var e_=Object.defineProperty;var t_=(d,s,u)=>s in d?e_(d,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):d[s]=u;var ur=(d,s,u)=>t_(d,typeof s!="symbol"?s+"":s,u);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))f(y);new MutationObserver(y=>{for(const _ of y)if(_.type==="childList")for(const g of _.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&f(g)}).observe(document,{childList:!0,subtree:!0});function u(y){const _={};return y.integrity&&(_.integrity=y.integrity),y.referrerPolicy&&(_.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?_.credentials="include":y.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function f(y){if(y.ep)return;y.ep=!0;const _=u(y);fetch(y.href,_)}})();(function(d,s){typeof exports=="object"&&typeof module<"u"?s(exports):typeof define=="function"&&define.amd?define(["exports"],s):s((d=typeof globalThis<"u"?globalThis:d||self).flatgeobuf={})})(void 0,function(d){var s,u=((s={})[s.Unknown=0]="Unknown",s[s.Point=1]="Point",s[s.LineString=2]="LineString",s[s.Polygon=3]="Polygon",s[s.MultiPoint=4]="MultiPoint",s[s.MultiLineString=5]="MultiLineString",s[s.MultiPolygon=6]="MultiPolygon",s[s.GeometryCollection=7]="GeometryCollection",s[s.CircularString=8]="CircularString",s[s.CompoundCurve=9]="CompoundCurve",s[s.CurvePolygon=10]="CurvePolygon",s[s.MultiCurve=11]="MultiCurve",s[s.MultiSurface=12]="MultiSurface",s[s.Curve=13]="Curve",s[s.Surface=14]="Surface",s[s.PolyhedralSurface=15]="PolyhedralSurface",s[s.TIN=16]="TIN",s[s.Triangle=17]="Triangle",s);const f=new Int32Array(2),y=new Float32Array(f.buffer),_=new Float64Array(f.buffer),g=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var a,C;(function(fe){fe[fe.UTF8_BYTES=1]="UTF8_BYTES",fe[fe.UTF16_STRING=2]="UTF16_STRING"})(a||(a={}));class F{constructor(k){this.bytes_=k,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(k){return new F(new Uint8Array(k))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(k){this.position_=k}capacity(){return this.bytes_.length}readInt8(k){return this.readUint8(k)<<24>>24}readUint8(k){return this.bytes_[k]}readInt16(k){return this.readUint16(k)<<16>>16}readUint16(k){return this.bytes_[k]|this.bytes_[k+1]<<8}readInt32(k){return this.bytes_[k]|this.bytes_[k+1]<<8|this.bytes_[k+2]<<16|this.bytes_[k+3]<<24}readUint32(k){return this.readInt32(k)>>>0}readInt64(k){return BigInt.asIntN(64,BigInt(this.readUint32(k))+(BigInt(this.readUint32(k+4))<<BigInt(32)))}readUint64(k){return BigInt.asUintN(64,BigInt(this.readUint32(k))+(BigInt(this.readUint32(k+4))<<BigInt(32)))}readFloat32(k){return f[0]=this.readInt32(k),y[0]}readFloat64(k){return f[g?0:1]=this.readInt32(k),f[g?1:0]=this.readInt32(k+4),_[0]}writeInt8(k,D){this.bytes_[k]=D}writeUint8(k,D){this.bytes_[k]=D}writeInt16(k,D){this.bytes_[k]=D,this.bytes_[k+1]=D>>8}writeUint16(k,D){this.bytes_[k]=D,this.bytes_[k+1]=D>>8}writeInt32(k,D){this.bytes_[k]=D,this.bytes_[k+1]=D>>8,this.bytes_[k+2]=D>>16,this.bytes_[k+3]=D>>24}writeUint32(k,D){this.bytes_[k]=D,this.bytes_[k+1]=D>>8,this.bytes_[k+2]=D>>16,this.bytes_[k+3]=D>>24}writeInt64(k,D){this.writeInt32(k,Number(BigInt.asIntN(32,D))),this.writeInt32(k+4,Number(BigInt.asIntN(32,D>>BigInt(32))))}writeUint64(k,D){this.writeUint32(k,Number(BigInt.asUintN(32,D))),this.writeUint32(k+4,Number(BigInt.asUintN(32,D>>BigInt(32))))}writeFloat32(k,D){y[0]=D,this.writeInt32(k,f[0])}writeFloat64(k,D){_[0]=D,this.writeInt32(k,f[g?0:1]),this.writeInt32(k+4,f[g?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+4+4)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let k="";for(let D=0;D<4;D++)k+=String.fromCharCode(this.readInt8(this.position_+4+D));return k}__offset(k,D){const ae=k-this.readInt32(k);return D<this.readInt16(ae)?this.readInt16(ae+D):0}__union(k,D){return k.bb_pos=D+this.readInt32(D),k.bb=this,k}__string(k,D){k+=this.readInt32(k);const ae=this.readInt32(k);k+=4;const Ee=this.bytes_.subarray(k,k+ae);return D===a.UTF8_BYTES?Ee:this.text_decoder_.decode(Ee)}__union_with_string(k,D){return typeof k=="string"?this.__string(D):this.__union(k,D)}__indirect(k){return k+this.readInt32(k)}__vector(k){return k+this.readInt32(k)+4}__vector_len(k){return this.readInt32(k+this.readInt32(k))}__has_identifier(k){if(k.length!=4)throw new Error("FlatBuffers: file identifier must be length 4");for(let D=0;D<4;D++)if(k.charCodeAt(D)!=this.readInt8(this.position()+4+D))return!1;return!0}createScalarList(k,D){const ae=[];for(let Ee=0;Ee<D;++Ee){const Re=k(Ee);Re!==null&&ae.push(Re)}return ae}createObjList(k,D){const ae=[];for(let Ee=0;Ee<D;++Ee){const Re=k(Ee);Re!==null&&ae.push(Re.unpack())}return ae}}class U{constructor(k){let D;this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder,D=k||1024,this.bb=F.allocate(D),this.space=D}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(k){this.force_defaults=k}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(k,D){k>this.minalign&&(this.minalign=k);const ae=1+~(this.bb.capacity()-this.space+D)&k-1;for(;this.space<ae+k+D;){const Ee=this.bb.capacity();this.bb=U.growByteBuffer(this.bb),this.space+=this.bb.capacity()-Ee}this.pad(ae)}pad(k){for(let D=0;D<k;D++)this.bb.writeInt8(--this.space,0)}writeInt8(k){this.bb.writeInt8(this.space-=1,k)}writeInt16(k){this.bb.writeInt16(this.space-=2,k)}writeInt32(k){this.bb.writeInt32(this.space-=4,k)}writeInt64(k){this.bb.writeInt64(this.space-=8,k)}writeFloat32(k){this.bb.writeFloat32(this.space-=4,k)}writeFloat64(k){this.bb.writeFloat64(this.space-=8,k)}addInt8(k){this.prep(1,0),this.writeInt8(k)}addInt16(k){this.prep(2,0),this.writeInt16(k)}addInt32(k){this.prep(4,0),this.writeInt32(k)}addInt64(k){this.prep(8,0),this.writeInt64(k)}addFloat32(k){this.prep(4,0),this.writeFloat32(k)}addFloat64(k){this.prep(8,0),this.writeFloat64(k)}addFieldInt8(k,D,ae){(this.force_defaults||D!=ae)&&(this.addInt8(D),this.slot(k))}addFieldInt16(k,D,ae){(this.force_defaults||D!=ae)&&(this.addInt16(D),this.slot(k))}addFieldInt32(k,D,ae){(this.force_defaults||D!=ae)&&(this.addInt32(D),this.slot(k))}addFieldInt64(k,D,ae){(this.force_defaults||D!==ae)&&(this.addInt64(D),this.slot(k))}addFieldFloat32(k,D,ae){(this.force_defaults||D!=ae)&&(this.addFloat32(D),this.slot(k))}addFieldFloat64(k,D,ae){(this.force_defaults||D!=ae)&&(this.addFloat64(D),this.slot(k))}addFieldOffset(k,D,ae){(this.force_defaults||D!=ae)&&(this.addOffset(D),this.slot(k))}addFieldStruct(k,D,ae){D!=ae&&(this.nested(D),this.slot(k))}nested(k){if(k!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(k){this.vtable!==null&&(this.vtable[k]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(k){const D=k.capacity();if(3221225472&D)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const ae=D<<1,Ee=F.allocate(ae);return Ee.setPosition(ae-D),Ee.bytes().set(k.bytes(),ae-D),Ee}addOffset(k){this.prep(4,0),this.writeInt32(this.offset()-k+4)}startObject(k){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=k;for(let D=0;D<k;D++)this.vtable[D]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const k=this.offset();let D=this.vtable_in_use-1;for(;D>=0&&this.vtable[D]==0;D--);const ae=D+1;for(;D>=0;D--)this.addInt16(this.vtable[D]!=0?k-this.vtable[D]:0);this.addInt16(k-this.object_start);const Ee=2*(ae+2);this.addInt16(Ee);let Re=0;const Ve=this.space;e:for(D=0;D<this.vtables.length;D++){const lt=this.bb.capacity()-this.vtables[D];if(Ee==this.bb.readInt16(lt)){for(let ee=2;ee<Ee;ee+=2)if(this.bb.readInt16(Ve+ee)!=this.bb.readInt16(lt+ee))continue e;Re=this.vtables[D];break}}return Re?(this.space=this.bb.capacity()-k,this.bb.writeInt32(this.space,Re-k)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-k,this.offset()-k)),this.isNested=!1,k}finish(k,D,ae){const Ee=ae?4:0;if(D){const Re=D;if(this.prep(this.minalign,8+Ee),Re.length!=4)throw new TypeError("FlatBuffers: file identifier must be length 4");for(let Ve=3;Ve>=0;Ve--)this.writeInt8(Re.charCodeAt(Ve))}this.prep(this.minalign,4+Ee),this.addOffset(k),Ee&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(k,D){this.finish(k,D,!0)}requiredField(k,D){const ae=this.bb.capacity()-k,Ee=ae-this.bb.readInt32(ae);if(!(D<this.bb.readInt16(Ee)&&this.bb.readInt16(Ee+D)!=0))throw new TypeError("FlatBuffers: field "+D+" must be set")}startVector(k,D,ae){this.notNested(),this.vector_num_elems=D,this.prep(4,k*D),this.prep(ae,k*D)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(k){if(!k)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(k))return this.string_maps.get(k);const D=this.createString(k);return this.string_maps.set(k,D),D}createString(k){if(k==null)return 0;let D;return D=k instanceof Uint8Array?k:this.text_encoder.encode(k),this.addInt8(0),this.startVector(1,D.length,1),this.bb.setPosition(this.space-=D.length),this.bb.bytes().set(D,this.space),this.endVector()}createByteVector(k){return k==null?0:(this.startVector(1,k.length,1),this.bb.setPosition(this.space-=k.length),this.bb.bytes().set(k,this.space),this.endVector())}createObjectOffset(k){return k===null?0:typeof k=="string"?this.createString(k):k.pack(this)}createObjectOffsetList(k){const D=[];for(let ae=0;ae<k.length;++ae){const Ee=k[ae];if(Ee===null)throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.");D.push(this.createObjectOffset(Ee))}return D}createStructOffsetList(k,D){return D(this,k.length),this.createObjectOffsetList(k.slice().reverse()),this.endVector()}}class O{constructor(){ur(this,"bb",null);ur(this,"bb_pos",0)}__init(k,D){return this.bb_pos=k,this.bb=D,this}static getRootAsGeometry(k,D){return(D||new O).__init(k.readInt32(k.position())+k.position(),k)}static getSizePrefixedRootAsGeometry(k,D){return k.setPosition(k.position()+4),(D||new O).__init(k.readInt32(k.position())+k.position(),k)}ends(k){let D=this.bb.__offset(this.bb_pos,4);return D?this.bb.readUint32(this.bb.__vector(this.bb_pos+D)+4*k):0}endsLength(){let k=this.bb.__offset(this.bb_pos,4);return k?this.bb.__vector_len(this.bb_pos+k):0}endsArray(){let k=this.bb.__offset(this.bb_pos,4);return k?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+k),this.bb.__vector_len(this.bb_pos+k)):null}xy(k){let D=this.bb.__offset(this.bb_pos,6);return D?this.bb.readFloat64(this.bb.__vector(this.bb_pos+D)+8*k):0}xyLength(){let k=this.bb.__offset(this.bb_pos,6);return k?this.bb.__vector_len(this.bb_pos+k):0}xyArray(){let k=this.bb.__offset(this.bb_pos,6);return k?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+k),this.bb.__vector_len(this.bb_pos+k)):null}z(k){let D=this.bb.__offset(this.bb_pos,8);return D?this.bb.readFloat64(this.bb.__vector(this.bb_pos+D)+8*k):0}zLength(){let k=this.bb.__offset(this.bb_pos,8);return k?this.bb.__vector_len(this.bb_pos+k):0}zArray(){let k=this.bb.__offset(this.bb_pos,8);return k?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+k),this.bb.__vector_len(this.bb_pos+k)):null}m(k){let D=this.bb.__offset(this.bb_pos,10);return D?this.bb.readFloat64(this.bb.__vector(this.bb_pos+D)+8*k):0}mLength(){let k=this.bb.__offset(this.bb_pos,10);return k?this.bb.__vector_len(this.bb_pos+k):0}mArray(){let k=this.bb.__offset(this.bb_pos,10);return k?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+k),this.bb.__vector_len(this.bb_pos+k)):null}t(k){let D=this.bb.__offset(this.bb_pos,12);return D?this.bb.readFloat64(this.bb.__vector(this.bb_pos+D)+8*k):0}tLength(){let k=this.bb.__offset(this.bb_pos,12);return k?this.bb.__vector_len(this.bb_pos+k):0}tArray(){let k=this.bb.__offset(this.bb_pos,12);return k?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+k),this.bb.__vector_len(this.bb_pos+k)):null}tm(k){let D=this.bb.__offset(this.bb_pos,14);return D?this.bb.readUint64(this.bb.__vector(this.bb_pos+D)+8*k):BigInt(0)}tmLength(){let k=this.bb.__offset(this.bb_pos,14);return k?this.bb.__vector_len(this.bb_pos+k):0}type(){let k=this.bb.__offset(this.bb_pos,16);return k?this.bb.readUint8(this.bb_pos+k):u.Unknown}parts(k,D){let ae=this.bb.__offset(this.bb_pos,18);return ae?(D||new O).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+ae)+4*k),this.bb):null}partsLength(){let k=this.bb.__offset(this.bb_pos,18);return k?this.bb.__vector_len(this.bb_pos+k):0}static startGeometry(k){k.startObject(8)}static addEnds(k,D){k.addFieldOffset(0,D,0)}static createEndsVector(k,D){k.startVector(4,D.length,4);for(let ae=D.length-1;ae>=0;ae--)k.addInt32(D[ae]);return k.endVector()}static startEndsVector(k,D){k.startVector(4,D,4)}static addXy(k,D){k.addFieldOffset(1,D,0)}static createXyVector(k,D){k.startVector(8,D.length,8);for(let ae=D.length-1;ae>=0;ae--)k.addFloat64(D[ae]);return k.endVector()}static startXyVector(k,D){k.startVector(8,D,8)}static addZ(k,D){k.addFieldOffset(2,D,0)}static createZVector(k,D){k.startVector(8,D.length,8);for(let ae=D.length-1;ae>=0;ae--)k.addFloat64(D[ae]);return k.endVector()}static startZVector(k,D){k.startVector(8,D,8)}static addM(k,D){k.addFieldOffset(3,D,0)}static createMVector(k,D){k.startVector(8,D.length,8);for(let ae=D.length-1;ae>=0;ae--)k.addFloat64(D[ae]);return k.endVector()}static startMVector(k,D){k.startVector(8,D,8)}static addT(k,D){k.addFieldOffset(4,D,0)}static createTVector(k,D){k.startVector(8,D.length,8);for(let ae=D.length-1;ae>=0;ae--)k.addFloat64(D[ae]);return k.endVector()}static startTVector(k,D){k.startVector(8,D,8)}static addTm(k,D){k.addFieldOffset(5,D,0)}static createTmVector(k,D){k.startVector(8,D.length,8);for(let ae=D.length-1;ae>=0;ae--)k.addInt64(D[ae]);return k.endVector()}static startTmVector(k,D){k.startVector(8,D,8)}static addType(k,D){k.addFieldInt8(6,D,u.Unknown)}static addParts(k,D){k.addFieldOffset(7,D,0)}static createPartsVector(k,D){k.startVector(4,D.length,4);for(let ae=D.length-1;ae>=0;ae--)k.addOffset(D[ae]);return k.endVector()}static startPartsVector(k,D){k.startVector(4,D,4)}static endGeometry(k){return k.endObject()}static createGeometry(k,D,ae,Ee,Re,Ve,lt,ee,B){return O.startGeometry(k),O.addEnds(k,D),O.addXy(k,ae),O.addZ(k,Ee),O.addM(k,Re),O.addT(k,Ve),O.addTm(k,lt),O.addType(k,ee),O.addParts(k,B),O.endGeometry(k)}}function $(fe,k){let D,ae,{xy:Ee,z:Re,ends:Ve,parts:lt,type:ee}=k;if(lt){let q=lt.map(ne=>$(fe,ne)),Y=O.createPartsVector(fe,q);return O.startGeometry(fe),O.addParts(fe,Y),O.addType(fe,ee),O.endGeometry(fe)}let B=O.createXyVector(fe,Ee);return Re&&(D=O.createZVector(fe,Re)),Ve&&(ae=O.createEndsVector(fe,Ve)),O.startGeometry(fe),ae&&O.addEnds(fe,ae),O.addXy(fe,B),D&&O.addZ(fe,D),O.addType(fe,ee),O.endGeometry(fe)}function V(fe,k,D){if(fe.length!==0)if(Array.isArray(fe[0]))for(let ae of fe)V(ae,k,D);else fe.length===2?k.push(...fe):(k.push(fe[0],fe[1]),D.push(fe[2]))}function ye(fe,k){let D=[];for(let ae=0;ae<fe.length;ae+=2){let Ee=[fe[ae],fe[ae+1]];k&&Ee.push(k[ae>>1]),D.push(Ee)}return D}function de(fe){return fe?u[fe]:u.Unknown}function Pe(fe){let k,D,ae=fe.coordinates,Ee=[],Re=[],Ve=de(fe.type),lt=0;switch(fe.type){case"Point":case"MultiPoint":case"LineString":V(ae,Ee,Re);break;case"MultiLineString":case"Polygon":V(ae,Ee,Re),ae.length>1&&(k=ae.map(ee=>lt+=ee.length));break;case"MultiPolygon":D=ae.map(ee=>({type:"Polygon",coordinates:ee})).map(Pe)}return{xy:Ee,z:Re.length>0?Re:void 0,ends:k,type:Ve,parts:D}}function ue(fe){let k=de(fe.type),D=[];for(let ae=0;ae<fe.geometries.length;ae++){let Ee=fe.geometries[ae];Ee.type==="GeometryCollection"?D.push(ue(Ee)):D.push(Pe(Ee))}return{type:k,parts:D}}function Se(fe,k){let D=k;if(D===u.Unknown&&(D=fe.type()),D===u.GeometryCollection){let Ee=[];for(let Re=0;Re<fe.partsLength();Re++){let Ve=fe.parts(Re),lt=Ve.type();Ee.push(Se(Ve,lt))}return{type:u[D],geometries:Ee}}if(D===u.MultiPolygon){let Ee=[];for(let Re=0;Re<fe.partsLength();Re++)Ee.push(Se(fe.parts(Re),u.Polygon));return{type:u[D],coordinates:Ee.map(Re=>Re.coordinates)}}let ae=function(Ee,Re){let Ve=Ee.xyArray(),lt=Ee.zArray();switch(Re){case u.Point:{let ee=Array.from(Ve);return lt&&ee.push(lt[0]),ee}case u.MultiPoint:case u.LineString:return ye(Ve,lt);case u.MultiLineString:case u.Polygon:return function(ee,B,q){let Y;if(!q||q.length===0)return[ye(ee,B)];let ne=0,ge=Array.from(q).map(ve=>ee.slice(ne,ne=ve<<1));return B&&(ne=0,Y=Array.from(q).map(ve=>B.slice(ne,ne=ve))),ge.map((ve,we)=>ye(ve,Y?Y[we]:void 0))}(Ve,lt,Ee.endsArray())}}(fe,D);return{type:u[D],coordinates:ae}}var ze=((C={})[C.Byte=0]="Byte",C[C.UByte=1]="UByte",C[C.Bool=2]="Bool",C[C.Short=3]="Short",C[C.UShort=4]="UShort",C[C.Int=5]="Int",C[C.UInt=6]="UInt",C[C.Long=7]="Long",C[C.ULong=8]="ULong",C[C.Float=9]="Float",C[C.Double=10]="Double",C[C.String=11]="String",C[C.Json=12]="Json",C[C.DateTime=13]="DateTime",C[C.Binary=14]="Binary",C);class Ye{constructor(){ur(this,"bb",null);ur(this,"bb_pos",0)}__init(k,D){return this.bb_pos=k,this.bb=D,this}static getRootAsColumn(k,D){return(D||new Ye).__init(k.readInt32(k.position())+k.position(),k)}static getSizePrefixedRootAsColumn(k,D){return k.setPosition(k.position()+4),(D||new Ye).__init(k.readInt32(k.position())+k.position(),k)}name(k){let D=this.bb.__offset(this.bb_pos,4);return D?this.bb.__string(this.bb_pos+D,k):null}type(){let k=this.bb.__offset(this.bb_pos,6);return k?this.bb.readUint8(this.bb_pos+k):ze.Byte}title(k){let D=this.bb.__offset(this.bb_pos,8);return D?this.bb.__string(this.bb_pos+D,k):null}description(k){let D=this.bb.__offset(this.bb_pos,10);return D?this.bb.__string(this.bb_pos+D,k):null}width(){let k=this.bb.__offset(this.bb_pos,12);return k?this.bb.readInt32(this.bb_pos+k):-1}precision(){let k=this.bb.__offset(this.bb_pos,14);return k?this.bb.readInt32(this.bb_pos+k):-1}scale(){let k=this.bb.__offset(this.bb_pos,16);return k?this.bb.readInt32(this.bb_pos+k):-1}nullable(){let k=this.bb.__offset(this.bb_pos,18);return!k||!!this.bb.readInt8(this.bb_pos+k)}unique(){let k=this.bb.__offset(this.bb_pos,20);return!!k&&!!this.bb.readInt8(this.bb_pos+k)}primaryKey(){let k=this.bb.__offset(this.bb_pos,22);return!!k&&!!this.bb.readInt8(this.bb_pos+k)}metadata(k){let D=this.bb.__offset(this.bb_pos,24);return D?this.bb.__string(this.bb_pos+D,k):null}static startColumn(k){k.startObject(11)}static addName(k,D){k.addFieldOffset(0,D,0)}static addType(k,D){k.addFieldInt8(1,D,ze.Byte)}static addTitle(k,D){k.addFieldOffset(2,D,0)}static addDescription(k,D){k.addFieldOffset(3,D,0)}static addWidth(k,D){k.addFieldInt32(4,D,-1)}static addPrecision(k,D){k.addFieldInt32(5,D,-1)}static addScale(k,D){k.addFieldInt32(6,D,-1)}static addNullable(k,D){k.addFieldInt8(7,+D,1)}static addUnique(k,D){k.addFieldInt8(8,+D,0)}static addPrimaryKey(k,D){k.addFieldInt8(9,+D,0)}static addMetadata(k,D){k.addFieldOffset(10,D,0)}static endColumn(k){let D=k.endObject();return k.requiredField(D,4),D}static createColumn(k,D,ae,Ee,Re,Ve,lt,ee,B,q,Y,ne){return Ye.startColumn(k),Ye.addName(k,D),Ye.addType(k,ae),Ye.addTitle(k,Ee),Ye.addDescription(k,Re),Ye.addWidth(k,Ve),Ye.addPrecision(k,lt),Ye.addScale(k,ee),Ye.addNullable(k,B),Ye.addUnique(k,q),Ye.addPrimaryKey(k,Y),Ye.addMetadata(k,ne),Ye.endColumn(k)}}class Je{constructor(){ur(this,"bb",null);ur(this,"bb_pos",0)}__init(k,D){return this.bb_pos=k,this.bb=D,this}static getRootAsFeature(k,D){return(D||new Je).__init(k.readInt32(k.position())+k.position(),k)}static getSizePrefixedRootAsFeature(k,D){return k.setPosition(k.position()+4),(D||new Je).__init(k.readInt32(k.position())+k.position(),k)}geometry(k){let D=this.bb.__offset(this.bb_pos,4);return D?(k||new O).__init(this.bb.__indirect(this.bb_pos+D),this.bb):null}properties(k){let D=this.bb.__offset(this.bb_pos,6);return D?this.bb.readUint8(this.bb.__vector(this.bb_pos+D)+k):0}propertiesLength(){let k=this.bb.__offset(this.bb_pos,6);return k?this.bb.__vector_len(this.bb_pos+k):0}propertiesArray(){let k=this.bb.__offset(this.bb_pos,6);return k?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+k),this.bb.__vector_len(this.bb_pos+k)):null}columns(k,D){let ae=this.bb.__offset(this.bb_pos,8);return ae?(D||new Ye).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+ae)+4*k),this.bb):null}columnsLength(){let k=this.bb.__offset(this.bb_pos,8);return k?this.bb.__vector_len(this.bb_pos+k):0}static startFeature(k){k.startObject(3)}static addGeometry(k,D){k.addFieldOffset(0,D,0)}static addProperties(k,D){k.addFieldOffset(1,D,0)}static createPropertiesVector(k,D){k.startVector(1,D.length,1);for(let ae=D.length-1;ae>=0;ae--)k.addInt8(D[ae]);return k.endVector()}static startPropertiesVector(k,D){k.startVector(1,D,1)}static addColumns(k,D){k.addFieldOffset(2,D,0)}static createColumnsVector(k,D){k.startVector(4,D.length,4);for(let ae=D.length-1;ae>=0;ae--)k.addOffset(D[ae]);return k.endVector()}static startColumnsVector(k,D){k.startVector(4,D,4)}static endFeature(k){return k.endObject()}static finishFeatureBuffer(k,D){k.finish(D)}static finishSizePrefixedFeatureBuffer(k,D){k.finish(D,void 0,!0)}static createFeature(k,D,ae,Ee){return Je.startFeature(k),Je.addGeometry(k,D),Je.addProperties(k,ae),Je.addColumns(k,Ee),Je.endFeature(k)}}let ct=new TextEncoder,Ge=new TextDecoder;function De(fe,k,D){let ae=D.columns,Ee=new U,Re=0,Ve=1024,lt=new Uint8Array(1024),ee=new DataView(lt.buffer),B=function(ge){if(Re+ge<Ve)return;let ve=new Uint8Array(Ve=Math.max(Ve+ge,2*Ve));ve.set(lt),ee=new DataView((lt=ve).buffer)};if(ae)for(let ge=0;ge<ae.length;ge++){let ve=ae[ge],we=k[ve.name];if(we!==null)switch(B(2),ee.setUint16(Re,ge,!0),Re+=2,ve.type){case ze.Bool:B(1),ee.setUint8(Re,we),Re+=1;break;case ze.Short:B(2),ee.setInt16(Re,we,!0),Re+=2;break;case ze.UShort:B(2),ee.setUint16(Re,we,!0),Re+=2;break;case ze.Int:B(4),ee.setInt32(Re,we,!0),Re+=4;break;case ze.UInt:B(4),ee.setUint32(Re,we,!0),Re+=4;break;case ze.Long:B(8),ee.setBigInt64(Re,BigInt(we),!0),Re+=8;break;case ze.Float:B(4),ee.setFloat32(Re,we,!0),Re+=4;break;case ze.Double:B(8),ee.setFloat64(Re,we,!0),Re+=8;break;case ze.DateTime:case ze.String:{let be=ct.encode(we);B(4),ee.setUint32(Re,be.length,!0),Re+=4,B(be.length),lt.set(be,Re),Re+=be.length;break}case ze.Json:{let be=ct.encode(JSON.stringify(we));B(4),ee.setUint32(Re,be.length,!0),Re+=4,B(be.length),lt.set(be,Re),Re+=be.length;break}case ze.Binary:B(4),ee.setUint32(Re,we.length,!0),Re+=4,B(we.length),lt.set(we,Re),Re+=we.length;break;default:throw Error("Unknown type "+ve.type)}}let q=0;Re>0&&(q=Je.createPropertiesVector(Ee,lt.slice(0,Re)));let Y=$(Ee,fe);Je.startFeature(Ee),Je.addGeometry(Ee,Y),q&&Je.addProperties(Ee,q);let ne=Je.endFeature(Ee);return Ee.finishSizePrefixed(ne),Ee.asUint8Array()}function Qe(fe,k){let D={};if(!k||k.length===0)return D;let ae=fe.propertiesArray();if(!ae)return D;let Ee=new DataView(ae.buffer,ae.byteOffset),Re=fe.propertiesLength(),Ve=0;for(;Ve<Re;){let lt=Ee.getUint16(Ve,!0);Ve+=2;let ee=k[lt],B=ee.name;switch(ee.type){case ze.Bool:D[B]=!!Ee.getUint8(Ve),Ve+=1;break;case ze.Byte:D[B]=Ee.getInt8(Ve),Ve+=1;break;case ze.UByte:D[B]=Ee.getUint8(Ve),Ve+=1;break;case ze.Short:D[B]=Ee.getInt16(Ve,!0),Ve+=2;break;case ze.UShort:D[B]=Ee.getUint16(Ve,!0),Ve+=2;break;case ze.Int:D[B]=Ee.getInt32(Ve,!0),Ve+=4;break;case ze.UInt:D[B]=Ee.getUint32(Ve,!0),Ve+=4;break;case ze.Long:D[B]=Number(Ee.getBigInt64(Ve,!0)),Ve+=8;break;case ze.ULong:D[B]=Number(Ee.getBigUint64(Ve,!0)),Ve+=8;break;case ze.Float:D[B]=Ee.getFloat32(Ve,!0),Ve+=4;break;case ze.Double:D[B]=Ee.getFloat64(Ve,!0),Ve+=8;break;case ze.DateTime:case ze.String:{let q=Ee.getUint32(Ve,!0);Ve+=4,D[B]=Ge.decode(ae.subarray(Ve,Ve+q)),Ve+=q;break}case ze.Json:{let q=Ee.getUint32(Ve,!0);Ve+=4;let Y=Ge.decode(ae.subarray(Ve,Ve+q));D[B]=JSON.parse(Y),Ve+=q;break}case ze.Binary:{let q=Ee.getUint32(Ve,!0);Ve+=4,D[B]=ae.subarray(Ve,Ve+q),Ve+=q;break}default:throw Error("Unknown type "+ee.type)}}return D}function pt(fe,k,D){let ae=D.columns;return{type:"Feature",id:fe,geometry:Se(k.geometry(),D.geometryType),properties:Qe(k,ae)}}var pe=new Uint8Array(0);function me(fe,k){if(!fe.length)return k;if(!k.length)return fe;var D=new Uint8Array(fe.length+k.length);return D.set(fe),D.set(k,fe.length),D}function Ne(fe){this._source=fe,this._array=pe,this._index=0}Ne.prototype.read=function(){var fe=this,k=fe._array.subarray(fe._index);return fe._source.read().then(function(D){return fe._array=pe,fe._index=0,D.done?k.length>0?{done:!1,value:k}:{done:!0,value:void 0}:{done:!1,value:me(k,D.value)}})},Ne.prototype.slice=function(fe){if((fe|=0)<0)throw new Error("invalid length");var k=this,D=this._array.length-this._index;if(this._index+fe<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=fe));var ae=new Uint8Array(fe);return ae.set(this._array.subarray(this._index)),function Ee(){return k._source.read().then(function(Re){return Re.done?(k._array=pe,k._index=0,D>0?ae.subarray(0,D):null):D+Re.value.length>=fe?(k._array=Re.value,k._index=fe-D,ae.set(Re.value.subarray(0,fe-D),D),ae):(ae.set(Re.value,D),D+=Re.value.length,Ee())})}()},Ne.prototype.cancel=function(){return this._source.cancel()};class Le{constructor(){ur(this,"bb",null);ur(this,"bb_pos",0)}__init(k,D){return this.bb_pos=k,this.bb=D,this}static getRootAsCrs(k,D){return(D||new Le).__init(k.readInt32(k.position())+k.position(),k)}static getSizePrefixedRootAsCrs(k,D){return k.setPosition(k.position()+4),(D||new Le).__init(k.readInt32(k.position())+k.position(),k)}org(k){let D=this.bb.__offset(this.bb_pos,4);return D?this.bb.__string(this.bb_pos+D,k):null}code(){let k=this.bb.__offset(this.bb_pos,6);return k?this.bb.readInt32(this.bb_pos+k):0}name(k){let D=this.bb.__offset(this.bb_pos,8);return D?this.bb.__string(this.bb_pos+D,k):null}description(k){let D=this.bb.__offset(this.bb_pos,10);return D?this.bb.__string(this.bb_pos+D,k):null}wkt(k){let D=this.bb.__offset(this.bb_pos,12);return D?this.bb.__string(this.bb_pos+D,k):null}codeString(k){let D=this.bb.__offset(this.bb_pos,14);return D?this.bb.__string(this.bb_pos+D,k):null}static startCrs(k){k.startObject(6)}static addOrg(k,D){k.addFieldOffset(0,D,0)}static addCode(k,D){k.addFieldInt32(1,D,0)}static addName(k,D){k.addFieldOffset(2,D,0)}static addDescription(k,D){k.addFieldOffset(3,D,0)}static addWkt(k,D){k.addFieldOffset(4,D,0)}static addCodeString(k,D){k.addFieldOffset(5,D,0)}static endCrs(k){return k.endObject()}static createCrs(k,D,ae,Ee,Re,Ve,lt){return Le.startCrs(k),Le.addOrg(k,D),Le.addCode(k,ae),Le.addName(k,Ee),Le.addDescription(k,Re),Le.addWkt(k,Ve),Le.addCodeString(k,lt),Le.endCrs(k)}}class et{constructor(){ur(this,"bb",null);ur(this,"bb_pos",0)}__init(k,D){return this.bb_pos=k,this.bb=D,this}static getRootAsHeader(k,D){return(D||new et).__init(k.readInt32(k.position())+k.position(),k)}static getSizePrefixedRootAsHeader(k,D){return k.setPosition(k.position()+4),(D||new et).__init(k.readInt32(k.position())+k.position(),k)}name(k){let D=this.bb.__offset(this.bb_pos,4);return D?this.bb.__string(this.bb_pos+D,k):null}envelope(k){let D=this.bb.__offset(this.bb_pos,6);return D?this.bb.readFloat64(this.bb.__vector(this.bb_pos+D)+8*k):0}envelopeLength(){let k=this.bb.__offset(this.bb_pos,6);return k?this.bb.__vector_len(this.bb_pos+k):0}envelopeArray(){let k=this.bb.__offset(this.bb_pos,6);return k?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+k),this.bb.__vector_len(this.bb_pos+k)):null}geometryType(){let k=this.bb.__offset(this.bb_pos,8);return k?this.bb.readUint8(this.bb_pos+k):u.Unknown}hasZ(){let k=this.bb.__offset(this.bb_pos,10);return!!k&&!!this.bb.readInt8(this.bb_pos+k)}hasM(){let k=this.bb.__offset(this.bb_pos,12);return!!k&&!!this.bb.readInt8(this.bb_pos+k)}hasT(){let k=this.bb.__offset(this.bb_pos,14);return!!k&&!!this.bb.readInt8(this.bb_pos+k)}hasTm(){let k=this.bb.__offset(this.bb_pos,16);return!!k&&!!this.bb.readInt8(this.bb_pos+k)}columns(k,D){let ae=this.bb.__offset(this.bb_pos,18);return ae?(D||new Ye).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+ae)+4*k),this.bb):null}columnsLength(){let k=this.bb.__offset(this.bb_pos,18);return k?this.bb.__vector_len(this.bb_pos+k):0}featuresCount(){let k=this.bb.__offset(this.bb_pos,20);return k?this.bb.readUint64(this.bb_pos+k):BigInt("0")}indexNodeSize(){let k=this.bb.__offset(this.bb_pos,22);return k?this.bb.readUint16(this.bb_pos+k):16}crs(k){let D=this.bb.__offset(this.bb_pos,24);return D?(k||new Le).__init(this.bb.__indirect(this.bb_pos+D),this.bb):null}title(k){let D=this.bb.__offset(this.bb_pos,26);return D?this.bb.__string(this.bb_pos+D,k):null}description(k){let D=this.bb.__offset(this.bb_pos,28);return D?this.bb.__string(this.bb_pos+D,k):null}metadata(k){let D=this.bb.__offset(this.bb_pos,30);return D?this.bb.__string(this.bb_pos+D,k):null}static startHeader(k){k.startObject(14)}static addName(k,D){k.addFieldOffset(0,D,0)}static addEnvelope(k,D){k.addFieldOffset(1,D,0)}static createEnvelopeVector(k,D){k.startVector(8,D.length,8);for(let ae=D.length-1;ae>=0;ae--)k.addFloat64(D[ae]);return k.endVector()}static startEnvelopeVector(k,D){k.startVector(8,D,8)}static addGeometryType(k,D){k.addFieldInt8(2,D,u.Unknown)}static addHasZ(k,D){k.addFieldInt8(3,+D,0)}static addHasM(k,D){k.addFieldInt8(4,+D,0)}static addHasT(k,D){k.addFieldInt8(5,+D,0)}static addHasTm(k,D){k.addFieldInt8(6,+D,0)}static addColumns(k,D){k.addFieldOffset(7,D,0)}static createColumnsVector(k,D){k.startVector(4,D.length,4);for(let ae=D.length-1;ae>=0;ae--)k.addOffset(D[ae]);return k.endVector()}static startColumnsVector(k,D){k.startVector(4,D,4)}static addFeaturesCount(k,D){k.addFieldInt64(8,D,BigInt("0"))}static addIndexNodeSize(k,D){k.addFieldInt16(9,D,16)}static addCrs(k,D){k.addFieldOffset(10,D,0)}static addTitle(k,D){k.addFieldOffset(11,D,0)}static addDescription(k,D){k.addFieldOffset(12,D,0)}static addMetadata(k,D){k.addFieldOffset(13,D,0)}static endHeader(k){return k.endObject()}static finishHeaderBuffer(k,D){k.finish(D)}static finishSizePrefixedHeaderBuffer(k,D){k.finish(D,void 0,!0)}}function it(fe){let k=et.getRootAsHeader(fe),D=k.featuresCount(),ae=k.indexNodeSize(),Ee=[];for(let lt=0;lt<k.columnsLength();lt++){let ee=k.columns(lt);if(!ee)throw Error("Column unexpectedly missing");if(!ee.name())throw Error("Column name unexpectedly missing");Ee.push({name:ee.name(),type:ee.type(),title:ee.title(),description:ee.description(),width:ee.width(),precision:ee.precision(),scale:ee.scale(),nullable:ee.nullable(),unique:ee.unique(),primary_key:ee.primaryKey()})}let Re=k.crs(),Ve=Re?{org:Re.org(),code:Re.code(),name:Re.name(),description:Re.description(),wkt:Re.wkt(),code_string:Re.codeString()}:null;return{geometryType:k.geometryType(),columns:Ee,envelope:null,featuresCount:Number(D),indexNodeSize:ae,crs:Ve,title:k.title(),description:k.description(),metadata:k.metadata()}}/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var nt=function(fe,k){return nt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,ae){D.__proto__=ae}||function(D,ae){for(var Ee in ae)ae.hasOwnProperty(Ee)&&(D[Ee]=ae[Ee])},nt(fe,k)};function Xe(fe,k,D,ae){return new(D||(D=Promise))(function(Ee,Re){function Ve(B){try{ee(ae.next(B))}catch(q){Re(q)}}function lt(B){try{ee(ae.throw(B))}catch(q){Re(q)}}function ee(B){var q;B.done?Ee(B.value):(q=B.value,q instanceof D?q:new D(function(Y){Y(q)})).then(Ve,lt)}ee((ae=ae.apply(fe,[])).next())})}function at(fe,k){var D,ae,Ee,Re,Ve={label:0,sent:function(){if(1&Ee[0])throw Ee[1];return Ee[1]},trys:[],ops:[]};return Re={next:lt(0),throw:lt(1),return:lt(2)},typeof Symbol=="function"&&(Re[Symbol.iterator]=function(){return this}),Re;function lt(ee){return function(B){return function(q){if(D)throw new TypeError("Generator is already executing.");for(;Ve;)try{if(D=1,ae&&(Ee=2&q[0]?ae.return:q[0]?ae.throw||((Ee=ae.return)&&Ee.call(ae),0):ae.next)&&!(Ee=Ee.call(ae,q[1])).done)return Ee;switch(ae=0,Ee&&(q=[2&q[0],Ee.value]),q[0]){case 0:case 1:Ee=q;break;case 4:return Ve.label++,{value:q[1],done:!1};case 5:Ve.label++,ae=q[1],q=[0];continue;case 7:q=Ve.ops.pop(),Ve.trys.pop();continue;default:if(Ee=Ve.trys,!((Ee=Ee.length>0&&Ee[Ee.length-1])||q[0]!==6&&q[0]!==2)){Ve=0;continue}if(q[0]===3&&(!Ee||q[1]>Ee[0]&&q[1]<Ee[3])){Ve.label=q[1];break}if(q[0]===6&&Ve.label<Ee[1]){Ve.label=Ee[1],Ee=q;break}if(Ee&&Ve.label<Ee[2]){Ve.label=Ee[2],Ve.ops.push(q);break}Ee[2]&&Ve.ops.pop(),Ve.trys.pop();continue}q=k.call(fe,Ve)}catch(Y){q=[6,Y],ae=0}finally{D=Ee=0}if(5&q[0])throw q[1];return{value:q[0]?q[1]:void 0,done:!0}}([ee,B])}}}function dt(fe){var k=typeof Symbol=="function"&&Symbol.iterator,D=k&&fe[k],ae=0;if(D)return D.call(fe);if(fe&&typeof fe.length=="number")return{next:function(){return fe&&ae>=fe.length&&(fe=void 0),{value:fe&&fe[ae++],done:!fe}}};throw new TypeError(k?"Object is not iterable.":"Symbol.iterator is not defined.")}function Mt(fe){return this instanceof Mt?(this.v=fe,this):new Mt(fe)}function ie(fe,k,D){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var ae,Ee=D.apply(fe,k||[]),Re=[];return ae={},Ve("next"),Ve("throw"),Ve("return"),ae[Symbol.asyncIterator]=function(){return this},ae;function Ve(Y){Ee[Y]&&(ae[Y]=function(ne){return new Promise(function(ge,ve){Re.push([Y,ne,ge,ve])>1||lt(Y,ne)})})}function lt(Y,ne){try{(function(ge){ge.value instanceof Mt?Promise.resolve(ge.value.v).then(ee,B):q(Re[0][2],ge)})(Ee[Y](ne))}catch(ge){q(Re[0][3],ge)}}function ee(Y){lt("next",Y)}function B(Y){lt("throw",Y)}function q(Y,ne){Y(ne),Re.shift(),Re.length&&lt(Re[0][0],Re[0][1])}}var xe=function(fe){function k(D){var ae=fe.call(this,D)||this;return Object.defineProperty(ae,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(ae,ae.constructor.prototype):ae.__proto__=ae.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(ae,ae.constructor),ae}return function(D,ae){function Ee(){this.constructor=D}nt(D,ae),D.prototype=ae===null?Object.create(ae):(Ee.prototype=ae.prototype,new Ee)}(k,fe),k}(Error);function ke(fe){fe!=null&&typeof fe.then=="function"&&fe.then(qe,qe)}(function(){function fe(k){if(k<0)throw new RangeError("Capacity may not be less than 0");this._c=k,this._q=[]}Object.defineProperty(fe.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(fe.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),fe.prototype.add=function(k){if(this.full)throw new Error("Buffer full");this._q.push(k)},fe.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}})(),function(){function fe(k){if(k<1)throw new RangeError("Capacity may not be less than 1");this._c=k,this._q=[]}Object.defineProperty(fe.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(fe.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),fe.prototype.add=function(k){for(;this._q.length>=this._c;)this._q.shift();this._q.push(k)},fe.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}}(),function(){function fe(k){if(k<1)throw new RangeError("Capacity may not be less than 1");this._c=k,this._q=[]}Object.defineProperty(fe.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(fe.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),fe.prototype.add=function(k){this._q.length<this._c&&this._q.push(k)},fe.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}}();var Fe=1024,qe=function(){};function $e(fe){var k=fe.err,D=Promise.resolve(fe.execution).then(function(ae){if(k!=null)throw k;return ae});return fe.err=void 0,fe.execution=D.then(function(){},function(){}),fe.pending===void 0?D:fe.pending.then(function(){return D})}function Ke(fe,k){var D=fe.state>=3;return Promise.resolve(k).then(function(ae){return!D&&fe.state>=4?$e(fe).then(function(Ee){return{value:Ee,done:!0}}):{value:ae,done:D}})}function tt(fe,k){var D,ae;if(!(fe.state>=2))if(fe.state=2,fe.onnext(),fe.onstop(),fe.err==null&&(fe.err=k),fe.pushes.length!==0||fe.buffer!==void 0&&!fe.buffer.empty)try{for(var Ee=dt(fe.pushes),Re=Ee.next();!Re.done;Re=Ee.next())Re.value.resolve()}catch(Ve){D={error:Ve}}finally{try{Re&&!Re.done&&(ae=Ee.return)&&ae.call(Ee)}finally{if(D)throw D.error}}else Tt(fe)}function Tt(fe){var k,D;if(!(fe.state>=3)){fe.state<2&&tt(fe),fe.state=3,fe.buffer=void 0;try{for(var ae=dt(fe.nexts),Ee=ae.next();!Ee.done;Ee=ae.next()){var Re=Ee.value,Ve=fe.pending===void 0?$e(fe):fe.pending.then(function(){return $e(fe)});Re.resolve(Ke(fe,Ve))}}catch(lt){k={error:lt}}finally{try{Ee&&!Ee.done&&(D=ae.return)&&D.call(ae)}finally{if(k)throw k.error}}fe.pushes=[],fe.nexts=[]}}function kt(fe){fe.state>=4||(fe.state<3&&Tt(fe),fe.state=4)}function Nt(fe,k){if(ke(k),fe.pushes.length>=Fe)throw new xe("No more than 1024 pending calls to push are allowed on a single repeater.");if(fe.state>=2)return Promise.resolve(void 0);var D,ae=fe.pending===void 0?Promise.resolve(k):fe.pending.then(function(){return k});ae=ae.catch(function(lt){fe.state<2&&(fe.err=lt),kt(fe)}),fe.nexts.length?(fe.nexts.shift().resolve(Ke(fe,ae)),D=fe.nexts.length?Promise.resolve(fe.nexts[0].value):fe.buffer===void 0||fe.buffer.full?new Promise(function(lt){return fe.onnext=lt}):Promise.resolve(void 0)):fe.buffer===void 0||fe.buffer.full?D=new Promise(function(lt){return fe.pushes.push({resolve:lt,value:ae})}):(fe.buffer.add(ae),D=Promise.resolve(void 0));var Ee=!0,Re={},Ve=D.catch(function(lt){if(Ee)throw lt});return Re.then=function(lt,ee){return Ee=!1,Promise.prototype.then.call(D,lt,ee)},Re.catch=function(lt){return Ee=!1,Promise.prototype.catch.call(D,lt)},Re.finally=D.finally.bind(D),fe.pending=ae.then(function(){return Ve}).catch(function(lt){fe.err=lt,kt(fe)}),Re}function zt(fe){if(!(fe.state>=1)){fe.state=1;var k=Nt.bind(null,fe),D=function(ae){var Ee=tt.bind(null,ae),Re=new Promise(function(Ve){return ae.onstop=Ve});return Ee.then=Re.then.bind(Re),Ee.catch=Re.catch.bind(Re),Ee.finally=Re.finally.bind(Re),Ee}(fe);fe.execution=new Promise(function(ae){return ae(fe.executor(k,D))}),fe.execution.catch(function(){return tt(fe)})}}var ti=new WeakMap,ht=function(){function fe(k,D){ti.set(this,{executor:k,buffer:D,err:void 0,state:0,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:qe,onstop:qe})}return fe.prototype.next=function(k){ke(k);var D=ti.get(this);if(D===void 0)throw new Error("WeakMap error");if(D.nexts.length>=Fe)throw new xe("No more than 1024 pending calls to next are allowed on a single repeater.");if(D.state<=0&&zt(D),D.onnext(k),D.buffer!==void 0&&!D.buffer.empty){var ae=Ke(D,D.buffer.remove());if(D.pushes.length){var Ee=D.pushes.shift();D.buffer.add(Ee.value),D.onnext=Ee.resolve}return ae}if(D.pushes.length){var Re=D.pushes.shift();return D.onnext=Re.resolve,Ke(D,Re.value)}return D.state>=2?(Tt(D),Ke(D,$e(D))):new Promise(function(Ve){return D.nexts.push({resolve:Ve,value:k})})},fe.prototype.return=function(k){ke(k);var D=ti.get(this);if(D===void 0)throw new Error("WeakMap error");return Tt(D),D.execution=Promise.resolve(D.execution).then(function(){return k}),Ke(D,$e(D))},fe.prototype.throw=function(k){var D=ti.get(this);if(D===void 0)throw new Error("WeakMap error");return D.state<=0||D.state>=2||D.buffer!==void 0&&!D.buffer.empty?(Tt(D),D.err==null&&(D.err=k),Ke(D,$e(D))):this.next(Promise.reject(k))},fe.prototype[Symbol.asyncIterator]=function(){return this},fe.race=gi,fe.merge=Ht,fe.zip=ft,fe.latest=Pt,fe}();function te(fe,k){var D,ae,Ee=[],Re=function(ee){ee!=null&&typeof ee[Symbol.asyncIterator]=="function"?Ee.push(ee[Symbol.asyncIterator]()):ee!=null&&typeof ee[Symbol.iterator]=="function"?Ee.push(ee[Symbol.iterator]()):Ee.push(function(){return ie(this,arguments,function(){return at(this,function(B){switch(B.label){case 0:return k.yieldValues?[4,Mt(ee)]:[3,3];case 1:return[4,B.sent()];case 2:B.sent(),B.label=3;case 3:return k.returnValues?[4,Mt(ee)]:[3,5];case 4:return[2,B.sent()];case 5:return[2]}})})}())};try{for(var Ve=dt(fe),lt=Ve.next();!lt.done;lt=Ve.next())Re(lt.value)}catch(ee){D={error:ee}}finally{try{lt&&!lt.done&&(ae=Ve.return)&&ae.call(Ve)}finally{if(D)throw D.error}}return Ee}function gi(fe){var k=this,D=te(fe,{returnValues:!0});return new ht(function(ae,Ee){return Xe(k,0,void 0,function(){var Re,Ve,lt,ee,B,q;return at(this,function(Y){switch(Y.label){case 0:if(!D.length)return Ee(),[2];Ve=!1,Ee.then(function(){Re(),Ve=!0}),Y.label=1;case 1:Y.trys.push([1,,5,7]),ee=void 0,B=0,q=function(){var ne,ge,ve,we,be,He;return at(this,function(st){switch(st.label){case 0:ne=B;try{for(be=void 0,ge=dt(D),ve=ge.next();!ve.done;ve=ge.next())we=ve.value,Promise.resolve(we.next()).then(function(je){je.done?(Ee(),lt===void 0&&(lt=je)):B===ne&&(B++,Re(je))},function(je){return Ee(je)})}catch(je){be={error:je}}finally{try{ve&&!ve.done&&(He=ge.return)&&He.call(ge)}finally{if(be)throw be.error}}return[4,new Promise(function(je){return Re=je})];case 1:return(ee=st.sent())===void 0?[3,3]:[4,ae(ee.value)];case 2:st.sent(),st.label=3;case 3:return[2]}})},Y.label=2;case 2:return Ve?[3,4]:[5,q()];case 3:return Y.sent(),[3,2];case 4:return[2,lt&&lt.value];case 5:return Ee(),[4,Promise.race(D.map(function(ne){return ne.return&&ne.return()}))];case 6:return Y.sent(),[7];case 7:return[2]}})})})}function Ht(fe){var k=this,D=te(fe,{yieldValues:!0});return new ht(function(ae,Ee){return Xe(k,0,void 0,function(){var Re,Ve,lt,ee=this;return at(this,function(B){switch(B.label){case 0:if(!D.length)return Ee(),[2];Re=[],Ve=!1,Ee.then(function(){var q,Y;Ve=!0;try{for(var ne=dt(Re),ge=ne.next();!ge.done;ge=ne.next())(0,ge.value)()}catch(ve){q={error:ve}}finally{try{ge&&!ge.done&&(Y=ne.return)&&Y.call(ne)}finally{if(q)throw q.error}}}),B.label=1;case 1:return B.trys.push([1,,3,4]),[4,Promise.all(D.map(function(q,Y){return Xe(ee,0,void 0,function(){var ne;return at(this,function(ge){switch(ge.label){case 0:ge.trys.push([0,,6,9]),ge.label=1;case 1:return Ve?[3,5]:(Promise.resolve(q.next()).then(function(ve){return Re[Y](ve)},function(ve){return Ee(ve)}),[4,new Promise(function(ve){Re[Y]=ve})]);case 2:return(ne=ge.sent())===void 0?[3,4]:ne.done?(lt=ne,[2]):[4,ae(ne.value)];case 3:ge.sent(),ge.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return q.return?[4,q.return()]:[3,8];case 7:ge.sent(),ge.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return B.sent(),[2,lt&&lt.value];case 3:return Ee(),[7];case 4:return[2]}})})})}function ft(fe){var k=this,D=te(fe,{returnValues:!0});return new ht(function(ae,Ee){return Xe(k,0,void 0,function(){var Re,Ve,lt,ee;return at(this,function(B){switch(B.label){case 0:if(!D.length)return Ee(),[2,[]];Ve=!1,Ee.then(function(){Re(),Ve=!0}),B.label=1;case 1:B.trys.push([1,,6,8]),B.label=2;case 2:return Ve?[3,5]:(Promise.all(D.map(function(q){return q.next()})).then(function(q){return Re(q)},function(q){return Ee(q)}),[4,new Promise(function(q){return Re=q})]);case 3:return(lt=B.sent())===void 0?[2]:(ee=lt.map(function(q){return q.value}),lt.some(function(q){return q.done})?[2,ee]:[4,ae(ee)]);case 4:return B.sent(),[3,2];case 5:return[3,8];case 6:return Ee(),[4,Promise.all(D.map(function(q){return q.return&&q.return()}))];case 7:return B.sent(),[7];case 8:return[2]}})})})}function Pt(fe){var k=this,D=te(fe,{yieldValues:!0,returnValues:!0});return new ht(function(ae,Ee){return Xe(k,0,void 0,function(){var Re,Ve,lt,ee,B,q=this;return at(this,function(Y){switch(Y.label){case 0:if(!D.length)return Ee(),[2,[]];Ve=[],lt=!1,Ee.then(function(){var ne,ge;Re();try{for(var ve=dt(Ve),we=ve.next();!we.done;we=ve.next())(0,we.value)()}catch(be){ne={error:be}}finally{try{we&&!we.done&&(ge=ve.return)&&ge.call(ve)}finally{if(ne)throw ne.error}}lt=!0}),Y.label=1;case 1:return Y.trys.push([1,,5,7]),Promise.all(D.map(function(ne){return ne.next()})).then(function(ne){return Re(ne)},function(ne){return Ee(ne)}),[4,new Promise(function(ne){return Re=ne})];case 2:return(ee=Y.sent())===void 0?[2]:(B=ee.map(function(ne){return ne.value}),ee.every(function(ne){return ne.done})?[2,B]:[4,ae(B.slice())]);case 3:return Y.sent(),[4,Promise.all(D.map(function(ne,ge){return Xe(q,0,void 0,function(){var ve;return at(this,function(we){switch(we.label){case 0:if(ee[ge].done)return[2,ee[ge].value];we.label=1;case 1:return lt?[3,4]:(Promise.resolve(ne.next()).then(function(be){return Ve[ge](be)},function(be){return Ee(be)}),[4,new Promise(function(be){return Ve[ge]=be})]);case 2:return(ve=we.sent())===void 0?[2,ee[ge].value]:ve.done?[2,ve.value]:(B[ge]=ve.value,[4,ae(B.slice())]);case 3:return we.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,Y.sent()];case 5:return Ee(),[4,Promise.all(D.map(function(ne){return ne.return&&ne.return()}))];case 6:return Y.sent(),[7];case 7:return[2]}})})})}const ai=class ai{constructor(){ur(this,"_extraRequestThreshold",262144)}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(k){if(k<0)throw Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=k}};ur(ai,"global",new ai);let Bt=ai;function Dt(fe,k){k=Math.min(Math.max(+k,2),65535);let D=fe,ae=D;do ae+=D=Math.ceil(D/k);while(D!==1);return 40*ae}async function*Yt(fe,k,D,ae){class Ee{constructor(ge,ve){ur(this,"_level");ur(this,"nodes");this._level=ve,this.nodes=ge}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(ge){this.nodes[1]=ge}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}let{minX:Re,minY:Ve,maxX:lt,maxY:ee}=D,B=function(ne,ge){if(ge<2)throw Error("Node size must be at least 2");if(ne===0)throw Error("Number of items must be greater than 0");let ve=ne,we=ve,be=[ve];do we+=ve=Math.ceil(ve/ge),be.push(ve);while(ve!==1);let He=[];for(let je of(ve=we,be))He.push(ve-je),ve-=je;let st=[];for(let je=0;je<be.length;je++)st.push([He[je],He[je]+be[je]]);return st}(fe,k),q=B[0][0],Y=[new Ee([0,1],B.length-1)];for(;Y.length!=0;){let ne=Y.shift(),ge=ne.startNodeIdx(),ve=ge>=q,we=(()=>{let[,st]=B[ne.level()],je=Math.min(ne.endNodeIdx()+k,st);return ve&&je<st?je+1:je})(),be=we-ge,He=new DataView(await ae(40*ge,40*be));for(let st=ge;st<we;st++){let je=st-ge,xt=40*je;if(lt<He.getFloat64(xt+0,!0)||ee<He.getFloat64(xt+8,!0)||Re>He.getFloat64(xt+16,!0)||Ve>He.getFloat64(xt+24,!0))continue;let Ot=He.getBigUint64(xt+32,!0);if(ve){let wi=(()=>{if(!(st<fe-1))return null;{let Xi=40*(je+1);return He.getBigUint64(Xi+32,!0)-Ot}})(),yi=st-q;yield[Number(Ot),yi,Number(wi)];continue}let Xt=Bt.global.extraRequestThreshold()/40,bi=Y[Y.length-1];if(bi!==void 0&&bi.level()==ne.level()-1&&Ot<bi.endNodeIdx()+Xt){bi.extendEndNodeIdx(Number(Ot));continue}let ri=(()=>{let wi=ne.level()-1;return new Ee([Number(Ot),Number(Ot)+1],wi)})();bi!==void 0&&(bi.level(),ri.level()),Y.push(ri)}}}const ii=new Uint8Array([102,103,98,3,102,103,98,0]);class ui{constructor(k,D,ae,Ee,Re){ur(this,"headerClient");ur(this,"header");ur(this,"headerLength");ur(this,"indexLength");ur(this,"nocache");this.headerClient=k,this.header=D,this.headerLength=ae,this.indexLength=Ee,this.nocache=Re}static async open(k,D){let ae,Ee=new Pi(k,D),Re=2024+(()=>{let B,q=0;for(B=0;B<3;B++)q+=16**B*40;return q})();if(!new Uint8Array(await Ee.getRange(0,8,Re,"header")).subarray(0,3).every((B,q)=>ii[q]===B))throw Error("Not a FlatGeobuf file");if((ae=new DataView(await Ee.getRange(8,4,Re,"header")).getUint32(0,!0))>10485760||ae<8)throw Error("Invalid header size");let Ve=await Ee.getRange(12,ae,Re,"header"),lt=it(new F(new Uint8Array(Ve))),ee=Dt(lt.featuresCount,lt.indexNodeSize);return new ui(Ee,lt,ae,ee,D)}async*selectBbox(k){let D=this.lengthBeforeTree(),ae=this.headerClient,Ee=async function(ee,B){return ae.getRange(D+ee,B,0,"index")},Re=[],Ve=[];for await(let ee of Yt(this.header.featuresCount,this.header.indexNodeSize,k,Ee)){let[B,q]=ee,[,,Y]=ee;if(Y||(Y=4),Ve.length==0){Ve.push([B,Y,q]);continue}let ne=Ve[Ve.length-1];B-(ne[0]+ne[1])>Bt.global.extraRequestThreshold()&&(Re.push(Ve),Ve=[]),Ve.push([B,Y,q])}this.headerClient.logUsage("header+index"),Ve.length>0&&Re.push(Ve);let lt=Re.flatMap(ee=>this.readFeatureBatch(ee,this.nocache));yield*ht.merge(lt)}lengthBeforeTree(){return ii.length+4+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(k){return new Pi(this.headerClient.httpClient,k)}async*readFeatureBatch(k,D){let[ae]=k[0],[Ee,Re]=k[k.length-1],Ve=this.buildFeatureClient(D),lt=Ee+Re-ae;for(let[ee,,B]of k){let q=await this.readFeature(Ve,ee,lt);yield{id:B,feature:q},lt=0}Ve.logUsage("feature")}async readFeature(k,D,ae){let Ee,Re=D+this.lengthBeforeFeatures();Ee=new DataView(await k.getRange(Re,4,ae,"feature length")).getUint32(0,!0);let Ve=new Uint8Array(await k.getRange(Re+4,Ee,ae,"feature data")),lt=new Uint8Array(Ee+4);lt.set(Ve,4);let ee=new F(lt);return ee.setPosition(4),Je.getRootAsFeature(ee)}}class Pi{constructor(k,D){ur(this,"httpClient");ur(this,"bytesEverUsed",0);ur(this,"bytesEverFetched",0);ur(this,"buffer",new ArrayBuffer(0));ur(this,"head",0);if(typeof k=="string")this.httpClient=new Ni(k,D);else{if(!(k instanceof Ni))throw Error("Unknown source ");this.httpClient=k}}async getRange(k,D,ae,Ee){this.bytesEverUsed+=D;let Re=k-this.head,Ve=Re+D;if(Re>=0&&Ve<=this.buffer.byteLength)return this.buffer.slice(Re,Ve);let lt=Math.max(D,ae);return this.bytesEverFetched+=lt,this.buffer=await this.httpClient.getRange(k,lt,Ee),this.head=k,this.buffer.slice(0,D)}logUsage(k){k.split(" ")[0],(100*this.bytesEverUsed/this.bytesEverFetched).toFixed(2)}}class Ni{constructor(k,D){ur(this,"url");ur(this,"nocache");ur(this,"requestsEverMade",0);ur(this,"bytesEverRequested",0);this.url=k,this.nocache=D}async getRange(k,D,ae){this.requestsEverMade+=1,this.bytesEverRequested+=D;let Ee={Range:`bytes=${k}-${k+D-1}`};return this.nocache&&(Ee["Cache-Control"]="no-cache, no-store"),await(await fetch(this.url,{headers:Ee})).arrayBuffer()}}function yt(fe){let k;for(let D of fe){if(k===u.Unknown)break;let ae=D.getGeometry?de(D.getGeometry().getType()):de(D.geometry.type);k===void 0?k=ae:k!==ae&&(k=u.Unknown)}if(k===void 0)throw Error("Could not infer geometry type for collection of features.");return k}function si(fe,k,D){if(!fe.subarray(0,3).every((q,Y)=>ii[Y]===q))throw Error("Not a FlatGeobuf file");let ae=new F(fe),Ee=ae.readUint32(ii.length);ae.setPosition(ii.length+4);let Re=it(ae);D&&D(Re);let Ve=ii.length+4+Ee,{indexNodeSize:lt,featuresCount:ee}=Re;lt>0&&(Ve+=Dt(ee,lt));let B=[];for(;Ve<ae.capacity();){let q=ae.readUint32(Ve);ae.setPosition(Ve+4);let Y=Je.getRootAsFeature(ae);B.push(k(B.length,Y,Re)),Ve+=4+q}return B}async function*mi(fe,k,D){let ae,Ee=typeof(lt=fe).slice=="function"?lt:new Ne(typeof lt.read=="function"?lt:lt.getReader()),Re=async ve=>await Ee.slice(ve),Ve=new Uint8Array(await Re(8));var lt;if(!Ve.subarray(0,3).every((ve,we)=>ii[we]===ve))throw Error("Not a FlatGeobuf file");Ve=new Uint8Array(await Re(4));let ee=new F(Ve),B=ee.readUint32(0);Ve=new Uint8Array(await Re(B));let q=it(ee=new F(Ve));D&&D(q);let{indexNodeSize:Y,featuresCount:ne}=q;if(Y>0){let ve=Dt(ne,Y);await Re(ve)}let ge=0;for(;ae=await Rt(Re,q,k,ge++);)yield ae}async function Rt(fe,k,D,ae){let Ee=new Uint8Array(await fe(4,"feature length"));if(Ee.byteLength===0)return;let Re=new F(Ee),Ve=Re.readUint32(0);Ee=new Uint8Array(await fe(Ve,"feature data"));let lt=new Uint8Array(Ve+4);return lt.set(Ee,4),(Re=new F(lt)).setPosition(4),D(ae,Je.getRootAsFeature(Re),k)}function nr(fe,k=0){let D=function(ee){let B=ee.features[0].properties,q=null;return B&&(q=Object.keys(B).map(Y=>function(ne,ge){return{name:ge,type:function(ve){if(typeof ve=="boolean")return ze.Bool;if(typeof ve=="number")return ve%1==0?ze.Int:ze.Double;if(typeof ve=="string"||ve===null)return ze.String;if(ve instanceof Uint8Array)return ze.Binary;if(typeof ve=="object")return ze.Json;throw Error(`Unknown type (value '${ve}')`)}(ne[ge]),title:null,description:null,width:-1,precision:-1,scale:-1,nullable:!0,unique:!1,primary_key:!1}}(B,Y))),{geometryType:yt(ee.features),columns:q,envelope:null,featuresCount:ee.features.length,indexNodeSize:0,crs:null,title:null,description:null,metadata:null}}(fe),ae=function(ee,B=0){let q,Y=new U,ne=0;ee.columns&&(ne=et.createColumnsVector(Y,ee.columns.map(we=>function(be,He){let st=be.createString(He.name);return Ye.startColumn(be),Ye.addName(be,st),Ye.addType(be,He.type),Ye.endColumn(be)}(Y,we))));let ge=Y.createString("L1");B&&(Le.startCrs(Y),Le.addCode(Y,B),q=Le.endCrs(Y)),et.startHeader(Y),q&&et.addCrs(Y,q),et.addFeaturesCount(Y,BigInt(ee.featuresCount)),et.addGeometryType(Y,ee.geometryType),et.addIndexNodeSize(Y,0),ne&&et.addColumns(Y,ne),et.addName(Y,ge);let ve=et.endHeader(Y);return Y.finishSizePrefixed(ve),Y.asUint8Array()}(D,k),Ee=fe.features.map(ee=>De(ee.geometry.type==="GeometryCollection"?ue(ee.geometry):Pe(ee.geometry),ee.properties,D)),Re=Ee.map(ee=>ee.length).reduce((ee,B)=>ee+B),Ve=new Uint8Array(ii.length+ae.length+Re);Ve.set(ae,ii.length);let lt=ii.length+ae.length;for(let ee of Ee)Ve.set(ee,lt),lt+=ee.length;return Ve.set(ii),Ve}function _t(fe,k,D,ae=!1){return async function*(Ee,Re,Ve,lt,ee=!1){let B=await ui.open(Ee,ee);for await(let q of(lt&&lt(B.header),B.selectBbox(Re)))yield Ve(q.id,q.feature,B.header)}(fe,k,pt,D,ae)}d.deserialize=function(fe,k,D,ae=!1){return fe instanceof Uint8Array?function(Ee,Re){return{type:"FeatureCollection",features:si(Ee,pt,Re)}}(fe,D):fe instanceof ReadableStream?function(Ee,Re){return mi(Ee,pt,Re)}(fe,D):_t(fe,k,D,ae)},d.serialize=function(fe,k=0){return nr(fe,k)}});var i_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function r_(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var fg={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(d,s){(function(u,f){d.exports=f()})(i_,function(){var u={},f={};function y(g,a,C){if(f[g]=C,g==="index"){var F="var sharedModule = {}; ("+f.shared+")(sharedModule); ("+f.worker+")(sharedModule);",U={};return f.shared(U),f.index(u,U),typeof window<"u"&&u.setWorkerUrl(window.URL.createObjectURL(new Blob([F],{type:"text/javascript"}))),u}}y("shared",["exports"],function(g){function a(i,t,n,l){return new(n||(n=Promise))(function(m,v){function x(z){try{T(l.next(z))}catch(j){v(j)}}function I(z){try{T(l.throw(z))}catch(j){v(j)}}function T(z){var j;z.done?m(z.value):(j=z.value,j instanceof n?j:new n(function(Z){Z(j)})).then(x,I)}T((l=l.apply(i,t||[])).next())})}function C(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var F=U;function U(i,t){this.x=i,this.y=t}U.prototype={clone:function(){return new U(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,n=i.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),n=Math.sin(i),l=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=l,this},_rotateAround:function(i,t){var n=Math.cos(i),l=Math.sin(i),m=t.y+l*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-l*(this.y-t.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},U.convert=function(i){return i instanceof U?i:Array.isArray(i)?new U(i[0],i[1]):i};var O=C(F),$=V;function V(i,t,n,l){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(l-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=n,this.p2y=l}V.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,l=0;l<8;l++){var m=this.sampleCurveX(n)-i;if(Math.abs(m)<t)return n;var v=this.sampleCurveDerivativeX(n);if(Math.abs(v)<1e-6)break;n-=m/v}var x=0,I=1;for(n=i,l=0;l<20&&(m=this.sampleCurveX(n),!(Math.abs(m-i)<t));l++)i>m?x=n:I=n,n=.5*(I-x)+x;return n},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var ye=C($);let de,Pe;function ue(){return de==null&&(de=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),de}function Se(){if(Pe==null&&(Pe=!1,ue())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let l=0;l<5*5;l++){const m=4*l;t.fillStyle=`rgb(${m},${m+1},${m+2})`,t.fillRect(l%5,Math.floor(l/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let l=0;l<5*5*4;l++)if(l%4!=3&&n[l]!==l){Pe=!0;break}}}return Pe||!1}function ze(i,t,n,l){const m=new ye(i,t,n,l);return v=>m.solve(v)}const Ye=ze(.25,.1,.25,1);function Je(i,t,n){return Math.min(n,Math.max(t,i))}function ct(i,t,n){const l=n-t,m=((i-t)%l+l)%l+t;return m===t?n:m}function Ge(i,...t){for(const n of t)for(const l in n)i[l]=n[l];return i}let De=1;function Qe(i,t,n){const l={};for(const m in i)l[m]=t.call(this,i[m],m,i);return l}function pt(i,t,n){const l={};for(const m in i)t.call(this,i[m],m,i)&&(l[m]=i[m]);return l}function pe(i){return Array.isArray(i)?i.map(pe):typeof i=="object"&&i?Qe(i,pe):i}const me={};function Ne(i){me[i]||(typeof console<"u"&&console.warn(i),me[i]=!0)}function Le(i,t,n){return(n.y-i.y)*(t.x-i.x)>(t.y-i.y)*(n.x-i.x)}function et(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let it=null;function nt(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Xe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function at(i,t,n,l,m){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(i,{timestamp:0});try{const x=v==null?void 0:v.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const I=x.startsWith("BGR"),T=new Uint8ClampedArray(l*m*4);if(yield v.copyTo(T,function(z,j,Z,X,J){const re=4*Math.max(-j,0),ce=(Math.max(0,Z)-Z)*X*4+re,Ae=4*X,Ce=Math.max(0,j),Ze=Math.max(0,Z);return{rect:{x:Ce,y:Ze,width:Math.min(z.width,j+X)-Ce,height:Math.min(z.height,Z+J)-Ze},layout:[{offset:ce,stride:Ae}]}}(i,t,n,l,m)),I)for(let z=0;z<T.length;z+=4){const j=T[z];T[z]=T[z+2],T[z+2]=j}return T}finally{v.close()}})}let dt,Mt;const ie="AbortError";function xe(){return new Error(ie)}const ke={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Fe(i){return ke.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const qe="global-dispatcher";class $e extends Error{constructor(t,n,l,m){super(`AJAXError: ${n} (${t}): ${l}`),this.status=t,this.statusText=n,this.url=l,this.body=m}}const Ke=()=>et(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,tt=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const l=Fe(i.url);if(l)return l(i,t);if(et(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:qe},t)}if(!(/^file:/.test(n=i.url)||/^file:/.test(Ke())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(l,m){return a(this,void 0,void 0,function*(){const v=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:Ke(),signal:m.signal});l.type!=="json"||v.headers.has("Accept")||v.headers.set("Accept","application/json");const x=yield fetch(v);if(!x.ok){const z=yield x.blob();throw new $e(x.status,x.statusText,l.url,z)}let I;I=l.type==="arrayBuffer"||l.type==="image"?x.arrayBuffer():l.type==="json"?x.json():x.text();const T=yield I;if(m.signal.aborted)throw xe();return{data:T,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(i,t);if(et(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:qe},t)}var n;return function(l,m){return new Promise((v,x)=>{var I;const T=new XMLHttpRequest;T.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(T.responseType="arraybuffer");for(const z in l.headers)T.setRequestHeader(z,l.headers[z]);l.type==="json"&&(T.responseType="text",!((I=l.headers)===null||I===void 0)&&I.Accept||T.setRequestHeader("Accept","application/json")),T.withCredentials=l.credentials==="include",T.onerror=()=>{x(new Error(T.statusText))},T.onload=()=>{if(!m.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let z=T.response;if(l.type==="json")try{z=JSON.parse(T.response)}catch(j){return void x(j)}v({data:z,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const z=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});x(new $e(T.status,T.statusText,l.url,z))}},m.signal.addEventListener("abort",()=>{T.abort(),x(xe())}),T.send(l.body)})}(i,t)};function Tt(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function kt(i,t,n){n[i]&&n[i].indexOf(t)!==-1||(n[i]=n[i]||[],n[i].push(t))}function Nt(i,t,n){if(n&&n[i]){const l=n[i].indexOf(t);l!==-1&&n[i].splice(l,1)}}class zt{constructor(t,n={}){Ge(this,n),this.type=t}}class ti extends zt{constructor(t,n={}){super("error",Ge({error:t},n))}}class ht{on(t,n){return this._listeners=this._listeners||{},kt(t,n,this._listeners),this}off(t,n){return Nt(t,n,this._listeners),Nt(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},kt(t,n,this._oneTimeListeners),this):new Promise(l=>this.once(t,l))}fire(t,n){typeof t=="string"&&(t=new zt(t,n||{}));const l=t.type;if(this.listens(l)){t.target=this;const m=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const I of m)I.call(this,t);const v=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const I of v)Nt(l,I,this._oneTimeListeners),I.call(this,t);const x=this._eventedParent;x&&(Ge(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(t))}else t instanceof ti&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const gi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ht(i,t){const n={};for(const l in i)l!=="ref"&&(n[l]=i[l]);return gi.forEach(l=>{l in t&&(n[l]=t[l])}),n}function ft(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let n=0;n<i.length;n++)if(!ft(i[n],t[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const n in i)if(!ft(i[n],t[n]))return!1;return!0}return i===t}function Pt(i,t){i.push(t)}function Bt(i,t,n){Pt(n,{command:"addSource",args:[i,t[i]]})}function Dt(i,t,n){Pt(t,{command:"removeSource",args:[i]}),n[i]=!0}function Yt(i,t,n,l){Dt(i,n,l),Bt(i,t,n)}function ii(i,t,n){let l;for(l in i[n])if(Object.prototype.hasOwnProperty.call(i[n],l)&&l!=="data"&&!ft(i[n][l],t[n][l]))return!1;for(l in t[n])if(Object.prototype.hasOwnProperty.call(t[n],l)&&l!=="data"&&!ft(i[n][l],t[n][l]))return!1;return!0}function ui(i,t,n,l,m,v){i=i||{},t=t||{};for(const x in i)Object.prototype.hasOwnProperty.call(i,x)&&(ft(i[x],t[x])||n.push({command:v,args:[l,x,t[x],m]}));for(const x in t)Object.prototype.hasOwnProperty.call(t,x)&&!Object.prototype.hasOwnProperty.call(i,x)&&(ft(i[x],t[x])||n.push({command:v,args:[l,x,t[x],m]}))}function Pi(i){return i.id}function Ni(i,t){return i[t.id]=t,i}class yt{constructor(t,n,l,m){this.message=(t?`${t}: `:"")+l,m&&(this.identifier=m),n!=null&&n.__line__&&(this.line=n.__line__)}}function si(i,...t){for(const n of t)for(const l in n)i[l]=n[l];return i}class mi extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class Rt{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[l,m]of n)this.bindings[l]=m}concat(t){return new Rt(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const nr={kind:"null"},_t={kind:"number"},ai={kind:"string"},fe={kind:"boolean"},k={kind:"color"},D={kind:"object"},ae={kind:"value"},Ee={kind:"collator"},Re={kind:"formatted"},Ve={kind:"padding"},lt={kind:"resolvedImage"},ee={kind:"variableAnchorOffsetCollection"};function B(i,t){return{kind:"array",itemType:i,N:t}}function q(i){if(i.kind==="array"){const t=q(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const Y=[nr,_t,ai,fe,k,Re,D,B(ae),Ve,lt,ee];function ne(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ne(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const n of Y)if(!ne(n,t))return null}}return`Expected ${q(i)} but found ${q(t)} instead.`}function ge(i,t){return t.some(n=>n.kind===i.kind)}function ve(i,t){return t.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}function we(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const be=.96422,He=.82521,st=4/29,je=6/29,xt=3*je*je,Ot=je*je*je,Xt=Math.PI/180,bi=180/Math.PI;function ri(i){return(i%=360)<0&&(i+=360),i}function wi([i,t,n,l]){let m,v;const x=Xi((.2225045*(i=yi(i))+.7168786*(t=yi(t))+.0606169*(n=yi(n)))/1);i===t&&t===n?m=v=x:(m=Xi((.4360747*i+.3850649*t+.1430804*n)/be),v=Xi((.0139322*i+.0971045*t+.7141733*n)/He));const I=116*x-16;return[I<0?0:I,500*(m-x),200*(x-v),l]}function yi(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Xi(i){return i>Ot?Math.pow(i,1/3):i/xt+st}function Ui([i,t,n,l]){let m=(i+16)/116,v=isNaN(t)?m:m+t/500,x=isNaN(n)?m:m-n/200;return m=1*qi(m),v=be*qi(v),x=He*qi(x),[_i(3.1338561*v-1.6168667*m-.4906146*x),_i(-.9787684*v+1.9161415*m+.033454*x),_i(.0719453*v-.2289914*m+1.4052427*x),l]}function _i(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function qi(i){return i>je?i*i*i:xt*(i-st)}function Ki(i){return parseInt(i.padEnd(2,i),16)/255}function vr(i,t){return wr(t?i/100:i,0,1)}function wr(i,t,n){return Math.min(Math.max(t,i),n)}function zr(i){return!i.some(Number.isNaN)}const Xs={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class $i{constructor(t,n,l,m=1,v=!0){this.r=t,this.g=n,this.b=l,this.a=m,v||(this.r*=m,this.g*=m,this.b*=m,m||this.overwriteGetter("rgb",[t,n,l,m]))}static parse(t){if(t instanceof $i)return t;if(typeof t!="string")return;const n=function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const m=Xs[l];if(m){const[x,I,T]=m;return[x/255,I/255,T/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const x=l.length<6?1:2;let I=1;return[Ki(l.slice(I,I+=x)),Ki(l.slice(I,I+=x)),Ki(l.slice(I,I+=x)),Ki(l.slice(I,I+x)||"ff")]}if(l.startsWith("rgb")){const x=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[I,T,z,j,Z,X,J,re,ce,Ae,Ce,Ze]=x,Oe=[j||" ",J||" ",Ae].join("");if(Oe==="  "||Oe==="  /"||Oe===",,"||Oe===",,,"){const Ue=[z,X,ce].join(""),ot=Ue==="%%%"?100:Ue===""?255:0;if(ot){const It=[wr(+T/ot,0,1),wr(+Z/ot,0,1),wr(+re/ot,0,1),Ce?vr(+Ce,Ze):1];if(zr(It))return It}}return}}const v=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[x,I,T,z,j,Z,X,J,re]=v,ce=[T||" ",j||" ",X].join("");if(ce==="  "||ce==="  /"||ce===",,"||ce===",,,"){const Ae=[+I,wr(+z,0,100),wr(+Z,0,100),J?vr(+J,re):1];if(zr(Ae))return function([Ce,Ze,Oe,Ue]){function ot(It){const qt=(It+Ce/30)%12,pi=Ze*Math.min(Oe,1-Oe);return Oe-pi*Math.max(-1,Math.min(qt-3,9-qt,1))}return Ce=ri(Ce),Ze/=100,Oe/=100,[ot(0),ot(8),ot(4),Ue]}(Ae)}}}(t);return n?new $i(...n,!1):void 0}get rgb(){const{r:t,g:n,b:l,a:m}=this,v=m||1/0;return this.overwriteGetter("rgb",[t/v,n/v,l/v,m])}get hcl(){return this.overwriteGetter("hcl",function(t){const[n,l,m,v]=wi(t),x=Math.sqrt(l*l+m*m);return[Math.round(1e4*x)?ri(Math.atan2(m,l)*bi):NaN,x,n,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",wi(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,l,m]=this.rgb;return`rgba(${[t,n,l].map(v=>Math.round(255*v)).join(",")},${m})`}}$i.black=new $i(0,0,0,1),$i.white=new $i(1,1,1,1),$i.transparent=new $i(0,0,0,0),$i.red=new $i(1,0,0,1);class rl{constructor(t,n,l){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ya{constructor(t,n,l,m,v){this.text=t,this.image=n,this.scale=l,this.fontStack=m,this.textColor=v}}class tn{constructor(t){this.sections=t}static fromString(t){return new tn([new ya(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof tn?t:tn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class fn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof fn)return t;if(typeof t=="number")return new fn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new fn(t)}}toString(){return JSON.stringify(this.values)}}const nl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class xn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof xn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const l=t[n],m=t[n+1];if(typeof l!="string"||!nl.has(l)||!Array.isArray(m)||m.length!==2||typeof m[0]!="number"||typeof m[1]!="number")return}return new xn(t)}}toString(){return JSON.stringify(this.values)}}class rn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new rn({name:t,available:!1}):null}}function _a(i,t,n,l){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[i,t,n,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[i,t,n,l]:[i,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function $n(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof $i||i instanceof rl||i instanceof tn||i instanceof fn||i instanceof xn||i instanceof rn)return!0;if(Array.isArray(i)){for(const t of i)if(!$n(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!$n(i[t]))return!1;return!0}return!1}function Sr(i){if(i===null)return nr;if(typeof i=="string")return ai;if(typeof i=="boolean")return fe;if(typeof i=="number")return _t;if(i instanceof $i)return k;if(i instanceof rl)return Ee;if(i instanceof tn)return Re;if(i instanceof fn)return Ve;if(i instanceof xn)return ee;if(i instanceof rn)return lt;if(Array.isArray(i)){const t=i.length;let n;for(const l of i){const m=Sr(l);if(n){if(n===m)continue;n=ae;break}n=m}return B(n||ae,t)}return D}function sr(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof $i||i instanceof tn||i instanceof fn||i instanceof xn||i instanceof rn?i.toString():JSON.stringify(i)}class wn{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!$n(t[1]))return n.error("invalid value");const l=t[1];let m=Sr(l);const v=n.expectedType;return m.kind!=="array"||m.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(m=v),new wn(m,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class pr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const ja={string:ai,number:_t,boolean:fe,object:D};class mn{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let l,m=1;const v=t[0];if(v==="array"){let I,T;if(t.length>2){const z=t[1];if(typeof z!="string"||!(z in ja)||z==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);I=ja[z],m++}else I=ae;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);T=t[2],m++}l=B(I,T)}else{if(!ja[v])throw new Error(`Types doesn't contain name = ${v}`);l=ja[v]}const x=[];for(;m<t.length;m++){const I=n.parse(t[m],m,ae);if(!I)return null;x.push(I)}return new mn(l,x)}evaluate(t){for(let n=0;n<this.args.length;n++){const l=this.args[n].evaluate(t);if(!ne(this.type,Sr(l)))return l;if(n===this.args.length-1)throw new pr(`Expected value to be of type ${q(this.type)}, but found ${q(Sr(l))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const sl={"to-boolean":fe,"to-color":k,"to-number":_t,"to-string":ai};class Lr{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const l=t[0];if(!sl[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&t.length!==2)return n.error("Expected one argument.");const m=sl[l],v=[];for(let x=1;x<t.length;x++){const I=n.parse(t[x],x,ae);if(!I)return null;v.push(I)}return new Lr(m,v)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,l;for(const m of this.args){if(n=m.evaluate(t),l=null,n instanceof $i)return n;if(typeof n=="string"){const v=t.parseColor(n);if(v)return v}else if(Array.isArray(n)&&(l=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:_a(n[0],n[1],n[2],n[3]),!l))return new $i(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new pr(l||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const l of this.args){n=l.evaluate(t);const m=fn.parse(n);if(m)return m}throw new pr(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const l of this.args){n=l.evaluate(t);const m=xn.parse(n);if(m)return m}throw new pr(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const l of this.args){if(n=l.evaluate(t),n===null)return 0;const m=Number(n);if(!isNaN(m))return m}throw new pr(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return tn.fromString(sr(this.args[0].evaluate(t)));case"resolvedImage":return rn.fromString(sr(this.args[0].evaluate(t)));default:return sr(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const fo=["Unknown","Point","LineString","Polygon"];class Zr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?fo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=$i.parse(t)),n}}class cs{constructor(t,n,l=[],m,v=new Rt,x=[]){this.registry=t,this.path=l,this.key=l.map(I=>`[${I}]`).join(""),this.scope=v,this.errors=x,this.expectedType=m,this._isConstant=n}parse(t,n,l,m,v={}){return n?this.concat(n,l,m)._parse(t,v):this._parse(t,v)}_parse(t,n){function l(m,v,x){return x==="assert"?new mn(v,[m]):x==="coerce"?new Lr(v,[m]):m}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=t[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[m];if(v){let x=v.parse(t,this);if(!x)return null;if(this.expectedType){const I=this.expectedType,T=x.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||T.kind!=="value")if(I.kind!=="color"&&I.kind!=="formatted"&&I.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string")if(I.kind!=="padding"||T.kind!=="value"&&T.kind!=="number"&&T.kind!=="array")if(I.kind!=="variableAnchorOffsetCollection"||T.kind!=="value"&&T.kind!=="array"){if(this.checkSubtype(I,T))return null}else x=l(x,I,n.typeAnnotation||"coerce");else x=l(x,I,n.typeAnnotation||"coerce");else x=l(x,I,n.typeAnnotation||"coerce");else x=l(x,I,n.typeAnnotation||"assert")}if(!(x instanceof wn)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const I=new Zr;try{x=new wn(x.type,x.evaluate(I))}catch(T){return this.error(T.message),null}}return x}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,l){const m=typeof t=="number"?this.path.concat(t):this.path,v=l?this.scope.concat(l):this.scope;return new cs(this.registry,this._isConstant,m,n||null,v,this.errors)}error(t,...n){const l=`${this.key}${n.map(m=>`[${m}]`).join("")}`;this.errors.push(new mi(l,t))}checkSubtype(t,n){const l=ne(t,n);return l&&this.error(l),l}}class hs{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const l=[];for(let v=1;v<t.length-1;v+=2){const x=t[v];if(typeof x!="string")return n.error(`Expected string, but found ${typeof x} instead.`,v);if(/[^a-zA-Z0-9_]/.test(x))return n.error("Variable names must contain only alphanumeric characters or '_'.",v);const I=n.parse(t[v+1],v+1);if(!I)return null;l.push([x,I])}const m=n.parse(t[t.length-1],t.length-1,n.expectedType,l);return m?new hs(l,m):null}outputDefined(){return this.result.outputDefined()}}class Vi{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const l=t[1];return n.scope.has(l)?new Vi(l,n.scope.get(l)):n.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class mo{constructor(t,n,l){this.type=t,this.index=n,this.input=l}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=n.parse(t[1],1,_t),m=n.parse(t[2],2,B(n.expectedType||ae));return l&&m?new mo(m.type.itemType,l,m):null}evaluate(t){const n=this.index.evaluate(t),l=this.input.evaluate(t);if(n<0)throw new pr(`Array index out of bounds: ${n} < 0.`);if(n>=l.length)throw new pr(`Array index out of bounds: ${n} > ${l.length-1}.`);if(n!==Math.floor(n))throw new pr(`Array index must be an integer, but found ${n} instead.`);return l[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class al{constructor(t,n){this.type=fe,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=n.parse(t[1],1,ae),m=n.parse(t[2],2,ae);return l&&m?ge(l.type,[fe,ai,_t,nr,ae])?new al(l,m):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${q(l.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!l)return!1;if(!ve(n,["boolean","string","number","null"]))throw new pr(`Expected first argument to be of type boolean, string, number or null, but found ${q(Sr(n))} instead.`);if(!ve(l,["string","array"]))throw new pr(`Expected second argument to be of type array or string, but found ${q(Sr(l))} instead.`);return l.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Ks{constructor(t,n,l){this.type=_t,this.needle=t,this.haystack=n,this.fromIndex=l}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=n.parse(t[1],1,ae),m=n.parse(t[2],2,ae);if(!l||!m)return null;if(!ge(l.type,[fe,ai,_t,nr,ae]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${q(l.type)} instead`);if(t.length===4){const v=n.parse(t[3],3,_t);return v?new Ks(l,m,v):null}return new Ks(l,m)}evaluate(t){const n=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!ve(n,["boolean","string","number","null"]))throw new pr(`Expected first argument to be of type boolean, string, number or null, but found ${q(Sr(n))} instead.`);let m;if(this.fromIndex&&(m=this.fromIndex.evaluate(t)),ve(l,["string"])){const v=l.indexOf(n,m);return v===-1?-1:[...l.slice(0,v)].length}if(ve(l,["array"]))return l.indexOf(n,m);throw new pr(`Expected second argument to be of type array or string, but found ${q(Sr(l))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class ol{constructor(t,n,l,m,v,x){this.inputType=t,this.type=n,this.input=l,this.cases=m,this.outputs=v,this.otherwise=x}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let l,m;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);const v={},x=[];for(let z=2;z<t.length-1;z+=2){let j=t[z];const Z=t[z+1];Array.isArray(j)||(j=[j]);const X=n.concat(z);if(j.length===0)return X.error("Expected at least one branch label.");for(const re of j){if(typeof re!="number"&&typeof re!="string")return X.error("Branch labels must be numbers or strings.");if(typeof re=="number"&&Math.abs(re)>Number.MAX_SAFE_INTEGER)return X.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof re=="number"&&Math.floor(re)!==re)return X.error("Numeric branch labels must be integer values.");if(l){if(X.checkSubtype(l,Sr(re)))return null}else l=Sr(re);if(v[String(re)]!==void 0)return X.error("Branch labels must be unique.");v[String(re)]=x.length}const J=n.parse(Z,z,m);if(!J)return null;m=m||J.type,x.push(J)}const I=n.parse(t[1],1,ae);if(!I)return null;const T=n.parse(t[t.length-1],t.length-1,m);return T?I.type.kind!=="value"&&n.concat(1).checkSubtype(l,I.type)?null:new ol(l,m,I,v,x,T):null}evaluate(t){const n=this.input.evaluate(t);return(Sr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class va{constructor(t,n,l){this.type=t,this.branches=n,this.otherwise=l}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);const m=[];for(let x=1;x<t.length-1;x+=2){const I=n.parse(t[x],x,fe);if(!I)return null;const T=n.parse(t[x+1],x+1,l);if(!T)return null;m.push([I,T]),l=l||T.type}const v=n.parse(t[t.length-1],t.length-1,l);if(!v)return null;if(!l)throw new Error("Can't infer output type");return new va(l,m,v)}evaluate(t){for(const[n,l]of this.branches)if(n.evaluate(t))return l.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,l]of this.branches)t(n),t(l);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class qa{constructor(t,n,l,m){this.type=t,this.input=n,this.beginIndex=l,this.endIndex=m}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=n.parse(t[1],1,ae),m=n.parse(t[2],2,_t);if(!l||!m)return null;if(!ge(l.type,[B(ae),ai,ae]))return n.error(`Expected first argument to be of type array or string, but found ${q(l.type)} instead`);if(t.length===4){const v=n.parse(t[3],3,_t);return v?new qa(l.type,l,m,v):null}return new qa(l.type,l,m)}evaluate(t){const n=this.input.evaluate(t),l=this.beginIndex.evaluate(t);let m;if(this.endIndex&&(m=this.endIndex.evaluate(t)),ve(n,["string"]))return[...n].slice(l,m).join("");if(ve(n,["array"]))return n.slice(l,m);throw new pr(`Expected first argument to be of type array or string, but found ${q(Sr(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function go(i,t){const n=i.length-1;let l,m,v=0,x=n,I=0;for(;v<=x;)if(I=Math.floor((v+x)/2),l=i[I],m=i[I+1],l<=t){if(I===n||t<m)return I;v=I+1}else{if(!(l>t))throw new pr("Input is not a number.");x=I-1}return 0}class ba{constructor(t,n,l){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[m,v]of l)this.labels.push(m),this.outputs.push(v)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const l=n.parse(t[1],1,_t);if(!l)return null;const m=[];let v=null;n.expectedType&&n.expectedType.kind!=="value"&&(v=n.expectedType);for(let x=1;x<t.length;x+=2){const I=x===1?-1/0:t[x],T=t[x+1],z=x,j=x+1;if(typeof I!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(m.length&&m[m.length-1][0]>=I)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const Z=n.parse(T,j,v);if(!Z)return null;v=v||Z.type,m.push([I,Z])}return new ba(v,l,m)}evaluate(t){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(t);const m=this.input.evaluate(t);if(m<=n[0])return l[0].evaluate(t);const v=n.length;return m>=n[v-1]?l[v-1].evaluate(t):l[go(n,m)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Ps(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var yo=Va;function Va(i,t,n,l){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(l-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=n,this.p2y=l}Va.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,l=0;l<8;l++){var m=this.sampleCurveX(n)-i;if(Math.abs(m)<t)return n;var v=this.sampleCurveDerivativeX(n);if(Math.abs(v)<1e-6)break;n-=m/v}var x=0,I=1;for(n=i,l=0;l<20&&(m=this.sampleCurveX(n),!(Math.abs(m-i)<t));l++)i>m?x=n:I=n,n=.5*(I-x)+x;return n},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var Dl=Ps(yo);function Ar(i,t,n){return i+n*(t-i)}function Ua(i,t,n){return i.map((l,m)=>Ar(l,t[m],n))}const Gr={number:Ar,color:function(i,t,n,l="rgb"){switch(l){case"rgb":{const[m,v,x,I]=Ua(i.rgb,t.rgb,n);return new $i(m,v,x,I,!1)}case"hcl":{const[m,v,x,I]=i.hcl,[T,z,j,Z]=t.hcl;let X,J;if(isNaN(m)||isNaN(T))isNaN(m)?isNaN(T)?X=NaN:(X=T,x!==1&&x!==0||(J=z)):(X=m,j!==1&&j!==0||(J=v));else{let Ze=T-m;T>m&&Ze>180?Ze-=360:T<m&&m-T>180&&(Ze+=360),X=m+n*Ze}const[re,ce,Ae,Ce]=function([Ze,Oe,Ue,ot]){return Ze=isNaN(Ze)?0:Ze*Xt,Ui([Ue,Math.cos(Ze)*Oe,Math.sin(Ze)*Oe,ot])}([X,J??Ar(v,z,n),Ar(x,j,n),Ar(I,Z,n)]);return new $i(re,ce,Ae,Ce,!1)}case"lab":{const[m,v,x,I]=Ui(Ua(i.lab,t.lab,n));return new $i(m,v,x,I,!1)}}},array:Ua,padding:function(i,t,n){return new fn(Ua(i.values,t.values,n))},variableAnchorOffsetCollection:function(i,t,n){const l=i.values,m=t.values;if(l.length!==m.length)throw new pr(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);const v=[];for(let x=0;x<l.length;x+=2){if(l[x]!==m[x])throw new pr(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${l[x]}, to[${x}]: ${m[x]}`);v.push(l[x]);const[I,T]=l[x+1],[z,j]=m[x+1];v.push([Ar(I,z,n),Ar(T,j,n)])}return new xn(v)}};class oi{constructor(t,n,l,m,v){this.type=t,this.operator=n,this.interpolation=l,this.input=m,this.labels=[],this.outputs=[];for(const[x,I]of v)this.labels.push(x),this.outputs.push(I)}static interpolationFactor(t,n,l,m){let v=0;if(t.name==="exponential")v=_o(n,t.base,l,m);else if(t.name==="linear")v=_o(n,1,l,m);else if(t.name==="cubic-bezier"){const x=t.controlPoints;v=new Dl(x[0],x[1],x[2],x[3]).solve(_o(n,1,l,m))}return v}static parse(t,n){let[l,m,v,...x]=t;if(!Array.isArray(m)||m.length===0)return n.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const z=m[1];if(typeof z!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:z}}else{if(m[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const z=m.slice(1);if(z.length!==4||z.some(j=>typeof j!="number"||j<0||j>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:z}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(v=n.parse(v,2,_t),!v)return null;const I=[];let T=null;l==="interpolate-hcl"||l==="interpolate-lab"?T=k:n.expectedType&&n.expectedType.kind!=="value"&&(T=n.expectedType);for(let z=0;z<x.length;z+=2){const j=x[z],Z=x[z+1],X=z+3,J=z+4;if(typeof j!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',X);if(I.length&&I[I.length-1][0]>=j)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',X);const re=n.parse(Z,J,T);if(!re)return null;T=T||re.type,I.push([j,re])}return we(T,_t)||we(T,k)||we(T,Ve)||we(T,ee)||we(T,B(_t))?new oi(T,l,m,v,I):n.error(`Type ${q(T)} is not interpolatable.`)}evaluate(t){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(t);const m=this.input.evaluate(t);if(m<=n[0])return l[0].evaluate(t);const v=n.length;if(m>=n[v-1])return l[v-1].evaluate(t);const x=go(n,m),I=oi.interpolationFactor(this.interpolation,m,n[x],n[x+1]),T=l[x].evaluate(t),z=l[x+1].evaluate(t);switch(this.operator){case"interpolate":return Gr[this.type.kind](T,z,I);case"interpolate-hcl":return Gr.color(T,z,I,"hcl");case"interpolate-lab":return Gr.color(T,z,I,"lab")}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function _o(i,t,n,l){const m=l-n,v=i-n;return m===0?0:t===1?v/m:(Math.pow(t,v)-1)/(Math.pow(t,m)-1)}class vo{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let l=null;const m=n.expectedType;m&&m.kind!=="value"&&(l=m);const v=[];for(const I of t.slice(1)){const T=n.parse(I,1+v.length,l,void 0,{typeAnnotation:"omit"});if(!T)return null;l=l||T.type,v.push(T)}if(!l)throw new Error("No output type");const x=m&&v.some(I=>ne(m,I.type));return new vo(x?ae:l,v)}evaluate(t){let n,l=null,m=0;for(const v of this.args)if(m++,l=v.evaluate(t),l&&l instanceof rn&&!l.available&&(n||(n=l.name),l=null,m===this.args.length&&(l=n)),l!==null)break;return l}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function zn(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ll(i,t,n,l){return l.compare(t,n)===0}function Ys(i,t,n){const l=i!=="=="&&i!=="!=";return class mg{constructor(v,x,I){this.type=fe,this.lhs=v,this.rhs=x,this.collator=I,this.hasUntypedArgument=v.type.kind==="value"||x.type.kind==="value"}static parse(v,x){if(v.length!==3&&v.length!==4)return x.error("Expected two or three arguments.");const I=v[0];let T=x.parse(v[1],1,ae);if(!T)return null;if(!zn(I,T.type))return x.concat(1).error(`"${I}" comparisons are not supported for type '${q(T.type)}'.`);let z=x.parse(v[2],2,ae);if(!z)return null;if(!zn(I,z.type))return x.concat(2).error(`"${I}" comparisons are not supported for type '${q(z.type)}'.`);if(T.type.kind!==z.type.kind&&T.type.kind!=="value"&&z.type.kind!=="value")return x.error(`Cannot compare types '${q(T.type)}' and '${q(z.type)}'.`);l&&(T.type.kind==="value"&&z.type.kind!=="value"?T=new mn(z.type,[T]):T.type.kind!=="value"&&z.type.kind==="value"&&(z=new mn(T.type,[z])));let j=null;if(v.length===4){if(T.type.kind!=="string"&&z.type.kind!=="string"&&T.type.kind!=="value"&&z.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(j=x.parse(v[3],3,Ee),!j)return null}return new mg(T,z,j)}evaluate(v){const x=this.lhs.evaluate(v),I=this.rhs.evaluate(v);if(l&&this.hasUntypedArgument){const T=Sr(x),z=Sr(I);if(T.kind!==z.kind||T.kind!=="string"&&T.kind!=="number")throw new pr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${T.kind}, ${z.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const T=Sr(x),z=Sr(I);if(T.kind!=="string"||z.kind!=="string")return t(v,x,I)}return this.collator?n(v,x,I,this.collator.evaluate(v)):t(v,x,I)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const bo=Ys("==",function(i,t,n){return t===n},ll),xo=Ys("!=",function(i,t,n){return t!==n},function(i,t,n,l){return!ll(0,t,n,l)}),Fl=Ys("<",function(i,t,n){return t<n},function(i,t,n,l){return l.compare(t,n)<0}),oc=Ys(">",function(i,t,n){return t>n},function(i,t,n,l){return l.compare(t,n)>0}),lc=Ys("<=",function(i,t,n){return t<=n},function(i,t,n,l){return l.compare(t,n)<=0}),wo=Ys(">=",function(i,t,n){return t>=n},function(i,t,n,l){return l.compare(t,n)>=0});class us{constructor(t,n,l){this.type=Ee,this.locale=l,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const l=t[1];if(typeof l!="object"||Array.isArray(l))return n.error("Collator options argument must be an object.");const m=n.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,fe);if(!m)return null;const v=n.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,fe);if(!v)return null;let x=null;return l.locale&&(x=n.parse(l.locale,1,ai),!x)?null:new us(m,v,x)}evaluate(t){return new rl(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Ls{constructor(t,n,l,m,v){this.type=ai,this.number=t,this.locale=n,this.currency=l,this.minFractionDigits=m,this.maxFractionDigits=v}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const l=n.parse(t[1],1,_t);if(!l)return null;const m=t[2];if(typeof m!="object"||Array.isArray(m))return n.error("NumberFormat options argument must be an object.");let v=null;if(m.locale&&(v=n.parse(m.locale,1,ai),!v))return null;let x=null;if(m.currency&&(x=n.parse(m.currency,1,ai),!x))return null;let I=null;if(m["min-fraction-digits"]&&(I=n.parse(m["min-fraction-digits"],1,_t),!I))return null;let T=null;return m["max-fraction-digits"]&&(T=n.parse(m["max-fraction-digits"],1,_t),!T)?null:new Ls(l,v,x,I,T)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class So{constructor(t){this.type=Re,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const l=t[1];if(!Array.isArray(l)&&typeof l=="object")return n.error("First argument must be an image or text section.");const m=[];let v=!1;for(let x=1;x<=t.length-1;++x){const I=t[x];if(v&&typeof I=="object"&&!Array.isArray(I)){v=!1;let T=null;if(I["font-scale"]&&(T=n.parse(I["font-scale"],1,_t),!T))return null;let z=null;if(I["text-font"]&&(z=n.parse(I["text-font"],1,B(ai)),!z))return null;let j=null;if(I["text-color"]&&(j=n.parse(I["text-color"],1,k),!j))return null;const Z=m[m.length-1];Z.scale=T,Z.font=z,Z.textColor=j}else{const T=n.parse(t[x],1,ae);if(!T)return null;const z=T.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,m.push({content:T,scale:null,font:null,textColor:null})}}return new So(m)}evaluate(t){return new tn(this.sections.map(n=>{const l=n.content.evaluate(t);return Sr(l)===lt?new ya("",l,null,null,null):new ya(sr(l),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}}class Js{constructor(t){this.type=lt,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const l=n.parse(t[1],1,ai);return l?new Js(l):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),l=rn.fromString(n);return l&&t.availableImages&&(l.available=t.availableImages.indexOf(n)>-1),l}eachChild(t){t(this.input)}outputDefined(){return!1}}class $a{constructor(t){this.type=_t,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=n.parse(t[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${q(l.type)} instead.`):new $a(l):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new pr(`Expected value to be of type string or array, but found ${q(Sr(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const gn=8192;function Rl(i,t){const n=(180+i[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,m=Math.pow(2,t.z);return[Math.round(n*m*gn),Math.round(l*m*gn)]}function Ao(i,t){const n=Math.pow(2,t.z);return[(m=(i[0]/gn+t.x)/n,360*m-180),(l=(i[1]/gn+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,m}function ks(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function ds(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function Ci(i,t,n){const l=i[0]-t[0],m=i[1]-t[1],v=i[0]-n[0],x=i[1]-n[1];return l*x-v*m==0&&l*v<=0&&m*x<=0}function Zn(i,t,n,l){return(m=[l[0]-n[0],l[1]-n[1]])[0]*(v=[t[0]-i[0],t[1]-i[1]])[1]-m[1]*v[0]!=0&&!(!Ol(i,t,n,l)||!Ol(n,l,i,t));var m,v}function cc(i,t,n){for(const l of n)for(let m=0;m<l.length-1;++m)if(Zn(i,t,l[m],l[m+1]))return!0;return!1}function Nn(i,t,n=!1){let l=!1;for(const I of t)for(let T=0;T<I.length-1;T++){if(Ci(i,I[T],I[T+1]))return n;(v=I[T])[1]>(m=i)[1]!=(x=I[T+1])[1]>m[1]&&m[0]<(x[0]-v[0])*(m[1]-v[1])/(x[1]-v[1])+v[0]&&(l=!l)}var m,v,x;return l}function ps(i,t){for(const n of t)if(Nn(i,n))return!0;return!1}function Io(i,t){for(const n of i)if(!Nn(n,t))return!1;for(let n=0;n<i.length-1;++n)if(cc(i[n],i[n+1],t))return!1;return!0}function Za(i,t){for(const n of t)if(Io(i,n))return!0;return!1}function Ol(i,t,n,l){const m=l[0]-n[0],v=l[1]-n[1],x=(i[0]-n[0])*v-m*(i[1]-n[1]),I=(t[0]-n[0])*v-m*(t[1]-n[1]);return x>0&&I<0||x<0&&I>0}function xa(i,t,n){const l=[];for(let m=0;m<i.length;m++){const v=[];for(let x=0;x<i[m].length;x++){const I=Rl(i[m][x],n);ks(t,I),v.push(I)}l.push(v)}return l}function Bl(i,t,n){const l=[];for(let m=0;m<i.length;m++){const v=xa(i[m],t,n);l.push(v)}return l}function Po(i,t,n,l){if(i[0]<n[0]||i[0]>n[2]){const m=.5*l;let v=i[0]-n[0]>m?-l:n[0]-i[0]>m?l:0;v===0&&(v=i[0]-n[2]>m?-l:n[2]-i[0]>m?l:0),i[0]+=v}ks(t,i)}function Lo(i,t,n,l){const m=Math.pow(2,l.z)*gn,v=[l.x*gn,l.y*gn],x=[];for(const I of i)for(const T of I){const z=[T.x+v[0],T.y+v[1]];Po(z,t,n,m),x.push(z)}return x}function cl(i,t,n,l){const m=Math.pow(2,l.z)*gn,v=[l.x*gn,l.y*gn],x=[];for(const T of i){const z=[];for(const j of T){const Z=[j.x+v[0],j.y+v[1]];ks(t,Z),z.push(Z)}x.push(z)}if(t[2]-t[0]<=m/2){(I=t)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(const T of x)for(const z of T)Po(z,t,n,m)}var I;return x}class Gn{constructor(t,n){this.type=fe,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if($n(t[1])){const l=t[1];if(l.type==="FeatureCollection"){const m=[];for(const v of l.features){const{type:x,coordinates:I}=v.geometry;x==="Polygon"&&m.push(I),x==="MultiPolygon"&&m.push(...I)}if(m.length)return new Gn(l,{type:"MultiPolygon",coordinates:m})}else if(l.type==="Feature"){const m=l.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Gn(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Gn(l,l)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,l){const m=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=n.canonicalID();if(l.type==="Polygon"){const I=xa(l.coordinates,v,x),T=Lo(n.geometry(),m,v,x);if(!ds(m,v))return!1;for(const z of T)if(!Nn(z,I))return!1}if(l.type==="MultiPolygon"){const I=Bl(l.coordinates,v,x),T=Lo(n.geometry(),m,v,x);if(!ds(m,v))return!1;for(const z of T)if(!ps(z,I))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,l){const m=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=n.canonicalID();if(l.type==="Polygon"){const I=xa(l.coordinates,v,x),T=cl(n.geometry(),m,v,x);if(!ds(m,v))return!1;for(const z of T)if(!Io(z,I))return!1}if(l.type==="MultiPolygon"){const I=Bl(l.coordinates,v,x),T=cl(n.geometry(),m,v,x);if(!ds(m,v))return!1;for(const z of T)if(!Za(z,I))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ko=class{constructor(i=[],t=(n,l)=>n<l?-1:n>l?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:n}=this,l=t[i];for(;i>0;){const m=i-1>>1,v=t[m];if(n(l,v)>=0)break;t[i]=v,i=m}t[i]=l}_down(i){const{data:t,compare:n}=this,l=this.length>>1,m=t[i];for(;i<l;){let v=1+(i<<1);const x=v+1;if(x<this.length&&n(t[x],t[v])<0&&(v=x),n(t[v],m)>=0)break;t[i]=t[v],i=v}t[i]=m}};function hl(i,t,n,l,m){ul(i,t,n,l||i.length-1,m||To)}function ul(i,t,n,l,m){for(;l>n;){if(l-n>600){var v=l-n+1,x=t-n+1,I=Math.log(v),T=.5*Math.exp(2*I/3),z=.5*Math.sqrt(I*T*(v-T)/v)*(x-v/2<0?-1:1);ul(i,t,Math.max(n,Math.floor(t-x*T/v+z)),Math.min(l,Math.floor(t+(v-x)*T/v+z)),m)}var j=i[t],Z=n,X=l;for(Ga(i,n,t),m(i[l],j)>0&&Ga(i,n,l);Z<X;){for(Ga(i,Z,X),Z++,X--;m(i[Z],j)<0;)Z++;for(;m(i[X],j)>0;)X--}m(i[n],j)===0?Ga(i,n,X):Ga(i,++X,l),X<=t&&(n=X+1),t<=X&&(l=X-1)}}function Ga(i,t,n){var l=i[t];i[t]=i[n],i[n]=l}function To(i,t){return i<t?-1:i>t?1:0}function Ts(i,t){if(i.length<=1)return[i];const n=[];let l,m;for(const v of i){const x=wa(v);x!==0&&(v.area=Math.abs(x),m===void 0&&(m=x<0),m===x<0?(l&&n.push(l),l=[v]):l.push(v))}if(l&&n.push(l),t>1)for(let v=0;v<n.length;v++)n[v].length<=t||(hl(n[v],t,1,n[v].length-1,dl),n[v]=n[v].slice(0,t));return n}function dl(i,t){return t.area-i.area}function wa(i){let t=0;for(let n,l,m=0,v=i.length,x=v-1;m<v;x=m++)n=i[m],l=i[x],t+=(l.x-n.x)*(n.y+l.y);return t}const Co=1/298.257223563,E=Co*(2-Co),Q=Math.PI/180;class Ie{constructor(t){const n=6378.137*Q*1e3,l=Math.cos(t*Q),m=1/(1-E*(1-l*l)),v=Math.sqrt(m);this.kx=n*v*l,this.ky=n*v*m*(1-E)}distance(t,n){const l=this.wrap(t[0]-n[0])*this.kx,m=(t[1]-n[1])*this.ky;return Math.sqrt(l*l+m*m)}pointOnLine(t,n){let l,m,v,x,I=1/0;for(let T=0;T<t.length-1;T++){let z=t[T][0],j=t[T][1],Z=this.wrap(t[T+1][0]-z)*this.kx,X=(t[T+1][1]-j)*this.ky,J=0;Z===0&&X===0||(J=(this.wrap(n[0]-z)*this.kx*Z+(n[1]-j)*this.ky*X)/(Z*Z+X*X),J>1?(z=t[T+1][0],j=t[T+1][1]):J>0&&(z+=Z/this.kx*J,j+=X/this.ky*J)),Z=this.wrap(n[0]-z)*this.kx,X=(n[1]-j)*this.ky;const re=Z*Z+X*X;re<I&&(I=re,l=z,m=j,v=T,x=J)}return{point:[l,m],index:v,t:Math.max(0,Math.min(1,x))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Be(i,t){return t[0]-i[0]}function We(i){return i[1]-i[0]+1}function ut(i,t){return i[1]>=i[0]&&i[1]<t}function Lt(i,t){if(i[0]>i[1])return[null,null];const n=We(i);if(t){if(n===2)return[i,null];const m=Math.floor(n/2);return[[i[0],i[0]+m],[i[0]+m,i[1]]]}if(n===1)return[i,null];const l=Math.floor(n/2)-1;return[[i[0],i[0]+l],[i[0]+l+1,i[1]]]}function $t(i,t){if(!ut(t,i.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let l=t[0];l<=t[1];++l)ks(n,i[l]);return n}function ci(i){const t=[1/0,1/0,-1/0,-1/0];for(const n of i)for(const l of n)ks(t,l);return t}function Ai(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Ii(i,t,n){if(!Ai(i)||!Ai(t))return NaN;let l=0,m=0;return i[2]<t[0]&&(l=t[0]-i[2]),i[0]>t[2]&&(l=i[0]-t[2]),i[1]>t[3]&&(m=i[1]-t[3]),i[3]<t[1]&&(m=t[1]-i[3]),n.distance([0,0],[l,m])}function Di(i,t,n){const l=n.pointOnLine(t,i);return n.distance(i,l.point)}function ar(i,t,n,l,m){const v=Math.min(Di(i,[n,l],m),Di(t,[n,l],m)),x=Math.min(Di(n,[i,t],m),Di(l,[i,t],m));return Math.min(v,x)}function kr(i,t,n,l,m){if(!ut(t,i.length)||!ut(l,n.length))return 1/0;let v=1/0;for(let x=t[0];x<t[1];++x){const I=i[x],T=i[x+1];for(let z=l[0];z<l[1];++z){const j=n[z],Z=n[z+1];if(Zn(I,T,j,Z))return 0;v=Math.min(v,ar(I,T,j,Z,m))}}return v}function Ei(i,t,n,l,m){if(!ut(t,i.length)||!ut(l,n.length))return NaN;let v=1/0;for(let x=t[0];x<=t[1];++x)for(let I=l[0];I<=l[1];++I)if(v=Math.min(v,m.distance(i[x],n[I])),v===0)return v;return v}function nn(i,t,n){if(Nn(i,t,!0))return 0;let l=1/0;for(const m of t){const v=m[0],x=m[m.length-1];if(v!==x&&(l=Math.min(l,Di(i,[x,v],n)),l===0))return l;const I=n.pointOnLine(m,i);if(l=Math.min(l,n.distance(i,I.point)),l===0)return l}return l}function li(i,t,n,l){if(!ut(t,i.length))return NaN;for(let v=t[0];v<=t[1];++v)if(Nn(i[v],n,!0))return 0;let m=1/0;for(let v=t[0];v<t[1];++v){const x=i[v],I=i[v+1];for(const T of n)for(let z=0,j=T.length,Z=j-1;z<j;Z=z++){const X=T[Z],J=T[z];if(Zn(x,I,X,J))return 0;m=Math.min(m,ar(x,I,X,J,l))}}return m}function Sn(i,t){for(const n of i)for(const l of n)if(Nn(l,t,!0))return!0;return!1}function Oi(i,t,n,l=1/0){const m=ci(i),v=ci(t);if(l!==1/0&&Ii(m,v,n)>=l)return l;if(ds(m,v)){if(Sn(i,t))return 0}else if(Sn(t,i))return 0;let x=1/0;for(const I of i)for(let T=0,z=I.length,j=z-1;T<z;j=T++){const Z=I[j],X=I[T];for(const J of t)for(let re=0,ce=J.length,Ae=ce-1;re<ce;Ae=re++){const Ce=J[Ae],Ze=J[re];if(Zn(Z,X,Ce,Ze))return 0;x=Math.min(x,ar(Z,X,Ce,Ze,n))}}return x}function Bi(i,t,n,l,m,v){if(!v)return;const x=Ii($t(l,v),m,n);x<t&&i.push([x,v,[0,0]])}function Cs(i,t,n,l,m,v,x){if(!v||!x)return;const I=Ii($t(l,v),$t(m,x),n);I<t&&i.push([I,v,x])}function Qs(i,t,n,l,m=1/0){let v=Math.min(l.distance(i[0],n[0][0]),m);if(v===0)return v;const x=new ko([[0,[0,i.length-1],[0,0]]],Be),I=ci(n);for(;x.length>0;){const T=x.pop();if(T[0]>=v)continue;const z=T[1],j=t?50:100;if(We(z)<=j){if(!ut(z,i.length))return NaN;if(t){const Z=li(i,z,n,l);if(isNaN(Z)||Z===0)return Z;v=Math.min(v,Z)}else for(let Z=z[0];Z<=z[1];++Z){const X=nn(i[Z],n,l);if(v=Math.min(v,X),v===0)return 0}}else{const Z=Lt(z,t);Bi(x,v,l,i,I,Z[0]),Bi(x,v,l,i,I,Z[1])}}return v}function ea(i,t,n,l,m,v=1/0){let x=Math.min(v,m.distance(i[0],n[0]));if(x===0)return x;const I=new ko([[0,[0,i.length-1],[0,n.length-1]]],Be);for(;I.length>0;){const T=I.pop();if(T[0]>=x)continue;const z=T[1],j=T[2],Z=t?50:100,X=l?50:100;if(We(z)<=Z&&We(j)<=X){if(!ut(z,i.length)&&ut(j,n.length))return NaN;let J;if(t&&l)J=kr(i,z,n,j,m),x=Math.min(x,J);else if(t&&!l){const re=i.slice(z[0],z[1]+1);for(let ce=j[0];ce<=j[1];++ce)if(J=Di(n[ce],re,m),x=Math.min(x,J),x===0)return x}else if(!t&&l){const re=n.slice(j[0],j[1]+1);for(let ce=z[0];ce<=z[1];++ce)if(J=Di(i[ce],re,m),x=Math.min(x,J),x===0)return x}else J=Ei(i,z,n,j,m),x=Math.min(x,J)}else{const J=Lt(z,t),re=Lt(j,l);Cs(I,x,m,i,n,J[0],re[0]),Cs(I,x,m,i,n,J[0],re[1]),Cs(I,x,m,i,n,J[1],re[0]),Cs(I,x,m,i,n,J[1],re[1])}}return x}function Sa(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class fs{constructor(t,n){this.type=_t,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if($n(t[1])){const l=t[1];if(l.type==="FeatureCollection")return new fs(l,l.features.map(m=>Sa(m.geometry)).flat());if(l.type==="Feature")return new fs(l,Sa(l.geometry));if("type"in l&&"coordinates"in l)return new fs(l,Sa(l))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,l){const m=n.geometry(),v=m.flat().map(T=>Ao([T.x,T.y],n.canonical));if(m.length===0)return NaN;const x=new Ie(v[0][1]);let I=1/0;for(const T of l){switch(T.type){case"Point":I=Math.min(I,ea(v,!1,[T.coordinates],!1,x,I));break;case"LineString":I=Math.min(I,ea(v,!1,T.coordinates,!0,x,I));break;case"Polygon":I=Math.min(I,Qs(v,!1,T.coordinates,x,I))}if(I===0)return I}return I}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,l){const m=n.geometry(),v=m.flat().map(T=>Ao([T.x,T.y],n.canonical));if(m.length===0)return NaN;const x=new Ie(v[0][1]);let I=1/0;for(const T of l){switch(T.type){case"Point":I=Math.min(I,ea(v,!0,[T.coordinates],!1,x,I));break;case"LineString":I=Math.min(I,ea(v,!0,T.coordinates,!0,x,I));break;case"Polygon":I=Math.min(I,Qs(v,!0,T.coordinates,x,I))}if(I===0)return I}return I}(t,this.geometries);if(t.geometryType()==="Polygon")return function(n,l){const m=n.geometry();if(m.length===0||m[0].length===0)return NaN;const v=Ts(m,0).map(T=>T.map(z=>z.map(j=>Ao([j.x,j.y],n.canonical)))),x=new Ie(v[0][0][0][1]);let I=1/0;for(const T of l)for(const z of v){switch(T.type){case"Point":I=Math.min(I,Qs([T.coordinates],!1,z,x,I));break;case"LineString":I=Math.min(I,Qs(T.coordinates,!0,z,x,I));break;case"Polygon":I=Math.min(I,Oi(z,T.coordinates,x,I))}if(I===0)return I}return I}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Es={"==":bo,"!=":xo,">":oc,"<":Fl,">=":wo,"<=":lc,array:mn,at:mo,boolean:mn,case:va,coalesce:vo,collator:us,format:So,image:Js,in:al,"index-of":Ks,interpolate:oi,"interpolate-hcl":oi,"interpolate-lab":oi,length:$a,let:hs,literal:wn,match:ol,number:mn,"number-format":Ls,object:mn,slice:qa,step:ba,string:mn,"to-boolean":Lr,"to-color":Lr,"to-number":Lr,"to-string":Lr,var:Vi,within:Gn,distance:fs};class Wr{constructor(t,n,l,m){this.name=t,this.type=n,this._evaluate=l,this.args=m}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const l=t[0],m=Wr.definitions[l];if(!m)return n.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(m)?m[0]:m.type,x=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,I=x.filter(([z])=>!Array.isArray(z)||z.length===t.length-1);let T=null;for(const[z,j]of I){T=new cs(n.registry,ta,n.path,null,n.scope);const Z=[];let X=!1;for(let J=1;J<t.length;J++){const re=t[J],ce=Array.isArray(z)?z[J-1]:z.type,Ae=T.parse(re,1+Z.length,ce);if(!Ae){X=!0;break}Z.push(Ae)}if(!X)if(Array.isArray(z)&&z.length!==Z.length)T.error(`Expected ${z.length} arguments, but found ${Z.length} instead.`);else{for(let J=0;J<Z.length;J++){const re=Array.isArray(z)?z[J]:z.type,ce=Z[J];T.concat(J+1).checkSubtype(re,ce.type)}if(T.errors.length===0)return new Wr(l,v,j,Z)}}if(I.length===1)n.errors.push(...T.errors);else{const z=(I.length?I:x).map(([Z])=>{return X=Z,Array.isArray(X)?`(${X.map(q).join(", ")})`:`(${q(X.type)}...)`;var X}).join(" | "),j=[];for(let Z=1;Z<t.length;Z++){const X=n.parse(t[Z],1+j.length);if(!X)return null;j.push(q(X.type))}n.error(`Expected arguments of type ${z}, but found (${j.join(", ")}) instead.`)}return null}static register(t,n){Wr.definitions=n;for(const l in n)t[l]=Wr}}function Or(i,[t,n,l,m]){t=t.evaluate(i),n=n.evaluate(i),l=l.evaluate(i);const v=m?m.evaluate(i):1,x=_a(t,n,l,v);if(x)throw new pr(x);return new $i(t/255,n/255,l/255,v,!1)}function Aa(i,t){return i in t}function Ia(i,t){const n=t[i];return n===void 0?null:n}function Wn(i){return{type:i}}function ta(i){if(i instanceof Vi)return ta(i.boundExpression);if(i instanceof Wr&&i.name==="error"||i instanceof us||i instanceof Gn||i instanceof fs)return!1;const t=i instanceof Lr||i instanceof mn;let n=!0;return i.eachChild(l=>{n=t?n&&ta(l):n&&l instanceof wn}),!!n&&jr(i)&&ia(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function jr(i){if(i instanceof Wr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Gn||i instanceof fs)return!1;let t=!0;return i.eachChild(n=>{t&&!jr(n)&&(t=!1)}),t}function Pa(i){if(i instanceof Wr&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(n=>{t&&!Pa(n)&&(t=!1)}),t}function ia(i,t){if(i instanceof Wr&&t.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(l=>{n&&!ia(l,t)&&(n=!1)}),n}function Wa(i){return{result:"success",value:i}}function Hr(i){return{result:"error",value:i}}function ms(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function pl(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Eo(i){return!!i.expression&&i.expression.interpolated}function Mi(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Ms(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function An(i){return i}function sn(i,t){const n=t.type==="color",l=i.stops&&typeof i.stops[0][0]=="object",m=l||!(l||i.property!==void 0),v=i.type||(Eo(t)?"exponential":"interval");if(n||t.type==="padding"){const j=n?$i.parse:fn.parse;(i=si({},i)).stops&&(i.stops=i.stops.map(Z=>[Z[0],j(Z[1])])),i.default=j(i.default?i.default:t.default)}if(i.colorSpace&&(x=i.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var x;let I,T,z;if(v==="exponential")I=Ha;else if(v==="interval")I=Hn;else if(v==="categorical"){I=zs,T=Object.create(null);for(const j of i.stops)T[j[0]]=j[1];z=typeof i.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);I=Ns}if(l){const j={},Z=[];for(let re=0;re<i.stops.length;re++){const ce=i.stops[re],Ae=ce[0].zoom;j[Ae]===void 0&&(j[Ae]={zoom:Ae,type:i.type,property:i.property,default:i.default,stops:[]},Z.push(Ae)),j[Ae].stops.push([ce[0].value,ce[1]])}const X=[];for(const re of Z)X.push([j[re].zoom,sn(j[re],t)]);const J={name:"linear"};return{kind:"composite",interpolationType:J,interpolationFactor:oi.interpolationFactor.bind(void 0,J),zoomStops:X.map(re=>re[0]),evaluate:({zoom:re},ce)=>Ha({stops:X,base:i.base},t,re).evaluate(re,ce)}}if(m){const j=v==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:j,interpolationFactor:oi.interpolationFactor.bind(void 0,j),zoomStops:i.stops.map(Z=>Z[0]),evaluate:({zoom:Z})=>I(i,t,Z,T,z)}}return{kind:"source",evaluate(j,Z){const X=Z&&Z.properties?Z.properties[i.property]:void 0;return X===void 0?Dn(i.default,t.default):I(i,t,X,T,z)}}}function Dn(i,t,n){return i!==void 0?i:t!==void 0?t:n!==void 0?n:void 0}function zs(i,t,n,l,m){return Dn(typeof n===m?l[n]:void 0,i.default,t.default)}function Hn(i,t,n){if(Mi(n)!=="number")return Dn(i.default,t.default);const l=i.stops.length;if(l===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[l-1][0])return i.stops[l-1][1];const m=go(i.stops.map(v=>v[0]),n);return i.stops[m][1]}function Ha(i,t,n){const l=i.base!==void 0?i.base:1;if(Mi(n)!=="number")return Dn(i.default,t.default);const m=i.stops.length;if(m===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[m-1][0])return i.stops[m-1][1];const v=go(i.stops.map(j=>j[0]),n),x=function(j,Z,X,J){const re=J-X,ce=j-X;return re===0?0:Z===1?ce/re:(Math.pow(Z,ce)-1)/(Math.pow(Z,re)-1)}(n,l,i.stops[v][0],i.stops[v+1][0]),I=i.stops[v][1],T=i.stops[v+1][1],z=Gr[t.type]||An;return typeof I.evaluate=="function"?{evaluate(...j){const Z=I.evaluate.apply(void 0,j),X=T.evaluate.apply(void 0,j);if(Z!==void 0&&X!==void 0)return z(Z,X,x,i.colorSpace)}}:z(I,T,x,i.colorSpace)}function Ns(i,t,n){switch(t.type){case"color":n=$i.parse(n);break;case"formatted":n=tn.fromString(n.toString());break;case"resolvedImage":n=rn.fromString(n.toString());break;case"padding":n=fn.parse(n);break;default:Mi(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return Dn(n,i.default,t.default)}Wr.register(Es,{error:[{kind:"error"},[ai],(i,[t])=>{throw new pr(t.evaluate(i))}],typeof:[ai,[ae],(i,[t])=>q(Sr(t.evaluate(i)))],"to-rgba":[B(_t,4),[k],(i,[t])=>{const[n,l,m,v]=t.evaluate(i).rgb;return[255*n,255*l,255*m,v]}],rgb:[k,[_t,_t,_t],Or],rgba:[k,[_t,_t,_t,_t],Or],has:{type:fe,overloads:[[[ai],(i,[t])=>Aa(t.evaluate(i),i.properties())],[[ai,D],(i,[t,n])=>Aa(t.evaluate(i),n.evaluate(i))]]},get:{type:ae,overloads:[[[ai],(i,[t])=>Ia(t.evaluate(i),i.properties())],[[ai,D],(i,[t,n])=>Ia(t.evaluate(i),n.evaluate(i))]]},"feature-state":[ae,[ai],(i,[t])=>Ia(t.evaluate(i),i.featureState||{})],properties:[D,[],i=>i.properties()],"geometry-type":[ai,[],i=>i.geometryType()],id:[ae,[],i=>i.id()],zoom:[_t,[],i=>i.globals.zoom],"heatmap-density":[_t,[],i=>i.globals.heatmapDensity||0],"line-progress":[_t,[],i=>i.globals.lineProgress||0],accumulated:[ae,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[_t,Wn(_t),(i,t)=>{let n=0;for(const l of t)n+=l.evaluate(i);return n}],"*":[_t,Wn(_t),(i,t)=>{let n=1;for(const l of t)n*=l.evaluate(i);return n}],"-":{type:_t,overloads:[[[_t,_t],(i,[t,n])=>t.evaluate(i)-n.evaluate(i)],[[_t],(i,[t])=>-t.evaluate(i)]]},"/":[_t,[_t,_t],(i,[t,n])=>t.evaluate(i)/n.evaluate(i)],"%":[_t,[_t,_t],(i,[t,n])=>t.evaluate(i)%n.evaluate(i)],ln2:[_t,[],()=>Math.LN2],pi:[_t,[],()=>Math.PI],e:[_t,[],()=>Math.E],"^":[_t,[_t,_t],(i,[t,n])=>Math.pow(t.evaluate(i),n.evaluate(i))],sqrt:[_t,[_t],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[_t,[_t],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[_t,[_t],(i,[t])=>Math.log(t.evaluate(i))],log2:[_t,[_t],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[_t,[_t],(i,[t])=>Math.sin(t.evaluate(i))],cos:[_t,[_t],(i,[t])=>Math.cos(t.evaluate(i))],tan:[_t,[_t],(i,[t])=>Math.tan(t.evaluate(i))],asin:[_t,[_t],(i,[t])=>Math.asin(t.evaluate(i))],acos:[_t,[_t],(i,[t])=>Math.acos(t.evaluate(i))],atan:[_t,[_t],(i,[t])=>Math.atan(t.evaluate(i))],min:[_t,Wn(_t),(i,t)=>Math.min(...t.map(n=>n.evaluate(i)))],max:[_t,Wn(_t),(i,t)=>Math.max(...t.map(n=>n.evaluate(i)))],abs:[_t,[_t],(i,[t])=>Math.abs(t.evaluate(i))],round:[_t,[_t],(i,[t])=>{const n=t.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[_t,[_t],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[_t,[_t],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[fe,[ai,ae],(i,[t,n])=>i.properties()[t.value]===n.value],"filter-id-==":[fe,[ae],(i,[t])=>i.id()===t.value],"filter-type-==":[fe,[ai],(i,[t])=>i.geometryType()===t.value],"filter-<":[fe,[ai,ae],(i,[t,n])=>{const l=i.properties()[t.value],m=n.value;return typeof l==typeof m&&l<m}],"filter-id-<":[fe,[ae],(i,[t])=>{const n=i.id(),l=t.value;return typeof n==typeof l&&n<l}],"filter->":[fe,[ai,ae],(i,[t,n])=>{const l=i.properties()[t.value],m=n.value;return typeof l==typeof m&&l>m}],"filter-id->":[fe,[ae],(i,[t])=>{const n=i.id(),l=t.value;return typeof n==typeof l&&n>l}],"filter-<=":[fe,[ai,ae],(i,[t,n])=>{const l=i.properties()[t.value],m=n.value;return typeof l==typeof m&&l<=m}],"filter-id-<=":[fe,[ae],(i,[t])=>{const n=i.id(),l=t.value;return typeof n==typeof l&&n<=l}],"filter->=":[fe,[ai,ae],(i,[t,n])=>{const l=i.properties()[t.value],m=n.value;return typeof l==typeof m&&l>=m}],"filter-id->=":[fe,[ae],(i,[t])=>{const n=i.id(),l=t.value;return typeof n==typeof l&&n>=l}],"filter-has":[fe,[ae],(i,[t])=>t.value in i.properties()],"filter-has-id":[fe,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[fe,[B(ai)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[fe,[B(ae)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[fe,[ai,B(ae)],(i,[t,n])=>n.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[fe,[ai,B(ae)],(i,[t,n])=>function(l,m,v,x){for(;v<=x;){const I=v+x>>1;if(m[I]===l)return!0;m[I]>l?x=I-1:v=I+1}return!1}(i.properties()[t.value],n.value,0,n.value.length-1)],all:{type:fe,overloads:[[[fe,fe],(i,[t,n])=>t.evaluate(i)&&n.evaluate(i)],[Wn(fe),(i,t)=>{for(const n of t)if(!n.evaluate(i))return!1;return!0}]]},any:{type:fe,overloads:[[[fe,fe],(i,[t,n])=>t.evaluate(i)||n.evaluate(i)],[Wn(fe),(i,t)=>{for(const n of t)if(n.evaluate(i))return!0;return!1}]]},"!":[fe,[fe],(i,[t])=>!t.evaluate(i)],"is-supported-script":[fe,[ai],(i,[t])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(t.evaluate(i))}],upcase:[ai,[ai],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[ai,[ai],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[ai,Wn(ae),(i,t)=>t.map(n=>sr(n.evaluate(i))).join("")],"resolved-locale":[ai,[Ee],(i,[t])=>t.evaluate(i).resolvedLocale()]});class fr{constructor(t,n){var l;this.expression=t,this._warningHistory={},this._evaluator=new Zr,this._defaultValue=n?(l=n).type==="color"&&Ms(l.default)?new $i(0,0,0,0):l.type==="color"?$i.parse(l.default)||null:l.type==="padding"?fn.parse(l.default)||null:l.type==="variableAnchorOffsetCollection"?xn.parse(l.default)||null:l.default===void 0?null:l.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,l,m,v,x){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=l,this._evaluator.canonical=m,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(t,n,l,m,v,x){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=l||null,this._evaluator.canonical=m,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new pr(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function La(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Es}function Nr(i,t){const n=new cs(Es,ta,[],t?function(m){const v={color:k,string:ai,number:_t,enum:ai,boolean:fe,formatted:Re,padding:Ve,resolvedImage:lt,variableAnchorOffsetCollection:ee};return m.type==="array"?B(v[m.value]||ae,m.length):v[m.type]}(t):void 0),l=n.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?Wa(new fr(l,t)):Hr(n.errors)}class Xr{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!Pa(n.expression)}evaluateWithoutErrorHandling(t,n,l,m,v,x){return this._styleExpression.evaluateWithoutErrorHandling(t,n,l,m,v,x)}evaluate(t,n,l,m,v,x){return this._styleExpression.evaluate(t,n,l,m,v,x)}}class gs{constructor(t,n,l,m){this.kind=t,this.zoomStops=l,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!Pa(n.expression),this.interpolationType=m}evaluateWithoutErrorHandling(t,n,l,m,v,x){return this._styleExpression.evaluateWithoutErrorHandling(t,n,l,m,v,x)}evaluate(t,n,l,m,v,x){return this._styleExpression.evaluate(t,n,l,m,v,x)}interpolationFactor(t,n,l){return this.interpolationType?oi.interpolationFactor(this.interpolationType,t,n,l):0}}function Mo(i,t){const n=Nr(i,t);if(n.result==="error")return n;const l=n.value.expression,m=jr(l);if(!m&&!ms(t))return Hr([new mi("","data expressions not supported")]);const v=ia(l,["zoom"]);if(!v&&!pl(t))return Hr([new mi("","zoom expressions not supported")]);const x=ys(l);return x||v?x instanceof mi?Hr([x]):x instanceof oi&&!Eo(t)?Hr([new mi("",'"interpolate" expressions cannot be used with this property')]):Wa(x?new gs(m?"camera":"composite",n.value,x.labels,x instanceof oi?x.interpolation:void 0):new Xr(m?"constant":"source",n.value)):Hr([new mi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ds{constructor(t,n){this._parameters=t,this._specification=n,si(this,sn(this._parameters,this._specification))}static deserialize(t){return new Ds(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ys(i){let t=null;if(i instanceof hs)t=ys(i.result);else if(i instanceof vo){for(const n of i.args)if(t=ys(n),t)break}else(i instanceof ba||i instanceof oi)&&i.input instanceof Wr&&i.input.name==="zoom"&&(t=i);return t instanceof mi||i.eachChild(n=>{const l=ys(n);l instanceof mi?t=l:!t&&l?t=new mi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&l&&t!==l&&(t=new mi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Fs(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!Fs(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const _s={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ra(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Fs(i)||(i=vs(i));const t=Nr(i,_s);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,l,m)=>t.value.evaluate(n,l,{},m),needGeometry:ka(i)}}function zo(i,t){return i<t?-1:i>t?1:0}function ka(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(ka(i[t]))return!0;return!1}function vs(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?Xa(i[1],i[2],"=="):t==="!="?zi(Xa(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Xa(i[1],i[2],t):t==="any"?(n=i.slice(1),["any"].concat(n.map(vs))):t==="all"?["all"].concat(i.slice(1).map(vs)):t==="none"?["all"].concat(i.slice(1).map(vs).map(zi)):t==="in"?an(i[1],i.slice(2)):t==="!in"?zi(an(i[1],i.slice(2))):t==="has"?on(i[1]):t!=="!has"||zi(on(i[1]));var n}function Xa(i,t,n){switch(i){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,i,t]}}function an(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",i,["literal",t.sort(zo)]]:["filter-in-small",i,["literal",t]]}}function on(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function zi(i){return["!",i]}function Zi(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let m="[";for(const v of i)m+=`${Zi(v)},`;return`${m}]`}const n=Object.keys(i).sort();let l="{";for(let m=0;m<n.length;m++)l+=`${JSON.stringify(n[m])}:${Zi(i[n[m]])},`;return`${l}}`}function Ir(i){let t="";for(const n of gi)t+=`/${Zi(i[n])}`;return t}function Dr(i){const t=i.value;return t?[new yt(i.key,t,"constants have been deprecated as of v8")]:[]}function Yi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function yn(i){if(Array.isArray(i))return i.map(yn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const n in i)t[n]=yn(i[n]);return t}return Yi(i)}function qr(i){const t=i.key,n=i.value,l=i.valueSpec||{},m=i.objectElementValidators||{},v=i.style,x=i.styleSpec,I=i.validateSpec;let T=[];const z=Mi(n);if(z!=="object")return[new yt(t,n,`object expected, ${z} found`)];for(const j in n){const Z=j.split(".")[0],X=l[Z]||l["*"];let J;if(m[Z])J=m[Z];else if(l[Z])J=I;else if(m["*"])J=m["*"];else{if(!l["*"]){T.push(new yt(t,n[j],`unknown property "${j}"`));continue}J=I}T=T.concat(J({key:(t&&`${t}.`)+j,value:n[j],valueSpec:X,style:v,styleSpec:x,object:n,objectKey:j,validateSpec:I},n))}for(const j in l)m[j]||l[j].required&&l[j].default===void 0&&n[j]===void 0&&T.push(new yt(t,n,`missing required property "${j}"`));return T}function Ta(i){const t=i.value,n=i.valueSpec,l=i.style,m=i.styleSpec,v=i.key,x=i.arrayElementValidator||i.validateSpec;if(Mi(t)!=="array")return[new yt(v,t,`array expected, ${Mi(t)} found`)];if(n.length&&t.length!==n.length)return[new yt(v,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new yt(v,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let I={type:n.value,values:n.values};m.$version<7&&(I.function=n.function),Mi(n.value)==="object"&&(I=n.value);let T=[];for(let z=0;z<t.length;z++)T=T.concat(x({array:t,arrayIndex:z,value:t[z],valueSpec:I,validateSpec:i.validateSpec,style:l,styleSpec:m,key:`${v}[${z}]`}));return T}function fl(i){const t=i.key,n=i.value,l=i.valueSpec;let m=Mi(n);return m==="number"&&n!=n&&(m="NaN"),m!=="number"?[new yt(t,n,`number expected, ${m} found`)]:"minimum"in l&&n<l.minimum?[new yt(t,n,`${n} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&n>l.maximum?[new yt(t,n,`${n} is greater than the maximum value ${l.maximum}`)]:[]}function Ka(i){const t=i.valueSpec,n=Yi(i.value.type);let l,m,v,x={};const I=n!=="categorical"&&i.value.property===void 0,T=!I,z=Mi(i.value.stops)==="array"&&Mi(i.value.stops[0])==="array"&&Mi(i.value.stops[0][0])==="object",j=qr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(J){if(n==="identity")return[new yt(J.key,J.value,'identity function may not have a "stops" property')];let re=[];const ce=J.value;return re=re.concat(Ta({key:J.key,value:ce,valueSpec:J.valueSpec,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec,arrayElementValidator:Z})),Mi(ce)==="array"&&ce.length===0&&re.push(new yt(J.key,ce,"array must have at least one stop")),re},default:function(J){return J.validateSpec({key:J.key,value:J.value,valueSpec:t,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec})}}});return n==="identity"&&I&&j.push(new yt(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||j.push(new yt(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!Eo(i.valueSpec)&&j.push(new yt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(T&&!ms(i.valueSpec)?j.push(new yt(i.key,i.value,"property functions not supported")):I&&!pl(i.valueSpec)&&j.push(new yt(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!z||i.value.property!==void 0||j.push(new yt(i.key,i.value,'"property" property is required')),j;function Z(J){let re=[];const ce=J.value,Ae=J.key;if(Mi(ce)!=="array")return[new yt(Ae,ce,`array expected, ${Mi(ce)} found`)];if(ce.length!==2)return[new yt(Ae,ce,`array length 2 expected, length ${ce.length} found`)];if(z){if(Mi(ce[0])!=="object")return[new yt(Ae,ce,`object expected, ${Mi(ce[0])} found`)];if(ce[0].zoom===void 0)return[new yt(Ae,ce,"object stop key must have zoom")];if(ce[0].value===void 0)return[new yt(Ae,ce,"object stop key must have value")];if(v&&v>Yi(ce[0].zoom))return[new yt(Ae,ce[0].zoom,"stop zoom values must appear in ascending order")];Yi(ce[0].zoom)!==v&&(v=Yi(ce[0].zoom),m=void 0,x={}),re=re.concat(qr({key:`${Ae}[0]`,value:ce[0],valueSpec:{zoom:{}},validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec,objectElementValidators:{zoom:fl,value:X}}))}else re=re.concat(X({key:`${Ae}[0]`,value:ce[0],valueSpec:{},validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec},ce));return La(yn(ce[1]))?re.concat([new yt(`${Ae}[1]`,ce[1],"expressions are not allowed in function stops.")]):re.concat(J.validateSpec({key:`${Ae}[1]`,value:ce[1],valueSpec:t,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec}))}function X(J,re){const ce=Mi(J.value),Ae=Yi(J.value),Ce=J.value!==null?J.value:re;if(l){if(ce!==l)return[new yt(J.key,Ce,`${ce} stop domain type must match previous stop domain type ${l}`)]}else l=ce;if(ce!=="number"&&ce!=="string"&&ce!=="boolean")return[new yt(J.key,Ce,"stop domain value must be a number, string, or boolean")];if(ce!=="number"&&n!=="categorical"){let Ze=`number expected, ${ce} found`;return ms(t)&&n===void 0&&(Ze+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new yt(J.key,Ce,Ze)]}return n!=="categorical"||ce!=="number"||isFinite(Ae)&&Math.floor(Ae)===Ae?n!=="categorical"&&ce==="number"&&m!==void 0&&Ae<m?[new yt(J.key,Ce,"stop domain values must appear in ascending order")]:(m=Ae,n==="categorical"&&Ae in x?[new yt(J.key,Ce,"stop domain values must be unique")]:(x[Ae]=!0,[])):[new yt(J.key,Ce,`integer expected, found ${Ae}`)]}}function Vr(i){const t=(i.expressionContext==="property"?Mo:Nr)(yn(i.value),i.valueSpec);if(t.result==="error")return t.value.map(l=>new yt(`${i.key}${l.key}`,i.value,l.message));const n=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new yt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Pa(n))return[new yt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Pa(n))return[new yt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ia(n,["zoom","feature-state"]))return[new yt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!jr(n))return[new yt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Fr(i){const t=i.key,n=i.value,l=i.valueSpec,m=[];return Array.isArray(l.values)?l.values.indexOf(Yi(n))===-1&&m.push(new yt(t,n,`expected one of [${l.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(l.values).indexOf(Yi(n))===-1&&m.push(new yt(t,n,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(n)} found`)),m}function No(i){return Fs(yn(i.value))?Vr(si({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ya(i)}function Ya(i){const t=i.value,n=i.key;if(Mi(t)!=="array")return[new yt(n,t,`array expected, ${Mi(t)} found`)];const l=i.styleSpec;let m,v=[];if(t.length<1)return[new yt(n,t,"filter array must have at least 1 element")];switch(v=v.concat(Fr({key:`${n}[0]`,value:t[0],valueSpec:l.filter_operator,style:i.style,styleSpec:i.styleSpec})),Yi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Yi(t[1])==="$type"&&v.push(new yt(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&v.push(new yt(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(m=Mi(t[1]),m!=="string"&&v.push(new yt(`${n}[1]`,t[1],`string expected, ${m} found`)));for(let x=2;x<t.length;x++)m=Mi(t[x]),Yi(t[1])==="$type"?v=v.concat(Fr({key:`${n}[${x}]`,value:t[x],valueSpec:l.geometry_type,style:i.style,styleSpec:i.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&v.push(new yt(`${n}[${x}]`,t[x],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)v=v.concat(Ya({key:`${n}[${x}]`,value:t[x],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":m=Mi(t[1]),t.length!==2?v.push(new yt(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):m!=="string"&&v.push(new yt(`${n}[1]`,t[1],`string expected, ${m} found`))}return v}function jl(i,t){const n=i.key,l=i.validateSpec,m=i.style,v=i.styleSpec,x=i.value,I=i.objectKey,T=v[`${t}_${i.layerType}`];if(!T)return[];const z=I.match(/^(.*)-transition$/);if(t==="paint"&&z&&T[z[1]]&&T[z[1]].transition)return l({key:n,value:x,valueSpec:v.transition,style:m,styleSpec:v});const j=i.valueSpec||T[I];if(!j)return[new yt(n,x,`unknown property "${I}"`)];let Z;if(Mi(x)==="string"&&ms(j)&&!j.tokens&&(Z=/^{([^}]+)}$/.exec(x)))return[new yt(n,x,`"${I}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Z[1])} }\`.`)];const X=[];return i.layerType==="symbol"&&(I==="text-field"&&m&&!m.glyphs&&X.push(new yt(n,x,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&Ms(yn(x))&&Yi(x.type)==="identity"&&X.push(new yt(n,x,'"text-font" does not support identity functions'))),X.concat(l({key:i.key,value:x,valueSpec:j,style:m,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:I}))}function Ja(i){return jl(i,"paint")}function Do(i){return jl(i,"layout")}function ml(i){let t=[];const n=i.value,l=i.key,m=i.style,v=i.styleSpec;n.type||n.ref||t.push(new yt(l,n,'either "type" or "ref" is required'));let x=Yi(n.type);const I=Yi(n.ref);if(n.id){const T=Yi(n.id);for(let z=0;z<i.arrayIndex;z++){const j=m.layers[z];Yi(j.id)===T&&t.push(new yt(l,n.id,`duplicate layer id "${n.id}", previously used at line ${j.id.__line__}`))}}if("ref"in n){let T;["type","source","source-layer","filter","layout"].forEach(z=>{z in n&&t.push(new yt(l,n[z],`"${z}" is prohibited for ref layers`))}),m.layers.forEach(z=>{Yi(z.id)===I&&(T=z)}),T?T.ref?t.push(new yt(l,n.ref,"ref cannot reference another ref layer")):x=Yi(T.type):t.push(new yt(l,n.ref,`ref layer "${I}" not found`))}else if(x!=="background")if(n.source){const T=m.sources&&m.sources[n.source],z=T&&Yi(T.type);T?z==="vector"&&x==="raster"?t.push(new yt(l,n.source,`layer "${n.id}" requires a raster source`)):z!=="raster-dem"&&x==="hillshade"?t.push(new yt(l,n.source,`layer "${n.id}" requires a raster-dem source`)):z==="raster"&&x!=="raster"?t.push(new yt(l,n.source,`layer "${n.id}" requires a vector source`)):z!=="vector"||n["source-layer"]?z==="raster-dem"&&x!=="hillshade"?t.push(new yt(l,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!n.paint||!n.paint["line-gradient"]||z==="geojson"&&T.lineMetrics||t.push(new yt(l,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new yt(l,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new yt(l,n.source,`source "${n.source}" not found`))}else t.push(new yt(l,n,'missing required property "source"'));return t=t.concat(qr({key:l,value:n,valueSpec:v.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${l}.type`,value:n.type,valueSpec:v.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:No,layout:T=>qr({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":z=>Do(si({layerType:x},z))}}),paint:T=>qr({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":z=>Ja(si({layerType:x},z))}})}})),t}function Ca(i){const t=i.value,n=i.key,l=Mi(t);return l!=="string"?[new yt(n,t,`string expected, ${l} found`)]:[]}const Fo={promoteId:function({key:i,value:t}){if(Mi(t)==="string")return Ca({key:i,value:t});{const n=[];for(const l in t)n.push(...Ca({key:`${i}.${l}`,value:t[l]}));return n}}};function Qa(i){const t=i.value,n=i.key,l=i.styleSpec,m=i.style,v=i.validateSpec;if(!t.type)return[new yt(n,t,'"type" is required')];const x=Yi(t.type);let I;switch(x){case"vector":case"raster":return I=qr({key:n,value:t,valueSpec:l[`source_${x.replace("-","_")}`],style:i.style,styleSpec:l,objectElementValidators:Fo,validateSpec:v}),I;case"raster-dem":return I=function(T){var z;const j=(z=T.sourceName)!==null&&z!==void 0?z:"",Z=T.value,X=T.styleSpec,J=X.source_raster_dem,re=T.style;let ce=[];const Ae=Mi(Z);if(Z===void 0)return ce;if(Ae!=="object")return ce.push(new yt("source_raster_dem",Z,`object expected, ${Ae} found`)),ce;const Ce=Yi(Z.encoding)==="custom",Ze=["redFactor","greenFactor","blueFactor","baseShift"],Oe=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const Ue in Z)!Ce&&Ze.includes(Ue)?ce.push(new yt(Ue,Z[Ue],`In "${j}": "${Ue}" is only valid when "encoding" is set to "custom". ${Oe} encoding found`)):J[Ue]?ce=ce.concat(T.validateSpec({key:Ue,value:Z[Ue],valueSpec:J[Ue],validateSpec:T.validateSpec,style:re,styleSpec:X})):ce.push(new yt(Ue,Z[Ue],`unknown property "${Ue}"`));return ce}({sourceName:n,value:t,style:i.style,styleSpec:l,validateSpec:v}),I;case"geojson":if(I=qr({key:n,value:t,valueSpec:l.source_geojson,style:m,styleSpec:l,validateSpec:v,objectElementValidators:Fo}),t.cluster)for(const T in t.clusterProperties){const[z,j]=t.clusterProperties[T],Z=typeof z=="string"?[z,["accumulated"],["get",T]]:z;I.push(...Vr({key:`${n}.${T}.map`,value:j,validateSpec:v,expressionContext:"cluster-map"})),I.push(...Vr({key:`${n}.${T}.reduce`,value:Z,validateSpec:v,expressionContext:"cluster-reduce"}))}return I;case"video":return qr({key:n,value:t,valueSpec:l.source_video,style:m,validateSpec:v,styleSpec:l});case"image":return qr({key:n,value:t,valueSpec:l.source_image,style:m,validateSpec:v,styleSpec:l});case"canvas":return[new yt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Fr({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:m,validateSpec:v,styleSpec:l})}}function Ro(i){const t=i.value,n=i.styleSpec,l=n.light,m=i.style;let v=[];const x=Mi(t);if(t===void 0)return v;if(x!=="object")return v=v.concat([new yt("light",t,`object expected, ${x} found`)]),v;for(const I in t){const T=I.match(/^(.*)-transition$/);v=v.concat(T&&l[T[1]]&&l[T[1]].transition?i.validateSpec({key:I,value:t[I],valueSpec:n.transition,validateSpec:i.validateSpec,style:m,styleSpec:n}):l[I]?i.validateSpec({key:I,value:t[I],valueSpec:l[I],validateSpec:i.validateSpec,style:m,styleSpec:n}):[new yt(I,t[I],`unknown property "${I}"`)])}return v}function gl(i){const t=i.value,n=i.styleSpec,l=n.sky,m=i.style,v=Mi(t);if(t===void 0)return[];if(v!=="object")return[new yt("sky",t,`object expected, ${v} found`)];let x=[];for(const I in t)x=x.concat(l[I]?i.validateSpec({key:I,value:t[I],valueSpec:l[I],style:m,styleSpec:n}):[new yt(I,t[I],`unknown property "${I}"`)]);return x}function hc(i){const t=i.value,n=i.styleSpec,l=n.terrain,m=i.style;let v=[];const x=Mi(t);if(t===void 0)return v;if(x!=="object")return v=v.concat([new yt("terrain",t,`object expected, ${x} found`)]),v;for(const I in t)v=v.concat(l[I]?i.validateSpec({key:I,value:t[I],valueSpec:l[I],validateSpec:i.validateSpec,style:m,styleSpec:n}):[new yt(I,t[I],`unknown property "${I}"`)]);return v}function uc(i){let t=[];const n=i.value,l=i.key;if(Array.isArray(n)){const m=[],v=[];for(const x in n)n[x].id&&m.includes(n[x].id)&&t.push(new yt(l,n,`all the sprites' ids must be unique, but ${n[x].id} is duplicated`)),m.push(n[x].id),n[x].url&&v.includes(n[x].url)&&t.push(new yt(l,n,`all the sprites' URLs must be unique, but ${n[x].url} is duplicated`)),v.push(n[x].url),t=t.concat(qr({key:`${l}[${x}]`,value:n[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return Ca({key:l,value:n})}const yl={"*":()=>[],array:Ta,boolean:function(i){const t=i.value,n=i.key,l=Mi(t);return l!=="boolean"?[new yt(n,t,`boolean expected, ${l} found`)]:[]},number:fl,color:function(i){const t=i.key,n=i.value,l=Mi(n);return l!=="string"?[new yt(t,n,`color expected, ${l} found`)]:$i.parse(String(n))?[]:[new yt(t,n,`color expected, "${n}" found`)]},constants:Dr,enum:Fr,filter:No,function:Ka,layer:ml,object:qr,source:Qa,light:Ro,sky:gl,terrain:hc,projection:function(i){const t=i.value,n=i.styleSpec,l=n.projection,m=i.style,v=Mi(t);if(t===void 0)return[];if(v!=="object")return[new yt("projection",t,`object expected, ${v} found`)];let x=[];for(const I in t)x=x.concat(l[I]?i.validateSpec({key:I,value:t[I],valueSpec:l[I],style:m,styleSpec:n}):[new yt(I,t[I],`unknown property "${I}"`)]);return x},string:Ca,formatted:function(i){return Ca(i).length===0?[]:Vr(i)},resolvedImage:function(i){return Ca(i).length===0?[]:Vr(i)},padding:function(i){const t=i.key,n=i.value;if(Mi(n)==="array"){if(n.length<1||n.length>4)return[new yt(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const l={type:"number"};let m=[];for(let v=0;v<n.length;v++)m=m.concat(i.validateSpec({key:`${t}[${v}]`,value:n[v],validateSpec:i.validateSpec,valueSpec:l}));return m}return fl({key:t,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,n=i.value,l=Mi(n),m=i.styleSpec;if(l!=="array"||n.length<1||n.length%2!=0)return[new yt(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let x=0;x<n.length;x+=2)v=v.concat(Fr({key:`${t}[${x}]`,value:n[x],valueSpec:m.layout_symbol["text-anchor"]})),v=v.concat(Ta({key:`${t}[${x+1}]`,value:n[x+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:m}));return v},sprite:uc};function Oo(i){const t=i.value,n=i.valueSpec,l=i.styleSpec;return i.validateSpec=Oo,n.expression&&Ms(Yi(t))?Ka(i):n.expression&&La(yn(t))?Vr(i):n.type&&yl[n.type]?yl[n.type](i):qr(si({},i,{valueSpec:n.type?l[n.type]:n}))}function Fc(i){const t=i.value,n=i.key,l=Ca(i);return l.length||(t.indexOf("{fontstack}")===-1&&l.push(new yt(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&l.push(new yt(n,t,'"glyphs" url must include a "{range}" token'))),l}function Xn(i,t=te){let n=[];return n=n.concat(Oo({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:Oo,objectElementValidators:{glyphs:Fc,"*":()=>[]}})),i.constants&&(n=n.concat(Dr({key:"constants",value:i.constants,style:i,styleSpec:t,validateSpec:Oo}))),dc(n)}function Rs(i){return function(t){return i({...t,validateSpec:Oo})}}function dc(i){return[].concat(i).sort((t,n)=>t.line-n.line)}function Fn(i){return function(...t){return dc(i.apply(this,t))}}Xn.source=Fn(Rs(Qa)),Xn.sprite=Fn(Rs(uc)),Xn.glyphs=Fn(Rs(Fc)),Xn.light=Fn(Rs(Ro)),Xn.sky=Fn(Rs(gl)),Xn.terrain=Fn(Rs(hc)),Xn.layer=Fn(Rs(ml)),Xn.filter=Fn(Rs(No)),Xn.paintProperty=Fn(Rs(Ja)),Xn.layoutProperty=Fn(Rs(Do));const na=Xn,_l=na.light,wh=na.sky,Rc=na.paintProperty,pc=na.layoutProperty;function fc(i,t){let n=!1;if(t&&t.length)for(const l of t)i.fire(new ti(new Error(l.message))),n=!0;return n}class Bo{constructor(t,n,l){const m=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const x=new Int32Array(this.arrayBuffer);t=x[0],this.d=(n=x[1])+2*(l=x[2]);for(let T=0;T<this.d*this.d;T++){const z=x[3+T],j=x[3+T+1];m.push(z===j?null:x.subarray(z,j))}const I=x[3+m.length+1];this.keys=x.subarray(x[3+m.length],I),this.bboxes=x.subarray(I),this.insert=this._insertReadonly}else{this.d=n+2*l;for(let x=0;x<this.d*this.d;x++)m.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=l,this.scale=n/t,this.uid=0;const v=l/n*t;this.min=-v,this.max=t+v}insert(t,n,l,m,v){this._forEachCell(n,l,m,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(m),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,l,m,v,x){this.cells[v].push(x)}query(t,n,l,m,v){const x=this.min,I=this.max;if(t<=x&&n<=x&&I<=l&&I<=m&&!v)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(t,n,l,m,this._queryCell,T,{},v),T}}_queryCell(t,n,l,m,v,x,I,T){const z=this.cells[v];if(z!==null){const j=this.keys,Z=this.bboxes;for(let X=0;X<z.length;X++){const J=z[X];if(I[J]===void 0){const re=4*J;(T?T(Z[re+0],Z[re+1],Z[re+2],Z[re+3]):t<=Z[re+2]&&n<=Z[re+3]&&l>=Z[re+0]&&m>=Z[re+1])?(I[J]=!0,x.push(j[J])):I[J]=!1}}}}_forEachCell(t,n,l,m,v,x,I,T){const z=this._convertToCellCoord(t),j=this._convertToCellCoord(n),Z=this._convertToCellCoord(l),X=this._convertToCellCoord(m);for(let J=z;J<=Z;J++)for(let re=j;re<=X;re++){const ce=this.d*re+J;if((!T||T(this._convertFromCellCoord(J),this._convertFromCellCoord(re),this._convertFromCellCoord(J+1),this._convertFromCellCoord(re+1)))&&v.call(this,t,n,l,m,ce,x,I,T))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let l=0;for(let x=0;x<this.cells.length;x++)l+=this.cells[x].length;const m=new Int32Array(n+l+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;let v=n;for(let x=0;x<t.length;x++){const I=t[x];m[3+x]=v,m.set(I,v),v+=I.length}return m[3+t.length]=v,m.set(this.keys,v),v+=this.keys.length,m[3+t.length+1]=v,m.set(this.bboxes,v),v+=this.bboxes.length,m.buffer}static serialize(t,n){const l=t.toArrayBuffer();return n&&n.push(l),{buffer:l}}static deserialize(t){return new Bo(t.buffer)}}const Kn={};function Vt(i,t,n={}){if(Kn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),Kn[i]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}Vt("Object",Object),Vt("TransferableGridIndex",Bo),Vt("Color",$i),Vt("Error",Error),Vt("AJAXError",$e),Vt("ResolvedImage",rn),Vt("StylePropertyFunction",Ds),Vt("StyleExpression",fr,{omit:["_evaluator"]}),Vt("ZoomDependentExpression",gs),Vt("ZoomConstantExpression",Xr),Vt("CompoundExpression",Wr,{omit:["_evaluate"]});for(const i in Es)Es[i]._classRegistryKey||Vt(`Expression_${i}`,Es[i]);function bs(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Rn(i){return i.$name||i.constructor._classRegistryKey}function Os(i){return!function(t){if(t===null||typeof t!="object")return!1;const n=Rn(t);return!(!n||n==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||bs(i)||nt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function jo(i,t){if(Os(i))return(bs(i)||nt(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const v=[];for(const x of i)v.push(jo(x,t));return v}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const n=Rn(i);if(!n)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!Kn[n])throw new Error(`${n} is not registered.`);const{klass:l}=Kn[n],m=l.serialize?l.serialize(i,t):{};if(l.serialize){if(t&&m===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in i){if(!i.hasOwnProperty(v)||Kn[n].omit.indexOf(v)>=0)continue;const x=i[v];m[v]=Kn[n].shallow.indexOf(v)>=0?x:jo(x,t)}i instanceof Error&&(m.message=i.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(m.$name=n),m}function eo(i){if(Os(i))return i;if(Array.isArray(i))return i.map(eo);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=Rn(i)||"Object";if(!Kn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=Kn[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(i);const l=Object.create(n.prototype);for(const m of Object.keys(i)){if(m==="$name")continue;const v=i[m];l[m]=Kn[t].shallow.indexOf(m)>=0?v:eo(v)}return l}class Bs{constructor(){this.first=!0}update(t,n){const l=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=l,!0))}}const Si={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function mc(i){for(const t of i)if(yc(t.charCodeAt(0)))return!0;return!1}function Sh(i){for(const t of i)if(!to(t.charCodeAt(0)))return!1;return!0}function ql(i){const t=i.map(n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}}).filter(n=>n);return new RegExp(t.join("|"),"u")}const Oc=ql(["Arab","Dupl","Mong","Ougr","Syrc"]);function to(i){return!Oc.test(String.fromCodePoint(i))}const gc=ql(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function yc(i){return!(i!==746&&i!==747&&(i<4352||!(Si["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Si["CJK Compatibility"](i)||Si["CJK Strokes"](i)||!(!Si["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Si["Enclosed CJK Letters and Months"](i)||Si["Ideographic Description Characters"](i)||Si.Kanbun(i)||Si.Katakana(i)&&i!==12540||!(!Si["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Si["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Si["Vertical Forms"](i)||Si["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||gc.test(String.fromCodePoint(i)))))}function vl(i){return!(yc(i)||function(t){return!!(Si["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Si["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Si["Letterlike Symbols"](t)||Si["Number Forms"](t)||Si["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Si["Control Pictures"](t)&&t!==9251||Si["Optical Character Recognition"](t)||Si["Enclosed Alphanumerics"](t)||Si["Geometric Shapes"](t)||Si["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Si["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Si["CJK Symbols and Punctuation"](t)||Si.Katakana(t)||Si["Private Use Area"](t)||Si["CJK Compatibility Forms"](t)||Si["Small Form Variants"](t)||Si["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}const Vl=ql(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function io(i){return Vl.test(String.fromCodePoint(i))}function _c(i,t){return!(!t&&io(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Si.Khmer(i))}function Bc(i){for(const t of i)if(io(t.charCodeAt(0)))return!0;return!1}const On=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Qi{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Bs,this.transition={})}isSupportedScript(t){return function(n,l){for(const m of n)if(!_c(m.charCodeAt(0),l))return!1;return!0}(t,On.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),l=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*n}}}class qo{constructor(t,n){this.property=t,this.value=n,this.expression=function(l,m){if(Ms(l))return new Ds(l,m);if(La(l)){const v=Mo(l,m);if(v.result==="error")throw new Error(v.value.map(x=>`${x.key}: ${x.message}`).join(", "));return v.value}{let v=l;return m.type==="color"&&typeof l=="string"?v=$i.parse(l):m.type!=="padding"||typeof l!="number"&&!Array.isArray(l)?m.type==="variableAnchorOffsetCollection"&&Array.isArray(l)&&(v=xn.parse(l)):v=fn.parse(l),{kind:"constant",evaluate:()=>v}}}(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,l){return this.property.possiblyEvaluate(this,t,n,l)}}class Ul{constructor(t){this.property=t,this.value=new qo(t,void 0)}transitioned(t,n){return new jc(this.property,this.value,n,Ge({},t.transition,this.transition),t.now)}untransitioned(){return new jc(this.property,this.value,null,{},0)}}class $l{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return pe(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ul(this._values[t].property)),this._values[t].value=new qo(this._values[t].property,n===null?void 0:pe(n))}getTransition(t){return pe(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ul(this._values[t].property)),this._values[t].transition=pe(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(t[n]=l);const m=this.getTransition(n);m!==void 0&&(t[`${n}-transition`]=m)}return t}transitioned(t,n){const l=new bl(this._properties);for(const m of Object.keys(this._values))l._values[m]=this._values[m].transitioned(t,n._values[m]);return l}untransitioned(){const t=new bl(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class jc{constructor(t,n,l,m,v){this.property=t,this.value=n,this.begin=v+m.delay||0,this.end=this.begin+m.duration||0,t.specification.transition&&(m.delay||m.duration)&&(this.prior=l)}possiblyEvaluate(t,n,l){const m=t.now||0,v=this.value.possiblyEvaluate(t,n,l),x=this.prior;if(x){if(m>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(m<this.begin)return x.possiblyEvaluate(t,n,l);{const I=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(t,n,l),v,function(T){if(T<=0)return 0;if(T>=1)return 1;const z=T*T,j=z*T;return 4*(T<.5?j:3*(T-z)+j-.75)}(I))}}return v}}class bl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,l){const m=new Ea(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].possiblyEvaluate(t,n,l);return m}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class xl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return pe(this._values[t].value)}setValue(t,n){this._values[t]=new qo(this._values[t].property,n===null?void 0:pe(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(t[n]=l)}return t}possiblyEvaluate(t,n,l){const m=new Ea(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].possiblyEvaluate(t,n,l);return m}}class xs{constructor(t,n,l){this.property=t,this.value=n,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,l,m){return this.property.evaluate(this.value,this.parameters,t,n,l,m)}}class Ea{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Wt{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,l){const m=Gr[this.specification.type];return m?m(t,n,l):t}}class hi{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,l,m){return new xs(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},l,m)}:t.expression,n)}interpolate(t,n,l){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new xs(this,{kind:"constant",value:void 0},t.parameters);const m=Gr[this.specification.type];if(m){const v=m(t.value.value,n.value.value,l);return new xs(this,{kind:"constant",value:v},t.parameters)}return t}evaluate(t,n,l,m,v,x){return t.kind==="constant"?t.value:t.evaluate(n,l,m,v,x)}}class wl extends hi{possiblyEvaluate(t,n,l,m){if(t.value===void 0)return new xs(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const v=t.expression.evaluate(n,null,{},l,m),x=t.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,I=this._calculate(x,x,x,n);return new xs(this,{kind:"constant",value:I},n)}if(t.expression.kind==="camera"){const v=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new xs(this,{kind:"constant",value:v},n)}return new xs(this,t.expression,n)}evaluate(t,n,l,m,v,x){if(t.kind==="source"){const I=t.evaluate(n,l,m,v,x);return this._calculate(I,I,I,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},l,m),t.evaluate({zoom:Math.floor(n.zoom)},l,m),t.evaluate({zoom:Math.floor(n.zoom)+1},l,m),n):t.value}_calculate(t,n,l,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:l,to:n}}interpolate(t){return t}}class b{constructor(t){this.specification=t}possiblyEvaluate(t,n,l,m){if(t.value!==void 0){if(t.expression.kind==="constant"){const v=t.expression.evaluate(n,null,{},l,m);return this._calculate(v,v,v,n)}return this._calculate(t.expression.evaluate(new Qi(Math.floor(n.zoom-1),n)),t.expression.evaluate(new Qi(Math.floor(n.zoom),n)),t.expression.evaluate(new Qi(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,l,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:l,to:n}}interpolate(t){return t}}class A{constructor(t){this.specification=t}possiblyEvaluate(t,n,l,m){return!!t.expression.evaluate(n,null,{},l,m)}interpolate(){return!1}}class c{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const l=t[n];l.specification.overridable&&this.overridableProperties.push(n);const m=this.defaultPropertyValues[n]=new qo(l,void 0),v=this.defaultTransitionablePropertyValues[n]=new Ul(l);this.defaultTransitioningPropertyValues[n]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=m.possiblyEvaluate({})}}}Vt("DataDrivenProperty",hi),Vt("DataConstantProperty",Wt),Vt("CrossFadedDataDrivenProperty",wl),Vt("CrossFadedProperty",b),Vt("ColorRampProperty",A);const e="-transition";class r extends ht{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new xl(n.layout)),n.paint)){this._transitionablePaint=new $l(n.paint);for(const l in t.paint)this.setPaintProperty(l,t.paint[l],{validate:!1});for(const l in t.layout)this.setLayoutProperty(l,t.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ea(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,l={}){n!=null&&this._validate(pc,`layers.${this.id}.layout.${t}`,t,n,l)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,l={}){if(n!=null&&this._validate(Rc,`layers.${this.id}.paint.${t}`,t,n,l))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const m=this._transitionablePaint._values[t],v=m.property.specification["property-type"]==="cross-faded-data-driven",x=m.value.isDataDriven(),I=m.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const T=this._transitionablePaint._values[t].value;return T.isDataDriven()||x||v||this._handleOverridablePaintPropertyUpdate(t,I,T)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,l){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),pt(t,(n,l)=>!(n===void 0||l==="layout"&&!Object.keys(n).length||l==="paint"&&!Object.keys(n).length))}_validate(t,n,l,m,v={}){return(!v||v.validate!==!1)&&fc(this,t.call(na,{key:n,layerType:this.type,objectKey:l,value:m,styleSpec:te,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof xs&&ms(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const o={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class h{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class p{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function w(i,t=1){let n=0,l=0;return{members:i.map(m=>{const v=o[m.type].BYTES_PER_ELEMENT,x=n=S(n,Math.max(t,v)),I=m.components||1;return l=Math.max(l,v),n+=v*I,{name:m.name,type:m.type,components:I,offset:x}}),size:S(n,Math.max(l,t)),alignment:t}}function S(i,t){return Math.ceil(i/t)*t}class P extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const l=this.length;return this.resize(l+1),this.emplace(l,t,n)}emplace(t,n,l){const m=2*t;return this.int16[m+0]=n,this.int16[m+1]=l,t}}P.prototype.bytesPerElement=4,Vt("StructArrayLayout2i4",P);class M extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,l)}emplace(t,n,l,m){const v=3*t;return this.int16[v+0]=n,this.int16[v+1]=l,this.int16[v+2]=m,t}}M.prototype.bytesPerElement=6,Vt("StructArrayLayout3i6",M);class R extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l,m){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,l,m)}emplace(t,n,l,m,v){const x=4*t;return this.int16[x+0]=n,this.int16[x+1]=l,this.int16[x+2]=m,this.int16[x+3]=v,t}}R.prototype.bytesPerElement=8,Vt("StructArrayLayout4i8",R);class N extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l,m,v,x){const I=this.length;return this.resize(I+1),this.emplace(I,t,n,l,m,v,x)}emplace(t,n,l,m,v,x,I){const T=6*t;return this.int16[T+0]=n,this.int16[T+1]=l,this.int16[T+2]=m,this.int16[T+3]=v,this.int16[T+4]=x,this.int16[T+5]=I,t}}N.prototype.bytesPerElement=12,Vt("StructArrayLayout2i4i12",N);class W extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l,m,v,x){const I=this.length;return this.resize(I+1),this.emplace(I,t,n,l,m,v,x)}emplace(t,n,l,m,v,x,I){const T=4*t,z=8*t;return this.int16[T+0]=n,this.int16[T+1]=l,this.uint8[z+4]=m,this.uint8[z+5]=v,this.uint8[z+6]=x,this.uint8[z+7]=I,t}}W.prototype.bytesPerElement=8,Vt("StructArrayLayout2i4ub8",W);class H extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const l=this.length;return this.resize(l+1),this.emplace(l,t,n)}emplace(t,n,l){const m=2*t;return this.float32[m+0]=n,this.float32[m+1]=l,t}}H.prototype.bytesPerElement=8,Vt("StructArrayLayout2f8",H);class G extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,l,m,v,x,I,T,z,j){const Z=this.length;return this.resize(Z+1),this.emplace(Z,t,n,l,m,v,x,I,T,z,j)}emplace(t,n,l,m,v,x,I,T,z,j,Z){const X=10*t;return this.uint16[X+0]=n,this.uint16[X+1]=l,this.uint16[X+2]=m,this.uint16[X+3]=v,this.uint16[X+4]=x,this.uint16[X+5]=I,this.uint16[X+6]=T,this.uint16[X+7]=z,this.uint16[X+8]=j,this.uint16[X+9]=Z,t}}G.prototype.bytesPerElement=20,Vt("StructArrayLayout10ui20",G);class K extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,l,m,v,x,I,T,z,j,Z,X){const J=this.length;return this.resize(J+1),this.emplace(J,t,n,l,m,v,x,I,T,z,j,Z,X)}emplace(t,n,l,m,v,x,I,T,z,j,Z,X,J){const re=12*t;return this.int16[re+0]=n,this.int16[re+1]=l,this.int16[re+2]=m,this.int16[re+3]=v,this.uint16[re+4]=x,this.uint16[re+5]=I,this.uint16[re+6]=T,this.uint16[re+7]=z,this.int16[re+8]=j,this.int16[re+9]=Z,this.int16[re+10]=X,this.int16[re+11]=J,t}}K.prototype.bytesPerElement=24,Vt("StructArrayLayout4i4ui4i24",K);class se extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,l){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,l)}emplace(t,n,l,m){const v=3*t;return this.float32[v+0]=n,this.float32[v+1]=l,this.float32[v+2]=m,t}}se.prototype.bytesPerElement=12,Vt("StructArrayLayout3f12",se);class oe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}oe.prototype.bytesPerElement=4,Vt("StructArrayLayout1ul4",oe);class he extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,l,m,v,x,I,T,z){const j=this.length;return this.resize(j+1),this.emplace(j,t,n,l,m,v,x,I,T,z)}emplace(t,n,l,m,v,x,I,T,z,j){const Z=10*t,X=5*t;return this.int16[Z+0]=n,this.int16[Z+1]=l,this.int16[Z+2]=m,this.int16[Z+3]=v,this.int16[Z+4]=x,this.int16[Z+5]=I,this.uint32[X+3]=T,this.uint16[Z+8]=z,this.uint16[Z+9]=j,t}}he.prototype.bytesPerElement=20,Vt("StructArrayLayout6i1ul2ui20",he);class le extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l,m,v,x){const I=this.length;return this.resize(I+1),this.emplace(I,t,n,l,m,v,x)}emplace(t,n,l,m,v,x,I){const T=6*t;return this.int16[T+0]=n,this.int16[T+1]=l,this.int16[T+2]=m,this.int16[T+3]=v,this.int16[T+4]=x,this.int16[T+5]=I,t}}le.prototype.bytesPerElement=12,Vt("StructArrayLayout2i2i2i12",le);class _e extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l,m,v){const x=this.length;return this.resize(x+1),this.emplace(x,t,n,l,m,v)}emplace(t,n,l,m,v,x){const I=4*t,T=8*t;return this.float32[I+0]=n,this.float32[I+1]=l,this.float32[I+2]=m,this.int16[T+6]=v,this.int16[T+7]=x,t}}_e.prototype.bytesPerElement=16,Vt("StructArrayLayout2f1f2i16",_e);class Me extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l,m,v,x){const I=this.length;return this.resize(I+1),this.emplace(I,t,n,l,m,v,x)}emplace(t,n,l,m,v,x,I){const T=16*t,z=4*t,j=8*t;return this.uint8[T+0]=n,this.uint8[T+1]=l,this.float32[z+1]=m,this.float32[z+2]=v,this.int16[j+6]=x,this.int16[j+7]=I,t}}Me.prototype.bytesPerElement=16,Vt("StructArrayLayout2ub2f2i16",Me);class Te extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,l){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,l)}emplace(t,n,l,m){const v=3*t;return this.uint16[v+0]=n,this.uint16[v+1]=l,this.uint16[v+2]=m,t}}Te.prototype.bytesPerElement=6,Vt("StructArrayLayout3ui6",Te);class rt extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,l,m,v,x,I,T,z,j,Z,X,J,re,ce,Ae,Ce){const Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,t,n,l,m,v,x,I,T,z,j,Z,X,J,re,ce,Ae,Ce)}emplace(t,n,l,m,v,x,I,T,z,j,Z,X,J,re,ce,Ae,Ce,Ze){const Oe=24*t,Ue=12*t,ot=48*t;return this.int16[Oe+0]=n,this.int16[Oe+1]=l,this.uint16[Oe+2]=m,this.uint16[Oe+3]=v,this.uint32[Ue+2]=x,this.uint32[Ue+3]=I,this.uint32[Ue+4]=T,this.uint16[Oe+10]=z,this.uint16[Oe+11]=j,this.uint16[Oe+12]=Z,this.float32[Ue+7]=X,this.float32[Ue+8]=J,this.uint8[ot+36]=re,this.uint8[ot+37]=ce,this.uint8[ot+38]=Ae,this.uint32[Ue+10]=Ce,this.int16[Oe+22]=Ze,t}}rt.prototype.bytesPerElement=48,Vt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",rt);class mt extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,l,m,v,x,I,T,z,j,Z,X,J,re,ce,Ae,Ce,Ze,Oe,Ue,ot,It,qt,pi,jt,Ft,Qt,Zt){const Ut=this.length;return this.resize(Ut+1),this.emplace(Ut,t,n,l,m,v,x,I,T,z,j,Z,X,J,re,ce,Ae,Ce,Ze,Oe,Ue,ot,It,qt,pi,jt,Ft,Qt,Zt)}emplace(t,n,l,m,v,x,I,T,z,j,Z,X,J,re,ce,Ae,Ce,Ze,Oe,Ue,ot,It,qt,pi,jt,Ft,Qt,Zt,Ut){const gt=32*t,ei=16*t;return this.int16[gt+0]=n,this.int16[gt+1]=l,this.int16[gt+2]=m,this.int16[gt+3]=v,this.int16[gt+4]=x,this.int16[gt+5]=I,this.int16[gt+6]=T,this.int16[gt+7]=z,this.uint16[gt+8]=j,this.uint16[gt+9]=Z,this.uint16[gt+10]=X,this.uint16[gt+11]=J,this.uint16[gt+12]=re,this.uint16[gt+13]=ce,this.uint16[gt+14]=Ae,this.uint16[gt+15]=Ce,this.uint16[gt+16]=Ze,this.uint16[gt+17]=Oe,this.uint16[gt+18]=Ue,this.uint16[gt+19]=ot,this.uint16[gt+20]=It,this.uint16[gt+21]=qt,this.uint16[gt+22]=pi,this.uint32[ei+12]=jt,this.float32[ei+13]=Ft,this.float32[ei+14]=Qt,this.uint16[gt+30]=Zt,this.uint16[gt+31]=Ut,t}}mt.prototype.bytesPerElement=64,Vt("StructArrayLayout8i15ui1ul2f2ui64",mt);class vt extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}vt.prototype.bytesPerElement=4,Vt("StructArrayLayout1f4",vt);class St extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,l){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,l)}emplace(t,n,l,m){const v=3*t;return this.uint16[6*t+0]=n,this.float32[v+1]=l,this.float32[v+2]=m,t}}St.prototype.bytesPerElement=12,Vt("StructArrayLayout1ui2f12",St);class wt extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,l){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,l)}emplace(t,n,l,m){const v=4*t;return this.uint32[2*t+0]=n,this.uint16[v+2]=l,this.uint16[v+3]=m,t}}wt.prototype.bytesPerElement=8,Vt("StructArrayLayout1ul2ui8",wt);class bt extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const l=this.length;return this.resize(l+1),this.emplace(l,t,n)}emplace(t,n,l){const m=2*t;return this.uint16[m+0]=n,this.uint16[m+1]=l,t}}bt.prototype.bytesPerElement=4,Vt("StructArrayLayout2ui4",bt);class At extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}At.prototype.bytesPerElement=2,Vt("StructArrayLayout1ui2",At);class Gt extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,l,m){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,l,m)}emplace(t,n,l,m,v){const x=4*t;return this.float32[x+0]=n,this.float32[x+1]=l,this.float32[x+2]=m,this.float32[x+3]=v,t}}Gt.prototype.bytesPerElement=16,Vt("StructArrayLayout4f16",Gt);class Ct extends h{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new O(this.anchorPointX,this.anchorPointY)}}Ct.prototype.size=20;class Et extends he{get(t){return new Ct(this,t)}}Vt("CollisionBoxArray",Et);class Jt extends h{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Jt.prototype.size=48;class fi extends rt{get(t){return new Jt(this,t)}}Vt("PlacedSymbolArray",fi);class di extends h{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}di.prototype.size=64;class vi extends mt{get(t){return new di(this,t)}}Vt("SymbolInstanceArray",vi);class Ti extends vt{getoffsetX(t){return this.float32[1*t+0]}}Vt("GlyphOffsetArray",Ti);class Gi extends M{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Vt("SymbolLineVertexArray",Gi);class or extends h{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}or.prototype.size=12;class ji extends St{get(t){return new or(this,t)}}Vt("TextAnchorOffsetArray",ji);class br extends h{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}br.prototype.size=8;class Wi extends wt{get(t){return new br(this,t)}}Vt("FeatureIndexArray",Wi);class mr extends P{}class Tr extends P{}class _n extends P{}class Bn extends N{}class lr extends W{}class Ma extends H{}class jn extends G{}class Sl extends K{}class Vo extends se{}class ln extends oe{}class vn extends le{}class Ur extends Me{}class cn extends Te{}class Pr extends bt{}const Kr=w([{name:"a_pos",components:2,type:"Int16"}],4),{members:hn}=Kr;class Ri{constructor(t=[]){this.segments=t}prepareSegment(t,n,l,m){let v=this.segments[this.segments.length-1];return t>Ri.MAX_VERTEX_ARRAY_LENGTH&&Ne(`Max vertices per segment is ${Ri.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!v||v.vertexLength+t>Ri.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==m)&&(v={vertexOffset:n.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},m!==void 0&&(v.sortKey=m),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,l,m){return new Ri([{vertexOffset:t,primitiveOffset:n,vertexLength:l,primitiveLength:m,vaos:{},sortKey:0}])}}function js(i,t){return 256*(i=Je(Math.floor(i),0,255))+Je(Math.floor(t),0,255)}Ri.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Vt("SegmentVector",Ri);const za=w([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var sa={exports:{}},Uo={exports:{}};Uo.exports=function(i,t){var n,l,m,v,x,I,T,z;for(l=i.length-(n=3&i.length),m=t,x=3432918353,I=461845907,z=0;z<l;)T=255&i.charCodeAt(z)|(255&i.charCodeAt(++z))<<8|(255&i.charCodeAt(++z))<<16|(255&i.charCodeAt(++z))<<24,++z,m=27492+(65535&(v=5*(65535&(m=(m^=T=(65535&(T=(T=(65535&T)*x+(((T>>>16)*x&65535)<<16)&4294967295)<<15|T>>>17))*I+(((T>>>16)*I&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(T=0,n){case 3:T^=(255&i.charCodeAt(z+2))<<16;case 2:T^=(255&i.charCodeAt(z+1))<<8;case 1:m^=T=(65535&(T=(T=(65535&(T^=255&i.charCodeAt(z)))*x+(((T>>>16)*x&65535)<<16)&4294967295)<<15|T>>>17))*I+(((T>>>16)*I&65535)<<16)&4294967295}return m^=i.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0};var Ah=Uo.exports,qc={exports:{}};qc.exports=function(i,t){for(var n,l=i.length,m=t^l,v=0;l>=4;)n=1540483477*(65535&(n=255&i.charCodeAt(v)|(255&i.charCodeAt(++v))<<8|(255&i.charCodeAt(++v))<<16|(255&i.charCodeAt(++v))<<24))+((1540483477*(n>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),l-=4,++v;switch(l){case 3:m^=(255&i.charCodeAt(v+2))<<16;case 2:m^=(255&i.charCodeAt(v+1))<<8;case 1:m=1540483477*(65535&(m^=255&i.charCodeAt(v)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};var qs=Ah,aa=qc.exports;sa.exports=qs,sa.exports.murmur3=qs,sa.exports.murmur2=aa;var Zl=C(sa.exports);class Al{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,l,m){this.ids.push(Gl(t)),this.positions.push(n,l,m)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Gl(t);let l=0,m=this.ids.length-1;for(;l<m;){const x=l+m>>1;this.ids[x]>=n?m=x:l=x+1}const v=[];for(;this.ids[l]===n;)v.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return v}static serialize(t,n){const l=new Float64Array(t.ids),m=new Uint32Array(t.positions);return Il(l,m,0,l.length-1),n&&n.push(l.buffer,m.buffer),{ids:l,positions:m}}static deserialize(t){const n=new Al;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function Gl(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Zl(String(i))}function Il(i,t,n,l){for(;n<l;){const m=i[n+l>>1];let v=n-1,x=l+1;for(;;){do v++;while(i[v]<m);do x--;while(i[x]>m);if(v>=x)break;oa(i,v,x),oa(t,3*v,3*x),oa(t,3*v+1,3*x+1),oa(t,3*v+2,3*x+2)}x-n<l-x?(Il(i,t,n,x),n=x+1):(Il(i,t,x+1,l),l=x)}}function oa(i,t,n){const l=i[t];i[t]=i[n],i[n]=l}Vt("FeaturePositionMap",Al);class $o{constructor(t,n){this.gl=t.gl,this.location=n}}class vc extends $o{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class bc extends $o{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Vc extends $o{constructor(t,n){super(t,n),this.current=$i.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const xc=new Float32Array(16);function Uc(i){return[js(255*i.r,255*i.g),js(255*i.b,255*i.a)]}class wc{constructor(t,n,l){this.value=t,this.uniformNames=n.map(m=>`u_${m}`),this.type=l}setUniform(t,n,l){t.set(l.constantOr(this.value))}getBinding(t,n,l){return this.type==="color"?new Vc(t,n):new vc(t,n)}}class ro{constructor(t,n){this.uniformNames=n.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,l,m){const v=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&t.set(v)}getBinding(t,n,l){return l.substr(0,9)==="u_pattern"?new bc(t,n):new vc(t,n)}}class Na{constructor(t,n,l,m){this.expression=t,this.type=l,this.maxValue=0,this.paintVertexAttributes=n.map(v=>({name:`a_${v}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,n,l,m,v){const x=this.paintVertexArray.length,I=this.expression.evaluate(new Qi(0),n,{},m,[],v);this.paintVertexArray.resize(t),this._setPaintValue(x,t,I)}updatePaintArray(t,n,l,m){const v=this.expression.evaluate({zoom:0},l,m);this._setPaintValue(t,n,v)}_setPaintValue(t,n,l){if(this.type==="color"){const m=Uc(l);for(let v=t;v<n;v++)this.paintVertexArray.emplace(v,m[0],m[1])}else{for(let m=t;m<n;m++)this.paintVertexArray.emplace(m,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ws{constructor(t,n,l,m,v,x){this.expression=t,this.uniformNames=n.map(I=>`u_${I}_t`),this.type=l,this.useIntegerZoom=m,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=n.map(I=>({name:`a_${I}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(t,n,l,m,v){const x=this.expression.evaluate(new Qi(this.zoom),n,{},m,[],v),I=this.expression.evaluate(new Qi(this.zoom+1),n,{},m,[],v),T=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(T,t,x,I)}updatePaintArray(t,n,l,m){const v=this.expression.evaluate({zoom:this.zoom},l,m),x=this.expression.evaluate({zoom:this.zoom+1},l,m);this._setPaintValue(t,n,v,x)}_setPaintValue(t,n,l,m){if(this.type==="color"){const v=Uc(l),x=Uc(m);for(let I=t;I<n;I++)this.paintVertexArray.emplace(I,v[0],v[1],x[0],x[1])}else{for(let v=t;v<n;v++)this.paintVertexArray.emplace(v,l,m);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(m))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const l=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,m=Je(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);t.set(m)}getBinding(t,n,l){return new vc(t,n)}}class qn{constructor(t,n,l,m,v,x){this.expression=t,this.type=n,this.useIntegerZoom=l,this.zoom=m,this.layerId=x,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(t,n,l){const m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(m,t,n.patterns&&n.patterns[this.layerId],l)}updatePaintArray(t,n,l,m,v){this._setPaintValues(t,n,l.patterns&&l.patterns[this.layerId],v)}_setPaintValues(t,n,l,m){if(!m||!l)return;const{min:v,mid:x,max:I}=l,T=m[v],z=m[x],j=m[I];if(T&&z&&j)for(let Z=t;Z<n;Z++)this.zoomInPaintVertexArray.emplace(Z,z.tl[0],z.tl[1],z.br[0],z.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],z.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(Z,z.tl[0],z.tl[1],z.br[0],z.br[1],j.tl[0],j.tl[1],j.br[0],j.br[1],z.pixelRatio,j.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,za.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,za.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ih{constructor(t,n,l){this.binders={},this._buffers=[];const m=[];for(const v in t.paint._values){if(!l(v))continue;const x=t.paint.get(v);if(!(x instanceof xs&&ms(x.property.specification)))continue;const I=id(v,t.type),T=x.value,z=x.property.specification.type,j=x.property.useIntegerZoom,Z=x.property.specification["property-type"],X=Z==="cross-faded"||Z==="cross-faded-data-driven";if(T.kind==="constant")this.binders[v]=X?new ro(T.value,I):new wc(T.value,I,z),m.push(`/u_${v}`);else if(T.kind==="source"||X){const J=Ph(v,z,"source");this.binders[v]=X?new qn(T,z,j,n,J,t.id):new Na(T,I,z,J),m.push(`/a_${v}`)}else{const J=Ph(v,z,"composite");this.binders[v]=new ws(T,I,z,j,n,J),m.push(`/z_${v}`)}}this.cacheKey=m.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof Na||n instanceof ws?n.maxValue:0}populatePaintArrays(t,n,l,m,v){for(const x in this.binders){const I=this.binders[x];(I instanceof Na||I instanceof ws||I instanceof qn)&&I.populatePaintArray(t,n,l,m,v)}}setConstantPatternPositions(t,n){for(const l in this.binders){const m=this.binders[l];m instanceof ro&&m.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,l,m,v){let x=!1;for(const I in t){const T=n.getPositions(I);for(const z of T){const j=l.feature(z.index);for(const Z in this.binders){const X=this.binders[Z];if((X instanceof Na||X instanceof ws||X instanceof qn)&&X.expression.isStateDependent===!0){const J=m.paint.get(Z);X.expression=J.value,X.updatePaintArray(z.start,z.end,j,t[I],v),x=!0}}}}return x}defines(){const t=[];for(const n in this.binders){const l=this.binders[n];(l instanceof wc||l instanceof ro)&&t.push(...l.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof Na||l instanceof ws)for(let m=0;m<l.paintVertexAttributes.length;m++)t.push(l.paintVertexAttributes[m].name);else if(l instanceof qn)for(let m=0;m<za.members.length;m++)t.push(za.members[m].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof wc||l instanceof ro||l instanceof ws)for(const m of l.uniformNames)t.push(m)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const l=[];for(const m in this.binders){const v=this.binders[m];if(v instanceof wc||v instanceof ro||v instanceof ws){for(const x of v.uniformNames)if(n[x]){const I=v.getBinding(t,n[x],x);l.push({name:x,property:m,binding:I})}}}return l}setUniforms(t,n,l,m){for(const{name:v,property:x,binding:I}of n)this.binders[x].setUniform(I,m,l.get(x),v)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const l=this.binders[n];if(t&&l instanceof qn){const m=t.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(l instanceof Na||l instanceof ws)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(t){for(const n in this.binders){const l=this.binders[n];(l instanceof Na||l instanceof ws||l instanceof qn)&&l.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof Na||n instanceof ws||n instanceof qn)&&n.destroy()}}}class Zo{constructor(t,n,l=()=>!0){this.programConfigurations={};for(const m of t)this.programConfigurations[m.id]=new Ih(m,n,l);this.needsUpload=!1,this._featureMap=new Al,this._bufferOffset=0}populatePaintArrays(t,n,l,m,v,x){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(t,n,m,v,x);n.id!==void 0&&this._featureMap.add(n.id,l,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,l,m){for(const v of l)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(t,this._featureMap,n,v,m)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function id(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function Ph(i,t,n){const l={color:{source:H,composite:Gt},number:{source:vt,composite:H}},m=function(v){return{"line-pattern":{source:jn,composite:jn},"fill-pattern":{source:jn,composite:jn},"fill-extrusion-pattern":{source:jn,composite:jn}}[v]}(i);return m&&m[n]||l[t][n]}Vt("ConstantBinder",wc),Vt("CrossFadedConstantBinder",ro),Vt("SourceExpressionBinder",Na),Vt("CrossFadedCompositeBinder",qn),Vt("CompositeExpressionBinder",ws),Vt("ProgramConfiguration",Ih,{omit:["_buffers"]}),Vt("ProgramConfigurationSet",Zo);const cr=8192,Lh=Math.pow(2,14)-1,kh=-Lh-1;function Pl(i){const t=cr/i.extent,n=i.loadGeometry();for(let l=0;l<n.length;l++){const m=n[l];for(let v=0;v<m.length;v++){const x=m[v],I=Math.round(x.x*t),T=Math.round(x.y*t);x.x=Je(I,kh,Lh),x.y=Je(T,kh,Lh),(I<x.x||I>x.x+1||T<x.y||T>x.y+1)&&Ne("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Go(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?Pl(i):[]}}function $c(i,t,n,l,m){i.emplaceBack(2*t+(l+1)/2,2*n+(m+1)/2)}class Ll{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Tr,this.indexArray=new cn,this.segments=new Ri,this.programConfigurations=new Zo(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,l){const m=this.layers[0],v=[];let x=null,I=!1;m.type==="circle"&&(x=m.layout.get("circle-sort-key"),I=!x.isConstant());for(const{feature:T,id:z,index:j,sourceLayerIndex:Z}of t){const X=this.layers[0]._featureFilter.needGeometry,J=Go(T,X);if(!this.layers[0]._featureFilter.filter(new Qi(this.zoom),J,l))continue;const re=I?x.evaluate(J,{},l):void 0,ce={id:z,properties:T.properties,type:T.type,sourceLayerIndex:Z,index:j,geometry:X?J.geometry:Pl(T),patterns:{},sortKey:re};v.push(ce)}I&&v.sort((T,z)=>T.sortKey-z.sortKey);for(const T of v){const{geometry:z,index:j,sourceLayerIndex:Z}=T,X=t[j].feature;this.addFeature(T,z,j,l),n.featureIndex.insert(X,z,j,Z,this.index)}}update(t,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,l,m){for(const v of n)for(const x of v){const I=x.x,T=x.y;if(I<0||I>=cr||T<0||T>=cr)continue;const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),j=z.vertexLength;$c(this.layoutVertexArray,I,T,-1,-1),$c(this.layoutVertexArray,I,T,1,-1),$c(this.layoutVertexArray,I,T,1,1),$c(this.layoutVertexArray,I,T,-1,1),this.indexArray.emplaceBack(j,j+1,j+2),this.indexArray.emplaceBack(j,j+3,j+2),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{},m)}}function Zc(i,t){for(let n=0;n<i.length;n++)if(Ho(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(Ho(i,t[n]))return!0;return!!Fa(i,t)}function Gc(i,t,n){return!!Ho(i,t)||!!Sc(t,i,n)}function Da(i,t){if(i.length===1)return hu(t,i[0]);for(let n=0;n<t.length;n++){const l=t[n];for(let m=0;m<l.length;m++)if(Ho(i,l[m]))return!0}for(let n=0;n<i.length;n++)if(hu(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(Fa(i,t[n]))return!0;return!1}function Wo(i,t,n){if(i.length>1){if(Fa(i,t))return!0;for(let l=0;l<t.length;l++)if(Sc(t[l],i,n))return!0}for(let l=0;l<i.length;l++)if(Sc(i[l],t,n))return!0;return!1}function Fa(i,t){if(i.length===0||t.length===0)return!1;for(let n=0;n<i.length-1;n++){const l=i[n],m=i[n+1];for(let v=0;v<t.length-1;v++)if(Wc(l,m,t[v],t[v+1]))return!0}return!1}function Wc(i,t,n,l){return Le(i,n,l)!==Le(t,n,l)&&Le(i,t,n)!==Le(i,t,l)}function Sc(i,t,n){const l=n*n;if(t.length===1)return i.distSqr(t[0])<l;for(let m=1;m<t.length;m++)if(Th(i,t[m-1],t[m])<l)return!0;return!1}function Th(i,t,n){const l=t.distSqr(n);if(l===0)return i.distSqr(t);const m=((i.x-t.x)*(n.x-t.x)+(i.y-t.y)*(n.y-t.y))/l;return i.distSqr(m<0?t:m>1?n:n.sub(t)._mult(m)._add(t))}function hu(i,t){let n,l,m,v=!1;for(let x=0;x<i.length;x++){n=i[x];for(let I=0,T=n.length-1;I<n.length;T=I++)l=n[I],m=n[T],l.y>t.y!=m.y>t.y&&t.x<(m.x-l.x)*(t.y-l.y)/(m.y-l.y)+l.x&&(v=!v)}return v}function Ho(i,t){let n=!1;for(let l=0,m=i.length-1;l<i.length;m=l++){const v=i[l],x=i[m];v.y>t.y!=x.y>t.y&&t.x<(x.x-v.x)*(t.y-v.y)/(x.y-v.y)+v.x&&(n=!n)}return n}function Ch(i,t,n){const l=n[0],m=n[2];if(i.x<l.x&&t.x<l.x||i.x>m.x&&t.x>m.x||i.y<l.y&&t.y<l.y||i.y>m.y&&t.y>m.y)return!1;const v=Le(i,t,n[0]);return v!==Le(i,t,n[1])||v!==Le(i,t,n[2])||v!==Le(i,t,n[3])}function Eh(i,t,n){const l=t.paint.get(i).value;return l.kind==="constant"?l.value:n.programConfigurations.get(t.id).getMaxValue(i)}function uu(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function du(i,t,n,l,m){if(!t[0]&&!t[1])return i;const v=O.convert(t)._mult(m);n==="viewport"&&v._rotate(-l);const x=[];for(let I=0;I<i.length;I++)x.push(i[I].sub(v));return x}let Yp,Jp;Vt("CircleBucket",Ll,{omit:["layers"]});var f1={get paint(){return Jp=Jp||new c({"circle-radius":new hi(te.paint_circle["circle-radius"]),"circle-color":new hi(te.paint_circle["circle-color"]),"circle-blur":new hi(te.paint_circle["circle-blur"]),"circle-opacity":new hi(te.paint_circle["circle-opacity"]),"circle-translate":new Wt(te.paint_circle["circle-translate"]),"circle-translate-anchor":new Wt(te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Wt(te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Wt(te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new hi(te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new hi(te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new hi(te.paint_circle["circle-stroke-opacity"])})},get layout(){return Yp=Yp||new c({"circle-sort-key":new hi(te.layout_circle["circle-sort-key"])})}},Yn=1e-6,Hc=typeof Float32Array<"u"?Float32Array:Array;function rd(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Qp(i,t,n){var l=t[0],m=t[1],v=t[2],x=t[3],I=t[4],T=t[5],z=t[6],j=t[7],Z=t[8],X=t[9],J=t[10],re=t[11],ce=t[12],Ae=t[13],Ce=t[14],Ze=t[15],Oe=n[0],Ue=n[1],ot=n[2],It=n[3];return i[0]=Oe*l+Ue*I+ot*Z+It*ce,i[1]=Oe*m+Ue*T+ot*X+It*Ae,i[2]=Oe*v+Ue*z+ot*J+It*Ce,i[3]=Oe*x+Ue*j+ot*re+It*Ze,i[4]=(Oe=n[4])*l+(Ue=n[5])*I+(ot=n[6])*Z+(It=n[7])*ce,i[5]=Oe*m+Ue*T+ot*X+It*Ae,i[6]=Oe*v+Ue*z+ot*J+It*Ce,i[7]=Oe*x+Ue*j+ot*re+It*Ze,i[8]=(Oe=n[8])*l+(Ue=n[9])*I+(ot=n[10])*Z+(It=n[11])*ce,i[9]=Oe*m+Ue*T+ot*X+It*Ae,i[10]=Oe*v+Ue*z+ot*J+It*Ce,i[11]=Oe*x+Ue*j+ot*re+It*Ze,i[12]=(Oe=n[12])*l+(Ue=n[13])*I+(ot=n[14])*Z+(It=n[15])*ce,i[13]=Oe*m+Ue*T+ot*X+It*Ae,i[14]=Oe*v+Ue*z+ot*J+It*Ce,i[15]=Oe*x+Ue*j+ot*re+It*Ze,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var Mh,m1=Qp;function pu(i,t,n){var l=t[0],m=t[1],v=t[2],x=t[3];return i[0]=n[0]*l+n[4]*m+n[8]*v+n[12]*x,i[1]=n[1]*l+n[5]*m+n[9]*v+n[13]*x,i[2]=n[2]*l+n[6]*m+n[10]*v+n[14]*x,i[3]=n[3]*l+n[7]*m+n[11]*v+n[15]*x,i}Mh=new Hc(4),Hc!=Float32Array&&(Mh[0]=0,Mh[1]=0,Mh[2]=0,Mh[3]=0);class g1 extends r{constructor(t){super(t,f1)}createBucket(t){return new Ll(t)}queryRadius(t){const n=t;return Eh("circle-radius",this,n)+Eh("circle-stroke-width",this,n)+uu(this.paint.get("circle-translate"))}queryIntersectsFeature(t,n,l,m,v,x,I,T){const z=du(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,I),j=this.paint.get("circle-radius").evaluate(n,l)+this.paint.get("circle-stroke-width").evaluate(n,l),Z=this.paint.get("circle-pitch-alignment")==="map",X=Z?z:function(re,ce){return re.map(Ae=>ef(Ae,ce))}(z,T),J=Z?j*I:j;for(const re of m)for(const ce of re){const Ae=Z?ce:ef(ce,T);let Ce=J;const Ze=pu([],[ce.x,ce.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ce*=Ze[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ce*=x.cameraToCenterDistance/Ze[3]),Gc(X,Ae,Ce))return!0}return!1}}function ef(i,t){const n=pu([],[i.x,i.y,0,1],t);return new O(n[0]/n[3],n[1]/n[3])}class tf extends Ll{}let rf;Vt("HeatmapBucket",tf,{omit:["layers"]});var y1={get paint(){return rf=rf||new c({"heatmap-radius":new hi(te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new hi(te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Wt(te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new A(te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Wt(te.paint_heatmap["heatmap-opacity"])})}};function nd(i,{width:t,height:n},l,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==t*n*l)throw new RangeError(`mismatched image size. expected: ${m.length} but got: ${t*n*l}`)}else m=new Uint8Array(t*n*l);return i.width=t,i.height=n,i.data=m,i}function nf(i,{width:t,height:n},l){if(t===i.width&&n===i.height)return;const m=nd({},{width:t,height:n},l);sd(i,m,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,n)},l),i.width=t,i.height=n,i.data=m.data}function sd(i,t,n,l,m,v){if(m.width===0||m.height===0)return t;if(m.width>i.width||m.height>i.height||n.x>i.width-m.width||n.y>i.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>t.width||m.height>t.height||l.x>t.width-m.width||l.y>t.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const x=i.data,I=t.data;if(x===I)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<m.height;T++){const z=((n.y+T)*i.width+n.x)*v,j=((l.y+T)*t.width+l.x)*v;for(let Z=0;Z<m.width*v;Z++)I[j+Z]=x[z+Z]}return t}class zh{constructor(t,n){nd(this,t,1,n)}resize(t){nf(this,t,1)}clone(){return new zh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,l,m,v){sd(t,n,l,m,v,1)}}class la{constructor(t,n){nd(this,t,4,n)}resize(t){nf(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new la({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,l,m,v){sd(t,n,l,m,v,4)}}function sf(i){const t={},n=i.resolution||256,l=i.clips?i.clips.length:1,m=i.image||new la({width:n,height:l});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const v=(x,I,T)=>{t[i.evaluationKey]=T;const z=i.expression.evaluate(t);m.data[x+I+0]=Math.floor(255*z.r/z.a),m.data[x+I+1]=Math.floor(255*z.g/z.a),m.data[x+I+2]=Math.floor(255*z.b/z.a),m.data[x+I+3]=Math.floor(255*z.a)};if(i.clips)for(let x=0,I=0;x<l;++x,I+=4*n)for(let T=0,z=0;T<n;T++,z+=4){const j=T/(n-1),{start:Z,end:X}=i.clips[x];v(I,z,Z*(1-j)+X*j)}else for(let x=0,I=0;x<n;x++,I+=4)v(0,I,x/(n-1));return m}Vt("AlphaImage",zh),Vt("RGBAImage",la);const ad="big-fb";class _1 extends r{createBucket(t){return new tf(t)}constructor(t){super(t,y1),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=sf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(ad)&&this.heatmapFbos.delete(ad)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let af;var v1={get paint(){return af=af||new c({"hillshade-illumination-direction":new Wt(te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Wt(te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Wt(te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Wt(te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Wt(te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Wt(te.paint_hillshade["hillshade-accent-color"])})}};class b1 extends r{constructor(t){super(t,v1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const x1=w([{name:"a_pos",components:2,type:"Int16"}],4),{members:w1}=x1;function of(i,t,n=2){const l=t&&t.length,m=l?t[0]*n:i.length;let v=lf(i,0,m,n,!0);const x=[];if(!v||v.next===v.prev)return x;let I,T,z;if(l&&(v=function(j,Z,X,J){const re=[];for(let ce=0,Ae=Z.length;ce<Ae;ce++){const Ce=lf(j,Z[ce]*J,ce<Ae-1?Z[ce+1]*J:j.length,J,!1);Ce===Ce.next&&(Ce.steiner=!0),re.push(C1(Ce))}re.sort(L1);for(let ce=0;ce<re.length;ce++)X=k1(re[ce],X);return X}(i,t,v,n)),i.length>80*n){I=1/0,T=1/0;let j=-1/0,Z=-1/0;for(let X=n;X<m;X+=n){const J=i[X],re=i[X+1];J<I&&(I=J),re<T&&(T=re),J>j&&(j=J),re>Z&&(Z=re)}z=Math.max(j-I,Z-T),z=z!==0?32767/z:0}return Nh(v,x,n,I,T,z,0),x}function lf(i,t,n,l,m){let v;if(m===function(x,I,T,z){let j=0;for(let Z=I,X=T-z;Z<T;Z+=z)j+=(x[X]-x[Z])*(x[Z+1]+x[X+1]),X=Z;return j}(i,t,n,l)>0)for(let x=t;x<n;x+=l)v=uf(x/l|0,i[x],i[x+1],v);else for(let x=n-l;x>=t;x-=l)v=uf(x/l|0,i[x],i[x+1],v);return v&&fu(v,v.next)&&(Fh(v),v=v.next),v}function Ac(i,t){if(!i)return i;t||(t=i);let n,l=i;do if(n=!1,l.steiner||!fu(l,l.next)&&Br(l.prev,l,l.next)!==0)l=l.next;else{if(Fh(l),l=t=l.prev,l===l.next)break;n=!0}while(n||l!==t);return t}function Nh(i,t,n,l,m,v,x){if(!i)return;!x&&v&&function(T,z,j,Z){let X=T;do X.z===0&&(X.z=od(X.x,X.y,z,j,Z)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==T);X.prevZ.nextZ=null,X.prevZ=null,function(J){let re,ce=1;do{let Ae,Ce=J;J=null;let Ze=null;for(re=0;Ce;){re++;let Oe=Ce,Ue=0;for(let It=0;It<ce&&(Ue++,Oe=Oe.nextZ,Oe);It++);let ot=ce;for(;Ue>0||ot>0&&Oe;)Ue!==0&&(ot===0||!Oe||Ce.z<=Oe.z)?(Ae=Ce,Ce=Ce.nextZ,Ue--):(Ae=Oe,Oe=Oe.nextZ,ot--),Ze?Ze.nextZ=Ae:J=Ae,Ae.prevZ=Ze,Ze=Ae;Ce=Oe}Ze.nextZ=null,ce*=2}while(re>1)}(X)}(i,l,m,v);let I=i;for(;i.prev!==i.next;){const T=i.prev,z=i.next;if(v?A1(i,l,m,v):S1(i))t.push(T.i,i.i,z.i),Fh(i),i=z.next,I=z.next;else if((i=z)===I){x?x===1?Nh(i=I1(Ac(i),t),t,n,l,m,v,2):x===2&&P1(i,t,n,l,m,v):Nh(Ac(i),t,n,l,m,v,1);break}}}function S1(i){const t=i.prev,n=i,l=i.next;if(Br(t,n,l)>=0)return!1;const m=t.x,v=n.x,x=l.x,I=t.y,T=n.y,z=l.y,j=m<v?m<x?m:x:v<x?v:x,Z=I<T?I<z?I:z:T<z?T:z,X=m>v?m>x?m:x:v>x?v:x,J=I>T?I>z?I:z:T>z?T:z;let re=l.next;for(;re!==t;){if(re.x>=j&&re.x<=X&&re.y>=Z&&re.y<=J&&Xc(m,I,v,T,x,z,re.x,re.y)&&Br(re.prev,re,re.next)>=0)return!1;re=re.next}return!0}function A1(i,t,n,l){const m=i.prev,v=i,x=i.next;if(Br(m,v,x)>=0)return!1;const I=m.x,T=v.x,z=x.x,j=m.y,Z=v.y,X=x.y,J=I<T?I<z?I:z:T<z?T:z,re=j<Z?j<X?j:X:Z<X?Z:X,ce=I>T?I>z?I:z:T>z?T:z,Ae=j>Z?j>X?j:X:Z>X?Z:X,Ce=od(J,re,t,n,l),Ze=od(ce,Ae,t,n,l);let Oe=i.prevZ,Ue=i.nextZ;for(;Oe&&Oe.z>=Ce&&Ue&&Ue.z<=Ze;){if(Oe.x>=J&&Oe.x<=ce&&Oe.y>=re&&Oe.y<=Ae&&Oe!==m&&Oe!==x&&Xc(I,j,T,Z,z,X,Oe.x,Oe.y)&&Br(Oe.prev,Oe,Oe.next)>=0||(Oe=Oe.prevZ,Ue.x>=J&&Ue.x<=ce&&Ue.y>=re&&Ue.y<=Ae&&Ue!==m&&Ue!==x&&Xc(I,j,T,Z,z,X,Ue.x,Ue.y)&&Br(Ue.prev,Ue,Ue.next)>=0))return!1;Ue=Ue.nextZ}for(;Oe&&Oe.z>=Ce;){if(Oe.x>=J&&Oe.x<=ce&&Oe.y>=re&&Oe.y<=Ae&&Oe!==m&&Oe!==x&&Xc(I,j,T,Z,z,X,Oe.x,Oe.y)&&Br(Oe.prev,Oe,Oe.next)>=0)return!1;Oe=Oe.prevZ}for(;Ue&&Ue.z<=Ze;){if(Ue.x>=J&&Ue.x<=ce&&Ue.y>=re&&Ue.y<=Ae&&Ue!==m&&Ue!==x&&Xc(I,j,T,Z,z,X,Ue.x,Ue.y)&&Br(Ue.prev,Ue,Ue.next)>=0)return!1;Ue=Ue.nextZ}return!0}function I1(i,t){let n=i;do{const l=n.prev,m=n.next.next;!fu(l,m)&&cf(l,n,n.next,m)&&Dh(l,m)&&Dh(m,l)&&(t.push(l.i,n.i,m.i),Fh(n),Fh(n.next),n=i=m),n=n.next}while(n!==i);return Ac(n)}function P1(i,t,n,l,m,v){let x=i;do{let I=x.next.next;for(;I!==x.prev;){if(x.i!==I.i&&E1(x,I)){let T=hf(x,I);return x=Ac(x,x.next),T=Ac(T,T.next),Nh(x,t,n,l,m,v,0),void Nh(T,t,n,l,m,v,0)}I=I.next}x=x.next}while(x!==i)}function L1(i,t){return i.x-t.x}function k1(i,t){const n=function(m,v){let x=v;const I=m.x,T=m.y;let z,j=-1/0;do{if(T<=x.y&&T>=x.next.y&&x.next.y!==x.y){const ce=x.x+(T-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(ce<=I&&ce>j&&(j=ce,z=x.x<x.next.x?x:x.next,ce===I))return z}x=x.next}while(x!==v);if(!z)return null;const Z=z,X=z.x,J=z.y;let re=1/0;x=z;do{if(I>=x.x&&x.x>=X&&I!==x.x&&Xc(T<J?I:j,T,X,J,T<J?j:I,T,x.x,x.y)){const ce=Math.abs(T-x.y)/(I-x.x);Dh(x,m)&&(ce<re||ce===re&&(x.x>z.x||x.x===z.x&&T1(z,x)))&&(z=x,re=ce)}x=x.next}while(x!==Z);return z}(i,t);if(!n)return t;const l=hf(n,i);return Ac(l,l.next),Ac(n,n.next)}function T1(i,t){return Br(i.prev,i,t.prev)<0&&Br(t.next,i,i.next)<0}function od(i,t,n,l,m){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*m|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-l)*m|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function C1(i){let t=i,n=i;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==i);return n}function Xc(i,t,n,l,m,v,x,I){return(m-x)*(t-I)>=(i-x)*(v-I)&&(i-x)*(l-I)>=(n-x)*(t-I)&&(n-x)*(v-I)>=(m-x)*(l-I)}function E1(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(n,l){let m=n;do{if(m.i!==n.i&&m.next.i!==n.i&&m.i!==l.i&&m.next.i!==l.i&&cf(m,m.next,n,l))return!0;m=m.next}while(m!==n);return!1}(i,t)&&(Dh(i,t)&&Dh(t,i)&&function(n,l){let m=n,v=!1;const x=(n.x+l.x)/2,I=(n.y+l.y)/2;do m.y>I!=m.next.y>I&&m.next.y!==m.y&&x<(m.next.x-m.x)*(I-m.y)/(m.next.y-m.y)+m.x&&(v=!v),m=m.next;while(m!==n);return v}(i,t)&&(Br(i.prev,i,t.prev)||Br(i,t.prev,t))||fu(i,t)&&Br(i.prev,i,i.next)>0&&Br(t.prev,t,t.next)>0)}function Br(i,t,n){return(t.y-i.y)*(n.x-t.x)-(t.x-i.x)*(n.y-t.y)}function fu(i,t){return i.x===t.x&&i.y===t.y}function cf(i,t,n,l){const m=gu(Br(i,t,n)),v=gu(Br(i,t,l)),x=gu(Br(n,l,i)),I=gu(Br(n,l,t));return m!==v&&x!==I||!(m!==0||!mu(i,n,t))||!(v!==0||!mu(i,l,t))||!(x!==0||!mu(n,i,l))||!(I!==0||!mu(n,t,l))}function mu(i,t,n){return t.x<=Math.max(i.x,n.x)&&t.x>=Math.min(i.x,n.x)&&t.y<=Math.max(i.y,n.y)&&t.y>=Math.min(i.y,n.y)}function gu(i){return i>0?1:i<0?-1:0}function Dh(i,t){return Br(i.prev,i,i.next)<0?Br(i,t,i.next)>=0&&Br(i,i.prev,t)>=0:Br(i,t,i.prev)<0||Br(i,i.next,t)<0}function hf(i,t){const n=ld(i.i,i.x,i.y),l=ld(t.i,t.x,t.y),m=i.next,v=t.prev;return i.next=t,t.prev=i,n.next=m,m.prev=n,l.next=n,n.prev=l,v.next=l,l.prev=v,l}function uf(i,t,n,l){const m=ld(i,t,n);return l?(m.next=l.next,m.prev=l,l.next.prev=m,l.next=m):(m.prev=m,m.next=m),m}function Fh(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function ld(i,t,n){return{i,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function cd(i,t,n){const l=n.patternDependencies;let m=!1;for(const v of t){const x=v.paint.get(`${i}-pattern`);x.isConstant()||(m=!0);const I=x.constantOr(null);I&&(m=!0,l[I.to]=!0,l[I.from]=!0)}return m}function hd(i,t,n,l,m){const v=m.patternDependencies;for(const x of t){const I=x.paint.get(`${i}-pattern`).value;if(I.kind!=="constant"){let T=I.evaluate({zoom:l-1},n,{},m.availableImages),z=I.evaluate({zoom:l},n,{},m.availableImages),j=I.evaluate({zoom:l+1},n,{},m.availableImages);T=T&&T.name?T.name:T,z=z&&z.name?z.name:z,j=j&&j.name?j.name:j,v[T]=!0,v[z]=!0,v[j]=!0,n.patterns[x.id]={min:T,mid:z,max:j}}}return n}class ud{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new _n,this.indexArray=new cn,this.indexArray2=new Pr,this.programConfigurations=new Zo(t.layers,t.zoom),this.segments=new Ri,this.segments2=new Ri,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,l){this.hasPattern=cd("fill",this.layers,n);const m=this.layers[0].layout.get("fill-sort-key"),v=!m.isConstant(),x=[];for(const{feature:I,id:T,index:z,sourceLayerIndex:j}of t){const Z=this.layers[0]._featureFilter.needGeometry,X=Go(I,Z);if(!this.layers[0]._featureFilter.filter(new Qi(this.zoom),X,l))continue;const J=v?m.evaluate(X,{},l,n.availableImages):void 0,re={id:T,properties:I.properties,type:I.type,sourceLayerIndex:j,index:z,geometry:Z?X.geometry:Pl(I),patterns:{},sortKey:J};x.push(re)}v&&x.sort((I,T)=>I.sortKey-T.sortKey);for(const I of x){const{geometry:T,index:z,sourceLayerIndex:j}=I;if(this.hasPattern){const Z=hd("fill",this.layers,I,this.zoom,n);this.patternFeatures.push(Z)}else this.addFeature(I,T,z,l,{});n.featureIndex.insert(t[z].feature,T,z,j,this.index)}}update(t,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,l)}addFeatures(t,n,l){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,n,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,w1),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,l,m,v){for(const x of Ts(n,500)){let I=0;for(const J of x)I+=J.length;const T=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),z=T.vertexLength,j=[],Z=[];for(const J of x){if(J.length===0)continue;J!==x[0]&&Z.push(j.length/2);const re=this.segments2.prepareSegment(J.length,this.layoutVertexArray,this.indexArray2),ce=re.vertexLength;this.layoutVertexArray.emplaceBack(J[0].x,J[0].y),this.indexArray2.emplaceBack(ce+J.length-1,ce),j.push(J[0].x),j.push(J[0].y);for(let Ae=1;Ae<J.length;Ae++)this.layoutVertexArray.emplaceBack(J[Ae].x,J[Ae].y),this.indexArray2.emplaceBack(ce+Ae-1,ce+Ae),j.push(J[Ae].x),j.push(J[Ae].y);re.vertexLength+=J.length,re.primitiveLength+=J.length}const X=of(j,Z);for(let J=0;J<X.length;J+=3)this.indexArray.emplaceBack(z+X[J],z+X[J+1],z+X[J+2]);T.vertexLength+=I,T.primitiveLength+=X.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,v,m)}}let df,pf;Vt("FillBucket",ud,{omit:["layers","patternFeatures"]});var M1={get paint(){return pf=pf||new c({"fill-antialias":new Wt(te.paint_fill["fill-antialias"]),"fill-opacity":new hi(te.paint_fill["fill-opacity"]),"fill-color":new hi(te.paint_fill["fill-color"]),"fill-outline-color":new hi(te.paint_fill["fill-outline-color"]),"fill-translate":new Wt(te.paint_fill["fill-translate"]),"fill-translate-anchor":new Wt(te.paint_fill["fill-translate-anchor"]),"fill-pattern":new wl(te.paint_fill["fill-pattern"])})},get layout(){return df=df||new c({"fill-sort-key":new hi(te.layout_fill["fill-sort-key"])})}};class z1 extends r{constructor(t){super(t,M1)}recalculate(t,n){super.recalculate(t,n);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new ud(t)}queryRadius(){return uu(this.paint.get("fill-translate"))}queryIntersectsFeature(t,n,l,m,v,x,I){return Da(du(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,I),m)}isTileClipped(){return!0}}const N1=w([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),D1=w([{name:"a_centroid",components:2,type:"Int16"}],4),{members:F1}=N1;var Wl={},R1=F,ff=Kc;function Kc(i,t,n,l,m){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=l,this._values=m,i.readFields(O1,this,t)}function O1(i,t,n){i==1?t.id=n.readVarint():i==2?function(l,m){for(var v=l.readVarint()+l.pos;l.pos<v;){var x=m._keys[l.readVarint()],I=m._values[l.readVarint()];m.properties[x]=I}}(n,t):i==3?t.type=n.readVarint():i==4&&(t._geometry=n.pos)}function B1(i){for(var t,n,l=0,m=0,v=i.length,x=v-1;m<v;x=m++)l+=((n=i[x]).x-(t=i[m]).x)*(t.y+n.y);return l}Kc.types=["Unknown","Point","LineString","Polygon"],Kc.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,n=i.readVarint()+i.pos,l=1,m=0,v=0,x=0,I=[];i.pos<n;){if(m<=0){var T=i.readVarint();l=7&T,m=T>>3}if(m--,l===1||l===2)v+=i.readSVarint(),x+=i.readSVarint(),l===1&&(t&&I.push(t),t=[]),t.push(new R1(v,x));else{if(l!==7)throw new Error("unknown command "+l);t&&t.push(t[0].clone())}}return t&&I.push(t),I},Kc.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,n=1,l=0,m=0,v=0,x=1/0,I=-1/0,T=1/0,z=-1/0;i.pos<t;){if(l<=0){var j=i.readVarint();n=7&j,l=j>>3}if(l--,n===1||n===2)(m+=i.readSVarint())<x&&(x=m),m>I&&(I=m),(v+=i.readSVarint())<T&&(T=v),v>z&&(z=v);else if(n!==7)throw new Error("unknown command "+n)}return[x,T,I,z]},Kc.prototype.toGeoJSON=function(i,t,n){var l,m,v=this.extent*Math.pow(2,n),x=this.extent*i,I=this.extent*t,T=this.loadGeometry(),z=Kc.types[this.type];function j(J){for(var re=0;re<J.length;re++){var ce=J[re];J[re]=[360*(ce.x+x)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(ce.y+I)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var Z=[];for(l=0;l<T.length;l++)Z[l]=T[l][0];j(T=Z);break;case 2:for(l=0;l<T.length;l++)j(T[l]);break;case 3:for(T=function(J){var re=J.length;if(re<=1)return[J];for(var ce,Ae,Ce=[],Ze=0;Ze<re;Ze++){var Oe=B1(J[Ze]);Oe!==0&&(Ae===void 0&&(Ae=Oe<0),Ae===Oe<0?(ce&&Ce.push(ce),ce=[J[Ze]]):ce.push(J[Ze]))}return ce&&Ce.push(ce),Ce}(T),l=0;l<T.length;l++)for(m=0;m<T[l].length;m++)j(T[l][m])}T.length===1?T=T[0]:z="Multi"+z;var X={type:"Feature",geometry:{type:z,coordinates:T},properties:this.properties};return"id"in this&&(X.id=this.id),X};var j1=ff,mf=gf;function gf(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(q1,this,t),this.length=this._features.length}function q1(i,t,n){i===15?t.version=n.readVarint():i===1?t.name=n.readString():i===5?t.extent=n.readVarint():i===2?t._features.push(n.pos):i===3?t._keys.push(n.readString()):i===4&&t._values.push(function(l){for(var m=null,v=l.readVarint()+l.pos;l.pos<v;){var x=l.readVarint()>>3;m=x===1?l.readString():x===2?l.readFloat():x===3?l.readDouble():x===4?l.readVarint64():x===5?l.readVarint():x===6?l.readSVarint():x===7?l.readBoolean():null}return m}(n))}gf.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new j1(this._pbf,t,this.extent,this._keys,this._values)};var V1=mf;function U1(i,t,n){if(i===3){var l=new V1(n,n.readVarint()+n.pos);l.length&&(t[l.name]=l)}}Wl.VectorTile=function(i,t){this.layers=i.readFields(U1,{},t)},Wl.VectorTileFeature=ff,Wl.VectorTileLayer=mf;const $1=Wl.VectorTileFeature.types,dd=Math.pow(2,13);function Rh(i,t,n,l,m,v,x,I){i.emplaceBack(t,n,2*Math.floor(l*dd)+x,m*dd*2,v*dd*2,Math.round(I))}class pd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Bn,this.centroidVertexArray=new mr,this.indexArray=new cn,this.programConfigurations=new Zo(t.layers,t.zoom),this.segments=new Ri,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,l){this.features=[],this.hasPattern=cd("fill-extrusion",this.layers,n);for(const{feature:m,id:v,index:x,sourceLayerIndex:I}of t){const T=this.layers[0]._featureFilter.needGeometry,z=Go(m,T);if(!this.layers[0]._featureFilter.filter(new Qi(this.zoom),z,l))continue;const j={id:v,sourceLayerIndex:I,index:x,geometry:T?z.geometry:Pl(m),properties:m.properties,type:m.type,patterns:{}};this.hasPattern?this.features.push(hd("fill-extrusion",this.layers,j,this.zoom,n)):this.addFeature(j,j.geometry,x,l,{}),n.featureIndex.insert(m,j.geometry,x,I,this.index,!0)}}addFeatures(t,n,l){for(const m of this.features){const{geometry:v}=m;this.addFeature(m,v,m.index,n,l)}}update(t,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,F1),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,D1.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,l,m,v){for(const x of Ts(n,500)){const I={x:0,y:0,vertexCount:0};let T=0;for(const re of x)T+=re.length;let z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const re of x){if(re.length===0||G1(re))continue;let ce=0;for(let Ae=0;Ae<re.length;Ae++){const Ce=re[Ae];if(Ae>=1){const Ze=re[Ae-1];if(!Z1(Ce,Ze)){z.vertexLength+4>Ri.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Oe=Ce.sub(Ze)._perp()._unit(),Ue=Ze.dist(Ce);ce+Ue>32768&&(ce=0),Rh(this.layoutVertexArray,Ce.x,Ce.y,Oe.x,Oe.y,0,0,ce),Rh(this.layoutVertexArray,Ce.x,Ce.y,Oe.x,Oe.y,0,1,ce),I.x+=2*Ce.x,I.y+=2*Ce.y,I.vertexCount+=2,ce+=Ue,Rh(this.layoutVertexArray,Ze.x,Ze.y,Oe.x,Oe.y,0,0,ce),Rh(this.layoutVertexArray,Ze.x,Ze.y,Oe.x,Oe.y,0,1,ce),I.x+=2*Ze.x,I.y+=2*Ze.y,I.vertexCount+=2;const ot=z.vertexLength;this.indexArray.emplaceBack(ot,ot+2,ot+1),this.indexArray.emplaceBack(ot+1,ot+2,ot+3),z.vertexLength+=4,z.primitiveLength+=2}}}}if(z.vertexLength+T>Ri.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray)),$1[t.type]!=="Polygon")continue;const j=[],Z=[],X=z.vertexLength;for(const re of x)if(re.length!==0){re!==x[0]&&Z.push(j.length/2);for(let ce=0;ce<re.length;ce++){const Ae=re[ce];Rh(this.layoutVertexArray,Ae.x,Ae.y,0,0,1,1,0),I.x+=Ae.x,I.y+=Ae.y,I.vertexCount+=1,j.push(Ae.x),j.push(Ae.y)}}const J=of(j,Z);for(let re=0;re<J.length;re+=3)this.indexArray.emplaceBack(X+J[re],X+J[re+2],X+J[re+1]);z.primitiveLength+=J.length/3,z.vertexLength+=T;for(let re=0;re<I.vertexCount;re++){const ce=Math.floor(I.x/I.vertexCount),Ae=Math.floor(I.y/I.vertexCount);this.centroidVertexArray.emplaceBack(ce,Ae)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,v,m)}}function Z1(i,t){return i.x===t.x&&(i.x<0||i.x>cr)||i.y===t.y&&(i.y<0||i.y>cr)}function G1(i){return i.every(t=>t.x<0)||i.every(t=>t.x>cr)||i.every(t=>t.y<0)||i.every(t=>t.y>cr)}let yf;Vt("FillExtrusionBucket",pd,{omit:["layers","features"]});var W1={get paint(){return yf=yf||new c({"fill-extrusion-opacity":new Wt(te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new hi(te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Wt(te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Wt(te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new wl(te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new hi(te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new hi(te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Wt(te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class H1 extends r{constructor(t){super(t,W1)}createBucket(t){return new pd(t)}queryRadius(){return uu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,n,l,m,v,x,I,T){const z=du(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,I),j=this.paint.get("fill-extrusion-height").evaluate(n,l),Z=this.paint.get("fill-extrusion-base").evaluate(n,l),X=function(re,ce,Ae,Ce){const Ze=[];for(const Oe of re){const Ue=[Oe.x,Oe.y,0,1];pu(Ue,Ue,ce),Ze.push(new O(Ue[0]/Ue[3],Ue[1]/Ue[3]))}return Ze}(z,T),J=function(re,ce,Ae,Ce){const Ze=[],Oe=[],Ue=Ce[8]*ce,ot=Ce[9]*ce,It=Ce[10]*ce,qt=Ce[11]*ce,pi=Ce[8]*Ae,jt=Ce[9]*Ae,Ft=Ce[10]*Ae,Qt=Ce[11]*Ae;for(const Zt of re){const Ut=[],gt=[];for(const ei of Zt){const Kt=ei.x,xi=ei.y,ir=Ce[0]*Kt+Ce[4]*xi+Ce[12],tr=Ce[1]*Kt+Ce[5]*xi+Ce[13],un=Ce[2]*Kt+Ce[6]*xi+Ce[14],Ra=Ce[3]*Kt+Ce[7]*xi+Ce[15],Pn=un+It,dn=Ra+qt,Jn=ir+pi,Qn=tr+jt,es=un+Ft,Rr=Ra+Qt,pn=new O((ir+Ue)/dn,(tr+ot)/dn);pn.z=Pn/dn,Ut.push(pn);const Vn=new O(Jn/Rr,Qn/Rr);Vn.z=es/Rr,gt.push(Vn)}Ze.push(Ut),Oe.push(gt)}return[Ze,Oe]}(m,Z,j,T);return function(re,ce,Ae){let Ce=1/0;Da(Ae,ce)&&(Ce=_f(Ae,ce[0]));for(let Ze=0;Ze<ce.length;Ze++){const Oe=ce[Ze],Ue=re[Ze];for(let ot=0;ot<Oe.length-1;ot++){const It=Oe[ot],qt=[It,Oe[ot+1],Ue[ot+1],Ue[ot],It];Zc(Ae,qt)&&(Ce=Math.min(Ce,_f(Ae,qt)))}}return Ce!==1/0&&Ce}(J[0],J[1],X)}}function Oh(i,t){return i.x*t.x+i.y*t.y}function _f(i,t){if(i.length===1){let n=0;const l=t[n++];let m;for(;!m||l.equals(m);)if(m=t[n++],!m)return 1/0;for(;n<t.length;n++){const v=t[n],x=i[0],I=m.sub(l),T=v.sub(l),z=x.sub(l),j=Oh(I,I),Z=Oh(I,T),X=Oh(T,T),J=Oh(z,I),re=Oh(z,T),ce=j*X-Z*Z,Ae=(X*J-Z*re)/ce,Ce=(j*re-Z*J)/ce,Ze=l.z*(1-Ae-Ce)+m.z*Ae+v.z*Ce;if(isFinite(Ze))return Ze}return 1/0}{let n=1/0;for(const l of t)n=Math.min(n,l.z);return n}}const X1=w([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:K1}=X1,Y1=w([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:J1}=Y1,Q1=Wl.VectorTileFeature.types,ey=Math.cos(Math.PI/180*37.5),vf=Math.pow(2,14)/.5;class fd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new lr,this.layoutVertexArray2=new Ma,this.indexArray=new cn,this.programConfigurations=new Zo(t.layers,t.zoom),this.segments=new Ri,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,l){this.hasPattern=cd("line",this.layers,n);const m=this.layers[0].layout.get("line-sort-key"),v=!m.isConstant(),x=[];for(const{feature:I,id:T,index:z,sourceLayerIndex:j}of t){const Z=this.layers[0]._featureFilter.needGeometry,X=Go(I,Z);if(!this.layers[0]._featureFilter.filter(new Qi(this.zoom),X,l))continue;const J=v?m.evaluate(X,{},l):void 0,re={id:T,properties:I.properties,type:I.type,sourceLayerIndex:j,index:z,geometry:Z?X.geometry:Pl(I),patterns:{},sortKey:J};x.push(re)}v&&x.sort((I,T)=>I.sortKey-T.sortKey);for(const I of x){const{geometry:T,index:z,sourceLayerIndex:j}=I;if(this.hasPattern){const Z=hd("line",this.layers,I,this.zoom,n);this.patternFeatures.push(Z)}else this.addFeature(I,T,z,l,{});n.featureIndex.insert(t[z].feature,T,z,j,this.index)}}update(t,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,l)}addFeatures(t,n,l){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,n,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,J1)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,K1),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,l,m,v){const x=this.layers[0].layout,I=x.get("line-join").evaluate(t,{}),T=x.get("line-cap"),z=x.get("line-miter-limit"),j=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const Z of n)this.addLine(Z,t,I,T,z,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,v,m)}addLine(t,n,l,m,v,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ce=0;Ce<t.length-1;Ce++)this.totalDistance+=t[Ce].dist(t[Ce+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=Q1[n.type]==="Polygon";let T=t.length;for(;T>=2&&t[T-1].equals(t[T-2]);)T--;let z=0;for(;z<T-1&&t[z].equals(t[z+1]);)z++;if(T<(I?3:2))return;l==="bevel"&&(v=1.05);const j=this.overscaling<=16?15*cr/(512*this.overscaling):0,Z=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let X,J,re,ce,Ae;this.e1=this.e2=-1,I&&(X=t[T-2],Ae=t[z].sub(X)._unit()._perp());for(let Ce=z;Ce<T;Ce++){if(re=Ce===T-1?I?t[z+1]:void 0:t[Ce+1],re&&t[Ce].equals(re))continue;Ae&&(ce=Ae),X&&(J=X),X=t[Ce],Ae=re?re.sub(X)._unit()._perp():ce,ce=ce||Ae;let Ze=ce.add(Ae);Ze.x===0&&Ze.y===0||Ze._unit();const Oe=ce.x*Ae.x+ce.y*Ae.y,Ue=Ze.x*Ae.x+Ze.y*Ae.y,ot=Ue!==0?1/Ue:1/0,It=2*Math.sqrt(2-2*Ue),qt=Ue<ey&&J&&re,pi=ce.x*Ae.y-ce.y*Ae.x>0;if(qt&&Ce>z){const Qt=X.dist(J);if(Qt>2*j){const Zt=X.sub(X.sub(J)._mult(j/Qt)._round());this.updateDistance(J,Zt),this.addCurrentVertex(Zt,ce,0,0,Z),J=Zt}}const jt=J&&re;let Ft=jt?l:I?"butt":m;if(jt&&Ft==="round"&&(ot<x?Ft="miter":ot<=2&&(Ft="fakeround")),Ft==="miter"&&ot>v&&(Ft="bevel"),Ft==="bevel"&&(ot>2&&(Ft="flipbevel"),ot<v&&(Ft="miter")),J&&this.updateDistance(J,X),Ft==="miter")Ze._mult(ot),this.addCurrentVertex(X,Ze,0,0,Z);else if(Ft==="flipbevel"){if(ot>100)Ze=Ae.mult(-1);else{const Qt=ot*ce.add(Ae).mag()/ce.sub(Ae).mag();Ze._perp()._mult(Qt*(pi?-1:1))}this.addCurrentVertex(X,Ze,0,0,Z),this.addCurrentVertex(X,Ze.mult(-1),0,0,Z)}else if(Ft==="bevel"||Ft==="fakeround"){const Qt=-Math.sqrt(ot*ot-1),Zt=pi?Qt:0,Ut=pi?0:Qt;if(J&&this.addCurrentVertex(X,ce,Zt,Ut,Z),Ft==="fakeround"){const gt=Math.round(180*It/Math.PI/20);for(let ei=1;ei<gt;ei++){let Kt=ei/gt;if(Kt!==.5){const ir=Kt-.5;Kt+=Kt*ir*(Kt-1)*((1.0904+Oe*(Oe*(3.55645-1.43519*Oe)-3.2452))*ir*ir+(.848013+Oe*(.215638*Oe-1.06021)))}const xi=Ae.sub(ce)._mult(Kt)._add(ce)._unit()._mult(pi?-1:1);this.addHalfVertex(X,xi.x,xi.y,!1,pi,0,Z)}}re&&this.addCurrentVertex(X,Ae,-Zt,-Ut,Z)}else if(Ft==="butt")this.addCurrentVertex(X,Ze,0,0,Z);else if(Ft==="square"){const Qt=J?1:-1;this.addCurrentVertex(X,Ze,Qt,Qt,Z)}else Ft==="round"&&(J&&(this.addCurrentVertex(X,ce,0,0,Z),this.addCurrentVertex(X,ce,1,1,Z,!0)),re&&(this.addCurrentVertex(X,Ae,-1,-1,Z,!0),this.addCurrentVertex(X,Ae,0,0,Z)));if(qt&&Ce<T-1){const Qt=X.dist(re);if(Qt>2*j){const Zt=X.add(re.sub(X)._mult(j/Qt)._round());this.updateDistance(X,Zt),this.addCurrentVertex(Zt,Ae,0,0,Z),X=Zt}}}}addCurrentVertex(t,n,l,m,v,x=!1){const I=n.y*m-n.x,T=-n.y-n.x*m;this.addHalfVertex(t,n.x+n.y*l,n.y-n.x*l,x,!1,l,v),this.addHalfVertex(t,I,T,x,!0,-m,v),this.distance>vf/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,l,m,v,x))}addHalfVertex({x:t,y:n},l,m,v,x,I,T){const z=.5*(this.lineClips?this.scaledDistance*(vf-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(v?1:0),(n<<1)+(x?1:0),Math.round(63*l)+128,Math.round(63*m)+128,1+(I===0?0:I<0?-1:1)|(63&z)<<2,z>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const j=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,j),T.primitiveLength++),x?this.e2=j:this.e1=j}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let bf,xf;Vt("LineBucket",fd,{omit:["layers","patternFeatures"]});var wf={get paint(){return xf=xf||new c({"line-opacity":new hi(te.paint_line["line-opacity"]),"line-color":new hi(te.paint_line["line-color"]),"line-translate":new Wt(te.paint_line["line-translate"]),"line-translate-anchor":new Wt(te.paint_line["line-translate-anchor"]),"line-width":new hi(te.paint_line["line-width"]),"line-gap-width":new hi(te.paint_line["line-gap-width"]),"line-offset":new hi(te.paint_line["line-offset"]),"line-blur":new hi(te.paint_line["line-blur"]),"line-dasharray":new b(te.paint_line["line-dasharray"]),"line-pattern":new wl(te.paint_line["line-pattern"]),"line-gradient":new A(te.paint_line["line-gradient"])})},get layout(){return bf=bf||new c({"line-cap":new Wt(te.layout_line["line-cap"]),"line-join":new hi(te.layout_line["line-join"]),"line-miter-limit":new Wt(te.layout_line["line-miter-limit"]),"line-round-limit":new Wt(te.layout_line["line-round-limit"]),"line-sort-key":new hi(te.layout_line["line-sort-key"])})}};class ty extends hi{possiblyEvaluate(t,n){return n=new Qi(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,l,m){return n=Ge({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,l,m)}}let yu;class iy extends r{constructor(t){super(t,wf),this.gradientVersion=0,yu||(yu=new ty(wf.paint.properties["line-width"].specification),yu.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(l){return l._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof ba,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=yu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new fd(t)}queryRadius(t){const n=t,l=Sf(Eh("line-width",this,n),Eh("line-gap-width",this,n)),m=Eh("line-offset",this,n);return l/2+Math.abs(m)+uu(this.paint.get("line-translate"))}queryIntersectsFeature(t,n,l,m,v,x,I){const T=du(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,I),z=I/2*Sf(this.paint.get("line-width").evaluate(n,l),this.paint.get("line-gap-width").evaluate(n,l)),j=this.paint.get("line-offset").evaluate(n,l);return j&&(m=function(Z,X){const J=[];for(let re=0;re<Z.length;re++){const ce=Z[re],Ae=[];for(let Ce=0;Ce<ce.length;Ce++){const Ze=ce[Ce-1],Oe=ce[Ce],Ue=ce[Ce+1],ot=Ce===0?new O(0,0):Oe.sub(Ze)._unit()._perp(),It=Ce===ce.length-1?new O(0,0):Ue.sub(Oe)._unit()._perp(),qt=ot._add(It)._unit(),pi=qt.x*It.x+qt.y*It.y;pi!==0&&qt._mult(1/pi),Ae.push(qt._mult(X)._add(Oe))}J.push(Ae)}return J}(m,j*I)),function(Z,X,J){for(let re=0;re<X.length;re++){const ce=X[re];if(Z.length>=3){for(let Ae=0;Ae<ce.length;Ae++)if(Ho(Z,ce[Ae]))return!0}if(Wo(Z,ce,J))return!0}return!1}(T,m,z)}isTileClipped(){return!0}}function Sf(i,t){return t>0?t+2*i:i}const ry=w([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ny=w([{name:"a_projected_pos",components:3,type:"Float32"}],4);w([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const sy=w([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);w([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Af=w([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ay=w([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function oy(i,t,n){return i.sections.forEach(l=>{l.text=function(m,v,x){const I=v.layout.get("text-transform").evaluate(x,{});return I==="uppercase"?m=m.toLocaleUpperCase():I==="lowercase"&&(m=m.toLocaleLowerCase()),On.applyArabicShaping&&(m=On.applyArabicShaping(m)),m}(l.text,t,n)}),i}w([{name:"triangle",components:3,type:"Uint16"}]),w([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),w([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),w([{type:"Float32",name:"offsetX"}]),w([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),w([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Bh={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Yr=24,If=er,Pf=function(i,t,n,l,m){var v,x,I=8*m-l-1,T=(1<<I)-1,z=T>>1,j=-7,Z=m-1,X=-1,J=i[t+Z];for(Z+=X,v=J&(1<<-j)-1,J>>=-j,j+=I;j>0;v=256*v+i[t+Z],Z+=X,j-=8);for(x=v&(1<<-j)-1,v>>=-j,j+=l;j>0;x=256*x+i[t+Z],Z+=X,j-=8);if(v===0)v=1-z;else{if(v===T)return x?NaN:1/0*(J?-1:1);x+=Math.pow(2,l),v-=z}return(J?-1:1)*x*Math.pow(2,v-l)},Lf=function(i,t,n,l,m,v){var x,I,T,z=8*v-m-1,j=(1<<z)-1,Z=j>>1,X=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,J=0,re=1,ce=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(I=isNaN(t)?1:0,x=j):(x=Math.floor(Math.log(t)/Math.LN2),t*(T=Math.pow(2,-x))<1&&(x--,T*=2),(t+=x+Z>=1?X/T:X*Math.pow(2,1-Z))*T>=2&&(x++,T/=2),x+Z>=j?(I=0,x=j):x+Z>=1?(I=(t*T-1)*Math.pow(2,m),x+=Z):(I=t*Math.pow(2,Z-1)*Math.pow(2,m),x=0));m>=8;i[n+J]=255&I,J+=re,I/=256,m-=8);for(x=x<<m|I,z+=m;z>0;i[n+J]=255&x,J+=re,x/=256,z-=8);i[n+J-re]|=128*ce};function er(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}er.Varint=0,er.Fixed64=1,er.Bytes=2,er.Fixed32=5;var md=4294967296,kf=1/md,Tf=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function kl(i){return i.type===er.Bytes?i.readVarint()+i.pos:i.pos+1}function Yc(i,t,n){return n?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function Cf(i,t,n){var l=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(l);for(var m=n.pos-1;m>=i;m--)n.buf[m+l]=n.buf[m]}function ly(i,t){for(var n=0;n<i.length;n++)t.writeVarint(i[n])}function cy(i,t){for(var n=0;n<i.length;n++)t.writeSVarint(i[n])}function hy(i,t){for(var n=0;n<i.length;n++)t.writeFloat(i[n])}function uy(i,t){for(var n=0;n<i.length;n++)t.writeDouble(i[n])}function dy(i,t){for(var n=0;n<i.length;n++)t.writeBoolean(i[n])}function py(i,t){for(var n=0;n<i.length;n++)t.writeFixed32(i[n])}function fy(i,t){for(var n=0;n<i.length;n++)t.writeSFixed32(i[n])}function my(i,t){for(var n=0;n<i.length;n++)t.writeFixed64(i[n])}function gy(i,t){for(var n=0;n<i.length;n++)t.writeSFixed64(i[n])}function _u(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function Jc(i,t,n){i[n]=t,i[n+1]=t>>>8,i[n+2]=t>>>16,i[n+3]=t>>>24}function Ef(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}er.prototype={destroy:function(){this.buf=null},readFields:function(i,t,n){for(n=n||this.length;this.pos<n;){var l=this.readVarint(),m=l>>3,v=this.pos;this.type=7&l,i(m,t,this),this.pos===v&&this.skip(l)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=_u(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Ef(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=_u(this.buf,this.pos)+_u(this.buf,this.pos+4)*md;return this.pos+=8,i},readSFixed64:function(){var i=_u(this.buf,this.pos)+Ef(this.buf,this.pos+4)*md;return this.pos+=8,i},readFloat:function(){var i=Pf(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Pf(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,n,l=this.buf;return t=127&(n=l[this.pos++]),n<128?t:(t|=(127&(n=l[this.pos++]))<<7,n<128?t:(t|=(127&(n=l[this.pos++]))<<14,n<128?t:(t|=(127&(n=l[this.pos++]))<<21,n<128?t:function(m,v,x){var I,T,z=x.buf;if(I=(112&(T=z[x.pos++]))>>4,T<128||(I|=(127&(T=z[x.pos++]))<<3,T<128)||(I|=(127&(T=z[x.pos++]))<<10,T<128)||(I|=(127&(T=z[x.pos++]))<<17,T<128)||(I|=(127&(T=z[x.pos++]))<<24,T<128)||(I|=(1&(T=z[x.pos++]))<<31,T<128))return Yc(m,I,v);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=l[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&Tf?function(n,l,m){return Tf.decode(n.subarray(l,m))}(this.buf,t,i):function(n,l,m){for(var v="",x=l;x<m;){var I,T,z,j=n[x],Z=null,X=j>239?4:j>223?3:j>191?2:1;if(x+X>m)break;X===1?j<128&&(Z=j):X===2?(192&(I=n[x+1]))==128&&(Z=(31&j)<<6|63&I)<=127&&(Z=null):X===3?(T=n[x+2],(192&(I=n[x+1]))==128&&(192&T)==128&&((Z=(15&j)<<12|(63&I)<<6|63&T)<=2047||Z>=55296&&Z<=57343)&&(Z=null)):X===4&&(T=n[x+2],z=n[x+3],(192&(I=n[x+1]))==128&&(192&T)==128&&(192&z)==128&&((Z=(15&j)<<18|(63&I)<<12|(63&T)<<6|63&z)<=65535||Z>=1114112)&&(Z=null)),Z===null?(Z=65533,X=1):Z>65535&&(Z-=65536,v+=String.fromCharCode(Z>>>10&1023|55296),Z=56320|1023&Z),v+=String.fromCharCode(Z),x+=X}return v}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==er.Bytes)return i.push(this.readVarint(t));var n=kl(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==er.Bytes)return i.push(this.readSVarint());var t=kl(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==er.Bytes)return i.push(this.readBoolean());var t=kl(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==er.Bytes)return i.push(this.readFloat());var t=kl(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==er.Bytes)return i.push(this.readDouble());var t=kl(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==er.Bytes)return i.push(this.readFixed32());var t=kl(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==er.Bytes)return i.push(this.readSFixed32());var t=kl(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==er.Bytes)return i.push(this.readFixed64());var t=kl(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==er.Bytes)return i.push(this.readSFixed64());var t=kl(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===er.Varint)for(;this.buf[this.pos++]>127;);else if(t===er.Bytes)this.pos=this.readVarint()+this.pos;else if(t===er.Fixed32)this.pos+=4;else{if(t!==er.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Jc(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Jc(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Jc(this.buf,-1&i,this.pos),Jc(this.buf,Math.floor(i*kf),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Jc(this.buf,-1&i,this.pos),Jc(this.buf,Math.floor(i*kf),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,n){var l,m;if(t>=0?(l=t%4294967296|0,m=t/4294967296|0):(m=~(-t/4294967296),4294967295^(l=~(-t%4294967296))?l=l+1|0:(l=0,m=m+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(v,x,I){I.buf[I.pos++]=127&v|128,v>>>=7,I.buf[I.pos++]=127&v|128,v>>>=7,I.buf[I.pos++]=127&v|128,v>>>=7,I.buf[I.pos++]=127&v|128,I.buf[I.pos]=127&(v>>>=7)}(l,0,n),function(v,x){var I=(7&v)<<4;x.buf[x.pos++]|=I|((v>>>=3)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v)))))}(m,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(l,m,v){for(var x,I,T=0;T<m.length;T++){if((x=m.charCodeAt(T))>55295&&x<57344){if(!I){x>56319||T+1===m.length?(l[v++]=239,l[v++]=191,l[v++]=189):I=x;continue}if(x<56320){l[v++]=239,l[v++]=191,l[v++]=189,I=x;continue}x=I-55296<<10|x-56320|65536,I=null}else I&&(l[v++]=239,l[v++]=191,l[v++]=189,I=null);x<128?l[v++]=x:(x<2048?l[v++]=x>>6|192:(x<65536?l[v++]=x>>12|224:(l[v++]=x>>18|240,l[v++]=x>>12&63|128),l[v++]=x>>6&63|128),l[v++]=63&x|128)}return v}(this.buf,i,this.pos);var n=this.pos-t;n>=128&&Cf(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),Lf(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Lf(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,t){this.pos++;var n=this.pos;i(t,this);var l=this.pos-n;l>=128&&Cf(n,l,this),this.pos=n-1,this.writeVarint(l),this.pos+=l},writeMessage:function(i,t,n){this.writeTag(i,er.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,ly,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,cy,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,dy,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,hy,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,uy,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,py,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,fy,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,my,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,gy,t)},writeBytesField:function(i,t){this.writeTag(i,er.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,er.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,er.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,er.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,er.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,er.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,er.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,er.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,er.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,er.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var gd=C(If);const yd=3;function yy(i,t,n){i===1&&n.readMessage(_y,t)}function _y(i,t,n){if(i===3){const{id:l,bitmap:m,width:v,height:x,left:I,top:T,advance:z}=n.readMessage(vy,{});t.push({id:l,bitmap:new zh({width:v+2*yd,height:x+2*yd},m),metrics:{width:v,height:x,left:I,top:T,advance:z}})}}function vy(i,t,n){i===1?t.id=n.readVarint():i===2?t.bitmap=n.readBytes():i===3?t.width=n.readVarint():i===4?t.height=n.readVarint():i===5?t.left=n.readSVarint():i===6?t.top=n.readSVarint():i===7&&(t.advance=n.readVarint())}const Mf=yd;function zf(i){let t=0,n=0;for(const x of i)t+=x.w*x.h,n=Math.max(n,x.w);i.sort((x,I)=>I.h-x.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let m=0,v=0;for(const x of i)for(let I=l.length-1;I>=0;I--){const T=l[I];if(!(x.w>T.w||x.h>T.h)){if(x.x=T.x,x.y=T.y,v=Math.max(v,x.y+x.h),m=Math.max(m,x.x+x.w),x.w===T.w&&x.h===T.h){const z=l.pop();I<l.length&&(l[I]=z)}else x.h===T.h?(T.x+=x.w,T.w-=x.w):x.w===T.w?(T.y+=x.h,T.h-=x.h):(l.push({x:T.x+x.w,y:T.y,w:T.w-x.w,h:x.h}),T.y+=x.h,T.h-=x.h);break}}return{w:m,h:v,fill:t/(m*v)||0}}const Ss=1;class _d{constructor(t,{pixelRatio:n,version:l,stretchX:m,stretchY:v,content:x,textFitWidth:I,textFitHeight:T}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=m,this.stretchY=v,this.content=x,this.version=l,this.textFitWidth=I,this.textFitHeight=T}get tl(){return[this.paddedRect.x+Ss,this.paddedRect.y+Ss]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ss,this.paddedRect.y+this.paddedRect.h-Ss]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Ss)/this.pixelRatio,(this.paddedRect.h-2*Ss)/this.pixelRatio]}}class Nf{constructor(t,n){const l={},m={};this.haveRenderCallbacks=[];const v=[];this.addImages(t,l,v),this.addImages(n,m,v);const{w:x,h:I}=zf(v),T=new la({width:x||1,height:I||1});for(const z in t){const j=t[z],Z=l[z].paddedRect;la.copy(j.data,T,{x:0,y:0},{x:Z.x+Ss,y:Z.y+Ss},j.data)}for(const z in n){const j=n[z],Z=m[z].paddedRect,X=Z.x+Ss,J=Z.y+Ss,re=j.data.width,ce=j.data.height;la.copy(j.data,T,{x:0,y:0},{x:X,y:J},j.data),la.copy(j.data,T,{x:0,y:ce-1},{x:X,y:J-1},{width:re,height:1}),la.copy(j.data,T,{x:0,y:0},{x:X,y:J+ce},{width:re,height:1}),la.copy(j.data,T,{x:re-1,y:0},{x:X-1,y:J},{width:1,height:ce}),la.copy(j.data,T,{x:0,y:0},{x:X+re,y:J},{width:1,height:ce})}this.image=T,this.iconPositions=l,this.patternPositions=m}addImages(t,n,l){for(const m in t){const v=t[m],x={x:0,y:0,w:v.data.width+2*Ss,h:v.data.height+2*Ss};l.push(x),n[m]=new _d(x,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in t.updatedImages)this.patchUpdatedImage(this.iconPositions[l],t.getImage(l),n),this.patchUpdatedImage(this.patternPositions[l],t.getImage(l),n)}patchUpdatedImage(t,n,l){if(!t||!n||t.version===n.version)return;t.version=n.version;const[m,v]=t.tl;l.update(n.data,void 0,{x:m,y:v})}}var Hl;Vt("ImagePosition",_d),Vt("ImageAtlas",Nf),g.ah=void 0,(Hl=g.ah||(g.ah={}))[Hl.none=0]="none",Hl[Hl.horizontal=1]="horizontal",Hl[Hl.vertical=2]="vertical",Hl[Hl.horizontalOnly=3]="horizontalOnly";const jh=-17;class qh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const l=new qh;return l.scale=t||1,l.fontStack=n,l}static forImage(t){const n=new qh;return n.imageName=t,n}}class Qc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const l=new Qc;for(let m=0;m<t.sections.length;m++){const v=t.sections[m];v.image?l.addImageSection(v):l.addTextSection(v,n)}return l}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let n="";for(let l=0;l<t.length;l++){const m=t.charCodeAt(l+1)||null,v=t.charCodeAt(l-1)||null;n+=m&&vl(m)&&!Bh[t[l+1]]||v&&vl(v)&&!Bh[t[l-1]]||!Bh[t[l]]?t[l]:Bh[t[l]]}return n}(this.text)}trim(){let t=0;for(let l=0;l<this.text.length&&bu[this.text.charCodeAt(l)];l++)t++;let n=this.text.length;for(let l=this.text.length-1;l>=0&&l>=t&&bu[this.text.charCodeAt(l)];l--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const l=new Qc;return l.text=this.text.substring(t,n),l.sectionIndex=this.sectionIndex.slice(t,n),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(qh.forText(t.scale,t.fontStack||n));const l=this.sections.length-1;for(let m=0;m<t.text.length;++m)this.sectionIndex.push(l)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void Ne("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(qh.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Ne("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function vu(i,t,n,l,m,v,x,I,T,z,j,Z,X,J,re){const ce=Qc.fromFeature(i,m);let Ae;Z===g.ah.vertical&&ce.verticalizePunctuation();const{processBidirectionalText:Ce,processStyledBidirectionalText:Ze}=On;if(Ce&&ce.sections.length===1){Ae=[];const ot=Ce(ce.toString(),vd(ce,z,v,t,l,J));for(const It of ot){const qt=new Qc;qt.text=It,qt.sections=ce.sections;for(let pi=0;pi<It.length;pi++)qt.sectionIndex.push(0);Ae.push(qt)}}else if(Ze){Ae=[];const ot=Ze(ce.text,ce.sectionIndex,vd(ce,z,v,t,l,J));for(const It of ot){const qt=new Qc;qt.text=It[0],qt.sectionIndex=It[1],qt.sections=ce.sections,Ae.push(qt)}}else Ae=function(ot,It){const qt=[],pi=ot.text;let jt=0;for(const Ft of It)qt.push(ot.substring(jt,Ft)),jt=Ft;return jt<pi.length&&qt.push(ot.substring(jt,pi.length)),qt}(ce,vd(ce,z,v,t,l,J));const Oe=[],Ue={positionedLines:Oe,text:ce.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:Z,iconsInText:!1,verticalizable:!1};return function(ot,It,qt,pi,jt,Ft,Qt,Zt,Ut,gt,ei,Kt){let xi=0,ir=jh,tr=0,un=0;const Ra=Zt==="right"?1:Zt==="left"?0:.5;let Pn=0;for(const Rr of jt){Rr.trim();const pn=Rr.getMaxScale(),Vn=(pn-1)*Yr,Ln={positionedGlyphs:[],lineOffset:0};ot.positionedLines[Pn]=Ln;const ts=Ln.positionedGlyphs;let kn=0;if(!Rr.length()){ir+=Ft,++Pn;continue}for(let As=0;As<Rr.length();As++){const Hi=Rr.getSection(As),hr=Rr.getSectionIndex(As),gr=Rr.getCharCode(As);let Vs=0,Cr=null,rh=null,Ko=null,Yo=Yr;const Oa=!(Ut===g.ah.horizontal||!ei&&!yc(gr)||ei&&(bu[gr]||(dn=gr,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(dn)))));if(Hi.imageName){const ua=pi[Hi.imageName];if(!ua)continue;Ko=Hi.imageName,ot.iconsInText=ot.iconsInText||!0,rh=ua.paddedRect;const bn=ua.displaySize;Hi.scale=Hi.scale*Yr/Kt,Cr={width:bn[0],height:bn[1],left:Ss,top:-Mf,advance:Oa?bn[1]:bn[0]},Vs=Vn+(Yr-bn[1]*Hi.scale),Yo=Cr.advance;const Tl=Oa?bn[0]*Hi.scale-Yr*pn:bn[1]*Hi.scale-Yr*pn;Tl>0&&Tl>kn&&(kn=Tl)}else{const ua=qt[Hi.fontStack],bn=ua&&ua[gr];if(bn&&bn.rect)rh=bn.rect,Cr=bn.metrics;else{const Tl=It[Hi.fontStack],Wh=Tl&&Tl[gr];if(!Wh)continue;Cr=Wh.metrics}Vs=(pn-Hi.scale)*Yr}Oa?(ot.verticalizable=!0,ts.push({glyph:gr,imageName:Ko,x:xi,y:ir+Vs,vertical:Oa,scale:Hi.scale,fontStack:Hi.fontStack,sectionIndex:hr,metrics:Cr,rect:rh}),xi+=Yo*Hi.scale+gt):(ts.push({glyph:gr,imageName:Ko,x:xi,y:ir+Vs,vertical:Oa,scale:Hi.scale,fontStack:Hi.fontStack,sectionIndex:hr,metrics:Cr,rect:rh}),xi+=Cr.advance*Hi.scale+gt)}ts.length!==0&&(tr=Math.max(xi-gt,tr),Sy(ts,0,ts.length-1,Ra,kn)),xi=0;const ha=Ft*pn+kn;Ln.lineOffset=Math.max(kn,Vn),ir+=ha,un=Math.max(ha,un),++Pn}var dn;const Jn=ir-jh,{horizontalAlign:Qn,verticalAlign:es}=bd(Qt);(function(Rr,pn,Vn,Ln,ts,kn,ha,As,Hi){const hr=(pn-Vn)*ts;let gr=0;gr=kn!==ha?-As*Ln-jh:(-Ln*Hi+.5)*ha;for(const Vs of Rr)for(const Cr of Vs.positionedGlyphs)Cr.x+=hr,Cr.y+=gr})(ot.positionedLines,Ra,Qn,es,tr,un,Ft,Jn,jt.length),ot.top+=-es*Jn,ot.bottom=ot.top+Jn,ot.left+=-Qn*tr,ot.right=ot.left+tr}(Ue,t,n,l,Ae,x,I,T,Z,z,X,re),!function(ot){for(const It of ot)if(It.positionedGlyphs.length!==0)return!1;return!0}(Oe)&&Ue}const bu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},by={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},xy={40:!0};function Df(i,t,n,l,m,v){if(t.imageName){const x=l[t.imageName];return x?x.displaySize[0]*t.scale*Yr/v+m:0}{const x=n[t.fontStack],I=x&&x[i];return I?I.metrics.advance*t.scale+m:0}}function Ff(i,t,n,l){const m=Math.pow(i-t,2);return l?i<t?m/2:2*m:m+Math.abs(n)*n}function wy(i,t,n){let l=0;return i===10&&(l-=1e4),n&&(l+=150),i!==40&&i!==65288||(l+=50),t!==41&&t!==65289||(l+=50),l}function Rf(i,t,n,l,m,v){let x=null,I=Ff(t,n,m,v);for(const T of l){const z=Ff(t-T.x,n,m,v)+T.badness;z<=I&&(x=T,I=z)}return{index:i,x:t,priorBreak:x,badness:I}}function Of(i){return i?Of(i.priorBreak).concat(i.index):[]}function vd(i,t,n,l,m,v){if(!i)return[];const x=[],I=function(Z,X,J,re,ce,Ae){let Ce=0;for(let Ze=0;Ze<Z.length();Ze++){const Oe=Z.getSection(Ze);Ce+=Df(Z.getCharCode(Ze),Oe,re,ce,X,Ae)}return Ce/Math.max(1,Math.ceil(Ce/J))}(i,t,n,l,m,v),T=i.text.indexOf("​")>=0;let z=0;for(let Z=0;Z<i.length();Z++){const X=i.getSection(Z),J=i.getCharCode(Z);if(bu[J]||(z+=Df(J,X,l,m,t,v)),Z<i.length()-1){const re=!((j=J)<11904)&&(!!Si["CJK Compatibility Forms"](j)||!!Si["CJK Compatibility"](j)||!!Si["CJK Strokes"](j)||!!Si["CJK Symbols and Punctuation"](j)||!!Si["Enclosed CJK Letters and Months"](j)||!!Si["Halfwidth and Fullwidth Forms"](j)||!!Si["Ideographic Description Characters"](j)||!!Si["Vertical Forms"](j)||gc.test(String.fromCodePoint(j)));(by[J]||re||X.imageName||Z!==i.length()-2&&xy[i.getCharCode(Z+1)])&&x.push(Rf(Z+1,z,I,x,wy(J,i.getCharCode(Z+1),re&&T),!1))}}var j;return Of(Rf(i.length(),z,I,x,0,!0))}function bd(i){let t=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Sy(i,t,n,l,m){if(!l&&!m)return;const v=i[n],x=(i[n].x+v.metrics.advance*v.scale)*l;for(let I=t;I<=n;I++)i[I].x-=x,i[I].y+=m}function Ay(i,t,n){const{horizontalAlign:l,verticalAlign:m}=bd(n),v=t[0]-i.displaySize[0]*l,x=t[1]-i.displaySize[1]*m;return{image:i,top:x,bottom:x+i.displaySize[1],left:v,right:v+i.displaySize[0]}}function Bf(i){var t,n;let l=i.left,m=i.top,v=i.right-l,x=i.bottom-m;const I=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",T=(n=i.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",z=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(T==="proportional"){if(I==="stretchOnly"&&v/x<z||I==="proportional"){const j=Math.ceil(x*z);l*=j/v,v=j}}else if(I==="proportional"&&T==="stretchOnly"&&z!==0&&v/x>z){const j=Math.ceil(v/z);m*=j/x,x=j}return{x1:l,y1:m,x2:l+v,y2:m+x}}function jf(i,t,n,l,m,v){const x=i.image;let I;if(x.content){const Ae=x.content,Ce=x.pixelRatio||1;I=[Ae[0]/Ce,Ae[1]/Ce,x.displaySize[0]-Ae[2]/Ce,x.displaySize[1]-Ae[3]/Ce]}const T=t.left*v,z=t.right*v;let j,Z,X,J;n==="width"||n==="both"?(J=m[0]+T-l[3],Z=m[0]+z+l[1]):(J=m[0]+(T+z-x.displaySize[0])/2,Z=J+x.displaySize[0]);const re=t.top*v,ce=t.bottom*v;return n==="height"||n==="both"?(j=m[1]+re-l[0],X=m[1]+ce+l[2]):(j=m[1]+(re+ce-x.displaySize[1])/2,X=j+x.displaySize[1]),{image:x,top:j,right:Z,bottom:X,left:J,collisionPadding:I}}const Vh=255,Xo=128,Xl=Vh*Xo;function qf(i,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Qi(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:m}=n;let v=0;for(;v<l.length&&l[v]<=i;)v++;v=Math.max(0,v-1);let x=v;for(;x<l.length&&l[x]<i+1;)x++;x=Math.min(l.length-1,x);const I=l[v],T=l[x];return n.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:T,interpolationType:m}:{kind:"camera",minZoom:I,maxZoom:T,minSize:n.evaluate(new Qi(I)),maxSize:n.evaluate(new Qi(T)),interpolationType:m}}}function xd(i,t,n){let l="never";const m=i.get(t);return m?l=m:i.get(n)&&(l="always"),l}const Iy=Wl.VectorTileFeature.types,Py=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function xu(i,t,n,l,m,v,x,I,T,z,j,Z,X){const J=I?Math.min(Xl,Math.round(I[0])):0,re=I?Math.min(Xl,Math.round(I[1])):0;i.emplaceBack(t,n,Math.round(32*l),Math.round(32*m),v,x,(J<<1)+(T?1:0),re,16*z,16*j,256*Z,256*X)}function wd(i,t,n){i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n)}function Ly(i){for(const t of i.sections)if(Bc(t.text))return!0;return!1}class Sd{constructor(t){this.layoutVertexArray=new Sl,this.indexArray=new cn,this.programConfigurations=t,this.segments=new Ri,this.dynamicLayoutVertexArray=new Vo,this.opacityVertexArray=new ln,this.hasVisibleVertices=!1,this.placedSymbolArray=new fi}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,l,m){this.isEmpty()||(l&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ry.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,ny.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Py,!0),this.opacityVertexBuffer.itemSize=1),(l||m)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Vt("SymbolBuffers",Sd);class Ad{constructor(t,n,l){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new l,this.segments=new Ri,this.collisionVertexArray=new Ur}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,sy.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Vt("CollisionBuffers",Ad);class eh{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(x=>x.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=rd([]),this.placementViewportMatrix=rd([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=qf(this.zoom,n["text-size"]),this.iconSizeData=qf(this.zoom,n["icon-size"]);const l=this.layers[0].layout,m=l.get("symbol-sort-key"),v=l.get("symbol-z-order");this.canOverlap=xd(l,"text-overlap","text-allow-overlap")!=="never"||xd(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!m.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(x=>g.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=t.sourceID}createArrays(){this.text=new Sd(new Zo(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Sd(new Zo(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Ti,this.lineVertexArray=new Gi,this.symbolInstances=new vi,this.textAnchorOffsets=new ji}calculateGlyphDependencies(t,n,l,m,v){for(let x=0;x<t.length;x++)if(n[t.charCodeAt(x)]=!0,(l||m)&&v){const I=Bh[t.charAt(x)];I&&(n[I.charCodeAt(0)]=!0)}}populate(t,n,l){const m=this.layers[0],v=m.layout,x=v.get("text-font"),I=v.get("text-field"),T=v.get("icon-image"),z=(I.value.kind!=="constant"||I.value.value instanceof tn&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),j=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,Z=v.get("symbol-sort-key");if(this.features=[],!z&&!j)return;const X=n.iconDependencies,J=n.glyphDependencies,re=n.availableImages,ce=new Qi(this.zoom);for(const{feature:Ae,id:Ce,index:Ze,sourceLayerIndex:Oe}of t){const Ue=m._featureFilter.needGeometry,ot=Go(Ae,Ue);if(!m._featureFilter.filter(ce,ot,l))continue;let It,qt;if(Ue||(ot.geometry=Pl(Ae)),z){const jt=m.getValueAndResolveTokens("text-field",ot,l,re),Ft=tn.factory(jt),Qt=this.hasRTLText=this.hasRTLText||Ly(Ft);(!Qt||On.getRTLTextPluginStatus()==="unavailable"||Qt&&On.isParsed())&&(It=oy(Ft,m,ot))}if(j){const jt=m.getValueAndResolveTokens("icon-image",ot,l,re);qt=jt instanceof rn?jt:rn.fromString(jt)}if(!It&&!qt)continue;const pi=this.sortFeaturesByKey?Z.evaluate(ot,{},l):void 0;if(this.features.push({id:Ce,text:It,icon:qt,index:Ze,sourceLayerIndex:Oe,geometry:ot.geometry,properties:Ae.properties,type:Iy[Ae.type],sortKey:pi}),qt&&(X[qt.name]=!0),It){const jt=x.evaluate(ot,{},l).join(","),Ft=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(g.ah.vertical)>=0;for(const Qt of It.sections)if(Qt.image)X[Qt.image.name]=!0;else{const Zt=mc(It.toString()),Ut=Qt.fontStack||jt,gt=J[Ut]=J[Ut]||{};this.calculateGlyphDependencies(Qt.text,gt,Ft,this.allowVerticalPlacement,Zt)}}}v.get("symbol-placement")==="line"&&(this.features=function(Ae){const Ce={},Ze={},Oe=[];let Ue=0;function ot(jt){Oe.push(Ae[jt]),Ue++}function It(jt,Ft,Qt){const Zt=Ze[jt];return delete Ze[jt],Ze[Ft]=Zt,Oe[Zt].geometry[0].pop(),Oe[Zt].geometry[0]=Oe[Zt].geometry[0].concat(Qt[0]),Zt}function qt(jt,Ft,Qt){const Zt=Ce[Ft];return delete Ce[Ft],Ce[jt]=Zt,Oe[Zt].geometry[0].shift(),Oe[Zt].geometry[0]=Qt[0].concat(Oe[Zt].geometry[0]),Zt}function pi(jt,Ft,Qt){const Zt=Qt?Ft[0][Ft[0].length-1]:Ft[0][0];return`${jt}:${Zt.x}:${Zt.y}`}for(let jt=0;jt<Ae.length;jt++){const Ft=Ae[jt],Qt=Ft.geometry,Zt=Ft.text?Ft.text.toString():null;if(!Zt){ot(jt);continue}const Ut=pi(Zt,Qt),gt=pi(Zt,Qt,!0);if(Ut in Ze&&gt in Ce&&Ze[Ut]!==Ce[gt]){const ei=qt(Ut,gt,Qt),Kt=It(Ut,gt,Oe[ei].geometry);delete Ce[Ut],delete Ze[gt],Ze[pi(Zt,Oe[Kt].geometry,!0)]=Kt,Oe[ei].geometry=null}else Ut in Ze?It(Ut,gt,Qt):gt in Ce?qt(Ut,gt,Qt):(ot(jt),Ce[Ut]=Ue-1,Ze[gt]=Ue-1)}return Oe.filter(jt=>jt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ae,Ce)=>Ae.sortKey-Ce.sortKey)}update(t,n,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,l),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const l=this.lineVertexArray.length;if(t.segment!==void 0){let m=t.dist(n[t.segment+1]),v=t.dist(n[t.segment]);const x={};for(let I=t.segment+1;I<n.length;I++)x[I]={x:n[I].x,y:n[I].y,tileUnitDistanceFromAnchor:m},I<n.length-1&&(m+=n[I+1].dist(n[I]));for(let I=t.segment||0;I>=0;I--)x[I]={x:n[I].x,y:n[I].y,tileUnitDistanceFromAnchor:v},I>0&&(v+=n[I-1].dist(n[I]));for(let I=0;I<n.length;I++){const T=x[I];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(t,n,l,m,v,x,I,T,z,j,Z,X){const J=t.indexArray,re=t.layoutVertexArray,ce=t.segments.prepareSegment(4*n.length,re,J,this.canOverlap?x.sortKey:void 0),Ae=this.glyphOffsetArray.length,Ce=ce.vertexLength,Ze=this.allowVerticalPlacement&&I===g.ah.vertical?Math.PI/2:0,Oe=x.text&&x.text.sections;for(let Ue=0;Ue<n.length;Ue++){const{tl:ot,tr:It,bl:qt,br:pi,tex:jt,pixelOffsetTL:Ft,pixelOffsetBR:Qt,minFontScaleX:Zt,minFontScaleY:Ut,glyphOffset:gt,isSDF:ei,sectionIndex:Kt}=n[Ue],xi=ce.vertexLength,ir=gt[1];xu(re,T.x,T.y,ot.x,ir+ot.y,jt.x,jt.y,l,ei,Ft.x,Ft.y,Zt,Ut),xu(re,T.x,T.y,It.x,ir+It.y,jt.x+jt.w,jt.y,l,ei,Qt.x,Ft.y,Zt,Ut),xu(re,T.x,T.y,qt.x,ir+qt.y,jt.x,jt.y+jt.h,l,ei,Ft.x,Qt.y,Zt,Ut),xu(re,T.x,T.y,pi.x,ir+pi.y,jt.x+jt.w,jt.y+jt.h,l,ei,Qt.x,Qt.y,Zt,Ut),wd(t.dynamicLayoutVertexArray,T,Ze),J.emplaceBack(xi,xi+1,xi+2),J.emplaceBack(xi+1,xi+2,xi+3),ce.vertexLength+=4,ce.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(gt[0]),Ue!==n.length-1&&Kt===n[Ue+1].sectionIndex||t.programConfigurations.populatePaintArrays(re.length,x,x.index,{},X,Oe&&Oe[Kt])}t.placedSymbolArray.emplaceBack(T.x,T.y,Ae,this.glyphOffsetArray.length-Ae,Ce,z,j,T.segment,l?l[0]:0,l?l[1]:0,m[0],m[1],I,0,!1,0,Z)}_addCollisionDebugVertex(t,n,l,m,v,x){return n.emplaceBack(0,0),t.emplaceBack(l.x,l.y,m,v,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(t,n,l,m,v,x,I){const T=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),z=T.vertexLength,j=v.layoutVertexArray,Z=v.collisionVertexArray,X=I.anchorX,J=I.anchorY;this._addCollisionDebugVertex(j,Z,x,X,J,new O(t,n)),this._addCollisionDebugVertex(j,Z,x,X,J,new O(l,n)),this._addCollisionDebugVertex(j,Z,x,X,J,new O(l,m)),this._addCollisionDebugVertex(j,Z,x,X,J,new O(t,m)),T.vertexLength+=4;const re=v.indexArray;re.emplaceBack(z,z+1),re.emplaceBack(z+1,z+2),re.emplaceBack(z+2,z+3),re.emplaceBack(z+3,z),T.primitiveLength+=4}addDebugCollisionBoxes(t,n,l,m){for(let v=t;v<n;v++){const x=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,m?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ad(vn,Af.members,Pr),this.iconCollisionBox=new Ad(vn,Af.members,Pr);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,l,m,v,x,I,T,z){const j={};for(let Z=n;Z<l;Z++){const X=t.get(Z);j.textBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},j.textFeatureIndex=X.featureIndex;break}for(let Z=m;Z<v;Z++){const X=t.get(Z);j.verticalTextBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},j.verticalTextFeatureIndex=X.featureIndex;break}for(let Z=x;Z<I;Z++){const X=t.get(Z);j.iconBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},j.iconFeatureIndex=X.featureIndex;break}for(let Z=T;Z<z;Z++){const X=t.get(Z);j.verticalIconBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},j.verticalIconFeatureIndex=X.featureIndex;break}return j}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const l=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const l=t.placedSymbolArray.get(n),m=l.vertexStartIndex+4*l.numGlyphs;for(let v=l.vertexStartIndex;v<m;v+=4)t.indexArray.emplaceBack(v,v+1,v+2),t.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),l=Math.cos(t),m=[],v=[],x=[];for(let I=0;I<this.symbolInstances.length;++I){x.push(I);const T=this.symbolInstances.get(I);m.push(0|Math.round(n*T.anchorX+l*T.anchorY)),v.push(T.featureIndex)}return x.sort((I,T)=>m[I]-m[T]||v[T]-v[I]),x}addToSortKeyRanges(t,n){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===n?l.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const l=this.symbolInstances.get(n);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((m,v,x)=>{m>=0&&x.indexOf(m)===v&&this.addIndicesForPlacedSymbol(this.text,m)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Vf,Uf;Vt("SymbolBucket",eh,{omit:["layers","collisionBoxArray","features","compareText"]}),eh.MAX_GLYPHS=65535,eh.addDynamicAttributes=wd;var Id={get paint(){return Uf=Uf||new c({"icon-opacity":new hi(te.paint_symbol["icon-opacity"]),"icon-color":new hi(te.paint_symbol["icon-color"]),"icon-halo-color":new hi(te.paint_symbol["icon-halo-color"]),"icon-halo-width":new hi(te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new hi(te.paint_symbol["icon-halo-blur"]),"icon-translate":new Wt(te.paint_symbol["icon-translate"]),"icon-translate-anchor":new Wt(te.paint_symbol["icon-translate-anchor"]),"text-opacity":new hi(te.paint_symbol["text-opacity"]),"text-color":new hi(te.paint_symbol["text-color"],{runtimeType:k,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new hi(te.paint_symbol["text-halo-color"]),"text-halo-width":new hi(te.paint_symbol["text-halo-width"]),"text-halo-blur":new hi(te.paint_symbol["text-halo-blur"]),"text-translate":new Wt(te.paint_symbol["text-translate"]),"text-translate-anchor":new Wt(te.paint_symbol["text-translate-anchor"])})},get layout(){return Vf=Vf||new c({"symbol-placement":new Wt(te.layout_symbol["symbol-placement"]),"symbol-spacing":new Wt(te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Wt(te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new hi(te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Wt(te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Wt(te.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Wt(te.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Wt(te.layout_symbol["icon-ignore-placement"]),"icon-optional":new Wt(te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Wt(te.layout_symbol["icon-rotation-alignment"]),"icon-size":new hi(te.layout_symbol["icon-size"]),"icon-text-fit":new Wt(te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Wt(te.layout_symbol["icon-text-fit-padding"]),"icon-image":new hi(te.layout_symbol["icon-image"]),"icon-rotate":new hi(te.layout_symbol["icon-rotate"]),"icon-padding":new hi(te.layout_symbol["icon-padding"]),"icon-keep-upright":new Wt(te.layout_symbol["icon-keep-upright"]),"icon-offset":new hi(te.layout_symbol["icon-offset"]),"icon-anchor":new hi(te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Wt(te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Wt(te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Wt(te.layout_symbol["text-rotation-alignment"]),"text-field":new hi(te.layout_symbol["text-field"]),"text-font":new hi(te.layout_symbol["text-font"]),"text-size":new hi(te.layout_symbol["text-size"]),"text-max-width":new hi(te.layout_symbol["text-max-width"]),"text-line-height":new Wt(te.layout_symbol["text-line-height"]),"text-letter-spacing":new hi(te.layout_symbol["text-letter-spacing"]),"text-justify":new hi(te.layout_symbol["text-justify"]),"text-radial-offset":new hi(te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Wt(te.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new hi(te.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new hi(te.layout_symbol["text-anchor"]),"text-max-angle":new Wt(te.layout_symbol["text-max-angle"]),"text-writing-mode":new Wt(te.layout_symbol["text-writing-mode"]),"text-rotate":new hi(te.layout_symbol["text-rotate"]),"text-padding":new Wt(te.layout_symbol["text-padding"]),"text-keep-upright":new Wt(te.layout_symbol["text-keep-upright"]),"text-transform":new hi(te.layout_symbol["text-transform"]),"text-offset":new hi(te.layout_symbol["text-offset"]),"text-allow-overlap":new Wt(te.layout_symbol["text-allow-overlap"]),"text-overlap":new Wt(te.layout_symbol["text-overlap"]),"text-ignore-placement":new Wt(te.layout_symbol["text-ignore-placement"]),"text-optional":new Wt(te.layout_symbol["text-optional"])})}};class $f{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:nr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Vt("FormatSectionOverride",$f,{omit:["defaultValue"]});class wu extends r{constructor(t){super(t,Id)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const m=[];for(const v of l)m.indexOf(v)<0&&m.push(v);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,l,m){const v=this.layout.get(t).evaluate(n,{},l,m),x=this._unevaluatedLayout._values[t];return x.isDataDriven()||La(x.value)||!v?v:function(I,T){return T.replace(/{([^{}]+)}/g,(z,j)=>I&&j in I?String(I[j]):"")}(n.properties,v)}createBucket(t){return new eh(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Id.paint.overridableProperties){if(!wu.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),l=new $f(n),m=new fr(l,n.property.specification);let v=null;v=n.value.kind==="constant"||n.value.kind==="source"?new Xr("source",m):new gs("composite",m,n.value.zoomStops),this.paint._values[t]=new xs(n.property,v,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,l){return!(!this.layout||n.isDataDriven()||l.isDataDriven())&&wu.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const l=t.get("text-field"),m=Id.paint.properties[n];let v=!1;const x=I=>{for(const T of I)if(m.overrides&&m.overrides.hasOverride(T))return void(v=!0)};if(l.value.kind==="constant"&&l.value.value instanceof tn)x(l.value.value.sections);else if(l.value.kind==="source"){const I=z=>{v||(z instanceof wn&&Sr(z.value)===Re?x(z.value.sections):z instanceof So?x(z.sections):z.eachChild(I))},T=l.value;T._styleExpression&&I(T._styleExpression.expression)}return v}}let Zf;var ky={get paint(){return Zf=Zf||new c({"background-color":new Wt(te.paint_background["background-color"]),"background-pattern":new b(te.paint_background["background-pattern"]),"background-opacity":new Wt(te.paint_background["background-opacity"])})}};class Ty extends r{constructor(t){super(t,ky)}}let Gf;var Cy={get paint(){return Gf=Gf||new c({"raster-opacity":new Wt(te.paint_raster["raster-opacity"]),"raster-hue-rotate":new Wt(te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Wt(te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Wt(te.paint_raster["raster-brightness-max"]),"raster-saturation":new Wt(te.paint_raster["raster-saturation"]),"raster-contrast":new Wt(te.paint_raster["raster-contrast"]),"raster-resampling":new Wt(te.paint_raster["raster-resampling"]),"raster-fade-duration":new Wt(te.paint_raster["raster-fade-duration"])})}};class Ey extends r{constructor(t){super(t,Cy)}}class My extends r{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class zy{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Pd=63710088e-1;class Kl{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Kl(ct(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,l=this.lat*n,m=t.lat*n,v=Math.sin(l)*Math.sin(m)+Math.cos(l)*Math.cos(m)*Math.cos((t.lng-this.lng)*n);return Pd*Math.acos(Math.min(v,1))}static convert(t){if(t instanceof Kl)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Kl(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Kl(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Wf=2*Math.PI*Pd;function Hf(i){return Wf*Math.cos(i*Math.PI/180)}function Xf(i){return(180+i)/360}function Kf(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Yf(i,t){return i/Hf(t)}function Ld(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Uh{constructor(t,n,l=0){this.x=+t,this.y=+n,this.z=+l}static fromLngLat(t,n=0){const l=Kl.convert(t);return new Uh(Xf(l.lng),Kf(l.lat),Yf(n,l.lat))}toLngLat(){return new Kl(360*this.x-180,Ld(this.y))}toAltitude(){return this.z*Hf(Ld(this.y))}meterInMercatorCoordinateUnits(){return 1/Wf*(t=Ld(this.y),1/Math.cos(t*Math.PI/180));var t}}function Jf(i,t,n){var l=2*Math.PI*6378137/256/Math.pow(2,n);return[i*l-2*Math.PI*6378137/2,t*l-2*Math.PI*6378137/2]}class kd{constructor(t,n,l){if(!function(m,v,x){return!(m<0||m>25||x<0||x>=Math.pow(2,m)||v<0||v>=Math.pow(2,m))}(t,n,l))throw new Error(`x=${n}, y=${l}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=l,this.key=$h(0,t,t,n,l)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,l){const m=(x=this.y,I=this.z,T=Jf(256*(v=this.x),256*(x=Math.pow(2,I)-x-1),I),z=Jf(256*(v+1),256*(x+1),I),T[0]+","+T[1]+","+z[0]+","+z[1]);var v,x,I,T,z;const j=function(Z,X,J){let re,ce="";for(let Ae=Z;Ae>0;Ae--)re=1<<Ae-1,ce+=(X&re?1:0)+(J&re?2:0);return ce}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,j).replace(/{bbox-epsg-3857}/g,m)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new O((t.x*n-this.x)*cr,(t.y*n-this.y)*cr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Qf{constructor(t,n){this.wrap=t,this.canonical=n,this.key=$h(t,n.z,n.z,n.x,n.y)}}class ca{constructor(t,n,l,m,v){if(t<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${l}`);this.overscaledZ=t,this.wrap=n,this.canonical=new kd(l,+m,+v),this.key=$h(n,t,l,m,v)}clone(){return new ca(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new ca(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ca(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-t;return t>this.canonical.z?$h(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):$h(this.wrap*+n,t,t,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new ca(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,l=2*this.canonical.x,m=2*this.canonical.y;return[new ca(n,this.wrap,n,l,m),new ca(n,this.wrap,n,l+1,m),new ca(n,this.wrap,n,l,m+1),new ca(n,this.wrap,n,l+1,m+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new ca(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new ca(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Qf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Uh(t.x-this.wrap,t.y))}}function $h(i,t,n,l,m){(i*=2)<0&&(i=-1*i-1);const v=1<<n;return(v*v*i+v*m+l).toString(36)+n.toString(36)+t.toString(36)}Vt("CanonicalTileID",kd),Vt("OverscaledTileID",ca,{omit:["posMatrix"]});class em{constructor(t,n,l,m=1,v=1,x=1,I=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void Ne(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const T=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=m,this.greenFactor=v,this.blueFactor=x,this.baseShift=I;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let z=0;z<T;z++)this.data[this._idx(-1,z)]=this.data[this._idx(0,z)],this.data[this._idx(T,z)]=this.data[this._idx(T-1,z)],this.data[this._idx(z,-1)]=this.data[this._idx(z,0)],this.data[this._idx(z,T)]=this.data[this._idx(z,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let z=0;z<T;z++)for(let j=0;j<T;j++){const Z=this.get(z,j);Z>this.max&&(this.max=Z),Z<this.min&&(this.min=Z)}}get(t,n){const l=new Uint8Array(this.data.buffer),m=4*this._idx(t,n);return this.unpack(l[m],l[m+1],l[m+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,l){return t*this.redFactor+n*this.greenFactor+l*this.blueFactor-this.baseShift}getPixels(){return new la({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,l){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let m=n*this.dim,v=n*this.dim+this.dim,x=l*this.dim,I=l*this.dim+this.dim;switch(n){case-1:m=v-1;break;case 1:v=m+1}switch(l){case-1:x=I-1;break;case 1:I=x+1}const T=-n*this.dim,z=-l*this.dim;for(let j=x;j<I;j++)for(let Z=m;Z<v;Z++)this.data[this._idx(Z,j)]=t.data[this._idx(Z+T,j+z)]}}Vt("DEMData",em);class tm{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const l=t[n];this._stringToNumber[l]=n,this._numberToString[n]=l}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class im{constructor(t,n,l,m,v){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=l,t._y=m,this.properties=t.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class rm{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Bo(cr,16,0),this.grid3D=new Bo(cr,16,0),this.featureIndexArray=new Wi,this.promoteId=n}insert(t,n,l,m,v,x){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,m,v);const T=x?this.grid3D:this.grid;for(let z=0;z<n.length;z++){const j=n[z],Z=[1/0,1/0,-1/0,-1/0];for(let X=0;X<j.length;X++){const J=j[X];Z[0]=Math.min(Z[0],J.x),Z[1]=Math.min(Z[1],J.y),Z[2]=Math.max(Z[2],J.x),Z[3]=Math.max(Z[3],J.y)}Z[0]<cr&&Z[1]<cr&&Z[2]>=0&&Z[3]>=0&&T.insert(I,Z[0],Z[1],Z[2],Z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Wl.VectorTile(new gd(this.rawTileData)).layers,this.sourceLayerCoder=new tm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,l,m){this.loadVTLayers();const v=t.params||{},x=cr/t.tileSize/t.scale,I=ra(v.filter),T=t.queryGeometry,z=t.queryPadding*x,j=sm(T),Z=this.grid.query(j.minX-z,j.minY-z,j.maxX+z,j.maxY+z),X=sm(t.cameraQueryGeometry),J=this.grid3D.query(X.minX-z,X.minY-z,X.maxX+z,X.maxY+z,(Ae,Ce,Ze,Oe)=>function(Ue,ot,It,qt,pi){for(const Ft of Ue)if(ot<=Ft.x&&It<=Ft.y&&qt>=Ft.x&&pi>=Ft.y)return!0;const jt=[new O(ot,It),new O(ot,pi),new O(qt,pi),new O(qt,It)];if(Ue.length>2){for(const Ft of jt)if(Ho(Ue,Ft))return!0}for(let Ft=0;Ft<Ue.length-1;Ft++)if(Ch(Ue[Ft],Ue[Ft+1],jt))return!0;return!1}(t.cameraQueryGeometry,Ae-z,Ce-z,Ze+z,Oe+z));for(const Ae of J)Z.push(Ae);Z.sort(Ny);const re={};let ce;for(let Ae=0;Ae<Z.length;Ae++){const Ce=Z[Ae];if(Ce===ce)continue;ce=Ce;const Ze=this.featureIndexArray.get(Ce);let Oe=null;this.loadMatchingFeature(re,Ze.bucketIndex,Ze.sourceLayerIndex,Ze.featureIndex,I,v.layers,v.availableImages,n,l,m,(Ue,ot,It)=>(Oe||(Oe=Pl(Ue)),ot.queryIntersectsFeature(T,Ue,It,Oe,this.z,t.transform,x,t.pixelPosMatrix)))}return re}loadMatchingFeature(t,n,l,m,v,x,I,T,z,j,Z){const X=this.bucketLayerIDs[n];if(x&&!function(Ae,Ce){for(let Ze=0;Ze<Ae.length;Ze++)if(Ce.indexOf(Ae[Ze])>=0)return!0;return!1}(x,X))return;const J=this.sourceLayerCoder.decode(l),re=this.vtLayers[J].feature(m);if(v.needGeometry){const Ae=Go(re,!0);if(!v.filter(new Qi(this.tileID.overscaledZ),Ae,this.tileID.canonical))return}else if(!v.filter(new Qi(this.tileID.overscaledZ),re))return;const ce=this.getId(re,J);for(let Ae=0;Ae<X.length;Ae++){const Ce=X[Ae];if(x&&x.indexOf(Ce)<0)continue;const Ze=T[Ce];if(!Ze)continue;let Oe={};ce&&j&&(Oe=j.getState(Ze.sourceLayer||"_geojsonTileLayer",ce));const Ue=Ge({},z[Ce]);Ue.paint=nm(Ue.paint,Ze.paint,re,Oe,I),Ue.layout=nm(Ue.layout,Ze.layout,re,Oe,I);const ot=!Z||Z(re,Ze,Oe);if(!ot)continue;const It=new im(re,this.z,this.x,this.y,ce);It.layer=Ue;let qt=t[Ce];qt===void 0&&(qt=t[Ce]=[]),qt.push({featureIndex:m,feature:It,intersectionZ:ot})}}lookupSymbolFeatures(t,n,l,m,v,x,I,T){const z={};this.loadVTLayers();const j=ra(v);for(const Z of t)this.loadMatchingFeature(z,l,m,Z,j,x,I,T,n);return z}hasLayer(t){for(const n of this.bucketLayerIDs)for(const l of n)if(t===l)return!0;return!1}getId(t,n){let l=t.id;return this.promoteId&&(l=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof l=="boolean"&&(l=Number(l))),l}}function nm(i,t,n,l,m){return Qe(i,(v,x)=>{const I=t instanceof Ea?t.get(x):null;return I&&I.evaluate?I.evaluate(n,l,m):I})}function sm(i){let t=1/0,n=1/0,l=-1/0,m=-1/0;for(const v of i)t=Math.min(t,v.x),n=Math.min(n,v.y),l=Math.max(l,v.x),m=Math.max(m,v.y);return{minX:t,minY:n,maxX:l,maxY:m}}function Ny(i,t){return t-i}function am(i,t,n,l,m){const v=[];for(let x=0;x<i.length;x++){const I=i[x];let T;for(let z=0;z<I.length-1;z++){let j=I[z],Z=I[z+1];j.x<t&&Z.x<t||(j.x<t?j=new O(t,j.y+(t-j.x)/(Z.x-j.x)*(Z.y-j.y))._round():Z.x<t&&(Z=new O(t,j.y+(t-j.x)/(Z.x-j.x)*(Z.y-j.y))._round()),j.y<n&&Z.y<n||(j.y<n?j=new O(j.x+(n-j.y)/(Z.y-j.y)*(Z.x-j.x),n)._round():Z.y<n&&(Z=new O(j.x+(n-j.y)/(Z.y-j.y)*(Z.x-j.x),n)._round()),j.x>=l&&Z.x>=l||(j.x>=l?j=new O(l,j.y+(l-j.x)/(Z.x-j.x)*(Z.y-j.y))._round():Z.x>=l&&(Z=new O(l,j.y+(l-j.x)/(Z.x-j.x)*(Z.y-j.y))._round()),j.y>=m&&Z.y>=m||(j.y>=m?j=new O(j.x+(m-j.y)/(Z.y-j.y)*(Z.x-j.x),m)._round():Z.y>=m&&(Z=new O(j.x+(m-j.y)/(Z.y-j.y)*(Z.x-j.x),m)._round()),T&&j.equals(T[T.length-1])||(T=[j],v.push(T)),T.push(Z)))))}}return v}Vt("FeatureIndex",rm,{omit:["rawTileData","sourceLayerCoder"]});class Yl extends O{constructor(t,n,l,m){super(t,n),this.angle=l,m!==void 0&&(this.segment=m)}clone(){return new Yl(this.x,this.y,this.angle,this.segment)}}function om(i,t,n,l,m){if(t.segment===void 0||n===0)return!0;let v=t,x=t.segment+1,I=0;for(;I>-n/2;){if(x--,x<0)return!1;I-=i[x].dist(v),v=i[x]}I+=i[x].dist(i[x+1]),x++;const T=[];let z=0;for(;I<n/2;){const j=i[x],Z=i[x+1];if(!Z)return!1;let X=i[x-1].angleTo(j)-j.angleTo(Z);for(X=Math.abs((X+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:I,angleDelta:X}),z+=X;I-T[0].distance>l;)z-=T.shift().angleDelta;if(z>m)return!1;x++,I+=j.dist(Z)}return!0}function lm(i){let t=0;for(let n=0;n<i.length-1;n++)t+=i[n].dist(i[n+1]);return t}function cm(i,t,n){return i?.6*t*n:0}function hm(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function Dy(i,t,n,l,m,v){const x=cm(n,m,v),I=hm(n,l)*v;let T=0;const z=lm(i)/2;for(let j=0;j<i.length-1;j++){const Z=i[j],X=i[j+1],J=Z.dist(X);if(T+J>z){const re=(z-T)/J,ce=Gr.number(Z.x,X.x,re),Ae=Gr.number(Z.y,X.y,re),Ce=new Yl(ce,Ae,X.angleTo(Z),j);return Ce._round(),!x||om(i,Ce,I,x,t)?Ce:void 0}T+=J}}function Fy(i,t,n,l,m,v,x,I,T){const z=cm(l,v,x),j=hm(l,m),Z=j*x,X=i[0].x===0||i[0].x===T||i[0].y===0||i[0].y===T;return t-Z<t/4&&(t=Z+t/4),um(i,X?t/2*I%t:(j/2+2*v)*x*I%t,t,z,n,Z,X,!1,T)}function um(i,t,n,l,m,v,x,I,T){const z=v/2,j=lm(i);let Z=0,X=t-n,J=[];for(let re=0;re<i.length-1;re++){const ce=i[re],Ae=i[re+1],Ce=ce.dist(Ae),Ze=Ae.angleTo(ce);for(;X+n<Z+Ce;){X+=n;const Oe=(X-Z)/Ce,Ue=Gr.number(ce.x,Ae.x,Oe),ot=Gr.number(ce.y,Ae.y,Oe);if(Ue>=0&&Ue<T&&ot>=0&&ot<T&&X-z>=0&&X+z<=j){const It=new Yl(Ue,ot,Ze,re);It._round(),l&&!om(i,It,v,l,m)||J.push(It)}}Z+=Ce}return I||J.length||x||(J=um(i,Z/2,n,l,m,v,x,!0,T)),J}Vt("Anchor",Yl);const th=Ss;function dm(i,t,n,l){const m=[],v=i.image,x=v.pixelRatio,I=v.paddedRect.w-2*th,T=v.paddedRect.h-2*th;let z={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const j=v.stretchX||[[0,I]],Z=v.stretchY||[[0,T]],X=(gt,ei)=>gt+ei[1]-ei[0],J=j.reduce(X,0),re=Z.reduce(X,0),ce=I-J,Ae=T-re;let Ce=0,Ze=J,Oe=0,Ue=re,ot=0,It=ce,qt=0,pi=Ae;if(v.content&&l){const gt=v.content,ei=gt[2]-gt[0],Kt=gt[3]-gt[1];(v.textFitWidth||v.textFitHeight)&&(z=Bf(i)),Ce=Su(j,0,gt[0]),Oe=Su(Z,0,gt[1]),Ze=Su(j,gt[0],gt[2]),Ue=Su(Z,gt[1],gt[3]),ot=gt[0]-Ce,qt=gt[1]-Oe,It=ei-Ze,pi=Kt-Ue}const jt=z.x1,Ft=z.y1,Qt=z.x2-jt,Zt=z.y2-Ft,Ut=(gt,ei,Kt,xi)=>{const ir=Au(gt.stretch-Ce,Ze,Qt,jt),tr=Iu(gt.fixed-ot,It,gt.stretch,J),un=Au(ei.stretch-Oe,Ue,Zt,Ft),Ra=Iu(ei.fixed-qt,pi,ei.stretch,re),Pn=Au(Kt.stretch-Ce,Ze,Qt,jt),dn=Iu(Kt.fixed-ot,It,Kt.stretch,J),Jn=Au(xi.stretch-Oe,Ue,Zt,Ft),Qn=Iu(xi.fixed-qt,pi,xi.stretch,re),es=new O(ir,un),Rr=new O(Pn,un),pn=new O(Pn,Jn),Vn=new O(ir,Jn),Ln=new O(tr/x,Ra/x),ts=new O(dn/x,Qn/x),kn=t*Math.PI/180;if(kn){const Hi=Math.sin(kn),hr=Math.cos(kn),gr=[hr,-Hi,Hi,hr];es._matMult(gr),Rr._matMult(gr),Vn._matMult(gr),pn._matMult(gr)}const ha=gt.stretch+gt.fixed,As=ei.stretch+ei.fixed;return{tl:es,tr:Rr,bl:Vn,br:pn,tex:{x:v.paddedRect.x+th+ha,y:v.paddedRect.y+th+As,w:Kt.stretch+Kt.fixed-ha,h:xi.stretch+xi.fixed-As},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ln,pixelOffsetBR:ts,minFontScaleX:It/x/Qt,minFontScaleY:pi/x/Zt,isSDF:n}};if(l&&(v.stretchX||v.stretchY)){const gt=pm(j,ce,J),ei=pm(Z,Ae,re);for(let Kt=0;Kt<gt.length-1;Kt++){const xi=gt[Kt],ir=gt[Kt+1];for(let tr=0;tr<ei.length-1;tr++)m.push(Ut(xi,ei[tr],ir,ei[tr+1]))}}else m.push(Ut({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:T+1}));return m}function Su(i,t,n){let l=0;for(const m of i)l+=Math.max(t,Math.min(n,m[1]))-Math.max(t,Math.min(n,m[0]));return l}function pm(i,t,n){const l=[{fixed:-th,stretch:0}];for(const[m,v]of i){const x=l[l.length-1];l.push({fixed:m-x.stretch,stretch:x.stretch}),l.push({fixed:m-x.stretch,stretch:x.stretch+(v-m)})}return l.push({fixed:t+th,stretch:n}),l}function Au(i,t,n,l){return i/t*n+l}function Iu(i,t,n,l){return i-t*n/l}class Pu{constructor(t,n,l,m,v,x,I,T,z,j){var Z;if(this.boxStartIndex=t.length,z){let X=x.top,J=x.bottom;const re=x.collisionPadding;re&&(X-=re[1],J+=re[3]);let ce=J-X;ce>0&&(ce=Math.max(10,ce),this.circleDiameter=ce)}else{const X=!((Z=x.image)===null||Z===void 0)&&Z.content&&(x.image.textFitWidth||x.image.textFitHeight)?Bf(x):{x1:x.left,y1:x.top,x2:x.right,y2:x.bottom};X.y1=X.y1*I-T[0],X.y2=X.y2*I+T[2],X.x1=X.x1*I-T[3],X.x2=X.x2*I+T[1];const J=x.collisionPadding;if(J&&(X.x1-=J[0]*I,X.y1-=J[1]*I,X.x2+=J[2]*I,X.y2+=J[3]*I),j){const re=new O(X.x1,X.y1),ce=new O(X.x2,X.y1),Ae=new O(X.x1,X.y2),Ce=new O(X.x2,X.y2),Ze=j*Math.PI/180;re._rotate(Ze),ce._rotate(Ze),Ae._rotate(Ze),Ce._rotate(Ze),X.x1=Math.min(re.x,ce.x,Ae.x,Ce.x),X.x2=Math.max(re.x,ce.x,Ae.x,Ce.x),X.y1=Math.min(re.y,ce.y,Ae.y,Ce.y),X.y2=Math.max(re.y,ce.y,Ae.y,Ce.y)}t.emplaceBack(n.x,n.y,X.x1,X.y1,X.x2,X.y2,l,m,v)}this.boxEndIndex=t.length}}class Ry{constructor(t=[],n=(l,m)=>l<m?-1:l>m?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:l}=this,m=n[t];for(;t>0;){const v=t-1>>1,x=n[v];if(l(m,x)>=0)break;n[t]=x,t=v}n[t]=m}_down(t){const{data:n,compare:l}=this,m=this.length>>1,v=n[t];for(;t<m;){let x=1+(t<<1);const I=x+1;if(I<this.length&&l(n[I],n[x])<0&&(x=I),l(n[x],v)>=0)break;n[t]=n[x],t=x}n[t]=v}}function Oy(i,t=1,n=!1){let l=1/0,m=1/0,v=-1/0,x=-1/0;const I=i[0];for(let J=0;J<I.length;J++){const re=I[J];(!J||re.x<l)&&(l=re.x),(!J||re.y<m)&&(m=re.y),(!J||re.x>v)&&(v=re.x),(!J||re.y>x)&&(x=re.y)}const T=Math.min(v-l,x-m);let z=T/2;const j=new Ry([],By);if(T===0)return new O(l,m);for(let J=l;J<v;J+=T)for(let re=m;re<x;re+=T)j.push(new ih(J+z,re+z,z,i));let Z=function(J){let re=0,ce=0,Ae=0;const Ce=J[0];for(let Ze=0,Oe=Ce.length,Ue=Oe-1;Ze<Oe;Ue=Ze++){const ot=Ce[Ze],It=Ce[Ue],qt=ot.x*It.y-It.x*ot.y;ce+=(ot.x+It.x)*qt,Ae+=(ot.y+It.y)*qt,re+=3*qt}return new ih(ce/re,Ae/re,0,J)}(i),X=j.length;for(;j.length;){const J=j.pop();(J.d>Z.d||!Z.d)&&(Z=J,n&&console.log("found best %d after %d probes",Math.round(1e4*J.d)/1e4,X)),J.max-Z.d<=t||(z=J.h/2,j.push(new ih(J.p.x-z,J.p.y-z,z,i)),j.push(new ih(J.p.x+z,J.p.y-z,z,i)),j.push(new ih(J.p.x-z,J.p.y+z,z,i)),j.push(new ih(J.p.x+z,J.p.y+z,z,i)),X+=4)}return n&&(console.log(`num probes: ${X}`),console.log(`best distance: ${Z.d}`)),Z.p}function By(i,t){return t.max-i.max}function ih(i,t,n,l){this.p=new O(i,t),this.h=n,this.d=function(m,v){let x=!1,I=1/0;for(let T=0;T<v.length;T++){const z=v[T];for(let j=0,Z=z.length,X=Z-1;j<Z;X=j++){const J=z[j],re=z[X];J.y>m.y!=re.y>m.y&&m.x<(re.x-J.x)*(m.y-J.y)/(re.y-J.y)+J.x&&(x=!x),I=Math.min(I,Th(m,J,re))}}return(x?1:-1)*Math.sqrt(I)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}var In;g.aq=void 0,(In=g.aq||(g.aq={}))[In.center=1]="center",In[In.left=2]="left",In[In.right=3]="right",In[In.top=4]="top",In[In.bottom=5]="bottom",In[In["top-left"]=6]="top-left",In[In["top-right"]=7]="top-right",In[In["bottom-left"]=8]="bottom-left",In[In["bottom-right"]=9]="bottom-right";const Jl=7,Td=Number.POSITIVE_INFINITY;function fm(i,t){return t[1]!==Td?function(n,l,m){let v=0,x=0;switch(l=Math.abs(l),m=Math.abs(m),n){case"top-right":case"top-left":case"top":x=m-Jl;break;case"bottom-right":case"bottom-left":case"bottom":x=-m+Jl}switch(n){case"top-right":case"bottom-right":case"right":v=-l;break;case"top-left":case"bottom-left":case"left":v=l}return[v,x]}(i,t[0],t[1]):function(n,l){let m=0,v=0;l<0&&(l=0);const x=l/Math.SQRT2;switch(n){case"top-right":case"top-left":v=x-Jl;break;case"bottom-right":case"bottom-left":v=-x+Jl;break;case"bottom":v=-l+Jl;break;case"top":v=l-Jl}switch(n){case"top-right":case"bottom-right":m=-x;break;case"top-left":case"bottom-left":m=x;break;case"left":m=l;break;case"right":m=-l}return[m,v]}(i,t[0])}function mm(i,t,n){var l;const m=i.layout,v=(l=m.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(t,{},n);if(v){const I=v.values,T=[];for(let z=0;z<I.length;z+=2){const j=T[z]=I[z],Z=I[z+1].map(X=>X*Yr);j.startsWith("top")?Z[1]-=Jl:j.startsWith("bottom")&&(Z[1]+=Jl),T[z+1]=Z}return new xn(T)}const x=m.get("text-variable-anchor");if(x){let I;I=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[m.get("text-radial-offset").evaluate(t,{},n)*Yr,Td]:m.get("text-offset").evaluate(t,{},n).map(z=>z*Yr);const T=[];for(const z of x)T.push(z,fm(z,I));return new xn(T)}return null}function Cd(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function jy(i,t,n,l,m,v,x,I,T,z,j){let Z=v.textMaxSize.evaluate(t,{});Z===void 0&&(Z=x);const X=i.layers[0].layout,J=X.get("icon-offset").evaluate(t,{},j),re=ym(n.horizontal),ce=x/24,Ae=i.tilePixelRatio*ce,Ce=i.tilePixelRatio*Z/24,Ze=i.tilePixelRatio*I,Oe=i.tilePixelRatio*X.get("symbol-spacing"),Ue=X.get("text-padding")*i.tilePixelRatio,ot=function(gt,ei,Kt,xi=1){const ir=gt.get("icon-padding").evaluate(ei,{},Kt),tr=ir&&ir.values;return[tr[0]*xi,tr[1]*xi,tr[2]*xi,tr[3]*xi]}(X,t,j,i.tilePixelRatio),It=X.get("text-max-angle")/180*Math.PI,qt=X.get("text-rotation-alignment")!=="viewport"&&X.get("symbol-placement")!=="point",pi=X.get("icon-rotation-alignment")==="map"&&X.get("symbol-placement")!=="point",jt=X.get("symbol-placement"),Ft=Oe/2,Qt=X.get("icon-text-fit");let Zt;l&&Qt!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(Zt=jf(l,n.vertical,Qt,X.get("icon-text-fit-padding"),J,ce)),re&&(l=jf(l,re,Qt,X.get("icon-text-fit-padding"),J,ce)));const Ut=(gt,ei)=>{ei.x<0||ei.x>=cr||ei.y<0||ei.y>=cr||function(Kt,xi,ir,tr,un,Ra,Pn,dn,Jn,Qn,es,Rr,pn,Vn,Ln,ts,kn,ha,As,Hi,hr,gr,Vs,Cr,rh){const Ko=Kt.addToLineVertexArray(xi,ir);let Yo,Oa,ua,bn,Tl=0,Wh=0,xm=0,wm=0,Od=-1,Bd=-1;const Cl={};let Sm=Zl("");if(Kt.allowVerticalPlacement&&tr.vertical){const Un=dn.layout.get("text-rotate").evaluate(hr,{},Cr)+90;ua=new Pu(Jn,xi,Qn,es,Rr,tr.vertical,pn,Vn,Ln,Un),Pn&&(bn=new Pu(Jn,xi,Qn,es,Rr,Pn,kn,ha,Ln,Un))}if(un){const Un=dn.layout.get("icon-rotate").evaluate(hr,{}),da=dn.layout.get("icon-text-fit")!=="none",Ic=dm(un,Un,Vs,da),so=Pn?dm(Pn,Un,Vs,da):void 0;Oa=new Pu(Jn,xi,Qn,es,Rr,un,kn,ha,!1,Un),Tl=4*Ic.length;const Pc=Kt.iconSizeData;let Jo=null;Pc.kind==="source"?(Jo=[Xo*dn.layout.get("icon-size").evaluate(hr,{})],Jo[0]>Xl&&Ne(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${Vh}. Reduce your "icon-size".`)):Pc.kind==="composite"&&(Jo=[Xo*gr.compositeIconSizes[0].evaluate(hr,{},Cr),Xo*gr.compositeIconSizes[1].evaluate(hr,{},Cr)],(Jo[0]>Xl||Jo[1]>Xl)&&Ne(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${Vh}. Reduce your "icon-size".`)),Kt.addSymbols(Kt.icon,Ic,Jo,Hi,As,hr,g.ah.none,xi,Ko.lineStartIndex,Ko.lineLength,-1,Cr),Od=Kt.icon.placedSymbolArray.length-1,so&&(Wh=4*so.length,Kt.addSymbols(Kt.icon,so,Jo,Hi,As,hr,g.ah.vertical,xi,Ko.lineStartIndex,Ko.lineLength,-1,Cr),Bd=Kt.icon.placedSymbolArray.length-1)}const Am=Object.keys(tr.horizontal);for(const Un of Am){const da=tr.horizontal[Un];if(!Yo){Sm=Zl(da.text);const so=dn.layout.get("text-rotate").evaluate(hr,{},Cr);Yo=new Pu(Jn,xi,Qn,es,Rr,da,pn,Vn,Ln,so)}const Ic=da.positionedLines.length===1;if(xm+=gm(Kt,xi,da,Ra,dn,Ln,hr,ts,Ko,tr.vertical?g.ah.horizontal:g.ah.horizontalOnly,Ic?Am:[Un],Cl,Od,gr,Cr),Ic)break}tr.vertical&&(wm+=gm(Kt,xi,tr.vertical,Ra,dn,Ln,hr,ts,Ko,g.ah.vertical,["vertical"],Cl,Bd,gr,Cr));const Uy=Yo?Yo.boxStartIndex:Kt.collisionBoxArray.length,$y=Yo?Yo.boxEndIndex:Kt.collisionBoxArray.length,Zy=ua?ua.boxStartIndex:Kt.collisionBoxArray.length,Gy=ua?ua.boxEndIndex:Kt.collisionBoxArray.length,Wy=Oa?Oa.boxStartIndex:Kt.collisionBoxArray.length,Hy=Oa?Oa.boxEndIndex:Kt.collisionBoxArray.length,Xy=bn?bn.boxStartIndex:Kt.collisionBoxArray.length,Ky=bn?bn.boxEndIndex:Kt.collisionBoxArray.length;let no=-1;const ku=(Un,da)=>Un&&Un.circleDiameter?Math.max(Un.circleDiameter,da):da;no=ku(Yo,no),no=ku(ua,no),no=ku(Oa,no),no=ku(bn,no);const Im=no>-1?1:0;Im&&(no*=rh/Yr),Kt.glyphOffsetArray.length>=eh.MAX_GLYPHS&&Ne("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),hr.sortKey!==void 0&&Kt.addToSortKeyRanges(Kt.symbolInstances.length,hr.sortKey);const Yy=mm(dn,hr,Cr),[Jy,Qy]=function(Un,da){const Ic=Un.length,so=da==null?void 0:da.values;if((so==null?void 0:so.length)>0)for(let Pc=0;Pc<so.length;Pc+=2){const Jo=so[Pc+1];Un.emplaceBack(g.aq[so[Pc]],Jo[0],Jo[1])}return[Ic,Un.length]}(Kt.textAnchorOffsets,Yy);Kt.symbolInstances.emplaceBack(xi.x,xi.y,Cl.right>=0?Cl.right:-1,Cl.center>=0?Cl.center:-1,Cl.left>=0?Cl.left:-1,Cl.vertical||-1,Od,Bd,Sm,Uy,$y,Zy,Gy,Wy,Hy,Xy,Ky,Qn,xm,wm,Tl,Wh,Im,0,pn,no,Jy,Qy)}(i,ei,gt,n,l,m,Zt,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,Ae,[Ue,Ue,Ue,Ue],qt,T,Ze,ot,pi,J,t,v,z,j,x)};if(jt==="line")for(const gt of am(t.geometry,0,0,cr,cr)){const ei=Fy(gt,Oe,It,n.vertical||re,l,24,Ce,i.overscaling,cr);for(const Kt of ei)re&&qy(i,re.text,Ft,Kt)||Ut(gt,Kt)}else if(jt==="line-center"){for(const gt of t.geometry)if(gt.length>1){const ei=Dy(gt,It,n.vertical||re,l,24,Ce);ei&&Ut(gt,ei)}}else if(t.type==="Polygon")for(const gt of Ts(t.geometry,0)){const ei=Oy(gt,16);Ut(gt[0],new Yl(ei.x,ei.y,0))}else if(t.type==="LineString")for(const gt of t.geometry)Ut(gt,new Yl(gt[0].x,gt[0].y,0));else if(t.type==="Point")for(const gt of t.geometry)for(const ei of gt)Ut([ei],new Yl(ei.x,ei.y,0))}function gm(i,t,n,l,m,v,x,I,T,z,j,Z,X,J,re){const ce=function(Ze,Oe,Ue,ot,It,qt,pi,jt){const Ft=ot.layout.get("text-rotate").evaluate(qt,{})*Math.PI/180,Qt=[];for(const Zt of Oe.positionedLines)for(const Ut of Zt.positionedGlyphs){if(!Ut.rect)continue;const gt=Ut.rect||{};let ei=Mf+1,Kt=!0,xi=1,ir=0;const tr=(It||jt)&&Ut.vertical,un=Ut.metrics.advance*Ut.scale/2;if(jt&&Oe.verticalizable&&(ir=Zt.lineOffset/2-(Ut.imageName?-(Yr-Ut.metrics.width*Ut.scale)/2:(Ut.scale-1)*Yr)),Ut.imageName){const Hi=pi[Ut.imageName];Kt=Hi.sdf,xi=Hi.pixelRatio,ei=Ss/xi}const Ra=It?[Ut.x+un,Ut.y]:[0,0];let Pn=It?[0,0]:[Ut.x+un+Ue[0],Ut.y+Ue[1]-ir],dn=[0,0];tr&&(dn=Pn,Pn=[0,0]);const Jn=Ut.metrics.isDoubleResolution?2:1,Qn=(Ut.metrics.left-ei)*Ut.scale-un+Pn[0],es=(-Ut.metrics.top-ei)*Ut.scale+Pn[1],Rr=Qn+gt.w/Jn*Ut.scale/xi,pn=es+gt.h/Jn*Ut.scale/xi,Vn=new O(Qn,es),Ln=new O(Rr,es),ts=new O(Qn,pn),kn=new O(Rr,pn);if(tr){const Hi=new O(-un,un-jh),hr=-Math.PI/2,gr=Yr/2-un,Vs=new O(5-jh-gr,-(Ut.imageName?gr:0)),Cr=new O(...dn);Vn._rotateAround(hr,Hi)._add(Vs)._add(Cr),Ln._rotateAround(hr,Hi)._add(Vs)._add(Cr),ts._rotateAround(hr,Hi)._add(Vs)._add(Cr),kn._rotateAround(hr,Hi)._add(Vs)._add(Cr)}if(Ft){const Hi=Math.sin(Ft),hr=Math.cos(Ft),gr=[hr,-Hi,Hi,hr];Vn._matMult(gr),Ln._matMult(gr),ts._matMult(gr),kn._matMult(gr)}const ha=new O(0,0),As=new O(0,0);Qt.push({tl:Vn,tr:Ln,bl:ts,br:kn,tex:gt,writingMode:Oe.writingMode,glyphOffset:Ra,sectionIndex:Ut.sectionIndex,isSDF:Kt,pixelOffsetTL:ha,pixelOffsetBR:As,minFontScaleX:0,minFontScaleY:0})}return Qt}(0,n,I,m,v,x,l,i.allowVerticalPlacement),Ae=i.textSizeData;let Ce=null;Ae.kind==="source"?(Ce=[Xo*m.layout.get("text-size").evaluate(x,{})],Ce[0]>Xl&&Ne(`${i.layerIds[0]}: Value for "text-size" is >= ${Vh}. Reduce your "text-size".`)):Ae.kind==="composite"&&(Ce=[Xo*J.compositeTextSizes[0].evaluate(x,{},re),Xo*J.compositeTextSizes[1].evaluate(x,{},re)],(Ce[0]>Xl||Ce[1]>Xl)&&Ne(`${i.layerIds[0]}: Value for "text-size" is >= ${Vh}. Reduce your "text-size".`)),i.addSymbols(i.text,ce,Ce,I,v,x,z,t,T.lineStartIndex,T.lineLength,X,re);for(const Ze of j)Z[Ze]=i.text.placedSymbolArray.length-1;return 4*ce.length}function ym(i){for(const t in i)return i[t];return null}function qy(i,t,n,l){const m=i.compareText;if(t in m){const v=m[t];for(let x=v.length-1;x>=0;x--)if(l.dist(v[x])<n)return!0}else m[t]=[];return m[t].push(l),!1}const _m=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ed{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,l]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=l>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const v=_m[15&l];if(!v)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(t,2,1),[I]=new Uint32Array(t,4,1);return new Ed(I,x,v,t)}constructor(t,n=64,l=Float64Array,m){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=l,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const v=_m.indexOf(this.ArrayType),x=2*t*this.ArrayType.BYTES_PER_ELEMENT,I=t*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-I%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${l}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+I+T,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+x+I+T),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+I+T,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=t,this.coords[this._pos++]=n,l}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Md(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,l,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:x,nodeSize:I}=this,T=[0,v.length-1,0],z=[];for(;T.length;){const j=T.pop()||0,Z=T.pop()||0,X=T.pop()||0;if(Z-X<=I){for(let Ae=X;Ae<=Z;Ae++){const Ce=x[2*Ae],Ze=x[2*Ae+1];Ce>=t&&Ce<=l&&Ze>=n&&Ze<=m&&z.push(v[Ae])}continue}const J=X+Z>>1,re=x[2*J],ce=x[2*J+1];re>=t&&re<=l&&ce>=n&&ce<=m&&z.push(v[J]),(j===0?t<=re:n<=ce)&&(T.push(X),T.push(J-1),T.push(1-j)),(j===0?l>=re:m>=ce)&&(T.push(J+1),T.push(Z),T.push(1-j))}return z}within(t,n,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:v,nodeSize:x}=this,I=[0,m.length-1,0],T=[],z=l*l;for(;I.length;){const j=I.pop()||0,Z=I.pop()||0,X=I.pop()||0;if(Z-X<=x){for(let Ae=X;Ae<=Z;Ae++)bm(v[2*Ae],v[2*Ae+1],t,n)<=z&&T.push(m[Ae]);continue}const J=X+Z>>1,re=v[2*J],ce=v[2*J+1];bm(re,ce,t,n)<=z&&T.push(m[J]),(j===0?t-l<=re:n-l<=ce)&&(I.push(X),I.push(J-1),I.push(1-j)),(j===0?t+l>=re:n+l>=ce)&&(I.push(J+1),I.push(Z),I.push(1-j))}return T}}function Md(i,t,n,l,m,v){if(m-l<=n)return;const x=l+m>>1;vm(i,t,x,l,m,v),Md(i,t,n,l,x-1,1-v),Md(i,t,n,x+1,m,1-v)}function vm(i,t,n,l,m,v){for(;m>l;){if(m-l>600){const z=m-l+1,j=n-l+1,Z=Math.log(z),X=.5*Math.exp(2*Z/3),J=.5*Math.sqrt(Z*X*(z-X)/z)*(j-z/2<0?-1:1);vm(i,t,n,Math.max(l,Math.floor(n-j*X/z+J)),Math.min(m,Math.floor(n+(z-j)*X/z+J)),v)}const x=t[2*n+v];let I=l,T=m;for(Zh(i,t,l,n),t[2*m+v]>x&&Zh(i,t,l,m);I<T;){for(Zh(i,t,I,T),I++,T--;t[2*I+v]<x;)I++;for(;t[2*T+v]>x;)T--}t[2*l+v]===x?Zh(i,t,l,T):(T++,Zh(i,t,T,m)),T<=n&&(l=T+1),n<=T&&(m=T-1)}}function Zh(i,t,n,l){zd(i,n,l),zd(t,2*n,2*l),zd(t,2*n+1,2*l+1)}function zd(i,t,n){const l=i[t];i[t]=i[n],i[n]=l}function bm(i,t,n,l){const m=i-n,v=t-l;return m*m+v*v}var Nd;g.bg=void 0,(Nd=g.bg||(g.bg={})).create="create",Nd.load="load",Nd.fullLoad="fullLoad";let Lu=null,Gh=[];const Dd=1e3/60,Fd="loadTime",Rd="fullLoadTime",Vy={mark(i){performance.mark(i)},frame(i){const t=i;Lu!=null&&Gh.push(t-Lu),Lu=t},clearMetrics(){Lu=null,Gh=[],performance.clearMeasures(Fd),performance.clearMeasures(Rd);for(const i in g.bg)performance.clearMarks(g.bg[i])},getPerformanceMetrics(){performance.measure(Fd,g.bg.create,g.bg.load),performance.measure(Rd,g.bg.create,g.bg.fullLoad);const i=performance.getEntriesByName(Fd)[0].duration,t=performance.getEntriesByName(Rd)[0].duration,n=Gh.length,l=1/(Gh.reduce((v,x)=>v+x,0)/n/1e3),m=Gh.filter(v=>v>Dd).reduce((v,x)=>v+(x-Dd)/Dd,0);return{loadTime:i,fullLoadTime:t,fps:l,percentDroppedFrames:m/(n+m)*100,totalFrames:n}}};g.$=class extends R{},g.A=Hc,g.B=wh,g.C=function(i){if(it==null){const t=i.navigator?i.navigator.userAgent:null;it=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return it},g.D=Wt,g.E=ht,g.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new zy(()=>this.process()),this.subscription=function(n,l,m,v){return n.addEventListener(l,m,!1),{unsubscribe:()=>{n.removeEventListener(l,m,!1)}}}(this.target,"message",n=>this.receive(n)),this.globalScope=et(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((n,l)=>{const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[m]={resolve:n,reject:l},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[m];const I={id:m,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(I)},{once:!0});const v=[],x=Object.assign(Object.assign({},i),{id:m,sourceMapId:this.mapId,origin:location.origin,data:jo(i.data,v)});this.target.postMessage(x,{transfer:v})})}receive(i){const t=i.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const l=this.abortControllers[n];return delete this.abortControllers[n],void(l&&l.abort())}if(et(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return a(this,void 0,void 0,function*(){if(t.type==="<response>"){const m=this.resolveRejects[i];return delete this.resolveRejects[i],m?void(t.error?m.reject(eo(t.error)):m.resolve(eo(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=eo(t.data),l=new AbortController;this.abortControllers[i]=l;try{const m=yield this.messageHandlers[t.type](t.sourceMapId,n,l);this.completeTask(i,null,m)}catch(m){this.completeTask(i,m)}})}completeTask(i,t,n){const l=[];delete this.abortControllers[i];const m={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?jo(t):null,data:jo(n,l)};this.target.postMessage(m,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},g.G=qe,g.H=function(){var i=new Hc(16);return Hc!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},g.I=_d,g.J=function(i,t,n){var l,m,v,x,I,T,z,j,Z,X,J,re,ce=n[0],Ae=n[1],Ce=n[2];return t===i?(i[12]=t[0]*ce+t[4]*Ae+t[8]*Ce+t[12],i[13]=t[1]*ce+t[5]*Ae+t[9]*Ce+t[13],i[14]=t[2]*ce+t[6]*Ae+t[10]*Ce+t[14],i[15]=t[3]*ce+t[7]*Ae+t[11]*Ce+t[15]):(m=t[1],v=t[2],x=t[3],I=t[4],T=t[5],z=t[6],j=t[7],Z=t[8],X=t[9],J=t[10],re=t[11],i[0]=l=t[0],i[1]=m,i[2]=v,i[3]=x,i[4]=I,i[5]=T,i[6]=z,i[7]=j,i[8]=Z,i[9]=X,i[10]=J,i[11]=re,i[12]=l*ce+I*Ae+Z*Ce+t[12],i[13]=m*ce+T*Ae+X*Ce+t[13],i[14]=v*ce+z*Ae+J*Ce+t[14],i[15]=x*ce+j*Ae+re*Ce+t[15]),i},g.K=function(i,t,n){var l=n[0],m=n[1],v=n[2];return i[0]=t[0]*l,i[1]=t[1]*l,i[2]=t[2]*l,i[3]=t[3]*l,i[4]=t[4]*m,i[5]=t[5]*m,i[6]=t[6]*m,i[7]=t[7]*m,i[8]=t[8]*v,i[9]=t[9]*v,i[10]=t[10]*v,i[11]=t[11]*v,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},g.L=Qp,g.M=function(i,t){const n={};for(let l=0;l<t.length;l++){const m=t[l];m in i&&(n[m]=i[m])}return n},g.N=Kl,g.O=Xf,g.P=O,g.Q=Kf,g.R=la,g.S=ca,g.T=$l,g.U=ue,g.V=Se,g.W=at,g.X=cr,g.Y=w,g.Z=Uh,g._=a,g.a=ke,g.a$=function(i,t){var n=i[0],l=i[1],m=i[2],v=i[3],x=i[4],I=i[5],T=i[6],z=i[7],j=i[8],Z=i[9],X=i[10],J=i[11],re=i[12],ce=i[13],Ae=i[14],Ce=i[15],Ze=t[0],Oe=t[1],Ue=t[2],ot=t[3],It=t[4],qt=t[5],pi=t[6],jt=t[7],Ft=t[8],Qt=t[9],Zt=t[10],Ut=t[11],gt=t[12],ei=t[13],Kt=t[14],xi=t[15];return Math.abs(n-Ze)<=Yn*Math.max(1,Math.abs(n),Math.abs(Ze))&&Math.abs(l-Oe)<=Yn*Math.max(1,Math.abs(l),Math.abs(Oe))&&Math.abs(m-Ue)<=Yn*Math.max(1,Math.abs(m),Math.abs(Ue))&&Math.abs(v-ot)<=Yn*Math.max(1,Math.abs(v),Math.abs(ot))&&Math.abs(x-It)<=Yn*Math.max(1,Math.abs(x),Math.abs(It))&&Math.abs(I-qt)<=Yn*Math.max(1,Math.abs(I),Math.abs(qt))&&Math.abs(T-pi)<=Yn*Math.max(1,Math.abs(T),Math.abs(pi))&&Math.abs(z-jt)<=Yn*Math.max(1,Math.abs(z),Math.abs(jt))&&Math.abs(j-Ft)<=Yn*Math.max(1,Math.abs(j),Math.abs(Ft))&&Math.abs(Z-Qt)<=Yn*Math.max(1,Math.abs(Z),Math.abs(Qt))&&Math.abs(X-Zt)<=Yn*Math.max(1,Math.abs(X),Math.abs(Zt))&&Math.abs(J-Ut)<=Yn*Math.max(1,Math.abs(J),Math.abs(Ut))&&Math.abs(re-gt)<=Yn*Math.max(1,Math.abs(re),Math.abs(gt))&&Math.abs(ce-ei)<=Yn*Math.max(1,Math.abs(ce),Math.abs(ei))&&Math.abs(Ae-Kt)<=Yn*Math.max(1,Math.abs(Ae),Math.abs(Kt))&&Math.abs(Ce-xi)<=Yn*Math.max(1,Math.abs(Ce),Math.abs(xi))},g.a0=Ri,g.a1=kd,g.a2=yt,g.a3=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(n=>{t.onloadstart=()=>{n(t)};for(const l of i){const m=window.document.createElement("source");Tt(l)||(t.crossOrigin="Anonymous"),m.src=l,t.appendChild(m)}})},g.a4=function(){return De++},g.a5=Et,g.a6=eh,g.a7=ra,g.a8=Go,g.a9=im,g.aA=function(i){if(i.type==="custom")return new My(i);switch(i.type){case"background":return new Ty(i);case"circle":return new g1(i);case"fill":return new z1(i);case"fill-extrusion":return new H1(i);case"heatmap":return new _1(i);case"hillshade":return new b1(i);case"line":return new iy(i);case"raster":return new Ey(i);case"symbol":return new wu(i)}},g.aB=pe,g.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let n=[];try{if(!ft(i.version,t.version))return[{command:"setStyle",args:[t]}];ft(i.center,t.center)||n.push({command:"setCenter",args:[t.center]}),ft(i.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),ft(i.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),ft(i.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),ft(i.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),ft(i.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),ft(i.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),ft(i.light,t.light)||n.push({command:"setLight",args:[t.light]}),ft(i.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),ft(i.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),ft(i.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const l={},m=[];(function(x,I,T,z){let j;for(j in I=I||{},x=x||{})Object.prototype.hasOwnProperty.call(x,j)&&(Object.prototype.hasOwnProperty.call(I,j)||Dt(j,T,z));for(j in I)Object.prototype.hasOwnProperty.call(I,j)&&(Object.prototype.hasOwnProperty.call(x,j)?ft(x[j],I[j])||(x[j].type==="geojson"&&I[j].type==="geojson"&&ii(x,I,j)?Pt(T,{command:"setGeoJSONSourceData",args:[j,I[j].data]}):Yt(j,I,T,z)):Bt(j,I,T))})(i.sources,t.sources,m,l);const v=[];i.layers&&i.layers.forEach(x=>{"source"in x&&l[x.source]?n.push({command:"removeLayer",args:[x.id]}):v.push(x)}),n=n.concat(m),function(x,I,T){I=I||[];const z=(x=x||[]).map(Pi),j=I.map(Pi),Z=x.reduce(Ni,{}),X=I.reduce(Ni,{}),J=z.slice(),re=Object.create(null);let ce,Ae,Ce,Ze,Oe;for(let Ue=0,ot=0;Ue<z.length;Ue++)ce=z[Ue],Object.prototype.hasOwnProperty.call(X,ce)?ot++:(Pt(T,{command:"removeLayer",args:[ce]}),J.splice(J.indexOf(ce,ot),1));for(let Ue=0,ot=0;Ue<j.length;Ue++)ce=j[j.length-1-Ue],J[J.length-1-Ue]!==ce&&(Object.prototype.hasOwnProperty.call(Z,ce)?(Pt(T,{command:"removeLayer",args:[ce]}),J.splice(J.lastIndexOf(ce,J.length-ot),1)):ot++,Ze=J[J.length-Ue],Pt(T,{command:"addLayer",args:[X[ce],Ze]}),J.splice(J.length-Ue,0,ce),re[ce]=!0);for(let Ue=0;Ue<j.length;Ue++)if(ce=j[Ue],Ae=Z[ce],Ce=X[ce],!re[ce]&&!ft(Ae,Ce))if(ft(Ae.source,Ce.source)&&ft(Ae["source-layer"],Ce["source-layer"])&&ft(Ae.type,Ce.type)){for(Oe in ui(Ae.layout,Ce.layout,T,ce,null,"setLayoutProperty"),ui(Ae.paint,Ce.paint,T,ce,null,"setPaintProperty"),ft(Ae.filter,Ce.filter)||Pt(T,{command:"setFilter",args:[ce,Ce.filter]}),ft(Ae.minzoom,Ce.minzoom)&&ft(Ae.maxzoom,Ce.maxzoom)||Pt(T,{command:"setLayerZoomRange",args:[ce,Ce.minzoom,Ce.maxzoom]}),Ae)Object.prototype.hasOwnProperty.call(Ae,Oe)&&Oe!=="layout"&&Oe!=="paint"&&Oe!=="filter"&&Oe!=="metadata"&&Oe!=="minzoom"&&Oe!=="maxzoom"&&(Oe.indexOf("paint.")===0?ui(Ae[Oe],Ce[Oe],T,ce,Oe.slice(6),"setPaintProperty"):ft(Ae[Oe],Ce[Oe])||Pt(T,{command:"setLayerProperty",args:[ce,Oe,Ce[Oe]]}));for(Oe in Ce)Object.prototype.hasOwnProperty.call(Ce,Oe)&&!Object.prototype.hasOwnProperty.call(Ae,Oe)&&Oe!=="layout"&&Oe!=="paint"&&Oe!=="filter"&&Oe!=="metadata"&&Oe!=="minzoom"&&Oe!=="maxzoom"&&(Oe.indexOf("paint.")===0?ui(Ae[Oe],Ce[Oe],T,ce,Oe.slice(6),"setPaintProperty"):ft(Ae[Oe],Ce[Oe])||Pt(T,{command:"setLayerProperty",args:[ce,Oe,Ce[Oe]]}))}else Pt(T,{command:"removeLayer",args:[ce]}),Ze=J[J.lastIndexOf(ce)+1],Pt(T,{command:"addLayer",args:[Ce,Ze]})}(v,t.layers,n)}catch(l){console.warn("Unable to compute style diff:",l),n=[{command:"setStyle",args:[t]}]}return n},g.aD=function(i){const t=[],n=i.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},g.aE=function i(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let l=0;l<t.length;l++)if(!i(t[l],n[l]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const l in t)if(!i(t[l],n[l]))return!1;return!0}return t===n},g.aF=Qe,g.aG=pt,g.aH=class extends $o{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},g.aI=vc,g.aJ=class extends $o{constructor(i,t){super(i,t),this.current=xc}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},g.aK=bc,g.aL=Vc,g.aM=$i,g.aN=class extends $o{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},g.aO=class extends $o{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},g.aP=function(i,t,n,l,m,v,x){var I=1/(t-n),T=1/(l-m),z=1/(v-x);return i[0]=-2*I,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*T,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*z,i[11]=0,i[12]=(t+n)*I,i[13]=(m+l)*T,i[14]=(x+v)*z,i[15]=1,i},g.aQ=m1,g.aR=class extends _e{},g.aS=ay,g.aT=class extends Te{},g.aU=ad,g.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},g.aW=sf,g.aX=mr,g.aY=cn,g.aZ=class extends At{},g.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},g.aa=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,l,m,v)=>{const x=m||v;return t[l]=!x||x.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},g.ab=function(i,t){const n=[];for(const l in i)l in t||n.push(l);return n},g.ac=Je,g.ad=function(i,t,n){var l=Math.sin(n),m=Math.cos(n),v=t[0],x=t[1],I=t[2],T=t[3],z=t[4],j=t[5],Z=t[6],X=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=v*m+z*l,i[1]=x*m+j*l,i[2]=I*m+Z*l,i[3]=T*m+X*l,i[4]=z*m-v*l,i[5]=j*m-x*l,i[6]=Z*m-I*l,i[7]=X*m-T*l,i},g.ae=function(i){var t=new Hc(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},g.af=pu,g.ag=function(i,t){let n=0,l=0;if(i.kind==="constant")l=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:m,minZoom:v,maxZoom:x}=i,I=m?Je(oi.interpolationFactor(m,t,v,x),0,1):0;i.kind==="camera"?l=Gr.number(i.minSize,i.maxSize,I):n=I}return{uSizeT:n,uSize:l}},g.ai=function(i,{uSize:t,uSizeT:n},{lowerSize:l,upperSize:m}){return i.kind==="source"?l/Xo:i.kind==="composite"?Gr.number(l/Xo,m/Xo,n):t},g.aj=wd,g.ak=function(i,t,n,l){const m=t.y-i.y,v=t.x-i.x,x=l.y-n.y,I=l.x-n.x,T=x*v-I*m;if(T===0)return null;const z=(I*(i.y-n.y)-x*(i.x-n.x))/T;return new O(i.x+z*v,i.y+z*m)},g.al=am,g.am=Zc,g.an=rd,g.ao=function(i){let t=1/0,n=1/0,l=-1/0,m=-1/0;for(const v of i)t=Math.min(t,v.x),n=Math.min(n,v.y),l=Math.max(l,v.x),m=Math.max(m,v.y);return[t,n,l,m]},g.ap=Yr,g.ar=xd,g.as=function(i,t){var n=t[0],l=t[1],m=t[2],v=t[3],x=t[4],I=t[5],T=t[6],z=t[7],j=t[8],Z=t[9],X=t[10],J=t[11],re=t[12],ce=t[13],Ae=t[14],Ce=t[15],Ze=n*I-l*x,Oe=n*T-m*x,Ue=n*z-v*x,ot=l*T-m*I,It=l*z-v*I,qt=m*z-v*T,pi=j*ce-Z*re,jt=j*Ae-X*re,Ft=j*Ce-J*re,Qt=Z*Ae-X*ce,Zt=Z*Ce-J*ce,Ut=X*Ce-J*Ae,gt=Ze*Ut-Oe*Zt+Ue*Qt+ot*Ft-It*jt+qt*pi;return gt?(i[0]=(I*Ut-T*Zt+z*Qt)*(gt=1/gt),i[1]=(m*Zt-l*Ut-v*Qt)*gt,i[2]=(ce*qt-Ae*It+Ce*ot)*gt,i[3]=(X*It-Z*qt-J*ot)*gt,i[4]=(T*Ft-x*Ut-z*jt)*gt,i[5]=(n*Ut-m*Ft+v*jt)*gt,i[6]=(Ae*Ue-re*qt-Ce*Oe)*gt,i[7]=(j*qt-X*Ue+J*Oe)*gt,i[8]=(x*Zt-I*Ft+z*pi)*gt,i[9]=(l*Ft-n*Zt-v*pi)*gt,i[10]=(re*It-ce*Ue+Ce*Ze)*gt,i[11]=(Z*Ue-j*It-J*Ze)*gt,i[12]=(I*jt-x*Qt-T*pi)*gt,i[13]=(n*Qt-l*jt+m*pi)*gt,i[14]=(ce*Oe-re*ot-Ae*Ze)*gt,i[15]=(j*ot-Z*Oe+X*Ze)*gt,i):null},g.at=Cd,g.au=bd,g.av=Ed,g.aw=function(){const i={},t=te.$version;for(const n in te.$root){const l=te.$root[n];if(l.required){let m=null;m=n==="version"?t:l.type==="array"?[]:{},m!=null&&(i[n]=m)}}return i},g.ax=Bs,g.ay=Ke,g.az=function(i){i=i.slice();const t=Object.create(null);for(let n=0;n<i.length;n++)t[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=Ht(i[n],t[i[n].ref]));return i},g.b=nt,g.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},g.b1=function(i,t,n){return i[0]=t[0]*n[0],i[1]=t[1]*n[1],i[2]=t[2]*n[2],i[3]=t[3]*n[3],i},g.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},g.b3=ct,g.b4=Qf,g.b5=Yf,g.b6=function(i,t,n,l,m){var v,x=1/Math.tan(t/2);return i[0]=x/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=x,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,m!=null&&m!==1/0?(i[10]=(m+l)*(v=1/(l-m)),i[14]=2*m*l*v):(i[10]=-1,i[14]=-2*l),i},g.b7=function(i,t,n){var l=Math.sin(n),m=Math.cos(n),v=t[4],x=t[5],I=t[6],T=t[7],z=t[8],j=t[9],Z=t[10],X=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=v*m+z*l,i[5]=x*m+j*l,i[6]=I*m+Z*l,i[7]=T*m+X*l,i[8]=z*m-v*l,i[9]=j*m-x*l,i[10]=Z*m-I*l,i[11]=X*m-T*l,i},g.b8=ze,g.b9=Ye,g.bA=If,g.bB=function(i){return i.message===ie},g.bC=Nr,g.bD=On,g.ba=function(i){return i*Math.PI/180},g.bb=function(i,t){const{x:n,y:l}=Uh.fromLngLat(t);return!(i<0||i>25||l<0||l>=1||n<0||n>=1)},g.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},g.bd=class extends M{},g.be=Pd,g.bf=Vy,g.bh=$e,g.bi=function(i,t){ke.REGISTERED_PROTOCOLS[i]=t},g.bj=function(i){delete ke.REGISTERED_PROTOCOLS[i]},g.bk=function(i,t){const n={};for(let m=0;m<i.length;m++){const v=t&&t[i[m].id]||Ir(i[m]);t&&(t[i[m].id]=v);let x=n[v];x||(x=n[v]=[]),x.push(i[m])}const l=[];for(const m in n)l.push(n[m]);return l},g.bl=Vt,g.bm=tm,g.bn=rm,g.bo=Nf,g.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=cr/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],n=t.layout,l=t._unevaluatedLayout._values,m={layoutIconSize:l["icon-size"].possiblyEvaluate(new Qi(i.bucket.zoom+1),i.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new Qi(i.bucket.zoom+1),i.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new Qi(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:z,maxZoom:j}=i.bucket.textSizeData;m.compositeTextSizes=[l["text-size"].possiblyEvaluate(new Qi(z),i.canonical),l["text-size"].possiblyEvaluate(new Qi(j),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:z,maxZoom:j}=i.bucket.iconSizeData;m.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new Qi(z),i.canonical),l["icon-size"].possiblyEvaluate(new Qi(j),i.canonical)]}const v=n.get("text-line-height")*Yr,x=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",I=n.get("text-keep-upright"),T=n.get("text-size");for(const z of i.bucket.features){const j=n.get("text-font").evaluate(z,{},i.canonical).join(","),Z=T.evaluate(z,{},i.canonical),X=m.layoutTextSize.evaluate(z,{},i.canonical),J=m.layoutIconSize.evaluate(z,{},i.canonical),re={horizontal:{},vertical:void 0},ce=z.text;let Ae,Ce=[0,0];if(ce){const Ue=ce.toString(),ot=n.get("text-letter-spacing").evaluate(z,{},i.canonical)*Yr,It=Sh(Ue)?ot:0,qt=n.get("text-anchor").evaluate(z,{},i.canonical),pi=mm(t,z,i.canonical);if(!pi){const Zt=n.get("text-radial-offset").evaluate(z,{},i.canonical);Ce=Zt?fm(qt,[Zt*Yr,Td]):n.get("text-offset").evaluate(z,{},i.canonical).map(Ut=>Ut*Yr)}let jt=x?"center":n.get("text-justify").evaluate(z,{},i.canonical);const Ft=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(z,{},i.canonical)*Yr:1/0,Qt=()=>{i.bucket.allowVerticalPlacement&&mc(Ue)&&(re.vertical=vu(ce,i.glyphMap,i.glyphPositions,i.imagePositions,j,Ft,v,qt,"left",It,Ce,g.ah.vertical,!0,X,Z))};if(!x&&pi){const Zt=new Set;if(jt==="auto")for(let gt=0;gt<pi.values.length;gt+=2)Zt.add(Cd(pi.values[gt]));else Zt.add(jt);let Ut=!1;for(const gt of Zt)if(!re.horizontal[gt])if(Ut)re.horizontal[gt]=re.horizontal[0];else{const ei=vu(ce,i.glyphMap,i.glyphPositions,i.imagePositions,j,Ft,v,"center",gt,It,Ce,g.ah.horizontal,!1,X,Z);ei&&(re.horizontal[gt]=ei,Ut=ei.positionedLines.length===1)}Qt()}else{jt==="auto"&&(jt=Cd(qt));const Zt=vu(ce,i.glyphMap,i.glyphPositions,i.imagePositions,j,Ft,v,qt,jt,It,Ce,g.ah.horizontal,!1,X,Z);Zt&&(re.horizontal[jt]=Zt),Qt(),mc(Ue)&&x&&I&&(re.vertical=vu(ce,i.glyphMap,i.glyphPositions,i.imagePositions,j,Ft,v,qt,jt,It,Ce,g.ah.vertical,!1,X,Z))}}let Ze=!1;if(z.icon&&z.icon.name){const Ue=i.imageMap[z.icon.name];Ue&&(Ae=Ay(i.imagePositions[z.icon.name],n.get("icon-offset").evaluate(z,{},i.canonical),n.get("icon-anchor").evaluate(z,{},i.canonical)),Ze=!!Ue.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=Ze:i.bucket.sdfIcons!==Ze&&Ne("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ue.pixelRatio!==i.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const Oe=ym(re.horizontal)||re.vertical;i.bucket.iconsInText=!!Oe&&Oe.iconsInText,(Oe||Ae)&&jy(i.bucket,z,re,Ae,i.imageMap,m,X,J,Ce,Ze,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},g.bq=fd,g.br=ud,g.bs=pd,g.bt=Wl,g.bu=gd,g.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},g.bw=function(i,t,n,l,m){return a(this,void 0,void 0,function*(){if(Se())try{return yield at(i,t,n,l,m)}catch{}return function(v,x,I,T,z){const j=v.width,Z=v.height;dt&&Mt||(dt=new OffscreenCanvas(j,Z),Mt=dt.getContext("2d",{willReadFrequently:!0})),dt.width=j,dt.height=Z,Mt.drawImage(v,0,0,j,Z);const X=Mt.getImageData(x,I,T,z);return Mt.clearRect(0,0,j,Z),X.data}(i,t,n,l,m)})},g.bx=em,g.by=C,g.bz=F,g.c=xe,g.d=i=>a(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),g.e=Ge,g.f=i=>new Promise((t,n)=>{const l=new Image;l.onload=()=>{t(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame(()=>{l.src=Xe})},l.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const m=new Blob([new Uint8Array(i)],{type:"image/png"});l.src=i.byteLength?URL.createObjectURL(m):Xe}),g.g=Fe,g.h=(i,t)=>tt(Ge(i,{type:"json"}),t),g.i=et,g.j=ti,g.k=zt,g.l=(i,t)=>tt(Ge(i,{type:"arrayBuffer"}),t),g.m=tt,g.n=function(i){return new gd(i).readFields(yy,[])},g.o=zh,g.p=zf,g.q=c,g.r=_l,g.s=Tt,g.t=fc,g.u=na,g.v=te,g.w=Ne,g.x=function([i,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(n),y:i*Math.sin(t)*Math.sin(n),z:i*Math.cos(n)}},g.y=Gr,g.z=Qi}),y("worker",["./shared"],function(g){class a{constructor(B){this.keyCache={},B&&this.replace(B)}replace(B){this._layerConfigs={},this._layers={},this.update(B,[])}update(B,q){for(const ne of B){this._layerConfigs[ne.id]=ne;const ge=this._layers[ne.id]=g.aA(ne);ge._featureFilter=g.a7(ge.filter),this.keyCache[ne.id]&&delete this.keyCache[ne.id]}for(const ne of q)delete this.keyCache[ne],delete this._layerConfigs[ne],delete this._layers[ne];this.familiesBySource={};const Y=g.bk(Object.values(this._layerConfigs),this.keyCache);for(const ne of Y){const ge=ne.map(je=>this._layers[je.id]),ve=ge[0];if(ve.visibility==="none")continue;const we=ve.source||"";let be=this.familiesBySource[we];be||(be=this.familiesBySource[we]={});const He=ve.sourceLayer||"_geojsonTileLayer";let st=be[He];st||(st=be[He]=[]),st.push(ge)}}}class C{constructor(B){const q={},Y=[];for(const we in B){const be=B[we],He=q[we]={};for(const st in be){const je=be[+st];if(!je||je.bitmap.width===0||je.bitmap.height===0)continue;const xt={x:0,y:0,w:je.bitmap.width+2,h:je.bitmap.height+2};Y.push(xt),He[st]={rect:xt,metrics:je.metrics}}}const{w:ne,h:ge}=g.p(Y),ve=new g.o({width:ne||1,height:ge||1});for(const we in B){const be=B[we];for(const He in be){const st=be[+He];if(!st||st.bitmap.width===0||st.bitmap.height===0)continue;const je=q[we][He].rect;g.o.copy(st.bitmap,ve,{x:0,y:0},{x:je.x+1,y:je.y+1},st.bitmap)}}this.image=ve,this.positions=q}}g.bl("GlyphAtlas",C);class F{constructor(B){this.tileID=new g.S(B.tileID.overscaledZ,B.tileID.wrap,B.tileID.canonical.z,B.tileID.canonical.x,B.tileID.canonical.y),this.uid=B.uid,this.zoom=B.zoom,this.pixelRatio=B.pixelRatio,this.tileSize=B.tileSize,this.source=B.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=B.showCollisionBoxes,this.collectResourceTiming=!!B.collectResourceTiming,this.returnDependencies=!!B.returnDependencies,this.promoteId=B.promoteId,this.inFlightDependencies=[]}parse(B,q,Y,ne){return g._(this,void 0,void 0,function*(){this.status="parsing",this.data=B,this.collisionBoxArray=new g.a5;const ge=new g.bm(Object.keys(B.layers).sort()),ve=new g.bn(this.tileID,this.promoteId);ve.bucketLayerIDs=[];const we={},be={featureIndex:ve,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Y},He=q.familiesBySource[this.source];for(const _i in He){const qi=B.layers[_i];if(!qi)continue;qi.version===1&&g.w(`Vector tile source "${this.source}" layer "${_i}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ki=ge.encode(_i),vr=[];for(let wr=0;wr<qi.length;wr++){const zr=qi.feature(wr),Xs=ve.getId(zr,_i);vr.push({feature:zr,id:Xs,index:wr,sourceLayerIndex:Ki})}for(const wr of He[_i]){const zr=wr[0];zr.source!==this.source&&g.w(`layer.source = ${zr.source} does not equal this.source = ${this.source}`),zr.minzoom&&this.zoom<Math.floor(zr.minzoom)||zr.maxzoom&&this.zoom>=zr.maxzoom||zr.visibility!=="none"&&(U(wr,this.zoom,Y),(we[zr.id]=zr.createBucket({index:ve.bucketLayerIDs.length,layers:wr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ki,sourceID:this.source})).populate(vr,be,this.tileID.canonical),ve.bucketLayerIDs.push(wr.map(Xs=>Xs.id)))}}const st=g.aF(be.glyphDependencies,_i=>Object.keys(_i).map(Number));this.inFlightDependencies.forEach(_i=>_i==null?void 0:_i.abort()),this.inFlightDependencies=[];let je=Promise.resolve({});if(Object.keys(st).length){const _i=new AbortController;this.inFlightDependencies.push(_i),je=ne.sendAsync({type:"GG",data:{stacks:st,source:this.source,tileID:this.tileID,type:"glyphs"}},_i)}const xt=Object.keys(be.iconDependencies);let Ot=Promise.resolve({});if(xt.length){const _i=new AbortController;this.inFlightDependencies.push(_i),Ot=ne.sendAsync({type:"GI",data:{icons:xt,source:this.source,tileID:this.tileID,type:"icons"}},_i)}const Xt=Object.keys(be.patternDependencies);let bi=Promise.resolve({});if(Xt.length){const _i=new AbortController;this.inFlightDependencies.push(_i),bi=ne.sendAsync({type:"GI",data:{icons:Xt,source:this.source,tileID:this.tileID,type:"patterns"}},_i)}const[ri,wi,yi]=yield Promise.all([je,Ot,bi]),Xi=new C(ri),Ui=new g.bo(wi,yi);for(const _i in we){const qi=we[_i];qi instanceof g.a6?(U(qi.layers,this.zoom,Y),g.bp({bucket:qi,glyphMap:ri,glyphPositions:Xi.positions,imageMap:wi,imagePositions:Ui.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):qi.hasPattern&&(qi instanceof g.bq||qi instanceof g.br||qi instanceof g.bs)&&(U(qi.layers,this.zoom,Y),qi.addFeatures(be,this.tileID.canonical,Ui.patternPositions))}return this.status="done",{buckets:Object.values(we).filter(_i=>!_i.isEmpty()),featureIndex:ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Xi.image,imageAtlas:Ui,glyphMap:this.returnDependencies?ri:null,iconMap:this.returnDependencies?wi:null,glyphPositions:this.returnDependencies?Xi.positions:null}})}}function U(ee,B,q){const Y=new g.z(B);for(const ne of ee)ne.recalculate(Y,q)}class O{constructor(B,q,Y){this.actor=B,this.layerIndex=q,this.availableImages=Y,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(B,q){return g._(this,void 0,void 0,function*(){const Y=yield g.l(B.request,q);try{return{vectorTile:new g.bt.VectorTile(new g.bu(Y.data)),rawData:Y.data,cacheControl:Y.cacheControl,expires:Y.expires}}catch(ne){const ge=new Uint8Array(Y.data);let ve=`Unable to parse the tile at ${B.request.url}, `;throw ve+=ge[0]===31&&ge[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ne.message}`,new Error(ve)}})}loadTile(B){return g._(this,void 0,void 0,function*(){const q=B.uid,Y=!!(B&&B.request&&B.request.collectResourceTiming)&&new g.bv(B.request),ne=new F(B);this.loading[q]=ne;const ge=new AbortController;ne.abort=ge;try{const ve=yield this.loadVectorTile(B,ge);if(delete this.loading[q],!ve)return null;const we=ve.rawData,be={};ve.expires&&(be.expires=ve.expires),ve.cacheControl&&(be.cacheControl=ve.cacheControl);const He={};if(Y){const je=Y.finish();je&&(He.resourceTiming=JSON.parse(JSON.stringify(je)))}ne.vectorTile=ve.vectorTile;const st=ne.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[q]=ne,this.fetching[q]={rawTileData:we,cacheControl:be,resourceTiming:He};try{const je=yield st;return g.e({rawTileData:we.slice(0)},je,be,He)}finally{delete this.fetching[q]}}catch(ve){throw delete this.loading[q],ne.status="done",this.loaded[q]=ne,ve}})}reloadTile(B){return g._(this,void 0,void 0,function*(){const q=B.uid;if(!this.loaded||!this.loaded[q])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Y=this.loaded[q];if(Y.showCollisionBoxes=B.showCollisionBoxes,Y.status==="parsing"){const ne=yield Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor);let ge;if(this.fetching[q]){const{rawTileData:ve,cacheControl:we,resourceTiming:be}=this.fetching[q];delete this.fetching[q],ge=g.e({rawTileData:ve.slice(0)},ne,we,be)}else ge=ne;return ge}if(Y.status==="done"&&Y.vectorTile)return Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(B){return g._(this,void 0,void 0,function*(){const q=this.loading,Y=B.uid;q&&q[Y]&&q[Y].abort&&(q[Y].abort.abort(),delete q[Y])})}removeTile(B){return g._(this,void 0,void 0,function*(){this.loaded&&this.loaded[B.uid]&&delete this.loaded[B.uid]})}}class ${constructor(){this.loaded={}}loadTile(B){return g._(this,void 0,void 0,function*(){const{uid:q,encoding:Y,rawImageData:ne,redFactor:ge,greenFactor:ve,blueFactor:we,baseShift:be}=B,He=ne.width+2,st=ne.height+2,je=g.b(ne)?new g.R({width:He,height:st},yield g.bw(ne,-1,-1,He,st)):ne,xt=new g.bx(q,je,Y,ge,ve,we,be);return this.loaded=this.loaded||{},this.loaded[q]=xt,xt})}removeTile(B){const q=this.loaded,Y=B.uid;q&&q[Y]&&delete q[Y]}}function V(ee,B){if(ee.length!==0){ye(ee[0],B);for(var q=1;q<ee.length;q++)ye(ee[q],!B)}}function ye(ee,B){for(var q=0,Y=0,ne=0,ge=ee.length,ve=ge-1;ne<ge;ve=ne++){var we=(ee[ne][0]-ee[ve][0])*(ee[ve][1]+ee[ne][1]),be=q+we;Y+=Math.abs(q)>=Math.abs(we)?q-be+we:we-be+q,q=be}q+Y>=0!=!!B&&ee.reverse()}var de=g.by(function ee(B,q){var Y,ne=B&&B.type;if(ne==="FeatureCollection")for(Y=0;Y<B.features.length;Y++)ee(B.features[Y],q);else if(ne==="GeometryCollection")for(Y=0;Y<B.geometries.length;Y++)ee(B.geometries[Y],q);else if(ne==="Feature")ee(B.geometry,q);else if(ne==="Polygon")V(B.coordinates,q);else if(ne==="MultiPolygon")for(Y=0;Y<B.coordinates.length;Y++)V(B.coordinates[Y],q);return B});const Pe=g.bt.VectorTileFeature.prototype.toGeoJSON;var ue={exports:{}},Se=g.bz,ze=g.bt.VectorTileFeature,Ye=Je;function Je(ee,B){this.options=B||{},this.features=ee,this.length=ee.length}function ct(ee,B){this.id=typeof ee.id=="number"?ee.id:void 0,this.type=ee.type,this.rawGeometry=ee.type===1?[ee.geometry]:ee.geometry,this.properties=ee.tags,this.extent=B||4096}Je.prototype.feature=function(ee){return new ct(this.features[ee],this.options.extent)},ct.prototype.loadGeometry=function(){var ee=this.rawGeometry;this.geometry=[];for(var B=0;B<ee.length;B++){for(var q=ee[B],Y=[],ne=0;ne<q.length;ne++)Y.push(new Se(q[ne][0],q[ne][1]));this.geometry.push(Y)}return this.geometry},ct.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ee=this.geometry,B=1/0,q=-1/0,Y=1/0,ne=-1/0,ge=0;ge<ee.length;ge++)for(var ve=ee[ge],we=0;we<ve.length;we++){var be=ve[we];B=Math.min(B,be.x),q=Math.max(q,be.x),Y=Math.min(Y,be.y),ne=Math.max(ne,be.y)}return[B,Y,q,ne]},ct.prototype.toGeoJSON=ze.prototype.toGeoJSON;var Ge=g.bA,De=Ye;function Qe(ee){var B=new Ge;return function(q,Y){for(var ne in q.layers)Y.writeMessage(3,pt,q.layers[ne])}(ee,B),B.finish()}function pt(ee,B){var q;B.writeVarintField(15,ee.version||1),B.writeStringField(1,ee.name||""),B.writeVarintField(5,ee.extent||4096);var Y={keys:[],values:[],keycache:{},valuecache:{}};for(q=0;q<ee.length;q++)Y.feature=ee.feature(q),B.writeMessage(2,pe,Y);var ne=Y.keys;for(q=0;q<ne.length;q++)B.writeStringField(3,ne[q]);var ge=Y.values;for(q=0;q<ge.length;q++)B.writeMessage(4,it,ge[q])}function pe(ee,B){var q=ee.feature;q.id!==void 0&&B.writeVarintField(1,q.id),B.writeMessage(2,me,ee),B.writeVarintField(3,q.type),B.writeMessage(4,et,q)}function me(ee,B){var q=ee.feature,Y=ee.keys,ne=ee.values,ge=ee.keycache,ve=ee.valuecache;for(var we in q.properties){var be=q.properties[we],He=ge[we];if(be!==null){He===void 0&&(Y.push(we),ge[we]=He=Y.length-1),B.writeVarint(He);var st=typeof be;st!=="string"&&st!=="boolean"&&st!=="number"&&(be=JSON.stringify(be));var je=st+":"+be,xt=ve[je];xt===void 0&&(ne.push(be),ve[je]=xt=ne.length-1),B.writeVarint(xt)}}}function Ne(ee,B){return(B<<3)+(7&ee)}function Le(ee){return ee<<1^ee>>31}function et(ee,B){for(var q=ee.loadGeometry(),Y=ee.type,ne=0,ge=0,ve=q.length,we=0;we<ve;we++){var be=q[we],He=1;Y===1&&(He=be.length),B.writeVarint(Ne(1,He));for(var st=Y===3?be.length-1:be.length,je=0;je<st;je++){je===1&&Y!==1&&B.writeVarint(Ne(2,st-1));var xt=be[je].x-ne,Ot=be[je].y-ge;B.writeVarint(Le(xt)),B.writeVarint(Le(Ot)),ne+=xt,ge+=Ot}Y===3&&B.writeVarint(Ne(7,1))}}function it(ee,B){var q=typeof ee;q==="string"?B.writeStringField(1,ee):q==="boolean"?B.writeBooleanField(7,ee):q==="number"&&(ee%1!=0?B.writeDoubleField(3,ee):ee<0?B.writeSVarintField(6,ee):B.writeVarintField(5,ee))}ue.exports=Qe,ue.exports.fromVectorTileJs=Qe,ue.exports.fromGeojsonVt=function(ee,B){B=B||{};var q={};for(var Y in ee)q[Y]=new De(ee[Y].features,B),q[Y].name=Y,q[Y].version=B.version,q[Y].extent=B.extent;return Qe({layers:q})},ue.exports.GeoJSONWrapper=De;var nt=g.by(ue.exports);const Xe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ee=>ee},at=Math.fround||(dt=new Float32Array(1),ee=>(dt[0]=+ee,dt[0]));var dt;const Mt=3,ie=5,xe=6;class ke{constructor(B){this.options=Object.assign(Object.create(Xe),B),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(B){const{log:q,minZoom:Y,maxZoom:ne}=this.options;q&&console.time("total time");const ge=`prepare ${B.length} points`;q&&console.time(ge),this.points=B;const ve=[];for(let be=0;be<B.length;be++){const He=B[be];if(!He.geometry)continue;const[st,je]=He.geometry.coordinates,xt=at($e(st)),Ot=at(Ke(je));ve.push(xt,Ot,1/0,be,-1,1),this.options.reduce&&ve.push(0)}let we=this.trees[ne+1]=this._createTree(ve);q&&console.timeEnd(ge);for(let be=ne;be>=Y;be--){const He=+Date.now();we=this.trees[be]=this._createTree(this._cluster(we,be)),q&&console.log("z%d: %d clusters in %dms",be,we.numItems,+Date.now()-He)}return q&&console.timeEnd("total time"),this}getClusters(B,q){let Y=((B[0]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,B[1]));let ge=B[2]===180?180:((B[2]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)Y=-180,ge=180;else if(Y>ge){const je=this.getClusters([Y,ne,180,ve],q),xt=this.getClusters([-180,ne,ge,ve],q);return je.concat(xt)}const we=this.trees[this._limitZoom(q)],be=we.range($e(Y),Ke(ve),$e(ge),Ke(ne)),He=we.data,st=[];for(const je of be){const xt=this.stride*je;st.push(He[xt+ie]>1?Fe(He,xt,this.clusterProps):this.points[He[xt+Mt]])}return st}getChildren(B){const q=this._getOriginId(B),Y=this._getOriginZoom(B),ne="No cluster with the specified id.",ge=this.trees[Y];if(!ge)throw new Error(ne);const ve=ge.data;if(q*this.stride>=ve.length)throw new Error(ne);const we=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),be=ge.within(ve[q*this.stride],ve[q*this.stride+1],we),He=[];for(const st of be){const je=st*this.stride;ve[je+4]===B&&He.push(ve[je+ie]>1?Fe(ve,je,this.clusterProps):this.points[ve[je+Mt]])}if(He.length===0)throw new Error(ne);return He}getLeaves(B,q,Y){const ne=[];return this._appendLeaves(ne,B,q=q||10,Y=Y||0,0),ne}getTile(B,q,Y){const ne=this.trees[this._limitZoom(B)],ge=Math.pow(2,B),{extent:ve,radius:we}=this.options,be=we/ve,He=(Y-be)/ge,st=(Y+1+be)/ge,je={features:[]};return this._addTileFeatures(ne.range((q-be)/ge,He,(q+1+be)/ge,st),ne.data,q,Y,ge,je),q===0&&this._addTileFeatures(ne.range(1-be/ge,He,1,st),ne.data,ge,Y,ge,je),q===ge-1&&this._addTileFeatures(ne.range(0,He,be/ge,st),ne.data,-1,Y,ge,je),je.features.length?je:null}getClusterExpansionZoom(B){let q=this._getOriginZoom(B)-1;for(;q<=this.options.maxZoom;){const Y=this.getChildren(B);if(q++,Y.length!==1)break;B=Y[0].properties.cluster_id}return q}_appendLeaves(B,q,Y,ne,ge){const ve=this.getChildren(q);for(const we of ve){const be=we.properties;if(be&&be.cluster?ge+be.point_count<=ne?ge+=be.point_count:ge=this._appendLeaves(B,be.cluster_id,Y,ne,ge):ge<ne?ge++:B.push(we),B.length===Y)break}return ge}_createTree(B){const q=new g.av(B.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Y=0;Y<B.length;Y+=this.stride)q.add(B[Y],B[Y+1]);return q.finish(),q.data=B,q}_addTileFeatures(B,q,Y,ne,ge,ve){for(const we of B){const be=we*this.stride,He=q[be+ie]>1;let st,je,xt;if(He)st=qe(q,be,this.clusterProps),je=q[be],xt=q[be+1];else{const bi=this.points[q[be+Mt]];st=bi.properties;const[ri,wi]=bi.geometry.coordinates;je=$e(ri),xt=Ke(wi)}const Ot={type:1,geometry:[[Math.round(this.options.extent*(je*ge-Y)),Math.round(this.options.extent*(xt*ge-ne))]],tags:st};let Xt;Xt=He||this.options.generateId?q[be+Mt]:this.points[q[be+Mt]].id,Xt!==void 0&&(Ot.id=Xt),ve.features.push(Ot)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(Math.floor(+B),this.options.maxZoom+1))}_cluster(B,q){const{radius:Y,extent:ne,reduce:ge,minPoints:ve}=this.options,we=Y/(ne*Math.pow(2,q)),be=B.data,He=[],st=this.stride;for(let je=0;je<be.length;je+=st){if(be[je+2]<=q)continue;be[je+2]=q;const xt=be[je],Ot=be[je+1],Xt=B.within(be[je],be[je+1],we),bi=be[je+ie];let ri=bi;for(const wi of Xt){const yi=wi*st;be[yi+2]>q&&(ri+=be[yi+ie])}if(ri>bi&&ri>=ve){let wi,yi=xt*bi,Xi=Ot*bi,Ui=-1;const _i=((je/st|0)<<5)+(q+1)+this.points.length;for(const qi of Xt){const Ki=qi*st;if(be[Ki+2]<=q)continue;be[Ki+2]=q;const vr=be[Ki+ie];yi+=be[Ki]*vr,Xi+=be[Ki+1]*vr,be[Ki+4]=_i,ge&&(wi||(wi=this._map(be,je,!0),Ui=this.clusterProps.length,this.clusterProps.push(wi)),ge(wi,this._map(be,Ki)))}be[je+4]=_i,He.push(yi/ri,Xi/ri,1/0,_i,-1,ri),ge&&He.push(Ui)}else{for(let wi=0;wi<st;wi++)He.push(be[je+wi]);if(ri>1)for(const wi of Xt){const yi=wi*st;if(!(be[yi+2]<=q)){be[yi+2]=q;for(let Xi=0;Xi<st;Xi++)He.push(be[yi+Xi])}}}}return He}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,q,Y){if(B[q+ie]>1){const ve=this.clusterProps[B[q+xe]];return Y?Object.assign({},ve):ve}const ne=this.points[B[q+Mt]].properties,ge=this.options.map(ne);return Y&&ge===ne?Object.assign({},ge):ge}}function Fe(ee,B,q){return{type:"Feature",id:ee[B+Mt],properties:qe(ee,B,q),geometry:{type:"Point",coordinates:[(Y=ee[B],360*(Y-.5)),tt(ee[B+1])]}};var Y}function qe(ee,B,q){const Y=ee[B+ie],ne=Y>=1e4?`${Math.round(Y/1e3)}k`:Y>=1e3?Math.round(Y/100)/10+"k":Y,ge=ee[B+xe],ve=ge===-1?{}:Object.assign({},q[ge]);return Object.assign(ve,{cluster:!0,cluster_id:ee[B+Mt],point_count:Y,point_count_abbreviated:ne})}function $e(ee){return ee/360+.5}function Ke(ee){const B=Math.sin(ee*Math.PI/180),q=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return q<0?0:q>1?1:q}function tt(ee){const B=(180-360*ee)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function Tt(ee,B,q,Y){let ne=Y;const ge=B+(q-B>>1);let ve,we=q-B;const be=ee[B],He=ee[B+1],st=ee[q],je=ee[q+1];for(let xt=B+3;xt<q;xt+=3){const Ot=kt(ee[xt],ee[xt+1],be,He,st,je);if(Ot>ne)ve=xt,ne=Ot;else if(Ot===ne){const Xt=Math.abs(xt-ge);Xt<we&&(ve=xt,we=Xt)}}ne>Y&&(ve-B>3&&Tt(ee,B,ve,Y),ee[ve+2]=ne,q-ve>3&&Tt(ee,ve,q,Y))}function kt(ee,B,q,Y,ne,ge){let ve=ne-q,we=ge-Y;if(ve!==0||we!==0){const be=((ee-q)*ve+(B-Y)*we)/(ve*ve+we*we);be>1?(q=ne,Y=ge):be>0&&(q+=ve*be,Y+=we*be)}return ve=ee-q,we=B-Y,ve*ve+we*we}function Nt(ee,B,q,Y){const ne={id:ee??null,type:B,geometry:q,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(B==="Point"||B==="MultiPoint"||B==="LineString")zt(ne,q);else if(B==="Polygon")zt(ne,q[0]);else if(B==="MultiLineString")for(const ge of q)zt(ne,ge);else if(B==="MultiPolygon")for(const ge of q)zt(ne,ge[0]);return ne}function zt(ee,B){for(let q=0;q<B.length;q+=3)ee.minX=Math.min(ee.minX,B[q]),ee.minY=Math.min(ee.minY,B[q+1]),ee.maxX=Math.max(ee.maxX,B[q]),ee.maxY=Math.max(ee.maxY,B[q+1])}function ti(ee,B,q,Y){if(!B.geometry)return;const ne=B.geometry.coordinates;if(ne&&ne.length===0)return;const ge=B.geometry.type,ve=Math.pow(q.tolerance/((1<<q.maxZoom)*q.extent),2);let we=[],be=B.id;if(q.promoteId?be=B.properties[q.promoteId]:q.generateId&&(be=Y||0),ge==="Point")ht(ne,we);else if(ge==="MultiPoint")for(const He of ne)ht(He,we);else if(ge==="LineString")te(ne,we,ve,!1);else if(ge==="MultiLineString"){if(q.lineMetrics){for(const He of ne)we=[],te(He,we,ve,!1),ee.push(Nt(be,"LineString",we,B.properties));return}gi(ne,we,ve,!1)}else if(ge==="Polygon")gi(ne,we,ve,!0);else{if(ge!=="MultiPolygon"){if(ge==="GeometryCollection"){for(const He of B.geometry.geometries)ti(ee,{id:be,geometry:He,properties:B.properties},q,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const He of ne){const st=[];gi(He,st,ve,!0),we.push(st)}}ee.push(Nt(be,ge,we,B.properties))}function ht(ee,B){B.push(Ht(ee[0]),ft(ee[1]),0)}function te(ee,B,q,Y){let ne,ge,ve=0;for(let be=0;be<ee.length;be++){const He=Ht(ee[be][0]),st=ft(ee[be][1]);B.push(He,st,0),be>0&&(ve+=Y?(ne*st-He*ge)/2:Math.sqrt(Math.pow(He-ne,2)+Math.pow(st-ge,2))),ne=He,ge=st}const we=B.length-3;B[2]=1,Tt(B,0,we,q),B[we+2]=1,B.size=Math.abs(ve),B.start=0,B.end=B.size}function gi(ee,B,q,Y){for(let ne=0;ne<ee.length;ne++){const ge=[];te(ee[ne],ge,q,Y),B.push(ge)}}function Ht(ee){return ee/360+.5}function ft(ee){const B=Math.sin(ee*Math.PI/180),q=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return q<0?0:q>1?1:q}function Pt(ee,B,q,Y,ne,ge,ve,we){if(Y/=B,ge>=(q/=B)&&ve<Y)return ee;if(ve<q||ge>=Y)return null;const be=[];for(const He of ee){const st=He.geometry;let je=He.type;const xt=ne===0?He.minX:He.minY,Ot=ne===0?He.maxX:He.maxY;if(xt>=q&&Ot<Y){be.push(He);continue}if(Ot<q||xt>=Y)continue;let Xt=[];if(je==="Point"||je==="MultiPoint")Bt(st,Xt,q,Y,ne);else if(je==="LineString")Dt(st,Xt,q,Y,ne,!1,we.lineMetrics);else if(je==="MultiLineString")ii(st,Xt,q,Y,ne,!1);else if(je==="Polygon")ii(st,Xt,q,Y,ne,!0);else if(je==="MultiPolygon")for(const bi of st){const ri=[];ii(bi,ri,q,Y,ne,!0),ri.length&&Xt.push(ri)}if(Xt.length){if(we.lineMetrics&&je==="LineString"){for(const bi of Xt)be.push(Nt(He.id,je,bi,He.tags));continue}je!=="LineString"&&je!=="MultiLineString"||(Xt.length===1?(je="LineString",Xt=Xt[0]):je="MultiLineString"),je!=="Point"&&je!=="MultiPoint"||(je=Xt.length===3?"Point":"MultiPoint"),be.push(Nt(He.id,je,Xt,He.tags))}}return be.length?be:null}function Bt(ee,B,q,Y,ne){for(let ge=0;ge<ee.length;ge+=3){const ve=ee[ge+ne];ve>=q&&ve<=Y&&ui(B,ee[ge],ee[ge+1],ee[ge+2])}}function Dt(ee,B,q,Y,ne,ge,ve){let we=Yt(ee);const be=ne===0?Pi:Ni;let He,st,je=ee.start;for(let ri=0;ri<ee.length-3;ri+=3){const wi=ee[ri],yi=ee[ri+1],Xi=ee[ri+2],Ui=ee[ri+3],_i=ee[ri+4],qi=ne===0?wi:yi,Ki=ne===0?Ui:_i;let vr=!1;ve&&(He=Math.sqrt(Math.pow(wi-Ui,2)+Math.pow(yi-_i,2))),qi<q?Ki>q&&(st=be(we,wi,yi,Ui,_i,q),ve&&(we.start=je+He*st)):qi>Y?Ki<Y&&(st=be(we,wi,yi,Ui,_i,Y),ve&&(we.start=je+He*st)):ui(we,wi,yi,Xi),Ki<q&&qi>=q&&(st=be(we,wi,yi,Ui,_i,q),vr=!0),Ki>Y&&qi<=Y&&(st=be(we,wi,yi,Ui,_i,Y),vr=!0),!ge&&vr&&(ve&&(we.end=je+He*st),B.push(we),we=Yt(ee)),ve&&(je+=He)}let xt=ee.length-3;const Ot=ee[xt],Xt=ee[xt+1],bi=ne===0?Ot:Xt;bi>=q&&bi<=Y&&ui(we,Ot,Xt,ee[xt+2]),xt=we.length-3,ge&&xt>=3&&(we[xt]!==we[0]||we[xt+1]!==we[1])&&ui(we,we[0],we[1],we[2]),we.length&&B.push(we)}function Yt(ee){const B=[];return B.size=ee.size,B.start=ee.start,B.end=ee.end,B}function ii(ee,B,q,Y,ne,ge){for(const ve of ee)Dt(ve,B,q,Y,ne,ge,!1)}function ui(ee,B,q,Y){ee.push(B,q,Y)}function Pi(ee,B,q,Y,ne,ge){const ve=(ge-B)/(Y-B);return ui(ee,ge,q+(ne-q)*ve,1),ve}function Ni(ee,B,q,Y,ne,ge){const ve=(ge-q)/(ne-q);return ui(ee,B+(Y-B)*ve,ge,1),ve}function yt(ee,B){const q=[];for(let Y=0;Y<ee.length;Y++){const ne=ee[Y],ge=ne.type;let ve;if(ge==="Point"||ge==="MultiPoint"||ge==="LineString")ve=si(ne.geometry,B);else if(ge==="MultiLineString"||ge==="Polygon"){ve=[];for(const we of ne.geometry)ve.push(si(we,B))}else if(ge==="MultiPolygon"){ve=[];for(const we of ne.geometry){const be=[];for(const He of we)be.push(si(He,B));ve.push(be)}}q.push(Nt(ne.id,ge,ve,ne.tags))}return q}function si(ee,B){const q=[];q.size=ee.size,ee.start!==void 0&&(q.start=ee.start,q.end=ee.end);for(let Y=0;Y<ee.length;Y+=3)q.push(ee[Y]+B,ee[Y+1],ee[Y+2]);return q}function mi(ee,B){if(ee.transformed)return ee;const q=1<<ee.z,Y=ee.x,ne=ee.y;for(const ge of ee.features){const ve=ge.geometry,we=ge.type;if(ge.geometry=[],we===1)for(let be=0;be<ve.length;be+=2)ge.geometry.push(Rt(ve[be],ve[be+1],B,q,Y,ne));else for(let be=0;be<ve.length;be++){const He=[];for(let st=0;st<ve[be].length;st+=2)He.push(Rt(ve[be][st],ve[be][st+1],B,q,Y,ne));ge.geometry.push(He)}}return ee.transformed=!0,ee}function Rt(ee,B,q,Y,ne,ge){return[Math.round(q*(ee*Y-ne)),Math.round(q*(B*Y-ge))]}function nr(ee,B,q,Y,ne){const ge=B===ne.maxZoom?0:ne.tolerance/((1<<B)*ne.extent),ve={features:[],numPoints:0,numSimplified:0,numFeatures:ee.length,source:null,x:q,y:Y,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const we of ee)_t(ve,we,ge,ne);return ve}function _t(ee,B,q,Y){const ne=B.geometry,ge=B.type,ve=[];if(ee.minX=Math.min(ee.minX,B.minX),ee.minY=Math.min(ee.minY,B.minY),ee.maxX=Math.max(ee.maxX,B.maxX),ee.maxY=Math.max(ee.maxY,B.maxY),ge==="Point"||ge==="MultiPoint")for(let we=0;we<ne.length;we+=3)ve.push(ne[we],ne[we+1]),ee.numPoints++,ee.numSimplified++;else if(ge==="LineString")ai(ve,ne,ee,q,!1,!1);else if(ge==="MultiLineString"||ge==="Polygon")for(let we=0;we<ne.length;we++)ai(ve,ne[we],ee,q,ge==="Polygon",we===0);else if(ge==="MultiPolygon")for(let we=0;we<ne.length;we++){const be=ne[we];for(let He=0;He<be.length;He++)ai(ve,be[He],ee,q,!0,He===0)}if(ve.length){let we=B.tags||null;if(ge==="LineString"&&Y.lineMetrics){we={};for(const He in B.tags)we[He]=B.tags[He];we.mapbox_clip_start=ne.start/ne.size,we.mapbox_clip_end=ne.end/ne.size}const be={geometry:ve,type:ge==="Polygon"||ge==="MultiPolygon"?3:ge==="LineString"||ge==="MultiLineString"?2:1,tags:we};B.id!==null&&(be.id=B.id),ee.features.push(be)}}function ai(ee,B,q,Y,ne,ge){const ve=Y*Y;if(Y>0&&B.size<(ne?ve:Y))return void(q.numPoints+=B.length/3);const we=[];for(let be=0;be<B.length;be+=3)(Y===0||B[be+2]>ve)&&(q.numSimplified++,we.push(B[be],B[be+1])),q.numPoints++;ne&&function(be,He){let st=0;for(let je=0,xt=be.length,Ot=xt-2;je<xt;Ot=je,je+=2)st+=(be[je]-be[Ot])*(be[je+1]+be[Ot+1]);if(st>0===He)for(let je=0,xt=be.length;je<xt/2;je+=2){const Ot=be[je],Xt=be[je+1];be[je]=be[xt-2-je],be[je+1]=be[xt-1-je],be[xt-2-je]=Ot,be[xt-1-je]=Xt}}(we,ge),ee.push(we)}const fe={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class k{constructor(B,q){const Y=(q=this.options=function(ge,ve){for(const we in ve)ge[we]=ve[we];return ge}(Object.create(fe),q)).debug;if(Y&&console.time("preprocess data"),q.maxZoom<0||q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(q.promoteId&&q.generateId)throw new Error("promoteId and generateId cannot be used together.");let ne=function(ge,ve){const we=[];if(ge.type==="FeatureCollection")for(let be=0;be<ge.features.length;be++)ti(we,ge.features[be],ve,be);else ti(we,ge.type==="Feature"?ge:{geometry:ge},ve);return we}(B,q);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",q.indexMaxZoom,q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ne=function(ge,ve){const we=ve.buffer/ve.extent;let be=ge;const He=Pt(ge,1,-1-we,we,0,-1,2,ve),st=Pt(ge,1,1-we,2+we,0,-1,2,ve);return(He||st)&&(be=Pt(ge,1,-we,1+we,0,-1,2,ve)||[],He&&(be=yt(He,1).concat(be)),st&&(be=be.concat(yt(st,-1)))),be}(ne,q),ne.length&&this.splitTile(ne,0,0,0),Y&&(ne.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(B,q,Y,ne,ge,ve,we){const be=[B,q,Y,ne],He=this.options,st=He.debug;for(;be.length;){ne=be.pop(),Y=be.pop(),q=be.pop(),B=be.pop();const je=1<<q,xt=D(q,Y,ne);let Ot=this.tiles[xt];if(!Ot&&(st>1&&console.time("creation"),Ot=this.tiles[xt]=nr(B,q,Y,ne,He),this.tileCoords.push({z:q,x:Y,y:ne}),st)){st>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",q,Y,ne,Ot.numFeatures,Ot.numPoints,Ot.numSimplified),console.timeEnd("creation"));const vr=`z${q}`;this.stats[vr]=(this.stats[vr]||0)+1,this.total++}if(Ot.source=B,ge==null){if(q===He.indexMaxZoom||Ot.numPoints<=He.indexMaxPoints)continue}else{if(q===He.maxZoom||q===ge)continue;if(ge!=null){const vr=ge-q;if(Y!==ve>>vr||ne!==we>>vr)continue}}if(Ot.source=null,B.length===0)continue;st>1&&console.time("clipping");const Xt=.5*He.buffer/He.extent,bi=.5-Xt,ri=.5+Xt,wi=1+Xt;let yi=null,Xi=null,Ui=null,_i=null,qi=Pt(B,je,Y-Xt,Y+ri,0,Ot.minX,Ot.maxX,He),Ki=Pt(B,je,Y+bi,Y+wi,0,Ot.minX,Ot.maxX,He);B=null,qi&&(yi=Pt(qi,je,ne-Xt,ne+ri,1,Ot.minY,Ot.maxY,He),Xi=Pt(qi,je,ne+bi,ne+wi,1,Ot.minY,Ot.maxY,He),qi=null),Ki&&(Ui=Pt(Ki,je,ne-Xt,ne+ri,1,Ot.minY,Ot.maxY,He),_i=Pt(Ki,je,ne+bi,ne+wi,1,Ot.minY,Ot.maxY,He),Ki=null),st>1&&console.timeEnd("clipping"),be.push(yi||[],q+1,2*Y,2*ne),be.push(Xi||[],q+1,2*Y,2*ne+1),be.push(Ui||[],q+1,2*Y+1,2*ne),be.push(_i||[],q+1,2*Y+1,2*ne+1)}}getTile(B,q,Y){B=+B,q=+q,Y=+Y;const ne=this.options,{extent:ge,debug:ve}=ne;if(B<0||B>24)return null;const we=1<<B,be=D(B,q=q+we&we-1,Y);if(this.tiles[be])return mi(this.tiles[be],ge);ve>1&&console.log("drilling down to z%d-%d-%d",B,q,Y);let He,st=B,je=q,xt=Y;for(;!He&&st>0;)st--,je>>=1,xt>>=1,He=this.tiles[D(st,je,xt)];return He&&He.source?(ve>1&&(console.log("found parent tile z%d-%d-%d",st,je,xt),console.time("drilling down")),this.splitTile(He.source,st,je,xt,B,q,Y),ve>1&&console.timeEnd("drilling down"),this.tiles[be]?mi(this.tiles[be],ge):null):null}}function D(ee,B,q){return 32*((1<<ee)*q+B)+ee}function ae(ee,B){return B?ee.properties[B]:ee.id}function Ee(ee,B){if(ee==null)return!0;if(ee.type==="Feature")return ae(ee,B)!=null;if(ee.type==="FeatureCollection"){const q=new Set;for(const Y of ee.features){const ne=ae(Y,B);if(ne==null||q.has(ne))return!1;q.add(ne)}return!0}return!1}function Re(ee,B){const q=new Map;if(ee!=null)if(ee.type==="Feature")q.set(ae(ee,B),ee);else for(const Y of ee.features)q.set(ae(Y,B),Y);return q}class Ve extends O{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(B,q){return g._(this,void 0,void 0,function*(){const Y=B.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ne=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!ne)return null;const ge=new class{constructor(we){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=g.X,this.length=we.length,this._features=we}feature(we){return new class{constructor(be){this._feature=be,this.extent=g.X,this.type=be.type,this.properties=be.tags,"id"in be&&!isNaN(be.id)&&(this.id=parseInt(be.id,10))}loadGeometry(){if(this._feature.type===1){const be=[];for(const He of this._feature.geometry)be.push([new g.P(He[0],He[1])]);return be}{const be=[];for(const He of this._feature.geometry){const st=[];for(const je of He)st.push(new g.P(je[0],je[1]));be.push(st)}return be}}toGeoJSON(be,He,st){return Pe.call(this,be,He,st)}}(this._features[we])}}(ne.features);let ve=nt(ge);return ve.byteOffset===0&&ve.byteLength===ve.buffer.byteLength||(ve=new Uint8Array(ve)),{vectorTile:ge,rawData:ve.buffer}})}loadData(B){return g._(this,void 0,void 0,function*(){var q;(q=this._pendingRequest)===null||q===void 0||q.abort();const Y=!!(B&&B.request&&B.request.collectResourceTiming)&&new g.bv(B.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(B,this._pendingRequest),this._geoJSONIndex=B.cluster?new ke(function({superclusterOptions:ve,clusterProperties:we}){if(!we||!ve)return ve;const be={},He={},st={accumulated:null,zoom:0},je={properties:null},xt=Object.keys(we);for(const Ot of xt){const[Xt,bi]=we[Ot],ri=g.bC(bi),wi=g.bC(typeof Xt=="string"?[Xt,["accumulated"],["get",Ot]]:Xt);be[Ot]=ri.value,He[Ot]=wi.value}return ve.map=Ot=>{je.properties=Ot;const Xt={};for(const bi of xt)Xt[bi]=be[bi].evaluate(st,je);return Xt},ve.reduce=(Ot,Xt)=>{je.properties=Xt;for(const bi of xt)st.accumulated=Ot[bi],Ot[bi]=He[bi].evaluate(st,je)},ve}(B)).load((yield this._pendingData).features):(ne=yield this._pendingData,new k(ne,B.geojsonVtOptions)),this.loaded={};const ge={};if(Y){const ve=Y.finish();ve&&(ge.resourceTiming={},ge.resourceTiming[B.source]=JSON.parse(JSON.stringify(ve)))}return ge}catch(ge){if(delete this._pendingRequest,g.bB(ge))return{abandoned:!0};throw ge}var ne})}getData(){return g._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(B){const q=this.loaded;return q&&q[B.uid]?super.reloadTile(B):this.loadTile(B)}loadAndProcessGeoJSON(B,q){return g._(this,void 0,void 0,function*(){let Y=yield this.loadGeoJSON(B,q);if(delete this._pendingRequest,typeof Y!="object")throw new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`);if(de(Y,!0),B.filter){const ne=g.bC(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ne.result==="error")throw new Error(ne.value.map(ve=>`${ve.key}: ${ve.message}`).join(", "));Y={type:"FeatureCollection",features:Y.features.filter(ve=>ne.value.evaluate({zoom:0},ve))}}return Y})}loadGeoJSON(B,q){return g._(this,void 0,void 0,function*(){const{promoteId:Y}=B;if(B.request){const ne=yield g.h(B.request,q);return this._dataUpdateable=Ee(ne.data,Y)?Re(ne.data,Y):void 0,ne.data}if(typeof B.data=="string")try{const ne=JSON.parse(B.data);return this._dataUpdateable=Ee(ne,Y)?Re(ne,Y):void 0,ne}catch{throw new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`)}if(!B.dataDiff)throw new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${B.source}`);return function(ne,ge,ve){var we,be,He,st;if(ge.removeAll&&ne.clear(),ge.remove)for(const je of ge.remove)ne.delete(je);if(ge.add)for(const je of ge.add){const xt=ae(je,ve);xt!=null&&ne.set(xt,je)}if(ge.update)for(const je of ge.update){let xt=ne.get(je.id);if(xt==null)continue;const Ot=!je.removeAllProperties&&(((we=je.removeProperties)===null||we===void 0?void 0:we.length)>0||((be=je.addOrUpdateProperties)===null||be===void 0?void 0:be.length)>0);if((je.newGeometry||je.removeAllProperties||Ot)&&(xt=Object.assign({},xt),ne.set(je.id,xt),Ot&&(xt.properties=Object.assign({},xt.properties))),je.newGeometry&&(xt.geometry=je.newGeometry),je.removeAllProperties)xt.properties={};else if(((He=je.removeProperties)===null||He===void 0?void 0:He.length)>0)for(const Xt of je.removeProperties)Object.prototype.hasOwnProperty.call(xt.properties,Xt)&&delete xt.properties[Xt];if(((st=je.addOrUpdateProperties)===null||st===void 0?void 0:st.length)>0)for(const{key:Xt,value:bi}of je.addOrUpdateProperties)xt.properties[Xt]=bi}}(this._dataUpdateable,B.dataDiff,Y),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(B){return g._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(B){return this._geoJSONIndex.getClusterExpansionZoom(B.clusterId)}getClusterChildren(B){return this._geoJSONIndex.getChildren(B.clusterId)}getClusterLeaves(B){return this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset)}}class lt{constructor(B){this.self=B,this.actor=new g.F(B),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(q,Y)=>{if(this.externalWorkerSourceTypes[q])throw new Error(`Worker source with name "${q}" already registered.`);this.externalWorkerSourceTypes[q]=Y},this.self.addProtocol=g.bi,this.self.removeProtocol=g.bj,this.self.registerRTLTextPlugin=q=>{if(g.bD.isParsed())throw new Error("RTL text plugin already registered.");g.bD.setMethods(q)},this.actor.registerMessageHandler("LDT",(q,Y)=>this._getDEMWorkerSource(q,Y.source).loadTile(Y)),this.actor.registerMessageHandler("RDT",(q,Y)=>g._(this,void 0,void 0,function*(){this._getDEMWorkerSource(q,Y.source).removeTile(Y)})),this.actor.registerMessageHandler("GCEZ",(q,Y)=>g._(this,void 0,void 0,function*(){return this._getWorkerSource(q,Y.type,Y.source).getClusterExpansionZoom(Y)})),this.actor.registerMessageHandler("GCC",(q,Y)=>g._(this,void 0,void 0,function*(){return this._getWorkerSource(q,Y.type,Y.source).getClusterChildren(Y)})),this.actor.registerMessageHandler("GCL",(q,Y)=>g._(this,void 0,void 0,function*(){return this._getWorkerSource(q,Y.type,Y.source).getClusterLeaves(Y)})),this.actor.registerMessageHandler("LD",(q,Y)=>this._getWorkerSource(q,Y.type,Y.source).loadData(Y)),this.actor.registerMessageHandler("GD",(q,Y)=>this._getWorkerSource(q,Y.type,Y.source).getData()),this.actor.registerMessageHandler("LT",(q,Y)=>this._getWorkerSource(q,Y.type,Y.source).loadTile(Y)),this.actor.registerMessageHandler("RT",(q,Y)=>this._getWorkerSource(q,Y.type,Y.source).reloadTile(Y)),this.actor.registerMessageHandler("AT",(q,Y)=>this._getWorkerSource(q,Y.type,Y.source).abortTile(Y)),this.actor.registerMessageHandler("RMT",(q,Y)=>this._getWorkerSource(q,Y.type,Y.source).removeTile(Y)),this.actor.registerMessageHandler("RS",(q,Y)=>g._(this,void 0,void 0,function*(){if(!this.workerSources[q]||!this.workerSources[q][Y.type]||!this.workerSources[q][Y.type][Y.source])return;const ne=this.workerSources[q][Y.type][Y.source];delete this.workerSources[q][Y.type][Y.source],ne.removeSource!==void 0&&ne.removeSource(Y)})),this.actor.registerMessageHandler("RM",q=>g._(this,void 0,void 0,function*(){delete this.layerIndexes[q],delete this.availableImages[q],delete this.workerSources[q],delete this.demWorkerSources[q]})),this.actor.registerMessageHandler("SR",(q,Y)=>g._(this,void 0,void 0,function*(){this.referrer=Y})),this.actor.registerMessageHandler("SRPS",(q,Y)=>this._syncRTLPluginState(q,Y)),this.actor.registerMessageHandler("IS",(q,Y)=>g._(this,void 0,void 0,function*(){this.self.importScripts(Y)})),this.actor.registerMessageHandler("SI",(q,Y)=>this._setImages(q,Y)),this.actor.registerMessageHandler("UL",(q,Y)=>g._(this,void 0,void 0,function*(){this._getLayerIndex(q).update(Y.layers,Y.removedIds)})),this.actor.registerMessageHandler("SL",(q,Y)=>g._(this,void 0,void 0,function*(){this._getLayerIndex(q).replace(Y)}))}_setImages(B,q){return g._(this,void 0,void 0,function*(){this.availableImages[B]=q;for(const Y in this.workerSources[B]){const ne=this.workerSources[B][Y];for(const ge in ne)ne[ge].availableImages=q}})}_syncRTLPluginState(B,q){return g._(this,void 0,void 0,function*(){if(g.bD.isParsed())return g.bD.getState();if(q.pluginStatus!=="loading")return g.bD.setState(q),q;const Y=q.pluginURL;if(this.self.importScripts(Y),g.bD.isParsed()){const ne={pluginStatus:"loaded",pluginURL:Y};return g.bD.setState(ne),ne}throw g.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${Y}`)})}_getAvailableImages(B){let q=this.availableImages[B];return q||(q=[]),q}_getLayerIndex(B){let q=this.layerIndexes[B];return q||(q=this.layerIndexes[B]=new a),q}_getWorkerSource(B,q,Y){if(this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][q]||(this.workerSources[B][q]={}),!this.workerSources[B][q][Y]){const ne={sendAsync:(ge,ve)=>(ge.targetMapId=B,this.actor.sendAsync(ge,ve))};switch(q){case"vector":this.workerSources[B][q][Y]=new O(ne,this._getLayerIndex(B),this._getAvailableImages(B));break;case"geojson":this.workerSources[B][q][Y]=new Ve(ne,this._getLayerIndex(B),this._getAvailableImages(B));break;default:this.workerSources[B][q][Y]=new this.externalWorkerSourceTypes[q](ne,this._getLayerIndex(B),this._getAvailableImages(B))}}return this.workerSources[B][q][Y]}_getDEMWorkerSource(B,q){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][q]||(this.demWorkerSources[B][q]=new $),this.demWorkerSources[B][q]}}return g.i(self)&&(self.worker=new lt(self)),lt}),y("index",["exports","./shared"],function(g,a){var C="4.7.1";let F,U;const O={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:c=>new Promise((e,r)=>{const o=requestAnimationFrame(e);c.signal.addEventListener("abort",()=>{cancelAnimationFrame(o),r(a.c())})}),getImageData(c,e=0){return this.getImageCanvasContext(c).getImageData(-e,-e,c.width+2*e,c.height+2*e)},getImageCanvasContext(c){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=c.width,e.height=c.height,r.drawImage(c,0,0,c.width,c.height),r},resolveURL:c=>(F||(F=document.createElement("a")),F.href=c,F.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(U==null&&(U=matchMedia("(prefers-reduced-motion: reduce)")),U.matches)}};class ${static testProp(e){if(!$.docStyle)return e[0];for(let r=0;r<e.length;r++)if(e[r]in $.docStyle)return e[r];return e[0]}static create(e,r,o){const h=window.document.createElement(e);return r!==void 0&&(h.className=r),o&&o.appendChild(h),h}static createNS(e,r){return window.document.createElementNS(e,r)}static disableDrag(){$.docStyle&&$.selectProp&&($.userSelect=$.docStyle[$.selectProp],$.docStyle[$.selectProp]="none")}static enableDrag(){$.docStyle&&$.selectProp&&($.docStyle[$.selectProp]=$.userSelect)}static setTransform(e,r){e.style[$.transformProp]=r}static addEventListener(e,r,o,h={}){e.addEventListener(r,o,"passive"in h?h:h.capture)}static removeEventListener(e,r,o,h={}){e.removeEventListener(r,o,"passive"in h?h:h.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",$.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",$.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",$.suppressClickInternal,!0)},0)}static getScale(e){const r=e.getBoundingClientRect();return{x:r.width/e.offsetWidth||1,y:r.height/e.offsetHeight||1,boundingClientRect:r}}static getPoint(e,r,o){const h=r.boundingClientRect;return new a.P((o.clientX-h.left)/r.x-e.clientLeft,(o.clientY-h.top)/r.y-e.clientTop)}static mousePos(e,r){const o=$.getScale(e);return $.getPoint(e,o,r)}static touchPos(e,r){const o=[],h=$.getScale(e);for(let p=0;p<r.length;p++)o.push($.getPoint(e,h,r[p]));return o}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}$.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,$.selectProp=$.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),$.transformProp=$.testProp(["transform","WebkitTransform"]);const V={supported:!1,testSupport:function(c){!Pe&&de&&(ue?Se(c):ye=c)}};let ye,de,Pe=!1,ue=!1;function Se(c){const e=c.createTexture();c.bindTexture(c.TEXTURE_2D,e);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,de),c.isContextLost())return;V.supported=!0}catch{}c.deleteTexture(e),Pe=!0}var ze;typeof document<"u"&&(de=document.createElement("img"),de.onload=()=>{ye&&Se(ye),ye=null,ue=!0},de.onerror=()=>{Pe=!0,ye=null},de.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(c){let e,r,o,h;c.resetRequestQueue=()=>{e=[],r=0,o=0,h={}},c.addThrottleControl=P=>{const M=o++;return h[M]=P,M},c.removeThrottleControl=P=>{delete h[P],w()},c.getImage=(P,M,R=!0)=>new Promise((N,W)=>{V.supported&&(P.headers||(P.headers={}),P.headers.accept="image/webp,*/*"),a.e(P,{type:"image"}),e.push({abortController:M,requestParameters:P,supportImageRefresh:R,state:"queued",onError:H=>{W(H)},onSuccess:H=>{N(H)}}),w()});const p=P=>a._(this,void 0,void 0,function*(){P.state="running";const{requestParameters:M,supportImageRefresh:R,onError:N,onSuccess:W,abortController:H}=P,G=R===!1&&!a.i(self)&&!a.g(M.url)&&(!M.headers||Object.keys(M.headers).reduce((oe,he)=>oe&&he==="accept",!0));r++;const K=G?S(M,H):a.m(M,H);try{const oe=yield K;delete P.abortController,P.state="completed",oe.data instanceof HTMLImageElement||a.b(oe.data)?W(oe):oe.data&&W({data:yield(se=oe.data,typeof createImageBitmap=="function"?a.d(se):a.f(se)),cacheControl:oe.cacheControl,expires:oe.expires})}catch(oe){delete P.abortController,N(oe)}finally{r--,w()}var se}),w=()=>{const P=(()=>{for(const M of Object.keys(h))if(h[M]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let M=r;M<P&&e.length>0;M++){const R=e.shift();R.abortController.signal.aborted?M--:p(R)}},S=(P,M)=>new Promise((R,N)=>{const W=new Image,H=P.url,G=P.credentials;G&&G==="include"?W.crossOrigin="use-credentials":(G&&G==="same-origin"||!a.s(H))&&(W.crossOrigin="anonymous"),M.signal.addEventListener("abort",()=>{W.src="",N(a.c())}),W.fetchPriority="high",W.onload=()=>{W.onerror=W.onload=null,R({data:W})},W.onerror=()=>{W.onerror=W.onload=null,M.signal.aborted||N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},W.src=H})}(ze||(ze={})),ze.resetRequestQueue();class Ye{constructor(e){this._transformRequestFn=e}transformRequest(e,r){return this._transformRequestFn&&this._transformRequestFn(e,r)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Je(c){var e=new a.A(3);return e[0]=c[0],e[1]=c[1],e[2]=c[2],e}var ct,Ge=function(c,e,r){return c[0]=e[0]-r[0],c[1]=e[1]-r[1],c[2]=e[2]-r[2],c};ct=new a.A(3),a.A!=Float32Array&&(ct[0]=0,ct[1]=0,ct[2]=0);var De=function(c){var e=c[0],r=c[1];return e*e+r*r};function Qe(c){const e=[];if(typeof c=="string")e.push({id:"default",url:c});else if(c&&c.length>0){const r=[];for(const{id:o,url:h}of c){const p=`${o}${h}`;r.indexOf(p)===-1&&(r.push(p),e.push({id:o,url:h}))}}return e}function pt(c,e,r){const o=c.split("?");return o[0]+=`${e}${r}`,o.join("?")}(function(){var c=new a.A(2);a.A!=Float32Array&&(c[0]=0,c[1]=0)})();class pe{constructor(e,r,o,h){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(r,h)}update(e,r,o){const{width:h,height:p}=e,w=!(this.size&&this.size[0]===h&&this.size[1]===p||o),{context:S}=this,{gl:P}=S;if(this.useMipmap=!!(r&&r.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!r||r.premultiply!==!1)),w)this.size=[h,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||a.b(e)?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,e):P.texImage2D(P.TEXTURE_2D,0,this.format,h,p,0,this.format,P.UNSIGNED_BYTE,e.data);else{const{x:M,y:R}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||a.b(e)?P.texSubImage2D(P.TEXTURE_2D,0,M,R,P.RGBA,P.UNSIGNED_BYTE,e):P.texSubImage2D(P.TEXTURE_2D,0,M,R,h,p,P.RGBA,P.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)}bind(e,r,o){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),o!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,o||e),this.filter=e),r!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function me(c){const{userImage:e}=c;return!!(e&&e.render&&e.render())&&(c.data.replace(new Uint8Array(e.data.buffer)),!0)}class Ne extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:r,promiseResolve:o}of this.requestors)o(this._getImagesForIds(r));this.requestors=[]}}getImage(e){const r=this.images[e];if(r&&!r.data&&r.spriteData){const o=r.spriteData;r.data=new a.R({width:o.width,height:o.height},o.context.getImageData(o.x,o.y,o.width,o.height).data),r.spriteData=null}return r}addImage(e,r){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,r)&&(this.images[e]=r)}_validate(e,r){let o=!0;const h=r.data||r.spriteData;return this._validateStretch(r.stretchX,h&&h.width)||(this.fire(new a.j(new Error(`Image "${e}" has invalid "stretchX" value`))),o=!1),this._validateStretch(r.stretchY,h&&h.height)||(this.fire(new a.j(new Error(`Image "${e}" has invalid "stretchY" value`))),o=!1),this._validateContent(r.content,r)||(this.fire(new a.j(new Error(`Image "${e}" has invalid "content" value`))),o=!1),o}_validateStretch(e,r){if(!e)return!0;let o=0;for(const h of e){if(h[0]<o||h[1]<h[0]||r<h[1])return!1;o=h[1]}return!0}_validateContent(e,r){if(!e)return!0;if(e.length!==4)return!1;const o=r.spriteData,h=o&&o.width||r.data.width,p=o&&o.height||r.data.height;return!(e[0]<0||h<e[0]||e[1]<0||p<e[1]||e[2]<0||h<e[2]||e[3]<0||p<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,r,o=!0){const h=this.getImage(e);if(o&&(h.data.width!==r.data.width||h.data.height!==r.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=h.version+1,this.images[e]=r,this.updatedImages[e]=!0}removeImage(e){const r=this.images[e];delete this.images[e],delete this.patterns[e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((r,o)=>{let h=!0;if(!this.isLoaded())for(const p of e)this.images[p]||(h=!1);this.isLoaded()||h?r(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:r})})}_getImagesForIds(e){const r={};for(const o of e){let h=this.getImage(o);h||(this.fire(new a.k("styleimagemissing",{id:o})),h=this.getImage(o)),h?r[o]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,textFitWidth:h.textFitWidth,textFitHeight:h.textFitHeight,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:a.w(`Image "${o}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){const{width:e,height:r}=this.atlasImage;return{width:e,height:r}}getPattern(e){const r=this.patterns[e],o=this.getImage(e);if(!o)return null;if(r&&r.position.version===o.version)return r.position;if(r)r.position.version=o.version;else{const h={w:o.data.width+2,h:o.data.height+2,x:0,y:0},p=new a.I(h,o);this.patterns[e]={bin:h,position:p}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new pe(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const p in this.patterns)e.push(this.patterns[p].bin);const{w:r,h:o}=a.p(e),h=this.atlasImage;h.resize({width:r||1,height:o||1});for(const p in this.patterns){const{bin:w}=this.patterns[p],S=w.x+1,P=w.y+1,M=this.getImage(p).data,R=M.width,N=M.height;a.R.copy(M,h,{x:0,y:0},{x:S,y:P},{width:R,height:N}),a.R.copy(M,h,{x:0,y:N-1},{x:S,y:P-1},{width:R,height:1}),a.R.copy(M,h,{x:0,y:0},{x:S,y:P+N},{width:R,height:1}),a.R.copy(M,h,{x:R-1,y:0},{x:S-1,y:P},{width:1,height:N}),a.R.copy(M,h,{x:0,y:0},{x:S+R,y:P},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const r of e){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const o=this.getImage(r);o||a.w(`Image with ID: "${r}" was not found`),me(o)&&this.updateImage(r,o)}}}const Le=1e20;function et(c,e,r,o,h,p,w,S,P){for(let M=e;M<e+o;M++)it(c,r*p+M,p,h,w,S,P);for(let M=r;M<r+h;M++)it(c,M*p+e,1,o,w,S,P)}function it(c,e,r,o,h,p,w){p[0]=0,w[0]=-Le,w[1]=Le,h[0]=c[e];for(let S=1,P=0,M=0;S<o;S++){h[S]=c[e+S*r];const R=S*S;do{const N=p[P];M=(h[S]-h[N]+R-N*N)/(S-N)/2}while(M<=w[P]&&--P>-1);P++,p[P]=S,w[P]=M,w[P+1]=Le}for(let S=0,P=0;S<o;S++){for(;w[P+1]<S;)P++;const M=p[P],R=S-M;c[e+S*r]=h[M]+R*R}}class nt{constructor(e,r){this.requestManager=e,this.localIdeographFontFamily=r,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return a._(this,void 0,void 0,function*(){const r=[];for(const p in e)for(const w of e[p])r.push(this._getAndCacheGlyphsPromise(p,w));const o=yield Promise.all(r),h={};for(const{stack:p,id:w,glyph:S}of o)h[p]||(h[p]={}),h[p][w]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return h})}_getAndCacheGlyphsPromise(e,r){return a._(this,void 0,void 0,function*(){let o=this.entries[e];o||(o=this.entries[e]={glyphs:{},requests:{},ranges:{}});let h=o.glyphs[r];if(h!==void 0)return{stack:e,id:r,glyph:h};if(h=this._tinySDF(o,e,r),h)return o.glyphs[r]=h,{stack:e,id:r,glyph:h};const p=Math.floor(r/256);if(256*p>65535)throw new Error("glyphs > 65535 not supported");if(o.ranges[p])return{stack:e,id:r,glyph:h};if(!this.url)throw new Error("glyphsUrl is not set");if(!o.requests[p]){const S=nt.loadGlyphRange(e,p,this.url,this.requestManager);o.requests[p]=S}const w=yield o.requests[p];for(const S in w)this._doesCharSupportLocalGlyph(+S)||(o.glyphs[+S]=w[+S]);return o.ranges[p]=!0,{stack:e,id:r,glyph:w[r]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,r,o){const h=this.localIdeographFontFamily;if(!h||!this._doesCharSupportLocalGlyph(o))return;let p=e.tinySDF;if(!p){let S="400";/bold/i.test(r)?S="900":/medium/i.test(r)?S="500":/light/i.test(r)&&(S="200"),p=e.tinySDF=new nt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:h,fontWeight:S})}const w=p.draw(String.fromCharCode(o));return{id:o,bitmap:new a.o({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}}nt.loadGlyphRange=function(c,e,r,o){return a._(this,void 0,void 0,function*(){const h=256*e,p=h+255,w=o.transformRequest(r.replace("{fontstack}",c).replace("{range}",`${h}-${p}`),"Glyphs"),S=yield a.l(w,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${e}, ${h}-${p}`);const P={};for(const M of a.n(S.data))P[M.id]=M;return P})},nt.TinySDF=class{constructor({fontSize:c=24,buffer:e=3,radius:r=8,cutoff:o=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:w="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=r;const S=this.size=c+4*e,P=this._createCanvas(S),M=this.ctx=P.getContext("2d",{willReadFrequently:!0});M.font=`${w} ${p} ${c}px ${h}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(c){const e=document.createElement("canvas");return e.width=e.height=c,e}draw(c){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:o,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(c),w=Math.ceil(r),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-h))),P=Math.min(this.size-this.buffer,w+Math.ceil(o)),M=S+2*this.buffer,R=P+2*this.buffer,N=Math.max(M*R,0),W=new Uint8ClampedArray(N),H={data:W,width:M,height:R,glyphWidth:S,glyphHeight:P,glyphTop:w,glyphLeft:0,glyphAdvance:e};if(S===0||P===0)return H;const{ctx:G,buffer:K,gridInner:se,gridOuter:oe}=this;G.clearRect(K,K,S,P),G.fillText(c,K,K+w);const he=G.getImageData(K,K,S,P);oe.fill(Le,0,N),se.fill(0,0,N);for(let le=0;le<P;le++)for(let _e=0;_e<S;_e++){const Me=he.data[4*(le*S+_e)+3]/255;if(Me===0)continue;const Te=(le+K)*M+_e+K;if(Me===1)oe[Te]=0,se[Te]=Le;else{const rt=.5-Me;oe[Te]=rt>0?rt*rt:0,se[Te]=rt<0?rt*rt:0}}et(oe,0,0,M,R,M,this.f,this.v,this.z),et(se,K,K,S,P,M,this.f,this.v,this.z);for(let le=0;le<N;le++){const _e=Math.sqrt(oe[le])-Math.sqrt(se[le]);W[le]=Math.round(255-255*(_e/this.radius+this.cutoff))}return H}};class Xe{constructor(){this.specification=a.v.light.position}possiblyEvaluate(e,r){return a.x(e.expression.evaluate(r))}interpolate(e,r,o){return{x:a.y.number(e.x,r.x,o),y:a.y.number(e.y,r.y,o),z:a.y.number(e.z,r.z,o)}}}let at;class dt extends a.E{constructor(e){super(),at=at||new a.q({anchor:new a.D(a.v.light.anchor),position:new Xe,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(at),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,r={}){if(!this._validate(a.r,e,r))for(const o in e){const h=e[o];o.endsWith("-transition")?this._transitionable.setTransition(o.slice(0,-11),h):this._transitionable.setValue(o,h)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,o){return(!o||o.validate!==!1)&&a.t(this,e.call(a.u,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const Mt=new a.q({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class ie extends a.E{constructor(e){super(),this._transitionable=new a.T(Mt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.z(0))}setSky(e,r={}){if(!this._validate(a.B,e,r)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const o in e){const h=e[o];o.endsWith("-transition")?this._transitionable.setTransition(o.slice(0,-11),h):this._transitionable.setValue(o,h)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,o={}){return(o==null?void 0:o.validate)!==!1&&a.t(this,e.call(a.u,a.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class xe{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,r){const o=e.join(",")+String(r);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(e,r)),this.dashEntry[o]}getDashRanges(e,r,o){const h=[];let p=e.length%2==1?-e[e.length-1]*o:0,w=e[0]*o,S=!0;h.push({left:p,right:w,isDash:S,zeroLength:e[0]===0});let P=e[0];for(let M=1;M<e.length;M++){S=!S;const R=e[M];p=P*o,P+=R,w=P*o,h.push({left:p,right:w,isDash:S,zeroLength:R===0})}return h}addRoundDash(e,r,o){const h=r/2;for(let p=-o;p<=o;p++){const w=this.width*(this.nextRow+o+p);let S=0,P=e[S];for(let M=0;M<this.width;M++){M/P.right>1&&(P=e[++S]);const R=Math.abs(M-P.left),N=Math.abs(M-P.right),W=Math.min(R,N);let H;const G=p/o*(h+1);if(P.isDash){const K=h-Math.abs(G);H=Math.sqrt(W*W+K*K)}else H=h-Math.sqrt(W*W+G*G);this.data[w+M]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(e){for(let S=e.length-1;S>=0;--S){const P=e[S],M=e[S+1];P.zeroLength?e.splice(S,1):M&&M.isDash===P.isDash&&(M.left=P.left,e.splice(S,1))}const r=e[0],o=e[e.length-1];r.isDash===o.isDash&&(r.left=o.left-this.width,o.right=r.right+this.width);const h=this.width*this.nextRow;let p=0,w=e[p];for(let S=0;S<this.width;S++){S/w.right>1&&(w=e[++p]);const P=Math.abs(S-w.left),M=Math.abs(S-w.right),R=Math.min(P,M);this.data[h+S]=Math.max(0,Math.min(255,(w.isDash?R:-R)+128))}}addDash(e,r){const o=r?7:0,h=2*o+1;if(this.nextRow+h>this.height)return a.w("LineAtlas out of space"),null;let p=0;for(let S=0;S<e.length;S++)p+=e[S];if(p!==0){const S=this.width/p,P=this.getDashRanges(e,this.width,S);r?this.addRoundDash(P,S,o):this.addRegularDash(P)}const w={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:p};return this.nextRow+=h,this.dirty=!0,w}bind(e){const r=e.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}const ke="maplibre_preloaded_worker_pool";class Fe{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Fe.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ke]}numActive(){return Object.keys(this.active).length}}const qe=Math.floor(O.hardwareConcurrency/2);let $e,Ke;function tt(){return $e||($e=new Fe),$e}Fe.workerCount=a.C(globalThis)?Math.max(Math.min(qe,3),1):1;class Tt{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=r;const o=this.workerPool.acquire(r);for(let h=0;h<o.length;h++){const p=new a.F(o[h],r);p.name=`Worker ${h}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,r){const o=[];for(const h of this.actors)o.push(h.sendAsync({type:e,data:r}));return Promise.all(o)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(r=>{r.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,r){for(const o of this.actors)o.registerMessageHandler(e,r)}}function kt(){return Ke||(Ke=new Tt(tt(),a.G),Ke.registerMessageHandler("GR",(c,e,r)=>a.m(e,r))),Ke}function Nt(c,e){const r=a.H();return a.J(r,r,[1,1,0]),a.K(r,r,[.5*c.width,.5*c.height,1]),a.L(r,r,c.calculatePosMatrix(e.toUnwrapped()))}function zt(c,e,r,o,h,p){const w=function(N,W,H){if(N)for(const G of N){const K=W[G];if(K&&K.source===H&&K.type==="fill-extrusion")return!0}else for(const G in W){const K=W[G];if(K.source===H&&K.type==="fill-extrusion")return!0}return!1}(h&&h.layers,e,c.id),S=p.maxPitchScaleFactor(),P=c.tilesIn(o,S,w);P.sort(ti);const M=[];for(const N of P)M.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(e,r,c._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,h,p,S,Nt(c.transform,N.tileID))});const R=function(N){const W={},H={};for(const G of N){const K=G.queryResults,se=G.wrappedTileID,oe=H[se]=H[se]||{};for(const he in K){const le=K[he],_e=oe[he]=oe[he]||{},Me=W[he]=W[he]||[];for(const Te of le)_e[Te.featureIndex]||(_e[Te.featureIndex]=!0,Me.push(Te))}}return W}(M);for(const N in R)R[N].forEach(W=>{const H=W.feature,G=c.getFeatureState(H.layer["source-layer"],H.id);H.source=H.layer.source,H.layer["source-layer"]&&(H.sourceLayer=H.layer["source-layer"]),H.state=G});return R}function ti(c,e){const r=c.tileID,o=e.tileID;return r.overscaledZ-o.overscaledZ||r.canonical.y-o.canonical.y||r.wrap-o.wrap||r.canonical.x-o.canonical.x}function ht(c,e,r){return a._(this,void 0,void 0,function*(){let o=c;if(c.url?o=(yield a.h(e.transformRequest(c.url,"Source"),r)).data:yield O.frameAsync(r),!o)return null;const h=a.M(a.e(o,c),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in o&&o.vector_layers&&(h.vectorLayerIds=o.vector_layers.map(p=>p.id)),h})}class te{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof a.N?new a.N(e.lng,e.lat):a.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof a.N?new a.N(e.lng,e.lat):a.N.convert(e),this}extend(e){const r=this._sw,o=this._ne;let h,p;if(e instanceof a.N)h=e,p=e;else{if(!(e instanceof te))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(te.convert(e)):this.extend(a.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(a.N.convert(e)):this;if(h=e._sw,p=e._ne,!h||!p)return this}return r||o?(r.lng=Math.min(h.lng,r.lng),r.lat=Math.min(h.lat,r.lat),o.lng=Math.max(p.lng,o.lng),o.lat=Math.max(p.lat,o.lat)):(this._sw=new a.N(h.lng,h.lat),this._ne=new a.N(p.lng,p.lat)),this}getCenter(){return new a.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.N(this.getWest(),this.getNorth())}getSouthEast(){return new a.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:o}=a.N.convert(e);let h=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&h}static convert(e){return e instanceof te?e:e&&new te(e)}static fromLngLat(e,r=0){const o=360*r/40075017,h=o/Math.cos(Math.PI/180*e.lat);return new te(new a.N(e.lng-h,e.lat-o),new a.N(e.lng+h,e.lat+o))}adjustAntiMeridian(){const e=new a.N(this._sw.lng,this._sw.lat),r=new a.N(this._ne.lng,this._ne.lat);return new te(e,e.lng>r.lng?new a.N(r.lng+360,r.lat):r)}}class gi{constructor(e,r,o){this.bounds=te.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=o||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const r=Math.pow(2,e.z),o=Math.floor(a.O(this.bounds.getWest())*r),h=Math.floor(a.Q(this.bounds.getNorth())*r),p=Math.ceil(a.O(this.bounds.getEast())*r),w=Math.ceil(a.Q(this.bounds.getSouth())*r);return e.x>=o&&e.x<p&&e.y>=h&&e.y<w}}class Ht extends a.E{constructor(e,r,o,h){if(super(),this.id=e,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.M(r,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield ht(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(a.e(this,e),e.bounds&&(this.tileBounds=new gi(e.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new a.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(e){return a._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),o={request:this.map._requestManager.transformRequest(r,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.request.collectResourceTiming=this._collectResourceTiming;let h="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((p,w)=>{e.reloadPromise={resolve:p,reject:w}})}else e.actor=this.dispatcher.getActor(),h="LT";e.abortController=new AbortController;try{const p=yield e.actor.sendAsync({type:h,data:o},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,p)}catch(p){if(delete e.abortController,e.aborted)return;if(p&&p.status!==404)throw p;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,r){if(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),e.reloadPromise){const o=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(o.resolve).catch(o.reject)}}abortTile(e){return a._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return a._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ft extends a.E{constructor(e,r,o,h){super(),this.id=e,this.dispatcher=o,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},r),a.e(this,a.M(r,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield ht(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(a.e(this,e),e.bounds&&(this.tileBounds=new gi(e.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new a.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return a.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return a._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const o=yield ze.getImage(this.map._requestManager.transformRequest(r,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(o&&o.data){this.map._refreshExpiredTiles&&o.cacheControl&&o.expires&&e.setExpiryData({cacheControl:o.cacheControl,expires:o.expires});const h=this.map.painter.context,p=h.gl,w=o.data;e.texture=this.map.painter.getTileTexture(w.width),e.texture?e.texture.update(w,{useMipmap:!0}):(e.texture=new pe(h,w,p.RGBA,{useMipmap:!0}),e.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(o){if(delete e.abortController,e.aborted)e.state="unloaded";else if(o)throw e.state="errored",o}})}abortTile(e){return a._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return a._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Pt extends ft{constructor(e,r,o,h){super(e,r,o,h),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(e){return a._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),o=this.map._requestManager.transformRequest(r,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const h=yield ze.getImage(o,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(h&&h.data){const p=h.data;this.map._refreshExpiredTiles&&h.cacheControl&&h.expires&&e.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const w=a.b(p)&&a.U()?p:yield this.readImageNow(p),S={type:this.type,uid:e.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const P=yield e.actor.sendAsync({type:"LDT",data:S});e.dem=P,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(h){if(delete e.abortController,e.aborted)e.state="unloaded";else if(h)throw e.state="errored",h}})}readImageNow(e){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.V()){const r=e.width+2,o=e.height+2;try{return new a.R({width:r,height:o},yield a.W(e,-1,-1,r,o))}catch{}}return O.getImageData(e,1)})}_getNeighboringTiles(e){const r=e.canonical,o=Math.pow(2,r.z),h=(r.x-1+o)%o,p=r.x===0?e.wrap-1:e.wrap,w=(r.x+1+o)%o,S=r.x+1===o?e.wrap+1:e.wrap,P={};return P[new a.S(e.overscaledZ,p,r.z,h,r.y).key]={backfilled:!1},P[new a.S(e.overscaledZ,S,r.z,w,r.y).key]={backfilled:!1},r.y>0&&(P[new a.S(e.overscaledZ,p,r.z,h,r.y-1).key]={backfilled:!1},P[new a.S(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},P[new a.S(e.overscaledZ,S,r.z,w,r.y-1).key]={backfilled:!1}),r.y+1<o&&(P[new a.S(e.overscaledZ,p,r.z,h,r.y+1).key]={backfilled:!1},P[new a.S(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},P[new a.S(e.overscaledZ,S,r.z,w,r.y+1).key]={backfilled:!1}),P}unloadTile(e){return a._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Bt extends a.E{constructor(e,r,o,h){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=o.getActor(),this.setEventedParent(h),this._data=r.data,this._options=a.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const p=a.X/this.tileSize;r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*p,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*p,extent:a.X,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:a.X,radius:(r.clusterRadius||50)*p,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return a._(this,void 0,void 0,function*(){const e=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,r,o){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:r,offset:o}})}_updateWorkerData(e){return a._(this,void 0,void 0,function*(){const r=a.e({type:this.type},this.workerOptions);e?r.dataDiff=e:typeof this._data=="string"?(r.request=this.map._requestManager.transformRequest(O.resolveURL(this._data),"Source"),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const o=yield this.actor.sendAsync({type:"LD",data:r});if(this._pendingLoads--,this._removed||o.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let h=null;o.resourceTiming&&o.resourceTiming[this.id]&&(h=o.resourceTiming[this.id].slice(0));const p={dataType:"source"};this._collectResourceTiming&&h&&h.length>0&&a.e(p,{resourceTiming:h}),this.fire(new a.k("data",Object.assign(Object.assign({},p),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},p),{sourceDataType:"content"})))}catch(o){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(o))}})}loaded(){return this._pendingLoads===0}loadTile(e){return a._(this,void 0,void 0,function*(){const r=e.actor?"RT":"LT";e.actor=this.actor;const o={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const h=yield this.actor.sendAsync({type:r,data:o},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(h,this.map.painter,r==="RT")})}abortTile(e){return a._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return a._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Dt=a.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Yt extends a.E{constructor(e,r,o,h){super(),this.id=e,this.dispatcher=o,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=r}load(e){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const r=yield ze.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,e&&(this.coordinates=e),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,this.fire(new a.j(r))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const r=e.map(a.Z.fromLngLat);this.tileID=function(h){let p=1/0,w=1/0,S=-1/0,P=-1/0;for(const W of h)p=Math.min(p,W.x),w=Math.min(w,W.y),S=Math.max(S,W.x),P=Math.max(P,W.y);const M=Math.max(S-p,P-w),R=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),N=Math.pow(2,R);return new a.a1(R,Math.floor((p+S)/2*N),Math.floor((w+P)/2*N))}(r),this.minzoom=this.maxzoom=this.tileID.z;const o=r.map(h=>this.tileID.getTilePoint(h)._round());return this._boundsArray=new a.$,this._boundsArray.emplaceBack(o[0].x,o[0].y,0,0),this._boundsArray.emplaceBack(o[1].x,o[1].y,a.X,0),this._boundsArray.emplaceBack(o[3].x,o[3].y,0,a.X),this._boundsArray.emplaceBack(o[2].x,o[2].y,a.X,a.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,r=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Dt.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new pe(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let o=!1;for(const h in this.tiles){const p=this.tiles[h];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,o=!0)}o&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class ii extends Yt{constructor(e,r,o,h){super(e,r,o,h),this.roundZoom=!0,this.type="video",this.options=r}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const r of e.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{const r=yield a.a3(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new a.j(r))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new a.j(new a.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,r=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Dt.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new pe(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let o=!1;for(const h in this.tiles){const p=this.tiles[h];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,o=!0)}o&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ui extends Yt{constructor(e,r,o,h){super(e,r,o,h),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(w=>typeof w!="number"))||this.fire(new a.j(new a.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a2(`sources.${e}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new a.j(new a.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,o=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,Dt.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new pe(r,this.canvas,o.RGBA,{premultiply:!0});let h=!1;for(const p in this.tiles){const w=this.tiles[p];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,h=!0)}h&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Pi={},Ni=c=>{switch(c){case"geojson":return Bt;case"image":return Yt;case"raster":return ft;case"raster-dem":return Pt;case"vector":return Ht;case"video":return ii;case"canvas":return ui}return Pi[c]},yt="RTLPluginLoaded";class si extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=kt()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(r=>{throw this.status="error",r})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return a._(this,arguments,void 0,function*(r,o=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=O.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!o)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(yt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let mi=null;function Rt(){return mi||(mi=new si),mi}class nr{constructor(e,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=a.a4(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const r=e+this.timeAdded;r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,r,o){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,p){const w={};if(!p)return w;for(const S of h){const P=S.layerIds.map(M=>p.getLayer(M)).filter(Boolean);if(P.length!==0){S.layers=P,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(M=>P.filter(R=>R.id===M)[0]));for(const M of P)w[M.id]=S}}return w}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const p=this.buckets[h];if(p instanceof a.a6){if(this.hasSymbolBuckets=!0,!o)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const p=this.buckets[h];if(p instanceof a.a6&&p.hasRTLText){this.hasRTLText=!0,Rt().lazyLoad();break}}this.queryPadding=0;for(const h in this.buckets){const p=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(h).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new a.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const o in this.buckets){const h=this.buckets[o];h.uploadPending()&&h.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new pe(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new pe(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,o,h,p,w,S,P,M,R){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:p,scale:w,tileSize:this.tileSize,pixelPosMatrix:R,transform:P,params:S,queryPadding:this.queryPadding*M},e,r,o):{}}querySourceFeatures(e,r){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const h=o.loadVTLayers(),p=r&&r.sourceLayer?r.sourceLayer:"",w=h._geojsonTileLayer||h[p];if(!w)return;const S=a.a7(r&&r.filter),{z:P,x:M,y:R}=this.tileID.canonical,N={z:P,x:M,y:R};for(let W=0;W<w.length;W++){const H=w.feature(W);if(S.needGeometry){const se=a.a8(H,!0);if(!S.filter(new a.z(this.tileID.overscaledZ),se,this.tileID.canonical))continue}else if(!S.filter(new a.z(this.tileID.overscaledZ),H))continue;const G=o.getId(H,p),K=new a.a9(H,P,M,R,G);K.tile=N,e.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const o=a.aa(e.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const o=Date.now();let h=!1;if(this.expirationTime>o)h=!1;else if(r)if(this.expirationTime<r)h=!0;else{const p=this.expirationTime-r;p?this.expirationTime=o+Math.max(p,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const o=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!r.style.hasLayer(h))continue;const p=this.buckets[h],w=p.layers[0].sourceLayer||"_geojsonTileLayer",S=o[w],P=e[w];if(!S||!P||Object.keys(P).length===0)continue;p.update(P,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const M=r&&r.style&&r.style.getLayer(h);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<O.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=O.now()+e}setDependencies(e,r){const o={};for(const h of r)o[h]=!0;this.dependencies[e]=o}hasDependency(e,r){for(const o of e){const h=this.dependencies[o];if(h){for(const p of r)if(h[p])return!0}}return!1}}class _t{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,o){const h=e.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const p={value:r,timeout:void 0};if(o!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},o)),this.data[h].push(p),this.order.push(h),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const o=e.wrapped().key,h=r===void 0?0:this.data[o].indexOf(r),p=this.data[o][h];return this.data[o].splice(h,1),p.timeout&&clearTimeout(p.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(p.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const o in this.data)for(const h of this.data[o])e(h.value)||r.push(h);for(const o of r)this.remove(o.value.tileID,o)}}class ai{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,o){const h=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},a.e(this.stateChanges[e][h],o),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==h&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][h]===null){this.deletedStates[e][h]={};for(const p in this.state[e][h])o[p]||(this.deletedStates[e][h][p]=null)}else for(const p in o)this.deletedStates[e]&&this.deletedStates[e][h]&&this.deletedStates[e][h][p]===null&&delete this.deletedStates[e][h][p]}removeFeatureState(e,r,o){if(this.deletedStates[e]===null)return;const h=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},o&&r!==void 0)this.deletedStates[e][h]!==null&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][o]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][h])for(o in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][o]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,r){const o=String(r),h=a.e({},(this.state[e]||{})[o],(this.stateChanges[e]||{})[o]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][r];if(p===null)return{};for(const w in p)delete h[w]}return h}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const o={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const p={};for(const w in this.stateChanges[h])this.state[h][w]||(this.state[h][w]={}),a.e(this.state[h][w],this.stateChanges[h][w]),p[w]=this.state[h][w];o[h]=p}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const p={};if(this.deletedStates[h]===null)for(const w in this.state[h])p[w]={},this.state[h][w]={};else for(const w in this.deletedStates[h]){if(this.deletedStates[h][w]===null)this.state[h][w]={};else for(const S of Object.keys(this.deletedStates[h][w]))delete this.state[h][w][S];p[w]=this.state[h][w]}o[h]=o[h]||{},a.e(o[h],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(const h in e)e[h].setFeatureState(o,r)}}class fe extends a.E{constructor(e,r,o){super(),this.id=e,this.dispatcher=o,this.on("data",h=>this._dataHandler(h)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((h,p,w,S)=>{const P=new(Ni(p.type))(h,p,w,S);if(P.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${P.id}`);return P})(e,r,o,this),this._tiles={},this._cache=new _t(0,h=>this._unloadTile(h)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ai,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,r,o){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,r,o)}catch(h){e.state="errored",h.status!==404?this._source.fire(new a.j(h,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new a.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const o=this._tiles[r];o.upload(e),o.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(k).map(e=>e.key)}getRenderableIds(e){const r=[];for(const o in this._tiles)this._isIdRenderable(o,e)&&r.push(this._tiles[o]);return e?r.sort((o,h)=>{const p=o.tileID,w=h.tileID,S=new a.P(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),P=new a.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-w.overscaledZ||P.y-S.y||P.x-S.x}).map(o=>o.tileID.key):r.map(o=>o.tileID).sort(k).map(o=>o.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,r){return a._(this,void 0,void 0,function*(){const o=this._tiles[e];o&&(o.state!=="loading"&&(o.state=r),yield this._loadTile(o,e,r))})}_tileLoaded(e,r,o){e.timeAdded=O.now(),o==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const r=this.getRenderableIds();for(let h=0;h<r.length;h++){const p=r[h];if(e.neighboringTiles&&e.neighboringTiles[p]){const w=this.getTileByID(p);o(e,w),o(w,e)}}function o(h,p){h.needsHillshadePrepare=!0,h.needsTerrainPrepare=!0;let w=p.tileID.canonical.x-h.tileID.canonical.x;const S=p.tileID.canonical.y-h.tileID.canonical.y,P=Math.pow(2,h.tileID.canonical.z),M=p.tileID.key;w===0&&S===0||Math.abs(S)>1||(Math.abs(w)>1&&(Math.abs(w+P)===1?w+=P:Math.abs(w-P)===1&&(w-=P)),p.dem&&h.dem&&(h.dem.backfillBorder(p.dem,w,S),h.neighboringTiles&&h.neighboringTiles[M]&&(h.neighboringTiles[M].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,o,h){for(const p in this._tiles){let w=this._tiles[p];if(h[p]||!w.hasData()||w.tileID.overscaledZ<=r||w.tileID.overscaledZ>o)continue;let S=w.tileID;for(;w&&w.tileID.overscaledZ>r+1;){const M=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[M.key],w&&w.hasData()&&(S=M)}let P=S;for(;P.overscaledZ>r;)if(P=P.scaledTo(P.overscaledZ-1),e[P.key]){h[S.key]=S;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const o=this._loadedParentTiles[e.key];return o&&o.tileID.overscaledZ>=r?o:null}for(let o=e.overscaledZ-1;o>=r;o--){const h=e.scaledTo(o),p=this._getLoadedTile(h);if(p)return p}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const r=Math.ceil(e.width/this._source.tileSize)+1,o=Math.ceil(e.height/this._source.tileSize)+1,h=Math.floor(r*o*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(p)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const o={};for(const h in this._tiles){const p=this._tiles[h];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+r),o[p.tileID.key]=p}this._tiles=o;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(h,this._tiles[h])}}_updateCoveredAndRetainedTiles(e,r,o,h,p,w){const S={},P={},M=Object.keys(e),R=O.now();for(const N of M){const W=e[N],H=this._tiles[N];if(!H||H.fadeEndTime!==0&&H.fadeEndTime<=R)continue;const G=this.findLoadedParent(W,r),K=this.findLoadedSibling(W),se=G||K||null;se&&(this._addTile(se.tileID),S[se.tileID.key]=se.tileID),P[N]=W}this._retainLoadedChildren(P,h,o,e);for(const N in S)e[N]||(this._coveredTiles[N]=!0,e[N]=S[N]);if(w){const N={},W={};for(const H of p)this._tiles[H.key].hasData()?N[H.key]=H:W[H.key]=H;for(const H in W){const G=W[H].children(this._source.maxzoom);this._tiles[G[0].key]&&this._tiles[G[1].key]&&this._tiles[G[2].key]&&this._tiles[G[3].key]&&(N[G[0].key]=e[G[0].key]=G[0],N[G[1].key]=e[G[1].key]=G[1],N[G[2].key]=e[G[2].key]=G[2],N[G[3].key]=e[G[3].key]=G[3],delete W[H])}for(const H in W){const G=W[H],K=this.findLoadedParent(G,this._source.minzoom),se=this.findLoadedSibling(G),oe=K||se||null;if(oe){N[oe.tileID.key]=e[oe.tileID.key]=oe.tileID;for(const he in N)N[he].isChildOf(oe.tileID)&&delete N[he]}}for(const H in this._tiles)N[H]||(this._coveredTiles[H]=!0)}}update(e,r){if(!this._sourceLoaded||this._paused)return;let o;this.transform=e,this.terrain=r,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?o=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(R=>new a.S(R.canonical.z,R.wrap,R.canonical.z,R.canonical.x,R.canonical.y)):(o=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r}),this._source.hasTile&&(o=o.filter(R=>this._source.hasTile(R)))):o=[];const h=e.coveringZoomLevel(this._source),p=Math.max(h-fe.maxOverzooming,this._source.minzoom),w=Math.max(h+fe.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const R={};for(const N of o)if(N.canonical.z>this._source.minzoom){const W=N.scaledTo(N.canonical.z-1);R[W.key]=W;const H=N.scaledTo(Math.max(this._source.minzoom,Math.min(N.canonical.z,5)));R[H.key]=H}o=o.concat(Object.values(R))}const S=o.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const P=this._updateRetainedTiles(o,h);D(this._source.type)&&this._updateCoveredAndRetainedTiles(P,p,w,h,o,r);for(const R in P)this._tiles[R].clearFadeHold();const M=a.ab(this._tiles,P);for(const R of M){const N=this._tiles[R];N.hasSymbolBuckets&&!N.holdingForFade()?N.setHoldDuration(this.map._fadeDuration):N.hasSymbolBuckets&&!N.symbolFadeFinished()||this._removeTile(R)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,r){var o;const h={},p={},w=Math.max(r-fe.maxOverzooming,this._source.minzoom),S=Math.max(r+fe.maxUnderzooming,this._source.minzoom),P={};for(const M of e){const R=this._addTile(M);h[M.key]=M,R.hasData()||r<this._source.maxzoom&&(P[M.key]=M)}this._retainLoadedChildren(P,r,S,h);for(const M of e){let R=this._tiles[M.key];if(R.hasData())continue;if(r+1>this._source.maxzoom){const W=M.children(this._source.maxzoom)[0],H=this.getTile(W);if(H&&H.hasData()){h[W.key]=W;continue}}else{const W=M.children(this._source.maxzoom);if(h[W[0].key]&&h[W[1].key]&&h[W[2].key]&&h[W[3].key])continue}let N=R.wasRequested();for(let W=M.overscaledZ-1;W>=w;--W){const H=M.scaledTo(W);if(p[H.key])break;if(p[H.key]=!0,R=this.getTile(H),!R&&N&&(R=this._addTile(H)),R){const G=R.hasData();if((G||!(!((o=this.map)===null||o===void 0)&&o.cancelPendingTileRequestsWhileZooming)||N)&&(h[H.key]=H),N=R.wasRequested(),G)break}}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let o,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){o=this._loadedParentTiles[h.key];break}r.push(h.key);const p=h.scaledTo(h.overscaledZ-1);if(o=this._getLoadedTile(p),o)break;h=p}for(const p of r)this._loadedParentTiles[p]=o}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const r=this._tiles[e].tileID,o=this._getLoadedTile(r);this._loadedSiblingTiles[r.key]=o}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const o=r;return r||(r=new nr(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,e.key,r.state)),r.uses++,this._tiles[e.key]=r,o||this._source.fire(new a.k("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const o=r.getExpiryTimeout();o&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},o))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(e){const r=e.sourceDataType;e.dataType==="source"&&r==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&r==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,r,o){const h=[],p=this.transform;if(!p)return h;const w=o?p.getCameraQueryGeometry(e):e,S=e.map(G=>p.pointCoordinate(G,this.terrain)),P=w.map(G=>p.pointCoordinate(G,this.terrain)),M=this.getIds();let R=1/0,N=1/0,W=-1/0,H=-1/0;for(const G of P)R=Math.min(R,G.x),N=Math.min(N,G.y),W=Math.max(W,G.x),H=Math.max(H,G.y);for(let G=0;G<M.length;G++){const K=this._tiles[M[G]];if(K.holdingForFade())continue;const se=K.tileID,oe=Math.pow(2,p.zoom-K.tileID.overscaledZ),he=r*K.queryPadding*a.X/K.tileSize/oe,le=[se.getTilePoint(new a.Z(R,N)),se.getTilePoint(new a.Z(W,H))];if(le[0].x-he<a.X&&le[0].y-he<a.X&&le[1].x+he>=0&&le[1].y+he>=0){const _e=S.map(Te=>se.getTilePoint(Te)),Me=P.map(Te=>se.getTilePoint(Te));h.push({tile:K,tileID:se,queryGeometry:_e,cameraQueryGeometry:Me,scale:oe})}}return h}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(o=>this._tiles[o].tileID);for(const o of r)o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(D(this._source.type)){const e=O.now();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=e)return!0}return!1}setFeatureState(e,r,o){this._state.updateState(e=e||"_geojsonTileLayer",r,o)}removeFeatureState(e,r,o){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,o)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,o){const h=this._tiles[e];h&&h.setDependencies(r,o)}reloadTilesForDependencies(e,r){for(const o in this._tiles)this._tiles[o].hasDependency(e,r)&&this._reloadTile(o,"reloading");this._cache.filter(o=>!o.hasDependency(e,r))}}function k(c,e){const r=Math.abs(2*c.wrap)-+(c.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return c.overscaledZ-e.overscaledZ||o-r||e.canonical.y-c.canonical.y||e.canonical.x-c.canonical.x}function D(c){return c==="raster"||c==="image"||c==="video"}fe.maxOverzooming=10,fe.maxUnderzooming=3;class ae{constructor(e,r){this.reset(e,r)}reset(e,r){this.points=e||[],this._distances=[0];for(let o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=a.ac(e,0,1);let r=1,o=this._distances[r];const h=e*this.paddedLength+this.padding;for(;o<h&&r<this._distances.length;)o=this._distances[++r];const p=r-1,w=this._distances[p],S=o-w,P=S>0?(h-w)/S:0;return this.points[p].mult(1-P).add(this.points[r].mult(P))}}function Ee(c,e){let r=!0;return c==="always"||c!=="never"&&e!=="never"||(r=!1),r}class Re{constructor(e,r,o){const h=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(e/o),this.yCellCount=Math.ceil(r/o);for(let w=0;w<this.xCellCount*this.yCellCount;w++)h.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=r,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,r,o,h,p){this._forEachCell(r,o,h,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(p)}insertCircle(e,r,o,h){this._forEachCell(r-h,o-h,r+h,o+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(r),this.circles.push(o),this.circles.push(h)}_insertBoxCell(e,r,o,h,p,w){this.boxCells[p].push(w)}_insertCircleCell(e,r,o,h,p,w){this.circleCells[p].push(w)}_query(e,r,o,h,p,w,S){if(o<0||e>this.width||h<0||r>this.height)return[];const P=[];if(e<=0&&r<=0&&this.width<=o&&this.height<=h){if(p)return[{key:null,x1:e,y1:r,x2:o,y2:h}];for(let M=0;M<this.boxKeys.length;M++)P.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const R=this.circles[3*M],N=this.circles[3*M+1],W=this.circles[3*M+2];P.push({key:this.circleKeys[M],x1:R-W,y1:N-W,x2:R+W,y2:N+W})}}else this._forEachCell(e,r,o,h,this._queryCell,P,{hitTest:p,overlapMode:w,seenUids:{box:{},circle:{}}},S);return P}query(e,r,o,h){return this._query(e,r,o,h,!1,null)}hitTest(e,r,o,h,p,w){return this._query(e,r,o,h,!0,p,w).length>0}hitTestCircle(e,r,o,h,p){const w=e-o,S=e+o,P=r-o,M=r+o;if(S<0||w>this.width||M<0||P>this.height)return!1;const R=[];return this._forEachCell(w,P,S,M,this._queryCellCircle,R,{hitTest:!0,overlapMode:h,circle:{x:e,y:r,radius:o},seenUids:{box:{},circle:{}}},p),R.length>0}_queryCell(e,r,o,h,p,w,S,P){const{seenUids:M,hitTest:R,overlapMode:N}=S,W=this.boxCells[p];if(W!==null){const G=this.bboxes;for(const K of W)if(!M.box[K]){M.box[K]=!0;const se=4*K,oe=this.boxKeys[K];if(e<=G[se+2]&&r<=G[se+3]&&o>=G[se+0]&&h>=G[se+1]&&(!P||P(oe))&&(!R||!Ee(N,oe.overlapMode))&&(w.push({key:oe,x1:G[se],y1:G[se+1],x2:G[se+2],y2:G[se+3]}),R))return!0}}const H=this.circleCells[p];if(H!==null){const G=this.circles;for(const K of H)if(!M.circle[K]){M.circle[K]=!0;const se=3*K,oe=this.circleKeys[K];if(this._circleAndRectCollide(G[se],G[se+1],G[se+2],e,r,o,h)&&(!P||P(oe))&&(!R||!Ee(N,oe.overlapMode))){const he=G[se],le=G[se+1],_e=G[se+2];if(w.push({key:oe,x1:he-_e,y1:le-_e,x2:he+_e,y2:le+_e}),R)return!0}}}return!1}_queryCellCircle(e,r,o,h,p,w,S,P){const{circle:M,seenUids:R,overlapMode:N}=S,W=this.boxCells[p];if(W!==null){const G=this.bboxes;for(const K of W)if(!R.box[K]){R.box[K]=!0;const se=4*K,oe=this.boxKeys[K];if(this._circleAndRectCollide(M.x,M.y,M.radius,G[se+0],G[se+1],G[se+2],G[se+3])&&(!P||P(oe))&&!Ee(N,oe.overlapMode))return w.push(!0),!0}}const H=this.circleCells[p];if(H!==null){const G=this.circles;for(const K of H)if(!R.circle[K]){R.circle[K]=!0;const se=3*K,oe=this.circleKeys[K];if(this._circlesCollide(G[se],G[se+1],G[se+2],M.x,M.y,M.radius)&&(!P||P(oe))&&!Ee(N,oe.overlapMode))return w.push(!0),!0}}}_forEachCell(e,r,o,h,p,w,S,P){const M=this._convertToXCellCoord(e),R=this._convertToYCellCoord(r),N=this._convertToXCellCoord(o),W=this._convertToYCellCoord(h);for(let H=M;H<=N;H++)for(let G=R;G<=W;G++)if(p.call(this,e,r,o,h,this.xCellCount*G+H,w,S,P))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,r,o,h,p,w){const S=h-e,P=p-r,M=o+w;return M*M>S*S+P*P}_circleAndRectCollide(e,r,o,h,p,w,S){const P=(w-h)/2,M=Math.abs(e-(h+P));if(M>P+o)return!1;const R=(S-p)/2,N=Math.abs(r-(p+R));if(N>R+o)return!1;if(M<=P||N<=R)return!0;const W=M-P,H=N-R;return W*W+H*H<=o*o}}function Ve(c,e,r,o,h){const p=a.H();return e?(a.K(p,p,[1/h,1/h,1]),r||a.ad(p,p,o.angle)):a.L(p,o.labelPlaneMatrix,c),p}function lt(c,e,r,o,h){if(e){const p=a.ae(c);return a.K(p,p,[h,h,1]),r||a.ad(p,p,-o.angle),p}return o.glCoordMatrix}function ee(c,e,r,o){let h;o?(h=[c,e,o(c,e),1],a.af(h,h,r)):(h=[c,e,0,1],bi(h,h,r));const p=h[3];return{point:new a.P(h[0]/p,h[1]/p),signedDistanceFromCamera:p,isOccluded:!1}}function B(c,e){return .5+c/e*.5}function q(c,e){return c.x>=-e[0]&&c.x<=e[0]&&c.y>=-e[1]&&c.y<=e[1]}function Y(c,e,r,o,h,p,w,S,P,M,R,N,W,H,G){const K=o?c.textSizeData:c.iconSizeData,se=a.ag(K,r.transform.zoom),oe=[256/r.width*2+1,256/r.height*2+1],he=o?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;he.clear();const le=c.lineVertexArray,_e=o?c.text.placedSymbolArray:c.icon.placedSymbolArray,Me=r.transform.width/r.transform.height;let Te=!1;for(let rt=0;rt<_e.length;rt++){const mt=_e.get(rt);if(mt.hidden||mt.writingMode===a.ah.vertical&&!Te){Xt(mt.numGlyphs,he);continue}Te=!1;const vt=ee(mt.anchorX,mt.anchorY,e,G);if(!q(vt.point,oe)){Xt(mt.numGlyphs,he);continue}const St=B(r.transform.cameraToCenterDistance,vt.signedDistanceFromCamera),wt=a.ai(K,se,mt),bt=w?wt/St:wt*St,At={getElevation:G,labelPlaneMatrix:h,lineVertexArray:le,pitchWithMap:w,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:M,tileAnchorPoint:new a.P(mt.anchorX,mt.anchorY),unwrappedTileID:R,width:N,height:W,translation:H},Gt=ve(At,mt,bt,!1,S,e,p,c.glyphOffsetArray,he,Me,P);Te=Gt.useVertical,(Gt.notEnoughRoom||Te||Gt.needsFlipping&&ve(At,mt,bt,!0,S,e,p,c.glyphOffsetArray,he,Me,P).notEnoughRoom)&&Xt(mt.numGlyphs,he)}o?c.text.dynamicLayoutVertexBuffer.updateData(he):c.icon.dynamicLayoutVertexBuffer.updateData(he)}function ne(c,e,r,o,h,p,w,S){const P=p.glyphStartIndex+p.numGlyphs,M=p.lineStartIndex,R=p.lineStartIndex+p.lineLength,N=e.getoffsetX(p.glyphStartIndex),W=e.getoffsetX(P-1),H=xt(c*N,r,o,h,p.segment,M,R,S,w);if(!H)return null;const G=xt(c*W,r,o,h,p.segment,M,R,S,w);return G?S.projectionCache.anyProjectionOccluded?null:{first:H,last:G}:null}function ge(c,e,r,o){return c===a.ah.horizontal&&Math.abs(r.y-e.y)>Math.abs(r.x-e.x)*o?{useVertical:!0}:(c===a.ah.vertical?e.y<r.y:e.x>r.x)?{needsFlipping:!0}:null}function ve(c,e,r,o,h,p,w,S,P,M,R){const N=r/24,W=e.lineOffsetX*N,H=e.lineOffsetY*N;let G;if(e.numGlyphs>1){const K=e.glyphStartIndex+e.numGlyphs,se=e.lineStartIndex,oe=e.lineStartIndex+e.lineLength,he=ne(N,S,W,H,o,e,R,c);if(!he)return{notEnoughRoom:!0};const le=ee(he.first.point.x,he.first.point.y,w,c.getElevation).point,_e=ee(he.last.point.x,he.last.point.y,w,c.getElevation).point;if(h&&!o){const Me=ge(e.writingMode,le,_e,M);if(Me)return Me}G=[he.first];for(let Me=e.glyphStartIndex+1;Me<K-1;Me++)G.push(xt(N*S.getoffsetX(Me),W,H,o,e.segment,se,oe,c,R));G.push(he.last)}else{if(h&&!o){const se=ee(c.tileAnchorPoint.x,c.tileAnchorPoint.y,p,c.getElevation).point,oe=e.lineStartIndex+e.segment+1,he=new a.P(c.lineVertexArray.getx(oe),c.lineVertexArray.gety(oe)),le=ee(he.x,he.y,p,c.getElevation),_e=le.signedDistanceFromCamera>0?le.point:function(Te,rt,mt,vt,St,wt){return we(Te,rt,mt,1,St,wt)}(c.tileAnchorPoint,he,se,0,p,c),Me=ge(e.writingMode,se,_e,M);if(Me)return Me}const K=xt(N*S.getoffsetX(e.glyphStartIndex),W,H,o,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,c,R);if(!K||c.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};G=[K]}for(const K of G)a.aj(P,K.point,K.angle);return{}}function we(c,e,r,o,h,p){const w=c.add(c.sub(e)._unit()),S=h!==void 0?ee(w.x,w.y,h,p.getElevation).point:He(w.x,w.y,p).point,P=r.sub(S);return r.add(P._mult(o/P.mag()))}function be(c,e,r){const o=e.projectionCache;if(o.projections[c])return o.projections[c];const h=new a.P(e.lineVertexArray.getx(c),e.lineVertexArray.gety(c)),p=He(h.x,h.y,e);if(p.signedDistanceFromCamera>0)return o.projections[c]=p.point,o.anyProjectionOccluded=o.anyProjectionOccluded||p.isOccluded,p.point;const w=c-r.direction;return function(S,P,M,R,N){return we(S,P,M,R,void 0,N)}(r.distanceFromAnchor===0?e.tileAnchorPoint:new a.P(e.lineVertexArray.getx(w),e.lineVertexArray.gety(w)),h,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,e)}function He(c,e,r){const o=c+r.translation[0],h=e+r.translation[1];let p;return!r.pitchWithMap&&r.projection.useSpecialProjectionForSymbols?(p=r.projection.projectTileCoordinates(o,h,r.unwrappedTileID,r.getElevation),p.point.x=(.5*p.point.x+.5)*r.width,p.point.y=(.5*-p.point.y+.5)*r.height):(p=ee(o,h,r.labelPlaneMatrix,r.getElevation),p.isOccluded=!1),p}function st(c,e,r){return c._unit()._perp()._mult(e*r)}function je(c,e,r,o,h,p,w,S,P){if(S.projectionCache.offsets[c])return S.projectionCache.offsets[c];const M=r.add(e);if(c+P.direction<o||c+P.direction>=h)return S.projectionCache.offsets[c]=M,M;const R=be(c+P.direction,S,P),N=st(R.sub(r),w,P.direction),W=r.add(N),H=R.add(N);return S.projectionCache.offsets[c]=a.ak(p,M,W,H)||M,S.projectionCache.offsets[c]}function xt(c,e,r,o,h,p,w,S,P){const M=o?c-e:c+e;let R=M>0?1:-1,N=0;o&&(R*=-1,N=Math.PI),R<0&&(N+=Math.PI);let W,H=R>0?p+h:p+h+1;S.projectionCache.cachedAnchorPoint?W=S.projectionCache.cachedAnchorPoint:(W=He(S.tileAnchorPoint.x,S.tileAnchorPoint.y,S).point,S.projectionCache.cachedAnchorPoint=W);let G,K,se=W,oe=W,he=0,le=0;const _e=Math.abs(M),Me=[];let Te;for(;he+le<=_e;){if(H+=R,H<p||H>=w)return null;he+=le,oe=se,K=G;const vt={absOffsetX:_e,direction:R,distanceFromAnchor:he,previousVertex:oe};if(se=be(H,S,vt),r===0)Me.push(oe),Te=se.sub(oe);else{let St;const wt=se.sub(oe);St=wt.mag()===0?st(be(H+R,S,vt).sub(se),r,R):st(wt,r,R),K||(K=oe.add(St)),G=je(H,St,se,p,w,K,r,S,vt),Me.push(K),Te=G.sub(K)}le=Te.mag()}const rt=Te._mult((_e-he)/le)._add(K||oe),mt=N+Math.atan2(se.y-oe.y,se.x-oe.x);return Me.push(rt),{point:rt,angle:P?mt:0,path:Me}}const Ot=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Xt(c,e){for(let r=0;r<c;r++){const o=e.length;e.resize(o+4),e.float32.set(Ot,3*o)}}function bi(c,e,r){const o=e[0],h=e[1];return c[0]=r[0]*o+r[4]*h+r[12],c[1]=r[1]*o+r[5]*h+r[13],c[3]=r[3]*o+r[7]*h+r[15],c}const ri=100;class wi{constructor(e,r,o=new Re(e.width+200,e.height+200,25),h=new Re(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=r,this.grid=o,this.ignoredGrid=h,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+ri,this.screenBottomBoundary=e.height+ri,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,r,o,h,p,w,S,P,M,R,N){const W=e.anchorPointX+P[0],H=e.anchorPointY+P[1],G=this.projectAndGetPerspectiveRatio(h,W,H,p,R),K=o*G.perspectiveRatio;let se;if(w||S)se=this._projectCollisionBox(e,K,h,p,w,S,P,G,R,N);else{const Me=G.point.x+(N?N.x*K:0),Te=G.point.y+(N?N.y*K:0);se={allPointsOccluded:!1,box:[Me+e.x1*K,Te+e.y1*K,Me+e.x2*K,Te+e.y2*K]}}const[oe,he,le,_e]=se.box;return this.mapProjection.useSpecialProjectionForSymbols&&(w?se.allPointsOccluded:this.mapProjection.isOccluded(W,H,p))||G.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(oe,he,le,_e)||r!=="always"&&this.grid.hitTest(oe,he,le,_e,r,M)?{box:[oe,he,le,_e],placeable:!1,offscreen:!1}:{box:[oe,he,le,_e],placeable:!0,offscreen:this.isOffscreen(oe,he,le,_e)}}placeCollisionCircles(e,r,o,h,p,w,S,P,M,R,N,W,H,G,K,se){const oe=[],he=new a.P(r.anchorX,r.anchorY),le=this.getPerspectiveRatio(w,he.x,he.y,S,se),_e=(N?p/le:p*le)/a.ap,Me={getElevation:se,labelPlaneMatrix:P,lineVertexArray:o,pitchWithMap:N,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:he,unwrappedTileID:S,width:this.transform.width,height:this.transform.height,translation:K},Te=ne(_e,h,r.lineOffsetX*_e,r.lineOffsetY*_e,!1,r,!1,Me);let rt=!1,mt=!1,vt=!0;if(Te){const St=.5*H*le+G,wt=new a.P(-100,-100),bt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),At=new ae,Gt=Te.first,Ct=Te.last;let Et=[];for(let di=Gt.path.length-1;di>=1;di--)Et.push(Gt.path[di]);for(let di=1;di<Ct.path.length;di++)Et.push(Ct.path[di]);const Jt=2.5*St;if(M){const di=this.projectPathToScreenSpace(Et,Me,M);Et=di.some(vi=>vi.signedDistanceFromCamera<=0)?[]:di.map(vi=>vi.point)}let fi=[];if(Et.length>0){const di=Et[0].clone(),vi=Et[0].clone();for(let Ti=1;Ti<Et.length;Ti++)di.x=Math.min(di.x,Et[Ti].x),di.y=Math.min(di.y,Et[Ti].y),vi.x=Math.max(vi.x,Et[Ti].x),vi.y=Math.max(vi.y,Et[Ti].y);fi=di.x>=wt.x&&vi.x<=bt.x&&di.y>=wt.y&&vi.y<=bt.y?[Et]:vi.x<wt.x||di.x>bt.x||vi.y<wt.y||di.y>bt.y?[]:a.al([Et],wt.x,wt.y,bt.x,bt.y)}for(const di of fi){At.reset(di,.25*St);let vi=0;vi=At.length<=.5*St?1:Math.ceil(At.paddedLength/Jt)+1;for(let Ti=0;Ti<vi;Ti++){const Gi=Ti/Math.max(vi-1,1),or=At.lerp(Gi),ji=or.x+ri,br=or.y+ri;oe.push(ji,br,St,0);const Wi=ji-St,mr=br-St,Tr=ji+St,_n=br+St;if(vt=vt&&this.isOffscreen(Wi,mr,Tr,_n),mt=mt||this.isInsideGrid(Wi,mr,Tr,_n),e!=="always"&&this.grid.hitTestCircle(ji,br,St,e,W)&&(rt=!0,!R))return{circles:[],offscreen:!1,collisionDetected:rt}}}}return{circles:!R&&rt||!mt||le<this.perspectiveRatioCutoff?[]:oe,offscreen:vt,collisionDetected:rt}}projectPathToScreenSpace(e,r,o){return e.map(h=>ee(h.x,h.y,o,r.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let o=1/0,h=1/0,p=-1/0,w=-1/0;for(const R of e){const N=new a.P(R.x+ri,R.y+ri);o=Math.min(o,N.x),h=Math.min(h,N.y),p=Math.max(p,N.x),w=Math.max(w,N.y),r.push(N)}const S=this.grid.query(o,h,p,w).concat(this.ignoredGrid.query(o,h,p,w)),P={},M={};for(const R of S){const N=R.key;if(P[N.bucketInstanceId]===void 0&&(P[N.bucketInstanceId]={}),P[N.bucketInstanceId][N.featureIndex])continue;const W=[new a.P(R.x1,R.y1),new a.P(R.x2,R.y1),new a.P(R.x2,R.y2),new a.P(R.x1,R.y2)];a.am(r,W)&&(P[N.bucketInstanceId][N.featureIndex]=!0,M[N.bucketInstanceId]===void 0&&(M[N.bucketInstanceId]=[]),M[N.bucketInstanceId].push(N.featureIndex))}return M}insertCollisionBox(e,r,o,h,p,w){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:p,collisionGroupID:w,overlapMode:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,r,o,h,p,w){const S=o?this.ignoredGrid:this.grid,P={bucketInstanceId:h,featureIndex:p,collisionGroupID:w,overlapMode:r};for(let M=0;M<e.length;M+=4)S.insertCircle(P,e[M],e[M+1],e[M+2])}projectAndGetPerspectiveRatio(e,r,o,h,p){let w;p?(w=[r,o,p(r,o),1],a.af(w,w,e)):(w=[r,o,0,1],bi(w,w,e));const S=w[3];return{point:new a.P((w[0]/S+1)/2*this.transform.width+ri,(-w[1]/S+1)/2*this.transform.height+ri),perspectiveRatio:.5+this.transform.cameraToCenterDistance/S*.5,isOccluded:!1,signedDistanceFromCamera:S}}getPerspectiveRatio(e,r,o,h,p){const w=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(r,o,h,p):ee(r,o,e,p);return .5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5}isOffscreen(e,r,o,h){return o<ri||e>=this.screenRightBoundary||h<ri||r>this.screenBottomBoundary}isInsideGrid(e,r,o,h){return o>=0&&e<this.gridRightBoundary&&h>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const e=a.an([]);return a.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,r,o,h,p,w,S,P,M,R){let N=new a.P(1,0),W=new a.P(0,1);const H=new a.P(e.anchorPointX+S[0],e.anchorPointY+S[1]);if(w&&!p){const vt=this.projectAndGetPerspectiveRatio(o,H.x+1,H.y,h,M).point.sub(P.point).unit(),St=Math.atan(vt.y/vt.x)+(vt.x<0?Math.PI:0),wt=Math.sin(St),bt=Math.cos(St);N=new a.P(bt,wt),W=new a.P(-wt,bt)}else if(!w&&p){const vt=-this.transform.angle,St=Math.sin(vt),wt=Math.cos(vt);N=new a.P(wt,St),W=new a.P(-St,wt)}let G=P.point,K=r;if(p){G=H;const vt=this.transform.zoom-Math.floor(this.transform.zoom);K=Math.pow(2,-vt),K*=this.mapProjection.getPitchedTextCorrection(this.transform,H,h),R||(K*=a.ac(.5+P.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}R&&(G=G.add(N.mult(R.x*K)).add(W.mult(R.y*K)));const se=e.x1*K,oe=e.x2*K,he=(se+oe)/2,le=e.y1*K,_e=e.y2*K,Me=(le+_e)/2,Te=[{offsetX:se,offsetY:le},{offsetX:he,offsetY:le},{offsetX:oe,offsetY:le},{offsetX:oe,offsetY:Me},{offsetX:oe,offsetY:_e},{offsetX:he,offsetY:_e},{offsetX:se,offsetY:_e},{offsetX:se,offsetY:Me}];let rt=[];for(const{offsetX:vt,offsetY:St}of Te)rt.push(new a.P(G.x+N.x*vt+W.x*St,G.y+N.y*vt+W.y*St));let mt=!1;if(p){const vt=rt.map(St=>this.projectAndGetPerspectiveRatio(o,St.x,St.y,h,M));mt=vt.some(St=>!St.isOccluded),rt=vt.map(St=>St.point)}else mt=!0;return{box:a.ao(rt),allPointsOccluded:!mt}}}function yi(c,e,r){return e*(a.X/(c.tileSize*Math.pow(2,r-c.tileID.overscaledZ)))}class Xi{constructor(e,r,o,h){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?r:-r))):h&&o?1:0,this.placed=o}isHidden(){return this.opacity===0&&!this.placed}}class Ui{constructor(e,r,o,h,p){this.text=new Xi(e?e.text:null,r,o,p),this.icon=new Xi(e?e.icon:null,r,h,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _i{constructor(e,r,o){this.text=e,this.icon=r,this.skipFade=o}}class qi{constructor(){this.invProjMatrix=a.H(),this.viewportMatrix=a.H(),this.circles=[]}}class Ki{constructor(e,r,o,h,p){this.bucketInstanceId=e,this.featureIndex=r,this.sourceLayerIndex=o,this.bucketIndex=h,this.tileID=p}}class vr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const r=++this.maxGroupID;this.collisionGroups[e]={ID:r,predicate:o=>o.collisionGroupID===r}}return this.collisionGroups[e]}}function wr(c,e,r,o,h){const{horizontalAlign:p,verticalAlign:w}=a.au(c);return new a.P(-(p-.5)*e+o[0]*h,-(w-.5)*r+o[1]*h)}class zr{constructor(e,r,o,h,p,w){this.transform=e.clone(),this.terrain=o,this.collisionIndex=new wi(this.transform,r),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new vr(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const r=this.terrain;return r?(o,h)=>r.getElevation(e,o,h):null}getBucketParts(e,r,o,h){const p=o.getBucket(r),w=o.latestFeatureIndex;if(!p||!w||r.id!==p.layerIds[0])return;const S=o.collisionBoxArray,P=p.layers[0].layout,M=p.layers[0].paint,R=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),N=o.tileSize/a.X,W=o.tileID.toUnwrapped(),H=this.transform.calculatePosMatrix(W),G=P.get("text-pitch-alignment")==="map",K=P.get("text-rotation-alignment")==="map",se=yi(o,1,this.transform.zoom),oe=this.collisionIndex.mapProjection.translatePosition(this.transform,o,M.get("text-translate"),M.get("text-translate-anchor")),he=this.collisionIndex.mapProjection.translatePosition(this.transform,o,M.get("icon-translate"),M.get("icon-translate-anchor")),le=Ve(H,G,K,this.transform,se);let _e=null;if(G){const Te=lt(H,G,K,this.transform,se);_e=a.L([],this.transform.labelPlaneMatrix,Te)}this.retainedQueryData[p.bucketInstanceId]=new Ki(p.bucketInstanceId,w,p.sourceLayerIndex,p.index,o.tileID);const Me={bucket:p,layout:P,translationText:oe,translationIcon:he,posMatrix:H,unwrappedTileID:W,textLabelPlaneMatrix:le,labelToScreenMatrix:_e,scale:R,textPixelRatio:N,holdingForFade:o.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:a.ag(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(h)for(const Te of p.sortKeyRanges){const{sortKey:rt,symbolInstanceStart:mt,symbolInstanceEnd:vt}=Te;e.push({sortKey:rt,symbolInstanceStart:mt,symbolInstanceEnd:vt,parameters:Me})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:Me})}attemptAnchorPlacement(e,r,o,h,p,w,S,P,M,R,N,W,H,G,K,se,oe,he,le){const _e=a.aq[e.textAnchor],Me=[e.textOffset0,e.textOffset1],Te=wr(_e,o,h,Me,p),rt=this.collisionIndex.placeCollisionBox(r,W,P,M,R,S,w,se,N.predicate,le,Te);if((!he||this.collisionIndex.placeCollisionBox(he,W,P,M,R,S,w,oe,N.predicate,le,Te).placeable)&&rt.placeable){let mt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID].text&&(mt=this.prevPlacement.variableOffsets[H.crossTileID].anchor),H.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[H.crossTileID]={textOffset:Me,width:o,height:h,anchor:_e,textBoxScale:p,prevAnchor:mt},this.markUsedJustification(G,_e,H,K),G.allowVerticalPlacement&&(this.markUsedOrientation(G,K,H),this.placedOrientations[H.crossTileID]=K),{shift:Te,placedGlyphBoxes:rt}}}placeLayerBucketPart(e,r,o){const{bucket:h,layout:p,translationText:w,translationIcon:S,posMatrix:P,unwrappedTileID:M,textLabelPlaneMatrix:R,labelToScreenMatrix:N,textPixelRatio:W,holdingForFade:H,collisionBoxArray:G,partiallyEvaluatedTextSize:K,collisionGroup:se}=e.parameters,oe=p.get("text-optional"),he=p.get("icon-optional"),le=a.ar(p,"text-overlap","text-allow-overlap"),_e=le==="always",Me=a.ar(p,"icon-overlap","icon-allow-overlap"),Te=Me==="always",rt=p.get("text-rotation-alignment")==="map",mt=p.get("text-pitch-alignment")==="map",vt=p.get("icon-text-fit")!=="none",St=p.get("symbol-z-order")==="viewport-y",wt=_e&&(Te||!h.hasIconData()||he),bt=Te&&(_e||!h.hasTextData()||oe);!h.collisionArrays&&G&&h.deserializeCollisionBoxes(G);const At=this._getTerrainElevationFunc(this.retainedQueryData[h.bucketInstanceId].tileID),Gt=(Ct,Et,Jt)=>{var fi,di;if(r[Ct.crossTileID])return;if(H)return void(this.placements[Ct.crossTileID]=new _i(!1,!1,!1));let vi=!1,Ti=!1,Gi=!0,or=null,ji={box:null,placeable:!1,offscreen:null},br={box:null,placeable:!1,offscreen:null},Wi=null,mr=null,Tr=null,_n=0,Bn=0,lr=0;Et.textFeatureIndex?_n=Et.textFeatureIndex:Ct.useRuntimeCollisionCircles&&(_n=Ct.featureIndex),Et.verticalTextFeatureIndex&&(Bn=Et.verticalTextFeatureIndex);const Ma=Et.textBox;if(Ma){const ln=Pr=>{let Kr=a.ah.horizontal;if(h.allowVerticalPlacement&&!Pr&&this.prevPlacement){const hn=this.prevPlacement.placedOrientations[Ct.crossTileID];hn&&(this.placedOrientations[Ct.crossTileID]=hn,Kr=hn,this.markUsedOrientation(h,Kr,Ct))}return Kr},vn=(Pr,Kr)=>{if(h.allowVerticalPlacement&&Ct.numVerticalGlyphVertices>0&&Et.verticalTextBox){for(const hn of h.writingModes)if(hn===a.ah.vertical?(ji=Kr(),br=ji):ji=Pr(),ji&&ji.placeable)break}else ji=Pr()},Ur=Ct.textAnchorOffsetStartIndex,cn=Ct.textAnchorOffsetEndIndex;if(cn===Ur){const Pr=(Kr,hn)=>{const Ri=this.collisionIndex.placeCollisionBox(Kr,le,W,P,M,mt,rt,w,se.predicate,At);return Ri&&Ri.placeable&&(this.markUsedOrientation(h,hn,Ct),this.placedOrientations[Ct.crossTileID]=hn),Ri};vn(()=>Pr(Ma,a.ah.horizontal),()=>{const Kr=Et.verticalTextBox;return h.allowVerticalPlacement&&Ct.numVerticalGlyphVertices>0&&Kr?Pr(Kr,a.ah.vertical):{box:null,offscreen:null}}),ln(ji&&ji.placeable)}else{let Pr=a.aq[(di=(fi=this.prevPlacement)===null||fi===void 0?void 0:fi.variableOffsets[Ct.crossTileID])===null||di===void 0?void 0:di.anchor];const Kr=(Ri,js,za)=>{const sa=Ri.x2-Ri.x1,Uo=Ri.y2-Ri.y1,Ah=Ct.textBoxScale,qc=vt&&Me==="never"?js:null;let qs=null,aa=le==="never"?1:2,Zl="never";Pr&&aa++;for(let Al=0;Al<aa;Al++){for(let Gl=Ur;Gl<cn;Gl++){const Il=h.textAnchorOffsets.get(Gl);if(Pr&&Il.textAnchor!==Pr)continue;const oa=this.attemptAnchorPlacement(Il,Ri,sa,Uo,Ah,rt,mt,W,P,M,se,Zl,Ct,h,za,w,S,qc,At);if(oa&&(qs=oa.placedGlyphBoxes,qs&&qs.placeable))return vi=!0,or=oa.shift,qs}Pr?Pr=null:Zl=le}return o&&!qs&&(qs={box:this.collisionIndex.placeCollisionBox(Ma,"always",W,P,M,mt,rt,w,se.predicate,At,new a.P(0,0)).box,offscreen:!1,placeable:!1}),qs};vn(()=>Kr(Ma,Et.iconBox,a.ah.horizontal),()=>{const Ri=Et.verticalTextBox;return h.allowVerticalPlacement&&(!ji||!ji.placeable)&&Ct.numVerticalGlyphVertices>0&&Ri?Kr(Ri,Et.verticalIconBox,a.ah.vertical):{box:null,occluded:!0,offscreen:null}}),ji&&(vi=ji.placeable,Gi=ji.offscreen);const hn=ln(ji&&ji.placeable);if(!vi&&this.prevPlacement){const Ri=this.prevPlacement.variableOffsets[Ct.crossTileID];Ri&&(this.variableOffsets[Ct.crossTileID]=Ri,this.markUsedJustification(h,Ri.anchor,Ct,hn))}}}if(Wi=ji,vi=Wi&&Wi.placeable,Gi=Wi&&Wi.offscreen,Ct.useRuntimeCollisionCircles){const ln=h.text.placedSymbolArray.get(Ct.centerJustifiedTextSymbolIndex),vn=a.ai(h.textSizeData,K,ln),Ur=p.get("text-padding");mr=this.collisionIndex.placeCollisionCircles(le,ln,h.lineVertexArray,h.glyphOffsetArray,vn,P,M,R,N,o,mt,se.predicate,Ct.collisionCircleDiameter,Ur,w,At),mr.circles.length&&mr.collisionDetected&&!o&&a.w("Collisions detected, but collision boxes are not shown"),vi=_e||mr.circles.length>0&&!mr.collisionDetected,Gi=Gi&&mr.offscreen}if(Et.iconFeatureIndex&&(lr=Et.iconFeatureIndex),Et.iconBox){const ln=vn=>this.collisionIndex.placeCollisionBox(vn,Me,W,P,M,mt,rt,S,se.predicate,At,vt&&or?or:void 0);br&&br.placeable&&Et.verticalIconBox?(Tr=ln(Et.verticalIconBox),Ti=Tr.placeable):(Tr=ln(Et.iconBox),Ti=Tr.placeable),Gi=Gi&&Tr.offscreen}const jn=oe||Ct.numHorizontalGlyphVertices===0&&Ct.numVerticalGlyphVertices===0,Sl=he||Ct.numIconVertices===0;jn||Sl?Sl?jn||(Ti=Ti&&vi):vi=Ti&&vi:Ti=vi=Ti&&vi;const Vo=Ti&&Tr.placeable;if(vi&&Wi.placeable&&this.collisionIndex.insertCollisionBox(Wi.box,le,p.get("text-ignore-placement"),h.bucketInstanceId,br&&br.placeable&&Bn?Bn:_n,se.ID),Vo&&this.collisionIndex.insertCollisionBox(Tr.box,Me,p.get("icon-ignore-placement"),h.bucketInstanceId,lr,se.ID),mr&&vi&&this.collisionIndex.insertCollisionCircles(mr.circles,le,p.get("text-ignore-placement"),h.bucketInstanceId,_n,se.ID),o&&this.storeCollisionData(h.bucketInstanceId,Jt,Et,Wi,Tr,mr),Ct.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ct.crossTileID]=new _i(vi||wt,Ti||bt,Gi||h.justReloaded),r[Ct.crossTileID]=!0};if(St){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ct=h.getSortedSymbolIndexes(this.transform.angle);for(let Et=Ct.length-1;Et>=0;--Et){const Jt=Ct[Et];Gt(h.symbolInstances.get(Jt),h.collisionArrays[Jt],Jt)}}else for(let Ct=e.symbolInstanceStart;Ct<e.symbolInstanceEnd;Ct++)Gt(h.symbolInstances.get(Ct),h.collisionArrays[Ct],Ct);if(o&&h.bucketInstanceId in this.collisionCircleArrays){const Ct=this.collisionCircleArrays[h.bucketInstanceId];a.as(Ct.invProjMatrix,P),Ct.viewportMatrix=this.collisionIndex.getViewportMatrix()}h.justReloaded=!1}storeCollisionData(e,r,o,h,p,w){if(o.textBox||o.iconBox){let S,P;this.collisionBoxArrays.has(e)?S=this.collisionBoxArrays.get(e):(S=new Map,this.collisionBoxArrays.set(e,S)),S.has(r)?P=S.get(r):(P={text:null,icon:null},S.set(r,P)),o.textBox&&(P.text=h.box),o.iconBox&&(P.icon=p.box)}if(w){let S=this.collisionCircleArrays[e];S===void 0&&(S=this.collisionCircleArrays[e]=new qi);for(let P=0;P<w.circles.length;P+=4)S.circles.push(w.circles[P+0]),S.circles.push(w.circles[P+1]),S.circles.push(w.circles[P+2]),S.circles.push(w.collisionDetected?1:0)}}markUsedJustification(e,r,o,h){let p;p=h===a.ah.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[a.at(r)];const w=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];for(const S of w)S>=0&&(e.text.placedSymbolArray.get(S).crossTileID=p>=0&&S!==p?0:o.crossTileID)}markUsedOrientation(e,r,o){const h=r===a.ah.horizontal||r===a.ah.horizontalOnly?r:0,p=r===a.ah.vertical?r:0,w=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];for(const S of w)e.text.placedSymbolArray.get(S).placedOrientation=h;o.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let o=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const h=r?r.symbolFadeChange(e):1,p=r?r.opacities:{},w=r?r.variableOffsets:{},S=r?r.placedOrientations:{};for(const P in this.placements){const M=this.placements[P],R=p[P];R?(this.opacities[P]=new Ui(R,h,M.text,M.icon),o=o||M.text!==R.text.placed||M.icon!==R.icon.placed):(this.opacities[P]=new Ui(null,h,M.text,M.icon,M.skipFade),o=o||M.text||M.icon)}for(const P in p){const M=p[P];if(!this.opacities[P]){const R=new Ui(M,h,!1,!1);R.isHidden()||(this.opacities[P]=R,o=o||M.text.placed||M.icon.placed)}}for(const P in w)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=w[P]);for(const P in S)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=S[P]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");o?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:e)}updateLayerOpacities(e,r){const o={};for(const h of r){const p=h.getBucket(e);p&&h.latestFeatureIndex&&e.id===p.layerIds[0]&&this.updateBucketOpacities(p,h.tileID,o,h.collisionBoxArray)}}updateBucketOpacities(e,r,o,h){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const p=e.layers[0],w=p.layout,S=new Ui(null,0,!1,!1,!0),P=w.get("text-allow-overlap"),M=w.get("icon-allow-overlap"),R=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),N=w.get("text-rotation-alignment")==="map",W=w.get("text-pitch-alignment")==="map",H=w.get("icon-text-fit")!=="none",G=new Ui(null,0,P&&(M||!e.hasIconData()||w.get("icon-optional")),M&&(P||!e.hasTextData()||w.get("text-optional")),!0);!e.collisionArrays&&h&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(h);const K=(oe,he,le)=>{for(let _e=0;_e<he/4;_e++)oe.opacityVertexArray.emplaceBack(le);oe.hasVisibleVertices=oe.hasVisibleVertices||le!==_a},se=this.collisionBoxArrays.get(e.bucketInstanceId);for(let oe=0;oe<e.symbolInstances.length;oe++){const he=e.symbolInstances.get(oe),{numHorizontalGlyphVertices:le,numVerticalGlyphVertices:_e,crossTileID:Me}=he;let Te=this.opacities[Me];o[Me]?Te=S:Te||(Te=G,this.opacities[Me]=Te),o[Me]=!0;const rt=he.numIconVertices>0,mt=this.placedOrientations[he.crossTileID],vt=mt===a.ah.vertical,St=mt===a.ah.horizontal||mt===a.ah.horizontalOnly;if(le>0||_e>0){const bt=rn(Te.text);K(e.text,le,vt?_a:bt),K(e.text,_e,St?_a:bt);const At=Te.text.isHidden();[he.rightJustifiedTextSymbolIndex,he.centerJustifiedTextSymbolIndex,he.leftJustifiedTextSymbolIndex].forEach(Et=>{Et>=0&&(e.text.placedSymbolArray.get(Et).hidden=At||vt?1:0)}),he.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(he.verticalPlacedTextSymbolIndex).hidden=At||St?1:0);const Gt=this.variableOffsets[he.crossTileID];Gt&&this.markUsedJustification(e,Gt.anchor,he,mt);const Ct=this.placedOrientations[he.crossTileID];Ct&&(this.markUsedJustification(e,"left",he,Ct),this.markUsedOrientation(e,Ct,he))}if(rt){const bt=rn(Te.icon),At=!(H&&he.verticalPlacedIconSymbolIndex&&vt);he.placedIconSymbolIndex>=0&&(K(e.icon,he.numIconVertices,At?bt:_a),e.icon.placedSymbolArray.get(he.placedIconSymbolIndex).hidden=Te.icon.isHidden()),he.verticalPlacedIconSymbolIndex>=0&&(K(e.icon,he.numVerticalIconVertices,At?_a:bt),e.icon.placedSymbolArray.get(he.verticalPlacedIconSymbolIndex).hidden=Te.icon.isHidden())}const wt=se&&se.has(oe)?se.get(oe):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const bt=e.collisionArrays[oe];if(bt){let At=new a.P(0,0);if(bt.textBox||bt.verticalTextBox){let Gt=!0;if(R){const Ct=this.variableOffsets[Me];Ct?(At=wr(Ct.anchor,Ct.width,Ct.height,Ct.textOffset,Ct.textBoxScale),N&&At._rotate(W?this.transform.angle:-this.transform.angle)):Gt=!1}if(bt.textBox||bt.verticalTextBox){let Ct;bt.textBox&&(Ct=vt),bt.verticalTextBox&&(Ct=St),Xs(e.textCollisionBox.collisionVertexArray,Te.text.placed,!Gt||Ct,wt.text,At.x,At.y)}}if(bt.iconBox||bt.verticalIconBox){const Gt=!!(!St&&bt.verticalIconBox);let Ct;bt.iconBox&&(Ct=Gt),bt.verticalIconBox&&(Ct=!Gt),Xs(e.iconCollisionBox.collisionVertexArray,Te.icon.placed,Ct,wt.icon,H?At.x:0,H?At.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const oe=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=oe.invProjMatrix,e.placementViewportMatrix=oe.viewportMatrix,e.collisionCircleArray=oe.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,r){const o=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*o>e}setStale(){this.stale=!0}}function Xs(c,e,r,o,h,p){o&&o.length!==0||(o=[0,0,0,0]);const w=o[0]-ri,S=o[1]-ri,P=o[2]-ri,M=o[3]-ri;c.emplaceBack(e?1:0,r?1:0,h||0,p||0,w,S),c.emplaceBack(e?1:0,r?1:0,h||0,p||0,P,S),c.emplaceBack(e?1:0,r?1:0,h||0,p||0,P,M),c.emplaceBack(e?1:0,r?1:0,h||0,p||0,w,M)}const $i=Math.pow(2,25),rl=Math.pow(2,24),ya=Math.pow(2,17),tn=Math.pow(2,16),fn=Math.pow(2,9),nl=Math.pow(2,8),xn=Math.pow(2,1);function rn(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const e=c.placed?1:0,r=Math.floor(127*c.opacity);return r*$i+e*rl+r*ya+e*tn+r*fn+e*nl+r*xn+e}const _a=0;function $n(){return{isOccluded:(c,e,r)=>!1,getPitchedTextCorrection:(c,e,r)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(c,e,r,o){throw new Error("Not implemented.")},translatePosition:(c,e,r,o)=>function(h,p,w,S,P=!1){if(!w[0]&&!w[1])return[0,0];const M=P?S==="map"?h.angle:0:S==="viewport"?-h.angle:0;if(M){const R=Math.sin(M),N=Math.cos(M);w=[w[0]*N-w[1]*R,w[0]*R+w[1]*N]}return[P?w[0]:yi(p,w[0],h.zoom),P?w[1]:yi(p,w[1],h.zoom)]}(c,e,r,o),getCircleRadiusCorrection:c=>1}}class Sr{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,r,o,h,p){const w=this._bucketParts;for(;this._currentTileIndex<e.length;)if(r.getBucketParts(w,h,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((S,P)=>S.sortKey-P.sortKey));this._currentPartIndex<w.length;)if(r.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,p())return!0;return!1}}class sr{constructor(e,r,o,h,p,w,S,P){this.placement=new zr(e,$n(),r,w,S,P),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(e,r,o){const h=O.now(),p=()=>!this._forceFullPlacement&&O.now()-h>2;for(;this._currentPlacementIndex>=0;){const w=r[e[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=S)&&(!w.maxzoom||w.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Sr(w)),this._inProgressLayer.continuePlacement(o[w.source],this.placement,this._showCollisionBoxes,w,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const wn=512/a.X/2;class pr{constructor(e,r,o){this.tileID=e,this.bucketInstanceId=o,this._symbolsByKey={};const h=new Map;for(let p=0;p<r.length;p++){const w=r.get(p),S=w.key,P=h.get(S);P?P.push(w):h.set(S,[w])}for(const[p,w]of h){const S={positions:w.map(P=>({x:Math.floor(P.anchorX*wn),y:Math.floor(P.anchorY*wn)})),crossTileIDs:w.map(P=>P.crossTileID)};if(S.positions.length>128){const P=new a.av(S.positions.length,16,Uint16Array);for(const{x:M,y:R}of S.positions)P.add(M,R);P.finish(),delete S.positions,S.index=P}this._symbolsByKey[p]=S}}getScaledCoordinates(e,r){const{x:o,y:h,z:p}=this.tileID.canonical,{x:w,y:S,z:P}=r.canonical,M=wn/Math.pow(2,P-p),R=(S*a.X+e.anchorY)*M,N=h*a.X*wn;return{x:Math.floor((w*a.X+e.anchorX)*M-o*a.X*wn),y:Math.floor(R-N)}}findMatches(e,r,o){const h=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let p=0;p<e.length;p++){const w=e.get(p);if(w.crossTileID)continue;const S=this._symbolsByKey[w.key];if(!S)continue;const P=this.getScaledCoordinates(w,r);if(S.index){const M=S.index.range(P.x-h,P.y-h,P.x+h,P.y+h).sort();for(const R of M){const N=S.crossTileIDs[R];if(!o[N]){o[N]=!0,w.crossTileID=N;break}}}else if(S.positions)for(let M=0;M<S.positions.length;M++){const R=S.positions[M],N=S.crossTileIDs[M];if(Math.abs(R.x-P.x)<=h&&Math.abs(R.y-P.y)<=h&&!o[N]){o[N]=!0,w.crossTileID=N;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class ja{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class mn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const r=Math.round((e-this.lng)/360);if(r!==0)for(const o in this.indexes){const h=this.indexes[o],p={};for(const w in h){const S=h[w];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+r),p[S.tileID.key]=S}this.indexes[o]=p}this.lng=e}addBucket(e,r,o){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let p=0;p<r.symbolInstances.length;p++)r.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const h=this.usedCrossTileIDs[e.overscaledZ];for(const p in this.indexes){const w=this.indexes[p];if(Number(p)>e.overscaledZ)for(const S in w){const P=w[S];P.tileID.isChildOf(e)&&P.findMatches(r.symbolInstances,e,h)}else{const S=w[e.scaledTo(Number(p)).key];S&&S.findMatches(r.symbolInstances,e,h)}}for(let p=0;p<r.symbolInstances.length;p++){const w=r.symbolInstances.get(p);w.crossTileID||(w.crossTileID=o.generate(),h[w.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new pr(e,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(e,r){for(const o of r.getCrossTileIDsLists())for(const h of o)delete this.usedCrossTileIDs[e][h]}removeStaleBuckets(e){let r=!1;for(const o in this.indexes){const h=this.indexes[o];for(const p in h)e[h[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,h[p]),delete h[p],r=!0)}return r}}class sl{constructor(){this.layerIndexes={},this.crossTileIDs=new ja,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,r,o){let h=this.layerIndexes[e.id];h===void 0&&(h=this.layerIndexes[e.id]=new mn);let p=!1;const w={};h.handleWrapJump(o);for(const S of r){const P=S.getBucket(e);P&&e.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(S.tileID,P,this.crossTileIDs)&&(p=!0),w[P.bucketInstanceId]=!0)}return h.removeStaleBuckets(w)&&(p=!0),p}pruneUnusedLayers(e){const r={};e.forEach(o=>{r[o]=!0});for(const o in this.layerIndexes)r[o]||delete this.layerIndexes[o]}}const Lr=(c,e)=>a.t(c,e&&e.filter(r=>r.identifier!=="source.canvas")),fo=a.aw();class Zr extends a.E{constructor(e,r={}){super(),this._rtlPluginLoaded=()=>{for(const o in this.sourceCaches){const h=this.sourceCaches[o].getSource().type;h!=="vector"&&h!=="geojson"||this.sourceCaches[o].reload()}},this.map=e,this.dispatcher=new Tt(tt(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(o,h)=>this.getGlyphs(o,h)),this.dispatcher.registerMessageHandler("GI",(o,h)=>this.getImages(o,h)),this.imageManager=new Ne,this.imageManager.setEventedParent(this),this.glyphManager=new nt(e._requestManager,r.localIdeographFontFamily),this.lineAtlas=new xe(256,512),this.crossTileSymbolIndex=new sl,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ay()),Rt().on(yt,this._rtlPluginLoaded),this.on("data",o=>{if(o.dataType!=="source"||o.sourceDataType!=="metadata")return;const h=this.sourceCaches[o.sourceId];if(!h)return;const p=h.getSource();if(p&&p.vectorLayerIds)for(const w in this._layers){const S=this._layers[w];S.source===p.id&&this._validateLayer(S)}})}loadURL(e,r={},o){this.fire(new a.k("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const h=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const p=this._loadStyleRequest;a.h(h,this._loadStyleRequest).then(w=>{this._loadStyleRequest=null,this._load(w.data,r,o)}).catch(w=>{this._loadStyleRequest=null,w&&!p.signal.aborted&&this.fire(new a.j(w))})}loadJSON(e,r={},o){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,O.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(e,r,o)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(fo,{validate:!1})}_load(e,r,o){var h;const p=r.transformStyle?r.transformStyle(o,e):e;if(!r.validate||!Lr(this,a.u(p))){this._loaded=!0,this.stylesheet=p;for(const w in p.sources)this.addSource(w,p.sources[w],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs),this._createLayers(),this.light=new dt(this.stylesheet.light),this.sky=new ie(this.stylesheet.sky),this.map.setTerrain((h=this.stylesheet.terrain)!==null&&h!==void 0?h:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const e=a.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(r=>r.id),this._layers={},this._serializedLayers=null;for(const r of e){const o=a.aA(r);o.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=o}}_loadSprite(e,r=!1,o=void 0){let h;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(p,w,S,P){return a._(this,void 0,void 0,function*(){const M=Qe(p),R=S>1?"@2x":"",N={},W={};for(const{id:H,url:G}of M){const K=w.transformRequest(pt(G,R,".json"),"SpriteJSON");N[H]=a.h(K,P);const se=w.transformRequest(pt(G,R,".png"),"SpriteImage");W[H]=ze.getImage(se,P)}return yield Promise.all([...Object.values(N),...Object.values(W)]),function(H,G){return a._(this,void 0,void 0,function*(){const K={};for(const se in H){K[se]={};const oe=O.getImageCanvasContext((yield G[se]).data),he=(yield H[se]).data;for(const le in he){const{width:_e,height:Me,x:Te,y:rt,sdf:mt,pixelRatio:vt,stretchX:St,stretchY:wt,content:bt,textFitWidth:At,textFitHeight:Gt}=he[le];K[se][le]={data:null,pixelRatio:vt,sdf:mt,stretchX:St,stretchY:wt,content:bt,textFitWidth:At,textFitHeight:Gt,spriteData:{width:_e,height:Me,x:Te,y:rt,context:oe}}}}return K})}(N,W)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(p=>{if(this._spriteRequest=null,p)for(const w in p){this._spritesImagesIds[w]=[];const S=this._spritesImagesIds[w]?this._spritesImagesIds[w].filter(P=>!(P in p)):[];for(const P of S)this.imageManager.removeImage(P),this._changedImages[P]=!0;for(const P in p[w]){const M=w==="default"?P:`${w}:${P}`;this._spritesImagesIds[w].push(M),M in this.imageManager.images?this.imageManager.updateImage(M,p[w][P],!1):this.imageManager.addImage(M,p[w][P]),r&&(this._changedImages[M]=!0)}}}).catch(p=>{this._spriteRequest=null,h=p,this.fire(new a.j(h))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),o&&o(h)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(e){const r=this.sourceCaches[e.source];if(!r)return;const o=e.sourceLayer;if(!o)return;const h=r.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(o)===-1)&&this.fire(new a.j(new Error(`Source layer "${o}" does not exist on source "${h.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,r=!1){const o=this._serializedAllLayers();if(!e||e.length===0)return Object.values(r?a.aB(o):o);const h=[];for(const p of e)if(o[p]){const w=r?a.aB(o[p]):o[p];h.push(w)}return h}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const r=Object.keys(this._layers);for(const o of r){const h=this._layers[o];h.type!=="custom"&&(e[o]=h.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const r=this._changed;if(r){const h=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(h.length||p.length)&&this._updateWorkerLayers(h,p);for(const w in this._updatedSources){const S=this._updatedSources[w];if(S==="reload")this._reloadSource(w);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const o={};for(const h in this.sourceCaches){const p=this.sourceCaches[h];o[h]=p.used,p.used=!1}for(const h of this._order){const p=this._layers[h];p.recalculate(e,this._availableImages),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(const h in o){const p=this.sourceCaches[h];!!o[h]!=!!p.used&&p.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,r&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,r={}){var o;this._checkLoaded();const h=this.serialize();if(e=r.transformStyle?r.transformStyle(h,e):e,((o=r.validate)===null||o===void 0||o)&&Lr(this,a.u(e)))return!1;(e=a.aB(e)).layers=a.az(e.layers);const p=a.aC(h,e),w=this._getOperationsToPerform(p);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const S of w.operations)S();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const r=[],o=[];for(const h of e)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":r.push(()=>this.addLayer.apply(this,h.args));break;case"removeLayer":r.push(()=>this.removeLayer.apply(this,h.args));break;case"setPaintProperty":r.push(()=>this.setPaintProperty.apply(this,h.args));break;case"setLayoutProperty":r.push(()=>this.setLayoutProperty.apply(this,h.args));break;case"setFilter":r.push(()=>this.setFilter.apply(this,h.args));break;case"addSource":r.push(()=>this.addSource.apply(this,h.args));break;case"removeSource":r.push(()=>this.removeSource.apply(this,h.args));break;case"setLayerZoomRange":r.push(()=>this.setLayerZoomRange.apply(this,h.args));break;case"setLight":r.push(()=>this.setLight.apply(this,h.args));break;case"setGeoJSONSourceData":r.push(()=>this.setGeoJSONSourceData.apply(this,h.args));break;case"setGlyphs":r.push(()=>this.setGlyphs.apply(this,h.args));break;case"setSprite":r.push(()=>this.setSprite.apply(this,h.args));break;case"setSky":r.push(()=>this.setSky.apply(this,h.args));break;case"setTerrain":r.push(()=>this.map.setTerrain.apply(this,h.args));break;case"setTransition":r.push(()=>{});break;default:o.push(h.command)}return{operations:r,unimplemented:o}}addImage(e,r){if(this.getImage(e))return this.fire(new a.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,r),this._afterImageUpdated(e)}updateImage(e,r){this.imageManager.updateImage(e,r)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new a.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,r,o={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(a.u.source,`sources.${e}`,r,null,o))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const h=this.sourceCaches[e]=new fe(e,r,this.dispatcher);h.style=this,h.setEventedParent(this,()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:e})),h.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const o in this._layers)if(this._layers[o].source===e)return this.fire(new a.j(new Error(`Source "${e}" cannot be removed while layer "${o}" is using it.`)));const r=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],r.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,r){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const o=this.sourceCaches[e].getSource();if(o.type!=="geojson")throw new Error(`geojsonSource.type is ${o.type}, which is !== 'geojson`);o.setData(r),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,r,o={}){this._checkLoaded();const h=e.id;if(this.getLayer(h))return void this.fire(new a.j(new Error(`Layer "${h}" already exists on this map.`)));let p;if(e.type==="custom"){if(Lr(this,a.aD(e)))return;p=a.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(h,e.source),e=a.aB(e),e=a.e(e,{source:h})),this._validate(a.u.layer,`layers.${h}`,e,{arrayIndex:-1},o))return;p=a.aA(e),this._validateLayer(p),p.setEventedParent(this,{layer:{id:h}})}const w=r?this._order.indexOf(r):this._order.length;if(r&&w===-1)this.fire(new a.j(new Error(`Cannot add layer "${h}" before non-existing layer "${r}".`)));else{if(this._order.splice(w,0,h),this._layerOrderChanged=!0,this._layers[h]=p,this._removedLayers[h]&&p.source&&p.type!=="custom"){const S=this._removedLayers[h];delete this._removedLayers[h],S.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(e,r){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new a.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===r)return;const o=this._order.indexOf(e);this._order.splice(o,1);const h=r?this._order.indexOf(r):this._order.length;r&&h===-1?this.fire(new a.j(new Error(`Cannot move layer "${e}" before non-existing layer "${r}".`))):(this._order.splice(h,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const r=this._layers[e];if(!r)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${e}".`)));r.setEventedParent(null);const o=this._order.indexOf(e);this._order.splice(o,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,r,o){this._checkLoaded();const h=this.getLayer(e);h?h.minzoom===r&&h.maxzoom===o||(r!=null&&(h.minzoom=r),o!=null&&(h.maxzoom=o),this._updateLayer(h)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,r,o={}){this._checkLoaded();const h=this.getLayer(e);if(h){if(!a.aE(h.filter,r))return r==null?(h.filter=void 0,void this._updateLayer(h)):void(this._validate(a.u.filter,`layers.${h.id}.filter`,r,null,o)||(h.filter=a.aB(r),this._updateLayer(h)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return a.aB(this.getLayer(e).filter)}setLayoutProperty(e,r,o,h={}){this._checkLoaded();const p=this.getLayer(e);p?a.aE(p.getLayoutProperty(r),o)||(p.setLayoutProperty(r,o,h),this._updateLayer(p)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,r){const o=this.getLayer(e);if(o)return o.getLayoutProperty(r);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,r,o,h={}){this._checkLoaded();const p=this.getLayer(e);p?a.aE(p.getPaintProperty(r),o)||(p.setPaintProperty(r,o,h)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,r){return this.getLayer(e).getPaintProperty(r)}setFeatureState(e,r){this._checkLoaded();const o=e.source,h=e.sourceLayer,p=this.sourceCaches[o];if(p===void 0)return void this.fire(new a.j(new Error(`The source '${o}' does not exist in the map's style.`)));const w=p.getSource().type;w==="geojson"&&h?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||h?(e.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),p.setFeatureState(h,e.id,r)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,r){this._checkLoaded();const o=e.source,h=this.sourceCaches[o];if(h===void 0)return void this.fire(new a.j(new Error(`The source '${o}' does not exist in the map's style.`)));const p=h.getSource().type,w=p==="vector"?e.sourceLayer:void 0;p!=="vector"||w?r&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(w,e.id,r):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const r=e.source,o=e.sourceLayer,h=this.sourceCaches[r];if(h!==void 0)return h.getSource().type!=="vector"||o?(e.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),h.getFeatureState(o,e.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=a.aF(this.sourceCaches,p=>p.serialize()),r=this._serializeByIds(this._order,!0),o=this.map.getTerrain()||void 0,h=this.stylesheet;return a.aG({version:h.version,name:h.name,metadata:h.metadata,light:h.light,sky:h.sky,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,sources:e,layers:r,terrain:o},p=>p!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const r=w=>this._layers[w].type==="fill-extrusion",o={},h=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(r(S)){o[S]=w;for(const P of e){const M=P[S];if(M)for(const R of M)h.push(R)}}}h.sort((w,S)=>S.intersectionZ-w.intersectionZ);const p=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(r(S))for(let P=h.length-1;P>=0;P--){const M=h[P].feature;if(o[M.layer.id]<w)break;p.push(M),h.pop()}else for(const P of e){const M=P[S];if(M)for(const R of M)p.push(R.feature)}}return p}queryRenderedFeatures(e,r,o){r&&r.filter&&this._validate(a.u.filter,"queryRenderedFeatures.filter",r.filter,null,r);const h={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const S of r.layers){const P=this._layers[S];if(!P)return this.fire(new a.j(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];h[P.source]=!0}}const p=[];r.availableImages=this._availableImages;const w=this._serializedAllLayers();for(const S in this.sourceCaches)r.layers&&!h[S]||p.push(zt(this.sourceCaches[S],this._layers,w,e,r,o));return this.placement&&p.push(function(S,P,M,R,N,W,H){const G={},K=W.queryRenderedSymbols(R),se=[];for(const oe of Object.keys(K).map(Number))se.push(H[oe]);se.sort(ti);for(const oe of se){const he=oe.featureIndex.lookupSymbolFeatures(K[oe.bucketInstanceId],P,oe.bucketIndex,oe.sourceLayerIndex,N.filter,N.layers,N.availableImages,S);for(const le in he){const _e=G[le]=G[le]||[],Me=he[le];Me.sort((Te,rt)=>{const mt=oe.featureSortOrder;if(mt){const vt=mt.indexOf(Te.featureIndex);return mt.indexOf(rt.featureIndex)-vt}return rt.featureIndex-Te.featureIndex});for(const Te of Me)_e.push(Te)}}for(const oe in G)G[oe].forEach(he=>{const le=he.feature,_e=M[S[oe].source].getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=_e});return G}(this._layers,w,this.sourceCaches,e,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(e,r){r&&r.filter&&this._validate(a.u.filter,"querySourceFeatures.filter",r.filter,null,r);const o=this.sourceCaches[e];return o?function(h,p){const w=h.getRenderableIds().map(M=>h.getTileByID(M)),S=[],P={};for(let M=0;M<w.length;M++){const R=w[M],N=R.tileID.canonical.key;P[N]||(P[N]=!0,R.querySourceFeatures(S,p))}return S}(o,r):[]}getLight(){return this.light.getLight()}setLight(e,r={}){this._checkLoaded();const o=this.light.getLight();let h=!1;for(const w in e)if(!a.aE(e[w],o[w])){h=!0;break}if(!h)return;const p={now:O.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(p)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,r={}){const o=this.getSky();let h=!1;if(!e&&!o)return;if(e&&!o)h=!0;else if(!e&&o)h=!0;else for(const w in e)if(!a.aE(e[w],o[w])){h=!0;break}if(!h)return;const p={now:O.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,r),this.sky.updateTransitions(p)}_validate(e,r,o,h,p={}){return(!p||p.validate!==!1)&&Lr(this,e.call(a.u,a.e({key:r,style:this.serialize(),value:o,styleSpec:a.v},h)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Rt().off(yt,this._rtlPluginLoaded);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const o=this.sourceCaches[r];o.setEventedParent(null),o.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const r in this.sourceCaches)this.sourceCaches[r].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,r,o,h,p=!1){let w=!1,S=!1;const P={};for(const M of this._order){const R=this._layers[M];if(R.type!=="symbol")continue;if(!P[R.source]){const W=this.sourceCaches[R.source];P[R.source]=W.getRenderableIds(!0).map(H=>W.getTileByID(H)).sort((H,G)=>G.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(G.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(R,P[R.source],e.center.lng);w=w||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||o===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(O.now(),e.zoom))&&(this.pauseablePlacement=new sr(e,this.map.terrain,this._order,p,r,o,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(O.now()),S=!0),w&&this.pauseablePlacement.placement.setStale()),S||w)for(const M of this._order){const R=this._layers[M];R.type==="symbol"&&this.placement.updateLayerOpacities(R,P[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(O.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,r){return a._(this,void 0,void 0,function*(){const o=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();const h=this.sourceCaches[r.source];return h&&h.setDependencies(r.tileID.key,r.type,r.icons),o})}getGlyphs(e,r){return a._(this,void 0,void 0,function*(){const o=yield this.glyphManager.getGlyphs(r.stacks),h=this.sourceCaches[r.source];return h&&h.setDependencies(r.tileID.key,r.type,[""]),o})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,r={}){this._checkLoaded(),e&&this._validate(a.u.glyphs,"glyphs",e,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,r,o={},h){this._checkLoaded();const p=[{id:e,url:r}],w=[...Qe(this.stylesheet.sprite),...p];this._validate(a.u.sprite,"sprite",w,null,o)||(this.stylesheet.sprite=w,this._loadSprite(p,!0,h))}removeSprite(e){this._checkLoaded();const r=Qe(this.stylesheet.sprite);if(r.find(o=>o.id===e)){if(this._spritesImagesIds[e])for(const o of this._spritesImagesIds[e])this.imageManager.removeImage(o),this._changedImages[o]=!0;r.splice(r.findIndex(o=>o.id===e),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Qe(this.stylesheet.sprite)}setSprite(e,r={},o){this._checkLoaded(),e&&this._validate(a.u.sprite,"sprite",e,null,r)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,o):(this._unloadSprite(),o&&o(null)))}}var cs=a.Y([{name:"a_pos",type:"Int16",components:2}]);const hs={prelude:Vi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Vi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Vi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Vi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Vi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Vi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Vi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Vi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Vi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Vi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Vi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Vi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Vi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Vi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Vi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Vi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Vi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Vi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Vi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Vi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Vi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Vi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Vi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Vi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Vi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Vi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Vi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Vi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Vi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Vi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Vi(c,e){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,o=e.match(/attribute ([\w]+) ([\w]+)/g),h=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=p?p.concat(h):h,S={};return{fragmentSource:c=c.replace(r,(P,M,R,N,W)=>(S[W]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${W}
varying ${R} ${N} ${W};
#else
uniform ${R} ${N} u_${W};
#endif
`:`
#ifdef HAS_UNIFORM_u_${W}
    ${R} ${N} ${W} = u_${W};
#endif
`)),vertexSource:e=e.replace(r,(P,M,R,N,W)=>{const H=N==="float"?"vec2":"vec4",G=W.match(/color/)?"color":H;return S[W]?M==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
attribute ${R} ${H} a_${W};
varying ${R} ${N} ${W};
#else
uniform ${R} ${N} u_${W};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = a_${W};
#else
    ${R} ${N} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = unpack_mix_${G}(a_${W}, u_${W}_t);
#else
    ${R} ${N} ${W} = u_${W};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
attribute ${R} ${H} a_${W};
#else
uniform ${R} ${N} u_${W};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${R} ${N} ${W} = a_${W};
#else
    ${R} ${N} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${R} ${N} ${W} = unpack_mix_${G}(a_${W}, u_${W}_t);
#else
    ${R} ${N} ${W} = u_${W};
#endif
`}),staticAttributes:o,staticUniforms:w}}class mo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,r,o,h,p,w,S,P,M){this.context=e;let R=this.boundPaintVertexBuffers.length!==h.length;for(let N=0;!R&&N<h.length;N++)this.boundPaintVertexBuffers[N]!==h[N]&&(R=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==o||R||this.boundIndexBuffer!==p||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==P||this.boundDynamicVertexBuffer3!==M?this.freshBind(r,o,h,p,w,S,P,M):(e.bindVertexArray.set(this.vao),S&&S.bind(),p&&p.dynamicDraw&&p.bind(),P&&P.bind(),M&&M.bind())}freshBind(e,r,o,h,p,w,S,P){const M=e.numAttributes,R=this.context,N=R.gl;this.vao&&this.destroy(),this.vao=R.createVertexArray(),R.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=h,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=P,r.enableAttributes(N,e);for(const W of o)W.enableAttributes(N,e);w&&w.enableAttributes(N,e),S&&S.enableAttributes(N,e),P&&P.enableAttributes(N,e),r.bind(),r.setVertexAttribPointers(N,e,p);for(const W of o)W.bind(),W.setVertexAttribPointers(N,e,p);w&&(w.bind(),w.setVertexAttribPointers(N,e,p)),h&&h.bind(),S&&(S.bind(),S.setVertexAttribPointers(N,e,p)),P&&(P.bind(),P.setVertexAttribPointers(N,e,p)),R.currentNumAttributes=M}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const al=(c,e,r,o,h)=>({u_matrix:c,u_texture:0,u_ele_delta:e,u_fog_matrix:r,u_fog_color:o?o.properties.get("fog-color"):a.aM.white,u_fog_ground_blend:o?o.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:o?o.calculateFogBlendOpacity(h):0,u_horizon_color:o?o.properties.get("horizon-color"):a.aM.white,u_horizon_fog_blend:o?o.properties.get("horizon-fog-blend"):1});function Ks(c){const e=[];for(let r=0;r<c.length;r++){if(c[r]===null)continue;const o=c[r].split(" ");e.push(o.pop())}return e}class ol{constructor(e,r,o,h,p,w){const S=e.gl;this.program=S.createProgram();const P=Ks(r.staticAttributes),M=o?o.getBinderAttributes():[],R=P.concat(M),N=hs.prelude.staticUniforms?Ks(hs.prelude.staticUniforms):[],W=r.staticUniforms?Ks(r.staticUniforms):[],H=o?o.getBinderUniforms():[],G=N.concat(W).concat(H),K=[];for(const Te of G)K.indexOf(Te)<0&&K.push(Te);const se=o?o.defines():[];p&&se.push("#define OVERDRAW_INSPECTOR;"),w&&se.push("#define TERRAIN3D;");const oe=se.concat(hs.prelude.fragmentSource,r.fragmentSource).join(`
`),he=se.concat(hs.prelude.vertexSource,r.vertexSource).join(`
`),le=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(le,oe),S.compileShader(le),!S.getShaderParameter(le,S.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${S.getShaderInfoLog(le)}`);S.attachShader(this.program,le);const _e=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(_e,he),S.compileShader(_e),!S.getShaderParameter(_e,S.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${S.getShaderInfoLog(_e)}`);S.attachShader(this.program,_e),this.attributes={};const Me={};this.numAttributes=R.length;for(let Te=0;Te<this.numAttributes;Te++)R[Te]&&(S.bindAttribLocation(this.program,Te,R[Te]),this.attributes[R[Te]]=Te);if(S.linkProgram(this.program),!S.getProgramParameter(this.program,S.LINK_STATUS))throw new Error(`Program failed to link: ${S.getProgramInfoLog(this.program)}`);S.deleteShader(_e),S.deleteShader(le);for(let Te=0;Te<K.length;Te++){const rt=K[Te];if(rt&&!Me[rt]){const mt=S.getUniformLocation(this.program,rt);mt&&(Me[rt]=mt)}}this.fixedUniforms=h(e,Me),this.terrainUniforms=((Te,rt)=>({u_depth:new a.aH(Te,rt.u_depth),u_terrain:new a.aH(Te,rt.u_terrain),u_terrain_dim:new a.aI(Te,rt.u_terrain_dim),u_terrain_matrix:new a.aJ(Te,rt.u_terrain_matrix),u_terrain_unpack:new a.aK(Te,rt.u_terrain_unpack),u_terrain_exaggeration:new a.aI(Te,rt.u_terrain_exaggeration)}))(e,Me),this.binderUniforms=o?o.getUniforms(e,Me):[]}draw(e,r,o,h,p,w,S,P,M,R,N,W,H,G,K,se,oe,he){const le=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(o),e.setStencilMode(h),e.setColorMode(p),e.setCullFace(w),P){e.activeTexture.set(le.TEXTURE2),le.bindTexture(le.TEXTURE_2D,P.depthTexture),e.activeTexture.set(le.TEXTURE3),le.bindTexture(le.TEXTURE_2D,P.texture);for(const Me in this.terrainUniforms)this.terrainUniforms[Me].set(P[Me])}for(const Me in this.fixedUniforms)this.fixedUniforms[Me].set(S[Me]);K&&K.setUniforms(e,this.binderUniforms,H,{zoom:G});let _e=0;switch(r){case le.LINES:_e=2;break;case le.TRIANGLES:_e=3;break;case le.LINE_STRIP:_e=1}for(const Me of W.get()){const Te=Me.vaos||(Me.vaos={});(Te[M]||(Te[M]=new mo)).bind(e,this,R,K?K.getPaintVertexBuffers():[],N,Me.vertexOffset,se,oe,he),le.drawElements(r,Me.primitiveLength*_e,le.UNSIGNED_SHORT,Me.primitiveOffset*_e*2)}}}function va(c,e,r){const o=1/yi(r,1,e.transform.tileZoom),h=Math.pow(2,r.tileID.overscaledZ),p=r.tileSize*Math.pow(2,e.transform.tileZoom)/h,w=p*(r.tileID.canonical.x+r.tileID.wrap*h),S=p*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[o,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[w>>16,S>>16],u_pixel_coord_lower:[65535&w,65535&S]}}const qa=(c,e,r,o)=>{const h=e.style.light,p=h.properties.get("position"),w=[p.x,p.y,p.z],S=function(){var M=new a.A(9);return a.A!=Float32Array&&(M[1]=0,M[2]=0,M[3]=0,M[5]=0,M[6]=0,M[7]=0),M[0]=1,M[4]=1,M[8]=1,M}();h.properties.get("anchor")==="viewport"&&function(M,R){var N=Math.sin(R),W=Math.cos(R);M[0]=W,M[1]=N,M[2]=0,M[3]=-N,M[4]=W,M[5]=0,M[6]=0,M[7]=0,M[8]=1}(S,-e.transform.angle),function(M,R,N){var W=R[0],H=R[1],G=R[2];M[0]=W*N[0]+H*N[3]+G*N[6],M[1]=W*N[1]+H*N[4]+G*N[7],M[2]=W*N[2]+H*N[5]+G*N[8]}(w,w,S);const P=h.properties.get("color");return{u_matrix:c,u_lightpos:w,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[P.r,P.g,P.b],u_vertical_gradient:+r,u_opacity:o}},go=(c,e,r,o,h,p,w)=>a.e(qa(c,e,r,o),va(p,e,w),{u_height_factor:-Math.pow(2,h.overscaledZ)/w.tileSize/8}),ba=c=>({u_matrix:c}),Ps=(c,e,r,o)=>a.e(ba(c),va(r,e,o)),yo=(c,e)=>({u_matrix:c,u_world:e}),Va=(c,e,r,o,h)=>a.e(Ps(c,e,r,o),{u_world:h}),Dl=(c,e,r,o)=>{const h=c.transform;let p,w;if(o.paint.get("circle-pitch-alignment")==="map"){const S=yi(r,1,h.zoom);p=!0,w=[S,S]}else p=!1,w=h.pixelsToGLUnits;return{u_camera_to_center_distance:h.cameraToCenterDistance,u_scale_with_map:+(o.paint.get("circle-pitch-scale")==="map"),u_matrix:c.translatePosMatrix(e.posMatrix,r,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_pitch_with_map:+p,u_device_pixel_ratio:c.pixelRatio,u_extrude_scale:w}},Ar=(c,e,r)=>({u_matrix:c,u_inv_matrix:e,u_camera_to_center_distance:r.cameraToCenterDistance,u_viewport_size:[r.width,r.height]}),Ua=(c,e,r=1)=>({u_matrix:c,u_color:e,u_overlay:0,u_overlay_scale:r}),Gr=c=>({u_matrix:c}),oi=(c,e,r,o)=>({u_matrix:c,u_extrude_scale:yi(e,1,r),u_intensity:o}),_o=(c,e,r,o)=>{const h=a.H();a.aP(h,0,c.width,c.height,0,0,1);const p=c.context.gl;return{u_matrix:h,u_world:[p.drawingBufferWidth,p.drawingBufferHeight],u_image:r,u_color_ramp:o,u_opacity:e.paint.get("heatmap-opacity")}};function vo(c,e){const r=Math.pow(2,e.canonical.z),o=e.canonical.y;return[new a.Z(0,o/r).toLngLat().lat,new a.Z(0,(o+1)/r).toLngLat().lat]}const zn=(c,e,r,o)=>{const h=c.transform;return{u_matrix:Fl(c,e,r,o),u_ratio:1/yi(e,1,h.zoom),u_device_pixel_ratio:c.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},ll=(c,e,r,o,h)=>a.e(zn(c,e,r,h),{u_image:0,u_image_height:o}),Ys=(c,e,r,o,h)=>{const p=c.transform,w=xo(e,p);return{u_matrix:Fl(c,e,r,h),u_texsize:e.imageAtlasTexture.size,u_ratio:1/yi(e,1,p.zoom),u_device_pixel_ratio:c.pixelRatio,u_image:0,u_scale:[w,o.fromScale,o.toScale],u_fade:o.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},bo=(c,e,r,o,h,p)=>{const w=c.lineAtlas,S=xo(e,c.transform),P=r.layout.get("line-cap")==="round",M=w.getDash(o.from,P),R=w.getDash(o.to,P),N=M.width*h.fromScale,W=R.width*h.toScale;return a.e(zn(c,e,r,p),{u_patternscale_a:[S/N,-M.height/2],u_patternscale_b:[S/W,-R.height/2],u_sdfgamma:w.width/(256*Math.min(N,W)*c.pixelRatio)/2,u_image:0,u_tex_y_a:M.y,u_tex_y_b:R.y,u_mix:h.t})};function xo(c,e){return 1/yi(c,1,e.tileZoom)}function Fl(c,e,r,o){return c.translatePosMatrix(o?o.posMatrix:e.tileID.posMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const oc=(c,e,r,o,h)=>{return{u_matrix:c,u_tl_parent:e,u_scale_parent:r,u_buffer_scale:1,u_fade_t:o.mix,u_opacity:o.opacity*h.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:h.paint.get("raster-brightness-min"),u_brightness_high:h.paint.get("raster-brightness-max"),u_saturation_factor:(w=h.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(p=h.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:lc(h.paint.get("raster-hue-rotate"))};var p,w};function lc(c){c*=Math.PI/180;const e=Math.sin(c),r=Math.cos(c);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}const wo=(c,e,r,o,h,p,w,S,P,M,R,N,W,H)=>{const G=w.transform;return{u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:G.cameraToCenterDistance,u_pitch:G.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:G.width/G.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:P,u_coord_matrix:M,u_is_text:+N,u_pitch_with_map:+o,u_is_along_line:h,u_is_variable_anchor:p,u_texsize:W,u_texture:0,u_translation:R,u_pitched_scale:H}},us=(c,e,r,o,h,p,w,S,P,M,R,N,W,H,G)=>{const K=w.transform;return a.e(wo(c,e,r,o,h,p,w,S,P,M,R,N,W,G),{u_gamma_scale:o?Math.cos(K._pitch)*K.cameraToCenterDistance:1,u_device_pixel_ratio:w.pixelRatio,u_is_halo:+H})},Ls=(c,e,r,o,h,p,w,S,P,M,R,N,W,H)=>a.e(us(c,e,r,o,h,p,w,S,P,M,R,!0,N,!0,H),{u_texsize_icon:W,u_texture_icon:1}),So=(c,e,r)=>({u_matrix:c,u_opacity:e,u_color:r}),Js=(c,e,r,o,h,p)=>a.e(function(w,S,P,M){const R=P.imageManager.getPattern(w.from.toString()),N=P.imageManager.getPattern(w.to.toString()),{width:W,height:H}=P.imageManager.getPixelSize(),G=Math.pow(2,M.tileID.overscaledZ),K=M.tileSize*Math.pow(2,P.transform.tileZoom)/G,se=K*(M.tileID.canonical.x+M.tileID.wrap*G),oe=K*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[W,H],u_mix:S.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/yi(M,1,P.transform.tileZoom),u_pixel_coord_upper:[se>>16,oe>>16],u_pixel_coord_lower:[65535&se,65535&oe]}}(o,p,r,h),{u_matrix:c,u_opacity:e}),$a={fillExtrusion:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix),u_lightpos:new a.aN(c,e.u_lightpos),u_lightintensity:new a.aI(c,e.u_lightintensity),u_lightcolor:new a.aN(c,e.u_lightcolor),u_vertical_gradient:new a.aI(c,e.u_vertical_gradient),u_opacity:new a.aI(c,e.u_opacity)}),fillExtrusionPattern:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix),u_lightpos:new a.aN(c,e.u_lightpos),u_lightintensity:new a.aI(c,e.u_lightintensity),u_lightcolor:new a.aN(c,e.u_lightcolor),u_vertical_gradient:new a.aI(c,e.u_vertical_gradient),u_height_factor:new a.aI(c,e.u_height_factor),u_image:new a.aH(c,e.u_image),u_texsize:new a.aO(c,e.u_texsize),u_pixel_coord_upper:new a.aO(c,e.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(c,e.u_pixel_coord_lower),u_scale:new a.aN(c,e.u_scale),u_fade:new a.aI(c,e.u_fade),u_opacity:new a.aI(c,e.u_opacity)}),fill:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix)}),fillPattern:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix),u_image:new a.aH(c,e.u_image),u_texsize:new a.aO(c,e.u_texsize),u_pixel_coord_upper:new a.aO(c,e.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(c,e.u_pixel_coord_lower),u_scale:new a.aN(c,e.u_scale),u_fade:new a.aI(c,e.u_fade)}),fillOutline:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix),u_world:new a.aO(c,e.u_world)}),fillOutlinePattern:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix),u_world:new a.aO(c,e.u_world),u_image:new a.aH(c,e.u_image),u_texsize:new a.aO(c,e.u_texsize),u_pixel_coord_upper:new a.aO(c,e.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(c,e.u_pixel_coord_lower),u_scale:new a.aN(c,e.u_scale),u_fade:new a.aI(c,e.u_fade)}),circle:(c,e)=>({u_camera_to_center_distance:new a.aI(c,e.u_camera_to_center_distance),u_scale_with_map:new a.aH(c,e.u_scale_with_map),u_pitch_with_map:new a.aH(c,e.u_pitch_with_map),u_extrude_scale:new a.aO(c,e.u_extrude_scale),u_device_pixel_ratio:new a.aI(c,e.u_device_pixel_ratio),u_matrix:new a.aJ(c,e.u_matrix)}),collisionBox:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix),u_pixel_extrude_scale:new a.aO(c,e.u_pixel_extrude_scale)}),collisionCircle:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix),u_inv_matrix:new a.aJ(c,e.u_inv_matrix),u_camera_to_center_distance:new a.aI(c,e.u_camera_to_center_distance),u_viewport_size:new a.aO(c,e.u_viewport_size)}),debug:(c,e)=>({u_color:new a.aL(c,e.u_color),u_matrix:new a.aJ(c,e.u_matrix),u_overlay:new a.aH(c,e.u_overlay),u_overlay_scale:new a.aI(c,e.u_overlay_scale)}),clippingMask:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix)}),heatmap:(c,e)=>({u_extrude_scale:new a.aI(c,e.u_extrude_scale),u_intensity:new a.aI(c,e.u_intensity),u_matrix:new a.aJ(c,e.u_matrix)}),heatmapTexture:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix),u_world:new a.aO(c,e.u_world),u_image:new a.aH(c,e.u_image),u_color_ramp:new a.aH(c,e.u_color_ramp),u_opacity:new a.aI(c,e.u_opacity)}),hillshade:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix),u_image:new a.aH(c,e.u_image),u_latrange:new a.aO(c,e.u_latrange),u_light:new a.aO(c,e.u_light),u_shadow:new a.aL(c,e.u_shadow),u_highlight:new a.aL(c,e.u_highlight),u_accent:new a.aL(c,e.u_accent)}),hillshadePrepare:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix),u_image:new a.aH(c,e.u_image),u_dimension:new a.aO(c,e.u_dimension),u_zoom:new a.aI(c,e.u_zoom),u_unpack:new a.aK(c,e.u_unpack)}),line:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix),u_ratio:new a.aI(c,e.u_ratio),u_device_pixel_ratio:new a.aI(c,e.u_device_pixel_ratio),u_units_to_pixels:new a.aO(c,e.u_units_to_pixels)}),lineGradient:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix),u_ratio:new a.aI(c,e.u_ratio),u_device_pixel_ratio:new a.aI(c,e.u_device_pixel_ratio),u_units_to_pixels:new a.aO(c,e.u_units_to_pixels),u_image:new a.aH(c,e.u_image),u_image_height:new a.aI(c,e.u_image_height)}),linePattern:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix),u_texsize:new a.aO(c,e.u_texsize),u_ratio:new a.aI(c,e.u_ratio),u_device_pixel_ratio:new a.aI(c,e.u_device_pixel_ratio),u_image:new a.aH(c,e.u_image),u_units_to_pixels:new a.aO(c,e.u_units_to_pixels),u_scale:new a.aN(c,e.u_scale),u_fade:new a.aI(c,e.u_fade)}),lineSDF:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix),u_ratio:new a.aI(c,e.u_ratio),u_device_pixel_ratio:new a.aI(c,e.u_device_pixel_ratio),u_units_to_pixels:new a.aO(c,e.u_units_to_pixels),u_patternscale_a:new a.aO(c,e.u_patternscale_a),u_patternscale_b:new a.aO(c,e.u_patternscale_b),u_sdfgamma:new a.aI(c,e.u_sdfgamma),u_image:new a.aH(c,e.u_image),u_tex_y_a:new a.aI(c,e.u_tex_y_a),u_tex_y_b:new a.aI(c,e.u_tex_y_b),u_mix:new a.aI(c,e.u_mix)}),raster:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix),u_tl_parent:new a.aO(c,e.u_tl_parent),u_scale_parent:new a.aI(c,e.u_scale_parent),u_buffer_scale:new a.aI(c,e.u_buffer_scale),u_fade_t:new a.aI(c,e.u_fade_t),u_opacity:new a.aI(c,e.u_opacity),u_image0:new a.aH(c,e.u_image0),u_image1:new a.aH(c,e.u_image1),u_brightness_low:new a.aI(c,e.u_brightness_low),u_brightness_high:new a.aI(c,e.u_brightness_high),u_saturation_factor:new a.aI(c,e.u_saturation_factor),u_contrast_factor:new a.aI(c,e.u_contrast_factor),u_spin_weights:new a.aN(c,e.u_spin_weights)}),symbolIcon:(c,e)=>({u_is_size_zoom_constant:new a.aH(c,e.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(c,e.u_is_size_feature_constant),u_size_t:new a.aI(c,e.u_size_t),u_size:new a.aI(c,e.u_size),u_camera_to_center_distance:new a.aI(c,e.u_camera_to_center_distance),u_pitch:new a.aI(c,e.u_pitch),u_rotate_symbol:new a.aH(c,e.u_rotate_symbol),u_aspect_ratio:new a.aI(c,e.u_aspect_ratio),u_fade_change:new a.aI(c,e.u_fade_change),u_matrix:new a.aJ(c,e.u_matrix),u_label_plane_matrix:new a.aJ(c,e.u_label_plane_matrix),u_coord_matrix:new a.aJ(c,e.u_coord_matrix),u_is_text:new a.aH(c,e.u_is_text),u_pitch_with_map:new a.aH(c,e.u_pitch_with_map),u_is_along_line:new a.aH(c,e.u_is_along_line),u_is_variable_anchor:new a.aH(c,e.u_is_variable_anchor),u_texsize:new a.aO(c,e.u_texsize),u_texture:new a.aH(c,e.u_texture),u_translation:new a.aO(c,e.u_translation),u_pitched_scale:new a.aI(c,e.u_pitched_scale)}),symbolSDF:(c,e)=>({u_is_size_zoom_constant:new a.aH(c,e.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(c,e.u_is_size_feature_constant),u_size_t:new a.aI(c,e.u_size_t),u_size:new a.aI(c,e.u_size),u_camera_to_center_distance:new a.aI(c,e.u_camera_to_center_distance),u_pitch:new a.aI(c,e.u_pitch),u_rotate_symbol:new a.aH(c,e.u_rotate_symbol),u_aspect_ratio:new a.aI(c,e.u_aspect_ratio),u_fade_change:new a.aI(c,e.u_fade_change),u_matrix:new a.aJ(c,e.u_matrix),u_label_plane_matrix:new a.aJ(c,e.u_label_plane_matrix),u_coord_matrix:new a.aJ(c,e.u_coord_matrix),u_is_text:new a.aH(c,e.u_is_text),u_pitch_with_map:new a.aH(c,e.u_pitch_with_map),u_is_along_line:new a.aH(c,e.u_is_along_line),u_is_variable_anchor:new a.aH(c,e.u_is_variable_anchor),u_texsize:new a.aO(c,e.u_texsize),u_texture:new a.aH(c,e.u_texture),u_gamma_scale:new a.aI(c,e.u_gamma_scale),u_device_pixel_ratio:new a.aI(c,e.u_device_pixel_ratio),u_is_halo:new a.aH(c,e.u_is_halo),u_translation:new a.aO(c,e.u_translation),u_pitched_scale:new a.aI(c,e.u_pitched_scale)}),symbolTextAndIcon:(c,e)=>({u_is_size_zoom_constant:new a.aH(c,e.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(c,e.u_is_size_feature_constant),u_size_t:new a.aI(c,e.u_size_t),u_size:new a.aI(c,e.u_size),u_camera_to_center_distance:new a.aI(c,e.u_camera_to_center_distance),u_pitch:new a.aI(c,e.u_pitch),u_rotate_symbol:new a.aH(c,e.u_rotate_symbol),u_aspect_ratio:new a.aI(c,e.u_aspect_ratio),u_fade_change:new a.aI(c,e.u_fade_change),u_matrix:new a.aJ(c,e.u_matrix),u_label_plane_matrix:new a.aJ(c,e.u_label_plane_matrix),u_coord_matrix:new a.aJ(c,e.u_coord_matrix),u_is_text:new a.aH(c,e.u_is_text),u_pitch_with_map:new a.aH(c,e.u_pitch_with_map),u_is_along_line:new a.aH(c,e.u_is_along_line),u_is_variable_anchor:new a.aH(c,e.u_is_variable_anchor),u_texsize:new a.aO(c,e.u_texsize),u_texsize_icon:new a.aO(c,e.u_texsize_icon),u_texture:new a.aH(c,e.u_texture),u_texture_icon:new a.aH(c,e.u_texture_icon),u_gamma_scale:new a.aI(c,e.u_gamma_scale),u_device_pixel_ratio:new a.aI(c,e.u_device_pixel_ratio),u_is_halo:new a.aH(c,e.u_is_halo),u_translation:new a.aO(c,e.u_translation),u_pitched_scale:new a.aI(c,e.u_pitched_scale)}),background:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix),u_opacity:new a.aI(c,e.u_opacity),u_color:new a.aL(c,e.u_color)}),backgroundPattern:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix),u_opacity:new a.aI(c,e.u_opacity),u_image:new a.aH(c,e.u_image),u_pattern_tl_a:new a.aO(c,e.u_pattern_tl_a),u_pattern_br_a:new a.aO(c,e.u_pattern_br_a),u_pattern_tl_b:new a.aO(c,e.u_pattern_tl_b),u_pattern_br_b:new a.aO(c,e.u_pattern_br_b),u_texsize:new a.aO(c,e.u_texsize),u_mix:new a.aI(c,e.u_mix),u_pattern_size_a:new a.aO(c,e.u_pattern_size_a),u_pattern_size_b:new a.aO(c,e.u_pattern_size_b),u_scale_a:new a.aI(c,e.u_scale_a),u_scale_b:new a.aI(c,e.u_scale_b),u_pixel_coord_upper:new a.aO(c,e.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(c,e.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aI(c,e.u_tile_units_to_pixels)}),terrain:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix),u_texture:new a.aH(c,e.u_texture),u_ele_delta:new a.aI(c,e.u_ele_delta),u_fog_matrix:new a.aJ(c,e.u_fog_matrix),u_fog_color:new a.aL(c,e.u_fog_color),u_fog_ground_blend:new a.aI(c,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.aI(c,e.u_fog_ground_blend_opacity),u_horizon_color:new a.aL(c,e.u_horizon_color),u_horizon_fog_blend:new a.aI(c,e.u_horizon_fog_blend)}),terrainDepth:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix),u_ele_delta:new a.aI(c,e.u_ele_delta)}),terrainCoords:(c,e)=>({u_matrix:new a.aJ(c,e.u_matrix),u_texture:new a.aH(c,e.u_texture),u_terrain_coords_id:new a.aI(c,e.u_terrain_coords_id),u_ele_delta:new a.aI(c,e.u_ele_delta)}),sky:(c,e)=>({u_sky_color:new a.aL(c,e.u_sky_color),u_horizon_color:new a.aL(c,e.u_horizon_color),u_horizon:new a.aI(c,e.u_horizon),u_sky_horizon_blend:new a.aI(c,e.u_sky_horizon_blend)})};class gn{constructor(e,r,o){this.context=e;const h=e.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!o,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Rl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ao{constructor(e,r,o,h){this.length=r.length,this.attributes=o,this.itemSize=r.bytesPerElement,this.dynamicDraw=h,this.context=e;const p=e.gl;this.buffer=p.createBuffer(),e.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,r){for(let o=0;o<this.attributes.length;o++){const h=r.attributes[this.attributes[o].name];h!==void 0&&e.enableVertexAttribArray(h)}}setVertexAttribPointers(e,r,o){for(let h=0;h<this.attributes.length;h++){const p=this.attributes[h],w=r.attributes[p.name];w!==void 0&&e.vertexAttribPointer(w,p.components,e[Rl[p.type]],!1,this.itemSize,p.offset+this.itemSize*(o||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ks=new WeakMap;function ds(c){var e;if(ks.has(c))return ks.get(c);{const r=(e=c.getParameter(c.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return ks.set(c,r),r}}class Ci{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Zn extends Ci{getDefault(){return a.aM.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class cc extends Ci{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Nn extends Ci{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class ps extends Ci{getDefault(){return[!0,!0,!0,!0]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Io extends Ci{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Za extends Ci{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Ol extends Ci{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const r=this.current;(e.func!==r.func||e.ref!==r.ref||e.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class xa extends Ci{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Bl extends Ci{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=e,this.dirty=!1}}class Po extends Ci{getDefault(){return[0,1]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Lo extends Ci{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=e,this.dirty=!1}}class cl extends Ci{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Gn extends Ci{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.BLEND):r.disable(r.BLEND),this.current=e,this.dirty=!1}}class ko extends Ci{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class hl extends Ci{getDefault(){return a.aM.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class ul extends Ci{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Ga extends Ci{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=e,this.dirty=!1}}class To extends Ci{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Ts extends Ci{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class dl extends Ci{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class wa extends Ci{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Co extends Ci{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class E extends Ci{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Q extends Ci{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ie extends Ci{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Be extends Ci{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class We extends Ci{getDefault(){return null}set(e){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ut extends Ci{getDefault(){return null}set(e){var r;if(e===this.current&&!this.dirty)return;const o=this.gl;ds(o)?o.bindVertexArray(e):(r=o.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Lt extends Ci{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class $t extends Ci{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class ci extends Ci{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Ai extends Ci{constructor(e,r){super(e),this.context=e,this.parent=r}getDefault(){return null}}class Ii extends Ai{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Di extends Ai{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ar extends Ai{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class kr{constructor(e,r,o,h,p){this.context=e,this.width=r,this.height=o;const w=e.gl,S=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new Ii(e,S),h)this.depthAttachment=p?new ar(e,S):new Di(e,S);else if(p)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,r=this.colorAttachment.get();if(r&&e.deleteTexture(r),this.depthAttachment){const o=this.depthAttachment.get();o&&e.deleteRenderbuffer(o)}e.deleteFramebuffer(this.framebuffer)}}class Ei{constructor(e,r,o){this.blendFunction=e,this.blendColor=r,this.mask=o}}Ei.Replace=[1,0],Ei.disabled=new Ei(Ei.Replace,a.aM.transparent,[!1,!1,!1,!1]),Ei.unblended=new Ei(Ei.Replace,a.aM.transparent,[!0,!0,!0,!0]),Ei.alphaBlended=new Ei([1,771],a.aM.transparent,[!0,!0,!0,!0]);class nn{constructor(e){var r,o;if(this.gl=e,this.clearColor=new Zn(this),this.clearDepth=new cc(this),this.clearStencil=new Nn(this),this.colorMask=new ps(this),this.depthMask=new Io(this),this.stencilMask=new Za(this),this.stencilFunc=new Ol(this),this.stencilOp=new xa(this),this.stencilTest=new Bl(this),this.depthRange=new Po(this),this.depthTest=new Lo(this),this.depthFunc=new cl(this),this.blend=new Gn(this),this.blendFunc=new ko(this),this.blendColor=new hl(this),this.blendEquation=new ul(this),this.cullFace=new Ga(this),this.cullFaceSide=new To(this),this.frontFace=new Ts(this),this.program=new dl(this),this.activeTexture=new wa(this),this.viewport=new Co(this),this.bindFramebuffer=new E(this),this.bindRenderbuffer=new Q(this),this.bindTexture=new Ie(this),this.bindVertexBuffer=new Be(this),this.bindElementBuffer=new We(this),this.bindVertexArray=new ut(this),this.pixelStoreUnpack=new Lt(this),this.pixelStoreUnpackPremultiplyAlpha=new $t(this),this.pixelStoreUnpackFlipY=new ci(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ds(e)){this.HALF_FLOAT=e.HALF_FLOAT;const h=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=e.RGBA16F)!==null&&r!==void 0?r:h==null?void 0:h.RGBA16F_EXT,this.RGB16F=(o=e.RGB16F)!==null&&o!==void 0?o:h==null?void 0:h.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const h=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=h==null?void 0:h.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,r){return new gn(this,e,r)}createVertexBuffer(e,r,o){return new Ao(this,e,r,o)}createRenderbuffer(e,r,o){const h=this.gl,p=h.createRenderbuffer();return this.bindRenderbuffer.set(p),h.renderbufferStorage(h.RENDERBUFFER,e,r,o),this.bindRenderbuffer.set(null),p}createFramebuffer(e,r,o,h){return new kr(this,e,r,o,h)}clear({color:e,depth:r,stencil:o}){const h=this.gl;let p=0;e&&(p|=h.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(p|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),o!==void 0&&(p|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(o),this.stencilMask.set(255)),h.clear(p)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){a.aE(e.blendFunction,Ei.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ds(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var r;return ds(this.gl)?this.gl.deleteVertexArray(e):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class li{constructor(e,r,o){this.func=e,this.mask=r,this.range=o}}li.ReadOnly=!1,li.ReadWrite=!0,li.disabled=new li(519,li.ReadOnly,[0,1]);const Sn=7680;class Oi{constructor(e,r,o,h,p,w){this.test=e,this.ref=r,this.mask=o,this.fail=h,this.depthFail=p,this.pass=w}}Oi.disabled=new Oi({func:519,mask:0},0,0,Sn,Sn,Sn);class Bi{constructor(e,r,o){this.enable=e,this.mode=r,this.frontFace=o}}let Cs;function Qs(c,e,r,o,h){const p=c.context,w=p.gl,S=c.useProgram("collisionBox"),P=[];let M=0,R=0;for(let oe=0;oe<o.length;oe++){const he=o[oe],le=e.getTile(he).getBucket(r);if(!le)continue;const _e=h?le.textCollisionBox:le.iconCollisionBox,Me=le.collisionCircleArray;if(Me.length>0){const Te=a.H();a.aQ(Te,le.placementInvProjMatrix,c.transform.glCoordMatrix),a.aQ(Te,Te,le.placementViewportMatrix),P.push({circleArray:Me,circleOffset:R,transform:he.posMatrix,invTransform:Te,coord:he}),M+=Me.length/4,R=M}_e&&S.draw(p,w.LINES,li.disabled,Oi.disabled,c.colorModeForRenderPass(),Bi.disabled,{u_matrix:he.posMatrix,u_pixel_extrude_scale:[1/(N=c.transform).width,1/N.height]},c.style.map.terrain&&c.style.map.terrain.getTerrainData(he),r.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,null,c.transform.zoom,null,null,_e.collisionVertexBuffer)}var N;if(!h||!P.length)return;const W=c.useProgram("collisionCircle"),H=new a.aR;H.resize(4*M),H._trim();let G=0;for(const oe of P)for(let he=0;he<oe.circleArray.length/4;he++){const le=4*he,_e=oe.circleArray[le+0],Me=oe.circleArray[le+1],Te=oe.circleArray[le+2],rt=oe.circleArray[le+3];H.emplace(G++,_e,Me,Te,rt,0),H.emplace(G++,_e,Me,Te,rt,1),H.emplace(G++,_e,Me,Te,rt,2),H.emplace(G++,_e,Me,Te,rt,3)}(!Cs||Cs.length<2*M)&&(Cs=function(oe){const he=2*oe,le=new a.aT;le.resize(he),le._trim();for(let _e=0;_e<he;_e++){const Me=6*_e;le.uint16[Me+0]=4*_e+0,le.uint16[Me+1]=4*_e+1,le.uint16[Me+2]=4*_e+2,le.uint16[Me+3]=4*_e+2,le.uint16[Me+4]=4*_e+3,le.uint16[Me+5]=4*_e+0}return le}(M));const K=p.createIndexBuffer(Cs,!0),se=p.createVertexBuffer(H,a.aS.members,!0);for(const oe of P){const he=Ar(oe.transform,oe.invTransform,c.transform);W.draw(p,w.TRIANGLES,li.disabled,Oi.disabled,c.colorModeForRenderPass(),Bi.disabled,he,c.style.map.terrain&&c.style.map.terrain.getTerrainData(oe.coord),r.id,se,K,a.a0.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,c.transform.zoom,null,null,null)}se.destroy(),K.destroy()}Bi.disabled=new Bi(!1,1029,2305),Bi.backCCW=new Bi(!0,1029,2305);const ea=a.an(new Float32Array(16));function Sa(c,e,r,o,h,p){const{horizontalAlign:w,verticalAlign:S}=a.au(c);return new a.P((-(w-.5)*e/h+o[0])*p,(-(S-.5)*r/h+o[1])*p)}function fs(c,e,r,o,h,p){const w=e.tileAnchorPoint.add(new a.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let S=o.mult(p);r||(S=S.rotate(-h));const P=w.add(S);return ee(P.x,P.y,e.labelPlaneMatrix,e.getElevation).point}if(r){const S=He(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(c),P=Math.atan(S.y/S.x)+(S.x<0?Math.PI:0);return c.add(o.rotate(P))}return c.add(o)}function Es(c,e,r,o,h,p,w,S,P,M,R,N,W,H){const G=c.text.placedSymbolArray,K=c.text.dynamicLayoutVertexArray,se=c.icon.dynamicLayoutVertexArray,oe={};K.clear();for(let he=0;he<G.length;he++){const le=G.get(he),_e=le.hidden||!le.crossTileID||c.allowVerticalPlacement&&!le.placedOrientation?null:o[le.crossTileID];if(_e){const Me=new a.P(le.anchorX,le.anchorY),Te={getElevation:H,width:h.width,height:h.height,labelPlaneMatrix:p,lineVertexArray:null,pitchWithMap:r,projection:R,projectionCache:null,tileAnchorPoint:Me,translation:N,unwrappedTileID:W},rt=r?ee(Me.x,Me.y,w,H):He(Me.x,Me.y,Te),mt=B(h.cameraToCenterDistance,rt.signedDistanceFromCamera);let vt=a.ai(c.textSizeData,P,le)*mt/a.ap;r&&(vt*=c.tilePixelRatio/S);const{width:St,height:wt,anchor:bt,textOffset:At,textBoxScale:Gt}=_e,Ct=Sa(bt,St,wt,At,Gt,vt),Et=R.getPitchedTextCorrection(h,Me.add(new a.P(N[0],N[1])),W),Jt=fs(rt.point,Te,e,Ct,h.angle,Et),fi=c.allowVerticalPlacement&&le.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let di=0;di<le.numGlyphs;di++)a.aj(K,Jt,fi);M&&le.associatedIconIndex>=0&&(oe[le.associatedIconIndex]={shiftedAnchor:Jt,angle:fi})}else Xt(le.numGlyphs,K)}if(M){se.clear();const he=c.icon.placedSymbolArray;for(let le=0;le<he.length;le++){const _e=he.get(le);if(_e.hidden)Xt(_e.numGlyphs,se);else{const Me=oe[le];if(Me)for(let Te=0;Te<_e.numGlyphs;Te++)a.aj(se,Me.shiftedAnchor,Me.angle);else Xt(_e.numGlyphs,se)}}c.icon.dynamicLayoutVertexBuffer.updateData(se)}c.text.dynamicLayoutVertexBuffer.updateData(K)}function Wr(c,e,r){return r.iconsInText&&e?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function Or(c,e,r,o,h,p,w,S,P,M,R,N){const W=c.context,H=W.gl,G=c.transform,K=$n(),se=S==="map",oe=P==="map",he=S!=="viewport"&&r.layout.get("symbol-placement")!=="point",le=se&&!oe&&!he,_e=!oe&&he,Me=!r.layout.get("symbol-sort-key").isConstant();let Te=!1;const rt=c.depthModeForSublayer(0,li.ReadOnly),mt=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),vt=[],St=K.getCircleRadiusCorrection(G);for(const wt of o){const bt=e.getTile(wt),At=bt.getBucket(r);if(!At)continue;const Gt=h?At.text:At.icon;if(!Gt||!Gt.segments.get().length||!Gt.hasVisibleVertices)continue;const Ct=Gt.programConfigurations.get(r.id),Et=h||At.sdfIcons,Jt=h?At.textSizeData:At.iconSizeData,fi=oe||G.pitch!==0,di=c.useProgram(Wr(Et,h,At),Ct),vi=a.ag(Jt,G.zoom),Ti=c.style.map.terrain&&c.style.map.terrain.getTerrainData(wt);let Gi,or,ji,br,Wi=[0,0],mr=null;if(h)or=bt.glyphAtlasTexture,ji=H.LINEAR,Gi=bt.glyphAtlasTexture.size,At.iconsInText&&(Wi=bt.imageAtlasTexture.size,mr=bt.imageAtlasTexture,br=fi||c.options.rotating||c.options.zooming||Jt.kind==="composite"||Jt.kind==="camera"?H.LINEAR:H.NEAREST);else{const Ri=r.layout.get("icon-size").constantOr(0)!==1||At.iconsNeedLinear;or=bt.imageAtlasTexture,ji=Et||c.options.rotating||c.options.zooming||Ri||fi?H.LINEAR:H.NEAREST,Gi=bt.imageAtlasTexture.size}const Tr=yi(bt,1,c.transform.zoom),_n=_e?wt.posMatrix:ea,Bn=Ve(_n,oe,se,c.transform,Tr),lr=lt(_n,oe,se,c.transform,Tr),Ma=lt(wt.posMatrix,oe,se,c.transform,Tr),jn=K.translatePosition(c.transform,bt,p,w),Sl=mt&&At.hasTextData(),Vo=r.layout.get("icon-text-fit")!=="none"&&Sl&&At.hasIconData();if(he){const Ri=c.style.map.terrain?(za,sa)=>c.style.map.terrain.getElevation(wt,za,sa):null,js=r.layout.get("text-rotation-alignment")==="map";Y(At,wt.posMatrix,c,h,Bn,Ma,oe,M,js,K,wt.toUnwrapped(),G.width,G.height,jn,Ri)}const ln=wt.posMatrix,vn=h&&mt||Vo,Ur=he||vn?ea:Bn,cn=lr,Pr=Et&&r.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Kr;Kr=Et?At.iconsInText?Ls(Jt.kind,vi,le,oe,he,vn,c,ln,Ur,cn,jn,Gi,Wi,St):us(Jt.kind,vi,le,oe,he,vn,c,ln,Ur,cn,jn,h,Gi,!0,St):wo(Jt.kind,vi,le,oe,he,vn,c,ln,Ur,cn,jn,h,Gi,St);const hn={program:di,buffers:Gt,uniformValues:Kr,atlasTexture:or,atlasTextureIcon:mr,atlasInterpolation:ji,atlasInterpolationIcon:br,isSDF:Et,hasHalo:Pr};if(Me&&At.canOverlap){Te=!0;const Ri=Gt.segments.get();for(const js of Ri)vt.push({segments:new a.a0([js]),sortKey:js.sortKey,state:hn,terrainData:Ti})}else vt.push({segments:Gt.segments,sortKey:0,state:hn,terrainData:Ti})}Te&&vt.sort((wt,bt)=>wt.sortKey-bt.sortKey);for(const wt of vt){const bt=wt.state;if(W.activeTexture.set(H.TEXTURE0),bt.atlasTexture.bind(bt.atlasInterpolation,H.CLAMP_TO_EDGE),bt.atlasTextureIcon&&(W.activeTexture.set(H.TEXTURE1),bt.atlasTextureIcon&&bt.atlasTextureIcon.bind(bt.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),bt.isSDF){const At=bt.uniformValues;bt.hasHalo&&(At.u_is_halo=1,Aa(bt.buffers,wt.segments,r,c,bt.program,rt,R,N,At,wt.terrainData)),At.u_is_halo=0}Aa(bt.buffers,wt.segments,r,c,bt.program,rt,R,N,bt.uniformValues,wt.terrainData)}}function Aa(c,e,r,o,h,p,w,S,P,M){const R=o.context;h.draw(R,R.gl.TRIANGLES,p,w,S,Bi.disabled,P,M,r.id,c.layoutVertexBuffer,c.indexBuffer,e,r.paint,o.transform.zoom,c.programConfigurations.get(r.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function Ia(c,e,r,o){const h=c.context,p=h.gl,w=Oi.disabled,S=new Ei([p.ONE,p.ONE],a.aM.transparent,[!0,!0,!0,!0]),P=e.getBucket(r);if(!P)return;const M=o.key;let R=r.heatmapFbos.get(M);R||(R=ta(h,e.tileSize,e.tileSize),r.heatmapFbos.set(M,R)),h.bindFramebuffer.set(R.framebuffer),h.viewport.set([0,0,e.tileSize,e.tileSize]),h.clear({color:a.aM.transparent});const N=P.programConfigurations.get(r.id),W=c.useProgram("heatmap",N),H=c.style.map.terrain.getTerrainData(o);W.draw(h,p.TRIANGLES,li.disabled,w,S,Bi.disabled,oi(o.posMatrix,e,c.transform.zoom,r.paint.get("heatmap-intensity")),H,r.id,P.layoutVertexBuffer,P.indexBuffer,P.segments,r.paint,c.transform.zoom,N)}function Wn(c,e,r){const o=c.context,h=o.gl;o.setColorMode(c.colorModeForRenderPass());const p=jr(o,e),w=r.key,S=e.heatmapFbos.get(w);S&&(o.activeTexture.set(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,S.colorAttachment.get()),o.activeTexture.set(h.TEXTURE1),p.bind(h.LINEAR,h.CLAMP_TO_EDGE),c.useProgram("heatmapTexture").draw(o,h.TRIANGLES,li.disabled,Oi.disabled,c.colorModeForRenderPass(),Bi.disabled,_o(c,e,0,1),null,e.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments,e.paint,c.transform.zoom),S.destroy(),e.heatmapFbos.delete(w))}function ta(c,e,r){var o,h;const p=c.gl,w=p.createTexture();p.bindTexture(p.TEXTURE_2D,w),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);const S=(o=c.HALF_FLOAT)!==null&&o!==void 0?o:p.UNSIGNED_BYTE,P=(h=c.RGBA16F)!==null&&h!==void 0?h:p.RGBA;p.texImage2D(p.TEXTURE_2D,0,P,e,r,0,p.RGBA,S,null);const M=c.createFramebuffer(e,r,!1,!1);return M.colorAttachment.set(w),M}function jr(c,e){return e.colorRampTexture||(e.colorRampTexture=new pe(c,e.colorRamp,c.gl.RGBA)),e.colorRampTexture}function Pa(c,e,r,o,h){if(!r||!o||!o.imageAtlas)return;const p=o.imageAtlas.patternPositions;let w=p[r.to.toString()],S=p[r.from.toString()];if(!w&&S&&(w=S),!S&&w&&(S=w),!w||!S){const P=h.getPaintProperty(e);w=p[P],S=p[P]}w&&S&&c.setConstantPatternPositions(w,S)}function ia(c,e,r,o,h,p,w){const S=c.context.gl,P="fill-pattern",M=r.paint.get(P),R=M&&M.constantOr(1),N=r.getCrossfadeParameters();let W,H,G,K,se;w?(H=R&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",W=S.LINES):(H=R?"fillPattern":"fill",W=S.TRIANGLES);const oe=M.constantOr(null);for(const he of o){const le=e.getTile(he);if(R&&!le.patternsLoaded())continue;const _e=le.getBucket(r);if(!_e)continue;const Me=_e.programConfigurations.get(r.id),Te=c.useProgram(H,Me),rt=c.style.map.terrain&&c.style.map.terrain.getTerrainData(he);R&&(c.context.activeTexture.set(S.TEXTURE0),le.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Me.updatePaintBuffers(N)),Pa(Me,P,oe,le,r);const mt=rt?he:null,vt=c.translatePosMatrix(mt?mt.posMatrix:he.posMatrix,le,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(w){K=_e.indexBuffer2,se=_e.segments2;const St=[S.drawingBufferWidth,S.drawingBufferHeight];G=H==="fillOutlinePattern"&&R?Va(vt,c,N,le,St):yo(vt,St)}else K=_e.indexBuffer,se=_e.segments,G=R?Ps(vt,c,N,le):ba(vt);Te.draw(c.context,W,h,c.stencilModeForClipping(he),p,Bi.disabled,G,rt,r.id,_e.layoutVertexBuffer,K,se,r.paint,c.transform.zoom,Me)}}function Wa(c,e,r,o,h,p,w){const S=c.context,P=S.gl,M="fill-extrusion-pattern",R=r.paint.get(M),N=R.constantOr(1),W=r.getCrossfadeParameters(),H=r.paint.get("fill-extrusion-opacity"),G=R.constantOr(null);for(const K of o){const se=e.getTile(K),oe=se.getBucket(r);if(!oe)continue;const he=c.style.map.terrain&&c.style.map.terrain.getTerrainData(K),le=oe.programConfigurations.get(r.id),_e=c.useProgram(N?"fillExtrusionPattern":"fillExtrusion",le);N&&(c.context.activeTexture.set(P.TEXTURE0),se.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),le.updatePaintBuffers(W)),Pa(le,M,G,se,r);const Me=c.translatePosMatrix(K.posMatrix,se,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Te=r.paint.get("fill-extrusion-vertical-gradient"),rt=N?go(Me,c,Te,H,K,W,se):qa(Me,c,Te,H);_e.draw(S,S.gl.TRIANGLES,h,p,w,Bi.backCCW,rt,he,r.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,r.paint,c.transform.zoom,le,c.style.map.terrain&&oe.centroidVertexBuffer)}}function Hr(c,e,r,o,h,p,w){const S=c.context,P=S.gl,M=r.fbo;if(!M)return;const R=c.useProgram("hillshade"),N=c.style.map.terrain&&c.style.map.terrain.getTerrainData(e);S.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,M.colorAttachment.get()),R.draw(S,P.TRIANGLES,h,p,w,Bi.disabled,((W,H,G,K)=>{const se=G.paint.get("hillshade-shadow-color"),oe=G.paint.get("hillshade-highlight-color"),he=G.paint.get("hillshade-accent-color");let le=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);G.paint.get("hillshade-illumination-anchor")==="viewport"&&(le-=W.transform.angle);const _e=!W.options.moving;return{u_matrix:K?K.posMatrix:W.transform.calculatePosMatrix(H.tileID.toUnwrapped(),_e),u_image:0,u_latrange:vo(0,H.tileID),u_light:[G.paint.get("hillshade-exaggeration"),le],u_shadow:se,u_highlight:oe,u_accent:he}})(c,r,o,N?e:null),N,o.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}function ms(c,e,r,o,h,p){const w=c.context,S=w.gl,P=e.dem;if(P&&P.data){const M=P.dim,R=P.stride,N=P.getPixels();if(w.activeTexture.set(S.TEXTURE1),w.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||c.getTileTexture(R),e.demTexture){const H=e.demTexture;H.update(N,{premultiply:!1}),H.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else e.demTexture=new pe(w,N,S.RGBA,{premultiply:!1}),e.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);w.activeTexture.set(S.TEXTURE0);let W=e.fbo;if(!W){const H=new pe(w,{width:M,height:M,data:null},S.RGBA);H.bind(S.LINEAR,S.CLAMP_TO_EDGE),W=e.fbo=w.createFramebuffer(M,M,!0,!1),W.colorAttachment.set(H.texture)}w.bindFramebuffer.set(W.framebuffer),w.viewport.set([0,0,M,M]),c.useProgram("hillshadePrepare").draw(w,S.TRIANGLES,o,h,p,Bi.disabled,((H,G)=>{const K=G.stride,se=a.H();return a.aP(se,0,a.X,-a.X,0,0,1),a.J(se,se,[0,-a.X,0]),{u_matrix:se,u_image:1,u_dimension:[K,K],u_zoom:H.overscaledZ,u_unpack:G.getUnpackVector()}})(e.tileID,P),null,r.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function pl(c,e,r,o,h,p){const w=o.paint.get("raster-fade-duration");if(!p&&w>0){const S=O.now(),P=(S-c.timeAdded)/w,M=e?(S-e.timeAdded)/w:-1,R=r.getSource(),N=h.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),W=!e||Math.abs(e.tileID.overscaledZ-N)>Math.abs(c.tileID.overscaledZ-N),H=W&&c.refreshedUponExpiration?1:a.ac(W?P:1-M,0,1);return c.refreshedUponExpiration&&P>=1&&(c.refreshedUponExpiration=!1),e?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}const Eo=new a.aM(1,0,0,1),Mi=new a.aM(0,1,0,1),Ms=new a.aM(0,0,1,1),An=new a.aM(1,0,1,1),sn=new a.aM(0,1,1,1);function Dn(c,e,r,o){Hn(c,0,e+r/2,c.transform.width,r,o)}function zs(c,e,r,o){Hn(c,e-r/2,0,r,c.transform.height,o)}function Hn(c,e,r,o,h,p){const w=c.context,S=w.gl;S.enable(S.SCISSOR_TEST),S.scissor(e*c.pixelRatio,r*c.pixelRatio,o*c.pixelRatio,h*c.pixelRatio),w.clear({color:p}),S.disable(S.SCISSOR_TEST)}function Ha(c,e,r){const o=c.context,h=o.gl,p=r.posMatrix,w=c.useProgram("debug"),S=li.disabled,P=Oi.disabled,M=c.colorModeForRenderPass(),R="$debug",N=c.style.map.terrain&&c.style.map.terrain.getTerrainData(r);o.activeTexture.set(h.TEXTURE0);const W=e.getTileByID(r.key).latestRawTileData,H=Math.floor((W&&W.byteLength||0)/1024),G=e.getTile(r).tileSize,K=512/Math.min(G,512)*(r.overscaledZ/c.transform.zoom)*.5;let se=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(se+=` => ${r.overscaledZ}`),function(oe,he){oe.initDebugOverlayCanvas();const le=oe.debugOverlayCanvas,_e=oe.context.gl,Me=oe.debugOverlayCanvas.getContext("2d");Me.clearRect(0,0,le.width,le.height),Me.shadowColor="white",Me.shadowBlur=2,Me.lineWidth=1.5,Me.strokeStyle="white",Me.textBaseline="top",Me.font="bold 36px Open Sans, sans-serif",Me.fillText(he,5,5),Me.strokeText(he,5,5),oe.debugOverlayTexture.update(le),oe.debugOverlayTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}(c,`${se} ${H}kB`),w.draw(o,h.TRIANGLES,S,P,Ei.alphaBlended,Bi.disabled,Ua(p,a.aM.transparent,K),null,R,c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments),w.draw(o,h.LINE_STRIP,S,P,M,Bi.disabled,Ua(p,a.aM.red),N,R,c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments)}function Ns(c,e,r){const o=c.context,h=o.gl,p=c.colorModeForRenderPass(),w=new li(h.LEQUAL,li.ReadWrite,c.depthRangeFor3D),S=c.useProgram("terrain"),P=e.getTerrainMesh();o.bindFramebuffer.set(null),o.viewport.set([0,0,c.width,c.height]);for(const M of r){const R=c.renderToTexture.getTexture(M),N=e.getTerrainData(M.tileID);o.activeTexture.set(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,R.texture);const W=c.transform.calculatePosMatrix(M.tileID.toUnwrapped()),H=e.getMeshFrameDelta(c.transform.zoom),G=c.transform.calculateFogMatrix(M.tileID.toUnwrapped()),K=al(W,H,G,c.style.sky,c.transform.pitch);S.draw(o,h.TRIANGLES,w,Oi.disabled,p,Bi.backCCW,K,N,"terrain",P.vertexBuffer,P.indexBuffer,P.segments)}}class fr{constructor(e,r,o){this.vertexBuffer=e,this.indexBuffer=r,this.segments=o}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class La{constructor(e,r){this.context=new nn(e),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=fe.maxUnderzooming+fe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new sl}resize(e,r,o){if(this.width=Math.floor(e*o),this.height=Math.floor(r*o),this.pixelRatio=o,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const e=this.context,r=new a.aX;r.emplaceBack(0,0),r.emplaceBack(a.X,0),r.emplaceBack(0,a.X),r.emplaceBack(a.X,a.X),this.tileExtentBuffer=e.createVertexBuffer(r,cs.members),this.tileExtentSegments=a.a0.simpleSegment(0,0,4,2);const o=new a.aX;o.emplaceBack(0,0),o.emplaceBack(a.X,0),o.emplaceBack(0,a.X),o.emplaceBack(a.X,a.X),this.debugBuffer=e.createVertexBuffer(o,cs.members),this.debugSegments=a.a0.simpleSegment(0,0,4,5);const h=new a.$;h.emplaceBack(0,0,0,0),h.emplaceBack(a.X,0,a.X,0),h.emplaceBack(0,a.X,0,a.X),h.emplaceBack(a.X,a.X,a.X,a.X),this.rasterBoundsBuffer=e.createVertexBuffer(h,Dt.members),this.rasterBoundsSegments=a.a0.simpleSegment(0,0,4,2);const p=new a.aX;p.emplaceBack(0,0),p.emplaceBack(1,0),p.emplaceBack(0,1),p.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(p,cs.members),this.viewportSegments=a.a0.simpleSegment(0,0,4,2);const w=new a.aZ;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(w);const S=new a.aY;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(S);const P=this.context.gl;this.stencilClearMode=new Oi({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO)}clearStencil(){const e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const o=a.H();a.aP(o,0,this.width,this.height,0,0,1),a.K(o,o,[r.drawingBufferWidth,r.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,r.TRIANGLES,li.disabled,this.stencilClearMode,Ei.disabled,Bi.disabled,Gr(o),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,r){if(this.currentStencilSource===e.source||!e.isTileClipped()||!r||!r.length)return;this.currentStencilSource=e.source;const o=this.context,h=o.gl;this.nextStencilID+r.length>256&&this.clearStencil(),o.setColorMode(Ei.disabled),o.setDepthMode(li.disabled);const p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of r){const S=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,P=this.style.map.terrain&&this.style.map.terrain.getTerrainData(w);p.draw(o,h.TRIANGLES,li.disabled,new Oi({func:h.ALWAYS,mask:0},S,255,h.KEEP,h.KEEP,h.REPLACE),Ei.disabled,Bi.disabled,Gr(w.posMatrix),P,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,r=this.context.gl;return new Oi({func:r.NOTEQUAL,mask:255},e,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(e){const r=this.context.gl;return new Oi({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(e){const r=this.context.gl,o=e.sort((w,S)=>S.overscaledZ-w.overscaledZ),h=o[o.length-1].overscaledZ,p=o[0].overscaledZ-h+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const w={};for(let S=0;S<p;S++)w[S+h]=new Oi({func:r.GEQUAL,mask:255},S+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=p,[w,o]}return[{[h]:Oi.disabled},o]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Ei([e.CONSTANT_COLOR,e.ONE],new a.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ei.unblended:Ei.alphaBlended}depthModeForSublayer(e,r,o){if(!this.opaquePassEnabledForLayer())return li.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new li(o||this.context.gl.LEQUAL,r,[h,h])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,r){this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(O.now()),this.imageManager.beginFrame();const o=this.style._order,h=this.style.sourceCaches,p={},w={},S={};for(const P in h){const M=h[P];M.used&&M.prepare(this.context),p[P]=M.getVisibleCoordinates(),w[P]=p[P].slice().reverse(),S[P]=M.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<o.length;P++)if(this.style._layers[o[P]].is3D()){this.opaquePassCutoff=P;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const P of o){const M=this.style._layers[P];if(!M.hasOffscreenPass()||M.isHidden(this.transform.zoom))continue;const R=w[M.source];(M.type==="custom"||R.length)&&this.renderLayer(this,h[M.source],M,R)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?a.aM.black:a.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(P,M){const R=P.context,N=R.gl,W=((oe,he,le)=>({u_sky_color:oe.properties.get("sky-color"),u_horizon_color:oe.properties.get("horizon-color"),u_horizon:(he.height/2+he.getHorizon())*le,u_sky_horizon_blend:oe.properties.get("sky-horizon-blend")*he.height/2*le}))(M,P.style.map.transform,P.pixelRatio),H=new li(N.LEQUAL,li.ReadWrite,[0,1]),G=Oi.disabled,K=P.colorModeForRenderPass(),se=P.useProgram("sky");if(!M.mesh){const oe=new a.aX;oe.emplaceBack(-1,-1),oe.emplaceBack(1,-1),oe.emplaceBack(1,1),oe.emplaceBack(-1,1);const he=new a.aY;he.emplaceBack(0,1,2),he.emplaceBack(0,2,3),M.mesh=new fr(R.createVertexBuffer(oe,cs.members),R.createIndexBuffer(he),a.a0.simpleSegment(0,0,oe.length,he.length))}se.draw(R,N.TRIANGLES,H,G,K,Bi.disabled,W,void 0,"sky",M.mesh.vertexBuffer,M.mesh.indexBuffer,M.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[o[this.currentLayer]],M=h[P.source],R=p[P.source];this._renderTileClippingMasks(P,R),this.renderLayer(this,M,P,R)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){const P=this.style._layers[o[this.currentLayer]],M=h[P.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(P))continue;const R=(P.type==="symbol"?S:w)[P.source];this._renderTileClippingMasks(P,p[P.source]),this.renderLayer(this,M,P,R)}if(this.options.showTileBoundaries){const P=function(M,R){let N=null;const W=Object.values(M._layers).flatMap(se=>se.source&&!se.isHidden(R)?[M.sourceCaches[se.source]]:[]),H=W.filter(se=>se.getSource().type==="vector"),G=W.filter(se=>se.getSource().type!=="vector"),K=se=>{(!N||N.getSource().maxzoom<se.getSource().maxzoom)&&(N=se)};return H.forEach(se=>K(se)),N||G.forEach(se=>K(se)),N}(this.style,this.transform.zoom);P&&function(M,R,N){for(let W=0;W<N.length;W++)Ha(M,R,N[W])}(this,P,P.getVisibleCoordinates())}this.options.showPadding&&function(P){const M=P.transform.padding;Dn(P,P.transform.height-(M.top||0),3,Eo),Dn(P,M.bottom||0,3,Mi),zs(P,M.left||0,3,Ms),zs(P,P.transform.width-(M.right||0),3,An);const R=P.transform.centerPoint;(function(N,W,H,G){Hn(N,W-1,H-10,2,20,G),Hn(N,W-10,H-1,20,2,G)})(P,R.x,P.transform.height-R.y,sn)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const r=this.terrainFacilitator.matrix,o=this.transform.modelViewProjectionMatrix;let h=this.terrainFacilitator.dirty;h||(h=e?!a.a_(r,o):!a.a$(r,o)),h||(h=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),h&&(a.b0(r,o),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(p,w){const S=p.context,P=S.gl,M=Ei.unblended,R=new li(P.LEQUAL,li.ReadWrite,[0,1]),N=w.getTerrainMesh(),W=w.sourceCache.getRenderableTiles(),H=p.useProgram("terrainDepth");S.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),S.clear({color:a.aM.transparent,depth:1});for(const G of W){const K=w.getTerrainData(G.tileID),se={u_matrix:p.transform.calculatePosMatrix(G.tileID.toUnwrapped()),u_ele_delta:w.getMeshFrameDelta(p.transform.zoom)};H.draw(S,P.TRIANGLES,R,Oi.disabled,M,Bi.backCCW,se,K,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain),function(p,w){const S=p.context,P=S.gl,M=Ei.unblended,R=new li(P.LEQUAL,li.ReadWrite,[0,1]),N=w.getTerrainMesh(),W=w.getCoordsTexture(),H=w.sourceCache.getRenderableTiles(),G=p.useProgram("terrainCoords");S.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),S.clear({color:a.aM.transparent,depth:1}),w.coordsIndex=[];for(const K of H){const se=w.getTerrainData(K.tileID);S.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,W.texture);const oe={u_matrix:p.transform.calculatePosMatrix(K.tileID.toUnwrapped()),u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(p.transform.zoom)};G.draw(S,P.TRIANGLES,R,Oi.disabled,M,Bi.backCCW,oe,se,"terrain",N.vertexBuffer,N.indexBuffer,N.segments),w.coordsIndex.push(K.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain))}renderLayer(e,r,o,h){if(!o.isHidden(this.transform.zoom)&&(o.type==="background"||o.type==="custom"||(h||[]).length))switch(this.id=o.id,o.type){case"symbol":(function(p,w,S,P,M){if(p.renderPass!=="translucent")return;const R=Oi.disabled,N=p.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(W,H,G,K,se,oe,he,le,_e){const Me=H.transform,Te=$n(),rt=se==="map",mt=oe==="map";for(const vt of W){const St=K.getTile(vt),wt=St.getBucket(G);if(!wt||!wt.text||!wt.text.segments.get().length)continue;const bt=a.ag(wt.textSizeData,Me.zoom),At=yi(St,1,H.transform.zoom),Gt=Ve(vt.posMatrix,mt,rt,H.transform,At),Ct=G.layout.get("icon-text-fit")!=="none"&&wt.hasIconData();if(bt){const Et=Math.pow(2,Me.zoom-St.tileID.overscaledZ),Jt=H.style.map.terrain?(di,vi)=>H.style.map.terrain.getElevation(vt,di,vi):null,fi=Te.translatePosition(Me,St,he,le);Es(wt,rt,mt,_e,Me,Gt,vt.posMatrix,Et,bt,Ct,Te,fi,vt.toUnwrapped(),Jt)}}}(P,p,S,w,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),M),S.paint.get("icon-opacity").constantOr(1)!==0&&Or(p,w,S,P,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),R,N),S.paint.get("text-opacity").constantOr(1)!==0&&Or(p,w,S,P,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),R,N),w.map.showCollisionBoxes&&(Qs(p,w,S,P,!0),Qs(p,w,S,P,!1))})(e,r,o,h,this.style.placement.variableOffsets);break;case"circle":(function(p,w,S,P){if(p.renderPass!=="translucent")return;const M=S.paint.get("circle-opacity"),R=S.paint.get("circle-stroke-width"),N=S.paint.get("circle-stroke-opacity"),W=!S.layout.get("circle-sort-key").isConstant();if(M.constantOr(1)===0&&(R.constantOr(1)===0||N.constantOr(1)===0))return;const H=p.context,G=H.gl,K=p.depthModeForSublayer(0,li.ReadOnly),se=Oi.disabled,oe=p.colorModeForRenderPass(),he=[];for(let le=0;le<P.length;le++){const _e=P[le],Me=w.getTile(_e),Te=Me.getBucket(S);if(!Te)continue;const rt=Te.programConfigurations.get(S.id),mt=p.useProgram("circle",rt),vt=Te.layoutVertexBuffer,St=Te.indexBuffer,wt=p.style.map.terrain&&p.style.map.terrain.getTerrainData(_e),bt={programConfiguration:rt,program:mt,layoutVertexBuffer:vt,indexBuffer:St,uniformValues:Dl(p,_e,Me,S),terrainData:wt};if(W){const At=Te.segments.get();for(const Gt of At)he.push({segments:new a.a0([Gt]),sortKey:Gt.sortKey,state:bt})}else he.push({segments:Te.segments,sortKey:0,state:bt})}W&&he.sort((le,_e)=>le.sortKey-_e.sortKey);for(const le of he){const{programConfiguration:_e,program:Me,layoutVertexBuffer:Te,indexBuffer:rt,uniformValues:mt,terrainData:vt}=le.state;Me.draw(H,G.TRIANGLES,K,se,oe,Bi.disabled,mt,vt,S.id,Te,rt,le.segments,S.paint,p.transform.zoom,_e)}})(e,r,o,h);break;case"heatmap":(function(p,w,S,P){if(S.paint.get("heatmap-opacity")===0)return;const M=p.context;if(p.style.map.terrain){for(const R of P){const N=w.getTile(R);w.hasRenderableParent(R)||(p.renderPass==="offscreen"?Ia(p,N,S,R):p.renderPass==="translucent"&&Wn(p,S,R))}M.viewport.set([0,0,p.width,p.height])}else p.renderPass==="offscreen"?function(R,N,W,H){const G=R.context,K=G.gl,se=Oi.disabled,oe=new Ei([K.ONE,K.ONE],a.aM.transparent,[!0,!0,!0,!0]);(function(he,le,_e){const Me=he.gl;he.activeTexture.set(Me.TEXTURE1),he.viewport.set([0,0,le.width/4,le.height/4]);let Te=_e.heatmapFbos.get(a.aU);Te?(Me.bindTexture(Me.TEXTURE_2D,Te.colorAttachment.get()),he.bindFramebuffer.set(Te.framebuffer)):(Te=ta(he,le.width/4,le.height/4),_e.heatmapFbos.set(a.aU,Te))})(G,R,W),G.clear({color:a.aM.transparent});for(let he=0;he<H.length;he++){const le=H[he];if(N.hasRenderableParent(le))continue;const _e=N.getTile(le),Me=_e.getBucket(W);if(!Me)continue;const Te=Me.programConfigurations.get(W.id),rt=R.useProgram("heatmap",Te),{zoom:mt}=R.transform;rt.draw(G,K.TRIANGLES,li.disabled,se,oe,Bi.disabled,oi(le.posMatrix,_e,mt,W.paint.get("heatmap-intensity")),null,W.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,W.paint,R.transform.zoom,Te)}G.viewport.set([0,0,R.width,R.height])}(p,w,S,P):p.renderPass==="translucent"&&function(R,N){const W=R.context,H=W.gl;W.setColorMode(R.colorModeForRenderPass());const G=N.heatmapFbos.get(a.aU);G&&(W.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,G.colorAttachment.get()),W.activeTexture.set(H.TEXTURE1),jr(W,N).bind(H.LINEAR,H.CLAMP_TO_EDGE),R.useProgram("heatmapTexture").draw(W,H.TRIANGLES,li.disabled,Oi.disabled,R.colorModeForRenderPass(),Bi.disabled,_o(R,N,0,1),null,N.id,R.viewportBuffer,R.quadTriangleIndexBuffer,R.viewportSegments,N.paint,R.transform.zoom))}(p,S)})(e,r,o,h);break;case"line":(function(p,w,S,P){if(p.renderPass!=="translucent")return;const M=S.paint.get("line-opacity"),R=S.paint.get("line-width");if(M.constantOr(1)===0||R.constantOr(1)===0)return;const N=p.depthModeForSublayer(0,li.ReadOnly),W=p.colorModeForRenderPass(),H=S.paint.get("line-dasharray"),G=S.paint.get("line-pattern"),K=G.constantOr(1),se=S.paint.get("line-gradient"),oe=S.getCrossfadeParameters(),he=K?"linePattern":H?"lineSDF":se?"lineGradient":"line",le=p.context,_e=le.gl;let Me=!0;for(const Te of P){const rt=w.getTile(Te);if(K&&!rt.patternsLoaded())continue;const mt=rt.getBucket(S);if(!mt)continue;const vt=mt.programConfigurations.get(S.id),St=p.context.program.get(),wt=p.useProgram(he,vt),bt=Me||wt.program!==St,At=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Te),Gt=G.constantOr(null);if(Gt&&rt.imageAtlas){const Jt=rt.imageAtlas,fi=Jt.patternPositions[Gt.to.toString()],di=Jt.patternPositions[Gt.from.toString()];fi&&di&&vt.setConstantPatternPositions(fi,di)}const Ct=At?Te:null,Et=K?Ys(p,rt,S,oe,Ct):H?bo(p,rt,S,H,oe,Ct):se?ll(p,rt,S,mt.lineClipsArray.length,Ct):zn(p,rt,S,Ct);if(K)le.activeTexture.set(_e.TEXTURE0),rt.imageAtlasTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),vt.updatePaintBuffers(oe);else if(H&&(bt||p.lineAtlas.dirty))le.activeTexture.set(_e.TEXTURE0),p.lineAtlas.bind(le);else if(se){const Jt=mt.gradients[S.id];let fi=Jt.texture;if(S.gradientVersion!==Jt.version){let di=256;if(S.stepInterpolant){const vi=w.getSource().maxzoom,Ti=Te.canonical.z===vi?Math.ceil(1<<p.transform.maxZoom-Te.canonical.z):1;di=a.ac(a.aV(mt.maxLineLength/a.X*1024*Ti),256,le.maxTextureSize)}Jt.gradient=a.aW({expression:S.gradientExpression(),evaluationKey:"lineProgress",resolution:di,image:Jt.gradient||void 0,clips:mt.lineClipsArray}),Jt.texture?Jt.texture.update(Jt.gradient):Jt.texture=new pe(le,Jt.gradient,_e.RGBA),Jt.version=S.gradientVersion,fi=Jt.texture}le.activeTexture.set(_e.TEXTURE0),fi.bind(S.stepInterpolant?_e.NEAREST:_e.LINEAR,_e.CLAMP_TO_EDGE)}wt.draw(le,_e.TRIANGLES,N,p.stencilModeForClipping(Te),W,Bi.disabled,Et,At,S.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,S.paint,p.transform.zoom,vt,mt.layoutVertexBuffer2),Me=!1}})(e,r,o,h);break;case"fill":(function(p,w,S,P){const M=S.paint.get("fill-color"),R=S.paint.get("fill-opacity");if(R.constantOr(1)===0)return;const N=p.colorModeForRenderPass(),W=S.paint.get("fill-pattern"),H=p.opaquePassEnabledForLayer()&&!W.constantOr(1)&&M.constantOr(a.aM.transparent).a===1&&R.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===H){const G=p.depthModeForSublayer(1,p.renderPass==="opaque"?li.ReadWrite:li.ReadOnly);ia(p,w,S,P,G,N,!1)}if(p.renderPass==="translucent"&&S.paint.get("fill-antialias")){const G=p.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,li.ReadOnly);ia(p,w,S,P,G,N,!0)}})(e,r,o,h);break;case"fill-extrusion":(function(p,w,S,P){const M=S.paint.get("fill-extrusion-opacity");if(M!==0&&p.renderPass==="translucent"){const R=new li(p.context.gl.LEQUAL,li.ReadWrite,p.depthRangeFor3D);if(M!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))Wa(p,w,S,P,R,Oi.disabled,Ei.disabled),Wa(p,w,S,P,R,p.stencilModeFor3D(),p.colorModeForRenderPass());else{const N=p.colorModeForRenderPass();Wa(p,w,S,P,R,Oi.disabled,N)}}})(e,r,o,h);break;case"hillshade":(function(p,w,S,P){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const M=p.context,R=p.depthModeForSublayer(0,li.ReadOnly),N=p.colorModeForRenderPass(),[W,H]=p.renderPass==="translucent"?p.stencilConfigForOverlap(P):[{},P];for(const G of H){const K=w.getTile(G);K.needsHillshadePrepare!==void 0&&K.needsHillshadePrepare&&p.renderPass==="offscreen"?ms(p,K,S,R,Oi.disabled,N):p.renderPass==="translucent"&&Hr(p,G,K,S,R,W[G.overscaledZ],N)}M.viewport.set([0,0,p.width,p.height])})(e,r,o,h);break;case"raster":(function(p,w,S,P){if(p.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!P.length)return;const M=p.context,R=M.gl,N=w.getSource(),W=p.useProgram("raster"),H=p.colorModeForRenderPass(),[G,K]=N instanceof Yt?[{},P]:p.stencilConfigForOverlap(P),se=K[K.length-1].overscaledZ,oe=!p.options.moving;for(const he of K){const le=p.depthModeForSublayer(he.overscaledZ-se,S.paint.get("raster-opacity")===1?li.ReadWrite:li.ReadOnly,R.LESS),_e=w.getTile(he);_e.registerFadeDuration(S.paint.get("raster-fade-duration"));const Me=w.findLoadedParent(he,0),Te=w.findLoadedSibling(he),rt=pl(_e,Me||Te||null,w,S,p.transform,p.style.map.terrain);let mt,vt;const St=S.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;M.activeTexture.set(R.TEXTURE0),_e.texture.bind(St,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),M.activeTexture.set(R.TEXTURE1),Me?(Me.texture.bind(St,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),mt=Math.pow(2,Me.tileID.overscaledZ-_e.tileID.overscaledZ),vt=[_e.tileID.canonical.x*mt%1,_e.tileID.canonical.y*mt%1]):_e.texture.bind(St,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),_e.texture.useMipmap&&M.extTextureFilterAnisotropic&&p.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);const wt=p.style.map.terrain&&p.style.map.terrain.getTerrainData(he),bt=wt?he:null,At=bt?bt.posMatrix:p.transform.calculatePosMatrix(he.toUnwrapped(),oe),Gt=oc(At,vt||[0,0],mt||1,rt,S);N instanceof Yt?W.draw(M,R.TRIANGLES,le,Oi.disabled,H,Bi.disabled,Gt,wt,S.id,N.boundsBuffer,p.quadTriangleIndexBuffer,N.boundsSegments):W.draw(M,R.TRIANGLES,le,G[he.overscaledZ],H,Bi.disabled,Gt,wt,S.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}})(e,r,o,h);break;case"background":(function(p,w,S,P){const M=S.paint.get("background-color"),R=S.paint.get("background-opacity");if(R===0)return;const N=p.context,W=N.gl,H=p.transform,G=H.tileSize,K=S.paint.get("background-pattern");if(p.isPatternMissing(K))return;const se=!K&&M.a===1&&R===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==se)return;const oe=Oi.disabled,he=p.depthModeForSublayer(0,se==="opaque"?li.ReadWrite:li.ReadOnly),le=p.colorModeForRenderPass(),_e=p.useProgram(K?"backgroundPattern":"background"),Me=P||H.coveringTiles({tileSize:G,terrain:p.style.map.terrain});K&&(N.activeTexture.set(W.TEXTURE0),p.imageManager.bind(p.context));const Te=S.getCrossfadeParameters();for(const rt of Me){const mt=P?rt.posMatrix:p.transform.calculatePosMatrix(rt.toUnwrapped()),vt=K?Js(mt,R,p,K,{tileID:rt,tileSize:G},Te):So(mt,R,M),St=p.style.map.terrain&&p.style.map.terrain.getTerrainData(rt);_e.draw(N,W.TRIANGLES,he,oe,le,Bi.disabled,vt,St,S.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}})(e,0,o,h);break;case"custom":(function(p,w,S){const P=p.context,M=S.implementation;if(p.renderPass==="offscreen"){const R=M.prerender;R&&(p.setCustomLayerDefaults(),P.setColorMode(p.colorModeForRenderPass()),R.call(M,P.gl,p.transform.customLayerMatrix()),P.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),P.setColorMode(p.colorModeForRenderPass()),P.setStencilMode(Oi.disabled);const R=M.renderingMode==="3d"?new li(p.context.gl.LEQUAL,li.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,li.ReadOnly);P.setDepthMode(R),M.render(P.gl,p.transform.customLayerMatrix(),{farZ:p.transform.farZ,nearZ:p.transform.nearZ,fov:p.transform._fov,modelViewProjectionMatrix:p.transform.modelViewProjectionMatrix,projectionMatrix:p.transform.projectionMatrix}),P.setDirty(),p.setBaseState(),P.bindFramebuffer.set(null)}})(e,0,o)}}translatePosMatrix(e,r,o,h,p){if(!o[0]&&!o[1])return e;const w=p?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(w){const M=Math.sin(w),R=Math.cos(w);o=[o[0]*R-o[1]*M,o[0]*M+o[1]*R]}const S=[p?o[0]:yi(r,o[0],this.transform.zoom),p?o[1]:yi(r,o[1],this.transform.zoom),0],P=new Float32Array(16);return a.J(P,e,S),P}saveTileTexture(e){const r=this._tileTextures[e.size[0]];r?r.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const r=this._tileTextures[e];return r&&r.length>0?r.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const r=this.imageManager.getPattern(e.from.toString()),o=this.imageManager.getPattern(e.to.toString());return!r||!o}useProgram(e,r){this.cache=this.cache||{};const o=e+(r?r.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[o]||(this.cache[o]=new ol(this.context,hs[e],r,$a[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new pe(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:r}=this.context.gl;return this.width!==e||this.height!==r}}class Nr{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,o){const h=Math.pow(2,o),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const P=1/(S=a.af([],S,e))[3]/r*h;return a.b1(S,S,[P,P,1/S[3],P])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const P=function(W,H){var G=H[0],K=H[1],se=H[2],oe=G*G+K*K+se*se;return oe>0&&(oe=1/Math.sqrt(oe)),W[0]=H[0]*oe,W[1]=H[1]*oe,W[2]=H[2]*oe,W}([],function(W,H,G){var K=H[0],se=H[1],oe=H[2],he=G[0],le=G[1],_e=G[2];return W[0]=se*_e-oe*le,W[1]=oe*he-K*_e,W[2]=K*le-se*he,W}([],Ge([],p[S[0]],p[S[1]]),Ge([],p[S[2]],p[S[1]]))),M=-((R=P)[0]*(N=p[S[1]])[0]+R[1]*N[1]+R[2]*N[2]);var R,N;return P.concat(M)});return new Nr(p,w)}}class Xr{constructor(e,r){this.min=e,this.max=r,this.center=function(o,h,p){return o[0]=.5*h[0],o[1]=.5*h[1],o[2]=.5*h[2],o}([],function(o,h,p){return o[0]=h[0]+p[0],o[1]=h[1]+p[1],o[2]=h[2]+p[2],o}([],this.min,this.max))}quadrant(e){const r=[e%2==0,e<2],o=Je(this.min),h=Je(this.max);for(let p=0;p<r.length;p++)o[p]=r[p]?this.min[p]:this.center[p],h[p]=r[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new Xr(o,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const r=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let o=!0;for(let h=0;h<e.planes.length;h++){const p=e.planes[h];let w=0;for(let S=0;S<r.length;S++)a.b2(p,r[S])>=0&&w++;if(w===0)return 0;w!==r.length&&(o=!1)}if(o)return 2;for(let h=0;h<3;h++){let p=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let S=0;S<e.points.length;S++){const P=e.points[S][h]-this.min[h];p=Math.min(p,P),w=Math.max(w,P)}if(w<0||p>this.max[h]-this.min[h])return 0}return 1}}class gs{constructor(e=0,r=0,o=0,h=0){if(isNaN(e)||e<0||isNaN(r)||r<0||isNaN(o)||o<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=r,this.left=o,this.right=h}interpolate(e,r,o){return r.top!=null&&e.top!=null&&(this.top=a.y.number(e.top,r.top,o)),r.bottom!=null&&e.bottom!=null&&(this.bottom=a.y.number(e.bottom,r.bottom,o)),r.left!=null&&e.left!=null&&(this.left=a.y.number(e.left,r.left,o)),r.right!=null&&e.right!=null&&(this.right=a.y.number(e.right,r.right,o)),this}getCenter(e,r){const o=a.ac((this.left+e-this.right)/2,0,e),h=a.ac((this.top+r-this.bottom)/2,0,r);return new a.P(o,h)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new gs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Mo=85.051129;class Ds{constructor(e,r,o,h,p){this.tileSize=512,this._renderWorldCopies=p===void 0||!!p,this._minZoom=e||0,this._maxZoom=r||22,this._minPitch=o??0,this._maxPitch=h??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new gs,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new Ds(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const r=-a.b3(e,-180,180)*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=function(){var o=new a.A(4);return a.A!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o}(),function(o,h,p){var w=h[0],S=h[1],P=h[2],M=h[3],R=Math.sin(p),N=Math.cos(p);o[0]=w*N+P*R,o[1]=S*N+M*R,o[2]=w*-R+P*N,o[3]=S*-R+M*N}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const r=a.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const r=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this.tileZoom=Math.max(0,Math.floor(r)),this.scale=this.zoomScale(r),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,r,o){this._unmodified=!1,this._edgeInsets.interpolate(e,r,o),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const r=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(e){const r=[new a.b4(0,e)];if(this._renderWorldCopies){const o=this.pointCoordinate(new a.P(0,0)),h=this.pointCoordinate(new a.P(this.width,0)),p=this.pointCoordinate(new a.P(this.width,this.height)),w=this.pointCoordinate(new a.P(0,this.height)),S=Math.floor(Math.min(o.x,h.x,p.x,w.x)),P=Math.floor(Math.max(o.x,h.x,p.x,w.x)),M=1;for(let R=S-M;R<=P+M;R++)R!==0&&r.push(new a.b4(R,e))}return r}coveringTiles(e){var r,o;let h=this.coveringZoomLevel(e);const p=h;if(e.minzoom!==void 0&&h<e.minzoom)return[];e.maxzoom!==void 0&&h>e.maxzoom&&(h=e.maxzoom);const w=this.pointCoordinate(this.getCameraPoint()),S=a.Z.fromLngLat(this.center),P=Math.pow(2,h),M=[P*w.x,P*w.y,0],R=[P*S.x,P*S.y,0],N=Nr.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,h);let W=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(W=h);const H=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,G=le=>({aabb:new Xr([le*P,0,0],[(le+1)*P,P,0]),zoom:0,x:0,y:0,wrap:le,fullyVisible:!1}),K=[],se=[],oe=h,he=e.reparseOverscaled?p:h;if(this._renderWorldCopies)for(let le=1;le<=3;le++)K.push(G(-le)),K.push(G(le));for(K.push(G(0));K.length>0;){const le=K.pop(),_e=le.x,Me=le.y;let Te=le.fullyVisible;if(!Te){const wt=le.aabb.intersects(N);if(wt===0)continue;Te=wt===2}const rt=e.terrain?M:R,mt=le.aabb.distanceX(rt),vt=le.aabb.distanceY(rt),St=Math.max(Math.abs(mt),Math.abs(vt));if(le.zoom===oe||St>H+(1<<oe-le.zoom)-2&&le.zoom>=W){const wt=oe-le.zoom,bt=M[0]-.5-(_e<<wt),At=M[1]-.5-(Me<<wt);se.push({tileID:new a.S(le.zoom===oe?he:le.zoom,le.wrap,le.zoom,_e,Me),distanceSq:De([R[0]-.5-_e,R[1]-.5-Me]),tileDistanceToCamera:Math.sqrt(bt*bt+At*At)})}else for(let wt=0;wt<4;wt++){const bt=(_e<<1)+wt%2,At=(Me<<1)+(wt>>1),Gt=le.zoom+1;let Ct=le.aabb.quadrant(wt);if(e.terrain){const Et=new a.S(Gt,le.wrap,Gt,bt,At),Jt=e.terrain.getMinMaxElevation(Et),fi=(r=Jt.minElevation)!==null&&r!==void 0?r:this.elevation,di=(o=Jt.maxElevation)!==null&&o!==void 0?o:this.elevation;Ct=new Xr([Ct.min[0],Ct.min[1],fi],[Ct.max[0],Ct.max[1],di])}K.push({aabb:Ct,zoom:Gt,x:bt,y:At,wrap:le.wrap,fullyVisible:Te})}}return se.sort((le,_e)=>le.distanceSq-_e.distanceSq).map(le=>le.tileID)}resize(e,r){this.width=e,this.height=r,this.pixelsToGLUnits=[2/e,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const r=a.ac(e.lat,-85.051129,Mo);return new a.P(a.O(e.lng)*this.worldSize,a.Q(r)*this.worldSize)}unproject(e){return new a.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const r=this.elevation,o=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,h=this.pointLocation(this.centerPoint,e),p=e.getElevationForLngLatZoom(h,this.tileZoom);if(!(this.elevation-p))return;const w=o+r-p,S=Math.cos(this._pitch)*this.cameraToCenterDistance/w/a.b5(1,h.lat),P=this.scaleZoom(S/this.tileSize);this._elevation=p,this._center=h,this.zoom=P}setLocationAtPoint(e,r){const o=this.pointCoordinate(r),h=this.pointCoordinate(this.centerPoint),p=this.locationCoordinate(e),w=new a.Z(p.x-(o.x-h.x),p.y-(o.y-h.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,r){return r?this.coordinatePoint(this.locationCoordinate(e),r.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,r){return this.coordinateLocation(this.pointCoordinate(e,r))}locationCoordinate(e){return a.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,r){if(r){const W=r.pointCoordinate(e);if(W!=null)return W}const o=[e.x,e.y,0,1],h=[e.x,e.y,1,1];a.af(o,o,this.pixelMatrixInverse),a.af(h,h,this.pixelMatrixInverse);const p=o[3],w=h[3],S=o[1]/p,P=h[1]/w,M=o[2]/p,R=h[2]/w,N=M===R?0:(0-M)/(R-M);return new a.Z(a.y.number(o[0]/p,h[0]/w,N)/this.worldSize,a.y.number(S,P,N)/this.worldSize)}coordinatePoint(e,r=0,o=this.pixelMatrix){const h=[e.x*this.worldSize,e.y*this.worldSize,r,1];return a.af(h,h,o),new a.P(h[0]/h[3],h[1]/h[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new te().extend(this.pointLocation(new a.P(0,e))).extend(this.pointLocation(new a.P(this.width,e))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new te([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Mo])}calculateTileMatrix(e){const r=e.canonical,o=this.worldSize/this.zoomScale(r.z),h=r.x+Math.pow(2,r.z)*e.wrap,p=a.an(new Float64Array(16));return a.J(p,p,[h*o,r.y*o,0]),a.K(p,p,[o/a.X,o/a.X,1]),p}calculatePosMatrix(e,r=!1){const o=e.key,h=r?this._alignedPosMatrixCache:this._posMatrixCache;if(h[o])return h[o];const p=this.calculateTileMatrix(e);return a.L(p,r?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,p),h[o]=new Float32Array(p),h[o]}calculateFogMatrix(e){const r=e.key,o=this._fogMatrixCache;if(o[r])return o[r];const h=this.calculateTileMatrix(e);return a.L(h,this.fogMatrix,h),o[r]=new Float32Array(h),o[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,r){r=a.ac(+r,this.minZoom,this.maxZoom);const o={center:new a.N(e.lng,e.lat),zoom:r};let h=this.lngRange;if(!this._renderWorldCopies&&h===null){const le=179.9999999999;h=[-le,le]}const p=this.tileSize*this.zoomScale(o.zoom);let w=0,S=p,P=0,M=p,R=0,N=0;const{x:W,y:H}=this.size;if(this.latRange){const le=this.latRange;w=a.Q(le[1])*p,S=a.Q(le[0])*p,S-w<H&&(R=H/(S-w))}h&&(P=a.b3(a.O(h[0])*p,0,p),M=a.b3(a.O(h[1])*p,0,p),M<P&&(M+=p),M-P<W&&(N=W/(M-P)));const{x:G,y:K}=this.project.call({worldSize:p},e);let se,oe;const he=Math.max(N||0,R||0);if(he){const le=new a.P(N?(M+P)/2:G,R?(S+w)/2:K);return o.center=this.unproject.call({worldSize:p},le).wrap(),o.zoom+=this.scaleZoom(he),o}if(this.latRange){const le=H/2;K-le<w&&(oe=w+le),K+le>S&&(oe=S-le)}if(h){const le=(P+M)/2;let _e=G;this._renderWorldCopies&&(_e=a.b3(G,le-p/2,le+p/2));const Me=W/2;_e-Me<P&&(se=P+Me),_e+Me>M&&(se=M-Me)}if(se!==void 0||oe!==void 0){const le=new a.P(se??G,oe??K);o.center=this.unproject.call({worldSize:p},le).wrap()}return o}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:r,zoom:o}=this.getConstrained(this.center,this.zoom);this.center=r,this.zoom=o,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,r=this.point.x,o=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b5(1,this.center.lat)*this.worldSize;let h=a.an(new Float64Array(16));a.K(h,h,[this.width/2,-this.height/2,1]),a.J(h,h,[1,-1,0]),this.labelPlaneMatrix=h,h=a.an(new Float64Array(16)),a.K(h,h,[1,-1,1]),a.J(h,h,[-1,-1,0]),a.K(h,h,[2/this.width,2/this.height,1]),this.glCoordMatrix=h;const p=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),w=Math.min(this.elevation,this.minElevationForCurrentTile),S=p-w*this._pixelPerMeter/Math.cos(this._pitch),P=w<0?S:p,M=Math.PI/2+this._pitch,R=this._fov*(.5+e.y/this.height),N=Math.sin(R)*P/Math.sin(a.ac(Math.PI-M-R,.01,Math.PI-.01)),W=this.getHorizon(),H=2*Math.atan(W/this.cameraToCenterDistance)*(.5+e.y/(2*W)),G=Math.sin(H)*P/Math.sin(a.ac(Math.PI-M-H,.01,Math.PI-.01)),K=Math.min(N,G);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*K+P),this.nearZ=this.height/50,h=new Float64Array(16),a.b6(h,this._fov,this.width/this.height,this.nearZ,this.farZ),h[8]=2*-e.x/this.width,h[9]=2*e.y/this.height,this.projectionMatrix=a.ae(h),a.K(h,h,[1,-1,1]),a.J(h,h,[0,0,-this.cameraToCenterDistance]),a.b7(h,h,this._pitch),a.ad(h,h,this.angle),a.J(h,h,[-r,-o,0]),this.mercatorMatrix=a.K([],h,[this.worldSize,this.worldSize,this.worldSize]),a.K(h,h,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.L(new Float64Array(16),this.labelPlaneMatrix,h),a.J(h,h,[0,0,-this.elevation]),this.modelViewProjectionMatrix=h,this.invModelViewProjectionMatrix=a.as([],h),this.fogMatrix=new Float64Array(16),a.b6(this.fogMatrix,this._fov,this.width/this.height,p,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,a.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),a.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),a.b7(this.fogMatrix,this.fogMatrix,this._pitch),a.ad(this.fogMatrix,this.fogMatrix,this.angle),a.J(this.fogMatrix,this.fogMatrix,[-r,-o,0]),a.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),a.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=a.L(new Float64Array(16),this.labelPlaneMatrix,h);const se=this.width%2/2,oe=this.height%2/2,he=Math.cos(this.angle),le=Math.sin(this.angle),_e=r-Math.round(r)+he*se+le*oe,Me=o-Math.round(o)+he*oe+le*se,Te=new Float64Array(h);if(a.J(Te,Te,[_e>.5?_e-1:_e,Me>.5?Me-1:Me,0]),this.alignedModelViewProjectionMatrix=Te,h=a.as(new Float64Array(16),this.pixelMatrix),!h)throw new Error("failed to invert matrix");this.pixelMatrixInverse=h,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new a.P(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return a.af(r,r,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,e))}getCameraQueryGeometry(e){const r=this.getCameraPoint();if(e.length===1)return[e[0],r];{let o=r.x,h=r.y,p=r.x,w=r.y;for(const S of e)o=Math.min(o,S.x),h=Math.min(h,S.y),p=Math.max(p,S.x),w=Math.max(w,S.y);return[new a.P(o,h),new a.P(p,h),new a.P(p,w),new a.P(o,w),new a.P(o,h)]}}lngLatToCameraDepth(e,r){const o=this.locationCoordinate(e),h=[o.x*this.worldSize,o.y*this.worldSize,r,1];return a.af(h,h,this.modelViewProjectionMatrix),h[2]/h[3]}}function ys(c,e){let r,o=!1,h=null,p=null;const w=()=>{h=null,o&&(c.apply(p,r),h=setTimeout(w,e),o=!1)};return(...S)=>(o=!0,p=this,r=S,h||w(),h)}class Fs{constructor(e){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let o;return r.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(o=h)}),(o&&o[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(r.length>=3&&!r.some(o=>isNaN(o))){const o=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:o,pitch:+(r[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{const r=this._getCurrentHash();if(r.length===0)return;const o=r.join("/");let h=o;h.split("&").length>0&&(h=h.split("&")[0]),this._hashName&&(h=`${this._hashName}=${o}`);let p=window.location.hash.replace(h,"");p.startsWith("#&")?p=p.slice(0,1)+p.slice(2):p==="#"&&(p="");let w=window.location.href.replace(/(#.+)?$/,p);w=w.replace("&&","&"),window.history.replaceState(window.history.state,null,w)},this._updateHash=ys(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const r=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,h=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,h),w=Math.round(r.lng*p)/p,S=Math.round(r.lat*p)/p,P=this._map.getBearing(),M=this._map.getPitch();let R="";if(R+=e?`/${w}/${S}/${o}`:`${o}/${S}/${w}`,(P||M)&&(R+="/"+Math.round(10*P)/10),M&&(R+=`/${Math.round(M)}`),this._hashName){const N=this._hashName;let W=!1;const H=window.location.hash.slice(1).split("&").map(G=>{const K=G.split("=")[0];return K===N?(W=!0,`${K}=${R}`):G}).filter(G=>G);return W||H.push(`${N}=${R}`),`#${H.join("&")}`}return`#${R}`}}const _s={linearity:.3,easing:a.b8(0,0,.3,1)},ra=a.e({deceleration:2500,maxSpeed:1400},_s),zo=a.e({deceleration:20,maxSpeed:1400},_s),ka=a.e({deceleration:1e3,maxSpeed:360},_s),vs=a.e({deceleration:1e3,maxSpeed:90},_s);class Xa{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:O.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,r=O.now();for(;e.length>0&&r-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)r.zoom+=p.zoomDelta||0,r.bearing+=p.bearingDelta||0,r.pitch+=p.pitchDelta||0,p.panDelta&&r.pan._add(p.panDelta),p.around&&(r.around=p.around),p.pinchAround&&(r.pinchAround=p.pinchAround);const o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(r.pan.mag()){const p=on(r.pan.mag(),o,a.e({},ra,e||{}));h.offset=r.pan.mult(p.amount/r.pan.mag()),h.center=this._map.transform.center,an(h,p)}if(r.zoom){const p=on(r.zoom,o,zo);h.zoom=this._map.transform.zoom+p.amount,an(h,p)}if(r.bearing){const p=on(r.bearing,o,ka);h.bearing=this._map.transform.bearing+a.ac(p.amount,-179,179),an(h,p)}if(r.pitch){const p=on(r.pitch,o,vs);h.pitch=this._map.transform.pitch+p.amount,an(h,p)}if(h.zoom||h.bearing){const p=r.pinchAround===void 0?r.around:r.pinchAround;h.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),a.e(h,{noMoveStart:!0})}}function an(c,e){(!c.duration||c.duration<e.duration)&&(c.duration=e.duration,c.easing=e.easing)}function on(c,e,r){const{maxSpeed:o,linearity:h,deceleration:p}=r,w=a.ac(c*h/(e/1e3),-o,o),S=Math.abs(w)/(p*h);return{easing:r.easing,duration:1e3*S,amount:w*(S/2)}}class zi extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,o,h={}){const p=$.mousePos(r.getCanvas(),o),w=r.unproject(p);super(e,a.e({point:p,lngLat:w,originalEvent:o},h)),this._defaultPrevented=!1,this.target=r}}class Zi extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,o){const h=e==="touchend"?o.changedTouches:o.touches,p=$.touchPos(r.getCanvasContainer(),h),w=p.map(P=>r.unproject(P)),S=p.reduce((P,M,R,N)=>P.add(M.div(N.length)),new a.P(0,0));super(e,{points:p,point:S,lngLats:w,lngLat:r.unproject(S),originalEvent:o}),this._defaultPrevented=!1}}class Ir extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,o){super(e,{originalEvent:o}),this._defaultPrevented=!1}}class Dr{constructor(e,r){this._map=e,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Ir(e.type,this._map,e))}mousedown(e,r){return this._mousedownPos=r,this._firePreventable(new zi(e.type,this._map,e))}mouseup(e){this._map.fire(new zi(e.type,this._map,e))}click(e,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new zi(e.type,this._map,e))}dblclick(e){return this._firePreventable(new zi(e.type,this._map,e))}mouseover(e){this._map.fire(new zi(e.type,this._map,e))}mouseout(e){this._map.fire(new zi(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Zi(e.type,this._map,e))}touchmove(e){this._map.fire(new Zi(e.type,this._map,e))}touchend(e){this._map.fire(new Zi(e.type,this._map,e))}touchcancel(e){this._map.fire(new Zi(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yi{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new zi(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new zi(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yn{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(a.P.convert(e),this._map.terrain)}}class qr{constructor(e,r){this._map=e,this._tr=new yn(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,r){this.isEnabled()&&e.shiftKey&&e.button===0&&($.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(e,r){if(!this._active)return;const o=r;if(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=o,this._box||(this._box=$.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const p=Math.min(h.x,o.x),w=Math.max(h.x,o.x),S=Math.min(h.y,o.y),P=Math.max(h.y,o.y);$.setTransform(this._box,`translate(${p}px,${S}px)`),this._box.style.width=w-p+"px",this._box.style.height=P-S+"px"}mouseupWindow(e,r){if(!this._active||e.button!==0)return;const o=this._startPos,h=r;if(this.reset(),$.suppressClick(),o.x!==h.x||o.y!==h.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:e})),{cameraAnimation:p=>p.fitScreenCoordinates(o,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&($.remove(this._box),this._box=null),$.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,r){return this._map.fire(new a.k(e,{originalEvent:r}))}}function Ta(c,e){if(c.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${c.length}, points ${e.length}`);const r={};for(let o=0;o<c.length;o++)r[c[o].identifier]=e[o];return r}class fl{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,r,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),o.length===this.numTouches&&(this.centroid=function(h){const p=new a.P(0,0);for(const w of h)p._add(w);return p.div(h.length)}(r),this.touches=Ta(o,r)))}touchmove(e,r,o){if(this.aborted||!this.centroid)return;const h=Ta(o,r);for(const p in this.touches){const w=h[p];(!w||w.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(e,r,o){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class Ka{constructor(e){this.singleTap=new fl(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,r,o){this.singleTap.touchstart(e,r,o)}touchmove(e,r,o){this.singleTap.touchmove(e,r,o)}touchend(e,r,o){const h=this.singleTap.touchend(e,r,o);if(h){const p=e.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(h)<30;if(p&&w||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class Vr{constructor(e){this._tr=new yn(e),this._zoomIn=new Ka({numTouches:1,numTaps:2}),this._zoomOut=new Ka({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,r,o){this._zoomIn.touchstart(e,r,o),this._zoomOut.touchstart(e,r,o)}touchmove(e,r,o){this._zoomIn.touchmove(e,r,o),this._zoomOut.touchmove(e,r,o)}touchend(e,r,o){const h=this._zoomIn.touchend(e,r,o),p=this._zoomOut.touchend(e,r,o),w=this._tr;return h?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(h)},{originalEvent:e})}):p?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(p)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fr{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const r=this._moveFunction(...e);if(r.bearingDelta||r.pitchDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(e,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=r.length?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,r){if(!this.isEnabled())return;const o=this._lastPoint;if(!o)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const h=r.length?r[0]:r;return!this._moved&&h.dist(o)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(o,h))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&$.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const No={0:1,2:2};class Ya{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const r=$.mouseButton(e);this._eventButton=r}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(r,o){const h=No[o];return r.buttons===void 0||(r.buttons&h)!==h}(e,this._eventButton)}isValidEndEvent(e){return $.mouseButton(e)===this._eventButton}}class jl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const Ja=c=>{c.mousedown=c.dragStart,c.mousemoveWindow=c.dragMove,c.mouseup=c.dragEnd,c.contextmenu=e=>{e.preventDefault()}},Do=({enable:c,clickTolerance:e,bearingDegreesPerPixelMoved:r=.8})=>{const o=new Ya({checkCorrectEvent:h=>$.mouseButton(h)===0&&h.ctrlKey||$.mouseButton(h)===2});return new Fr({clickTolerance:e,move:(h,p)=>({bearingDelta:(p.x-h.x)*r}),moveStateManager:o,enable:c,assignEvents:Ja})},ml=({enable:c,clickTolerance:e,pitchDegreesPerPixelMoved:r=-.5})=>{const o=new Ya({checkCorrectEvent:h=>$.mouseButton(h)===0&&h.ctrlKey||$.mouseButton(h)===2});return new Fr({clickTolerance:e,move:(h,p)=>({pitchDelta:(p.y-h.y)*r}),moveStateManager:o,enable:c,assignEvents:Ja})};class Ca{constructor(e,r){this._clickTolerance=e.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,r,o){return this._calculateTransform(e,r,o)}touchmove(e,r,o){if(this._active){if(!this._shouldBePrevented(o.length))return e.preventDefault(),this._calculateTransform(e,r,o);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,r,o){this._calculateTransform(e,r,o),this._active&&this._shouldBePrevented(o.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,r,o){o.length>0&&(this._active=!0);const h=Ta(o,r),p=new a.P(0,0),w=new a.P(0,0);let S=0;for(const M in h){const R=h[M],N=this._touches[M];N&&(p._add(R),w._add(R.sub(N)),S++,h[M]=R)}if(this._touches=h,this._shouldBePrevented(S)||!w.mag())return;const P=w.div(S);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(S),panDelta:P}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,r,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([r[0],r[1]]))}touchmove(e,r,o){if(!this._firstTwoTouches)return;e.preventDefault();const[h,p]=this._firstTwoTouches,w=Qa(o,r,h),S=Qa(o,r,p);if(!w||!S)return;const P=this._aroundCenter?null:w.add(S).div(2);return this._move([w,S],P,e)}touchend(e,r,o){if(!this._firstTwoTouches)return;const[h,p]=this._firstTwoTouches,w=Qa(o,r,h),S=Qa(o,r,p);w&&S||(this._active&&$.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Qa(c,e,r){for(let o=0;o<c.length;o++)if(c[o].identifier===r)return e[o]}function Ro(c,e){return Math.log(c/e)/Math.LN2}class gl extends Fo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,r){const o=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Ro(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ro(this._distance,o),pinchAround:r}}}function hc(c,e){return 180*c.angleWith(e)/Math.PI}class uc extends Fo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,r,o){const h=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:hc(this._vector,h),pinchAround:r}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const r=25/(Math.PI*this._minDiameter)*360,o=hc(e,this._startVector);return Math.abs(o)<r}}function yl(c){return Math.abs(c.y)>Math.abs(c.x)}class Oo extends Fo{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,r,o){super.touchstart(e,r,o),this._currentTouchCount=o.length}_start(e){this._lastPoints=e,yl(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,r,o){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const h=e[0].sub(this._lastPoints[0]),p=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,p,o.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(h.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(e,r,o){if(this._valid!==void 0)return this._valid;const h=e.mag()>=2,p=r.mag()>=2;if(!h&&!p)return;if(!h||!p)return this._firstMove===void 0&&(this._firstMove=o),o-this._firstMove<100&&void 0;const w=e.y>0==r.y>0;return yl(e)&&yl(r)&&w}}const Fc={panStep:100,bearingStep:15,pitchStep:10};class Xn{constructor(e){this._tr=new yn(e);const r=Fc;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let r=0,o=0,h=0,p=0,w=0;switch(e.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:e.shiftKey?o=-1:(e.preventDefault(),p=-1);break;case 39:e.shiftKey?o=1:(e.preventDefault(),p=1);break;case 38:e.shiftKey?h=1:(e.preventDefault(),w=-1);break;case 40:e.shiftKey?h=-1:(e.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(o=0,h=0),{cameraAnimation:S=>{const P=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:Rs,zoom:r?Math.round(P.zoom)+r*(e.shiftKey?2:1):P.zoom,bearing:P.bearing+o*this._bearingStep,pitch:P.pitch+h*this._pitchStep,offset:[-p*this._panStep,-w*this._panStep],center:P.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Rs(c){return c*(2-c)}const dc=4.000244140625;class Fn{constructor(e,r){this._onTimeout=o=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)},this._map=e,this._tr=new yn(e),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let r=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const o=O.now(),h=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,r!==0&&r%dc==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(h*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=$.mousePos(this._map.getCanvas(),e),o=this._tr;this._around=r.y>o.transform.height/2-o.transform.getHorizon()?a.N.convert(this._aroundCenter?o.center:o.unproject(r)):a.N.convert(o.center),this._aroundPoint=o.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>dc?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&M!==0&&(M=1/M);const R=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(R*M))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,o=this._startZoom,h=this._easing;let p,w=!1;const S=O.now()-this._lastWheelEventTime;if(this._type==="wheel"&&o&&h&&S){const P=Math.min(S/200,1),M=h(P);p=a.y.number(o,r,M),P<1?this._frameId||(this._frameId=!0):w=!0}else p=r,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!w,zoomDelta:p-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let r=a.b9;if(this._prevEase){const o=this._prevEase,h=(O.now()-o.start)/o.duration,p=o.easing(h+.01)-o.easing(h),w=.27/Math.sqrt(p*p+1e-4)*.01,S=Math.sqrt(.0729-w*w);r=a.b8(w,S,.25,1)}return this._prevEase={start:O.now(),duration:e,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class na{constructor(e,r){this._clickZoom=e,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _l{constructor(e){this._tr=new yn(e),this.reset()}reset(){this._active=!1}dblclick(e,r){return e.preventDefault(),{cameraAnimation:o=>{o.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wh{constructor(){this._tap=new Ka({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,r,o){if(!this._swipePoint)if(this._tapTime){const h=r[0],p=e.timeStamp-this._tapTime<500,w=this._tapPoint.dist(h)<30;p&&w?o.length>0&&(this._swipePoint=h,this._swipeTouch=o[0].identifier):this.reset()}else this._tap.touchstart(e,r,o)}touchmove(e,r,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;const h=r[0],p=h.y-this._swipePoint.y;return this._swipePoint=h,e.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(e,r,o)}touchend(e,r,o){if(this._tapTime)this._swipePoint&&o.length===0&&this.reset();else{const h=this._tap.touchend(e,r,o);h&&(this._tapTime=e.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rc{constructor(e,r,o){this._el=e,this._mousePan=r,this._touchPan=o}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class pc{constructor(e,r,o){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=r,this._mousePitch=o}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class fc{constructor(e,r,o,h){this._el=e,this._touchZoom=r,this._touchRotate=o,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Bo{constructor(e,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=$.create("div","maplibregl-cooperative-gesture-screen",e);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const o=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=r,this._container.appendChild(h);const p=document.createElement("div");p.className="maplibregl-mobile-message",p.textContent=o,this._container.appendChild(p),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&($.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,r){this._enabled&&(this._map.fire(new a.k("cooperativegestureprevented",{gestureType:e,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Kn=c=>c.zoom||c.drag||c.pitch||c.rotate;class Vt extends a.k{}function bs(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class Rn{constructor(e,r){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,p)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=h.type==="renderFrame"?void 0:h,S={needsRenderFrame:!1},P={},M={},R=h.touches,N=R?this._getMapTouches(R):void 0,W=N?$.touchPos(this._map.getCanvas(),N):$.mousePos(this._map.getCanvas(),h);for(const{handlerName:K,handler:se,allowed:oe}of this._handlers){if(!se.isEnabled())continue;let he;this._blockedByActive(M,oe,K)?se.reset():se[p||h.type]&&(he=se[p||h.type](h,W,N),this.mergeHandlerResult(S,P,he,K,w),he&&he.needsRenderFrame&&this._triggerRenderFrame()),(he||se.isActive())&&(M[K]=se)}const H={};for(const K in this._previousActiveHandlers)M[K]||(H[K]=w);this._previousActiveHandlers=M,(Object.keys(H).length||bs(S))&&(this._changes.push([S,P,H]),this._triggerRenderFrame()),(Object.keys(M).length||bs(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=S;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Xa(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,p,w]of this._listeners)$.addEventListener(h,p,h===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[e,r,o]of this._listeners)$.removeEventListener(e,r,e===document?this.handleWindowEvent:this.handleEvent,o)}_addDefaultHandlers(e){const r=this._map,o=r.getCanvasContainer();this._add("mapEvent",new Dr(r,e));const h=r.boxZoom=new qr(r,e);this._add("boxZoom",h),e.interactive&&e.boxZoom&&h.enable();const p=r.cooperativeGestures=new Bo(r,e.cooperativeGestures);this._add("cooperativeGestures",p),e.cooperativeGestures&&p.enable();const w=new Vr(r),S=new _l(r);r.doubleClickZoom=new na(S,w),this._add("tapZoom",w),this._add("clickZoom",S),e.interactive&&e.doubleClickZoom&&r.doubleClickZoom.enable();const P=new wh;this._add("tapDragZoom",P);const M=r.touchPitch=new Oo(r);this._add("touchPitch",M),e.interactive&&e.touchPitch&&r.touchPitch.enable(e.touchPitch);const R=Do(e),N=ml(e);r.dragRotate=new pc(e,R,N),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]),e.interactive&&e.dragRotate&&r.dragRotate.enable();const W=(({enable:he,clickTolerance:le})=>{const _e=new Ya({checkCorrectEvent:Me=>$.mouseButton(Me)===0&&!Me.ctrlKey});return new Fr({clickTolerance:le,move:(Me,Te)=>({around:Te,panDelta:Te.sub(Me)}),activateOnStart:!0,moveStateManager:_e,enable:he,assignEvents:Ja})})(e),H=new Ca(e,r);r.dragPan=new Rc(o,W,H),this._add("mousePan",W),this._add("touchPan",H,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&r.dragPan.enable(e.dragPan);const G=new uc,K=new gl;r.touchZoomRotate=new fc(o,K,G,P),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&r.touchZoomRotate.enable(e.touchZoomRotate);const se=r.scrollZoom=new Fn(r,()=>this._triggerRenderFrame());this._add("scrollZoom",se,["mousePan"]),e.interactive&&e.scrollZoom&&r.scrollZoom.enable(e.scrollZoom);const oe=r.keyboard=new Xn(r);this._add("keyboard",oe),e.interactive&&e.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new Yi(r))}_add(e,r,o){this._handlers.push({handlerName:e,handler:r,allowed:o}),this._handlersById[e]=r}stop(e){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Kn(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,r,o){for(const h in e)if(h!==o&&(!r||r.indexOf(h)<0))return!0;return!1}_getMapTouches(e){const r=[];for(const o of e)this._el.contains(o.target)&&r.push(o);return r}mergeHandlerResult(e,r,o,h,p){if(!o)return;a.e(e,o);const w={handlerName:h,originalEvent:o.originalEvent||p};o.zoomDelta!==void 0&&(r.zoom=w),o.panDelta!==void 0&&(r.drag=w),o.pitchDelta!==void 0&&(r.pitch=w),o.bearingDelta!==void 0&&(r.rotate=w)}_applyChanges(){const e={},r={},o={};for(const[h,p,w]of this._changes)h.panDelta&&(e.panDelta=(e.panDelta||new a.P(0,0))._add(h.panDelta)),h.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+h.pitchDelta),h.around!==void 0&&(e.around=h.around),h.pinchAround!==void 0&&(e.pinchAround=h.pinchAround),h.noInertia&&(e.noInertia=h.noInertia),a.e(r,p),a.e(o,w);this._updateMapTransform(e,r,o),this._changes=[]}_updateMapTransform(e,r,o){const h=this._map,p=h._getTransformForUpdate(),w=h.terrain;if(!(bs(e)||w&&this._terrainMovement))return this._fireEvents(r,o,!0);let{panDelta:S,zoomDelta:P,bearingDelta:M,pitchDelta:R,around:N,pinchAround:W}=e;W!==void 0&&(N=W),h._stop(!0),N=N||h.transform.centerPoint;const H=p.pointLocation(S?N.sub(S):N);M&&(p.bearing+=M),R&&(p.pitch+=R),P&&(p.zoom+=P),w?this._terrainMovement||!r.drag&&!r.zoom?r.drag&&this._terrainMovement?p.center=p.pointLocation(p.centerPoint.sub(S)):p.setLocationAtPoint(H,N):(this._terrainMovement=!0,this._map._elevationFreeze=!0,p.setLocationAtPoint(H,N)):p.setLocationAtPoint(H,N),h._applyUpdatedTransform(p),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(r,o,!0)}_fireEvents(e,r,o){const h=Kn(this._eventsInProgress),p=Kn(e),w={};for(const N in e){const{originalEvent:W}=e[N];this._eventsInProgress[N]||(w[`${N}start`]=W),this._eventsInProgress[N]=e[N]}!h&&p&&this._fireEvent("movestart",p.originalEvent);for(const N in w)this._fireEvent(N,w[N]);p&&this._fireEvent("move",p.originalEvent);for(const N in e){const{originalEvent:W}=e[N];this._fireEvent(N,W)}const S={};let P;for(const N in this._eventsInProgress){const{handlerName:W,originalEvent:H}=this._eventsInProgress[N];this._handlersById[W].isActive()||(delete this._eventsInProgress[N],P=r[W]||H,S[`${N}end`]=P)}for(const N in S)this._fireEvent(N,S[N]);const M=Kn(this._eventsInProgress),R=(h||p)&&!M;if(R&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const N=this._map._getTransformForUpdate();N.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(N)}if(o&&R){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),W=H=>H!==0&&-this._bearingSnap<H&&H<this._bearingSnap;!N||!N.essential&&O.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:P})),W(this._map.getBearing())&&this._map.resetNorth()):(W(N.bearing||this._map.getBearing())&&(N.bearing=0),N.freezeElevation=!0,this._map.easeTo(N,{originalEvent:P})),this._updatingCamera=!1}}_fireEvent(e,r){this._map.fire(new a.k(e,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Vt("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Os extends a.E{constructor(e,r){super(),this._renderFrameCallback=()=>{const o=Math.min((O.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=r.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,r){return this.jumpTo({center:e},r)}panBy(e,r,o){return e=a.P.convert(e).mult(-1),this.panTo(this.transform.center,a.e({offset:e},r),o)}panTo(e,r,o){return this.easeTo(a.e({center:e},r),o)}getZoom(){return this.transform.zoom}setZoom(e,r){return this.jumpTo({zoom:e},r),this}zoomTo(e,r,o){return this.easeTo(a.e({zoom:e},r),o)}zoomIn(e,r){return this.zoomTo(this.getZoom()+1,e,r),this}zoomOut(e,r){return this.zoomTo(this.getZoom()-1,e,r),this}getBearing(){return this.transform.bearing}setBearing(e,r){return this.jumpTo({bearing:e},r),this}getPadding(){return this.transform.padding}setPadding(e,r){return this.jumpTo({padding:e},r),this}rotateTo(e,r,o){return this.easeTo(a.e({bearing:e},r),o)}resetNorth(e,r){return this.rotateTo(0,a.e({duration:1e3},e),r),this}resetNorthPitch(e,r){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},e),r),this}snapToNorth(e,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,r):this}getPitch(){return this.transform.pitch}setPitch(e,r){return this.jumpTo({pitch:e},r),this}cameraForBounds(e,r){e=te.convert(e).adjustAntiMeridian();const o=r&&r.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),o,r)}_cameraForBoxAndBearing(e,r,o,h){const p={top:0,bottom:0,right:0,left:0};if(typeof(h=a.e({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const wt=h.padding;h.padding={top:wt,bottom:wt,right:wt,left:wt}}h.padding=a.e(p,h.padding);const w=this.transform,S=w.padding,P=new te(e,r),M=w.project(P.getNorthWest()),R=w.project(P.getNorthEast()),N=w.project(P.getSouthEast()),W=w.project(P.getSouthWest()),H=a.ba(-o),G=M.rotate(H),K=R.rotate(H),se=N.rotate(H),oe=W.rotate(H),he=new a.P(Math.max(G.x,K.x,oe.x,se.x),Math.max(G.y,K.y,oe.y,se.y)),le=new a.P(Math.min(G.x,K.x,oe.x,se.x),Math.min(G.y,K.y,oe.y,se.y)),_e=he.sub(le),Me=(w.width-(S.left+S.right+h.padding.left+h.padding.right))/_e.x,Te=(w.height-(S.top+S.bottom+h.padding.top+h.padding.bottom))/_e.y;if(Te<0||Me<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const rt=Math.min(w.scaleZoom(w.scale*Math.min(Me,Te)),h.maxZoom),mt=a.P.convert(h.offset),vt=new a.P((h.padding.left-h.padding.right)/2,(h.padding.top-h.padding.bottom)/2).rotate(a.ba(o)),St=mt.add(vt).mult(w.scale/w.zoomScale(rt));return{center:w.unproject(M.add(N).div(2).sub(St)),zoom:rt,bearing:o}}fitBounds(e,r,o){return this._fitInternal(this.cameraForBounds(e,r),r,o)}fitScreenCoordinates(e,r,o,h,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(e)),this.transform.pointLocation(a.P.convert(r)),o,h),h,p)}_fitInternal(e,r,o){return e?(delete(r=a.e(e,r)).padding,r.linear?this.easeTo(r,o):this.flyTo(r,o)):this}jumpTo(e,r){this.stop();const o=this._getTransformForUpdate();let h=!1,p=!1,w=!1;return"zoom"in e&&o.zoom!==+e.zoom&&(h=!0,o.zoom=+e.zoom),e.center!==void 0&&(o.center=a.N.convert(e.center)),"bearing"in e&&o.bearing!==+e.bearing&&(p=!0,o.bearing=+e.bearing),"pitch"in e&&o.pitch!==+e.pitch&&(w=!0,o.pitch=+e.pitch),e.padding==null||o.isPaddingEqual(e.padding)||(o.padding=e.padding),this._applyUpdatedTransform(o),this.fire(new a.k("movestart",r)).fire(new a.k("move",r)),h&&this.fire(new a.k("zoomstart",r)).fire(new a.k("zoom",r)).fire(new a.k("zoomend",r)),p&&this.fire(new a.k("rotatestart",r)).fire(new a.k("rotate",r)).fire(new a.k("rotateend",r)),w&&this.fire(new a.k("pitchstart",r)).fire(new a.k("pitch",r)).fire(new a.k("pitchend",r)),this.fire(new a.k("moveend",r))}calculateCameraOptionsFromTo(e,r,o,h=0){const p=a.Z.fromLngLat(e,r),w=a.Z.fromLngLat(o,h),S=w.x-p.x,P=w.y-p.y,M=w.z-p.z,R=Math.hypot(S,P,M);if(R===0)throw new Error("Can't calculate camera options with same From and To");const N=Math.hypot(S,P),W=this.transform.scaleZoom(this.transform.cameraToCenterDistance/R/this.transform.tileSize),H=180*Math.atan2(S,-P)/Math.PI;let G=180*Math.acos(N/R)/Math.PI;return G=M<0?90-G:90+G,{center:w.toLngLat(),zoom:W,pitch:G,bearing:H}}easeTo(e,r){var o;this._stop(!1,e.easeId),((e=a.e({offset:[0,0],duration:500,easing:a.b9},e)).animate===!1||!e.essential&&O.prefersReducedMotion)&&(e.duration=0);const h=this._getTransformForUpdate(),p=h.zoom,w=h.bearing,S=h.pitch,P=h.padding,M="bearing"in e?this._normalizeBearing(e.bearing,w):w,R="pitch"in e?+e.pitch:S,N="padding"in e?e.padding:h.padding,W=a.P.convert(e.offset);let H=h.centerPoint.add(W);const G=h.pointLocation(H),{center:K,zoom:se}=h.getConstrained(a.N.convert(e.center||G),(o=e.zoom)!==null&&o!==void 0?o:p);this._normalizeCenter(K,h);const oe=h.project(G),he=h.project(K).sub(oe),le=h.zoomScale(se-p);let _e,Me;e.around&&(_e=a.N.convert(e.around),Me=h.locationPoint(_e));const Te={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||se!==p,this._rotating=this._rotating||w!==M,this._pitching=this._pitching||R!==S,this._padding=!h.isPaddingEqual(N),this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,Te),this.terrain&&this._prepareElevation(K),this._ease(rt=>{if(this._zooming&&(h.zoom=a.y.number(p,se,rt)),this._rotating&&(h.bearing=a.y.number(w,M,rt)),this._pitching&&(h.pitch=a.y.number(S,R,rt)),this._padding&&(h.interpolatePadding(P,N,rt),H=h.centerPoint.add(W)),this.terrain&&!e.freezeElevation&&this._updateElevation(rt),_e)h.setLocationAtPoint(_e,Me);else{const mt=h.zoomScale(h.zoom-p),vt=se>p?Math.min(2,le):Math.max(.5,le),St=Math.pow(vt,1-rt),wt=h.unproject(oe.add(he.mult(rt*St)).mult(mt));h.setLocationAtPoint(h.renderWorldCopies?wt.wrap():wt,H)}this._applyUpdatedTransform(h),this._fireMoveEvents(r)},rt=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r,rt)},e),this}_prepareEase(e,r,o={}){this._moving=!0,r||o.moving||this.fire(new a.k("movestart",e)),this._zooming&&!o.zooming&&this.fire(new a.k("zoomstart",e)),this._rotating&&!o.rotating&&this.fire(new a.k("rotatestart",e)),this._pitching&&!o.pitching&&this.fire(new a.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&r!==this._elevationTarget){const o=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(o-(r-(o*e+this._elevationStart))/(1-e)),this._elevationTarget=r}this.transform.elevation=a.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const r=e.getCameraPosition(),o=this.terrain.getElevationForLngLatZoom(r.lngLat,e.zoom);if(r.altitude<o){const h=this.calculateCameraOptionsFromTo(r.lngLat,o,e.center,e.elevation);return{pitch:h.pitch,zoom:h.zoom}}return{}}_applyUpdatedTransform(e){const r=[];if(this.terrain&&r.push(h=>this._elevateCameraIfInsideTerrain(h)),this.transformCameraUpdate&&r.push(h=>this.transformCameraUpdate(h)),!r.length)return;const o=e.clone();for(const h of r){const p=o.clone(),{center:w,zoom:S,pitch:P,bearing:M,elevation:R}=h(p);w&&(p.center=w),S!==void 0&&(p.zoom=S),P!==void 0&&(p.pitch=P),M!==void 0&&(p.bearing=M),R!==void 0&&(p.elevation=R),o.apply(p)}this.transform.apply(o)}_fireMoveEvents(e){this.fire(new a.k("move",e)),this._zooming&&this.fire(new a.k("zoom",e)),this._rotating&&this.fire(new a.k("rotate",e)),this._pitching&&this.fire(new a.k("pitch",e))}_afterEase(e,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const o=this._zooming,h=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,o&&this.fire(new a.k("zoomend",e)),h&&this.fire(new a.k("rotateend",e)),p&&this.fire(new a.k("pitchend",e)),this.fire(new a.k("moveend",e))}flyTo(e,r){var o;if(!e.essential&&O.prefersReducedMotion){const Et=a.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Et,r)}this.stop(),e=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b9},e);const h=this._getTransformForUpdate(),p=h.zoom,w=h.bearing,S=h.pitch,P=h.padding,M="bearing"in e?this._normalizeBearing(e.bearing,w):w,R="pitch"in e?+e.pitch:S,N="padding"in e?e.padding:h.padding,W=a.P.convert(e.offset);let H=h.centerPoint.add(W);const G=h.pointLocation(H),{center:K,zoom:se}=h.getConstrained(a.N.convert(e.center||G),(o=e.zoom)!==null&&o!==void 0?o:p);this._normalizeCenter(K,h);const oe=h.zoomScale(se-p),he=h.project(G),le=h.project(K).sub(he);let _e=e.curve;const Me=Math.max(h.width,h.height),Te=Me/oe,rt=le.mag();if("minZoom"in e){const Et=a.ac(Math.min(e.minZoom,p,se),h.minZoom,h.maxZoom),Jt=Me/h.zoomScale(Et-p);_e=Math.sqrt(Jt/rt*2)}const mt=_e*_e;function vt(Et){const Jt=(Te*Te-Me*Me+(Et?-1:1)*mt*mt*rt*rt)/(2*(Et?Te:Me)*mt*rt);return Math.log(Math.sqrt(Jt*Jt+1)-Jt)}function St(Et){return(Math.exp(Et)-Math.exp(-Et))/2}function wt(Et){return(Math.exp(Et)+Math.exp(-Et))/2}const bt=vt(!1);let At=function(Et){return wt(bt)/wt(bt+_e*Et)},Gt=function(Et){return Me*((wt(bt)*(St(Jt=bt+_e*Et)/wt(Jt))-St(bt))/mt)/rt;var Jt},Ct=(vt(!0)-bt)/_e;if(Math.abs(rt)<1e-6||!isFinite(Ct)){if(Math.abs(Me-Te)<1e-6)return this.easeTo(e,r);const Et=Te<Me?-1:1;Ct=Math.abs(Math.log(Te/Me))/_e,Gt=()=>0,At=Jt=>Math.exp(Et*_e*Jt)}return e.duration="duration"in e?+e.duration:1e3*Ct/("screenSpeed"in e?+e.screenSpeed/_e:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=w!==M,this._pitching=R!==S,this._padding=!h.isPaddingEqual(N),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(K),this._ease(Et=>{const Jt=Et*Ct,fi=1/At(Jt);h.zoom=Et===1?se:p+h.scaleZoom(fi),this._rotating&&(h.bearing=a.y.number(w,M,Et)),this._pitching&&(h.pitch=a.y.number(S,R,Et)),this._padding&&(h.interpolatePadding(P,N,Et),H=h.centerPoint.add(W)),this.terrain&&!e.freezeElevation&&this._updateElevation(Et);const di=Et===1?K:h.unproject(he.add(le.mult(Gt(Jt))).mult(fi));h.setLocationAtPoint(h.renderWorldCopies?di.wrap():di,H),this._applyUpdatedTransform(h),this._fireMoveEvents(r)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,r){var o;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,r)}return e||(o=this.handlers)===null||o===void 0||o.stop(!1),this}_ease(e,r,o){o.animate===!1||o.duration===0?(e(1),r()):(this._easeStart=O.now(),this._easeOptions=o,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,r){e=a.b3(e,-180,180);const o=Math.abs(e-r);return Math.abs(e-360-r)<o&&(e-=360),Math.abs(e+360-r)<o&&(e+=360),e}_normalizeCenter(e,r){if(!r.renderWorldCopies||r.lngRange)return;const o=e.lng-r.center.lng;e.lng+=o>180?-360:o<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(a.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const jo={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class eo{constructor(e=jo){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=$.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=$.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=$.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){$.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,r){const o=this._map._getUIString(`AttributionControl.${r}`);e.title=o,e.setAttribute("aria-label",o)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(h=>typeof h!="string"?"":h)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const r=this._map.style.sourceCaches;for(const h in r){const p=r[h];if(p.used||p.usedForTerrain){const w=p.getSource();w.attribution&&e.indexOf(w.attribution)<0&&e.push(w.attribution)}}e=e.filter(h=>String(h).trim()),e.sort((h,p)=>h.length-p.length),e=e.filter((h,p)=>{for(let w=p+1;w<e.length;w++)if(e[w].indexOf(h)>=0)return!1;return!0});const o=e.join(" | ");o!==this._attribHTML&&(this._attribHTML=o,e.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Bs{constructor(e={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const o=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&o.classList.add("maplibregl-compact"):o.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=$.create("div","maplibregl-ctrl");const r=$.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){$.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Si{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const r=++this._id;return this._queue.push({callback:e,id:r,cancelled:!1}),r}remove(e){const r=this._currentlyRunning,o=r?this._queue.concat(r):this._queue;for(const h of o)if(h.id===e)return void(h.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const o of r)if(!o.cancelled&&(o.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var mc=a.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Sh extends a.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,r){this.sourceCache.update(e,r),this._renderableTilesKeys=[];const o={};for(const h of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r}))o[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.posMatrix=new Float64Array(16),a.aP(h.posMatrix,0,a.X,0,a.X,0,1),this._tiles[h.key]=new nr(h,this.tileSize));for(const h in this._tiles)o[h]||delete this._tiles[h]}freeRtt(e){for(const r in this._tiles){const o=this._tiles[r];(!e||o.tileID.equals(e)||o.tileID.isChildOf(e)||e.isChildOf(o.tileID))&&(o.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const r={};for(const o of this._renderableTilesKeys){const h=this._tiles[o].tileID;if(h.canonical.equals(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16),a.aP(p.posMatrix,0,a.X,0,a.X,0,1),r[o]=p}else if(h.canonical.isChildOf(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const w=h.canonical.z-e.canonical.z,S=h.canonical.x-(h.canonical.x>>w<<w),P=h.canonical.y-(h.canonical.y>>w<<w),M=a.X>>w;a.aP(p.posMatrix,0,M,0,M,0,1),a.J(p.posMatrix,p.posMatrix,[-S*M,-P*M,0]),r[o]=p}else if(e.canonical.isChildOf(h.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const w=e.canonical.z-h.canonical.z,S=e.canonical.x-(e.canonical.x>>w<<w),P=e.canonical.y-(e.canonical.y>>w<<w),M=a.X>>w;a.aP(p.posMatrix,0,a.X,0,a.X,0,1),a.J(p.posMatrix,p.posMatrix,[S*M,P*M,0]),a.K(p.posMatrix,p.posMatrix,[1/2**w,1/2**w,0]),r[o]=p}}return r}getSourceTile(e,r){const o=this.sourceCache._source;let h=e.overscaledZ-this.deltaZoom;if(h>o.maxzoom&&(h=o.maxzoom),h<o.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(h).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!p||!p.dem)&&r)for(;h>=o.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(e.scaledTo(h--).key);return p}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(r=>r.timeAdded>=e)}}class ql{constructor(e,r,o){this.painter=e,this.sourceCache=new Sh(r),this.options=o,this.exaggeration=typeof o.exaggeration=="number"?o.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,r,o,h=a.X){var p;if(!(r>=0&&r<h&&o>=0&&o<h))return 0;const w=this.getTerrainData(e),S=(p=w.tile)===null||p===void 0?void 0:p.dem;if(!S)return 0;const P=function(G,K,se){var oe=K[0],he=K[1];return G[0]=se[0]*oe+se[4]*he+se[12],G[1]=se[1]*oe+se[5]*he+se[13],G}([],[r/h*a.X,o/h*a.X],w.u_terrain_matrix),M=[P[0]*S.dim,P[1]*S.dim],R=Math.floor(M[0]),N=Math.floor(M[1]),W=M[0]-R,H=M[1]-N;return S.get(R,N)*(1-W)*(1-H)+S.get(R+1,N)*W*(1-H)+S.get(R,N+1)*(1-W)*H+S.get(R+1,N+1)*W*H}getElevationForLngLatZoom(e,r){if(!a.bb(r,e.wrap()))return 0;const{tileID:o,mercatorX:h,mercatorY:p}=this._getOverscaledTileIDFromLngLatZoom(e,r);return this.getElevation(o,h%a.X,p%a.X,a.X)}getElevation(e,r,o,h=a.X){return this.getDEMElevation(e,r,o,h)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const h=this.painter.context,p=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new pe(h,p,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new pe(h,new a.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const r=this.sourceCache.getSourceTile(e,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const h=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new pe(h,r.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),r.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const o=r&&r+r.tileID.key+e.key;if(o&&!this._demMatrixCache[o]){const h=this.sourceCache.sourceCache._source.maxzoom;let p=e.canonical.z-r.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=h?p=e.canonical.z-h:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=e.canonical.x-(e.canonical.x>>p<<p),S=e.canonical.y-(e.canonical.y>>p<<p),P=a.bc(new Float64Array(16),[1/(a.X<<p),1/(a.X<<p),0]);a.J(P,P,[w*a.X,S*a.X,0]),this._demMatrixCache[e.key]={matrix:P,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:o?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(e){const r=this.painter,o=r.width/devicePixelRatio,h=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===o&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new pe(r.context,{width:o,height:h,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new pe(r.context,{width:o,height:h,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(o,h,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,o,h))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,w=0;p<this._coordsTextureSize;p++)for(let S=0;S<this._coordsTextureSize;S++,w+=4)r[w+0]=255&S,r[w+1]=255&p,r[w+2]=S>>8<<4|p>>8,r[w+3]=0;const o=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),h=new pe(e,o,e.gl.RGBA,{premultiply:!1});return h.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const r=new Uint8Array(4),o=this.painter.context,h=o.gl,p=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),w=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);o.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(p,S-w-1,1,1,h.RGBA,h.UNSIGNED_BYTE,r),o.bindFramebuffer.set(null);const P=r[0]+(r[2]>>4<<8),M=r[1]+((15&r[2])<<8),R=this.coordsIndex[255-r[3]],N=R&&this.sourceCache.getTileByID(R);if(!N)return null;const W=this._coordsTextureSize,H=(1<<N.tileID.canonical.z)*W;return new a.Z((N.tileID.canonical.x*W+P)/H+N.tileID.wrap,(N.tileID.canonical.y*W+M)/H,this.getElevation(N.tileID,P,M,W))}depthAtPoint(e){const r=new Uint8Array(4),o=this.painter.context,h=o.gl;return o.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,r),o.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,r=new a.bd,o=new a.aY,h=this.meshSize,p=a.X/h,w=h*h;for(let N=0;N<=h;N++)for(let W=0;W<=h;W++)r.emplaceBack(W*p,N*p,0);for(let N=0;N<w;N+=h+1)for(let W=0;W<h;W++)o.emplaceBack(W+N,h+W+N+1,h+W+N+2),o.emplaceBack(W+N,h+W+N+2,W+N+1);const S=r.length,P=S+2*(h+1);for(const N of[0,1])for(let W=0;W<=h;W++)for(const H of[0,1])r.emplaceBack(W*p,N*a.X,H);for(let N=0;N<2*h;N+=2)o.emplaceBack(P+N,P+N+1,P+N+3),o.emplaceBack(P+N,P+N+3,P+N+2),o.emplaceBack(S+N,S+N+3,S+N+1),o.emplaceBack(S+N,S+N+2,S+N+3);const M=r.length,R=M+2*(h+1);for(const N of[0,1])for(let W=0;W<=h;W++)for(const H of[0,1])r.emplaceBack(N*a.X,W*p,H);for(let N=0;N<2*h;N+=2)o.emplaceBack(M+N,M+N+1,M+N+3),o.emplaceBack(M+N,M+N+3,M+N+2),o.emplaceBack(R+N,R+N+3,R+N+1),o.emplaceBack(R+N,R+N+2,R+N+3);return this._mesh=new fr(e.createVertexBuffer(r,mc.members),e.createIndexBuffer(o),a.a0.simpleSegment(0,0,r.length,o.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*a.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,r){var o;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(e,r);return(o=this.getMinMaxElevation(h).minElevation)!==null&&o!==void 0?o:0}getMinMaxElevation(e){const r=this.getTerrainData(e).tile,o={minElevation:null,maxElevation:null};return r&&r.dem&&(o.minElevation=r.dem.min*this.exaggeration,o.maxElevation=r.dem.max*this.exaggeration),o}_getOverscaledTileIDFromLngLatZoom(e,r){const o=a.Z.fromLngLat(e.wrap()),h=(1<<r)*a.X,p=o.x*h,w=o.y*h,S=Math.floor(p/a.X),P=Math.floor(w/a.X);return{tileID:new a.S(r,0,r,S,P),mercatorX:p,mercatorY:w}}}class Oc{constructor(e,r,o){this._context=e,this._size=r,this._tileSize=o,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),o=new pe(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return o.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(o.texture),{id:e,fbo:r,texture:o,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(r=>e.id!==r),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const to={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class gc{constructor(e,r){this.painter=e,this.terrain=r,this.pool=new Oc(e.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(o=>!e._layers[o].isHidden(r)),this._coordsDescendingInv={};for(const o in e.sourceCaches){this._coordsDescendingInv[o]={};const h=e.sourceCaches[o].getVisibleCoordinates();for(const p of h){const w=this.terrain.sourceCache.getTerrainCoords(p);for(const S in w)this._coordsDescendingInv[o][S]||(this._coordsDescendingInv[o][S]=[]),this._coordsDescendingInv[o][S].push(w[S])}}this._coordsDescendingInvStr={};for(const o of e._order){const h=e._layers[o],p=h.source;if(to[h.type]&&!this._coordsDescendingInvStr[p]){this._coordsDescendingInvStr[p]={};for(const w in this._coordsDescendingInv[p])this._coordsDescendingInvStr[p][w]=this._coordsDescendingInv[p][w].map(S=>S.key).sort().join()}}for(const o of this._renderableTiles)for(const h in this._coordsDescendingInvStr){const p=this._coordsDescendingInvStr[h][o.tileID.key];p&&p!==o.rttCoords[h]&&(o.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const r=e.type,o=this.painter,h=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(to[r]&&(this._prevType&&to[this._prevType]||this._stacks.push([]),this._prevType=r,this._stacks[this._stacks.length-1].push(e.id),!h))return!0;if(to[this._prevType]||to[r]&&h){this._prevType=r;const p=this._stacks.length-1,w=this._stacks[p]||[];for(const S of this._renderableTiles){if(this.pool.isFull()&&(Ns(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(S),S.rtt[p]){const M=this.pool.getObjectForId(S.rtt[p].id);if(M.stamp===S.rtt[p].stamp){this.pool.useObject(M);continue}}const P=this.pool.getOrCreateFreeObject();this.pool.useObject(P),this.pool.stampObject(P),S.rtt[p]={id:P.id,stamp:P.stamp},o.context.bindFramebuffer.set(P.fbo.framebuffer),o.context.clear({color:a.aM.transparent,stencil:0}),o.currentStencilSource=void 0;for(let M=0;M<w.length;M++){const R=o.style._layers[w[M]],N=R.source?this._coordsDescendingInv[R.source][S.tileID.key]:[S.tileID];o.context.viewport.set([0,0,P.fbo.width,P.fbo.height]),o._renderTileClippingMasks(R,N),o.renderLayer(o,o.style.sourceCaches[R.source],R,N),R.source&&(S.rttCoords[R.source]=this._coordsDescendingInvStr[R.source][S.tileID.key])}}return Ns(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),to[r]}return!1}}const yc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},vl=C,Vl={hash:!1,interactive:!0,bearingSnap:7,attributionControl:jo,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},io=c=>{c.touchstart=c.dragStart,c.touchmoveWindow=c.dragMove,c.touchend=c.dragEnd},_c={showCompass:!0,showZoom:!0,visualizePitch:!1};class Bc{constructor(e,r,o=!1){this.mousedown=w=>{this.startMouse(a.e({},w,{ctrlKey:!0,preventDefault:()=>w.preventDefault()}),$.mousePos(this.element,w)),$.addEventListener(window,"mousemove",this.mousemove),$.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=w=>{this.moveMouse(w,$.mousePos(this.element,w))},this.mouseup=w=>{this.mouseRotate.dragEnd(w),this.mousePitch&&this.mousePitch.dragEnd(w),this.offTemp()},this.touchstart=w=>{w.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=$.touchPos(this.element,w.targetTouches)[0],this.startTouch(w,this._startPos),$.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.addEventListener(window,"touchend",this.touchend))},this.touchmove=w=>{w.targetTouches.length!==1?this.reset():(this._lastPos=$.touchPos(this.element,w.targetTouches)[0],this.moveTouch(w,this._lastPos))},this.touchend=w=>{w.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const h=e.dragRotate._mouseRotate.getClickTolerance(),p=e.dragRotate._mousePitch.getClickTolerance();this.element=r,this.mouseRotate=Do({clickTolerance:h,enable:!0}),this.touchRotate=(({enable:w,clickTolerance:S,bearingDegreesPerPixelMoved:P=.8})=>{const M=new jl;return new Fr({clickTolerance:S,move:(R,N)=>({bearingDelta:(N.x-R.x)*P}),moveStateManager:M,enable:w,assignEvents:io})})({clickTolerance:h,enable:!0}),this.map=e,o&&(this.mousePitch=ml({clickTolerance:p,enable:!0}),this.touchPitch=(({enable:w,clickTolerance:S,pitchDegreesPerPixelMoved:P=-.5})=>{const M=new jl;return new Fr({clickTolerance:S,move:(R,N)=>({pitchDelta:(N.y-R.y)*P}),moveStateManager:M,enable:w,assignEvents:io})})({clickTolerance:p,enable:!0})),$.addEventListener(r,"mousedown",this.mousedown),$.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),$.addEventListener(r,"touchcancel",this.reset)}startMouse(e,r){this.mouseRotate.dragStart(e,r),this.mousePitch&&this.mousePitch.dragStart(e,r),$.disableDrag()}startTouch(e,r){this.touchRotate.dragStart(e,r),this.touchPitch&&this.touchPitch.dragStart(e,r),$.disableDrag()}moveMouse(e,r){const o=this.map,{bearingDelta:h}=this.mouseRotate.dragMove(e,r)||{};if(h&&o.setBearing(o.getBearing()+h),this.mousePitch){const{pitchDelta:p}=this.mousePitch.dragMove(e,r)||{};p&&o.setPitch(o.getPitch()+p)}}moveTouch(e,r){const o=this.map,{bearingDelta:h}=this.touchRotate.dragMove(e,r)||{};if(h&&o.setBearing(o.getBearing()+h),this.touchPitch){const{pitchDelta:p}=this.touchPitch.dragMove(e,r)||{};p&&o.setPitch(o.getPitch()+p)}}off(){const e=this.element;$.removeEventListener(e,"mousedown",this.mousedown),$.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),$.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.removeEventListener(window,"touchend",this.touchend),$.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){$.enableDrag(),$.removeEventListener(window,"mousemove",this.mousemove),$.removeEventListener(window,"mouseup",this.mouseup),$.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.removeEventListener(window,"touchend",this.touchend)}}let On;function Qi(c,e,r){const o=new a.N(c.lng,c.lat);if(c=new a.N(c.lng,c.lat),e){const h=new a.N(c.lng-360,c.lat),p=new a.N(c.lng+360,c.lat),w=r.locationPoint(c).distSqr(e);r.locationPoint(h).distSqr(e)<w?c=h:r.locationPoint(p).distSqr(e)<w&&(c=p)}for(;Math.abs(c.lng-r.center.lng)>180;){const h=r.locationPoint(c);if(h.x>=0&&h.y>=0&&h.x<=r.width&&h.y<=r.height)break;c.lng>r.center.lng?c.lng-=360:c.lng+=360}return c.lng!==o.lng&&r.locationPoint(c).y>r.height/2-r.getHorizon()?c:o}const qo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ul(c,e,r){const o=c.classList;for(const h in qo)o.remove(`maplibregl-${r}-anchor-${h}`);o.add(`maplibregl-${r}-anchor-${e}`)}class $l extends a.E{constructor(e){if(super(),this._onKeyPress=r=>{const o=r.code,h=r.charCode||r.keyCode;o!=="Space"&&o!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=r=>{const o=r.originalEvent.target,h=this._element;this._popup&&(o===h||h.contains(o))&&this.togglePopup()},this._update=r=>{var o;if(!this._map)return;const h=this._map.loaded()&&!this._map.isMoving();((r==null?void 0:r.type)==="terrain"||(r==null?void 0:r.type)==="render"&&!h)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Qi(this._lngLat,this._flatPos,this._map.transform):(o=this._lngLat)===null||o===void 0?void 0:o.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),$.setTransform(this._element,`${qo[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${w} ${p}`),O.frameAsync(new AbortController).then(()=>{this._updateOpacity(r&&r.type==="moveend")}).catch(()=>{})},this._onMove=r=>{if(!this._isDragging){const o=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=o}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=a.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=$.create("div");const r=$.createNS("http://www.w3.org/2000/svg","svg"),o=41,h=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${o}px`),r.setAttributeNS(null,"width",`${h}px`),r.setAttributeNS(null,"viewBox",`0 0 ${h} ${o}`);const p=$.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"stroke","none"),p.setAttributeNS(null,"stroke-width","1"),p.setAttributeNS(null,"fill","none"),p.setAttributeNS(null,"fill-rule","evenodd");const w=$.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const S=$.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const P=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const oe of P){const he=$.createNS("http://www.w3.org/2000/svg","ellipse");he.setAttributeNS(null,"opacity","0.04"),he.setAttributeNS(null,"cx","10.5"),he.setAttributeNS(null,"cy","5.80029008"),he.setAttributeNS(null,"rx",oe.rx),he.setAttributeNS(null,"ry",oe.ry),S.appendChild(he)}const M=$.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill",this._color);const R=$.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),M.appendChild(R);const N=$.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"opacity","0.25"),N.setAttributeNS(null,"fill","#000000");const W=$.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),N.appendChild(W);const H=$.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(6.0, 7.0)"),H.setAttributeNS(null,"fill","#FFFFFF");const G=$.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(8.0, 8.0)");const K=$.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#000000"),K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962");const se=$.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#FFFFFF"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962"),G.appendChild(K),G.appendChild(se),w.appendChild(S),w.appendChild(M),w.appendChild(N),w.appendChild(H),w.appendChild(G),r.appendChild(w),r.setAttributeNS(null,"height",o*this._scale+"px"),r.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(r),this._offset=a.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",r=>{r.preventDefault()}),this._element.addEventListener("mousedown",r=>{r.preventDefault()}),Ul(this._element,this._anchor,"marker"),e&&e.className)for(const r of e.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),$.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=a.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const h=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var r,o;if(!(!((r=this._map)===null||r===void 0)&&r.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const h=this._map,p=h.terrain.depthAtPoint(this._pos),w=h.terrain.getElevationForLngLatZoom(this._lngLat,h.transform.tileZoom);if(h.transform.lngLatToCameraDepth(this._lngLat,w)-p<.006)return void(this._element.style.opacity=this._opacity);const S=-this._offset.y/h.transform._pixelPerMeter,P=Math.sin(h.getPitch()*Math.PI/180)*S,M=h.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),R=h.transform.lngLatToCameraDepth(this._lngLat,w+P)-M>.006;!((o=this._popup)===null||o===void 0)&&o.isOpen()&&R&&this._popup.remove(),this._element.style.opacity=R?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=a.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,r){return e===void 0&&r===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}const jc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let bl=0,xl=!1;const xs={maxWidth:100,unit:"metric"};function Ea(c,e,r){const o=r&&r.maxWidth||100,h=c._container.clientHeight/2,p=c.unproject([0,h]),w=c.unproject([o,h]),S=p.distanceTo(w);if(r&&r.unit==="imperial"){const P=3.2808*S;P>5280?Wt(e,o,P/5280,c._getUIString("ScaleControl.Miles")):Wt(e,o,P,c._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?Wt(e,o,S/1852,c._getUIString("ScaleControl.NauticalMiles")):S>=1e3?Wt(e,o,S/1e3,c._getUIString("ScaleControl.Kilometers")):Wt(e,o,S,c._getUIString("ScaleControl.Meters"))}function Wt(c,e,r,o){const h=function(p){const w=Math.pow(10,`${Math.floor(p)}`.length-1);let S=p/w;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(P){const M=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*M)/M}(S),w*S}(r);c.style.width=e*(h/r)+"px",c.innerHTML=`${h}&nbsp;${o}`}const hi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},wl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function b(c){if(c){if(typeof c=="number"){const e=Math.round(Math.abs(c)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,c),"top-left":new a.P(e,e),"top-right":new a.P(-e,e),bottom:new a.P(0,-c),"bottom-left":new a.P(e,-e),"bottom-right":new a.P(-e,-e),left:new a.P(c,0),right:new a.P(-c,0)}}if(c instanceof a.P||Array.isArray(c)){const e=a.P.convert(c);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:a.P.convert(c.center||[0,0]),top:a.P.convert(c.top||[0,0]),"top-left":a.P.convert(c["top-left"]||[0,0]),"top-right":a.P.convert(c["top-right"]||[0,0]),bottom:a.P.convert(c.bottom||[0,0]),"bottom-left":a.P.convert(c["bottom-left"]||[0,0]),"bottom-right":a.P.convert(c["bottom-right"]||[0,0]),left:a.P.convert(c.left||[0,0]),right:a.P.convert(c.right||[0,0])}}return b(new a.P(0,0))}const A=C;g.AJAXError=a.bh,g.Evented=a.E,g.LngLat=a.N,g.MercatorCoordinate=a.Z,g.Point=a.P,g.addProtocol=a.bi,g.config=a.a,g.removeProtocol=a.bj,g.AttributionControl=eo,g.BoxZoomHandler=qr,g.CanvasSource=ui,g.CooperativeGesturesHandler=Bo,g.DoubleClickZoomHandler=na,g.DragPanHandler=Rc,g.DragRotateHandler=pc,g.EdgeInsets=gs,g.FullscreenControl=class extends a.E{constructor(c={}){super(),this._onFullscreenChange=()=>{var e;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=r==null?void 0:r.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){$.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const c=this._fullscreenButton=$.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);$.create("span","maplibregl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.title=c}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},g.GeoJSONSource=Bt,g.GeolocateControl=class extends a.E{constructor(c){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const r=new a.N(e.coords.longitude,e.coords.latitude),o=e.coords.accuracy,h=this._map.getBearing(),p=a.e({bearing:h},this.options.fitBoundsOptions),w=te.fromLngLat(r,o);this._map.fitBounds(w,p,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const r=new a.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&xl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=$.create("button","maplibregl-ctrl-geolocate",this._container),$.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=$.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new $l({element:this._dotElement}),this._circleElement=$.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new $l({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")),this.fire(new a.k("userlocationlostfocus")))})}},this.options=a.e({},jc,c)}onAdd(c){return this._map=c,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return a._(this,arguments,void 0,function*(e=!1){if(On!==void 0&&!e)return On;if(window.navigator.permissions===void 0)return On=!!window.navigator.geolocation,On;try{On=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{On=!!window.navigator.geolocation}return On})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),$.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,bl=0,xl=!1}_isOutOfMapMaxBounds(c){const e=this._map.getMaxBounds(),r=c.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const c=this._map.getBounds(),e=c.getSouthEast(),r=c.getNorthEast(),o=e.distanceTo(r),h=Math.ceil(this._accuracy/(o/this._map._container.clientHeight)*2);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":bl--,xl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart")),this.fire(new a.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),bl++,bl>1?(c={maximumAge:6e5,timeout:0},xl=!0):(c=this.options.positionOptions,xl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},g.Hash=Fs,g.ImageSource=Yt,g.KeyboardHandler=Xn,g.LngLatBounds=te,g.LogoControl=Bs,g.Map=class extends Os{constructor(c){a.bf.mark(a.bg.create);const e=Object.assign(Object.assign({},Vl),c);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ds(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Si,this._controls=[],this._mapId=a.a4(),this._contextLost=r=>{r.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:r}))},this._contextRestored=r=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:r}))},this._onMapScroll=r=>{if(r.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},yc),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ze.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ye(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let r=!1;const o=ys(h=>{this._trackResize&&!this._removed&&(this.resize(h),this.redraw())},50);this._resizeObserver=new ResizeObserver(h=>{r?o(h):r=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Rn(this,e),this._hash=e.hash&&new Fs(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,a.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new eo(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new Bs,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new a.k(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new a.k(`${r.dataType}dataloading`,r))}),this.on("dataabort",r=>{this.fire(new a.k("sourcedataabort",r))})}_getMapId(){return this._mapId}addControl(c,e){if(e===void 0&&(e=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=c.onAdd(this);this._controls.push(c);const o=this._controlPositions[e];return e.indexOf("bottom")!==-1?o.insertBefore(r,o.firstChild):o.appendChild(r),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(c);return e>-1&&this._controls.splice(e,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}calculateCameraOptionsFromTo(c,e,r,o){return o==null&&this.terrain&&(o=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(c,e,r,o)}resize(c){var e;const r=this._containerDimensions(),o=r[0],h=r[1],p=this._getClampedPixelRatio(o,h);if(this._resizeCanvas(o,h,p),this.painter.resize(o,h,p),this.painter.overLimit()){const S=this.painter.context.gl;this._maxCanvasSize=[S.drawingBufferWidth,S.drawingBufferHeight];const P=this._getClampedPixelRatio(o,h);this._resizeCanvas(o,h,P),this.painter.resize(o,h,P)}this.transform.resize(o,h),(e=this._requestedCameraState)===null||e===void 0||e.resize(o,h);const w=!this._moving;return w&&(this.stop(),this.fire(new a.k("movestart",c)).fire(new a.k("move",c))),this.fire(new a.k("resize",c)),w&&this.fire(new a.k("moveend",c)),this}_getClampedPixelRatio(c,e){const{0:r,1:o}=this._maxCanvasSize,h=this.getPixelRatio(),p=c*h,w=e*h;return Math.min(p>r?r/p:1,w>o?o/w:1)*h}getPixelRatio(){var c;return(c=this._overridePixelRatio)!==null&&c!==void 0?c:devicePixelRatio}setPixelRatio(c){this._overridePixelRatio=c,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(c){return this.transform.setMaxBounds(te.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c&&this.setZoom(c),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c&&this.setZoom(c),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c&&this.setPitch(c),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c&&this.setPitch(c),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this._update()}project(c){return this.transform.locationPoint(a.N.convert(c),this.style&&this.terrain)}unproject(c){return this.transform.pointLocation(a.P.convert(c),this.terrain)}isMoving(){var c;return this._moving||((c=this.handlers)===null||c===void 0?void 0:c.isMoving())}isZooming(){var c;return this._zooming||((c=this.handlers)===null||c===void 0?void 0:c.isZooming())}isRotating(){var c;return this._rotating||((c=this.handlers)===null||c===void 0?void 0:c.isRotating())}_createDelegatedListener(c,e,r){if(c==="mouseenter"||c==="mouseover"){let o=!1;return{layers:e,listener:r,delegates:{mousemove:p=>{const w=e.filter(P=>this.getLayer(P)),S=w.length!==0?this.queryRenderedFeatures(p.point,{layers:w}):[];S.length?o||(o=!0,r.call(this,new zi(c,this,p.originalEvent,{features:S}))):o=!1},mouseout:()=>{o=!1}}}}if(c==="mouseleave"||c==="mouseout"){let o=!1;return{layers:e,listener:r,delegates:{mousemove:w=>{const S=e.filter(P=>this.getLayer(P));(S.length!==0?this.queryRenderedFeatures(w.point,{layers:S}):[]).length?o=!0:o&&(o=!1,r.call(this,new zi(c,this,w.originalEvent)))},mouseout:w=>{o&&(o=!1,r.call(this,new zi(c,this,w.originalEvent)))}}}}{const o=h=>{const p=e.filter(S=>this.getLayer(S)),w=p.length!==0?this.queryRenderedFeatures(h.point,{layers:p}):[];w.length&&(h.features=w,r.call(this,h),delete h.features)};return{layers:e,listener:r,delegates:{[c]:o}}}}_saveDelegatedListener(c,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(e)}_removeDelegatedListener(c,e,r){if(!this._delegatedListeners||!this._delegatedListeners[c])return;const o=this._delegatedListeners[c];for(let h=0;h<o.length;h++){const p=o[h];if(p.listener===r&&p.layers.length===e.length&&p.layers.every(w=>e.includes(w))){for(const w in p.delegates)this.off(w,p.delegates[w]);return void o.splice(h,1)}}}on(c,e,r){if(r===void 0)return super.on(c,e);const o=this._createDelegatedListener(c,typeof e=="string"?[e]:e,r);this._saveDelegatedListener(c,o);for(const h in o.delegates)this.on(h,o.delegates[h]);return this}once(c,e,r){if(r===void 0)return super.once(c,e);const o=typeof e=="string"?[e]:e,h=this._createDelegatedListener(c,o,r);for(const p in h.delegates){const w=h.delegates[p];h.delegates[p]=(...S)=>{this._removeDelegatedListener(c,o,r),w(...S)}}this._saveDelegatedListener(c,h);for(const p in h.delegates)this.once(p,h.delegates[p]);return this}off(c,e,r){return r===void 0?super.off(c,e):(this._removeDelegatedListener(c,typeof e=="string"?[e]:e,r),this)}queryRenderedFeatures(c,e){if(!this.style)return[];let r;const o=c instanceof a.P||Array.isArray(c),h=o?c:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(o?{}:c)||{},h instanceof a.P||typeof h[0]=="number")r=[a.P.convert(h)];else{const p=a.P.convert(h[0]),w=a.P.convert(h[1]);r=[p,new a.P(w.x,p.y),w,new a.P(p.x,w.y),p]}return this.style.queryRenderedFeatures(r,e,this.transform)}querySourceFeatures(c,e){return this.style.querySourceFeatures(c,e)}setStyle(c,e){return(e=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&c?(this._diffStyle(c,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(c,e))}setTransformRequest(c){return this._requestManager.setTransformRequest(c),this}_getUIString(c){const e=this._locale[c];if(e==null)throw new Error(`Missing UI string '${c}'`);return e}_updateStyle(c,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(c,e));const r=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!c)),c?(this.style=new Zr(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c,e,r):this.style.loadJSON(c,e,r),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Zr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,e){if(typeof c=="string"){const r=this._requestManager.transformRequest(c,"Style");a.h(r,new AbortController).then(o=>{this._updateDiff(o.data,e)}).catch(o=>{o&&this.fire(new a.j(o))})}else typeof c=="object"&&this._updateDiff(c,e)}_updateDiff(c,e){try{this.style.setState(c,e)&&this._update(!0)}catch(r){a.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(c,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(c,e){return this._lazyInitEmptyStyle(),this.style.addSource(c,e),this._update(!0)}isSourceLoaded(c){const e=this.style&&this.style.sourceCaches[c];if(e!==void 0)return e.loaded();this.fire(new a.j(new Error(`There is no source with ID '${c}'`)))}setTerrain(c){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),c){const e=this.style.sourceCaches[c.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${c.source}`);this.terrain===null&&e.reload();for(const r in this.style._layers){const o=this.style._layers[r];o.type==="hillshade"&&o.source===c.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ql(this.painter,e,c),this.painter.renderToTexture=new gc(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=r=>{r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==c.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:c})),this}getTerrain(){var c,e;return(e=(c=this.terrain)===null||c===void 0?void 0:c.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const c=this.style&&this.style.sourceCaches;for(const e in c){const r=c[e]._tiles;for(const o in r){const h=r[o];if(h.state!=="loaded"&&h.state!=="errored")return!1}}return!0}removeSource(c){return this.style.removeSource(c),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,e,r={}){const{pixelRatio:o=1,sdf:h=!1,stretchX:p,stretchY:w,content:S,textFitWidth:P,textFitHeight:M}=r;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||a.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:R,height:N,data:W}=e,H=e;return this.style.addImage(c,{data:new a.R({width:R,height:N},new Uint8Array(W)),pixelRatio:o,stretchX:p,stretchY:w,content:S,textFitWidth:P,textFitHeight:M,sdf:h,version:0,userImage:H}),H.onAdd&&H.onAdd(this,c),this}}{const{width:R,height:N,data:W}=O.getImageData(e);this.style.addImage(c,{data:new a.R({width:R,height:N},W),pixelRatio:o,stretchX:p,stretchY:w,content:S,textFitWidth:P,textFitHeight:M,sdf:h,version:0})}}updateImage(c,e){const r=this.style.getImage(c);if(!r)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const o=e instanceof HTMLImageElement||a.b(e)?O.getImageData(e):e,{width:h,height:p,data:w}=o;if(h===void 0||p===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==r.data.width||p!==r.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(e instanceof HTMLImageElement||a.b(e));return r.data.replace(w,S),this.style.updateImage(c,r),this}getImage(c){return this.style.getImage(c)}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c){return ze.getImage(this._requestManager.transformRequest(c,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(c,e){return this._lazyInitEmptyStyle(),this.style.addLayer(c,e),this._update(!0)}moveLayer(c,e){return this.style.moveLayer(c,e),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(c,e,r){return this.style.setLayerZoomRange(c,e,r),this._update(!0)}setFilter(c,e,r={}){return this.style.setFilter(c,e,r),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,e,r,o={}){return this.style.setPaintProperty(c,e,r,o),this._update(!0)}getPaintProperty(c,e){return this.style.getPaintProperty(c,e)}setLayoutProperty(c,e,r,o={}){return this.style.setLayoutProperty(c,e,r,o),this._update(!0)}getLayoutProperty(c,e){return this.style.getLayoutProperty(c,e)}setGlyphs(c,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(c,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(c,e,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(c,e,r,o=>{o||this._update(!0)}),this}removeSprite(c){return this._lazyInitEmptyStyle(),this.style.removeSprite(c),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(c,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(c,e,r=>{r||this._update(!0)}),this}setLight(c,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(c){return this._lazyInitEmptyStyle(),this.style.setSky(c),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(c,e){return this.style.setFeatureState(c,e),this._update()}removeFeatureState(c,e){return this.style.removeFeatureState(c,e),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let c=0,e=0;return this._container&&(c=this._container.clientWidth||400,e=this._container.clientHeight||300),[c,e]}_setupContainer(){const c=this._container;c.classList.add("maplibregl-map");const e=this._canvasContainer=$.create("div","maplibregl-canvas-container",c);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=$.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),o=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],o);const h=this._controlContainer=$.create("div","maplibregl-control-container",c),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{p[w]=$.create("div",`maplibregl-ctrl-${w} `,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,e,r){this._canvas.width=Math.floor(r*c),this._canvas.height=Math.floor(r*e),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const c={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",o=>{e={requestedAttributes:c},o&&(e.statusMessage=o.statusMessage,e.type=o.type)},{once:!0});const r=this._canvas.getContext("webgl2",c)||this._canvas.getContext("webgl",c);if(!r){const o="Failed to initialize WebGL";throw e?(e.message=o,new Error(JSON.stringify(e))):new Error(o)}this.painter=new La(r,this.transform),V.testSupport(r)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_render(c){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(c),this._removed)return;let r=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const h=this.transform.zoom,p=O.now();this.style.zoomHistory.update(h,p);const w=new a.z(h,{now:p,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),S=w.crossFadingFactor();S===1&&S===this._crossFadingFactor||(r=!0,this._crossFadingFactor=S),this.style.update(w)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bf.mark(a.bg.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||r)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const o=this._sourcesDirty||this._styleDirty||this._placementDirty;return o||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||o||(this._fullyLoaded=!0,a.bf.mark(a.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var c;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ze.removeThrottleControl(this._imageQueueHandle),(c=this._resizeObserver)===null||c===void 0||c.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),$.remove(this._canvasContainer),$.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bf.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,O.frameAsync(this._frameRequest).then(c=>{a.bf.frame(c),this._frameRequest=null,this._render(c)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get version(){return vl}getCameraTargetElevation(){return this.transform.elevation}},g.MapMouseEvent=zi,g.MapTouchEvent=Zi,g.MapWheelEvent=Ir,g.Marker=$l,g.NavigationControl=class{constructor(c){this._updateZoomButtons=()=>{const e=this._map.getZoom(),r=e===this._map.getMaxZoom(),o=e===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,r)=>{const o=this._map._getUIString(`NavigationControl.${r}`);e.title=o,e.setAttribute("aria-label",o)},this.options=a.e({},_c,c),this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),$.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),$.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=$.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Bc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){$.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(c,e){const r=$.create("button",c,this._container);return r.type="button",r.addEventListener("click",e),r}},g.Popup=class extends a.E{constructor(c){super(),this.remove=()=>(this._content&&$.remove(this._content),this._container&&($.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var r;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=$.create("div","maplibregl-popup",this._map.getContainer()),this._tip=$.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const S of this.options.className.split(" "))this._container.classList.add(S);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Qi(this._lngLat,this._flatPos,this._map.transform):(r=this._lngLat)===null||r===void 0?void 0:r.wrap(),this._trackPointer&&!e)return;const o=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let h=this.options.anchor;const p=b(this.options.offset);if(!h){const S=this._container.offsetWidth,P=this._container.offsetHeight;let M;M=o.y+p.bottom.y<P?["top"]:o.y>this._map.transform.height-P?["bottom"]:[],o.x<S/2?M.push("left"):o.x>this._map.transform.width-S/2&&M.push("right"),h=M.length===0?"bottom":M.join("-")}let w=o.add(p[h]);this.options.subpixelPositioning||(w=w.round()),$.setTransform(this._container,`${qo[h]} translate(${w.x}px,${w.y}px)`),Ul(this._container,h,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(hi),c)}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=a.N.convert(c),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){const e=document.createDocumentFragment(),r=document.createElement("body");let o;for(r.innerHTML=c;o=r.firstChild,o;)e.appendChild(o);return this.setDOMContent(e)}getMaxWidth(){var c;return(c=this._container)===null||c===void 0?void 0:c.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=$.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(c){return this._container&&this._container.classList.add(c),this}removeClassName(c){return this._container&&this._container.classList.remove(c),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){if(this._container)return this._container.classList.toggle(c)}setSubpixelPositioning(c){this.options.subpixelPositioning=c}_createCloseButton(){this.options.closeButton&&(this._closeButton=$.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(wl);c&&c.focus()}},g.RasterDEMTileSource=Pt,g.RasterTileSource=ft,g.ScaleControl=class{constructor(c){this._onMove=()=>{Ea(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Ea(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},xs),c)}getDefaultPosition(){return"bottom-left"}onAdd(c){return this._map=c,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){$.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},g.ScrollZoomHandler=Fn,g.Style=Zr,g.TerrainControl=class{constructor(c){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=c}onAdd(c){return this._map=c,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=$.create("button","maplibregl-ctrl-terrain",this._container),$.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){$.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},g.TwoFingersTouchPitchHandler=Oo,g.TwoFingersTouchRotateHandler=uc,g.TwoFingersTouchZoomHandler=gl,g.TwoFingersTouchZoomRotateHandler=fc,g.VectorTileSource=Ht,g.VideoSource=ii,g.addSourceType=(c,e)=>a._(void 0,void 0,void 0,function*(){if(Ni(c))throw new Error(`A source type called "${c}" already exists.`);((r,o)=>{Pi[r]=o})(c,e)}),g.clearPrewarmedResources=function(){const c=$e;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(ke),$e=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},g.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},g.getRTLTextPluginStatus=function(){return Rt().getRTLTextPluginStatus()},g.getVersion=function(){return A},g.getWorkerCount=function(){return Fe.workerCount},g.getWorkerUrl=function(){return a.a.WORKER_URL},g.importScriptInWorkers=function(c){return kt().broadcast("IS",c)},g.prewarm=function(){tt().acquire(ke)},g.setMaxParallelImageRequests=function(c){a.a.MAX_PARALLEL_IMAGE_REQUESTS=c},g.setRTLTextPlugin=function(c,e){return Rt().setRTLTextPlugin(c,e)},g.setWorkerCount=function(c){Fe.workerCount=c},g.setWorkerUrl=function(c){a.a.WORKER_URL=c}});var _=u;return _})})(fg);var gg=fg.exports;const ah=r_(gg);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function jd(d,s,u,f){return new(u||(u=Promise))(function(y,_){function g(F){try{C(f.next(F))}catch(U){_(U)}}function a(F){try{C(f.throw(F))}catch(U){_(U)}}function C(F){F.done?y(F.value):new u(function(U){U(F.value)}).then(g,a)}C((f=f.apply(d,s||[])).next())})}var Yh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Hu(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var yg=s_,n_=Object.prototype.hasOwnProperty;function s_(){for(var d={},s=0;s<arguments.length;s++){var u=arguments[s];for(var f in u)n_.call(u,f)&&(d[f]=u[f])}return d}var ao=Hu(yg),_g={exports:{}};(function(d,s){(function(){var u={};d.exports=u,u.simpleFilter=function(f,y){return y.filter(function(_){return u.test(f,_)})},u.test=function(f,y){return u.match(f,y)!==null},u.match=function(f,y,_){_=_||{};var g=0,a=[],C=y.length,F=0,U=0,O=_.pre||"",$=_.post||"",V=_.caseSensitive&&y||y.toLowerCase(),ye;f=_.caseSensitive&&f||f.toLowerCase();for(var de=0;de<C;de++)ye=y[de],V[de]===f[g]?(ye=O+ye+$,g+=1,U+=1+U):U=0,F+=U,a[a.length]=ye;return g===f.length?(F=V===f?1/0:F,{rendered:a.join(""),score:F}):null},u.filter=function(f,y,_){return!y||y.length===0?[]:typeof f!="string"?y:(_=_||{},y.reduce(function(g,a,C,F){var U=a;_.extract&&(U=_.extract(a));var O=u.match(f,U,_);return O!=null&&(g[g.length]={string:O.rendered,score:O.score,index:C,original:a}),g},[]).sort(function(g,a){var C=a.score-g.score;return C||g.index-a.index}))}})()})(_g);var a_=_g.exports,Gs=function(d){return this.component=d,this.items=[],this.active=d.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,d.el.parentNode.insertBefore(this.wrapper,d.el.nextSibling),this};Gs.prototype.show=function(){this.element.style.display="block"};Gs.prototype.hide=function(){this.element.style.display="none"};Gs.prototype.add=function(d){this.items.push(d)};Gs.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0};Gs.prototype.isEmpty=function(){return!this.items.length};Gs.prototype.isVisible=function(){return this.element.style.display==="block"};Gs.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var d=0;d<this.items.length;d++)this.drawItem(this.items[d],this.active===d);this.show()};Gs.prototype.drawItem=function(d,s){var u=document.createElement("li"),f=document.createElement("a");s&&(u.className+=" active"),f.innerHTML=d.string,u.appendChild(f),this.element.appendChild(u),u.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),u.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,d)}).bind(this))};Gs.prototype.handleMouseUp=function(d){this.selectingListItem=!1,this.component.value(d.original),this.clear(),this.draw()};Gs.prototype.move=function(d){this.active=d,this.draw()};Gs.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)};Gs.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)};Gs.prototype.drawError=function(d){var s=document.createElement("li");s.innerHTML=d,this.element.appendChild(s),this.show()};var o_=Gs,l_=yg,c_=a_,h_=o_,os=function(d,s,u){return u=u||{},this.options=l_({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},u),this.el=d,this.data=s||[],this.list=new h_(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(f){this.handleKeyUp(f.keyCode,f)}).bind(this),!1),this.el.addEventListener("keydown",(function(f){this.handleKeyDown(f)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(f){this.handlePaste(f)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};os.prototype.handleKeyUp=function(d,s){if(!(d===40||d===38||d===27||d===9)){if(d===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),s.stopPropagation());return}this.handleInputChange(this.el.value)}};os.prototype.handleKeyDown=function(d){switch(d.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&d.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};os.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};os.prototype.handlePaste=function(d){if(d.clipboardData)this.handleInputChange(d.clipboardData.getData("Text"));else{var s=this;setTimeout(function(){s.handleInputChange(d.target.value)},100)}};os.prototype.handleInputChange=function(d){if(this.query=this.normalize(d),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(s){for(var u=0;u<s.length&&(this.list.add(s[u]),u!==this.options.limit-1);u++);this.list.draw()}).bind(this))};os.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};os.prototype.update=function(d){this.data=d,this.handleKeyUp()};os.prototype.clear=function(){this.data=[],this.list.clear()};os.prototype.normalize=function(d){return d=d.toLowerCase(),d};os.prototype.match=function(d,s){return d.indexOf(s)>-1};os.prototype.value=function(d){if(this.selected=d,this.el.value=this.getItemValue(d||{place_name:this.query}),document.createEvent){var s=document.createEvent("HTMLEvents");s.initEvent("change",!0,!1),this.el.dispatchEvent(s)}else this.el.fireEvent("onchange")};os.prototype.getCandidates=function(d){var s={pre:"<strong>",post:"</strong>",extract:(function(f){return this.getItemValue(f)}).bind(this)},u;this.options.filter?(u=c_.filter(this.query,this.data,s),u=u.map((function(f){return{original:f.original,string:this.render(f.original,f.string)}}).bind(this))):u=this.data.map((function(f){var y=this.render(f);return{original:f,string:y}}).bind(this)),d(u)};os.prototype.getItemValue=function(d){return d};os.prototype.render=function(d,s){if(s)return s;for(var u=d.original?this.getItemValue(d.original):this.getItemValue(d),f=this.normalize(u),y=f.lastIndexOf(this.query);y>-1;){var _=y+this.query.length;u=u.slice(0,y)+"<strong>"+u.slice(y,_)+"</strong>"+u.slice(_),y=f.slice(0,y).lastIndexOf(this.query)}return u};os.prototype.renderError=function(d){this.list.drawError(d)};var u_=os,vg=u_,d_=vg;typeof window<"u"&&(window.Suggestions=vg);var p_=Hu(d_),bg={exports:{}};(function(d){(function(s,u,f){d.exports?d.exports=f():s[u]=f()})(Yh,"subtag",function(){var s="",u=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function f(C){return C.match(u)||[]}function y(C){return f(C).filter(function(F,U){return F&&U})}function _(C){return C=f(C),{language:C[1]||s,extlang:C[2]||s,script:C[3]||s,region:C[4]||s}}function g(C,F,U){Object.defineProperty(C,F,{value:U,enumerable:!0})}function a(C,F,U){function O($){return f($)[C]||s}g(O,"pattern",F),g(_,U,O)}return a(1,/^[a-zA-Z]{2,3}$/,"language"),a(2,/^[a-zA-Z]{3}$/,"extlang"),a(3,/^[a-zA-Z]{4}$/,"script"),a(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),g(_,"split",y),_})})(bg);var f_=bg.exports,m_=Hu(f_),g_="Expected a function",Pm=NaN,y_="[object Symbol]",__=/^\s+|\s+$/g,v_=/^[-+]0x[0-9a-f]+$/i,b_=/^0b[01]+$/i,x_=/^0o[0-7]+$/i,w_=parseInt,S_=typeof Yh=="object"&&Yh&&Yh.Object===Object&&Yh,A_=typeof self=="object"&&self&&self.Object===Object&&self,I_=S_||A_||Function("return this")(),P_=Object.prototype,L_=P_.toString,k_=Math.max,T_=Math.min,qd=function(){return I_.Date.now()};function C_(d,s,u){var f,y,_,g,a,C,F=0,U=!1,O=!1,$=!0;if(typeof d!="function")throw new TypeError(g_);s=Lm(s)||0,ip(u)&&(U=!!u.leading,O="maxWait"in u,_=O?k_(Lm(u.maxWait)||0,s):_,$="trailing"in u?!!u.trailing:$);function V(ct){var Ge=f,De=y;return f=y=void 0,F=ct,g=d.apply(De,Ge),g}function ye(ct){return F=ct,a=setTimeout(ue,s),U?V(ct):g}function de(ct){var Ge=ct-C,De=ct-F,Qe=s-Ge;return O?T_(Qe,_-De):Qe}function Pe(ct){var Ge=ct-C,De=ct-F;return C===void 0||Ge>=s||Ge<0||O&&De>=_}function ue(){var ct=qd();if(Pe(ct))return Se(ct);a=setTimeout(ue,de(ct))}function Se(ct){return a=void 0,$&&f?V(ct):(f=y=void 0,g)}function ze(){a!==void 0&&clearTimeout(a),F=0,f=C=y=a=void 0}function Ye(){return a===void 0?g:Se(qd())}function Je(){var ct=qd(),Ge=Pe(ct);if(f=arguments,y=this,C=ct,Ge){if(a===void 0)return ye(C);if(O)return a=setTimeout(ue,s),V(C)}return a===void 0&&(a=setTimeout(ue,s)),g}return Je.cancel=ze,Je.flush=Ye,Je}function ip(d){var s=typeof d;return!!d&&(s=="object"||s=="function")}function E_(d){return!!d&&typeof d=="object"}function M_(d){return typeof d=="symbol"||E_(d)&&L_.call(d)==y_}function Lm(d){if(typeof d=="number")return d;if(M_(d))return Pm;if(ip(d)){var s=typeof d.valueOf=="function"?d.valueOf():d;d=ip(s)?s+"":s}if(typeof d!="string")return d===0?d:+d;d=d.replace(__,"");var u=b_.test(d);return u||x_.test(d)?w_(d.slice(2),u?2:8):v_.test(d)?Pm:+d}var z_=C_,N_=Hu(z_),Ip={exports:{}},ph=typeof Reflect=="object"?Reflect:null,km=ph&&typeof ph.apply=="function"?ph.apply:function(s,u,f){return Function.prototype.apply.call(s,u,f)},Nu;ph&&typeof ph.ownKeys=="function"?Nu=ph.ownKeys:Object.getOwnPropertySymbols?Nu=function(s){return Object.getOwnPropertyNames(s).concat(Object.getOwnPropertySymbols(s))}:Nu=function(s){return Object.getOwnPropertyNames(s)};function D_(d){console&&console.warn&&console.warn(d)}var xg=Number.isNaN||function(s){return s!==s};function _r(){_r.init.call(this)}Ip.exports=_r;Ip.exports.once=B_;_r.EventEmitter=_r;_r.prototype._events=void 0;_r.prototype._eventsCount=0;_r.prototype._maxListeners=void 0;var Tm=10;function Xu(d){if(typeof d!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof d)}Object.defineProperty(_r,"defaultMaxListeners",{enumerable:!0,get:function(){return Tm},set:function(d){if(typeof d!="number"||d<0||xg(d))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+d+".");Tm=d}});_r.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};_r.prototype.setMaxListeners=function(s){if(typeof s!="number"||s<0||xg(s))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+s+".");return this._maxListeners=s,this};function wg(d){return d._maxListeners===void 0?_r.defaultMaxListeners:d._maxListeners}_r.prototype.getMaxListeners=function(){return wg(this)};_r.prototype.emit=function(s){for(var u=[],f=1;f<arguments.length;f++)u.push(arguments[f]);var y=s==="error",_=this._events;if(_!==void 0)y=y&&_.error===void 0;else if(!y)return!1;if(y){var g;if(u.length>0&&(g=u[0]),g instanceof Error)throw g;var a=new Error("Unhandled error."+(g?" ("+g.message+")":""));throw a.context=g,a}var C=_[s];if(C===void 0)return!1;if(typeof C=="function")km(C,this,u);else for(var F=C.length,U=Lg(C,F),f=0;f<F;++f)km(U[f],this,u);return!0};function Sg(d,s,u,f){var y,_,g;if(Xu(u),_=d._events,_===void 0?(_=d._events=Object.create(null),d._eventsCount=0):(_.newListener!==void 0&&(d.emit("newListener",s,u.listener?u.listener:u),_=d._events),g=_[s]),g===void 0)g=_[s]=u,++d._eventsCount;else if(typeof g=="function"?g=_[s]=f?[u,g]:[g,u]:f?g.unshift(u):g.push(u),y=wg(d),y>0&&g.length>y&&!g.warned){g.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+g.length+" "+String(s)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=d,a.type=s,a.count=g.length,D_(a)}return d}_r.prototype.addListener=function(s,u){return Sg(this,s,u,!1)};_r.prototype.on=_r.prototype.addListener;_r.prototype.prependListener=function(s,u){return Sg(this,s,u,!0)};function F_(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ag(d,s,u){var f={fired:!1,wrapFn:void 0,target:d,type:s,listener:u},y=F_.bind(f);return y.listener=u,f.wrapFn=y,y}_r.prototype.once=function(s,u){return Xu(u),this.on(s,Ag(this,s,u)),this};_r.prototype.prependOnceListener=function(s,u){return Xu(u),this.prependListener(s,Ag(this,s,u)),this};_r.prototype.removeListener=function(s,u){var f,y,_,g,a;if(Xu(u),y=this._events,y===void 0)return this;if(f=y[s],f===void 0)return this;if(f===u||f.listener===u)--this._eventsCount===0?this._events=Object.create(null):(delete y[s],y.removeListener&&this.emit("removeListener",s,f.listener||u));else if(typeof f!="function"){for(_=-1,g=f.length-1;g>=0;g--)if(f[g]===u||f[g].listener===u){a=f[g].listener,_=g;break}if(_<0)return this;_===0?f.shift():R_(f,_),f.length===1&&(y[s]=f[0]),y.removeListener!==void 0&&this.emit("removeListener",s,a||u)}return this};_r.prototype.off=_r.prototype.removeListener;_r.prototype.removeAllListeners=function(s){var u,f,y;if(f=this._events,f===void 0)return this;if(f.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):f[s]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete f[s]),this;if(arguments.length===0){var _=Object.keys(f),g;for(y=0;y<_.length;++y)g=_[y],g!=="removeListener"&&this.removeAllListeners(g);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(u=f[s],typeof u=="function")this.removeListener(s,u);else if(u!==void 0)for(y=u.length-1;y>=0;y--)this.removeListener(s,u[y]);return this};function Ig(d,s,u){var f=d._events;if(f===void 0)return[];var y=f[s];return y===void 0?[]:typeof y=="function"?u?[y.listener||y]:[y]:u?O_(y):Lg(y,y.length)}_r.prototype.listeners=function(s){return Ig(this,s,!0)};_r.prototype.rawListeners=function(s){return Ig(this,s,!1)};_r.listenerCount=function(d,s){return typeof d.listenerCount=="function"?d.listenerCount(s):Pg.call(d,s)};_r.prototype.listenerCount=Pg;function Pg(d){var s=this._events;if(s!==void 0){var u=s[d];if(typeof u=="function")return 1;if(u!==void 0)return u.length}return 0}_r.prototype.eventNames=function(){return this._eventsCount>0?Nu(this._events):[]};function Lg(d,s){for(var u=new Array(s),f=0;f<s;++f)u[f]=d[f];return u}function R_(d,s){for(;s+1<d.length;s++)d[s]=d[s+1];d.pop()}function O_(d){for(var s=new Array(d.length),u=0;u<s.length;++u)s[u]=d[u].listener||d[u];return s}function B_(d,s){return new Promise(function(u,f){function y(g){d.removeListener(s,_),f(g)}function _(){typeof d.removeListener=="function"&&d.removeListener("error",y),u([].slice.call(arguments))}kg(d,s,_,{once:!0}),s!=="error"&&j_(d,y,{once:!0})})}function j_(d,s,u){typeof d.on=="function"&&kg(d,"error",s,u)}function kg(d,s,u,f){if(typeof d.on=="function")f.once?d.once(s,u):d.on(s,u);else if(typeof d.addEventListener=="function")d.addEventListener(s,function y(_){f.once&&d.removeEventListener(s,y),u(_)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof d)}var q_=Ip.exports;const Cm={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},V_={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},U_=/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/;class $_{constructor(s,u){this.options={zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:void 0,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:f=>f.text!==void 0?f.text:f.place_name,render:function(f){if(!f.geometry){const _=f.text,g=_.toLowerCase().indexOf(this.query.toLowerCase()),a=this.query.length,C=_.substring(0,g),F=_.substring(g,g+a),U=_.substring(g+a);return'<div class="maplibregl-ctrl-geocoder--suggestion"><svg class="maplibregl-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="maplibregl-ctrl-geocoder--suggestion-info"><div class="maplibregl-ctrl-geocoder--suggestion-title">'+C+'<span class="maplibregl-ctrl-geocoder--suggestion-match">'+F+"</span>"+U+"</div></div></div>"}const y=f.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--result"><svg class="maplibregl-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="maplibregl-ctrl-geocoder--result-title">'+y[0]+'</div><div class="maplibregl-ctrl-geocoder--result-address">'+y.splice(1,y.length).join(",")+"</div></div></div>"},popupRender:f=>{const y=f.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--suggestion popup-suggestion"><div class="maplibregl-ctrl-geocoder--suggestion-title popup-suggestion-title">'+y[0]+'</div><div class="maplibregl-ctrl-geocoder--suggestion-address popup-suggestion-address">'+y.splice(1,y.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},this._eventEmitter=new q_.EventEmitter,this.options=ao({},this.options,u),this.fresh=!0,this.lastSelected=null,this.geocoderApi=s}addTo(s){function u(f,y){if(!document.body.contains(y))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const _=f.onAdd();y.appendChild(_)}if(s instanceof HTMLElement)u(this,s);else if(typeof s=="string"){const f=document.querySelectorAll(s);if(f.length===0)throw new Error("Element "+s+"not found.");if(f.length>1)throw new Error("Geocoder can only be added to a single html element");u(this,f[0])}else if("addControl"in s)s.addControl(this);else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")}onAdd(s){if(s&&typeof s!="string"&&(this._map=s),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);const u=this.container=document.createElement("div");u.className="maplibregl-ctrl-geocoder maplibregl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";const f=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",N_(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);const y=document.createElement("div");y.classList.add("maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("type","button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="maplibregl-ctrl-geocoder--button";const _=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(_),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),y.appendChild(this._clearEl),y.appendChild(this._loadingEl),u.appendChild(f),u.appendChild(this._inputEl),u.appendChild(y),this._typeahead=new p_(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),u}createIcon(s,u){const f=document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.setAttribute("class","maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+s),f.setAttribute("viewBox","0 0 18 18"),f.setAttribute("xml:space","preserve"),f.setAttribute("width","18"),f.setAttribute("height","18"),"innerHTML"in f)f.innerHTML=u;else{const y=document.createElement("div");y.innerHTML="<svg>"+u.valueOf().toString()+"</svg>";const _=y.firstChild,g=_.firstChild;f.appendChild(g)}return f}onRemove(){return this.container.remove(),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this}_onPaste(s){const u=(s.clipboardData||window.clipboardData).getData("text");u.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(u)}_onKeyDown(s){if(s.keyCode===27&&this.options.clearAndBlurOnEsc)return this._clear(s),this._inputEl.blur();const _=s.target&&s.target.shadowRoot?s.target.shadowRoot.activeElement:s.target;if(!(_?_.value:""))return this.fresh=!0,s.keyCode!==9&&this.clear(s),this._clearEl.style.display="none";if(!(s.metaKey||[9,27,37,39,38,40].indexOf(s.keyCode)!==-1)){if(s.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(_.value);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(_.value,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}_.value.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(_.value)}}_showButton(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")}_hideButton(){this._typeahead.selected&&(this._clearEl.style.display="none")}_onBlur(s){this.options.clearOnBlur&&this._clearOnBlur(s),this.options.collapsed&&this._collapse()}_onChange(){const s=this._typeahead.selected;if(s&&!s.geometry)s.placeId?this._geocode(s.placeId,!0,!0):this._geocode(s.text,!0);else if(s&&JSON.stringify(s)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){let u;if(this._removeResultMarkers(),s.properties&&Cm[s.properties.short_code])u=ao({},this.options.flyTo),this._map&&this._map.fitBounds(Cm[s.properties.short_code].bbox,u);else if(s.bbox){const f=s.bbox;u=ao({},this.options.flyTo),this._map&&this._map.fitBounds([[f[0],f[1]],[f[2],f[3]]],u)}else{const f={zoom:this.options.zoom};u=ao({},f,this.options.flyTo),s.center?u.center=s.center:s.geometry&&s.geometry.type&&s.geometry.type==="Point"&&s.geometry.coordinates&&(u.center=s.geometry.coordinates),this._map&&this._map.flyTo(u)}}this.options.marker&&this._maplibregl&&this._handleMarker(s),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(s),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:s})}}_getConfigForRequest(){return["bbox","limit","proximity","countries","types","language","reverseMode"].reduce((f,y)=>(this.options[y]&&(["countries","types","language"].indexOf(y)>-1?f[y]=this.options[y].split(/[\s,]+/):f[y]=this.options[y],y==="proximity"&&this.options[y]&&typeof this.options[y].longitude=="number"&&typeof this.options[y].latitude=="number"&&(f[y]=[this.options[y].longitude,this.options[y].latitude])),f),{})}_geocode(s){return jd(this,arguments,void 0,function*(u,f=!1,y=!1){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:u});const _=this._getConfigForRequest(),g=this._createGeocodeRequest(_,u,f,y),a=this.options.localGeocoder?this.options.localGeocoder(u)||[]:[];try{const C=yield g;yield this._handleGeocodeResponse(C,_,u,f,a)}catch(C){this._handleGeocodeErrorResponse(C,a)}return g})}_createGeocodeRequest(s,u,f,y){return this.options.localGeocoderOnly?Promise.resolve({}):this.options.reverseGeocode&&U_.test(u)?this._createReverseGeocodeRequest(u,s):(s.query=u,this.geocoderApi.getSuggestions?f?this.geocoderApi.searchByPlaceId&&y?this.geocoderApi.searchByPlaceId(s):this.geocoderApi.forwardGeocode(s):this.geocoderApi.getSuggestions(s):this.geocoderApi.forwardGeocode(s))}_createReverseGeocodeRequest(s,u){const f=s.split(/[\s(,)?]+/).map(y=>parseFloat(y)).reverse();return u.query=f,u.limit=1,"proximity"in u&&delete u.proximity,this.geocoderApi.reverseGeocode(u)}_handleGeocodeResponse(s,u,f,y,_){return jd(this,void 0,void 0,function*(){this._loadingEl.style.display="none";let g={};s?g=s:g={type:"FeatureCollection",features:[]},g.config=u,this.fresh&&(this.fresh=!1),g.features=g.features?_.concat(g.features):_;const a=this.options.externalGeocoder?this.options.externalGeocoder(f,g.features,u)||Promise.resolve([]):Promise.resolve([]);try{const F=yield a;g.features=g.features?F.concat(g.features):F}catch{}this.options.filter&&g.features.length&&(g.features=g.features.filter(this.options.filter));let C=[];"suggestions"in g?C=g.suggestions:"place"in g?C=[g.place]:C=g.features,C.length?(this._clearEl.style.display="block",this._typeahead.update(C),(!this.options.showResultsWhileTyping||y)&&this.options.showResultMarkers&&(g.features.length>0||"place"in g)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",g)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",g))})}_handleGeocodeErrorResponse(s,u){this._loadingEl.style.display="none",u.length&&this.options.localGeocoder?(this._clearEl.style.display="block",this._typeahead.update(u)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:u}),this._eventEmitter.emit("error",{error:s})}_clear(s){s&&s.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0}clear(s){this._clear(s),this._inputEl.focus()}_clearOnBlur(s){s.relatedTarget&&this._clear(s)}_onQueryResult(s){if(!("features"in s)||!s.features.length)return;const u=s.features[0];this._typeahead.selected=u,this._inputEl.value=u.place_name,this._onChange()}_updateProximity(){if(this._map)if(this._map.getZoom()>9){const s=this._map.getCenter().wrap();this.setProximity({longitude:s.lng,latitude:s.lat})}else this.setProximity(null)}_collapse(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("maplibregl-ctrl-geocoder--collapsed")}_unCollapse(){this.container.classList.remove("maplibregl-ctrl-geocoder--collapsed")}query(s){return jd(this,void 0,void 0,function*(){const u=yield this._geocode(s);this._onQueryResult(u)})}_renderError(){this._renderMessage("<div class='maplibre-gl-geocoder--error'>There was an error reaching the server</div>")}_renderNoResults(){this._renderMessage("<div class='maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>No results found</div>")}_renderMessage(s){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(s)}_getPlaceholderText(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){const s=this.options.language.split(",")[0],u=m_.language(s),f=V_[u];if(f)return f}return"Search"}_fitBoundsForMarkers(){if(this._typeahead.data.length<1)return;const s=this._typeahead.data.filter(u=>typeof u!="string").slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){const f=ao({},{padding:100},this.options.flyTo),y=new this._maplibregl.LngLatBounds;for(const _ of s)y.extend(_.geometry.coordinates);this._map.fitBounds(y,f)}return s.length>0&&this._maplibregl&&this._handleResultMarkers(s),this}setInput(s){return this._inputEl.value=s,this._typeahead.selected=null,this._typeahead.clear(),s.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(s),this}setProximity(s){return this.options.proximity=s,this}getProximity(){return this.options.proximity}setRenderFunction(s){return s&&typeof s=="function"&&(this._typeahead.render=s),this}getRenderFunction(){return this._typeahead.render}setLanguage(s){return this.options.language=s||this.options.language||navigator.language,this}getLanguage(){return this.options.language}getZoom(){return this.options.zoom}setZoom(s){return this.options.zoom=s,this}getFlyTo(){return this.options.flyTo}setFlyTo(s){return this.options.flyTo=s,this}getPlaceholder(){return this.options.placeholder}setPlaceholder(s){return this.placeholder=s||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this}getBbox(){return this.options.bbox}setBbox(s){return this.options.bbox=s,this}getCountries(){return this.options.countries}setCountries(s){return this.options.countries=s,this}getTypes(){return this.options.types}setTypes(s){return this.options.types=s,this}getMinLength(){return this.options.minLength}setMinLength(s){return this.options.minLength=s,this._typeahead&&(this._typeahead.options.minLength=s),this}getLimit(){return this.options.limit}setLimit(s){return this.options.limit=s,this._typeahead&&(this._typeahead.options.limit=s),this}getFilter(){return this.options.filter}setFilter(s){return this.options.filter=s,this}setGeocoderApi(s){return this.geocoderApi=s,this}getGeocoderApi(){return this.geocoderApi}_handleMarker(s){if(!this._map)return;this._removeMarker();const f=ao({},{color:"#4668F2"},this.options.marker);this.mapMarker=new this._maplibregl.Marker(f);let y;if(this.options.popup){const g=ao({},{},this.options.popup);y=new this._maplibregl.Popup(g).setHTML(this.options.popupRender(s))}return s.center?(this.mapMarker.setLngLat(s.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(y)):s.geometry&&s.geometry.type&&s.geometry.type==="Point"&&s.geometry.coordinates&&(this.mapMarker.setLngLat(s.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(y)),this}_removeMarker(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)}_handleResultMarkers(s){if(!this._map)return;this._removeResultMarkers();let f=ao({},{color:"#4668F2"},this.options.showResultMarkers);for(const y of s){let _;if(this.options.showResultMarkers){this.options.showResultMarkers&&this.options.showResultMarkers.element&&(_=this.options.showResultMarkers.element.cloneNode(!0),f=ao(f,{element:_}));const g=new this._maplibregl.Marker(ao({},f,{element:_}));let a;if(this.options.popup){const F=ao({},{},this.options.popup);a=new this._maplibregl.Popup(F).setHTML(this.options.popupRender(y))}y.center?(g.setLngLat(y.center).addTo(this._map),this.options.popup&&g.setPopup(a)):y.geometry&&y.geometry.type&&y.geometry.type==="Point"&&y.geometry.coordinates&&(g.setLngLat(y.geometry.coordinates).addTo(this._map),this.options.popup&&g.setPopup(a)),this.resultMarkers.push(g)}}return this}_removeResultMarkers(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(s){s.remove()}),this.resultMarkers=[])}on(s,u){return this._eventEmitter.on(s,u),this}once(s){return new Promise(u=>{this._eventEmitter.once(s,u)})}off(s,u){return this._eventEmitter.removeListener(s,u),this}}const Z_="modulepreload",G_=function(d){return"/"+d},Em={},rp=function(s,u,f){let y=Promise.resolve();if(u&&u.length>0){document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),a=(g==null?void 0:g.nonce)||(g==null?void 0:g.getAttribute("nonce"));y=Promise.allSettled(u.map(C=>{if(C=G_(C),C in Em)return;Em[C]=!0;const F=C.endsWith(".css"),U=F?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${C}"]${U}`))return;const O=document.createElement("link");if(O.rel=F?"stylesheet":Z_,F||(O.as="script"),O.crossOrigin="",O.href=C,a&&O.setAttribute("nonce",a),document.head.appendChild(O),F)return new Promise(($,V)=>{O.addEventListener("load",$),O.addEventListener("error",()=>V(new Error(`Unable to preload CSS for ${C}`)))})}))}function _(g){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=g,window.dispatchEvent(a),!a.defaultPrevented)throw g}return y.then(g=>{for(const a of g||[])a.status==="rejected"&&_(a.reason);return s().catch(_)})};var W_=Object.defineProperty,H_=(d,s,u)=>s in d?W_(d,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):d[s]=u,Ji=(d,s,u)=>H_(d,typeof s!="symbol"?s+"":s,u);class X_{constructor(s){Ji(this,"map"),Ji(this,"width"),Ji(this,"height"),Ji(this,"svgCanvas"),Ji(this,"xLine"),Ji(this,"yLine"),Ji(this,"color","#535353"),this.map=s,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var s,u;this.width=(s=this.map)==null?void 0:s.getCanvas().clientWidth,this.height=(u=this.map)==null?void 0:u.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const s=this.width/2,u=this.height/2;this.yLine.setAttribute("x1",`${s}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${s}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${u}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${u}px`)}else console.error("element value is null")}createCanvas(s){if(this.width!==void 0&&this.height!==void 0){const u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.style.position="relative",u.setAttribute("width",`${this.width}px`),u.setAttribute("height",`${this.height}px`);const f=this.width/2,y=this.height/2;this.yLine=u.appendChild(this.createLine(f,0,f,this.height,this.color,"2px")),this.xLine=u.appendChild(this.createLine(0,y,this.width,y,this.color,"2px")),s==null||s.appendChild(u),this.svgCanvas=u}}createLine(s,u,f,y,_,g){const a=document.createElementNS("http://www.w3.org/2000/svg","line");return a.setAttribute("x1",s),a.setAttribute("y1",u),a.setAttribute("x2",f),a.setAttribute("y2",y),a.setAttribute("stroke-dasharray","5,5"),a.setAttribute("stroke",_),a.setAttribute("stroke-width",g),a}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}}const Mm={72:72,96:96,200:200,300:300,400:400},Ml={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},Tu={Landscape:"landscape",Portrait:"portrait"},hh={LETTER:[279,216],A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},_h={in:"in",mm:"mm"};class K_{constructor(s){Ji(this,"map"),Ji(this,"width"),Ji(this,"height"),Ji(this,"unit"),Ji(this,"svgCanvas"),Ji(this,"svgPath");var u,f,y;if(this.map=s,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const _=(u=this.map)==null?void 0:u.getCanvas().clientWidth,g=(f=this.map)==null?void 0:f.getCanvas().clientHeight,a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.style.position="absolute",a.style.top="0px",a.style.left="0px",a.setAttribute("width",`${_}px`),a.setAttribute("height",`${g}px`);const C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttribute("style","fill:#888888;stroke-width:0"),C.setAttribute("fill-opacity","0.5"),a.append(C),(y=this.map)==null||y.getCanvasContainer().appendChild(a),this.svgCanvas=a,this.svgPath=C}mapResize(){this.generateCutOut()}updateArea(s,u){this.width=s,this.height=u,this.unit=_h.mm,this.generateCutOut()}generateCutOut(){var s,u;if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const f=this.toPixels(this.width),y=this.toPixels(this.height),_=(s=this.map)==null?void 0:s.getCanvas().clientWidth,g=(u=this.map)==null?void 0:u.getCanvas().clientHeight,a=_/2-f/2,C=a+f,F=g/2-y/2,U=F+y;this.svgCanvas.setAttribute("width",`${_}px`),this.svgCanvas.setAttribute("height",`${g}px`),this.svgPath.setAttribute("d",`M 0 0 L ${_} 0 L ${_} ${g} L 0 ${g} M ${a} ${F} L ${a} ${U} L ${C} ${U} L ${C} ${F}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(s,u=96){return this.unit===_h.mm&&(u/=25.4),u*s}}const Tg={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate",LanguageName:"English",LanguageCode:"en"},Y_={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Générer",LanguageName:"Français",LanguageCode:"fr"},J_={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi",LanguageName:"Suomalainen",LanguageCode:"fi"},Q_={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflösung",Generate:"Erstellen",LanguageName:"Deutsch",LanguageCode:"de"},ev={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera",LanguageName:"Svenska",LanguageCode:"sv"},tv={PageSize:"Tamaño de página",PageOrientation:"Orientación de página",Format:"Formato",DPI:"DPI",Generate:"Generar",LanguageName:"Española",LanguageCode:"es"},iv={PageSize:"Mida",PageOrientation:"Orientació",Format:"Format",DPI:"DPI",Generate:"Genera",LanguageName:"Catalan",LanguageCode:"ca"},rv={PageSize:"Kích thước trang",PageOrientation:"Loại trang",Format:"Định dạng",DPI:"Mật độ điểm ảnh (DPI)",Generate:"Tạo",LanguageName:"Tiếng Việt",LanguageCode:"vi"},nv={PageSize:"Розмір сторінки",PageOrientation:"Орієнтація сторінки",Format:"Формат",DPI:"DPI",Generate:"Згенерувати",LanguageName:"українська",LanguageCode:"uk"},sv={PageSize:"页面大小",PageOrientation:"页面方向",Format:"格式",DPI:"像素",Generate:"导出",LanguageName:"简体字",LanguageCode:"zhHans"},av={PageSize:"頁面大小",PageOrientation:"頁面方向",Format:"格式",DPI:"像素",Generate:"導出",LanguageName:"繁体字",LanguageCode:"zhHant"},ov={PageSize:"ページサイズ",PageOrientation:"ページ方向",Format:"フォーマット",DPI:"DPI（解像度）",Generate:"出力",LanguageName:"日本語",LanguageCode:"ja"},lv={PageSize:"Tamanho da página",PageOrientation:"Orientação da página",Format:"Formato",DPI:"DPI",Generate:"Gerar",LanguageName:"Português",LanguageCode:"pt"},cv=[Tg,Y_,J_,Q_,ev,tv,iv,rv,nv,sv,av,ov,lv],hv=d=>cv.find(s=>s.LanguageCode===d)??Tg;function dr(d){"@babel/helpers - typeof";return dr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},dr(d)}var as=Uint8Array,ma=Uint16Array,Pp=Int32Array,Ku=new as([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Yu=new as([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),np=new as([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Cg=function(d,s){for(var u=new ma(31),f=0;f<31;++f)u[f]=s+=1<<d[f-1];for(var y=new Pp(u[30]),f=1;f<30;++f)for(var _=u[f];_<u[f+1];++_)y[_]=_-u[f]<<5|f;return{b:u,r:y}},Eg=Cg(Ku,2),Mg=Eg.b,sp=Eg.r;Mg[28]=258,sp[258]=28;var zg=Cg(Yu,0),uv=zg.b,zm=zg.r,ap=new ma(32768);for(var Er=0;Er<32768;++Er){var Ql=(Er&43690)>>1|(Er&21845)<<1;Ql=(Ql&52428)>>2|(Ql&13107)<<2,Ql=(Ql&61680)>>4|(Ql&3855)<<4,ap[Er]=((Ql&65280)>>8|(Ql&255)<<8)>>1}var tl=function(d,s,u){for(var f=d.length,y=0,_=new ma(s);y<f;++y)d[y]&&++_[d[y]-1];var g=new ma(s);for(y=1;y<s;++y)g[y]=g[y-1]+_[y-1]<<1;var a;if(u){a=new ma(1<<s);var C=15-s;for(y=0;y<f;++y)if(d[y])for(var F=y<<4|d[y],U=s-d[y],O=g[d[y]-1]++<<U,$=O|(1<<U)-1;O<=$;++O)a[ap[O]>>C]=F}else for(a=new ma(f),y=0;y<f;++y)d[y]&&(a[y]=ap[g[d[y]-1]++]>>15-d[y]);return a},nc=new as(288);for(var Er=0;Er<144;++Er)nc[Er]=8;for(var Er=144;Er<256;++Er)nc[Er]=9;for(var Er=256;Er<280;++Er)nc[Er]=7;for(var Er=280;Er<288;++Er)nc[Er]=8;var tu=new as(32);for(var Er=0;Er<32;++Er)tu[Er]=5;var dv=tl(nc,9,0),pv=tl(nc,9,1),fv=tl(tu,5,0),mv=tl(tu,5,1),Vd=function(d){for(var s=d[0],u=1;u<d.length;++u)d[u]>s&&(s=d[u]);return s},oo=function(d,s,u){var f=s/8|0;return(d[f]|d[f+1]<<8)>>(s&7)&u},Ud=function(d,s){var u=s/8|0;return(d[u]|d[u+1]<<8|d[u+2]<<16)>>(s&7)},Lp=function(d){return(d+7)/8|0},Ng=function(d,s,u){return(u==null||u>d.length)&&(u=d.length),new as(d.subarray(s,u))},gv=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ho=function(d,s,u){var f=new Error(s||gv[d]);if(f.code=d,Error.captureStackTrace&&Error.captureStackTrace(f,ho),!u)throw f;return f},yv=function(d,s,u,f){var y=d.length,_=0;if(!y||s.f&&!s.l)return u||new as(0);var g=!u,a=g||s.i!=2,C=s.i;g&&(u=new as(y*3));var F=function(kt){var Nt=u.length;if(kt>Nt){var zt=new as(Math.max(Nt*2,kt));zt.set(u),u=zt}},U=s.f||0,O=s.p||0,$=s.b||0,V=s.l,ye=s.d,de=s.m,Pe=s.n,ue=y*8;do{if(!V){U=oo(d,O,1);var Se=oo(d,O+1,3);if(O+=3,Se)if(Se==1)V=pv,ye=mv,de=9,Pe=5;else if(Se==2){var ze=oo(d,O,31)+257,Ye=oo(d,O+10,15)+4,Je=ze+oo(d,O+5,31)+1;O+=14;for(var ct=new as(Je),Ge=new as(19),De=0;De<Ye;++De)Ge[np[De]]=oo(d,O+De*3,7);O+=Ye*3;for(var Qe=Vd(Ge),pt=(1<<Qe)-1,pe=tl(Ge,Qe,1),De=0;De<Je;){var me=pe[oo(d,O,pt)];O+=me&15;var Ne=me>>4;if(Ne<16)ct[De++]=Ne;else{var Le=0,et=0;for(Ne==16?(et=3+oo(d,O,3),O+=2,Le=ct[De-1]):Ne==17?(et=3+oo(d,O,7),O+=3):Ne==18&&(et=11+oo(d,O,127),O+=7);et--;)ct[De++]=Le}}var it=ct.subarray(0,ze),nt=ct.subarray(ze);de=Vd(it),Pe=Vd(nt),V=tl(it,de,1),ye=tl(nt,Pe,1)}else ho(1);else{var Ne=Lp(O)+4,Xe=d[Ne-4]|d[Ne-3]<<8,at=Ne+Xe;if(at>y){C&&ho(0);break}a&&F($+Xe),u.set(d.subarray(Ne,at),$),s.b=$+=Xe,s.p=O=at*8,s.f=U;continue}if(O>ue){C&&ho(0);break}}a&&F($+131072);for(var dt=(1<<de)-1,Mt=(1<<Pe)-1,ie=O;;ie=O){var Le=V[Ud(d,O)&dt],xe=Le>>4;if(O+=Le&15,O>ue){C&&ho(0);break}if(Le||ho(2),xe<256)u[$++]=xe;else if(xe==256){ie=O,V=null;break}else{var ke=xe-254;if(xe>264){var De=xe-257,Fe=Ku[De];ke=oo(d,O,(1<<Fe)-1)+Mg[De],O+=Fe}var qe=ye[Ud(d,O)&Mt],$e=qe>>4;qe||ho(3),O+=qe&15;var nt=uv[$e];if($e>3){var Fe=Yu[$e];nt+=Ud(d,O)&(1<<Fe)-1,O+=Fe}if(O>ue){C&&ho(0);break}a&&F($+131072);var Ke=$+ke;if($<nt){var tt=_-nt,Tt=Math.min(nt,Ke);for(tt+$<0&&ho(3);$<Tt;++$)u[$]=f[tt+$]}for(;$<Ke;++$)u[$]=u[$-nt]}}s.l=V,s.p=ie,s.b=$,s.f=U,V&&(U=1,s.m=de,s.d=ye,s.n=Pe)}while(!U);return $!=u.length&&g?Ng(u,0,$):u.subarray(0,$)},El=function(d,s,u){u<<=s&7;var f=s/8|0;d[f]|=u,d[f+1]|=u>>8},Hh=function(d,s,u){u<<=s&7;var f=s/8|0;d[f]|=u,d[f+1]|=u>>8,d[f+2]|=u>>16},$d=function(d,s){for(var u=[],f=0;f<d.length;++f)d[f]&&u.push({s:f,f:d[f]});var y=u.length,_=u.slice();if(!y)return{t:Fg,l:0};if(y==1){var g=new as(u[0].s+1);return g[u[0].s]=1,{t:g,l:1}}u.sort(function(Je,ct){return Je.f-ct.f}),u.push({s:-1,f:25001});var a=u[0],C=u[1],F=0,U=1,O=2;for(u[0]={s:-1,f:a.f+C.f,l:a,r:C};U!=y-1;)a=u[u[F].f<u[O].f?F++:O++],C=u[F!=U&&u[F].f<u[O].f?F++:O++],u[U++]={s:-1,f:a.f+C.f,l:a,r:C};for(var $=_[0].s,f=1;f<y;++f)_[f].s>$&&($=_[f].s);var V=new ma($+1),ye=op(u[U-1],V,0);if(ye>s){var f=0,de=0,Pe=ye-s,ue=1<<Pe;for(_.sort(function(ct,Ge){return V[Ge.s]-V[ct.s]||ct.f-Ge.f});f<y;++f){var Se=_[f].s;if(V[Se]>s)de+=ue-(1<<ye-V[Se]),V[Se]=s;else break}for(de>>=Pe;de>0;){var ze=_[f].s;V[ze]<s?de-=1<<s-V[ze]++-1:++f}for(;f>=0&&de;--f){var Ye=_[f].s;V[Ye]==s&&(--V[Ye],++de)}ye=s}return{t:new as(V),l:ye}},op=function(d,s,u){return d.s==-1?Math.max(op(d.l,s,u+1),op(d.r,s,u+1)):s[d.s]=u},Nm=function(d){for(var s=d.length;s&&!d[--s];);for(var u=new ma(++s),f=0,y=d[0],_=1,g=function(C){u[f++]=C},a=1;a<=s;++a)if(d[a]==y&&a!=s)++_;else{if(!y&&_>2){for(;_>138;_-=138)g(32754);_>2&&(g(_>10?_-11<<5|28690:_-3<<5|12305),_=0)}else if(_>3){for(g(y),--_;_>6;_-=6)g(8304);_>2&&(g(_-3<<5|8208),_=0)}for(;_--;)g(y);_=1,y=d[a]}return{c:u.subarray(0,f),n:s}},Xh=function(d,s){for(var u=0,f=0;f<s.length;++f)u+=d[f]*s[f];return u},Dg=function(d,s,u){var f=u.length,y=Lp(s+2);d[y]=f&255,d[y+1]=f>>8,d[y+2]=d[y]^255,d[y+3]=d[y+1]^255;for(var _=0;_<f;++_)d[y+_+4]=u[_];return(y+4+f)*8},Dm=function(d,s,u,f,y,_,g,a,C,F,U){El(s,U++,u),++y[256];for(var O=$d(y,15),$=O.t,V=O.l,ye=$d(_,15),de=ye.t,Pe=ye.l,ue=Nm($),Se=ue.c,ze=ue.n,Ye=Nm(de),Je=Ye.c,ct=Ye.n,Ge=new ma(19),De=0;De<Se.length;++De)++Ge[Se[De]&31];for(var De=0;De<Je.length;++De)++Ge[Je[De]&31];for(var Qe=$d(Ge,7),pt=Qe.t,pe=Qe.l,me=19;me>4&&!pt[np[me-1]];--me);var Ne=F+5<<3,Le=Xh(y,nc)+Xh(_,tu)+g,et=Xh(y,$)+Xh(_,de)+g+14+3*me+Xh(Ge,pt)+2*Ge[16]+3*Ge[17]+7*Ge[18];if(C>=0&&Ne<=Le&&Ne<=et)return Dg(s,U,d.subarray(C,C+F));var it,nt,Xe,at;if(El(s,U,1+(et<Le)),U+=2,et<Le){it=tl($,V,0),nt=$,Xe=tl(de,Pe,0),at=de;var dt=tl(pt,pe,0);El(s,U,ze-257),El(s,U+5,ct-1),El(s,U+10,me-4),U+=14;for(var De=0;De<me;++De)El(s,U+3*De,pt[np[De]]);U+=3*me;for(var Mt=[Se,Je],ie=0;ie<2;++ie)for(var xe=Mt[ie],De=0;De<xe.length;++De){var ke=xe[De]&31;El(s,U,dt[ke]),U+=pt[ke],ke>15&&(El(s,U,xe[De]>>5&127),U+=xe[De]>>12)}}else it=dv,nt=nc,Xe=fv,at=tu;for(var De=0;De<a;++De){var Fe=f[De];if(Fe>255){var ke=Fe>>18&31;Hh(s,U,it[ke+257]),U+=nt[ke+257],ke>7&&(El(s,U,Fe>>23&31),U+=Ku[ke]);var qe=Fe&31;Hh(s,U,Xe[qe]),U+=at[qe],qe>3&&(Hh(s,U,Fe>>5&8191),U+=Yu[qe])}else Hh(s,U,it[Fe]),U+=nt[Fe]}return Hh(s,U,it[256]),U+nt[256]},_v=new Pp([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Fg=new as(0),vv=function(d,s,u,f,y,_){var g=_.z||d.length,a=new as(f+g+5*(1+Math.ceil(g/7e3))+y),C=a.subarray(f,a.length-y),F=_.l,U=(_.r||0)&7;if(s){U&&(C[0]=_.r>>3);for(var O=_v[s-1],$=O>>13,V=O&8191,ye=(1<<u)-1,de=_.p||new ma(32768),Pe=_.h||new ma(ye+1),ue=Math.ceil(u/3),Se=2*ue,ze=function(ti){return(d[ti]^d[ti+1]<<ue^d[ti+2]<<Se)&ye},Ye=new Pp(25e3),Je=new ma(288),ct=new ma(32),Ge=0,De=0,Qe=_.i||0,pt=0,pe=_.w||0,me=0;Qe+2<g;++Qe){var Ne=ze(Qe),Le=Qe&32767,et=Pe[Ne];if(de[Le]=et,Pe[Ne]=Le,pe<=Qe){var it=g-Qe;if((Ge>7e3||pt>24576)&&(it>423||!F)){U=Dm(d,C,0,Ye,Je,ct,De,pt,me,Qe-me,U),pt=Ge=De=0,me=Qe;for(var nt=0;nt<286;++nt)Je[nt]=0;for(var nt=0;nt<30;++nt)ct[nt]=0}var Xe=2,at=0,dt=V,Mt=Le-et&32767;if(it>2&&Ne==ze(Qe-Mt))for(var ie=Math.min($,it)-1,xe=Math.min(32767,Qe),ke=Math.min(258,it);Mt<=xe&&--dt&&Le!=et;){if(d[Qe+Xe]==d[Qe+Xe-Mt]){for(var Fe=0;Fe<ke&&d[Qe+Fe]==d[Qe+Fe-Mt];++Fe);if(Fe>Xe){if(Xe=Fe,at=Mt,Fe>ie)break;for(var qe=Math.min(Mt,Fe-2),$e=0,nt=0;nt<qe;++nt){var Ke=Qe-Mt+nt&32767,tt=de[Ke],Tt=Ke-tt&32767;Tt>$e&&($e=Tt,et=Ke)}}}Le=et,et=de[Le],Mt+=Le-et&32767}if(at){Ye[pt++]=268435456|sp[Xe]<<18|zm[at];var kt=sp[Xe]&31,Nt=zm[at]&31;De+=Ku[kt]+Yu[Nt],++Je[257+kt],++ct[Nt],pe=Qe+Xe,++Ge}else Ye[pt++]=d[Qe],++Je[d[Qe]]}}for(Qe=Math.max(Qe,pe);Qe<g;++Qe)Ye[pt++]=d[Qe],++Je[d[Qe]];U=Dm(d,C,F,Ye,Je,ct,De,pt,me,Qe-me,U),F||(_.r=U&7|C[U/8|0]<<3,U-=7,_.h=Pe,_.p=de,_.i=Qe,_.w=pe)}else{for(var Qe=_.w||0;Qe<g+F;Qe+=65535){var zt=Qe+65535;zt>=g&&(C[U/8|0]=F,zt=g),U=Dg(C,U+1,d.subarray(Qe,zt))}_.i=g}return Ng(a,0,f+Lp(U)+y)},Rg=function(){var d=1,s=0;return{p:function(u){for(var f=d,y=s,_=u.length|0,g=0;g!=_;){for(var a=Math.min(g+2655,_);g<a;++g)y+=f+=u[g];f=(f&65535)+15*(f>>16),y=(y&65535)+15*(y>>16)}d=f,s=y},d:function(){return d%=65521,s%=65521,(d&255)<<24|(d&65280)<<8|(s&255)<<8|s>>8}}},bv=function(d,s,u,f,y){if(!y&&(y={l:1},s.dictionary)){var _=s.dictionary.subarray(-32768),g=new as(_.length+d.length);g.set(_),g.set(d,_.length),d=g,y.w=_.length}return vv(d,s.level==null?6:s.level,s.mem==null?y.l?Math.ceil(Math.max(8,Math.min(13,Math.log(d.length)))*1.5):20:12+s.mem,u,f,y)},Og=function(d,s,u){for(;u;++s)d[s]=u,u>>>=8},xv=function(d,s){var u=s.level,f=u==0?0:u<6?1:u==9?3:2;if(d[0]=120,d[1]=f<<6|(s.dictionary&&32),d[1]|=31-(d[0]<<8|d[1])%31,s.dictionary){var y=Rg();y.p(s.dictionary),Og(d,2,y.d())}},wv=function(d,s){return((d[0]&15)!=8||d[0]>>4>7||(d[0]<<8|d[1])%31)&&ho(6,"invalid zlib data"),(d[1]>>5&1)==+!s&&ho(6,"invalid zlib data: "+(d[1]&32?"need":"unexpected")+" dictionary"),(d[1]>>3&4)+2};function lp(d,s){s||(s={});var u=Rg();u.p(d);var f=bv(d,s,s.dictionary?6:2,4);return xv(f,s),Og(f,f.length-4,u.d()),f}function Sv(d,s){return yv(d.subarray(wv(d,s),-4),{i:2},s,s)}var Av=typeof TextDecoder<"u"&&new TextDecoder,Iv=0;try{Av.decode(Fg,{stream:!0}),Iv=1}catch{}/** @license
 *
 * jsPDF - PDF Document creation from JavaScript
 * Version 2.5.2 Built on 2024-09-17T13:29:57.859Z
 *                      CommitID 00000000
 *
 * Copyright (c) 2010-2021 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
 *               2015-2021 yWorks GmbH, http://www.yworks.com
 *               2015-2021 Lukas Holländer <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
 *               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
 *               2010 Aaron Spike, https://github.com/acspike
 *               2012 Willow Systems Corporation, https://github.com/willowsystems
 *               2012 Pablo Hess, https://github.com/pablohess
 *               2012 Florian Jenett, https://github.com/fjenett
 *               2013 Warren Weckesser, https://github.com/warrenweckesser
 *               2013 Youssef Beddad, https://github.com/lifof
 *               2013 Lee Driscoll, https://github.com/lsdriscoll
 *               2013 Stefan Slonevskiy, https://github.com/stefslon
 *               2013 Jeremy Morel, https://github.com/jmorel
 *               2013 Christoph Hartmann, https://github.com/chris-rock
 *               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
 *               2014 James Makes, https://github.com/dollaruw
 *               2014 Diego Casorran, https://github.com/diegocr
 *               2014 Steven Spungin, https://github.com/Flamenco
 *               2014 Kenneth Glassey, https://github.com/Gavvers
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 * Contributor(s):
 *    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
 *    kim3er, mfo, alnorth, Flamenco
 */var ki=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function Zd(){ki.console&&typeof ki.console.log=="function"&&ki.console.log.apply(ki.console,arguments)}var xr={log:Zd,warn:function(d){ki.console&&(typeof ki.console.warn=="function"?ki.console.warn.apply(ki.console,arguments):Zd.call(null,arguments))},error:function(d){ki.console&&(typeof ki.console.error=="function"?ki.console.error.apply(ki.console,arguments):Zd(d))}};function Gd(d,s,u){var f=new XMLHttpRequest;f.open("GET",d),f.responseType="blob",f.onload=function(){Lc(f.response,s,u)},f.onerror=function(){xr.error("could not download file")},f.send()}function Fm(d){var s=new XMLHttpRequest;s.open("HEAD",d,!1);try{s.send()}catch{}return s.status>=200&&s.status<=299}function Cu(d){try{d.dispatchEvent(new MouseEvent("click"))}catch{var s=document.createEvent("MouseEvents");s.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),d.dispatchEvent(s)}}var Jh,cp,Lc=ki.saveAs||((typeof window>"u"?"undefined":dr(window))!=="object"||window!==ki?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(d,s,u){var f=ki.URL||ki.webkitURL,y=document.createElement("a");s=s||d.name||"download",y.download=s,y.rel="noopener",typeof d=="string"?(y.href=d,y.origin!==location.origin?Fm(y.href)?Gd(d,s,u):Cu(y,y.target="_blank"):Cu(y)):(y.href=f.createObjectURL(d),setTimeout(function(){f.revokeObjectURL(y.href)},4e4),setTimeout(function(){Cu(y)},0))}:"msSaveOrOpenBlob"in navigator?function(d,s,u){if(s=s||d.name||"download",typeof d=="string")if(Fm(d))Gd(d,s,u);else{var f=document.createElement("a");f.href=d,f.target="_blank",setTimeout(function(){Cu(f)})}else navigator.msSaveOrOpenBlob(function(y,_){return _===void 0?_={autoBom:!1}:dr(_)!=="object"&&(xr.warn("Deprecated: Expected third argument to be a object"),_={autoBom:!_}),_.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(y.type)?new Blob(["\uFEFF",y],{type:y.type}):y}(d,u),s)}:function(d,s,u,f){if((f=f||open("","_blank"))&&(f.document.title=f.document.body.innerText="downloading..."),typeof d=="string")return Gd(d,s,u);var y=d.type==="application/octet-stream",_=/constructor/i.test(ki.HTMLElement)||ki.safari,g=/CriOS\/[\d]+/.test(navigator.userAgent);if((g||y&&_)&&(typeof FileReader>"u"?"undefined":dr(FileReader))==="object"){var a=new FileReader;a.onloadend=function(){var U=a.result;U=g?U:U.replace(/^data:[^;]*;/,"data:attachment/file;"),f?f.location.href=U:location=U,f=null},a.readAsDataURL(d)}else{var C=ki.URL||ki.webkitURL,F=C.createObjectURL(d);f?f.location=F:location.href=F,f=null,setTimeout(function(){C.revokeObjectURL(F)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function Bg(d){var s;d=d||"",this.ok=!1,d.charAt(0)=="#"&&(d=d.substr(1,6)),d={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[d=(d=d.replace(/ /g,"")).toLowerCase()]||d;for(var u=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(a){return[parseInt(a[1]),parseInt(a[2]),parseInt(a[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}}],f=0;f<u.length;f++){var y=u[f].re,_=u[f].process,g=y.exec(d);g&&(s=_(g),this.r=s[0],this.g=s[1],this.b=s[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var a=this.r.toString(16),C=this.g.toString(16),F=this.b.toString(16);return a.length==1&&(a="0"+a),C.length==1&&(C="0"+C),F.length==1&&(F="0"+F),"#"+a+C+F}}/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function Wd(d,s){var u=d[0],f=d[1],y=d[2],_=d[3];u=is(u,f,y,_,s[0],7,-680876936),_=is(_,u,f,y,s[1],12,-389564586),y=is(y,_,u,f,s[2],17,606105819),f=is(f,y,_,u,s[3],22,-1044525330),u=is(u,f,y,_,s[4],7,-176418897),_=is(_,u,f,y,s[5],12,1200080426),y=is(y,_,u,f,s[6],17,-1473231341),f=is(f,y,_,u,s[7],22,-45705983),u=is(u,f,y,_,s[8],7,1770035416),_=is(_,u,f,y,s[9],12,-1958414417),y=is(y,_,u,f,s[10],17,-42063),f=is(f,y,_,u,s[11],22,-1990404162),u=is(u,f,y,_,s[12],7,1804603682),_=is(_,u,f,y,s[13],12,-40341101),y=is(y,_,u,f,s[14],17,-1502002290),u=rs(u,f=is(f,y,_,u,s[15],22,1236535329),y,_,s[1],5,-165796510),_=rs(_,u,f,y,s[6],9,-1069501632),y=rs(y,_,u,f,s[11],14,643717713),f=rs(f,y,_,u,s[0],20,-373897302),u=rs(u,f,y,_,s[5],5,-701558691),_=rs(_,u,f,y,s[10],9,38016083),y=rs(y,_,u,f,s[15],14,-660478335),f=rs(f,y,_,u,s[4],20,-405537848),u=rs(u,f,y,_,s[9],5,568446438),_=rs(_,u,f,y,s[14],9,-1019803690),y=rs(y,_,u,f,s[3],14,-187363961),f=rs(f,y,_,u,s[8],20,1163531501),u=rs(u,f,y,_,s[13],5,-1444681467),_=rs(_,u,f,y,s[2],9,-51403784),y=rs(y,_,u,f,s[7],14,1735328473),u=ns(u,f=rs(f,y,_,u,s[12],20,-1926607734),y,_,s[5],4,-378558),_=ns(_,u,f,y,s[8],11,-2022574463),y=ns(y,_,u,f,s[11],16,1839030562),f=ns(f,y,_,u,s[14],23,-35309556),u=ns(u,f,y,_,s[1],4,-1530992060),_=ns(_,u,f,y,s[4],11,1272893353),y=ns(y,_,u,f,s[7],16,-155497632),f=ns(f,y,_,u,s[10],23,-1094730640),u=ns(u,f,y,_,s[13],4,681279174),_=ns(_,u,f,y,s[0],11,-358537222),y=ns(y,_,u,f,s[3],16,-722521979),f=ns(f,y,_,u,s[6],23,76029189),u=ns(u,f,y,_,s[9],4,-640364487),_=ns(_,u,f,y,s[12],11,-421815835),y=ns(y,_,u,f,s[15],16,530742520),u=ss(u,f=ns(f,y,_,u,s[2],23,-995338651),y,_,s[0],6,-198630844),_=ss(_,u,f,y,s[7],10,1126891415),y=ss(y,_,u,f,s[14],15,-1416354905),f=ss(f,y,_,u,s[5],21,-57434055),u=ss(u,f,y,_,s[12],6,1700485571),_=ss(_,u,f,y,s[3],10,-1894986606),y=ss(y,_,u,f,s[10],15,-1051523),f=ss(f,y,_,u,s[1],21,-2054922799),u=ss(u,f,y,_,s[8],6,1873313359),_=ss(_,u,f,y,s[15],10,-30611744),y=ss(y,_,u,f,s[6],15,-1560198380),f=ss(f,y,_,u,s[13],21,1309151649),u=ss(u,f,y,_,s[4],6,-145523070),_=ss(_,u,f,y,s[11],10,-1120210379),y=ss(y,_,u,f,s[2],15,718787259),f=ss(f,y,_,u,s[9],21,-343485551),d[0]=ic(u,d[0]),d[1]=ic(f,d[1]),d[2]=ic(y,d[2]),d[3]=ic(_,d[3])}function Ju(d,s,u,f,y,_){return s=ic(ic(s,d),ic(f,_)),ic(s<<y|s>>>32-y,u)}function is(d,s,u,f,y,_,g){return Ju(s&u|~s&f,d,s,y,_,g)}function rs(d,s,u,f,y,_,g){return Ju(s&f|u&~f,d,s,y,_,g)}function ns(d,s,u,f,y,_,g){return Ju(s^u^f,d,s,y,_,g)}function ss(d,s,u,f,y,_,g){return Ju(u^(s|~f),d,s,y,_,g)}function jg(d){var s,u=d.length,f=[1732584193,-271733879,-1732584194,271733878];for(s=64;s<=d.length;s+=64)Wd(f,Pv(d.substring(s-64,s)));d=d.substring(s-64);var y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(s=0;s<d.length;s++)y[s>>2]|=d.charCodeAt(s)<<(s%4<<3);if(y[s>>2]|=128<<(s%4<<3),s>55)for(Wd(f,y),s=0;s<16;s++)y[s]=0;return y[14]=8*u,Wd(f,y),f}function Pv(d){var s,u=[];for(s=0;s<64;s+=4)u[s>>2]=d.charCodeAt(s)+(d.charCodeAt(s+1)<<8)+(d.charCodeAt(s+2)<<16)+(d.charCodeAt(s+3)<<24);return u}Jh=ki.atob.bind(ki),cp=ki.btoa.bind(ki);var Rm="0123456789abcdef".split("");function Lv(d){for(var s="",u=0;u<4;u++)s+=Rm[d>>8*u+4&15]+Rm[d>>8*u&15];return s}function kv(d){return String.fromCharCode((255&d)>>0,(65280&d)>>8,(16711680&d)>>16,(4278190080&d)>>24)}function hp(d){return jg(d).map(kv).join("")}var Tv=function(d){for(var s=0;s<d.length;s++)d[s]=Lv(d[s]);return d.join("")}(jg("hello"))!="5d41402abc4b2a76b9719d911017c592";function ic(d,s){if(Tv){var u=(65535&d)+(65535&s);return(d>>16)+(s>>16)+(u>>16)<<16|65535&u}return d+s&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function up(d,s){var u,f,y,_;if(d!==u){for(var g=(y=d,_=1+(256/d.length>>0),new Array(_+1).join(y)),a=[],C=0;C<256;C++)a[C]=C;var F=0;for(C=0;C<256;C++){var U=a[C];F=(F+U+g.charCodeAt(C))%256,a[C]=a[F],a[F]=U}u=d,f=a}else a=f;var O=s.length,$=0,V=0,ye="";for(C=0;C<O;C++)V=(V+(U=a[$=($+1)%256]))%256,a[$]=a[V],a[V]=U,g=a[(a[$]+a[V])%256],ye+=String.fromCharCode(s.charCodeAt(C)^g);return ye}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var Om={print:4,modify:8,copy:16,"annot-forms":32};function oh(d,s,u,f){this.v=1,this.r=2;var y=192;d.forEach(function(a){if(Om.perm!==void 0)throw new Error("Invalid permission: "+a);y+=Om[a]}),this.padding="(¿N^NuAd\0NVÿú\b..\0¶Ðh>/\f©þdSiz";var _=(s+this.padding).substr(0,32),g=(u+this.padding).substr(0,32);this.O=this.processOwnerPassword(_,g),this.P=-(1+(255^y)),this.encryptionKey=hp(_+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(f)).substr(0,5),this.U=up(this.encryptionKey,this.padding)}function lh(d){if(/[^\u0000-\u00ff]/.test(d))throw new Error("Invalid PDF Name Object: "+d+", Only accept ASCII characters.");for(var s="",u=d.length,f=0;f<u;f++){var y=d.charCodeAt(f);y<33||y===35||y===37||y===40||y===41||y===47||y===60||y===62||y===91||y===93||y===123||y===125||y>126?s+="#"+("0"+y.toString(16)).slice(-2):s+=d[f]}return s}function Bm(d){if(dr(d)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var s={};this.subscribe=function(u,f,y){if(y=y||!1,typeof u!="string"||typeof f!="function"||typeof y!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");s.hasOwnProperty(u)||(s[u]={});var _=Math.random().toString(35);return s[u][_]=[f,!!y],_},this.unsubscribe=function(u){for(var f in s)if(s[f][u])return delete s[f][u],Object.keys(s[f]).length===0&&delete s[f],!0;return!1},this.publish=function(u){if(s.hasOwnProperty(u)){var f=Array.prototype.slice.call(arguments,1),y=[];for(var _ in s[u]){var g=s[u][_];try{g[0].apply(d,f)}catch(a){ki.console&&xr.error("jsPDF PubSub Error",a.message,a)}g[1]&&y.push(_)}y.length&&y.forEach(this.unsubscribe)}},this.getTopics=function(){return s}}function ju(d){if(!(this instanceof ju))return new ju(d);var s="opacity,stroke-opacity".split(",");for(var u in d)d.hasOwnProperty(u)&&s.indexOf(u)>=0&&(this[u]=d[u]);this.id="",this.objectNumber=-1}function qg(d,s){this.gState=d,this.matrix=s,this.id="",this.objectNumber=-1}function kc(d,s,u,f,y){if(!(this instanceof kc))return new kc(d,s,u,f,y);this.type=d==="axial"?2:3,this.coords=s,this.colors=u,qg.call(this,f,y)}function uh(d,s,u,f,y){if(!(this instanceof uh))return new uh(d,s,u,f,y);this.boundingBox=d,this.xStep=s,this.yStep=u,this.stream="",this.cloneIndex=0,qg.call(this,f,y)}function Li(d){var s,u=typeof arguments[0]=="string"?arguments[0]:"p",f=arguments[1],y=arguments[2],_=arguments[3],g=[],a=1,C=16,F="S",U=null;dr(d=d||{})==="object"&&(u=d.orientation,f=d.unit||f,y=d.format||y,_=d.compress||d.compressPdf||_,(U=d.encryption||null)!==null&&(U.userPassword=U.userPassword||"",U.ownerPassword=U.ownerPassword||"",U.userPermissions=U.userPermissions||[]),a=typeof d.userUnit=="number"?Math.abs(d.userUnit):1,d.precision!==void 0&&(s=d.precision),d.floatPrecision!==void 0&&(C=d.floatPrecision),F=d.defaultPathOperation||"S"),g=d.filters||(_===!0?["FlateEncode"]:g),f=f||"mm",u=(""+(u||"P")).toLowerCase();var O=d.putOnlyUsedFonts||!1,$={},V={internal:{},__private__:{}};V.__private__.PubSub=Bm;var ye="1.3",de=V.__private__.getPdfVersion=function(){return ye};V.__private__.setPdfVersion=function(E){ye=E};var Pe={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};V.__private__.getPageFormats=function(){return Pe};var ue=V.__private__.getPageFormat=function(E){return Pe[E]};y=y||"a4";var Se={COMPAT:"compat",ADVANCED:"advanced"},ze=Se.COMPAT;function Ye(){this.saveGraphicsState(),te(new we(Rt,0,0,-Rt,0,wa()*Rt).toString()+" cm"),this.setFontSize(this.getFontSize()/Rt),F="n",ze=Se.ADVANCED}function Je(){this.restoreGraphicsState(),F="S",ze=Se.COMPAT}var ct=V.__private__.combineFontStyleAndFontWeight=function(E,Q){if(E=="bold"&&Q=="normal"||E=="bold"&&Q==400||E=="normal"&&Q=="italic"||E=="bold"&&Q=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return Q&&(E=Q==400||Q==="normal"?E==="italic"?"italic":"normal":Q!=700&&Q!=="bold"||E!=="normal"?(Q==700?"bold":Q)+""+E:"bold"),E};V.advancedAPI=function(E){var Q=ze===Se.COMPAT;return Q&&Ye.call(this),typeof E!="function"||(E(this),Q&&Je.call(this)),this},V.compatAPI=function(E){var Q=ze===Se.ADVANCED;return Q&&Je.call(this),typeof E!="function"||(E(this),Q&&Ye.call(this)),this},V.isAdvancedAPI=function(){return ze===Se.ADVANCED};var Ge,De=function(E){if(ze!==Se.ADVANCED)throw new Error(E+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},Qe=V.roundToPrecision=V.__private__.roundToPrecision=function(E,Q){var Ie=s||Q;if(isNaN(E)||isNaN(Ie))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return E.toFixed(Ie).replace(/0+$/,"")};Ge=V.hpf=V.__private__.hpf=typeof C=="number"?function(E){if(isNaN(E))throw new Error("Invalid argument passed to jsPDF.hpf");return Qe(E,C)}:C==="smart"?function(E){if(isNaN(E))throw new Error("Invalid argument passed to jsPDF.hpf");return Qe(E,E>-1&&E<1?16:5)}:function(E){if(isNaN(E))throw new Error("Invalid argument passed to jsPDF.hpf");return Qe(E,16)};var pt=V.f2=V.__private__.f2=function(E){if(isNaN(E))throw new Error("Invalid argument passed to jsPDF.f2");return Qe(E,2)},pe=V.__private__.f3=function(E){if(isNaN(E))throw new Error("Invalid argument passed to jsPDF.f3");return Qe(E,3)},me=V.scale=V.__private__.scale=function(E){if(isNaN(E))throw new Error("Invalid argument passed to jsPDF.scale");return ze===Se.COMPAT?E*Rt:ze===Se.ADVANCED?E:void 0},Ne=function(E){return ze===Se.COMPAT?wa()-E:ze===Se.ADVANCED?E:void 0},Le=function(E){return me(Ne(E))};V.__private__.setPrecision=V.setPrecision=function(E){typeof parseInt(E,10)=="number"&&(s=parseInt(E,10))};var et,it="00000000000000000000000000000000",nt=V.__private__.getFileId=function(){return it},Xe=V.__private__.setFileId=function(E){return it=E!==void 0&&/^[a-fA-F0-9]{32}$/.test(E)?E.toUpperCase():it.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),U!==null&&(Ar=new oh(U.userPermissions,U.userPassword,U.ownerPassword,it)),it};V.setFileId=function(E){return Xe(E),this},V.getFileId=function(){return nt()};var at=V.__private__.convertDateToPDFDate=function(E){var Q=E.getTimezoneOffset(),Ie=Q<0?"+":"-",Be=Math.floor(Math.abs(Q/60)),We=Math.abs(Q%60),ut=[Ie,ke(Be),"'",ke(We),"'"].join("");return["D:",E.getFullYear(),ke(E.getMonth()+1),ke(E.getDate()),ke(E.getHours()),ke(E.getMinutes()),ke(E.getSeconds()),ut].join("")},dt=V.__private__.convertPDFDateToDate=function(E){var Q=parseInt(E.substr(2,4),10),Ie=parseInt(E.substr(6,2),10)-1,Be=parseInt(E.substr(8,2),10),We=parseInt(E.substr(10,2),10),ut=parseInt(E.substr(12,2),10),Lt=parseInt(E.substr(14,2),10);return new Date(Q,Ie,Be,We,ut,Lt,0)},Mt=V.__private__.setCreationDate=function(E){var Q;if(E===void 0&&(E=new Date),E instanceof Date)Q=at(E);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(E))throw new Error("Invalid argument passed to jsPDF.setCreationDate");Q=E}return et=Q},ie=V.__private__.getCreationDate=function(E){var Q=et;return E==="jsDate"&&(Q=dt(et)),Q};V.setCreationDate=function(E){return Mt(E),this},V.getCreationDate=function(E){return ie(E)};var xe,ke=V.__private__.padd2=function(E){return("0"+parseInt(E)).slice(-2)},Fe=V.__private__.padd2Hex=function(E){return("00"+(E=E.toString())).substr(E.length)},qe=0,$e=[],Ke=[],tt=0,Tt=[],kt=[],Nt=!1,zt=Ke,ti=function(){qe=0,tt=0,Ke=[],$e=[],Tt=[],bi=xt(),ri=xt()};V.__private__.setCustomOutputDestination=function(E){Nt=!0,zt=E};var ht=function(E){Nt||(zt=E)};V.__private__.resetCustomOutputDestination=function(){Nt=!1,zt=Ke};var te=V.__private__.out=function(E){return E=E.toString(),tt+=E.length+1,zt.push(E),zt},gi=V.__private__.write=function(E){return te(arguments.length===1?E.toString():Array.prototype.join.call(arguments," "))},Ht=V.__private__.getArrayBuffer=function(E){for(var Q=E.length,Ie=new ArrayBuffer(Q),Be=new Uint8Array(Ie);Q--;)Be[Q]=E.charCodeAt(Q);return Ie},ft=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];V.__private__.getStandardFonts=function(){return ft};var Pt=d.fontSize||16;V.__private__.setFontSize=V.setFontSize=function(E){return Pt=ze===Se.ADVANCED?E/Rt:E,this};var Bt,Dt=V.__private__.getFontSize=V.getFontSize=function(){return ze===Se.COMPAT?Pt:Pt*Rt},Yt=d.R2L||!1;V.__private__.setR2L=V.setR2L=function(E){return Yt=E,this},V.__private__.getR2L=V.getR2L=function(){return Yt};var ii,ui=V.__private__.setZoomMode=function(E){var Q=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(E))Bt=E;else if(isNaN(E)){if(Q.indexOf(E)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+E+'" is not recognized.');Bt=E}else Bt=parseInt(E,10)};V.__private__.getZoomMode=function(){return Bt};var Pi,Ni=V.__private__.setPageMode=function(E){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(E)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+E+'" is not recognized.');ii=E};V.__private__.getPageMode=function(){return ii};var yt=V.__private__.setLayoutMode=function(E){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(E)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+E+'" is not recognized.');Pi=E};V.__private__.getLayoutMode=function(){return Pi},V.__private__.setDisplayMode=V.setDisplayMode=function(E,Q,Ie){return ui(E),yt(Q),Ni(Ie),this};var si={title:"",subject:"",author:"",keywords:"",creator:""};V.__private__.getDocumentProperty=function(E){if(Object.keys(si).indexOf(E)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return si[E]},V.__private__.getDocumentProperties=function(){return si},V.__private__.setDocumentProperties=V.setProperties=V.setDocumentProperties=function(E){for(var Q in si)si.hasOwnProperty(Q)&&E[Q]&&(si[Q]=E[Q]);return this},V.__private__.setDocumentProperty=function(E,Q){if(Object.keys(si).indexOf(E)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return si[E]=Q};var mi,Rt,nr,_t,ai,fe={},k={},D=[],ae={},Ee={},Re={},Ve={},lt=null,ee=0,B=[],q=new Bm(V),Y=d.hotfixes||[],ne={},ge={},ve=[],we=function E(Q,Ie,Be,We,ut,Lt){if(!(this instanceof E))return new E(Q,Ie,Be,We,ut,Lt);isNaN(Q)&&(Q=1),isNaN(Ie)&&(Ie=0),isNaN(Be)&&(Be=0),isNaN(We)&&(We=1),isNaN(ut)&&(ut=0),isNaN(Lt)&&(Lt=0),this._matrix=[Q,Ie,Be,We,ut,Lt]};Object.defineProperty(we.prototype,"sx",{get:function(){return this._matrix[0]},set:function(E){this._matrix[0]=E}}),Object.defineProperty(we.prototype,"shy",{get:function(){return this._matrix[1]},set:function(E){this._matrix[1]=E}}),Object.defineProperty(we.prototype,"shx",{get:function(){return this._matrix[2]},set:function(E){this._matrix[2]=E}}),Object.defineProperty(we.prototype,"sy",{get:function(){return this._matrix[3]},set:function(E){this._matrix[3]=E}}),Object.defineProperty(we.prototype,"tx",{get:function(){return this._matrix[4]},set:function(E){this._matrix[4]=E}}),Object.defineProperty(we.prototype,"ty",{get:function(){return this._matrix[5]},set:function(E){this._matrix[5]=E}}),Object.defineProperty(we.prototype,"a",{get:function(){return this._matrix[0]},set:function(E){this._matrix[0]=E}}),Object.defineProperty(we.prototype,"b",{get:function(){return this._matrix[1]},set:function(E){this._matrix[1]=E}}),Object.defineProperty(we.prototype,"c",{get:function(){return this._matrix[2]},set:function(E){this._matrix[2]=E}}),Object.defineProperty(we.prototype,"d",{get:function(){return this._matrix[3]},set:function(E){this._matrix[3]=E}}),Object.defineProperty(we.prototype,"e",{get:function(){return this._matrix[4]},set:function(E){this._matrix[4]=E}}),Object.defineProperty(we.prototype,"f",{get:function(){return this._matrix[5]},set:function(E){this._matrix[5]=E}}),Object.defineProperty(we.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(we.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(we.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(we.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),we.prototype.join=function(E){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(Ge).join(E)},we.prototype.multiply=function(E){var Q=E.sx*this.sx+E.shy*this.shx,Ie=E.sx*this.shy+E.shy*this.sy,Be=E.shx*this.sx+E.sy*this.shx,We=E.shx*this.shy+E.sy*this.sy,ut=E.tx*this.sx+E.ty*this.shx+this.tx,Lt=E.tx*this.shy+E.ty*this.sy+this.ty;return new we(Q,Ie,Be,We,ut,Lt)},we.prototype.decompose=function(){var E=this.sx,Q=this.shy,Ie=this.shx,Be=this.sy,We=this.tx,ut=this.ty,Lt=Math.sqrt(E*E+Q*Q),$t=(E/=Lt)*Ie+(Q/=Lt)*Be;Ie-=E*$t,Be-=Q*$t;var ci=Math.sqrt(Ie*Ie+Be*Be);return $t/=ci,E*(Be/=ci)<Q*(Ie/=ci)&&(E=-E,Q=-Q,$t=-$t,Lt=-Lt),{scale:new we(Lt,0,0,ci,0,0),translate:new we(1,0,0,1,We,ut),rotate:new we(E,Q,-Q,E,0,0),skew:new we(1,0,$t,1,0,0)}},we.prototype.toString=function(E){return this.join(" ")},we.prototype.inversed=function(){var E=this.sx,Q=this.shy,Ie=this.shx,Be=this.sy,We=this.tx,ut=this.ty,Lt=1/(E*Be-Q*Ie),$t=Be*Lt,ci=-Q*Lt,Ai=-Ie*Lt,Ii=E*Lt;return new we($t,ci,Ai,Ii,-$t*We-Ai*ut,-ci*We-Ii*ut)},we.prototype.applyToPoint=function(E){var Q=E.x*this.sx+E.y*this.shx+this.tx,Ie=E.x*this.shy+E.y*this.sy+this.ty;return new Gn(Q,Ie)},we.prototype.applyToRectangle=function(E){var Q=this.applyToPoint(E),Ie=this.applyToPoint(new Gn(E.x+E.w,E.y+E.h));return new ko(Q.x,Q.y,Ie.x-Q.x,Ie.y-Q.y)},we.prototype.clone=function(){var E=this.sx,Q=this.shy,Ie=this.shx,Be=this.sy,We=this.tx,ut=this.ty;return new we(E,Q,Ie,Be,We,ut)},V.Matrix=we;var be=V.matrixMult=function(E,Q){return Q.multiply(E)},He=new we(1,0,0,1,0,0);V.unitMatrix=V.identityMatrix=He;var st=function(E,Q){if(!Ee[E]){var Ie=(Q instanceof kc?"Sh":"P")+(Object.keys(ae).length+1).toString(10);Q.id=Ie,Ee[E]=Ie,ae[Ie]=Q,q.publish("addPattern",Q)}};V.ShadingPattern=kc,V.TilingPattern=uh,V.addShadingPattern=function(E,Q){return De("addShadingPattern()"),st(E,Q),this},V.beginTilingPattern=function(E){De("beginTilingPattern()"),ul(E.boundingBox[0],E.boundingBox[1],E.boundingBox[2]-E.boundingBox[0],E.boundingBox[3]-E.boundingBox[1],E.matrix)},V.endTilingPattern=function(E,Q){De("endTilingPattern()"),Q.stream=kt[xe].join(`
`),st(E,Q),q.publish("endTilingPattern",Q),ve.pop().restore()};var je=V.__private__.newObject=function(){var E=xt();return Ot(E,!0),E},xt=V.__private__.newObjectDeferred=function(){return qe++,$e[qe]=function(){return tt},qe},Ot=function(E,Q){return Q=typeof Q=="boolean"&&Q,$e[E]=tt,Q&&te(E+" 0 obj"),E},Xt=V.__private__.newAdditionalObject=function(){var E={objId:xt(),content:""};return Tt.push(E),E},bi=xt(),ri=xt(),wi=V.__private__.decodeColorString=function(E){var Q=E.split(" ");if(Q.length!==2||Q[1]!=="g"&&Q[1]!=="G")Q.length===5&&(Q[4]==="k"||Q[4]==="K")&&(Q=[(1-Q[0])*(1-Q[3]),(1-Q[1])*(1-Q[3]),(1-Q[2])*(1-Q[3]),"r"]);else{var Ie=parseFloat(Q[0]);Q=[Ie,Ie,Ie,"r"]}for(var Be="#",We=0;We<3;We++)Be+=("0"+Math.floor(255*parseFloat(Q[We])).toString(16)).slice(-2);return Be},yi=V.__private__.encodeColorString=function(E){var Q;typeof E=="string"&&(E={ch1:E});var Ie=E.ch1,Be=E.ch2,We=E.ch3,ut=E.ch4,Lt=E.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Ie=="string"&&Ie.charAt(0)!=="#"){var $t=new Bg(Ie);if($t.ok)Ie=$t.toHex();else if(!/^\d*\.?\d*$/.test(Ie))throw new Error('Invalid color "'+Ie+'" passed to jsPDF.encodeColorString.')}if(typeof Ie=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Ie)&&(Ie="#"+Ie[1]+Ie[1]+Ie[2]+Ie[2]+Ie[3]+Ie[3]),typeof Ie=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Ie)){var ci=parseInt(Ie.substr(1),16);Ie=ci>>16&255,Be=ci>>8&255,We=255&ci}if(Be===void 0||ut===void 0&&Ie===Be&&Be===We)if(typeof Ie=="string")Q=Ie+" "+Lt[0];else switch(E.precision){case 2:Q=pt(Ie/255)+" "+Lt[0];break;case 3:default:Q=pe(Ie/255)+" "+Lt[0]}else if(ut===void 0||dr(ut)==="object"){if(ut&&!isNaN(ut.a)&&ut.a===0)return Q=["1.","1.","1.",Lt[1]].join(" ");if(typeof Ie=="string")Q=[Ie,Be,We,Lt[1]].join(" ");else switch(E.precision){case 2:Q=[pt(Ie/255),pt(Be/255),pt(We/255),Lt[1]].join(" ");break;default:case 3:Q=[pe(Ie/255),pe(Be/255),pe(We/255),Lt[1]].join(" ")}}else if(typeof Ie=="string")Q=[Ie,Be,We,ut,Lt[2]].join(" ");else switch(E.precision){case 2:Q=[pt(Ie),pt(Be),pt(We),pt(ut),Lt[2]].join(" ");break;case 3:default:Q=[pe(Ie),pe(Be),pe(We),pe(ut),Lt[2]].join(" ")}return Q},Xi=V.__private__.getFilters=function(){return g},Ui=V.__private__.putStream=function(E){var Q=(E=E||{}).data||"",Ie=E.filters||Xi(),Be=E.alreadyAppliedFilters||[],We=E.addLength1||!1,ut=Q.length,Lt=E.objectId,$t=function(nn){return nn};if(U!==null&&Lt===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");U!==null&&($t=Ar.encryptor(Lt,0));var ci={};Ie===!0&&(Ie=["FlateEncode"]);var Ai=E.additionalKeyValues||[],Ii=(ci=Li.API.processDataByFilters!==void 0?Li.API.processDataByFilters(Q,Ie):{data:Q,reverseChain:[]}).reverseChain+(Array.isArray(Be)?Be.join(" "):Be.toString());if(ci.data.length!==0&&(Ai.push({key:"Length",value:ci.data.length}),We===!0&&Ai.push({key:"Length1",value:ut})),Ii.length!=0)if(Ii.split("/").length-1==1)Ai.push({key:"Filter",value:Ii});else{Ai.push({key:"Filter",value:"["+Ii+"]"});for(var Di=0;Di<Ai.length;Di+=1)if(Ai[Di].key==="DecodeParms"){for(var ar=[],kr=0;kr<ci.reverseChain.split("/").length-1;kr+=1)ar.push("null");ar.push(Ai[Di].value),Ai[Di].value="["+ar.join(" ")+"]"}}te("<<");for(var Ei=0;Ei<Ai.length;Ei++)te("/"+Ai[Ei].key+" "+Ai[Ei].value);te(">>"),ci.data.length!==0&&(te("stream"),te($t(ci.data)),te("endstream"))},_i=V.__private__.putPage=function(E){var Q=E.number,Ie=E.data,Be=E.objId,We=E.contentsObjId;Ot(Be,!0),te("<</Type /Page"),te("/Parent "+E.rootDictionaryObjId+" 0 R"),te("/Resources "+E.resourceDictionaryObjId+" 0 R"),te("/MediaBox ["+parseFloat(Ge(E.mediaBox.bottomLeftX))+" "+parseFloat(Ge(E.mediaBox.bottomLeftY))+" "+Ge(E.mediaBox.topRightX)+" "+Ge(E.mediaBox.topRightY)+"]"),E.cropBox!==null&&te("/CropBox ["+Ge(E.cropBox.bottomLeftX)+" "+Ge(E.cropBox.bottomLeftY)+" "+Ge(E.cropBox.topRightX)+" "+Ge(E.cropBox.topRightY)+"]"),E.bleedBox!==null&&te("/BleedBox ["+Ge(E.bleedBox.bottomLeftX)+" "+Ge(E.bleedBox.bottomLeftY)+" "+Ge(E.bleedBox.topRightX)+" "+Ge(E.bleedBox.topRightY)+"]"),E.trimBox!==null&&te("/TrimBox ["+Ge(E.trimBox.bottomLeftX)+" "+Ge(E.trimBox.bottomLeftY)+" "+Ge(E.trimBox.topRightX)+" "+Ge(E.trimBox.topRightY)+"]"),E.artBox!==null&&te("/ArtBox ["+Ge(E.artBox.bottomLeftX)+" "+Ge(E.artBox.bottomLeftY)+" "+Ge(E.artBox.topRightX)+" "+Ge(E.artBox.topRightY)+"]"),typeof E.userUnit=="number"&&E.userUnit!==1&&te("/UserUnit "+E.userUnit),q.publish("putPage",{objId:Be,pageContext:B[Q],pageNumber:Q,page:Ie}),te("/Contents "+We+" 0 R"),te(">>"),te("endobj");var ut=Ie.join(`
`);return ze===Se.ADVANCED&&(ut+=`
Q`),Ot(We,!0),Ui({data:ut,filters:Xi(),objectId:We}),te("endobj"),Be},qi=V.__private__.putPages=function(){var E,Q,Ie=[];for(E=1;E<=ee;E++)B[E].objId=xt(),B[E].contentsObjId=xt();for(E=1;E<=ee;E++)Ie.push(_i({number:E,data:kt[E],objId:B[E].objId,contentsObjId:B[E].contentsObjId,mediaBox:B[E].mediaBox,cropBox:B[E].cropBox,bleedBox:B[E].bleedBox,trimBox:B[E].trimBox,artBox:B[E].artBox,userUnit:B[E].userUnit,rootDictionaryObjId:bi,resourceDictionaryObjId:ri}));Ot(bi,!0),te("<</Type /Pages");var Be="/Kids [";for(Q=0;Q<ee;Q++)Be+=Ie[Q]+" 0 R ";te(Be+"]"),te("/Count "+ee),te(">>"),te("endobj"),q.publish("postPutPages")},Ki=function(E){q.publish("putFont",{font:E,out:te,newObject:je,putStream:Ui}),E.isAlreadyPutted!==!0&&(E.objectNumber=je(),te("<<"),te("/Type /Font"),te("/BaseFont /"+lh(E.postScriptName)),te("/Subtype /Type1"),typeof E.encoding=="string"&&te("/Encoding /"+E.encoding),te("/FirstChar 32"),te("/LastChar 255"),te(">>"),te("endobj"))},vr=function(){for(var E in fe)fe.hasOwnProperty(E)&&(O===!1||O===!0&&$.hasOwnProperty(E))&&Ki(fe[E])},wr=function(E){E.objectNumber=je();var Q=[];Q.push({key:"Type",value:"/XObject"}),Q.push({key:"Subtype",value:"/Form"}),Q.push({key:"BBox",value:"["+[Ge(E.x),Ge(E.y),Ge(E.x+E.width),Ge(E.y+E.height)].join(" ")+"]"}),Q.push({key:"Matrix",value:"["+E.matrix.toString()+"]"});var Ie=E.pages[1].join(`
`);Ui({data:Ie,additionalKeyValues:Q,objectId:E.objectNumber}),te("endobj")},zr=function(){for(var E in ne)ne.hasOwnProperty(E)&&wr(ne[E])},Xs=function(E,Q){var Ie,Be=[],We=1/(Q-1);for(Ie=0;Ie<1;Ie+=We)Be.push(Ie);if(Be.push(1),E[0].offset!=0){var ut={offset:0,color:E[0].color};E.unshift(ut)}if(E[E.length-1].offset!=1){var Lt={offset:1,color:E[E.length-1].color};E.push(Lt)}for(var $t="",ci=0,Ai=0;Ai<Be.length;Ai++){for(Ie=Be[Ai];Ie>E[ci+1].offset;)ci++;var Ii=E[ci].offset,Di=(Ie-Ii)/(E[ci+1].offset-Ii),ar=E[ci].color,kr=E[ci+1].color;$t+=Fe(Math.round((1-Di)*ar[0]+Di*kr[0]).toString(16))+Fe(Math.round((1-Di)*ar[1]+Di*kr[1]).toString(16))+Fe(Math.round((1-Di)*ar[2]+Di*kr[2]).toString(16))}return $t.trim()},$i=function(E,Q){Q||(Q=21);var Ie=je(),Be=Xs(E.colors,Q),We=[];We.push({key:"FunctionType",value:"0"}),We.push({key:"Domain",value:"[0.0 1.0]"}),We.push({key:"Size",value:"["+Q+"]"}),We.push({key:"BitsPerSample",value:"8"}),We.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),We.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Ui({data:Be,additionalKeyValues:We,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Ie}),te("endobj"),E.objectNumber=je(),te("<< /ShadingType "+E.type),te("/ColorSpace /DeviceRGB");var ut="/Coords ["+Ge(parseFloat(E.coords[0]))+" "+Ge(parseFloat(E.coords[1]))+" ";E.type===2?ut+=Ge(parseFloat(E.coords[2]))+" "+Ge(parseFloat(E.coords[3])):ut+=Ge(parseFloat(E.coords[2]))+" "+Ge(parseFloat(E.coords[3]))+" "+Ge(parseFloat(E.coords[4]))+" "+Ge(parseFloat(E.coords[5])),te(ut+="]"),E.matrix&&te("/Matrix ["+E.matrix.toString()+"]"),te("/Function "+Ie+" 0 R"),te("/Extend [true true]"),te(">>"),te("endobj")},rl=function(E,Q){var Ie=xt(),Be=je();Q.push({resourcesOid:Ie,objectOid:Be}),E.objectNumber=Be;var We=[];We.push({key:"Type",value:"/Pattern"}),We.push({key:"PatternType",value:"1"}),We.push({key:"PaintType",value:"1"}),We.push({key:"TilingType",value:"1"}),We.push({key:"BBox",value:"["+E.boundingBox.map(Ge).join(" ")+"]"}),We.push({key:"XStep",value:Ge(E.xStep)}),We.push({key:"YStep",value:Ge(E.yStep)}),We.push({key:"Resources",value:Ie+" 0 R"}),E.matrix&&We.push({key:"Matrix",value:"["+E.matrix.toString()+"]"}),Ui({data:E.stream,additionalKeyValues:We,objectId:E.objectNumber}),te("endobj")},ya=function(E){var Q;for(Q in ae)ae.hasOwnProperty(Q)&&(ae[Q]instanceof kc?$i(ae[Q]):ae[Q]instanceof uh&&rl(ae[Q],E))},tn=function(E){for(var Q in E.objectNumber=je(),te("<<"),E)switch(Q){case"opacity":te("/ca "+pt(E[Q]));break;case"stroke-opacity":te("/CA "+pt(E[Q]))}te(">>"),te("endobj")},fn=function(){var E;for(E in Re)Re.hasOwnProperty(E)&&tn(Re[E])},nl=function(){for(var E in te("/XObject <<"),ne)ne.hasOwnProperty(E)&&ne[E].objectNumber>=0&&te("/"+E+" "+ne[E].objectNumber+" 0 R");q.publish("putXobjectDict"),te(">>")},xn=function(){Ar.oid=je(),te("<<"),te("/Filter /Standard"),te("/V "+Ar.v),te("/R "+Ar.r),te("/U <"+Ar.toHexString(Ar.U)+">"),te("/O <"+Ar.toHexString(Ar.O)+">"),te("/P "+Ar.P),te(">>"),te("endobj")},rn=function(){for(var E in te("/Font <<"),fe)fe.hasOwnProperty(E)&&(O===!1||O===!0&&$.hasOwnProperty(E))&&te("/"+E+" "+fe[E].objectNumber+" 0 R");te(">>")},_a=function(){if(Object.keys(ae).length>0){for(var E in te("/Shading <<"),ae)ae.hasOwnProperty(E)&&ae[E]instanceof kc&&ae[E].objectNumber>=0&&te("/"+E+" "+ae[E].objectNumber+" 0 R");q.publish("putShadingPatternDict"),te(">>")}},$n=function(E){if(Object.keys(ae).length>0){for(var Q in te("/Pattern <<"),ae)ae.hasOwnProperty(Q)&&ae[Q]instanceof V.TilingPattern&&ae[Q].objectNumber>=0&&ae[Q].objectNumber<E&&te("/"+Q+" "+ae[Q].objectNumber+" 0 R");q.publish("putTilingPatternDict"),te(">>")}},Sr=function(){if(Object.keys(Re).length>0){var E;for(E in te("/ExtGState <<"),Re)Re.hasOwnProperty(E)&&Re[E].objectNumber>=0&&te("/"+E+" "+Re[E].objectNumber+" 0 R");q.publish("putGStateDict"),te(">>")}},sr=function(E){Ot(E.resourcesOid,!0),te("<<"),te("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),rn(),_a(),$n(E.objectOid),Sr(),nl(),te(">>"),te("endobj")},wn=function(){var E=[];vr(),fn(),zr(),ya(E),q.publish("putResources"),E.forEach(sr),sr({resourcesOid:ri,objectOid:Number.MAX_SAFE_INTEGER}),q.publish("postPutResources")},pr=function(){q.publish("putAdditionalObjects");for(var E=0;E<Tt.length;E++){var Q=Tt[E];Ot(Q.objId,!0),te(Q.content),te("endobj")}q.publish("postPutAdditionalObjects")},ja=function(E){k[E.fontName]=k[E.fontName]||{},k[E.fontName][E.fontStyle]=E.id},mn=function(E,Q,Ie,Be,We){var ut={id:"F"+(Object.keys(fe).length+1).toString(10),postScriptName:E,fontName:Q,fontStyle:Ie,encoding:Be,isStandardFont:We||!1,metadata:{}};return q.publish("addFont",{font:ut,instance:this}),fe[ut.id]=ut,ja(ut),ut.id},sl=function(E){for(var Q=0,Ie=ft.length;Q<Ie;Q++){var Be=mn.call(this,E[Q][0],E[Q][1],E[Q][2],ft[Q][3],!0);O===!1&&($[Be]=!0);var We=E[Q][0].split("-");ja({id:Be,fontName:We[0],fontStyle:We[1]||""})}q.publish("addFonts",{fonts:fe,dictionary:k})},Lr=function(E){return E.foo=function(){try{return E.apply(this,arguments)}catch(Be){var Q=Be.stack||"";~Q.indexOf(" at ")&&(Q=Q.split(" at ")[1]);var Ie="Error in function "+Q.split(`
`)[0].split("<")[0]+": "+Be.message;if(!ki.console)throw new Error(Ie);ki.console.error(Ie,Be),ki.alert&&alert(Ie)}},E.foo.bar=E,E.foo},fo=function(E,Q){var Ie,Be,We,ut,Lt,$t,ci,Ai,Ii;if(We=(Q=Q||{}).sourceEncoding||"Unicode",Lt=Q.outputEncoding,(Q.autoencode||Lt)&&fe[mi].metadata&&fe[mi].metadata[We]&&fe[mi].metadata[We].encoding&&(ut=fe[mi].metadata[We].encoding,!Lt&&fe[mi].encoding&&(Lt=fe[mi].encoding),!Lt&&ut.codePages&&(Lt=ut.codePages[0]),typeof Lt=="string"&&(Lt=ut[Lt]),Lt)){for(ci=!1,$t=[],Ie=0,Be=E.length;Ie<Be;Ie++)(Ai=Lt[E.charCodeAt(Ie)])?$t.push(String.fromCharCode(Ai)):$t.push(E[Ie]),$t[Ie].charCodeAt(0)>>8&&(ci=!0);E=$t.join("")}for(Ie=E.length;ci===void 0&&Ie!==0;)E.charCodeAt(Ie-1)>>8&&(ci=!0),Ie--;if(!ci)return E;for($t=Q.noBOM?[]:[254,255],Ie=0,Be=E.length;Ie<Be;Ie++){if((Ii=(Ai=E.charCodeAt(Ie))>>8)>>8)throw new Error("Character at position "+Ie+" of string '"+E+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");$t.push(Ii),$t.push(Ai-(Ii<<8))}return String.fromCharCode.apply(void 0,$t)},Zr=V.__private__.pdfEscape=V.pdfEscape=function(E,Q){return fo(E,Q).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},cs=V.__private__.beginPage=function(E){kt[++ee]=[],B[ee]={objId:0,contentsObjId:0,userUnit:Number(a),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(E[0]),topRightY:Number(E[1])}},mo(ee),ht(kt[xe])},hs=function(E,Q){var Ie,Be,We;switch(u=Q||u,typeof E=="string"&&(Ie=ue(E.toLowerCase()),Array.isArray(Ie)&&(Be=Ie[0],We=Ie[1])),Array.isArray(E)&&(Be=E[0]*Rt,We=E[1]*Rt),isNaN(Be)&&(Be=y[0],We=y[1]),(Be>14400||We>14400)&&(xr.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Be=Math.min(14400,Be),We=Math.min(14400,We)),y=[Be,We],u.substr(0,1)){case"l":We>Be&&(y=[We,Be]);break;case"p":Be>We&&(y=[We,Be])}cs(y),Rl($a),te(ps),Po!==0&&te(Po+" J"),Lo!==0&&te(Lo+" j"),q.publish("addPage",{pageNumber:ee})},Vi=function(E){E>0&&E<=ee&&(kt.splice(E,1),B.splice(E,1),ee--,xe>ee&&(xe=ee),this.setPage(xe))},mo=function(E){E>0&&E<=ee&&(xe=E)},al=V.__private__.getNumberOfPages=V.getNumberOfPages=function(){return kt.length-1},Ks=function(E,Q,Ie){var Be,We=void 0;return Ie=Ie||{},E=E!==void 0?E:fe[mi].fontName,Q=Q!==void 0?Q:fe[mi].fontStyle,Be=E.toLowerCase(),k[Be]!==void 0&&k[Be][Q]!==void 0?We=k[Be][Q]:k[E]!==void 0&&k[E][Q]!==void 0?We=k[E][Q]:Ie.disableWarning===!1&&xr.warn("Unable to look up font label for font '"+E+"', '"+Q+"'. Refer to getFontList() for available fonts."),We||Ie.noFallback||(We=k.times[Q])==null&&(We=k.times.normal),We},ol=V.__private__.putInfo=function(){var E=je(),Q=function(Be){return Be};for(var Ie in U!==null&&(Q=Ar.encryptor(E,0)),te("<<"),te("/Producer ("+Zr(Q("jsPDF "+Li.version))+")"),si)si.hasOwnProperty(Ie)&&si[Ie]&&te("/"+Ie.substr(0,1).toUpperCase()+Ie.substr(1)+" ("+Zr(Q(si[Ie]))+")");te("/CreationDate ("+Zr(Q(et))+")"),te(">>"),te("endobj")},va=V.__private__.putCatalog=function(E){var Q=(E=E||{}).rootDictionaryObjId||bi;switch(je(),te("<<"),te("/Type /Catalog"),te("/Pages "+Q+" 0 R"),Bt||(Bt="fullwidth"),Bt){case"fullwidth":te("/OpenAction [3 0 R /FitH null]");break;case"fullheight":te("/OpenAction [3 0 R /FitV null]");break;case"fullpage":te("/OpenAction [3 0 R /Fit]");break;case"original":te("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Ie=""+Bt;Ie.substr(Ie.length-1)==="%"&&(Bt=parseInt(Bt)/100),typeof Bt=="number"&&te("/OpenAction [3 0 R /XYZ null null "+pt(Bt)+"]")}switch(Pi||(Pi="continuous"),Pi){case"continuous":te("/PageLayout /OneColumn");break;case"single":te("/PageLayout /SinglePage");break;case"two":case"twoleft":te("/PageLayout /TwoColumnLeft");break;case"tworight":te("/PageLayout /TwoColumnRight")}ii&&te("/PageMode /"+ii),q.publish("putCatalog"),te(">>"),te("endobj")},qa=V.__private__.putTrailer=function(){te("trailer"),te("<<"),te("/Size "+(qe+1)),te("/Root "+qe+" 0 R"),te("/Info "+(qe-1)+" 0 R"),U!==null&&te("/Encrypt "+Ar.oid+" 0 R"),te("/ID [ <"+it+"> <"+it+"> ]"),te(">>")},go=V.__private__.putHeader=function(){te("%PDF-"+ye),te("%ºß¬à")},ba=V.__private__.putXRef=function(){var E="0000000000";te("xref"),te("0 "+(qe+1)),te("0000000000 65535 f ");for(var Q=1;Q<=qe;Q++)typeof $e[Q]=="function"?te((E+$e[Q]()).slice(-10)+" 00000 n "):$e[Q]!==void 0?te((E+$e[Q]).slice(-10)+" 00000 n "):te("0000000000 00000 n ")},Ps=V.__private__.buildDocument=function(){ti(),ht(Ke),q.publish("buildDocument"),go(),qi(),pr(),wn(),U!==null&&xn(),ol(),va();var E=tt;return ba(),qa(),te("startxref"),te(""+E),te("%%EOF"),ht(kt[xe]),Ke.join(`
`)},yo=V.__private__.getBlob=function(E){return new Blob([Ht(E)],{type:"application/pdf"})},Va=V.output=V.__private__.output=Lr(function(E,Q){switch(typeof(Q=Q||{})=="string"?Q={filename:Q}:Q.filename=Q.filename||"generated.pdf",E){case void 0:return Ps();case"save":V.save(Q.filename);break;case"arraybuffer":return Ht(Ps());case"blob":return yo(Ps());case"bloburi":case"bloburl":if(ki.URL!==void 0&&typeof ki.URL.createObjectURL=="function")return ki.URL&&ki.URL.createObjectURL(yo(Ps()))||void 0;xr.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Ie="",Be=Ps();try{Ie=cp(Be)}catch{Ie=cp(unescape(encodeURIComponent(Be)))}return"data:application/pdf;filename="+Q.filename+";base64,"+Ie;case"pdfobjectnewwindow":if(Object.prototype.toString.call(ki)==="[object Window]"){var We="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",ut=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';Q.pdfObjectUrl&&(We=Q.pdfObjectUrl,ut="");var Lt='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+We+'"'+ut+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(Q)+");<\/script></body></html>",$t=ki.open();return $t!==null&&$t.document.write(Lt),$t}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(ki)==="[object Window]"){var ci='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(Q.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+Q.filename+'" width="500px" height="400px" /></body></html>',Ai=ki.open();if(Ai!==null){Ai.document.write(ci);var Ii=this;Ai.document.documentElement.querySelector("#pdfViewer").onload=function(){Ai.document.title=Q.filename,Ai.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Ii.output("bloburl"))}}return Ai}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(ki)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Di='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",Q)+'"></iframe></body></html>',ar=ki.open();if(ar!==null&&(ar.document.write(Di),ar.document.title=Q.filename),ar||typeof safari>"u")return ar;break;case"datauri":case"dataurl":return ki.document.location.href=this.output("datauristring",Q);default:return null}}),Dl=function(E){return Array.isArray(Y)===!0&&Y.indexOf(E)>-1};switch(f){case"pt":Rt=1;break;case"mm":Rt=72/25.4;break;case"cm":Rt=72/2.54;break;case"in":Rt=72;break;case"px":Rt=Dl("px_scaling")==1?.75:96/72;break;case"pc":case"em":Rt=12;break;case"ex":Rt=6;break;default:if(typeof f!="number")throw new Error("Invalid unit: "+f);Rt=f}var Ar=null;Mt(),Xe();var Ua=function(E){return U!==null?Ar.encryptor(E,0):function(Q){return Q}},Gr=V.__private__.getPageInfo=V.getPageInfo=function(E){if(isNaN(E)||E%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:B[E].objId,pageNumber:E,pageContext:B[E]}},oi=V.__private__.getPageInfoByObjId=function(E){if(isNaN(E)||E%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var Q in B)if(B[Q].objId===E)break;return Gr(Q)},_o=V.__private__.getCurrentPageInfo=V.getCurrentPageInfo=function(){return{objId:B[xe].objId,pageNumber:xe,pageContext:B[xe]}};V.addPage=function(){return hs.apply(this,arguments),this},V.setPage=function(){return mo.apply(this,arguments),ht.call(this,kt[xe]),this},V.insertPage=function(E){return this.addPage(),this.movePage(xe,E),this},V.movePage=function(E,Q){var Ie,Be;if(E>Q){Ie=kt[E],Be=B[E];for(var We=E;We>Q;We--)kt[We]=kt[We-1],B[We]=B[We-1];kt[Q]=Ie,B[Q]=Be,this.setPage(Q)}else if(E<Q){Ie=kt[E],Be=B[E];for(var ut=E;ut<Q;ut++)kt[ut]=kt[ut+1],B[ut]=B[ut+1];kt[Q]=Ie,B[Q]=Be,this.setPage(Q)}return this},V.deletePage=function(){return Vi.apply(this,arguments),this},V.__private__.text=V.text=function(E,Q,Ie,Be,We){var ut,Lt,$t,ci,Ai,Ii,Di,ar,kr,Ei=(Be=Be||{}).scope||this;if(typeof E=="number"&&typeof Q=="number"&&(typeof Ie=="string"||Array.isArray(Ie))){var nn=Ie;Ie=Q,Q=E,E=nn}if(arguments[3]instanceof we?(De("The transform parameter of text() with a Matrix value"),kr=We):($t=arguments[4],ci=arguments[5],dr(Di=arguments[3])==="object"&&Di!==null||(typeof $t=="string"&&(ci=$t,$t=null),typeof Di=="string"&&(ci=Di,Di=null),typeof Di=="number"&&($t=Di,Di=null),Be={flags:Di,angle:$t,align:ci})),isNaN(Q)||isNaN(Ie)||E==null)throw new Error("Invalid arguments passed to jsPDF.text");if(E.length===0)return Ei;var li="",Sn=!1,Oi=typeof Be.lineHeightFactor=="number"?Be.lineHeightFactor:Js,Bi=Ei.internal.scaleFactor;function Cs(zi){return zi=zi.split("	").join(Array(Be.TabLen||9).join(" ")),Zr(zi,Di)}function Qs(zi){for(var Zi,Ir=zi.concat(),Dr=[],Yi=Ir.length;Yi--;)typeof(Zi=Ir.shift())=="string"?Dr.push(Zi):Array.isArray(zi)&&(Zi.length===1||Zi[1]===void 0&&Zi[2]===void 0)?Dr.push(Zi[0]):Dr.push([Zi[0],Zi[1],Zi[2]]);return Dr}function ea(zi,Zi){var Ir;if(typeof zi=="string")Ir=Zi(zi)[0];else if(Array.isArray(zi)){for(var Dr,Yi,yn=zi.concat(),qr=[],Ta=yn.length;Ta--;)typeof(Dr=yn.shift())=="string"?qr.push(Zi(Dr)[0]):Array.isArray(Dr)&&typeof Dr[0]=="string"&&(Yi=Zi(Dr[0],Dr[1],Dr[2]),qr.push([Yi[0],Yi[1],Yi[2]]));Ir=qr}return Ir}var Sa=!1,fs=!0;if(typeof E=="string")Sa=!0;else if(Array.isArray(E)){var Es=E.concat();Lt=[];for(var Wr,Or=Es.length;Or--;)(typeof(Wr=Es.shift())!="string"||Array.isArray(Wr)&&typeof Wr[0]!="string")&&(fs=!1);Sa=fs}if(Sa===!1)throw new Error('Type of text must be string or Array. "'+E+'" is not recognized.');typeof E=="string"&&(E=E.match(/[\r?\n]/)?E.split(/\r\n|\r|\n/g):[E]);var Aa=Pt/Ei.internal.scaleFactor,Ia=Aa*(Oi-1);switch(Be.baseline){case"bottom":Ie-=Ia;break;case"top":Ie+=Aa-Ia;break;case"hanging":Ie+=Aa-2*Ia;break;case"middle":Ie+=Aa/2-Ia}if((Ii=Be.maxWidth||0)>0&&(typeof E=="string"?E=Ei.splitTextToSize(E,Ii):Object.prototype.toString.call(E)==="[object Array]"&&(E=E.reduce(function(zi,Zi){return zi.concat(Ei.splitTextToSize(Zi,Ii))},[]))),ut={text:E,x:Q,y:Ie,options:Be,mutex:{pdfEscape:Zr,activeFontKey:mi,fonts:fe,activeFontSize:Pt}},q.publish("preProcessText",ut),E=ut.text,$t=(Be=ut.options).angle,!(kr instanceof we)&&$t&&typeof $t=="number"){$t*=Math.PI/180,Be.rotationDirection===0&&($t=-$t),ze===Se.ADVANCED&&($t=-$t);var Wn=Math.cos($t),ta=Math.sin($t);kr=new we(Wn,ta,-ta,Wn,0,0)}else $t&&$t instanceof we&&(kr=$t);ze!==Se.ADVANCED||kr||(kr=He),(Ai=Be.charSpace||xa)!==void 0&&(li+=Ge(me(Ai))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(ar=Be.horizontalScale)!==void 0&&(li+=Ge(100*ar)+` Tz
`),Be.lang;var jr=-1,Pa=Be.renderingMode!==void 0?Be.renderingMode:Be.stroke,ia=Ei.internal.getCurrentPageInfo().pageContext;switch(Pa){case 0:case!1:case"fill":jr=0;break;case 1:case!0:case"stroke":jr=1;break;case 2:case"fillThenStroke":jr=2;break;case 3:case"invisible":jr=3;break;case 4:case"fillAndAddForClipping":jr=4;break;case 5:case"strokeAndAddPathForClipping":jr=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":jr=6;break;case 7:case"addToPathForClipping":jr=7}var Wa=ia.usedRenderingMode!==void 0?ia.usedRenderingMode:-1;jr!==-1?li+=jr+` Tr
`:Wa!==-1&&(li+=`0 Tr
`),jr!==-1&&(ia.usedRenderingMode=jr),ci=Be.align||"left";var Hr,ms=Pt*Oi,pl=Ei.internal.pageSize.getWidth(),Eo=fe[mi];Ai=Be.charSpace||xa,Ii=Be.maxWidth||0,Di=Object.assign({autoencode:!0,noBOM:!0},Be.flags);var Mi=[],Ms=function(zi){return Ei.getStringUnitWidth(zi,{font:Eo,charSpace:Ai,fontSize:Pt,doKerning:!1})*Pt/Bi};if(Object.prototype.toString.call(E)==="[object Array]"){var An;Lt=Qs(E),ci!=="left"&&(Hr=Lt.map(Ms));var sn,Dn=0;if(ci==="right"){Q-=Hr[0],E=[],Or=Lt.length;for(var zs=0;zs<Or;zs++)zs===0?(sn=Ci(Q),An=Zn(Ie)):(sn=me(Dn-Hr[zs]),An=-ms),E.push([Lt[zs],sn,An]),Dn=Hr[zs]}else if(ci==="center"){Q-=Hr[0]/2,E=[],Or=Lt.length;for(var Hn=0;Hn<Or;Hn++)Hn===0?(sn=Ci(Q),An=Zn(Ie)):(sn=me((Dn-Hr[Hn])/2),An=-ms),E.push([Lt[Hn],sn,An]),Dn=Hr[Hn]}else if(ci==="left"){E=[],Or=Lt.length;for(var Ha=0;Ha<Or;Ha++)E.push(Lt[Ha])}else if(ci==="justify"&&Eo.encoding==="Identity-H"){E=[],Or=Lt.length,Ii=Ii!==0?Ii:pl;for(var Ns=0,fr=0;fr<Or;fr++)if(An=fr===0?Zn(Ie):-ms,sn=fr===0?Ci(Q):Ns,fr<Or-1){var La=me((Ii-Hr[fr])/(Lt[fr].split(" ").length-1)),Nr=Lt[fr].split(" ");E.push([Nr[0]+" ",sn,An]),Ns=0;for(var Xr=1;Xr<Nr.length;Xr++){var gs=(Ms(Nr[Xr-1]+" "+Nr[Xr])-Ms(Nr[Xr]))*Bi+La;Xr==Nr.length-1?E.push([Nr[Xr],gs,0]):E.push([Nr[Xr]+" ",gs,0]),Ns-=gs}}else E.push([Lt[fr],sn,An]);E.push(["",Ns,0])}else{if(ci!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(E=[],Or=Lt.length,Ii=Ii!==0?Ii:pl,fr=0;fr<Or;fr++)An=fr===0?Zn(Ie):-ms,sn=fr===0?Ci(Q):0,fr<Or-1?Mi.push(Ge(me((Ii-Hr[fr])/(Lt[fr].split(" ").length-1)))):Mi.push(0),E.push([Lt[fr],sn,An])}}var Mo=typeof Be.R2L=="boolean"?Be.R2L:Yt;Mo===!0&&(E=ea(E,function(zi,Zi,Ir){return[zi.split("").reverse().join(""),Zi,Ir]})),ut={text:E,x:Q,y:Ie,options:Be,mutex:{pdfEscape:Zr,activeFontKey:mi,fonts:fe,activeFontSize:Pt}},q.publish("postProcessText",ut),E=ut.text,Sn=ut.mutex.isHex||!1;var Ds=fe[mi].encoding;Ds!=="WinAnsiEncoding"&&Ds!=="StandardEncoding"||(E=ea(E,function(zi,Zi,Ir){return[Cs(zi),Zi,Ir]})),Lt=Qs(E),E=[];for(var ys,Fs,_s,ra=0,zo=1,ka=Array.isArray(Lt[0])?zo:ra,vs="",Xa=function(zi,Zi,Ir){var Dr="";return Ir instanceof we?(Ir=typeof Be.angle=="number"?be(Ir,new we(1,0,0,1,zi,Zi)):be(new we(1,0,0,1,zi,Zi),Ir),ze===Se.ADVANCED&&(Ir=be(new we(1,0,0,-1,0,0),Ir)),Dr=Ir.join(" ")+` Tm
`):Dr=Ge(zi)+" "+Ge(Zi)+` Td
`,Dr},an=0;an<Lt.length;an++){switch(vs="",ka){case zo:_s=(Sn?"<":"(")+Lt[an][0]+(Sn?">":")"),ys=parseFloat(Lt[an][1]),Fs=parseFloat(Lt[an][2]);break;case ra:_s=(Sn?"<":"(")+Lt[an]+(Sn?">":")"),ys=Ci(Q),Fs=Zn(Ie)}Mi!==void 0&&Mi[an]!==void 0&&(vs=Mi[an]+` Tw
`),an===0?E.push(vs+Xa(ys,Fs,kr)+_s):ka===ra?E.push(vs+_s):ka===zo&&E.push(vs+Xa(ys,Fs,kr)+_s)}E=ka===ra?E.join(` Tj
T* `):E.join(` Tj
`),E+=` Tj
`;var on=`BT
/`;return on+=mi+" "+Pt+` Tf
`,on+=Ge(Pt*Oi)+` TL
`,on+=Za+`
`,on+=li,on+=E,te(on+="ET"),$[mi]=!0,Ei};var vo=V.__private__.clip=V.clip=function(E){return te(E==="evenodd"?"W*":"W"),this};V.clipEvenOdd=function(){return vo("evenodd")},V.__private__.discardPath=V.discardPath=function(){return te("n"),this};var zn=V.__private__.isValidStyle=function(E){var Q=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(E)!==-1&&(Q=!0),Q};V.__private__.setDefaultPathOperation=V.setDefaultPathOperation=function(E){return zn(E)&&(F=E),this};var ll=V.__private__.getStyle=V.getStyle=function(E){var Q=F;switch(E){case"D":case"S":Q="S";break;case"F":Q="f";break;case"FD":case"DF":Q="B";break;case"f":case"f*":case"B":case"B*":Q=E}return Q},Ys=V.close=function(){return te("h"),this};V.stroke=function(){return te("S"),this},V.fill=function(E){return bo("f",E),this},V.fillEvenOdd=function(E){return bo("f*",E),this},V.fillStroke=function(E){return bo("B",E),this},V.fillStrokeEvenOdd=function(E){return bo("B*",E),this};var bo=function(E,Q){dr(Q)==="object"?oc(Q,E):te(E)},xo=function(E){E===null||ze===Se.ADVANCED&&E===void 0||(E=ll(E),te(E))};function Fl(E,Q,Ie,Be,We){var ut=new uh(Q||this.boundingBox,Ie||this.xStep,Be||this.yStep,this.gState,We||this.matrix);ut.stream=this.stream;var Lt=E+"$$"+this.cloneIndex+++"$$";return st(Lt,ut),ut}var oc=function(E,Q){var Ie=Ee[E.key],Be=ae[Ie];if(Be instanceof kc)te("q"),te(lc(Q)),Be.gState&&V.setGState(Be.gState),te(E.matrix.toString()+" cm"),te("/"+Ie+" sh"),te("Q");else if(Be instanceof uh){var We=new we(1,0,0,-1,0,wa());E.matrix&&(We=We.multiply(E.matrix||He),Ie=Fl.call(Be,E.key,E.boundingBox,E.xStep,E.yStep,We).id),te("q"),te("/Pattern cs"),te("/"+Ie+" scn"),Be.gState&&V.setGState(Be.gState),te(Q),te("Q")}},lc=function(E){switch(E){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},wo=V.moveTo=function(E,Q){return te(Ge(me(E))+" "+Ge(Le(Q))+" m"),this},us=V.lineTo=function(E,Q){return te(Ge(me(E))+" "+Ge(Le(Q))+" l"),this},Ls=V.curveTo=function(E,Q,Ie,Be,We,ut){return te([Ge(me(E)),Ge(Le(Q)),Ge(me(Ie)),Ge(Le(Be)),Ge(me(We)),Ge(Le(ut)),"c"].join(" ")),this};V.__private__.line=V.line=function(E,Q,Ie,Be,We){if(isNaN(E)||isNaN(Q)||isNaN(Ie)||isNaN(Be)||!zn(We))throw new Error("Invalid arguments passed to jsPDF.line");return ze===Se.COMPAT?this.lines([[Ie-E,Be-Q]],E,Q,[1,1],We||"S"):this.lines([[Ie-E,Be-Q]],E,Q,[1,1]).stroke()},V.__private__.lines=V.lines=function(E,Q,Ie,Be,We,ut){var Lt,$t,ci,Ai,Ii,Di,ar,kr,Ei,nn,li,Sn;if(typeof E=="number"&&(Sn=Ie,Ie=Q,Q=E,E=Sn),Be=Be||[1,1],ut=ut||!1,isNaN(Q)||isNaN(Ie)||!Array.isArray(E)||!Array.isArray(Be)||!zn(We)||typeof ut!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(wo(Q,Ie),Lt=Be[0],$t=Be[1],Ai=E.length,nn=Q,li=Ie,ci=0;ci<Ai;ci++)(Ii=E[ci]).length===2?(nn=Ii[0]*Lt+nn,li=Ii[1]*$t+li,us(nn,li)):(Di=Ii[0]*Lt+nn,ar=Ii[1]*$t+li,kr=Ii[2]*Lt+nn,Ei=Ii[3]*$t+li,nn=Ii[4]*Lt+nn,li=Ii[5]*$t+li,Ls(Di,ar,kr,Ei,nn,li));return ut&&Ys(),xo(We),this},V.path=function(E){for(var Q=0;Q<E.length;Q++){var Ie=E[Q],Be=Ie.c;switch(Ie.op){case"m":wo(Be[0],Be[1]);break;case"l":us(Be[0],Be[1]);break;case"c":Ls.apply(this,Be);break;case"h":Ys()}}return this},V.__private__.rect=V.rect=function(E,Q,Ie,Be,We){if(isNaN(E)||isNaN(Q)||isNaN(Ie)||isNaN(Be)||!zn(We))throw new Error("Invalid arguments passed to jsPDF.rect");return ze===Se.COMPAT&&(Be=-Be),te([Ge(me(E)),Ge(Le(Q)),Ge(me(Ie)),Ge(me(Be)),"re"].join(" ")),xo(We),this},V.__private__.triangle=V.triangle=function(E,Q,Ie,Be,We,ut,Lt){if(isNaN(E)||isNaN(Q)||isNaN(Ie)||isNaN(Be)||isNaN(We)||isNaN(ut)||!zn(Lt))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Ie-E,Be-Q],[We-Ie,ut-Be],[E-We,Q-ut]],E,Q,[1,1],Lt,!0),this},V.__private__.roundedRect=V.roundedRect=function(E,Q,Ie,Be,We,ut,Lt){if(isNaN(E)||isNaN(Q)||isNaN(Ie)||isNaN(Be)||isNaN(We)||isNaN(ut)||!zn(Lt))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var $t=4/3*(Math.SQRT2-1);return We=Math.min(We,.5*Ie),ut=Math.min(ut,.5*Be),this.lines([[Ie-2*We,0],[We*$t,0,We,ut-ut*$t,We,ut],[0,Be-2*ut],[0,ut*$t,-We*$t,ut,-We,ut],[2*We-Ie,0],[-We*$t,0,-We,-ut*$t,-We,-ut],[0,2*ut-Be],[0,-ut*$t,We*$t,-ut,We,-ut]],E+We,Q,[1,1],Lt,!0),this},V.__private__.ellipse=V.ellipse=function(E,Q,Ie,Be,We){if(isNaN(E)||isNaN(Q)||isNaN(Ie)||isNaN(Be)||!zn(We))throw new Error("Invalid arguments passed to jsPDF.ellipse");var ut=4/3*(Math.SQRT2-1)*Ie,Lt=4/3*(Math.SQRT2-1)*Be;return wo(E+Ie,Q),Ls(E+Ie,Q-Lt,E+ut,Q-Be,E,Q-Be),Ls(E-ut,Q-Be,E-Ie,Q-Lt,E-Ie,Q),Ls(E-Ie,Q+Lt,E-ut,Q+Be,E,Q+Be),Ls(E+ut,Q+Be,E+Ie,Q+Lt,E+Ie,Q),xo(We),this},V.__private__.circle=V.circle=function(E,Q,Ie,Be){if(isNaN(E)||isNaN(Q)||isNaN(Ie)||!zn(Be))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(E,Q,Ie,Ie,Be)},V.setFont=function(E,Q,Ie){return Ie&&(Q=ct(Q,Ie)),mi=Ks(E,Q,{disableWarning:!1}),this};var So=V.__private__.getFont=V.getFont=function(){return fe[Ks.apply(V,arguments)]};V.__private__.getFontList=V.getFontList=function(){var E,Q,Ie={};for(E in k)if(k.hasOwnProperty(E))for(Q in Ie[E]=[],k[E])k[E].hasOwnProperty(Q)&&Ie[E].push(Q);return Ie},V.addFont=function(E,Q,Ie,Be,We){var ut=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&ut.indexOf(arguments[3])!==-1?We=arguments[3]:arguments[3]&&ut.indexOf(arguments[3])==-1&&(Ie=ct(Ie,Be)),We=We||"Identity-H",mn.call(this,E,Q,Ie,We)};var Js,$a=d.lineWidth||.200025,gn=V.__private__.getLineWidth=V.getLineWidth=function(){return $a},Rl=V.__private__.setLineWidth=V.setLineWidth=function(E){return $a=E,te(Ge(me(E))+" w"),this};V.__private__.setLineDash=Li.API.setLineDash=Li.API.setLineDashPattern=function(E,Q){if(E=E||[],Q=Q||0,isNaN(Q)||!Array.isArray(E))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return E=E.map(function(Ie){return Ge(me(Ie))}).join(" "),Q=Ge(me(Q)),te("["+E+"] "+Q+" d"),this};var Ao=V.__private__.getLineHeight=V.getLineHeight=function(){return Pt*Js};V.__private__.getLineHeight=V.getLineHeight=function(){return Pt*Js};var ks=V.__private__.setLineHeightFactor=V.setLineHeightFactor=function(E){return typeof(E=E||1.15)=="number"&&(Js=E),this},ds=V.__private__.getLineHeightFactor=V.getLineHeightFactor=function(){return Js};ks(d.lineHeight);var Ci=V.__private__.getHorizontalCoordinate=function(E){return me(E)},Zn=V.__private__.getVerticalCoordinate=function(E){return ze===Se.ADVANCED?E:B[xe].mediaBox.topRightY-B[xe].mediaBox.bottomLeftY-me(E)},cc=V.__private__.getHorizontalCoordinateString=V.getHorizontalCoordinateString=function(E){return Ge(Ci(E))},Nn=V.__private__.getVerticalCoordinateString=V.getVerticalCoordinateString=function(E){return Ge(Zn(E))},ps=d.strokeColor||"0 G";V.__private__.getStrokeColor=V.getDrawColor=function(){return wi(ps)},V.__private__.setStrokeColor=V.setDrawColor=function(E,Q,Ie,Be){return ps=yi({ch1:E,ch2:Q,ch3:Ie,ch4:Be,pdfColorType:"draw",precision:2}),te(ps),this};var Io=d.fillColor||"0 g";V.__private__.getFillColor=V.getFillColor=function(){return wi(Io)},V.__private__.setFillColor=V.setFillColor=function(E,Q,Ie,Be){return Io=yi({ch1:E,ch2:Q,ch3:Ie,ch4:Be,pdfColorType:"fill",precision:2}),te(Io),this};var Za=d.textColor||"0 g",Ol=V.__private__.getTextColor=V.getTextColor=function(){return wi(Za)};V.__private__.setTextColor=V.setTextColor=function(E,Q,Ie,Be){return Za=yi({ch1:E,ch2:Q,ch3:Ie,ch4:Be,pdfColorType:"text",precision:3}),this};var xa=d.charSpace,Bl=V.__private__.getCharSpace=V.getCharSpace=function(){return parseFloat(xa||0)};V.__private__.setCharSpace=V.setCharSpace=function(E){if(isNaN(E))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return xa=E,this};var Po=0;V.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},V.__private__.setLineCap=V.setLineCap=function(E){var Q=V.CapJoinStyles[E];if(Q===void 0)throw new Error("Line cap style of '"+E+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Po=Q,te(Q+" J"),this};var Lo=0;V.__private__.setLineJoin=V.setLineJoin=function(E){var Q=V.CapJoinStyles[E];if(Q===void 0)throw new Error("Line join style of '"+E+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Lo=Q,te(Q+" j"),this},V.__private__.setLineMiterLimit=V.__private__.setMiterLimit=V.setLineMiterLimit=V.setMiterLimit=function(E){if(E=E||0,isNaN(E))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return te(Ge(me(E))+" M"),this},V.GState=ju,V.setGState=function(E){(E=typeof E=="string"?Re[Ve[E]]:cl(null,E)).equals(lt)||(te("/"+E.id+" gs"),lt=E)};var cl=function(E,Q){if(!E||!Ve[E]){var Ie=!1;for(var Be in Re)if(Re.hasOwnProperty(Be)&&Re[Be].equals(Q)){Ie=!0;break}if(Ie)Q=Re[Be];else{var We="GS"+(Object.keys(Re).length+1).toString(10);Re[We]=Q,Q.id=We}return E&&(Ve[E]=Q.id),q.publish("addGState",Q),Q}};V.addGState=function(E,Q){return cl(E,Q),this},V.saveGraphicsState=function(){return te("q"),D.push({key:mi,size:Pt,color:Za}),this},V.restoreGraphicsState=function(){te("Q");var E=D.pop();return mi=E.key,Pt=E.size,Za=E.color,lt=null,this},V.setCurrentTransformationMatrix=function(E){return te(E.toString()+" cm"),this},V.comment=function(E){return te("#"+E),this};var Gn=function(E,Q){var Ie=E||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Ie},set:function(ut){isNaN(ut)||(Ie=parseFloat(ut))}});var Be=Q||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Be},set:function(ut){isNaN(ut)||(Be=parseFloat(ut))}});var We="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return We},set:function(ut){We=ut.toString()}}),this},ko=function(E,Q,Ie,Be){Gn.call(this,E,Q),this.type="rect";var We=Ie||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return We},set:function(Lt){isNaN(Lt)||(We=parseFloat(Lt))}});var ut=Be||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return ut},set:function(Lt){isNaN(Lt)||(ut=parseFloat(Lt))}}),this},hl=function(){this.page=ee,this.currentPage=xe,this.pages=kt.slice(0),this.pagesContext=B.slice(0),this.x=nr,this.y=_t,this.matrix=ai,this.width=Ts(xe),this.height=wa(xe),this.outputDestination=zt,this.id="",this.objectNumber=-1};hl.prototype.restore=function(){ee=this.page,xe=this.currentPage,B=this.pagesContext,kt=this.pages,nr=this.x,_t=this.y,ai=this.matrix,dl(xe,this.width),Co(xe,this.height),zt=this.outputDestination};var ul=function(E,Q,Ie,Be,We){ve.push(new hl),ee=xe=0,kt=[],nr=E,_t=Q,ai=We,cs([Ie,Be])},Ga=function(E){if(ge[E])ve.pop().restore();else{var Q=new hl,Ie="Xo"+(Object.keys(ne).length+1).toString(10);Q.id=Ie,ge[E]=Ie,ne[Ie]=Q,q.publish("addFormObject",Q),ve.pop().restore()}};for(var To in V.beginFormObject=function(E,Q,Ie,Be,We){return ul(E,Q,Ie,Be,We),this},V.endFormObject=function(E){return Ga(E),this},V.doFormObject=function(E,Q){var Ie=ne[ge[E]];return te("q"),te(Q.toString()+" cm"),te("/"+Ie.id+" Do"),te("Q"),this},V.getFormObject=function(E){var Q=ne[ge[E]];return{x:Q.x,y:Q.y,width:Q.width,height:Q.height,matrix:Q.matrix}},V.save=function(E,Q){return E=E||"generated.pdf",(Q=Q||{}).returnPromise=Q.returnPromise||!1,Q.returnPromise===!1?(Lc(yo(Ps()),E),typeof Lc.unload=="function"&&ki.setTimeout&&setTimeout(Lc.unload,911),this):new Promise(function(Ie,Be){try{var We=Lc(yo(Ps()),E);typeof Lc.unload=="function"&&ki.setTimeout&&setTimeout(Lc.unload,911),Ie(We)}catch(ut){Be(ut.message)}})},Li.API)Li.API.hasOwnProperty(To)&&(To==="events"&&Li.API.events.length?function(E,Q){var Ie,Be,We;for(We=Q.length-1;We!==-1;We--)Ie=Q[We][0],Be=Q[We][1],E.subscribe.apply(E,[Ie].concat(typeof Be=="function"?[Be]:Be))}(q,Li.API.events):V[To]=Li.API[To]);var Ts=V.getPageWidth=function(E){return(B[E=E||xe].mediaBox.topRightX-B[E].mediaBox.bottomLeftX)/Rt},dl=V.setPageWidth=function(E,Q){B[E].mediaBox.topRightX=Q*Rt+B[E].mediaBox.bottomLeftX},wa=V.getPageHeight=function(E){return(B[E=E||xe].mediaBox.topRightY-B[E].mediaBox.bottomLeftY)/Rt},Co=V.setPageHeight=function(E,Q){B[E].mediaBox.topRightY=Q*Rt+B[E].mediaBox.bottomLeftY};return V.internal={pdfEscape:Zr,getStyle:ll,getFont:So,getFontSize:Dt,getCharSpace:Bl,getTextColor:Ol,getLineHeight:Ao,getLineHeightFactor:ds,getLineWidth:gn,write:gi,getHorizontalCoordinate:Ci,getVerticalCoordinate:Zn,getCoordinateString:cc,getVerticalCoordinateString:Nn,collections:{},newObject:je,newAdditionalObject:Xt,newObjectDeferred:xt,newObjectDeferredBegin:Ot,getFilters:Xi,putStream:Ui,events:q,scaleFactor:Rt,pageSize:{getWidth:function(){return Ts(xe)},setWidth:function(E){dl(xe,E)},getHeight:function(){return wa(xe)},setHeight:function(E){Co(xe,E)}},encryptionOptions:U,encryption:Ar,getEncryptor:Ua,output:Va,getNumberOfPages:al,pages:kt,out:te,f2:pt,f3:pe,getPageInfo:Gr,getPageInfoByObjId:oi,getCurrentPageInfo:_o,getPDFVersion:de,Point:Gn,Rectangle:ko,Matrix:we,hasHotfix:Dl},Object.defineProperty(V.internal.pageSize,"width",{get:function(){return Ts(xe)},set:function(E){dl(xe,E)},enumerable:!0,configurable:!0}),Object.defineProperty(V.internal.pageSize,"height",{get:function(){return wa(xe)},set:function(E){Co(xe,E)},enumerable:!0,configurable:!0}),sl.call(V,ft),mi="F1",hs(y,u),q.publish("initialized"),V}oh.prototype.lsbFirstWord=function(d){return String.fromCharCode(d>>0&255,d>>8&255,d>>16&255,d>>24&255)},oh.prototype.toHexString=function(d){return d.split("").map(function(s){return("0"+(255&s.charCodeAt(0)).toString(16)).slice(-2)}).join("")},oh.prototype.hexToBytes=function(d){for(var s=[],u=0;u<d.length;u+=2)s.push(String.fromCharCode(parseInt(d.substr(u,2),16)));return s.join("")},oh.prototype.processOwnerPassword=function(d,s){return up(hp(s).substr(0,5),d)},oh.prototype.encryptor=function(d,s){var u=hp(this.encryptionKey+String.fromCharCode(255&d,d>>8&255,d>>16&255,255&s,s>>8&255)).substr(0,10);return function(f){return up(u,f)}},ju.prototype.equals=function(d){var s,u="id,objectNumber,equals";if(!d||dr(d)!==dr(this))return!1;var f=0;for(s in this)if(!(u.indexOf(s)>=0)){if(this.hasOwnProperty(s)&&!d.hasOwnProperty(s)||this[s]!==d[s])return!1;f++}for(s in d)d.hasOwnProperty(s)&&u.indexOf(s)<0&&f--;return f===0},Li.API={events:[]},Li.version="2.5.2";var $r=Li.API,kp=1,Mc=function(d){return d.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},nh=function(d){return d.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Fi=function(d){return d.toFixed(2)},ec=function(d){return d.toFixed(5)};$r.__acroform__={};var Ws=function(d,s){d.prototype=Object.create(s.prototype),d.prototype.constructor=d},jm=function(d){return d*kp},Qo=function(d){var s=new Ug,u=ni.internal.getHeight(d)||0,f=ni.internal.getWidth(d)||0;return s.BBox=[0,0,Number(Fi(f)),Number(Fi(u))],s},Cv=$r.__acroform__.setBit=function(d,s){if(d=d||0,s=s||0,isNaN(d)||isNaN(s))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return d|=1<<s},Ev=$r.__acroform__.clearBit=function(d,s){if(d=d||0,s=s||0,isNaN(d)||isNaN(s))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return d&=~(1<<s)},Mv=$r.__acroform__.getBit=function(d,s){if(isNaN(d)||isNaN(s))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return d&1<<s?1:0},Jr=$r.__acroform__.getBitForPdf=function(d,s){if(isNaN(d)||isNaN(s))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Mv(d,s-1)},Qr=$r.__acroform__.setBitForPdf=function(d,s){if(isNaN(d)||isNaN(s))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Cv(d,s-1)},en=$r.__acroform__.clearBitForPdf=function(d,s){if(isNaN(d)||isNaN(s))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Ev(d,s-1)},zv=$r.__acroform__.calculateCoordinates=function(d,s){var u=s.internal.getHorizontalCoordinate,f=s.internal.getVerticalCoordinate,y=d[0],_=d[1],g=d[2],a=d[3],C={};return C.lowerLeft_X=u(y)||0,C.lowerLeft_Y=f(_+a)||0,C.upperRight_X=u(y+g)||0,C.upperRight_Y=f(_)||0,[Number(Fi(C.lowerLeft_X)),Number(Fi(C.lowerLeft_Y)),Number(Fi(C.upperRight_X)),Number(Fi(C.upperRight_Y))]},Nv=function(d){if(d.appearanceStreamContent)return d.appearanceStreamContent;if(d.V||d.DV){var s=[],u=d._V||d.DV,f=dp(d,u),y=d.scope.internal.getFont(d.fontName,d.fontStyle).id;s.push("/Tx BMC"),s.push("q"),s.push("BT"),s.push(d.scope.__private__.encodeColorString(d.color)),s.push("/"+y+" "+Fi(f.fontSize)+" Tf"),s.push("1 0 0 1 0 0 Tm"),s.push(f.text),s.push("ET"),s.push("Q"),s.push("EMC");var _=Qo(d);return _.scope=d.scope,_.stream=s.join(`
`),_}},dp=function(d,s){var u=d.fontSize===0?d.maxFontSize:d.fontSize,f={text:"",fontSize:""},y=(s=(s=s.substr(0,1)=="("?s.substr(1):s).substr(s.length-1)==")"?s.substr(0,s.length-1):s).split(" ");y=d.multiline?y.map(function(pe){return pe.split(`
`)}):y.map(function(pe){return[pe]});var _=u,g=ni.internal.getHeight(d)||0;g=g<0?-g:g;var a=ni.internal.getWidth(d)||0;a=a<0?-a:a;var C=function(pe,me,Ne){if(pe+1<y.length){var Le=me+" "+y[pe+1][0];return Eu(Le,d,Ne).width<=a-4}return!1};_++;e:for(;_>0;){s="",_--;var F,U,O=Eu("3",d,_).height,$=d.multiline?g-_:(g-O)/2,V=$+=2,ye=0,de=0,Pe=0;if(_<=0){s=`(...) Tj
`,s+="% Width of Text: "+Eu(s,d,_=12).width+", FieldWidth:"+a+`
`;break}for(var ue="",Se=0,ze=0;ze<y.length;ze++)if(y.hasOwnProperty(ze)){var Ye=!1;if(y[ze].length!==1&&Pe!==y[ze].length-1){if((O+2)*(Se+2)+2>g)continue e;ue+=y[ze][Pe],Ye=!0,de=ze,ze--}else{ue=(ue+=y[ze][Pe]+" ").substr(ue.length-1)==" "?ue.substr(0,ue.length-1):ue;var Je=parseInt(ze),ct=C(Je,ue,_),Ge=ze>=y.length-1;if(ct&&!Ge){ue+=" ",Pe=0;continue}if(ct||Ge){if(Ge)de=Je;else if(d.multiline&&(O+2)*(Se+2)+2>g)continue e}else{if(!d.multiline||(O+2)*(Se+2)+2>g)continue e;de=Je}}for(var De="",Qe=ye;Qe<=de;Qe++){var pt=y[Qe];if(d.multiline){if(Qe===de){De+=pt[Pe]+" ",Pe=(Pe+1)%pt.length;continue}if(Qe===ye){De+=pt[pt.length-1]+" ";continue}}De+=pt[0]+" "}switch(De=De.substr(De.length-1)==" "?De.substr(0,De.length-1):De,U=Eu(De,d,_).width,d.textAlign){case"right":F=a-U-2;break;case"center":F=(a-U)/2;break;case"left":default:F=2}s+=Fi(F)+" "+Fi(V)+` Td
`,s+="("+Mc(De)+`) Tj
`,s+=-Fi(F)+` 0 Td
`,V=-(_+2),U=0,ye=Ye?de:de+1,Se++,ue=""}break}return f.text=s,f.fontSize=_,f},Eu=function(d,s,u){var f=s.scope.internal.getFont(s.fontName,s.fontStyle),y=s.scope.getStringUnitWidth(d,{font:f,fontSize:parseFloat(u),charSpace:0})*parseFloat(u);return{height:s.scope.getStringUnitWidth("3",{font:f,fontSize:parseFloat(u),charSpace:0})*parseFloat(u)*1.5,width:y}},Dv={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},Fv=function(d,s){var u={type:"reference",object:d};s.internal.getPageInfo(d.page).pageContext.annotations.find(function(f){return f.type===u.type&&f.object===u.object})===void 0&&s.internal.getPageInfo(d.page).pageContext.annotations.push(u)},Rv=function(d,s){for(var u in d)if(d.hasOwnProperty(u)){var f=u,y=d[u];s.internal.newObjectDeferredBegin(y.objId,!0),dr(y)==="object"&&typeof y.putStream=="function"&&y.putStream(),delete d[f]}},Ov=function(d,s){if(s.scope=d,d.internal!==void 0&&(d.internal.acroformPlugin===void 0||d.internal.acroformPlugin.isInitialized===!1)){if(uo.FieldNum=0,d.internal.acroformPlugin=JSON.parse(JSON.stringify(Dv)),d.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");kp=d.internal.scaleFactor,d.internal.acroformPlugin.acroFormDictionaryRoot=new $g,d.internal.acroformPlugin.acroFormDictionaryRoot.scope=d,d.internal.acroformPlugin.acroFormDictionaryRoot._eventID=d.internal.events.subscribe("postPutResources",function(){(function(u){u.internal.events.unsubscribe(u.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete u.internal.acroformPlugin.acroFormDictionaryRoot._eventID,u.internal.acroformPlugin.printedOut=!0})(d)}),d.internal.events.subscribe("buildDocument",function(){(function(u){u.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var f=u.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var y in f)if(f.hasOwnProperty(y)){var _=f[y];_.objId=void 0,_.hasAnnotation&&Fv(_,u)}})(d)}),d.internal.events.subscribe("putCatalog",function(){(function(u){if(u.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");u.internal.write("/AcroForm "+u.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(d)}),d.internal.events.subscribe("postPutPages",function(u){(function(f,y){var _=!f;for(var g in f||(y.internal.newObjectDeferredBegin(y.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),y.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),f=f||y.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(f.hasOwnProperty(g)){var a=f[g],C=[],F=a.Rect;if(a.Rect&&(a.Rect=zv(a.Rect,y)),y.internal.newObjectDeferredBegin(a.objId,!0),a.DA=ni.createDefaultAppearanceStream(a),dr(a)==="object"&&typeof a.getKeyValueListForStream=="function"&&(C=a.getKeyValueListForStream()),a.Rect=F,a.hasAppearanceStream&&!a.appearanceStreamContent){var U=Nv(a);C.push({key:"AP",value:"<</N "+U+">>"}),y.internal.acroformPlugin.xForms.push(U)}if(a.appearanceStreamContent){var O="";for(var $ in a.appearanceStreamContent)if(a.appearanceStreamContent.hasOwnProperty($)){var V=a.appearanceStreamContent[$];if(O+="/"+$+" ",O+="<<",Object.keys(V).length>=1||Array.isArray(V)){for(var g in V)if(V.hasOwnProperty(g)){var ye=V[g];typeof ye=="function"&&(ye=ye.call(y,a)),O+="/"+g+" "+ye+" ",y.internal.acroformPlugin.xForms.indexOf(ye)>=0||y.internal.acroformPlugin.xForms.push(ye)}}else typeof(ye=V)=="function"&&(ye=ye.call(y,a)),O+="/"+g+" "+ye,y.internal.acroformPlugin.xForms.indexOf(ye)>=0||y.internal.acroformPlugin.xForms.push(ye);O+=">>"}C.push({key:"AP",value:`<<
`+O+">>"})}y.internal.putStream({additionalKeyValues:C,objectId:a.objId}),y.internal.out("endobj")}_&&Rv(y.internal.acroformPlugin.xForms,y)})(u,d)}),d.internal.acroformPlugin.isInitialized=!0}},Vg=$r.__acroform__.arrayToPdfArray=function(d,s,u){var f=function(g){return g};if(Array.isArray(d)){for(var y="[",_=0;_<d.length;_++)switch(_!==0&&(y+=" "),dr(d[_])){case"boolean":case"number":case"object":y+=d[_].toString();break;case"string":d[_].substr(0,1)!=="/"?(s!==void 0&&u&&(f=u.internal.getEncryptor(s)),y+="("+Mc(f(d[_].toString()))+")"):y+=d[_].toString()}return y+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},Hd=function(d,s,u){var f=function(y){return y};return s!==void 0&&u&&(f=u.internal.getEncryptor(s)),(d=d||"").toString(),d="("+Mc(f(d))+")"},el=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(d){this._objId=d}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};el.prototype.toString=function(){return this.objId+" 0 R"},el.prototype.putStream=function(){var d=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:d,objectId:this.objId}),this.scope.internal.out("endobj")},el.prototype.getKeyValueListForStream=function(){var d=[],s=Object.getOwnPropertyNames(this).filter(function(_){return _!="content"&&_!="appearanceStreamContent"&&_!="scope"&&_!="objId"&&_.substring(0,1)!="_"});for(var u in s)if(Object.getOwnPropertyDescriptor(this,s[u]).configurable===!1){var f=s[u],y=this[f];y&&(Array.isArray(y)?d.push({key:f,value:Vg(y,this.objId,this.scope)}):y instanceof el?(y.scope=this.scope,d.push({key:f,value:y.objId+" 0 R"})):typeof y!="function"&&d.push({key:f,value:y}))}return d};var Ug=function(){el.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var d,s=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return s},set:function(u){s=u}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(u){d=u.trim()},get:function(){return d||null}})};Ws(Ug,el);var $g=function(){el.call(this);var d,s=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return s.length>0?s:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return s}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(d){var u=function(f){return f};return this.scope&&(u=this.scope.internal.getEncryptor(this.objId)),"("+Mc(u(d))+")"}},set:function(u){d=u}})};Ws($g,el);var uo=function d(){el.call(this);var s=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return s},set:function(ue){if(isNaN(ue))throw new Error('Invalid value "'+ue+'" for attribute F supplied.');s=ue}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Jr(s,3)},set:function(ue){ue?this.F=Qr(s,3):this.F=en(s,3)}});var u=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return u},set:function(ue){if(isNaN(ue))throw new Error('Invalid value "'+ue+'" for attribute Ff supplied.');u=ue}});var f=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(f.length!==0)return f},set:function(ue){f=ue!==void 0?ue:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!f||isNaN(f[0])?0:f[0]},set:function(ue){f[0]=ue}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!f||isNaN(f[1])?0:f[1]},set:function(ue){f[1]=ue}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!f||isNaN(f[2])?0:f[2]},set:function(ue){f[2]=ue}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!f||isNaN(f[3])?0:f[3]},set:function(ue){f[3]=ue}});var y="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return y},set:function(ue){switch(ue){case"/Btn":case"/Tx":case"/Ch":case"/Sig":y=ue;break;default:throw new Error('Invalid value "'+ue+'" for attribute FT supplied.')}}});var _=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!_||_.length<1){if(this instanceof qu)return;_="FieldObject"+d.FieldNum++}var ue=function(Se){return Se};return this.scope&&(ue=this.scope.internal.getEncryptor(this.objId)),"("+Mc(ue(_))+")"},set:function(ue){_=ue.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return _},set:function(ue){_=ue}});var g="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return g},set:function(ue){g=ue}});var a="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return a},set:function(ue){a=ue}});var C=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return C},set:function(ue){C=ue}});var F=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return F===void 0?50/kp:F},set:function(ue){F=ue}});var U="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return U},set:function(ue){U=ue}});var O="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!O||this instanceof qu||this instanceof Cc))return Hd(O,this.objId,this.scope)},set:function(ue){ue=ue.toString(),O=ue}});var $=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if($)return this instanceof Cn?$:Hd($,this.objId,this.scope)},set:function(ue){ue=ue.toString(),$=this instanceof Cn?ue:ue.substr(0,1)==="("?nh(ue.substr(1,ue.length-2)):nh(ue)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Cn?nh($.substr(1,$.length-1)):$},set:function(ue){ue=ue.toString(),$=this instanceof Cn?"/"+ue:ue}});var V=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(V)return V},set:function(ue){this.V=ue}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(V)return this instanceof Cn?V:Hd(V,this.objId,this.scope)},set:function(ue){ue=ue.toString(),V=this instanceof Cn?ue:ue.substr(0,1)==="("?nh(ue.substr(1,ue.length-2)):nh(ue)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Cn?nh(V.substr(1,V.length-1)):V},set:function(ue){ue=ue.toString(),V=this instanceof Cn?"/"+ue:ue}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var ye,de=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return de},set:function(ue){ue=!!ue,de=ue}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(ye)return ye},set:function(ue){ye=ue}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Jr(this.Ff,1)},set:function(ue){ue?this.Ff=Qr(this.Ff,1):this.Ff=en(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Jr(this.Ff,2)},set:function(ue){ue?this.Ff=Qr(this.Ff,2):this.Ff=en(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Jr(this.Ff,3)},set:function(ue){ue?this.Ff=Qr(this.Ff,3):this.Ff=en(this.Ff,3)}});var Pe=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(Pe!==null)return Pe},set:function(ue){if([0,1,2].indexOf(ue)===-1)throw new Error('Invalid value "'+ue+'" for attribute Q supplied.');Pe=ue}}),Object.defineProperty(this,"textAlign",{get:function(){var ue;switch(Pe){case 0:default:ue="left";break;case 1:ue="center";break;case 2:ue="right"}return ue},configurable:!0,enumerable:!0,set:function(ue){switch(ue){case"right":case 2:Pe=2;break;case"center":case 1:Pe=1;break;case"left":case 0:default:Pe=0}}})};Ws(uo,el);var fh=function(){uo.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var d=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return d},set:function(u){d=u}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return d},set:function(u){d=u}});var s=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return Vg(s,this.objId,this.scope)},set:function(u){var f,y;y=[],typeof(f=u)=="string"&&(y=function(_,g,a){a||(a=1);for(var C,F=[];C=g.exec(_);)F.push(C[a]);return F}(f,/\((.*?)\)/g)),s=y}}),this.getOptions=function(){return s},this.setOptions=function(u){s=u,this.sort&&s.sort()},this.addOption=function(u){u=(u=u||"").toString(),s.push(u),this.sort&&s.sort()},this.removeOption=function(u,f){for(f=f||!1,u=(u=u||"").toString();s.indexOf(u)!==-1&&(s.splice(s.indexOf(u),1),f!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Jr(this.Ff,18)},set:function(u){u?this.Ff=Qr(this.Ff,18):this.Ff=en(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Jr(this.Ff,19)},set:function(u){this.combo===!0&&(u?this.Ff=Qr(this.Ff,19):this.Ff=en(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Jr(this.Ff,20)},set:function(u){u?(this.Ff=Qr(this.Ff,20),s.sort()):this.Ff=en(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Jr(this.Ff,22)},set:function(u){u?this.Ff=Qr(this.Ff,22):this.Ff=en(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Jr(this.Ff,23)},set:function(u){u?this.Ff=Qr(this.Ff,23):this.Ff=en(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Jr(this.Ff,27)},set:function(u){u?this.Ff=Qr(this.Ff,27):this.Ff=en(this.Ff,27)}}),this.hasAppearanceStream=!1};Ws(fh,uo);var mh=function(){fh.call(this),this.fontName="helvetica",this.combo=!1};Ws(mh,fh);var gh=function(){mh.call(this),this.combo=!0};Ws(gh,mh);var Du=function(){gh.call(this),this.edit=!0};Ws(Du,gh);var Cn=function(){uo.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Jr(this.Ff,15)},set:function(u){u?this.Ff=Qr(this.Ff,15):this.Ff=en(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Jr(this.Ff,16)},set:function(u){u?this.Ff=Qr(this.Ff,16):this.Ff=en(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Jr(this.Ff,17)},set:function(u){u?this.Ff=Qr(this.Ff,17):this.Ff=en(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Jr(this.Ff,26)},set:function(u){u?this.Ff=Qr(this.Ff,26):this.Ff=en(this.Ff,26)}});var d,s={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var u=function(_){return _};if(this.scope&&(u=this.scope.internal.getEncryptor(this.objId)),Object.keys(s).length!==0){var f,y=[];for(f in y.push("<<"),s)y.push("/"+f+" ("+Mc(u(s[f]))+")");return y.push(">>"),y.join(`
`)}},set:function(u){dr(u)==="object"&&(s=u)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return s.CA||""},set:function(u){typeof u=="string"&&(s.CA=u)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return d},set:function(u){d=u}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return d.substr(1,d.length-1)},set:function(u){d="/"+u}})};Ws(Cn,uo);var Fu=function(){Cn.call(this),this.pushButton=!0};Ws(Fu,Cn);var yh=function(){Cn.call(this),this.radio=!0,this.pushButton=!1;var d=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return d},set:function(s){d=s!==void 0?s:[]}})};Ws(yh,Cn);var qu=function(){var d,s;uo.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return d},set:function(y){d=y}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return s},set:function(y){s=y}});var u,f={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var y=function(a){return a};this.scope&&(y=this.scope.internal.getEncryptor(this.objId));var _,g=[];for(_ in g.push("<<"),f)g.push("/"+_+" ("+Mc(y(f[_]))+")");return g.push(">>"),g.join(`
`)},set:function(y){dr(y)==="object"&&(f=y)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return f.CA||""},set:function(y){typeof y=="string"&&(f.CA=y)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return u},set:function(y){u=y}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return u.substr(1,u.length-1)},set:function(y){u="/"+y}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=ni.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Ws(qu,uo),yh.prototype.setAppearance=function(d){if(!("createAppearanceStream"in d)||!("getCA"in d))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var s in this.Kids)if(this.Kids.hasOwnProperty(s)){var u=this.Kids[s];u.appearanceStreamContent=d.createAppearanceStream(u.optionName),u.caption=d.getCA()}},yh.prototype.createOption=function(d){var s=new qu;return s.Parent=this,s.optionName=d,this.Kids.push(s),Bv.call(this.scope,s),s};var Ru=function(){Cn.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=ni.CheckBox.createAppearanceStream()};Ws(Ru,Cn);var Cc=function(){uo.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Jr(this.Ff,13)},set:function(s){s?this.Ff=Qr(this.Ff,13):this.Ff=en(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Jr(this.Ff,21)},set:function(s){s?this.Ff=Qr(this.Ff,21):this.Ff=en(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Jr(this.Ff,23)},set:function(s){s?this.Ff=Qr(this.Ff,23):this.Ff=en(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Jr(this.Ff,24)},set:function(s){s?this.Ff=Qr(this.Ff,24):this.Ff=en(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Jr(this.Ff,25)},set:function(s){s?this.Ff=Qr(this.Ff,25):this.Ff=en(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Jr(this.Ff,26)},set:function(s){s?this.Ff=Qr(this.Ff,26):this.Ff=en(this.Ff,26)}});var d=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return d},set:function(s){d=s}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return d},set:function(s){Number.isInteger(s)&&(d=s)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Ws(Cc,uo);var Ou=function(){Cc.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Jr(this.Ff,14)},set:function(d){d?this.Ff=Qr(this.Ff,14):this.Ff=en(this.Ff,14)}}),this.password=!0};Ws(Ou,Cc);var ni={CheckBox:{createAppearanceStream:function(){return{N:{On:ni.CheckBox.YesNormal},D:{On:ni.CheckBox.YesPushDown,Off:ni.CheckBox.OffPushDown}}},YesPushDown:function(d){var s=Qo(d);s.scope=d.scope;var u=[],f=d.scope.internal.getFont(d.fontName,d.fontStyle).id,y=d.scope.__private__.encodeColorString(d.color),_=dp(d,d.caption);return u.push("0.749023 g"),u.push("0 0 "+Fi(ni.internal.getWidth(d))+" "+Fi(ni.internal.getHeight(d))+" re"),u.push("f"),u.push("BMC"),u.push("q"),u.push("0 0 1 rg"),u.push("/"+f+" "+Fi(_.fontSize)+" Tf "+y),u.push("BT"),u.push(_.text),u.push("ET"),u.push("Q"),u.push("EMC"),s.stream=u.join(`
`),s},YesNormal:function(d){var s=Qo(d);s.scope=d.scope;var u=d.scope.internal.getFont(d.fontName,d.fontStyle).id,f=d.scope.__private__.encodeColorString(d.color),y=[],_=ni.internal.getHeight(d),g=ni.internal.getWidth(d),a=dp(d,d.caption);return y.push("1 g"),y.push("0 0 "+Fi(g)+" "+Fi(_)+" re"),y.push("f"),y.push("q"),y.push("0 0 1 rg"),y.push("0 0 "+Fi(g-1)+" "+Fi(_-1)+" re"),y.push("W"),y.push("n"),y.push("0 g"),y.push("BT"),y.push("/"+u+" "+Fi(a.fontSize)+" Tf "+f),y.push(a.text),y.push("ET"),y.push("Q"),s.stream=y.join(`
`),s},OffPushDown:function(d){var s=Qo(d);s.scope=d.scope;var u=[];return u.push("0.749023 g"),u.push("0 0 "+Fi(ni.internal.getWidth(d))+" "+Fi(ni.internal.getHeight(d))+" re"),u.push("f"),s.stream=u.join(`
`),s}},RadioButton:{Circle:{createAppearanceStream:function(d){var s={D:{Off:ni.RadioButton.Circle.OffPushDown},N:{}};return s.N[d]=ni.RadioButton.Circle.YesNormal,s.D[d]=ni.RadioButton.Circle.YesPushDown,s},getCA:function(){return"l"},YesNormal:function(d){var s=Qo(d);s.scope=d.scope;var u=[],f=ni.internal.getWidth(d)<=ni.internal.getHeight(d)?ni.internal.getWidth(d)/4:ni.internal.getHeight(d)/4;f=Number((.9*f).toFixed(5));var y=ni.internal.Bezier_C,_=Number((f*y).toFixed(5));return u.push("q"),u.push("1 0 0 1 "+ec(ni.internal.getWidth(d)/2)+" "+ec(ni.internal.getHeight(d)/2)+" cm"),u.push(f+" 0 m"),u.push(f+" "+_+" "+_+" "+f+" 0 "+f+" c"),u.push("-"+_+" "+f+" -"+f+" "+_+" -"+f+" 0 c"),u.push("-"+f+" -"+_+" -"+_+" -"+f+" 0 -"+f+" c"),u.push(_+" -"+f+" "+f+" -"+_+" "+f+" 0 c"),u.push("f"),u.push("Q"),s.stream=u.join(`
`),s},YesPushDown:function(d){var s=Qo(d);s.scope=d.scope;var u=[],f=ni.internal.getWidth(d)<=ni.internal.getHeight(d)?ni.internal.getWidth(d)/4:ni.internal.getHeight(d)/4;f=Number((.9*f).toFixed(5));var y=Number((2*f).toFixed(5)),_=Number((y*ni.internal.Bezier_C).toFixed(5)),g=Number((f*ni.internal.Bezier_C).toFixed(5));return u.push("0.749023 g"),u.push("q"),u.push("1 0 0 1 "+ec(ni.internal.getWidth(d)/2)+" "+ec(ni.internal.getHeight(d)/2)+" cm"),u.push(y+" 0 m"),u.push(y+" "+_+" "+_+" "+y+" 0 "+y+" c"),u.push("-"+_+" "+y+" -"+y+" "+_+" -"+y+" 0 c"),u.push("-"+y+" -"+_+" -"+_+" -"+y+" 0 -"+y+" c"),u.push(_+" -"+y+" "+y+" -"+_+" "+y+" 0 c"),u.push("f"),u.push("Q"),u.push("0 g"),u.push("q"),u.push("1 0 0 1 "+ec(ni.internal.getWidth(d)/2)+" "+ec(ni.internal.getHeight(d)/2)+" cm"),u.push(f+" 0 m"),u.push(f+" "+g+" "+g+" "+f+" 0 "+f+" c"),u.push("-"+g+" "+f+" -"+f+" "+g+" -"+f+" 0 c"),u.push("-"+f+" -"+g+" -"+g+" -"+f+" 0 -"+f+" c"),u.push(g+" -"+f+" "+f+" -"+g+" "+f+" 0 c"),u.push("f"),u.push("Q"),s.stream=u.join(`
`),s},OffPushDown:function(d){var s=Qo(d);s.scope=d.scope;var u=[],f=ni.internal.getWidth(d)<=ni.internal.getHeight(d)?ni.internal.getWidth(d)/4:ni.internal.getHeight(d)/4;f=Number((.9*f).toFixed(5));var y=Number((2*f).toFixed(5)),_=Number((y*ni.internal.Bezier_C).toFixed(5));return u.push("0.749023 g"),u.push("q"),u.push("1 0 0 1 "+ec(ni.internal.getWidth(d)/2)+" "+ec(ni.internal.getHeight(d)/2)+" cm"),u.push(y+" 0 m"),u.push(y+" "+_+" "+_+" "+y+" 0 "+y+" c"),u.push("-"+_+" "+y+" -"+y+" "+_+" -"+y+" 0 c"),u.push("-"+y+" -"+_+" -"+_+" -"+y+" 0 -"+y+" c"),u.push(_+" -"+y+" "+y+" -"+_+" "+y+" 0 c"),u.push("f"),u.push("Q"),s.stream=u.join(`
`),s}},Cross:{createAppearanceStream:function(d){var s={D:{Off:ni.RadioButton.Cross.OffPushDown},N:{}};return s.N[d]=ni.RadioButton.Cross.YesNormal,s.D[d]=ni.RadioButton.Cross.YesPushDown,s},getCA:function(){return"8"},YesNormal:function(d){var s=Qo(d);s.scope=d.scope;var u=[],f=ni.internal.calculateCross(d);return u.push("q"),u.push("1 1 "+Fi(ni.internal.getWidth(d)-2)+" "+Fi(ni.internal.getHeight(d)-2)+" re"),u.push("W"),u.push("n"),u.push(Fi(f.x1.x)+" "+Fi(f.x1.y)+" m"),u.push(Fi(f.x2.x)+" "+Fi(f.x2.y)+" l"),u.push(Fi(f.x4.x)+" "+Fi(f.x4.y)+" m"),u.push(Fi(f.x3.x)+" "+Fi(f.x3.y)+" l"),u.push("s"),u.push("Q"),s.stream=u.join(`
`),s},YesPushDown:function(d){var s=Qo(d);s.scope=d.scope;var u=ni.internal.calculateCross(d),f=[];return f.push("0.749023 g"),f.push("0 0 "+Fi(ni.internal.getWidth(d))+" "+Fi(ni.internal.getHeight(d))+" re"),f.push("f"),f.push("q"),f.push("1 1 "+Fi(ni.internal.getWidth(d)-2)+" "+Fi(ni.internal.getHeight(d)-2)+" re"),f.push("W"),f.push("n"),f.push(Fi(u.x1.x)+" "+Fi(u.x1.y)+" m"),f.push(Fi(u.x2.x)+" "+Fi(u.x2.y)+" l"),f.push(Fi(u.x4.x)+" "+Fi(u.x4.y)+" m"),f.push(Fi(u.x3.x)+" "+Fi(u.x3.y)+" l"),f.push("s"),f.push("Q"),s.stream=f.join(`
`),s},OffPushDown:function(d){var s=Qo(d);s.scope=d.scope;var u=[];return u.push("0.749023 g"),u.push("0 0 "+Fi(ni.internal.getWidth(d))+" "+Fi(ni.internal.getHeight(d))+" re"),u.push("f"),s.stream=u.join(`
`),s}}},createDefaultAppearanceStream:function(d){var s=d.scope.internal.getFont(d.fontName,d.fontStyle).id,u=d.scope.__private__.encodeColorString(d.color);return"/"+s+" "+d.fontSize+" Tf "+u}};ni.internal={Bezier_C:.551915024494,calculateCross:function(d){var s=ni.internal.getWidth(d),u=ni.internal.getHeight(d),f=Math.min(s,u);return{x1:{x:(s-f)/2,y:(u-f)/2+f},x2:{x:(s-f)/2+f,y:(u-f)/2},x3:{x:(s-f)/2,y:(u-f)/2},x4:{x:(s-f)/2+f,y:(u-f)/2+f}}}},ni.internal.getWidth=function(d){var s=0;return dr(d)==="object"&&(s=jm(d.Rect[2])),s},ni.internal.getHeight=function(d){var s=0;return dr(d)==="object"&&(s=jm(d.Rect[3])),s};var Bv=$r.addField=function(d){if(Ov(this,d),!(d instanceof uo))throw new Error("Invalid argument passed to jsPDF.addField.");var s;return(s=d).scope.internal.acroformPlugin.printedOut&&(s.scope.internal.acroformPlugin.printedOut=!1,s.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),s.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(s),d.page=d.scope.internal.getCurrentPageInfo().pageNumber,this};$r.AcroFormChoiceField=fh,$r.AcroFormListBox=mh,$r.AcroFormComboBox=gh,$r.AcroFormEditBox=Du,$r.AcroFormButton=Cn,$r.AcroFormPushButton=Fu,$r.AcroFormRadioButton=yh,$r.AcroFormCheckBox=Ru,$r.AcroFormTextField=Cc,$r.AcroFormPasswordField=Ou,$r.AcroFormAppearance=ni,$r.AcroForm={ChoiceField:fh,ListBox:mh,ComboBox:gh,EditBox:Du,Button:Cn,PushButton:Fu,RadioButton:yh,CheckBox:Ru,TextField:Cc,PasswordField:Ou,Appearance:ni},Li.AcroForm={ChoiceField:fh,ListBox:mh,ComboBox:gh,EditBox:Du,Button:Cn,PushButton:Fu,RadioButton:yh,CheckBox:Ru,TextField:Cc,PasswordField:Ou,Appearance:ni};function Zg(d){return d.reduce(function(s,u,f){return s[u]=f,s},{})}(function(d){d.__addimage__={};var s="UNKNOWN",u={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},f=d.__addimage__.getImageFileTypeByImageData=function(pe,me){var Ne,Le,et,it,nt,Xe=s;if((me=me||s)==="RGBA"||pe.data!==void 0&&pe.data instanceof Uint8ClampedArray&&"height"in pe&&"width"in pe)return"RGBA";if(ct(pe))for(nt in u)for(et=u[nt],Ne=0;Ne<et.length;Ne+=1){for(it=!0,Le=0;Le<et[Ne].length;Le+=1)if(et[Ne][Le]!==void 0&&et[Ne][Le]!==pe[Le]){it=!1;break}if(it===!0){Xe=nt;break}}else for(nt in u)for(et=u[nt],Ne=0;Ne<et.length;Ne+=1){for(it=!0,Le=0;Le<et[Ne].length;Le+=1)if(et[Ne][Le]!==void 0&&et[Ne][Le]!==pe.charCodeAt(Le)){it=!1;break}if(it===!0){Xe=nt;break}}return Xe===s&&me!==s&&(Xe=me),Xe},y=function pe(me){for(var Ne=this.internal.write,Le=this.internal.putStream,et=(0,this.internal.getFilters)();et.indexOf("FlateEncode")!==-1;)et.splice(et.indexOf("FlateEncode"),1);me.objectId=this.internal.newObject();var it=[];if(it.push({key:"Type",value:"/XObject"}),it.push({key:"Subtype",value:"/Image"}),it.push({key:"Width",value:me.width}),it.push({key:"Height",value:me.height}),me.colorSpace===Pe.INDEXED?it.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(me.palette.length/3-1)+" "+("sMask"in me&&me.sMask!==void 0?me.objectId+2:me.objectId+1)+" 0 R]"}):(it.push({key:"ColorSpace",value:"/"+me.colorSpace}),me.colorSpace===Pe.DEVICE_CMYK&&it.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),it.push({key:"BitsPerComponent",value:me.bitsPerComponent}),"decodeParameters"in me&&me.decodeParameters!==void 0&&it.push({key:"DecodeParms",value:"<<"+me.decodeParameters+">>"}),"transparency"in me&&Array.isArray(me.transparency)){for(var nt="",Xe=0,at=me.transparency.length;Xe<at;Xe++)nt+=me.transparency[Xe]+" "+me.transparency[Xe]+" ";it.push({key:"Mask",value:"["+nt+"]"})}me.sMask!==void 0&&it.push({key:"SMask",value:me.objectId+1+" 0 R"});var dt=me.filter!==void 0?["/"+me.filter]:void 0;if(Le({data:me.data,additionalKeyValues:it,alreadyAppliedFilters:dt,objectId:me.objectId}),Ne("endobj"),"sMask"in me&&me.sMask!==void 0){var Mt="/Predictor "+me.predictor+" /Colors 1 /BitsPerComponent "+me.bitsPerComponent+" /Columns "+me.width,ie={width:me.width,height:me.height,colorSpace:"DeviceGray",bitsPerComponent:me.bitsPerComponent,decodeParameters:Mt,data:me.sMask};"filter"in me&&(ie.filter=me.filter),pe.call(this,ie)}if(me.colorSpace===Pe.INDEXED){var xe=this.internal.newObject();Le({data:De(new Uint8Array(me.palette)),objectId:xe}),Ne("endobj")}},_=function(){var pe=this.internal.collections.addImage_images;for(var me in pe)y.call(this,pe[me])},g=function(){var pe,me=this.internal.collections.addImage_images,Ne=this.internal.write;for(var Le in me)Ne("/I"+(pe=me[Le]).index,pe.objectId,"0","R")},a=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",_),this.internal.events.subscribe("putXobjectDict",g))},C=function(){var pe=this.internal.collections.addImage_images;return a.call(this),pe},F=function(){return Object.keys(this.internal.collections.addImage_images).length},U=function(pe){return typeof d["process"+pe.toUpperCase()]=="function"},O=function(pe){return dr(pe)==="object"&&pe.nodeType===1},$=function(pe,me){if(pe.nodeName==="IMG"&&pe.hasAttribute("src")){var Ne=""+pe.getAttribute("src");if(Ne.indexOf("data:image/")===0)return Jh(unescape(Ne).split("base64,").pop());var Le=d.loadFile(Ne,!0);if(Le!==void 0)return Le}if(pe.nodeName==="CANVAS"){if(pe.width===0||pe.height===0)throw new Error("Given canvas must have data. Canvas width: "+pe.width+", height: "+pe.height);var et;switch(me){case"PNG":et="image/png";break;case"WEBP":et="image/webp";break;case"JPEG":case"JPG":default:et="image/jpeg"}return Jh(pe.toDataURL(et,1).split("base64,").pop())}},V=function(pe){var me=this.internal.collections.addImage_images;if(me){for(var Ne in me)if(pe===me[Ne].alias)return me[Ne]}},ye=function(pe,me,Ne){return pe||me||(pe=-96,me=-96),pe<0&&(pe=-1*Ne.width*72/pe/this.internal.scaleFactor),me<0&&(me=-1*Ne.height*72/me/this.internal.scaleFactor),pe===0&&(pe=me*Ne.width/Ne.height),me===0&&(me=pe*Ne.height/Ne.width),[pe,me]},de=function(pe,me,Ne,Le,et,it){var nt=ye.call(this,Ne,Le,et),Xe=this.internal.getCoordinateString,at=this.internal.getVerticalCoordinateString,dt=C.call(this);if(Ne=nt[0],Le=nt[1],dt[et.index]=et,it){it*=Math.PI/180;var Mt=Math.cos(it),ie=Math.sin(it),xe=function(Fe){return Fe.toFixed(4)},ke=[xe(Mt),xe(ie),xe(-1*ie),xe(Mt),0,0,"cm"]}this.internal.write("q"),it?(this.internal.write([1,"0","0",1,Xe(pe),at(me+Le),"cm"].join(" ")),this.internal.write(ke.join(" ")),this.internal.write([Xe(Ne),"0","0",Xe(Le),"0","0","cm"].join(" "))):this.internal.write([Xe(Ne),"0","0",Xe(Le),Xe(pe),at(me+Le),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+et.index+" Do"),this.internal.write("Q")},Pe=d.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};d.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var ue=d.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},Se=d.__addimage__.sHashCode=function(pe){var me,Ne,Le=0;if(typeof pe=="string")for(Ne=pe.length,me=0;me<Ne;me++)Le=(Le<<5)-Le+pe.charCodeAt(me),Le|=0;else if(ct(pe))for(Ne=pe.byteLength/2,me=0;me<Ne;me++)Le=(Le<<5)-Le+pe[me],Le|=0;return Le},ze=d.__addimage__.validateStringAsBase64=function(pe){(pe=pe||"").toString().trim();var me=!0;return pe.length===0&&(me=!1),pe.length%4!=0&&(me=!1),/^[A-Za-z0-9+/]+$/.test(pe.substr(0,pe.length-2))===!1&&(me=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(pe.substr(-2))===!1&&(me=!1),me},Ye=d.__addimage__.extractImageFromDataUrl=function(pe){var me=(pe=pe||"").split("base64,"),Ne=null;if(me.length===2){var Le=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(me[0]);Array.isArray(Le)&&(Ne={mimeType:Le[1],charset:Le[2],data:me[1]})}return Ne},Je=d.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};d.__addimage__.isArrayBuffer=function(pe){return Je()&&pe instanceof ArrayBuffer};var ct=d.__addimage__.isArrayBufferView=function(pe){return Je()&&typeof Uint32Array<"u"&&(pe instanceof Int8Array||pe instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&pe instanceof Uint8ClampedArray||pe instanceof Int16Array||pe instanceof Uint16Array||pe instanceof Int32Array||pe instanceof Uint32Array||pe instanceof Float32Array||pe instanceof Float64Array)},Ge=d.__addimage__.binaryStringToUint8Array=function(pe){for(var me=pe.length,Ne=new Uint8Array(me),Le=0;Le<me;Le++)Ne[Le]=pe.charCodeAt(Le);return Ne},De=d.__addimage__.arrayBufferToBinaryString=function(pe){for(var me="",Ne=ct(pe)?pe:new Uint8Array(pe),Le=0;Le<Ne.length;Le+=8192)me+=String.fromCharCode.apply(null,Ne.subarray(Le,Le+8192));return me};d.addImage=function(){var pe,me,Ne,Le,et,it,nt,Xe,at;if(typeof arguments[1]=="number"?(me=s,Ne=arguments[1],Le=arguments[2],et=arguments[3],it=arguments[4],nt=arguments[5],Xe=arguments[6],at=arguments[7]):(me=arguments[1],Ne=arguments[2],Le=arguments[3],et=arguments[4],it=arguments[5],nt=arguments[6],Xe=arguments[7],at=arguments[8]),dr(pe=arguments[0])==="object"&&!O(pe)&&"imageData"in pe){var dt=pe;pe=dt.imageData,me=dt.format||me||s,Ne=dt.x||Ne||0,Le=dt.y||Le||0,et=dt.w||dt.width||et,it=dt.h||dt.height||it,nt=dt.alias||nt,Xe=dt.compression||Xe,at=dt.rotation||dt.angle||at}var Mt=this.internal.getFilters();if(Xe===void 0&&Mt.indexOf("FlateEncode")!==-1&&(Xe="SLOW"),isNaN(Ne)||isNaN(Le))throw new Error("Invalid coordinates passed to jsPDF.addImage");a.call(this);var ie=Qe.call(this,pe,me,nt,Xe);return de.call(this,Ne,Le,et,it,ie,at),this};var Qe=function(pe,me,Ne,Le){var et,it,nt;if(typeof pe=="string"&&f(pe)===s){pe=unescape(pe);var Xe=pt(pe,!1);(Xe!==""||(Xe=d.loadFile(pe,!0))!==void 0)&&(pe=Xe)}if(O(pe)&&(pe=$(pe,me)),me=f(pe,me),!U(me))throw new Error("addImage does not support files of type '"+me+"', please ensure that a plugin for '"+me+"' support is added.");if(((nt=Ne)==null||nt.length===0)&&(Ne=function(at){return typeof at=="string"||ct(at)?Se(at):ct(at.data)?Se(at.data):null}(pe)),(et=V.call(this,Ne))||(Je()&&(pe instanceof Uint8Array||me==="RGBA"||(it=pe,pe=Ge(pe))),et=this["process"+me.toUpperCase()](pe,F.call(this),Ne,function(at){return at&&typeof at=="string"&&(at=at.toUpperCase()),at in d.image_compression?at:ue.NONE}(Le),it)),!et)throw new Error("An unknown error occurred whilst processing the image.");return et},pt=d.__addimage__.convertBase64ToBinaryString=function(pe,me){var Ne;me=typeof me!="boolean"||me;var Le,et="";if(typeof pe=="string"){Le=(Ne=Ye(pe))!==null?Ne.data:pe;try{et=Jh(Le)}catch(it){if(me)throw ze(Le)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+it.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return et};d.getImageProperties=function(pe){var me,Ne,Le="";if(O(pe)&&(pe=$(pe)),typeof pe=="string"&&f(pe)===s&&((Le=pt(pe,!1))===""&&(Le=d.loadFile(pe)||""),pe=Le),Ne=f(pe),!U(Ne))throw new Error("addImage does not support files of type '"+Ne+"', please ensure that a plugin for '"+Ne+"' support is added.");if(!Je()||pe instanceof Uint8Array||(pe=Ge(pe)),!(me=this["process"+Ne.toUpperCase()](pe)))throw new Error("An unknown error occurred whilst processing the image");return me.fileType=Ne,me}})(Li.API),function(d){var s=function(u){if(u!==void 0&&u!="")return!0};Li.API.events.push(["addPage",function(u){this.internal.getPageInfo(u.pageNumber).pageContext.annotations=[]}]),d.events.push(["putPage",function(u){for(var f,y,_,g=this.internal.getCoordinateString,a=this.internal.getVerticalCoordinateString,C=this.internal.getPageInfoByObjId(u.objId),F=u.pageContext.annotations,U=!1,O=0;O<F.length&&!U;O++)switch((f=F[O]).type){case"link":(s(f.options.url)||s(f.options.pageNumber))&&(U=!0);break;case"reference":case"text":case"freetext":U=!0}if(U!=0){this.internal.write("/Annots [");for(var $=0;$<F.length;$++){f=F[$];var V=this.internal.pdfEscape,ye=this.internal.getEncryptor(u.objId);switch(f.type){case"reference":this.internal.write(" "+f.object.objId+" 0 R ");break;case"text":var de=this.internal.newAdditionalObject(),Pe=this.internal.newAdditionalObject(),ue=this.internal.getEncryptor(de.objId),Se=f.title||"Note";_="<</Type /Annot /Subtype /Text "+(y="/Rect ["+g(f.bounds.x)+" "+a(f.bounds.y+f.bounds.h)+" "+g(f.bounds.x+f.bounds.w)+" "+a(f.bounds.y)+"] ")+"/Contents ("+V(ue(f.contents))+")",_+=" /Popup "+Pe.objId+" 0 R",_+=" /P "+C.objId+" 0 R",_+=" /T ("+V(ue(Se))+") >>",de.content=_;var ze=de.objId+" 0 R";_="<</Type /Annot /Subtype /Popup "+(y="/Rect ["+g(f.bounds.x+30)+" "+a(f.bounds.y+f.bounds.h)+" "+g(f.bounds.x+f.bounds.w+30)+" "+a(f.bounds.y)+"] ")+" /Parent "+ze,f.open&&(_+=" /Open true"),_+=" >>",Pe.content=_,this.internal.write(de.objId,"0 R",Pe.objId,"0 R");break;case"freetext":y="/Rect ["+g(f.bounds.x)+" "+a(f.bounds.y)+" "+g(f.bounds.x+f.bounds.w)+" "+a(f.bounds.y+f.bounds.h)+"] ";var Ye=f.color||"#000000";_="<</Type /Annot /Subtype /FreeText "+y+"/Contents ("+V(ye(f.contents))+")",_+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+Ye+")",_+=" /Border [0 0 0]",_+=" >>",this.internal.write(_);break;case"link":if(f.options.name){var Je=this.annotations._nameMap[f.options.name];f.options.pageNumber=Je.page,f.options.top=Je.y}else f.options.top||(f.options.top=0);if(y="/Rect ["+f.finalBounds.x+" "+f.finalBounds.y+" "+f.finalBounds.w+" "+f.finalBounds.h+"] ",_="",f.options.url)_="<</Type /Annot /Subtype /Link "+y+"/Border [0 0 0] /A <</S /URI /URI ("+V(ye(f.options.url))+") >>";else if(f.options.pageNumber)switch(_="<</Type /Annot /Subtype /Link "+y+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(f.options.pageNumber).objId+" 0 R",f.options.magFactor=f.options.magFactor||"XYZ",f.options.magFactor){case"Fit":_+=" /Fit]";break;case"FitH":_+=" /FitH "+f.options.top+"]";break;case"FitV":f.options.left=f.options.left||0,_+=" /FitV "+f.options.left+"]";break;case"XYZ":default:var ct=a(f.options.top);f.options.left=f.options.left||0,f.options.zoom===void 0&&(f.options.zoom=0),_+=" /XYZ "+f.options.left+" "+ct+" "+f.options.zoom+"]"}_!=""&&(_+=" >>",this.internal.write(_))}}this.internal.write("]")}}]),d.createAnnotation=function(u){var f=this.internal.getCurrentPageInfo();switch(u.type){case"link":this.link(u.bounds.x,u.bounds.y,u.bounds.w,u.bounds.h,u);break;case"text":case"freetext":f.pageContext.annotations.push(u)}},d.link=function(u,f,y,_,g){var a=this.internal.getCurrentPageInfo(),C=this.internal.getCoordinateString,F=this.internal.getVerticalCoordinateString;a.pageContext.annotations.push({finalBounds:{x:C(u),y:F(f),w:C(u+y),h:F(f+_)},options:g,type:"link"})},d.textWithLink=function(u,f,y,_){var g,a,C=this.getTextWidth(u),F=this.internal.getLineHeight()/this.internal.scaleFactor;if(_.maxWidth!==void 0){a=_.maxWidth;var U=this.splitTextToSize(u,a).length;g=Math.ceil(F*U)}else a=C,g=F;return this.text(u,f,y,_),y+=.2*F,_.align==="center"&&(f-=C/2),_.align==="right"&&(f-=C),this.link(f,y-F,a,g,_),C},d.getTextWidth=function(u){var f=this.internal.getFontSize();return this.getStringUnitWidth(u)*f/this.internal.scaleFactor}}(Li.API),function(d){var s={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},u={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},f={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},y=[1570,1571,1573,1575];d.__arabicParser__={};var _=d.__arabicParser__.isInArabicSubstitutionA=function(de){return s[de.charCodeAt(0)]!==void 0},g=d.__arabicParser__.isArabicLetter=function(de){return typeof de=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(de)},a=d.__arabicParser__.isArabicEndLetter=function(de){return g(de)&&_(de)&&s[de.charCodeAt(0)].length<=2},C=d.__arabicParser__.isArabicAlfLetter=function(de){return g(de)&&y.indexOf(de.charCodeAt(0))>=0};d.__arabicParser__.arabicLetterHasIsolatedForm=function(de){return g(de)&&_(de)&&s[de.charCodeAt(0)].length>=1};var F=d.__arabicParser__.arabicLetterHasFinalForm=function(de){return g(de)&&_(de)&&s[de.charCodeAt(0)].length>=2};d.__arabicParser__.arabicLetterHasInitialForm=function(de){return g(de)&&_(de)&&s[de.charCodeAt(0)].length>=3};var U=d.__arabicParser__.arabicLetterHasMedialForm=function(de){return g(de)&&_(de)&&s[de.charCodeAt(0)].length==4},O=d.__arabicParser__.resolveLigatures=function(de){var Pe=0,ue=u,Se="",ze=0;for(Pe=0;Pe<de.length;Pe+=1)ue[de.charCodeAt(Pe)]!==void 0?(ze++,typeof(ue=ue[de.charCodeAt(Pe)])=="number"&&(Se+=String.fromCharCode(ue),ue=u,ze=0),Pe===de.length-1&&(ue=u,Se+=de.charAt(Pe-(ze-1)),Pe-=ze-1,ze=0)):(ue=u,Se+=de.charAt(Pe-ze),Pe-=ze,ze=0);return Se};d.__arabicParser__.isArabicDiacritic=function(de){return de!==void 0&&f[de.charCodeAt(0)]!==void 0};var $=d.__arabicParser__.getCorrectForm=function(de,Pe,ue){return g(de)?_(de)===!1?-1:!F(de)||!g(Pe)&&!g(ue)||!g(ue)&&a(Pe)||a(de)&&!g(Pe)||a(de)&&C(Pe)||a(de)&&a(Pe)?0:U(de)&&g(Pe)&&!a(Pe)&&g(ue)&&F(ue)?3:a(de)||!g(ue)?1:2:-1},V=function(de){var Pe=0,ue=0,Se=0,ze="",Ye="",Je="",ct=(de=de||"").split("\\s+"),Ge=[];for(Pe=0;Pe<ct.length;Pe+=1){for(Ge.push(""),ue=0;ue<ct[Pe].length;ue+=1)ze=ct[Pe][ue],Ye=ct[Pe][ue-1],Je=ct[Pe][ue+1],g(ze)?(Se=$(ze,Ye,Je),Ge[Pe]+=Se!==-1?String.fromCharCode(s[ze.charCodeAt(0)][Se]):ze):Ge[Pe]+=ze;Ge[Pe]=O(Ge[Pe])}return Ge.join(" ")},ye=d.__arabicParser__.processArabic=d.processArabic=function(){var de,Pe=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,ue=[];if(Array.isArray(Pe)){var Se=0;for(ue=[],Se=0;Se<Pe.length;Se+=1)Array.isArray(Pe[Se])?ue.push([V(Pe[Se][0]),Pe[Se][1],Pe[Se][2]]):ue.push([V(Pe[Se])]);de=ue}else de=V(Pe);return typeof arguments[0]=="string"?de:(arguments[0].text=de,arguments[0])};d.events.push(["preProcessText",ye])}(Li.API),Li.API.autoPrint=function(d){var s;switch((d=d||{}).variant=d.variant||"non-conform",d.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){s=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+s+" 0 R")})}return this},function(d){var s=function(){var u=void 0;Object.defineProperty(this,"pdf",{get:function(){return u},set:function(a){u=a}});var f=150;Object.defineProperty(this,"width",{get:function(){return f},set:function(a){f=isNaN(a)||Number.isInteger(a)===!1||a<0?150:a,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=f+1)}});var y=300;Object.defineProperty(this,"height",{get:function(){return y},set:function(a){y=isNaN(a)||Number.isInteger(a)===!1||a<0?300:a,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=y+1)}});var _=[];Object.defineProperty(this,"childNodes",{get:function(){return _},set:function(a){_=a}});var g={};Object.defineProperty(this,"style",{get:function(){return g},set:function(a){g=a}}),Object.defineProperty(this,"parentNode",{})};s.prototype.getContext=function(u,f){var y;if((u=u||"2d")!=="2d")return null;for(y in f)this.pdf.context2d.hasOwnProperty(y)&&(this.pdf.context2d[y]=f[y]);return this.pdf.context2d._canvas=this,this.pdf.context2d},s.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},d.events.push(["initialized",function(){this.canvas=new s,this.canvas.pdf=this}])}(Li.API),function(d){var s={left:0,top:0,bottom:0,right:0},u=!1,f=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},s),this.internal.__cell__.margins.width=this.getPageWidth(),y.call(this))},y=function(){this.internal.__cell__.lastCell=new _,this.internal.__cell__.pages=1},_=function(){var C=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return C},set:function(de){C=de}});var F=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return F},set:function(de){F=de}});var U=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return U},set:function(de){U=de}});var O=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return O},set:function(de){O=de}});var $=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return $},set:function(de){$=de}});var V=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return V},set:function(de){V=de}});var ye=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return ye},set:function(de){ye=de}}),this};_.prototype.clone=function(){return new _(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},_.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},d.setHeaderFunction=function(C){return f.call(this),this.internal.__cell__.headerFunction=typeof C=="function"?C:void 0,this},d.getTextDimensions=function(C,F){f.call(this);var U=(F=F||{}).fontSize||this.getFontSize(),O=F.font||this.getFont(),$=F.scaleFactor||this.internal.scaleFactor,V=0,ye=0,de=0,Pe=this;if(!Array.isArray(C)&&typeof C!="string"){if(typeof C!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");C=String(C)}var ue=F.maxWidth;ue>0?typeof C=="string"?C=this.splitTextToSize(C,ue):Object.prototype.toString.call(C)==="[object Array]"&&(C=C.reduce(function(ze,Ye){return ze.concat(Pe.splitTextToSize(Ye,ue))},[])):C=Array.isArray(C)?C:[C];for(var Se=0;Se<C.length;Se++)V<(de=this.getStringUnitWidth(C[Se],{font:O})*U)&&(V=de);return V!==0&&(ye=C.length),{w:V/=$,h:Math.max((ye*U*this.getLineHeightFactor()-U*(this.getLineHeightFactor()-1))/$,0)}},d.cellAddPage=function(){f.call(this),this.addPage();var C=this.internal.__cell__.margins||s;return this.internal.__cell__.lastCell=new _(C.left,C.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var g=d.cell=function(){var C;C=arguments[0]instanceof _?arguments[0]:new _(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),f.call(this);var F=this.internal.__cell__.lastCell,U=this.internal.__cell__.padding,O=this.internal.__cell__.margins||s,$=this.internal.__cell__.tableHeaderRow,V=this.internal.__cell__.printHeaders;return F.lineNumber!==void 0&&(F.lineNumber===C.lineNumber?(C.x=(F.x||0)+(F.width||0),C.y=F.y||0):F.y+F.height+C.height+O.bottom>this.getPageHeight()?(this.cellAddPage(),C.y=O.top,V&&$&&(this.printHeaderRow(C.lineNumber,!0),C.y+=$[0].height)):C.y=F.y+F.height||C.y),C.text[0]!==void 0&&(this.rect(C.x,C.y,C.width,C.height,u===!0?"FD":void 0),C.align==="right"?this.text(C.text,C.x+C.width-U,C.y+U,{align:"right",baseline:"top"}):C.align==="center"?this.text(C.text,C.x+C.width/2,C.y+U,{align:"center",baseline:"top",maxWidth:C.width-U-U}):this.text(C.text,C.x+U,C.y+U,{align:"left",baseline:"top",maxWidth:C.width-U-U})),this.internal.__cell__.lastCell=C,this};d.table=function(C,F,U,O,$){if(f.call(this),!U)throw new Error("No data for PDF table.");var V,ye,de,Pe,ue=[],Se=[],ze=[],Ye={},Je={},ct=[],Ge=[],De=($=$||{}).autoSize||!1,Qe=$.printHeaders!==!1,pt=$.css&&$.css["font-size"]!==void 0?16*$.css["font-size"]:$.fontSize||12,pe=$.margins||Object.assign({width:this.getPageWidth()},s),me=typeof $.padding=="number"?$.padding:3,Ne=$.headerBackgroundColor||"#c8c8c8",Le=$.headerTextColor||"#000";if(y.call(this),this.internal.__cell__.printHeaders=Qe,this.internal.__cell__.margins=pe,this.internal.__cell__.table_font_size=pt,this.internal.__cell__.padding=me,this.internal.__cell__.headerBackgroundColor=Ne,this.internal.__cell__.headerTextColor=Le,this.setFontSize(pt),O==null)Se=ue=Object.keys(U[0]),ze=ue.map(function(){return"left"});else if(Array.isArray(O)&&dr(O[0])==="object")for(ue=O.map(function(dt){return dt.name}),Se=O.map(function(dt){return dt.prompt||dt.name||""}),ze=O.map(function(dt){return dt.align||"left"}),V=0;V<O.length;V+=1)Je[O[V].name]=O[V].width*(19.049976/25.4);else Array.isArray(O)&&typeof O[0]=="string"&&(Se=ue=O,ze=ue.map(function(){return"left"}));if(De||Array.isArray(O)&&typeof O[0]=="string")for(V=0;V<ue.length;V+=1){for(Ye[Pe=ue[V]]=U.map(function(dt){return dt[Pe]}),this.setFont(void 0,"bold"),ct.push(this.getTextDimensions(Se[V],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),ye=Ye[Pe],this.setFont(void 0,"normal"),de=0;de<ye.length;de+=1)ct.push(this.getTextDimensions(ye[de],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);Je[Pe]=Math.max.apply(null,ct)+me+me,ct=[]}if(Qe){var et={};for(V=0;V<ue.length;V+=1)et[ue[V]]={},et[ue[V]].text=Se[V],et[ue[V]].align=ze[V];var it=a.call(this,et,Je);Ge=ue.map(function(dt){return new _(C,F,Je[dt],it,et[dt].text,void 0,et[dt].align)}),this.setTableHeaderRow(Ge),this.printHeaderRow(1,!1)}var nt=O.reduce(function(dt,Mt){return dt[Mt.name]=Mt.align,dt},{});for(V=0;V<U.length;V+=1){"rowStart"in $&&$.rowStart instanceof Function&&$.rowStart({row:V,data:U[V]},this);var Xe=a.call(this,U[V],Je);for(de=0;de<ue.length;de+=1){var at=U[V][ue[de]];"cellStart"in $&&$.cellStart instanceof Function&&$.cellStart({row:V,col:de,data:at},this),g.call(this,new _(C,F,Je[ue[de]],Xe,at,V+2,nt[ue[de]]))}}return this.internal.__cell__.table_x=C,this.internal.__cell__.table_y=F,this};var a=function(C,F){var U=this.internal.__cell__.padding,O=this.internal.__cell__.table_font_size,$=this.internal.scaleFactor;return Object.keys(C).map(function(V){var ye=C[V];return this.splitTextToSize(ye.hasOwnProperty("text")?ye.text:ye,F[V]-U-U)},this).map(function(V){return this.getLineHeightFactor()*V.length*O/$+U+U},this).reduce(function(V,ye){return Math.max(V,ye)},0)};d.setTableHeaderRow=function(C){f.call(this),this.internal.__cell__.tableHeaderRow=C},d.printHeaderRow=function(C,F){if(f.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var U;if(u=!0,typeof this.internal.__cell__.headerFunction=="function"){var O=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new _(O[0],O[1],O[2],O[3],void 0,-1)}this.setFont(void 0,"bold");for(var $=[],V=0;V<this.internal.__cell__.tableHeaderRow.length;V+=1){U=this.internal.__cell__.tableHeaderRow[V].clone(),F&&(U.y=this.internal.__cell__.margins.top||0,$.push(U)),U.lineNumber=C;var ye=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),g.call(this,U),this.setTextColor(ye)}$.length>0&&this.setTableHeaderRow($),this.setFont(void 0,"normal"),u=!1}}(Li.API);var Gg={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},Wg=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],pp=Zg(Wg),Hg=[100,200,300,400,500,600,700,800,900],jv=Zg(Hg);function fp(d){var s=d.family.replace(/"|'/g,"").toLowerCase(),u=function(_){return Gg[_=_||"normal"]?_:"normal"}(d.style),f=function(_){if(!_)return 400;if(typeof _=="number")return _>=100&&_<=900&&_%100==0?_:400;if(/^\d00$/.test(_))return parseInt(_);switch(_){case"bold":return 700;case"normal":default:return 400}}(d.weight),y=function(_){return typeof pp[_=_||"normal"]=="number"?_:"normal"}(d.stretch);return{family:s,style:u,weight:f,stretch:y,src:d.src||[],ref:d.ref||{name:s,style:[y,u,f].join(" ")}}}function qm(d,s,u,f){var y;for(y=u;y>=0&&y<s.length;y+=f)if(d[s[y]])return d[s[y]];for(y=u;y>=0&&y<s.length;y-=f)if(d[s[y]])return d[s[y]]}var qv={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},Vm={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function Um(d){return[d.stretch,d.style,d.weight,d.family].join(" ")}function Vv(d,s,u){for(var f=(u=u||{}).defaultFontFamily||"times",y=Object.assign({},qv,u.genericFontFamilies||{}),_=null,g=null,a=0;a<s.length;++a)if(y[(_=fp(s[a])).family]&&(_.family=y[_.family]),d.hasOwnProperty(_.family)){g=d[_.family];break}if(!(g=g||d[f]))throw new Error("Could not find a font-family for the rule '"+Um(_)+"' and default family '"+f+"'.");if(g=function(C,F){if(F[C])return F[C];var U=pp[C],O=U<=pp.normal?-1:1,$=qm(F,Wg,U,O);if(!$)throw new Error("Could not find a matching font-stretch value for "+C);return $}(_.stretch,g),g=function(C,F){if(F[C])return F[C];for(var U=Gg[C],O=0;O<U.length;++O)if(F[U[O]])return F[U[O]];throw new Error("Could not find a matching font-style for "+C)}(_.style,g),!(g=function(C,F){if(F[C])return F[C];if(C===400&&F[500])return F[500];if(C===500&&F[400])return F[400];var U=jv[C],O=qm(F,Hg,U,C<400?-1:1);if(!O)throw new Error("Could not find a matching font-weight for value "+C);return O}(_.weight,g)))throw new Error("Failed to resolve a font for the rule '"+Um(_)+"'.");return g}function $m(d){return d.trimLeft()}function Uv(d,s){for(var u=0;u<d.length;){if(d.charAt(u)===s)return[d.substring(0,u),d.substring(u+1)];u+=1}return null}function $v(d){var s=d.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return s===null?null:[s[0],d.substring(s[0].length)]}var Mu,Zm,Gm,Wm=["times"];(function(d){var s,u,f,y,_,g,a,C,F,U=function(ie){return ie=ie||{},this.isStrokeTransparent=ie.isStrokeTransparent||!1,this.strokeOpacity=ie.strokeOpacity||1,this.strokeStyle=ie.strokeStyle||"#000000",this.fillStyle=ie.fillStyle||"#000000",this.isFillTransparent=ie.isFillTransparent||!1,this.fillOpacity=ie.fillOpacity||1,this.font=ie.font||"10px sans-serif",this.textBaseline=ie.textBaseline||"alphabetic",this.textAlign=ie.textAlign||"left",this.lineWidth=ie.lineWidth||1,this.lineJoin=ie.lineJoin||"miter",this.lineCap=ie.lineCap||"butt",this.path=ie.path||[],this.transform=ie.transform!==void 0?ie.transform.clone():new C,this.globalCompositeOperation=ie.globalCompositeOperation||"normal",this.globalAlpha=ie.globalAlpha||1,this.clip_path=ie.clip_path||[],this.currentPoint=ie.currentPoint||new g,this.miterLimit=ie.miterLimit||10,this.lastPoint=ie.lastPoint||new g,this.lineDashOffset=ie.lineDashOffset||0,this.lineDash=ie.lineDash||[],this.margin=ie.margin||[0,0,0,0],this.prevPageLastElemOffset=ie.prevPageLastElemOffset||0,this.ignoreClearRect=typeof ie.ignoreClearRect!="boolean"||ie.ignoreClearRect,this};d.events.push(["initialized",function(){this.context2d=new O(this),s=this.internal.f2,u=this.internal.getCoordinateString,f=this.internal.getVerticalCoordinateString,y=this.internal.getHorizontalCoordinate,_=this.internal.getVerticalCoordinate,g=this.internal.Point,a=this.internal.Rectangle,C=this.internal.Matrix,F=new U}]);var O=function(ie){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var xe=ie;Object.defineProperty(this,"pdf",{get:function(){return xe}});var ke=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return ke},set:function(ht){ke=!!ht}});var Fe=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return Fe},set:function(ht){Fe=!!ht}});var qe=0;Object.defineProperty(this,"posX",{get:function(){return qe},set:function(ht){isNaN(ht)||(qe=ht)}});var $e=0;Object.defineProperty(this,"posY",{get:function(){return $e},set:function(ht){isNaN(ht)||($e=ht)}}),Object.defineProperty(this,"margin",{get:function(){return F.margin},set:function(ht){var te;typeof ht=="number"?te=[ht,ht,ht,ht]:((te=new Array(4))[0]=ht[0],te[1]=ht.length>=2?ht[1]:te[0],te[2]=ht.length>=3?ht[2]:te[0],te[3]=ht.length>=4?ht[3]:te[1]),F.margin=te}});var Ke=!1;Object.defineProperty(this,"autoPaging",{get:function(){return Ke},set:function(ht){Ke=ht}});var tt=0;Object.defineProperty(this,"lastBreak",{get:function(){return tt},set:function(ht){tt=ht}});var Tt=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Tt},set:function(ht){Tt=ht}}),Object.defineProperty(this,"ctx",{get:function(){return F},set:function(ht){ht instanceof U&&(F=ht)}}),Object.defineProperty(this,"path",{get:function(){return F.path},set:function(ht){F.path=ht}});var kt=[];Object.defineProperty(this,"ctxStack",{get:function(){return kt},set:function(ht){kt=ht}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(ht){var te;te=$(ht),this.ctx.fillStyle=te.style,this.ctx.isFillTransparent=te.a===0,this.ctx.fillOpacity=te.a,this.pdf.setFillColor(te.r,te.g,te.b,{a:te.a}),this.pdf.setTextColor(te.r,te.g,te.b,{a:te.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(ht){var te=$(ht);this.ctx.strokeStyle=te.style,this.ctx.isStrokeTransparent=te.a===0,this.ctx.strokeOpacity=te.a,te.a===0?this.pdf.setDrawColor(255,255,255):(te.a,this.pdf.setDrawColor(te.r,te.g,te.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(ht){["butt","round","square"].indexOf(ht)!==-1&&(this.ctx.lineCap=ht,this.pdf.setLineCap(ht))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(ht){isNaN(ht)||(this.ctx.lineWidth=ht,this.pdf.setLineWidth(ht))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(ht){["bevel","round","miter"].indexOf(ht)!==-1&&(this.ctx.lineJoin=ht,this.pdf.setLineJoin(ht))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(ht){isNaN(ht)||(this.ctx.miterLimit=ht,this.pdf.setMiterLimit(ht))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(ht){this.ctx.textBaseline=ht}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(ht){["right","end","center","left","start"].indexOf(ht)!==-1&&(this.ctx.textAlign=ht)}});var Nt=null;function zt(ht,te){if(Nt===null){var gi=function(Ht){var ft=[];return Object.keys(Ht).forEach(function(Pt){Ht[Pt].forEach(function(Bt){var Dt=null;switch(Bt){case"bold":Dt={family:Pt,weight:"bold"};break;case"italic":Dt={family:Pt,style:"italic"};break;case"bolditalic":Dt={family:Pt,weight:"bold",style:"italic"};break;case"":case"normal":Dt={family:Pt}}Dt!==null&&(Dt.ref={name:Pt,style:Bt},ft.push(Dt))})}),ft}(ht.getFontList());Nt=function(Ht){for(var ft={},Pt=0;Pt<Ht.length;++Pt){var Bt=fp(Ht[Pt]),Dt=Bt.family,Yt=Bt.stretch,ii=Bt.style,ui=Bt.weight;ft[Dt]=ft[Dt]||{},ft[Dt][Yt]=ft[Dt][Yt]||{},ft[Dt][Yt][ii]=ft[Dt][Yt][ii]||{},ft[Dt][Yt][ii][ui]=Bt}return ft}(gi.concat(te))}return Nt}var ti=null;Object.defineProperty(this,"fontFaces",{get:function(){return ti},set:function(ht){Nt=null,ti=ht}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(ht){var te;if(this.ctx.font=ht,(te=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(ht))!==null){var gi=te[1],Ht=(te[2],te[3]),ft=te[4],Pt=(te[5],te[6]),Bt=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(ft)[2];ft=Math.floor(Bt==="px"?parseFloat(ft)*this.pdf.internal.scaleFactor:Bt==="em"?parseFloat(ft)*this.pdf.getFontSize():parseFloat(ft)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(ft);var Dt=function(si){var mi,Rt,nr=[],_t=si.trim();if(_t==="")return Wm;if(_t in Vm)return[Vm[_t]];for(;_t!=="";){switch(Rt=null,mi=(_t=$m(_t)).charAt(0)){case'"':case"'":Rt=Uv(_t.substring(1),mi);break;default:Rt=$v(_t)}if(Rt===null||(nr.push(Rt[0]),(_t=$m(Rt[1]))!==""&&_t.charAt(0)!==","))return Wm;_t=_t.replace(/^,/,"")}return nr}(Pt);if(this.fontFaces){var Yt=Vv(zt(this.pdf,this.fontFaces),Dt.map(function(si){return{family:si,stretch:"normal",weight:Ht,style:gi}}));this.pdf.setFont(Yt.ref.name,Yt.ref.style)}else{var ii="";(Ht==="bold"||parseInt(Ht,10)>=700||gi==="bold")&&(ii="bold"),gi==="italic"&&(ii+="italic"),ii.length===0&&(ii="normal");for(var ui="",Pi={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Ni=0;Ni<Dt.length;Ni++){if(this.pdf.internal.getFont(Dt[Ni],ii,{noFallback:!0,disableWarning:!0})!==void 0){ui=Dt[Ni];break}if(ii==="bolditalic"&&this.pdf.internal.getFont(Dt[Ni],"bold",{noFallback:!0,disableWarning:!0})!==void 0)ui=Dt[Ni],ii="bold";else if(this.pdf.internal.getFont(Dt[Ni],"normal",{noFallback:!0,disableWarning:!0})!==void 0){ui=Dt[Ni],ii="normal";break}}if(ui===""){for(var yt=0;yt<Dt.length;yt++)if(Pi[Dt[yt]]){ui=Pi[Dt[yt]];break}}ui=ui===""?"Times":ui,this.pdf.setFont(ui,ii)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(ht){this.ctx.globalCompositeOperation=ht}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(ht){this.ctx.globalAlpha=ht}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(ht){this.ctx.lineDashOffset=ht,Mt.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(ht){this.ctx.lineDash=ht,Mt.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(ht){this.ctx.ignoreClearRect=!!ht}})};O.prototype.setLineDash=function(ie){this.lineDash=ie},O.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},O.prototype.fill=function(){Ye.call(this,"fill",!1)},O.prototype.stroke=function(){Ye.call(this,"stroke",!1)},O.prototype.beginPath=function(){this.path=[{type:"begin"}]},O.prototype.moveTo=function(ie,xe){if(isNaN(ie)||isNaN(xe))throw xr.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var ke=this.ctx.transform.applyToPoint(new g(ie,xe));this.path.push({type:"mt",x:ke.x,y:ke.y}),this.ctx.lastPoint=new g(ie,xe)},O.prototype.closePath=function(){var ie=new g(0,0),xe=0;for(xe=this.path.length-1;xe!==-1;xe--)if(this.path[xe].type==="begin"&&dr(this.path[xe+1])==="object"&&typeof this.path[xe+1].x=="number"){ie=new g(this.path[xe+1].x,this.path[xe+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new g(ie.x,ie.y)},O.prototype.lineTo=function(ie,xe){if(isNaN(ie)||isNaN(xe))throw xr.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var ke=this.ctx.transform.applyToPoint(new g(ie,xe));this.path.push({type:"lt",x:ke.x,y:ke.y}),this.ctx.lastPoint=new g(ke.x,ke.y)},O.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),Ye.call(this,null,!0)},O.prototype.quadraticCurveTo=function(ie,xe,ke,Fe){if(isNaN(ke)||isNaN(Fe)||isNaN(ie)||isNaN(xe))throw xr.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var qe=this.ctx.transform.applyToPoint(new g(ke,Fe)),$e=this.ctx.transform.applyToPoint(new g(ie,xe));this.path.push({type:"qct",x1:$e.x,y1:$e.y,x:qe.x,y:qe.y}),this.ctx.lastPoint=new g(qe.x,qe.y)},O.prototype.bezierCurveTo=function(ie,xe,ke,Fe,qe,$e){if(isNaN(qe)||isNaN($e)||isNaN(ie)||isNaN(xe)||isNaN(ke)||isNaN(Fe))throw xr.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var Ke=this.ctx.transform.applyToPoint(new g(qe,$e)),tt=this.ctx.transform.applyToPoint(new g(ie,xe)),Tt=this.ctx.transform.applyToPoint(new g(ke,Fe));this.path.push({type:"bct",x1:tt.x,y1:tt.y,x2:Tt.x,y2:Tt.y,x:Ke.x,y:Ke.y}),this.ctx.lastPoint=new g(Ke.x,Ke.y)},O.prototype.arc=function(ie,xe,ke,Fe,qe,$e){if(isNaN(ie)||isNaN(xe)||isNaN(ke)||isNaN(Fe)||isNaN(qe))throw xr.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if($e=!!$e,!this.ctx.transform.isIdentity){var Ke=this.ctx.transform.applyToPoint(new g(ie,xe));ie=Ke.x,xe=Ke.y;var tt=this.ctx.transform.applyToPoint(new g(0,ke)),Tt=this.ctx.transform.applyToPoint(new g(0,0));ke=Math.sqrt(Math.pow(tt.x-Tt.x,2)+Math.pow(tt.y-Tt.y,2))}Math.abs(qe-Fe)>=2*Math.PI&&(Fe=0,qe=2*Math.PI),this.path.push({type:"arc",x:ie,y:xe,radius:ke,startAngle:Fe,endAngle:qe,counterclockwise:$e})},O.prototype.arcTo=function(ie,xe,ke,Fe,qe){throw new Error("arcTo not implemented.")},O.prototype.rect=function(ie,xe,ke,Fe){if(isNaN(ie)||isNaN(xe)||isNaN(ke)||isNaN(Fe))throw xr.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(ie,xe),this.lineTo(ie+ke,xe),this.lineTo(ie+ke,xe+Fe),this.lineTo(ie,xe+Fe),this.lineTo(ie,xe),this.lineTo(ie+ke,xe),this.lineTo(ie,xe)},O.prototype.fillRect=function(ie,xe,ke,Fe){if(isNaN(ie)||isNaN(xe)||isNaN(ke)||isNaN(Fe))throw xr.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!V.call(this)){var qe={};this.lineCap!=="butt"&&(qe.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(qe.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(ie,xe,ke,Fe),this.fill(),qe.hasOwnProperty("lineCap")&&(this.lineCap=qe.lineCap),qe.hasOwnProperty("lineJoin")&&(this.lineJoin=qe.lineJoin)}},O.prototype.strokeRect=function(ie,xe,ke,Fe){if(isNaN(ie)||isNaN(xe)||isNaN(ke)||isNaN(Fe))throw xr.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");ye.call(this)||(this.beginPath(),this.rect(ie,xe,ke,Fe),this.stroke())},O.prototype.clearRect=function(ie,xe,ke,Fe){if(isNaN(ie)||isNaN(xe)||isNaN(ke)||isNaN(Fe))throw xr.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(ie,xe,ke,Fe))},O.prototype.save=function(ie){ie=typeof ie!="boolean"||ie;for(var xe=this.pdf.internal.getCurrentPageInfo().pageNumber,ke=0;ke<this.pdf.internal.getNumberOfPages();ke++)this.pdf.setPage(ke+1),this.pdf.internal.out("q");if(this.pdf.setPage(xe),ie){this.ctx.fontSize=this.pdf.internal.getFontSize();var Fe=new U(this.ctx);this.ctxStack.push(this.ctx),this.ctx=Fe}},O.prototype.restore=function(ie){ie=typeof ie!="boolean"||ie;for(var xe=this.pdf.internal.getCurrentPageInfo().pageNumber,ke=0;ke<this.pdf.internal.getNumberOfPages();ke++)this.pdf.setPage(ke+1),this.pdf.internal.out("Q");this.pdf.setPage(xe),ie&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},O.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var $=function(ie){var xe,ke,Fe,qe;if(ie.isCanvasGradient===!0&&(ie=ie.getColor()),!ie)return{r:0,g:0,b:0,a:0,style:ie};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(ie))xe=0,ke=0,Fe=0,qe=0;else{var $e=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(ie);if($e!==null)xe=parseInt($e[1]),ke=parseInt($e[2]),Fe=parseInt($e[3]),qe=1;else if(($e=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(ie))!==null)xe=parseInt($e[1]),ke=parseInt($e[2]),Fe=parseInt($e[3]),qe=parseFloat($e[4]);else{if(qe=1,typeof ie=="string"&&ie.charAt(0)!=="#"){var Ke=new Bg(ie);ie=Ke.ok?Ke.toHex():"#000000"}ie.length===4?(xe=ie.substring(1,2),xe+=xe,ke=ie.substring(2,3),ke+=ke,Fe=ie.substring(3,4),Fe+=Fe):(xe=ie.substring(1,3),ke=ie.substring(3,5),Fe=ie.substring(5,7)),xe=parseInt(xe,16),ke=parseInt(ke,16),Fe=parseInt(Fe,16)}}return{r:xe,g:ke,b:Fe,a:qe,style:ie}},V=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},ye=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};O.prototype.fillText=function(ie,xe,ke,Fe){if(isNaN(xe)||isNaN(ke)||typeof ie!="string")throw xr.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(Fe=isNaN(Fe)?void 0:Fe,!V.call(this)){var qe=Xe(this.ctx.transform.rotation),$e=this.ctx.transform.scaleX;me.call(this,{text:ie,x:xe,y:ke,scale:$e,angle:qe,align:this.textAlign,maxWidth:Fe})}},O.prototype.strokeText=function(ie,xe,ke,Fe){if(isNaN(xe)||isNaN(ke)||typeof ie!="string")throw xr.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!ye.call(this)){Fe=isNaN(Fe)?void 0:Fe;var qe=Xe(this.ctx.transform.rotation),$e=this.ctx.transform.scaleX;me.call(this,{text:ie,x:xe,y:ke,scale:$e,renderingMode:"stroke",angle:qe,align:this.textAlign,maxWidth:Fe})}},O.prototype.measureText=function(ie){if(typeof ie!="string")throw xr.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var xe=this.pdf,ke=this.pdf.internal.scaleFactor,Fe=xe.internal.getFontSize(),qe=xe.getStringUnitWidth(ie)*Fe/xe.internal.scaleFactor,$e=function(Ke){var tt=(Ke=Ke||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return tt}}),this};return new $e({width:qe*=Math.round(96*ke/72*1e4)/1e4})},O.prototype.scale=function(ie,xe){if(isNaN(ie)||isNaN(xe))throw xr.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var ke=new C(ie,0,0,xe,0,0);this.ctx.transform=this.ctx.transform.multiply(ke)},O.prototype.rotate=function(ie){if(isNaN(ie))throw xr.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var xe=new C(Math.cos(ie),Math.sin(ie),-Math.sin(ie),Math.cos(ie),0,0);this.ctx.transform=this.ctx.transform.multiply(xe)},O.prototype.translate=function(ie,xe){if(isNaN(ie)||isNaN(xe))throw xr.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var ke=new C(1,0,0,1,ie,xe);this.ctx.transform=this.ctx.transform.multiply(ke)},O.prototype.transform=function(ie,xe,ke,Fe,qe,$e){if(isNaN(ie)||isNaN(xe)||isNaN(ke)||isNaN(Fe)||isNaN(qe)||isNaN($e))throw xr.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var Ke=new C(ie,xe,ke,Fe,qe,$e);this.ctx.transform=this.ctx.transform.multiply(Ke)},O.prototype.setTransform=function(ie,xe,ke,Fe,qe,$e){ie=isNaN(ie)?1:ie,xe=isNaN(xe)?0:xe,ke=isNaN(ke)?0:ke,Fe=isNaN(Fe)?1:Fe,qe=isNaN(qe)?0:qe,$e=isNaN($e)?0:$e,this.ctx.transform=new C(ie,xe,ke,Fe,qe,$e)};var de=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};O.prototype.drawImage=function(ie,xe,ke,Fe,qe,$e,Ke,tt,Tt){var kt=this.pdf.getImageProperties(ie),Nt=1,zt=1,ti=1,ht=1;Fe!==void 0&&tt!==void 0&&(ti=tt/Fe,ht=Tt/qe,Nt=kt.width/Fe*tt/Fe,zt=kt.height/qe*Tt/qe),$e===void 0&&($e=xe,Ke=ke,xe=0,ke=0),Fe!==void 0&&tt===void 0&&(tt=Fe,Tt=qe),Fe===void 0&&tt===void 0&&(tt=kt.width,Tt=kt.height);for(var te,gi=this.ctx.transform.decompose(),Ht=Xe(gi.rotate.shx),ft=new C,Pt=(ft=(ft=(ft=ft.multiply(gi.translate)).multiply(gi.skew)).multiply(gi.scale)).applyToRectangle(new a($e-xe*ti,Ke-ke*ht,Fe*Nt,qe*zt)),Bt=Pe.call(this,Pt),Dt=[],Yt=0;Yt<Bt.length;Yt+=1)Dt.indexOf(Bt[Yt])===-1&&Dt.push(Bt[Yt]);if(ze(Dt),this.autoPaging)for(var ii=Dt[0],ui=Dt[Dt.length-1],Pi=ii;Pi<ui+1;Pi++){this.pdf.setPage(Pi);var Ni=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],yt=Pi===1?this.posY+this.margin[0]:this.margin[0],si=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],mi=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Rt=Pi===1?0:si+(Pi-2)*mi;if(this.ctx.clip_path.length!==0){var nr=this.path;te=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=Se(te,this.posX+this.margin[3],-Rt+yt+this.ctx.prevPageLastElemOffset),Je.call(this,"fill",!0),this.path=nr}var _t=JSON.parse(JSON.stringify(Pt));_t=Se([_t],this.posX+this.margin[3],-Rt+yt+this.ctx.prevPageLastElemOffset)[0];var ai=(Pi>ii||Pi<ui)&&de.call(this);ai&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Ni,mi,null).clip().discardPath()),this.pdf.addImage(ie,"JPEG",_t.x,_t.y,_t.w,_t.h,null,null,Ht),ai&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(ie,"JPEG",Pt.x,Pt.y,Pt.w,Pt.h,null,null,Ht)};var Pe=function(ie,xe,ke){var Fe=[];xe=xe||this.pdf.internal.pageSize.width,ke=ke||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var qe=this.posY+this.ctx.prevPageLastElemOffset;switch(ie.type){default:case"mt":case"lt":Fe.push(Math.floor((ie.y+qe)/ke)+1);break;case"arc":Fe.push(Math.floor((ie.y+qe-ie.radius)/ke)+1),Fe.push(Math.floor((ie.y+qe+ie.radius)/ke)+1);break;case"qct":var $e=at(this.ctx.lastPoint.x,this.ctx.lastPoint.y,ie.x1,ie.y1,ie.x,ie.y);Fe.push(Math.floor(($e.y+qe)/ke)+1),Fe.push(Math.floor(($e.y+$e.h+qe)/ke)+1);break;case"bct":var Ke=dt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,ie.x1,ie.y1,ie.x2,ie.y2,ie.x,ie.y);Fe.push(Math.floor((Ke.y+qe)/ke)+1),Fe.push(Math.floor((Ke.y+Ke.h+qe)/ke)+1);break;case"rect":Fe.push(Math.floor((ie.y+qe)/ke)+1),Fe.push(Math.floor((ie.y+ie.h+qe)/ke)+1)}for(var tt=0;tt<Fe.length;tt+=1)for(;this.pdf.internal.getNumberOfPages()<Fe[tt];)ue.call(this);return Fe},ue=function(){var ie=this.fillStyle,xe=this.strokeStyle,ke=this.font,Fe=this.lineCap,qe=this.lineWidth,$e=this.lineJoin;this.pdf.addPage(),this.fillStyle=ie,this.strokeStyle=xe,this.font=ke,this.lineCap=Fe,this.lineWidth=qe,this.lineJoin=$e},Se=function(ie,xe,ke){for(var Fe=0;Fe<ie.length;Fe++)switch(ie[Fe].type){case"bct":ie[Fe].x2+=xe,ie[Fe].y2+=ke;case"qct":ie[Fe].x1+=xe,ie[Fe].y1+=ke;case"mt":case"lt":case"arc":default:ie[Fe].x+=xe,ie[Fe].y+=ke}return ie},ze=function(ie){return ie.sort(function(xe,ke){return xe-ke})},Ye=function(ie,xe){for(var ke,Fe,qe=this.fillStyle,$e=this.strokeStyle,Ke=this.lineCap,tt=this.lineWidth,Tt=Math.abs(tt*this.ctx.transform.scaleX),kt=this.lineJoin,Nt=JSON.parse(JSON.stringify(this.path)),zt=JSON.parse(JSON.stringify(this.path)),ti=[],ht=0;ht<zt.length;ht++)if(zt[ht].x!==void 0)for(var te=Pe.call(this,zt[ht]),gi=0;gi<te.length;gi+=1)ti.indexOf(te[gi])===-1&&ti.push(te[gi]);for(var Ht=0;Ht<ti.length;Ht++)for(;this.pdf.internal.getNumberOfPages()<ti[Ht];)ue.call(this);if(ze(ti),this.autoPaging)for(var ft=ti[0],Pt=ti[ti.length-1],Bt=ft;Bt<Pt+1;Bt++){this.pdf.setPage(Bt),this.fillStyle=qe,this.strokeStyle=$e,this.lineCap=Ke,this.lineWidth=Tt,this.lineJoin=kt;var Dt=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Yt=Bt===1?this.posY+this.margin[0]:this.margin[0],ii=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],ui=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Pi=Bt===1?0:ii+(Bt-2)*ui;if(this.ctx.clip_path.length!==0){var Ni=this.path;ke=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=Se(ke,this.posX+this.margin[3],-Pi+Yt+this.ctx.prevPageLastElemOffset),Je.call(this,ie,!0),this.path=Ni}if(Fe=JSON.parse(JSON.stringify(Nt)),this.path=Se(Fe,this.posX+this.margin[3],-Pi+Yt+this.ctx.prevPageLastElemOffset),xe===!1||Bt===0){var yt=(Bt>ft||Bt<Pt)&&de.call(this);yt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Dt,ui,null).clip().discardPath()),Je.call(this,ie,xe),yt&&this.pdf.restoreGraphicsState()}this.lineWidth=tt}else this.lineWidth=Tt,Je.call(this,ie,xe),this.lineWidth=tt;this.path=Nt},Je=function(ie,xe){if((ie!=="stroke"||xe||!ye.call(this))&&(ie==="stroke"||xe||!V.call(this))){for(var ke,Fe,qe=[],$e=this.path,Ke=0;Ke<$e.length;Ke++){var tt=$e[Ke];switch(tt.type){case"begin":qe.push({begin:!0});break;case"close":qe.push({close:!0});break;case"mt":qe.push({start:tt,deltas:[],abs:[]});break;case"lt":var Tt=qe.length;if($e[Ke-1]&&!isNaN($e[Ke-1].x)&&(ke=[tt.x-$e[Ke-1].x,tt.y-$e[Ke-1].y],Tt>0)){for(;Tt>=0;Tt--)if(qe[Tt-1].close!==!0&&qe[Tt-1].begin!==!0){qe[Tt-1].deltas.push(ke),qe[Tt-1].abs.push(tt);break}}break;case"bct":ke=[tt.x1-$e[Ke-1].x,tt.y1-$e[Ke-1].y,tt.x2-$e[Ke-1].x,tt.y2-$e[Ke-1].y,tt.x-$e[Ke-1].x,tt.y-$e[Ke-1].y],qe[qe.length-1].deltas.push(ke);break;case"qct":var kt=$e[Ke-1].x+2/3*(tt.x1-$e[Ke-1].x),Nt=$e[Ke-1].y+2/3*(tt.y1-$e[Ke-1].y),zt=tt.x+2/3*(tt.x1-tt.x),ti=tt.y+2/3*(tt.y1-tt.y),ht=tt.x,te=tt.y;ke=[kt-$e[Ke-1].x,Nt-$e[Ke-1].y,zt-$e[Ke-1].x,ti-$e[Ke-1].y,ht-$e[Ke-1].x,te-$e[Ke-1].y],qe[qe.length-1].deltas.push(ke);break;case"arc":qe.push({deltas:[],abs:[],arc:!0}),Array.isArray(qe[qe.length-1].abs)&&qe[qe.length-1].abs.push(tt)}}Fe=xe?null:ie==="stroke"?"stroke":"fill";for(var gi=!1,Ht=0;Ht<qe.length;Ht++)if(qe[Ht].arc)for(var ft=qe[Ht].abs,Pt=0;Pt<ft.length;Pt++){var Bt=ft[Pt];Bt.type==="arc"?De.call(this,Bt.x,Bt.y,Bt.radius,Bt.startAngle,Bt.endAngle,Bt.counterclockwise,void 0,xe,!gi):Ne.call(this,Bt.x,Bt.y),gi=!0}else if(qe[Ht].close===!0)this.pdf.internal.out("h"),gi=!1;else if(qe[Ht].begin!==!0){var Dt=qe[Ht].start.x,Yt=qe[Ht].start.y;Le.call(this,qe[Ht].deltas,Dt,Yt),gi=!0}Fe&&Qe.call(this,Fe),xe&&pt.call(this)}},ct=function(ie){var xe=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,ke=xe*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return ie-ke;case"top":return ie+xe-ke;case"hanging":return ie+xe-2*ke;case"middle":return ie+xe/2-ke;case"ideographic":return ie;case"alphabetic":default:return ie}},Ge=function(ie){return ie+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};O.prototype.createLinearGradient=function(){var ie=function(){};return ie.colorStops=[],ie.addColorStop=function(xe,ke){this.colorStops.push([xe,ke])},ie.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},ie.isCanvasGradient=!0,ie},O.prototype.createPattern=function(){return this.createLinearGradient()},O.prototype.createRadialGradient=function(){return this.createLinearGradient()};var De=function(ie,xe,ke,Fe,qe,$e,Ke,tt,Tt){for(var kt=it.call(this,ke,Fe,qe,$e),Nt=0;Nt<kt.length;Nt++){var zt=kt[Nt];Nt===0&&(Tt?pe.call(this,zt.x1+ie,zt.y1+xe):Ne.call(this,zt.x1+ie,zt.y1+xe)),et.call(this,ie,xe,zt.x2,zt.y2,zt.x3,zt.y3,zt.x4,zt.y4)}tt?pt.call(this):Qe.call(this,Ke)},Qe=function(ie){switch(ie){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},pt=function(){this.pdf.clip(),this.pdf.discardPath()},pe=function(ie,xe){this.pdf.internal.out(u(ie)+" "+f(xe)+" m")},me=function(ie){var xe;switch(ie.align){case"right":case"end":xe="right";break;case"center":xe="center";break;case"left":case"start":default:xe="left"}var ke=this.pdf.getTextDimensions(ie.text),Fe=ct.call(this,ie.y),qe=Ge.call(this,Fe)-ke.h,$e=this.ctx.transform.applyToPoint(new g(ie.x,Fe)),Ke=this.ctx.transform.decompose(),tt=new C;tt=(tt=(tt=tt.multiply(Ke.translate)).multiply(Ke.skew)).multiply(Ke.scale);for(var Tt,kt,Nt,zt=this.ctx.transform.applyToRectangle(new a(ie.x,Fe,ke.w,ke.h)),ti=tt.applyToRectangle(new a(ie.x,qe,ke.w,ke.h)),ht=Pe.call(this,ti),te=[],gi=0;gi<ht.length;gi+=1)te.indexOf(ht[gi])===-1&&te.push(ht[gi]);if(ze(te),this.autoPaging)for(var Ht=te[0],ft=te[te.length-1],Pt=Ht;Pt<ft+1;Pt++){this.pdf.setPage(Pt);var Bt=Pt===1?this.posY+this.margin[0]:this.margin[0],Dt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Yt=this.pdf.internal.pageSize.height-this.margin[2],ii=Yt-this.margin[0],ui=this.pdf.internal.pageSize.width-this.margin[1],Pi=ui-this.margin[3],Ni=Pt===1?0:Dt+(Pt-2)*ii;if(this.ctx.clip_path.length!==0){var yt=this.path;Tt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=Se(Tt,this.posX+this.margin[3],-1*Ni+Bt),Je.call(this,"fill",!0),this.path=yt}var si=Se([JSON.parse(JSON.stringify(ti))],this.posX+this.margin[3],-Ni+Bt+this.ctx.prevPageLastElemOffset)[0];ie.scale>=.01&&(kt=this.pdf.internal.getFontSize(),this.pdf.setFontSize(kt*ie.scale),Nt=this.lineWidth,this.lineWidth=Nt*ie.scale);var mi=this.autoPaging!=="text";if(mi||si.y+si.h<=Yt){if(mi||si.y>=Bt&&si.x<=ui){var Rt=mi?ie.text:this.pdf.splitTextToSize(ie.text,ie.maxWidth||ui-si.x)[0],nr=Se([JSON.parse(JSON.stringify(zt))],this.posX+this.margin[3],-Ni+Bt+this.ctx.prevPageLastElemOffset)[0],_t=mi&&(Pt>Ht||Pt<ft)&&de.call(this);_t&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Pi,ii,null).clip().discardPath()),this.pdf.text(Rt,nr.x,nr.y,{angle:ie.angle,align:xe,renderingMode:ie.renderingMode}),_t&&this.pdf.restoreGraphicsState()}}else si.y<Yt&&(this.ctx.prevPageLastElemOffset+=Yt-si.y);ie.scale>=.01&&(this.pdf.setFontSize(kt),this.lineWidth=Nt)}else ie.scale>=.01&&(kt=this.pdf.internal.getFontSize(),this.pdf.setFontSize(kt*ie.scale),Nt=this.lineWidth,this.lineWidth=Nt*ie.scale),this.pdf.text(ie.text,$e.x+this.posX,$e.y+this.posY,{angle:ie.angle,align:xe,renderingMode:ie.renderingMode,maxWidth:ie.maxWidth}),ie.scale>=.01&&(this.pdf.setFontSize(kt),this.lineWidth=Nt)},Ne=function(ie,xe,ke,Fe){ke=ke||0,Fe=Fe||0,this.pdf.internal.out(u(ie+ke)+" "+f(xe+Fe)+" l")},Le=function(ie,xe,ke){return this.pdf.lines(ie,xe,ke,null,null)},et=function(ie,xe,ke,Fe,qe,$e,Ke,tt){this.pdf.internal.out([s(y(ke+ie)),s(_(Fe+xe)),s(y(qe+ie)),s(_($e+xe)),s(y(Ke+ie)),s(_(tt+xe)),"c"].join(" "))},it=function(ie,xe,ke,Fe){for(var qe=2*Math.PI,$e=Math.PI/2;xe>ke;)xe-=qe;var Ke=Math.abs(ke-xe);Ke<qe&&Fe&&(Ke=qe-Ke);for(var tt=[],Tt=Fe?-1:1,kt=xe;Ke>1e-5;){var Nt=kt+Tt*Math.min(Ke,$e);tt.push(nt.call(this,ie,kt,Nt)),Ke-=Math.abs(Nt-kt),kt=Nt}return tt},nt=function(ie,xe,ke){var Fe=(ke-xe)/2,qe=ie*Math.cos(Fe),$e=ie*Math.sin(Fe),Ke=qe,tt=-$e,Tt=Ke*Ke+tt*tt,kt=Tt+Ke*qe+tt*$e,Nt=4/3*(Math.sqrt(2*Tt*kt)-kt)/(Ke*$e-tt*qe),zt=Ke-Nt*tt,ti=tt+Nt*Ke,ht=zt,te=-ti,gi=Fe+xe,Ht=Math.cos(gi),ft=Math.sin(gi);return{x1:ie*Math.cos(xe),y1:ie*Math.sin(xe),x2:zt*Ht-ti*ft,y2:zt*ft+ti*Ht,x3:ht*Ht-te*ft,y3:ht*ft+te*Ht,x4:ie*Math.cos(ke),y4:ie*Math.sin(ke)}},Xe=function(ie){return 180*ie/Math.PI},at=function(ie,xe,ke,Fe,qe,$e){var Ke=ie+.5*(ke-ie),tt=xe+.5*(Fe-xe),Tt=qe+.5*(ke-qe),kt=$e+.5*(Fe-$e),Nt=Math.min(ie,qe,Ke,Tt),zt=Math.max(ie,qe,Ke,Tt),ti=Math.min(xe,$e,tt,kt),ht=Math.max(xe,$e,tt,kt);return new a(Nt,ti,zt-Nt,ht-ti)},dt=function(ie,xe,ke,Fe,qe,$e,Ke,tt){var Tt,kt,Nt,zt,ti,ht,te,gi,Ht,ft,Pt,Bt,Dt,Yt,ii=ke-ie,ui=Fe-xe,Pi=qe-ke,Ni=$e-Fe,yt=Ke-qe,si=tt-$e;for(kt=0;kt<41;kt++)Ht=(te=(Nt=ie+(Tt=kt/40)*ii)+Tt*((ti=ke+Tt*Pi)-Nt))+Tt*(ti+Tt*(qe+Tt*yt-ti)-te),ft=(gi=(zt=xe+Tt*ui)+Tt*((ht=Fe+Tt*Ni)-zt))+Tt*(ht+Tt*($e+Tt*si-ht)-gi),kt==0?(Pt=Ht,Bt=ft,Dt=Ht,Yt=ft):(Pt=Math.min(Pt,Ht),Bt=Math.min(Bt,ft),Dt=Math.max(Dt,Ht),Yt=Math.max(Yt,ft));return new a(Math.round(Pt),Math.round(Bt),Math.round(Dt-Pt),Math.round(Yt-Bt))},Mt=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var ie,xe,ke=(ie=this.ctx.lineDash,xe=this.ctx.lineDashOffset,JSON.stringify({lineDash:ie,lineDashOffset:xe}));this.prevLineDash!==ke&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=ke)}}})(Li.API),function(d){var s=function(_){var g,a,C,F,U,O,$,V,ye,de;for(a=[],C=0,F=(_+=g="\0\0\0\0".slice(_.length%4||4)).length;F>C;C+=4)(U=(_.charCodeAt(C)<<24)+(_.charCodeAt(C+1)<<16)+(_.charCodeAt(C+2)<<8)+_.charCodeAt(C+3))!==0?(O=(U=((U=((U=((U=(U-(de=U%85))/85)-(ye=U%85))/85)-(V=U%85))/85)-($=U%85))/85)%85,a.push(O+33,$+33,V+33,ye+33,de+33)):a.push(122);return function(Pe,ue){for(var Se=ue;Se>0;Se--)Pe.pop()}(a,g.length),String.fromCharCode.apply(String,a)+"~>"},u=function(_){var g,a,C,F,U,O=String,$="length",V=255,ye="charCodeAt",de="slice",Pe="replace";for(_[de](-2),_=_[de](0,-2)[Pe](/\s/g,"")[Pe]("z","!!!!!"),C=[],F=0,U=(_+=g="uuuuu"[de](_[$]%5||5))[$];U>F;F+=5)a=52200625*(_[ye](F)-33)+614125*(_[ye](F+1)-33)+7225*(_[ye](F+2)-33)+85*(_[ye](F+3)-33)+(_[ye](F+4)-33),C.push(V&a>>24,V&a>>16,V&a>>8,V&a);return function(ue,Se){for(var ze=Se;ze>0;ze--)ue.pop()}(C,g[$]),O.fromCharCode.apply(O,C)},f=function(_){var g=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((_=_.replace(/\s/g,"")).indexOf(">")!==-1&&(_=_.substr(0,_.indexOf(">"))),_.length%2&&(_+="0"),g.test(_)===!1)return"";for(var a="",C=0;C<_.length;C+=2)a+=String.fromCharCode("0x"+(_[C]+_[C+1]));return a},y=function(_){for(var g=new Uint8Array(_.length),a=_.length;a--;)g[a]=_.charCodeAt(a);return _=(g=lp(g)).reduce(function(C,F){return C+String.fromCharCode(F)},"")};d.processDataByFilters=function(_,g){var a=0,C=_||"",F=[];for(typeof(g=g||[])=="string"&&(g=[g]),a=0;a<g.length;a+=1)switch(g[a]){case"ASCII85Decode":case"/ASCII85Decode":C=u(C),F.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":C=s(C),F.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":C=f(C),F.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":C=C.split("").map(function(U){return("0"+U.charCodeAt().toString(16)).slice(-2)}).join("")+">",F.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":C=y(C),F.push("/FlateDecode");break;default:throw new Error('The filter: "'+g[a]+'" is not implemented')}return{data:C,reverseChain:F.reverse().join(" ")}}}(Li.API),function(d){d.loadFile=function(s,u,f){return function(y,_,g){_=_!==!1,g=typeof g=="function"?g:function(){};var a=void 0;try{a=function(C,F,U){var O=new XMLHttpRequest,$=0,V=function(ye){var de=ye.length,Pe=[],ue=String.fromCharCode;for($=0;$<de;$+=1)Pe.push(ue(255&ye.charCodeAt($)));return Pe.join("")};if(O.open("GET",C,!F),O.overrideMimeType("text/plain; charset=x-user-defined"),F===!1&&(O.onload=function(){O.status===200?U(V(this.responseText)):U(void 0)}),O.send(null),F&&O.status===200)return V(O.responseText)}(y,_,g)}catch{}return a}(s,u,f)},d.loadImageFile=d.loadFile}(Li.API),function(d){function s(){return(ki.html2canvas?Promise.resolve(ki.html2canvas):rp(()=>import("./html2canvas.esm-d2sM-0Wm-tnAx6l3B.js"),[])).catch(function(g){return Promise.reject(new Error("Could not load html2canvas: "+g))}).then(function(g){return g.default?g.default:g})}function u(){return(ki.DOMPurify?Promise.resolve(ki.DOMPurify):rp(()=>import("./purify.es-DD-6ZaCo-DpjTUmET.js"),[])).catch(function(g){return Promise.reject(new Error("Could not load dompurify: "+g))}).then(function(g){return g.default?g.default:g})}var f=function(g){var a=dr(g);return a==="undefined"?"undefined":a==="string"||g instanceof String?"string":a==="number"||g instanceof Number?"number":a==="function"||g instanceof Function?"function":g&&g.constructor===Array?"array":g&&g.nodeType===1?"element":a==="object"?"object":"unknown"},y=function(g,a){var C=document.createElement(g);for(var F in a.className&&(C.className=a.className),a.innerHTML&&a.dompurify&&(C.innerHTML=a.dompurify.sanitize(a.innerHTML)),a.style)C.style[F]=a.style[F];return C},_=function g(a){var C=Object.assign(g.convert(Promise.resolve()),JSON.parse(JSON.stringify(g.template))),F=g.convert(Promise.resolve(),C);return F=(F=F.setProgress(1,g,1,[g])).set(a)};(_.prototype=Object.create(Promise.prototype)).constructor=_,_.convert=function(g,a){return g.__proto__=a||_.prototype,g},_.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},_.prototype.from=function(g,a){return this.then(function(){switch(a=a||function(C){switch(f(C)){case"string":return"string";case"element":return C.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(g)){case"string":return this.then(u).then(function(C){return this.set({src:y("div",{innerHTML:g,dompurify:C})})});case"element":return this.set({src:g});case"canvas":return this.set({canvas:g});case"img":return this.set({img:g});default:return this.error("Unknown source type.")}})},_.prototype.to=function(g){switch(g){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},_.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var g={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},a=function C(F,U){for(var O=F.nodeType===3?document.createTextNode(F.nodeValue):F.cloneNode(!1),$=F.firstChild;$;$=$.nextSibling)U!==!0&&$.nodeType===1&&$.nodeName==="SCRIPT"||O.appendChild(C($,U));return F.nodeType===1&&(F.nodeName==="CANVAS"?(O.width=F.width,O.height=F.height,O.getContext("2d").drawImage(F,0,0)):F.nodeName!=="TEXTAREA"&&F.nodeName!=="SELECT"||(O.value=F.value),O.addEventListener("load",function(){O.scrollTop=F.scrollTop,O.scrollLeft=F.scrollLeft},!0)),O}(this.prop.src,this.opt.html2canvas.javascriptEnabled);a.tagName==="BODY"&&(g.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=y("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=y("div",{className:"html2pdf__container",style:g}),this.prop.container.appendChild(a),this.prop.container.firstChild.appendChild(y("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},_.prototype.toCanvas=function(){var g=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(g).then(s).then(function(a){var C=Object.assign({},this.opt.html2canvas);return delete C.onrendered,a(this.prop.container,C)}).then(function(a){(this.opt.html2canvas.onrendered||function(){})(a),this.prop.canvas=a,document.body.removeChild(this.prop.overlay)})},_.prototype.toContext2d=function(){var g=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(g).then(s).then(function(a){var C=this.opt.jsPDF,F=this.opt.fontFaces,U=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,O=Object.assign({async:!0,allowTaint:!0,scale:U,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete O.onrendered,C.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,C.context2d.posX=this.opt.x,C.context2d.posY=this.opt.y,C.context2d.margin=this.opt.margin,C.context2d.fontFaces=F,F)for(var $=0;$<F.length;++$){var V=F[$],ye=V.src.find(function(de){return de.format==="truetype"});ye&&C.addFont(ye.url,V.ref.name,V.ref.style)}return O.windowHeight=O.windowHeight||0,O.windowHeight=O.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):O.windowHeight,C.context2d.save(!0),a(this.prop.container,O)}).then(function(a){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(a),this.prop.canvas=a,document.body.removeChild(this.prop.overlay)})},_.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var g=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=g})},_.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},_.prototype.output=function(g,a,C){return(C=C||"pdf").toLowerCase()==="img"||C.toLowerCase()==="image"?this.outputImg(g,a):this.outputPdf(g,a)},_.prototype.outputPdf=function(g,a){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(g,a)})},_.prototype.outputImg=function(g){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(g){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+g+'" is not supported.'}})},_.prototype.save=function(g){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(g?{filename:g}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},_.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},_.prototype.set=function(g){if(f(g)!=="object")return this;var a=Object.keys(g||{}).map(function(C){if(C in _.template.prop)return function(){this.prop[C]=g[C]};switch(C){case"margin":return this.setMargin.bind(this,g.margin);case"jsPDF":return function(){return this.opt.jsPDF=g.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,g.pageSize);default:return function(){this.opt[C]=g[C]}}},this);return this.then(function(){return this.thenList(a)})},_.prototype.get=function(g,a){return this.then(function(){var C=g in _.template.prop?this.prop[g]:this.opt[g];return a?a(C):C})},_.prototype.setMargin=function(g){return this.then(function(){switch(f(g)){case"number":g=[g,g,g,g];case"array":if(g.length===2&&(g=[g[0],g[1],g[0],g[1]]),g.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=g}).then(this.setPageSize)},_.prototype.setPageSize=function(g){function a(C,F){return Math.floor(C*F/72*96)}return this.then(function(){(g=g||Li.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(g.inner={width:g.width-this.opt.margin[1]-this.opt.margin[3],height:g.height-this.opt.margin[0]-this.opt.margin[2]},g.inner.px={width:a(g.inner.width,g.k),height:a(g.inner.height,g.k)},g.inner.ratio=g.inner.height/g.inner.width),this.prop.pageSize=g})},_.prototype.setProgress=function(g,a,C,F){return g!=null&&(this.progress.val=g),a!=null&&(this.progress.state=a),C!=null&&(this.progress.n=C),F!=null&&(this.progress.stack=F),this.progress.ratio=this.progress.val/this.progress.state,this},_.prototype.updateProgress=function(g,a,C,F){return this.setProgress(g?this.progress.val+g:null,a||null,C?this.progress.n+C:null,F?this.progress.stack.concat(F):null)},_.prototype.then=function(g,a){var C=this;return this.thenCore(g,a,function(F,U){return C.updateProgress(null,null,1,[F]),Promise.prototype.then.call(this,function(O){return C.updateProgress(null,F),O}).then(F,U).then(function(O){return C.updateProgress(1),O})})},_.prototype.thenCore=function(g,a,C){C=C||Promise.prototype.then,g&&(g=g.bind(this)),a&&(a=a.bind(this));var F=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:_.convert(Object.assign({},this),Promise.prototype),U=C.call(F,g,a);return _.convert(U,this.__proto__)},_.prototype.thenExternal=function(g,a){return Promise.prototype.then.call(this,g,a)},_.prototype.thenList=function(g){var a=this;return g.forEach(function(C){a=a.thenCore(C)}),a},_.prototype.catch=function(g){g&&(g=g.bind(this));var a=Promise.prototype.catch.call(this,g);return _.convert(a,this)},_.prototype.catchExternal=function(g){return Promise.prototype.catch.call(this,g)},_.prototype.error=function(g){return this.then(function(){throw new Error(g)})},_.prototype.using=_.prototype.set,_.prototype.saveAs=_.prototype.save,_.prototype.export=_.prototype.output,_.prototype.run=_.prototype.then,Li.getPageSize=function(g,a,C){if(dr(g)==="object"){var F=g;g=F.orientation,a=F.unit||a,C=F.format||C}a=a||"mm",C=C||"a4",g=(""+(g||"P")).toLowerCase();var U,O=(""+C).toLowerCase(),$={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(a){case"pt":U=1;break;case"mm":U=72/25.4;break;case"cm":U=72/2.54;break;case"in":U=72;break;case"px":U=.75;break;case"pc":case"em":U=12;break;case"ex":U=6;break;default:throw"Invalid unit: "+a}var V,ye=0,de=0;if($.hasOwnProperty(O))ye=$[O][1]/U,de=$[O][0]/U;else try{ye=C[1],de=C[0]}catch{throw new Error("Invalid format: "+C)}if(g==="p"||g==="portrait")g="p",de>ye&&(V=de,de=ye,ye=V);else{if(g!=="l"&&g!=="landscape")throw"Invalid orientation: "+g;g="l",ye>de&&(V=de,de=ye,ye=V)}return{width:de,height:ye,unit:a,k:U,orientation:g}},d.html=function(g,a){(a=a||{}).callback=a.callback||function(){},a.html2canvas=a.html2canvas||{},a.html2canvas.canvas=a.html2canvas.canvas||this.canvas,a.jsPDF=a.jsPDF||this,a.fontFaces=a.fontFaces?a.fontFaces.map(fp):null;var C=new _(a);return a.worker?C:C.from(g).doCallback()}}(Li.API),Li.API.addJS=function(d){return Gm=d,this.internal.events.subscribe("postPutResources",function(){Mu=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Mu+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),Zm=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+Gm+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Mu!==void 0&&Zm!==void 0&&this.internal.out("/Names <</JavaScript "+Mu+" 0 R>>")}),this},function(d){var s;d.events.push(["postPutResources",function(){var u=this,f=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var y=u.outline.render().split(/\r\n/),_=0;_<y.length;_++){var g=y[_],a=f.exec(g);if(a!=null){var C=a[1];u.internal.newObjectDeferredBegin(C,!1)}u.internal.write(g)}if(this.outline.createNamedDestinations){var F=this.internal.pages.length,U=[];for(_=0;_<F;_++){var O=u.internal.newObject();U.push(O);var $=u.internal.getPageInfo(_+1);u.internal.write("<< /D["+$.objId+" 0 R /XYZ null null null]>> endobj")}var V=u.internal.newObject();for(u.internal.write("<< /Names [ "),_=0;_<U.length;_++)u.internal.write("(page_"+(_+1)+")"+U[_]+" 0 R");u.internal.write(" ] >>","endobj"),s=u.internal.newObject(),u.internal.write("<< /Dests "+V+" 0 R"),u.internal.write(">>","endobj")}}]),d.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+s+" 0 R"))}]),d.events.push(["initialized",function(){var u=this;u.outline={createNamedDestinations:!1,root:{children:[]}},u.outline.add=function(f,y,_){var g={title:y,options:_,children:[]};return f==null&&(f=this.root),f.children.push(g),g},u.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=u,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},u.outline.genIds_r=function(f){f.id=u.internal.newObjectDeferred();for(var y=0;y<f.children.length;y++)this.genIds_r(f.children[y])},u.outline.renderRoot=function(f){this.objStart(f),this.line("/Type /Outlines"),f.children.length>0&&(this.line("/First "+this.makeRef(f.children[0])),this.line("/Last "+this.makeRef(f.children[f.children.length-1]))),this.line("/Count "+this.count_r({count:0},f)),this.objEnd()},u.outline.renderItems=function(f){for(var y=this.ctx.pdf.internal.getVerticalCoordinateString,_=0;_<f.children.length;_++){var g=f.children[_];this.objStart(g),this.line("/Title "+this.makeString(g.title)),this.line("/Parent "+this.makeRef(f)),_>0&&this.line("/Prev "+this.makeRef(f.children[_-1])),_<f.children.length-1&&this.line("/Next "+this.makeRef(f.children[_+1])),g.children.length>0&&(this.line("/First "+this.makeRef(g.children[0])),this.line("/Last "+this.makeRef(g.children[g.children.length-1])));var a=this.count=this.count_r({count:0},g);if(a>0&&this.line("/Count "+a),g.options&&g.options.pageNumber){var C=u.internal.getPageInfo(g.options.pageNumber);this.line("/Dest ["+C.objId+" 0 R /XYZ 0 "+y(0)+" 0]")}this.objEnd()}for(var F=0;F<f.children.length;F++)this.renderItems(f.children[F])},u.outline.line=function(f){this.ctx.val+=f+`\r
`},u.outline.makeRef=function(f){return f.id+" 0 R"},u.outline.makeString=function(f){return"("+u.internal.pdfEscape(f)+")"},u.outline.objStart=function(f){this.ctx.val+=`\r
`+f.id+` 0 obj\r
<<\r
`},u.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},u.outline.count_r=function(f,y){for(var _=0;_<y.children.length;_++)f.count++,this.count_r(f,y.children[_]);return f.count}}])}(Li.API),function(d){var s=[192,193,194,195,196,197,198,199];d.processJPEG=function(u,f,y,_,g,a){var C,F=this.decode.DCT_DECODE,U=null;if(typeof u=="string"||this.__addimage__.isArrayBuffer(u)||this.__addimage__.isArrayBufferView(u)){switch(u=g||u,u=this.__addimage__.isArrayBuffer(u)?new Uint8Array(u):u,(C=function(O){for(var $,V=256*O.charCodeAt(4)+O.charCodeAt(5),ye=O.length,de={width:0,height:0,numcomponents:1},Pe=4;Pe<ye;Pe+=2){if(Pe+=V,s.indexOf(O.charCodeAt(Pe+1))!==-1){$=256*O.charCodeAt(Pe+5)+O.charCodeAt(Pe+6),de={width:256*O.charCodeAt(Pe+7)+O.charCodeAt(Pe+8),height:$,numcomponents:O.charCodeAt(Pe+9)};break}V=256*O.charCodeAt(Pe+2)+O.charCodeAt(Pe+3)}return de}(u=this.__addimage__.isArrayBufferView(u)?this.__addimage__.arrayBufferToBinaryString(u):u)).numcomponents){case 1:a=this.color_spaces.DEVICE_GRAY;break;case 4:a=this.color_spaces.DEVICE_CMYK;break;case 3:a=this.color_spaces.DEVICE_RGB}U={data:u,width:C.width,height:C.height,colorSpace:a,bitsPerComponent:8,filter:F,index:f,alias:y}}return U}}(Li.API);var sh,zu,Hm,Xm,Km,Zv=function(){var d,s,u;function f(_){var g,a,C,F,U,O,$,V,ye,de,Pe,ue,Se,ze;for(this.data=_,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},O=null;;){switch(g=this.readUInt32(),ye=(function(){var Ye,Je;for(Je=[],Ye=0;Ye<4;++Ye)Je.push(String.fromCharCode(this.data[this.pos++]));return Je}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(g);break;case"fcTL":O&&this.animation.frames.push(O),this.pos+=4,O={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},U=this.readUInt16(),F=this.readUInt16()||100,O.delay=1e3*U/F,O.disposeOp=this.data[this.pos++],O.blendOp=this.data[this.pos++],O.data=[];break;case"IDAT":case"fdAT":for(ye==="fdAT"&&(this.pos+=4,g-=4),_=(O!=null?O.data:void 0)||this.imgData,ue=0;0<=g?ue<g:ue>g;0<=g?++ue:--ue)_.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(C=this.palette.length/3,this.transparency.indexed=this.read(g),this.transparency.indexed.length>C)throw new Error("More transparent colors than palette size");if((de=C-this.transparency.indexed.length)>0)for(Se=0;0<=de?Se<de:Se>de;0<=de?++Se:--Se)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(g)[0];break;case 2:this.transparency.rgb=this.read(g)}break;case"tEXt":$=(Pe=this.read(g)).indexOf(0),V=String.fromCharCode.apply(String,Pe.slice(0,$)),this.text[V]=String.fromCharCode.apply(String,Pe.slice($+1));break;case"IEND":return O&&this.animation.frames.push(O),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(ze=this.colorType)===4||ze===6,a=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*a,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=g}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}f.prototype.read=function(_){var g,a;for(a=[],g=0;0<=_?g<_:g>_;0<=_?++g:--g)a.push(this.data[this.pos++]);return a},f.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},f.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},f.prototype.decodePixels=function(_){var g=this.pixelBitlength/8,a=new Uint8Array(this.width*this.height*g),C=0,F=this;if(_==null&&(_=this.imgData),_.length===0)return new Uint8Array(0);function U(O,$,V,ye){var de,Pe,ue,Se,ze,Ye,Je,ct,Ge,De,Qe,pt,pe,me,Ne,Le,et,it,nt,Xe,at,dt=Math.ceil((F.width-O)/V),Mt=Math.ceil((F.height-$)/ye),ie=F.width==dt&&F.height==Mt;for(me=g*dt,pt=ie?a:new Uint8Array(me*Mt),Ye=_.length,pe=0,Pe=0;pe<Mt&&C<Ye;){switch(_[C++]){case 0:for(Se=et=0;et<me;Se=et+=1)pt[Pe++]=_[C++];break;case 1:for(Se=it=0;it<me;Se=it+=1)de=_[C++],ze=Se<g?0:pt[Pe-g],pt[Pe++]=(de+ze)%256;break;case 2:for(Se=nt=0;nt<me;Se=nt+=1)de=_[C++],ue=(Se-Se%g)/g,Ne=pe&&pt[(pe-1)*me+ue*g+Se%g],pt[Pe++]=(Ne+de)%256;break;case 3:for(Se=Xe=0;Xe<me;Se=Xe+=1)de=_[C++],ue=(Se-Se%g)/g,ze=Se<g?0:pt[Pe-g],Ne=pe&&pt[(pe-1)*me+ue*g+Se%g],pt[Pe++]=(de+Math.floor((ze+Ne)/2))%256;break;case 4:for(Se=at=0;at<me;Se=at+=1)de=_[C++],ue=(Se-Se%g)/g,ze=Se<g?0:pt[Pe-g],pe===0?Ne=Le=0:(Ne=pt[(pe-1)*me+ue*g+Se%g],Le=ue&&pt[(pe-1)*me+(ue-1)*g+Se%g]),Je=ze+Ne-Le,ct=Math.abs(Je-ze),De=Math.abs(Je-Ne),Qe=Math.abs(Je-Le),Ge=ct<=De&&ct<=Qe?ze:De<=Qe?Ne:Le,pt[Pe++]=(de+Ge)%256;break;default:throw new Error("Invalid filter algorithm: "+_[C-1])}if(!ie){var xe=(($+pe*ye)*F.width+O)*g,ke=pe*me;for(Se=0;Se<dt;Se+=1){for(var Fe=0;Fe<g;Fe+=1)a[xe++]=pt[ke++];xe+=(V-1)*g}}pe++}}return _=Sv(_),F.interlaceMethod==1?(U(0,0,8,8),U(4,0,8,8),U(0,4,4,8),U(2,0,4,4),U(0,2,2,4),U(1,0,2,2),U(0,1,1,2)):U(0,0,1,1),a},f.prototype.decodePalette=function(){var _,g,a,C,F,U,O,$,V;for(a=this.palette,U=this.transparency.indexed||[],F=new Uint8Array((U.length||0)+a.length),C=0,_=0,g=O=0,$=a.length;O<$;g=O+=3)F[C++]=a[g],F[C++]=a[g+1],F[C++]=a[g+2],F[C++]=(V=U[_++])!=null?V:255;return F},f.prototype.copyToImageData=function(_,g){var a,C,F,U,O,$,V,ye,de,Pe,ue;if(C=this.colors,de=null,a=this.hasAlphaChannel,this.palette.length&&(de=(ue=this._decodedPalette)!=null?ue:this._decodedPalette=this.decodePalette(),C=4,a=!0),ye=(F=_.data||_).length,O=de||g,U=$=0,C===1)for(;U<ye;)V=de?4*g[U/4]:$,Pe=O[V++],F[U++]=Pe,F[U++]=Pe,F[U++]=Pe,F[U++]=a?O[V++]:255,$=V;else for(;U<ye;)V=de?4*g[U/4]:$,F[U++]=O[V++],F[U++]=O[V++],F[U++]=O[V++],F[U++]=a?O[V++]:255,$=V},f.prototype.decode=function(){var _;return _=new Uint8Array(this.width*this.height*4),this.copyToImageData(_,this.decodePixels()),_};var y=function(){if(Object.prototype.toString.call(ki)==="[object Window]"){try{s=ki.document.createElement("canvas"),u=s.getContext("2d")}catch{return!1}return!0}return!1};return y(),d=function(_){var g;if(y()===!0)return u.width=_.width,u.height=_.height,u.clearRect(0,0,_.width,_.height),u.putImageData(_,0,0),(g=new Image).src=s.toDataURL(),g;throw new Error("This method requires a Browser with Canvas-capability.")},f.prototype.decodeFrames=function(_){var g,a,C,F,U,O,$,V;if(this.animation){for(V=[],a=U=0,O=($=this.animation.frames).length;U<O;a=++U)g=$[a],C=_.createImageData(g.width,g.height),F=this.decodePixels(new Uint8Array(g.data)),this.copyToImageData(C,F),g.imageData=C,V.push(g.image=d(C));return V}},f.prototype.renderFrame=function(_,g){var a,C,F;return a=(C=this.animation.frames)[g],F=C[g-1],g===0&&_.clearRect(0,0,this.width,this.height),(F!=null?F.disposeOp:void 0)===1?_.clearRect(F.xOffset,F.yOffset,F.width,F.height):(F!=null?F.disposeOp:void 0)===2&&_.putImageData(F.imageData,F.xOffset,F.yOffset),a.blendOp===0&&_.clearRect(a.xOffset,a.yOffset,a.width,a.height),_.drawImage(a.image,a.xOffset,a.yOffset)},f.prototype.animate=function(_){var g,a,C,F,U,O,$=this;return a=0,O=this.animation,F=O.numFrames,C=O.frames,U=O.numPlays,(g=function(){var V,ye;if(V=a++%F,ye=C[V],$.renderFrame(_,V),F>1&&a/F<U)return $.animation._timeout=setTimeout(g,ye.delay)})()},f.prototype.stopAnimation=function(){var _;return clearTimeout((_=this.animation)!=null?_._timeout:void 0)},f.prototype.render=function(_){var g,a;return _._png&&_._png.stopAnimation(),_._png=this,_.width=this.width,_.height=this.height,g=_.getContext("2d"),this.animation?(this.decodeFrames(g),this.animate(g)):(a=g.createImageData(this.width,this.height),this.copyToImageData(a,this.decodePixels()),g.putImageData(a,0,0))},f}();/**
 * @license
 *
 * Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 *//**
 * @license
 * (c) Dean McNamee <dean@gmail.com>, 2013.
 *
 * https://github.com/deanm/omggif
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *
 * omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
 * including animation and compression.  It does not rely on any specific
 * underlying system, so should run in the browser, Node, or Plask.
 */function Gv(d){var s=0;if(d[s++]!==71||d[s++]!==73||d[s++]!==70||d[s++]!==56||(d[s++]+1&253)!=56||d[s++]!==97)throw new Error("Invalid GIF 87a/89a header.");var u=d[s++]|d[s++]<<8,f=d[s++]|d[s++]<<8,y=d[s++],_=y>>7,g=1<<(7&y)+1;d[s++],d[s++];var a=null,C=null;_&&(a=s,C=g,s+=3*g);var F=!0,U=[],O=0,$=null,V=0,ye=null;for(this.width=u,this.height=f;F&&s<d.length;)switch(d[s++]){case 33:switch(d[s++]){case 255:if(d[s]!==11||d[s+1]==78&&d[s+2]==69&&d[s+3]==84&&d[s+4]==83&&d[s+5]==67&&d[s+6]==65&&d[s+7]==80&&d[s+8]==69&&d[s+9]==50&&d[s+10]==46&&d[s+11]==48&&d[s+12]==3&&d[s+13]==1&&d[s+16]==0)s+=14,ye=d[s++]|d[s++]<<8,s++;else for(s+=12;;){if(!((pe=d[s++])>=0))throw Error("Invalid block size");if(pe===0)break;s+=pe}break;case 249:if(d[s++]!==4||d[s+4]!==0)throw new Error("Invalid graphics extension block.");var de=d[s++];O=d[s++]|d[s++]<<8,$=d[s++],!(1&de)&&($=null),V=de>>2&7,s++;break;case 254:for(;;){if(!((pe=d[s++])>=0))throw Error("Invalid block size");if(pe===0)break;s+=pe}break;default:throw new Error("Unknown graphic control label: 0x"+d[s-1].toString(16))}break;case 44:var Pe=d[s++]|d[s++]<<8,ue=d[s++]|d[s++]<<8,Se=d[s++]|d[s++]<<8,ze=d[s++]|d[s++]<<8,Ye=d[s++],Je=Ye>>6&1,ct=1<<(7&Ye)+1,Ge=a,De=C,Qe=!1;Ye>>7&&(Qe=!0,Ge=s,De=ct,s+=3*ct);var pt=s;for(s++;;){var pe;if(!((pe=d[s++])>=0))throw Error("Invalid block size");if(pe===0)break;s+=pe}U.push({x:Pe,y:ue,width:Se,height:ze,has_local_palette:Qe,palette_offset:Ge,palette_size:De,data_offset:pt,data_length:s-pt,transparent_index:$,interlaced:!!Je,delay:O,disposal:V});break;case 59:F=!1;break;default:throw new Error("Unknown gif block: 0x"+d[s-1].toString(16))}this.numFrames=function(){return U.length},this.loopCount=function(){return ye},this.frameInfo=function(me){if(me<0||me>=U.length)throw new Error("Frame index out of range.");return U[me]},this.decodeAndBlitFrameBGRA=function(me,Ne){var Le=this.frameInfo(me),et=Le.width*Le.height,it=new Uint8Array(et);Ym(d,Le.data_offset,it,et);var nt=Le.palette_offset,Xe=Le.transparent_index;Xe===null&&(Xe=256);var at=Le.width,dt=u-at,Mt=at,ie=4*(Le.y*u+Le.x),xe=4*((Le.y+Le.height)*u+Le.x),ke=ie,Fe=4*dt;Le.interlaced===!0&&(Fe+=4*u*7);for(var qe=8,$e=0,Ke=it.length;$e<Ke;++$e){var tt=it[$e];if(Mt===0&&(Mt=at,(ke+=Fe)>=xe&&(Fe=4*dt+4*u*(qe-1),ke=ie+(at+dt)*(qe<<1),qe>>=1)),tt===Xe)ke+=4;else{var Tt=d[nt+3*tt],kt=d[nt+3*tt+1],Nt=d[nt+3*tt+2];Ne[ke++]=Nt,Ne[ke++]=kt,Ne[ke++]=Tt,Ne[ke++]=255}--Mt}},this.decodeAndBlitFrameRGBA=function(me,Ne){var Le=this.frameInfo(me),et=Le.width*Le.height,it=new Uint8Array(et);Ym(d,Le.data_offset,it,et);var nt=Le.palette_offset,Xe=Le.transparent_index;Xe===null&&(Xe=256);var at=Le.width,dt=u-at,Mt=at,ie=4*(Le.y*u+Le.x),xe=4*((Le.y+Le.height)*u+Le.x),ke=ie,Fe=4*dt;Le.interlaced===!0&&(Fe+=4*u*7);for(var qe=8,$e=0,Ke=it.length;$e<Ke;++$e){var tt=it[$e];if(Mt===0&&(Mt=at,(ke+=Fe)>=xe&&(Fe=4*dt+4*u*(qe-1),ke=ie+(at+dt)*(qe<<1),qe>>=1)),tt===Xe)ke+=4;else{var Tt=d[nt+3*tt],kt=d[nt+3*tt+1],Nt=d[nt+3*tt+2];Ne[ke++]=Tt,Ne[ke++]=kt,Ne[ke++]=Nt,Ne[ke++]=255}--Mt}}}function Ym(d,s,u,f){for(var y=d[s++],_=1<<y,g=_+1,a=g+1,C=y+1,F=(1<<C)-1,U=0,O=0,$=0,V=d[s++],ye=new Int32Array(4096),de=null;;){for(;U<16&&V!==0;)O|=d[s++]<<U,U+=8,V===1?V=d[s++]:--V;if(U<C)break;var Pe=O&F;if(O>>=C,U-=C,Pe!==_){if(Pe===g)break;for(var ue=Pe<a?Pe:de,Se=0,ze=ue;ze>_;)ze=ye[ze]>>8,++Se;var Ye=ze;if($+Se+(ue!==Pe?1:0)>f)return void xr.log("Warning, gif stream longer than expected.");u[$++]=Ye;var Je=$+=Se;for(ue!==Pe&&(u[$++]=Ye),ze=ue;Se--;)ze=ye[ze],u[--Je]=255&ze,ze>>=8;de!==null&&a<4096&&(ye[a++]=de<<8|Ye,a>=F+1&&C<12&&(++C,F=F<<1|1)),de=Pe}else a=g+1,F=(1<<(C=y+1))-1,de=null}return $!==f&&xr.log("Warning, gif stream shorter than expected."),u}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function Xd(d){var s,u,f,y,_,g=Math.floor,a=new Array(64),C=new Array(64),F=new Array(64),U=new Array(64),O=new Array(65535),$=new Array(65535),V=new Array(64),ye=new Array(64),de=[],Pe=0,ue=7,Se=new Array(64),ze=new Array(64),Ye=new Array(64),Je=new Array(256),ct=new Array(2048),Ge=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],De=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],Qe=[0,1,2,3,4,5,6,7,8,9,10,11],pt=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],pe=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],me=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Ne=[0,1,2,3,4,5,6,7,8,9,10,11],Le=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],et=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function it(ie,xe){for(var ke=0,Fe=0,qe=new Array,$e=1;$e<=16;$e++){for(var Ke=1;Ke<=ie[$e];Ke++)qe[xe[Fe]]=[],qe[xe[Fe]][0]=ke,qe[xe[Fe]][1]=$e,Fe++,ke++;ke*=2}return qe}function nt(ie){for(var xe=ie[0],ke=ie[1]-1;ke>=0;)xe&1<<ke&&(Pe|=1<<ue),ke--,--ue<0&&(Pe==255?(Xe(255),Xe(0)):Xe(Pe),ue=7,Pe=0)}function Xe(ie){de.push(ie)}function at(ie){Xe(ie>>8&255),Xe(255&ie)}function dt(ie,xe,ke,Fe,qe){for(var $e,Ke=qe[0],tt=qe[240],Tt=function(ft,Pt){var Bt,Dt,Yt,ii,ui,Pi,Ni,yt,si,mi,Rt=0;for(si=0;si<8;++si){Bt=ft[Rt],Dt=ft[Rt+1],Yt=ft[Rt+2],ii=ft[Rt+3],ui=ft[Rt+4],Pi=ft[Rt+5],Ni=ft[Rt+6];var nr=Bt+(yt=ft[Rt+7]),_t=Bt-yt,ai=Dt+Ni,fe=Dt-Ni,k=Yt+Pi,D=Yt-Pi,ae=ii+ui,Ee=ii-ui,Re=nr+ae,Ve=nr-ae,lt=ai+k,ee=ai-k;ft[Rt]=Re+lt,ft[Rt+4]=Re-lt;var B=.707106781*(ee+Ve);ft[Rt+2]=Ve+B,ft[Rt+6]=Ve-B;var q=.382683433*((Re=Ee+D)-(ee=fe+_t)),Y=.5411961*Re+q,ne=1.306562965*ee+q,ge=.707106781*(lt=D+fe),ve=_t+ge,we=_t-ge;ft[Rt+5]=we+Y,ft[Rt+3]=we-Y,ft[Rt+1]=ve+ne,ft[Rt+7]=ve-ne,Rt+=8}for(Rt=0,si=0;si<8;++si){Bt=ft[Rt],Dt=ft[Rt+8],Yt=ft[Rt+16],ii=ft[Rt+24],ui=ft[Rt+32],Pi=ft[Rt+40],Ni=ft[Rt+48];var be=Bt+(yt=ft[Rt+56]),He=Bt-yt,st=Dt+Ni,je=Dt-Ni,xt=Yt+Pi,Ot=Yt-Pi,Xt=ii+ui,bi=ii-ui,ri=be+Xt,wi=be-Xt,yi=st+xt,Xi=st-xt;ft[Rt]=ri+yi,ft[Rt+32]=ri-yi;var Ui=.707106781*(Xi+wi);ft[Rt+16]=wi+Ui,ft[Rt+48]=wi-Ui;var _i=.382683433*((ri=bi+Ot)-(Xi=je+He)),qi=.5411961*ri+_i,Ki=1.306562965*Xi+_i,vr=.707106781*(yi=Ot+je),wr=He+vr,zr=He-vr;ft[Rt+40]=zr+qi,ft[Rt+24]=zr-qi,ft[Rt+8]=wr+Ki,ft[Rt+56]=wr-Ki,Rt++}for(si=0;si<64;++si)mi=ft[si]*Pt[si],V[si]=mi>0?mi+.5|0:mi-.5|0;return V}(ie,xe),kt=0;kt<64;++kt)ye[Ge[kt]]=Tt[kt];var Nt=ye[0]-ke;ke=ye[0],Nt==0?nt(Fe[0]):(nt(Fe[$[$e=32767+Nt]]),nt(O[$e]));for(var zt=63;zt>0&&ye[zt]==0;)zt--;if(zt==0)return nt(Ke),ke;for(var ti,ht=1;ht<=zt;){for(var te=ht;ye[ht]==0&&ht<=zt;)++ht;var gi=ht-te;if(gi>=16){ti=gi>>4;for(var Ht=1;Ht<=ti;++Ht)nt(tt);gi&=15}$e=32767+ye[ht],nt(qe[(gi<<4)+$[$e]]),nt(O[$e]),ht++}return zt!=63&&nt(Ke),ke}function Mt(ie){ie=Math.min(Math.max(ie,1),100),_!=ie&&(function(xe){for(var ke=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Fe=0;Fe<64;Fe++){var qe=g((ke[Fe]*xe+50)/100);qe=Math.min(Math.max(qe,1),255),a[Ge[Fe]]=qe}for(var $e=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Ke=0;Ke<64;Ke++){var tt=g(($e[Ke]*xe+50)/100);tt=Math.min(Math.max(tt,1),255),C[Ge[Ke]]=tt}for(var Tt=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],kt=0,Nt=0;Nt<8;Nt++)for(var zt=0;zt<8;zt++)F[kt]=1/(a[Ge[kt]]*Tt[Nt]*Tt[zt]*8),U[kt]=1/(C[Ge[kt]]*Tt[Nt]*Tt[zt]*8),kt++}(ie<50?Math.floor(5e3/ie):Math.floor(200-2*ie)),_=ie)}this.encode=function(ie,xe){xe&&Mt(xe),de=new Array,Pe=0,ue=7,at(65496),at(65504),at(16),Xe(74),Xe(70),Xe(73),Xe(70),Xe(0),Xe(1),Xe(1),Xe(0),at(1),at(1),Xe(0),Xe(0),function(){at(65499),at(132),Xe(0);for(var Dt=0;Dt<64;Dt++)Xe(a[Dt]);Xe(1);for(var Yt=0;Yt<64;Yt++)Xe(C[Yt])}(),function(Dt,Yt){at(65472),at(17),Xe(8),at(Yt),at(Dt),Xe(3),Xe(1),Xe(17),Xe(0),Xe(2),Xe(17),Xe(1),Xe(3),Xe(17),Xe(1)}(ie.width,ie.height),function(){at(65476),at(418),Xe(0);for(var Dt=0;Dt<16;Dt++)Xe(De[Dt+1]);for(var Yt=0;Yt<=11;Yt++)Xe(Qe[Yt]);Xe(16);for(var ii=0;ii<16;ii++)Xe(pt[ii+1]);for(var ui=0;ui<=161;ui++)Xe(pe[ui]);Xe(1);for(var Pi=0;Pi<16;Pi++)Xe(me[Pi+1]);for(var Ni=0;Ni<=11;Ni++)Xe(Ne[Ni]);Xe(17);for(var yt=0;yt<16;yt++)Xe(Le[yt+1]);for(var si=0;si<=161;si++)Xe(et[si])}(),at(65498),at(12),Xe(3),Xe(1),Xe(0),Xe(2),Xe(17),Xe(3),Xe(17),Xe(0),Xe(63),Xe(0);var ke=0,Fe=0,qe=0;Pe=0,ue=7,this.encode.displayName="_encode_";for(var $e,Ke,tt,Tt,kt,Nt,zt,ti,ht,te=ie.data,gi=ie.width,Ht=ie.height,ft=4*gi,Pt=0;Pt<Ht;){for($e=0;$e<ft;){for(kt=ft*Pt+$e,zt=-1,ti=0,ht=0;ht<64;ht++)Nt=kt+(ti=ht>>3)*ft+(zt=4*(7&ht)),Pt+ti>=Ht&&(Nt-=ft*(Pt+1+ti-Ht)),$e+zt>=ft&&(Nt-=$e+zt-ft+4),Ke=te[Nt++],tt=te[Nt++],Tt=te[Nt++],Se[ht]=(ct[Ke]+ct[tt+256>>0]+ct[Tt+512>>0]>>16)-128,ze[ht]=(ct[Ke+768>>0]+ct[tt+1024>>0]+ct[Tt+1280>>0]>>16)-128,Ye[ht]=(ct[Ke+1280>>0]+ct[tt+1536>>0]+ct[Tt+1792>>0]>>16)-128;ke=dt(Se,F,ke,s,f),Fe=dt(ze,U,Fe,u,y),qe=dt(Ye,U,qe,u,y),$e+=32}Pt+=8}if(ue>=0){var Bt=[];Bt[1]=ue+1,Bt[0]=(1<<ue+1)-1,nt(Bt)}return at(65497),new Uint8Array(de)},d=d||50,function(){for(var ie=String.fromCharCode,xe=0;xe<256;xe++)Je[xe]=ie(xe)}(),s=it(De,Qe),u=it(me,Ne),f=it(pt,pe),y=it(Le,et),function(){for(var ie=1,xe=2,ke=1;ke<=15;ke++){for(var Fe=ie;Fe<xe;Fe++)$[32767+Fe]=ke,O[32767+Fe]=[],O[32767+Fe][1]=ke,O[32767+Fe][0]=Fe;for(var qe=-(xe-1);qe<=-ie;qe++)$[32767+qe]=ke,O[32767+qe]=[],O[32767+qe][1]=ke,O[32767+qe][0]=xe-1+qe;ie<<=1,xe<<=1}}(),function(){for(var ie=0;ie<256;ie++)ct[ie]=19595*ie,ct[ie+256>>0]=38470*ie,ct[ie+512>>0]=7471*ie+32768,ct[ie+768>>0]=-11059*ie,ct[ie+1024>>0]=-21709*ie,ct[ie+1280>>0]=32768*ie+8421375,ct[ie+1536>>0]=-27439*ie,ct[ie+1792>>0]=-5329*ie}(),Mt(d)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function lo(d,s){if(this.pos=0,this.buffer=d,this.datav=new DataView(d.buffer),this.is_with_alpha=!!s,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function Jm(d){function s(De){if(!De)throw Error("assert :P")}function u(De,Qe,pt){for(var pe=0;4>pe;pe++)if(De[Qe+pe]!=pt.charCodeAt(pe))return!0;return!1}function f(De,Qe,pt,pe,me){for(var Ne=0;Ne<me;Ne++)De[Qe+Ne]=pt[pe+Ne]}function y(De,Qe,pt,pe){for(var me=0;me<pe;me++)De[Qe+me]=pt}function _(De){return new Int32Array(De)}function g(De,Qe){for(var pt=[],pe=0;pe<De;pe++)pt.push(new Qe);return pt}function a(De,Qe){var pt=[];return function pe(me,Ne,Le){for(var et=Le[Ne],it=0;it<et&&(me.push(Le.length>Ne+1?[]:new Qe),!(Le.length<Ne+1));it++)pe(me[it],Ne+1,Le)}(pt,0,De),pt}var C=function(){var De=this;function Qe(b,A){for(var c=1<<A-1>>>0;b&c;)c>>>=1;return c?(b&c-1)+c:b}function pt(b,A,c,e,r){s(!(e%c));do b[A+(e-=c)]=r;while(0<e)}function pe(b,A,c,e,r){if(s(2328>=r),512>=r)var o=_(512);else if((o=_(r))==null)return 0;return function(h,p,w,S,P,M){var R,N,W=p,H=1<<w,G=_(16),K=_(16);for(s(P!=0),s(S!=null),s(h!=null),s(0<w),N=0;N<P;++N){if(15<S[N])return 0;++G[S[N]]}if(G[0]==P)return 0;for(K[1]=0,R=1;15>R;++R){if(G[R]>1<<R)return 0;K[R+1]=K[R]+G[R]}for(N=0;N<P;++N)R=S[N],0<S[N]&&(M[K[R]++]=N);if(K[15]==1)return(S=new me).g=0,S.value=M[0],pt(h,W,1,H,S),H;var se,oe=-1,he=H-1,le=0,_e=1,Me=1,Te=1<<w;for(N=0,R=1,P=2;R<=w;++R,P<<=1){if(_e+=Me<<=1,0>(Me-=G[R]))return 0;for(;0<G[R];--G[R])(S=new me).g=R,S.value=M[N++],pt(h,W+le,P,Te,S),le=Qe(le,R)}for(R=w+1,P=2;15>=R;++R,P<<=1){if(_e+=Me<<=1,0>(Me-=G[R]))return 0;for(;0<G[R];--G[R]){if(S=new me,(le&he)!=oe){for(W+=Te,se=1<<(oe=R)-w;15>oe&&!(0>=(se-=G[oe]));)++oe,se<<=1;H+=Te=1<<(se=oe-w),h[p+(oe=le&he)].g=se+w,h[p+oe].value=W-p-oe}S.g=R-w,S.value=M[N++],pt(h,W+(le>>w),P,Te,S),le=Qe(le,R)}}return _e!=2*K[15]-1?0:H}(b,A,c,e,r,o)}function me(){this.value=this.g=0}function Ne(){this.value=this.g=0}function Le(){this.G=g(5,me),this.H=_(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=g(Or,Ne)}function et(b,A,c,e){s(b!=null),s(A!=null),s(2147483648>e),b.Ca=254,b.I=0,b.b=-8,b.Ka=0,b.oa=A,b.pa=c,b.Jd=A,b.Yc=c+e,b.Zc=4<=e?c+e-4+1:c,$e(b)}function it(b,A){for(var c=0;0<A--;)c|=tt(b,128)<<A;return c}function nt(b,A){var c=it(b,A);return Ke(b)?-c:c}function Xe(b,A,c,e){var r,o=0;for(s(b!=null),s(A!=null),s(4294967288>e),b.Sb=e,b.Ra=0,b.u=0,b.h=0,4<e&&(e=4),r=0;r<e;++r)o+=A[c+r]<<8*r;b.Ra=o,b.bb=e,b.oa=A,b.pa=c}function at(b){for(;8<=b.u&&b.bb<b.Sb;)b.Ra>>>=8,b.Ra+=b.oa[b.pa+b.bb]<<Wn-8>>>0,++b.bb,b.u-=8;ke(b)&&(b.h=1,b.u=0)}function dt(b,A){if(s(0<=A),!b.h&&A<=Ia){var c=xe(b)&Aa[A];return b.u+=A,at(b),c}return b.h=1,b.u=0}function Mt(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function ie(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function xe(b){return b.Ra>>>(b.u&Wn-1)>>>0}function ke(b){return s(b.bb<=b.Sb),b.h||b.bb==b.Sb&&b.u>Wn}function Fe(b,A){b.u=A,b.h=ke(b)}function qe(b){b.u>=ta&&(s(b.u>=ta),at(b))}function $e(b){s(b!=null&&b.oa!=null),b.pa<b.Zc?(b.I=(b.oa[b.pa++]|b.I<<8)>>>0,b.b+=8):(s(b!=null&&b.oa!=null),b.pa<b.Yc?(b.b+=8,b.I=b.oa[b.pa++]|b.I<<8):b.Ka?b.b=0:(b.I<<=8,b.b+=8,b.Ka=1))}function Ke(b){return it(b,1)}function tt(b,A){var c=b.Ca;0>b.b&&$e(b);var e=b.b,r=c*A>>>8,o=(b.I>>>e>r)+0;for(o?(c-=r,b.I-=r+1<<e>>>0):c=r+1,e=c,r=0;256<=e;)r+=8,e>>=8;return e=7^r+jr[e],b.b-=e,b.Ca=(c<<e)-1,o}function Tt(b,A,c){b[A+0]=c>>24&255,b[A+1]=c>>16&255,b[A+2]=c>>8&255,b[A+3]=c>>0&255}function kt(b,A){return b[A+0]<<0|b[A+1]<<8}function Nt(b,A){return kt(b,A)|b[A+2]<<16}function zt(b,A){return kt(b,A)|kt(b,A+2)<<16}function ti(b,A){var c=1<<A;return s(b!=null),s(0<A),b.X=_(c),b.X==null?0:(b.Mb=32-A,b.Xa=A,1)}function ht(b,A){s(b!=null),s(A!=null),s(b.Xa==A.Xa),f(A.X,0,b.X,0,1<<A.Xa)}function te(){this.X=[],this.Xa=this.Mb=0}function gi(b,A,c,e){s(c!=null),s(e!=null);var r=c[0],o=e[0];return r==0&&(r=(b*o+A/2)/A),o==0&&(o=(A*r+b/2)/b),0>=r||0>=o?0:(c[0]=r,e[0]=o,1)}function Ht(b,A){return b+(1<<A)-1>>>A}function ft(b,A){return((4278255360&b)+(4278255360&A)>>>0&4278255360)+((16711935&b)+(16711935&A)>>>0&16711935)>>>0}function Pt(b,A){De[A]=function(c,e,r,o,h,p,w){var S;for(S=0;S<h;++S){var P=De[b](p[w+S-1],r,o+S);p[w+S]=ft(c[e+S],P)}}}function Bt(){this.ud=this.hd=this.jd=0}function Dt(b,A){return((4278124286&(b^A))>>>1)+(b&A)>>>0}function Yt(b){return 0<=b&&256>b?b:0>b?0:255<b?255:void 0}function ii(b,A){return Yt(b+(b-A+.5>>1))}function ui(b,A,c){return Math.abs(A-c)-Math.abs(b-c)}function Pi(b,A,c,e,r,o,h){for(e=o[h-1],c=0;c<r;++c)o[h+c]=e=ft(b[A+c],e)}function Ni(b,A,c,e,r){var o;for(o=0;o<c;++o){var h=b[A+o],p=h>>8&255,w=16711935&(w=(w=16711935&h)+((p<<16)+p));e[r+o]=(4278255360&h)+w>>>0}}function yt(b,A){A.jd=b>>0&255,A.hd=b>>8&255,A.ud=b>>16&255}function si(b,A,c,e,r,o){var h;for(h=0;h<e;++h){var p=A[c+h],w=p>>>8,S=p,P=255&(P=(P=p>>>16)+((b.jd<<24>>24)*(w<<24>>24)>>>5));S=255&(S=(S=S+((b.hd<<24>>24)*(w<<24>>24)>>>5))+((b.ud<<24>>24)*(P<<24>>24)>>>5)),r[o+h]=(4278255360&p)+(P<<16)+S}}function mi(b,A,c,e,r){De[A]=function(o,h,p,w,S,P,M,R,N){for(w=M;w<R;++w)for(M=0;M<N;++M)S[P++]=r(p[e(o[h++])])},De[b]=function(o,h,p,w,S,P,M){var R=8>>o.b,N=o.Ea,W=o.K[0],H=o.w;if(8>R)for(o=(1<<o.b)-1,H=(1<<R)-1;h<p;++h){var G,K=0;for(G=0;G<N;++G)G&o||(K=e(w[S++])),P[M++]=r(W[K&H]),K>>=R}else De["VP8LMapColor"+c](w,S,W,H,P,M,h,p,N)}}function Rt(b,A,c,e,r){for(c=A+c;A<c;){var o=b[A++];e[r++]=o>>16&255,e[r++]=o>>8&255,e[r++]=o>>0&255}}function nr(b,A,c,e,r){for(c=A+c;A<c;){var o=b[A++];e[r++]=o>>16&255,e[r++]=o>>8&255,e[r++]=o>>0&255,e[r++]=o>>24&255}}function _t(b,A,c,e,r){for(c=A+c;A<c;){var o=(h=b[A++])>>16&240|h>>12&15,h=h>>0&240|h>>28&15;e[r++]=o,e[r++]=h}}function ai(b,A,c,e,r){for(c=A+c;A<c;){var o=(h=b[A++])>>16&248|h>>13&7,h=h>>5&224|h>>3&31;e[r++]=o,e[r++]=h}}function fe(b,A,c,e,r){for(c=A+c;A<c;){var o=b[A++];e[r++]=o>>0&255,e[r++]=o>>8&255,e[r++]=o>>16&255}}function k(b,A,c,e,r,o){if(o==0)for(c=A+c;A<c;)Tt(e,((o=b[A++])[0]>>24|o[1]>>8&65280|o[2]<<8&16711680|o[3]<<24)>>>0),r+=32;else f(e,r,b,A,c)}function D(b,A){De[A][0]=De[b+"0"],De[A][1]=De[b+"1"],De[A][2]=De[b+"2"],De[A][3]=De[b+"3"],De[A][4]=De[b+"4"],De[A][5]=De[b+"5"],De[A][6]=De[b+"6"],De[A][7]=De[b+"7"],De[A][8]=De[b+"8"],De[A][9]=De[b+"9"],De[A][10]=De[b+"10"],De[A][11]=De[b+"11"],De[A][12]=De[b+"12"],De[A][13]=De[b+"13"],De[A][14]=De[b+"0"],De[A][15]=De[b+"0"]}function ae(b){return b==Fo||b==Qa||b==Ro||b==gl}function Ee(){this.eb=[],this.size=this.A=this.fb=0}function Re(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Ve(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new Ee,this.f.kb=new Re,this.sd=null}function lt(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function ee(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function B(b){return alert("todo:WebPSamplerProcessPlane"),b.T}function q(b,A){var c=b.T,e=A.ba.f.RGBA,r=e.eb,o=e.fb+b.ka*e.A,h=Si[A.ba.S],p=b.y,w=b.O,S=b.f,P=b.N,M=b.ea,R=b.W,N=A.cc,W=A.dc,H=A.Mc,G=A.Nc,K=b.ka,se=b.ka+b.T,oe=b.U,he=oe+1>>1;for(K==0?h(p,w,null,null,S,P,M,R,S,P,M,R,r,o,null,null,oe):(h(A.ec,A.fc,p,w,N,W,H,G,S,P,M,R,r,o-e.A,r,o,oe),++c);K+2<se;K+=2)N=S,W=P,H=M,G=R,P+=b.Rc,R+=b.Rc,o+=2*e.A,h(p,(w+=2*b.fa)-b.fa,p,w,N,W,H,G,S,P,M,R,r,o-e.A,r,o,oe);return w+=b.fa,b.j+se<b.o?(f(A.ec,A.fc,p,w,oe),f(A.cc,A.dc,S,P,he),f(A.Mc,A.Nc,M,R,he),c--):1&se||h(p,w,null,null,S,P,M,R,S,P,M,R,r,o+e.A,null,null,oe),c}function Y(b,A,c){var e=b.F,r=[b.J];if(e!=null){var o=b.U,h=A.ba.S,p=h==Do||h==Ro;A=A.ba.f.RGBA;var w=[0],S=b.ka;w[0]=b.T,b.Kb&&(S==0?--w[0]:(--S,r[0]-=b.width),b.j+b.ka+b.T==b.o&&(w[0]=b.o-b.j-S));var P=A.eb;S=A.fb+S*A.A,b=Zi(e,r[0],b.width,o,w,P,S+(p?0:3),A.A),s(c==w),b&&ae(h)&&on(P,S,p,o,w,A.A)}return 0}function ne(b){var A=b.ma,c=A.ba.S,e=11>c,r=c==Ya||c==Ja||c==Do||c==ml||c==12||ae(c);if(A.memory=null,A.Ib=null,A.Jb=null,A.Nd=null,!fs(A.Oa,b,r?11:12))return 0;if(r&&ae(c)&&Lt(),b.da)alert("todo:use_scaling");else{if(e){if(A.Ib=B,b.Kb){if(c=b.U+1>>1,A.memory=_(b.U+2*c),A.memory==null)return 0;A.ec=A.memory,A.fc=0,A.cc=A.ec,A.dc=A.fc+b.U,A.Mc=A.cc,A.Nc=A.dc+c,A.Ib=q,Lt()}}else alert("todo:EmitYUV");r&&(A.Jb=Y,e&&We())}if(e&&!Qi){for(b=0;256>b;++b)qo[b]=89858*(b-128)+Vl>>vl,jc[b]=-22014*(b-128)+Vl,$l[b]=-45773*(b-128),Ul[b]=113618*(b-128)+Vl>>vl;for(b=io;b<_c;++b)A=76283*(b-16)+Vl>>vl,bl[b-io]=Oi(A,255),xl[b-io]=Oi(A+8>>4,15);Qi=1}return 1}function ge(b){var A=b.ma,c=b.U,e=b.T;return s(!(1&b.ka)),0>=c||0>=e?0:(c=A.Ib(b,A),A.Jb!=null&&A.Jb(b,A,c),A.Dc+=c,1)}function ve(b){b.ma.memory=null}function we(b,A,c,e){return dt(b,8)!=47?0:(A[0]=dt(b,14)+1,c[0]=dt(b,14)+1,e[0]=dt(b,1),dt(b,3)!=0?0:!b.h)}function be(b,A){if(4>b)return b+1;var c=b-2>>1;return(2+(1&b)<<c)+dt(A,c)+1}function He(b,A){return 120<A?A-120:1<=(c=((c=Xn[A-1])>>4)*b+(8-(15&c)))?c:1;var c}function st(b,A,c){var e=xe(c),r=b[A+=255&e].g-8;return 0<r&&(Fe(c,c.u+8),e=xe(c),A+=b[A].value,A+=e&(1<<r)-1),Fe(c,c.u+b[A].g),b[A].value}function je(b,A,c){return c.g+=b.g,c.value+=b.value<<A>>>0,s(8>=c.g),b.g}function xt(b,A,c){var e=b.xc;return s((A=e==0?0:b.vc[b.md*(c>>e)+(A>>e)])<b.Wb),b.Ya[A]}function Ot(b,A,c,e){var r=b.ab,o=b.c*A,h=b.C;A=h+A;var p=c,w=e;for(e=b.Ta,c=b.Ua;0<r--;){var S=b.gc[r],P=h,M=A,R=p,N=w,W=(w=e,p=c,S.Ea);switch(s(P<M),s(M<=S.nc),S.hc){case 2:Wa(R,N,(M-P)*W,w,p);break;case 0:var H=P,G=M,K=w,se=p,oe=(Te=S).Ea;H==0&&(Pa(R,N,null,null,1,K,se),Pi(R,N+1,0,0,oe-1,K,se+1),N+=oe,se+=oe,++H);for(var he=1<<Te.b,le=he-1,_e=Ht(oe,Te.b),Me=Te.K,Te=Te.w+(H>>Te.b)*_e;H<G;){var rt=Me,mt=Te,vt=1;for(ia(R,N,K,se-oe,1,K,se);vt<oe;){var St=(vt&~le)+he;St>oe&&(St=oe),(0,Mi[rt[mt++]>>8&15])(R,N+ +vt,K,se+vt-oe,St-vt,K,se+vt),vt=St}N+=oe,se+=oe,++H&le||(Te+=_e)}M!=S.nc&&f(w,p-W,w,p+(M-P-1)*W,W);break;case 1:for(W=R,G=N,oe=(R=S.Ea)-(se=R&~(K=(N=1<<S.b)-1)),H=Ht(R,S.b),he=S.K,S=S.w+(P>>S.b)*H;P<M;){for(le=he,_e=S,Me=new Bt,Te=G+se,rt=G+R;G<Te;)yt(le[_e++],Me),Ms(Me,W,G,N,w,p),G+=N,p+=N;G<rt&&(yt(le[_e++],Me),Ms(Me,W,G,oe,w,p),G+=oe,p+=oe),++P&K||(S+=H)}break;case 3:if(R==w&&N==p&&0<S.b){for(G=w,R=W=p+(M-P)*W-(se=(M-P)*Ht(S.Ea,S.b)),N=w,K=p,H=[],se=(oe=se)-1;0<=se;--se)H[se]=N[K+se];for(se=oe-1;0<=se;--se)G[R+se]=H[se];Hr(S,P,M,w,W,w,p)}else Hr(S,P,M,R,N,w,p)}p=e,w=c}w!=c&&f(e,c,p,w,o)}function Xt(b,A){var c=b.V,e=b.Ba+b.c*b.C,r=A-b.C;if(s(A<=b.l.o),s(16>=r),0<r){var o=b.l,h=b.Ta,p=b.Ua,w=o.width;if(Ot(b,r,c,e),r=p=[p],s((c=b.C)<(e=A)),s(o.v<o.va),e>o.o&&(e=o.o),c<o.j){var S=o.j-c;c=o.j,r[0]+=S*w}if(c>=e?c=0:(r[0]+=4*o.v,o.ka=c-o.j,o.U=o.va-o.v,o.T=e-c,c=1),c){if(p=p[0],11>(c=b.ca).S){var P=c.f.RGBA,M=(e=c.S,r=o.U,o=o.T,S=P.eb,P.A),R=o;for(P=P.fb+b.Ma*P.A;0<R--;){var N=h,W=p,H=r,G=S,K=P;switch(e){case No:An(N,W,H,G,K);break;case Ya:sn(N,W,H,G,K);break;case Fo:sn(N,W,H,G,K),on(G,K,0,H,1,0);break;case jl:Hn(N,W,H,G,K);break;case Ja:k(N,W,H,G,K,1);break;case Qa:k(N,W,H,G,K,1),on(G,K,0,H,1,0);break;case Do:k(N,W,H,G,K,0);break;case Ro:k(N,W,H,G,K,0),on(G,K,1,H,1,0);break;case ml:Dn(N,W,H,G,K);break;case gl:Dn(N,W,H,G,K),zi(G,K,H,1,0);break;case Ca:zs(N,W,H,G,K);break;default:s(0)}p+=w,P+=M}b.Ma+=o}else alert("todo:EmitRescaledRowsYUVA");s(b.Ma<=c.height)}}b.C=A,s(b.C<=b.i)}function bi(b){var A;if(0<b.ua)return 0;for(A=0;A<b.Wb;++A){var c=b.Ya[A].G,e=b.Ya[A].H;if(0<c[1][e[1]+0].g||0<c[2][e[2]+0].g||0<c[3][e[3]+0].g)return 0}return 1}function ri(b,A,c,e,r,o){if(b.Z!=0){var h=b.qd,p=b.rd;for(s(Bs[b.Z]!=null);A<c;++A)Bs[b.Z](h,p,e,r,e,r,o),h=e,p=r,r+=o;b.qd=h,b.rd=p}}function wi(b,A){var c=b.l.ma,e=c.Z==0||c.Z==1?b.l.j:b.C;if(e=b.C<e?e:b.C,s(A<=b.l.o),A>e){var r=b.l.width,o=c.ca,h=c.tb+r*e,p=b.V,w=b.Ba+b.c*e,S=b.gc;s(b.ab==1),s(S[0].hc==3),pl(S[0],e,A,p,w,o,h),ri(c,e,A,o,h,r)}b.C=b.Ma=A}function yi(b,A,c,e,r,o,h){var p=b.$/e,w=b.$%e,S=b.m,P=b.s,M=c+b.$,R=M;r=c+e*r;var N=c+e*o,W=280+P.ua,H=b.Pb?p:16777216,G=0<P.ua?P.Wa:null,K=P.wc,se=M<N?xt(P,w,p):null;s(b.C<o),s(N<=r);var oe=!1;e:for(;;){for(;oe||M<N;){var he=0;if(p>=H){var le=M-c;s((H=b).Pb),H.wd=H.m,H.xd=le,0<H.s.ua&&ht(H.s.Wa,H.s.vb),H=p+dc}if(w&K||(se=xt(P,w,p)),s(se!=null),se.Qb&&(A[M]=se.qb,oe=!0),!oe)if(qe(S),se.jc){he=S,le=A;var _e=M,Me=se.pd[xe(he)&Or-1];s(se.jc),256>Me.g?(Fe(he,he.u+Me.g),le[_e]=Me.value,he=0):(Fe(he,he.u+Me.g-256),s(256<=Me.value),he=Me.value),he==0&&(oe=!0)}else he=st(se.G[0],se.H[0],S);if(S.h)break;if(oe||256>he){if(!oe)if(se.nd)A[M]=(se.qb|he<<8)>>>0;else{if(qe(S),oe=st(se.G[1],se.H[1],S),qe(S),le=st(se.G[2],se.H[2],S),_e=st(se.G[3],se.H[3],S),S.h)break;A[M]=(_e<<24|oe<<16|he<<8|le)>>>0}if(oe=!1,++M,++w>=e&&(w=0,++p,h!=null&&p<=o&&!(p%16)&&h(b,p),G!=null))for(;R<M;)he=A[R++],G.X[(506832829*he&4294967295)>>>G.Mb]=he}else if(280>he){if(he=be(he-256,S),le=st(se.G[4],se.H[4],S),qe(S),le=He(e,le=be(le,S)),S.h)break;if(M-c<le||r-M<he)break e;for(_e=0;_e<he;++_e)A[M+_e]=A[M+_e-le];for(M+=he,w+=he;w>=e;)w-=e,++p,h!=null&&p<=o&&!(p%16)&&h(b,p);if(s(M<=r),w&K&&(se=xt(P,w,p)),G!=null)for(;R<M;)he=A[R++],G.X[(506832829*he&4294967295)>>>G.Mb]=he}else{if(!(he<W))break e;for(oe=he-280,s(G!=null);R<M;)he=A[R++],G.X[(506832829*he&4294967295)>>>G.Mb]=he;he=M,s(!(oe>>>(le=G).Xa)),A[he]=le.X[oe],oe=!0}oe||s(S.h==ke(S))}if(b.Pb&&S.h&&M<r)s(b.m.h),b.a=5,b.m=b.wd,b.$=b.xd,0<b.s.ua&&ht(b.s.vb,b.s.Wa);else{if(S.h)break e;h!=null&&h(b,p>o?o:p),b.a=0,b.$=M-c}return 1}return b.a=3,0}function Xi(b){s(b!=null),b.vc=null,b.yc=null,b.Ya=null;var A=b.Wa;A!=null&&(A.X=null),b.vb=null,s(b!=null)}function Ui(){var b=new Ga;return b==null?null:(b.a=0,b.xb=eo,D("Predictor","VP8LPredictors"),D("Predictor","VP8LPredictors_C"),D("PredictorAdd","VP8LPredictorsAdd"),D("PredictorAdd","VP8LPredictorsAdd_C"),Wa=Ni,Ms=si,An=Rt,sn=nr,Dn=_t,zs=ai,Hn=fe,De.VP8LMapColor32b=ms,De.VP8LMapColor8b=Eo,b)}function _i(b,A,c,e,r){var o=1,h=[b],p=[A],w=e.m,S=e.s,P=null,M=0;e:for(;;){if(c)for(;o&&dt(w,1);){var R=h,N=p,W=e,H=1,G=W.m,K=W.gc[W.ab],se=dt(G,2);if(W.Oc&1<<se)o=0;else{switch(W.Oc|=1<<se,K.hc=se,K.Ea=R[0],K.nc=N[0],K.K=[null],++W.ab,s(4>=W.ab),se){case 0:case 1:K.b=dt(G,3)+2,H=_i(Ht(K.Ea,K.b),Ht(K.nc,K.b),0,W,K.K),K.K=K.K[0];break;case 3:var oe,he=dt(G,8)+1,le=16<he?0:4<he?1:2<he?2:3;if(R[0]=Ht(K.Ea,le),K.b=le,oe=H=_i(he,1,0,W,K.K)){var _e,Me=he,Te=K,rt=1<<(8>>Te.b),mt=_(rt);if(mt==null)oe=0;else{var vt=Te.K[0],St=Te.w;for(mt[0]=Te.K[0][0],_e=1;_e<1*Me;++_e)mt[_e]=ft(vt[St+_e],mt[_e-1]);for(;_e<4*rt;++_e)mt[_e]=0;Te.K[0]=null,Te.K[0]=mt,oe=1}}H=oe;break;case 2:break;default:s(0)}o=H}}if(h=h[0],p=p[0],o&&dt(w,1)&&!(o=1<=(M=dt(w,4))&&11>=M)){e.a=3;break e}var wt;if(wt=o)t:{var bt,At,Gt,Ct=e,Et=h,Jt=p,fi=M,di=c,vi=Ct.m,Ti=Ct.s,Gi=[null],or=1,ji=0,br=Rs[fi];i:for(;;){if(di&&dt(vi,1)){var Wi=dt(vi,3)+2,mr=Ht(Et,Wi),Tr=Ht(Jt,Wi),_n=mr*Tr;if(!_i(mr,Tr,0,Ct,Gi))break i;for(Gi=Gi[0],Ti.xc=Wi,bt=0;bt<_n;++bt){var Bn=Gi[bt]>>8&65535;Gi[bt]=Bn,Bn>=or&&(or=Bn+1)}}if(vi.h)break i;for(At=0;5>At;++At){var lr=yl[At];!At&&0<fi&&(lr+=1<<fi),ji<lr&&(ji=lr)}var Ma=g(or*br,me),jn=or,Sl=g(jn,Le);if(Sl==null)var Vo=null;else s(65536>=jn),Vo=Sl;var ln=_(ji);if(Vo==null||ln==null||Ma==null){Ct.a=1;break i}var vn=Ma;for(bt=Gt=0;bt<or;++bt){var Ur=Vo[bt],cn=Ur.G,Pr=Ur.H,Kr=0,hn=1,Ri=0;for(At=0;5>At;++At){lr=yl[At],cn[At]=vn,Pr[At]=Gt,!At&&0<fi&&(lr+=1<<fi);n:{var js,za=lr,sa=Ct,Uo=ln,Ah=vn,qc=Gt,qs=0,aa=sa.m,Zl=dt(aa,1);if(y(Uo,0,0,za),Zl){var Al=dt(aa,1)+1,Gl=dt(aa,1),Il=dt(aa,Gl==0?1:8);Uo[Il]=1,Al==2&&(Uo[Il=dt(aa,8)]=1);var oa=1}else{var $o=_(19),vc=dt(aa,4)+4;if(19<vc){sa.a=3;var bc=0;break n}for(js=0;js<vc;++js)$o[Fc[js]]=dt(aa,3);var Vc=void 0,xc=void 0,Uc=sa,wc=$o,ro=za,Na=Uo,ws=0,qn=Uc.m,Ih=8,Zo=g(128,me);r:for(;pe(Zo,0,7,wc,19);){if(dt(qn,1)){var id=2+2*dt(qn,3);if((Vc=2+dt(qn,id))>ro)break r}else Vc=ro;for(xc=0;xc<ro&&Vc--;){qe(qn);var Ph=Zo[0+(127&xe(qn))];Fe(qn,qn.u+Ph.g);var cr=Ph.value;if(16>cr)Na[xc++]=cr,cr!=0&&(Ih=cr);else{var Lh=cr==16,kh=cr-16,Pl=uc[kh],Go=dt(qn,hc[kh])+Pl;if(xc+Go>ro)break r;for(var $c=Lh?Ih:0;0<Go--;)Na[xc++]=$c}}ws=1;break r}ws||(Uc.a=3),oa=ws}(oa=oa&&!aa.h)&&(qs=pe(Ah,qc,8,Uo,za)),oa&&qs!=0?bc=qs:(sa.a=3,bc=0)}if(bc==0)break i;if(hn&&Oo[At]==1&&(hn=vn[Gt].g==0),Kr+=vn[Gt].g,Gt+=bc,3>=At){var Ll,Zc=ln[0];for(Ll=1;Ll<lr;++Ll)ln[Ll]>Zc&&(Zc=ln[Ll]);Ri+=Zc}}if(Ur.nd=hn,Ur.Qb=0,hn&&(Ur.qb=(cn[3][Pr[3]+0].value<<24|cn[1][Pr[1]+0].value<<16|cn[2][Pr[2]+0].value)>>>0,Kr==0&&256>cn[0][Pr[0]+0].value&&(Ur.Qb=1,Ur.qb+=cn[0][Pr[0]+0].value<<8)),Ur.jc=!Ur.Qb&&6>Ri,Ur.jc){var Gc,Da=Ur;for(Gc=0;Gc<Or;++Gc){var Wo=Gc,Fa=Da.pd[Wo],Wc=Da.G[0][Da.H[0]+Wo];256<=Wc.value?(Fa.g=Wc.g+256,Fa.value=Wc.value):(Fa.g=0,Fa.value=0,Wo>>=je(Wc,8,Fa),Wo>>=je(Da.G[1][Da.H[1]+Wo],16,Fa),Wo>>=je(Da.G[2][Da.H[2]+Wo],0,Fa),je(Da.G[3][Da.H[3]+Wo],24,Fa))}}}Ti.vc=Gi,Ti.Wb=or,Ti.Ya=Vo,Ti.yc=Ma,wt=1;break t}wt=0}if(!(o=wt)){e.a=3;break e}if(0<M){if(S.ua=1<<M,!ti(S.Wa,M)){e.a=1,o=0;break e}}else S.ua=0;var Sc=e,Th=h,hu=p,Ho=Sc.s,Ch=Ho.xc;if(Sc.c=Th,Sc.i=hu,Ho.md=Ht(Th,Ch),Ho.wc=Ch==0?-1:(1<<Ch)-1,c){e.xb=jo;break e}if((P=_(h*p))==null){e.a=1,o=0;break e}o=(o=yi(e,P,0,h,p,p,null))&&!w.h;break e}return o?(r!=null?r[0]=P:(s(P==null),s(c)),e.$=0,c||Xi(S)):Xi(S),o}function qi(b,A){var c=b.c*b.i,e=c+A+16*A;return s(b.c<=A),b.V=_(e),b.V==null?(b.Ta=null,b.Ua=0,b.a=1,0):(b.Ta=b.V,b.Ua=b.Ba+c+A,1)}function Ki(b,A){var c=b.C,e=A-c,r=b.V,o=b.Ba+b.c*c;for(s(A<=b.l.o);0<e;){var h=16<e?16:e,p=b.l.ma,w=b.l.width,S=w*h,P=p.ca,M=p.tb+w*c,R=b.Ta,N=b.Ua;Ot(b,h,r,o),Ir(R,N,P,M,S),ri(p,c,c+h,P,M,w),e-=h,r+=h*b.c,c+=h}s(c==A),b.C=b.Ma=A}function vr(){this.ub=this.yd=this.td=this.Rb=0}function wr(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function zr(){this.Fb=this.Bb=this.Cb=0,this.Zb=_(4),this.Lb=_(4)}function Xs(){this.Yb=function(){var b=[];return function A(c,e,r){for(var o=r[e],h=0;h<o&&(c.push(r.length>e+1?[]:0),!(r.length<e+1));h++)A(c[h],e+1,r)}(b,0,[3,11]),b}()}function $i(){this.jb=_(3),this.Wc=a([4,8],Xs),this.Xc=a([4,17],Xs)}function rl(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new _(4),this.od=new _(4)}function ya(){this.ld=this.La=this.dd=this.tc=0}function tn(){this.Na=this.la=0}function fn(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function nl(){this.ad=_(384),this.Za=0,this.Ob=_(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function xn(){this.uc=this.M=this.Nb=0,this.wa=Array(new ya),this.Y=0,this.ya=Array(new nl),this.aa=0,this.l=new $n}function rn(){this.y=_(16),this.f=_(8),this.ea=_(8)}function _a(){this.cb=this.a=0,this.sc="",this.m=new Mt,this.Od=new vr,this.Kc=new wr,this.ed=new rl,this.Qa=new zr,this.Ic=this.$c=this.Aa=0,this.D=new xn,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=g(8,Mt),this.ia=0,this.pb=g(4,fn),this.Pa=new $i,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new rn),this.Hd=0,this.rb=Array(new tn),this.sb=0,this.wa=Array(new ya),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new nl),this.L=this.aa=0,this.gd=a([4,2],ya),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function $n(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Sr(){var b=new _a;return b!=null&&(b.a=0,b.sc="OK",b.cb=0,b.Xb=0,_l||(_l=ja)),b}function sr(b,A,c){return b.a==0&&(b.a=A,b.sc=c,b.cb=0),0}function wn(b,A,c){return 3<=c&&b[A+0]==157&&b[A+1]==1&&b[A+2]==42}function pr(b,A){if(b==null)return 0;if(b.a=0,b.sc="OK",A==null)return sr(b,2,"null VP8Io passed to VP8GetHeaders()");var c=A.data,e=A.w,r=A.ha;if(4>r)return sr(b,7,"Truncated header.");var o=c[e+0]|c[e+1]<<8|c[e+2]<<16,h=b.Od;if(h.Rb=!(1&o),h.td=o>>1&7,h.yd=o>>4&1,h.ub=o>>5,3<h.td)return sr(b,3,"Incorrect keyframe parameters.");if(!h.yd)return sr(b,4,"Frame not displayable.");e+=3,r-=3;var p=b.Kc;if(h.Rb){if(7>r)return sr(b,7,"cannot parse picture header");if(!wn(c,e,r))return sr(b,3,"Bad code word");p.c=16383&(c[e+4]<<8|c[e+3]),p.Td=c[e+4]>>6,p.i=16383&(c[e+6]<<8|c[e+5]),p.Ud=c[e+6]>>6,e+=7,r-=7,b.za=p.c+15>>4,b.Ub=p.i+15>>4,A.width=p.c,A.height=p.i,A.Da=0,A.j=0,A.v=0,A.va=A.width,A.o=A.height,A.da=0,A.ib=A.width,A.hb=A.height,A.U=A.width,A.T=A.height,y((o=b.Pa).jb,0,255,o.jb.length),s((o=b.Qa)!=null),o.Cb=0,o.Bb=0,o.Fb=1,y(o.Zb,0,0,o.Zb.length),y(o.Lb,0,0,o.Lb)}if(h.ub>r)return sr(b,7,"bad partition length");et(o=b.m,c,e,h.ub),e+=h.ub,r-=h.ub,h.Rb&&(p.Ld=Ke(o),p.Kd=Ke(o)),p=b.Qa;var w,S=b.Pa;if(s(o!=null),s(p!=null),p.Cb=Ke(o),p.Cb){if(p.Bb=Ke(o),Ke(o)){for(p.Fb=Ke(o),w=0;4>w;++w)p.Zb[w]=Ke(o)?nt(o,7):0;for(w=0;4>w;++w)p.Lb[w]=Ke(o)?nt(o,6):0}if(p.Bb)for(w=0;3>w;++w)S.jb[w]=Ke(o)?it(o,8):255}else p.Bb=0;if(o.Ka)return sr(b,3,"cannot parse segment header");if((p=b.ed).zd=Ke(o),p.Tb=it(o,6),p.wb=it(o,3),p.Pc=Ke(o),p.Pc&&Ke(o)){for(S=0;4>S;++S)Ke(o)&&(p.vd[S]=nt(o,6));for(S=0;4>S;++S)Ke(o)&&(p.od[S]=nt(o,6))}if(b.L=p.Tb==0?0:p.zd?1:2,o.Ka)return sr(b,3,"cannot parse filter header");var P=r;if(r=w=e,e=w+P,p=P,b.Xb=(1<<it(b.m,2))-1,P<3*(S=b.Xb))c=7;else{for(w+=3*S,p-=3*S,P=0;P<S;++P){var M=c[r+0]|c[r+1]<<8|c[r+2]<<16;M>p&&(M=p),et(b.Jc[+P],c,w,M),w+=M,p-=M,r+=3}et(b.Jc[+S],c,w,p),c=w<e?0:5}if(c!=0)return sr(b,c,"cannot parse partitions");for(c=it(w=b.m,7),r=Ke(w)?nt(w,4):0,e=Ke(w)?nt(w,4):0,p=Ke(w)?nt(w,4):0,S=Ke(w)?nt(w,4):0,w=Ke(w)?nt(w,4):0,P=b.Qa,M=0;4>M;++M){if(P.Cb){var R=P.Zb[M];P.Fb||(R+=c)}else{if(0<M){b.pb[M]=b.pb[0];continue}R=c}var N=b.pb[M];N.Sc[0]=Fn[Oi(R+r,127)],N.Sc[1]=na[Oi(R+0,127)],N.Eb[0]=2*Fn[Oi(R+e,127)],N.Eb[1]=101581*na[Oi(R+p,127)]>>16,8>N.Eb[1]&&(N.Eb[1]=8),N.Qc[0]=Fn[Oi(R+S,117)],N.Qc[1]=na[Oi(R+w,127)],N.lc=R+w}if(!h.Rb)return sr(b,4,"Not a key frame.");for(Ke(o),h=b.Pa,c=0;4>c;++c){for(r=0;8>r;++r)for(e=0;3>e;++e)for(p=0;11>p;++p)S=tt(o,Kn[c][r][e][p])?it(o,8):fc[c][r][e][p],h.Wc[c][r].Yb[e][p]=S;for(r=0;17>r;++r)h.Xc[c][r]=h.Wc[c][Vt[r]]}return b.kc=Ke(o),b.kc&&(b.Bd=it(o,8)),b.cb=1}function ja(b,A,c,e,r,o,h){var p=A[r].Yb[c];for(c=0;16>r;++r){if(!tt(b,p[c+0]))return r;for(;!tt(b,p[c+1]);)if(p=A[++r].Yb[0],c=0,r==16)return 16;var w=A[r+1].Yb;if(tt(b,p[c+2])){var S=b,P=0;if(tt(S,(R=p)[(M=c)+3]))if(tt(S,R[M+6])){for(p=0,M=2*(P=tt(S,R[M+8]))+(R=tt(S,R[M+9+P])),P=0,R=wh[M];R[p];++p)P+=P+tt(S,R[p]);P+=3+(8<<M)}else tt(S,R[M+7])?(P=7+2*tt(S,165),P+=tt(S,145)):P=5+tt(S,159);else P=tt(S,R[M+4])?3+tt(S,R[M+5]):2;p=w[2]}else P=1,p=w[1];w=h+Rc[r],0>(S=b).b&&$e(S);var M,R=S.b,N=(M=S.Ca>>1)-(S.I>>R)>>31;--S.b,S.Ca+=N,S.Ca|=1,S.I-=(M+1&N)<<R,o[w]=((P^N)-N)*e[(0<r)+0]}return 16}function mn(b){var A=b.rb[b.sb-1];A.la=0,A.Na=0,y(b.zc,0,0,b.zc.length),b.ja=0}function sl(b,A){if(b==null)return 0;if(A==null)return sr(b,2,"NULL VP8Io parameter in VP8Decode().");if(!b.cb&&!pr(b,A))return 0;if(s(b.cb),A.ac==null||A.ac(A)){A.ob&&(b.L=0);var c=Ea[b.L];if(b.L==2?(b.yb=0,b.zb=0):(b.yb=A.v-c>>4,b.zb=A.j-c>>4,0>b.yb&&(b.yb=0),0>b.zb&&(b.zb=0)),b.Va=A.o+15+c>>4,b.Hb=A.va+15+c>>4,b.Hb>b.za&&(b.Hb=b.za),b.Va>b.Ub&&(b.Va=b.Ub),0<b.L){var e=b.ed;for(c=0;4>c;++c){var r;if(b.Qa.Cb){var o=b.Qa.Lb[c];b.Qa.Fb||(o+=e.Tb)}else o=e.Tb;for(r=0;1>=r;++r){var h=b.gd[c][r],p=o;if(e.Pc&&(p+=e.vd[0],r&&(p+=e.od[0])),0<(p=0>p?0:63<p?63:p)){var w=p;0<e.wb&&(w=4<e.wb?w>>2:w>>1)>9-e.wb&&(w=9-e.wb),1>w&&(w=1),h.dd=w,h.tc=2*p+w,h.ld=40<=p?2:15<=p?1:0}else h.tc=0;h.La=r}}}c=0}else sr(b,6,"Frame setup failed"),c=b.a;if(c=c==0){if(c){b.$c=0,0<b.Aa||(b.Ic=hi);e:{c=b.Ic,e=4*(w=b.za);var S=32*w,P=w+1,M=0<b.L?w*(0<b.Aa?2:1):0,R=(b.Aa==2?2:1)*w;if((h=e+832+(r=3*(16*c+Ea[b.L])/2*S)+(o=b.Fa!=null&&0<b.Fa.length?b.Kc.c*b.Kc.i:0))!=h)c=0;else{if(h>b.Vb){if(b.Vb=0,b.Ec=_(h),b.Fc=0,b.Ec==null){c=sr(b,1,"no memory during frame initialization.");break e}b.Vb=h}h=b.Ec,p=b.Fc,b.Ac=h,b.Bc=p,p+=e,b.Gd=g(S,rn),b.Hd=0,b.rb=g(P+1,tn),b.sb=1,b.wa=M?g(M,ya):null,b.Y=0,b.D.Nb=0,b.D.wa=b.wa,b.D.Y=b.Y,0<b.Aa&&(b.D.Y+=w),s(!0),b.oc=h,b.pc=p,p+=832,b.ya=g(R,nl),b.aa=0,b.D.ya=b.ya,b.D.aa=b.aa,b.Aa==2&&(b.D.aa+=w),b.R=16*w,b.B=8*w,w=(S=Ea[b.L])*b.R,S=S/2*b.B,b.sa=h,b.ta=p+w,b.qa=b.sa,b.ra=b.ta+16*c*b.R+S,b.Ha=b.qa,b.Ia=b.ra+8*c*b.B+S,b.$c=0,p+=r,b.mb=o?h:null,b.nb=o?p:null,s(p+o<=b.Fc+b.Vb),mn(b),y(b.Ac,b.Bc,0,e),c=1}}if(c){if(A.ka=0,A.y=b.sa,A.O=b.ta,A.f=b.qa,A.N=b.ra,A.ea=b.Ha,A.Vd=b.Ia,A.fa=b.R,A.Rc=b.B,A.F=null,A.J=0,!Ta){for(c=-255;255>=c;++c)Dr[255+c]=0>c?-c:c;for(c=-1020;1020>=c;++c)Yi[1020+c]=-128>c?-128:127<c?127:c;for(c=-112;112>=c;++c)yn[112+c]=-16>c?-16:15<c?15:c;for(c=-255;510>=c;++c)qr[255+c]=0>c?0:255<c?255:c;Ta=1}Ha=ol,Ns=Vi,La=mo,Nr=al,Xr=Ks,fr=hs,gs=Io,Mo=Za,Ds=Bl,ys=Po,Fs=Ol,_s=xa,ra=Lo,zo=cl,ka=ds,vs=Ci,Xa=Zn,an=cc,Rn[0]=zn,Rn[1]=qa,Rn[2]=_o,Rn[3]=vo,Rn[4]=ll,Rn[5]=bo,Rn[6]=Ys,Rn[7]=xo,Rn[8]=oc,Rn[9]=Fl,bs[0]=Dl,bs[1]=ba,bs[2]=Ps,bs[3]=yo,bs[4]=Ar,bs[5]=Ua,bs[6]=Gr,Os[0]=Ls,Os[1]=go,Os[2]=lc,Os[3]=wo,Os[4]=Js,Os[5]=So,Os[6]=$a,c=1}else c=0}c&&(c=function(N,W){for(N.M=0;N.M<N.Va;++N.M){var H,G=N.Jc[N.M&N.Xb],K=N.m,se=N;for(H=0;H<se.za;++H){var oe=K,he=se,le=he.Ac,_e=he.Bc+4*H,Me=he.zc,Te=he.ya[he.aa+H];if(he.Qa.Bb?Te.$b=tt(oe,he.Pa.jb[0])?2+tt(oe,he.Pa.jb[2]):tt(oe,he.Pa.jb[1]):Te.$b=0,he.kc&&(Te.Ad=tt(oe,he.Bd)),Te.Za=!tt(oe,145)+0,Te.Za){var rt=Te.Ob,mt=0;for(he=0;4>he;++he){var vt,St=Me[0+he];for(vt=0;4>vt;++vt){St=Bo[le[_e+vt]][St];for(var wt=pc[tt(oe,St[0])];0<wt;)wt=pc[2*wt+tt(oe,St[wt])];St=-wt,le[_e+vt]=St}f(rt,mt,le,_e,4),mt+=4,Me[0+he]=St}}else St=tt(oe,156)?tt(oe,128)?1:3:tt(oe,163)?2:0,Te.Ob[0]=St,y(le,_e,St,4),y(Me,0,St,4);Te.Dd=tt(oe,142)?tt(oe,114)?tt(oe,183)?1:3:2:0}if(se.m.Ka)return sr(N,7,"Premature end-of-partition0 encountered.");for(;N.ja<N.za;++N.ja){if(se=G,oe=(K=N).rb[K.sb-1],le=K.rb[K.sb+K.ja],H=K.ya[K.aa+K.ja],_e=K.kc?H.Ad:0)oe.la=le.la=0,H.Za||(oe.Na=le.Na=0),H.Hc=0,H.Gc=0,H.ia=0;else{var bt,At;if(oe=le,le=se,_e=K.Pa.Xc,Me=K.ya[K.aa+K.ja],Te=K.pb[Me.$b],he=Me.ad,rt=0,mt=K.rb[K.sb-1],St=vt=0,y(he,rt,0,384),Me.Za)var Gt=0,Ct=_e[3];else{wt=_(16);var Et=oe.Na+mt.Na;if(Et=_l(le,_e[1],Et,Te.Eb,0,wt,0),oe.Na=mt.Na=(0<Et)+0,1<Et)Ha(wt,0,he,rt);else{var Jt=wt[0]+3>>3;for(wt=0;256>wt;wt+=16)he[rt+wt]=Jt}Gt=1,Ct=_e[0]}var fi=15&oe.la,di=15&mt.la;for(wt=0;4>wt;++wt){var vi=1&di;for(Jt=At=0;4>Jt;++Jt)fi=fi>>1|(vi=(Et=_l(le,Ct,Et=vi+(1&fi),Te.Sc,Gt,he,rt))>Gt)<<7,At=At<<2|(3<Et?3:1<Et?2:he[rt+0]!=0),rt+=16;fi>>=4,di=di>>1|vi<<7,vt=(vt<<8|At)>>>0}for(Ct=fi,Gt=di>>4,bt=0;4>bt;bt+=2){for(At=0,fi=oe.la>>4+bt,di=mt.la>>4+bt,wt=0;2>wt;++wt){for(vi=1&di,Jt=0;2>Jt;++Jt)Et=vi+(1&fi),fi=fi>>1|(vi=0<(Et=_l(le,_e[2],Et,Te.Qc,0,he,rt)))<<3,At=At<<2|(3<Et?3:1<Et?2:he[rt+0]!=0),rt+=16;fi>>=2,di=di>>1|vi<<5}St|=At<<4*bt,Ct|=fi<<4<<bt,Gt|=(240&di)<<bt}oe.la=Ct,mt.la=Gt,Me.Hc=vt,Me.Gc=St,Me.ia=43690&St?0:Te.ia,_e=!(vt|St)}if(0<K.L&&(K.wa[K.Y+K.ja]=K.gd[H.$b][H.Za],K.wa[K.Y+K.ja].La|=!_e),se.Ka)return sr(N,7,"Premature end-of-file encountered.")}if(mn(N),K=W,se=1,H=(G=N).D,oe=0<G.L&&G.M>=G.zb&&G.M<=G.Va,G.Aa==0)e:{if(H.M=G.M,H.uc=oe,ea(G,H),se=1,H=(At=G.D).Nb,oe=(St=Ea[G.L])*G.R,le=St/2*G.B,wt=16*H*G.R,Jt=8*H*G.B,_e=G.sa,Me=G.ta-oe+wt,Te=G.qa,he=G.ra-le+Jt,rt=G.Ha,mt=G.Ia-le+Jt,di=(fi=At.M)==0,vt=fi>=G.Va-1,G.Aa==2&&ea(G,At),At.uc)for(vi=(Et=G).D.M,s(Et.D.uc),At=Et.yb;At<Et.Hb;++At){Gt=At,Ct=vi;var Ti=(Gi=(lr=Et).D).Nb;bt=lr.R;var Gi=Gi.wa[Gi.Y+Gt],or=lr.sa,ji=lr.ta+16*Ti*bt+16*Gt,br=Gi.dd,Wi=Gi.tc;if(Wi!=0)if(s(3<=Wi),lr.L==1)0<Gt&&vs(or,ji,bt,Wi+4),Gi.La&&an(or,ji,bt,Wi),0<Ct&&ka(or,ji,bt,Wi+4),Gi.La&&Xa(or,ji,bt,Wi);else{var mr=lr.B,Tr=lr.qa,_n=lr.ra+8*Ti*mr+8*Gt,Bn=lr.Ha,lr=lr.Ia+8*Ti*mr+8*Gt;Ti=Gi.ld,0<Gt&&(Mo(or,ji,bt,Wi+4,br,Ti),ys(Tr,_n,Bn,lr,mr,Wi+4,br,Ti)),Gi.La&&(_s(or,ji,bt,Wi,br,Ti),zo(Tr,_n,Bn,lr,mr,Wi,br,Ti)),0<Ct&&(gs(or,ji,bt,Wi+4,br,Ti),Ds(Tr,_n,Bn,lr,mr,Wi+4,br,Ti)),Gi.La&&(Fs(or,ji,bt,Wi,br,Ti),ra(Tr,_n,Bn,lr,mr,Wi,br,Ti))}}if(G.ia&&alert("todo:DitherRow"),K.put!=null){if(At=16*fi,fi=16*(fi+1),di?(K.y=G.sa,K.O=G.ta+wt,K.f=G.qa,K.N=G.ra+Jt,K.ea=G.Ha,K.W=G.Ia+Jt):(At-=St,K.y=_e,K.O=Me,K.f=Te,K.N=he,K.ea=rt,K.W=mt),vt||(fi-=St),fi>K.o&&(fi=K.o),K.F=null,K.J=null,G.Fa!=null&&0<G.Fa.length&&At<fi&&(K.J=Co(G,K,At,fi-At),K.F=G.mb,K.F==null&&K.F.length==0)){se=sr(G,3,"Could not decode alpha data.");break e}At<K.j&&(St=K.j-At,At=K.j,s(!(1&St)),K.O+=G.R*St,K.N+=G.B*(St>>1),K.W+=G.B*(St>>1),K.F!=null&&(K.J+=K.width*St)),At<fi&&(K.O+=K.v,K.N+=K.v>>1,K.W+=K.v>>1,K.F!=null&&(K.J+=K.v),K.ka=At-K.j,K.U=K.va-K.v,K.T=fi-At,se=K.put(K))}H+1!=G.Ic||vt||(f(G.sa,G.ta-oe,_e,Me+16*G.R,oe),f(G.qa,G.ra-le,Te,he+8*G.B,le),f(G.Ha,G.Ia-le,rt,mt+8*G.B,le))}if(!se)return sr(N,6,"Output aborted.")}return 1}(b,A)),A.bc!=null&&A.bc(A),c&=1}return c?(b.cb=0,c):0}function Lr(b,A,c,e,r){r=b[A+c+32*e]+(r>>3),b[A+c+32*e]=-256&r?0>r?0:255:r}function fo(b,A,c,e,r,o){Lr(b,A,0,c,e+r),Lr(b,A,1,c,e+o),Lr(b,A,2,c,e-o),Lr(b,A,3,c,e-r)}function Zr(b){return(20091*b>>16)+b}function cs(b,A,c,e){var r,o=0,h=_(16);for(r=0;4>r;++r){var p=b[A+0]+b[A+8],w=b[A+0]-b[A+8],S=(35468*b[A+4]>>16)-Zr(b[A+12]),P=Zr(b[A+4])+(35468*b[A+12]>>16);h[o+0]=p+P,h[o+1]=w+S,h[o+2]=w-S,h[o+3]=p-P,o+=4,A++}for(r=o=0;4>r;++r)p=(b=h[o+0]+4)+h[o+8],w=b-h[o+8],S=(35468*h[o+4]>>16)-Zr(h[o+12]),Lr(c,e,0,0,p+(P=Zr(h[o+4])+(35468*h[o+12]>>16))),Lr(c,e,1,0,w+S),Lr(c,e,2,0,w-S),Lr(c,e,3,0,p-P),o++,e+=32}function hs(b,A,c,e){var r=b[A+0]+4,o=35468*b[A+4]>>16,h=Zr(b[A+4]),p=35468*b[A+1]>>16;fo(c,e,0,r+h,b=Zr(b[A+1]),p),fo(c,e,1,r+o,b,p),fo(c,e,2,r-o,b,p),fo(c,e,3,r-h,b,p)}function Vi(b,A,c,e,r){cs(b,A,c,e),r&&cs(b,A+16,c,e+4)}function mo(b,A,c,e){Ns(b,A+0,c,e,1),Ns(b,A+32,c,e+128,1)}function al(b,A,c,e){var r;for(b=b[A+0]+4,r=0;4>r;++r)for(A=0;4>A;++A)Lr(c,e,A,r,b)}function Ks(b,A,c,e){b[A+0]&&Nr(b,A+0,c,e),b[A+16]&&Nr(b,A+16,c,e+4),b[A+32]&&Nr(b,A+32,c,e+128),b[A+48]&&Nr(b,A+48,c,e+128+4)}function ol(b,A,c,e){var r,o=_(16);for(r=0;4>r;++r){var h=b[A+0+r]+b[A+12+r],p=b[A+4+r]+b[A+8+r],w=b[A+4+r]-b[A+8+r],S=b[A+0+r]-b[A+12+r];o[0+r]=h+p,o[8+r]=h-p,o[4+r]=S+w,o[12+r]=S-w}for(r=0;4>r;++r)h=(b=o[0+4*r]+3)+o[3+4*r],p=o[1+4*r]+o[2+4*r],w=o[1+4*r]-o[2+4*r],S=b-o[3+4*r],c[e+0]=h+p>>3,c[e+16]=S+w>>3,c[e+32]=h-p>>3,c[e+48]=S-w>>3,e+=64}function va(b,A,c){var e,r=A-32,o=Vr,h=255-b[r-1];for(e=0;e<c;++e){var p,w=o,S=h+b[A-1];for(p=0;p<c;++p)b[A+p]=w[S+b[r+p]];A+=32}}function qa(b,A){va(b,A,4)}function go(b,A){va(b,A,8)}function ba(b,A){va(b,A,16)}function Ps(b,A){var c;for(c=0;16>c;++c)f(b,A+32*c,b,A-32,16)}function yo(b,A){var c;for(c=16;0<c;--c)y(b,A,b[A-1],16),A+=32}function Va(b,A,c){var e;for(e=0;16>e;++e)y(A,c+32*e,b,16)}function Dl(b,A){var c,e=16;for(c=0;16>c;++c)e+=b[A-1+32*c]+b[A+c-32];Va(e>>5,b,A)}function Ar(b,A){var c,e=8;for(c=0;16>c;++c)e+=b[A-1+32*c];Va(e>>4,b,A)}function Ua(b,A){var c,e=8;for(c=0;16>c;++c)e+=b[A+c-32];Va(e>>4,b,A)}function Gr(b,A){Va(128,b,A)}function oi(b,A,c){return b+2*A+c+2>>2}function _o(b,A){var c,e=A-32;for(e=new Uint8Array([oi(b[e-1],b[e+0],b[e+1]),oi(b[e+0],b[e+1],b[e+2]),oi(b[e+1],b[e+2],b[e+3]),oi(b[e+2],b[e+3],b[e+4])]),c=0;4>c;++c)f(b,A+32*c,e,0,e.length)}function vo(b,A){var c=b[A-1],e=b[A-1+32],r=b[A-1+64],o=b[A-1+96];Tt(b,A+0,16843009*oi(b[A-1-32],c,e)),Tt(b,A+32,16843009*oi(c,e,r)),Tt(b,A+64,16843009*oi(e,r,o)),Tt(b,A+96,16843009*oi(r,o,o))}function zn(b,A){var c,e=4;for(c=0;4>c;++c)e+=b[A+c-32]+b[A-1+32*c];for(e>>=3,c=0;4>c;++c)y(b,A+32*c,e,4)}function ll(b,A){var c=b[A-1+0],e=b[A-1+32],r=b[A-1+64],o=b[A-1-32],h=b[A+0-32],p=b[A+1-32],w=b[A+2-32],S=b[A+3-32];b[A+0+96]=oi(e,r,b[A-1+96]),b[A+1+96]=b[A+0+64]=oi(c,e,r),b[A+2+96]=b[A+1+64]=b[A+0+32]=oi(o,c,e),b[A+3+96]=b[A+2+64]=b[A+1+32]=b[A+0+0]=oi(h,o,c),b[A+3+64]=b[A+2+32]=b[A+1+0]=oi(p,h,o),b[A+3+32]=b[A+2+0]=oi(w,p,h),b[A+3+0]=oi(S,w,p)}function Ys(b,A){var c=b[A+1-32],e=b[A+2-32],r=b[A+3-32],o=b[A+4-32],h=b[A+5-32],p=b[A+6-32],w=b[A+7-32];b[A+0+0]=oi(b[A+0-32],c,e),b[A+1+0]=b[A+0+32]=oi(c,e,r),b[A+2+0]=b[A+1+32]=b[A+0+64]=oi(e,r,o),b[A+3+0]=b[A+2+32]=b[A+1+64]=b[A+0+96]=oi(r,o,h),b[A+3+32]=b[A+2+64]=b[A+1+96]=oi(o,h,p),b[A+3+64]=b[A+2+96]=oi(h,p,w),b[A+3+96]=oi(p,w,w)}function bo(b,A){var c=b[A-1+0],e=b[A-1+32],r=b[A-1+64],o=b[A-1-32],h=b[A+0-32],p=b[A+1-32],w=b[A+2-32],S=b[A+3-32];b[A+0+0]=b[A+1+64]=o+h+1>>1,b[A+1+0]=b[A+2+64]=h+p+1>>1,b[A+2+0]=b[A+3+64]=p+w+1>>1,b[A+3+0]=w+S+1>>1,b[A+0+96]=oi(r,e,c),b[A+0+64]=oi(e,c,o),b[A+0+32]=b[A+1+96]=oi(c,o,h),b[A+1+32]=b[A+2+96]=oi(o,h,p),b[A+2+32]=b[A+3+96]=oi(h,p,w),b[A+3+32]=oi(p,w,S)}function xo(b,A){var c=b[A+0-32],e=b[A+1-32],r=b[A+2-32],o=b[A+3-32],h=b[A+4-32],p=b[A+5-32],w=b[A+6-32],S=b[A+7-32];b[A+0+0]=c+e+1>>1,b[A+1+0]=b[A+0+64]=e+r+1>>1,b[A+2+0]=b[A+1+64]=r+o+1>>1,b[A+3+0]=b[A+2+64]=o+h+1>>1,b[A+0+32]=oi(c,e,r),b[A+1+32]=b[A+0+96]=oi(e,r,o),b[A+2+32]=b[A+1+96]=oi(r,o,h),b[A+3+32]=b[A+2+96]=oi(o,h,p),b[A+3+64]=oi(h,p,w),b[A+3+96]=oi(p,w,S)}function Fl(b,A){var c=b[A-1+0],e=b[A-1+32],r=b[A-1+64],o=b[A-1+96];b[A+0+0]=c+e+1>>1,b[A+2+0]=b[A+0+32]=e+r+1>>1,b[A+2+32]=b[A+0+64]=r+o+1>>1,b[A+1+0]=oi(c,e,r),b[A+3+0]=b[A+1+32]=oi(e,r,o),b[A+3+32]=b[A+1+64]=oi(r,o,o),b[A+3+64]=b[A+2+64]=b[A+0+96]=b[A+1+96]=b[A+2+96]=b[A+3+96]=o}function oc(b,A){var c=b[A-1+0],e=b[A-1+32],r=b[A-1+64],o=b[A-1+96],h=b[A-1-32],p=b[A+0-32],w=b[A+1-32],S=b[A+2-32];b[A+0+0]=b[A+2+32]=c+h+1>>1,b[A+0+32]=b[A+2+64]=e+c+1>>1,b[A+0+64]=b[A+2+96]=r+e+1>>1,b[A+0+96]=o+r+1>>1,b[A+3+0]=oi(p,w,S),b[A+2+0]=oi(h,p,w),b[A+1+0]=b[A+3+32]=oi(c,h,p),b[A+1+32]=b[A+3+64]=oi(e,c,h),b[A+1+64]=b[A+3+96]=oi(r,e,c),b[A+1+96]=oi(o,r,e)}function lc(b,A){var c;for(c=0;8>c;++c)f(b,A+32*c,b,A-32,8)}function wo(b,A){var c;for(c=0;8>c;++c)y(b,A,b[A-1],8),A+=32}function us(b,A,c){var e;for(e=0;8>e;++e)y(A,c+32*e,b,8)}function Ls(b,A){var c,e=8;for(c=0;8>c;++c)e+=b[A+c-32]+b[A-1+32*c];us(e>>4,b,A)}function So(b,A){var c,e=4;for(c=0;8>c;++c)e+=b[A+c-32];us(e>>3,b,A)}function Js(b,A){var c,e=4;for(c=0;8>c;++c)e+=b[A-1+32*c];us(e>>3,b,A)}function $a(b,A){us(128,b,A)}function gn(b,A,c){var e=b[A-c],r=b[A+0],o=3*(r-e)+fl[1020+b[A-2*c]-b[A+c]],h=Ka[112+(o+4>>3)];b[A-c]=Vr[255+e+Ka[112+(o+3>>3)]],b[A+0]=Vr[255+r-h]}function Rl(b,A,c,e){var r=b[A+0],o=b[A+c];return Fr[255+b[A-2*c]-b[A-c]]>e||Fr[255+o-r]>e}function Ao(b,A,c,e){return 4*Fr[255+b[A-c]-b[A+0]]+Fr[255+b[A-2*c]-b[A+c]]<=e}function ks(b,A,c,e,r){var o=b[A-3*c],h=b[A-2*c],p=b[A-c],w=b[A+0],S=b[A+c],P=b[A+2*c],M=b[A+3*c];return 4*Fr[255+p-w]+Fr[255+h-S]>e?0:Fr[255+b[A-4*c]-o]<=r&&Fr[255+o-h]<=r&&Fr[255+h-p]<=r&&Fr[255+M-P]<=r&&Fr[255+P-S]<=r&&Fr[255+S-w]<=r}function ds(b,A,c,e){var r=2*e+1;for(e=0;16>e;++e)Ao(b,A+e,c,r)&&gn(b,A+e,c)}function Ci(b,A,c,e){var r=2*e+1;for(e=0;16>e;++e)Ao(b,A+e*c,1,r)&&gn(b,A+e*c,1)}function Zn(b,A,c,e){var r;for(r=3;0<r;--r)ds(b,A+=4*c,c,e)}function cc(b,A,c,e){var r;for(r=3;0<r;--r)Ci(b,A+=4,c,e)}function Nn(b,A,c,e,r,o,h,p){for(o=2*o+1;0<r--;){if(ks(b,A,c,o,h))if(Rl(b,A,c,p))gn(b,A,c);else{var w=b,S=A,P=c,M=w[S-2*P],R=w[S-P],N=w[S+0],W=w[S+P],H=w[S+2*P],G=27*(se=fl[1020+3*(N-R)+fl[1020+M-W]])+63>>7,K=18*se+63>>7,se=9*se+63>>7;w[S-3*P]=Vr[255+w[S-3*P]+se],w[S-2*P]=Vr[255+M+K],w[S-P]=Vr[255+R+G],w[S+0]=Vr[255+N-G],w[S+P]=Vr[255+W-K],w[S+2*P]=Vr[255+H-se]}A+=e}}function ps(b,A,c,e,r,o,h,p){for(o=2*o+1;0<r--;){if(ks(b,A,c,o,h))if(Rl(b,A,c,p))gn(b,A,c);else{var w=b,S=A,P=c,M=w[S-P],R=w[S+0],N=w[S+P],W=Ka[112+((H=3*(R-M))+4>>3)],H=Ka[112+(H+3>>3)],G=W+1>>1;w[S-2*P]=Vr[255+w[S-2*P]+G],w[S-P]=Vr[255+M+H],w[S+0]=Vr[255+R-W],w[S+P]=Vr[255+N-G]}A+=e}}function Io(b,A,c,e,r,o){Nn(b,A,c,1,16,e,r,o)}function Za(b,A,c,e,r,o){Nn(b,A,1,c,16,e,r,o)}function Ol(b,A,c,e,r,o){var h;for(h=3;0<h;--h)ps(b,A+=4*c,c,1,16,e,r,o)}function xa(b,A,c,e,r,o){var h;for(h=3;0<h;--h)ps(b,A+=4,1,c,16,e,r,o)}function Bl(b,A,c,e,r,o,h,p){Nn(b,A,r,1,8,o,h,p),Nn(c,e,r,1,8,o,h,p)}function Po(b,A,c,e,r,o,h,p){Nn(b,A,1,r,8,o,h,p),Nn(c,e,1,r,8,o,h,p)}function Lo(b,A,c,e,r,o,h,p){ps(b,A+4*r,r,1,8,o,h,p),ps(c,e+4*r,r,1,8,o,h,p)}function cl(b,A,c,e,r,o,h,p){ps(b,A+4,1,r,8,o,h,p),ps(c,e+4,1,r,8,o,h,p)}function Gn(){this.ba=new Ve,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new ee,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function ko(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function hl(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function ul(){this.ua=0,this.Wa=new te,this.vb=new te,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new Le,this.yc=new me}function Ga(){this.xb=this.a=0,this.l=new $n,this.ca=new Ve,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new ie,this.Pb=0,this.wd=new ie,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new ul,this.ab=0,this.gc=g(4,hl),this.Oc=0}function To(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new $n,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Ts(b,A,c,e,r,o,h){for(b=b==null?0:b[A+0],A=0;A<h;++A)r[o+A]=b+c[e+A]&255,b=r[o+A]}function dl(b,A,c,e,r,o,h){var p;if(b==null)Ts(null,null,c,e,r,o,h);else for(p=0;p<h;++p)r[o+p]=b[A+p]+c[e+p]&255}function wa(b,A,c,e,r,o,h){if(b==null)Ts(null,null,c,e,r,o,h);else{var p,w=b[A+0],S=w,P=w;for(p=0;p<h;++p)S=P+(w=b[A+p])-S,P=c[e+p]+(-256&S?0>S?0:255:S)&255,S=w,r[o+p]=P}}function Co(b,A,c,e){var r=A.width,o=A.o;if(s(b!=null&&A!=null),0>c||0>=e||c+e>o)return null;if(!b.Cc){if(b.ga==null){var h;if(b.ga=new To,(h=b.ga==null)||(h=A.width*A.o,s(b.Gb.length==0),b.Gb=_(h),b.Uc=0,b.Gb==null?h=0:(b.mb=b.Gb,b.nb=b.Uc,b.rc=null,h=1),h=!h),!h){h=b.ga;var p=b.Fa,w=b.P,S=b.qc,P=b.mb,M=b.nb,R=w+1,N=S-1,W=h.l;if(s(p!=null&&P!=null&&A!=null),Bs[0]=null,Bs[1]=Ts,Bs[2]=dl,Bs[3]=wa,h.ca=P,h.tb=M,h.c=A.width,h.i=A.height,s(0<h.c&&0<h.i),1>=S)A=0;else if(h.$a=p[w+0]>>0&3,h.Z=p[w+0]>>2&3,h.Lc=p[w+0]>>4&3,w=p[w+0]>>6&3,0>h.$a||1<h.$a||4<=h.Z||1<h.Lc||w)A=0;else if(W.put=ge,W.ac=ne,W.bc=ve,W.ma=h,W.width=A.width,W.height=A.height,W.Da=A.Da,W.v=A.v,W.va=A.va,W.j=A.j,W.o=A.o,h.$a)e:{s(h.$a==1),A=Ui();t:for(;;){if(A==null){A=0;break e}if(s(h!=null),h.mc=A,A.c=h.c,A.i=h.i,A.l=h.l,A.l.ma=h,A.l.width=h.c,A.l.height=h.i,A.a=0,Xe(A.m,p,R,N),!_i(h.c,h.i,1,A,null)||(A.ab==1&&A.gc[0].hc==3&&bi(A.s)?(h.ic=1,p=A.c*A.i,A.Ta=null,A.Ua=0,A.V=_(p),A.Ba=0,A.V==null?(A.a=1,A=0):A=1):(h.ic=0,A=qi(A,h.c)),!A))break t;A=1;break e}h.mc=null,A=0}else A=N>=h.c*h.i;h=!A}if(h)return null;b.ga.Lc!=1?b.Ga=0:e=o-c}s(b.ga!=null),s(c+e<=o);e:{if(A=(p=b.ga).c,o=p.l.o,p.$a==0){if(R=b.rc,N=b.Vc,W=b.Fa,w=b.P+1+c*A,S=b.mb,P=b.nb+c*A,s(w<=b.P+b.qc),p.Z!=0)for(s(Bs[p.Z]!=null),h=0;h<e;++h)Bs[p.Z](R,N,W,w,S,P,A),R=S,N=P,P+=A,w+=A;else for(h=0;h<e;++h)f(S,P,W,w,A),R=S,N=P,P+=A,w+=A;b.rc=R,b.Vc=N}else{if(s(p.mc!=null),A=c+e,s((h=p.mc)!=null),s(A<=h.i),h.C>=A)A=1;else if(p.ic||We(),p.ic){p=h.V,R=h.Ba,N=h.c;var H=h.i,G=(W=1,w=h.$/N,S=h.$%N,P=h.m,M=h.s,h.$),K=N*H,se=N*A,oe=M.wc,he=G<se?xt(M,S,w):null;s(G<=K),s(A<=H),s(bi(M));t:for(;;){for(;!P.h&&G<se;){if(S&oe||(he=xt(M,S,w)),s(he!=null),qe(P),256>(H=st(he.G[0],he.H[0],P)))p[R+G]=H,++G,++S>=N&&(S=0,++w<=A&&!(w%16)&&wi(h,w));else{if(!(280>H)){W=0;break t}H=be(H-256,P);var le,_e=st(he.G[4],he.H[4],P);if(qe(P),!(G>=(_e=He(N,_e=be(_e,P)))&&K-G>=H)){W=0;break t}for(le=0;le<H;++le)p[R+G+le]=p[R+G+le-_e];for(G+=H,S+=H;S>=N;)S-=N,++w<=A&&!(w%16)&&wi(h,w);G<se&&S&oe&&(he=xt(M,S,w))}s(P.h==ke(P))}wi(h,w>A?A:w);break t}!W||P.h&&G<K?(W=0,h.a=P.h?5:3):h.$=G,A=W}else A=yi(h,h.V,h.Ba,h.c,h.i,A,Ki);if(!A){e=0;break e}}c+e>=o&&(b.Cc=1),e=1}if(!e)return null;if(b.Cc&&((e=b.ga)!=null&&(e.mc=null),b.ga=null,0<b.Ga))return alert("todo:WebPDequantizeLevels"),null}return b.nb+c*r}function E(b,A,c,e,r,o){for(;0<r--;){var h,p=b,w=A+(c?1:0),S=b,P=A+(c?0:3);for(h=0;h<e;++h){var M=S[P+4*h];M!=255&&(M*=32897,p[w+4*h+0]=p[w+4*h+0]*M>>23,p[w+4*h+1]=p[w+4*h+1]*M>>23,p[w+4*h+2]=p[w+4*h+2]*M>>23)}A+=o}}function Q(b,A,c,e,r){for(;0<e--;){var o;for(o=0;o<c;++o){var h=b[A+2*o+0],p=15&(S=b[A+2*o+1]),w=4369*p,S=(240&S|S>>4)*w>>16;b[A+2*o+0]=(240&h|h>>4)*w>>16&240|(15&h|h<<4)*w>>16>>4&15,b[A+2*o+1]=240&S|p}A+=r}}function Ie(b,A,c,e,r,o,h,p){var w,S,P=255;for(S=0;S<r;++S){for(w=0;w<e;++w){var M=b[A+w];o[h+4*w]=M,P&=M}A+=c,h+=p}return P!=255}function Be(b,A,c,e,r){var o;for(o=0;o<r;++o)c[e+o]=b[A+o]>>8}function We(){on=E,zi=Q,Zi=Ie,Ir=Be}function ut(b,A,c){De[b]=function(e,r,o,h,p,w,S,P,M,R,N,W,H,G,K,se,oe){var he,le=oe-1>>1,_e=p[w+0]|S[P+0]<<16,Me=M[R+0]|N[W+0]<<16;s(e!=null);var Te=3*_e+Me+131074>>2;for(A(e[r+0],255&Te,Te>>16,H,G),o!=null&&(Te=3*Me+_e+131074>>2,A(o[h+0],255&Te,Te>>16,K,se)),he=1;he<=le;++he){var rt=p[w+he]|S[P+he]<<16,mt=M[R+he]|N[W+he]<<16,vt=_e+rt+Me+mt+524296,St=vt+2*(rt+Me)>>3;Te=St+_e>>1,_e=(vt=vt+2*(_e+mt)>>3)+rt>>1,A(e[r+2*he-1],255&Te,Te>>16,H,G+(2*he-1)*c),A(e[r+2*he-0],255&_e,_e>>16,H,G+(2*he-0)*c),o!=null&&(Te=vt+Me>>1,_e=St+mt>>1,A(o[h+2*he-1],255&Te,Te>>16,K,se+(2*he-1)*c),A(o[h+2*he+0],255&_e,_e>>16,K,se+(2*he+0)*c)),_e=rt,Me=mt}1&oe||(Te=3*_e+Me+131074>>2,A(e[r+oe-1],255&Te,Te>>16,H,G+(oe-1)*c),o!=null&&(Te=3*Me+_e+131074>>2,A(o[h+oe-1],255&Te,Te>>16,K,se+(oe-1)*c)))}}function Lt(){Si[No]=mc,Si[Ya]=ql,Si[jl]=Sh,Si[Ja]=Oc,Si[Do]=to,Si[ml]=gc,Si[Ca]=yc,Si[Fo]=ql,Si[Qa]=Oc,Si[Ro]=to,Si[gl]=gc}function $t(b){return b&~On?0>b?0:255:b>>Bc}function ci(b,A){return $t((19077*b>>8)+(26149*A>>8)-14234)}function Ai(b,A,c){return $t((19077*b>>8)-(6419*A>>8)-(13320*c>>8)+8708)}function Ii(b,A){return $t((19077*b>>8)+(33050*A>>8)-17685)}function Di(b,A,c,e,r){e[r+0]=ci(b,c),e[r+1]=Ai(b,A,c),e[r+2]=Ii(b,A)}function ar(b,A,c,e,r){e[r+0]=Ii(b,A),e[r+1]=Ai(b,A,c),e[r+2]=ci(b,c)}function kr(b,A,c,e,r){var o=Ai(b,A,c);A=o<<3&224|Ii(b,A)>>3,e[r+0]=248&ci(b,c)|o>>5,e[r+1]=A}function Ei(b,A,c,e,r){var o=240&Ii(b,A)|15;e[r+0]=240&ci(b,c)|Ai(b,A,c)>>4,e[r+1]=o}function nn(b,A,c,e,r){e[r+0]=255,Di(b,A,c,e,r+1)}function li(b,A,c,e,r){ar(b,A,c,e,r),e[r+3]=255}function Sn(b,A,c,e,r){Di(b,A,c,e,r),e[r+3]=255}function Oi(b,A){return 0>b?0:b>A?A:b}function Bi(b,A,c){De[b]=function(e,r,o,h,p,w,S,P,M){for(var R=P+(-2&M)*c;P!=R;)A(e[r+0],o[h+0],p[w+0],S,P),A(e[r+1],o[h+0],p[w+0],S,P+c),r+=2,++h,++w,P+=2*c;1&M&&A(e[r+0],o[h+0],p[w+0],S,P)}}function Cs(b,A,c){return c==0?b==0?A==0?6:5:A==0?4:0:c}function Qs(b,A,c,e,r){switch(b>>>30){case 3:Ns(A,c,e,r,0);break;case 2:fr(A,c,e,r);break;case 1:Nr(A,c,e,r)}}function ea(b,A){var c,e,r=A.M,o=A.Nb,h=b.oc,p=b.pc+40,w=b.oc,S=b.pc+584,P=b.oc,M=b.pc+600;for(c=0;16>c;++c)h[p+32*c-1]=129;for(c=0;8>c;++c)w[S+32*c-1]=129,P[M+32*c-1]=129;for(0<r?h[p-1-32]=w[S-1-32]=P[M-1-32]=129:(y(h,p-32-1,127,21),y(w,S-32-1,127,9),y(P,M-32-1,127,9)),e=0;e<b.za;++e){var R=A.ya[A.aa+e];if(0<e){for(c=-1;16>c;++c)f(h,p+32*c-4,h,p+32*c+12,4);for(c=-1;8>c;++c)f(w,S+32*c-4,w,S+32*c+4,4),f(P,M+32*c-4,P,M+32*c+4,4)}var N=b.Gd,W=b.Hd+e,H=R.ad,G=R.Hc;if(0<r&&(f(h,p-32,N[W].y,0,16),f(w,S-32,N[W].f,0,8),f(P,M-32,N[W].ea,0,8)),R.Za){var K=h,se=p-32+16;for(0<r&&(e>=b.za-1?y(K,se,N[W].y[15],4):f(K,se,N[W+1].y,0,4)),c=0;4>c;c++)K[se+128+c]=K[se+256+c]=K[se+384+c]=K[se+0+c];for(c=0;16>c;++c,G<<=2)K=h,se=p+xs[c],Rn[R.Ob[c]](K,se),Qs(G,H,16*+c,K,se)}else if(K=Cs(e,r,R.Ob[0]),bs[K](h,p),G!=0)for(c=0;16>c;++c,G<<=2)Qs(G,H,16*+c,h,p+xs[c]);for(c=R.Gc,K=Cs(e,r,R.Dd),Os[K](w,S),Os[K](P,M),G=H,K=w,se=S,255&(R=c>>0)&&(170&R?La(G,256,K,se):Xr(G,256,K,se)),R=P,G=M,255&(c>>=8)&&(170&c?La(H,320,R,G):Xr(H,320,R,G)),r<b.Ub-1&&(f(N[W].y,0,h,p+480,16),f(N[W].f,0,w,S+224,8),f(N[W].ea,0,P,M+224,8)),c=8*o*b.B,N=b.sa,W=b.ta+16*e+16*o*b.R,H=b.qa,R=b.ra+8*e+c,G=b.Ha,K=b.Ia+8*e+c,c=0;16>c;++c)f(N,W+c*b.R,h,p+32*c,16);for(c=0;8>c;++c)f(H,R+c*b.B,w,S+32*c,8),f(G,K+c*b.B,P,M+32*c,8)}}function Sa(b,A,c,e,r,o,h,p,w){var S=[0],P=[0],M=0,R=w!=null?w.kd:0,N=w??new ko;if(b==null||12>c)return 7;N.data=b,N.w=A,N.ha=c,A=[A],c=[c],N.gb=[N.gb];e:{var W=A,H=c,G=N.gb;if(s(b!=null),s(H!=null),s(G!=null),G[0]=0,12<=H[0]&&!u(b,W[0],"RIFF")){if(u(b,W[0]+8,"WEBP")){G=3;break e}var K=zt(b,W[0]+4);if(12>K||4294967286<K){G=3;break e}if(R&&K>H[0]-8){G=7;break e}G[0]=K,W[0]+=12,H[0]-=12}G=0}if(G!=0)return G;for(K=0<N.gb[0],c=c[0];;){e:{var se=b;H=A,G=c;var oe=S,he=P,le=W=[0];if((Te=M=[M])[0]=0,8>G[0])G=7;else{if(!u(se,H[0],"VP8X")){if(zt(se,H[0]+4)!=10){G=3;break e}if(18>G[0]){G=7;break e}var _e=zt(se,H[0]+8),Me=1+Nt(se,H[0]+12);if(2147483648<=Me*(se=1+Nt(se,H[0]+15))){G=3;break e}le!=null&&(le[0]=_e),oe!=null&&(oe[0]=Me),he!=null&&(he[0]=se),H[0]+=18,G[0]-=18,Te[0]=1}G=0}}if(M=M[0],W=W[0],G!=0)return G;if(H=!!(2&W),!K&&M)return 3;if(o!=null&&(o[0]=!!(16&W)),h!=null&&(h[0]=H),p!=null&&(p[0]=0),h=S[0],W=P[0],M&&H&&w==null){G=0;break}if(4>c){G=7;break}if(K&&M||!K&&!M&&!u(b,A[0],"ALPH")){c=[c],N.na=[N.na],N.P=[N.P],N.Sa=[N.Sa];e:{_e=b,G=A,K=c;var Te=N.gb;oe=N.na,he=N.P,le=N.Sa,Me=22,s(_e!=null),s(K!=null),se=G[0];var rt=K[0];for(s(oe!=null),s(le!=null),oe[0]=null,he[0]=null,le[0]=0;;){if(G[0]=se,K[0]=rt,8>rt){G=7;break e}var mt=zt(_e,se+4);if(4294967286<mt){G=3;break e}var vt=8+mt+1&-2;if(Me+=vt,0<Te&&Me>Te){G=3;break e}if(!u(_e,se,"VP8 ")||!u(_e,se,"VP8L")){G=0;break e}if(rt[0]<vt){G=7;break e}u(_e,se,"ALPH")||(oe[0]=_e,he[0]=se+8,le[0]=mt),se+=vt,rt-=vt}}if(c=c[0],N.na=N.na[0],N.P=N.P[0],N.Sa=N.Sa[0],G!=0)break}c=[c],N.Ja=[N.Ja],N.xa=[N.xa];e:if(Te=b,G=A,K=c,oe=N.gb[0],he=N.Ja,le=N.xa,_e=G[0],se=!u(Te,_e,"VP8 "),Me=!u(Te,_e,"VP8L"),s(Te!=null),s(K!=null),s(he!=null),s(le!=null),8>K[0])G=7;else{if(se||Me){if(Te=zt(Te,_e+4),12<=oe&&Te>oe-12){G=3;break e}if(R&&Te>K[0]-8){G=7;break e}he[0]=Te,G[0]+=8,K[0]-=8,le[0]=Me}else le[0]=5<=K[0]&&Te[_e+0]==47&&!(Te[_e+4]>>5),he[0]=K[0];G=0}if(c=c[0],N.Ja=N.Ja[0],N.xa=N.xa[0],A=A[0],G!=0)break;if(4294967286<N.Ja)return 3;if(p==null||H||(p[0]=N.xa?2:1),h=[h],W=[W],N.xa){if(5>c){G=7;break}p=h,R=W,H=o,b==null||5>c?b=0:5<=c&&b[A+0]==47&&!(b[A+4]>>5)?(K=[0],Te=[0],oe=[0],Xe(he=new ie,b,A,c),we(he,K,Te,oe)?(p!=null&&(p[0]=K[0]),R!=null&&(R[0]=Te[0]),H!=null&&(H[0]=oe[0]),b=1):b=0):b=0}else{if(10>c){G=7;break}p=W,b==null||10>c||!wn(b,A+3,c-3)?b=0:(R=b[A+0]|b[A+1]<<8|b[A+2]<<16,H=16383&(b[A+7]<<8|b[A+6]),b=16383&(b[A+9]<<8|b[A+8]),1&R||3<(R>>1&7)||!(R>>4&1)||R>>5>=N.Ja||!H||!b?b=0:(h&&(h[0]=H),p&&(p[0]=b),b=1))}if(!b||(h=h[0],W=W[0],M&&(S[0]!=h||P[0]!=W)))return 3;w!=null&&(w[0]=N,w.offset=A-w.w,s(4294967286>A-w.w),s(w.offset==w.ha-c));break}return G==0||G==7&&M&&w==null?(o!=null&&(o[0]|=N.na!=null&&0<N.na.length),e!=null&&(e[0]=h),r!=null&&(r[0]=W),0):G}function fs(b,A,c){var e=A.width,r=A.height,o=0,h=0,p=e,w=r;if(A.Da=b!=null&&0<b.Da,A.Da&&(p=b.cd,w=b.bd,o=b.v,h=b.j,11>c||(o&=-2,h&=-2),0>o||0>h||0>=p||0>=w||o+p>e||h+w>r))return 0;if(A.v=o,A.j=h,A.va=o+p,A.o=h+w,A.U=p,A.T=w,A.da=b!=null&&0<b.da,A.da){if(!gi(p,w,c=[b.ib],o=[b.hb]))return 0;A.ib=c[0],A.hb=o[0]}return A.ob=b!=null&&b.ob,A.Kb=b==null||!b.Sd,A.da&&(A.ob=A.ib<3*e/4&&A.hb<3*r/4,A.Kb=0),1}function Es(b){if(b==null)return 2;if(11>b.S){var A=b.f.RGBA;A.fb+=(b.height-1)*A.A,A.A=-A.A}else A=b.f.kb,b=b.height,A.O+=(b-1)*A.fa,A.fa=-A.fa,A.N+=(b-1>>1)*A.Ab,A.Ab=-A.Ab,A.W+=(b-1>>1)*A.Db,A.Db=-A.Db,A.F!=null&&(A.J+=(b-1)*A.lb,A.lb=-A.lb);return 0}function Wr(b,A,c,e){if(e==null||0>=b||0>=A)return 2;if(c!=null){if(c.Da){var r=c.cd,o=c.bd,h=-2&c.v,p=-2&c.j;if(0>h||0>p||0>=r||0>=o||h+r>b||p+o>A)return 2;b=r,A=o}if(c.da){if(!gi(b,A,r=[c.ib],o=[c.hb]))return 2;b=r[0],A=o[0]}}e.width=b,e.height=A;e:{var w=e.width,S=e.height;if(b=e.S,0>=w||0>=S||!(b>=No&&13>b))b=2;else{if(0>=e.Rd&&e.sd==null){h=o=r=A=0;var P=(p=w*wl[b])*S;if(11>b||(o=(S+1)/2*(A=(w+1)/2),b==12&&(h=(r=w)*S)),(S=_(P+2*o+h))==null){b=1;break e}e.sd=S,11>b?((w=e.f.RGBA).eb=S,w.fb=0,w.A=p,w.size=P):((w=e.f.kb).y=S,w.O=0,w.fa=p,w.Fd=P,w.f=S,w.N=0+P,w.Ab=A,w.Cd=o,w.ea=S,w.W=0+P+o,w.Db=A,w.Ed=o,b==12&&(w.F=S,w.J=0+P+2*o),w.Tc=h,w.lb=r)}if(A=1,r=e.S,o=e.width,h=e.height,r>=No&&13>r)if(11>r)b=e.f.RGBA,A&=(p=Math.abs(b.A))*(h-1)+o<=b.size,A&=p>=o*wl[r],A&=b.eb!=null;else{b=e.f.kb,p=(o+1)/2,P=(h+1)/2,w=Math.abs(b.fa),S=Math.abs(b.Ab);var M=Math.abs(b.Db),R=Math.abs(b.lb),N=R*(h-1)+o;A&=w*(h-1)+o<=b.Fd,A&=S*(P-1)+p<=b.Cd,A=(A&=M*(P-1)+p<=b.Ed)&w>=o&S>=p&M>=p,A&=b.y!=null,A&=b.f!=null,A&=b.ea!=null,r==12&&(A&=R>=o,A&=N<=b.Tc,A&=b.F!=null)}else A=0;b=A?0:2}}return b!=0||c!=null&&c.fd&&(b=Es(e)),b}var Or=64,Aa=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Ia=24,Wn=32,ta=8,jr=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Pt("Predictor0","PredictorAdd0"),De.Predictor0=function(){return 4278190080},De.Predictor1=function(b){return b},De.Predictor2=function(b,A,c){return A[c+0]},De.Predictor3=function(b,A,c){return A[c+1]},De.Predictor4=function(b,A,c){return A[c-1]},De.Predictor5=function(b,A,c){return Dt(Dt(b,A[c+1]),A[c+0])},De.Predictor6=function(b,A,c){return Dt(b,A[c-1])},De.Predictor7=function(b,A,c){return Dt(b,A[c+0])},De.Predictor8=function(b,A,c){return Dt(A[c-1],A[c+0])},De.Predictor9=function(b,A,c){return Dt(A[c+0],A[c+1])},De.Predictor10=function(b,A,c){return Dt(Dt(b,A[c-1]),Dt(A[c+0],A[c+1]))},De.Predictor11=function(b,A,c){var e=A[c+0];return 0>=ui(e>>24&255,b>>24&255,(A=A[c-1])>>24&255)+ui(e>>16&255,b>>16&255,A>>16&255)+ui(e>>8&255,b>>8&255,A>>8&255)+ui(255&e,255&b,255&A)?e:b},De.Predictor12=function(b,A,c){var e=A[c+0];return(Yt((b>>24&255)+(e>>24&255)-((A=A[c-1])>>24&255))<<24|Yt((b>>16&255)+(e>>16&255)-(A>>16&255))<<16|Yt((b>>8&255)+(e>>8&255)-(A>>8&255))<<8|Yt((255&b)+(255&e)-(255&A)))>>>0},De.Predictor13=function(b,A,c){var e=A[c-1];return(ii((b=Dt(b,A[c+0]))>>24&255,e>>24&255)<<24|ii(b>>16&255,e>>16&255)<<16|ii(b>>8&255,e>>8&255)<<8|ii(b>>0&255,e>>0&255))>>>0};var Pa=De.PredictorAdd0;De.PredictorAdd1=Pi,Pt("Predictor2","PredictorAdd2"),Pt("Predictor3","PredictorAdd3"),Pt("Predictor4","PredictorAdd4"),Pt("Predictor5","PredictorAdd5"),Pt("Predictor6","PredictorAdd6"),Pt("Predictor7","PredictorAdd7"),Pt("Predictor8","PredictorAdd8"),Pt("Predictor9","PredictorAdd9"),Pt("Predictor10","PredictorAdd10"),Pt("Predictor11","PredictorAdd11"),Pt("Predictor12","PredictorAdd12"),Pt("Predictor13","PredictorAdd13");var ia=De.PredictorAdd2;mi("ColorIndexInverseTransform","MapARGB","32b",function(b){return b>>8&255},function(b){return b}),mi("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(b){return b},function(b){return b>>8&255});var Wa,Hr=De.ColorIndexInverseTransform,ms=De.MapARGB,pl=De.VP8LColorIndexInverseTransformAlpha,Eo=De.MapAlpha,Mi=De.VP8LPredictorsAdd=[];Mi.length=16,(De.VP8LPredictors=[]).length=16,(De.VP8LPredictorsAdd_C=[]).length=16,(De.VP8LPredictors_C=[]).length=16;var Ms,An,sn,Dn,zs,Hn,Ha,Ns,fr,La,Nr,Xr,gs,Mo,Ds,ys,Fs,_s,ra,zo,ka,vs,Xa,an,on,zi,Zi,Ir,Dr=_(511),Yi=_(2041),yn=_(225),qr=_(767),Ta=0,fl=Yi,Ka=yn,Vr=qr,Fr=Dr,No=0,Ya=1,jl=2,Ja=3,Do=4,ml=5,Ca=6,Fo=7,Qa=8,Ro=9,gl=10,hc=[2,3,7],uc=[3,3,11],yl=[280,256,256,256,40],Oo=[0,1,1,1,0],Fc=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Xn=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Rs=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],dc=8,Fn=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],na=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],_l=null,wh=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],Rc=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],pc=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],fc=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Bo=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Kn=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Vt=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],bs=[],Rn=[],Os=[],jo=1,eo=2,Bs=[],Si=[];ut("UpsampleRgbLinePair",Di,3),ut("UpsampleBgrLinePair",ar,3),ut("UpsampleRgbaLinePair",Sn,4),ut("UpsampleBgraLinePair",li,4),ut("UpsampleArgbLinePair",nn,4),ut("UpsampleRgba4444LinePair",Ei,2),ut("UpsampleRgb565LinePair",kr,2);var mc=De.UpsampleRgbLinePair,Sh=De.UpsampleBgrLinePair,ql=De.UpsampleRgbaLinePair,Oc=De.UpsampleBgraLinePair,to=De.UpsampleArgbLinePair,gc=De.UpsampleRgba4444LinePair,yc=De.UpsampleRgb565LinePair,vl=16,Vl=1<<vl-1,io=-227,_c=482,Bc=6,On=(256<<Bc)-1,Qi=0,qo=_(256),Ul=_(256),$l=_(256),jc=_(256),bl=_(_c-io),xl=_(_c-io);Bi("YuvToRgbRow",Di,3),Bi("YuvToBgrRow",ar,3),Bi("YuvToRgbaRow",Sn,4),Bi("YuvToBgraRow",li,4),Bi("YuvToArgbRow",nn,4),Bi("YuvToRgba4444Row",Ei,2),Bi("YuvToRgb565Row",kr,2);var xs=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Ea=[0,2,8],Wt=[8,7,6,4,4,2,2,2,1,1,1,1],hi=1;this.WebPDecodeRGBA=function(b,A,c,e,r){var o=Ya,h=new Gn,p=new Ve;h.ba=p,p.S=o,p.width=[p.width],p.height=[p.height];var w=p.width,S=p.height,P=new lt;if(P==null||b==null)var M=2;else s(P!=null),M=Sa(b,A,c,P.width,P.height,P.Pd,P.Qd,P.format,null);if(M!=0?w=0:(w!=null&&(w[0]=P.width[0]),S!=null&&(S[0]=P.height[0]),w=1),w){p.width=p.width[0],p.height=p.height[0],e!=null&&(e[0]=p.width),r!=null&&(r[0]=p.height);e:{if(e=new $n,(r=new ko).data=b,r.w=A,r.ha=c,r.kd=1,A=[0],s(r!=null),((b=Sa(r.data,r.w,r.ha,null,null,null,A,null,r))==0||b==7)&&A[0]&&(b=4),(A=b)==0){if(s(h!=null),e.data=r.data,e.w=r.w+r.offset,e.ha=r.ha-r.offset,e.put=ge,e.ac=ne,e.bc=ve,e.ma=h,r.xa){if((b=Ui())==null){h=1;break e}if(function(R,N){var W=[0],H=[0],G=[0];t:for(;;){if(R==null)return 0;if(N==null)return R.a=2,0;if(R.l=N,R.a=0,Xe(R.m,N.data,N.w,N.ha),!we(R.m,W,H,G)){R.a=3;break t}if(R.xb=eo,N.width=W[0],N.height=H[0],!_i(W[0],H[0],1,R,null))break t;return 1}return s(R.a!=0),0}(b,e)){if(e=(A=Wr(e.width,e.height,h.Oa,h.ba))==0){t:{e=b;i:for(;;){if(e==null){e=0;break t}if(s(e.s.yc!=null),s(e.s.Ya!=null),s(0<e.s.Wb),s((c=e.l)!=null),s((r=c.ma)!=null),e.xb!=0){if(e.ca=r.ba,e.tb=r.tb,s(e.ca!=null),!fs(r.Oa,c,Ja)){e.a=2;break i}if(!qi(e,c.width)||c.da)break i;if((c.da||ae(e.ca.S))&&We(),11>e.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),e.ca.f.kb.F!=null&&We()),e.Pb&&0<e.s.ua&&e.s.vb.X==null&&!ti(e.s.vb,e.s.Wa.Xa)){e.a=1;break i}e.xb=0}if(!yi(e,e.V,e.Ba,e.c,e.i,c.o,Xt))break i;r.Dc=e.Ma,e=1;break t}s(e.a!=0),e=0}e=!e}e&&(A=b.a)}else A=b.a}else{if((b=new Sr)==null){h=1;break e}if(b.Fa=r.na,b.P=r.P,b.qc=r.Sa,pr(b,e)){if((A=Wr(e.width,e.height,h.Oa,h.ba))==0){if(b.Aa=0,c=h.Oa,s((r=b)!=null),c!=null){if(0<(w=0>(w=c.Md)?0:100<w?255:255*w/100)){for(S=P=0;4>S;++S)12>(M=r.pb[S]).lc&&(M.ia=w*Wt[0>M.lc?0:M.lc]>>3),P|=M.ia;P&&(alert("todo:VP8InitRandom"),r.ia=1)}r.Ga=c.Id,100<r.Ga?r.Ga=100:0>r.Ga&&(r.Ga=0)}sl(b,e)||(A=b.a)}}else A=b.a}A==0&&h.Oa!=null&&h.Oa.fd&&(A=Es(h.ba))}h=A}o=h!=0?null:11>o?p.f.RGBA.eb:p.f.kb.y}else o=null;return o};var wl=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function F(De,Qe){for(var pt="",pe=0;pe<4;pe++)pt+=String.fromCharCode(De[Qe++]);return pt}function U(De,Qe){return(De[Qe+0]<<0|De[Qe+1]<<8|De[Qe+2]<<16)>>>0}function O(De,Qe){return(De[Qe+0]<<0|De[Qe+1]<<8|De[Qe+2]<<16|De[Qe+3]<<24)>>>0}new C;var $=[0],V=[0],ye=[],de=new C,Pe=d,ue=function(De,Qe){var pt={},pe=0,me=!1,Ne=0,Le=0;if(pt.frames=[],!function(xe,ke,Fe,qe){for(var $e=0;$e<qe;$e++)if(xe[ke+$e]!=Fe.charCodeAt($e))return!0;return!1}(De,Qe,"RIFF",4)){var et,it;for(O(De,Qe+=4),Qe+=8;Qe<De.length;){var nt=F(De,Qe),Xe=O(De,Qe+=4);Qe+=4;var at=Xe+(1&Xe);switch(nt){case"VP8 ":case"VP8L":pt.frames[pe]===void 0&&(pt.frames[pe]={}),(ie=pt.frames[pe]).src_off=me?Le:Qe-8,ie.src_size=Ne+Xe+8,pe++,me&&(me=!1,Ne=0,Le=0);break;case"VP8X":(ie=pt.header={}).feature_flags=De[Qe];var dt=Qe+4;ie.canvas_width=1+U(De,dt),dt+=3,ie.canvas_height=1+U(De,dt),dt+=3;break;case"ALPH":me=!0,Ne=at+8,Le=Qe-8;break;case"ANIM":(ie=pt.header).bgcolor=O(De,Qe),dt=Qe+4,ie.loop_count=(et=De)[(it=dt)+0]<<0|et[it+1]<<8,dt+=2;break;case"ANMF":var Mt,ie;(ie=pt.frames[pe]={}).offset_x=2*U(De,Qe),Qe+=3,ie.offset_y=2*U(De,Qe),Qe+=3,ie.width=1+U(De,Qe),Qe+=3,ie.height=1+U(De,Qe),Qe+=3,ie.duration=U(De,Qe),Qe+=3,Mt=De[Qe++],ie.dispose=1&Mt,ie.blend=Mt>>1&1}nt!="ANMF"&&(Qe+=at)}return pt}}(Pe,0);ue.response=Pe,ue.rgbaoutput=!0,ue.dataurl=!1;var Se=ue.header?ue.header:null,ze=ue.frames?ue.frames:null;if(Se){Se.loop_counter=Se.loop_count,$=[Se.canvas_height],V=[Se.canvas_width];for(var Ye=0;Ye<ze.length&&ze[Ye].blend!=0;Ye++);}var Je=ze[0],ct=de.WebPDecodeRGBA(Pe,Je.src_off,Je.src_size,V,$);Je.rgba=ct,Je.imgwidth=V[0],Je.imgheight=$[0];for(var Ge=0;Ge<V[0]*$[0]*4;Ge++)ye[Ge]=ct[Ge];return this.width=V,this.height=$,this.data=ye,this}(function(d){var s=function(){return typeof lp=="function"},u=function($,V,ye,de){var Pe=4,ue=g;switch(de){case d.image_compression.FAST:Pe=1,ue=_;break;case d.image_compression.MEDIUM:Pe=6,ue=a;break;case d.image_compression.SLOW:Pe=9,ue=C}$=f($,V,ye,ue);var Se=lp($,{level:Pe});return d.__addimage__.arrayBufferToBinaryString(Se)},f=function($,V,ye,de){for(var Pe,ue,Se,ze=$.length/V,Ye=new Uint8Array($.length+ze),Je=U(),ct=0;ct<ze;ct+=1){if(Se=ct*V,Pe=$.subarray(Se,Se+V),de)Ye.set(de(Pe,ye,ue),Se+ct);else{for(var Ge,De=Je.length,Qe=[];Ge<De;Ge+=1)Qe[Ge]=Je[Ge](Pe,ye,ue);var pt=O(Qe.concat());Ye.set(Qe[pt],Se+ct)}ue=Pe}return Ye},y=function($){var V=Array.apply([],$);return V.unshift(0),V},_=function($,V){var ye,de=[],Pe=$.length;de[0]=1;for(var ue=0;ue<Pe;ue+=1)ye=$[ue-V]||0,de[ue+1]=$[ue]-ye+256&255;return de},g=function($,V,ye){var de,Pe=[],ue=$.length;Pe[0]=2;for(var Se=0;Se<ue;Se+=1)de=ye&&ye[Se]||0,Pe[Se+1]=$[Se]-de+256&255;return Pe},a=function($,V,ye){var de,Pe,ue=[],Se=$.length;ue[0]=3;for(var ze=0;ze<Se;ze+=1)de=$[ze-V]||0,Pe=ye&&ye[ze]||0,ue[ze+1]=$[ze]+256-(de+Pe>>>1)&255;return ue},C=function($,V,ye){var de,Pe,ue,Se,ze=[],Ye=$.length;ze[0]=4;for(var Je=0;Je<Ye;Je+=1)de=$[Je-V]||0,Pe=ye&&ye[Je]||0,ue=ye&&ye[Je-V]||0,Se=F(de,Pe,ue),ze[Je+1]=$[Je]-Se+256&255;return ze},F=function($,V,ye){if($===V&&V===ye)return $;var de=Math.abs(V-ye),Pe=Math.abs($-ye),ue=Math.abs($+V-ye-ye);return de<=Pe&&de<=ue?$:Pe<=ue?V:ye},U=function(){return[y,_,g,a,C]},O=function($){var V=$.map(function(ye){return ye.reduce(function(de,Pe){return de+Math.abs(Pe)},0)});return V.indexOf(Math.min.apply(null,V))};d.processPNG=function($,V,ye,de){var Pe,ue,Se,ze,Ye,Je,ct,Ge,De,Qe,pt,pe,me,Ne,Le,et=this.decode.FLATE_DECODE,it="";if(this.__addimage__.isArrayBuffer($)&&($=new Uint8Array($)),this.__addimage__.isArrayBufferView($)){if($=(Se=new Zv($)).imgData,ue=Se.bits,Pe=Se.colorSpace,Ye=Se.colors,[4,6].indexOf(Se.colorType)!==-1){if(Se.bits===8){De=(Ge=Se.pixelBitlength==32?new Uint32Array(Se.decodePixels().buffer):Se.pixelBitlength==16?new Uint16Array(Se.decodePixels().buffer):new Uint8Array(Se.decodePixels().buffer)).length,pt=new Uint8Array(De*Se.colors),Qe=new Uint8Array(De);var nt,Xe=Se.pixelBitlength-Se.bits;for(Ne=0,Le=0;Ne<De;Ne++){for(me=Ge[Ne],nt=0;nt<Xe;)pt[Le++]=me>>>nt&255,nt+=Se.bits;Qe[Ne]=me>>>nt&255}}if(Se.bits===16){De=(Ge=new Uint32Array(Se.decodePixels().buffer)).length,pt=new Uint8Array(De*(32/Se.pixelBitlength)*Se.colors),Qe=new Uint8Array(De*(32/Se.pixelBitlength)),pe=Se.colors>1,Ne=0,Le=0;for(var at=0;Ne<De;)me=Ge[Ne++],pt[Le++]=me>>>0&255,pe&&(pt[Le++]=me>>>16&255,me=Ge[Ne++],pt[Le++]=me>>>0&255),Qe[at++]=me>>>16&255;ue=8}de!==d.image_compression.NONE&&s()?($=u(pt,Se.width*Se.colors,Se.colors,de),ct=u(Qe,Se.width,1,de)):($=pt,ct=Qe,et=void 0)}if(Se.colorType===3&&(Pe=this.color_spaces.INDEXED,Je=Se.palette,Se.transparency.indexed)){var dt=Se.transparency.indexed,Mt=0;for(Ne=0,De=dt.length;Ne<De;++Ne)Mt+=dt[Ne];if((Mt/=255)===De-1&&dt.indexOf(0)!==-1)ze=[dt.indexOf(0)];else if(Mt!==De){for(Ge=Se.decodePixels(),Qe=new Uint8Array(Ge.length),Ne=0,De=Ge.length;Ne<De;Ne++)Qe[Ne]=dt[Ge[Ne]];ct=u(Qe,Se.width,1)}}var ie=function(xe){var ke;switch(xe){case d.image_compression.FAST:ke=11;break;case d.image_compression.MEDIUM:ke=13;break;case d.image_compression.SLOW:ke=14;break;default:ke=12}return ke}(de);return et===this.decode.FLATE_DECODE&&(it="/Predictor "+ie+" "),it+="/Colors "+Ye+" /BitsPerComponent "+ue+" /Columns "+Se.width,(this.__addimage__.isArrayBuffer($)||this.__addimage__.isArrayBufferView($))&&($=this.__addimage__.arrayBufferToBinaryString($)),(ct&&this.__addimage__.isArrayBuffer(ct)||this.__addimage__.isArrayBufferView(ct))&&(ct=this.__addimage__.arrayBufferToBinaryString(ct)),{alias:ye,data:$,index:V,filter:et,decodeParameters:it,transparency:ze,palette:Je,sMask:ct,predictor:ie,width:Se.width,height:Se.height,bitsPerComponent:ue,colorSpace:Pe}}}})(Li.API),function(d){d.processGIF89A=function(s,u,f,y){var _=new Gv(s),g=_.width,a=_.height,C=[];_.decodeAndBlitFrameRGBA(0,C);var F={data:C,width:g,height:a},U=new Xd(100).encode(F,100);return d.processJPEG.call(this,U,u,f,y)},d.processGIF87A=d.processGIF89A}(Li.API),lo.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var d=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(d);for(var s=0;s<d;s++){var u=this.datav.getUint8(this.pos++,!0),f=this.datav.getUint8(this.pos++,!0),y=this.datav.getUint8(this.pos++,!0),_=this.datav.getUint8(this.pos++,!0);this.palette[s]={red:y,green:f,blue:u,quad:_}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},lo.prototype.parseBGR=function(){this.pos=this.offset;try{var d="bit"+this.bitPP,s=this.width*this.height*4;this.data=new Uint8Array(s),this[d]()}catch(u){xr.log("bit decode error:"+u)}},lo.prototype.bit1=function(){var d,s=Math.ceil(this.width/8),u=s%4;for(d=this.height-1;d>=0;d--){for(var f=this.bottom_up?d:this.height-1-d,y=0;y<s;y++)for(var _=this.datav.getUint8(this.pos++,!0),g=f*this.width*4+8*y*4,a=0;a<8&&8*y+a<this.width;a++){var C=this.palette[_>>7-a&1];this.data[g+4*a]=C.blue,this.data[g+4*a+1]=C.green,this.data[g+4*a+2]=C.red,this.data[g+4*a+3]=255}u!==0&&(this.pos+=4-u)}},lo.prototype.bit4=function(){for(var d=Math.ceil(this.width/2),s=d%4,u=this.height-1;u>=0;u--){for(var f=this.bottom_up?u:this.height-1-u,y=0;y<d;y++){var _=this.datav.getUint8(this.pos++,!0),g=f*this.width*4+2*y*4,a=_>>4,C=15&_,F=this.palette[a];if(this.data[g]=F.blue,this.data[g+1]=F.green,this.data[g+2]=F.red,this.data[g+3]=255,2*y+1>=this.width)break;F=this.palette[C],this.data[g+4]=F.blue,this.data[g+4+1]=F.green,this.data[g+4+2]=F.red,this.data[g+4+3]=255}s!==0&&(this.pos+=4-s)}},lo.prototype.bit8=function(){for(var d=this.width%4,s=this.height-1;s>=0;s--){for(var u=this.bottom_up?s:this.height-1-s,f=0;f<this.width;f++){var y=this.datav.getUint8(this.pos++,!0),_=u*this.width*4+4*f;if(y<this.palette.length){var g=this.palette[y];this.data[_]=g.red,this.data[_+1]=g.green,this.data[_+2]=g.blue,this.data[_+3]=255}else this.data[_]=255,this.data[_+1]=255,this.data[_+2]=255,this.data[_+3]=255}d!==0&&(this.pos+=4-d)}},lo.prototype.bit15=function(){for(var d=this.width%3,s=parseInt("11111",2),u=this.height-1;u>=0;u--){for(var f=this.bottom_up?u:this.height-1-u,y=0;y<this.width;y++){var _=this.datav.getUint16(this.pos,!0);this.pos+=2;var g=(_&s)/s*255|0,a=(_>>5&s)/s*255|0,C=(_>>10&s)/s*255|0,F=_>>15?255:0,U=f*this.width*4+4*y;this.data[U]=C,this.data[U+1]=a,this.data[U+2]=g,this.data[U+3]=F}this.pos+=d}},lo.prototype.bit16=function(){for(var d=this.width%3,s=parseInt("11111",2),u=parseInt("111111",2),f=this.height-1;f>=0;f--){for(var y=this.bottom_up?f:this.height-1-f,_=0;_<this.width;_++){var g=this.datav.getUint16(this.pos,!0);this.pos+=2;var a=(g&s)/s*255|0,C=(g>>5&u)/u*255|0,F=(g>>11)/s*255|0,U=y*this.width*4+4*_;this.data[U]=F,this.data[U+1]=C,this.data[U+2]=a,this.data[U+3]=255}this.pos+=d}},lo.prototype.bit24=function(){for(var d=this.height-1;d>=0;d--){for(var s=this.bottom_up?d:this.height-1-d,u=0;u<this.width;u++){var f=this.datav.getUint8(this.pos++,!0),y=this.datav.getUint8(this.pos++,!0),_=this.datav.getUint8(this.pos++,!0),g=s*this.width*4+4*u;this.data[g]=_,this.data[g+1]=y,this.data[g+2]=f,this.data[g+3]=255}this.pos+=this.width%4}},lo.prototype.bit32=function(){for(var d=this.height-1;d>=0;d--)for(var s=this.bottom_up?d:this.height-1-d,u=0;u<this.width;u++){var f=this.datav.getUint8(this.pos++,!0),y=this.datav.getUint8(this.pos++,!0),_=this.datav.getUint8(this.pos++,!0),g=this.datav.getUint8(this.pos++,!0),a=s*this.width*4+4*u;this.data[a]=_,this.data[a+1]=y,this.data[a+2]=f,this.data[a+3]=g}},lo.prototype.getData=function(){return this.data},function(d){d.processBMP=function(s,u,f,y){var _=new lo(s,!1),g=_.width,a=_.height,C={data:_.getData(),width:g,height:a},F=new Xd(100).encode(C,100);return d.processJPEG.call(this,F,u,f,y)}}(Li.API),Jm.prototype.getData=function(){return this.data},function(d){d.processWEBP=function(s,u,f,y){var _=new Jm(s),g=_.width,a=_.height,C={data:_.getData(),width:g,height:a},F=new Xd(100).encode(C,100);return d.processJPEG.call(this,F,u,f,y)}}(Li.API),Li.API.processRGBA=function(d,s,u){for(var f=d.data,y=f.length,_=new Uint8Array(y/4*3),g=new Uint8Array(y/4),a=0,C=0,F=0;F<y;F+=4){var U=f[F],O=f[F+1],$=f[F+2],V=f[F+3];_[a++]=U,_[a++]=O,_[a++]=$,g[C++]=V}var ye=this.__addimage__.arrayBufferToBinaryString(_);return{alpha:this.__addimage__.arrayBufferToBinaryString(g),data:ye,index:s,alias:u,colorSpace:"DeviceRGB",bitsPerComponent:8,width:d.width,height:d.height}},Li.API.setLanguage=function(d){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[d]!==void 0&&(this.internal.languageSettings.languageCode=d,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},sh=Li.API,zu=sh.getCharWidthsArray=function(d,s){var u,f,y=(s=s||{}).font||this.internal.getFont(),_=s.fontSize||this.internal.getFontSize(),g=s.charSpace||this.internal.getCharSpace(),a=s.widths?s.widths:y.metadata.Unicode.widths,C=a.fof?a.fof:1,F=s.kerning?s.kerning:y.metadata.Unicode.kerning,U=F.fof?F.fof:1,O=s.doKerning!==!1,$=0,V=d.length,ye=0,de=a[0]||C,Pe=[];for(u=0;u<V;u++)f=d.charCodeAt(u),typeof y.metadata.widthOfString=="function"?Pe.push((y.metadata.widthOfGlyph(y.metadata.characterToGlyph(f))+g*(1e3/_)||0)/1e3):($=O&&dr(F[f])==="object"&&!isNaN(parseInt(F[f][ye],10))?F[f][ye]/U:0,Pe.push((a[f]||de)/C+$)),ye=f;return Pe},Hm=sh.getStringUnitWidth=function(d,s){var u=(s=s||{}).fontSize||this.internal.getFontSize(),f=s.font||this.internal.getFont(),y=s.charSpace||this.internal.getCharSpace();return sh.processArabic&&(d=sh.processArabic(d)),typeof f.metadata.widthOfString=="function"?f.metadata.widthOfString(d,u,y)/u:zu.apply(this,arguments).reduce(function(_,g){return _+g},0)},Xm=function(d,s,u,f){for(var y=[],_=0,g=d.length,a=0;_!==g&&a+s[_]<u;)a+=s[_],_++;y.push(d.slice(0,_));var C=_;for(a=0;_!==g;)a+s[_]>f&&(y.push(d.slice(C,_)),a=0,C=_),a+=s[_],_++;return C!==_&&y.push(d.slice(C,_)),y},Km=function(d,s,u){u||(u={});var f,y,_,g,a,C,F,U=[],O=[U],$=u.textIndent||0,V=0,ye=0,de=d.split(" "),Pe=zu.apply(this,[" ",u])[0];if(C=u.lineIndent===-1?de[0].length+2:u.lineIndent||0){var ue=Array(C).join(" "),Se=[];de.map(function(Ye){(Ye=Ye.split(/\s*\n/)).length>1?Se=Se.concat(Ye.map(function(Je,ct){return(ct&&Je.length?`
`:"")+Je})):Se.push(Ye[0])}),de=Se,C=Hm.apply(this,[ue,u])}for(_=0,g=de.length;_<g;_++){var ze=0;if(f=de[_],C&&f[0]==`
`&&(f=f.substr(1),ze=1),$+V+(ye=(y=zu.apply(this,[f,u])).reduce(function(Ye,Je){return Ye+Je},0))>s||ze){if(ye>s){for(a=Xm.apply(this,[f,y,s-($+V),s]),U.push(a.shift()),U=[a.pop()];a.length;)O.push([a.shift()]);ye=y.slice(f.length-(U[0]?U[0].length:0)).reduce(function(Ye,Je){return Ye+Je},0)}else U=[f];O.push(U),$=ye+C,V=Pe}else U.push(f),$+=V+ye,V=Pe}return F=C?function(Ye,Je){return(Je?ue:"")+Ye.join(" ")}:function(Ye){return Ye.join(" ")},O.map(F)},sh.splitTextToSize=function(d,s,u){var f,y=(u=u||{}).fontSize||this.internal.getFontSize(),_=(function(U){if(U.widths&&U.kerning)return{widths:U.widths,kerning:U.kerning};var O=this.internal.getFont(U.fontName,U.fontStyle);return O.metadata.Unicode?{widths:O.metadata.Unicode.widths||{0:1},kerning:O.metadata.Unicode.kerning||{}}:{font:O.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,u);f=Array.isArray(d)?d:String(d).split(/\r?\n/);var g=1*this.internal.scaleFactor*s/y;_.textIndent=u.textIndent?1*u.textIndent*this.internal.scaleFactor/y:0,_.lineIndent=u.lineIndent;var a,C,F=[];for(a=0,C=f.length;a<C;a++)F=F.concat(Km.apply(this,[f[a],g,_]));return F},function(d){d.__fontmetrics__=d.__fontmetrics__||{};for(var s="klmnopqrstuvwxyz",u={},f={},y=0;y<s.length;y++)u[s[y]]="0123456789abcdef"[y],f["0123456789abcdef"[y]]=s[y];var _=function(O){return"0x"+parseInt(O,10).toString(16)},g=d.__fontmetrics__.compress=function(O){var $,V,ye,de,Pe=["{"];for(var ue in O){if($=O[ue],isNaN(parseInt(ue,10))?V="'"+ue+"'":(ue=parseInt(ue,10),V=(V=_(ue).slice(2)).slice(0,-1)+f[V.slice(-1)]),typeof $=="number")$<0?(ye=_($).slice(3),de="-"):(ye=_($).slice(2),de=""),ye=de+ye.slice(0,-1)+f[ye.slice(-1)];else{if(dr($)!=="object")throw new Error("Don't know what to do with value type "+dr($)+".");ye=g($)}Pe.push(V+ye)}return Pe.push("}"),Pe.join("")},a=d.__fontmetrics__.uncompress=function(O){if(typeof O!="string")throw new Error("Invalid argument passed to uncompress.");for(var $,V,ye,de,Pe={},ue=1,Se=Pe,ze=[],Ye="",Je="",ct=O.length-1,Ge=1;Ge<ct;Ge+=1)(de=O[Ge])=="'"?$?(ye=$.join(""),$=void 0):$=[]:$?$.push(de):de=="{"?(ze.push([Se,ye]),Se={},ye=void 0):de=="}"?((V=ze.pop())[0][V[1]]=Se,ye=void 0,Se=V[0]):de=="-"?ue=-1:ye===void 0?u.hasOwnProperty(de)?(Ye+=u[de],ye=parseInt(Ye,16)*ue,ue=1,Ye=""):Ye+=de:u.hasOwnProperty(de)?(Je+=u[de],Se[ye]=parseInt(Je,16)*ue,ue=1,ye=void 0,Je=""):Je+=de;return Pe},C={codePages:["WinAnsiEncoding"],WinAnsiEncoding:a("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},F={Unicode:{Courier:C,"Courier-Bold":C,"Courier-BoldOblique":C,"Courier-Oblique":C,Helvetica:C,"Helvetica-Bold":C,"Helvetica-BoldOblique":C,"Helvetica-Oblique":C,"Times-Roman":C,"Times-Bold":C,"Times-BoldItalic":C,"Times-Italic":C}},U={Unicode:{"Courier-Oblique":a("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":a("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":a("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:a("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":a("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":a("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:a("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:a("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":a("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:a("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":a("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":a("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":a("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":a("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};d.events.push(["addFont",function(O){var $=O.font,V=U.Unicode[$.postScriptName];V&&($.metadata.Unicode={},$.metadata.Unicode.widths=V.widths,$.metadata.Unicode.kerning=V.kerning);var ye=F.Unicode[$.postScriptName];ye&&($.metadata.Unicode.encoding=ye,$.encoding=ye.codePages[0])}])}(Li.API),function(d){var s=function(u){for(var f=u.length,y=new Uint8Array(f),_=0;_<f;_++)y[_]=u.charCodeAt(_);return y};d.API.events.push(["addFont",function(u){var f=void 0,y=u.font,_=u.instance;if(!y.isStandardFont){if(_===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+y.postScriptName+"').");if(typeof(f=_.existsFileInVFS(y.postScriptName)===!1?_.loadFile(y.postScriptName):_.getFileFromVFS(y.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+y.postScriptName+"').");(function(g,a){a=/^\x00\x01\x00\x00/.test(a)?s(a):s(Jh(a)),g.metadata=d.API.TTFFont.open(a),g.metadata.Unicode=g.metadata.Unicode||{encoding:{},kerning:{},widths:[]},g.metadata.glyIdsUsed=[0]})(y,f)}}])}(Li),function(d){function s(){return(ki.canvg?Promise.resolve(ki.canvg):rp(()=>import("./index.es-FMjD3wec-CFEw3lhY.js"),[])).catch(function(u){return Promise.reject(new Error("Could not load canvg: "+u))}).then(function(u){return u.default?u.default:u})}Li.API.addSvgAsImage=function(u,f,y,_,g,a,C,F){if(isNaN(f)||isNaN(y))throw xr.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(_)||isNaN(g))throw xr.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var U=document.createElement("canvas");U.width=_,U.height=g;var O=U.getContext("2d");O.fillStyle="#fff",O.fillRect(0,0,U.width,U.height);var $={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},V=this;return s().then(function(ye){return ye.fromString(O,u,$)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(ye){return ye.render($)}).then(function(){V.addImage(U.toDataURL("image/jpeg",1),f,y,_,g,C,F)})}}(),Li.API.putTotalPages=function(d){var s,u=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(s=new RegExp(d,"g"),u=this.internal.getNumberOfPages()):(s=new RegExp(this.pdfEscape16(d,this.internal.getFont()),"g"),u=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var f=1;f<=this.internal.getNumberOfPages();f++)for(var y=0;y<this.internal.pages[f].length;y++)this.internal.pages[f][y]=this.internal.pages[f][y].replace(s,u);return this},Li.API.viewerPreferences=function(d,s){var u;d=d||{},s=s||!1;var f,y,_,g={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},a=Object.keys(g),C=[],F=0,U=0,O=0;function $(ye,de){var Pe,ue=!1;for(Pe=0;Pe<ye.length;Pe+=1)ye[Pe]===de&&(ue=!0);return ue}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(g)),this.internal.viewerpreferences.isSubscribed=!1),u=this.internal.viewerpreferences.configuration,d==="reset"||s===!0){var V=a.length;for(O=0;O<V;O+=1)u[a[O]].value=u[a[O]].defaultValue,u[a[O]].explicitSet=!1}if(dr(d)==="object"){for(y in d)if(_=d[y],$(a,y)&&_!==void 0){if(u[y].type==="boolean"&&typeof _=="boolean")u[y].value=_;else if(u[y].type==="name"&&$(u[y].valueSet,_))u[y].value=_;else if(u[y].type==="integer"&&Number.isInteger(_))u[y].value=_;else if(u[y].type==="array"){for(F=0;F<_.length;F+=1)if(f=!0,_[F].length===1&&typeof _[F][0]=="number")C.push(String(_[F]-1));else if(_[F].length>1){for(U=0;U<_[F].length;U+=1)typeof _[F][U]!="number"&&(f=!1);f===!0&&C.push([_[F][0]-1,_[F][1]-1].join(" "))}u[y].value="["+C.join(" ")+"]"}else u[y].value=u[y].defaultValue;u[y].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var ye,de=[];for(ye in u)u[ye].explicitSet===!0&&(u[ye].type==="name"?de.push("/"+ye+" /"+u[ye].value):de.push("/"+ye+" "+u[ye].value));de.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+de.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=u,this},function(d){var s=function(){var f='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',y=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),_=unescape(encodeURIComponent(f)),g=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),a=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),C=unescape(encodeURIComponent("</x:xmpmeta>")),F=_.length+g.length+a.length+y.length+C.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+F+" >>"),this.internal.write("stream"),this.internal.write(y+_+g+a+C),this.internal.write("endstream"),this.internal.write("endobj")},u=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};d.addMetadata=function(f,y){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:f,namespaceuri:y||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",u),this.internal.events.subscribe("postPutResources",s)),this}}(Li.API),function(d){var s=d.API,u=s.pdfEscape16=function(_,g){for(var a,C=g.metadata.Unicode.widths,F=["","0","00","000","0000"],U=[""],O=0,$=_.length;O<$;++O){if(a=g.metadata.characterToGlyph(_.charCodeAt(O)),g.metadata.glyIdsUsed.push(a),g.metadata.toUnicode[a]=_.charCodeAt(O),C.indexOf(a)==-1&&(C.push(a),C.push([parseInt(g.metadata.widthOfGlyph(a),10)])),a=="0")return U.join("");a=a.toString(16),U.push(F[4-a.length],a)}return U.join("")},f=function(_){var g,a,C,F,U,O,$;for(U=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,C=[],O=0,$=(a=Object.keys(_).sort(function(V,ye){return V-ye})).length;O<$;O++)g=a[O],C.length>=100&&(U+=`
`+C.length+` beginbfchar
`+C.join(`
`)+`
endbfchar`,C=[]),_[g]!==void 0&&_[g]!==null&&typeof _[g].toString=="function"&&(F=("0000"+_[g].toString(16)).slice(-4),g=("0000"+(+g).toString(16)).slice(-4),C.push("<"+g+"><"+F+">"));return C.length&&(U+=`
`+C.length+` beginbfchar
`+C.join(`
`)+`
endbfchar
`),U+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};s.events.push(["putFont",function(_){(function(g){var a=g.font,C=g.out,F=g.newObject,U=g.putStream;if(a.metadata instanceof d.API.TTFFont&&a.encoding==="Identity-H"){for(var O=a.metadata.Unicode.widths,$=a.metadata.subset.encode(a.metadata.glyIdsUsed,1),V="",ye=0;ye<$.length;ye++)V+=String.fromCharCode($[ye]);var de=F();U({data:V,addLength1:!0,objectId:de}),C("endobj");var Pe=F();U({data:f(a.metadata.toUnicode),addLength1:!0,objectId:Pe}),C("endobj");var ue=F();C("<<"),C("/Type /FontDescriptor"),C("/FontName /"+lh(a.fontName)),C("/FontFile2 "+de+" 0 R"),C("/FontBBox "+d.API.PDFObject.convert(a.metadata.bbox)),C("/Flags "+a.metadata.flags),C("/StemV "+a.metadata.stemV),C("/ItalicAngle "+a.metadata.italicAngle),C("/Ascent "+a.metadata.ascender),C("/Descent "+a.metadata.decender),C("/CapHeight "+a.metadata.capHeight),C(">>"),C("endobj");var Se=F();C("<<"),C("/Type /Font"),C("/BaseFont /"+lh(a.fontName)),C("/FontDescriptor "+ue+" 0 R"),C("/W "+d.API.PDFObject.convert(O)),C("/CIDToGIDMap /Identity"),C("/DW 1000"),C("/Subtype /CIDFontType2"),C("/CIDSystemInfo"),C("<<"),C("/Supplement 0"),C("/Registry (Adobe)"),C("/Ordering ("+a.encoding+")"),C(">>"),C(">>"),C("endobj"),a.objectNumber=F(),C("<<"),C("/Type /Font"),C("/Subtype /Type0"),C("/ToUnicode "+Pe+" 0 R"),C("/BaseFont /"+lh(a.fontName)),C("/Encoding /"+a.encoding),C("/DescendantFonts ["+Se+" 0 R]"),C(">>"),C("endobj"),a.isAlreadyPutted=!0}})(_)}]),s.events.push(["putFont",function(_){(function(g){var a=g.font,C=g.out,F=g.newObject,U=g.putStream;if(a.metadata instanceof d.API.TTFFont&&a.encoding==="WinAnsiEncoding"){for(var O=a.metadata.rawData,$="",V=0;V<O.length;V++)$+=String.fromCharCode(O[V]);var ye=F();U({data:$,addLength1:!0,objectId:ye}),C("endobj");var de=F();U({data:f(a.metadata.toUnicode),addLength1:!0,objectId:de}),C("endobj");var Pe=F();C("<<"),C("/Descent "+a.metadata.decender),C("/CapHeight "+a.metadata.capHeight),C("/StemV "+a.metadata.stemV),C("/Type /FontDescriptor"),C("/FontFile2 "+ye+" 0 R"),C("/Flags 96"),C("/FontBBox "+d.API.PDFObject.convert(a.metadata.bbox)),C("/FontName /"+lh(a.fontName)),C("/ItalicAngle "+a.metadata.italicAngle),C("/Ascent "+a.metadata.ascender),C(">>"),C("endobj"),a.objectNumber=F();for(var ue=0;ue<a.metadata.hmtx.widths.length;ue++)a.metadata.hmtx.widths[ue]=parseInt(a.metadata.hmtx.widths[ue]*(1e3/a.metadata.head.unitsPerEm));C("<</Subtype/TrueType/Type/Font/ToUnicode "+de+" 0 R/BaseFont/"+lh(a.fontName)+"/FontDescriptor "+Pe+" 0 R/Encoding/"+a.encoding+" /FirstChar 29 /LastChar 255 /Widths "+d.API.PDFObject.convert(a.metadata.hmtx.widths)+">>"),C("endobj"),a.isAlreadyPutted=!0}})(_)}]);var y=function(_){var g,a=_.text||"",C=_.x,F=_.y,U=_.options||{},O=_.mutex||{},$=O.pdfEscape,V=O.activeFontKey,ye=O.fonts,de=V,Pe="",ue=0,Se="",ze=ye[de].encoding;if(ye[de].encoding!=="Identity-H")return{text:a,x:C,y:F,options:U,mutex:O};for(Se=a,de=V,Array.isArray(a)&&(Se=a[0]),ue=0;ue<Se.length;ue+=1)ye[de].metadata.hasOwnProperty("cmap")&&(g=ye[de].metadata.cmap.unicode.codeMap[Se[ue].charCodeAt(0)]),g||Se[ue].charCodeAt(0)<256&&ye[de].metadata.hasOwnProperty("Unicode")?Pe+=Se[ue]:Pe+="";var Ye="";return parseInt(de.slice(1))<14||ze==="WinAnsiEncoding"?Ye=$(Pe,de).split("").map(function(Je){return Je.charCodeAt(0).toString(16)}).join(""):ze==="Identity-H"&&(Ye=u(Pe,ye[de])),O.isHex=!0,{text:Ye,x:C,y:F,options:U,mutex:O}};s.events.push(["postProcessText",function(_){var g=_.text||"",a=[],C={text:g,x:_.x,y:_.y,options:_.options,mutex:_.mutex};if(Array.isArray(g)){var F=0;for(F=0;F<g.length;F+=1)Array.isArray(g[F])&&g[F].length===3?a.push([y(Object.assign({},C,{text:g[F][0]})).text,g[F][1],g[F][2]]):a.push(y(Object.assign({},C,{text:g[F]})).text);_.text=a}else _.text=y(Object.assign({},C,{text:g})).text}])}(Li),function(d){var s=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};d.existsFileInVFS=function(u){return s.call(this),this.internal.vFS[u]!==void 0},d.addFileToVFS=function(u,f){return s.call(this),this.internal.vFS[u]=f,this},d.getFileFromVFS=function(u){return s.call(this),this.internal.vFS[u]!==void 0?this.internal.vFS[u]:null}}(Li.API),function(d){d.__bidiEngine__=d.prototype.__bidiEngine__=function(f){var y,_,g,a,C,F,U,O=s,$=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],V=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],ye={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},de={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},Pe=["(",")","(","<",">","<","[","]","[","{","}","{","«","»","«","‹","›","‹","⁅","⁆","⁅","⁽","⁾","⁽","₍","₎","₍","≤","≥","≤","〈","〉","〈","﹙","﹚","﹙","﹛","﹜","﹛","﹝","﹞","﹝","﹤","﹥","﹤"],ue=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),Se=!1,ze=0;this.__bidiEngine__={};var Ye=function(pe){var me=pe.charCodeAt(),Ne=me>>8,Le=de[Ne];return Le!==void 0?O[256*Le+(255&me)]:Ne===252||Ne===253?"AL":ue.test(Ne)?"L":Ne===8?"R":"N"},Je=function(pe){for(var me,Ne=0;Ne<pe.length;Ne++){if((me=Ye(pe.charAt(Ne)))==="L")return!1;if(me==="R")return!0}return!1},ct=function(pe,me,Ne,Le){var et,it,nt,Xe,at=me[Le];switch(at){case"L":case"R":Se=!1;break;case"N":case"AN":break;case"EN":Se&&(at="AN");break;case"AL":Se=!0,at="R";break;case"WS":at="N";break;case"CS":Le<1||Le+1>=me.length||(et=Ne[Le-1])!=="EN"&&et!=="AN"||(it=me[Le+1])!=="EN"&&it!=="AN"?at="N":Se&&(it="AN"),at=it===et?it:"N";break;case"ES":at=(et=Le>0?Ne[Le-1]:"B")==="EN"&&Le+1<me.length&&me[Le+1]==="EN"?"EN":"N";break;case"ET":if(Le>0&&Ne[Le-1]==="EN"){at="EN";break}if(Se){at="N";break}for(nt=Le+1,Xe=me.length;nt<Xe&&me[nt]==="ET";)nt++;at=nt<Xe&&me[nt]==="EN"?"EN":"N";break;case"NSM":if(g&&!a){for(Xe=me.length,nt=Le+1;nt<Xe&&me[nt]==="NSM";)nt++;if(nt<Xe){var dt=pe[Le],Mt=dt>=1425&&dt<=2303||dt===64286;if(et=me[nt],Mt&&(et==="R"||et==="AL")){at="R";break}}}at=Le<1||(et=me[Le-1])==="B"?"N":Ne[Le-1];break;case"B":Se=!1,y=!0,at=ze;break;case"S":_=!0,at="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":Se=!1;break;case"BN":at="N"}return at},Ge=function(pe,me,Ne){var Le=pe.split("");return Ne&&De(Le,Ne,{hiLevel:ze}),Le.reverse(),me&&me.reverse(),Le.join("")},De=function(pe,me,Ne){var Le,et,it,nt,Xe,at=-1,dt=pe.length,Mt=0,ie=[],xe=ze?V:$,ke=[];for(Se=!1,y=!1,_=!1,et=0;et<dt;et++)ke[et]=Ye(pe[et]);for(it=0;it<dt;it++){if(Xe=Mt,ie[it]=ct(pe,ke,ie,it),Le=240&(Mt=xe[Xe][ye[ie[it]]]),Mt&=15,me[it]=nt=xe[Mt][5],Le>0)if(Le===16){for(et=at;et<it;et++)me[et]=1;at=-1}else at=-1;if(xe[Mt][6])at===-1&&(at=it);else if(at>-1){for(et=at;et<it;et++)me[et]=nt;at=-1}ke[it]==="B"&&(me[it]=0),Ne.hiLevel|=nt}_&&function(Fe,qe,$e){for(var Ke=0;Ke<$e;Ke++)if(Fe[Ke]==="S"){qe[Ke]=ze;for(var tt=Ke-1;tt>=0&&Fe[tt]==="WS";tt--)qe[tt]=ze}}(ke,me,dt)},Qe=function(pe,me,Ne,Le,et){if(!(et.hiLevel<pe)){if(pe===1&&ze===1&&!y)return me.reverse(),void(Ne&&Ne.reverse());for(var it,nt,Xe,at,dt=me.length,Mt=0;Mt<dt;){if(Le[Mt]>=pe){for(Xe=Mt+1;Xe<dt&&Le[Xe]>=pe;)Xe++;for(at=Mt,nt=Xe-1;at<nt;at++,nt--)it=me[at],me[at]=me[nt],me[nt]=it,Ne&&(it=Ne[at],Ne[at]=Ne[nt],Ne[nt]=it);Mt=Xe}Mt++}}},pt=function(pe,me,Ne){var Le=pe.split(""),et={hiLevel:ze};return Ne||(Ne=[]),De(Le,Ne,et),function(it,nt,Xe){if(Xe.hiLevel!==0&&U)for(var at,dt=0;dt<it.length;dt++)nt[dt]===1&&(at=Pe.indexOf(it[dt]))>=0&&(it[dt]=Pe[at+1])}(Le,Ne,et),Qe(2,Le,me,Ne,et),Qe(1,Le,me,Ne,et),Le.join("")};return this.__bidiEngine__.doBidiReorder=function(pe,me,Ne){if(function(et,it){if(it)for(var nt=0;nt<et.length;nt++)it[nt]=nt;a===void 0&&(a=Je(et)),F===void 0&&(F=Je(et))}(pe,me),g||!C||F)if(g&&C&&a^F)ze=a?1:0,pe=Ge(pe,me,Ne);else if(!g&&C&&F)ze=a?1:0,pe=pt(pe,me,Ne),pe=Ge(pe,me);else if(!g||a||C||F){if(g&&!C&&a^F)pe=Ge(pe,me),a?(ze=0,pe=pt(pe,me,Ne)):(ze=1,pe=pt(pe,me,Ne),pe=Ge(pe,me));else if(g&&a&&!C&&F)ze=1,pe=pt(pe,me,Ne),pe=Ge(pe,me);else if(!g&&!C&&a^F){var Le=U;a?(ze=1,pe=pt(pe,me,Ne),ze=0,U=!1,pe=pt(pe,me,Ne),U=Le):(ze=0,pe=pt(pe,me,Ne),pe=Ge(pe,me),ze=1,U=!1,pe=pt(pe,me,Ne),U=Le,pe=Ge(pe,me))}}else ze=0,pe=pt(pe,me,Ne);else ze=a?1:0,pe=pt(pe,me,Ne);return pe},this.__bidiEngine__.setOptions=function(pe){pe&&(g=pe.isInputVisual,C=pe.isOutputVisual,a=pe.isInputRtl,F=pe.isOutputRtl,U=pe.isSymmetricSwapping)},this.__bidiEngine__.setOptions(f),this.__bidiEngine__};var s=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],u=new d.__bidiEngine__({isInputVisual:!0});d.API.events.push(["postProcessText",function(f){var y=f.text,_=(f.x,f.y,f.options||{}),g=(f.mutex,_.lang,[]);if(_.isInputVisual=typeof _.isInputVisual!="boolean"||_.isInputVisual,u.setOptions(_),Object.prototype.toString.call(y)==="[object Array]"){var a=0;for(g=[],a=0;a<y.length;a+=1)Object.prototype.toString.call(y[a])==="[object Array]"?g.push([u.doBidiReorder(y[a][0]),y[a][1],y[a][2]]):g.push([u.doBidiReorder(y[a])]);f.text=g}else f.text=u.doBidiReorder(y);u.setOptions({isInputVisual:!0})}])}(Li),Li.API.TTFFont=function(){function d(s){var u;if(this.rawData=s,u=this.contents=new sc(s),this.contents.pos=4,u.readString(4)==="ttcf")throw new Error("TTCF not supported.");u.pos=0,this.parse(),this.subset=new o2(this),this.registerTTF()}return d.open=function(s){return new d(s)},d.prototype.parse=function(){return this.directory=new Wv(this.contents),this.head=new Xv(this),this.name=new e2(this),this.cmap=new Xg(this),this.toUnicode={},this.hhea=new Kv(this),this.maxp=new t2(this),this.hmtx=new i2(this),this.post=new Jv(this),this.os2=new Yv(this),this.loca=new a2(this),this.glyf=new r2(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},d.prototype.registerTTF=function(){var s,u,f,y,_;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var g,a,C,F;for(F=[],g=0,a=(C=this.bbox).length;g<a;g++)s=C[g],F.push(Math.round(s*this.scaleFactor));return F}).call(this),this.stemV=0,this.post.exists?(f=255&(y=this.post.italic_angle),32768&(u=y>>16)&&(u=-(1+(65535^u))),this.italicAngle=+(u+"."+f)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(_=this.familyClass)===1||_===2||_===3||_===4||_===5||_===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},d.prototype.characterToGlyph=function(s){var u;return((u=this.cmap.unicode)!=null?u.codeMap[s]:void 0)||0},d.prototype.widthOfGlyph=function(s){var u;return u=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(s).advance*u},d.prototype.widthOfString=function(s,u,f){var y,_,g,a;for(g=0,_=0,a=(s=""+s).length;0<=a?_<a:_>a;_=0<=a?++_:--_)y=s.charCodeAt(_),g+=this.widthOfGlyph(this.characterToGlyph(y))+f*(1e3/u)||0;return g*(u/1e3)},d.prototype.lineHeight=function(s,u){var f;return u==null&&(u=!1),f=u?this.lineGap:0,(this.ascender+f-this.decender)/1e3*s},d}();var po,sc=function(){function d(s){this.data=s??[],this.pos=0,this.length=this.data.length}return d.prototype.readByte=function(){return this.data[this.pos++]},d.prototype.writeByte=function(s){return this.data[this.pos++]=s},d.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},d.prototype.writeUInt32=function(s){return this.writeByte(s>>>24&255),this.writeByte(s>>16&255),this.writeByte(s>>8&255),this.writeByte(255&s)},d.prototype.readInt32=function(){var s;return(s=this.readUInt32())>=2147483648?s-4294967296:s},d.prototype.writeInt32=function(s){return s<0&&(s+=4294967296),this.writeUInt32(s)},d.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},d.prototype.writeUInt16=function(s){return this.writeByte(s>>8&255),this.writeByte(255&s)},d.prototype.readInt16=function(){var s;return(s=this.readUInt16())>=32768?s-65536:s},d.prototype.writeInt16=function(s){return s<0&&(s+=65536),this.writeUInt16(s)},d.prototype.readString=function(s){var u,f;for(f=[],u=0;0<=s?u<s:u>s;u=0<=s?++u:--u)f[u]=String.fromCharCode(this.readByte());return f.join("")},d.prototype.writeString=function(s){var u,f,y;for(y=[],u=0,f=s.length;0<=f?u<f:u>f;u=0<=f?++u:--u)y.push(this.writeByte(s.charCodeAt(u)));return y},d.prototype.readShort=function(){return this.readInt16()},d.prototype.writeShort=function(s){return this.writeInt16(s)},d.prototype.readLongLong=function(){var s,u,f,y,_,g,a,C;return s=this.readByte(),u=this.readByte(),f=this.readByte(),y=this.readByte(),_=this.readByte(),g=this.readByte(),a=this.readByte(),C=this.readByte(),128&s?-1*(72057594037927940*(255^s)+281474976710656*(255^u)+1099511627776*(255^f)+4294967296*(255^y)+16777216*(255^_)+65536*(255^g)+256*(255^a)+(255^C)+1):72057594037927940*s+281474976710656*u+1099511627776*f+4294967296*y+16777216*_+65536*g+256*a+C},d.prototype.writeLongLong=function(s){var u,f;return u=Math.floor(s/4294967296),f=4294967295&s,this.writeByte(u>>24&255),this.writeByte(u>>16&255),this.writeByte(u>>8&255),this.writeByte(255&u),this.writeByte(f>>24&255),this.writeByte(f>>16&255),this.writeByte(f>>8&255),this.writeByte(255&f)},d.prototype.readInt=function(){return this.readInt32()},d.prototype.writeInt=function(s){return this.writeInt32(s)},d.prototype.read=function(s){var u,f;for(u=[],f=0;0<=s?f<s:f>s;f=0<=s?++f:--f)u.push(this.readByte());return u},d.prototype.write=function(s){var u,f,y,_;for(_=[],f=0,y=s.length;f<y;f++)u=s[f],_.push(this.writeByte(u));return _},d}(),Wv=function(){var d;function s(u){var f,y,_;for(this.scalarType=u.readInt(),this.tableCount=u.readShort(),this.searchRange=u.readShort(),this.entrySelector=u.readShort(),this.rangeShift=u.readShort(),this.tables={},y=0,_=this.tableCount;0<=_?y<_:y>_;y=0<=_?++y:--y)f={tag:u.readString(4),checksum:u.readInt(),offset:u.readInt(),length:u.readInt()},this.tables[f.tag]=f}return s.prototype.encode=function(u){var f,y,_,g,a,C,F,U,O,$,V,ye,de;for(de in V=Object.keys(u).length,C=Math.log(2),O=16*Math.floor(Math.log(V)/C),g=Math.floor(O/C),U=16*V-O,(y=new sc).writeInt(this.scalarType),y.writeShort(V),y.writeShort(O),y.writeShort(g),y.writeShort(U),_=16*V,F=y.pos+_,a=null,ye=[],u)for($=u[de],y.writeString(de),y.writeInt(d($)),y.writeInt(F),y.writeInt($.length),ye=ye.concat($),de==="head"&&(a=F),F+=$.length;F%4;)ye.push(0),F++;return y.write(ye),f=2981146554-d(y.data),y.pos=a+8,y.writeUInt32(f),y.data},d=function(u){var f,y,_,g;for(u=Kg.call(u);u.length%4;)u.push(0);for(_=new sc(u),y=0,f=0,g=u.length;f<g;f=f+=4)y+=_.readUInt32();return 4294967295&y},s}(),Hv={}.hasOwnProperty,il=function(d,s){for(var u in s)Hv.call(s,u)&&(d[u]=s[u]);function f(){this.constructor=d}return f.prototype=s.prototype,d.prototype=new f,d.__super__=s.prototype,d};po=function(){function d(s){var u;this.file=s,u=this.file.directory.tables[this.tag],this.exists=!!u,u&&(this.offset=u.offset,this.length=u.length,this.parse(this.file.contents))}return d.prototype.parse=function(){},d.prototype.encode=function(){},d.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},d}();var Xv=function(d){function s(){return s.__super__.constructor.apply(this,arguments)}return il(s,po),s.prototype.tag="head",s.prototype.parse=function(u){return u.pos=this.offset,this.version=u.readInt(),this.revision=u.readInt(),this.checkSumAdjustment=u.readInt(),this.magicNumber=u.readInt(),this.flags=u.readShort(),this.unitsPerEm=u.readShort(),this.created=u.readLongLong(),this.modified=u.readLongLong(),this.xMin=u.readShort(),this.yMin=u.readShort(),this.xMax=u.readShort(),this.yMax=u.readShort(),this.macStyle=u.readShort(),this.lowestRecPPEM=u.readShort(),this.fontDirectionHint=u.readShort(),this.indexToLocFormat=u.readShort(),this.glyphDataFormat=u.readShort()},s.prototype.encode=function(u){var f;return(f=new sc).writeInt(this.version),f.writeInt(this.revision),f.writeInt(this.checkSumAdjustment),f.writeInt(this.magicNumber),f.writeShort(this.flags),f.writeShort(this.unitsPerEm),f.writeLongLong(this.created),f.writeLongLong(this.modified),f.writeShort(this.xMin),f.writeShort(this.yMin),f.writeShort(this.xMax),f.writeShort(this.yMax),f.writeShort(this.macStyle),f.writeShort(this.lowestRecPPEM),f.writeShort(this.fontDirectionHint),f.writeShort(u),f.writeShort(this.glyphDataFormat),f.data},s}(),Qm=function(){function d(s,u){var f,y,_,g,a,C,F,U,O,$,V,ye,de,Pe,ue,Se,ze;switch(this.platformID=s.readUInt16(),this.encodingID=s.readShort(),this.offset=u+s.readInt(),O=s.pos,s.pos=this.offset,this.format=s.readUInt16(),this.length=s.readUInt16(),this.language=s.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(C=0;C<256;++C)this.codeMap[C]=s.readByte();break;case 4:for(V=s.readUInt16(),$=V/2,s.pos+=6,_=function(){var Ye,Je;for(Je=[],C=Ye=0;0<=$?Ye<$:Ye>$;C=0<=$?++Ye:--Ye)Je.push(s.readUInt16());return Je}(),s.pos+=2,de=function(){var Ye,Je;for(Je=[],C=Ye=0;0<=$?Ye<$:Ye>$;C=0<=$?++Ye:--Ye)Je.push(s.readUInt16());return Je}(),F=function(){var Ye,Je;for(Je=[],C=Ye=0;0<=$?Ye<$:Ye>$;C=0<=$?++Ye:--Ye)Je.push(s.readUInt16());return Je}(),U=function(){var Ye,Je;for(Je=[],C=Ye=0;0<=$?Ye<$:Ye>$;C=0<=$?++Ye:--Ye)Je.push(s.readUInt16());return Je}(),y=(this.length-s.pos+this.offset)/2,a=function(){var Ye,Je;for(Je=[],C=Ye=0;0<=y?Ye<y:Ye>y;C=0<=y?++Ye:--Ye)Je.push(s.readUInt16());return Je}(),C=ue=0,ze=_.length;ue<ze;C=++ue)for(Pe=_[C],f=Se=ye=de[C];ye<=Pe?Se<=Pe:Se>=Pe;f=ye<=Pe?++Se:--Se)U[C]===0?g=f+F[C]:(g=a[U[C]/2+(f-ye)-($-C)]||0)!==0&&(g+=F[C]),this.codeMap[f]=65535&g}s.pos=O}return d.encode=function(s,u){var f,y,_,g,a,C,F,U,O,$,V,ye,de,Pe,ue,Se,ze,Ye,Je,ct,Ge,De,Qe,pt,pe,me,Ne,Le,et,it,nt,Xe,at,dt,Mt,ie,xe,ke,Fe,qe,$e,Ke,tt,Tt,kt,Nt;switch(Le=new sc,g=Object.keys(s).sort(function(zt,ti){return zt-ti}),u){case"macroman":for(de=0,Pe=function(){var zt=[];for(ye=0;ye<256;++ye)zt.push(0);return zt}(),Se={0:0},_={},et=0,at=g.length;et<at;et++)Se[tt=s[y=g[et]]]==null&&(Se[tt]=++de),_[y]={old:s[y],new:Se[s[y]]},Pe[y]=Se[s[y]];return Le.writeUInt16(1),Le.writeUInt16(0),Le.writeUInt32(12),Le.writeUInt16(0),Le.writeUInt16(262),Le.writeUInt16(0),Le.write(Pe),{charMap:_,subtable:Le.data,maxGlyphID:de+1};case"unicode":for(me=[],O=[],ze=0,Se={},f={},ue=F=null,it=0,dt=g.length;it<dt;it++)Se[Je=s[y=g[it]]]==null&&(Se[Je]=++ze),f[y]={old:Je,new:Se[Je]},a=Se[Je]-y,ue!=null&&a===F||(ue&&O.push(ue),me.push(y),F=a),ue=y;for(ue&&O.push(ue),O.push(65535),me.push(65535),pt=2*(Qe=me.length),De=2*Math.pow(Math.log(Qe)/Math.LN2,2),$=Math.log(De/2)/Math.LN2,Ge=2*Qe-De,C=[],ct=[],V=[],ye=nt=0,Mt=me.length;nt<Mt;ye=++nt){if(pe=me[ye],U=O[ye],pe===65535){C.push(0),ct.push(0);break}if(pe-(Ne=f[pe].new)>=32768)for(C.push(0),ct.push(2*(V.length+Qe-ye)),y=Xe=pe;pe<=U?Xe<=U:Xe>=U;y=pe<=U?++Xe:--Xe)V.push(f[y].new);else C.push(Ne-pe),ct.push(0)}for(Le.writeUInt16(3),Le.writeUInt16(1),Le.writeUInt32(12),Le.writeUInt16(4),Le.writeUInt16(16+8*Qe+2*V.length),Le.writeUInt16(0),Le.writeUInt16(pt),Le.writeUInt16(De),Le.writeUInt16($),Le.writeUInt16(Ge),$e=0,ie=O.length;$e<ie;$e++)y=O[$e],Le.writeUInt16(y);for(Le.writeUInt16(0),Ke=0,xe=me.length;Ke<xe;Ke++)y=me[Ke],Le.writeUInt16(y);for(Tt=0,ke=C.length;Tt<ke;Tt++)a=C[Tt],Le.writeUInt16(a);for(kt=0,Fe=ct.length;kt<Fe;kt++)Ye=ct[kt],Le.writeUInt16(Ye);for(Nt=0,qe=V.length;Nt<qe;Nt++)de=V[Nt],Le.writeUInt16(de);return{charMap:f,subtable:Le.data,maxGlyphID:ze+1}}},d}(),Xg=function(d){function s(){return s.__super__.constructor.apply(this,arguments)}return il(s,po),s.prototype.tag="cmap",s.prototype.parse=function(u){var f,y,_;for(u.pos=this.offset,this.version=u.readUInt16(),_=u.readUInt16(),this.tables=[],this.unicode=null,y=0;0<=_?y<_:y>_;y=0<=_?++y:--y)f=new Qm(u,this.offset),this.tables.push(f),f.isUnicode&&this.unicode==null&&(this.unicode=f);return!0},s.encode=function(u,f){var y,_;return f==null&&(f="macroman"),y=Qm.encode(u,f),(_=new sc).writeUInt16(0),_.writeUInt16(1),y.table=_.data.concat(y.subtable),y},s}(),Kv=function(d){function s(){return s.__super__.constructor.apply(this,arguments)}return il(s,po),s.prototype.tag="hhea",s.prototype.parse=function(u){return u.pos=this.offset,this.version=u.readInt(),this.ascender=u.readShort(),this.decender=u.readShort(),this.lineGap=u.readShort(),this.advanceWidthMax=u.readShort(),this.minLeftSideBearing=u.readShort(),this.minRightSideBearing=u.readShort(),this.xMaxExtent=u.readShort(),this.caretSlopeRise=u.readShort(),this.caretSlopeRun=u.readShort(),this.caretOffset=u.readShort(),u.pos+=8,this.metricDataFormat=u.readShort(),this.numberOfMetrics=u.readUInt16()},s}(),Yv=function(d){function s(){return s.__super__.constructor.apply(this,arguments)}return il(s,po),s.prototype.tag="OS/2",s.prototype.parse=function(u){if(u.pos=this.offset,this.version=u.readUInt16(),this.averageCharWidth=u.readShort(),this.weightClass=u.readUInt16(),this.widthClass=u.readUInt16(),this.type=u.readShort(),this.ySubscriptXSize=u.readShort(),this.ySubscriptYSize=u.readShort(),this.ySubscriptXOffset=u.readShort(),this.ySubscriptYOffset=u.readShort(),this.ySuperscriptXSize=u.readShort(),this.ySuperscriptYSize=u.readShort(),this.ySuperscriptXOffset=u.readShort(),this.ySuperscriptYOffset=u.readShort(),this.yStrikeoutSize=u.readShort(),this.yStrikeoutPosition=u.readShort(),this.familyClass=u.readShort(),this.panose=function(){var f,y;for(y=[],f=0;f<10;++f)y.push(u.readByte());return y}(),this.charRange=function(){var f,y;for(y=[],f=0;f<4;++f)y.push(u.readInt());return y}(),this.vendorID=u.readString(4),this.selection=u.readShort(),this.firstCharIndex=u.readShort(),this.lastCharIndex=u.readShort(),this.version>0&&(this.ascent=u.readShort(),this.descent=u.readShort(),this.lineGap=u.readShort(),this.winAscent=u.readShort(),this.winDescent=u.readShort(),this.codePageRange=function(){var f,y;for(y=[],f=0;f<2;f=++f)y.push(u.readInt());return y}(),this.version>1))return this.xHeight=u.readShort(),this.capHeight=u.readShort(),this.defaultChar=u.readShort(),this.breakChar=u.readShort(),this.maxContext=u.readShort()},s}(),Jv=function(d){function s(){return s.__super__.constructor.apply(this,arguments)}return il(s,po),s.prototype.tag="post",s.prototype.parse=function(u){var f,y,_;switch(u.pos=this.offset,this.format=u.readInt(),this.italicAngle=u.readInt(),this.underlinePosition=u.readShort(),this.underlineThickness=u.readShort(),this.isFixedPitch=u.readInt(),this.minMemType42=u.readInt(),this.maxMemType42=u.readInt(),this.minMemType1=u.readInt(),this.maxMemType1=u.readInt(),this.format){case 65536:break;case 131072:var g;for(y=u.readUInt16(),this.glyphNameIndex=[],g=0;0<=y?g<y:g>y;g=0<=y?++g:--g)this.glyphNameIndex.push(u.readUInt16());for(this.names=[],_=[];u.pos<this.offset+this.length;)f=u.readByte(),_.push(this.names.push(u.readString(f)));return _;case 151552:return y=u.readUInt16(),this.offsets=u.read(y);case 196608:break;case 262144:return this.map=(function(){var a,C,F;for(F=[],g=a=0,C=this.file.maxp.numGlyphs;0<=C?a<C:a>C;g=0<=C?++a:--a)F.push(u.readUInt32());return F}).call(this)}},s}(),Qv=function(d,s){this.raw=d,this.length=d.length,this.platformID=s.platformID,this.encodingID=s.encodingID,this.languageID=s.languageID},e2=function(d){function s(){return s.__super__.constructor.apply(this,arguments)}return il(s,po),s.prototype.tag="name",s.prototype.parse=function(u){var f,y,_,g,a,C,F,U,O,$,V;for(u.pos=this.offset,u.readShort(),f=u.readShort(),C=u.readShort(),y=[],g=0;0<=f?g<f:g>f;g=0<=f?++g:--g)y.push({platformID:u.readShort(),encodingID:u.readShort(),languageID:u.readShort(),nameID:u.readShort(),length:u.readShort(),offset:this.offset+C+u.readShort()});for(F={},g=O=0,$=y.length;O<$;g=++O)_=y[g],u.pos=_.offset,U=u.readString(_.length),a=new Qv(U,_),F[V=_.nameID]==null&&(F[V]=[]),F[_.nameID].push(a);this.strings=F,this.copyright=F[0],this.fontFamily=F[1],this.fontSubfamily=F[2],this.uniqueSubfamily=F[3],this.fontName=F[4],this.version=F[5];try{this.postscriptName=F[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=F[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=F[7],this.manufacturer=F[8],this.designer=F[9],this.description=F[10],this.vendorUrl=F[11],this.designerUrl=F[12],this.license=F[13],this.licenseUrl=F[14],this.preferredFamily=F[15],this.preferredSubfamily=F[17],this.compatibleFull=F[18],this.sampleText=F[19]},s}(),t2=function(d){function s(){return s.__super__.constructor.apply(this,arguments)}return il(s,po),s.prototype.tag="maxp",s.prototype.parse=function(u){return u.pos=this.offset,this.version=u.readInt(),this.numGlyphs=u.readUInt16(),this.maxPoints=u.readUInt16(),this.maxContours=u.readUInt16(),this.maxCompositePoints=u.readUInt16(),this.maxComponentContours=u.readUInt16(),this.maxZones=u.readUInt16(),this.maxTwilightPoints=u.readUInt16(),this.maxStorage=u.readUInt16(),this.maxFunctionDefs=u.readUInt16(),this.maxInstructionDefs=u.readUInt16(),this.maxStackElements=u.readUInt16(),this.maxSizeOfInstructions=u.readUInt16(),this.maxComponentElements=u.readUInt16(),this.maxComponentDepth=u.readUInt16()},s}(),i2=function(d){function s(){return s.__super__.constructor.apply(this,arguments)}return il(s,po),s.prototype.tag="hmtx",s.prototype.parse=function(u){var f,y,_,g,a,C,F;for(u.pos=this.offset,this.metrics=[],f=0,C=this.file.hhea.numberOfMetrics;0<=C?f<C:f>C;f=0<=C?++f:--f)this.metrics.push({advance:u.readUInt16(),lsb:u.readInt16()});for(_=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var U,O;for(O=[],f=U=0;0<=_?U<_:U>_;f=0<=_?++U:--U)O.push(u.readInt16());return O}(),this.widths=(function(){var U,O,$,V;for(V=[],U=0,O=($=this.metrics).length;U<O;U++)g=$[U],V.push(g.advance);return V}).call(this),y=this.widths[this.widths.length-1],F=[],f=a=0;0<=_?a<_:a>_;f=0<=_?++a:--a)F.push(this.widths.push(y));return F},s.prototype.forGlyph=function(u){return u in this.metrics?this.metrics[u]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[u-this.metrics.length]}},s}(),Kg=[].slice,r2=function(d){function s(){return s.__super__.constructor.apply(this,arguments)}return il(s,po),s.prototype.tag="glyf",s.prototype.parse=function(){return this.cache={}},s.prototype.glyphFor=function(u){var f,y,_,g,a,C,F,U,O,$;return u in this.cache?this.cache[u]:(g=this.file.loca,f=this.file.contents,y=g.indexOf(u),(_=g.lengthOf(u))===0?this.cache[u]=null:(f.pos=this.offset+y,a=(C=new sc(f.read(_))).readShort(),U=C.readShort(),$=C.readShort(),F=C.readShort(),O=C.readShort(),this.cache[u]=a===-1?new s2(C,U,$,F,O):new n2(C,a,U,$,F,O),this.cache[u]))},s.prototype.encode=function(u,f,y){var _,g,a,C,F;for(a=[],g=[],C=0,F=f.length;C<F;C++)_=u[f[C]],g.push(a.length),_&&(a=a.concat(_.encode(y)));return g.push(a.length),{table:a,offsets:g}},s}(),n2=function(){function d(s,u,f,y,_,g){this.raw=s,this.numberOfContours=u,this.xMin=f,this.yMin=y,this.xMax=_,this.yMax=g,this.compound=!1}return d.prototype.encode=function(){return this.raw.data},d}(),s2=function(){function d(s,u,f,y,_){var g,a;for(this.raw=s,this.xMin=u,this.yMin=f,this.xMax=y,this.yMax=_,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],g=this.raw;a=g.readShort(),this.glyphOffsets.push(g.pos),this.glyphIDs.push(g.readUInt16()),32&a;)g.pos+=1&a?4:2,128&a?g.pos+=8:64&a?g.pos+=4:8&a&&(g.pos+=2)}return d.prototype.encode=function(){var s,u,f;for(u=new sc(Kg.call(this.raw.data)),s=0,f=this.glyphIDs.length;s<f;++s)u.pos=this.glyphOffsets[s];return u.data},d}(),a2=function(d){function s(){return s.__super__.constructor.apply(this,arguments)}return il(s,po),s.prototype.tag="loca",s.prototype.parse=function(u){var f,y;return u.pos=this.offset,f=this.file.head.indexToLocFormat,this.offsets=f===0?(function(){var _,g;for(g=[],y=0,_=this.length;y<_;y+=2)g.push(2*u.readUInt16());return g}).call(this):(function(){var _,g;for(g=[],y=0,_=this.length;y<_;y+=4)g.push(u.readUInt32());return g}).call(this)},s.prototype.indexOf=function(u){return this.offsets[u]},s.prototype.lengthOf=function(u){return this.offsets[u+1]-this.offsets[u]},s.prototype.encode=function(u,f){for(var y=new Uint32Array(this.offsets.length),_=0,g=0,a=0;a<y.length;++a)if(y[a]=_,g<f.length&&f[g]==a){++g,y[a]=_;var C=this.offsets[a],F=this.offsets[a+1]-C;F>0&&(_+=F)}for(var U=new Array(4*y.length),O=0;O<y.length;++O)U[4*O+3]=255&y[O],U[4*O+2]=(65280&y[O])>>8,U[4*O+1]=(16711680&y[O])>>16,U[4*O]=(4278190080&y[O])>>24;return U},s}(),o2=function(){function d(s){this.font=s,this.subset={},this.unicodes={},this.next=33}return d.prototype.generateCmap=function(){var s,u,f,y,_;for(u in y=this.font.cmap.tables[0].codeMap,s={},_=this.subset)f=_[u],s[u]=y[f];return s},d.prototype.glyphsFor=function(s){var u,f,y,_,g,a,C;for(y={},g=0,a=s.length;g<a;g++)y[_=s[g]]=this.font.glyf.glyphFor(_);for(_ in u=[],y)(f=y[_])!=null&&f.compound&&u.push.apply(u,f.glyphIDs);if(u.length>0)for(_ in C=this.glyphsFor(u))f=C[_],y[_]=f;return y},d.prototype.encode=function(s,u){var f,y,_,g,a,C,F,U,O,$,V,ye,de,Pe,ue;for(y in f=Xg.encode(this.generateCmap(),"unicode"),g=this.glyphsFor(s),V={0:0},ue=f.charMap)V[(C=ue[y]).old]=C.new;for(ye in $=f.maxGlyphID,g)ye in V||(V[ye]=$++);return U=function(Se){var ze,Ye;for(ze in Ye={},Se)Ye[Se[ze]]=ze;return Ye}(V),O=Object.keys(U).sort(function(Se,ze){return Se-ze}),de=function(){var Se,ze,Ye;for(Ye=[],Se=0,ze=O.length;Se<ze;Se++)a=O[Se],Ye.push(U[a]);return Ye}(),_=this.font.glyf.encode(g,de,V),F=this.font.loca.encode(_.offsets,de),Pe={cmap:this.font.cmap.raw(),glyf:_.table,loca:F,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(u)},this.font.os2.exists&&(Pe["OS/2"]=this.font.os2.raw()),this.font.directory.encode(Pe)},d}();Li.API.PDFObject=function(){var d;function s(){}return d=function(u,f){return(Array(f+1).join("0")+u).slice(-f)},s.convert=function(u){var f,y,_,g;if(Array.isArray(u))return"["+function(){var a,C,F;for(F=[],a=0,C=u.length;a<C;a++)f=u[a],F.push(s.convert(f));return F}().join(" ")+"]";if(typeof u=="string")return"/"+u;if(u!=null&&u.isString)return"("+u+")";if(u instanceof Date)return"(D:"+d(u.getUTCFullYear(),4)+d(u.getUTCMonth(),2)+d(u.getUTCDate(),2)+d(u.getUTCHours(),2)+d(u.getUTCMinutes(),2)+d(u.getUTCSeconds(),2)+"Z)";if({}.toString.call(u)==="[object Object]"){for(y in _=["<<"],u)g=u[y],_.push("/"+y+" "+s.convert(g));return _.push(">>"),_.join(`
`)}return""+u},s}();const Tp={"circle-radius":8,"circle-color":"red","circle-stroke-width":1,"circle-stroke-color":"black"},Vu={style:{textSize:16,textHaloColor:"#FFFFFF",textHaloWidth:.8,textColor:"#000000",fallbackTextFont:["Open Sans Regular"]},visibility:"visible",position:"bottom-right"},Uu={image:'<svg width="800px" height="800px" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--gis" preserveAspectRatio="xMidYMid meet"><path d="M47.655 1.634l-35 95c-.828 2.24 1.659 4.255 3.68 2.98l33.667-21.228l33.666 21.228c2.02 1.271 4.503-.74 3.678-2.98l-35-95C51.907.514 51.163.006 50 .008c-1.163.001-1.99.65-2.345 1.626zm-.155 14.88v57.54L19.89 91.461z" fill="none" stroke="white" stroke-width="1.5"/><path d="M47.655 1.634l-35 95c-.828 2.24 1.659 4.255 3.68 2.98l33.667-21.228l33.666 21.228c2.02 1.271 4.503-.74 3.678-2.98l-35-95C51.907.514 51.163.006 50 .008c-1.163.001-1.99.65-2.345 1.626zm-.155 14.88v57.54L19.89 91.461z" fill="#000000" fill-rule="evenodd"></path></svg>',imageName:"gl-export-north-icon",imageSizeFraction:.05,visibility:"visible",position:"top-right"};class l2{constructor(s,u=hh.A4,f=300,y=Ml.PNG,_=_h.mm,g="map",a="maplibregl-marker",C=Tp,F="maplibregl-ctrl-attrib-inner",U=Vu,O=Uu){Ji(this,"map"),Ji(this,"width"),Ji(this,"height"),Ji(this,"dpi"),Ji(this,"format"),Ji(this,"unit"),Ji(this,"fileName"),Ji(this,"markerClassName"),Ji(this,"markerCirclePaint"),Ji(this,"attributionClassName"),Ji(this,"attributionOptions"),Ji(this,"northIconOptions"),this.map=s,this.width=u[0],this.height=u[1],this.dpi=f,this.format=y,this.unit=_,this.fileName=g,this.markerClassName=a,this.markerCirclePaint=C,this.attributionClassName=F,this.attributionOptions=U,this.northIconOptions=O}renderMapPost(s){return s}getMarkers(){return this.map.getCanvasContainer().getElementsByClassName(this.markerClassName)}renderMarkers(s){const u=this.getMarkers();for(let f=0;f<u.length;f++){const y=u.item(f);if(!y)continue;const _=y.getAttribute("style");if(!_)continue;const g=/translate\(([^,]+)px,\s*([^,]+)px\)/,a=_.match(g);if(!a)continue;const C=parseInt(a[1]),F=parseInt(a[2]),U=this.map.unproject([C,F]),O=`point${f}`;s.addSource(O,{type:"geojson",data:{type:"Point",coordinates:[U.lng,U.lat]}}),s.addLayer({id:O,source:O,type:"circle",paint:this.markerCirclePaint})}return s}generate(){const s=this;this.addLoader(),this.showLoader();const u=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return s.dpi/96}});const f=document.createElement("div");f.className="hidden-map",document.body.appendChild(f);const y=document.createElement("div");y.style.width=this.toPixels(this.width),y.style.height=this.toPixels(this.height),f.appendChild(y);const _=this.map.getStyle();if(_&&_.sources){const a=_.sources;Object.keys(a).forEach(C=>{const F=a[C];Object.keys(F).forEach(U=>{F[U]||delete F[U]})})}let g=this.getRenderedMap(y,_);g.on("load",()=>{this.addNorthIconToMap(g).then(()=>{g.once("idle",()=>{this.addAttributions(g)?g.once("idle",()=>{g=this.renderMapPost(g),this.getMarkers().length===0?this.exportImage(g,f,u):(g=this.renderMarkers(g),g.once("idle",()=>{this.exportImage(g,f,u)}))}):(g=this.renderMapPost(g),this.getMarkers().length===0?this.exportImage(g,f,u):(g=this.renderMarkers(g),g.once("idle",()=>{this.exportImage(g,f,u)})))})})})}stripHtml(s){const u=document.createElement("div");return u.innerHTML=s,u.textContent||u.innerText||""}getIconWidth(s,u){const f=s.getContainer(),y=parseInt(f.style.width.replace("px",""));return parseInt(`${y*u}`)}getElementPosition(s,u,f=0){const y=s.getContainer();let _=0,g=0;switch(u){case"top-left":_=0+f,g=0+f;break;case"top-right":_=parseInt(y.style.width.replace("px",""))-f,g=0+f;break;case"bottom-left":_=0+f,g=parseInt(y.style.height.replace("px",""))-f;break;case"bottom-right":_=parseInt(y.style.width.replace("px",""))-f,g=parseInt(y.style.height.replace("px",""))-f;break}return[_,g]}addNorthIconImage(s){const u=this.getIconWidth(s,this.northIconOptions.imageSizeFraction??.08);return new Promise(f=>{const y=new Image(u,u);y.onload=()=>{this.northIconOptions.imageName&&s.addImage(this.northIconOptions.imageName,y),f()};function _(g){return"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(g)}this.northIconOptions.image&&(y.src=_(this.northIconOptions.image))})}addNorthIconToMap(s){let u=this.northIconOptions.visibility??"visible";return s.getZoom()<2&&this.width>this.height&&(u="none"),new Promise(f=>{this.addNorthIconImage(s).then(()=>{const y=this.getIconWidth(s,this.northIconOptions.imageSizeFraction??.08)*.8,_=this.getElementPosition(s,this.northIconOptions.position??"top-right",y),g=s.unproject(_),a=this.northIconOptions.imageName??"gl-export-north-icon";s.addSource(a,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[g.lng,g.lat]},properties:{}}}),s.addLayer({id:a,source:a,type:"symbol",layout:{"icon-image":a,"icon-size":1,"icon-rotate":s.getBearing()*-1,"icon-allow-overlap":!0,"icon-ignore-placement":!0,visibility:u},paint:{}}),f()})})}addAttributions(s){var u;if(!this.map.getStyle().glyphs)return!1;const f=s.getContainer(),y=this.attributionOptions.position??"bottom-right",_=this.getElementPosition(s,y,5),g=_[0],a=s.unproject(_),C=f.getElementsByClassName(this.attributionClassName),F=[];if((C==null?void 0:C.length)>0){const Pe=C.item(0);if(Pe)for(let ue=0;ue<Pe.children.length;ue++){const Se=Pe.children.item(ue);Se&&F.push(this.stripHtml(Se.outerHTML))}}else{const Pe=this.map.getStyle().sources;Object.keys(Pe).forEach(ue=>{const Se=Pe[ue];if("attribution"in Se){const ze=Se.attribution;F.push(this.stripHtml(ze))}})}if(F.length===0)return!1;const U=F.join(" | "),O="attribution";s.addSource(O,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[a.lng,a.lat]},properties:{attribution:U}}});const $=this.map.getStyle().layers.filter(Pe=>Pe.type==="symbol"&&Pe.layout&&"text-font"in Pe.layout),V=$.length>0&&$[0].layout?$[0].layout["text-font"]:(u=this.attributionOptions.style)==null?void 0:u.fallbackTextFont;let ye=this.attributionOptions.visibility??"visible";s.getZoom()<2&&this.width>this.height&&(ye="none");const de=this.attributionOptions.style;return s.addLayer({id:O,source:O,type:"symbol",layout:{"text-field":["get","attribution"],"text-font":V,"text-max-width":parseInt(`${g/de.textSize}`),"text-anchor":y,"text-justify":["top-right","bottom-right"].includes(y)?"right":"left","text-size":de.textSize,"text-allow-overlap":!0,visibility:ye},paint:{"text-halo-color":de.textHaloColor,"text-halo-width":de.textHaloWidth,"text-color":de.textColor}}),!0}exportImage(s,u,f){var y;const _=s.getCanvas(),g=`${this.fileName}.${this.format}`;switch(this.format){case Ml.PNG:this.toPNG(_,g);break;case Ml.JPEG:this.toJPEG(_,g);break;case Ml.PDF:this.toPDF(s,g);break;case Ml.SVG:this.toSVG(_,g);break;default:console.error(`Invalid file format: ${this.format}`);break}s.remove(),(y=u.parentNode)==null||y.removeChild(u),Object.defineProperty(window,"devicePixelRatio",{get(){return f}}),u.remove(),this.hideLoader()}toPNG(s,u){const f=document.createElement("a");f.href=s.toDataURL(),f.download=u,f.click(),f.remove()}toJPEG(s,u){const f=s.toDataURL("image/jpeg",.85),y=document.createElement("a");y.href=f,y.download=u,y.click(),y.remove()}toPDF(s,u){const f=s.getCanvas(),y=new Li({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});y.addImage(f.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:_,lat:g}=s.getCenter();y.setProperties({title:s.getStyle().name,subject:`center: [${_}, ${g}], zoom: ${s.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),y.save(u)}toSVG(s,u){const f=s.toDataURL("image/png"),y=Number(this.toPixels(this.width,this.dpi).replace("px","")),_=Number(this.toPixels(this.height,this.dpi).replace("px","")),g=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${y}" 
      height="${_}" 
      viewBox="0 0 ${y} ${_}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${f}" width="${y}" height="${_}"></image>
    </svg>`,a=document.createElement("a");a.href=`data:application/xml,${encodeURIComponent(g)}`,a.download=u,a.click(),a.remove()}toPixels(s,u=96){return this.unit===_h.mm&&(u/=25.4),`${u*s}px`}addLoader(){var s;const u=(s=this.map.getCanvas().parentElement)==null?void 0:s.parentElement;if(!u||u.getElementsByClassName("map-export-loader").length>0)return;const f=document.createElement("span");f.classList.add("map-export-loader"),f.classList.add("loader-default"),u.appendChild(f)}showLoader(){var s,u;const f=(s=this.map.getCanvas().parentElement)==null?void 0:s.parentElement;if(!f)return;const y=f.getElementsByClassName("map-export-loader");y&&y.length>0&&((u=y.item(0))==null||u.classList.add("is-active"))}hideLoader(){var s,u;const f=(s=this.map.getCanvas().parentElement)==null?void 0:s.parentElement;if(!f)return;const y=f.getElementsByClassName("map-export-loader");y&&y.length>0&&((u=y.item(0))==null||u.classList.remove("is-active"))}}class c2 extends l2{constructor(s,u=hh.A4,f=300,y=Ml.PNG,_=_h.mm,g="map",a=Tp,C=Vu,F=Uu){super(s,u,f,y,_,g,"maplibregl-marker",a,"maplibregl-ctrl-attrib-inner",C,F)}getRenderedMap(s,u){const f=new gg.Map({container:s,style:u,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,preserveDrawingBuffer:!0,fadeDuration:0,transformRequest:this.map._requestManager._transformRequestFn});this.map.getTerrain()&&(f.setMaxPitch(85),f.setPitch(this.map.getPitch()));const y=(this.map.style.imageManager||{}).images||[];return Object.keys(y).forEach(_=>{y[_].data&&f.addImage(_,y[_].data)}),f}renderMapPost(s){const u=this.map.getTerrain();return u&&s.setTerrain({source:u.source,exaggeration:u.exaggeration}),s}}class h2{constructor(s){Ji(this,"controlContainer"),Ji(this,"exportContainer"),Ji(this,"crosshair"),Ji(this,"printableArea"),Ji(this,"map"),Ji(this,"exportButton"),Ji(this,"options",{PageSize:hh.A4,PageOrientation:Tu.Landscape,Format:Ml.PDF,DPI:Mm[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys(hh),Filename:"map",markerCirclePaint:Tp,attributionOptions:Vu,northIconOptions:Uu}),Ji(this,"MAPLIB_CSS_PREFIX","maplibregl"),s&&(s.attributionOptions=Object.assign(Vu,s.attributionOptions),s.northIconOptions=Object.assign(Uu,s.northIconOptions),this.options=Object.assign(this.options,s)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){const s=this.options.Local??"en";return hv(s)}onAdd(s){var u;this.map=s,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl`),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-group`),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-list`),this.exportButton=document.createElement("button"),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-icon`),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-control`),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const f=document.createElement("TABLE");f.className="print-table";const y={};(u=this.options.AllowedSizes)==null||u.forEach(U=>{hh[U]&&(y[U]=hh[U])});const _=this.createSelection(y,this.getTranslation().PageSize,"page-size",this.options.PageSize,(U,O)=>JSON.stringify(U[O]));f.appendChild(_);const g=this.createSelection(Tu,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(U,O)=>U[O]);f.appendChild(g);const a=this.createSelection(Ml,this.getTranslation().Format,"format-type",this.options.Format,(U,O)=>U[O]);f.appendChild(a);const C=this.createSelection(Mm,this.getTranslation().DPI,"dpi-type",this.options.DPI,(U,O)=>U[O]);f.appendChild(C),this.exportContainer.appendChild(f);const F=document.createElement("button");return F.type="button",F.textContent=this.getTranslation().Generate,F.classList.add("generate-button"),F.addEventListener("click",()=>{const U=document.getElementById("mapbox-gl-export-page-size"),O=document.getElementById("mapbox-gl-export-page-orientation"),$=document.getElementById("mapbox-gl-export-format-type"),V=document.getElementById("mapbox-gl-export-dpi-type"),ye=O.value;let de=JSON.parse(U.value);ye===Tu.Portrait&&(de=de.reverse()),this.generateMap(s,de,Number(V.value),$.value,_h.mm,this.options.Filename)}),this.exportContainer.appendChild(F),this.controlContainer}generateMap(s,u,f,y,_,g){new c2(s,u,f,y,_,g,this.options.markerCirclePaint,this.options.attributionOptions,this.options.northIconOptions).generate()}createSelection(s,u,f,y,_){const g=document.createElement("label");g.textContent=u;const a=document.createElement("select");a.setAttribute("id",`mapbox-gl-export-${f}`),a.style.width="100%",Object.keys(s).forEach(O=>{const $=document.createElement("option");$.setAttribute("value",_(s,O)),$.appendChild(document.createTextNode(O)),$.setAttribute("name",f),y===s[O]&&($.selected=!0),a.appendChild($)}),a.addEventListener("change",()=>{this.updatePrintableArea()});const C=document.createElement("TR"),F=document.createElement("TD"),U=document.createElement("TD");return F.appendChild(g),U.appendChild(a),C.appendChild(F),C.appendChild(U),C}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0),this.map=void 0)}onDocumentClick(s){this.controlContainer&&!this.controlContainer.contains(s.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(s){this.options.Crosshair===!0&&(s===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new X_(this.map),this.crosshair.create()))}togglePrintableArea(s){this.options.PrintableArea===!0&&(s===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new K_(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const s=document.getElementById("mapbox-gl-export-page-size"),u=document.getElementById("mapbox-gl-export-page-orientation").value;let f=JSON.parse(s.value);u===Tu.Portrait&&(f=f.reverse()),this.printableArea.updateArea(f[0],f[1])}}function Tn(d,s,u){return s in d?Object.defineProperty(d,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):d[s]=u,d}var rc={paints:"fill-antialias,fill-opacity,fill-color,fill-outline-color,fill-translate,fill-translate-anchor,fill-pattern,fill-extrusion-opacity,fill-extrusion-color,fill-extrusion-translate,fill-extrusion-translate-anchor,fill-extrusion-pattern,fill-extrusion-height,fill-extrusion-base,fill-extrusion-vertical-gradient,line-opacity,line-color,line-translate,line-translate-anchor,line-width,line-gap-width,line-offset,line-blur,line-dasharray,line-pattern,line-gradient,circle-radius,circle-color,circle-blur,circle-opacity,circle-translate,circle-translate-anchor,circle-pitch-scale,circle-pitch-alignment,circle-stroke-width,circle-stroke-color,circle-stroke-opacity,heatmap-radius,heatmap-weight,heatmap-intensity,heatmap-color,heatmap-opacity,icon-opacity,icon-color,icon-halo-color,icon-halo-width,icon-halo-blur,icon-translate,icon-translate-anchor,text-opacity,text-color,text-halo-color,text-halo-width,text-halo-blur,text-translate,text-translate-anchor,raster-opacity,raster-hue-rotate,raster-brightness-min,raster-brightness-max,raster-saturation,raster-contrast,raster-resampling,raster-fade-duration,hillshade-illumination-direction,hillshade-illumination-anchor,hillshade-exaggeration,hillshade-shadow-color,hillshade-highlight-color,hillshade-accent-color,background-color,background-pattern,background-opacity,sky-type,sky-atmosphere-sun,sky-atmosphere-sun-intensity,sky-gradient-center,sky-gradient-radius,sky-gradient,sky-atmosphere-halo-color,sky-atmosphere-color,sky-opacity".split(","),layouts:"visibility,fill-sort-key,circle-sort-key,line-cap,line-join,line-miter-limit,line-round-limit,line-sort-key,symbol-placement,symbol-spacing,symbol-avoid-edges,symbol-sort-key,symbol-z-order,icon-allow-overlap,icon-ignore-placement,icon-optional,icon-rotation-alignment,icon-size,icon-text-fit,icon-text-fit-padding,icon-image,icon-rotate,icon-padding,icon-keep-upright,icon-offset,icon-anchor,icon-pitch-alignment,text-pitch-alignment,text-rotation-alignment,text-field,text-font,text-size,text-max-width,text-line-height,text-letter-spacing,text-justify,text-radial-offset,text-variable-anchor,text-anchor,text-max-angle,text-writing-mode,text-rotate,text-padding,text-keep-upright,text-transform,text-offset,text-allow-overlap,text-ignore-placement,text-optional".split(",")};const Kd=d=>d.replace(/[A-Z]/g,s=>`-${s.toLowerCase()}`),mp=d=>d.replace(/(^|-)([a-z])/g,(s,u,f)=>`${f.toUpperCase()}`);function u2(d){return rc.paints.indexOf(d)>=0}function d2(d){return rc.layouts.indexOf(d)>=0}function p2(d){return rc.paints.indexOf(d)>=0?"paint":rc.layouts.indexOf(d)>=0?"layout":"other"}function f2(d){return String(d).match(/\.(geo)?json/)||d.type==="Feature"||d.type==="FeatureCollection"?{type:"geojson",data:d}:String(d).match(/^mapbox:\/\//)?{type:"vector",url:d}:d}const $u=(d,s)=>Array.isArray(d)?d:d instanceof RegExp?s.getStyle().layers.map(u=>u.id).filter(u=>u.match(d)):d instanceof Function?s.getStyle().layers.filter(u=>d(u)).map(u=>u.id):[d],Us=d=>function(s,...u){return $u(s,this.map).forEach(y=>d.call(this,y,...u))},Kh=d=>function(s,...u){const y=$u(s,this.map).map(_=>d.call(this,_,...u));return()=>y.forEach(_=>_())},Yg=["line","fill","circle","symbol","video","raster","fill-extrusion","heatmap","hillshade"];class Tc{constructor(){Tn(this,"_loaded",!1),Tn(this,"_mapgl",null),Tn(this,"map",null),Tn(this,"hoverFeatureState",Kh(function(s,u,f,y,_){if(Array.isArray(u)){let U=u.map(([O,$])=>this.hoverFeatureState(s,O,$));return()=>U.forEach(O=>O())}if(u===void 0){const U=this.getLayerStyle(s);u=U.source,f=U["source-layer"]}let g;const a=U=>{g&&this.map.setFeatureState({source:u,sourceLayer:f,id:g},{hover:U})},C=U=>{const O=U.features[0];O&&O.id===g||(a(!1),O&&(g&&_&&_({...U,oldFeatureId:g}),g=O.id,a(!0),y&&y(U)))},F=U=>{a(!1),U&&U.oldFeatureId&&(U.oldFeatureId=g),g=void 0,_&&_(U)};return this.map.on("mousemove",s,C),this.map.on("mouseleave",s,F),()=>{this.map.off("mousemove",s,C),this.map.off("mouseleave",s,F),F()}})),Tn(this,"clickLayer",Kh(function(s,u){const f=y=>{y.features=this.map.queryRenderedFeatures(y.point,{layers:[s]}),u(y)};return this.map.on("click",s,f),()=>this.map.off("click",s,f)})),Tn(this,"hoverLayer",Kh(function(s,u){const f=y=>{y.features=this.map.queryRenderedFeatures(y.point,{layers:[s]}),u(y)};return this.map.on("click",s,f),()=>this.map.off("click",s,f)})),Tn(this,"removeLayer",Us(function(s){const u=f=>{f.error.message.match(/does not exist/)||console.error(f.error)};this.map.once("error",u),this.map.removeLayer(s),this.map.off("error",u)})),Tn(this,"setProperty",Us(function(s,u,f){if(typeof u=="object")Object.keys(u).forEach(y=>this.setProperty(s,y,u[y]));else{const y=Kd(u);u2(y)?this.map.setPaintProperty(s,y,f):d2(y)&&this.map.setLayoutProperty(s,y,f)}})),Tn(this,"setLayerStyle",Us(function(s,u){const f=(g={},a={})=>Object.keys(g).forEach(C=>{C in a||this.setProperty(s,C,void 0)});typeof s=="object"&&!Array.isArray(s)&&s.id&&!u&&(u=s,s=u.id);const y=this.getLayerStyle(s),_=this.properties(u);f(y.paint,_.paint),f(y.layout,_.layout),this.setProperty(s,{..._.paint,..._.layout})})),Tn(this,"show",Us(function(s){this.setVisibility(s,"visible")})),Tn(this,"hide",Us(function(s){this.setVisibility(s,"none")})),Tn(this,"toggle",Us(function(s,u){this.setVisibility(s,u?"visible":"none")})),Tn(this,"showSource",Us(function(s){this.setVisibility(this.layersBySource(s),"visible")})),Tn(this,"hideSource",Us(function(s){this.setVisibility(this.layersBySource(s),"none")})),Tn(this,"toggleSource",Us(function(s,u){this.setVisibility(this.layersBySource(s),u?"visible":"none")})),Tn(this,"setFilter",Us(function(s,u){this.map.setFilter(s,u)})),Tn(this,"removeSource",Us(function(s){const u=this.layersBySource(s);this.removeLayer(u),this.map.getSource(s)&&this.map.removeSource(s)})),Tn(this,"setLayerSource",Us(function(s,u,f){const y=this.map.getStyle().layers,_=y.findIndex(C=>C.id===s),g=y[_],a=y[_+1]&&y[_+1].id;g.source=u,f?g["source-layer"]=f:f!==void 0&&delete g["source-layer"],this.map.removeLayer(s),this._mapAddLayerBefore(g,a)}))}static init(s,u){return s.U=new Tc,s.U._mapgl=u,s.U.map=s,s.U}static async newMap(s,u={},f={}){function y(F,U=[]){F.layers=[...F.layers,...U.map(O=>this.layerStyle(O))]}function _(F,U={}){F.sources={...F.sources,...U}}function g(F,U=O=>O){F=U(F)}function a(F,U={}){Object.keys(U).forEach(O=>{const $=U[O].layers;delete U[O].layers,F.sources[O]=U[O],F.layers=[...F.layers,...$.map(V=>this.layerStyle({source:O,...V}))]})}if(u.style||(u.style={version:8,layers:[],sources:{}}),f.addLayers||f.addSources||f.transformStyle||f.mixStyles){let F=u.style,U;if(typeof F=="string"){const $=F.replace(/^mapbox:\/\/styles\//,"https://api.mapbox.com/styles/v1/");U=await(await fetch($)).json()}else U=F;const O=new Tc;y.call(O,U,f.addLayers),_(U,f.addSources),g(U,f.transformStyle),a.call(O,U,f.mixStyles),u.style=U}const C=new s.Map(u);return Tc.init(C,s),C}hoverPointer(s){const u=$u(s,this.map),f=g=>this.map.getCanvas().style.cursor="pointer",y=g=>{this.map.queryRenderedFeatures(g.point,{layers:u}).length===0&&(this.map.getCanvas().style.cursor=_)},_=this.map.getCanvas().style.cursor;for(const g of u)this.map.on("mouseleave",g,y),this.map.on("mouseenter",g,f);return()=>{for(const g of u)this.map.off("mouseenter",g,f),this.map.off("mouseleave",g,y);this.map.getCanvas().style.cursor=_}}hoverPopup(s,u,f={}){if(!this._mapgl)throw"Mapbox GL JS or MapLibre GL JS object required when initialising";const y=new this._mapgl.Popup({closeButton:!1,...f});return Kh(function(_,g){const a=F=>{F.features[0]&&(y.setLngLat(F.lngLat),y.setHTML(g(F.features[0],y)),y.addTo(this.map))},C=F=>{y.remove()};return this.map.on("mouseenter",_,a),this.map.on("mouseout",_,C),()=>{this.map.off("mouseenter",_,a),this.map.off("mouseout",_,C),C()}}).call(this,s,u)}clickPopup(s,u,f={}){if(!this._mapgl)throw"Mapbox GL JS or Maplibre GL JS object required when initialising";const y=new this._mapgl.Popup({...f});return Kh(function(_,g){const a=C=>{C.features[0]&&(y.setLngLat(C.features[0].geometry.coordinates.slice()),y.setHTML(g(C.features[0],y)),y.addTo(this.map))};return this.map.on("click",_,a),()=>this.map.off("click",_,a)}).call(this,s,u)}clickOneLayer(s,u,f){const y=$u(s,this.map),_=g=>{let a=!1;for(const C of y){const F=this.map.queryRenderedFeatures(g.point,{layers:[C]});if(F[0])try{u({event:g,layer:C,feature:F[0],features:F})}finally{a=!0;break}}!a&&f&&f(g)};return this.map.on("click",_),()=>this.map.off("click",_)}_mapAddLayerBefore(s,u){u?this.map.addLayer(s,u):this.map.addLayer(s)}addLayer(s,u,f,y,_){return this._mapAddLayerBefore(this.layerStyle(s,u,f,y),_),this._makeSource(u)}add(s,u,f,y,_){if(this._mapAddLayerBefore({...this.properties(y),id:s,type:f,source:f2(u)},_),typeof u=="string")return this._makeSource(u)}setLayer(s,u,f,y,_){const g=this.layerStyle(s,u,f,y),a=this.map.getStyle(),C=a.layers.findIndex(F=>F.id===g.id);if(a.layers.findIndex(F=>F.id===_),C>=0){this.map.removeLayer(g.id);let F=_;!_&&a.layers[C+1]&&(F=a.layers[C+1].id),this.map.addLayer(g,F)}else this.map.addLayer(g,_||void 0);return this._makeSource(u)}addLineLayer(s,u,f){}addFillLayer(s,u,f){}addCircleLayer(s,u,f){}addSymbolLayer(s,u,f){}addVideoLayer(s,u,f){}addRasterLayer(s,u,f){}addFillExtrusionLayer(s,u,f){}addHeatmapLayer(s,u,f){}addHillshadeLayer(s,u,f){}addGeoJSONSource(s,u={type:"FeatureCollection",features:[]},f){return this.addSource(s,{type:"geojson",data:u,...f})}addGeoJSON(s,u={type:"FeatureCollection",features:[]},f){return this.addGeoJSONSource(s,u,f)}addSource(s,u){const f=this.map.getStyle();return f.sources[s]=u,this.map.setStyle(f),this._makeSource(s)}layersBySource(s){return this.map.getStyle().layers.filter(u=>u.source===s).map(u=>u.id)}addVectorSource(s,u,f={}){return typeof u=="string"?u.match(/\{z\}/)?this.addSource(s,{...f,type:"vector",tiles:[u]}):this.addSource(s,{...f,type:"vector",url:u}):this.addSource(s,{...u,type:"vector"})}addVector(s,u,f={}){return this.addVectorSource(s,u,f)}addRasterSource(s,u){return this.addSource(s,{...u,type:"raster"})}addRasterDemSource(s,u){return this.addSource(s,{...u,type:"raster-dem"})}addRasterSource(s,u){return this.addSource(s,{...u,type:"raster"})}addImageSource(s,u){return this.addSource(s,{...u,type:"image"})}addVideoSource(s,u){return this.addSource(s,{...u,type:"video"})}properties(s){if(!s)return;const u={},f={paint:{},layout:{},other:{}};return Object.keys(s).forEach(y=>{const _=Kd(y);f[p2(_)][_]=s[y]}),Object.keys(f.paint).length&&(u.paint=f.paint),Object.keys(f.layout).length&&(u.layout=f.layout),Object.assign(u,f.other),u}layerStyle(...s){const[u,f,y]=s,_=s.find(a=>typeof a=="object"&&!Array.isArray(a)),g=typeof _=="object"?this.properties(_)||{}:{};return typeof u=="string"&&(g.id=u),typeof f=="string"&&(g.source=f),typeof y=="string"&&(g.type=y),g}getLayerStyle(s){return this.map.getStyle().layers.find(u=>u.id===s)}setData(s,u={type:"FeatureCollection",features:[]}){this.map.getSource(s).setData(u)}onLoad(s){if(s)this.map.loaded()||this._loaded?s():this.map.once("load",()=>{this._loaded=!0,s()});else return new Promise(u=>this.onLoad(u))}setRootProperty(s,u){const f=this.map.getStyle();f[Kd(s)]=u,this.map.setStyle(f)}setTransition(s){this.setRootProperty("transition",s)}loadImage(s,u,f){return typeof u=="string"?new Promise((y,_)=>{this.map.loadImage(u,(g,a)=>{g?(console.error(`Error loading image ${u}`,g),_(`Error loading image ${u}`)):(this.map.addImage(s,a,f),y(s))})}):this.map.addImage(s,u,f)}lockOrientation(){this.map.touchZoomRotate.disableRotation(),this.map.dragRotate.disable()}fontsInUse(){function s(y){Array.isArray(y)&&(y[0]==="literal"?u.push(...y[1]):y.forEach(s))}let u=[];const f=this.map.getStyle().layers.map(y=>y.layout&&y.layout["text-font"]).filter(Boolean);for(const y of f)if(y.stops)try{u.push(...y.stops.flat().filter(Array.isArray).flat())}catch{console.log("Couldn't process font expression:",y)}else y.every(_=>typeof _=="string")?u.push(...y):s(y);return[...new Set(u)]}_makeSource(s){const u=new Tc;return u.map=this.map,u._mapgl=this._mapgl,Yg.forEach(function(f){Jg(f,u,s)}),u}}const Jg=(d,s,u)=>{let f;u?f=function(_,g,a){return this.setLayer(_,u,d,g,a)}:f=function(_,g,a,C){return this.setLayer(_,g,d,a,C)};const y=mp(d);s[`add${y}`]=f,s[`add${y}Layer`]=f};function m2(d){const s=(f,y)=>{const _="set"+mp(f);d[_]=Us(function(g,a){return this.map[y](g,f,a)})},u=(f,y)=>{const _="get"+mp(f);d[_]=Us(function(g){return this.map[y](g,f)})};d.update=d.setData,rc.paints.forEach(f=>s(f,"setPaintProperty")),rc.layouts.forEach(f=>s(f,"setLayoutProperty")),rc.paints.forEach(f=>u(f,"getPaintProperty")),rc.layouts.forEach(f=>u(f,"getLayoutProperty")),Yg.forEach(f=>Jg(f,d))}const g2=Tc.prototype;m2(g2);var fa=Uint8Array,dh=Uint16Array,y2=Int32Array,Qg=new fa([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e0=new fa([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),_2=new fa([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t0=function(d,s){for(var u=new dh(31),f=0;f<31;++f)u[f]=s+=1<<d[f-1];for(var y=new y2(u[30]),f=1;f<30;++f)for(var _=u[f];_<u[f+1];++_)y[_]=_-u[f]<<5|f;return{b:u,r:y}},i0=t0(Qg,2),r0=i0.b,v2=i0.r;r0[28]=258,v2[258]=28;var b2=t0(e0,0),x2=b2.b,gp=new dh(32768);for(var Mr=0;Mr<32768;++Mr){var tc=(Mr&43690)>>1|(Mr&21845)<<1;tc=(tc&52428)>>2|(tc&13107)<<2,tc=(tc&61680)>>4|(tc&3855)<<4,gp[Mr]=((tc&65280)>>8|(tc&255)<<8)>>1}var Qh=function(d,s,u){for(var f=d.length,y=0,_=new dh(s);y<f;++y)d[y]&&++_[d[y]-1];var g=new dh(s);for(y=1;y<s;++y)g[y]=g[y-1]+_[y-1]<<1;var a;if(u){a=new dh(1<<s);var C=15-s;for(y=0;y<f;++y)if(d[y])for(var F=y<<4|d[y],U=s-d[y],O=g[d[y]-1]++<<U,$=O|(1<<U)-1;O<=$;++O)a[gp[O]>>C]=F}else for(a=new dh(f),y=0;y<f;++y)d[y]&&(a[y]=gp[g[d[y]-1]++]>>15-d[y]);return a},su=new fa(288);for(var Mr=0;Mr<144;++Mr)su[Mr]=8;for(var Mr=144;Mr<256;++Mr)su[Mr]=9;for(var Mr=256;Mr<280;++Mr)su[Mr]=7;for(var Mr=280;Mr<288;++Mr)su[Mr]=8;var n0=new fa(32);for(var Mr=0;Mr<32;++Mr)n0[Mr]=5;var w2=Qh(su,9,1),S2=Qh(n0,5,1),Yd=function(d){for(var s=d[0],u=1;u<d.length;++u)d[u]>s&&(s=d[u]);return s},co=function(d,s,u){var f=s/8|0;return(d[f]|d[f+1]<<8)>>(s&7)&u},Jd=function(d,s){var u=s/8|0;return(d[u]|d[u+1]<<8|d[u+2]<<16)>>(s&7)},A2=function(d){return(d+7)/8|0},I2=function(d,s,u){return(u==null||u>d.length)&&(u=d.length),new fa(d.subarray(s,u))},P2=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],pa=function(d,s,u){var f=new Error(s||P2[d]);if(f.code=d,Error.captureStackTrace&&Error.captureStackTrace(f,pa),!u)throw f;return f},Cp=function(d,s,u,f){var y=d.length,_=0;if(!y||s.f&&!s.l)return u||new fa(0);var g=!u,a=g||s.i!=2,C=s.i;g&&(u=new fa(y*3));var F=function(kt){var Nt=u.length;if(kt>Nt){var zt=new fa(Math.max(Nt*2,kt));zt.set(u),u=zt}},U=s.f||0,O=s.p||0,$=s.b||0,V=s.l,ye=s.d,de=s.m,Pe=s.n,ue=y*8;do{if(!V){U=co(d,O,1);var Se=co(d,O+1,3);if(O+=3,Se)if(Se==1)V=w2,ye=S2,de=9,Pe=5;else if(Se==2){var ct=co(d,O,31)+257,Ge=co(d,O+10,15)+4,De=ct+co(d,O+5,31)+1;O+=14;for(var Qe=new fa(De),pt=new fa(19),pe=0;pe<Ge;++pe)pt[_2[pe]]=co(d,O+pe*3,7);O+=Ge*3;for(var me=Yd(pt),Ne=(1<<me)-1,Le=Qh(pt,me,1),pe=0;pe<De;){var et=Le[co(d,O,Ne)];O+=et&15;var ze=et>>4;if(ze<16)Qe[pe++]=ze;else{var it=0,nt=0;for(ze==16?(nt=3+co(d,O,3),O+=2,it=Qe[pe-1]):ze==17?(nt=3+co(d,O,7),O+=3):ze==18&&(nt=11+co(d,O,127),O+=7);nt--;)Qe[pe++]=it}}var Xe=Qe.subarray(0,ct),at=Qe.subarray(ct);de=Yd(Xe),Pe=Yd(at),V=Qh(Xe,de,1),ye=Qh(at,Pe,1)}else pa(1);else{var ze=A2(O)+4,Ye=d[ze-4]|d[ze-3]<<8,Je=ze+Ye;if(Je>y){C&&pa(0);break}a&&F($+Ye),u.set(d.subarray(ze,Je),$),s.b=$+=Ye,s.p=O=Je*8,s.f=U;continue}if(O>ue){C&&pa(0);break}}a&&F($+131072);for(var dt=(1<<de)-1,Mt=(1<<Pe)-1,ie=O;;ie=O){var it=V[Jd(d,O)&dt],xe=it>>4;if(O+=it&15,O>ue){C&&pa(0);break}if(it||pa(2),xe<256)u[$++]=xe;else if(xe==256){ie=O,V=null;break}else{var ke=xe-254;if(xe>264){var pe=xe-257,Fe=Qg[pe];ke=co(d,O,(1<<Fe)-1)+r0[pe],O+=Fe}var qe=ye[Jd(d,O)&Mt],$e=qe>>4;qe||pa(3),O+=qe&15;var at=x2[$e];if($e>3){var Fe=e0[$e];at+=Jd(d,O)&(1<<Fe)-1,O+=Fe}if(O>ue){C&&pa(0);break}a&&F($+131072);var Ke=$+ke;if($<at){var tt=_-at,Tt=Math.min(at,Ke);for(tt+$<0&&pa(3);$<Tt;++$)u[$]=f[tt+$]}for(;$<Ke;++$)u[$]=u[$-at]}}s.l=V,s.p=ie,s.b=$,s.f=U,V&&(U=1,s.m=de,s.d=ye,s.n=Pe)}while(!U);return $!=u.length&&g?I2(u,0,$):u.subarray(0,$)},L2=new fa(0),k2=function(d){(d[0]!=31||d[1]!=139||d[2]!=8)&&pa(6,"invalid gzip data");var s=d[3],u=10;s&4&&(u+=(d[10]|d[11]<<8)+2);for(var f=(s>>3&1)+(s>>4&1);f>0;f-=!d[u++]);return u+(s&2)},T2=function(d){var s=d.length;return(d[s-4]|d[s-3]<<8|d[s-2]<<16|d[s-1]<<24)>>>0},C2=function(d,s){return((d[0]&15)!=8||d[0]>>4>7||(d[0]<<8|d[1])%31)&&pa(6,"invalid zlib data"),(d[1]>>5&1)==+!s&&pa(6,"invalid zlib data: "+(d[1]&32?"need":"unexpected")+" dictionary"),(d[1]>>3&4)+2};function E2(d,s){return Cp(d,{i:2},s,s)}function M2(d,s){var u=k2(d);return u+8>d.length&&pa(6,"invalid gzip data"),Cp(d.subarray(u,-8),{i:2},new fa(T2(d)),s)}function z2(d,s){return Cp(d.subarray(C2(d,s),-4),{i:2},s,s)}function N2(d,s){return d[0]==31&&d[1]==139&&d[2]==8?M2(d,s):(d[0]&15)!=8||d[0]>>4>7||(d[0]<<8|d[1])%31?E2(d,s):z2(d,s)}var D2=typeof TextDecoder<"u"&&new TextDecoder,F2=0;try{D2.decode(L2,{stream:!0}),F2=1}catch{}var R2=Object.defineProperty,eu=Math.pow,yr=(d,s)=>R2(d,"name",{value:s,configurable:!0}),En=(d,s,u)=>new Promise((f,y)=>{var _=C=>{try{a(u.next(C))}catch(F){y(F)}},g=C=>{try{a(u.throw(C))}catch(F){y(F)}},a=C=>C.done?f(C.value):Promise.resolve(C.value).then(_,g);a((u=u.apply(d,s)).next())});yr((d,s)=>{let u=!1,f="",y=L.GridLayer.extend({createTile:yr((_,g)=>{let a=document.createElement("img"),C=new AbortController,F=C.signal;return a.cancel=()=>{C.abort()},u||(d.getHeader().then(U=>{U.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):U.tileType===2?f="image/png":U.tileType===3?f="image/jpeg":U.tileType===4?f="image/webp":U.tileType===5&&(f="image/avif")}),u=!0),d.getZxy(_.z,_.x,_.y,F).then(U=>{if(U){let O=new Blob([U.data],{type:f}),$=window.URL.createObjectURL(O);a.src=$,a.cancel=void 0,g(void 0,a)}}).catch(U=>{if(U.name!=="AbortError")throw U}),a},"createTile"),_removeTile:yr(function(_){let g=this._tiles[_];g&&(g.el.cancel&&g.el.cancel(),g.el.width=0,g.el.height=0,g.el.deleted=!0,L.DomUtil.remove(g.el),delete this._tiles[_],this.fire("tileunload",{tile:g.el,coords:this._keyToTileCoords(_)}))},"_removeTile")});return new y(s)},"leafletRasterLayer");var O2=yr(d=>(s,u)=>{if(u instanceof AbortController)return d(s,u);let f=new AbortController;return d(s,f).then(y=>u(void 0,y.data,y.cacheControl||"",y.expires||""),y=>u(y)).catch(y=>u(y)),{cancel:yr(()=>f.abort(),"cancel")}},"v3compat"),s0=class{constructor(s){this.tilev4=yr((u,f)=>En(this,null,function*(){if(u.type==="json"){let V=u.url.substr(10),ye=this.tiles.get(V);if(ye||(ye=new eg(V),this.tiles.set(V,ye)),this.metadata)return{data:yield ye.getTileJson(u.url)};let de=yield ye.getHeader();return{data:{tiles:[`${u.url}/{z}/{x}/{y}`],minzoom:de.minZoom,maxzoom:de.maxZoom,bounds:[de.minLon,de.minLat,de.maxLon,de.maxLat]}}}let y=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),_=u.url.match(y);if(!_)throw new Error("Invalid PMTiles protocol URL");let g=_[1],a=this.tiles.get(g);a||(a=new eg(g),this.tiles.set(g,a));let C=_[2],F=_[3],U=_[4],O=yield a.getHeader(),$=yield a==null?void 0:a.getZxy(+C,+F,+U,f.signal);return $?{data:new Uint8Array($.data),cacheControl:$.cacheControl,expires:$.expires}:O.tileType===1?{data:new Uint8Array}:{data:null}}),"tilev4"),this.tile=O2(this.tilev4),this.tiles=new Map,this.metadata=(s==null?void 0:s.metadata)||!1}add(s){this.tiles.set(s.source.getKey(),s)}get(s){return this.tiles.get(s)}};yr(s0,"Protocol");var B2=s0;function a0(d,s){return(s>>>0)*4294967296+(d>>>0)}yr(a0,"toNum");function o0(d,s){let u=s.buf,f=u[s.pos++],y=(f&112)>>4;if(f<128||(f=u[s.pos++],y|=(f&127)<<3,f<128)||(f=u[s.pos++],y|=(f&127)<<10,f<128)||(f=u[s.pos++],y|=(f&127)<<17,f<128)||(f=u[s.pos++],y|=(f&127)<<24,f<128)||(f=u[s.pos++],y|=(f&1)<<31,f<128))return a0(d,y);throw new Error("Expected varint not more than 10 bytes")}yr(o0,"readVarintRemainder");function ch(d){let s=d.buf,u=s[d.pos++],f=u&127;return u<128||(u=s[d.pos++],f|=(u&127)<<7,u<128)||(u=s[d.pos++],f|=(u&127)<<14,u<128)||(u=s[d.pos++],f|=(u&127)<<21,u<128)?f:(u=s[d.pos],f|=(u&15)<<28,o0(f,d))}yr(ch,"readVarint");function Ep(d,s,u,f){if(f===0){u===1&&(s[0]=d-1-s[0],s[1]=d-1-s[1]);let y=s[0];s[0]=s[1],s[1]=y}}yr(Ep,"rotate");function l0(d,s){let u=eu(2,d),f=s,y=s,_=s,g=[0,0],a=1;for(;a<u;)f=1&_/2,y=1&(_^f),Ep(a,g,f,y),g[0]+=a*f,g[1]+=a*y,_=_/4,a*=2;return[d,g[0],g[1]]}yr(l0,"idOnLevel");var j2=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function c0(d,s,u){if(d>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(s>eu(2,d)-1||u>eu(2,d)-1)throw Error("tile x/y outside zoom level bounds");let f=j2[d],y=eu(2,d),_=0,g=0,a=0,C=[s,u],F=y/2;for(;F>0;)_=(C[0]&F)>0?1:0,g=(C[1]&F)>0?1:0,a+=F*F*(3*_^g),Ep(F,C,_,g),F=F/2;return f+a}yr(c0,"zxyToTileId");function q2(d){let s=0;for(let u=0;u<27;u++){let f=(1<<u)*(1<<u);if(s+f>d)return l0(u,d-s);s+=f}throw Error("Tile zoom level exceeds max safe number limit (26)")}yr(q2,"tileIdToZxy");var V2=(d=>(d[d.Unknown=0]="Unknown",d[d.None=1]="None",d[d.Gzip=2]="Gzip",d[d.Brotli=3]="Brotli",d[d.Zstd=4]="Zstd",d))(V2||{});function Qu(d,s){return En(this,null,function*(){if(s===1||s===0)return d;if(s===2){if(typeof globalThis.DecompressionStream>"u")return N2(new Uint8Array(d));let u=new Response(d).body;if(!u)throw Error("Failed to read response stream");let f=u.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(f).arrayBuffer()}throw Error("Compression method not supported")})}yr(Qu,"defaultDecompress");var U2=(d=>(d[d.Unknown=0]="Unknown",d[d.Mvt=1]="Mvt",d[d.Png=2]="Png",d[d.Jpeg=3]="Jpeg",d[d.Webp=4]="Webp",d[d.Avif=5]="Avif",d))(U2||{});function h0(d){return d===1?".mvt":d===2?".png":d===3?".jpg":d===4?".webp":d===5?".avif":""}yr(h0,"tileTypeExt");var $2=127;function u0(d,s){let u=0,f=d.length-1;for(;u<=f;){let y=f+u>>1,_=s-d[y].tileId;if(_>0)u=y+1;else if(_<0)f=y-1;else return d[y]}return f>=0&&(d[f].runLength===0||s-d[f].tileId<d[f].runLength)?d[f]:null}yr(u0,"findTile");var Z2=class{constructor(s){this.file=s}getKey(){return this.file.name}getBytes(s,u){return En(this,null,function*(){return{data:yield this.file.slice(s,s+u).arrayBuffer()}})}};yr(Z2,"FileSource");var d0=class{constructor(s,u=new Headers){this.url=s,this.customHeaders=u,this.mustReload=!1;let f="";"navigator"in globalThis&&(f=globalThis.navigator.userAgent||"");let y=f.indexOf("Windows")>-1,_=/Chrome|Chromium|Edg|OPR|Brave/.test(f);this.chromeWindowsNoCache=!1,y&&_&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(s){this.customHeaders=s}getBytes(s,u,f,y){return En(this,null,function*(){let _,g;f?g=f:(_=new AbortController,g=_.signal);let a=new Headers(this.customHeaders);a.set("range",`bytes=${s}-${s+u-1}`);let C;this.mustReload?C="reload":this.chromeWindowsNoCache&&(C="no-store");let F=yield fetch(this.url,{signal:g,cache:C,headers:a});if(s===0&&F.status===416){let $=F.headers.get("Content-Range");if(!$||!$.startsWith("bytes */"))throw Error("Missing content-length on 416 response");let V=+$.substr(8);F=yield fetch(this.url,{signal:g,cache:"reload",headers:{range:`bytes=0-${V-1}`}})}let U=F.headers.get("Etag");if(U!=null&&U.startsWith("W/")&&(U=null),F.status===416||y&&U&&U!==y)throw this.mustReload=!0,new yp(`Server returned non-matching ETag ${y} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(F.status>=300)throw Error(`Bad response code: ${F.status}`);let O=F.headers.get("Content-Length");if(F.status===200&&(!O||+O>u))throw _&&_.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield F.arrayBuffer(),etag:U||void 0,cacheControl:F.headers.get("Cache-Control")||void 0,expires:F.headers.get("Expires")||void 0}})}};yr(d0,"FetchSource");var G2=d0;function Ba(d,s){let u=d.getUint32(s+4,!0),f=d.getUint32(s+0,!0);return u*eu(2,32)+f}yr(Ba,"getUint64");function p0(d,s){let u=new DataView(d),f=u.getUint8(7);if(f>3)throw Error(`Archive is spec version ${f} but this library supports up to spec version 3`);return{specVersion:f,rootDirectoryOffset:Ba(u,8),rootDirectoryLength:Ba(u,16),jsonMetadataOffset:Ba(u,24),jsonMetadataLength:Ba(u,32),leafDirectoryOffset:Ba(u,40),leafDirectoryLength:Ba(u,48),tileDataOffset:Ba(u,56),tileDataLength:Ba(u,64),numAddressedTiles:Ba(u,72),numTileEntries:Ba(u,80),numTileContents:Ba(u,88),clustered:u.getUint8(96)===1,internalCompression:u.getUint8(97),tileCompression:u.getUint8(98),tileType:u.getUint8(99),minZoom:u.getUint8(100),maxZoom:u.getUint8(101),minLon:u.getInt32(102,!0)/1e7,minLat:u.getInt32(106,!0)/1e7,maxLon:u.getInt32(110,!0)/1e7,maxLat:u.getInt32(114,!0)/1e7,centerZoom:u.getUint8(118),centerLon:u.getInt32(119,!0)/1e7,centerLat:u.getInt32(123,!0)/1e7,etag:s}}yr(p0,"bytesToHeader");function Mp(d){let s={buf:new Uint8Array(d),pos:0},u=ch(s),f=[],y=0;for(let _=0;_<u;_++){let g=ch(s);f.push({tileId:y+g,offset:0,length:0,runLength:1}),y+=g}for(let _=0;_<u;_++)f[_].runLength=ch(s);for(let _=0;_<u;_++)f[_].length=ch(s);for(let _=0;_<u;_++){let g=ch(s);g===0&&_>0?f[_].offset=f[_-1].offset+f[_-1].length:f[_].offset=g-1}return f}yr(Mp,"deserializeIndex");var f0=class extends Error{};yr(f0,"EtagMismatch");var yp=f0;function zp(d,s){return En(this,null,function*(){let u=yield d.getBytes(0,16384);if(new DataView(u.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let f=u.data.slice(0,$2),y=p0(f,u.etag),_=u.data.slice(y.rootDirectoryOffset,y.rootDirectoryOffset+y.rootDirectoryLength),g=`${d.getKey()}|${y.etag||""}|${y.rootDirectoryOffset}|${y.rootDirectoryLength}`,a=Mp(yield s(_,y.internalCompression));return[y,[g,a.length,a]]})}yr(zp,"getHeaderAndRoot");function Np(d,s,u,f,y){return En(this,null,function*(){let _=yield d.getBytes(u,f,void 0,y.etag),g=yield s(_.data,y.internalCompression),a=Mp(g);if(a.length===0)throw new Error("Empty directory is invalid");return a})}yr(Np,"getDirectory");var W2=class{constructor(s=100,u=!0,f=Qu){this.cache=new Map,this.maxCacheEntries=s,this.counter=1,this.decompress=f}getHeader(s){return En(this,null,function*(){let u=s.getKey(),f=this.cache.get(u);if(f)return f.lastUsed=this.counter++,f.data;let y=yield zp(s,this.decompress);return y[1]&&this.cache.set(y[1][0],{lastUsed:this.counter++,data:y[1][2]}),this.cache.set(u,{lastUsed:this.counter++,data:y[0]}),this.prune(),y[0]})}getDirectory(s,u,f,y){return En(this,null,function*(){let _=`${s.getKey()}|${y.etag||""}|${u}|${f}`,g=this.cache.get(_);if(g)return g.lastUsed=this.counter++,g.data;let a=yield Np(s,this.decompress,u,f,y);return this.cache.set(_,{lastUsed:this.counter++,data:a}),this.prune(),a})}prune(){if(this.cache.size>this.maxCacheEntries){let s=1/0,u;this.cache.forEach((f,y)=>{f.lastUsed<s&&(s=f.lastUsed,u=y)}),u&&this.cache.delete(u)}}invalidate(s){return En(this,null,function*(){this.cache.delete(s.getKey())})}};yr(W2,"ResolvedValueCache");var m0=class{constructor(s=100,u=!0,f=Qu){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=s,this.counter=1,this.decompress=f}getHeader(s){return En(this,null,function*(){let u=s.getKey(),f=this.cache.get(u);if(f)return f.lastUsed=this.counter++,yield f.data;let y=new Promise((_,g)=>{zp(s,this.decompress).then(a=>{a[1]&&this.cache.set(a[1][0],{lastUsed:this.counter++,data:Promise.resolve(a[1][2])}),_(a[0]),this.prune()}).catch(a=>{g(a)})});return this.cache.set(u,{lastUsed:this.counter++,data:y}),y})}getDirectory(s,u,f,y){return En(this,null,function*(){let _=`${s.getKey()}|${y.etag||""}|${u}|${f}`,g=this.cache.get(_);if(g)return g.lastUsed=this.counter++,yield g.data;let a=new Promise((C,F)=>{Np(s,this.decompress,u,f,y).then(U=>{C(U),this.prune()}).catch(U=>{F(U)})});return this.cache.set(_,{lastUsed:this.counter++,data:a}),a})}prune(){if(this.cache.size>=this.maxCacheEntries){let s=1/0,u;this.cache.forEach((f,y)=>{f.lastUsed<s&&(s=f.lastUsed,u=y)}),u&&this.cache.delete(u)}}invalidate(s){return En(this,null,function*(){let u=s.getKey();if(this.invalidations.get(u))return yield this.invalidations.get(u);this.cache.delete(s.getKey());let f=new Promise((y,_)=>{this.getHeader(s).then(g=>{y(),this.invalidations.delete(u)}).catch(g=>{_(g)})});this.invalidations.set(u,f)})}};yr(m0,"SharedPromiseCache");var H2=m0,g0=class{constructor(s,u,f){typeof s=="string"?this.source=new G2(s):this.source=s,f?this.decompress=f:this.decompress=Qu,u?this.cache=u:this.cache=new H2}getHeader(){return En(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(s,u,f,y){return En(this,null,function*(){let _=c0(s,u,f),g=yield this.cache.getHeader(this.source);if(s<g.minZoom||s>g.maxZoom)return;let a=g.rootDirectoryOffset,C=g.rootDirectoryLength;for(let F=0;F<=3;F++){let U=yield this.cache.getDirectory(this.source,a,C,g),O=u0(U,_);if(O){if(O.runLength>0){let $=yield this.source.getBytes(g.tileDataOffset+O.offset,O.length,y,g.etag);return{data:yield this.decompress($.data,g.tileCompression),cacheControl:$.cacheControl,expires:$.expires}}a=g.leafDirectoryOffset+O.offset,C=O.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(s,u,f,y){return En(this,null,function*(){try{return yield this.getZxyAttempt(s,u,f,y)}catch(_){if(_ instanceof yp)return this.cache.invalidate(this.source),yield this.getZxyAttempt(s,u,f,y);throw _}})}getMetadataAttempt(){return En(this,null,function*(){let s=yield this.cache.getHeader(this.source),u=yield this.source.getBytes(s.jsonMetadataOffset,s.jsonMetadataLength,void 0,s.etag),f=yield this.decompress(u.data,s.internalCompression),y=new TextDecoder("utf-8");return JSON.parse(y.decode(f))})}getMetadata(){return En(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(s){if(s instanceof yp)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw s}})}getTileJson(s){return En(this,null,function*(){let u=yield this.getHeader(),f=yield this.getMetadata(),y=h0(u.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${s}/{z}/{x}/{y}${y}`],vector_layers:f.vector_layers,attribution:f.attribution,description:f.description,name:f.name,version:f.version,bounds:[u.minLon,u.minLat,u.maxLon,u.maxLat],center:[u.centerLon,u.centerLat,u.centerZoom],minzoom:u.minZoom,maxzoom:u.maxZoom}})}};yr(g0,"PMTiles");var eg=g0,y0="1.13.7",tg=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global||Function("return this")()||{},ed=Array.prototype,Dp=Object.prototype,ig=typeof Symbol<"u"?Symbol.prototype:null,X2=ed.push,au=ed.slice,iu=Dp.toString,K2=Dp.hasOwnProperty,_0=typeof ArrayBuffer<"u",Y2=typeof DataView<"u",J2=Array.isArray,rg=Object.keys,ng=Object.create,sg=_0&&ArrayBuffer.isView,Q2=isNaN,eb=isFinite,v0=!{toString:null}.propertyIsEnumerable("toString"),ag=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],tb=Math.pow(2,53)-1;function $s(d,s){return s=s==null?d.length-1:+s,function(){for(var u=Math.max(arguments.length-s,0),f=Array(u),y=0;y<u;y++)f[y]=arguments[y+s];switch(s){case 0:return d.call(this,f);case 1:return d.call(this,arguments[0],f);case 2:return d.call(this,arguments[0],arguments[1],f)}var _=Array(s+1);for(y=0;y<s;y++)_[y]=arguments[y];return _[s]=f,d.apply(this,_)}}function zc(d){var s=typeof d;return s==="function"||s==="object"&&!!d}function ib(d){return d===null}function b0(d){return d===void 0}function x0(d){return d===!0||d===!1||iu.call(d)==="[object Boolean]"}function rb(d){return!!(d&&d.nodeType===1)}function ls(d){var s="[object "+d+"]";return function(u){return iu.call(u)===s}}const Fp=ls("String"),w0=ls("Number"),nb=ls("Date"),sb=ls("RegExp"),ab=ls("Error"),S0=ls("Symbol"),A0=ls("ArrayBuffer");var I0=ls("Function"),ob=tg.document&&tg.document.childNodes;typeof/./!="function"&&typeof Int8Array!="object"&&typeof ob!="function"&&(I0=function(d){return typeof d=="function"||!1});const Is=I0,P0=ls("Object");var L0=Y2&&(!/\[native code\]/.test(String(DataView))||P0(new DataView(new ArrayBuffer(8)))),Rp=typeof Map<"u"&&P0(new Map),lb=ls("DataView");function cb(d){return d!=null&&Is(d.getInt8)&&A0(d.buffer)}const Zu=L0?cb:lb,Nc=J2||ls("Array");function ac(d,s){return d!=null&&K2.call(d,s)}var _p=ls("Arguments");(function(){_p(arguments)||(_p=function(d){return ac(d,"callee")})})();const Op=_p;function hb(d){return!S0(d)&&eb(d)&&!isNaN(parseFloat(d))}function k0(d){return w0(d)&&Q2(d)}function T0(d){return function(){return d}}function C0(d){return function(s){var u=d(s);return typeof u=="number"&&u>=0&&u<=tb}}function E0(d){return function(s){return s==null?void 0:s[d]}}const Gu=E0("byteLength"),ub=C0(Gu);var db=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function pb(d){return sg?sg(d)&&!Zu(d):ub(d)&&db.test(iu.call(d))}const M0=_0?pb:T0(!1),Zs=E0("length");function fb(d){for(var s={},u=d.length,f=0;f<u;++f)s[d[f]]=!0;return{contains:function(y){return s[y]===!0},push:function(y){return s[y]=!0,d.push(y)}}}function z0(d,s){s=fb(s);var u=ag.length,f=d.constructor,y=Is(f)&&f.prototype||Dp,_="constructor";for(ac(d,_)&&!s.contains(_)&&s.push(_);u--;)_=ag[u],_ in d&&d[_]!==y[_]&&!s.contains(_)&&s.push(_)}function Mn(d){if(!zc(d))return[];if(rg)return rg(d);var s=[];for(var u in d)ac(d,u)&&s.push(u);return v0&&z0(d,s),s}function mb(d){if(d==null)return!0;var s=Zs(d);return typeof s=="number"&&(Nc(d)||Fp(d)||Op(d))?s===0:Zs(Mn(d))===0}function N0(d,s){var u=Mn(s),f=u.length;if(d==null)return!f;for(var y=Object(d),_=0;_<f;_++){var g=u[_];if(s[g]!==y[g]||!(g in y))return!1}return!0}function rr(d){if(d instanceof rr)return d;if(!(this instanceof rr))return new rr(d);this._wrapped=d}rr.VERSION=y0;rr.prototype.value=function(){return this._wrapped};rr.prototype.valueOf=rr.prototype.toJSON=rr.prototype.value;rr.prototype.toString=function(){return String(this._wrapped)};function og(d){return new Uint8Array(d.buffer||d,d.byteOffset||0,Gu(d))}var lg="[object DataView]";function vp(d,s,u,f){if(d===s)return d!==0||1/d===1/s;if(d==null||s==null)return!1;if(d!==d)return s!==s;var y=typeof d;return y!=="function"&&y!=="object"&&typeof s!="object"?!1:D0(d,s,u,f)}function D0(d,s,u,f){d instanceof rr&&(d=d._wrapped),s instanceof rr&&(s=s._wrapped);var y=iu.call(d);if(y!==iu.call(s))return!1;if(L0&&y=="[object Object]"&&Zu(d)){if(!Zu(s))return!1;y=lg}switch(y){case"[object RegExp]":case"[object String]":return""+d==""+s;case"[object Number]":return+d!=+d?+s!=+s:+d==0?1/+d===1/s:+d==+s;case"[object Date]":case"[object Boolean]":return+d==+s;case"[object Symbol]":return ig.valueOf.call(d)===ig.valueOf.call(s);case"[object ArrayBuffer]":case lg:return D0(og(d),og(s),u,f)}var _=y==="[object Array]";if(!_&&M0(d)){var g=Gu(d);if(g!==Gu(s))return!1;if(d.buffer===s.buffer&&d.byteOffset===s.byteOffset)return!0;_=!0}if(!_){if(typeof d!="object"||typeof s!="object")return!1;var a=d.constructor,C=s.constructor;if(a!==C&&!(Is(a)&&a instanceof a&&Is(C)&&C instanceof C)&&"constructor"in d&&"constructor"in s)return!1}u=u||[],f=f||[];for(var F=u.length;F--;)if(u[F]===d)return f[F]===s;if(u.push(d),f.push(s),_){if(F=d.length,F!==s.length)return!1;for(;F--;)if(!vp(d[F],s[F],u,f))return!1}else{var U=Mn(d),O;if(F=U.length,Mn(s).length!==F)return!1;for(;F--;)if(O=U[F],!(ac(s,O)&&vp(d[O],s[O],u,f)))return!1}return u.pop(),f.pop(),!0}function gb(d,s){return vp(d,s)}function ou(d){if(!zc(d))return[];var s=[];for(var u in d)s.push(u);return v0&&z0(d,s),s}function Bp(d){var s=Zs(d);return function(u){if(u==null)return!1;var f=ou(u);if(Zs(f))return!1;for(var y=0;y<s;y++)if(!Is(u[d[y]]))return!1;return d!==O0||!Is(u[jp])}}var jp="forEach",F0="has",qp=["clear","delete"],R0=["get",F0,"set"],yb=qp.concat(jp,R0),O0=qp.concat(R0),_b=["add"].concat(qp,jp,F0);const vb=Rp?Bp(yb):ls("Map"),bb=Rp?Bp(O0):ls("WeakMap"),xb=Rp?Bp(_b):ls("Set"),wb=ls("WeakSet");function bh(d){for(var s=Mn(d),u=s.length,f=Array(u),y=0;y<u;y++)f[y]=d[s[y]];return f}function Sb(d){for(var s=Mn(d),u=s.length,f=Array(u),y=0;y<u;y++)f[y]=[s[y],d[s[y]]];return f}function B0(d){for(var s={},u=Mn(d),f=0,y=u.length;f<y;f++)s[d[u[f]]]=u[f];return s}function bp(d){var s=[];for(var u in d)Is(d[u])&&s.push(u);return s.sort()}function Vp(d,s){return function(u){var f=arguments.length;if(s&&(u=Object(u)),f<2||u==null)return u;for(var y=1;y<f;y++)for(var _=arguments[y],g=d(_),a=g.length,C=0;C<a;C++){var F=g[C];(!s||u[F]===void 0)&&(u[F]=_[F])}return u}}const j0=Vp(ou),Wu=Vp(Mn),q0=Vp(ou,!0);function Ab(){return function(){}}function V0(d){if(!zc(d))return{};if(ng)return ng(d);var s=Ab();s.prototype=d;var u=new s;return s.prototype=null,u}function Ib(d,s){var u=V0(d);return s&&Wu(u,s),u}function Pb(d){return zc(d)?Nc(d)?d.slice():j0({},d):d}function Lb(d,s){return s(d),d}function U0(d){return Nc(d)?d:[d]}rr.toPath=U0;function lu(d){return rr.toPath(d)}function Up(d,s){for(var u=s.length,f=0;f<u;f++){if(d==null)return;d=d[s[f]]}return u?d:void 0}function $0(d,s,u){var f=Up(d,lu(s));return b0(f)?u:f}function kb(d,s){s=lu(s);for(var u=s.length,f=0;f<u;f++){var y=s[f];if(!ac(d,y))return!1;d=d[y]}return!!u}function $p(d){return d}function ru(d){return d=Wu({},d),function(s){return N0(s,d)}}function Zp(d){return d=lu(d),function(s){return Up(s,d)}}function cu(d,s,u){if(s===void 0)return d;switch(u??3){case 1:return function(f){return d.call(s,f)};case 3:return function(f,y,_){return d.call(s,f,y,_)};case 4:return function(f,y,_,g){return d.call(s,f,y,_,g)}}return function(){return d.apply(s,arguments)}}function Z0(d,s,u){return d==null?$p:Is(d)?cu(d,s,u):zc(d)&&!Nc(d)?ru(d):Zp(d)}function Gp(d,s){return Z0(d,s,1/0)}rr.iteratee=Gp;function Hs(d,s,u){return rr.iteratee!==Gp?rr.iteratee(d,s):Z0(d,s,u)}function Tb(d,s,u){s=Hs(s,u);for(var f=Mn(d),y=f.length,_={},g=0;g<y;g++){var a=f[g];_[a]=s(d[a],a,d)}return _}function G0(){}function Cb(d){return d==null?G0:function(s){return $0(d,s)}}function Eb(d,s,u){var f=Array(Math.max(0,d));s=cu(s,u,1);for(var y=0;y<d;y++)f[y]=s(y);return f}function xp(d,s){return s==null&&(s=d,d=0),d+Math.floor(Math.random()*(s-d+1))}const nu=Date.now||function(){return new Date().getTime()};function W0(d){var s=function(_){return d[_]},u="(?:"+Mn(d).join("|")+")",f=RegExp(u),y=RegExp(u,"g");return function(_){return _=_==null?"":""+_,f.test(_)?_.replace(y,s):_}}const H0={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Mb=W0(H0),zb=B0(H0),Nb=W0(zb),Db=rr.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var Qd=/(.)^/,Fb={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Rb=/\\|'|\r|\n|\u2028|\u2029/g;function Ob(d){return"\\"+Fb[d]}var Bb=/^\s*(\w|\$)+\s*$/;function jb(d,s,u){!s&&u&&(s=u),s=q0({},s,rr.templateSettings);var f=RegExp([(s.escape||Qd).source,(s.interpolate||Qd).source,(s.evaluate||Qd).source].join("|")+"|$","g"),y=0,_="__p+='";d.replace(f,function(F,U,O,$,V){return _+=d.slice(y,V).replace(Rb,Ob),y=V+F.length,U?_+=`'+
((__t=(`+U+`))==null?'':_.escape(__t))+
'`:O?_+=`'+
((__t=(`+O+`))==null?'':__t)+
'`:$&&(_+=`';
`+$+`
__p+='`),F}),_+=`';
`;var g=s.variable;if(g){if(!Bb.test(g))throw new Error("variable is not a bare identifier: "+g)}else _=`with(obj||{}){
`+_+`}
`,g="obj";_=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+_+`return __p;
`;var a;try{a=new Function(g,"_",_)}catch(F){throw F.source=_,F}var C=function(F){return a.call(this,F,rr)};return C.source="function("+g+`){
`+_+"}",C}function qb(d,s,u){s=lu(s);var f=s.length;if(!f)return Is(u)?u.call(d):u;for(var y=0;y<f;y++){var _=d==null?void 0:d[s[y]];_===void 0&&(_=u,y=f),d=Is(_)?_.call(d):_}return d}var Vb=0;function Ub(d){var s=++Vb+"";return d?d+s:s}function $b(d){var s=rr(d);return s._chain=!0,s}function X0(d,s,u,f,y){if(!(f instanceof s))return d.apply(u,y);var _=V0(d.prototype),g=d.apply(_,y);return zc(g)?g:_}var xh=$s(function(d,s){var u=xh.placeholder,f=function(){for(var y=0,_=s.length,g=Array(_),a=0;a<_;a++)g[a]=s[a]===u?arguments[y++]:s[a];for(;y<arguments.length;)g.push(arguments[y++]);return X0(d,f,this,this,g)};return f});xh.placeholder=rr;const K0=$s(function(d,s,u){if(!Is(d))throw new TypeError("Bind must be called on a function");var f=$s(function(y){return X0(d,f,s,this,u.concat(y))});return f}),ga=C0(Zs);function Dc(d,s,u,f){if(f=f||[],!s&&s!==0)s=1/0;else if(s<=0)return f.concat(d);for(var y=f.length,_=0,g=Zs(d);_<g;_++){var a=d[_];if(ga(a)&&(Nc(a)||Op(a)))if(s>1)Dc(a,s-1,u,f),y=f.length;else for(var C=0,F=a.length;C<F;)f[y++]=a[C++];else u||(f[y++]=a)}return f}const Zb=$s(function(d,s){s=Dc(s,!1,!1);var u=s.length;if(u<1)throw new Error("bindAll must be passed function names");for(;u--;){var f=s[u];d[f]=K0(d[f],d)}return d});function Gb(d,s){var u=function(f){var y=u.cache,_=""+(s?s.apply(this,arguments):f);return ac(y,_)||(y[_]=d.apply(this,arguments)),y[_]};return u.cache={},u}const Y0=$s(function(d,s,u){return setTimeout(function(){return d.apply(null,u)},s)}),Wb=xh(Y0,rr,1);function J0(d,s,u){var f,y,_,g,a=0;u||(u={});var C=function(){a=u.leading===!1?0:nu(),f=null,g=d.apply(y,_),f||(y=_=null)},F=function(){var U=nu();!a&&u.leading===!1&&(a=U);var O=s-(U-a);return y=this,_=arguments,O<=0||O>s?(f&&(clearTimeout(f),f=null),a=U,g=d.apply(y,_),f||(y=_=null)):!f&&u.trailing!==!1&&(f=setTimeout(C,O)),g};return F.cancel=function(){clearTimeout(f),a=0,f=y=_=null},F}function Hb(d,s,u){var f,y,_,g,a,C=function(){var U=nu()-y;s>U?f=setTimeout(C,s-U):(f=null,u||(g=d.apply(a,_)),f||(_=a=null))},F=$s(function(U){return a=this,_=U,y=nu(),f||(f=setTimeout(C,s),u&&(g=d.apply(a,_))),g});return F.cancel=function(){clearTimeout(f),f=_=a=null},F}function Xb(d,s){return xh(s,d)}function Wp(d){return function(){return!d.apply(this,arguments)}}function Kb(){var d=arguments,s=d.length-1;return function(){for(var u=s,f=d[s].apply(this,arguments);u--;)f=d[u].call(this,f);return f}}function Yb(d,s){return function(){if(--d<1)return s.apply(this,arguments)}}function Q0(d,s){var u;return function(){return--d>0&&(u=s.apply(this,arguments)),d<=1&&(s=null),u}}const Jb=xh(Q0,2);function e1(d,s,u){s=Hs(s,u);for(var f=Mn(d),y,_=0,g=f.length;_<g;_++)if(y=f[_],s(d[y],y,d))return y}function t1(d){return function(s,u,f){u=Hs(u,f);for(var y=Zs(s),_=d>0?0:y-1;_>=0&&_<y;_+=d)if(u(s[_],_,s))return _;return-1}}const Hp=t1(1),i1=t1(-1);function r1(d,s,u,f){u=Hs(u,f,1);for(var y=u(s),_=0,g=Zs(d);_<g;){var a=Math.floor((_+g)/2);u(d[a])<y?_=a+1:g=a}return _}function n1(d,s,u){return function(f,y,_){var g=0,a=Zs(f);if(typeof _=="number")d>0?g=_>=0?_:Math.max(_+a,g):a=_>=0?Math.min(_+1,a):_+a+1;else if(u&&_&&a)return _=u(f,y),f[_]===y?_:-1;if(y!==y)return _=s(au.call(f,g,a),k0),_>=0?_+g:-1;for(_=d>0?g:a-1;_>=0&&_<a;_+=d)if(f[_]===y)return _;return-1}}const s1=n1(1,Hp,r1),Qb=n1(-1,i1);function wp(d,s,u){var f=ga(d)?Hp:e1,y=f(d,s,u);if(y!==void 0&&y!==-1)return d[y]}function ex(d,s){return wp(d,ru(s))}function Nl(d,s,u){s=cu(s,u);var f,y;if(ga(d))for(f=0,y=d.length;f<y;f++)s(d[f],f,d);else{var _=Mn(d);for(f=0,y=_.length;f<y;f++)s(d[_[f]],_[f],d)}return d}function Ec(d,s,u){s=Hs(s,u);for(var f=!ga(d)&&Mn(d),y=(f||d).length,_=Array(y),g=0;g<y;g++){var a=f?f[g]:g;_[g]=s(d[a],a,d)}return _}function a1(d){var s=function(u,f,y,_){var g=!ga(u)&&Mn(u),a=(g||u).length,C=d>0?0:a-1;for(_||(y=u[g?g[C]:C],C+=d);C>=0&&C<a;C+=d){var F=g?g[C]:C;y=f(y,u[F],F,u)}return y};return function(u,f,y,_){var g=arguments.length>=3;return s(u,cu(f,_,4),y,g)}}const ep=a1(1),cg=a1(-1);function vh(d,s,u){var f=[];return s=Hs(s,u),Nl(d,function(y,_,g){s(y,_,g)&&f.push(y)}),f}function tx(d,s,u){return vh(d,Wp(Hs(s)),u)}function hg(d,s,u){s=Hs(s,u);for(var f=!ga(d)&&Mn(d),y=(f||d).length,_=0;_<y;_++){var g=f?f[_]:_;if(!s(d[g],g,d))return!1}return!0}function ug(d,s,u){s=Hs(s,u);for(var f=!ga(d)&&Mn(d),y=(f||d).length,_=0;_<y;_++){var g=f?f[_]:_;if(s(d[g],g,d))return!0}return!1}function zl(d,s,u,f){return ga(d)||(d=bh(d)),(typeof u!="number"||f)&&(u=0),s1(d,s,u)>=0}const ix=$s(function(d,s,u){var f,y;return Is(s)?y=s:(s=lu(s),f=s.slice(0,-1),s=s[s.length-1]),Ec(d,function(_){var g=y;if(!g){if(f&&f.length&&(_=Up(_,f)),_==null)return;g=_[s]}return g==null?g:g.apply(_,u)})});function Xp(d,s){return Ec(d,Zp(s))}function rx(d,s){return vh(d,ru(s))}function o1(d,s,u){var f=-1/0,y=-1/0,_,g;if(s==null||typeof s=="number"&&typeof d[0]!="object"&&d!=null){d=ga(d)?d:bh(d);for(var a=0,C=d.length;a<C;a++)_=d[a],_!=null&&_>f&&(f=_)}else s=Hs(s,u),Nl(d,function(F,U,O){g=s(F,U,O),(g>y||g===-1/0&&f===-1/0)&&(f=F,y=g)});return f}function nx(d,s,u){var f=1/0,y=1/0,_,g;if(s==null||typeof s=="number"&&typeof d[0]!="object"&&d!=null){d=ga(d)?d:bh(d);for(var a=0,C=d.length;a<C;a++)_=d[a],_!=null&&_<f&&(f=_)}else s=Hs(s,u),Nl(d,function(F,U,O){g=s(F,U,O),(g<y||g===1/0&&f===1/0)&&(f=F,y=g)});return f}var sx=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function l1(d){return d?Nc(d)?au.call(d):Fp(d)?d.match(sx):ga(d)?Ec(d,$p):bh(d):[]}function c1(d,s,u){if(s==null||u)return ga(d)||(d=bh(d)),d[xp(d.length-1)];var f=l1(d),y=Zs(f);s=Math.max(Math.min(s,y),0);for(var _=y-1,g=0;g<s;g++){var a=xp(g,_),C=f[g];f[g]=f[a],f[a]=C}return f.slice(0,s)}function ax(d){return c1(d,1/0)}function ox(d,s,u){var f=0;return s=Hs(s,u),Xp(Ec(d,function(y,_,g){return{value:y,index:f++,criteria:s(y,_,g)}}).sort(function(y,_){var g=y.criteria,a=_.criteria;if(g!==a){if(g>a||g===void 0)return 1;if(g<a||a===void 0)return-1}return y.index-_.index}),"value")}function td(d,s){return function(u,f,y){var _=s?[[],[]]:{};return f=Hs(f,y),Nl(u,function(g,a){var C=f(g,a,u);d(_,g,C)}),_}}const lx=td(function(d,s,u){ac(d,u)?d[u].push(s):d[u]=[s]}),cx=td(function(d,s,u){d[u]=s}),hx=td(function(d,s,u){ac(d,u)?d[u]++:d[u]=1}),ux=td(function(d,s,u){d[u?0:1].push(s)},!0);function dx(d){return d==null?0:ga(d)?d.length:Mn(d).length}function px(d,s,u){return s in u}const h1=$s(function(d,s){var u={},f=s[0];if(d==null)return u;Is(f)?(s.length>1&&(f=cu(f,s[1])),s=ou(d)):(f=px,s=Dc(s,!1,!1),d=Object(d));for(var y=0,_=s.length;y<_;y++){var g=s[y],a=d[g];f(a,g,d)&&(u[g]=a)}return u}),fx=$s(function(d,s){var u=s[0],f;return Is(u)?(u=Wp(u),s.length>1&&(f=s[1])):(s=Ec(Dc(s,!1,!1),String),u=function(y,_){return!zl(s,_)}),h1(d,u,f)});function u1(d,s,u){return au.call(d,0,Math.max(0,d.length-(s==null||u?1:s)))}function tp(d,s,u){return d==null||d.length<1?s==null||u?void 0:[]:s==null||u?d[0]:u1(d,d.length-s)}function Bu(d,s,u){return au.call(d,s==null||u?1:s)}function mx(d,s,u){return d==null||d.length<1?s==null||u?void 0:[]:s==null||u?d[d.length-1]:Bu(d,Math.max(0,d.length-s))}function gx(d){return vh(d,Boolean)}function yx(d,s){return Dc(d,s,!1)}const d1=$s(function(d,s){return s=Dc(s,!0,!0),vh(d,function(u){return!zl(s,u)})}),_x=$s(function(d,s){return d1(d,s)});function Sp(d,s,u,f){x0(s)||(f=u,u=s,s=!1),u!=null&&(u=Hs(u,f));for(var y=[],_=[],g=0,a=Zs(d);g<a;g++){var C=d[g],F=u?u(C,g,d):C;s&&!u?((!g||_!==F)&&y.push(C),_=F):u?zl(_,F)||(_.push(F),y.push(C)):zl(y,C)||y.push(C)}return y}const vx=$s(function(d){return Sp(Dc(d,!0,!0))});function bx(d){for(var s=[],u=arguments.length,f=0,y=Zs(d);f<y;f++){var _=d[f];if(!zl(s,_)){var g;for(g=1;g<u&&zl(arguments[g],_);g++);g===u&&s.push(_)}}return s}function Ap(d){for(var s=d&&o1(d,Zs).length||0,u=Array(s),f=0;f<s;f++)u[f]=Xp(d,f);return u}const xx=$s(Ap);function wx(d,s){for(var u={},f=0,y=Zs(d);f<y;f++)s?u[d[f]]=s[f]:u[d[f][0]]=d[f][1];return u}function Sx(d,s,u){s==null&&(s=d||0,d=0),u||(u=s<d?-1:1);for(var f=Math.max(Math.ceil((s-d)/u),0),y=Array(f),_=0;_<f;_++,d+=u)y[_]=d;return y}function Ax(d,s){if(s==null||s<1)return[];for(var u=[],f=0,y=d.length;f<y;)u.push(au.call(d,f,f+=s));return u}function Kp(d,s){return d._chain?rr(s).chain():s}function p1(d){return Nl(bp(d),function(s){var u=rr[s]=d[s];rr.prototype[s]=function(){var f=[this._wrapped];return X2.apply(f,arguments),Kp(this,u.apply(rr,f))}}),rr}Nl(["pop","push","reverse","shift","sort","splice","unshift"],function(d){var s=ed[d];rr.prototype[d]=function(){var u=this._wrapped;return u!=null&&(s.apply(u,arguments),(d==="shift"||d==="splice")&&u.length===0&&delete u[0]),Kp(this,u)}});Nl(["concat","join","slice"],function(d){var s=ed[d];rr.prototype[d]=function(){var u=this._wrapped;return u!=null&&(u=s.apply(u,arguments)),Kp(this,u)}});const Ix=Object.freeze(Object.defineProperty({__proto__:null,VERSION:y0,after:Yb,all:hg,allKeys:ou,any:ug,assign:Wu,before:Q0,bind:K0,bindAll:Zb,chain:$b,chunk:Ax,clone:Pb,collect:Ec,compact:gx,compose:Kb,constant:T0,contains:zl,countBy:hx,create:Ib,debounce:Hb,default:rr,defaults:q0,defer:Wb,delay:Y0,detect:wp,difference:d1,drop:Bu,each:Nl,escape:Mb,every:hg,extend:j0,extendOwn:Wu,filter:vh,find:wp,findIndex:Hp,findKey:e1,findLastIndex:i1,findWhere:ex,first:tp,flatten:yx,foldl:ep,foldr:cg,forEach:Nl,functions:bp,get:$0,groupBy:lx,has:kb,head:tp,identity:$p,include:zl,includes:zl,indexBy:cx,indexOf:s1,initial:u1,inject:ep,intersection:bx,invert:B0,invoke:ix,isArguments:Op,isArray:Nc,isArrayBuffer:A0,isBoolean:x0,isDataView:Zu,isDate:nb,isElement:rb,isEmpty:mb,isEqual:gb,isError:ab,isFinite:hb,isFunction:Is,isMap:vb,isMatch:N0,isNaN:k0,isNull:ib,isNumber:w0,isObject:zc,isRegExp:sb,isSet:xb,isString:Fp,isSymbol:S0,isTypedArray:M0,isUndefined:b0,isWeakMap:bb,isWeakSet:wb,iteratee:Gp,keys:Mn,last:mx,lastIndexOf:Qb,map:Ec,mapObject:Tb,matcher:ru,matches:ru,max:o1,memoize:Gb,methods:bp,min:nx,mixin:p1,negate:Wp,noop:G0,now:nu,object:wx,omit:fx,once:Jb,pairs:Sb,partial:xh,partition:ux,pick:h1,pluck:Xp,property:Zp,propertyOf:Cb,random:xp,range:Sx,reduce:ep,reduceRight:cg,reject:tx,rest:Bu,restArguments:$s,result:qb,sample:c1,select:vh,shuffle:ax,size:dx,some:ug,sortBy:ox,sortedIndex:r1,tail:Bu,take:tp,tap:Lb,template:jb,templateSettings:Db,throttle:J0,times:Eb,toArray:l1,toPath:U0,transpose:Ap,unescape:Nb,union:vx,uniq:Sp,unique:Sp,uniqueId:Ub,unzip:Ap,values:bh,where:rx,without:_x,wrap:Xb,zip:xx},Symbol.toStringTag,{value:"Module"}));var dg=p1(Ix);dg._=dg;let Px=new B2;ah.addProtocol("pmtiles",Px.tile);const pg=18;document.addEventListener("DOMContentLoaded",async()=>{const d=new ah.Map({container:"map",hash:!0,style:"./style.json",center:[135.57,34.777],zoom:13,maxZoom:19,minZoom:4,localIdeographFontFamily:["BIZ UDPGothic","sans-serif"]});Tc.init(d);function s(){const{_sw:g,_ne:a}=d.getBounds();return{minX:g.lng,minY:g.lat,maxX:a.lng,maxY:a.lat}}async function u(){if(d.getZoom()<pg)return;let g=0;const a={type:"FeatureCollection",features:[]};let C=flatgeobuf.deserialize("./data/r1chikeizu.fgb",s());for await(let F of C)a.features.push({...F,id:g}),g+=1;d.getSource("blocks").setData(a)}d.on("load",()=>{d.on("click",g=>{var O,$,V,ye;const C=["senbiki-fill","youto-fill","koudoti-fill","bouka-fill"].map(de=>d.queryRenderedFeatures(g.point,{layers:[de]})[0]);if(C[0]===void 0)return;let F=[];F[0]=C[0].properties.区域区分,F[0]=="市街化区域"&&(F[1]=`<br>${C[1].properties.用途地域}
      <li>容積率：${C[1].properties.容積率}</li>
      <li>建ぺい率：${C[1].properties.建ぺい率}</li>`,F[2]=(($=(O=C[2])==null?void 0:O.properties)==null?void 0:$.Type)??"高度地区指定なし"),F[3]="<br>",F[4]=((ye=(V=C[3])==null?void 0:V.properties)==null?void 0:ye.防火準防火)??"法22条地域";const U=F.join("");new ah.Popup().setLngLat(g.lngLat).setHTML(U).addTo(d)}),d.addSource("blocks",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),d.addLayer({id:"blocks-line",type:"line",source:"blocks",minzoom:pg,paint:{"line-color":["match",["get","layer"],"建物","#232323","道路","#232323","名称","#a8a1ad","#7b7b7d"],"line-width":["match",["get","layer"],"鉄道",2.6,"行政界等",1.6,"河川",1.6,.6]}}),u=J0(u,500),u(),d.on("moveend",function(g){u()})});const f={forwardGeocode:async g=>{const a=[],C=`https://geocode.csis.u-tokyo.ac.jp/cgi-bin/simple_geocode.cgi?addr=${g.query}&charset=UTF8&constraint=大阪府摂津市`,U=await(await fetch(C)).text(),$=await new DOMParser().parseFromString(U,"text/xml"),V=[$.getElementsByTagName("longitude")[0].firstChild.nodeValue,$.getElementsByTagName("latitude")[0].firstChild.nodeValue],ye={type:"Feature",geometry:{type:"Point",coordinates:V},place_name:$.getElementsByTagName("address")[0].textContent,place_type:["place"],center:V};return a.push(ye),{features:a}}};d.addControl(new $_(f,{maplibregl:ah})),d.addControl(new ah.NavigationControl),d.addControl(new h2({Format:Ml.PNG,Crosshair:!0,PrintableArea:!0,Local:"ja"})),d.addControl(new ah.ScaleControl({maxWidth:200}));let y=document.getElementById("style"),_=document.getElementById("bdr");document.getElementById("style").addEventListener("click",()=>{const g=!!y.checked;d.U.toggle("r-raster",g),d.U.toggle(["tran-fill","bldg-fill"],!g),d.U.toggleSource("v",!g)}),document.getElementById("bdr").addEventListener("click",()=>{d.U.toggle(/-symbol$/,_.checked)})});export{dr as d};
