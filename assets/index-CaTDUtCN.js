(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))g(v);new MutationObserver(v=>{for(const x of v)if(x.type==="childList")for(const b of x.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&g(b)}).observe(document,{childList:!0,subtree:!0});function u(v){const x={};return v.integrity&&(x.integrity=v.integrity),v.referrerPolicy&&(x.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?x.credentials="include":v.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function g(v){if(v.ep)return;v.ep=!0;const x=u(v);fetch(v.href,x)}})();var Td=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $y(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var Rd={exports:{}};var kb=Rd.exports,p_;function Db(){return p_||(p_=1,(function(p,l){(function(u,g){p.exports=g()})(kb,(function(){var u={},g={};function v(b,s,E){if(g[b]=E,b==="index"){var F="var sharedModule = {}; ("+g.shared+")(sharedModule); ("+g.worker+")(sharedModule);",B={};return g.shared(B),g.index(u,B),typeof window<"u"&&u.setWorkerUrl(window.URL.createObjectURL(new Blob([F],{type:"text/javascript"}))),u}}v("shared",["exports"],(function(b){function s(i,e,r,a){return new(r||(r=Promise))((function(c,d){function f(I){try{S(a.next(I))}catch(D){d(D)}}function y(I){try{S(a.throw(I))}catch(D){d(D)}}function S(I){var D;I.done?c(I.value):(D=I.value,D instanceof r?D:new r((function(R){R(D)}))).then(f,y)}S((a=a.apply(i,e||[])).next())}))}function E(i,e){this.x=i,this.y=e}function F(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var B,Q;typeof SuppressedError=="function"&&SuppressedError,E.prototype={clone(){return new E(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,e){return this.clone()._rotateAround(i,e)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult(i){const e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const e=Math.cos(i),r=Math.sin(i),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround(i,e){const r=Math.cos(i),a=Math.sin(i),c=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=c,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:E},E.convert=function(i){if(i instanceof E)return i;if(Array.isArray(i))return new E(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new E(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};var ne=(function(){if(Q)return B;function i(e,r,a,c){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=a,this.p2y=c}return Q=1,B=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,c=0;c<8;c++){var d=this.sampleCurveX(a)-e;if(Math.abs(d)<r)return a;var f=this.sampleCurveDerivativeX(a);if(Math.abs(f)<1e-6)break;a-=d/f}var y=0,S=1;for(a=e,c=0;c<20&&(d=this.sampleCurveX(a),!(Math.abs(d-e)<r));c++)e>d?y=a:S=a,a=.5*(S-y)+y;return a},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},B})(),j=F(ne);let Ie,he;function re(){return Ie==null&&(Ie=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ie}function ye(){if(he==null&&(he=!1,re())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let a=0;a<25;a++){const c=4*a;e.fillStyle=`rgb(${c},${c+1},${c+2})`,e.fillRect(a%5,Math.floor(a/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let a=0;a<100;a++)if(a%4!=3&&r[a]!==a){he=!0;break}}}return he||!1}var Je=1e-6,Be=typeof Float32Array<"u"?Float32Array:Array;function De(){var i=new Be(9);return Be!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Ue(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function $e(){var i=new Be(3);return Be!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function st(i){var e=i[0],r=i[1],a=i[2];return Math.sqrt(e*e+r*r+a*a)}function Ze(i,e,r){var a=new Be(3);return a[0]=i,a[1]=e,a[2]=r,a}function Pe(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i}function rt(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i}function _e(i,e,r){var a=e[0],c=e[1],d=e[2],f=r[0],y=r[1],S=r[2];return i[0]=c*S-d*y,i[1]=d*f-a*S,i[2]=a*y-c*f,i}var we,Ge=st;function Ye(i,e,r){var a=e[0],c=e[1],d=e[2],f=e[3];return i[0]=r[0]*a+r[4]*c+r[8]*d+r[12]*f,i[1]=r[1]*a+r[5]*c+r[9]*d+r[13]*f,i[2]=r[2]*a+r[6]*c+r[10]*d+r[14]*f,i[3]=r[3]*a+r[7]*c+r[11]*d+r[15]*f,i}function xt(){var i=new Be(4);return Be!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function kt(i,e,r,a){var c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",d=Math.PI/360;e*=d,a*=d,r*=d;var f=Math.sin(e),y=Math.cos(e),S=Math.sin(r),I=Math.cos(r),D=Math.sin(a),R=Math.cos(a);switch(c){case"xyz":i[0]=f*I*R+y*S*D,i[1]=y*S*R-f*I*D,i[2]=y*I*D+f*S*R,i[3]=y*I*R-f*S*D;break;case"xzy":i[0]=f*I*R-y*S*D,i[1]=y*S*R-f*I*D,i[2]=y*I*D+f*S*R,i[3]=y*I*R+f*S*D;break;case"yxz":i[0]=f*I*R+y*S*D,i[1]=y*S*R-f*I*D,i[2]=y*I*D-f*S*R,i[3]=y*I*R+f*S*D;break;case"yzx":i[0]=f*I*R+y*S*D,i[1]=y*S*R+f*I*D,i[2]=y*I*D-f*S*R,i[3]=y*I*R-f*S*D;break;case"zxy":i[0]=f*I*R-y*S*D,i[1]=y*S*R+f*I*D,i[2]=y*I*D+f*S*R,i[3]=y*I*R-f*S*D;break;case"zyx":i[0]=f*I*R-y*S*D,i[1]=y*S*R+f*I*D,i[2]=y*I*D-f*S*R,i[3]=y*I*R+f*S*D;break;default:throw new Error("Unknown angle order "+c)}return i}function yt(){var i=new Be(2);return Be!=Float32Array&&(i[0]=0,i[1]=0),i}function mt(i,e){var r=new Be(2);return r[0]=i,r[1]=e,r}$e(),we=new Be(4),Be!=Float32Array&&(we[0]=0,we[1]=0,we[2]=0,we[3]=0),$e(),Ze(1,0,0),Ze(0,1,0),xt(),xt(),De(),yt();const gt=8192;function Qt(i,e,r){return e*(gt/(i.tileSize*Math.pow(2,r-i.tileID.overscaledZ)))}function Vt(i,e){return(i%e+e)%e}function fe(i,e,r){return i*(1-r)+e*r}function Fe(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,r=e*i;return 4*(i<.5?r:3*(i-e)+r-.75)}function We(i,e,r,a){const c=new j(i,e,r,a);return d=>c.solve(d)}const tt=We(.25,.1,.25,1);function nt(i,e,r){return Math.min(r,Math.max(e,i))}function ut(i,e,r){const a=r-e,c=((i-e)%a+a)%a+e;return c===e?r:c}function ft(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}let It=1;function zt(i,e,r){const a={};for(const c in i)a[c]=e.call(this,i[c],c,i);return a}function Zt(i,e,r){const a={};for(const c in i)e.call(this,i[c],c,i)&&(a[c]=i[c]);return a}function sr(i){return Array.isArray(i)?i.map(sr):typeof i=="object"&&i?zt(i,sr):i}const ur={};function _r(i){ur[i]||(typeof console<"u"&&console.warn(i),ur[i]=!0)}function Le(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function lr(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let br=null;function Tr(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Yt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function zr(i,e,r,a,c){return s(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const d=new VideoFrame(i,{timestamp:0});try{const f=d?.format;if(!f||!f.startsWith("BGR")&&!f.startsWith("RGB"))throw new Error(`Unrecognized format ${f}`);const y=f.startsWith("BGR"),S=new Uint8ClampedArray(a*c*4);if(yield d.copyTo(S,(function(I,D,R,U,q){const H=4*Math.max(-D,0),X=(Math.max(0,R)-R)*U*4+H,K=4*U,de=Math.max(0,D),ze=Math.max(0,R);return{rect:{x:de,y:ze,width:Math.min(I.width,D+U)-de,height:Math.min(I.height,R+q)-ze},layout:[{offset:X,stride:K}]}})(i,e,r,a,c)),y)for(let I=0;I<S.length;I+=4){const D=S[I];S[I]=S[I+2],S[I+2]=D}return S}finally{d.close()}}))}let yr,Lr;function Cr(i,e,r,a){return i.addEventListener(e,r,a),{unsubscribe:()=>{i.removeEventListener(e,r,a)}}}function li(i){return i*Math.PI/180}function Gr(i){return i/Math.PI*180}const Vr={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},ni={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},ei="AbortError";class xr extends Error{constructor(e=ei){super(e instanceof Error?e.message:e),this.name=ei,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function Qe(i){return i.name===ei}const W={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function te(i){return W.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const se="global-dispatcher";class Ce extends Error{constructor(e,r,a,c){super(`AJAXError: ${r} (${e}): ${a}`),this.status=e,this.statusText=r,this.url=a,this.body=c}}const Oe=()=>lr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ht=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const a=te(i.url);if(a)return a(i,e);if(lr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:se},e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(Oe())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(a,c){return s(this,void 0,void 0,(function*(){const d=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:Oe(),signal:c.signal});let f,y;a.type!=="json"||d.headers.has("Accept")||d.headers.set("Accept","application/json");try{f=yield fetch(d)}catch(I){throw Qe(I)?I:new Ce(0,I.message,a.url,new Blob)}if(!f.ok){const I=yield f.blob();throw new Ce(f.status,f.statusText,a.url,I)}y=a.type==="arrayBuffer"||a.type==="image"?f.arrayBuffer():a.type==="json"?f.json():f.text();const S=yield y;return c.signal.throwIfAborted(),{data:S,cacheControl:f.headers.get("Cache-Control"),expires:f.headers.get("Expires")}}))})(i,e);if(lr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:se},e)}var r;return(function(a,c){return new Promise(((d,f)=>{var y;const S=new XMLHttpRequest;S.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(S.responseType="arraybuffer");for(const I in a.headers)S.setRequestHeader(I,a.headers[I]);a.type==="json"&&(S.responseType="text",!((y=a.headers)===null||y===void 0)&&y.Accept||S.setRequestHeader("Accept","application/json")),S.withCredentials=a.credentials==="include",S.onerror=()=>{f(new Error(S.statusText))},S.onload=()=>{if(!c.signal.aborted)if((S.status>=200&&S.status<300||S.status===0)&&S.response!==null){let I=S.response;if(a.type==="json")try{I=JSON.parse(S.response)}catch(D){return void f(D)}d({data:I,cacheControl:S.getResponseHeader("Cache-Control"),expires:S.getResponseHeader("Expires")})}else{const I=new Blob([S.response],{type:S.getResponseHeader("Content-Type")});f(new Ce(S.status,S.statusText,a.url,I))}},c.signal.addEventListener("abort",(()=>{S.abort(),f(new xr(c.signal.reason))})),S.send(a.body)}))})(i,e)};function Y(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function P(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function k(i,e,r){if(r&&r[i]){const a=r[i].indexOf(e);a!==-1&&r[i].splice(a,1)}}class ee{constructor(e,r={}){ft(this,r),this.type=e}}class le extends ee{constructor(e,r={}){super("error",ft({error:e},r))}}class ge{on(e,r){return this._listeners=this._listeners||{},P(e,r,this._listeners),{unsubscribe:()=>{this.off(e,r)}}}off(e,r){return k(e,r,this._listeners),k(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},P(e,r,this._oneTimeListeners),this):new Promise((a=>this.once(e,a)))}fire(e,r){typeof e=="string"&&(e=new ee(e,r||{}));const a=e.type;if(this.listens(a)){e.target=this;const c=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of c)y.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of d)k(a,y,this._oneTimeListeners),y.call(this,e);const f=this._eventedParent;f&&(ft(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(e))}else e instanceof le&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var ie={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const ot=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Mt(i,e){const r={};for(const a in i)a!=="ref"&&(r[a]=i[a]);return ot.forEach((a=>{a in e&&(r[a]=e[a])})),r}function ct(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!ct(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!ct(i[r],e[r]))return!1;return!0}return i===e}function dt(i,e){i.push(e)}function Dt(i,e,r){dt(r,{command:"addSource",args:[i,e[i]]})}function Ct(i,e,r){dt(e,{command:"removeSource",args:[i]}),r[i]=!0}function Ht(i,e,r,a){Ct(i,r,a),Dt(i,e,r)}function Gt(i,e,r){let a;for(a in i[r])if(Object.prototype.hasOwnProperty.call(i[r],a)&&a!=="data"&&!ct(i[r][a],e[r][a]))return!1;for(a in e[r])if(Object.prototype.hasOwnProperty.call(e[r],a)&&a!=="data"&&!ct(i[r][a],e[r][a]))return!1;return!0}function dr(i,e,r,a,c,d){i=i||{},e=e||{};for(const f in i)Object.prototype.hasOwnProperty.call(i,f)&&(ct(i[f],e[f])||r.push({command:d,args:[a,f,e[f],c]}));for(const f in e)Object.prototype.hasOwnProperty.call(e,f)&&!Object.prototype.hasOwnProperty.call(i,f)&&(ct(i[f],e[f])||r.push({command:d,args:[a,f,e[f],c]}))}function vr(i){return i.id}function Nr(i,e){return i[e.id]=e,i}class Lt{constructor(e,r,a,c){this.message=(e?`${e}: `:"")+a,c&&(this.identifier=c),r!=null&&r.__line__&&(this.line=r.__line__)}}function wr(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}class zi extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class fn{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,c]of r)this.bindings[a]=c}concat(e){return new fn(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const mi={kind:"null"},Xt={kind:"number"},Er={kind:"string"},Rr={kind:"boolean"},Ni={kind:"color"},Rs={kind:"projectionDefinition"},Dn={kind:"object"},$r={kind:"value"},wa={kind:"collator"},Sa={kind:"formatted"},Ua={kind:"padding"},ho={kind:"colorArray"},qa={kind:"numberArray"},Ga={kind:"resolvedImage"},fo={kind:"variableAnchorOffsetCollection"};function Ri(i,e){return{kind:"array",itemType:i,N:e}}function gi(i){if(i.kind==="array"){const e=gi(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Bo=[mi,Xt,Er,Rr,Ni,Rs,Sa,Dn,Ri($r),Ua,qa,ho,Ga,fo];function Ta(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Ta(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of Bo)if(!Ta(r,e))return null}}return`Expected ${gi(i)} but found ${gi(e)} instead.`}function po(i,e){return e.some((r=>r.kind===i.kind))}function Pa(i,e){return e.some((r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i))}function ds(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const oa=.96422,Bs=.82521,pl=4/29,ri=6/29,Gl=3*ri*ri,la=ri*ri*ri,Aa=Math.PI/180,$l=180/Math.PI;function As(i){return(i%=360)<0&&(i+=360),i}function wn([i,e,r,a]){let c,d;const f=ml((.2225045*(i=Os(i))+.7168786*(e=Os(e))+.0606169*(r=Os(r)))/1);i===e&&e===r?c=d=f:(c=ml((.4360747*i+.3850649*e+.1430804*r)/oa),d=ml((.0139322*i+.0971045*e+.7141733*r)/Bs));const y=116*f-16;return[y<0?0:y,500*(c-f),200*(f-d),a]}function Os(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function ml(i){return i>la?Math.pow(i,1/3):i/Gl+pl}function Zl([i,e,r,a]){let c=(i+16)/116,d=isNaN(e)?c:c+e/500,f=isNaN(r)?c:c-r/200;return c=1*js(c),d=oa*js(d),f=Bs*js(f),[Wl(3.1338561*d-1.6168667*c-.4906146*f),Wl(-.9787684*d+1.9161415*c+.033454*f),Wl(.0719453*d-.2289914*c+1.4052427*f),a]}function Wl(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function js(i){return i>ri?i*i*i:Gl*(i-pl)}const wc=Object.hasOwn||function(i,e){return Object.prototype.hasOwnProperty.call(i,e)};function mo(i,e){return wc(i,e)?i[e]:void 0}function $a(i){return parseInt(i.padEnd(2,i),16)/255}function go(i,e){return _o(e?i/100:i,0,1)}function _o(i,e,r){return Math.min(Math.max(e,i),r)}function Hl(i){return!i.some(Number.isNaN)}const Oo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Vs(i,e,r){return i+r*(e-i)}function Za(i,e,r){return i.map(((a,c)=>Vs(a,e[c],r)))}class Ur{constructor(e,r,a,c=1,d=!0){this.r=e,this.g=r,this.b=a,this.a=c,d||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[e,r,a,c]))}static parse(e){if(e instanceof Ur)return e;if(typeof e!="string")return;const r=(function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=mo(Oo,a);if(c){const[f,y,S]=c;return[f/255,y/255,S/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const f=a.length<6?1:2;let y=1;return[$a(a.slice(y,y+=f)),$a(a.slice(y,y+=f)),$a(a.slice(y,y+=f)),$a(a.slice(y,y+f)||"ff")]}if(a.startsWith("rgb")){const f=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[y,S,I,D,R,U,q,H,X,K,de,ze]=f,pe=[D||" ",q||" ",K].join("");if(pe==="  "||pe==="  /"||pe===",,"||pe===",,,"){const xe=[I,U,X].join(""),je=xe==="%%%"?100:xe===""?255:0;if(je){const Ke=[_o(+S/je,0,1),_o(+R/je,0,1),_o(+H/je,0,1),de?go(+de,ze):1];if(Hl(Ke))return Ke}}return}}const d=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){const[f,y,S,I,D,R,U,q,H]=d,X=[S||" ",D||" ",U].join("");if(X==="  "||X==="  /"||X===",,"||X===",,,"){const K=[+y,_o(+I,0,100),_o(+R,0,100),q?go(+q,H):1];if(Hl(K))return(function([de,ze,pe,xe]){function je(Ke){const bt=(Ke+de/30)%12,Bt=ze*Math.min(pe,1-pe);return pe-Bt*Math.max(-1,Math.min(bt-3,9-bt,1))}return de=As(de),ze/=100,pe/=100,[je(0),je(8),je(4),xe]})(K)}}})(e);return r?new Ur(...r,!1):void 0}get rgb(){const{r:e,g:r,b:a,a:c}=this,d=c||1/0;return this.overwriteGetter("rgb",[e/d,r/d,a/d,c])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[r,a,c,d]=wn(e),f=Math.sqrt(a*a+c*c);return[Math.round(1e4*f)?As(Math.atan2(c,a)*$l):NaN,f,r,d]})(this.rgb))}get lab(){return this.overwriteGetter("lab",wn(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,a,c]=this.rgb;return`rgba(${[e,r,a].map((d=>Math.round(255*d))).join(",")},${c})`}static interpolate(e,r,a,c="rgb"){switch(c){case"rgb":{const[d,f,y,S]=Za(e.rgb,r.rgb,a);return new Ur(d,f,y,S,!1)}case"hcl":{const[d,f,y,S]=e.hcl,[I,D,R,U]=r.hcl;let q,H;if(isNaN(d)||isNaN(I))isNaN(d)?isNaN(I)?q=NaN:(q=I,y!==1&&y!==0||(H=D)):(q=d,R!==1&&R!==0||(H=f));else{let pe=I-d;I>d&&pe>180?pe-=360:I<d&&d-I>180&&(pe+=360),q=d+a*pe}const[X,K,de,ze]=(function([pe,xe,je,Ke]){return pe=isNaN(pe)?0:pe*Aa,Zl([je,Math.cos(pe)*xe,Math.sin(pe)*xe,Ke])})([q,H??Vs(f,D,a),Vs(y,R,a),Vs(S,U,a)]);return new Ur(X,K,de,ze,!1)}case"lab":{const[d,f,y,S]=Zl(Za(e.lab,r.lab,a));return new Ur(d,f,y,S,!1)}}}}Ur.black=new Ur(0,0,0,1),Ur.white=new Ur(1,1,1,1),Ur.transparent=new Ur(0,0,0,0),Ur.red=new Ur(1,0,0,1);class Xl{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const jo=["bottom","center","top"];class Vo{constructor(e,r,a,c,d,f){this.text=e,this.image=r,this.scale=a,this.fontStack=c,this.textColor=d,this.verticalAlign=f}}class Hn{constructor(e){this.sections=e}static fromString(e){return new Hn([new Vo(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof Hn?e:Hn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class kr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof kr)return e;if(typeof e=="number")return new kr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new kr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,a){return new kr(Za(e.values,r.values,a))}}class Bi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Bi)return e;if(typeof e=="number")return new Bi([e]);if(Array.isArray(e)){for(const r of e)if(typeof r!="number")return;return new Bi(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,a){return new Bi(Za(e.values,r.values,a))}}class Br{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Br)return e;if(typeof e=="string"){const a=Ur.parse(e);return a?new Br([a]):void 0}if(!Array.isArray(e))return;const r=[];for(const a of e){if(typeof a!="string")return;const c=Ur.parse(a);if(!c)return;r.push(c)}return new Br(r)}toString(){return JSON.stringify(this.values)}static interpolate(e,r,a,c="rgb"){const d=[];if(e.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let f=0;f<e.values.length;f++)d.push(Ur.interpolate(e.values[f],r.values[f],a,c));return new Br(d)}}class wi extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Xn=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ki{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ki)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const a=e[r],c=e[r+1];if(typeof a!="string"||!Xn.has(a)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new Ki(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,a){const c=e.values,d=r.values;if(c.length!==d.length)throw new wi(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${r.toString()}`);const f=[];for(let y=0;y<c.length;y+=2){if(c[y]!==d[y])throw new wi(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${c[y]}, to[${y}]: ${d[y]}`);f.push(c[y]);const[S,I]=c[y+1],[D,R]=d[y+1];f.push([Vs(S,D,a),Vs(I,R,a)])}return new Ki(f)}}class is{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new is({name:e,available:!1}):null}}class Un{constructor(e,r,a){this.from=e,this.to=r,this.transition=a}static interpolate(e,r,a){return new Un(e,r,a)}static parse(e){return e instanceof Un?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new Un(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new Un(e.from,e.to,e.transition):typeof e=="string"?new Un(e,e,1):void 0}}function ca(i,e,r,a){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[i,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[i,e,r,a]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Us(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Un||i instanceof Ur||i instanceof Xl||i instanceof Hn||i instanceof kr||i instanceof Bi||i instanceof Br||i instanceof Ki||i instanceof is)return!0;if(Array.isArray(i)){for(const e of i)if(!Us(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Us(i[e]))return!1;return!0}return!1}function Mi(i){if(i===null)return mi;if(typeof i=="string")return Er;if(typeof i=="boolean")return Rr;if(typeof i=="number")return Xt;if(i instanceof Ur)return Ni;if(i instanceof Un)return Rs;if(i instanceof Xl)return wa;if(i instanceof Hn)return Sa;if(i instanceof kr)return Ua;if(i instanceof Bi)return qa;if(i instanceof Br)return ho;if(i instanceof Ki)return fo;if(i instanceof is)return Ga;if(Array.isArray(i)){const e=i.length;let r;for(const a of i){const c=Mi(a);if(r){if(r===c)continue;r=$r;break}r=c}return Ri(r||$r,e)}return Dn}function Wa(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Ur||i instanceof Un||i instanceof Hn||i instanceof kr||i instanceof Bi||i instanceof Br||i instanceof Ki||i instanceof is?i.toString():JSON.stringify(i)}class Fn{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Us(e[1]))return r.error("invalid value");const a=e[1];let c=Mi(a);const d=r.expectedType;return c.kind!=="array"||c.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(c=d),new Fn(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const gl={string:Er,number:Xt,boolean:Rr,object:Dn};class zn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,c=1;const d=e[0];if(d==="array"){let y,S;if(e.length>2){const I=e[1];if(typeof I!="string"||!(I in gl)||I==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=gl[I],c++}else y=$r;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);S=e[2],c++}a=Ri(y,S)}else{if(!gl[d])throw new Error(`Types doesn't contain name = ${d}`);a=gl[d]}const f=[];for(;c<e.length;c++){const y=r.parse(e[c],c,$r);if(!y)return null;f.push(y)}return new zn(a,f)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!Ta(this.type,Mi(a)))return a;if(r===this.args.length-1)throw new wi(`Expected value to be of type ${gi(this.type)}, but found ${gi(Mi(a))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const ua={"to-boolean":Rr,"to-color":Ni,"to-number":Xt,"to-string":Er};class qs{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0];if(!ua[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");const c=ua[a],d=[];for(let f=1;f<e.length;f++){const y=r.parse(e[f],f,$r);if(!y)return null;d.push(y)}return new qs(c,d)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,a;for(const c of this.args){if(r=c.evaluate(e),a=null,r instanceof Ur)return r;if(typeof r=="string"){const d=e.parseColor(r);if(d)return d}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:ca(r[0],r[1],r[2],r[3]),!a))return new Ur(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new wi(a||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const a of this.args){r=a.evaluate(e);const c=kr.parse(r);if(c)return c}throw new wi(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(const a of this.args){r=a.evaluate(e);const c=Bi.parse(r);if(c)return c}throw new wi(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(const a of this.args){r=a.evaluate(e);const c=Br.parse(r);if(c)return c}throw new wi(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const a of this.args){r=a.evaluate(e);const c=Ki.parse(r);if(c)return c}throw new wi(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const c=Number(r);if(!isNaN(c))return c}throw new wi(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Hn.fromString(Wa(this.args[0].evaluate(e)));case"resolvedImage":return is.fromString(Wa(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Wa(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Ia=["Unknown","Point","LineString","Polygon"];class Uo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ia[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache.get(e);return r||(r=Ur.parse(e),this._parseColorCache.set(e,r)),r}}class Gs{constructor(e,r,a=[],c,d=new fn,f=[]){this.registry=e,this.path=a,this.key=a.map((y=>`[${y}]`)).join(""),this.scope=d,this.errors=f,this.expectedType=c,this._isConstant=r}parse(e,r,a,c,d={}){return r?this.concat(r,a,c)._parse(e,d):this._parse(e,d)}_parse(e,r){function a(c,d,f){return f==="assert"?new zn(d,[c]):f==="coerce"?new qs(d,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[c];if(d){let f=d.parse(e,this);if(!f)return null;if(this.expectedType){const y=this.expectedType,S=f.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||S.kind!=="value"){if(y.kind==="projectionDefinition"&&["string","array"].includes(S.kind)||["color","formatted","resolvedImage"].includes(y.kind)&&["value","string"].includes(S.kind)||["padding","numberArray"].includes(y.kind)&&["value","number","array"].includes(S.kind)||y.kind==="colorArray"&&["value","string","array"].includes(S.kind)||y.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(S.kind))f=a(f,y,r.typeAnnotation||"coerce");else if(this.checkSubtype(y,S))return null}else f=a(f,y,r.typeAnnotation||"assert")}if(!(f instanceof Fn)&&f.type.kind!=="resolvedImage"&&this._isConstant(f)){const y=new Uo;try{f=new Fn(f.type,f.evaluate(y))}catch(S){return this.error(S.message),null}}return f}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){const c=typeof e=="number"?this.path.concat(e):this.path,d=a?this.scope.concat(a):this.scope;return new Gs(this.registry,this._isConstant,c,r||null,d,this.errors)}error(e,...r){const a=`${this.key}${r.map((c=>`[${c}]`)).join("")}`;this.errors.push(new zi(a,e))}checkSubtype(e,r){const a=Ta(e,r);return a&&this.error(a),a}}class vi{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let d=1;d<e.length-1;d+=2){const f=e[d];if(typeof f!="string")return r.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);const y=r.parse(e[d+1],d+1);if(!y)return null;a.push([f,y])}const c=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return c?new vi(a,c):null}outputDefined(){return this.result.outputDefined()}}class $s{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new $s(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class si{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Xt),c=r.parse(e[2],2,Ri(r.expectedType||$r));return a&&c?new si(c.type.itemType,a,c):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new wi(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new wi(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new wi(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Zr{constructor(e,r){this.type=Rr,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,$r),c=r.parse(e[2],2,$r);return a&&c?po(a.type,[Rr,Er,Xt,mi,$r])?new Zr(a,c):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${gi(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!Pa(r,["boolean","string","number","null"]))throw new wi(`Expected first argument to be of type boolean, string, number or null, but found ${gi(Mi(r))} instead.`);if(!Pa(a,["string","array"]))throw new wi(`Expected second argument to be of type array or string, but found ${gi(Mi(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Ha{constructor(e,r,a){this.type=Xt,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,$r),c=r.parse(e[2],2,$r);if(!a||!c)return null;if(!po(a.type,[Rr,Er,Xt,mi,$r]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${gi(a.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,Xt);return d?new Ha(a,c,d):null}return new Ha(a,c)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Pa(r,["boolean","string","number","null"]))throw new wi(`Expected first argument to be of type boolean, string, number or null, but found ${gi(Mi(r))} instead.`);let c;if(this.fromIndex&&(c=this.fromIndex.evaluate(e)),Pa(a,["string"])){const d=a.indexOf(r,c);return d===-1?-1:[...a.slice(0,d)].length}if(Pa(a,["array"]))return a.indexOf(r,c);throw new wi(`Expected second argument to be of type array or string, but found ${gi(Mi(a))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Qr{constructor(e,r,a,c,d,f){this.inputType=e,this.type=r,this.input=a,this.cases=c,this.outputs=d,this.otherwise=f}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);const d={},f=[];for(let I=2;I<e.length-1;I+=2){let D=e[I];const R=e[I+1];Array.isArray(D)||(D=[D]);const U=r.concat(I);if(D.length===0)return U.error("Expected at least one branch label.");for(const H of D){if(typeof H!="number"&&typeof H!="string")return U.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return U.error("Numeric branch labels must be integer values.");if(a){if(U.checkSubtype(a,Mi(H)))return null}else a=Mi(H);if(d[String(H)]!==void 0)return U.error("Branch labels must be unique.");d[String(H)]=f.length}const q=r.parse(R,I,c);if(!q)return null;c=c||q.type,f.push(q)}const y=r.parse(e[1],1,$r);if(!y)return null;const S=r.parse(e[e.length-1],e.length-1,c);return S?y.type.kind!=="value"&&r.concat(1).checkSubtype(a,y.type)?null:new Qr(a,c,y,d,f,S):null}evaluate(e){const r=this.input.evaluate(e);return(Mi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class Is{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const c=[];for(let f=1;f<e.length-1;f+=2){const y=r.parse(e[f],f,Rr);if(!y)return null;const S=r.parse(e[f+1],f+1,a);if(!S)return null;c.push([y,S]),a=a||S.type}const d=r.parse(e[e.length-1],e.length-1,a);if(!d)return null;if(!a)throw new Error("Can't infer output type");return new Is(a,c,d)}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every((([e,r])=>r.outputDefined()))&&this.otherwise.outputDefined()}}class ns{constructor(e,r,a,c){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=c}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,$r),c=r.parse(e[2],2,Xt);if(!a||!c)return null;if(!po(a.type,[Ri($r),Er,$r]))return r.error(`Expected first argument to be of type array or string, but found ${gi(a.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,Xt);return d?new ns(a.type,a,c,d):null}return new ns(a.type,a,c)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);let c;if(this.endIndex&&(c=this.endIndex.evaluate(e)),Pa(r,["string"]))return[...r].slice(a,c).join("");if(Pa(r,["array"]))return r.slice(a,c);throw new wi(`Expected first argument to be of type array or string, but found ${gi(Mi(r))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Zs(i,e){const r=i.length-1;let a,c,d=0,f=r,y=0;for(;d<=f;)if(y=Math.floor((d+f)/2),a=i[y],c=i[y+1],a<=e){if(y===r||e<c)return y;d=y+1}else{if(!(a>e))throw new wi("Input is not a number.");f=y-1}return 0}class ha{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[c,d]of a)this.labels.push(c),this.outputs.push(d)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,Xt);if(!a)return null;const c=[];let d=null;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(let f=1;f<e.length;f+=2){const y=f===1?-1/0:e[f],S=e[f+1],I=f,D=f+1;if(typeof y!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(c.length&&c[c.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const R=r.parse(S,D,d);if(!R)return null;d=d||R.type,c.push([y,R])}return new ha(d,a,c)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return a[0].evaluate(e);const d=r.length;return c>=r[d-1]?a[d-1].evaluate(e):a[Zs(r,c)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function N(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ae,Ne,it=(function(){if(Ne)return ae;function i(e,r,a,c){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=a,this.p2y=c}return Ne=1,ae=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,c=0;c<8;c++){var d=this.sampleCurveX(a)-e;if(Math.abs(d)<r)return a;var f=this.sampleCurveDerivativeX(a);if(Math.abs(f)<1e-6)break;a-=d/f}var y=0,S=1;for(a=e,c=0;c<20&&(d=this.sampleCurveX(a),!(Math.abs(d-e)<r));c++)e>d?y=a:S=a,a=.5*(S-y)+y;return a},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},ae})(),pt=N(it);class Rt{constructor(e,r,a,c,d){this.type=e,this.operator=r,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(const[f,y]of d)this.labels.push(f),this.outputs.push(y)}static interpolationFactor(e,r,a,c){let d=0;if(e.name==="exponential")d=Wt(r,e.base,a,c);else if(e.name==="linear")d=Wt(r,1,a,c);else if(e.name==="cubic-bezier"){const f=e.controlPoints;d=new pt(f[0],f[1],f[2],f[3]).solve(Wt(r,1,a,c))}return d}static parse(e,r){let[a,c,d,...f]=e;if(!Array.isArray(c)||c.length===0)return r.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const I=c[1];if(typeof I!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:I}}else{if(c[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const I=c.slice(1);if(I.length!==4||I.some((D=>typeof D!="number"||D<0||D>1)))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:I}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(d=r.parse(d,2,Xt),!d)return null;const y=[];let S=null;a!=="interpolate-hcl"&&a!=="interpolate-lab"||r.expectedType==ho?r.expectedType&&r.expectedType.kind!=="value"&&(S=r.expectedType):S=Ni;for(let I=0;I<f.length;I+=2){const D=f[I],R=f[I+1],U=I+3,q=I+4;if(typeof D!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(y.length&&y[y.length-1][0]>=D)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const H=r.parse(R,q,S);if(!H)return null;S=S||H.type,y.push([D,H])}return ds(S,Xt)||ds(S,Rs)||ds(S,Ni)||ds(S,Ua)||ds(S,qa)||ds(S,ho)||ds(S,fo)||ds(S,Ri(Xt))?new Rt(S,a,c,d,y):r.error(`Type ${gi(S)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return a[0].evaluate(e);const d=r.length;if(c>=r[d-1])return a[d-1].evaluate(e);const f=Zs(r,c),y=Rt.interpolationFactor(this.interpolation,c,r[f],r[f+1]),S=a[f].evaluate(e),I=a[f+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Vs(S,I,y);case"color":return Ur.interpolate(S,I,y);case"padding":return kr.interpolate(S,I,y);case"colorArray":return Br.interpolate(S,I,y);case"numberArray":return Bi.interpolate(S,I,y);case"variableAnchorOffsetCollection":return Ki.interpolate(S,I,y);case"array":return Za(S,I,y);case"projectionDefinition":return Un.interpolate(S,I,y)}case"interpolate-hcl":switch(this.type.kind){case"color":return Ur.interpolate(S,I,y,"hcl");case"colorArray":return Br.interpolate(S,I,y,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Ur.interpolate(S,I,y,"lab");case"colorArray":return Br.interpolate(S,I,y,"lab")}}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Wt(i,e,r,a){const c=a-r,d=i-r;return c===0?0:e===1?d/c:(Math.pow(e,d)-1)/(Math.pow(e,c)-1)}const ar={color:Ur.interpolate,number:Vs,padding:kr.interpolate,numberArray:Bi.interpolate,colorArray:Br.interpolate,variableAnchorOffsetCollection:Ki.interpolate,array:Za};class Pr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a=null;const c=r.expectedType;c&&c.kind!=="value"&&(a=c);const d=[];for(const y of e.slice(1)){const S=r.parse(y,1+d.length,a,void 0,{typeAnnotation:"omit"});if(!S)return null;a=a||S.type,d.push(S)}if(!a)throw new Error("No output type");const f=c&&d.some((y=>Ta(c,y.type)));return new Pr(f?$r:a,d)}evaluate(e){let r,a=null,c=0;for(const d of this.args)if(c++,a=d.evaluate(e),a&&a instanceof is&&!a.available&&(r||(r=a.name),a=null,c===this.args.length&&(a=r)),a!==null)break;return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function Wr(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Xr(i,e,r,a){return a.compare(e,r)===0}function Or(i,e,r){const a=i!=="=="&&i!=="!=";return class Zy{constructor(d,f,y){this.type=Rr,this.lhs=d,this.rhs=f,this.collator=y,this.hasUntypedArgument=d.type.kind==="value"||f.type.kind==="value"}static parse(d,f){if(d.length!==3&&d.length!==4)return f.error("Expected two or three arguments.");const y=d[0];let S=f.parse(d[1],1,$r);if(!S)return null;if(!Wr(y,S.type))return f.concat(1).error(`"${y}" comparisons are not supported for type '${gi(S.type)}'.`);let I=f.parse(d[2],2,$r);if(!I)return null;if(!Wr(y,I.type))return f.concat(2).error(`"${y}" comparisons are not supported for type '${gi(I.type)}'.`);if(S.type.kind!==I.type.kind&&S.type.kind!=="value"&&I.type.kind!=="value")return f.error(`Cannot compare types '${gi(S.type)}' and '${gi(I.type)}'.`);a&&(S.type.kind==="value"&&I.type.kind!=="value"?S=new zn(I.type,[S]):S.type.kind!=="value"&&I.type.kind==="value"&&(I=new zn(S.type,[I])));let D=null;if(d.length===4){if(S.type.kind!=="string"&&I.type.kind!=="string"&&S.type.kind!=="value"&&I.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(D=f.parse(d[3],3,wa),!D)return null}return new Zy(S,I,D)}evaluate(d){const f=this.lhs.evaluate(d),y=this.rhs.evaluate(d);if(a&&this.hasUntypedArgument){const S=Mi(f),I=Mi(y);if(S.kind!==I.kind||S.kind!=="string"&&S.kind!=="number")throw new wi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${S.kind}, ${I.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const S=Mi(f),I=Mi(y);if(S.kind!=="string"||I.kind!=="string")return e(d,f,y)}return this.collator?r(d,f,y,this.collator.evaluate(d)):e(d,f,y)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}}}const Hi=Or("==",(function(i,e,r){return e===r}),Xr),pn=Or("!=",(function(i,e,r){return e!==r}),(function(i,e,r,a){return!Xr(0,e,r,a)})),Ei=Or("<",(function(i,e,r){return e<r}),(function(i,e,r,a){return a.compare(e,r)<0})),Ln=Or(">",(function(i,e,r){return e>r}),(function(i,e,r,a){return a.compare(e,r)>0})),Gi=Or("<=",(function(i,e,r){return e<=r}),(function(i,e,r,a){return a.compare(e,r)<=0})),Sn=Or(">=",(function(i,e,r){return e>=r}),(function(i,e,r,a){return a.compare(e,r)>=0}));class fs{constructor(e,r,a){this.type=wa,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const c=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Rr);if(!c)return null;const d=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Rr);if(!d)return null;let f=null;return a.locale&&(f=r.parse(a.locale,1,Er),!f)?null:new fs(c,d,f)}evaluate(e){return new Xl(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Ls{constructor(e,r,a,c,d){this.type=Er,this.number=e,this.locale=r,this.currency=a,this.minFractionDigits=c,this.maxFractionDigits=d}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,Xt);if(!a)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return r.error("NumberFormat options argument must be an object.");let d=null;if(c.locale&&(d=r.parse(c.locale,1,Er),!d))return null;let f=null;if(c.currency&&(f=r.parse(c.currency,1,Er),!f))return null;let y=null;if(c["min-fraction-digits"]&&(y=r.parse(c["min-fraction-digits"],1,Xt),!y))return null;let S=null;return c["max-fraction-digits"]&&(S=r.parse(c["max-fraction-digits"],1,Xt),!S)?null:new Ls(a,d,f,y,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Cs{constructor(e){this.type=Sa,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const c=[];let d=!1;for(let f=1;f<=e.length-1;++f){const y=e[f];if(d&&typeof y=="object"&&!Array.isArray(y)){d=!1;let S=null;if(y["font-scale"]&&(S=r.parse(y["font-scale"],1,Xt),!S))return null;let I=null;if(y["text-font"]&&(I=r.parse(y["text-font"],1,Ri(Er)),!I))return null;let D=null;if(y["text-color"]&&(D=r.parse(y["text-color"],1,Ni),!D))return null;let R=null;if(y["vertical-align"]){if(typeof y["vertical-align"]=="string"&&!jo.includes(y["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${y["vertical-align"]}' instead.`);if(R=r.parse(y["vertical-align"],1,Er),!R)return null}const U=c[c.length-1];U.scale=S,U.font=I,U.textColor=D,U.verticalAlign=R}else{const S=r.parse(e[f],1,$r);if(!S)return null;const I=S.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,c.push({content:S,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Cs(c)}evaluate(e){return new Hn(this.sections.map((r=>{const a=r.content.evaluate(e);return Mi(a)===Ga?new Vo("",a,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(e):null):new Vo(Wa(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null,r.verticalAlign?r.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor),r.verticalAlign&&e(r.verticalAlign)}outputDefined(){return!1}}class La{constructor(e){this.type=Ga,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const a=r.parse(e[1],1,Er);return a?new La(a):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),a=is.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}}class da{constructor(e){this.type=Xt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${gi(a.type)} instead.`):new da(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new wi(`Expected value to be of type string or array, but found ${gi(Mi(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const ki=8192;function yo(i,e){const r=(180+i[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(r*c*ki),Math.round(a*c*ki)]}function Ws(i,e){const r=Math.pow(2,e.z);return[(c=(i[0]/ki+e.x)/r,360*c-180),(a=(i[1]/ki+e.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,c}function Hs(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Qi(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function qo(i,e,r){const a=i[0]-e[0],c=i[1]-e[1],d=i[0]-r[0],f=i[1]-r[1];return a*f-d*c==0&&a*d<=0&&c*f<=0}function Ca(i,e,r,a){return(c=[a[0]-r[0],a[1]-r[1]])[0]*(d=[e[0]-i[0],e[1]-i[1]])[1]-c[1]*d[0]!=0&&!(!_l(i,e,r,a)||!_l(r,a,i,e));var c,d}function Yl(i,e,r){for(const a of r)for(let c=0;c<a.length-1;++c)if(Ca(i,e,a[c],a[c+1]))return!0;return!1}function Ma(i,e,r=!1){let a=!1;for(const y of e)for(let S=0;S<y.length-1;S++){if(qo(i,y[S],y[S+1]))return r;(d=y[S])[1]>(c=i)[1]!=(f=y[S+1])[1]>c[1]&&c[0]<(f[0]-d[0])*(c[1]-d[1])/(f[1]-d[1])+d[0]&&(a=!a)}var c,d,f;return a}function Nn(i,e){for(const r of e)if(Ma(i,r))return!0;return!1}function Ea(i,e){for(const r of i)if(!Ma(r,e))return!1;for(let r=0;r<i.length-1;++r)if(Yl(i[r],i[r+1],e))return!1;return!0}function Go(i,e){for(const r of e)if(Ea(i,r))return!0;return!1}function _l(i,e,r,a){const c=a[0]-r[0],d=a[1]-r[1],f=(i[0]-r[0])*d-c*(i[1]-r[1]),y=(e[0]-r[0])*d-c*(e[1]-r[1]);return f>0&&y<0||f<0&&y>0}function ps(i,e,r){const a=[];for(let c=0;c<i.length;c++){const d=[];for(let f=0;f<i[c].length;f++){const y=yo(i[c][f],r);Hs(e,y),d.push(y)}a.push(d)}return a}function Xa(i,e,r){const a=[];for(let c=0;c<i.length;c++){const d=ps(i[c],e,r);a.push(d)}return a}function yl(i,e,r,a){if(i[0]<r[0]||i[0]>r[2]){const c=.5*a;let d=i[0]-r[0]>c?-a:r[0]-i[0]>c?a:0;d===0&&(d=i[0]-r[2]>c?-a:r[2]-i[0]>c?a:0),i[0]+=d}Hs(e,i)}function vl(i,e,r,a){const c=Math.pow(2,a.z)*ki,d=[a.x*ki,a.y*ki],f=[];for(const y of i)for(const S of y){const I=[S.x+d[0],S.y+d[1]];yl(I,e,r,c),f.push(I)}return f}function Ya(i,e,r,a){const c=Math.pow(2,a.z)*ki,d=[a.x*ki,a.y*ki],f=[];for(const S of i){const I=[];for(const D of S){const R=[D.x+d[0],D.y+d[1]];Hs(e,R),I.push(R)}f.push(I)}if(e[2]-e[0]<=c/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const S of f)for(const I of S)yl(I,e,r,c)}var y;return f}class Ms{constructor(e,r){this.type=Rr,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Us(e[1])){const a=e[1];if(a.type==="FeatureCollection"){const c=[];for(const d of a.features){const{type:f,coordinates:y}=d.geometry;f==="Polygon"&&c.push(y),f==="MultiPolygon"&&c.push(...y)}if(c.length)return new Ms(a,{type:"MultiPolygon",coordinates:c})}else if(a.type==="Feature"){const c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Ms(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Ms(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(r,a){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(a.type==="Polygon"){const y=ps(a.coordinates,d,f),S=vl(r.geometry(),c,d,f);if(!Qi(c,d))return!1;for(const I of S)if(!Ma(I,y))return!1}if(a.type==="MultiPolygon"){const y=Xa(a.coordinates,d,f),S=vl(r.geometry(),c,d,f);if(!Qi(c,d))return!1;for(const I of S)if(!Nn(I,y))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(r,a){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(a.type==="Polygon"){const y=ps(a.coordinates,d,f),S=Ya(r.geometry(),c,d,f);if(!Qi(c,d))return!1;for(const I of S)if(!Ea(I,y))return!1}if(a.type==="MultiPolygon"){const y=Xa(a.coordinates,d,f),S=Ya(r.geometry(),c,d,f);if(!Qi(c,d))return!1;for(const I of S)if(!Go(I,y))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ms=class{constructor(i=[],e=(r,a)=>r<a?-1:r>a?1:0){if(this.data=i,this.length=this.data.length,this.compare=e,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:e,compare:r}=this,a=e[i];for(;i>0;){const c=i-1>>1,d=e[c];if(r(a,d)>=0)break;e[i]=d,i=c}e[i]=a}_down(i){const{data:e,compare:r}=this,a=this.length>>1,c=e[i];for(;i<a;){let d=1+(i<<1);const f=d+1;if(f<this.length&&r(e[f],e[d])<0&&(d=f),r(e[d],c)>=0)break;e[i]=e[d],i=d}e[i]=c}};function ss(i,e,r=0,a=i.length-1,c=ka){for(;a>r;){if(a-r>600){const S=a-r+1,I=e-r+1,D=Math.log(S),R=.5*Math.exp(2*D/3),U=.5*Math.sqrt(D*R*(S-R)/S)*(I-S/2<0?-1:1);ss(i,e,Math.max(r,Math.floor(e-I*R/S+U)),Math.min(a,Math.floor(e+(S-I)*R/S+U)),c)}const d=i[e];let f=r,y=a;for(Es(i,r,e),c(i[a],d)>0&&Es(i,r,a);f<y;){for(Es(i,f,y),f++,y--;c(i[f],d)<0;)f++;for(;c(i[y],d)>0;)y--}c(i[r],d)===0?Es(i,r,y):(y++,Es(i,y,a)),y<=e&&(r=y+1),e<=y&&(a=y-1)}}function Es(i,e,r){const a=i[e];i[e]=i[r],i[r]=a}function ka(i,e){return i<e?-1:i>e?1:0}function fa(i,e){if(i.length<=1)return[i];const r=[];let a,c;for(const d of i){const f=bl(d);f!==0&&(d.area=Math.abs(f),c===void 0&&(c=f<0),c===f<0?(a&&r.push(a),a=[d]):a.push(d))}if(a&&r.push(a),e>1)for(let d=0;d<r.length;d++)r[d].length<=e||(ss(r[d],e,1,r[d].length-1,Jl),r[d]=r[d].slice(0,e));return r}function Jl(i,e){return e.area-i.area}function bl(i){let e=0;for(let r,a,c=0,d=i.length,f=d-1;c<d;f=c++)r=i[c],a=i[f],e+=(a.x-r.x)*(r.y+a.y);return e}const ln=1/298.257223563,vo=ln*(2-ln),pa=Math.PI/180;class Xs{constructor(e){const r=6378.137*pa*1e3,a=Math.cos(e*pa),c=1/(1-vo*(1-a*a)),d=Math.sqrt(c);this.kx=r*d*a,this.ky=r*d*c*(1-vo)}distance(e,r){const a=this.wrap(e[0]-r[0])*this.kx,c=(e[1]-r[1])*this.ky;return Math.sqrt(a*a+c*c)}pointOnLine(e,r){let a,c,d,f,y=1/0;for(let S=0;S<e.length-1;S++){let I=e[S][0],D=e[S][1],R=this.wrap(e[S+1][0]-I)*this.kx,U=(e[S+1][1]-D)*this.ky,q=0;R===0&&U===0||(q=(this.wrap(r[0]-I)*this.kx*R+(r[1]-D)*this.ky*U)/(R*R+U*U),q>1?(I=e[S+1][0],D=e[S+1][1]):q>0&&(I+=R/this.kx*q,D+=U/this.ky*q)),R=this.wrap(r[0]-I)*this.kx,U=(r[1]-D)*this.ky;const H=R*R+U*U;H<y&&(y=H,a=I,c=D,d=S,f=q)}return{point:[a,c],index:d,t:Math.max(0,Math.min(1,f))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function xl(i,e){return e[0]-i[0]}function bo(i){return i[1]-i[0]+1}function as(i,e){return i[1]>=i[0]&&i[1]<e}function xo(i,e){if(i[0]>i[1])return[null,null];const r=bo(i);if(e){if(r===2)return[i,null];const c=Math.floor(r/2);return[[i[0],i[0]+c],[i[0]+c,i[1]]]}if(r===1)return[i,null];const a=Math.floor(r/2)-1;return[[i[0],i[0]+a],[i[0]+a+1,i[1]]]}function Da(i,e){if(!as(e,i.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let a=e[0];a<=e[1];++a)Hs(r,i[a]);return r}function Fa(i){const e=[1/0,1/0,-1/0,-1/0];for(const r of i)for(const a of r)Hs(e,a);return e}function za(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Na(i,e,r){if(!za(i)||!za(e))return NaN;let a=0,c=0;return i[2]<e[0]&&(a=e[0]-i[2]),i[0]>e[2]&&(a=i[0]-e[2]),i[1]>e[3]&&(c=i[1]-e[3]),i[3]<e[1]&&(c=e[1]-i[3]),r.distance([0,0],[a,c])}function gs(i,e,r){const a=r.pointOnLine(e,i);return r.distance(i,a.point)}function Ja(i,e,r,a,c){const d=Math.min(gs(i,[r,a],c),gs(e,[r,a],c)),f=Math.min(gs(r,[i,e],c),gs(a,[i,e],c));return Math.min(d,f)}function Ys(i,e,r,a,c){if(!as(e,i.length)||!as(a,r.length))return 1/0;let d=1/0;for(let f=e[0];f<e[1];++f){const y=i[f],S=i[f+1];for(let I=a[0];I<a[1];++I){const D=r[I],R=r[I+1];if(Ca(y,S,D,R))return 0;d=Math.min(d,Ja(y,S,D,R,c))}}return d}function ma(i,e,r,a,c){if(!as(e,i.length)||!as(a,r.length))return NaN;let d=1/0;for(let f=e[0];f<=e[1];++f)for(let y=a[0];y<=a[1];++y)if(d=Math.min(d,c.distance(i[f],r[y])),d===0)return d;return d}function Si(i,e,r){if(Ma(i,e,!0))return 0;let a=1/0;for(const c of e){const d=c[0],f=c[c.length-1];if(d!==f&&(a=Math.min(a,gs(i,[f,d],r)),a===0))return a;const y=r.pointOnLine(c,i);if(a=Math.min(a,r.distance(i,y.point)),a===0)return a}return a}function Di(i,e,r,a){if(!as(e,i.length))return NaN;for(let d=e[0];d<=e[1];++d)if(Ma(i[d],r,!0))return 0;let c=1/0;for(let d=e[0];d<e[1];++d){const f=i[d],y=i[d+1];for(const S of r)for(let I=0,D=S.length,R=D-1;I<D;R=I++){const U=S[R],q=S[I];if(Ca(f,y,U,q))return 0;c=Math.min(c,Ja(f,y,U,q,a))}}return c}function cn(i,e){for(const r of i)for(const a of r)if(Ma(a,e,!0))return!0;return!1}function Cn(i,e,r,a=1/0){const c=Fa(i),d=Fa(e);if(a!==1/0&&Na(c,d,r)>=a)return a;if(Qi(c,d)){if(cn(i,e))return 0}else if(cn(e,i))return 0;let f=1/0;for(const y of i)for(let S=0,I=y.length,D=I-1;S<I;D=S++){const R=y[D],U=y[S];for(const q of e)for(let H=0,X=q.length,K=X-1;H<X;K=H++){const de=q[K],ze=q[H];if(Ca(R,U,de,ze))return 0;f=Math.min(f,Ja(R,U,de,ze,r))}}return f}function ai(i,e,r,a,c,d){if(!d)return;const f=Na(Da(a,d),c,r);f<e&&i.push([f,d,[0,0]])}function wo(i,e,r,a,c,d,f){if(!d||!f)return;const y=Na(Da(a,d),Da(c,f),r);y<e&&i.push([y,d,f])}function Ka(i,e,r,a,c=1/0){let d=Math.min(a.distance(i[0],r[0][0]),c);if(d===0)return d;const f=new ms([[0,[0,i.length-1],[0,0]]],xl),y=Fa(r);for(;f.length>0;){const S=f.pop();if(S[0]>=d)continue;const I=S[1],D=e?50:100;if(bo(I)<=D){if(!as(I,i.length))return NaN;if(e){const R=Di(i,I,r,a);if(isNaN(R)||R===0)return R;d=Math.min(d,R)}else for(let R=I[0];R<=I[1];++R){const U=Si(i[R],r,a);if(d=Math.min(d,U),d===0)return 0}}else{const R=xo(I,e);ai(f,d,a,i,y,R[0]),ai(f,d,a,i,y,R[1])}}return d}function $o(i,e,r,a,c,d=1/0){let f=Math.min(d,c.distance(i[0],r[0]));if(f===0)return f;const y=new ms([[0,[0,i.length-1],[0,r.length-1]]],xl);for(;y.length>0;){const S=y.pop();if(S[0]>=f)continue;const I=S[1],D=S[2],R=e?50:100,U=a?50:100;if(bo(I)<=R&&bo(D)<=U){if(!as(I,i.length)&&as(D,r.length))return NaN;let q;if(e&&a)q=Ys(i,I,r,D,c),f=Math.min(f,q);else if(e&&!a){const H=i.slice(I[0],I[1]+1);for(let X=D[0];X<=D[1];++X)if(q=gs(r[X],H,c),f=Math.min(f,q),f===0)return f}else if(!e&&a){const H=r.slice(D[0],D[1]+1);for(let X=I[0];X<=I[1];++X)if(q=gs(i[X],H,c),f=Math.min(f,q),f===0)return f}else q=ma(i,I,r,D,c),f=Math.min(f,q)}else{const q=xo(I,e),H=xo(D,a);wo(y,f,c,i,r,q[0],H[0]),wo(y,f,c,i,r,q[0],H[1]),wo(y,f,c,i,r,q[1],H[0]),wo(y,f,c,i,r,q[1],H[1])}}return f}function Sc(i){return i.type==="MultiPolygon"?i.coordinates.map((e=>({type:"Polygon",coordinates:e}))):i.type==="MultiLineString"?i.coordinates.map((e=>({type:"LineString",coordinates:e}))):i.type==="MultiPoint"?i.coordinates.map((e=>({type:"Point",coordinates:e}))):[i]}class So{constructor(e,r){this.type=Xt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Us(e[1])){const a=e[1];if(a.type==="FeatureCollection")return new So(a,a.features.map((c=>Sc(c.geometry))).flat());if(a.type==="Feature")return new So(a,Sc(a.geometry));if("type"in a&&"coordinates"in a)return new So(a,Sc(a))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(r,a){const c=r.geometry(),d=c.flat().map((S=>Ws([S.x,S.y],r.canonical)));if(c.length===0)return NaN;const f=new Xs(d[0][1]);let y=1/0;for(const S of a){switch(S.type){case"Point":y=Math.min(y,$o(d,!1,[S.coordinates],!1,f,y));break;case"LineString":y=Math.min(y,$o(d,!1,S.coordinates,!0,f,y));break;case"Polygon":y=Math.min(y,Ka(d,!1,S.coordinates,f,y))}if(y===0)return y}return y})(e,this.geometries);if(e.geometryType()==="LineString")return(function(r,a){const c=r.geometry(),d=c.flat().map((S=>Ws([S.x,S.y],r.canonical)));if(c.length===0)return NaN;const f=new Xs(d[0][1]);let y=1/0;for(const S of a){switch(S.type){case"Point":y=Math.min(y,$o(d,!0,[S.coordinates],!1,f,y));break;case"LineString":y=Math.min(y,$o(d,!0,S.coordinates,!0,f,y));break;case"Polygon":y=Math.min(y,Ka(d,!0,S.coordinates,f,y))}if(y===0)return y}return y})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(r,a){const c=r.geometry();if(c.length===0||c[0].length===0)return NaN;const d=fa(c,0).map((S=>S.map((I=>I.map((D=>Ws([D.x,D.y],r.canonical))))))),f=new Xs(d[0][0][0][1]);let y=1/0;for(const S of a)for(const I of d){switch(S.type){case"Point":y=Math.min(y,Ka([S.coordinates],!1,I,f,y));break;case"LineString":y=Math.min(y,Ka(S.coordinates,!0,I,f,y));break;case"Polygon":y=Math.min(y,Cn(I,S.coordinates,f,y))}if(y===0)return y}return y})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class wl{constructor(e){this.type=$r,this.key=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=e[1];return a==null?r.error("Global state property must be defined."):typeof a!="string"?r.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new wl(a)}evaluate(e){var r;const a=(r=e.globals)===null||r===void 0?void 0:r.globalState;return a&&Object.keys(a).length!==0?mo(a,this.key):null}eachChild(){}outputDefined(){return!1}}const Zo={"==":Hi,"!=":pn,">":Ln,"<":Ei,">=":Sn,"<=":Gi,array:zn,at:si,boolean:zn,case:Is,coalesce:Pr,collator:fs,format:Cs,image:La,in:Zr,"index-of":Ha,interpolate:Rt,"interpolate-hcl":Rt,"interpolate-lab":Rt,length:da,let:vi,literal:Fn,match:Qr,number:zn,"number-format":Ls,object:zn,slice:ns,step:ha,string:zn,"to-boolean":qs,"to-color":qs,"to-number":qs,"to-string":qs,var:$s,within:Ms,distance:So,"global-state":wl};class ks{constructor(e,r,a,c){this.name=e,this.type=r,this._evaluate=a,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const a=e[0],c=ks.definitions[a];if(!c)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(c)?c[0]:c.type,f=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,y=f.filter((([I])=>!Array.isArray(I)||I.length===e.length-1));let S=null;for(const[I,D]of y){S=new Gs(r.registry,Kl,r.path,null,r.scope);const R=[];let U=!1;for(let q=1;q<e.length;q++){const H=e[q],X=Array.isArray(I)?I[q-1]:I.type,K=S.parse(H,1+R.length,X);if(!K){U=!0;break}R.push(K)}if(!U)if(Array.isArray(I)&&I.length!==R.length)S.error(`Expected ${I.length} arguments, but found ${R.length} instead.`);else{for(let q=0;q<R.length;q++){const H=Array.isArray(I)?I[q]:I.type,X=R[q];S.concat(q+1).checkSubtype(H,X.type)}if(S.errors.length===0)return new ks(a,d,D,R)}}if(y.length===1)r.errors.push(...S.errors);else{const I=(y.length?y:f).map((([R])=>{return U=R,Array.isArray(U)?`(${U.map(gi).join(", ")})`:`(${gi(U.type)}...)`;var U})).join(" | "),D=[];for(let R=1;R<e.length;R++){const U=r.parse(e[R],1+D.length);if(!U)return null;D.push(gi(U.type))}r.error(`Expected arguments of type ${I}, but found (${D.join(", ")}) instead.`)}return null}static register(e,r){ks.definitions=r;for(const a in r)e[a]=ks}}function Yc(i,[e,r,a,c]){e=e.evaluate(i),r=r.evaluate(i),a=a.evaluate(i);const d=c?c.evaluate(i):1,f=ca(e,r,a,d);if(f)throw new wi(f);return new Ur(e/255,r/255,a/255,d,!1)}function Sl(i,e){return i in e}function Tc(i,e){const r=e[i];return r===void 0?null:r}function To(i){return{type:i}}function Kl(i){if(i instanceof $s)return Kl(i.boundExpression);if(i instanceof ks&&i.name==="error"||i instanceof fs||i instanceof Ms||i instanceof So||i instanceof wl)return!1;const e=i instanceof qs||i instanceof zn;let r=!0;return i.eachChild((a=>{r=e?r&&Kl(a):r&&a instanceof Fn})),!!r&&Ql(i)&&ec(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Ql(i){if(i instanceof ks&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Ms||i instanceof So)return!1;let e=!0;return i.eachChild((r=>{e&&!Ql(r)&&(e=!1)})),e}function Tl(i){if(i instanceof ks&&i.name==="feature-state")return!1;let e=!0;return i.eachChild((r=>{e&&!Tl(r)&&(e=!1)})),e}function ec(i,e){if(i instanceof ks&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild((a=>{r&&!ec(a,e)&&(r=!1)})),r}function Jc(i){return{result:"success",value:i}}function Wo(i){return{result:"error",value:i}}function Po(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function tc(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function os(i){return!!i.expression&&i.expression.interpolated}function qr(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Ho(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&Mi(i)===Dn}function Pc(i){return i}function Kc(i,e){const r=i.stops&&typeof i.stops[0][0]=="object",a=r||!(r||i.property!==void 0),c=i.type||(os(e)?"exponential":"interval"),d=(function(D){switch(D.type){case"color":return Ur.parse;case"padding":return kr.parse;case"numberArray":return Bi.parse;case"colorArray":return Br.parse;default:return null}})(e);if(d&&((i=wr({},i)).stops&&(i.stops=i.stops.map((D=>[D[0],d(D[1])]))),i.default=d(i.default?i.default:e.default)),i.colorSpace&&(f=i.colorSpace)!=="rgb"&&f!=="hcl"&&f!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var f;const y=(function(D){switch(D){case"exponential":return eu;case"interval":return Qc;case"categorical":return Ac;case"identity":return tu;default:throw new Error(`Unknown function type "${D}"`)}})(c);let S,I;if(c==="categorical"){S=Object.create(null);for(const D of i.stops)S[D[0]]=D[1];I=typeof i.stops[0][0]}if(r){const D={},R=[];for(let H=0;H<i.stops.length;H++){const X=i.stops[H],K=X[0].zoom;D[K]===void 0&&(D[K]={zoom:K,type:i.type,property:i.property,default:i.default,stops:[]},R.push(K)),D[K].stops.push([X[0].value,X[1]])}const U=[];for(const H of R)U.push([D[H].zoom,Kc(D[H],e)]);const q={name:"linear"};return{kind:"composite",interpolationType:q,interpolationFactor:Rt.interpolationFactor.bind(void 0,q),zoomStops:U.map((H=>H[0])),evaluate:({zoom:H},X)=>eu({stops:U,base:i.base},e,H).evaluate(H,X)}}if(a){const D=c==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:Rt.interpolationFactor.bind(void 0,D),zoomStops:i.stops.map((R=>R[0])),evaluate:({zoom:R})=>y(i,e,R,S,I)}}return{kind:"source",evaluate(D,R){const U=R&&R.properties?R.properties[i.property]:void 0;return U===void 0?Ao(i.default,e.default):y(i,e,U,S,I)}}}function Ao(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function Ac(i,e,r,a,c){return Ao(typeof r===c?a[r]:void 0,i.default,e.default)}function Qc(i,e,r){if(qr(r)!=="number")return Ao(i.default,e.default);const a=i.stops.length;if(a===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[a-1][0])return i.stops[a-1][1];const c=Zs(i.stops.map((d=>d[0])),r);return i.stops[c][1]}function eu(i,e,r){const a=i.base!==void 0?i.base:1;if(qr(r)!=="number")return Ao(i.default,e.default);const c=i.stops.length;if(c===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[c-1][0])return i.stops[c-1][1];const d=Zs(i.stops.map((D=>D[0])),r),f=(function(D,R,U,q){const H=q-U,X=D-U;return H===0?0:R===1?X/H:(Math.pow(R,X)-1)/(Math.pow(R,H)-1)})(r,a,i.stops[d][0],i.stops[d+1][0]),y=i.stops[d][1],S=i.stops[d+1][1],I=ar[e.type]||Pc;return typeof y.evaluate=="function"?{evaluate(...D){const R=y.evaluate.apply(void 0,D),U=S.evaluate.apply(void 0,D);if(R!==void 0&&U!==void 0)return I(R,U,f,i.colorSpace)}}:I(y,S,f,i.colorSpace)}function tu(i,e,r){switch(e.type){case"color":r=Ur.parse(r);break;case"formatted":r=Hn.fromString(r.toString());break;case"resolvedImage":r=is.fromString(r.toString());break;case"padding":r=kr.parse(r);break;case"colorArray":r=Br.parse(r);break;case"numberArray":r=Bi.parse(r);break;default:qr(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Ao(r,i.default,e.default)}ks.register(Zo,{error:[{kind:"error"},[Er],(i,[e])=>{throw new wi(e.evaluate(i))}],typeof:[Er,[$r],(i,[e])=>gi(Mi(e.evaluate(i)))],"to-rgba":[Ri(Xt,4),[Ni],(i,[e])=>{const[r,a,c,d]=e.evaluate(i).rgb;return[255*r,255*a,255*c,d]}],rgb:[Ni,[Xt,Xt,Xt],Yc],rgba:[Ni,[Xt,Xt,Xt,Xt],Yc],has:{type:Rr,overloads:[[[Er],(i,[e])=>Sl(e.evaluate(i),i.properties())],[[Er,Dn],(i,[e,r])=>Sl(e.evaluate(i),r.evaluate(i))]]},get:{type:$r,overloads:[[[Er],(i,[e])=>Tc(e.evaluate(i),i.properties())],[[Er,Dn],(i,[e,r])=>Tc(e.evaluate(i),r.evaluate(i))]]},"feature-state":[$r,[Er],(i,[e])=>Tc(e.evaluate(i),i.featureState||{})],properties:[Dn,[],i=>i.properties()],"geometry-type":[Er,[],i=>i.geometryType()],id:[$r,[],i=>i.id()],zoom:[Xt,[],i=>i.globals.zoom],"heatmap-density":[Xt,[],i=>i.globals.heatmapDensity||0],elevation:[Xt,[],i=>i.globals.elevation||0],"line-progress":[Xt,[],i=>i.globals.lineProgress||0],accumulated:[$r,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Xt,To(Xt),(i,e)=>{let r=0;for(const a of e)r+=a.evaluate(i);return r}],"*":[Xt,To(Xt),(i,e)=>{let r=1;for(const a of e)r*=a.evaluate(i);return r}],"-":{type:Xt,overloads:[[[Xt,Xt],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Xt],(i,[e])=>-e.evaluate(i)]]},"/":[Xt,[Xt,Xt],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Xt,[Xt,Xt],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Xt,[],()=>Math.LN2],pi:[Xt,[],()=>Math.PI],e:[Xt,[],()=>Math.E],"^":[Xt,[Xt,Xt],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Xt,[Xt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Xt,[Xt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Xt,[Xt],(i,[e])=>Math.log(e.evaluate(i))],log2:[Xt,[Xt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Xt,[Xt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Xt,[Xt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Xt,[Xt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Xt,[Xt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Xt,[Xt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Xt,[Xt],(i,[e])=>Math.atan(e.evaluate(i))],min:[Xt,To(Xt),(i,e)=>Math.min(...e.map((r=>r.evaluate(i))))],max:[Xt,To(Xt),(i,e)=>Math.max(...e.map((r=>r.evaluate(i))))],abs:[Xt,[Xt],(i,[e])=>Math.abs(e.evaluate(i))],round:[Xt,[Xt],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Xt,[Xt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Xt,[Xt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Rr,[Er,$r],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[Rr,[$r],(i,[e])=>i.id()===e.value],"filter-type-==":[Rr,[Er],(i,[e])=>i.geometryType()===e.value],"filter-<":[Rr,[Er,$r],(i,[e,r])=>{const a=i.properties()[e.value],c=r.value;return typeof a==typeof c&&a<c}],"filter-id-<":[Rr,[$r],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[Rr,[Er,$r],(i,[e,r])=>{const a=i.properties()[e.value],c=r.value;return typeof a==typeof c&&a>c}],"filter-id->":[Rr,[$r],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[Rr,[Er,$r],(i,[e,r])=>{const a=i.properties()[e.value],c=r.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[Rr,[$r],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[Rr,[Er,$r],(i,[e,r])=>{const a=i.properties()[e.value],c=r.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[Rr,[$r],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[Rr,[$r],(i,[e])=>e.value in i.properties()],"filter-has-id":[Rr,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Rr,[Ri(Er)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Rr,[Ri($r)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Rr,[Er,Ri($r)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Rr,[Er,Ri($r)],(i,[e,r])=>(function(a,c,d,f){for(;d<=f;){const y=d+f>>1;if(c[y]===a)return!0;c[y]>a?f=y-1:d=y+1}return!1})(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Rr,overloads:[[[Rr,Rr],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[To(Rr),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Rr,overloads:[[[Rr,Rr],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[To(Rr),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[Rr,[Rr],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Rr,[Er],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[Er,[Er],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Er,[Er],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Er,To($r),(i,e)=>e.map((r=>Wa(r.evaluate(i)))).join("")],"resolved-locale":[Er,[wa],(i,[e])=>e.evaluate(i).resolvedLocale()]});class rc{constructor(e,r,a){this.expression=e,this._warningHistory={},this._evaluator=new Uo,this._defaultValue=r?(function(c){if(c.type==="color"&&Ho(c.default))return new Ur(0,0,0,0);switch(c.type){case"color":return Ur.parse(c.default)||null;case"padding":return kr.parse(c.default)||null;case"numberArray":return Bi.parse(c.default)||null;case"colorArray":return Br.parse(c.default)||null;case"variableAnchorOffsetCollection":return Ki.parse(c.default)||null;case"projectionDefinition":return Un.parse(c.default)||null;default:return c.default===void 0?null:c.default}})(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this._globalState=a}evaluateWithoutErrorHandling(e,r,a,c,d,f){return this._globalState&&(e=Yo(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=c,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,c,d,f){this._globalState&&(e=Yo(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new wi(`Expected value to be one of ${Object.keys(this._enumValues).map((S=>JSON.stringify(S))).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function Qa(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Zo}function Xo(i,e,r){const a=new Gs(Zo,Kl,[],e?(function(d){const f={color:Ni,string:Er,number:Xt,enum:Er,boolean:Rr,formatted:Sa,padding:Ua,numberArray:qa,colorArray:ho,projectionDefinition:Rs,resolvedImage:Ga,variableAnchorOffsetCollection:fo};return d.type==="array"?Ri(f[d.value]||$r,d.length):f[d.type]})(e):void 0),c=a.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Jc(new rc(c,e,r)):Wo(a.errors)}class Ic{constructor(e,r,a){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Tl(r.expression),this.globalStateRefs=Io(r.expression),this._globalState=a}evaluateWithoutErrorHandling(e,r,a,c,d,f){return this._globalState&&(e=Yo(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,r,a,c,d,f)}evaluate(e,r,a,c,d,f){return this._globalState&&(e=Yo(e,this._globalState)),this._styleExpression.evaluate(e,r,a,c,d,f)}}class ru{constructor(e,r,a,c,d){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Tl(r.expression),this.globalStateRefs=Io(r.expression),this.interpolationType=c,this._globalState=d}evaluateWithoutErrorHandling(e,r,a,c,d,f){return this._globalState&&(e=Yo(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,r,a,c,d,f)}evaluate(e,r,a,c,d,f){return this._globalState&&(e=Yo(e,this._globalState)),this._styleExpression.evaluate(e,r,a,c,d,f)}interpolationFactor(e,r,a){return this.interpolationType?Rt.interpolationFactor(this.interpolationType,e,r,a):0}}function Lc(i,e,r){const a=Xo(i,e,r);if(a.result==="error")return a;const c=a.value.expression,d=Ql(c);if(!d&&!Po(e))return Wo([new zi("","data expressions not supported")]);const f=ec(c,["zoom"]);if(!f&&!tc(e))return Wo([new zi("","zoom expressions not supported")]);const y=Mc(c);return y||f?y instanceof zi?Wo([y]):y instanceof Rt&&!os(e)?Wo([new zi("",'"interpolate" expressions cannot be used with this property')]):Jc(y?new ru(d?"camera":"composite",a.value,y.labels,y instanceof Rt?y.interpolation:void 0,r):new Ic(d?"constant":"source",a.value,r)):Wo([new zi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Cc{constructor(e,r){this._parameters=e,this._specification=r,wr(this,Kc(this._parameters,this._specification))}static deserialize(e){return new Cc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Mc(i){let e=null;if(i instanceof vi)e=Mc(i.result);else if(i instanceof Pr){for(const r of i.args)if(e=Mc(r),e)break}else(i instanceof ha||i instanceof Rt)&&i.input instanceof ks&&i.input.name==="zoom"&&(e=i);return e instanceof zi||i.eachChild((r=>{const a=Mc(r);a instanceof zi?e=a:!e&&a?e=new zi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new zi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function Io(i,e=new Set){return i instanceof wl&&e.add(i.key),i.eachChild((r=>{Io(r,e)})),e}function Yo(i,e){const{zoom:r,heatmapDensity:a,elevation:c,lineProgress:d,isSupportedScript:f,accumulated:y}=i??{};return{zoom:r,heatmapDensity:a,elevation:c,lineProgress:d,isSupportedScript:f,accumulated:y,globalState:e}}function iu(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!iu(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const nu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Jo(i,e){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};iu(i)||(i=nc(i));const r=Xo(i,nu,e);if(r.result==="error")throw new Error(r.value.map((a=>`${a.key}: ${a.message}`)).join(", "));return{filter:(a,c,d)=>r.value.evaluate(a,c,{},d),needGeometry:Iu(i),getGlobalStateRefs:()=>Io(r.value.expression)}}function ic(i,e){return i<e?-1:i>e?1:0}function Iu(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(Iu(i[e]))return!0;return!1}function nc(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?sc(i[1],i[2],"=="):e==="!="?ac(sc(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?sc(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(nc))):e==="all"?["all"].concat(i.slice(1).map(nc)):e==="none"?["all"].concat(i.slice(1).map(nc).map(ac)):e==="in"?Lu(i[1],i.slice(2)):e==="!in"?ac(Lu(i[1],i.slice(2))):e==="has"?Cu(i[1]):e!=="!has"||ac(Cu(i[1]));var r}function sc(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function Lu(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((r=>typeof r!=typeof e[0]))?["filter-in-large",i,["literal",e.sort(ic)]]:["filter-in-small",i,["literal",e]]}}function Cu(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function ac(i){return["!",i]}function Ec(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let c="[";for(const d of i)c+=`${Ec(d)},`;return`${c}]`}const r=Object.keys(i).sort();let a="{";for(let c=0;c<r.length;c++)a+=`${JSON.stringify(r[c])}:${Ec(i[r[c]])},`;return`${a}}`}function eo(i){let e="";for(const r of ot)e+=`/${Ec(i[r])}`;return e}function Js(i){const e=i.value;return e?[new Lt(i.key,e,"constants have been deprecated as of v8")]:[]}function Ti(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ko(i){if(Array.isArray(i))return i.map(Ko);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Ko(i[r]);return e}return Ti(i)}function _s(i){const e=i.key,r=i.value,a=i.valueSpec||{},c=i.objectElementValidators||{},d=i.style,f=i.styleSpec,y=i.validateSpec;let S=[];const I=qr(r);if(I!=="object")return[new Lt(e,r,`object expected, ${I} found`)];for(const D in r){const R=D.split(".")[0],U=mo(a,R)||a["*"];let q;if(mo(c,R))q=c[R];else if(mo(a,R)){if(r[D]===void 0)continue;q=y}else if(c["*"])q=c["*"];else{if(!a["*"]){S.push(new Lt(e,r[D],`unknown property "${D}"`));continue}q=y}S=S.concat(q({key:(e&&`${e}.`)+D,value:r[D],valueSpec:U,style:d,styleSpec:f,object:r,objectKey:D,validateSpec:y},r))}for(const D in a)c[D]||a[D].required&&a[D].default===void 0&&r[D]===void 0&&S.push(new Lt(e,r,`missing required property "${D}"`));return S}function ga(i){const e=i.value,r=i.valueSpec,a=i.style,c=i.styleSpec,d=i.key,f=i.arrayElementValidator||i.validateSpec;if(qr(e)!=="array")return[new Lt(d,e,`array expected, ${qr(e)} found`)];if(r.length&&e.length!==r.length)return[new Lt(d,e,`array length ${r.length} expected, length ${e.length} found`)];let y={type:r.value,values:r.values};c.$version<7&&(y.function=r.function),qr(r.value)==="object"&&(y=r.value);let S=[];for(let I=0;I<e.length;I++)S=S.concat(f({array:e,arrayIndex:I,value:e[I],valueSpec:y,validateSpec:i.validateSpec,style:a,styleSpec:c,key:`${d}[${I}]`}));return S}function Yn(i){const e=i.key,r=i.value,a=i.valueSpec;let c=qr(r);return c==="number"&&r!=r&&(c="NaN"),c!=="number"?[new Lt(e,r,`number expected, ${c} found`)]:"minimum"in a&&r<a.minimum?[new Lt(e,r,`${r} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&r>a.maximum?[new Lt(e,r,`${r} is greater than the maximum value ${a.maximum}`)]:[]}function kc(i){const e=i.valueSpec,r=Ti(i.value.type);let a,c,d,f={};const y=r!=="categorical"&&i.value.property===void 0,S=!y,I=qr(i.value.stops)==="array"&&qr(i.value.stops[0])==="array"&&qr(i.value.stops[0][0])==="object",D=_s({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(q){if(r==="identity")return[new Lt(q.key,q.value,'identity function may not have a "stops" property')];let H=[];const X=q.value;return H=H.concat(ga({key:q.key,value:X,valueSpec:q.valueSpec,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:R})),qr(X)==="array"&&X.length===0&&H.push(new Lt(q.key,X,"array must have at least one stop")),H},default:function(q){return q.validateSpec({key:q.key,value:q.value,valueSpec:e,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec})}}});return r==="identity"&&y&&D.push(new Lt(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||D.push(new Lt(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!os(i.valueSpec)&&D.push(new Lt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(S&&!Po(i.valueSpec)?D.push(new Lt(i.key,i.value,"property functions not supported")):y&&!tc(i.valueSpec)&&D.push(new Lt(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!I||i.value.property!==void 0||D.push(new Lt(i.key,i.value,'"property" property is required')),D;function R(q){let H=[];const X=q.value,K=q.key;if(qr(X)!=="array")return[new Lt(K,X,`array expected, ${qr(X)} found`)];if(X.length!==2)return[new Lt(K,X,`array length 2 expected, length ${X.length} found`)];if(I){if(qr(X[0])!=="object")return[new Lt(K,X,`object expected, ${qr(X[0])} found`)];if(X[0].zoom===void 0)return[new Lt(K,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new Lt(K,X,"object stop key must have value")];if(d&&d>Ti(X[0].zoom))return[new Lt(K,X[0].zoom,"stop zoom values must appear in ascending order")];Ti(X[0].zoom)!==d&&(d=Ti(X[0].zoom),c=void 0,f={}),H=H.concat(_s({key:`${K}[0]`,value:X[0],valueSpec:{zoom:{}},validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:Yn,value:U}}))}else H=H.concat(U({key:`${K}[0]`,value:X[0],validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec},X));return Qa(Ko(X[1]))?H.concat([new Lt(`${K}[1]`,X[1],"expressions are not allowed in function stops.")]):H.concat(q.validateSpec({key:`${K}[1]`,value:X[1],valueSpec:e,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec}))}function U(q,H){const X=qr(q.value),K=Ti(q.value),de=q.value!==null?q.value:H;if(a){if(X!==a)return[new Lt(q.key,de,`${X} stop domain type must match previous stop domain type ${a}`)]}else a=X;if(X!=="number"&&X!=="string"&&X!=="boolean")return[new Lt(q.key,de,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&r!=="categorical"){let ze=`number expected, ${X} found`;return Po(e)&&r===void 0&&(ze+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Lt(q.key,de,ze)]}return r!=="categorical"||X!=="number"||isFinite(K)&&Math.floor(K)===K?r!=="categorical"&&X==="number"&&c!==void 0&&K<c?[new Lt(q.key,de,"stop domain values must appear in ascending order")]:(c=K,r==="categorical"&&K in f?[new Lt(q.key,de,"stop domain values must be unique")]:(f[K]=!0,[])):[new Lt(q.key,de,`integer expected, found ${K}`)]}}function Lo(i){const e=(i.expressionContext==="property"?Lc:Xo)(Ko(i.value),i.valueSpec);if(e.result==="error")return e.value.map((a=>new Lt(`${i.key}${a.key}`,i.value,a.message)));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Lt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Tl(r))return[new Lt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Tl(r))return[new Lt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ec(r,["zoom","feature-state"]))return[new Lt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Ql(r))return[new Lt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Pl(i){const e=i.key,r=i.value,a=qr(r);return a!=="string"?[new Lt(e,r,`color expected, ${a} found`)]:Ur.parse(String(r))?[]:[new Lt(e,r,`color expected, "${r}" found`)]}function Co(i){const e=i.key,r=i.value,a=i.valueSpec,c=[];return Array.isArray(a.values)?a.values.indexOf(Ti(r))===-1&&c.push(new Lt(e,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(Ti(r))===-1&&c.push(new Lt(e,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),c}function Qo(i){return iu(Ko(i.value))?Lo(wr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):su(i)}function su(i){const e=i.value,r=i.key;if(qr(e)!=="array")return[new Lt(r,e,`array expected, ${qr(e)} found`)];const a=i.styleSpec;let c,d=[];if(e.length<1)return[new Lt(r,e,"filter array must have at least 1 element")];switch(d=d.concat(Co({key:`${r}[0]`,value:e[0],valueSpec:a.filter_operator,style:i.style,styleSpec:i.styleSpec})),Ti(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Ti(e[1])==="$type"&&d.push(new Lt(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new Lt(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=qr(e[1]),c!=="string"&&d.push(new Lt(`${r}[1]`,e[1],`string expected, ${c} found`)));for(let f=2;f<e.length;f++)c=qr(e[f]),Ti(e[1])==="$type"?d=d.concat(Co({key:`${r}[${f}]`,value:e[f],valueSpec:a.geometry_type,style:i.style,styleSpec:i.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&d.push(new Lt(`${r}[${f}]`,e[f],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let f=1;f<e.length;f++)d=d.concat(su({key:`${r}[${f}]`,value:e[f],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":c=qr(e[1]),e.length!==2?d.push(new Lt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&d.push(new Lt(`${r}[1]`,e[1],`string expected, ${c} found`))}return d}function Mu(i,e){const r=i.key,a=i.validateSpec,c=i.style,d=i.styleSpec,f=i.value,y=i.objectKey,S=d[`${e}_${i.layerType}`];if(!S)return[];const I=y.match(/^(.*)-transition$/);if(e==="paint"&&I&&S[I[1]]&&S[I[1]].transition)return a({key:r,value:f,valueSpec:d.transition,style:c,styleSpec:d});const D=i.valueSpec||S[y];if(!D)return[new Lt(r,f,`unknown property "${y}"`)];let R;if(qr(f)==="string"&&Po(D)&&!D.tokens&&(R=/^{([^}]+)}$/.exec(f)))return[new Lt(r,f,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const U=[];return i.layerType==="symbol"&&y==="text-font"&&Ho(Ko(f))&&Ti(f.type)==="identity"&&U.push(new Lt(r,f,'"text-font" does not support identity functions')),U.concat(a({key:i.key,value:f,valueSpec:D,style:c,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:y}))}function oc(i){return Mu(i,"paint")}function lc(i){return Mu(i,"layout")}function Al(i){let e=[];const r=i.value,a=i.key,c=i.style,d=i.styleSpec;if(qr(r)!=="object")return[new Lt(a,r,`object expected, ${qr(r)} found`)];r.type||r.ref||e.push(new Lt(a,r,'either "type" or "ref" is required'));let f=Ti(r.type);const y=Ti(r.ref);if(r.id){const S=Ti(r.id);for(let I=0;I<i.arrayIndex;I++){const D=c.layers[I];Ti(D.id)===S&&e.push(new Lt(a,r.id,`duplicate layer id "${r.id}", previously used at line ${D.id.__line__}`))}}if("ref"in r){let S;["type","source","source-layer","filter","layout"].forEach((I=>{I in r&&e.push(new Lt(a,r[I],`"${I}" is prohibited for ref layers`))})),c.layers.forEach((I=>{Ti(I.id)===y&&(S=I)})),S?S.ref?e.push(new Lt(a,r.ref,"ref cannot reference another ref layer")):f=Ti(S.type):e.push(new Lt(a,r.ref,`ref layer "${y}" not found`))}else if(f!=="background")if(r.source){const S=c.sources&&c.sources[r.source],I=S&&Ti(S.type);S?I==="vector"&&f==="raster"?e.push(new Lt(a,r.source,`layer "${r.id}" requires a raster source`)):I!=="raster-dem"&&f==="hillshade"||I!=="raster-dem"&&f==="color-relief"?e.push(new Lt(a,r.source,`layer "${r.id}" requires a raster-dem source`)):I==="raster"&&f!=="raster"?e.push(new Lt(a,r.source,`layer "${r.id}" requires a vector source`)):I!=="vector"||r["source-layer"]?I==="raster-dem"&&f!=="hillshade"&&f!=="color-relief"?e.push(new Lt(a,r.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):f!=="line"||!r.paint||!r.paint["line-gradient"]||I==="geojson"&&S.lineMetrics||e.push(new Lt(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Lt(a,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Lt(a,r.source,`source "${r.source}" not found`))}else e.push(new Lt(a,r,'missing required property "source"'));return e=e.concat(_s({key:a,value:r,valueSpec:d.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${a}.type`,value:r.type,valueSpec:d.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:Qo,layout:S=>_s({layer:r,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":I=>lc(wr({layerType:f},I))}}),paint:S=>_s({layer:r,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":I=>oc(wr({layerType:f},I))}})}})),e}function Ra(i){const e=i.value,r=i.key,a=qr(e);return a!=="string"?[new Lt(r,e,`string expected, ${a} found`)]:[]}const au={promoteId:function({key:i,value:e}){if(qr(e)==="string")return Ra({key:i,value:e});{const r=[];for(const a in e)r.push(...Ra({key:`${i}.${a}`,value:e[a]}));return r}}};function Dc(i){const e=i.value,r=i.key,a=i.styleSpec,c=i.style,d=i.validateSpec;if(!e.type)return[new Lt(r,e,'"type" is required')];const f=Ti(e.type);let y;switch(f){case"vector":case"raster":return y=_s({key:r,value:e,valueSpec:a[`source_${f.replace("-","_")}`],style:i.style,styleSpec:a,objectElementValidators:au,validateSpec:d}),y;case"raster-dem":return y=(function(S){var I;const D=(I=S.sourceName)!==null&&I!==void 0?I:"",R=S.value,U=S.styleSpec,q=U.source_raster_dem,H=S.style;let X=[];const K=qr(R);if(R===void 0)return X;if(K!=="object")return X.push(new Lt("source_raster_dem",R,`object expected, ${K} found`)),X;const de=Ti(R.encoding)==="custom",ze=["redFactor","greenFactor","blueFactor","baseShift"],pe=S.value.encoding?`"${S.value.encoding}"`:"Default";for(const xe in R)!de&&ze.includes(xe)?X.push(new Lt(xe,R[xe],`In "${D}": "${xe}" is only valid when "encoding" is set to "custom". ${pe} encoding found`)):q[xe]?X=X.concat(S.validateSpec({key:xe,value:R[xe],valueSpec:q[xe],validateSpec:S.validateSpec,style:H,styleSpec:U})):X.push(new Lt(xe,R[xe],`unknown property "${xe}"`));return X})({sourceName:r,value:e,style:i.style,styleSpec:a,validateSpec:d}),y;case"geojson":if(y=_s({key:r,value:e,valueSpec:a.source_geojson,style:c,styleSpec:a,validateSpec:d,objectElementValidators:au}),e.cluster)for(const S in e.clusterProperties){const[I,D]=e.clusterProperties[S],R=typeof I=="string"?[I,["accumulated"],["get",S]]:I;y.push(...Lo({key:`${r}.${S}.map`,value:D,expressionContext:"cluster-map"})),y.push(...Lo({key:`${r}.${S}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return y;case"video":return _s({key:r,value:e,valueSpec:a.source_video,style:c,validateSpec:d,styleSpec:a});case"image":return _s({key:r,value:e,valueSpec:a.source_image,style:c,validateSpec:d,styleSpec:a});case"canvas":return[new Lt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Co({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function cc(i){const e=i.value,r=i.styleSpec,a=r.light,c=i.style;let d=[];const f=qr(e);if(e===void 0)return d;if(f!=="object")return d=d.concat([new Lt("light",e,`object expected, ${f} found`)]),d;for(const y in e){const S=y.match(/^(.*)-transition$/);d=d.concat(S&&a[S[1]]&&a[S[1]].transition?i.validateSpec({key:y,value:e[y],valueSpec:r.transition,validateSpec:i.validateSpec,style:c,styleSpec:r}):a[y]?i.validateSpec({key:y,value:e[y],valueSpec:a[y],validateSpec:i.validateSpec,style:c,styleSpec:r}):[new Lt(y,e[y],`unknown property "${y}"`)])}return d}function Eu(i){const e=i.value,r=i.styleSpec,a=r.sky,c=i.style,d=qr(e);if(e===void 0)return[];if(d!=="object")return[new Lt("sky",e,`object expected, ${d} found`)];let f=[];for(const y in e)f=f.concat(a[y]?i.validateSpec({key:y,value:e[y],valueSpec:a[y],style:c,styleSpec:r}):[new Lt(y,e[y],`unknown property "${y}"`)]);return f}function ou(i){const e=i.value,r=i.styleSpec,a=r.terrain,c=i.style;let d=[];const f=qr(e);if(e===void 0)return d;if(f!=="object")return d=d.concat([new Lt("terrain",e,`object expected, ${f} found`)]),d;for(const y in e)d=d.concat(a[y]?i.validateSpec({key:y,value:e[y],valueSpec:a[y],validateSpec:i.validateSpec,style:c,styleSpec:r}):[new Lt(y,e[y],`unknown property "${y}"`)]);return d}function lu(i){let e=[];const r=i.value,a=i.key;if(Array.isArray(r)){const c=[],d=[];for(const f in r)r[f].id&&c.includes(r[f].id)&&e.push(new Lt(a,r,`all the sprites' ids must be unique, but ${r[f].id} is duplicated`)),c.push(r[f].id),r[f].url&&d.includes(r[f].url)&&e.push(new Lt(a,r,`all the sprites' URLs must be unique, but ${r[f].url} is duplicated`)),d.push(r[f].url),e=e.concat(_s({key:`${a}[${f}]`,value:r[f],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return Ra({key:a,value:r})}function ku(i){return!!i&&i.constructor===Object}function cu(i){return ku(i.value)?[]:[new Lt(i.key,i.value,`object expected, ${qr(i.value)} found`)]}const Fc={"*":()=>[],array:ga,boolean:function(i){const e=i.value,r=i.key,a=qr(e);return a!=="boolean"?[new Lt(r,e,`boolean expected, ${a} found`)]:[]},number:Yn,color:Pl,constants:Js,enum:Co,filter:Qo,function:kc,layer:Al,object:_s,source:Dc,light:cc,sky:Eu,terrain:ou,projection:function(i){const e=i.value,r=i.styleSpec,a=r.projection,c=i.style,d=qr(e);if(e===void 0)return[];if(d!=="object")return[new Lt("projection",e,`object expected, ${d} found`)];let f=[];for(const y in e)f=f.concat(a[y]?i.validateSpec({key:y,value:e[y],valueSpec:a[y],style:c,styleSpec:r}):[new Lt(y,e[y],`unknown property "${y}"`)]);return f},projectionDefinition:function(i){const e=i.key;let r=i.value;r=r instanceof String?r.valueOf():r;const a=qr(r);return a!=="array"||(function(c){return Array.isArray(c)&&c.length===3&&typeof c[0]=="string"&&typeof c[1]=="string"&&typeof c[2]=="number"})(r)||(function(c){return!!["interpolate","step","literal"].includes(c[0])})(r)?["array","string"].includes(a)?[]:[new Lt(e,r,`projection expected, invalid type "${a}" found`)]:[new Lt(e,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:Ra,formatted:function(i){return Ra(i).length===0?[]:Lo(i)},resolvedImage:function(i){return Ra(i).length===0?[]:Lo(i)},padding:function(i){const e=i.key,r=i.value;if(qr(r)==="array"){if(r.length<1||r.length>4)return[new Lt(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const a={type:"number"};let c=[];for(let d=0;d<r.length;d++)c=c.concat(i.validateSpec({key:`${e}[${d}]`,value:r[d],validateSpec:i.validateSpec,valueSpec:a}));return c}return Yn({key:e,value:r,valueSpec:{}})},numberArray:function(i){const e=i.key,r=i.value;if(qr(r)==="array"){const a={type:"number"};if(r.length<1)return[new Lt(e,r,"array length at least 1 expected, length 0 found")];let c=[];for(let d=0;d<r.length;d++)c=c.concat(i.validateSpec({key:`${e}[${d}]`,value:r[d],validateSpec:i.validateSpec,valueSpec:a}));return c}return Yn({key:e,value:r,valueSpec:{}})},colorArray:function(i){const e=i.key,r=i.value;if(qr(r)==="array"){if(r.length<1)return[new Lt(e,r,"array length at least 1 expected, length 0 found")];let a=[];for(let c=0;c<r.length;c++)a=a.concat(Pl({key:`${e}[${c}]`,value:r[c]}));return a}return Pl({key:e,value:r})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,a=qr(r),c=i.styleSpec;if(a!=="array"||r.length<1||r.length%2!=0)return[new Lt(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let d=[];for(let f=0;f<r.length;f+=2)d=d.concat(Co({key:`${e}[${f}]`,value:r[f],valueSpec:c.layout_symbol["text-anchor"]})),d=d.concat(ga({key:`${e}[${f+1}]`,value:r[f+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:c}));return d},sprite:lu,state:cu,fontFaces:function(i){const e=i.key,r=i.value,a=i.validateSpec,c=i.styleSpec,d=i.style;if(!ku(r))return[new Lt(e,r,`object expected, ${qr(r)} found`)];const f=[];for(const y in r){const S=r[y],I=qr(S);if(I==="string")f.push(...Ra({key:`${e}.${y}`,value:S}));else if(I==="array"){const D={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[R,U]of S.entries())f.push(..._s({key:`${e}.${y}[${R}]`,value:U,valueSpec:D,styleSpec:c,style:d,validateSpec:a}))}else f.push(new Lt(`${e}.${y}`,S,`string or array expected, ${I} found`))}return f}};function _a(i){const e=i.value,r=i.valueSpec,a=i.styleSpec;return i.validateSpec=_a,r.expression&&Ho(Ti(e))?kc(i):r.expression&&Qa(Ko(e))?Lo(i):r.type&&Fc[r.type]?Fc[r.type](i):_s(wr({},i,{valueSpec:r.type?a[r.type]:r}))}function Du(i){const e=i.value,r=i.key,a=Ra(i);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new Lt(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new Lt(r,e,'"glyphs" url must include a "{range}" token'))),a}function Ks(i,e=ie){let r=[];return r=r.concat(_a({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:_a,objectElementValidators:{glyphs:Du,"*":()=>[]}})),i.constants&&(r=r.concat(Js({key:"constants",value:i.constants}))),T(r)}function Qs(i){return function(e){return i(Object.assign({},e,{validateSpec:_a}))}}function T(i){return[].concat(i).sort(((e,r)=>e.line-r.line))}function C(i){return function(...e){return T(i.apply(this,e))}}Ks.source=C(Qs(Dc)),Ks.sprite=C(Qs(lu)),Ks.glyphs=C(Qs(Du)),Ks.light=C(Qs(cc)),Ks.sky=C(Qs(Eu)),Ks.terrain=C(Qs(ou)),Ks.state=C(Qs(cu)),Ks.layer=C(Qs(Al)),Ks.filter=C(Qs(Qo)),Ks.paintProperty=C(Qs(oc)),Ks.layoutProperty=C(Qs(lc));const V={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class Z{constructor(e,r){this._globalState=r,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const r=Xo(e,V,this._globalState);if(r.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(r.value.map((a=>`${a.key}: ${a.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=r.value,this._globalStateRefs=Io(r.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const oe=ie,ue=Ks,me=ue.light,ve=ue.sky,Ae=ue.paintProperty,Re=ue.layoutProperty;function at(i,e){let r=!1;if(e&&e.length)for(const a of e)i.fire(new le(new Error(a.message))),r=!0;return r}class Tt{constructor(e,r,a){const c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const f=new Int32Array(this.arrayBuffer);e=f[0],this.d=(r=f[1])+2*(a=f[2]);for(let S=0;S<this.d*this.d;S++){const I=f[3+S],D=f[3+S+1];c.push(I===D?null:f.subarray(I,D))}const y=f[3+c.length+1];this.keys=f.subarray(f[3+c.length],y),this.bboxes=f.subarray(y),this.insert=this._insertReadonly}else{this.d=r+2*a;for(let f=0;f<this.d*this.d;f++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=a,this.scale=r/e,this.uid=0;const d=a/r*e;this.min=-d,this.max=e+d}insert(e,r,a,c,d){this._forEachCell(r,a,c,d,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(d)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,a,c,d,f){this.cells[d].push(f)}query(e,r,a,c,d){const f=this.min,y=this.max;if(e<=f&&r<=f&&y<=a&&y<=c&&!d)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(e,r,a,c,this._queryCell,S,{},d),S}}_queryCell(e,r,a,c,d,f,y,S){const I=this.cells[d];if(I!==null){const D=this.keys,R=this.bboxes;for(let U=0;U<I.length;U++){const q=I[U];if(y[q]===void 0){const H=4*q;(S?S(R[H+0],R[H+1],R[H+2],R[H+3]):e<=R[H+2]&&r<=R[H+3]&&a>=R[H+0]&&c>=R[H+1])?(y[q]=!0,f.push(D[q])):y[q]=!1}}}}_forEachCell(e,r,a,c,d,f,y,S){const I=this._convertToCellCoord(e),D=this._convertToCellCoord(r),R=this._convertToCellCoord(a),U=this._convertToCellCoord(c);for(let q=I;q<=R;q++)for(let H=D;H<=U;H++){const X=this.d*H+q;if((!S||S(this._convertFromCellCoord(q),this._convertFromCellCoord(H),this._convertFromCellCoord(q+1),this._convertFromCellCoord(H+1)))&&d.call(this,e,r,a,c,X,f,y,S))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let a=0;for(let f=0;f<this.cells.length;f++)a+=this.cells[f].length;const c=new Int32Array(r+a+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let d=r;for(let f=0;f<e.length;f++){const y=e[f];c[3+f]=d,c.set(y,d),d+=y.length}return c[3+e.length]=d,c.set(this.keys,d),d+=this.keys.length,c[3+e.length+1]=d,c.set(this.bboxes,d),d+=this.bboxes.length,c.buffer}static serialize(e,r){const a=e.toArrayBuffer();return r&&r.push(a),{buffer:a}}static deserialize(e){return new Tt(e.buffer)}}const ke={};function Ve(i,e,r={}){if(ke[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),ke[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}Ve("Object",Object),Ve("Set",Set),Ve("TransferableGridIndex",Tt),Ve("Color",Ur),Ve("Error",Error),Ve("AJAXError",Ce),Ve("ResolvedImage",is),Ve("StylePropertyFunction",Cc),Ve("StyleExpression",rc,{omit:["_evaluator"]}),Ve("ZoomDependentExpression",ru),Ve("ZoomConstantExpression",Ic),Ve("CompoundExpression",ks,{omit:["_evaluate"]});for(const i in Zo)Zo[i]._classRegistryKey||Ve(`Expression_${i}`,Zo[i]);function _t(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Ot(i){return i.$name||i.constructor._classRegistryKey}function wt(i){return!(function(e){if(e===null||typeof e!="object")return!1;const r=Ot(e);return!(!r||r==="Object")})(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||_t(i)||Tr(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function jt(i,e){if(wt(i))return(_t(i)||Tr(i))&&e&&e.push(i),ArrayBuffer.isView(i)&&e&&e.push(i.buffer),i instanceof ImageData&&e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const d=[];for(const f of i)d.push(jt(f,e));return d}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const r=Ot(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!ke[r])throw new Error(`${r} is not registered.`);const{klass:a}=ke[r],c=a.serialize?a.serialize(i,e):{};if(a.serialize){if(e&&c===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const d in i){if(!i.hasOwnProperty(d)||ke[r].omit.indexOf(d)>=0)continue;const f=i[d];c[d]=ke[r].shallow.indexOf(d)>=0?f:jt(f,e)}i instanceof Error&&(c.message=i.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(c.$name=r),c}function Ut(i){if(wt(i))return i;if(Array.isArray(i))return i.map(Ut);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const e=Ot(i)||"Object";if(!ke[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=ke[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const a=Object.create(r.prototype);for(const c of Object.keys(i)){if(c==="$name")continue;const d=i[c];a[c]=ke[e].shallow.indexOf(c)>=0?d:Ut(d)}return a}class tr{constructor(){this.first=!0}update(e,r){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}function Jt(i){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function Dr(i){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function Sr(i){return/\s/u.test(String.fromCodePoint(i))}function Yr(i){for(const e of i)if(Dr(e.codePointAt(0)))return!0;return!1}function Mr(i){for(const e of i)if(!ii(e.codePointAt(0)))return!1;return!0}function hi(i){const e=i.map((r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}})).filter((r=>r));return new RegExp(e.join("|"),"u")}const un=hi(["Arab","Dupl","Mong","Ougr","Syrc"]);function ii(i){return!un.test(String.fromCodePoint(i))}function Ir(i){return!(Dr(i)||(e=i,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const fr=hi(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function en(i){return fr.test(String.fromCodePoint(i))}function Jr(i,e){return!(!e&&en(i)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(i)))}function pi(i){for(const e of i)if(en(e.codePointAt(0)))return!0;return!1}const bi=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(bi.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,e){return s(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;const r=i.pluginURL,a=new Promise((d=>{this.loadScriptResolve=d}));e(r);const c=new Promise((d=>setTimeout((()=>d()),this.TIMEOUT)));if(yield Promise.race([a,c]),this.isParsed()){const d={pluginStatus:"loaded",pluginURL:r};return this.setState(d),d}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)}))}};class Kr{constructor(e,r){this.isSupportedScript=ls,this.zoom=e,r?(this.now=r.now||0,this.fadeDuration=r.fadeDuration||0,this.zoomHistory=r.zoomHistory||new tr,this.transition=r.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new tr,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}}}function ls(i){return(function(e,r){for(const a of e)if(!Jr(a.codePointAt(0),r))return!1;return!0})(i,bi.getRTLTextPluginStatus()==="loaded")}const Oi="-transition";class Mn{constructor(e,r,a){this.property=e,this.value=r,this.expression=(function(c,d,f){if(Ho(c))return new Cc(c,d);if(Qa(c)){const y=Lc(c,d,f);if(y.result==="error")throw new Error(y.value.map((S=>`${S.key}: ${S.message}`)).join(", "));return y.value}{let y=c;return d.type==="color"&&typeof c=="string"?y=Ur.parse(c):d.type!=="padding"||typeof c!="number"&&!Array.isArray(c)?d.type!=="numberArray"||typeof c!="number"&&!Array.isArray(c)?d.type!=="colorArray"||typeof c!="string"&&!Array.isArray(c)?d.type==="variableAnchorOffsetCollection"&&Array.isArray(c)?y=Ki.parse(c):d.type==="projectionDefinition"&&typeof c=="string"&&(y=Un.parse(c)):y=Br.parse(c):y=Bi.parse(c):y=kr.parse(c),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>y}}})(r===void 0?e.specification.default:r,e.specification,a)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class Rn{constructor(e,r){this.property=e,this.value=new Mn(e,void 0,r)}transitioned(e,r){return new _i(this.property,this.value,r,ft({},e.transition,this.transition),e.now)}untransitioned(){return new _i(this.property,this.value,null,{},0)}}class mn{constructor(e,r){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=r}getValue(e){return sr(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Rn(this._values[e].property,this._globalState)),this._values[e].value=new Mn(this._values[e].property,r===null?void 0:sr(r),this._globalState)}getTransition(e){return sr(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Rn(this._values[e].property,this._globalState)),this._values[e].transition=sr(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const c=this.getTransition(r);c!==void 0&&(e[`${r}${Oi}`]=c)}return e}transitioned(e,r){const a=new Pi(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(e,r._values[c]);return a}untransitioned(){const e=new Pi(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class _i{constructor(e,r,a,c,d){this.property=e,this.value=r,this.begin=d+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const c=e.now||0,d=this.value.possiblyEvaluate(e,r,a),f=this.prior;if(f){if(c>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(c<this.begin)return f.possiblyEvaluate(e,r,a);{const y=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,r,a),d,Fe(y))}}return d}}class Pi{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const c=new gn(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,r,a);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class tn{constructor(e,r){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=r}hasValue(e){return this._values[e].value!==void 0}getValue(e){return sr(this._values[e].value)}setValue(e,r){this._values[e]=new Mn(this._values[e].property,r===null?void 0:sr(r),this._globalState)}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const c=new gn(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,r,a);return c}}class ci{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,c){return this.property.evaluate(this.value,this.parameters,e,r,a,c)}}class gn{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class mr{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,a){const c=ar[this.specification.type];return c?c(e,r,a):e}}class pr{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,c){return new ci(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,c)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new ci(this,{kind:"constant",value:void 0},e.parameters);const c=ar[this.specification.type];if(c){const d=c(e.value.value,r.value.value,a);return new ci(this,{kind:"constant",value:d},e.parameters)}return e}evaluate(e,r,a,c,d,f){return e.kind==="constant"?e.value:e.evaluate(r,a,c,d,f)}}class Bn extends pr{possiblyEvaluate(e,r,a,c){if(e.value===void 0)return new ci(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const d=e.expression.evaluate(r,null,{},a,c),f=e.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,y=this._calculate(f,f,f,r);return new ci(this,{kind:"constant",value:y},r)}if(e.expression.kind==="camera"){const d=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new ci(this,{kind:"constant",value:d},r)}return new ci(this,e.expression,r)}evaluate(e,r,a,c,d,f){if(e.kind==="source"){const y=e.evaluate(r,a,c,d,f);return this._calculate(y,y,y,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},a,c),e.evaluate({zoom:Math.floor(r.zoom)},a,c),e.evaluate({zoom:Math.floor(r.zoom)+1},a,c),r):e.value}_calculate(e,r,a,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class Ai{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const d=e.expression.evaluate(r,null,{},a,c);return this._calculate(d,d,d,r)}return this._calculate(e.expression.evaluate(new Kr(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Kr(Math.floor(r.zoom),r)),e.expression.evaluate(new Kr(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,a,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class hn{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,c){return!!e.expression.evaluate(r,null,{},a,c)}interpolate(){return!1}}class Fi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const a=e[r];a.specification.overridable&&this.overridableProperties.push(r);const c=this.defaultPropertyValues[r]=new Mn(a,void 0,void 0),d=this.defaultTransitionablePropertyValues[r]=new Rn(a,void 0);this.defaultTransitioningPropertyValues[r]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=c.possiblyEvaluate({})}}}Ve("DataDrivenProperty",pr),Ve("DataConstantProperty",mr),Ve("CrossFadedDataDrivenProperty",Bn),Ve("CrossFadedProperty",Ai),Ve("ColorRampProperty",hn);class ji extends ge{constructor(e,r,a){if(super(),this.id=e.id,this.type=e.type,this._globalState=a,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},this._visibilityExpression=(function(c,d){return new Z(c,d)})(this.visibility,a),e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=Jo(e.filter,a)),r.layout&&(this._unevaluatedLayout=new tn(r.layout,a)),r.paint)){this._transitionablePaint=new mn(r.paint,a);for(const c in e.paint)this.setPaintProperty(c,e.paint[c],{validate:!1});for(const c in e.layout)this.setLayoutProperty(c,e.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new gn(r.paint)}}setFilter(e){this.filter=e,this._featureFilter=Jo(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const r of this._visibilityExpression.getGlobalStateRefs())e.add(r);if(this._unevaluatedLayout)for(const r in this._unevaluatedLayout._values){const a=this._unevaluatedLayout._values[r];for(const c of a.getGlobalStateRefs())e.add(c)}for(const r of this._featureFilter.getGlobalStateRefs())e.add(r);return e}getPaintAffectingGlobalStateRefs(){var e;const r=new globalThis.Map;if(this._transitionablePaint)for(const a in this._transitionablePaint._values){const c=this._transitionablePaint._values[a].value;for(const d of c.getGlobalStateRefs()){const f=(e=r.get(d))!==null&&e!==void 0?e:[];f.push({name:a,value:c.value}),r.set(d,f)}}return r}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,r,a={}){if(r==null||!this._validate(Re,`layers.${this.id}.layout.${e}`,e,r,a))return e==="visibility"?(this.visibility=r,this._visibilityExpression.setValue(r),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,r)}getPaintProperty(e){return e.endsWith(Oi)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,a={}){if(r!=null&&this._validate(Ae,`layers.${this.id}.paint.${e}`,e,r,a))return!1;if(e.endsWith(Oi))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const c=this._transitionablePaint._values[e],d=c.property.specification["property-type"]==="cross-faded-data-driven",f=c.value.isDataDriven(),y=c.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const S=this._transitionablePaint._values[e].value;return S.isDataDriven()||f||d||this._handleOverridablePaintPropertyUpdate(e,y,S)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e=this.minzoom,r=!1){return!!(this.minzoom&&e<(r?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Zt(e,((r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length)))}_validate(e,r,a,c,d={}){return(!d||d.validate!==!1)&&at(this,e.call(ue,{key:r,layerType:this.type,objectKey:a,value:c,styleSpec:ie,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof ci&&Po(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}let cs;var ys={get paint(){return cs=cs||new Fi({"raster-opacity":new mr(ie.paint_raster["raster-opacity"]),"raster-hue-rotate":new mr(ie.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new mr(ie.paint_raster["raster-brightness-min"]),"raster-brightness-max":new mr(ie.paint_raster["raster-brightness-max"]),"raster-saturation":new mr(ie.paint_raster["raster-saturation"]),"raster-contrast":new mr(ie.paint_raster["raster-contrast"]),"raster-resampling":new mr(ie.paint_raster["raster-resampling"]),"raster-fade-duration":new mr(ie.paint_raster["raster-fade-duration"])})}};class vs extends ji{constructor(e,r){super(e,ys,r)}}const Ds={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ii{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class fi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function xi(i,e=1){let r=0,a=0;return{members:i.map((c=>{const d=Ds[c.type].BYTES_PER_ELEMENT,f=r=Fs(r,Math.max(e,d)),y=c.components||1;return a=Math.max(a,d),r+=d*y,{name:c.name,type:c.type,components:y,offset:f}})),size:Fs(r,Math.max(a,e)),alignment:e}}function Fs(i,e){return Math.ceil(i/e)*e}class zs extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const c=2*e;return this.int16[c+0]=r,this.int16[c+1]=a,e}}zs.prototype.bytesPerElement=4,Ve("StructArrayLayout2i4",zs);class Tn extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,a)}emplace(e,r,a,c){const d=3*e;return this.int16[d+0]=r,this.int16[d+1]=a,this.int16[d+2]=c,e}}Tn.prototype.bytesPerElement=6,Ve("StructArrayLayout3i6",Tn);class Il extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a,c)}emplace(e,r,a,c,d){const f=4*e;return this.int16[f+0]=r,this.int16[f+1]=a,this.int16[f+2]=c,this.int16[f+3]=d,e}}Il.prototype.bytesPerElement=8,Ve("StructArrayLayout4i8",Il);class Ll extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,c,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,c,d,f)}emplace(e,r,a,c,d,f,y){const S=6*e;return this.int16[S+0]=r,this.int16[S+1]=a,this.int16[S+2]=c,this.int16[S+3]=d,this.int16[S+4]=f,this.int16[S+5]=y,e}}Ll.prototype.bytesPerElement=12,Ve("StructArrayLayout2i4i12",Ll);class Cl extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,c,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,c,d,f)}emplace(e,r,a,c,d,f,y){const S=4*e,I=8*e;return this.int16[S+0]=r,this.int16[S+1]=a,this.uint8[I+4]=c,this.uint8[I+5]=d,this.uint8[I+6]=f,this.uint8[I+7]=y,e}}Cl.prototype.bytesPerElement=8,Ve("StructArrayLayout2i4ub8",Cl);class to extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const c=2*e;return this.float32[c+0]=r,this.float32[c+1]=a,e}}to.prototype.bytesPerElement=8,Ve("StructArrayLayout2f8",to);class ro extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,c,d,f,y,S,I,D){const R=this.length;return this.resize(R+1),this.emplace(R,e,r,a,c,d,f,y,S,I,D)}emplace(e,r,a,c,d,f,y,S,I,D,R){const U=10*e;return this.uint16[U+0]=r,this.uint16[U+1]=a,this.uint16[U+2]=c,this.uint16[U+3]=d,this.uint16[U+4]=f,this.uint16[U+5]=y,this.uint16[U+6]=S,this.uint16[U+7]=I,this.uint16[U+8]=D,this.uint16[U+9]=R,e}}ro.prototype.bytesPerElement=20,Ve("StructArrayLayout10ui20",ro);class zc extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,c,d,f,y,S){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,a,c,d,f,y,S)}emplace(e,r,a,c,d,f,y,S,I){const D=8*e;return this.uint16[D+0]=r,this.uint16[D+1]=a,this.uint16[D+2]=c,this.uint16[D+3]=d,this.uint16[D+4]=f,this.uint16[D+5]=y,this.uint16[D+6]=S,this.uint16[D+7]=I,e}}zc.prototype.bytesPerElement=16,Ve("StructArrayLayout8ui16",zc);class el extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,c,d,f,y,S,I,D,R,U){const q=this.length;return this.resize(q+1),this.emplace(q,e,r,a,c,d,f,y,S,I,D,R,U)}emplace(e,r,a,c,d,f,y,S,I,D,R,U,q){const H=12*e;return this.int16[H+0]=r,this.int16[H+1]=a,this.int16[H+2]=c,this.int16[H+3]=d,this.uint16[H+4]=f,this.uint16[H+5]=y,this.uint16[H+6]=S,this.uint16[H+7]=I,this.int16[H+8]=D,this.int16[H+9]=R,this.int16[H+10]=U,this.int16[H+11]=q,e}}el.prototype.bytesPerElement=24,Ve("StructArrayLayout4i4ui4i24",el);class ya extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,a)}emplace(e,r,a,c){const d=3*e;return this.float32[d+0]=r,this.float32[d+1]=a,this.float32[d+2]=c,e}}ya.prototype.bytesPerElement=12,Ve("StructArrayLayout3f12",ya);class uc extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}uc.prototype.bytesPerElement=4,Ve("StructArrayLayout1ul4",uc);class uu extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,c,d,f,y,S,I){const D=this.length;return this.resize(D+1),this.emplace(D,e,r,a,c,d,f,y,S,I)}emplace(e,r,a,c,d,f,y,S,I,D){const R=10*e,U=5*e;return this.int16[R+0]=r,this.int16[R+1]=a,this.int16[R+2]=c,this.int16[R+3]=d,this.int16[R+4]=f,this.int16[R+5]=y,this.uint32[U+3]=S,this.uint16[R+8]=I,this.uint16[R+9]=D,e}}uu.prototype.bytesPerElement=20,Ve("StructArrayLayout6i1ul2ui20",uu);class Ml extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,c,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,c,d,f)}emplace(e,r,a,c,d,f,y){const S=6*e;return this.int16[S+0]=r,this.int16[S+1]=a,this.int16[S+2]=c,this.int16[S+3]=d,this.int16[S+4]=f,this.int16[S+5]=y,e}}Ml.prototype.bytesPerElement=12,Ve("StructArrayLayout2i2i2i12",Ml);class Mo extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,c,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,c,d)}emplace(e,r,a,c,d,f){const y=4*e,S=8*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=c,this.int16[S+6]=d,this.int16[S+7]=f,e}}Mo.prototype.bytesPerElement=16,Ve("StructArrayLayout2f1f2i16",Mo);class El extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,c,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,c,d,f)}emplace(e,r,a,c,d,f,y){const S=16*e,I=4*e,D=8*e;return this.uint8[S+0]=r,this.uint8[S+1]=a,this.float32[I+1]=c,this.float32[I+2]=d,this.int16[D+6]=f,this.int16[D+7]=y,e}}El.prototype.bytesPerElement=16,Ve("StructArrayLayout2ub2f2i16",El);class kl extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,a)}emplace(e,r,a,c){const d=3*e;return this.uint16[d+0]=r,this.uint16[d+1]=a,this.uint16[d+2]=c,e}}kl.prototype.bytesPerElement=6,Ve("StructArrayLayout3ui6",kl);class Eo extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,c,d,f,y,S,I,D,R,U,q,H,X,K,de){const ze=this.length;return this.resize(ze+1),this.emplace(ze,e,r,a,c,d,f,y,S,I,D,R,U,q,H,X,K,de)}emplace(e,r,a,c,d,f,y,S,I,D,R,U,q,H,X,K,de,ze){const pe=24*e,xe=12*e,je=48*e;return this.int16[pe+0]=r,this.int16[pe+1]=a,this.uint16[pe+2]=c,this.uint16[pe+3]=d,this.uint32[xe+2]=f,this.uint32[xe+3]=y,this.uint32[xe+4]=S,this.uint16[pe+10]=I,this.uint16[pe+11]=D,this.uint16[pe+12]=R,this.float32[xe+7]=U,this.float32[xe+8]=q,this.uint8[je+36]=H,this.uint8[je+37]=X,this.uint8[je+38]=K,this.uint32[xe+10]=de,this.int16[pe+22]=ze,e}}Eo.prototype.bytesPerElement=48,Ve("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Eo);class Dl extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,c,d,f,y,S,I,D,R,U,q,H,X,K,de,ze,pe,xe,je,Ke,bt,Bt,Nt,qt,ir,Kt){const Ft=this.length;return this.resize(Ft+1),this.emplace(Ft,e,r,a,c,d,f,y,S,I,D,R,U,q,H,X,K,de,ze,pe,xe,je,Ke,bt,Bt,Nt,qt,ir,Kt)}emplace(e,r,a,c,d,f,y,S,I,D,R,U,q,H,X,K,de,ze,pe,xe,je,Ke,bt,Bt,Nt,qt,ir,Kt,Ft){const Et=32*e,hr=16*e;return this.int16[Et+0]=r,this.int16[Et+1]=a,this.int16[Et+2]=c,this.int16[Et+3]=d,this.int16[Et+4]=f,this.int16[Et+5]=y,this.int16[Et+6]=S,this.int16[Et+7]=I,this.uint16[Et+8]=D,this.uint16[Et+9]=R,this.uint16[Et+10]=U,this.uint16[Et+11]=q,this.uint16[Et+12]=H,this.uint16[Et+13]=X,this.uint16[Et+14]=K,this.uint16[Et+15]=de,this.uint16[Et+16]=ze,this.uint16[Et+17]=pe,this.uint16[Et+18]=xe,this.uint16[Et+19]=je,this.uint16[Et+20]=Ke,this.uint16[Et+21]=bt,this.uint16[Et+22]=Bt,this.uint32[hr+12]=Nt,this.float32[hr+13]=qt,this.float32[hr+14]=ir,this.uint16[Et+30]=Kt,this.uint16[Et+31]=Ft,e}}Dl.prototype.bytesPerElement=64,Ve("StructArrayLayout8i15ui1ul2f2ui64",Dl);class Fl extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Fl.prototype.bytesPerElement=4,Ve("StructArrayLayout1f4",Fl);class ko extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,a)}emplace(e,r,a,c){const d=3*e;return this.uint16[6*e+0]=r,this.float32[d+1]=a,this.float32[d+2]=c,e}}ko.prototype.bytesPerElement=12,Ve("StructArrayLayout1ui2f12",ko);class Nc extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,a)}emplace(e,r,a,c){const d=4*e;return this.uint32[2*e+0]=r,this.uint16[d+2]=a,this.uint16[d+3]=c,e}}Nc.prototype.bytesPerElement=8,Ve("StructArrayLayout1ul2ui8",Nc);class m extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const c=2*e;return this.uint16[c+0]=r,this.uint16[c+1]=a,e}}m.prototype.bytesPerElement=4,Ve("StructArrayLayout2ui4",m);class t extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}t.prototype.bytesPerElement=2,Ve("StructArrayLayout1ui2",t);class n extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a,c)}emplace(e,r,a,c,d){const f=4*e;return this.float32[f+0]=r,this.float32[f+1]=a,this.float32[f+2]=c,this.float32[f+3]=d,e}}n.prototype.bytesPerElement=16,Ve("StructArrayLayout4f16",n);class o extends Ii{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new E(this.anchorPointX,this.anchorPointY)}}o.prototype.size=20;class h extends uu{get(e){return new o(this,e)}}Ve("CollisionBoxArray",h);class _ extends Ii{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}_.prototype.size=48;class w extends Eo{get(e){return new _(this,e)}}Ve("PlacedSymbolArray",w);class A extends Ii{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}A.prototype.size=64;class M extends Dl{get(e){return new A(this,e)}}Ve("SymbolInstanceArray",M);class z extends Fl{getoffsetX(e){return this.float32[1*e+0]}}Ve("GlyphOffsetArray",z);class O extends Tn{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ve("SymbolLineVertexArray",O);class $ extends Ii{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}$.prototype.size=12;class G extends ko{get(e){return new $(this,e)}}Ve("TextAnchorOffsetArray",G);class J extends Ii{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}J.prototype.size=8;class ce extends Nc{get(e){return new J(this,e)}}Ve("FeatureIndexArray",ce);class be extends zs{}class Te extends zs{}class Se extends zs{}class Me extends Ll{}class He extends Cl{}class Ee extends to{}class Xe extends ro{}class et extends zc{}class qe extends el{}class lt extends ya{}class At extends uc{}class vt extends Ml{}class St extends El{}class Pt extends kl{}class er extends m{}const rr=xi([{name:"a_pos",components:2,type:"Int16"}],4),{members:$t}=rr;class nr{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,r,a,c){const d=this.segments[this.segments.length-1];return e>nr.MAX_VERTEX_ARRAY_LENGTH&&_r(`Max vertices per segment is ${nr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${nr.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!d||d.vertexLength+e>nr.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==c?this.createNewSegment(r,a,c):d}createNewSegment(e,r,a){const c={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return a!==void 0&&(c.sortKey=a),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(c),c}getOrCreateLatestSegment(e,r,a){return this.prepareSegment(0,e,r,a)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,c){return new nr([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}function Hr(i,e){return 256*(i=nt(Math.floor(i),0,255))+nt(Math.floor(e),0,255)}nr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ve("SegmentVector",nr);const Ci=xi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Xi=xi([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Vi,rn,Ui,_n={exports:{}},nn={exports:{}},Jn={exports:{}},En=(function(){if(Ui)return _n.exports;Ui=1;var i=(Vi||(Vi=1,nn.exports=function(r,a){var c,d,f,y,S,I,D,R;for(d=r.length-(c=3&r.length),f=a,S=3432918353,I=461845907,R=0;R<d;)D=255&r.charCodeAt(R)|(255&r.charCodeAt(++R))<<8|(255&r.charCodeAt(++R))<<16|(255&r.charCodeAt(++R))<<24,++R,f=27492+(65535&(y=5*(65535&(f=(f^=D=(65535&(D=(D=(65535&D)*S+(((D>>>16)*S&65535)<<16)&4294967295)<<15|D>>>17))*I+(((D>>>16)*I&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(D=0,c){case 3:D^=(255&r.charCodeAt(R+2))<<16;case 2:D^=(255&r.charCodeAt(R+1))<<8;case 1:f^=D=(65535&(D=(D=(65535&(D^=255&r.charCodeAt(R)))*S+(((D>>>16)*S&65535)<<16)&4294967295)<<15|D>>>17))*I+(((D>>>16)*I&65535)<<16)&4294967295}return f^=r.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),nn.exports),e=(rn||(rn=1,Jn.exports=function(r,a){for(var c,d=r.length,f=a^d,y=0;d>=4;)c=1540483477*(65535&(c=255&r.charCodeAt(y)|(255&r.charCodeAt(++y))<<8|(255&r.charCodeAt(++y))<<16|(255&r.charCodeAt(++y))<<24))+((1540483477*(c>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),d-=4,++y;switch(d){case 3:f^=(255&r.charCodeAt(y+2))<<16;case 2:f^=(255&r.charCodeAt(y+1))<<8;case 1:f=1540483477*(65535&(f^=255&r.charCodeAt(y)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),Jn.exports);return _n.exports=i,_n.exports.murmur3=i,_n.exports.murmur2=e,_n.exports})(),Pn=F(En);class us{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,a,c){this.ids.push(zl(e)),this.positions.push(r,a,c)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=zl(e);let a=0,c=this.ids.length-1;for(;a<c;){const f=a+c>>1;this.ids[f]>=r?c=f:a=f+1}const d=[];for(;this.ids[a]===r;)d.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return d}static serialize(e,r){const a=new Float64Array(e.ids),c=new Uint32Array(e.positions);return tl(a,c,0,a.length-1),r&&r.push(a.buffer,c.buffer),{ids:a,positions:c}}static deserialize(e){const r=new us;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function zl(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Pn(String(i))}function tl(i,e,r,a){for(;r<a;){const c=i[r+a>>1];let d=r-1,f=a+1;for(;;){do d++;while(i[d]<c);do f--;while(i[f]>c);if(d>=f)break;Do(i,d,f),Do(e,3*d,3*f),Do(e,3*d+1,3*f+1),Do(e,3*d+2,3*f+2)}f-r<a-f?(tl(i,e,r,f),r=f+1):(tl(i,e,f+1,a),a=f)}}function Do(i,e,r){const a=i[e];i[e]=i[r],i[r]=a}Ve("FeaturePositionMap",us);class ea{constructor(e,r){this.gl=e.gl,this.location=r}}class hc extends ea{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class hu extends ea{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class dc extends ea{constructor(e,r){super(e,r),this.current=Ur.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Ba=new Float32Array(16);function Fo(i){return[Hr(255*i.r,255*i.g),Hr(255*i.b,255*i.a)]}class io{constructor(e,r,a){this.value=e,this.uniformNames=r.map((c=>`u_${c}`)),this.type=a}setUniform(e,r,a){e.set(a.constantOr(this.value))}getBinding(e,r,a){return this.type==="color"?new dc(e,r):new hc(e,r)}}class no{constructor(e,r){this.uniformNames=r.map((a=>`u_${a}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,r){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,r.y,r.height,r.width]}setUniform(e,r,a,c){let d=null;c==="u_pattern_to"?d=this.patternTo:c==="u_pattern_from"?d=this.patternFrom:c==="u_dasharray_to"?d=this.dashTo:c==="u_dasharray_from"?d=this.dashFrom:c==="u_pixel_ratio_to"?d=this.pixelRatioTo:c==="u_pixel_ratio_from"&&(d=this.pixelRatioFrom),d!==null&&e.set(d)}getBinding(e,r,a){return a.substr(0,9)==="u_pattern"||a.substr(0,12)==="u_dasharray_"?new hu(e,r):new hc(e,r)}}class $i{constructor(e,r,a,c){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map((d=>({name:`a_${d}`,type:"Float32",components:a==="color"?2:1,offset:0}))),this.paintVertexArray=new c}populatePaintArray(e,r,a){const c=this.paintVertexArray.length,d=this.expression.evaluate(new Kr(0,a),r,{},a.canonical,[],a.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(c,e,d)}updatePaintArray(e,r,a,c,d){const f=this.expression.evaluate(new Kr(0,d),a,c);this._setPaintValue(e,r,f)}_setPaintValue(e,r,a){if(this.type==="color"){const c=Fo(a);for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,c[0],c[1])}else{for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class qi{constructor(e,r,a,c,d,f){this.expression=e,this.uniformNames=r.map((y=>`u_${y}_t`)),this.type=a,this.useIntegerZoom=c,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=r.map((y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0}))),this.paintVertexArray=new f}populatePaintArray(e,r,a){const c=this.expression.evaluate(new Kr(this.zoom,a),r,{},a.canonical,[],a.formattedSection),d=this.expression.evaluate(new Kr(this.zoom+1,a),r,{},a.canonical,[],a.formattedSection),f=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(f,e,c,d)}updatePaintArray(e,r,a,c,d){const f=this.expression.evaluate(new Kr(this.zoom,d),a,c),y=this.expression.evaluate(new Kr(this.zoom+1,d),a,c);this._setPaintValue(e,r,f,y)}_setPaintValue(e,r,a,c){if(this.type==="color"){const d=Fo(a),f=Fo(c);for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,d[0],d[1],f[0],f[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,c=nt(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,r,a){return new hc(e,r)}}class qn{constructor(e,r,a,c,d,f){this.expression=e,this.type=r,this.useIntegerZoom=a,this.zoom=c,this.layerId=f,this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(e,r,a){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,this.getPositionIds(r),a)}updatePaintArray(e,r,a,c,d){this._setPaintValues(e,r,this.getPositionIds(a),d)}_setPaintValues(e,r,a,c){const d=this.getPositions(c);if(!d||!a)return;const f=d[a.min],y=d[a.mid],S=d[a.max];if(f&&y&&S)for(let I=e;I<r;I++)this.emplace(this.zoomInPaintVertexArray,I,y,f),this.emplace(this.zoomOutPaintVertexArray,I,y,S)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const r=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,r,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,r,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Gn extends qn{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return Ci.members}emplace(e,r,a,c){e.emplace(r,a.tlbr[0],a.tlbr[1],a.tlbr[2],a.tlbr[3],c.tlbr[0],c.tlbr[1],c.tlbr[2],c.tlbr[3],a.pixelRatio,c.pixelRatio)}}class Xh extends qn{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return Xi.members}emplace(e,r,a,c){e.emplace(r,0,a.y,a.height,a.width,0,c.y,c.height,c.width)}}class Yh{constructor(e,r,a){this.binders={},this._buffers=[];const c=[];for(const d in e.paint._values){if(!a(d))continue;const f=e.paint.get(d);if(!(f instanceof ci&&Po(f.property.specification)))continue;const y=tf(d,e.type),S=f.value,I=f.property.specification.type,D=f.property.useIntegerZoom,R=f.property.specification["property-type"],U=R==="cross-faded"||R==="cross-faded-data-driven";if(S.kind==="constant")this.binders[d]=U?new no(S.value,y):new io(S.value,y,I),c.push(`/u_${d}`);else if(S.kind==="source"||U){const q=Jh(d,I,"source");this.binders[d]=U?d==="line-dasharray"?new Xh(S,I,D,r,q,e.id):new Gn(S,I,D,r,q,e.id):new $i(S,y,I,q),c.push(`/a_${d}`)}else{const q=Jh(d,I,"composite");this.binders[d]=new qi(S,y,I,D,r,q),c.push(`/z_${d}`)}}this.cacheKey=c.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof $i||r instanceof qi?r.maxValue:0}populatePaintArrays(e,r,a){for(const c in this.binders){const d=this.binders[c];(d instanceof $i||d instanceof qi||d instanceof qn)&&d.populatePaintArray(e,r,a)}}setConstantPatternPositions(e,r){for(const a in this.binders){const c=this.binders[a];c instanceof no&&c.setConstantPatternPositions(e,r)}}setConstantDashPositions(e,r){for(const a in this.binders){const c=this.binders[a];c instanceof no&&c.setConstantDashPositions(e,r)}}updatePaintArrays(e,r,a,c,d){let f=!1;for(const y in e){const S=r.getPositions(y);for(const I of S){const D=a.feature(I.index);for(const R in this.binders){const U=this.binders[R];if((U instanceof $i||U instanceof qi||U instanceof qn)&&U.expression.isStateDependent===!0){const q=c.paint.get(R);U.expression=q.value,U.updatePaintArray(I.start,I.end,D,e[y],d),f=!0}}}}return f}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof io||a instanceof no)&&e.push(...a.uniformNames.map((c=>`#define HAS_UNIFORM_${c}`)))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof $i||a instanceof qi)for(let c=0;c<a.paintVertexAttributes.length;c++)e.push(a.paintVertexAttributes[c].name);else if(a instanceof qn){const c=a.getVertexAttributes();for(const d of c)e.push(d.name)}}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof io||a instanceof no||a instanceof qi)for(const c of a.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const a=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof io||d instanceof no||d instanceof qi){for(const f of d.uniformNames)if(r[f]){const y=d.getBinding(e,r[f],f);a.push({name:f,property:c,binding:y})}}}return a}setUniforms(e,r,a,c){for(const{name:d,property:f,binding:y}of r)this.binders[f].setUniform(y,c,a.get(f),d)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const a=this.binders[r];if(e&&a instanceof qn){const c=e.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(a instanceof $i||a instanceof qi)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof $i||a instanceof qi||a instanceof qn)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof $i||r instanceof qi||r instanceof qn)&&r.destroy()}}}class fc{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new Yh(c,r,a);this.needsUpload=!1,this._featureMap=new us,this._bufferOffset=0}populatePaintArrays(e,r,a,c){for(const d in this.programConfigurations)this.programConfigurations[d].populatePaintArrays(e,r,c);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,c){for(const d of a)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(e,this._featureMap,r,d,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function tf(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Jh(i,e,r){const a={color:{source:to,composite:n},number:{source:Fl,composite:to}},c=(function(d){return{"line-pattern":{source:Xe,composite:Xe},"fill-pattern":{source:Xe,composite:Xe},"fill-extrusion-pattern":{source:Xe,composite:Xe},"line-dasharray":{source:et,composite:et}}[d]})(i);return c&&c[r]||a[e][r]}Ve("ConstantBinder",io),Ve("CrossFadedConstantBinder",no),Ve("SourceExpressionBinder",$i),Ve("CrossFadedPatternBinder",Gn),Ve("CrossFadedDasharrayBinder",Xh),Ve("CompositeExpressionBinder",qi),Ve("ProgramConfiguration",Yh,{omit:["_buffers"]}),Ve("ProgramConfigurationSet",fc);const mh=Math.pow(2,14)-1,Nl=-mh-1;function Rl(i){const e=gt/i.extent,r=i.loadGeometry();for(let a=0;a<r.length;a++){const c=r[a];for(let d=0;d<c.length;d++){const f=c[d],y=Math.round(f.x*e),S=Math.round(f.y*e);f.x=nt(y,Nl,mh),f.y=nt(S,Nl,mh),(y<f.x||y>f.x+1||S<f.y||S>f.y+1)&&_r("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Bl(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Rl(i):[]}}const gh=-32768;function _h(i,e,r,a,c){i.emplaceBack(gh+8*e+a,gh+8*r+c)}class Fu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new Te,this.indexArray=new Pt,this.segments=new nr,this.programConfigurations=new fc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,a){const c=this.layers[0],d=[];let f=null,y=!1,S=c.type==="heatmap";if(c.type==="circle"){const D=c;f=D.layout.get("circle-sort-key"),y=!f.isConstant(),S=S||D.paint.get("circle-pitch-alignment")==="map"}const I=S?r.subdivisionGranularity.circle:1;for(const{feature:D,id:R,index:U,sourceLayerIndex:q}of e){const H=this.layers[0]._featureFilter.needGeometry,X=Bl(D,H);if(!this.layers[0]._featureFilter.filter(new Kr(this.zoom),X,a))continue;const K=y?f.evaluate(X,{},a):void 0,de={id:R,properties:D.properties,type:D.type,sourceLayerIndex:q,index:U,geometry:H?X.geometry:Rl(D),patterns:{},sortKey:K};d.push(de)}y&&d.sort(((D,R)=>D.sortKey-R.sortKey));for(const D of d){const{geometry:R,index:U,sourceLayerIndex:q}=D,H=e[U].feature;this.addFeature(D,R,U,a,I),r.featureIndex.insert(H,R,U,q,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:a})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$t),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,c,d=1){let f;switch(d){case 1:f=[0,7];break;case 3:f=[0,2,5,7];break;case 5:f=[0,1,3,4,6,7];break;case 7:f=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${d}; valid values are 1, 3, 5, 7.`)}const y=f.length;for(const S of r)for(const I of S){const D=I.x,R=I.y;if(D<0||D>=gt||R<0||R>=gt)continue;const U=this.segments.prepareSegment(y*y,this.layoutVertexArray,this.indexArray,e.sortKey),q=U.vertexLength;for(let H=0;H<y;H++)for(let X=0;X<y;X++)_h(this.layoutVertexArray,D,R,f[X],f[H]);for(let H=0;H<y-1;H++)for(let X=0;X<y-1;X++){const K=q+H*y+X,de=q+(H+1)*y+X;this.indexArray.emplaceBack(K,de+1,K+1),this.indexArray.emplaceBack(K,de,de+1)}U.vertexLength+=y*y,U.primitiveLength+=(y-1)*(y-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{imagePositions:{},canonical:c})}}function zu(i,e){for(let r=0;r<i.length;r++)if(Nu(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Nu(i,e[r]))return!0;return!!rf(i,e)}function Kh(i,e,r){return!!Nu(i,e)||!!nf(e,i,r)}function im(i,e){if(i.length===1)return sm(e,i[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let c=0;c<a.length;c++)if(Nu(i,a[c]))return!0}for(let r=0;r<i.length;r++)if(sm(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(rf(i,e[r]))return!0;return!1}function l1(i,e,r){if(i.length>1){if(rf(i,e))return!0;for(let a=0;a<e.length;a++)if(nf(e[a],i,r))return!0}for(let a=0;a<i.length;a++)if(nf(i[a],e,r))return!0;return!1}function rf(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const a=i[r],c=i[r+1];for(let d=0;d<e.length-1;d++)if(c1(a,c,e[d],e[d+1]))return!0}return!1}function c1(i,e,r,a){return Le(i,r,a)!==Le(e,r,a)&&Le(i,e,r)!==Le(i,e,a)}function nf(i,e,r){const a=r*r;if(e.length===1)return i.distSqr(e[0])<a;for(let c=1;c<e.length;c++)if(nm(i,e[c-1],e[c])<a)return!0;return!1}function nm(i,e,r){const a=e.distSqr(r);if(a===0)return i.distSqr(e);const c=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/a;return i.distSqr(c<0?e:c>1?r:r.sub(e)._mult(c)._add(e))}function sm(i,e){let r,a,c,d=!1;for(let f=0;f<i.length;f++){r=i[f];for(let y=0,S=r.length-1;y<r.length;S=y++)a=r[y],c=r[S],a.y>e.y!=c.y>e.y&&e.x<(c.x-a.x)*(e.y-a.y)/(c.y-a.y)+a.x&&(d=!d)}return d}function Nu(i,e){let r=!1;for(let a=0,c=i.length-1;a<i.length;c=a++){const d=i[a],f=i[c];d.y>e.y!=f.y>e.y&&e.x<(f.x-d.x)*(e.y-d.y)/(f.y-d.y)+d.x&&(r=!r)}return r}function u1(i,e,r){const a=r[0],c=r[2];if(i.x<a.x&&e.x<a.x||i.x>c.x&&e.x>c.x||i.y<a.y&&e.y<a.y||i.y>c.y&&e.y>c.y)return!1;const d=Le(i,e,r[0]);return d!==Le(i,e,r[1])||d!==Le(i,e,r[2])||d!==Le(i,e,r[3])}function Ru(i,e,r){const a=e.paint.get(i).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Qh(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function ed(i,e,r,a,c){if(!e[0]&&!e[1])return i;const d=E.convert(e)._mult(c);r==="viewport"&&d._rotate(-a);const f=[];for(let y=0;y<i.length;y++)f.push(i[y].sub(d));return f}function h1(i){const e=[];for(let r=0;r<i.length;r++){const a=i[r],c=e.at(-1);(r===0||c&&!a.equals(c))&&e.push(a)}return e}function d1({queryGeometry:i,size:e},r){return Kh(i,r,e)}function f1({queryGeometry:i,size:e,transform:r,unwrappedTileID:a,getElevation:c},d){return Kh(i,d,e*(r.projectTileCoordinates(d.x,d.y,a,c).signedDistanceFromCamera/r.cameraToCenterDistance))}function p1({queryGeometry:i,size:e,transform:r,unwrappedTileID:a,getElevation:c},d){const f=r.projectTileCoordinates(d.x,d.y,a,c).signedDistanceFromCamera,y=e*(r.cameraToCenterDistance/f);return Kh(i,sf(d,r,a,c),y)}function m1({queryGeometry:i,size:e,transform:r,unwrappedTileID:a,getElevation:c},d){return Kh(i,sf(d,r,a,c),e)}function am({queryGeometry:i,size:e,transform:r,unwrappedTileID:a,getElevation:c,pitchAlignment:d="map",pitchScale:f="map"},y){const S=d==="map"?f==="map"?d1:f1:f==="map"?p1:m1,I={queryGeometry:i,size:e,transform:r,unwrappedTileID:a,getElevation:c};for(const D of y)for(const R of D)if(S(I,R))return!0;return!1}function sf(i,e,r,a){const c=e.projectTileCoordinates(i.x,i.y,r,a).point;return new E((.5*c.x+.5)*e.width,(.5*-c.y+.5)*e.height)}let om,lm;Ve("CircleBucket",Fu,{omit:["layers"]});var g1={get paint(){return lm=lm||new Fi({"circle-radius":new pr(ie.paint_circle["circle-radius"]),"circle-color":new pr(ie.paint_circle["circle-color"]),"circle-blur":new pr(ie.paint_circle["circle-blur"]),"circle-opacity":new pr(ie.paint_circle["circle-opacity"]),"circle-translate":new mr(ie.paint_circle["circle-translate"]),"circle-translate-anchor":new mr(ie.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new mr(ie.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new mr(ie.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new pr(ie.paint_circle["circle-stroke-width"]),"circle-stroke-color":new pr(ie.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new pr(ie.paint_circle["circle-stroke-opacity"])})},get layout(){return om=om||new Fi({"circle-sort-key":new pr(ie.layout_circle["circle-sort-key"])})}};class _1 extends ji{constructor(e,r){super(e,g1,r)}createBucket(e){return new Fu(e)}queryRadius(e){const r=e;return Ru("circle-radius",this,r)+Ru("circle-stroke-width",this,r)+Qh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:a,geometry:c,transform:d,pixelsToTileUnits:f,unwrappedTileID:y,getElevation:S}){const I=ed(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-d.bearingInRadians,f),D=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a),R=this.paint.get("circle-pitch-scale"),U=this.paint.get("circle-pitch-alignment");let q,H;return U==="map"?(q=I,H=D*f):(q=(function(X,K,de,ze){return X.map((pe=>sf(pe,K,de,ze)))})(I,d,y,S),H=D),am({queryGeometry:q,size:H,transform:d,unwrappedTileID:y,getElevation:S,pitchAlignment:U,pitchScale:R},c)}}class cm extends Fu{}let um;Ve("HeatmapBucket",cm,{omit:["layers"]});var y1={get paint(){return um=um||new Fi({"heatmap-radius":new pr(ie.paint_heatmap["heatmap-radius"]),"heatmap-weight":new pr(ie.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new mr(ie.paint_heatmap["heatmap-intensity"]),"heatmap-color":new hn(ie.paint_heatmap["heatmap-color"]),"heatmap-opacity":new mr(ie.paint_heatmap["heatmap-opacity"])})}};function af(i,{width:e,height:r},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*r*a)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${e*r*a}`)}else c=new Uint8Array(e*r*a);return i.width=e,i.height=r,i.data=c,i}function hm(i,{width:e,height:r},a){if(e===i.width&&r===i.height)return;const c=af({},{width:e,height:r},a);of(i,c,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},a),i.width=e,i.height=r,i.data=c.data}function of(i,e,r,a,c,d){if(c.width===0||c.height===0)return e;if(c.width>i.width||c.height>i.height||r.x>i.width-c.width||r.y>i.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||a.x>e.width-c.width||a.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const f=i.data,y=e.data;if(f===y)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<c.height;S++){const I=((r.y+S)*i.width+r.x)*d,D=((a.y+S)*e.width+a.x)*d;for(let R=0;R<c.width*d;R++)y[D+R]=f[I+R]}return e}class yh{constructor(e,r){af(this,e,1,r)}resize(e){hm(this,e,1)}clone(){return new yh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,c,d){of(e,r,a,c,d,1)}}class va{constructor(e,r){af(this,e,4,r)}resize(e){hm(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new va({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,c,d){of(e,r,a,c,d,4)}setPixel(e,r,a){const c=4*(e*this.width+r);this.data[c+0]=Math.round(255*a.r/a.a),this.data[c+1]=Math.round(255*a.g/a.a),this.data[c+2]=Math.round(255*a.b/a.a),this.data[c+3]=Math.round(255*a.a)}}function dm(i){const e={},r=i.resolution||256,a=i.clips?i.clips.length:1,c=i.image||new va({width:r,height:a});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const d=(f,y,S)=>{e[i.evaluationKey]=S;const I=i.expression.evaluate(e);c.setPixel(f/4/r,y/4,I)};if(i.clips)for(let f=0,y=0;f<a;++f,y+=4*r)for(let S=0,I=0;S<r;S++,I+=4){const D=S/(r-1),{start:R,end:U}=i.clips[f];d(y,I,R*(1-D)+U*D)}else for(let f=0,y=0;f<r;f++,y+=4)d(0,y,f/(r-1));return c}Ve("AlphaImage",yh),Ve("RGBAImage",va);const lf="big-fb";class v1 extends ji{createBucket(e){return new cm(e)}constructor(e,r){super(e,y1,r),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=dm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(lf)&&this.heatmapFbos.delete(lf)}queryRadius(e){return Ru("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:a,geometry:c,transform:d,pixelsToTileUnits:f,unwrappedTileID:y,getElevation:S}){return am({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(r,a)*f,transform:d,unwrappedTileID:y,getElevation:S},c)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let fm;var b1={get paint(){return fm=fm||new Fi({"hillshade-illumination-direction":new mr(ie.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new mr(ie.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new mr(ie.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new mr(ie.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new mr(ie.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new mr(ie.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new mr(ie.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new mr(ie.paint_hillshade["hillshade-method"])})}};class x1 extends ji{constructor(e,r){super(e,b1,r),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,a=this.paint.get("hillshade-highlight-color").values,c=this.paint.get("hillshade-shadow-color").values;const d=Math.max(e.length,r.length,a.length,c.length);e=e.concat(Array(d-e.length).fill(e.at(-1))),r=r.concat(Array(d-r.length).fill(r.at(-1))),a=a.concat(Array(d-a.length).fill(a.at(-1))),c=c.concat(Array(d-c.length).fill(c.at(-1)));const f=r.map(li);return{directionRadians:e.map(li),altitudeRadians:f,shadowColor:c,highlightColor:a}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let pm;var w1={get paint(){return pm=pm||new Fi({"color-relief-opacity":new mr(ie["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new hn(ie["paint_color-relief"]["color-relief-color"])})}};class cf{constructor(e,r,a,c){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(r,c)}update(e,r,a){const{width:c,height:d}=e,f=!(this.size&&this.size[0]===c&&this.size[1]===d||a),{context:y}=this,{gl:S}=y;if(this.useMipmap=!!(r&&r.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!r||r.premultiply!==!1)),f)this.size=[c,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Tr(e)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,e):S.texImage2D(S.TEXTURE_2D,0,this.format,c,d,0,this.format,S.UNSIGNED_BYTE,e.data);else{const{x:I,y:D}=a||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Tr(e)?S.texSubImage2D(S.TEXTURE_2D,0,I,D,S.RGBA,S.UNSIGNED_BYTE,e):S.texSubImage2D(S.TEXTURE_2D,0,I,D,c,d,S.RGBA,S.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D),y.pixelStoreUnpackFlipY.setDefault(),y.pixelStoreUnpack.setDefault(),y.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,r,a){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),a!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=d.LINEAR),e!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,a||e),this.filter=e),r!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,r),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class mm{constructor(e,r,a,c=1,d=1,f=1,y=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void _r(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const S=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=d,this.blueFactor=f,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<S;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(S,I)]=this.data[this._idx(S-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,S)]=this.data[this._idx(I,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<S;I++)for(let D=0;D<S;D++){const R=this.get(I,D);R>this.max&&(this.max=R),R<this.min&&(this.min=R)}}get(e,r){const a=new Uint8Array(this.data.buffer),c=4*this._idx(e,r);return this.unpack(a[c],a[c+1],a[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${r}, dim: ${this.dim}`);return(r+1)*this.stride+(e+1)}unpack(e,r,a){return e*this.redFactor+r*this.greenFactor+a*this.blueFactor-this.baseShift}pack(e){return gm(e,this.getUnpackVector())}getPixels(){return new va({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=r*this.dim,d=r*this.dim+this.dim,f=a*this.dim,y=a*this.dim+this.dim;switch(r){case-1:c=d-1;break;case 1:d=c+1}switch(a){case-1:f=y-1;break;case 1:y=f+1}const S=-r*this.dim,I=-a*this.dim;for(let D=f;D<y;D++)for(let R=c;R<d;R++)this.data[this._idx(R,D)]=e.data[this._idx(R+S,D+I)]}}function gm(i,e){const r=e[0],a=e[1],c=e[2],d=e[3],f=Math.min(r,a,c),y=Math.round((i+d)/f);return{r:Math.floor(y*f/r)%256,g:Math.floor(y*f/a)%256,b:Math.floor(y*f/c)%256}}Ve("DEMData",mm);class S1 extends ji{constructor(e,r){super(e,w1,r)}_createColorRamp(e){const r={elevationStops:[],colorStops:[]},a=this._transitionablePaint._values["color-relief-color"].value.expression;if(a instanceof Ic&&a._styleExpression.expression instanceof Rt){this.colorRampExpression=a;const f=a._styleExpression.expression;r.elevationStops=f.labels,r.colorStops=[];for(const y of r.elevationStops)r.colorStops.push(f.evaluate({globals:{elevation:y}}))}if(r.elevationStops.length<1&&(r.elevationStops=[0],r.colorStops=[Ur.transparent]),r.elevationStops.length<2&&(r.elevationStops.push(r.elevationStops[0]+1),r.colorStops.push(r.colorStops[0])),r.elevationStops.length<=e)return r;const c={elevationStops:[],colorStops:[]},d=(r.elevationStops.length-1)/(e-1);for(let f=0;f<r.elevationStops.length-.5;f+=d)c.elevationStops.push(r.elevationStops[Math.round(f)]),c.colorStops.push(r.colorStops[Math.round(f)]);return _r(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${r.elevationStops.length}`),c}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,r,a){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const c=this._createColorRamp(r),d=new va({width:c.colorStops.length,height:1}),f=new va({width:c.colorStops.length,height:1});for(let y=0;y<c.elevationStops.length;y++){const S=gm(c.elevationStops[y],a);f.setPixel(0,y,new Ur(S.r/255,S.g/255,S.b/255,1)),d.setPixel(0,y,c.colorStops[y])}return this.colorRampTextures={elevationTexture:new cf(e,f,e.gl.RGBA),colorTexture:new cf(e,d,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const T1=xi([{name:"a_pos",components:2,type:"Int16"}],4),{members:P1}=T1;function td(i,e,r){const a=r.patternDependencies;let c=!1;for(const d of e){const f=d.paint.get(`${i}-pattern`);f.isConstant()||(c=!0);const y=f.constantOr(null);y&&(c=!0,a[y.to]=!0,a[y.from]=!0)}return c}function uf(i,e,r,a,c){const{zoom:d}=a,f=c.patternDependencies;for(const y of e){const S=y.paint.get(`${i}-pattern`).value;if(S.kind!=="constant"){let I=S.evaluate({zoom:d-1},r,{},c.availableImages),D=S.evaluate({zoom:d},r,{},c.availableImages),R=S.evaluate({zoom:d+1},r,{},c.availableImages);I=I&&I.name?I.name:I,D=D&&D.name?D.name:D,R=R&&R.name?R.name:R,f[I]=!0,f[D]=!0,f[R]=!0,r.patterns[y.id]={min:I,mid:D,max:R}}}return r}function _m(i,e,r,a,c){let d;if(c===(function(f,y,S,I){let D=0;for(let R=y,U=S-I;R<S;R+=I)D+=(f[U]-f[R])*(f[R+1]+f[U+1]),U=R;return D})(i,e,r,a)>0)for(let f=e;f<r;f+=a)d=xm(f/a|0,i[f],i[f+1],d);else for(let f=r-a;f>=e;f-=a)d=xm(f/a|0,i[f],i[f+1],d);return d&&Bu(d,d.next)&&(wh(d),d=d.next),d}function du(i,e){if(!i)return i;e||(e=i);let r,a=i;do if(r=!1,a.steiner||!Bu(a,a.next)&&kn(a.prev,a,a.next)!==0)a=a.next;else{if(wh(a),a=e=a.prev,a===a.next)break;r=!0}while(r||a!==e);return e}function vh(i,e,r,a,c,d,f){if(!i)return;!f&&d&&(function(S,I,D,R){let U=S;do U.z===0&&(U.z=hf(U.x,U.y,I,D,R)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==S);U.prevZ.nextZ=null,U.prevZ=null,(function(q){let H,X=1;do{let K,de=q;q=null;let ze=null;for(H=0;de;){H++;let pe=de,xe=0;for(let Ke=0;Ke<X&&(xe++,pe=pe.nextZ,pe);Ke++);let je=X;for(;xe>0||je>0&&pe;)xe!==0&&(je===0||!pe||de.z<=pe.z)?(K=de,de=de.nextZ,xe--):(K=pe,pe=pe.nextZ,je--),ze?ze.nextZ=K:q=K,K.prevZ=ze,ze=K;de=pe}ze.nextZ=null,X*=2}while(H>1)})(U)})(i,a,c,d);let y=i;for(;i.prev!==i.next;){const S=i.prev,I=i.next;if(d?I1(i,a,c,d):A1(i))e.push(S.i,i.i,I.i),wh(i),i=I.next,y=I.next;else if((i=I)===y){f?f===1?vh(i=L1(du(i),e),e,r,a,c,d,2):f===2&&C1(i,e,r,a,c,d):vh(du(i),e,r,a,c,d,1);break}}}function A1(i){const e=i.prev,r=i,a=i.next;if(kn(e,r,a)>=0)return!1;const c=e.x,d=r.x,f=a.x,y=e.y,S=r.y,I=a.y,D=Math.min(c,d,f),R=Math.min(y,S,I),U=Math.max(c,d,f),q=Math.max(y,S,I);let H=a.next;for(;H!==e;){if(H.x>=D&&H.x<=U&&H.y>=R&&H.y<=q&&bh(c,y,d,S,f,I,H.x,H.y)&&kn(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function I1(i,e,r,a){const c=i.prev,d=i,f=i.next;if(kn(c,d,f)>=0)return!1;const y=c.x,S=d.x,I=f.x,D=c.y,R=d.y,U=f.y,q=Math.min(y,S,I),H=Math.min(D,R,U),X=Math.max(y,S,I),K=Math.max(D,R,U),de=hf(q,H,e,r,a),ze=hf(X,K,e,r,a);let pe=i.prevZ,xe=i.nextZ;for(;pe&&pe.z>=de&&xe&&xe.z<=ze;){if(pe.x>=q&&pe.x<=X&&pe.y>=H&&pe.y<=K&&pe!==c&&pe!==f&&bh(y,D,S,R,I,U,pe.x,pe.y)&&kn(pe.prev,pe,pe.next)>=0||(pe=pe.prevZ,xe.x>=q&&xe.x<=X&&xe.y>=H&&xe.y<=K&&xe!==c&&xe!==f&&bh(y,D,S,R,I,U,xe.x,xe.y)&&kn(xe.prev,xe,xe.next)>=0))return!1;xe=xe.nextZ}for(;pe&&pe.z>=de;){if(pe.x>=q&&pe.x<=X&&pe.y>=H&&pe.y<=K&&pe!==c&&pe!==f&&bh(y,D,S,R,I,U,pe.x,pe.y)&&kn(pe.prev,pe,pe.next)>=0)return!1;pe=pe.prevZ}for(;xe&&xe.z<=ze;){if(xe.x>=q&&xe.x<=X&&xe.y>=H&&xe.y<=K&&xe!==c&&xe!==f&&bh(y,D,S,R,I,U,xe.x,xe.y)&&kn(xe.prev,xe,xe.next)>=0)return!1;xe=xe.nextZ}return!0}function L1(i,e){let r=i;do{const a=r.prev,c=r.next.next;!Bu(a,c)&&vm(a,r,r.next,c)&&xh(a,c)&&xh(c,a)&&(e.push(a.i,r.i,c.i),wh(r),wh(r.next),r=i=c),r=r.next}while(r!==i);return du(r)}function C1(i,e,r,a,c,d){let f=i;do{let y=f.next.next;for(;y!==f.prev;){if(f.i!==y.i&&F1(f,y)){let S=bm(f,y);return f=du(f,f.next),S=du(S,S.next),vh(f,e,r,a,c,d,0),void vh(S,e,r,a,c,d,0)}y=y.next}f=f.next}while(f!==i)}function M1(i,e){let r=i.x-e.x;return r===0&&(r=i.y-e.y,r===0)&&(r=(i.next.y-i.y)/(i.next.x-i.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function E1(i,e){const r=(function(c,d){let f=d;const y=c.x,S=c.y;let I,D=-1/0;if(Bu(c,f))return f;do{if(Bu(c,f.next))return f.next;if(S<=f.y&&S>=f.next.y&&f.next.y!==f.y){const X=f.x+(S-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(X<=y&&X>D&&(D=X,I=f.x<f.next.x?f:f.next,X===y))return I}f=f.next}while(f!==d);if(!I)return null;const R=I,U=I.x,q=I.y;let H=1/0;f=I;do{if(y>=f.x&&f.x>=U&&y!==f.x&&ym(S<q?y:D,S,U,q,S<q?D:y,S,f.x,f.y)){const X=Math.abs(S-f.y)/(y-f.x);xh(f,c)&&(X<H||X===H&&(f.x>I.x||f.x===I.x&&k1(I,f)))&&(I=f,H=X)}f=f.next}while(f!==R);return I})(i,e);if(!r)return e;const a=bm(r,i);return du(a,a.next),du(r,r.next)}function k1(i,e){return kn(i.prev,i,e.prev)<0&&kn(e.next,i,i.next)<0}function hf(i,e,r,a,c){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*c|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function D1(i){let e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function ym(i,e,r,a,c,d,f,y){return(c-f)*(e-y)>=(i-f)*(d-y)&&(i-f)*(a-y)>=(r-f)*(e-y)&&(r-f)*(d-y)>=(c-f)*(a-y)}function bh(i,e,r,a,c,d,f,y){return!(i===f&&e===y)&&ym(i,e,r,a,c,d,f,y)}function F1(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!(function(r,a){let c=r;do{if(c.i!==r.i&&c.next.i!==r.i&&c.i!==a.i&&c.next.i!==a.i&&vm(c,c.next,r,a))return!0;c=c.next}while(c!==r);return!1})(i,e)&&(xh(i,e)&&xh(e,i)&&(function(r,a){let c=r,d=!1;const f=(r.x+a.x)/2,y=(r.y+a.y)/2;do c.y>y!=c.next.y>y&&c.next.y!==c.y&&f<(c.next.x-c.x)*(y-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==r);return d})(i,e)&&(kn(i.prev,i,e.prev)||kn(i,e.prev,e))||Bu(i,e)&&kn(i.prev,i,i.next)>0&&kn(e.prev,e,e.next)>0)}function kn(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Bu(i,e){return i.x===e.x&&i.y===e.y}function vm(i,e,r,a){const c=id(kn(i,e,r)),d=id(kn(i,e,a)),f=id(kn(r,a,i)),y=id(kn(r,a,e));return c!==d&&f!==y||!(c!==0||!rd(i,r,e))||!(d!==0||!rd(i,a,e))||!(f!==0||!rd(r,i,a))||!(y!==0||!rd(r,e,a))}function rd(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function id(i){return i>0?1:i<0?-1:0}function xh(i,e){return kn(i.prev,i,i.next)<0?kn(i,e,i.next)>=0&&kn(i,i.prev,e)>=0:kn(i,e,i.prev)<0||kn(i,i.next,e)<0}function bm(i,e){const r=df(i.i,i.x,i.y),a=df(e.i,e.x,e.y),c=i.next,d=e.prev;return i.next=e,e.prev=i,r.next=c,c.prev=r,a.next=r,r.prev=a,d.next=a,a.prev=d,a}function xm(i,e,r,a){const c=df(i,e,r);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function wh(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function df(i,e,r){return{i,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Ou{constructor(e,r){if(r>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=r}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class nd{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}nd.noSubdivision=new nd({fill:new Ou(0,0),line:new Ou(0,0),tile:new Ou(0,0),stencil:new Ou(0,0),circle:1}),Ve("SubdivisionGranularityExpression",Ou),Ve("SubdivisionGranularitySetting",nd);const ju=-32768,Sh=32767;class z1{constructor(e,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=gt/e,this._canonical=r}_getKey(e,r){return(e+=32768)<<16|r+32768}_vertexToIndex(e,r){if(e<-32768||r<-32768||e>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const a=0|Math.round(e),c=0|Math.round(r),d=this._getKey(a,c);if(this._vertexDictionary.has(d))return this._vertexDictionary.get(d);const f=this._vertexBuffer.length/2;return this._vertexDictionary.set(d,f),this._vertexBuffer.push(a,c),f}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(c,d){const f=[];for(let y=0;y<d.length;y+=3){const S=d[y],I=d[y+1],D=d[y+2],R=c[2*S],U=c[2*S+1];(c[2*I]-R)*(c[2*D+1]-U)-(c[2*I+1]-U)*(c[2*D]-R)>0?(f.push(S),f.push(D),f.push(I)):(f.push(S),f.push(I),f.push(D))}return f})(this._vertexBuffer,e);const r=[],a=e.length;for(let c=0;c<a;c+=3){const d=[e[c+0],e[c+1],e[c+2]],f=[this._vertexBuffer[2*e[c+0]+0],this._vertexBuffer[2*e[c+0]+1],this._vertexBuffer[2*e[c+1]+0],this._vertexBuffer[2*e[c+1]+1],this._vertexBuffer[2*e[c+2]+0],this._vertexBuffer[2*e[c+2]+1]];let y=1/0,S=1/0,I=-1/0,D=-1/0;for(let X=0;X<3;X++){const K=f[2*X],de=f[2*X+1];y=Math.min(y,K),I=Math.max(I,K),S=Math.min(S,de),D=Math.max(D,de)}if(y===I||S===D)continue;const R=Math.floor(y/this._granularityCellSize),U=Math.ceil(I/this._granularityCellSize),q=Math.floor(S/this._granularityCellSize),H=Math.ceil(D/this._granularityCellSize);if(R!==U||q!==H)for(let X=q;X<H;X++){const K=this._scanlineGenerateVertexRingForCellRow(X,f,d);N1(this._vertexBuffer,K,r)}else r.push(...d)}return r}_scanlineGenerateVertexRingForCellRow(e,r,a){const c=e*this._granularityCellSize,d=c+this._granularityCellSize,f=[];for(let y=0;y<3;y++){const S=r[2*y],I=r[2*y+1],D=r[2*(y+1)%6],R=r[(2*(y+1)+1)%6],U=r[2*(y+2)%6],q=r[(2*(y+2)+1)%6],H=D-S,X=R-I,K=H===0,de=X===0,ze=(c-I)/X,pe=(d-I)/X,xe=Math.min(ze,pe),je=Math.max(ze,pe);if(!de&&(xe>=1||je<=0)||de&&(I<c||I>d)){R>=c&&R<=d&&f.push(a[(y+1)%3]);continue}!de&&xe>0&&f.push(this._vertexToIndex(S+H*xe,I+X*xe));const Ke=S+H*Math.max(xe,0),bt=S+H*Math.min(je,1);K||this._generateIntraEdgeVertices(f,S,I,D,R,Ke,bt),!de&&je<1&&f.push(this._vertexToIndex(S+H*je,I+X*je)),(de||R>=c&&R<=d)&&f.push(a[(y+1)%3]),!de&&(R<=c||R>=d)&&this._generateInterEdgeVertices(f,S,I,D,R,U,q,bt,c,d)}return f}_generateIntraEdgeVertices(e,r,a,c,d,f,y){const S=c-r,I=d-a,D=I===0,R=D?Math.min(r,c):Math.min(f,y),U=D?Math.max(r,c):Math.max(f,y),q=Math.floor(R/this._granularityCellSize)+1,H=Math.ceil(U/this._granularityCellSize)-1;if(D?r<c:f<y)for(let X=q;X<=H;X++){const K=X*this._granularityCellSize;e.push(this._vertexToIndex(K,a+I*(K-r)/S))}else for(let X=H;X>=q;X--){const K=X*this._granularityCellSize;e.push(this._vertexToIndex(K,a+I*(K-r)/S))}}_generateInterEdgeVertices(e,r,a,c,d,f,y,S,I,D){const R=d-a,U=f-c,q=y-d,H=(I-d)/q,X=(D-d)/q,K=Math.min(H,X),de=Math.max(H,X),ze=c+U*K;let pe=Math.floor(Math.min(ze,S)/this._granularityCellSize)+1,xe=Math.ceil(Math.max(ze,S)/this._granularityCellSize)-1,je=S<ze;const Ke=q===0;if(Ke&&(y===I||y===D))return;if(Ke||K>=1||de<=0){const Bt=a-y,Nt=f+(r-f)*Math.min((I-y)/Bt,(D-y)/Bt);pe=Math.floor(Math.min(Nt,S)/this._granularityCellSize)+1,xe=Math.ceil(Math.max(Nt,S)/this._granularityCellSize)-1,je=S<Nt}const bt=R>0?D:I;if(je)for(let Bt=pe;Bt<=xe;Bt++)e.push(this._vertexToIndex(Bt*this._granularityCellSize,bt));else for(let Bt=xe;Bt>=pe;Bt--)e.push(this._vertexToIndex(Bt*this._granularityCellSize,bt))}_generateOutline(e){const r=[];for(const a of e){const c=fu(a,this._granularity,!0),d=this._pointArrayToIndices(c),f=[];for(let y=1;y<d.length;y++)f.push(d[y-1]),f.push(d[y]);r.push(f)}return r}_handlePoles(e){let r=!1,a=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(a=!0)),(r||a)&&this._fillPoles(e,r,a)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let r=0;r<e.length;r+=2){const a=e[r+1];a===ju&&(e[r+1]=-32767),a===Sh&&(e[r+1]=32766)}}_generatePoleQuad(e,r,a,c,d,f){c>d!=(f===ju)?(e.push(r),e.push(a),e.push(this._vertexToIndex(c,f)),e.push(a),e.push(this._vertexToIndex(d,f)),e.push(this._vertexToIndex(c,f))):(e.push(a),e.push(r),e.push(this._vertexToIndex(c,f)),e.push(this._vertexToIndex(d,f)),e.push(a),e.push(this._vertexToIndex(c,f)))}_fillPoles(e,r,a){const c=this._vertexBuffer,d=gt,f=e.length;for(let y=2;y<f;y+=3){const S=e[y-2],I=e[y-1],D=e[y],R=c[2*S],U=c[2*S+1],q=c[2*I],H=c[2*I+1],X=c[2*D],K=c[2*D+1];r&&(U===0&&H===0&&this._generatePoleQuad(e,S,I,R,q,ju),H===0&&K===0&&this._generatePoleQuad(e,I,D,q,X,ju),K===0&&U===0&&this._generatePoleQuad(e,D,S,X,R,ju)),a&&(U===d&&H===d&&this._generatePoleQuad(e,S,I,R,q,Sh),H===d&&K===d&&this._generatePoleQuad(e,I,D,q,X,Sh),K===d&&U===d&&this._generatePoleQuad(e,D,S,X,R,Sh))}}_initializeVertices(e){for(let r=0;r<e.length;r+=2)this._vertexToIndex(e[r],e[r+1])}subdividePolygonInternal(e,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:a,holeIndices:c}=(function(y){const S=[],I=[];for(const D of y)if(D.length!==0){D!==y[0]&&S.push(I.length/2);for(let R=0;R<D.length;R++)I.push(D[R].x),I.push(D[R].y)}return{flattened:I,holeIndices:S}})(e);let d;this._initializeVertices(a);try{const y=(function(I,D,R=2){const U=D&&D.length,q=U?D[0]*R:I.length;let H=_m(I,0,q,R,!0);const X=[];if(!H||H.next===H.prev)return X;let K,de,ze;if(U&&(H=(function(pe,xe,je,Ke){const bt=[];for(let Bt=0,Nt=xe.length;Bt<Nt;Bt++){const qt=_m(pe,xe[Bt]*Ke,Bt<Nt-1?xe[Bt+1]*Ke:pe.length,Ke,!1);qt===qt.next&&(qt.steiner=!0),bt.push(D1(qt))}bt.sort(M1);for(let Bt=0;Bt<bt.length;Bt++)je=E1(bt[Bt],je);return je})(I,D,H,R)),I.length>80*R){K=I[0],de=I[1];let pe=K,xe=de;for(let je=R;je<q;je+=R){const Ke=I[je],bt=I[je+1];Ke<K&&(K=Ke),bt<de&&(de=bt),Ke>pe&&(pe=Ke),bt>xe&&(xe=bt)}ze=Math.max(pe-K,xe-de),ze=ze!==0?32767/ze:0}return vh(H,X,R,K,de,ze,0),X})(a,c),S=this._convertIndices(a,y);d=this._subdivideTrianglesScanline(S)}catch(y){console.error(y)}let f=[];return r&&(f=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(d),{verticesFlattened:this._vertexBuffer,indicesTriangles:d,indicesLineList:f}}_convertIndices(e,r){const a=[];for(let c=0;c<r.length;c++)a.push(this._vertexToIndex(e[2*r[c]],e[2*r[c]+1]));return a}_pointArrayToIndices(e){const r=[];for(let a=0;a<e.length;a++){const c=e[a];r.push(this._vertexToIndex(c.x,c.y))}return r}}function wm(i,e,r,a=!0){return new z1(r,e).subdividePolygonInternal(i,a)}function fu(i,e,r=!1){if(!i||i.length<1)return[];if(i.length<2)return[];const a=i[0],c=i[i.length-1],d=r&&(a.x!==c.x||a.y!==c.y);if(e<2)return d?[...i,i[0]]:[...i];const f=Math.floor(gt/e),y=[];y.push(new E(i[0].x,i[0].y));const S=i.length,I=d?S:S-1;for(let D=0;D<I;D++){const R=i[D],U=D<S-1?i[D+1]:i[0],q=R.x,H=R.y,X=U.x,K=U.y,de=q!==X,ze=H!==K;if(!de&&!ze)continue;const pe=X-q,xe=K-H,je=Math.abs(pe),Ke=Math.abs(xe);let bt=q,Bt=H;for(;;){const qt=pe>0?(Math.floor(bt/f)+1)*f:(Math.ceil(bt/f)-1)*f,ir=xe>0?(Math.floor(Bt/f)+1)*f:(Math.ceil(Bt/f)-1)*f,Kt=Math.abs(bt-qt),Ft=Math.abs(Bt-ir),Et=Math.abs(bt-X),hr=Math.abs(Bt-K),or=de?Kt/je:Number.POSITIVE_INFINITY,gr=ze?Ft/Ke:Number.POSITIVE_INFINITY;if((Et<=Kt||!de)&&(hr<=Ft||!ze))break;if(or<gr&&de||!ze){bt=qt,Bt+=xe*or;const cr=new E(bt,Math.round(Bt));y[y.length-1].x===cr.x&&y[y.length-1].y===cr.y||y.push(cr)}else{bt+=pe*gr,Bt=ir;const cr=new E(Math.round(bt),Bt);y[y.length-1].x===cr.x&&y[y.length-1].y===cr.y||y.push(cr)}}const Nt=new E(X,K);y[y.length-1].x===Nt.x&&y[y.length-1].y===Nt.y||y.push(Nt)}return y}function N1(i,e,r){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let a=0,c=i[2*e[0]];for(let S=1;S<e.length;S++){const I=i[2*e[S]];I<c&&(c=I,a=S)}const d=e.length;let f=a,y=(f+1)%d;for(;;){const S=f-1>=0?f-1:d-1,I=(y+1)%d,D=i[2*e[S]],R=i[2*e[I]],U=i[2*e[f]],q=i[2*e[f]+1],H=i[2*e[y]+1];let X=!1;if(D<R)X=!0;else if(D>R)X=!1;else{const K=H-q,de=-(i[2*e[y]]-U),ze=q<H?1:-1;((D-U)*K+(i[2*e[S]+1]-q)*de)*ze>((R-U)*K+(i[2*e[I]+1]-q)*de)*ze&&(X=!0)}if(X){const K=e[S],de=e[f],ze=e[y];K!==de&&K!==ze&&de!==ze&&r.push(ze,de,K),f--,f<0&&(f=d-1)}else{const K=e[I],de=e[f],ze=e[y];K!==de&&K!==ze&&de!==ze&&r.push(ze,de,K),y++,y>=d&&(y=0)}if(S===I)break}}function Sm(i,e,r,a,c,d,f,y,S){const I=c.length/2,D=f&&y&&S;if(I<nr.MAX_VERTEX_ARRAY_LENGTH){const R=e.prepareSegment(I,r,a),U=R.vertexLength;for(let X=0;X<d.length;X+=3)a.emplaceBack(U+d[X],U+d[X+1],U+d[X+2]);let q,H;R.vertexLength+=I,R.primitiveLength+=d.length/3,D&&(H=f.prepareSegment(I,r,y),q=H.vertexLength,H.vertexLength+=I);for(let X=0;X<c.length;X+=2)i(c[X],c[X+1]);if(D)for(let X=0;X<S.length;X++){const K=S[X];for(let de=1;de<K.length;de+=2)y.emplaceBack(q+K[de-1],q+K[de]);H.primitiveLength+=K.length/2}}else(function(R,U,q,H,X,K){const de=[];for(let Ke=0;Ke<H.length/2;Ke++)de.push(-1);const ze={count:0};let pe=0,xe=R.getOrCreateLatestSegment(U,q),je=xe.vertexLength;for(let Ke=2;Ke<X.length;Ke+=3){const bt=X[Ke-2],Bt=X[Ke-1],Nt=X[Ke];let qt=de[bt]<pe,ir=de[Bt]<pe,Kt=de[Nt]<pe;xe.vertexLength+((qt?1:0)+(ir?1:0)+(Kt?1:0))>nr.MAX_VERTEX_ARRAY_LENGTH&&(xe=R.createNewSegment(U,q),pe=ze.count,qt=!0,ir=!0,Kt=!0,je=0);const Ft=Th(de,H,K,ze,bt,qt,xe),Et=Th(de,H,K,ze,Bt,ir,xe),hr=Th(de,H,K,ze,Nt,Kt,xe);q.emplaceBack(je+Ft-pe,je+Et-pe,je+hr-pe),xe.primitiveLength++}})(e,r,a,c,d,i),D&&(function(R,U,q,H,X,K){const de=[];for(let Ke=0;Ke<H.length/2;Ke++)de.push(-1);const ze={count:0};let pe=0,xe=R.getOrCreateLatestSegment(U,q),je=xe.vertexLength;for(let Ke=0;Ke<X.length;Ke++){const bt=X[Ke];for(let Bt=1;Bt<X[Ke].length;Bt+=2){const Nt=bt[Bt-1],qt=bt[Bt];let ir=de[Nt]<pe,Kt=de[qt]<pe;xe.vertexLength+((ir?1:0)+(Kt?1:0))>nr.MAX_VERTEX_ARRAY_LENGTH&&(xe=R.createNewSegment(U,q),pe=ze.count,ir=!0,Kt=!0,je=0);const Ft=Th(de,H,K,ze,Nt,ir,xe),Et=Th(de,H,K,ze,qt,Kt,xe);q.emplaceBack(je+Ft-pe,je+Et-pe),xe.primitiveLength++}}})(f,r,y,c,S,i),e.forceNewSegmentOnNextPrepare(),f?.forceNewSegmentOnNextPrepare()}function Th(i,e,r,a,c,d,f){if(d){const y=a.count;return r(e[2*c],e[2*c+1]),i[c]=a.count,a.count++,f.vertexLength++,y}return i[c]}class ff{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new Se,this.indexArray=new Pt,this.indexArray2=new er,this.programConfigurations=new fc(e.layers,e.zoom),this.segments=new nr,this.segments2=new nr,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,a){this.hasDependencies=td("fill",this.layers,r);const c=this.layers[0].layout.get("fill-sort-key"),d=!c.isConstant(),f=[];for(const{feature:y,id:S,index:I,sourceLayerIndex:D}of e){const R=this.layers[0]._featureFilter.needGeometry,U=Bl(y,R);if(!this.layers[0]._featureFilter.filter(new Kr(this.zoom),U,a))continue;const q=d?c.evaluate(U,{},a,r.availableImages):void 0,H={id:S,properties:y.properties,type:y.type,sourceLayerIndex:D,index:I,geometry:R?U.geometry:Rl(y),patterns:{},sortKey:q};f.push(H)}d&&f.sort(((y,S)=>y.sortKey-S.sortKey));for(const y of f){const{geometry:S,index:I,sourceLayerIndex:D}=y;if(this.hasDependencies){const R=uf("fill",this.layers,y,{zoom:this.zoom},r);this.patternFeatures.push(R)}else this.addFeature(y,S,I,a,{},r.subdivisionGranularity);r.featureIndex.insert(e[I].feature,S,I,D,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:a})}addFeatures(e,r,a){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,a,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,P1),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,c,d,f){for(const y of fa(r,500)){const S=wm(y,c,f.fill.getGranularityForZoomLevel(c.z)),I=this.layoutVertexArray;Sm(((D,R)=>{I.emplaceBack(D,R)}),this.segments,this.layoutVertexArray,this.indexArray,S.verticesFlattened,S.indicesTriangles,this.segments2,this.indexArray2,S.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{imagePositions:d,canonical:c})}}let Tm,Pm;Ve("FillBucket",ff,{omit:["layers","patternFeatures"]});var R1={get paint(){return Pm=Pm||new Fi({"fill-antialias":new mr(ie.paint_fill["fill-antialias"]),"fill-opacity":new pr(ie.paint_fill["fill-opacity"]),"fill-color":new pr(ie.paint_fill["fill-color"]),"fill-outline-color":new pr(ie.paint_fill["fill-outline-color"]),"fill-translate":new mr(ie.paint_fill["fill-translate"]),"fill-translate-anchor":new mr(ie.paint_fill["fill-translate-anchor"]),"fill-pattern":new Bn(ie.paint_fill["fill-pattern"])})},get layout(){return Tm=Tm||new Fi({"fill-sort-key":new pr(ie.layout_fill["fill-sort-key"])})}};class B1 extends ji{constructor(e,r){super(e,R1,r)}recalculate(e,r){super.recalculate(e,r);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new ff(e)}queryRadius(){return Qh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:r,transform:a,pixelsToTileUnits:c}){return im(ed(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-a.bearingInRadians,c),r)}isTileClipped(){return!0}}const O1=xi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),j1=xi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:V1}=O1;class Ph{constructor(e,r,a,c,d){this.properties={},this.extent=a,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=c,this._values=d,e.readFields(U1,this,r)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos,a=[];let c,d=1,f=0,y=0,S=0;for(;e.pos<r;){if(f<=0){const I=e.readVarint();d=7&I,f=I>>3}if(f--,d===1||d===2)y+=e.readSVarint(),S+=e.readSVarint(),d===1&&(c&&a.push(c),c=[]),c&&c.push(new E(y,S));else{if(d!==7)throw new Error(`unknown command ${d}`);c&&c.push(c[0].clone())}}return c&&a.push(c),a}bbox(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos;let a=1,c=0,d=0,f=0,y=1/0,S=-1/0,I=1/0,D=-1/0;for(;e.pos<r;){if(c<=0){const R=e.readVarint();a=7&R,c=R>>3}if(c--,a===1||a===2)d+=e.readSVarint(),f+=e.readSVarint(),d<y&&(y=d),d>S&&(S=d),f<I&&(I=f),f>D&&(D=f);else if(a!==7)throw new Error(`unknown command ${a}`)}return[y,I,S,D]}toGeoJSON(e,r,a){const c=this.extent*Math.pow(2,a),d=this.extent*e,f=this.extent*r,y=this.loadGeometry();function S(U){return[360*(U.x+d)/c-180,360/Math.PI*Math.atan(Math.exp((1-2*(U.y+f)/c)*Math.PI))-90]}function I(U){return U.map(S)}let D;if(this.type===1){const U=[];for(const H of y)U.push(H[0]);const q=I(U);D=U.length===1?{type:"Point",coordinates:q[0]}:{type:"MultiPoint",coordinates:q}}else if(this.type===2){const U=y.map(I);D=U.length===1?{type:"LineString",coordinates:U[0]}:{type:"MultiLineString",coordinates:U}}else{if(this.type!==3)throw new Error("unknown feature type");{const U=Am(y),q=[];for(const H of U)q.push(H.map(I));D=q.length===1?{type:"Polygon",coordinates:q[0]}:{type:"MultiPolygon",coordinates:q}}}const R={type:"Feature",geometry:D,properties:this.properties};return this.id!=null&&(R.id=this.id),R}}function U1(i,e,r){i===1?e.id=r.readVarint():i===2?(function(a,c){const d=a.readVarint()+a.pos;for(;a.pos<d;){const f=c._keys[a.readVarint()],y=c._values[a.readVarint()];c.properties[f]=y}})(r,e):i===3?e.type=r.readVarint():i===4&&(e._geometry=r.pos)}function Am(i){const e=i.length;if(e<=1)return[i];const r=[];let a,c;for(let d=0;d<e;d++){const f=q1(i[d]);f!==0&&(c===void 0&&(c=f<0),c===f<0?(a&&r.push(a),a=[i[d]]):a&&a.push(i[d]))}return a&&r.push(a),r}function q1(i){let e=0;for(let r,a,c=0,d=i.length,f=d-1;c<d;f=c++)r=i[c],a=i[f],e+=(a.x-r.x)*(r.y+a.y);return e}Ph.types=["Unknown","Point","LineString","Polygon"];class G1{constructor(e,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields($1,this,r),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const r=this._pbf.readVarint()+this._pbf.pos;return new Ph(this._pbf,r,this.extent,this._keys,this._values)}}function $1(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push((function(a){let c=null;const d=a.readVarint()+a.pos;for(;a.pos<d;){const f=a.readVarint()>>3;c=f===1?a.readString():f===2?a.readFloat():f===3?a.readDouble():f===4?a.readVarint64():f===5?a.readVarint():f===6?a.readSVarint():f===7?a.readBoolean():null}if(c==null)throw new Error("unknown feature value");return c})(r))}class Im{constructor(e,r){this.layers=e.readFields(Z1,{},r)}}function Z1(i,e,r){if(i===3){const a=new G1(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}const pf=Math.pow(2,13);function Ah(i,e,r,a,c,d,f,y){i.emplaceBack(e,r,2*Math.floor(a*pf)+f,c*pf*2,d*pf*2,Math.round(y))}class mf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new Me,this.centroidVertexArray=new be,this.indexArray=new Pt,this.programConfigurations=new fc(e.layers,e.zoom),this.segments=new nr,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,a){this.features=[],this.hasDependencies=td("fill-extrusion",this.layers,r);for(const{feature:c,id:d,index:f,sourceLayerIndex:y}of e){const S=this.layers[0]._featureFilter.needGeometry,I=Bl(c,S);if(!this.layers[0]._featureFilter.filter(new Kr(this.zoom),I,a))continue;const D={id:d,sourceLayerIndex:y,index:f,geometry:S?I.geometry:Rl(c),properties:c.properties,type:c.type,patterns:{}};this.hasDependencies?this.features.push(uf("fill-extrusion",this.layers,D,{zoom:this.zoom},r)):this.addFeature(D,D.geometry,f,a,{},r.subdivisionGranularity),r.featureIndex.insert(c,D.geometry,f,y,this.index,!0)}}addFeatures(e,r,a){for(const c of this.features){const{geometry:d}=c;this.addFeature(c,d,c.index,r,a,e.subdivisionGranularity)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:a})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,V1),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,j1.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,a,c,d,f){for(const y of fa(r,500)){const S={x:0,y:0,sampleCount:0},I=this.layoutVertexArray.length;this.processPolygon(S,c,e,y,f);const D=this.layoutVertexArray.length-I,R=Math.floor(S.x/S.sampleCount),U=Math.floor(S.y/S.sampleCount);for(let q=0;q<D;q++)this.centroidVertexArray.emplaceBack(R,U)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{imagePositions:d,canonical:c})}processPolygon(e,r,a,c,d){if(c.length<1||Lm(c[0]))return;for(const R of c)R.length!==0&&W1(e,R);const f={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},y=d.fill.getGranularityForZoomLevel(r.z),S=Ph.types[a.type]==="Polygon";for(const R of c){if(R.length===0||Lm(R))continue;const U=fu(R,y,S);this._generateSideFaces(U,f)}if(!S)return;const I=wm(c,r,y,!1),D=this.layoutVertexArray;Sm(((R,U)=>{Ah(D,R,U,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,I.verticesFlattened,I.indicesTriangles)}_generateSideFaces(e,r){let a=0;for(let c=1;c<e.length;c++){const d=e[c],f=e[c-1];if(H1(d,f))continue;r.segment.vertexLength+4>nr.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const y=d.sub(f)._perp()._unit(),S=f.dist(d);a+S>32768&&(a=0),Ah(this.layoutVertexArray,d.x,d.y,y.x,y.y,0,0,a),Ah(this.layoutVertexArray,d.x,d.y,y.x,y.y,0,1,a),a+=S,Ah(this.layoutVertexArray,f.x,f.y,y.x,y.y,0,0,a),Ah(this.layoutVertexArray,f.x,f.y,y.x,y.y,0,1,a);const I=r.segment.vertexLength;this.indexArray.emplaceBack(I,I+2,I+1),this.indexArray.emplaceBack(I+1,I+2,I+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function W1(i,e){for(let r=0;r<e.length;r++){const a=e[r];r===e.length-1&&e[0].x===a.x&&e[0].y===a.y||(i.x+=a.x,i.y+=a.y,i.sampleCount++)}}function H1(i,e){return i.x===e.x&&(i.x<0||i.x>gt)||i.y===e.y&&(i.y<0||i.y>gt)}function Lm(i){return i.every((e=>e.x<0))||i.every((e=>e.x>gt))||i.every((e=>e.y<0))||i.every((e=>e.y>gt))}let Cm;Ve("FillExtrusionBucket",mf,{omit:["layers","features"]});var X1={get paint(){return Cm=Cm||new Fi({"fill-extrusion-opacity":new mr(ie["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new pr(ie["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new mr(ie["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new mr(ie["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Bn(ie["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new pr(ie["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new pr(ie["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new mr(ie["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Y1 extends ji{constructor(e,r){super(e,X1,r)}createBucket(e){return new mf(e)}queryRadius(){return Qh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:a,geometry:c,transform:d,pixelsToTileUnits:f,pixelPosMatrix:y}){const S=ed(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-d.bearingInRadians,f),I=this.paint.get("fill-extrusion-height").evaluate(r,a),D=this.paint.get("fill-extrusion-base").evaluate(r,a),R=(function(q,H){const X=[];for(const K of q){const de=[K.x,K.y,0,1];Ye(de,de,H),X.push(new E(de[0]/de[3],de[1]/de[3]))}return X})(S,y),U=(function(q,H,X,K){const de=[],ze=[],pe=K[8]*H,xe=K[9]*H,je=K[10]*H,Ke=K[11]*H,bt=K[8]*X,Bt=K[9]*X,Nt=K[10]*X,qt=K[11]*X;for(const ir of q){const Kt=[],Ft=[];for(const Et of ir){const hr=Et.x,or=Et.y,gr=K[0]*hr+K[4]*or+K[12],cr=K[1]*hr+K[5]*or+K[13],Ar=K[2]*hr+K[6]*or+K[14],yi=K[3]*hr+K[7]*or+K[15],ui=Ar+je,sn=yi+Ke,ws=gr+bt,On=cr+Bt,an=Ar+Nt,Yi=yi+qt,Li=new E((gr+pe)/sn,(cr+xe)/sn);Li.z=ui/sn,Kt.push(Li);const yn=new E(ws/Yi,On/Yi);yn.z=an/Yi,Ft.push(yn)}de.push(Kt),ze.push(Ft)}return[de,ze]})(c,D,I,y);return(function(q,H,X){let K=1/0;im(X,H)&&(K=Mm(X,H[0]));for(let de=0;de<H.length;de++){const ze=H[de],pe=q[de];for(let xe=0;xe<ze.length-1;xe++){const je=ze[xe],Ke=[je,ze[xe+1],pe[xe+1],pe[xe],je];zu(X,Ke)&&(K=Math.min(K,Mm(X,Ke)))}}return K!==1/0&&K})(U[0],U[1],R)}}function Ih(i,e){return i.x*e.x+i.y*e.y}function Mm(i,e){if(i.length===1){let r=0;const a=e[r++];let c;for(;!c||a.equals(c);)if(c=e[r++],!c)return 1/0;for(;r<e.length;r++){const d=e[r],f=i[0],y=c.sub(a),S=d.sub(a),I=f.sub(a),D=Ih(y,y),R=Ih(y,S),U=Ih(S,S),q=Ih(I,y),H=Ih(I,S),X=D*U-R*R,K=(U*q-R*H)/X,de=(D*H-R*q)/X,ze=a.z*(1-K-de)+c.z*K+d.z*de;if(isFinite(ze))return ze}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}const J1=xi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:K1}=J1,Q1=xi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:ev}=Q1,tv=Math.cos(Math.PI/180*37.5),Em=Math.pow(2,14)/.5;class gf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((r=>{this.gradients[r.id]={}})),this.layoutVertexArray=new He,this.layoutVertexArray2=new Ee,this.indexArray=new Pt,this.programConfigurations=new fc(e.layers,e.zoom),this.segments=new nr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,a){this.hasDependencies=td("line",this.layers,r)||this.hasLineDasharray(this.layers);const c=this.layers[0].layout.get("line-sort-key"),d=!c.isConstant(),f=[];for(const{feature:y,id:S,index:I,sourceLayerIndex:D}of e){const R=this.layers[0]._featureFilter.needGeometry,U=Bl(y,R);if(!this.layers[0]._featureFilter.filter(new Kr(this.zoom),U,a))continue;const q=d?c.evaluate(U,{},a):void 0,H={id:S,properties:y.properties,type:y.type,sourceLayerIndex:D,index:I,geometry:R?U.geometry:Rl(y),patterns:{},dashes:{},sortKey:q};f.push(H)}d&&f.sort(((y,S)=>y.sortKey-S.sortKey));for(const y of f){const{geometry:S,index:I,sourceLayerIndex:D}=y;this.hasDependencies?(td("line",this.layers,r)?uf("line",this.layers,y,{zoom:this.zoom},r):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,y,this.zoom,r),this.patternFeatures.push(y)):this.addFeature(y,S,I,a,{},{},r.subdivisionGranularity),r.featureIndex.insert(e[I].feature,S,I,D,this.index)}}update(e,r,a,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:a,dashPositions:c})}addFeatures(e,r,a,c){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,a,c,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ev)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,K1),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,c,d,f,y){const S=this.layers[0].layout,I=S.get("line-join").evaluate(e,{}),D=S.get("line-cap"),R=S.get("line-miter-limit"),U=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const q of r)this.addLine(q,e,I,D,R,U,c,y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{imagePositions:d,dashPositions:f,canonical:c})}addLine(e,r,a,c,d,f,y,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=fu(e,y?S.line.getGranularityForZoomLevel(y.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let pe=0;pe<e.length-1;pe++)this.totalDistance+=e[pe].dist(e[pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=Ph.types[r.type]==="Polygon";let D=e.length;for(;D>=2&&e[D-1].equals(e[D-2]);)D--;let R=0;for(;R<D-1&&e[R].equals(e[R+1]);)R++;if(D<(I?3:2))return;a==="bevel"&&(d=1.05);const U=this.overscaling<=16?122880/(512*this.overscaling):0,q=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray);let H,X,K,de,ze;this.e1=this.e2=-1,I&&(H=e[D-2],ze=e[R].sub(H)._unit()._perp());for(let pe=R;pe<D;pe++){if(K=pe===D-1?I?e[R+1]:void 0:e[pe+1],K&&e[pe].equals(K))continue;ze&&(de=ze),H&&(X=H),H=e[pe],ze=K?K.sub(H)._unit()._perp():de,de=de||ze;let xe=de.add(ze);xe.x===0&&xe.y===0||xe._unit();const je=de.x*ze.x+de.y*ze.y,Ke=xe.x*ze.x+xe.y*ze.y,bt=Ke!==0?1/Ke:1/0,Bt=2*Math.sqrt(2-2*Ke),Nt=Ke<tv&&X&&K,qt=de.x*ze.y-de.y*ze.x>0;if(Nt&&pe>R){const Ft=H.dist(X);if(Ft>2*U){const Et=H.sub(H.sub(X)._mult(U/Ft)._round());this.updateDistance(X,Et),this.addCurrentVertex(Et,de,0,0,q),X=Et}}const ir=X&&K;let Kt=ir?a:I?"butt":c;if(ir&&Kt==="round"&&(bt<f?Kt="miter":bt<=2&&(Kt="fakeround")),Kt==="miter"&&bt>d&&(Kt="bevel"),Kt==="bevel"&&(bt>2&&(Kt="flipbevel"),bt<d&&(Kt="miter")),X&&this.updateDistance(X,H),Kt==="miter")xe._mult(bt),this.addCurrentVertex(H,xe,0,0,q);else if(Kt==="flipbevel"){if(bt>100)xe=ze.mult(-1);else{const Ft=bt*de.add(ze).mag()/de.sub(ze).mag();xe._perp()._mult(Ft*(qt?-1:1))}this.addCurrentVertex(H,xe,0,0,q),this.addCurrentVertex(H,xe.mult(-1),0,0,q)}else if(Kt==="bevel"||Kt==="fakeround"){const Ft=-Math.sqrt(bt*bt-1),Et=qt?Ft:0,hr=qt?0:Ft;if(X&&this.addCurrentVertex(H,de,Et,hr,q),Kt==="fakeround"){const or=Math.round(180*Bt/Math.PI/20);for(let gr=1;gr<or;gr++){let cr=gr/or;if(cr!==.5){const yi=cr-.5;cr+=cr*yi*(cr-1)*((1.0904+je*(je*(3.55645-1.43519*je)-3.2452))*yi*yi+(.848013+je*(.215638*je-1.06021)))}const Ar=ze.sub(de)._mult(cr)._add(de)._unit()._mult(qt?-1:1);this.addHalfVertex(H,Ar.x,Ar.y,!1,qt,0,q)}}K&&this.addCurrentVertex(H,ze,-Et,-hr,q)}else if(Kt==="butt")this.addCurrentVertex(H,xe,0,0,q);else if(Kt==="square"){const Ft=X?1:-1;this.addCurrentVertex(H,xe,Ft,Ft,q)}else Kt==="round"&&(X&&(this.addCurrentVertex(H,de,0,0,q),this.addCurrentVertex(H,de,1,1,q,!0)),K&&(this.addCurrentVertex(H,ze,-1,-1,q,!0),this.addCurrentVertex(H,ze,0,0,q)));if(Nt&&pe<D-1){const Ft=H.dist(K);if(Ft>2*U){const Et=H.add(K.sub(H)._mult(U/Ft)._round());this.updateDistance(H,Et),this.addCurrentVertex(Et,ze,0,0,q),H=Et}}}}addCurrentVertex(e,r,a,c,d,f=!1){const y=r.y*c-r.x,S=-r.y-r.x*c;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,f,!1,a,d),this.addHalfVertex(e,y,S,f,!0,-c,d),this.distance>Em/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,a,c,d,f))}addHalfVertex({x:e,y:r},a,c,d,f,y,S){const I=.5*(this.lineClips?this.scaledDistance*(Em-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(r<<1)+(f?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(y===0?0:y<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const D=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,D,this.e2),S.primitiveLength++),f?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}hasLineDasharray(e){for(const r of e){const a=r.paint.get("line-dasharray");if(a&&!a.isConstant())return!0}return!1}addLineDashDependencies(e,r,a,c){for(const d of e){const f=d.paint.get("line-dasharray");if(!f||f.value.kind==="constant")continue;const y=d.layout.get("line-cap")==="round",S={dasharray:f.value.evaluate({zoom:a-1},r,{}),round:y},I={dasharray:f.value.evaluate({zoom:a},r,{}),round:y},D={dasharray:f.value.evaluate({zoom:a+1},r,{}),round:y},R=`${S.dasharray.join(",")},${S.round}`,U=`${I.dasharray.join(",")},${I.round}`,q=`${D.dasharray.join(",")},${D.round}`;c.dashDependencies[R]=S,c.dashDependencies[U]=I,c.dashDependencies[q]=D,r.dashes[d.id]={min:R,mid:U,max:q}}}}let km,Dm;Ve("LineBucket",gf,{omit:["layers","patternFeatures"]});var Fm={get paint(){return Dm=Dm||new Fi({"line-opacity":new pr(ie.paint_line["line-opacity"]),"line-color":new pr(ie.paint_line["line-color"]),"line-translate":new mr(ie.paint_line["line-translate"]),"line-translate-anchor":new mr(ie.paint_line["line-translate-anchor"]),"line-width":new pr(ie.paint_line["line-width"]),"line-gap-width":new pr(ie.paint_line["line-gap-width"]),"line-offset":new pr(ie.paint_line["line-offset"]),"line-blur":new pr(ie.paint_line["line-blur"]),"line-dasharray":new Bn(ie.paint_line["line-dasharray"]),"line-pattern":new Bn(ie.paint_line["line-pattern"]),"line-gradient":new hn(ie.paint_line["line-gradient"])})},get layout(){return km=km||new Fi({"line-cap":new mr(ie.layout_line["line-cap"]),"line-join":new pr(ie.layout_line["line-join"]),"line-miter-limit":new mr(ie.layout_line["line-miter-limit"]),"line-round-limit":new mr(ie.layout_line["line-round-limit"]),"line-sort-key":new pr(ie.layout_line["line-sort-key"])})}};class rv extends pr{possiblyEvaluate(e,r){return r=new Kr(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,a,c){return r=ft({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,a,c)}}let sd;class iv extends ji{constructor(e,r){super(e,Fm,r),this.gradientVersion=0,sd||(sd=new rv(Fm.paint.properties["line-width"].specification),sd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!(function(a){return a._styleExpression!==void 0})(r)&&r._styleExpression.expression instanceof ha,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=sd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new gf(e)}queryRadius(e){const r=e,a=zm(Ru("line-width",this,r),Ru("line-gap-width",this,r)),c=Ru("line-offset",this,r);return a/2+Math.abs(c)+Qh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:a,geometry:c,transform:d,pixelsToTileUnits:f}){const y=ed(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-d.bearingInRadians,f),S=f/2*zm(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),I=this.paint.get("line-offset").evaluate(r,a);return I&&(c=(function(D,R){const U=[];for(let q=0;q<D.length;q++){const H=h1(D[q]),X=[];for(let K=0;K<H.length;K++){const de=H[K],ze=H[K-1],pe=H[K+1],xe=K===0?new E(0,0):de.sub(ze)._unit()._perp(),je=K===H.length-1?new E(0,0):pe.sub(de)._unit()._perp(),Ke=xe._add(je)._unit(),bt=Ke.x*je.x+Ke.y*je.y;bt!==0&&Ke._mult(1/bt),X.push(Ke._mult(R)._add(de))}U.push(X)}return U})(c,I*f)),(function(D,R,U){for(let q=0;q<R.length;q++){const H=R[q];if(D.length>=3){for(let X=0;X<H.length;X++)if(Nu(D,H[X]))return!0}if(l1(D,H,U))return!0}return!1})(y,c,S)}isTileClipped(){return!0}}function zm(i,e){return e>0?e+2*i:i}const nv=xi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),sv=xi([{name:"a_projected_pos",components:3,type:"Float32"}],4);xi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const av=xi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);xi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Nm=xi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ov=xi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function lv(i,e,r){return i.sections.forEach((a=>{a.text=(function(c,d,f){const y=d.layout.get("text-transform").evaluate(f,{});return y==="uppercase"?c=c.toLocaleUpperCase():y==="lowercase"&&(c=c.toLocaleLowerCase()),bi.applyArabicShaping&&(c=bi.applyArabicShaping(c)),c})(a.text,e,r)})),i}xi([{name:"triangle",components:3,type:"Uint16"}]),xi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),xi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),xi([{type:"Float32",name:"offsetX"}]),xi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),xi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Kn=24;const Lh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},cv={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},uv={40:!0};function Rm(i,e,r,a,c,d){if("fontStack"in e){const f=r[e.fontStack],y=f&&f[i];return y?y.metrics.advance*e.scale+c:0}{const f=a[e.imageName];return f?f.displaySize[0]*e.scale*Kn/d+c:0}}function Bm(i,e,r,a){const c=Math.pow(i-e,2);return a?i<e?c/2:2*c:c+Math.abs(r)*r}function hv(i,e,r){let a=0;return i===10&&(a-=1e4),r&&(a+=150),i!==40&&i!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function Om(i,e,r,a,c,d){let f=null,y=Bm(e,r,c,d);for(const S of a){const I=Bm(e-S.x,r,c,d)+S.badness;I<=y&&(f=S,y=I)}return{index:i,x:e,priorBreak:f,badness:y}}function jm(i){return i?jm(i.priorBreak).concat(i.index):[]}class Vu{constructor(e="",r=[],a=[]){this.text=e,this.sections=r,this.sectionIndex=a,this.imageSectionID=null}static fromFeature(e,r){const a=new Vu;for(let c=0;c<e.sections.length;c++){const d=e.sections[c];d.image?a.addImageSection(d):a.addTextSection(d,r)}return a}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let r="",a={premature:!0,value:void 0};const c=e[Symbol.iterator]();let d=c.next();const f=e[Symbol.iterator]();f.next();let y=f.next();for(;!d.done;)r+=!y.done&&Ir(y.value.codePointAt(0))&&!Lh[y.value]||!a.premature&&Ir(a.value.codePointAt(0))&&!Lh[a.value]||!Lh[d.value]?d.value:Lh[d.value],a={value:d.value,premature:!1},d=c.next(),y=f.next();return r})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),r=e?e[0].length:0,a=this.text.match(/\S\s*$/),c=a?a[0].length-1:0;this.text=this.text.substring(r,this.text.length-c),this.sectionIndex=this.sectionIndex.slice(r,this.sectionIndex.length-c)}substring(e,r){const a=[...this.text].slice(e,r).join(""),c=this.sectionIndex.slice(e,r);return new Vu(a,this.sections,c)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,r)=>Math.max(e,this.sections[r].scale)),0)}getMaxImageSize(e){let r=0,a=0;for(let c=0;c<this.length();c++){const d=this.getSection(c);if("imageName"in d){const f=e[d.imageName];if(!f)continue;const y=f.displaySize;r=Math.max(r,y[0]),a=Math.max(a,y[1])}}return{maxImageWidth:r,maxImageHeight:a}}addTextSection(e,r){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||r});const a=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>a)))}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void _r("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:r}),this.sectionIndex.push(this.sections.length-1)):_r("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,r,a,c,d){const f=[],y=this.determineAverageLineWidth(e,r,a,c,d),S=this.hasZeroWidthSpaces();let I=0,D=0;const R=this.text[Symbol.iterator]();let U=R.next();const q=this.text[Symbol.iterator]();q.next();let H=q.next();const X=this.text[Symbol.iterator]();X.next(),X.next();let K=X.next();for(;!U.done;){const de=this.getSection(D),ze=U.value.codePointAt(0);if(Sr(ze)||(I+=Rm(ze,de,a,c,e,d)),!H.done){const pe=Jt(ze),xe=H.value.codePointAt(0);(cv[ze]||pe||"imageName"in de||!K.done&&uv[xe])&&f.push(Om(D+1,I,y,f,hv(ze,xe,pe&&S),!1))}D++,U=R.next(),H=q.next(),K=X.next()}return jm(Om(this.length(),I,y,f,0,!0))}determineAverageLineWidth(e,r,a,c,d){let f=0,y=0;for(const S of this.text){const I=this.getSection(y);f+=Rm(S.codePointAt(0),I,a,c,e,d),y++}return f/Math.max(1,Math.ceil(f/r))}}const _f=4294967296,Vm=1/_f,Um=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class ad{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,r,a=this.length){for(;this.pos<a;){const c=this.readVarint(),d=c>>3,f=this.pos;this.type=7&c,e(d,r,this),this.pos===f&&this.skip(c)}return r}readMessage(e,r){return this.readFields(e,r,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*_f;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*_f;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const r=this.buf;let a,c;return c=r[this.pos++],a=127&c,c<128?a:(c=r[this.pos++],a|=(127&c)<<7,c<128?a:(c=r[this.pos++],a|=(127&c)<<14,c<128?a:(c=r[this.pos++],a|=(127&c)<<21,c<128?a:(c=r[this.pos],a|=(15&c)<<28,(function(d,f,y){const S=y.buf;let I,D;if(D=S[y.pos++],I=(112&D)>>4,D<128||(D=S[y.pos++],I|=(127&D)<<3,D<128)||(D=S[y.pos++],I|=(127&D)<<10,D<128)||(D=S[y.pos++],I|=(127&D)<<17,D<128)||(D=S[y.pos++],I|=(127&D)<<24,D<128)||(D=S[y.pos++],I|=(1&D)<<31,D<128))return Uu(d,I,f);throw new Error("Expected varint not more than 10 bytes")})(a,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,r=this.pos;return this.pos=e,e-r>=12&&Um?Um.decode(this.buf.subarray(r,e)):(function(a,c,d){let f="",y=c;for(;y<d;){const S=a[y];let I,D,R,U=null,q=S>239?4:S>223?3:S>191?2:1;if(y+q>d)break;q===1?S<128&&(U=S):q===2?(I=a[y+1],(192&I)==128&&(U=(31&S)<<6|63&I,U<=127&&(U=null))):q===3?(I=a[y+1],D=a[y+2],(192&I)==128&&(192&D)==128&&(U=(15&S)<<12|(63&I)<<6|63&D,(U<=2047||U>=55296&&U<=57343)&&(U=null))):q===4&&(I=a[y+1],D=a[y+2],R=a[y+3],(192&I)==128&&(192&D)==128&&(192&R)==128&&(U=(15&S)<<18|(63&I)<<12|(63&D)<<6|63&R,(U<=65535||U>=1114112)&&(U=null))),U===null?(U=65533,q=1):U>65535&&(U-=65536,f+=String.fromCharCode(U>>>10&1023|55296),U=56320|1023&U),f+=String.fromCharCode(U),y+=q}return f})(this.buf,r,e)}readBytes(){const e=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,e);return this.pos=e,r}readPackedVarint(e=[],r){const a=this.readPackedEnd();for(;this.pos<a;)e.push(this.readVarint(r));return e}readPackedSVarint(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const r=7&e;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(e,r){this.writeVarint(e<<3|r)}realloc(e){let r=this.length||16;for(;r<this.pos+e;)r*=2;if(r!==this.length){const a=new Uint8Array(r);a.set(this.buf),this.buf=a,this.dataView=new DataView(a.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Vm),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Vm),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(r,a){let c,d;if(r>=0?(c=r%4294967296|0,d=r/4294967296|0):(c=~(-r%4294967296),d=~(-r/4294967296),4294967295^c?c=c+1|0:(c=0,d=d+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),(function(f,y,S){S.buf[S.pos++]=127&f|128,f>>>=7,S.buf[S.pos++]=127&f|128,f>>>=7,S.buf[S.pos++]=127&f|128,f>>>=7,S.buf[S.pos++]=127&f|128,S.buf[S.pos]=127&(f>>>=7)})(c,0,a),(function(f,y){const S=(7&f)<<4;y.buf[y.pos++]|=S|((f>>>=3)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f)))))})(d,a)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const r=this.pos;this.pos=(function(c,d,f){for(let y,S,I=0;I<d.length;I++){if(y=d.charCodeAt(I),y>55295&&y<57344){if(!S){y>56319||I+1===d.length?(c[f++]=239,c[f++]=191,c[f++]=189):S=y;continue}if(y<56320){c[f++]=239,c[f++]=191,c[f++]=189,S=y;continue}y=S-55296<<10|y-56320|65536,S=null}else S&&(c[f++]=239,c[f++]=191,c[f++]=189,S=null);y<128?c[f++]=y:(y<2048?c[f++]=y>>6|192:(y<65536?c[f++]=y>>12|224:(c[f++]=y>>18|240,c[f++]=y>>12&63|128),c[f++]=y>>6&63|128),c[f++]=63&y|128)}return f})(this.buf,e,this.pos);const a=this.pos-r;a>=128&&qm(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const r=e.length;this.writeVarint(r),this.realloc(r);for(let a=0;a<r;a++)this.buf[this.pos++]=e[a]}writeRawMessage(e,r){this.pos++;const a=this.pos;e(r,this);const c=this.pos-a;c>=128&&qm(a,c,this),this.pos=a-1,this.writeVarint(c),this.pos+=c}writeMessage(e,r,a){this.writeTag(e,2),this.writeRawMessage(r,a)}writePackedVarint(e,r){r.length&&this.writeMessage(e,dv,r)}writePackedSVarint(e,r){r.length&&this.writeMessage(e,fv,r)}writePackedBoolean(e,r){r.length&&this.writeMessage(e,gv,r)}writePackedFloat(e,r){r.length&&this.writeMessage(e,pv,r)}writePackedDouble(e,r){r.length&&this.writeMessage(e,mv,r)}writePackedFixed32(e,r){r.length&&this.writeMessage(e,_v,r)}writePackedSFixed32(e,r){r.length&&this.writeMessage(e,yv,r)}writePackedFixed64(e,r){r.length&&this.writeMessage(e,vv,r)}writePackedSFixed64(e,r){r.length&&this.writeMessage(e,bv,r)}writeBytesField(e,r){this.writeTag(e,2),this.writeBytes(r)}writeFixed32Field(e,r){this.writeTag(e,5),this.writeFixed32(r)}writeSFixed32Field(e,r){this.writeTag(e,5),this.writeSFixed32(r)}writeFixed64Field(e,r){this.writeTag(e,1),this.writeFixed64(r)}writeSFixed64Field(e,r){this.writeTag(e,1),this.writeSFixed64(r)}writeVarintField(e,r){this.writeTag(e,0),this.writeVarint(r)}writeSVarintField(e,r){this.writeTag(e,0),this.writeSVarint(r)}writeStringField(e,r){this.writeTag(e,2),this.writeString(r)}writeFloatField(e,r){this.writeTag(e,5),this.writeFloat(r)}writeDoubleField(e,r){this.writeTag(e,1),this.writeDouble(r)}writeBooleanField(e,r){this.writeVarintField(e,+r)}}function Uu(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function qm(i,e,r){const a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(let c=r.pos-1;c>=i;c--)r.buf[c+a]=r.buf[c]}function dv(i,e){for(let r=0;r<i.length;r++)e.writeVarint(i[r])}function fv(i,e){for(let r=0;r<i.length;r++)e.writeSVarint(i[r])}function pv(i,e){for(let r=0;r<i.length;r++)e.writeFloat(i[r])}function mv(i,e){for(let r=0;r<i.length;r++)e.writeDouble(i[r])}function gv(i,e){for(let r=0;r<i.length;r++)e.writeBoolean(i[r])}function _v(i,e){for(let r=0;r<i.length;r++)e.writeFixed32(i[r])}function yv(i,e){for(let r=0;r<i.length;r++)e.writeSFixed32(i[r])}function vv(i,e){for(let r=0;r<i.length;r++)e.writeFixed64(i[r])}function bv(i,e){for(let r=0;r<i.length;r++)e.writeSFixed64(i[r])}function xv(i,e,r){i===1&&r.readMessage(wv,e)}function wv(i,e,r){if(i===3){const{id:a,bitmap:c,width:d,height:f,left:y,top:S,advance:I}=r.readMessage(Sv,{});e.push({id:a,bitmap:new yh({width:d+6,height:f+6},c),metrics:{width:d,height:f,left:y,top:S,advance:I}})}}function Sv(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function Gm(i){let e=0,r=0;for(const f of i)e+=f.w*f.h,r=Math.max(r,f.w);i.sort(((f,y)=>y.h-f.h));const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let c=0,d=0;for(const f of i)for(let y=a.length-1;y>=0;y--){const S=a[y];if(!(f.w>S.w||f.h>S.h)){if(f.x=S.x,f.y=S.y,d=Math.max(d,f.y+f.h),c=Math.max(c,f.x+f.w),f.w===S.w&&f.h===S.h){const I=a.pop();I&&y<a.length&&(a[y]=I)}else f.h===S.h?(S.x+=f.w,S.w-=f.w):f.w===S.w?(S.y+=f.h,S.h-=f.h):(a.push({x:S.x+f.w,y:S.y,w:S.w-f.w,h:f.h}),S.y+=f.h,S.h-=f.h);break}}return{w:c,h:d,fill:e/(c*d)||0}}class yf{constructor(e,{pixelRatio:r,version:a,stretchX:c,stretchY:d,content:f,textFitWidth:y,textFitHeight:S}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=c,this.stretchY=d,this.content=f,this.version=a,this.textFitWidth=y,this.textFitHeight=S}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class $m{constructor(e,r){const a={},c={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,a,d),this.addImages(r,c,d);const{w:f,h:y}=Gm(d),S=new va({width:f||1,height:y||1});for(const I in e){const D=e[I],R=a[I].paddedRect;va.copy(D.data,S,{x:0,y:0},{x:R.x+1,y:R.y+1},D.data)}for(const I in r){const D=r[I],R=c[I].paddedRect,U=R.x+1,q=R.y+1,H=D.data.width,X=D.data.height;va.copy(D.data,S,{x:0,y:0},{x:U,y:q},D.data),va.copy(D.data,S,{x:0,y:X-1},{x:U,y:q-1},{width:H,height:1}),va.copy(D.data,S,{x:0,y:0},{x:U,y:q+X},{width:H,height:1}),va.copy(D.data,S,{x:H-1,y:0},{x:U-1,y:q},{width:1,height:X}),va.copy(D.data,S,{x:0,y:0},{x:U+H,y:q},{width:1,height:X})}this.image=S,this.iconPositions=a,this.patternPositions=c}addImages(e,r,a){for(const c in e){const d=e[c],f={x:0,y:0,w:d.data.width+2,h:d.data.height+2};a.push(f),r[c]=new yf(f,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[c,d]=e.tl;a.update(r.data,void 0,{x:c,y:d})}}var Rc;function od(i,e,r,a,c,d,f,y,S,I,D,R,U,q,H){const X=Vu.fromFeature(i,c);let K;R===b.az.vertical&&X.verticalizePunctuation();let de=X.determineLineBreaks(I,d,e,a,q);const{processBidirectionalText:ze,processStyledBidirectionalText:pe}=bi;if(ze&&X.sections.length===1){K=[],de=de.map((bt=>X.toCodeUnitIndex(bt)));const Ke=ze(X.toString(),de);for(const bt of Ke){const Bt=[...bt].map((()=>0));K.push(new Vu(bt,X.sections,Bt))}}else if(pe){K=[],de=de.map((Nt=>X.toCodeUnitIndex(Nt)));let Ke=0;const bt=[];for(const Nt of X.text)bt.push(...Array(Nt.length).fill(X.sectionIndex[Ke])),Ke++;const Bt=pe(X.text,bt,de);for(const Nt of Bt){const qt=[];let ir="";for(const Kt of Nt[0])qt.push(Nt[1][ir.length]),ir+=Kt;K.push(new Vu(Nt[0],X.sections,qt))}}else K=(function(Ke,bt){const Bt=[];let Nt=0;for(const qt of bt)Bt.push(Ke.substring(Nt,qt)),Nt=qt;return Nt<Ke.length()&&Bt.push(Ke.substring(Nt,Ke.length())),Bt})(X,de);const xe=[],je={positionedLines:xe,text:X.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:R,iconsInText:!1,verticalizable:!1};return(function(Ke,bt,Bt,Nt,qt,ir,Kt,Ft,Et,hr,or,gr){let cr=0,Ar=0,yi=0,ui=0;const sn=Ft==="right"?1:Ft==="left"?0:.5,ws=Kn/gr;let On=0;for(const Li of qt){Li.trim();const yn=Li.getMaxScale(),An={positionedGlyphs:[],lineOffset:0};Ke.positionedLines[On]=An;const Zi=An.positionedGlyphs;let ba=0;if(!Li.length()){Ar+=ir,++On;continue}const Ss=Tv(Nt,Li,ws);let xa=0;for(const ts of Li.text){const dn=Li.getSection(xa),jn=ts.codePointAt(0),vn=Pv(Et,or,jn),rs={glyph:jn,imageName:null,x:cr,y:Ar+-17,vertical:vn,scale:1,fontStack:"",sectionIndex:Li.getSectionIndex(xa),metrics:null,rect:null};let gc;if("fontStack"in dn){if(gc=Av(dn,jn,vn,Ss,bt,Bt),!gc)continue;rs.fontStack=dn.fontStack}else{if(Ke.iconsInText=!0,dn.scale*=ws,gc=Iv(dn,vn,yn,Ss,Nt),!gc)continue;ba=Math.max(ba,gc.imageOffset),rs.imageName=dn.imageName}const{rect:nl,metrics:zh,baselineOffset:Uc}=gc;rs.y+=Uc,rs.scale=dn.scale,rs.metrics=zh,rs.rect=nl,Zi.push(rs),vn?(Ke.verticalizable=!0,cr+=("imageName"in dn?zh.advance:Kn)*dn.scale+hr):cr+=zh.advance*dn.scale+hr,xa++}Zi.length!==0&&(yi=Math.max(cr-hr,yi),Lv(Zi,0,Zi.length-1,sn)),cr=0,An.lineOffset=Math.max(ba,(yn-1)*Kn);const zo=ir*yn+ba;Ar+=zo,ui=Math.max(zo,ui),++On}const{horizontalAlign:an,verticalAlign:Yi}=vf(Kt);(function(Li,yn,An,Zi,ba,Ss,xa,zo,ts){const dn=(yn-An)*ba;let jn=0;jn=Ss!==xa?-zo*Zi- -17:-Zi*ts*xa+.5*xa;for(const vn of Li)for(const rs of vn.positionedGlyphs)rs.x+=dn,rs.y+=jn})(Ke.positionedLines,sn,an,Yi,yi,ui,ir,Ar,qt.length),Ke.top+=-Yi*Ar,Ke.bottom=Ke.top+Ar,Ke.left+=-an*yi,Ke.right=Ke.left+yi})(je,e,r,a,K,f,y,S,R,I,U,H),!(function(Ke){for(const bt of Ke)if(bt.positionedGlyphs.length!==0)return!1;return!0})(xe)&&je}function vf(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Tv(i,e,r){const a=e.getMaxScale()*Kn,{maxImageWidth:c,maxImageHeight:d}=e.getMaxImageSize(i),f=Math.max(a,d*r);return{verticalLineContentWidth:Math.max(a,c*r),horizontalLineContentHeight:f}}function Zm(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function Pv(i,e,r){return!(i===b.az.horizontal||!e&&!Dr(r)||e&&(Sr(r)||(a=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(a)))));var a}function Av(i,e,r,a,c,d){const f=d[i.fontStack],y=(function(I,D,R,U){if(I&&I.rect)return I;const q=D[R.fontStack],H=q&&q[U];return H?{rect:null,metrics:H.metrics}:null})(f&&f[e],c,i,e);if(y===null)return null;let S;if(r)S=a.verticalLineContentWidth-i.scale*Kn;else{const I=Zm(i.verticalAlign);S=(a.horizontalLineContentHeight-i.scale*Kn)*I}return{rect:y.rect,metrics:y.metrics,baselineOffset:S}}function Iv(i,e,r,a,c){const d=c[i.imageName];if(!d)return null;const f=d.paddedRect,y=d.displaySize,S={width:y[0],height:y[1],left:1,top:-3,advance:e?y[1]:y[0]};let I;if(e)I=a.verticalLineContentWidth-y[1]*i.scale;else{const D=Zm(i.verticalAlign);I=(a.horizontalLineContentHeight-y[1]*i.scale)*D}return{rect:f,metrics:S,baselineOffset:I,imageOffset:(e?y[0]:y[1])*i.scale-Kn*r}}function Lv(i,e,r,a){if(a===0)return;const c=i[r],d=(i[r].x+c.metrics.advance*c.scale)*a;for(let f=e;f<=r;f++)i[f].x-=d}function Cv(i,e,r){const{horizontalAlign:a,verticalAlign:c}=vf(r),d=e[0]-i.displaySize[0]*a,f=e[1]-i.displaySize[1]*c;return{image:i,top:f,bottom:f+i.displaySize[1],left:d,right:d+i.displaySize[0]}}function Wm(i){var e,r;let a=i.left,c=i.top,d=i.right-a,f=i.bottom-c;const y=(e=i.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",S=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",I=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(S==="proportional"){if(y==="stretchOnly"&&d/f<I||y==="proportional"){const D=Math.ceil(f*I);a*=D/d,d=D}}else if(y==="proportional"&&S==="stretchOnly"&&I!==0&&d/f>I){const D=Math.ceil(d/I);c*=D/f,f=D}return{x1:a,y1:c,x2:a+d,y2:c+f}}function Hm(i,e,r,a,c,d){const f=i.image;let y;if(f.content){const K=f.content,de=f.pixelRatio||1;y=[K[0]/de,K[1]/de,f.displaySize[0]-K[2]/de,f.displaySize[1]-K[3]/de]}const S=e.left*d,I=e.right*d;let D,R,U,q;r==="width"||r==="both"?(q=c[0]+S-a[3],R=c[0]+I+a[1]):(q=c[0]+(S+I-f.displaySize[0])/2,R=q+f.displaySize[0]);const H=e.top*d,X=e.bottom*d;return r==="height"||r==="both"?(D=c[1]+H-a[0],U=c[1]+X+a[2]):(D=c[1]+(H+X-f.displaySize[1])/2,U=D+f.displaySize[1]),{image:f,top:D,right:R,bottom:U,left:q,collisionPadding:y}}Ve("ImagePosition",yf),Ve("ImageAtlas",$m),b.az=void 0,(Rc=b.az||(b.az={}))[Rc.none=0]="none",Rc[Rc.horizontal=1]="horizontal",Rc[Rc.vertical=2]="vertical",Rc[Rc.horizontalOnly=3]="horizontalOnly";const pc=128,Bc=32640;function Xm(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Kr(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:c}=r;let d=0;for(;d<a.length&&a[d]<=i;)d++;d=Math.max(0,d-1);let f=d;for(;f<a.length&&a[f]<i+1;)f++;f=Math.min(a.length-1,f);const y=a[d],S=a[f];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:S,interpolationType:c}:{kind:"camera",minZoom:y,maxZoom:S,minSize:r.evaluate(new Kr(y)),maxSize:r.evaluate(new Kr(S)),interpolationType:c}}}function bf(i,e,r){let a="never";const c=i.get(e);return c?a=c:i.get(r)&&(a="always"),a}const Mv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ld(i,e,r,a,c,d,f,y,S,I,D,R,U){const q=y?Math.min(Bc,Math.round(y[0])):0,H=y?Math.min(Bc,Math.round(y[1])):0;i.emplaceBack(e,r,Math.round(32*a),Math.round(32*c),d,f,(q<<1)+(S?1:0),H,16*I,16*D,256*R,256*U)}function xf(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function Ev(i){for(const e of i.sections)if(pi(e.text))return!0;return!1}class wf{constructor(e){this.layoutVertexArray=new qe,this.indexArray=new Pt,this.programConfigurations=e,this.segments=new nr,this.dynamicLayoutVertexArray=new lt,this.opacityVertexArray=new At,this.hasVisibleVertices=!1,this.placedSymbolArray=new w}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,a,c){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nv.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,sv.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Mv,!0),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ve("SymbolBuffers",wf);class Sf{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new nr,this.collisionVertexArray=new St}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,av.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ve("CollisionBuffers",Sf);class qu{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((f=>f.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Xm(this.zoom,r["text-size"]),this.iconSizeData=Xm(this.zoom,r["icon-size"]);const a=this.layers[0].layout,c=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.canOverlap=bf(a,"text-overlap","text-allow-overlap")!=="never"||bf(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map((f=>b.az[f]))),this.stateDependentLayerIds=this.layers.filter((f=>f.isStateDependent())).map((f=>f.id)),this.sourceID=e.sourceID}createArrays(){this.text=new wf(new fc(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new wf(new fc(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new z,this.lineVertexArray=new O,this.symbolInstances=new M,this.textAnchorOffsets=new G}calculateGlyphDependencies(e,r,a,c,d){for(const f of e)if(r[f.codePointAt(0)]=!0,(a||c)&&d){const y=Lh[f];y&&(r[y.codePointAt(0)]=!0)}}populate(e,r,a){const c=this.layers[0],d=c.layout,f=d.get("text-font"),y=d.get("text-field"),S=d.get("icon-image"),I=(y.value.kind!=="constant"||y.value.value instanceof Hn&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(f.value.kind!=="constant"||f.value.value.length>0),D=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,R=d.get("symbol-sort-key");if(this.features=[],!I&&!D)return;const U=r.iconDependencies,q=r.glyphDependencies,H=r.availableImages,X=new Kr(this.zoom);for(const{feature:K,id:de,index:ze,sourceLayerIndex:pe}of e){const xe=c._featureFilter.needGeometry,je=Bl(K,xe);if(!c._featureFilter.filter(X,je,a))continue;let Ke,bt;if(xe||(je.geometry=Rl(K)),I){const Nt=c.getValueAndResolveTokens("text-field",je,a,H),qt=Hn.factory(Nt),ir=this.hasRTLText=this.hasRTLText||Ev(qt);(!ir||bi.getRTLTextPluginStatus()==="unavailable"||ir&&bi.isParsed())&&(Ke=lv(qt,c,je))}if(D){const Nt=c.getValueAndResolveTokens("icon-image",je,a,H);bt=Nt instanceof is?Nt:is.fromString(Nt)}if(!Ke&&!bt)continue;const Bt=this.sortFeaturesByKey?R.evaluate(je,{},a):void 0;if(this.features.push({id:de,text:Ke,icon:bt,index:ze,sourceLayerIndex:pe,geometry:je.geometry,properties:K.properties,type:Ph.types[K.type],sortKey:Bt}),bt&&(U[bt.name]=!0),Ke){const Nt=f.evaluate(je,{},a).join(","),qt=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(b.az.vertical)>=0;for(const ir of Ke.sections)if(ir.image)U[ir.image.name]=!0;else{const Kt=Yr(Ke.toString()),Ft=ir.fontStack||Nt,Et=q[Ft]=q[Ft]||{};this.calculateGlyphDependencies(ir.text,Et,qt,this.allowVerticalPlacement,Kt)}}}d.get("symbol-placement")==="line"&&(this.features=(function(K){const de={},ze={},pe=[];let xe=0;function je(Nt){pe.push(K[Nt]),xe++}function Ke(Nt,qt,ir){const Kt=ze[Nt];return delete ze[Nt],ze[qt]=Kt,pe[Kt].geometry[0].pop(),pe[Kt].geometry[0]=pe[Kt].geometry[0].concat(ir[0]),Kt}function bt(Nt,qt,ir){const Kt=de[qt];return delete de[qt],de[Nt]=Kt,pe[Kt].geometry[0].shift(),pe[Kt].geometry[0]=ir[0].concat(pe[Kt].geometry[0]),Kt}function Bt(Nt,qt,ir){const Kt=ir?qt[0][qt[0].length-1]:qt[0][0];return`${Nt}:${Kt.x}:${Kt.y}`}for(let Nt=0;Nt<K.length;Nt++){const qt=K[Nt],ir=qt.geometry,Kt=qt.text?qt.text.toString():null;if(!Kt){je(Nt);continue}const Ft=Bt(Kt,ir),Et=Bt(Kt,ir,!0);if(Ft in ze&&Et in de&&ze[Ft]!==de[Et]){const hr=bt(Ft,Et,ir),or=Ke(Ft,Et,pe[hr].geometry);delete de[Ft],delete ze[Et],ze[Bt(Kt,pe[or].geometry,!0)]=or,pe[hr].geometry=null}else Ft in ze?Ke(Ft,Et,ir):Et in de?bt(Ft,Et,ir):(je(Nt),de[Ft]=xe-1,ze[Et]=xe-1)}return pe.filter((Nt=>Nt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((K,de)=>K.sortKey-de.sortKey))}update(e,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,{imagePositions:a}),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,{imagePositions:a}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(r[e.segment+1]),d=e.dist(r[e.segment]);const f={};for(let y=e.segment+1;y<r.length;y++)f[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:c},y<r.length-1&&(c+=r[y+1].dist(r[y]));for(let y=e.segment||0;y>=0;y--)f[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:d},y>0&&(d+=r[y-1].dist(r[y]));for(let y=0;y<r.length;y++){const S=f[y];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,c,d,f,y,S,I,D,R,U){const q=e.indexArray,H=e.layoutVertexArray,X=e.segments.prepareSegment(4*r.length,H,q,this.canOverlap?f.sortKey:void 0),K=this.glyphOffsetArray.length,de=X.vertexLength,ze=this.allowVerticalPlacement&&y===b.az.vertical?Math.PI/2:0,pe=f.text&&f.text.sections;for(let xe=0;xe<r.length;xe++){const{tl:je,tr:Ke,bl:bt,br:Bt,tex:Nt,pixelOffsetTL:qt,pixelOffsetBR:ir,minFontScaleX:Kt,minFontScaleY:Ft,glyphOffset:Et,isSDF:hr,sectionIndex:or}=r[xe],gr=X.vertexLength,cr=Et[1];ld(H,S.x,S.y,je.x,cr+je.y,Nt.x,Nt.y,a,hr,qt.x,qt.y,Kt,Ft),ld(H,S.x,S.y,Ke.x,cr+Ke.y,Nt.x+Nt.w,Nt.y,a,hr,ir.x,qt.y,Kt,Ft),ld(H,S.x,S.y,bt.x,cr+bt.y,Nt.x,Nt.y+Nt.h,a,hr,qt.x,ir.y,Kt,Ft),ld(H,S.x,S.y,Bt.x,cr+Bt.y,Nt.x+Nt.w,Nt.y+Nt.h,a,hr,ir.x,ir.y,Kt,Ft),xf(e.dynamicLayoutVertexArray,S,ze),q.emplaceBack(gr,gr+2,gr+1),q.emplaceBack(gr+1,gr+2,gr+3),X.vertexLength+=4,X.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Et[0]),xe!==r.length-1&&or===r[xe+1].sectionIndex||e.programConfigurations.populatePaintArrays(H.length,f,f.index,{imagePositions:{},canonical:U,formattedSection:pe&&pe[or]})}e.placedSymbolArray.emplaceBack(S.x,S.y,K,this.glyphOffsetArray.length-K,de,I,D,S.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],y,0,!1,0,R)}_addCollisionDebugVertex(e,r,a,c,d,f){return r.emplaceBack(0,0),e.emplaceBack(a.x,a.y,c,d,Math.round(f.x),Math.round(f.y))}addCollisionDebugVertices(e,r,a,c,d,f,y){const S=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),I=S.vertexLength,D=d.layoutVertexArray,R=d.collisionVertexArray,U=y.anchorX,q=y.anchorY;this._addCollisionDebugVertex(D,R,f,U,q,new E(e,r)),this._addCollisionDebugVertex(D,R,f,U,q,new E(a,r)),this._addCollisionDebugVertex(D,R,f,U,q,new E(a,c)),this._addCollisionDebugVertex(D,R,f,U,q,new E(e,c)),S.vertexLength+=4;const H=d.indexArray;H.emplaceBack(I,I+1),H.emplaceBack(I+1,I+2),H.emplaceBack(I+2,I+3),H.emplaceBack(I+3,I),S.primitiveLength+=4}addDebugCollisionBoxes(e,r,a,c){for(let d=e;d<r;d++){const f=this.collisionBoxArray.get(d);this.addCollisionDebugVertices(f.x1,f.y1,f.x2,f.y2,c?this.textCollisionBox:this.iconCollisionBox,f.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Sf(vt,Nm.members,er),this.iconCollisionBox=new Sf(vt,Nm.members,er);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,a,c,d,f,y,S,I){const D={};for(let R=r;R<a;R++){const U=e.get(R);D.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},D.textFeatureIndex=U.featureIndex;break}for(let R=c;R<d;R++){const U=e.get(R);D.verticalTextBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},D.verticalTextFeatureIndex=U.featureIndex;break}for(let R=f;R<y;R++){const U=e.get(R);D.iconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},D.iconFeatureIndex=U.featureIndex;break}for(let R=S;R<I;R++){const U=e.get(R);D.verticalIconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},D.verticalIconFeatureIndex=U.featureIndex;break}return D}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),c=a.vertexStartIndex+4*a.numGlyphs;for(let d=a.vertexStartIndex;d<c;d+=4)e.indexArray.emplaceBack(d,d+2,d+1),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),c=[],d=[],f=[];for(let y=0;y<this.symbolInstances.length;++y){f.push(y);const S=this.symbolInstances.get(y);c.push(0|Math.round(r*S.anchorX+a*S.anchorY)),d.push(S.featureIndex)}return f.sort(((y,S)=>c[y]-c[S]||d[S]-d[y])),f}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach(((c,d,f)=>{c>=0&&f.indexOf(c)===d&&this.addIndicesForPlacedSymbol(this.text,c)})),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ym,Jm;Ve("SymbolBucket",qu,{omit:["layers","collisionBoxArray","features","compareText"]}),qu.MAX_GLYPHS=65535,qu.addDynamicAttributes=xf;var Tf={get paint(){return Jm=Jm||new Fi({"icon-opacity":new pr(ie.paint_symbol["icon-opacity"]),"icon-color":new pr(ie.paint_symbol["icon-color"]),"icon-halo-color":new pr(ie.paint_symbol["icon-halo-color"]),"icon-halo-width":new pr(ie.paint_symbol["icon-halo-width"]),"icon-halo-blur":new pr(ie.paint_symbol["icon-halo-blur"]),"icon-translate":new mr(ie.paint_symbol["icon-translate"]),"icon-translate-anchor":new mr(ie.paint_symbol["icon-translate-anchor"]),"text-opacity":new pr(ie.paint_symbol["text-opacity"]),"text-color":new pr(ie.paint_symbol["text-color"],{runtimeType:Ni,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new pr(ie.paint_symbol["text-halo-color"]),"text-halo-width":new pr(ie.paint_symbol["text-halo-width"]),"text-halo-blur":new pr(ie.paint_symbol["text-halo-blur"]),"text-translate":new mr(ie.paint_symbol["text-translate"]),"text-translate-anchor":new mr(ie.paint_symbol["text-translate-anchor"])})},get layout(){return Ym=Ym||new Fi({"symbol-placement":new mr(ie.layout_symbol["symbol-placement"]),"symbol-spacing":new mr(ie.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new mr(ie.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new pr(ie.layout_symbol["symbol-sort-key"]),"symbol-z-order":new mr(ie.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new mr(ie.layout_symbol["icon-allow-overlap"]),"icon-overlap":new mr(ie.layout_symbol["icon-overlap"]),"icon-ignore-placement":new mr(ie.layout_symbol["icon-ignore-placement"]),"icon-optional":new mr(ie.layout_symbol["icon-optional"]),"icon-rotation-alignment":new mr(ie.layout_symbol["icon-rotation-alignment"]),"icon-size":new pr(ie.layout_symbol["icon-size"]),"icon-text-fit":new mr(ie.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new mr(ie.layout_symbol["icon-text-fit-padding"]),"icon-image":new pr(ie.layout_symbol["icon-image"]),"icon-rotate":new pr(ie.layout_symbol["icon-rotate"]),"icon-padding":new pr(ie.layout_symbol["icon-padding"]),"icon-keep-upright":new mr(ie.layout_symbol["icon-keep-upright"]),"icon-offset":new pr(ie.layout_symbol["icon-offset"]),"icon-anchor":new pr(ie.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new mr(ie.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new mr(ie.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new mr(ie.layout_symbol["text-rotation-alignment"]),"text-field":new pr(ie.layout_symbol["text-field"]),"text-font":new pr(ie.layout_symbol["text-font"]),"text-size":new pr(ie.layout_symbol["text-size"]),"text-max-width":new pr(ie.layout_symbol["text-max-width"]),"text-line-height":new mr(ie.layout_symbol["text-line-height"]),"text-letter-spacing":new pr(ie.layout_symbol["text-letter-spacing"]),"text-justify":new pr(ie.layout_symbol["text-justify"]),"text-radial-offset":new pr(ie.layout_symbol["text-radial-offset"]),"text-variable-anchor":new mr(ie.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new pr(ie.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new pr(ie.layout_symbol["text-anchor"]),"text-max-angle":new mr(ie.layout_symbol["text-max-angle"]),"text-writing-mode":new mr(ie.layout_symbol["text-writing-mode"]),"text-rotate":new pr(ie.layout_symbol["text-rotate"]),"text-padding":new mr(ie.layout_symbol["text-padding"]),"text-keep-upright":new mr(ie.layout_symbol["text-keep-upright"]),"text-transform":new pr(ie.layout_symbol["text-transform"]),"text-offset":new pr(ie.layout_symbol["text-offset"]),"text-allow-overlap":new mr(ie.layout_symbol["text-allow-overlap"]),"text-overlap":new mr(ie.layout_symbol["text-overlap"]),"text-ignore-placement":new mr(ie.layout_symbol["text-ignore-placement"]),"text-optional":new mr(ie.layout_symbol["text-optional"])})}};class Km{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:mi,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ve("FormatSectionOverride",Km,{omit:["defaultValue"]});class cd extends ji{constructor(e,r){super(e,Tf,r)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const c=[];for(const d of a)c.indexOf(d)<0&&c.push(d);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,a,c){const d=this.layout.get(e).evaluate(r,{},a,c),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||Qa(f.value)||!d?d:(function(y,S){return S.replace(/{([^{}]+)}/g,((I,D)=>y&&D in y?String(y[D]):""))})(r.properties,d)}createBucket(e){return new qu(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Tf.paint.overridableProperties){if(!cd.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new Km(r),c=new rc(a,r.property.specification);let d=null;d=r.value.kind==="constant"||r.value.kind==="source"?new Ic("source",c):new ru("composite",c,r.value.zoomStops),this.paint._values[e]=new ci(r.property,d,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&cd.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),c=Tf.paint.properties[r];let d=!1;const f=y=>{for(const S of y)if(c.overrides&&c.overrides.hasOverride(S))return void(d=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Hn)f(a.value.value.sections);else if(a.value.kind==="source"||a.value.kind==="composite"){const y=I=>{d||(I instanceof Fn&&Mi(I.value)===Sa?f(I.value.sections):I instanceof Cs?f(I.sections):I.eachChild(y))},S=a.value;S._styleExpression&&y(S._styleExpression.expression)}return d}}let Qm;var kv={get paint(){return Qm=Qm||new Fi({"background-color":new mr(ie.paint_background["background-color"]),"background-pattern":new Ai(ie.paint_background["background-pattern"]),"background-opacity":new mr(ie.paint_background["background-opacity"])})}};class Dv extends ji{constructor(e,r){super(e,kv,r)}}class Fv extends ji{constructor(e,r){super(e,{},r),this.onAdd=a=>{this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)},this.onRemove=a=>{this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class zv{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Nv={once:!0},Pf=63710088e-1;class Oc{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Oc(ut(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,c=e.lat*r,d=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((e.lng-this.lng)*r);return Pf*Math.acos(Math.min(d,1))}static convert(e){if(e instanceof Oc)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Oc(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Oc(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const eg=2*Math.PI*Pf;function tg(i){return eg*Math.cos(i*Math.PI/180)}function rg(i){return(180+i)/360}function ig(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function ng(i,e){return i/tg(e)}function sg(i){return 360*i-180}function ud(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function ag(i,e){return i*tg(ud(e))}class Ch{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=Oc.convert(e);return new Ch(rg(a.lng),ig(a.lat),ng(r,a.lat))}toLngLat(){return new Oc(sg(this.x),ud(this.y))}toAltitude(){return ag(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/eg*(e=ud(this.y),1/Math.cos(e*Math.PI/180));var e}}function og(i,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[i*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class Af{constructor(e,r,a){if(!(function(c,d,f){return!(c<0||c>25||f<0||f>=Math.pow(2,c)||d<0||d>=Math.pow(2,c))})(e,r,a))throw new Error(`x=${r}, y=${a}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=a,this.key=Gu(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,a){const c=(f=this.y,y=this.z,S=og(256*(d=this.x),256*(f=Math.pow(2,y)-f-1),y),I=og(256*(d+1),256*(f+1),y),S[0]+","+S[1]+","+I[0]+","+I[1]);var d,f,y,S,I;const D=(function(R,U,q){let H,X="";for(let K=R;K>0;K--)H=1<<K-1,X+=(U&H?1:0)+(q&H?2:0);return X})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,D).replace(/{bbox-epsg-3857}/g,c)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new E((e.x*r-this.x)*gt,(e.y*r-this.y)*gt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class lg{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Gu(e,r.z,r.z,r.x,r.y)}}class so{constructor(e,r,a,c,d){if(this.terrainRttPosMatrix32f=null,e<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${a}`);this.overscaledZ=e,this.wrap=r,this.canonical=new Af(a,+c,+d),this.key=Gu(r,e,a,c,d)}clone(){return new so(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new so(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new so(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-e;return e>this.canonical.z?Gu(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Gu(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const r=this.canonical.z-e.canonical.z;return!(r<0)&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new so(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new so(r,this.wrap,r,a,c),new so(r,this.wrap,r,a+1,c),new so(r,this.wrap,r,a,c+1),new so(r,this.wrap,r,a+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new so(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new so(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new lg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Ch(e.x-this.wrap,e.y))}}function Gu(i,e,r,a,c){(i*=2)<0&&(i=-1*i-1);const d=1<<r;return(d*d*i+d*c+a).toString(36)+r.toString(36)+e.toString(36)}function If(i,e){return e?i.properties[e]:i.id}function Rv(i,e){const r={id:i.id};if(e.removeAllProperties&&(delete i.removeProperties,delete i.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const a of e.removeProperties){const c=i.addOrUpdateProperties.findIndex((d=>d.key===a));c>-1&&i.addOrUpdateProperties.splice(c,1)}return(i.removeAllProperties||e.removeAllProperties)&&(r.removeAllProperties=!0),(i.removeProperties||e.removeProperties)&&(r.removeProperties=[...i.removeProperties||[],...e.removeProperties||[]]),(i.addOrUpdateProperties||e.addOrUpdateProperties)&&(r.addOrUpdateProperties=[...i.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(i.newGeometry||e.newGeometry)&&(r.newGeometry=e.newGeometry||i.newGeometry),r}function cg(i){var e,r;if(!i)return{};const a={};return a.removeAll=i.removeAll,a.remove=new Set(i.remove||[]),a.add=new Map((e=i.add)===null||e===void 0?void 0:e.map((c=>[c.id,c]))),a.update=new Map((r=i.update)===null||r===void 0?void 0:r.map((c=>[c.id,c]))),a}Ve("CanonicalTileID",Af),Ve("OverscaledTileID",so,{omit:["terrainRttPosMatrix32f"]});class pu{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const r=new pu;return r.extend(e(new E(this.minX,this.minY))),r.extend(e(new E(this.maxX,this.minY))),r.extend(e(new E(this.minX,this.maxY))),r.extend(e(new E(this.maxX,this.maxY))),r}static fromPoints(e){const r=new pu;for(const a of e)r.extend(a);return r}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class ug{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class hg{constructor(e,r,a,c,d){this.type="Feature",this._vectorTileFeature=e,this._x=a,this._y=c,this._z=r,this.properties=e.properties,this.id=d}projectPoint(e,r,a,c){return[360*(e.x+r)/c-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+a)/c)*Math.PI))-90]}projectLine(e,r,a,c){return e.map((d=>this.projectPoint(d,r,a,c)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,r=e.extent*Math.pow(2,this._z),a=e.extent*this._x,c=e.extent*this._y,d=e.loadGeometry();switch(e.type){case 1:{const f=[];for(const S of d)f.push(S[0]);const y=this.projectLine(f,a,c,r);this._geometry=f.length===1?{type:"Point",coordinates:y[0]}:{type:"MultiPoint",coordinates:y};break}case 2:{const f=d.map((y=>this.projectLine(y,a,c,r)));this._geometry=f.length===1?{type:"LineString",coordinates:f[0]}:{type:"MultiLineString",coordinates:f};break}case 3:{const f=Am(d),y=[];for(const S of f)y.push(S.map((I=>this.projectLine(I,a,c,r))));this._geometry=y.length===1?{type:"Polygon",coordinates:y[0]}:{type:"MultiPolygon",coordinates:y};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&r!=="_x"&&r!=="_y"&&r!=="_z"&&(e[r]=this[r]);return e}}class $u{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,r,a){this._name=e,this.dataBuffer=r,typeof a=="number"?this._size=a:(this.nullabilityBuffer=a,this._size=a.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class hd extends $u{}class Lf extends hd{getValueFromBuffer(e){return this.dataBuffer[e]}}class Cf extends hd{getValueFromBuffer(e){return this.dataBuffer[e]}}class dg extends $u{delta;constructor(e,r,a,c){super(e,r,c),this.delta=a}}class Mf extends dg{constructor(e,r,a,c){super(e,Int32Array.of(r),a,c)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class Ef extends $u{constructor(e,r,a){super(e,Int32Array.of(r),a)}getValueFromBuffer(e){return this.dataBuffer[0]}}class Bv{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,r,a,c,d=4096){this._name=e,this._geometryVector=r,this._idVector=a,this._propertyVectors=c,this._extent=d}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((r=>[r.name,r])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let r=0;for(;r<this.numFeatures;){let a;this.idVector&&(a=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(r)):this.idVector.getValue(r));const c=e?.next().value,d={};for(const f of this.propertyVectors){if(!f)continue;const y=f.name,S=f.getValue(r);S!==null&&(d[y]=S)}r++,yield{id:a,geometry:c,properties:d}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],r=this.geometryVector.getGeometries();for(let a=0;a<this.numFeatures;a++){let c;this.idVector&&(c=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(a)):this.idVector.getValue(a));const d={coordinates:r[a],type:this.geometryVector.geometryType(a)},f={};for(const y of this.propertyVectors){if(!y)continue;const S=y.name,I=y.getValue(a);I!==null&&(f[S]=I)}e.push({id:c,geometry:d,properties:f})}return e}containsMaxSaveIntegerValues(e){return e instanceof Lf||e instanceof Ef&&e instanceof Mf||e instanceof Cf}}class Ov{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var di,mc,bs,rl,mu,Oa,Qn,es,fg,ao;function hs(i,e,r){const a=new Int32Array(r);let c=0,d=e.get();for(let f=0;f<a.length;f++){let y=i[d++],S=127&y;y<128||(y=i[d++],S|=(127&y)<<7,y<128||(y=i[d++],S|=(127&y)<<14,y<128||(y=i[d++],S|=(127&y)<<21,y<128||(y=i[d++],S|=(15&y)<<28)))),a[c++]=S}return e.set(d),a}function dd(i,e,r){const a=new BigInt64Array(r);for(let c=0;c<a.length;c++)a[c]=Vv(i,e);return a}function jv(i,e){let r,a;return a=i[e.get()],e.increment(),r=127&a,a<128?r:(a=i[e.get()],e.increment(),r|=(127&a)<<7,a<128?r:(a=i[e.get()],e.increment(),r|=(127&a)<<14,a<128?r:(a=i[e.get()],e.increment(),r|=(127&a)<<21,a<128?r:(a=i[e.get()],r|=(15&a)<<28,(function(c,d,f){let y,S;if(S=d[f.get()],f.increment(),y=(112&S)>>4,S<128||(S=d[f.get()],f.increment(),y|=(127&S)<<3,S<128)||(S=d[f.get()],f.increment(),y|=(127&S)<<10,S<128)||(S=d[f.get()],f.increment(),y|=(127&S)<<17,S<128)||(S=d[f.get()],f.increment(),y|=(127&S)<<24,S<128)||(S=d[f.get()],f.increment(),y|=(1&S)<<31,S<128))return 4294967296*y+(c>>>0);throw new Error("Expected varint not more than 10 bytes")})(r,i,e)))))}function pg(i,e,r,a){throw new Error("FastPFor is not implemented yet.")}function gu(i){return i>>>1^-(1&i)}function Zu(i){return i>>1n^-(1n&i)}function Vv(i,e){let r=0n,a=0,c=e.get();for(;c<i.length;){const d=i[c++];if(r|=BigInt(127&d)<<BigInt(a),!(128&d))break;if(a+=7,a>=64)throw new Error("Varint too long")}return e.set(c),r}function mg(i,e,r){const a=new Int32Array(r);let c=0;for(let d=0;d<e;d++){const f=i[d];a.fill(i[d+e],c,c+f),c+=f}return a}function gg(i,e,r){const a=new BigInt64Array(r);let c=0;for(let d=0;d<e;d++){const f=Number(i[d]);a.fill(i[d+e],c,c+f),c+=f}return a}function _g(i,e,r){const a=new Float64Array(r);let c=0;for(let d=0;d<e;d++){const f=i[d];a.fill(i[d+e],c,c+f),c+=f}return a}function kf(i){const e=i.length/4*4;let r=1;if(e>=4)for(let a=i[0];r<e-4;r+=4)a=i[r]+=a,a=i[r+1]+=a,a=i[r+2]+=a,a=i[r+3]+=a;for(;r!=i.length;)i[r]+=i[r-1],++r}function yg(i){i[0]=i[0]>>>1^-(1&i[0]),i[1]=i[1]>>>1^-(1&i[1]);const e=i.length/4*4;let r=2;if(e>=4)for(;r<e-4;r+=4){const a=i[r],c=i[r+1],d=i[r+2],f=i[r+3];i[r]=(a>>>1^-(1&a))+i[r-2],i[r+1]=(c>>>1^-(1&c))+i[r-1],i[r+2]=(d>>>1^-(1&d))+i[r],i[r+3]=(f>>>1^-(1&f))+i[r+1]}for(;r!=i.length;r+=2)i[r]=(i[r]>>>1^-(1&i[r]))+i[r-2],i[r+1]=(i[r+1]>>>1^-(1&i[r+1]))+i[r-1]}(function(i){i.NONE="NONE",i.DELTA="DELTA",i.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",i.RLE="RLE",i.MORTON="MORTON",i.PDE="PDE"})(di||(di={})),(function(i){i.NONE="NONE",i.FAST_PFOR="FAST_PFOR",i.VARINT="VARINT",i.ALP="ALP"})(mc||(mc={})),(function(i){i.PRESENT="PRESENT",i.DATA="DATA",i.OFFSET="OFFSET",i.LENGTH="LENGTH"})(bs||(bs={}));class Df{_dictionaryType;_offsetType;_lengthType;constructor(e,r,a){this._dictionaryType=e,this._offsetType=r,this._lengthType=a}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function ta(i,e){const r=(function(a,c){const d=a[c.get()],f=Object.values(bs)[d>>4];let y=null;switch(f){case bs.DATA:y=new Df(Object.values(rl)[15&d]);break;case bs.OFFSET:y=new Df(null,Object.values(mu)[15&d]);break;case bs.LENGTH:y=new Df(null,null,Object.values(Oa)[15&d])}c.increment();const S=a[c.get()],I=Object.values(di)[S>>5],D=Object.values(di)[S>>2&7],R=Object.values(mc)[3&S];c.increment();const U=hs(a,c,2),q=U[0];return{physicalStreamType:f,logicalStreamType:y,logicalLevelTechnique1:I,logicalLevelTechnique2:D,physicalLevelTechnique:R,numValues:q,byteLength:U[1],decompressedCount:q}})(i,e);return r.logicalLevelTechnique1===di.MORTON?(function(a,c,d){const f=hs(c,d,2);return{physicalStreamType:a.physicalStreamType,logicalStreamType:a.logicalStreamType,logicalLevelTechnique1:a.logicalLevelTechnique1,logicalLevelTechnique2:a.logicalLevelTechnique2,physicalLevelTechnique:a.physicalLevelTechnique,numValues:a.numValues,byteLength:a.byteLength,decompressedCount:a.decompressedCount,numBits:f[0],coordinateShift:f[1]}})(r,i,e):di.RLE!==r.logicalLevelTechnique1&&di.RLE!==r.logicalLevelTechnique2||mc.NONE===r.physicalLevelTechnique?r:(function(a,c,d){const f=hs(c,d,2);return{physicalStreamType:a.physicalStreamType,logicalStreamType:a.logicalStreamType,logicalLevelTechnique1:a.logicalLevelTechnique1,logicalLevelTechnique2:a.logicalLevelTechnique2,physicalLevelTechnique:a.physicalLevelTechnique,numValues:a.numValues,byteLength:a.byteLength,decompressedCount:f[1],runs:f[0],numRleValues:f[1]}})(r,i,e)}(function(i){i.NONE="NONE",i.SINGLE="SINGLE",i.SHARED="SHARED",i.VERTEX="VERTEX",i.MORTON="MORTON",i.FSST="FSST"})(rl||(rl={})),(function(i){i.VERTEX="VERTEX",i.INDEX="INDEX",i.STRING="STRING",i.KEY="KEY"})(mu||(mu={})),(function(i){i.VAR_BINARY="VAR_BINARY",i.GEOMETRIES="GEOMETRIES",i.PARTS="PARTS",i.RINGS="RINGS",i.TRIANGLES="TRIANGLES",i.SYMBOL="SYMBOL",i.DICTIONARY="DICTIONARY"})(Oa||(Oa={})),(function(i){i[i.FLAT=0]="FLAT",i[i.CONST=1]="CONST",i[i.SEQUENCE=2]="SEQUENCE",i[i.DICTIONARY=3]="DICTIONARY",i[i.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Qn||(Qn={}));class il{values;_size;constructor(e,r){this.values=e,this._size=r}get(e){const r=Math.floor(e/8);return(this.values[r]>>e%8&1)==1}set(e,r){const a=Math.floor(e/8);this.values[a]=this.values[a]|(r?1:0)<<e%8}getInt(e){const r=Math.floor(e/8);return this.values[r]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function ra(i,e,r,a,c){return(function(d,f,y){switch(f.logicalLevelTechnique1){case di.DELTA:return f.logicalLevelTechnique2===di.RLE?(function(S,I,D){const R=new Int32Array(D);let U=0,q=0;for(let H=0;H<I;H++){const X=S[H],K=gu(S[H+I]);for(let de=0;de<X;de++)q+=K,R[U++]=q}return R})(d,f.runs,f.numRleValues):((function(S){S[0]=S[0]>>>1^-(1&S[0]);const I=S.length/4*4;let D=1;if(I>=4)for(;D<I-4;D+=4){const R=S[D],U=S[D+1],q=S[D+2],H=S[D+3];S[D]=(R>>>1^-(1&R))+S[D-1],S[D+1]=(U>>>1^-(1&U))+S[D],S[D+2]=(q>>>1^-(1&q))+S[D+1],S[D+3]=(H>>>1^-(1&H))+S[D+2]}for(;D!=S.length;++D)S[D]=(S[D]>>>1^-(1&S[D]))+S[D-1]})(d),d);case di.RLE:return(function(S,I,D){return D?(function(R,U,q){const H=new Int32Array(q);let X=0;for(let K=0;K<U;K++){const de=R[K];let ze=R[K+U];ze=ze>>>1^-(1&ze),H.fill(ze,X,X+de),X+=de}return H})(S,I.runs,I.numRleValues):mg(S,I.runs,I.numRleValues)})(d,f,y);case di.MORTON:return kf(d),d;case di.COMPONENTWISE_DELTA:return yg(d),d;case di.NONE:return y&&(function(S){for(let I=0;I<S.length;I++){const D=S[I];S[I]=D>>>1^-(1&D)}})(d),d;default:throw new Error(`The specified Logical level technique is not supported: ${f.logicalLevelTechnique1}`)}})(fd(i,e,r),r,a)}function jc(i,e,r){return(function(a,c){if(c.logicalLevelTechnique1===di.DELTA&&c.logicalLevelTechnique2===di.NONE)return(function(f){const y=new Int32Array(f.length+1);y[0]=0,y[1]=gu(f[0]);let S=y[1],I=2;for(;I!=y.length;++I){const D=f[I-1];S+=D>>>1^-(1&D),y[I]=y[I-1]+S}return y})(a);if(c.logicalLevelTechnique1===di.RLE&&c.logicalLevelTechnique2===di.NONE)return(function(f,y,S){const I=new Int32Array(S+1);I[0]=0;let D=1,R=I[0];for(let U=0;U<y;U++){const q=f[U],H=f[U+y];for(let X=D;X<D+q;X++)I[X]=H+R,R=I[X];D+=q}return I})(a,c.runs,c.numRleValues);if(c.logicalLevelTechnique1===di.NONE&&c.logicalLevelTechnique2===di.NONE){(function(f){let y=0;for(let S=0;S<f.length;S++)f[S]+=y,y=f[S]})(a);const d=new Int32Array(c.numValues+1);return d[0]=0,d.set(a,1),d}if(c.logicalLevelTechnique1===di.DELTA&&c.logicalLevelTechnique2===di.RLE){const d=(function(f,y,S){const I=new Int32Array(S+1);I[0]=0;let D=1,R=I[0];for(let U=0;U<y;U++){const q=f[U];let H=f[U+y];H=H>>>1^-(1&H);for(let X=D;X<D+q;X++)I[X]=H+R,R=I[X];D+=q}return I})(a,c.runs,c.numRleValues);return kf(d),d}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(fd(i,e,r),r)}function fd(i,e,r){const a=r.physicalLevelTechnique;if(a===mc.FAST_PFOR)return pg();if(a===mc.VARINT)return hs(i,e,r.numValues);if(a===mc.NONE){const c=e.get();e.add(r.byteLength);const d=i.subarray(c,e.get());return new Int32Array(d)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function Ff(i,e,r,a){const c=fd(i,e,r);if(c.length===1){const d=c[0];return a?gu(d):d}return a?(function(d){return gu(d[1])})(c):(function(d){return d[1]})(c)}function vg(i,e,r){return(function(a){if(a.length==2){const c=gu(a[1]);return[c,c]}return[gu(a[2]),gu(a[3])]})(fd(i,e,r))}function bg(i,e,r){return(function(a){if(a.length==2){const c=Zu(a[1]);return[c,c]}return[Zu(a[2]),Zu(a[3])]})(dd(i,e,r.numValues))}function xg(i,e,r,a){return(function(c,d,f){switch(d.logicalLevelTechnique1){case di.DELTA:return d.logicalLevelTechnique2===di.RLE?(function(y,S,I){const D=new BigInt64Array(I);let R=0,U=0n;for(let q=0;q<S;q++){const H=Number(y[q]),X=Zu(y[q+S]);for(let K=0;K<H;K++)U+=X,D[R++]=U}return D})(c,d.runs,d.numRleValues):((function(y){y[0]=y[0]>>1n^-(1n&y[0]);const S=y.length/4*4;let I=1;if(S>=4)for(;I<S-4;I+=4){const D=y[I],R=y[I+1],U=y[I+2],q=y[I+3];y[I]=(D>>1n^-(1n&D))+y[I-1],y[I+1]=(R>>1n^-(1n&R))+y[I],y[I+2]=(U>>1n^-(1n&U))+y[I+1],y[I+3]=(q>>1n^-(1n&q))+y[I+2]}for(;I!=y.length;++I)y[I]=(y[I]>>1n^-(1n&y[I]))+y[I-1]})(c),c);case di.RLE:return(function(y,S,I){return I?(function(D,R,U){const q=new BigInt64Array(U);let H=0;for(let X=0;X<R;X++){const K=Number(D[X]);let de=D[X+R];de=de>>1n^-(1n&de),q.fill(de,H,H+K),H+=K}return q})(y,S.runs,S.numRleValues):gg(y,S.runs,S.numRleValues)})(c,d,f);case di.NONE:return f&&(function(y){for(let S=0;S<y.length;S++){const I=y[S];y[S]=I>>1n^-(1n&I)}})(c),c;default:throw new Error(`The specified Logical level technique is not supported: ${d.logicalLevelTechnique1}`)}})(dd(i,e,r.numValues),r,a)}function wg(i,e,r,a){const c=dd(i,e,r.numValues);if(c.length===1){const d=c[0];return a?Zu(d):d}return a?(function(d){return Zu(d[1])})(c):(function(d){return d[1]})(c)}function zf(i,e,r,a,c){return(function(d,f,y,S){switch(f.logicalLevelTechnique1){case di.DELTA:return f.logicalLevelTechnique2===di.RLE&&(d=mg(d,f.runs,f.numRleValues)),(function(I,D){const R=new Int32Array(I.size());let U=0;I.get(0)?(R[0]=I.get(0)?D[0]>>>1^-(1&D[0]):0,U=1):R[0]=0;let q=1;for(;q!=R.length;++q)R[q]=I.get(q)?R[q-1]+(D[U]>>>1^-(1&D[U++])):R[q-1];return R})(S,d);case di.RLE:return(function(I,D,R,U){const q=D;return R?(function(H,X,K){const de=new Int32Array(H.size());let ze=0;for(let pe=0;pe<K;pe++){const xe=X[pe];let je=X[pe+K];je=je>>>1^-(1&je);for(let Ke=ze;Ke<ze+xe;Ke++)H.get(Ke)?de[Ke]=je:(de[Ke]=0,ze++);ze+=xe}return de})(U,I,q.runs):(function(H,X,K){const de=new Int32Array(H.size());let ze=0;for(let pe=0;pe<K;pe++){const xe=X[pe],je=X[pe+K];for(let Ke=ze;Ke<ze+xe;Ke++)H.get(Ke)?de[Ke]=je:(de[Ke]=0,ze++);ze+=xe}return de})(U,I,q.runs)})(d,f,y,S);case di.MORTON:return kf(d),d;case di.COMPONENTWISE_DELTA:return yg(d),d;case di.NONE:return d=y?(function(I,D){const R=new Int32Array(I.size());let U=0,q=0;for(;q!=R.length;++q)if(I.get(q)){const H=D[U++];R[q]=H>>>1^-(1&H)}else R[q]=0;return R})(S,d):(function(I,D){const R=new Int32Array(I.size());let U=0,q=0;for(;q!=R.length;++q)R[q]=I.get(q)?D[U++]:0;return R})(S,d),d;default:throw new Error("The specified Logical level technique is not supported")}})(r.physicalLevelTechnique===mc.FAST_PFOR?pg():hs(i,e,r.numValues),r,a,c)}function pd(i,e,r,a){const c=i.logicalLevelTechnique1;if(c===di.RLE)return i.runs===1?Qn.CONST:Qn.FLAT;const d=e instanceof il?e.size():e;if(c===di.DELTA&&i.logicalLevelTechnique2===di.RLE){const f=i.runs,y=2;if(i.numRleValues!==d)return Qn.FLAT;if(f===1)return Qn.SEQUENCE;if(f===2){const S=a.get();let I;if(i.physicalLevelTechnique===mc.VARINT)I=hs(r,a,4);else{const D=a.get();I=new Int32Array(r.buffer,r.byteOffset+D,4)}if(a.set(S),I[2]===y&&I[3]===y)return Qn.SEQUENCE}}return i.numValues===1?Qn.CONST:Qn.FLAT}class Sg extends hd{getValueFromBuffer(e){return this.dataBuffer[e]}}class Tg extends dg{constructor(e,r,a,c){super(e,BigInt64Array.of(r),a,c)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class Wu{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,r,a){this._geometryOffsets=e,this._partOffsets=r,this._ringOffsets=a}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function Nf(i,e,r){return{x:Pg(i,e)-r,y:Pg(i>>1,e)-r}}function Pg(i,e){let r=0;for(let a=0;a<e;a++)r|=(i&1<<2*a)>>a;return r}(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON",i[i.MULTIPOINT=3]="MULTIPOINT",i[i.MULTILINESTRING=4]="MULTILINESTRING",i[i.MULTIPOLYGON=5]="MULTIPOLYGON"})(es||(es={})),(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON"})(fg||(fg={})),(function(i){i[i.MORTON=0]="MORTON",i[i.VEC_2=1]="VEC_2",i[i.VEC_3=2]="VEC_3"})(ao||(ao={}));class Uv{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((r=>[r]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,r){return[e].concat(r)}createMultiPolygon(e){return e.flat()}}function Ag(i){const e=new Array(i.numGeometries);let r=1,a=1,c=1,d=0;const f=new Uv;let y=0,S=0;const I=i.mortonSettings,D=i.topologyVector,R=D.geometryOffsets,U=D.partOffsets,q=D.ringOffsets,H=i.vertexOffsets,X=i.containsPolygonGeometry(),K=i.vertexBuffer;for(let de=0;de<i.numGeometries;de++){const ze=i.geometryType(de);if(ze===es.POINT){if(H&&H.length!==0)if(i.vertexBufferType===ao.VEC_2){const pe=2*H[S++],xe=new E(K[pe],K[pe+1]);e[d++]=f.createPoint(xe)}else{const pe=Nf(K[H[S++]],I.numBits,I.coordinateShift),xe=new E(pe.x,pe.y);e[d++]=f.createPoint(xe)}else{const pe=new E(K[y++],K[y++]);e[d++]=f.createPoint(pe)}R&&c++,U&&r++,q&&a++}else if(ze===es.MULTIPOINT){const pe=R[c]-R[c-1];c++;const xe=new Array(pe);if(H&&H.length!==0){for(let je=0;je<pe;je++){const Ke=2*H[S++];xe[je]=new E(K[Ke],K[Ke+1])}e[d++]=f.createMultiPoint(xe)}else{for(let je=0;je<pe;je++){const Ke=K[y++],bt=K[y++];xe[je]=new E(Ke,bt)}e[d++]=f.createMultiPoint(xe)}}else if(ze===es.LINESTRING){let pe,xe=0;X?(xe=q[a]-q[a-1],a++):xe=U[r]-U[r-1],r++,H&&H.length!==0?(pe=i.vertexBufferType===ao.VEC_2?Bf(K,H,S,xe,!1):Of(K,H,S,xe,!1,I),S+=xe):(pe=Rf(K,y,xe,!1),y+=2*xe),e[d++]=f.createLineString(pe),R&&c++}else if(ze===es.POLYGON){const pe=U[r]-U[r-1];r++;const xe=new Array(pe-1);let je=q[a]-q[a-1];if(a++,H&&H.length!==0){const Ke=i.vertexBufferType===ao.VEC_2?gd(K,H,S,je):_d(K,H,S,je,0,I);S+=je;for(let bt=0;bt<xe.length;bt++)je=q[a]-q[a-1],a++,xe[bt]=i.vertexBufferType===ao.VEC_2?gd(K,H,S,je):_d(K,H,S,je,0,I),S+=je;e[d++]=f.createPolygon(Ke,xe)}else{const Ke=md(K,y,je);y+=2*je;for(let bt=0;bt<xe.length;bt++)je=q[a]-q[a-1],a++,xe[bt]=md(K,y,je),y+=2*je;e[d++]=f.createPolygon(Ke,xe)}R&&c++}else if(ze===es.MULTILINESTRING){const pe=R[c]-R[c-1];c++;const xe=new Array(pe);if(H&&H.length!==0){for(let je=0;je<pe;je++){let Ke=0;X?(Ke=q[a]-q[a-1],a++):Ke=U[r]-U[r-1],r++;const bt=i.vertexBufferType===ao.VEC_2?Bf(K,H,S,Ke,!1):Of(K,H,S,Ke,!1,I);xe[je]=bt,S+=Ke}e[d++]=f.createMultiLineString(xe)}else{for(let je=0;je<pe;je++){let Ke=0;X?(Ke=q[a]-q[a-1],a++):Ke=U[r]-U[r-1],r++,xe[je]=Rf(K,y,Ke,!1),y+=2*Ke}e[d++]=f.createMultiLineString(xe)}}else{if(ze!==es.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const pe=R[c]-R[c-1];c++;const xe=new Array(pe);let je=0;if(H&&H.length!==0){for(let Ke=0;Ke<pe;Ke++){const bt=U[r]-U[r-1];r++;const Bt=new Array(bt-1);je=q[a]-q[a-1],a++;const Nt=i.vertexBufferType===ao.VEC_2?gd(K,H,S,je):_d(K,H,S,je,0,I);S+=je;for(let qt=0;qt<Bt.length;qt++)je=q[a]-q[a-1],a++,Bt[qt]=i.vertexBufferType===ao.VEC_2?gd(K,H,S,je):_d(K,H,S,je,0,I),S+=je;xe[Ke]=f.createPolygon(Nt,Bt)}e[d++]=f.createMultiPolygon(xe)}else{for(let Ke=0;Ke<pe;Ke++){const bt=U[r]-U[r-1];r++;const Bt=new Array(bt-1);je=q[a]-q[a-1],a++;const Nt=md(K,y,je);y+=2*je;for(let qt=0;qt<Bt.length;qt++){const ir=q[a]-q[a-1];a++,Bt[qt]=md(K,y,ir),y+=2*ir}xe[Ke]=f.createPolygon(Nt,Bt)}e[d++]=f.createMultiPolygon(xe)}}}}return e}function md(i,e,r){return Rf(i,e,r,!0)}function gd(i,e,r,a){return Bf(i,e,r,a,!0)}function _d(i,e,r,a,c,d){return Of(i,e,r,a,!0,d)}function Rf(i,e,r,a){const c=new Array(a?r+1:r);for(let d=0;d<2*r;d+=2)c[d/2]=new E(i[e+d],i[e+d+1]);return a&&(c[c.length-1]=c[0]),c}function Bf(i,e,r,a,c){const d=new Array(c?a+1:a);for(let f=0;f<2*a;f+=2){const y=2*e[r+f/2];d[f/2]=new E(i[y],i[y+1])}return c&&(d[d.length-1]=d[0]),d}function Of(i,e,r,a,c,d){const f=new Array(c?a+1:a);for(let y=0;y<a;y++){const S=Nf(i[e[r+y]],d.numBits,d.coordinateShift);f[y]=new E(S.x,S.y)}return c&&(f[f.length-1]=f[0]),f}class Ig{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,r,a,c,d){this._vertexBufferType=e,this._topologyVector=r,this._vertexOffsets=a,this._vertexBuffer=c,this._mortonSettings=d}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=Ag(this);let r=0;for(;r<this.numGeometries;)yield{coordinates:e[r],type:this.geometryType(r)},r++}getSimpleEncodedVertex(e){const r=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[r],this.vertexBuffer[r+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const a=Nf(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[a.x,a.y]}const r=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[r],this.vertexBuffer[r+1]]}getGeometries(){return Ag(this)}get mortonSettings(){return this._mortonSettings}}class Lg extends Ig{_numGeometries;_geometryType;constructor(e,r,a,c,d,f,y){super(a,c,d,f,y),this._numGeometries=e,this._geometryType=r}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===es.POLYGON||this._geometryType===es.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Cg extends Ig{_geometryTypes;constructor(e,r,a,c,d,f){super(e,a,c,d,f),this._geometryTypes=r}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===es.POLYGON||this.geometryType(e)===es.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Mg{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,r,a,c){this._triangleOffsets=e,this._indexBuffer=r,this._vertexBuffer=a,this._topologyVector=c}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),r=this._topologyVector,a=r.partOffsets,c=r.ringOffsets,d=r.geometryOffsets;let f=0,y=1,S=1,I=1;for(let D=0;D<this.numGeometries;D++)switch(this.geometryType(D)){case es.POLYGON:{const R=a[y]-a[y-1];y++;const U=[];for(let q=0;q<R;q++){const H=c[S]-c[S-1];S++;const X=[];for(let K=0;K<H;K++){const de=this._vertexBuffer[f++],ze=this._vertexBuffer[f++];X.push(new E(de,ze))}X.length>0&&X.push(X[0]),U.push(X)}e[D]=U,d&&I++}break;case es.MULTIPOLYGON:{const R=d[I]-d[I-1];I++;const U=[];for(let q=0;q<R;q++){const H=a[y]-a[y-1];y++;for(let X=0;X<H;X++){const K=c[S]-c[S-1];S++;const de=[];for(let ze=0;ze<K;ze++){const pe=this._vertexBuffer[f++],xe=this._vertexBuffer[f++];de.push(new E(pe,xe))}de.length>0&&de.push(de[0]),U.push(de)}}e[D]=U}}return e}[Symbol.iterator](){return null}}function Eg(i,e,r,a,c,d){return new qv(i,e,r,a,c,d)}class qv extends Mg{_numGeometries;_geometryType;constructor(e,r,a,c,d,f){super(a,c,d,f),this._numGeometries=e,this._geometryType=r}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function kg(i,e,r,a,c){return new Gv(i,e,r,a,c)}class Gv extends Mg{_geometryTypes;constructor(e,r,a,c,d){super(r,a,c,d),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function $v(i,e,r,a,c){const d=ta(i,r);let f=null,y=null,S=null,I=null,D=null,R=null,U=null,q=null;if(pd(d,a,i,r)===Qn.CONST){const X=Ff(i,r,d,!1);for(let K=0;K<e-1;K++){const de=ta(i,r);switch(de.physicalStreamType){case bs.LENGTH:switch(de.logicalStreamType.lengthType){case Oa.GEOMETRIES:f=jc(i,r,de);break;case Oa.PARTS:y=jc(i,r,de);break;case Oa.RINGS:S=jc(i,r,de);break;case Oa.TRIANGLES:U=jc(i,r,de)}break;case bs.OFFSET:switch(de.logicalStreamType.offsetType){case mu.VERTEX:I=ra(i,r,de,!1);break;case mu.INDEX:q=ra(i,r,de,!1)}break;case bs.DATA:rl.VERTEX===de.logicalStreamType.dictionaryType?D=ra(i,r,de,!0):(R={numBits:de.numBits,coordinateShift:de.coordinateShift},D=ra(i,r,de,!1))}}return q!==null?f!=null||y!=null?Eg(a,X,U,q,D,new Wu(f,y,S)):Eg(a,X,U,q,D):R===null?(function(K,de,ze,pe,xe){return new Lg(K,de,ao.VEC_2,ze,pe,xe)})(a,X,new Wu(f,y,S),I,D):(function(K,de,ze,pe,xe,je){return new Lg(K,de,ao.MORTON,ze,pe,xe,je)})(a,X,new Wu(f,y,S),I,D,R)}const H=ra(i,r,d,!1);for(let X=0;X<e-1;X++){const K=ta(i,r);switch(K.physicalStreamType){case bs.LENGTH:switch(K.logicalStreamType.lengthType){case Oa.GEOMETRIES:f=ra(i,r,K,!1);break;case Oa.PARTS:y=ra(i,r,K,!1);break;case Oa.RINGS:S=ra(i,r,K,!1);break;case Oa.TRIANGLES:U=jc(i,r,K)}break;case bs.OFFSET:switch(K.logicalStreamType.offsetType){case mu.VERTEX:I=ra(i,r,K,!1);break;case mu.INDEX:q=ra(i,r,K,!1)}break;case bs.DATA:rl.VERTEX===K.logicalStreamType.dictionaryType?D=ra(i,r,K,!0):(R={numBits:K.numBits,coordinateShift:K.coordinateShift},D=ra(i,r,K,!1))}}return q!==null&&y===null?kg(H,U,q,D):(f!==null?(f=jf(H,f,2),y!==null&&S!==null?(y=Dg(H,f,y,!1),S=(function(X,K,de,ze){const pe=new Int32Array(de[de.length-1]+1);let xe=0;pe[0]=xe;let je=1,Ke=1,bt=0;for(let Bt=0;Bt<X.length;Bt++){const Nt=X[Bt],qt=K[Bt+1]-K[Bt];if(Nt!==0&&Nt!==3)for(let ir=0;ir<qt;ir++){const Kt=de[je]-de[je-1];je++;for(let Ft=0;Ft<Kt;Ft++)xe=pe[Ke++]=xe+ze[bt++]}else for(let ir=0;ir<qt;ir++)pe[Ke++]=++xe,je++}return pe})(H,f,y,S)):y!==null&&(y=(function(X,K,de){const ze=new Int32Array(K[K.length-1]+1);let pe=0;ze[0]=pe;let xe=1,je=0;for(let Ke=0;Ke<X.length;Ke++){const bt=X[Ke],Bt=K[Ke+1]-K[Ke];if(bt===4||bt===1)for(let Nt=0;Nt<Bt;Nt++)pe=ze[xe++]=pe+de[je++];else for(let Nt=0;Nt<Bt;Nt++)ze[xe++]=++pe}return ze})(H,f,y))):y!==null&&S!==null?(y=jf(H,y,1),S=Dg(H,y,S,!0)):y!==null&&(y=jf(H,y,0)),q!==null?kg(H,U,q,D,new Wu(f,y,S)):R===null?(function(X,K,de,ze){return new Cg(ao.VEC_2,X,K,de,ze)})(H,new Wu(f,y,S),I,D):(function(X,K,de,ze,pe){return new Cg(ao.MORTON,X,K,de,ze,pe)})(H,new Wu(f,y,S),I,D,R))}function jf(i,e,r){const a=new Int32Array(i.length+1);let c=0;a[0]=c;let d=0;for(let f=0;f<i.length;f++)c=a[f+1]=c+(i[f]>r?e[d++]:1);return a}function Dg(i,e,r,a){const c=new Int32Array(e[e.length-1]+1);let d=0;c[0]=d;let f=1,y=0;for(let S=0;S<i.length;S++){const I=i[S],D=e[S+1]-e[S];if(I===5||I===2||a&&(I===4||I===1))for(let R=0;R<D;R++)d=c[f++]=d+r[y++];else for(let R=0;R<D;R++)c[f++]=++d}return c}class Zv extends $u{dataVector;constructor(e,r,a){super(e,r.getBuffer(),a),this.dataVector=r}getValueFromBuffer(e){return this.dataVector.get(e)}}class Wv extends hd{getValueFromBuffer(e){return this.dataBuffer[e]}}class Fg extends $u{constructor(e,r,a){super(e,BigInt64Array.of(r),a)}getValueFromBuffer(e){return this.dataBuffer[0]}}function Mh(i,e,r){return zg(i,Math.ceil(e/8),r)}function zg(i,e,r){const a=new Uint8Array(e);let c=0;for(;c<e;){const d=i[r.increment()];if(d<=127){const f=d+3,y=i[r.increment()],S=c+f;a.fill(y,c,S),c=S}else{const f=256-d;for(let y=0;y<f;y++)a[c++]=i[r.increment()]}}return a}const Hv=new TextDecoder;function Vf(i,e,r){return r-e>=12?Hv.decode(i.subarray(e,r)):(function(a,c,d){let f="",y=c;for(;y<d;){const S=a[y];let I,D,R,U=null,q=S>239?4:S>223?3:S>191?2:1;if(y+q>d)break;q===1?S<128&&(U=S):q===2?(I=a[y+1],(192&I)==128&&(U=(31&S)<<6|63&I,U<=127&&(U=null))):q===3?(I=a[y+1],D=a[y+2],(192&I)==128&&(192&D)==128&&(U=(15&S)<<12|(63&I)<<6|63&D,(U<=2047||U>=55296&&U<=57343)&&(U=null))):q===4&&(I=a[y+1],D=a[y+2],R=a[y+3],(192&I)==128&&(192&D)==128&&(192&R)==128&&(U=(15&S)<<18|(63&I)<<12|(63&D)<<6|63&R,(U<=65535||U>=1114112)&&(U=null))),U===null?(U=65533,q=1):U>65535&&(U-=65536,f+=String.fromCharCode(U>>>10&1023|55296),U=56320|1023&U),f+=String.fromCharCode(U),y+=q}return f})(i,e,r)}class Uf extends $u{offsetBuffer;constructor(e,r,a,c){super(e,a,c),this.offsetBuffer=r}}class Ng extends Uf{textEncoder;constructor(e,r,a,c){super(e,r,a,c??r.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return Vf(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class Hu extends Uf{indexBuffer;textEncoder;constructor(e,r,a,c,d){super(e,a,c,d??r.length),this.indexBuffer=r,this.indexBuffer=r,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const r=this.indexBuffer[e];return Vf(this.dataBuffer,this.offsetBuffer[r],this.offsetBuffer[r+1])}}class Rg extends Uf{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,r,a,c,d,f,y){super(e,a,c,y),this.indexBuffer=r,this.symbolOffsetBuffer=d,this.symbolTableBuffer=f,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(a,c,d){const f=[],y=new Array(c.length).fill(0);for(let S=1;S<c.length;S++)y[S]=y[S-1]+c[S-1];for(let S=0;S<d.length;S++)if(d[S]===255)f.push(d[++S]);else{const I=c[d[S]],D=y[d[S]];for(let R=0;R<I;R++)f.push(a[D+R])}return new Uint8Array(f)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const r=this.indexBuffer[e];return Vf(this.decodedDictionary,this.offsetBuffer[r],this.offsetBuffer[r+1])}offsetToLengthBuffer(e){const r=new Uint32Array(e.length-1);let a=e[0];for(let c=1;c<e.length;c++){const d=e[c];r[c-1]=d-a,a=d}return r}}function Xv(i,e,r,a,c,d){return r.type==="scalarType"?(function(f,y,S,I,D,R){let U=null,q=0;if(f===0)return null;if(R.nullable){const X=ta(y,S);q=X.numValues;const K=S.get(),de=Mh(y,q,S);S.set(K+X.byteLength),U=new il(de,X.numValues)}const H=U??I;switch(D.physicalType){case 4:case 3:return(function(X,K,de,ze,pe){const xe=ta(X,K),je=pd(xe,pe,X,K),Ke=ze.physicalType===3;if(je===Qn.FLAT){const bt=Eh(pe)?zf(X,K,xe,Ke,pe):ra(X,K,xe,Ke);return new Lf(de.name,bt,pe)}if(je===Qn.SEQUENCE){const bt=vg(X,K,xe);return new Mf(de.name,bt[0],bt[1],xe.numRleValues)}{const bt=Ff(X,K,xe,Ke);return new Ef(de.name,bt,pe)}})(y,S,R,D,H);case 9:return(function(X,K,de,ze,pe){let xe=null,je=null,Ke=null,bt=null,Bt=null,Nt=null,qt=null,ir=null;for(let Kt=0;Kt<ze;Kt++){const Ft=ta(K,de);if(Ft.byteLength!==0)switch(Ft.physicalStreamType){case bs.PRESENT:{const Et=Mh(K,Ft.numValues,de);Nt=new il(Et,Ft.numValues);break}case bs.OFFSET:je=pe!=null||Nt!=null?zf(K,de,Ft,!1,pe??Nt):ra(K,de,Ft,!1);break;case bs.LENGTH:{const Et=jc(K,de,Ft);Oa.DICTIONARY===Ft.logicalStreamType.lengthType?xe=Et:Oa.SYMBOL===Ft.logicalStreamType.lengthType?bt=Et:qt=Et;break}case bs.DATA:{const Et=K.subarray(de.get(),de.get()+Ft.byteLength);de.add(Ft.byteLength);const hr=Ft.logicalStreamType.dictionaryType;rl.FSST===hr?Bt=Et:rl.SINGLE===hr||rl.SHARED===hr?Ke=Et:rl.NONE===hr&&(ir=Et);break}}}return(function(Kt,Ft,Et,hr,or,gr,cr){return Ft?new Rg(Kt,Et,hr,or,gr,Ft,cr):null})(X,Bt,je,xe,Ke,bt,pe??Nt)??(function(Kt,Ft,Et,hr,or){return Ft?or?new Hu(Kt,Et,hr,Ft,or):new Hu(Kt,Et,hr,Ft):null})(X,Ke,je,xe,pe??Nt)??(function(Kt,Ft,Et,hr,or){if(!Ft||!Et)return null;if(hr)return or?new Hu(Kt,hr,Ft,Et,or):new Hu(Kt,hr,Ft,Et);if(or&&or.size()!==Ft.length-1){const gr=new Int32Array(or.size());let cr=0;for(let Ar=0;Ar<or.size();Ar++)gr[Ar]=or.get(Ar)?cr++:0;return new Hu(Kt,gr,Ft,Et,or)}return or?new Ng(Kt,Ft,Et,or):new Ng(Kt,Ft,Et)})(X,qt,ir,je,pe??Nt)})(R.name,y,S,R.nullable?f-1:f,U);case 0:return(function(X,K,de,ze,pe){const xe=ta(X,K),je=xe.numValues,Ke=K.get(),bt=Eh(pe)?(function(Nt,qt,ir,Kt){const Ft=zg(Nt,Math.ceil(qt/8),ir),Et=new il(Ft,qt),hr=Kt.size(),or=new il(new Uint8Array(hr),hr);let gr=0;for(let cr=0;cr<Kt.size();cr++){const Ar=!!Kt.get(cr)&&Et.get(gr++);or.set(cr,Ar)}return or.getBuffer()})(X,je,K,pe):Mh(X,je,K);K.set(Ke+xe.byteLength);const Bt=new il(bt,je);return new Zv(de.name,Bt,pe)})(y,S,R,0,H);case 6:case 5:return(function(X,K,de,ze,pe){const xe=ta(X,K),je=pd(xe,ze,X,K),Ke=pe.physicalType===5;if(je===Qn.FLAT){const bt=Eh(ze)?(function(Bt,Nt,qt,ir,Kt){return(function(Ft,Et,hr,or){switch(Et.logicalLevelTechnique1){case di.DELTA:return Et.logicalLevelTechnique2===di.RLE&&(Ft=gg(Ft,Et.runs,Et.numRleValues)),(function(gr,cr){const Ar=new BigInt64Array(gr.size());let yi=0;gr.get(0)?(Ar[0]=gr.get(0)?cr[0]>>1n^-(1n&cr[0]):0n,yi=1):Ar[0]=0n;let ui=1;for(;ui!=Ar.length;++ui)Ar[ui]=gr.get(ui)?Ar[ui-1]+(cr[yi]>>1n^-(1n&cr[yi++])):Ar[ui-1];return Ar})(or,Ft);case di.RLE:return(function(gr,cr,Ar,yi){const ui=cr;return Ar?(function(sn,ws,On){const an=new BigInt64Array(sn.size());let Yi=0;for(let Li=0;Li<On;Li++){const yn=Number(ws[Li]);let An=ws[Li+On];An=An>>1n^-(1n&An);for(let Zi=Yi;Zi<Yi+yn;Zi++)sn.get(Zi)?an[Zi]=An:(an[Zi]=0n,Yi++);Yi+=yn}return an})(yi,gr,ui.runs):(function(sn,ws,On){const an=new BigInt64Array(sn.size());let Yi=0;for(let Li=0;Li<On;Li++){const yn=Number(ws[Li]),An=ws[Li+On];for(let Zi=Yi;Zi<Yi+yn;Zi++)sn.get(Zi)?an[Zi]=An:(an[Zi]=0n,Yi++);Yi+=yn}return an})(yi,gr,ui.runs)})(Ft,Et,hr,or);case di.NONE:return Ft=hr?(function(gr,cr){const Ar=new BigInt64Array(gr.size());let yi=0,ui=0;for(;ui!=Ar.length;++ui)if(gr.get(ui)){const sn=cr[yi++];Ar[ui]=sn>>1n^-(1n&sn)}else Ar[ui]=0n;return Ar})(or,Ft):(function(gr,cr){const Ar=new BigInt64Array(gr.size());let yi=0,ui=0;for(;ui!=Ar.length;++ui)Ar[ui]=gr.get(ui)?cr[yi++]:0n;return Ar})(or,Ft),Ft;default:throw new Error("The specified Logical level technique is not supported")}})(dd(Bt,Nt,qt.numValues),qt,ir,Kt)})(X,K,xe,Ke,ze):xg(X,K,xe,Ke);return new Sg(de.name,bt,ze)}if(je===Qn.SEQUENCE){const bt=bg(X,K,xe);return new Tg(de.name,bt[0],bt[1],xe.numRleValues)}{const bt=wg(X,K,xe,Ke);return new Fg(de.name,bt,ze)}})(y,S,R,H,D);case 7:return(function(X,K,de,ze){const pe=ta(X,K),xe=Eh(ze)?(function(je,Ke,bt,Bt){const Nt=Ke.get(),qt=Nt+Bt*Float32Array.BYTES_PER_ELEMENT,ir=new Uint8Array(je.subarray(Nt,qt)).buffer,Kt=new Float32Array(ir);Ke.set(qt);const Ft=bt.size(),Et=new Float32Array(Ft);let hr=0;for(let or=0;or<Ft;or++)Et[or]=bt.get(or)?Kt[hr++]:0;return Et})(X,K,ze,pe.numValues):(function(je,Ke,bt){const Bt=Ke.get(),Nt=Bt+bt*Float32Array.BYTES_PER_ELEMENT,qt=new Uint8Array(je.subarray(Bt,Nt)).buffer,ir=new Float32Array(qt);return Ke.set(Nt),ir})(X,K,pe.numValues);return new Wv(de.name,xe,ze)})(y,S,R,H);case 8:return(function(X,K,de,ze){const pe=ta(X,K),xe=Eh(ze)?(function(je,Ke,bt,Bt){const Nt=Ke.get(),qt=Nt+Bt*Float64Array.BYTES_PER_ELEMENT,ir=new Uint8Array(je.subarray(Nt,qt)).buffer,Kt=new Float64Array(ir);Ke.set(qt);const Ft=bt.size(),Et=new Float64Array(Ft);let hr=0;for(let or=0;or<Ft;or++)Et[or]=bt.get(or)?Kt[hr++]:0;return Et})(X,K,ze,pe.numValues):(function(je,Ke,bt){const Bt=Ke.get(),Nt=Bt+bt*Float64Array.BYTES_PER_ELEMENT,qt=new Uint8Array(je.subarray(Bt,Nt)).buffer,ir=new Float64Array(qt);return Ke.set(Nt),ir})(X,K,pe.numValues);return new Cf(de.name,xe,ze)})(y,S,R,H);default:throw new Error(`The specified data type for the field is currently not supported: ${D}`)}})(a,i,e,c,r.scalarType,r):a!=1?null:(function(f,y,S,I){let D=null,R=null,U=null,q=null,H=!1;for(;!H;){const ze=ta(f,y);switch(ze.physicalStreamType){case bs.LENGTH:Oa.DICTIONARY===ze.logicalStreamType.lengthType?D=jc(f,y,ze):U=jc(f,y,ze);break;case bs.DATA:rl.SINGLE===ze.logicalStreamType.dictionaryType||rl.SHARED===ze.logicalStreamType.dictionaryType?(R=f.subarray(y.get(),y.get()+ze.byteLength),H=!0):q=f.subarray(y.get(),y.get()+ze.byteLength),y.add(ze.byteLength)}}const X=S.complexType.children,K=[];let de=0;for(const ze of X){const pe=hs(f,y,1)[0];if(pe==0)continue;const xe=`${S.name}${ze.name==="default"?"":":"+ze.name}`;if(pe!==2||ze.type!=="scalarField"||ze.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const je=ta(f,y),Ke=Mh(f,je.numValues,y),bt=ta(f,y),Bt=bt.decompressedCount!==I?zf(f,y,bt,!1,new il(Ke,je.numValues)):ra(f,y,bt,!1);K[de++]=q?new Rg(xe,Bt,D,R,U,q,new il(Ke,je.numValues)):new Hu(xe,Bt,D,R,new il(Ke,je.numValues))}return K})(i,e,r,c)}function Eh(i){return i instanceof il}function Yv(i){if(i.name==="id")return!1;if(i.type==="scalarType"){const e=i.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(i.type==="complexType"){const e=i.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",i),!1}const Jv=new TextDecoder;function Bg(i,e){const r=hs(i,e,1)[0];if(r===0)return"";const a=e.get(),c=i.subarray(a,a+r);return e.add(r),Jv.decode(c)}function Og(i,e){const r=hs(i,e,1)[0]>>>0,a=!!(4&r),c=!!(2&r),d=hs(i,e,1)[0]>>>0,f={};if(1&r&&(f.nullable=!0),c){const y={};if(a?(y.type="logicalType",y.logicalType=d):(y.type="physicalType",y.physicalType=d),8&r){const S=hs(i,e,1)[0]>>>0;y.children=new Array(S);for(let I=0;I<S;I++)y.children[I]=Og(i,e)}f.type="complexField",f.complexField=y}else{const y={};a?(y.type="logicalType",y.logicalType=d):(y.type="physicalType",y.physicalType=d),f.type="scalarField",f.scalarField=y}return f}function Kv(i,e){const r=hs(i,e,1)[0]>>>0,a=(function(c){switch(c){case 0:case 1:case 2:case 3:{const d={};d.nullable=!!(1&c),d.columnScope=0;const f={};return f.physicalType=c>1?6:4,f.type="physicalType",d.scalarType=f,d.type="scalarType",d}case 4:{const d={nullable:!1,columnScope:0},f={type:"physicalType",physicalType:0};return d.type="complexType",d.complexType=f,d}case 30:{const d={nullable:!1,columnScope:0},f={type:"physicalType",physicalType:1};return d.type="complexType",d.complexType=f,d}default:return(function(d){let f=null;switch(d){case 10:case 11:f=0;break;case 12:case 13:f=1;break;case 14:case 15:f=2;break;case 16:case 17:f=3;break;case 18:case 19:f=4;break;case 20:case 21:f=5;break;case 22:case 23:f=6;break;case 24:case 25:f=7;break;case 26:case 27:f=8;break;case 28:case 29:f=9;break;default:return null}const y={};y.nullable=!!(1&d),y.columnScope=0;const S={type:"physicalType"};return S.physicalType=f,y.type="scalarType",y.scalarType=S,y})(c)}})(r);if(!a)throw new Error(`Unsupported column type code: ${r}`);if((function(c){return c>=10})(r)?a.name=Bg(i,e):r>=0&&r<=3?a.name="id":r===4&&(a.name="geometry"),(function(c){return c===30})(r)){const c=hs(i,e,1)[0]>>>0,d=a.complexType;d.children=new Array(c);for(let f=0;f<c;f++)d.children[f]=Og(i,e)}return a}function Qv(i,e){const r={featureTables:[]},a={};a.name=Bg(i,e);const c=hs(i,e,1)[0]>>>0,d=hs(i,e,1)[0]>>>0;a.columns=new Array(d);for(let f=0;f<d;f++)a.columns[f]=Kv(i,e);return r.featureTables.push(a),[r,c]}function eb(i,e,r,a,c,d,f=!1){const y=e.scalarType.physicalType,S=pd(c,d,i,r);if(y===4)switch(S){case Qn.FLAT:{const I=ra(i,r,c,!1);return new Lf(a,I,d)}case Qn.SEQUENCE:{const I=vg(i,r,c);return new Mf(a,I[0],I[1],c.numRleValues)}case Qn.CONST:{const I=Ff(i,r,c,!1);return new Ef(a,I,d)}}else switch(S){case Qn.FLAT:{if(f){const D=(function(R,U,q,H){const X=(function(K,de,ze){const pe=new Float64Array(de);for(let xe=0;xe<de;xe++)pe[xe]=jv(K,ze);return pe})(R,q.numValues,U);return(function(K,de,ze){switch(de.logicalLevelTechnique1){case di.DELTA:return de.logicalLevelTechnique2===di.RLE&&(K=_g(K,de.runs,de.numRleValues)),(function(pe){pe[0]=pe[0]%2==1?(pe[0]+1)/-2:pe[0]/2;const xe=pe.length/4*4;let je=1;if(xe>=4)for(;je<xe-4;je+=4){const Ke=pe[je],bt=pe[je+1],Bt=pe[je+2],Nt=pe[je+3];pe[je]=(Ke%2==1?(Ke+1)/-2:Ke/2)+pe[je-1],pe[je+1]=(bt%2==1?(bt+1)/-2:bt/2)+pe[je],pe[je+2]=(Bt%2==1?(Bt+1)/-2:Bt/2)+pe[je+1],pe[je+3]=(Nt%2==1?(Nt+1)/-2:Nt/2)+pe[je+2]}for(;je!=pe.length;++je)pe[je]=(pe[je]%2==1?(pe[je]+1)/-2:pe[je]/2)+pe[je-1]})(K),K;case di.RLE:return(function(pe,xe,je){return _g(pe,xe.runs,xe.numRleValues)})(K,de);case di.NONE:return K;default:throw new Error(`The specified Logical level technique is not supported: ${de.logicalLevelTechnique1}`)}})(X,q)})(i,r,c);return new Cf(a,D,d)}const I=xg(i,r,c,!1);return new Sg(a,I,d)}case Qn.SEQUENCE:{const I=bg(i,r,c);return new Tg(a,I[0],I[1],c.numRleValues)}case Qn.CONST:{const I=wg(i,r,c,!1);return new Fg(a,I,d)}}throw new Error("Vector type not supported for id column.")}class tb{constructor(e,r){var a;switch(this._featureData=e,this.properties=this._featureData.properties||{},(a=this._featureData.geometry)===null||a===void 0?void 0:a.type){case es.POINT:case es.MULTIPOINT:this.type=1;break;case es.LINESTRING:case es.MULTILINESTRING:this.type=2;break;case es.POLYGON:case es.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=r,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const r of this._featureData.geometry.coordinates){const a=[];for(const c of r)a.push(new E(c.x,c.y));e.push(a)}return e}}class rb{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new tb(this.features[e],this.extent)}}class jg{constructor(e){this.layers={};const r=(function(a,c,d=!0){const f=new Ov(0),y=[];for(;f.get()<a.length;){const S=hs(a,f,1)[0]>>>0,I=f.get()+S;if(I>a.length)throw new Error(`Block overruns tile: ${I} > ${a.length}`);if(hs(a,f,1)[0]>>>0!=1){f.set(I);continue}const D=Qv(a,f),R=D[1],U=D[0].featureTables[0];let q=null,H=null;const X=[];let K=0;for(const ze of U.columns){const pe=ze.name;if(pe==="id"){let xe=null;if(ze.nullable){const Ke=ta(a,f),bt=f.get(),Bt=Mh(a,Ke.numValues,f);f.set(bt+Ke.byteLength),xe=new il(Bt,Ke.numValues)}const je=ta(a,f);K=je.decompressedCount,q=eb(a,ze,f,pe,je,xe??K,d)}else if(pe==="geometry"){const xe=hs(a,f,1)[0];if(K===0){const je=f.get();K=ta(a,f).decompressedCount,f.set(je)}H=$v(a,xe,f,K)}else{const xe=Yv(ze)?hs(a,f,1)[0]:1;if(xe===0&&ze.type==="scalarType")continue;const je=Xv(a,f,ze,xe,K);if(je)if(Array.isArray(je))for(const Ke of je)X.push(Ke);else X.push(je)}}const de=new Bv(U.name,H,q,X,R);y.push(de),f.set(I)}return y})(new Uint8Array(e));this.layers=r.reduce(((a,c)=>Object.assign(Object.assign({},a),{[c.name]:new rb(c)})),{})}}class ib{constructor(e,r){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=r,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],r=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const a of r){const c=[];for(const d of a)c.push(new E(d[0],d[1]));e.push(c)}return e}}const kh="_geojsonTileLayer";function nb(i,e){e.writeVarintField(15,i.version||1),e.writeStringField(1,i.name||""),e.writeVarintField(5,i.extent||4096);const r={keys:[],values:[],keycache:{},valuecache:{}};for(let d=0;d<i.length;d++)r.feature=i.feature(d),e.writeMessage(2,sb,r);const a=r.keys;for(const d of a)e.writeStringField(3,d);const c=r.values;for(const d of c)e.writeMessage(4,lb,d)}function sb(i,e){if(!i.feature)return;const r=i.feature;r.id!==void 0&&e.writeVarintField(1,r.id),e.writeMessage(2,ab,i),e.writeVarintField(3,r.type),e.writeMessage(4,ob,r)}function ab(i,e){for(const r in i.feature?.properties){let a=i.feature.properties[r],c=i.keycache[r];if(a==null)continue;c===void 0&&(i.keys.push(r),c=i.keys.length-1,i.keycache[r]=c),e.writeVarint(c),typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"&&(a=JSON.stringify(a));const d=typeof a+":"+a;let f=i.valuecache[d];f===void 0&&(i.values.push(a),f=i.values.length-1,i.valuecache[d]=f),e.writeVarint(f)}}function qf(i,e){return(e<<3)+(7&i)}function Vg(i){return i<<1^i>>31}function ob(i,e){const r=i.loadGeometry(),a=i.type;let c=0,d=0;for(const f of r){let y=1;a===1&&(y=f.length),e.writeVarint(qf(1,y));const S=a===3?f.length-1:f.length;for(let I=0;I<S;I++){I===1&&a!==1&&e.writeVarint(qf(2,S-1));const D=f[I].x-c,R=f[I].y-d;e.writeVarint(Vg(D)),e.writeVarint(Vg(R)),c+=D,d+=R}i.type===3&&e.writeVarint(qf(7,1))}}function lb(i,e){const r=typeof i;r==="string"?e.writeStringField(1,i):r==="boolean"?e.writeBooleanField(7,i):r==="number"&&(i%1!=0?e.writeDoubleField(3,i):i<0?e.writeSVarintField(6,i):e.writeVarintField(5,i))}class Ug{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Tt(gt,16,0),this.grid3D=new Tt(gt,16,0),this.featureIndexArray=new ce,this.promoteId=r}insert(e,r,a,c,d,f){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,d);const S=f?this.grid3D:this.grid;for(let I=0;I<r.length;I++){const D=r[I],R=[1/0,1/0,-1/0,-1/0];for(let U=0;U<D.length;U++){const q=D[U];R[0]=Math.min(R[0],q.x),R[1]=Math.min(R[1],q.y),R[2]=Math.max(R[2],q.x),R[3]=Math.max(R[3],q.y)}R[0]<gt&&R[1]<gt&&R[2]>=0&&R[3]>=0&&S.insert(y,R[0],R[1],R[2],R[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new Im(new ad(this.rawTileData)).layers:new jg(this.rawTileData).layers,this.sourceLayerCoder=new ug(this.vtLayers?Object.keys(this.vtLayers).sort():[kh])),this.vtLayers}query(e,r,a,c){this.loadVTLayers();const d=e.params,f=gt/e.tileSize/e.scale,y=Jo(d.filter,d.globalState),S=e.queryGeometry,I=e.queryPadding*f,D=pu.fromPoints(S),R=this.grid.query(D.minX-I,D.minY-I,D.maxX+I,D.maxY+I),U=pu.fromPoints(e.cameraQueryGeometry).expandBy(I),q=this.grid3D.query(U.minX,U.minY,U.maxX,U.maxY,((K,de,ze,pe)=>(function(xe,je,Ke,bt,Bt){for(const qt of xe)if(je<=qt.x&&Ke<=qt.y&&bt>=qt.x&&Bt>=qt.y)return!0;const Nt=[new E(je,Ke),new E(je,Bt),new E(bt,Bt),new E(bt,Ke)];if(xe.length>2){for(const qt of Nt)if(Nu(xe,qt))return!0}for(let qt=0;qt<xe.length-1;qt++)if(u1(xe[qt],xe[qt+1],Nt))return!0;return!1})(e.cameraQueryGeometry,K-I,de-I,ze+I,pe+I)));for(const K of q)R.push(K);R.sort(cb);const H={};let X;for(let K=0;K<R.length;K++){const de=R[K];if(de===X)continue;X=de;const ze=this.featureIndexArray.get(de);let pe=null;this.loadMatchingFeature(H,ze.bucketIndex,ze.sourceLayerIndex,ze.featureIndex,y,d.layers,d.availableImages,r,a,c,((xe,je,Ke)=>(pe||(pe=Rl(xe)),je.queryIntersectsFeature({queryGeometry:S,feature:xe,featureState:Ke,geometry:pe,zoom:this.z,transform:e.transform,pixelsToTileUnits:f,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return H}loadMatchingFeature(e,r,a,c,d,f,y,S,I,D,R){const U=this.bucketLayerIDs[r];if(f&&!U.some((K=>f.has(K))))return;const q=this.sourceLayerCoder.decode(a),H=this.vtLayers[q].feature(c);if(d.needGeometry){const K=Bl(H,!0);if(!d.filter(new Kr(this.tileID.overscaledZ),K,this.tileID.canonical))return}else if(!d.filter(new Kr(this.tileID.overscaledZ),H))return;const X=this.getId(H,q);for(let K=0;K<U.length;K++){const de=U[K];if(f&&!f.has(de))continue;const ze=S[de];if(!ze)continue;let pe={};X&&D&&(pe=D.getState(ze.sourceLayer||kh,X));const xe=ft({},I[de]);xe.paint=qg(xe.paint,ze.paint,H,pe,y),xe.layout=qg(xe.layout,ze.layout,H,pe,y);const je=!R||R(H,ze,pe);if(!je)continue;const Ke=new hg(H,this.z,this.x,this.y,X);Ke.layer=xe;let bt=e[de];bt===void 0&&(bt=e[de]=[]),bt.push({featureIndex:c,feature:Ke,intersectionZ:je})}}lookupSymbolFeatures(e,r,a,c,d,f,y,S){const I={};this.loadVTLayers();const D=Jo(d.filterSpec,d.globalState);for(const R of e)this.loadMatchingFeature(I,a,c,R,D,f,y,S,r);return I}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){var a;let c=e.id;return this.promoteId&&(c=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof c=="boolean"&&(c=Number(c)),c===void 0&&(!((a=e.properties)===null||a===void 0)&&a.cluster)&&this.promoteId&&(c=Number(e.properties.cluster_id))),c}}function qg(i,e,r,a,c){return zt(i,((d,f)=>{const y=e instanceof gn?e.get(f):null;return y&&y.evaluate?y.evaluate(r,a,c):y}))}function cb(i,e){return e-i}function Gg(i,e,r,a,c){const d=[];for(let f=0;f<i.length;f++){const y=i[f];let S;for(let I=0;I<y.length-1;I++){let D=y[I],R=y[I+1];D.x<e&&R.x<e||(D.x<e?D=new E(e,D.y+(e-D.x)/(R.x-D.x)*(R.y-D.y))._round():R.x<e&&(R=new E(e,D.y+(e-D.x)/(R.x-D.x)*(R.y-D.y))._round()),D.y<r&&R.y<r||(D.y<r?D=new E(D.x+(r-D.y)/(R.y-D.y)*(R.x-D.x),r)._round():R.y<r&&(R=new E(D.x+(r-D.y)/(R.y-D.y)*(R.x-D.x),r)._round()),D.x>=a&&R.x>=a||(D.x>=a?D=new E(a,D.y+(a-D.x)/(R.x-D.x)*(R.y-D.y))._round():R.x>=a&&(R=new E(a,D.y+(a-D.x)/(R.x-D.x)*(R.y-D.y))._round()),D.y>=c&&R.y>=c||(D.y>=c?D=new E(D.x+(c-D.y)/(R.y-D.y)*(R.x-D.x),c)._round():R.y>=c&&(R=new E(D.x+(c-D.y)/(R.y-D.y)*(R.x-D.x),c)._round()),S&&D.equals(S[S.length-1])||(S=[D],d.push(S)),S.push(R)))))}}return d}function $g(i,e,r,a,c){switch(e){case 1:return(function(d,f,y,S){const I=[];for(const D of d)for(const R of D){const U=S===0?R.x:R.y;U>=f&&U<=y&&I.push([R])}return I})(i,r,a,c);case 2:return Zg(i,r,a,c,!1);case 3:return Zg(i,r,a,c,!0)}return[]}function ub(i,e,r,a,c){const d=a===0?hb:db;let f=[];const y=[];for(let D=0;D<i.length-1;D++){const R=i[D],U=i[D+1],q=a===0?R.x:R.y,H=a===0?U.x:U.y;let X=!1;q<e?H>e&&f.push(d(R,U,e)):q>r?H<r&&f.push(d(R,U,r)):f.push(R),H<e&&q>=e&&(f.push(d(R,U,e)),X=!0),H>r&&q<=r&&(f.push(d(R,U,r)),X=!0),!c&&X&&(y.push(f),f=[])}const S=i.length-1,I=a===0?i[S].x:i[S].y;return I>=e&&I<=r&&f.push(i[S]),c&&f.length>0&&!f[0].equals(f[f.length-1])&&f.push(new E(f[0].x,f[0].y)),f.length>0&&y.push(f),y}function Zg(i,e,r,a,c){const d=[];for(const f of i){const y=ub(f,e,r,a,c);y.length>0&&d.push(...y)}return d}function hb(i,e,r){return new E(r,i.y+(r-i.x)/(e.x-i.x)*(e.y-i.y))}function db(i,e,r){return new E(i.x+(r-i.y)/(e.y-i.y)*(e.x-i.x),r)}Ve("FeatureIndex",Ug,{omit:["rawTileData","sourceLayerCoder"]});class Vc extends E{constructor(e,r,a,c){super(e,r),this.angle=a,c!==void 0&&(this.segment=c)}clone(){return new Vc(this.x,this.y,this.angle,this.segment)}}function Wg(i,e,r,a,c){if(e.segment===void 0||r===0)return!0;let d=e,f=e.segment+1,y=0;for(;y>-r/2;){if(f--,f<0)return!1;y-=i[f].dist(d),d=i[f]}y+=i[f].dist(i[f+1]),f++;const S=[];let I=0;for(;y<r/2;){const D=i[f],R=i[f+1];if(!R)return!1;let U=i[f-1].angleTo(D)-D.angleTo(R);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:y,angleDelta:U}),I+=U;y-S[0].distance>a;)I-=S.shift().angleDelta;if(I>c)return!1;f++,y+=D.dist(R)}return!0}function Hg(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Xg(i,e,r){return i?.6*e*r:0}function Yg(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function fb(i,e,r,a,c,d){const f=Xg(r,c,d),y=Yg(r,a)*d;let S=0;const I=Hg(i)/2;for(let D=0;D<i.length-1;D++){const R=i[D],U=i[D+1],q=R.dist(U);if(S+q>I){const H=(I-S)/q,X=ar.number(R.x,U.x,H),K=ar.number(R.y,U.y,H),de=new Vc(X,K,U.angleTo(R),D);return de._round(),!f||Wg(i,de,y,f,e)?de:void 0}S+=q}}function pb(i,e,r,a,c,d,f,y,S){const I=Xg(a,d,f),D=Yg(a,c),R=D*f,U=i[0].x===0||i[0].x===S||i[0].y===0||i[0].y===S;return e-R<e/4&&(e=R+e/4),Jg(i,U?e/2*y%e:(D/2+2*d)*f*y%e,e,I,r,R,U,!1,S)}function Jg(i,e,r,a,c,d,f,y,S){const I=d/2,D=Hg(i);let R=0,U=e-r,q=[];for(let H=0;H<i.length-1;H++){const X=i[H],K=i[H+1],de=X.dist(K),ze=K.angleTo(X);for(;U+r<R+de;){U+=r;const pe=(U-R)/de,xe=ar.number(X.x,K.x,pe),je=ar.number(X.y,K.y,pe);if(xe>=0&&xe<S&&je>=0&&je<S&&U-I>=0&&U+I<=D){const Ke=new Vc(xe,je,ze,H);Ke._round(),a&&!Wg(i,Ke,d,a,c)||q.push(Ke)}}R+=de}return y||q.length||f||(q=Jg(i,R/2,r,a,c,d,f,!0,S)),q}function Kg(i,e,r,a){const c=[],d=i.image,f=d.pixelRatio,y=d.paddedRect.w-2,S=d.paddedRect.h-2;let I={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const D=d.stretchX||[[0,y]],R=d.stretchY||[[0,S]],U=(Et,hr)=>Et+hr[1]-hr[0],q=D.reduce(U,0),H=R.reduce(U,0),X=y-q,K=S-H;let de=0,ze=q,pe=0,xe=H,je=0,Ke=X,bt=0,Bt=K;if(d.content&&a){const Et=d.content,hr=Et[2]-Et[0],or=Et[3]-Et[1];(d.textFitWidth||d.textFitHeight)&&(I=Wm(i)),de=yd(D,0,Et[0]),pe=yd(R,0,Et[1]),ze=yd(D,Et[0],Et[2]),xe=yd(R,Et[1],Et[3]),je=Et[0]-de,bt=Et[1]-pe,Ke=hr-ze,Bt=or-xe}const Nt=I.x1,qt=I.y1,ir=I.x2-Nt,Kt=I.y2-qt,Ft=(Et,hr,or,gr)=>{const cr=vd(Et.stretch-de,ze,ir,Nt),Ar=bd(Et.fixed-je,Ke,Et.stretch,q),yi=vd(hr.stretch-pe,xe,Kt,qt),ui=bd(hr.fixed-bt,Bt,hr.stretch,H),sn=vd(or.stretch-de,ze,ir,Nt),ws=bd(or.fixed-je,Ke,or.stretch,q),On=vd(gr.stretch-pe,xe,Kt,qt),an=bd(gr.fixed-bt,Bt,gr.stretch,H),Yi=new E(cr,yi),Li=new E(sn,yi),yn=new E(sn,On),An=new E(cr,On),Zi=new E(Ar/f,ui/f),ba=new E(ws/f,an/f),Ss=e*Math.PI/180;if(Ss){const ts=Math.sin(Ss),dn=Math.cos(Ss),jn=[dn,-ts,ts,dn];Yi._matMult(jn),Li._matMult(jn),An._matMult(jn),yn._matMult(jn)}const xa=Et.stretch+Et.fixed,zo=hr.stretch+hr.fixed;return{tl:Yi,tr:Li,bl:An,br:yn,tex:{x:d.paddedRect.x+1+xa,y:d.paddedRect.y+1+zo,w:or.stretch+or.fixed-xa,h:gr.stretch+gr.fixed-zo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zi,pixelOffsetBR:ba,minFontScaleX:Ke/f/ir,minFontScaleY:Bt/f/Kt,isSDF:r}};if(a&&(d.stretchX||d.stretchY)){const Et=Qg(D,X,q),hr=Qg(R,K,H);for(let or=0;or<Et.length-1;or++){const gr=Et[or],cr=Et[or+1];for(let Ar=0;Ar<hr.length-1;Ar++)c.push(Ft(gr,hr[Ar],cr,hr[Ar+1]))}}else c.push(Ft({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:S+1}));return c}function yd(i,e,r){let a=0;for(const c of i)a+=Math.max(e,Math.min(r,c[1]))-Math.max(e,Math.min(r,c[0]));return a}function Qg(i,e,r){const a=[{fixed:-1,stretch:0}];for(const[c,d]of i){const f=a[a.length-1];a.push({fixed:c-f.stretch,stretch:f.stretch}),a.push({fixed:c-f.stretch,stretch:f.stretch+(d-c)})}return a.push({fixed:e+1,stretch:r}),a}function vd(i,e,r,a){return i/e*r+a}function bd(i,e,r,a){return i-e*r/a}Ve("Anchor",Vc);class xd{constructor(e,r,a,c,d,f,y,S,I,D){var R;if(this.boxStartIndex=e.length,I){let U=f.top,q=f.bottom;const H=f.collisionPadding;H&&(U-=H[1],q+=H[3]);let X=q-U;X>0&&(X=Math.max(10,X),this.circleDiameter=X)}else{const U=!((R=f.image)===null||R===void 0)&&R.content&&(f.image.textFitWidth||f.image.textFitHeight)?Wm(f):{x1:f.left,y1:f.top,x2:f.right,y2:f.bottom};U.y1=U.y1*y-S[0],U.y2=U.y2*y+S[2],U.x1=U.x1*y-S[3],U.x2=U.x2*y+S[1];const q=f.collisionPadding;if(q&&(U.x1-=q[0]*y,U.y1-=q[1]*y,U.x2+=q[2]*y,U.y2+=q[3]*y),D){const H=new E(U.x1,U.y1),X=new E(U.x2,U.y1),K=new E(U.x1,U.y2),de=new E(U.x2,U.y2),ze=D*Math.PI/180;H._rotate(ze),X._rotate(ze),K._rotate(ze),de._rotate(ze),U.x1=Math.min(H.x,X.x,K.x,de.x),U.x2=Math.max(H.x,X.x,K.x,de.x),U.y1=Math.min(H.y,X.y,K.y,de.y),U.y2=Math.max(H.y,X.y,K.y,de.y)}e.emplaceBack(r.x,r.y,U.x1,U.y1,U.x2,U.y2,a,c,d)}this.boxEndIndex=e.length}}class mb{constructor(e=[],r=(a,c)=>a<c?-1:a>c?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,c=r[e];for(;e>0;){const d=e-1>>1,f=r[d];if(a(c,f)>=0)break;r[e]=f,e=d}r[e]=c}_down(e){const{data:r,compare:a}=this,c=this.length>>1,d=r[e];for(;e<c;){let f=1+(e<<1);const y=f+1;if(y<this.length&&a(r[y],r[f])<0&&(f=y),a(r[f],d)>=0)break;r[e]=r[f],e=f}r[e]=d}}function gb(i,e=1,r=!1){const a=pu.fromPoints(i[0]),c=Math.min(a.width(),a.height());let d=c/2;const f=new mb([],_b),{minX:y,minY:S,maxX:I,maxY:D}=a;if(c===0)return new E(y,S);for(let q=y;q<I;q+=c)for(let H=S;H<D;H+=c)f.push(new Xu(q+d,H+d,d,i));let R=(function(q){let H=0,X=0,K=0;const de=q[0];for(let ze=0,pe=de.length,xe=pe-1;ze<pe;xe=ze++){const je=de[ze],Ke=de[xe],bt=je.x*Ke.y-Ke.x*je.y;X+=(je.x+Ke.x)*bt,K+=(je.y+Ke.y)*bt,H+=3*bt}return new Xu(X/H,K/H,0,q)})(i),U=f.length;for(;f.length;){const q=f.pop();(q.d>R.d||!R.d)&&(R=q,r&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,U)),q.max-R.d<=e||(d=q.h/2,f.push(new Xu(q.p.x-d,q.p.y-d,d,i)),f.push(new Xu(q.p.x+d,q.p.y-d,d,i)),f.push(new Xu(q.p.x-d,q.p.y+d,d,i)),f.push(new Xu(q.p.x+d,q.p.y+d,d,i)),U+=4)}return r&&(console.log(`num probes: ${U}`),console.log(`best distance: ${R.d}`)),R.p}function _b(i,e){return e.max-i.max}function Xu(i,e,r,a){this.p=new E(i,e),this.h=r,this.d=(function(c,d){let f=!1,y=1/0;for(let S=0;S<d.length;S++){const I=d[S];for(let D=0,R=I.length,U=R-1;D<R;U=D++){const q=I[D],H=I[U];q.y>c.y!=H.y>c.y&&c.x<(H.x-q.x)*(c.y-q.y)/(H.y-q.y)+q.x&&(f=!f),y=Math.min(y,nm(c,q,H))}}return(f?1:-1)*Math.sqrt(y)})(this.p,a),this.max=this.d+this.h*Math.SQRT2}var xs;b.aP=void 0,(xs=b.aP||(b.aP={}))[xs.center=1]="center",xs[xs.left=2]="left",xs[xs.right=3]="right",xs[xs.top=4]="top",xs[xs.bottom=5]="bottom",xs[xs["top-left"]=6]="top-left",xs[xs["top-right"]=7]="top-right",xs[xs["bottom-left"]=8]="bottom-left",xs[xs["bottom-right"]=9]="bottom-right";const Gf=Number.POSITIVE_INFINITY;function e_(i,e){return e[1]!==Gf?(function(r,a,c){let d=0,f=0;switch(a=Math.abs(a),c=Math.abs(c),r){case"top-right":case"top-left":case"top":f=c-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-c}switch(r){case"top-right":case"bottom-right":case"right":d=-a;break;case"top-left":case"bottom-left":case"left":d=a}return[d,f]})(i,e[0],e[1]):(function(r,a){let c=0,d=0;a<0&&(a=0);const f=a/Math.SQRT2;switch(r){case"top-right":case"top-left":d=f-7;break;case"bottom-right":case"bottom-left":d=7-f;break;case"bottom":d=7-a;break;case"top":d=a-7}switch(r){case"top-right":case"bottom-right":c=-f;break;case"top-left":case"bottom-left":c=f;break;case"left":c=a;break;case"right":c=-a}return[c,d]})(i,e[0])}function t_(i,e,r){var a;const c=i.layout,d=(a=c.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(e,{},r);if(d){const y=d.values,S=[];for(let I=0;I<y.length;I+=2){const D=S[I]=y[I],R=y[I+1].map((U=>U*Kn));D.startsWith("top")?R[1]-=7:D.startsWith("bottom")&&(R[1]+=7),S[I+1]=R}return new Ki(S)}const f=c.get("text-variable-anchor");if(f){let y;y=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(e,{},r)*Kn,Gf]:c.get("text-offset").evaluate(e,{},r).map((I=>I*Kn));const S=[];for(const I of f)S.push(I,e_(I,y));return new Ki(S)}return null}function $f(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function yb(i,e,r,a,c,d,f,y,S,I,D,R){let U=d.textMaxSize.evaluate(e,{});U===void 0&&(U=f);const q=i.layers[0].layout,H=q.get("icon-offset").evaluate(e,{},D),X=i_(r.horizontal),K=f/24,de=i.tilePixelRatio*K,ze=i.tilePixelRatio*U/24,pe=i.tilePixelRatio*y,xe=i.tilePixelRatio*q.get("symbol-spacing"),je=q.get("text-padding")*i.tilePixelRatio,Ke=(function(or,gr,cr,Ar=1){const yi=or.get("icon-padding").evaluate(gr,{},cr),ui=yi&&yi.values;return[ui[0]*Ar,ui[1]*Ar,ui[2]*Ar,ui[3]*Ar]})(q,e,D,i.tilePixelRatio),bt=q.get("text-max-angle")/180*Math.PI,Bt=q.get("text-rotation-alignment")!=="viewport"&&q.get("symbol-placement")!=="point",Nt=q.get("icon-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",qt=q.get("symbol-placement"),ir=xe/2,Kt=q.get("icon-text-fit");let Ft;a&&Kt!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Ft=Hm(a,r.vertical,Kt,q.get("icon-text-fit-padding"),H,K)),X&&(a=Hm(a,X,Kt,q.get("icon-text-fit-padding"),H,K)));const Et=D?R.line.getGranularityForZoomLevel(D.z):1,hr=(or,gr)=>{gr.x<0||gr.x>=gt||gr.y<0||gr.y>=gt||(function(cr,Ar,yi,ui,sn,ws,On,an,Yi,Li,yn,An,Zi,ba,Ss,xa,zo,ts,dn,jn,vn,rs,gc,nl,zh){const Uc=cr.addToLineVertexArray(Ar,yi);let _u,Yu,Ju,Ku,o_=0,l_=0,c_=0,u_=0,Qf=-1,ep=-1;const _c={};let h_=Pn("");if(cr.allowVerticalPlacement&&ui.vertical){const Ns=an.layout.get("text-rotate").evaluate(vn,{},nl)+90;Ju=new xd(Yi,Ar,Li,yn,An,ui.vertical,Zi,ba,Ss,Ns),On&&(Ku=new xd(Yi,Ar,Li,yn,An,On,zo,ts,Ss,Ns))}if(sn){const Ns=an.layout.get("icon-rotate").evaluate(vn,{}),oo=an.layout.get("icon-text-fit")!=="none",yu=Kg(sn,Ns,gc,oo),al=On?Kg(On,Ns,gc,oo):void 0;Yu=new xd(Yi,Ar,Li,yn,An,sn,zo,ts,!1,Ns),o_=4*yu.length;const vu=cr.iconSizeData;let Ol=null;vu.kind==="source"?(Ol=[pc*an.layout.get("icon-size").evaluate(vn,{})],Ol[0]>Bc&&_r(`${cr.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):vu.kind==="composite"&&(Ol=[pc*rs.compositeIconSizes[0].evaluate(vn,{},nl),pc*rs.compositeIconSizes[1].evaluate(vn,{},nl)],(Ol[0]>Bc||Ol[1]>Bc)&&_r(`${cr.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),cr.addSymbols(cr.icon,yu,Ol,jn,dn,vn,b.az.none,Ar,Uc.lineStartIndex,Uc.lineLength,-1,nl),Qf=cr.icon.placedSymbolArray.length-1,al&&(l_=4*al.length,cr.addSymbols(cr.icon,al,Ol,jn,dn,vn,b.az.vertical,Ar,Uc.lineStartIndex,Uc.lineLength,-1,nl),ep=cr.icon.placedSymbolArray.length-1)}const d_=Object.keys(ui.horizontal);for(const Ns of d_){const oo=ui.horizontal[Ns];if(!_u){h_=Pn(oo.text);const al=an.layout.get("text-rotate").evaluate(vn,{},nl);_u=new xd(Yi,Ar,Li,yn,An,oo,Zi,ba,Ss,al)}const yu=oo.positionedLines.length===1;if(c_+=r_(cr,Ar,oo,ws,an,Ss,vn,xa,Uc,ui.vertical?b.az.horizontal:b.az.horizontalOnly,yu?d_:[Ns],_c,Qf,rs,nl),yu)break}ui.vertical&&(u_+=r_(cr,Ar,ui.vertical,ws,an,Ss,vn,xa,Uc,b.az.vertical,["vertical"],_c,ep,rs,nl));const xb=_u?_u.boxStartIndex:cr.collisionBoxArray.length,wb=_u?_u.boxEndIndex:cr.collisionBoxArray.length,Sb=Ju?Ju.boxStartIndex:cr.collisionBoxArray.length,Tb=Ju?Ju.boxEndIndex:cr.collisionBoxArray.length,Pb=Yu?Yu.boxStartIndex:cr.collisionBoxArray.length,Ab=Yu?Yu.boxEndIndex:cr.collisionBoxArray.length,Ib=Ku?Ku.boxStartIndex:cr.collisionBoxArray.length,Lb=Ku?Ku.boxEndIndex:cr.collisionBoxArray.length;let sl=-1;const Sd=(Ns,oo)=>Ns&&Ns.circleDiameter?Math.max(Ns.circleDiameter,oo):oo;sl=Sd(_u,sl),sl=Sd(Ju,sl),sl=Sd(Yu,sl),sl=Sd(Ku,sl);const f_=sl>-1?1:0;f_&&(sl*=zh/Kn),cr.glyphOffsetArray.length>=qu.MAX_GLYPHS&&_r("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vn.sortKey!==void 0&&cr.addToSortKeyRanges(cr.symbolInstances.length,vn.sortKey);const Cb=t_(an,vn,nl),[Mb,Eb]=(function(Ns,oo){const yu=Ns.length,al=oo?.values;if(al?.length>0)for(let vu=0;vu<al.length;vu+=2){const Ol=al[vu+1];Ns.emplaceBack(b.aP[al[vu]],Ol[0],Ol[1])}return[yu,Ns.length]})(cr.textAnchorOffsets,Cb);cr.symbolInstances.emplaceBack(Ar.x,Ar.y,_c.right>=0?_c.right:-1,_c.center>=0?_c.center:-1,_c.left>=0?_c.left:-1,_c.vertical||-1,Qf,ep,h_,xb,wb,Sb,Tb,Pb,Ab,Ib,Lb,Li,c_,u_,o_,l_,f_,0,Zi,sl,Mb,Eb)})(i,gr,or,r,a,c,Ft,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,de,[je,je,je,je],Bt,S,pe,Ke,Nt,H,e,d,I,D,f)};if(qt==="line")for(const or of Gg(e.geometry,0,0,gt,gt)){const gr=fu(or,Et),cr=pb(gr,xe,bt,r.vertical||X,a,24,ze,i.overscaling,gt);for(const Ar of cr)X&&vb(i,X.text,ir,Ar)||hr(gr,Ar)}else if(qt==="line-center"){for(const or of e.geometry)if(or.length>1){const gr=fu(or,Et),cr=fb(gr,bt,r.vertical||X,a,24,ze);cr&&hr(gr,cr)}}else if(e.type==="Polygon")for(const or of fa(e.geometry,0)){const gr=gb(or,16);hr(fu(or[0],Et,!0),new Vc(gr.x,gr.y,0))}else if(e.type==="LineString")for(const or of e.geometry){const gr=fu(or,Et);hr(gr,new Vc(gr[0].x,gr[0].y,0))}else if(e.type==="Point")for(const or of e.geometry)for(const gr of or)hr([gr],new Vc(gr.x,gr.y,0))}function r_(i,e,r,a,c,d,f,y,S,I,D,R,U,q,H){const X=(function(ze,pe,xe,je,Ke,bt,Bt,Nt){const qt=je.layout.get("text-rotate").evaluate(bt,{})*Math.PI/180,ir=[];for(const Kt of pe.positionedLines)for(const Ft of Kt.positionedGlyphs){if(!Ft.rect)continue;const Et=Ft.rect||{};let hr=4,or=!0,gr=1,cr=0;const Ar=(Ke||Nt)&&Ft.vertical,yi=Ft.metrics.advance*Ft.scale/2;if(Nt&&pe.verticalizable&&(cr=Kt.lineOffset/2-(Ft.imageName?-(Kn-Ft.metrics.width*Ft.scale)/2:(Ft.scale-1)*Kn)),Ft.imageName){const ts=Bt[Ft.imageName];or=ts.sdf,gr=ts.pixelRatio,hr=1/gr}const ui=Ke?[Ft.x+yi,Ft.y]:[0,0];let sn=Ke?[0,0]:[Ft.x+yi+xe[0],Ft.y+xe[1]-cr],ws=[0,0];Ar&&(ws=sn,sn=[0,0]);const On=Ft.metrics.isDoubleResolution?2:1,an=(Ft.metrics.left-hr)*Ft.scale-yi+sn[0],Yi=(-Ft.metrics.top-hr)*Ft.scale+sn[1],Li=an+Et.w/On*Ft.scale/gr,yn=Yi+Et.h/On*Ft.scale/gr,An=new E(an,Yi),Zi=new E(Li,Yi),ba=new E(an,yn),Ss=new E(Li,yn);if(Ar){const ts=new E(-yi,yi- -17),dn=-Math.PI/2,jn=12-yi,vn=new E(22-jn,-(Ft.imageName?jn:0)),rs=new E(...ws);An._rotateAround(dn,ts)._add(vn)._add(rs),Zi._rotateAround(dn,ts)._add(vn)._add(rs),ba._rotateAround(dn,ts)._add(vn)._add(rs),Ss._rotateAround(dn,ts)._add(vn)._add(rs)}if(qt){const ts=Math.sin(qt),dn=Math.cos(qt),jn=[dn,-ts,ts,dn];An._matMult(jn),Zi._matMult(jn),ba._matMult(jn),Ss._matMult(jn)}const xa=new E(0,0),zo=new E(0,0);ir.push({tl:An,tr:Zi,bl:ba,br:Ss,tex:Et,writingMode:pe.writingMode,glyphOffset:ui,sectionIndex:Ft.sectionIndex,isSDF:or,pixelOffsetTL:xa,pixelOffsetBR:zo,minFontScaleX:0,minFontScaleY:0})}return ir})(0,r,y,c,d,f,a,i.allowVerticalPlacement),K=i.textSizeData;let de=null;K.kind==="source"?(de=[pc*c.layout.get("text-size").evaluate(f,{})],de[0]>Bc&&_r(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):K.kind==="composite"&&(de=[pc*q.compositeTextSizes[0].evaluate(f,{},H),pc*q.compositeTextSizes[1].evaluate(f,{},H)],(de[0]>Bc||de[1]>Bc)&&_r(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,X,de,y,d,f,I,e,S.lineStartIndex,S.lineLength,U,H);for(const ze of D)R[ze]=i.text.placedSymbolArray.length-1;return 4*X.length}function i_(i){for(const e in i)return i[e];return null}function vb(i,e,r,a){const c=i.compareText;if(e in c){const d=c[e];for(let f=d.length-1;f>=0;f--)if(a.dist(d[f])<r)return!0}else c[e]=[];return c[e].push(a),!1}const n_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Zf{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=a>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const d=n_[15&a];if(!d)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new Zf(y,f,d,e)}constructor(e,r=64,a=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=n_.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-y%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${a}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+y+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=r,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Wf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:f,nodeSize:y}=this,S=[0,d.length-1,0],I=[];for(;S.length;){const D=S.pop()||0,R=S.pop()||0,U=S.pop()||0;if(R-U<=y){for(let K=U;K<=R;K++){const de=f[2*K],ze=f[2*K+1];de>=e&&de<=a&&ze>=r&&ze<=c&&I.push(d[K])}continue}const q=U+R>>1,H=f[2*q],X=f[2*q+1];H>=e&&H<=a&&X>=r&&X<=c&&I.push(d[q]),(D===0?e<=H:r<=X)&&(S.push(U),S.push(q-1),S.push(1-D)),(D===0?a>=H:c>=X)&&(S.push(q+1),S.push(R),S.push(1-D))}return I}within(e,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:d,nodeSize:f}=this,y=[0,c.length-1,0],S=[],I=a*a;for(;y.length;){const D=y.pop()||0,R=y.pop()||0,U=y.pop()||0;if(R-U<=f){for(let K=U;K<=R;K++)a_(d[2*K],d[2*K+1],e,r)<=I&&S.push(c[K]);continue}const q=U+R>>1,H=d[2*q],X=d[2*q+1];a_(H,X,e,r)<=I&&S.push(c[q]),(D===0?e-a<=H:r-a<=X)&&(y.push(U),y.push(q-1),y.push(1-D)),(D===0?e+a>=H:r+a>=X)&&(y.push(q+1),y.push(R),y.push(1-D))}return S}}function Wf(i,e,r,a,c,d){if(c-a<=r)return;const f=a+c>>1;s_(i,e,f,a,c,d),Wf(i,e,r,a,f-1,1-d),Wf(i,e,r,f+1,c,1-d)}function s_(i,e,r,a,c,d){for(;c>a;){if(c-a>600){const I=c-a+1,D=r-a+1,R=Math.log(I),U=.5*Math.exp(2*R/3),q=.5*Math.sqrt(R*U*(I-U)/I)*(D-I/2<0?-1:1);s_(i,e,r,Math.max(a,Math.floor(r-D*U/I+q)),Math.min(c,Math.floor(r+(I-D)*U/I+q)),d)}const f=e[2*r+d];let y=a,S=c;for(Dh(i,e,a,r),e[2*c+d]>f&&Dh(i,e,a,c);y<S;){for(Dh(i,e,y,S),y++,S--;e[2*y+d]<f;)y++;for(;e[2*S+d]>f;)S--}e[2*a+d]===f?Dh(i,e,a,S):(S++,Dh(i,e,S,c)),S<=r&&(a=S+1),r<=S&&(c=S-1)}}function Dh(i,e,r,a){Hf(i,r,a),Hf(e,2*r,2*a),Hf(e,2*r+1,2*a+1)}function Hf(i,e,r){const a=i[e];i[e]=i[r],i[r]=a}function a_(i,e,r,a){const c=i-r,d=e-a;return c*c+d*d}var Xf;b.cI=void 0,(Xf=b.cI||(b.cI={})).create="create",Xf.load="load",Xf.fullLoad="fullLoad";let wd=null,Fh=[];const Yf=1e3/60,Jf="loadTime",Kf="fullLoadTime",bb={mark(i){performance.mark(i)},frame(i){const e=i;wd!=null&&Fh.push(e-wd),wd=e},clearMetrics(){wd=null,Fh=[],performance.clearMeasures(Jf),performance.clearMeasures(Kf);for(const i in b.cI)performance.clearMarks(b.cI[i])},getPerformanceMetrics(){performance.measure(Jf,b.cI.create,b.cI.load),performance.measure(Kf,b.cI.create,b.cI.fullLoad);const i=performance.getEntriesByName(Jf)[0].duration,e=performance.getEntriesByName(Kf)[0].duration,r=Fh.length,a=1/(Fh.reduce(((d,f)=>d+f),0)/r/1e3),c=Fh.filter((d=>d>Yf)).reduce(((d,f)=>d+(f-Yf)/Yf),0);return{loadTime:i,fullLoadTime:e,fps:a,percentDroppedFrames:c/(r+c)*100,totalFrames:r}}};b.$=re,b.A=Be,b.B=at,b.C=ue,b.D=mr,b.E=ge,b.F=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},b.G=ar,b.H=Kr,b.I=yf,b.J=ve,b.K=function(i){if(br==null){const e=i.navigator?i.navigator.userAgent:null;br=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return br},b.L=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new zv((()=>this.process())),this.subscription=Cr(this.target,"message",(r=>this.receive(r)),!1),this.globalScope=lr(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}unregisterMessageHandler(i){delete this.messageHandlers[i]}sendAsync(i,e){return new Promise(((r,a)=>{const c=Math.round(1e18*Math.random()).toString(36).substring(0,10),d=e?Cr(e.signal,"abort",(()=>{d?.unsubscribe(),delete this.resolveRejects[c];const S={id:c,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(S)}),Nv):null;this.resolveRejects[c]={resolve:S=>{d?.unsubscribe(),r(S)},reject:S=>{d?.unsubscribe(),a(S)}};const f=[],y=Object.assign(Object.assign({},i),{id:c,sourceMapId:this.mapId,origin:location.origin,data:jt(i.data,f)});this.target.postMessage(y,{transfer:f})}))}receive(i){const e=i.data,r=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[r];const a=this.abortControllers[r];return delete this.abortControllers[r],void(a&&a.abort())}if(lr(self)||e.mustQueue)return this.tasks[r]=e,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return s(this,void 0,void 0,(function*(){if(e.type==="<response>"){const c=this.resolveRejects[i];return delete this.resolveRejects[i],c?void(e.error?c.reject(Ut(e.error)):c.resolve(Ut(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=Ut(e.data),a=new AbortController;this.abortControllers[i]=a;try{const c=yield this.messageHandlers[e.type](e.sourceMapId,r,a);this.completeTask(i,null,c)}catch(c){this.completeTask(i,c)}}))}completeTask(i,e,r){const a=[];delete this.abortControllers[i];const c={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?jt(e):null,data:jt(r,a)};this.target.postMessage(c,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},b.M=se,b.N=function(){var i=new Be(16);return Be!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},b.O=function(i,e,r){var a,c,d,f,y,S,I,D,R,U,q,H,X=r[0],K=r[1],de=r[2];return e===i?(i[12]=e[0]*X+e[4]*K+e[8]*de+e[12],i[13]=e[1]*X+e[5]*K+e[9]*de+e[13],i[14]=e[2]*X+e[6]*K+e[10]*de+e[14],i[15]=e[3]*X+e[7]*K+e[11]*de+e[15]):(c=e[1],d=e[2],f=e[3],y=e[4],S=e[5],I=e[6],D=e[7],R=e[8],U=e[9],q=e[10],H=e[11],i[0]=a=e[0],i[1]=c,i[2]=d,i[3]=f,i[4]=y,i[5]=S,i[6]=I,i[7]=D,i[8]=R,i[9]=U,i[10]=q,i[11]=H,i[12]=a*X+y*K+R*de+e[12],i[13]=c*X+S*K+U*de+e[13],i[14]=d*X+I*K+q*de+e[14],i[15]=f*X+D*K+H*de+e[15]),i},b.P=E,b.Q=function(i,e,r){var a=r[0],c=r[1],d=r[2];return i[0]=e[0]*a,i[1]=e[1]*a,i[2]=e[2]*a,i[3]=e[3]*a,i[4]=e[4]*c,i[5]=e[5]*c,i[6]=e[6]*c,i[7]=e[7]*c,i[8]=e[8]*d,i[9]=e[9]*d,i[10]=e[10]*d,i[11]=e[11]*d,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},b.R=va,b.S=function(i,e,r){var a=e[0],c=e[1],d=e[2],f=e[3],y=e[4],S=e[5],I=e[6],D=e[7],R=e[8],U=e[9],q=e[10],H=e[11],X=e[12],K=e[13],de=e[14],ze=e[15],pe=r[0],xe=r[1],je=r[2],Ke=r[3];return i[0]=pe*a+xe*y+je*R+Ke*X,i[1]=pe*c+xe*S+je*U+Ke*K,i[2]=pe*d+xe*I+je*q+Ke*de,i[3]=pe*f+xe*D+je*H+Ke*ze,i[4]=(pe=r[4])*a+(xe=r[5])*y+(je=r[6])*R+(Ke=r[7])*X,i[5]=pe*c+xe*S+je*U+Ke*K,i[6]=pe*d+xe*I+je*q+Ke*de,i[7]=pe*f+xe*D+je*H+Ke*ze,i[8]=(pe=r[8])*a+(xe=r[9])*y+(je=r[10])*R+(Ke=r[11])*X,i[9]=pe*c+xe*S+je*U+Ke*K,i[10]=pe*d+xe*I+je*q+Ke*de,i[11]=pe*f+xe*D+je*H+Ke*ze,i[12]=(pe=r[12])*a+(xe=r[13])*y+(je=r[14])*R+(Ke=r[15])*X,i[13]=pe*c+xe*S+je*U+Ke*K,i[14]=pe*d+xe*I+je*q+Ke*de,i[15]=pe*f+xe*D+je*H+Ke*ze,i},b.T=cf,b.U=function(i,e){const r={};for(let a=0;a<e.length;a++){const c=e[a];c in i&&(r[c]=i[c])}return r},b.V=Oc,b.W=ut,b.X=ig,b.Y=rg,b.Z=Qe,b._=s,b.a=xr,b.a$=rt,b.a0=ye,b.a1=zr,b.a2=so,b.a3=sg,b.a4=ud,b.a5=gt,b.a6=function(i,e,r){if(!i)return e||{};if(!e)return i||{};const a=cg(i),c=cg(e);(function(f,y){y.removeAll&&(f.add.clear(),f.update.clear(),f.remove.clear(),y.remove.clear());for(const S of y.remove)f.add.delete(S),f.update.delete(S);for(const[S,I]of y.update){const D=f.update.get(S);D&&(y.update.set(S,Rv(D,I)),f.update.delete(S))}})(a,c);const d={};if((a.removeAll||c.removeAll)&&(d.removeAll=!0),d.remove=new Set([...a.remove,...c.remove]),d.add=new Map([...a.add,...c.add]),d.update=new Map([...a.update,...c.update]),d.remove.size&&d.add.size)for(const f of d.add.keys())d.remove.delete(f);return(function(f){const y={};return f.removeAll&&(y.removeAll=f.removeAll),f.remove&&(y.remove=Array.from(f.remove)),f.add&&(y.add=Array.from(f.add.values())),f.update&&(y.update=Array.from(f.update.values())),y})(d)},b.a7=function(i,e){const r=new Map;if(i==null||i.type==null)return r;if(i.type==="Feature"){const a=If(i,e);return a==null?void 0:(r.set(a,i),r)}if(i.type==="FeatureCollection"){const a=new Set;for(const c of i.features){const d=If(c,e);if(d==null||a.has(d))return;a.add(d),r.set(d,c)}return r}},b.a8=function(i,e,r){var a,c;const d=[];if(e.removeAll)i.clear();else if(e.remove)for(const f of e.remove){const y=i.get(f);y&&(d.push(y.geometry),i.delete(f))}if(e.add)for(const f of e.add){const y=If(f,r);if(y==null)continue;const S=i.get(y);S&&d.push(S.geometry),d.push(f.geometry),i.set(y,f)}if(e.update)for(const f of e.update){const y=i.get(f.id);if(!y)continue;const S=!!f.newGeometry,I=f.removeAllProperties||((a=f.removeProperties)===null||a===void 0?void 0:a.length)>0||((c=f.addOrUpdateProperties)===null||c===void 0?void 0:c.length)>0;if(!S&&!I)continue;d.push(y.geometry);const D=Object.assign({},y);if(i.set(f.id,D),S&&(d.push(f.newGeometry),D.geometry=f.newGeometry),I){if(D.properties=f.removeAllProperties?{}:Object.assign({},D.properties||{}),f.removeProperties)for(const R of f.removeProperties)delete D.properties[R];if(f.addOrUpdateProperties)for(const{key:R,value:U}of f.addOrUpdateProperties)D.properties[R]=U}}return d},b.a9=Ch,b.aA=function(i,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:c}){return i.kind==="source"?a/pc:i.kind==="composite"?ar.number(a/pc,c/pc,r):e},b.aB=function(i,e){var r=e[0],a=e[1],c=e[2],d=e[3],f=e[4],y=e[5],S=e[6],I=e[7],D=e[8],R=e[9],U=e[10],q=e[11],H=e[12],X=e[13],K=e[14],de=e[15],ze=r*y-a*f,pe=r*S-c*f,xe=r*I-d*f,je=a*S-c*y,Ke=a*I-d*y,bt=c*I-d*S,Bt=D*X-R*H,Nt=D*K-U*H,qt=D*de-q*H,ir=R*K-U*X,Kt=R*de-q*X,Ft=U*de-q*K,Et=ze*Ft-pe*Kt+xe*ir+je*qt-Ke*Nt+bt*Bt;return Et?(i[0]=(y*Ft-S*Kt+I*ir)*(Et=1/Et),i[1]=(c*Kt-a*Ft-d*ir)*Et,i[2]=(X*bt-K*Ke+de*je)*Et,i[3]=(U*Ke-R*bt-q*je)*Et,i[4]=(S*qt-f*Ft-I*Nt)*Et,i[5]=(r*Ft-c*qt+d*Nt)*Et,i[6]=(K*xe-H*bt-de*pe)*Et,i[7]=(D*bt-U*xe+q*pe)*Et,i[8]=(f*Kt-y*qt+I*Bt)*Et,i[9]=(a*qt-r*Kt-d*Bt)*Et,i[10]=(H*Ke-X*xe+de*ze)*Et,i[11]=(R*xe-D*Ke-q*ze)*Et,i[12]=(y*Nt-f*ir-S*Bt)*Et,i[13]=(r*ir-a*Nt+c*Bt)*Et,i[14]=(X*pe-H*je-K*ze)*Et,i[15]=(D*je-R*pe+U*ze)*Et,i):null},b.aC=yt,b.aD=function(i){var e=i[0],r=i[1];return Math.sqrt(e*e+r*r)},b.aE=function(i){return i[0]=0,i[1]=0,i},b.aF=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i},b.aG=xf,b.aH=Ye,b.aI=function(i,e,r,a){const c=e.y-i.y,d=e.x-i.x,f=a.y-r.y,y=a.x-r.x,S=f*d-y*c;if(S===0)return null;const I=(y*(i.y-r.y)-f*(i.x-r.x))/S;return new E(i.x+I*d,i.y+I*c)},b.aJ=Gg,b.aK=zu,b.aL=function(i){let e=1/0,r=1/0,a=-1/0,c=-1/0;for(const d of i)e=Math.min(e,d.x),r=Math.min(r,d.y),a=Math.max(a,d.x),c=Math.max(c,d.y);return[e,r,a,c]},b.aM=Kn,b.aN=Qt,b.aO=function(i,e,r,a,c=!1){if(!r[0]&&!r[1])return[0,0];const d=c?a==="map"?-i.bearingInRadians:0:a==="viewport"?i.bearingInRadians:0;if(d){const f=Math.sin(d),y=Math.cos(d);r=[r[0]*y-r[1]*f,r[0]*f+r[1]*y]}return[c?r[0]:Qt(e,r[0],i.zoom),c?r[1]:Qt(e,r[1],i.zoom)]},b.aQ=bf,b.aR=$f,b.aS=vf,b.aT=Zf,b.aU=xi,b.aV=nd,b.aW=be,b.aX=nr,b.aY=Pt,b.aZ=Gr,b.a_=ag,b.aa=pu,b.ab=25,b.ac=Af,b.ad=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((r=>{e.onloadstart=()=>{r(e)};for(const a of i){const c=window.document.createElement("source");Y(a)||(e.crossOrigin="Anonymous"),c.src=a,e.appendChild(c)}}))},b.ae=Lt,b.af=function(){return It++},b.ag=h,b.ah=qu,b.ai=kh,b.aj=Jo,b.ak=Bl,b.al=hg,b.am=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((r,a,c,d)=>{const f=c||d;return e[a]=!f||f.toLowerCase(),""})),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},b.an=nt,b.ao=85.051129,b.ap=li,b.aq=function(i){return Math.pow(2,i)},b.ar=Ue,b.as=ng,b.at=function(i){return Math.log(i)/Math.LN2},b.au=function(i){var e=i[0],r=i[1];return e*e+r*r},b.av=function(i){if(!i.length)return new Set;const e=Math.max(...i.map((S=>S.canonical.z)));let r=1/0,a=-1/0,c=1/0,d=-1/0;const f=[];for(const S of i){const{x:I,y:D,z:R}=S.canonical,U=Math.pow(2,e-R),q=I*U,H=D*U;f.push({id:S,x:q,y:H}),q<r&&(r=q),q>a&&(a=q),H<c&&(c=H),H>d&&(d=H)}const y=new Set;for(const S of f)S.x!==r&&S.x!==a&&S.y!==c&&S.y!==d||y.add(S.id);return y},b.aw=function(i,e){const r=Math.abs(2*i.wrap)-+(i.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||a-r||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x},b.ax=class{constructor(i,e){this.max=i,this.onRemove=e,this.reset()}reset(){for(const i in this.data)for(const e of this.data[i])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(i,e,r){const a=i.wrapped().key;this.data[a]===void 0&&(this.data[a]=[]);const c={value:e,timeout:void 0};if(r!==void 0&&(c.timeout=setTimeout((()=>{this.remove(i,c)}),r)),this.data[a].push(c),this.order.push(a),this.order.length>this.max){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const e=this.data[i].shift();return e.timeout&&clearTimeout(e.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),e.value}getByKey(i){const e=this.data[i];return e?e[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,e){if(!this.has(i))return this;const r=i.wrapped().key,a=e===void 0?0:this.data[r].indexOf(e),c=this.data[r][a];return this.data[r].splice(a,1),c.timeout&&clearTimeout(c.timeout),this.data[r].length===0&&delete this.data[r],this.onRemove(c.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(i){const e=[];for(const r in this.data)for(const a of this.data[r])i(a.value)||e.push(a);for(const r of e)this.remove(r.value.tileID,r)}},b.ay=function(i,e){let r=0,a=0;if(i.kind==="constant")a=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:c,minZoom:d,maxZoom:f}=i,y=c?nt(Rt.interpolationFactor(c,e,d,f),0,1):0;i.kind==="camera"?a=ar.number(i.minSize,i.maxSize,y):r=y}return{uSizeT:r,uSize:a}},b.b=Tr,b.b$=dc,b.b0=Pe,b.b1=function(i){var e=new Be(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},b.b2=function(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i},b.b3=function(i,e){var r=e[0],a=e[1],c=e[2],d=r*r+a*a+c*c;return d>0&&(d=1/Math.sqrt(d)),i[0]=e[0]*d,i[1]=e[1]*d,i[2]=e[2]*d,i},b.b4=_e,b.b5=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},b.b6=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},b.b7=st,b.b8=function(i,e,r){const a=e[0]*r[0]+e[1]*r[1]+e[2]*r[2];return a===0?null:(-(i[0]*r[0]+i[1]*r[1]+i[2]*r[2])-r[3])/a},b.b9=Ge,b.bA=function(){return new Float64Array(3)},b.bB=kt,b.bC=function(i,e,r){var a=r[0],c=r[1],d=r[2],f=r[3],y=e[0],S=e[1],I=e[2],D=c*I-d*S,R=d*y-a*I,U=a*S-c*y;return i[0]=y+f*(D+=D)+c*(U+=U)-d*(R+=R),i[1]=S+f*R+d*D-a*U,i[2]=I+f*U+a*R-c*D,i},b.bD=function(i,e,r){const a=(c=[i[0],i[1],i[2],e[0],e[1],e[2],r[0],r[1],r[2]])[0]*((D=c[8])*(f=c[4])-(y=c[5])*(I=c[7]))+c[1]*(-D*(d=c[3])+y*(S=c[6]))+c[2]*(I*d-f*S);var c,d,f,y,S,I,D;if(a===0)return null;const R=_e([],[e[0],e[1],e[2]],[r[0],r[1],r[2]]),U=_e([],[r[0],r[1],r[2]],[i[0],i[1],i[2]]),q=_e([],[i[0],i[1],i[2]],[e[0],e[1],e[2]]),H=rt([],R,-i[3]);return Pe(H,H,rt([],U,-e[3])),Pe(H,H,rt([],q,-r[3])),rt(H,H,1/a),H},b.bE=Pf,b.bF=function(){return new Float64Array(4)},b.bG=function(i,e,r,a){var c=[],d=[];return c[0]=e[0]-r[0],c[1]=e[1]-r[1],c[2]=e[2]-r[2],d[0]=c[0]*Math.cos(a)-c[1]*Math.sin(a),d[1]=c[0]*Math.sin(a)+c[1]*Math.cos(a),d[2]=c[2],i[0]=d[0]+r[0],i[1]=d[1]+r[1],i[2]=d[2]+r[2],i},b.bH=function(i,e,r,a){var c=[],d=[];return c[0]=e[0]-r[0],c[1]=e[1]-r[1],c[2]=e[2]-r[2],d[0]=c[0],d[1]=c[1]*Math.cos(a)-c[2]*Math.sin(a),d[2]=c[1]*Math.sin(a)+c[2]*Math.cos(a),i[0]=d[0]+r[0],i[1]=d[1]+r[1],i[2]=d[2]+r[2],i},b.bI=function(i,e,r,a){var c=[],d=[];return c[0]=e[0]-r[0],c[1]=e[1]-r[1],c[2]=e[2]-r[2],d[0]=c[2]*Math.sin(a)+c[0]*Math.cos(a),d[1]=c[1],d[2]=c[2]*Math.cos(a)-c[0]*Math.sin(a),i[0]=d[0]+r[0],i[1]=d[1]+r[1],i[2]=d[2]+r[2],i},b.bJ=function(i,e,r){var a=Math.sin(r),c=Math.cos(r),d=e[0],f=e[1],y=e[2],S=e[3],I=e[8],D=e[9],R=e[10],U=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=d*c-I*a,i[1]=f*c-D*a,i[2]=y*c-R*a,i[3]=S*c-U*a,i[8]=d*a+I*c,i[9]=f*a+D*c,i[10]=y*a+R*c,i[11]=S*a+U*c,i},b.bK=function(i,e){const r=Vt(i,360),a=Vt(e,360),c=a-r,d=a>r?c-360:c+360;return Math.abs(c)<Math.abs(d)?c:d},b.bL=function(i){return i[0]=0,i[1]=0,i[2]=0,i},b.bM=function(i,e,r,a){const c=Math.sqrt(i*i+e*e),d=Math.sqrt(r*r+a*a);i/=c,e/=c,r/=d,a/=d;const f=Math.acos(i*r+e*a);return-e*r+i*a>0?f:-f},b.bN=function(i,e){const r=Vt(i,2*Math.PI),a=Vt(e,2*Math.PI);return Math.min(Math.abs(r-a),Math.abs(r-a+2*Math.PI),Math.abs(r-a-2*Math.PI))},b.bO=function(){const i={},e=ie.$version;for(const r in ie.$root){const a=ie.$root[r];if(a.required){let c=null;c=r==="version"?e:a.type==="array"?[]:{},c!=null&&(i[r]=c)}}return i},b.bP=Oe,b.bQ=tr,b.bR=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let a=0;a<e.length;a++)if(!i(e[a],r[a]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const a in e)if(!i(e[a],r[a]))return!1;return!0}return e===r},b.bS=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=Mt(i[r],e[i[r].ref]));return i},b.bT=function(i,e){if(i.type==="custom")return new Fv(i,e);switch(i.type){case"background":return new Dv(i,e);case"circle":return new _1(i,e);case"color-relief":return new S1(i,e);case"fill":return new B1(i,e);case"fill-extrusion":return new Y1(i,e);case"heatmap":return new v1(i,e);case"hillshade":return new x1(i,e);case"line":return new iv(i,e);case"raster":return new vs(i,e);case"symbol":return new cd(i,e)}},b.bU=i=>i.type==="raster",b.bV=sr,b.bW=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let r=[];try{if(!ct(i.version,e.version))return[{command:"setStyle",args:[e]}];ct(i.center,e.center)||r.push({command:"setCenter",args:[e.center]}),ct(i.state,e.state)||r.push({command:"setGlobalState",args:[e.state]}),ct(i.centerAltitude,e.centerAltitude)||r.push({command:"setCenterAltitude",args:[e.centerAltitude]}),ct(i.zoom,e.zoom)||r.push({command:"setZoom",args:[e.zoom]}),ct(i.bearing,e.bearing)||r.push({command:"setBearing",args:[e.bearing]}),ct(i.pitch,e.pitch)||r.push({command:"setPitch",args:[e.pitch]}),ct(i.roll,e.roll)||r.push({command:"setRoll",args:[e.roll]}),ct(i.sprite,e.sprite)||r.push({command:"setSprite",args:[e.sprite]}),ct(i.glyphs,e.glyphs)||r.push({command:"setGlyphs",args:[e.glyphs]}),ct(i.transition,e.transition)||r.push({command:"setTransition",args:[e.transition]}),ct(i.light,e.light)||r.push({command:"setLight",args:[e.light]}),ct(i.terrain,e.terrain)||r.push({command:"setTerrain",args:[e.terrain]}),ct(i.sky,e.sky)||r.push({command:"setSky",args:[e.sky]}),ct(i.projection,e.projection)||r.push({command:"setProjection",args:[e.projection]});const a={},c=[];(function(f,y,S,I){let D;for(D in y=y||{},f=f||{})Object.prototype.hasOwnProperty.call(f,D)&&(Object.prototype.hasOwnProperty.call(y,D)||Ct(D,S,I));for(D in y)Object.prototype.hasOwnProperty.call(y,D)&&(Object.prototype.hasOwnProperty.call(f,D)?ct(f[D],y[D])||(f[D].type==="geojson"&&y[D].type==="geojson"&&Gt(f,y,D)?dt(S,{command:"setGeoJSONSourceData",args:[D,y[D].data]}):Ht(D,y,S,I)):Dt(D,y,S))})(i.sources,e.sources,c,a);const d=[];i.layers&&i.layers.forEach((f=>{"source"in f&&a[f.source]?r.push({command:"removeLayer",args:[f.id]}):d.push(f)})),r=r.concat(c),(function(f,y,S){y=y||[];const I=(f=f||[]).map(vr),D=y.map(vr),R=f.reduce(Nr,{}),U=y.reduce(Nr,{}),q=I.slice(),H=Object.create(null);let X,K,de,ze,pe;for(let xe=0,je=0;xe<I.length;xe++)X=I[xe],Object.prototype.hasOwnProperty.call(U,X)?je++:(dt(S,{command:"removeLayer",args:[X]}),q.splice(q.indexOf(X,je),1));for(let xe=0,je=0;xe<D.length;xe++)X=D[D.length-1-xe],q[q.length-1-xe]!==X&&(Object.prototype.hasOwnProperty.call(R,X)?(dt(S,{command:"removeLayer",args:[X]}),q.splice(q.lastIndexOf(X,q.length-je),1)):je++,ze=q[q.length-xe],dt(S,{command:"addLayer",args:[U[X],ze]}),q.splice(q.length-xe,0,X),H[X]=!0);for(let xe=0;xe<D.length;xe++)if(X=D[xe],K=R[X],de=U[X],!H[X]&&!ct(K,de))if(ct(K.source,de.source)&&ct(K["source-layer"],de["source-layer"])&&ct(K.type,de.type)){for(pe in dr(K.layout,de.layout,S,X,null,"setLayoutProperty"),dr(K.paint,de.paint,S,X,null,"setPaintProperty"),ct(K.filter,de.filter)||dt(S,{command:"setFilter",args:[X,de.filter]}),ct(K.minzoom,de.minzoom)&&ct(K.maxzoom,de.maxzoom)||dt(S,{command:"setLayerZoomRange",args:[X,de.minzoom,de.maxzoom]}),K)Object.prototype.hasOwnProperty.call(K,pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&(pe.indexOf("paint.")===0?dr(K[pe],de[pe],S,X,pe.slice(6),"setPaintProperty"):ct(K[pe],de[pe])||dt(S,{command:"setLayerProperty",args:[X,pe,de[pe]]}));for(pe in de)Object.prototype.hasOwnProperty.call(de,pe)&&!Object.prototype.hasOwnProperty.call(K,pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&(pe.indexOf("paint.")===0?dr(K[pe],de[pe],S,X,pe.slice(6),"setPaintProperty"):ct(K[pe],de[pe])||dt(S,{command:"setLayerProperty",args:[X,pe,de[pe]]}))}else dt(S,{command:"removeLayer",args:[X]}),ze=q[q.lastIndexOf(X)+1],dt(S,{command:"addLayer",args:[de,ze]})})(d,e.layers,r)}catch(a){console.warn("Unable to compute style diff:",a),r=[{command:"setStyle",args:[e]}]}return r},b.bX=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},b.bY=zt,b.bZ=Zt,b.b_=class extends ea{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},b.ba=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i},b.bb=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]},b.bc=lg,b.bd=Gu,b.be=function(i,e,r,a,c){var d=1/Math.tan(e/2);if(i[0]=d/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=d,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,c!=null&&c!==1/0){var f=1/(a-c);i[10]=(c+a)*f,i[14]=2*c*a*f}else i[10]=-1,i[14]=-2*a;return i},b.bf=function(i){var e=new Be(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},b.bg=function(i,e,r){var a=Math.sin(r),c=Math.cos(r),d=e[0],f=e[1],y=e[2],S=e[3],I=e[4],D=e[5],R=e[6],U=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=d*c+I*a,i[1]=f*c+D*a,i[2]=y*c+R*a,i[3]=S*c+U*a,i[4]=I*c-d*a,i[5]=D*c-f*a,i[6]=R*c-y*a,i[7]=U*c-S*a,i},b.bh=function(i,e,r){var a=Math.sin(r),c=Math.cos(r),d=e[4],f=e[5],y=e[6],S=e[7],I=e[8],D=e[9],R=e[10],U=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=d*c+I*a,i[5]=f*c+D*a,i[6]=y*c+R*a,i[7]=S*c+U*a,i[8]=I*c-d*a,i[9]=D*c-f*a,i[10]=R*c-y*a,i[11]=U*c-S*a,i},b.bi=function(){const i=new Float32Array(16);return Ue(i),i},b.bj=function(){const i=new Float64Array(16);return Ue(i),i},b.bk=function(){return new Float64Array(16)},b.bl=function(i,e,r){const a=new Float64Array(4);return kt(a,i,e-90,r),a},b.bm=function(i,e,r,a){var c,d,f,y,S,I=e[0],D=e[1],R=e[2],U=e[3],q=r[0],H=r[1],X=r[2],K=r[3];return(d=I*q+D*H+R*X+U*K)<0&&(d=-d,q=-q,H=-H,X=-X,K=-K),1-d>Je?(c=Math.acos(d),f=Math.sin(c),y=Math.sin((1-a)*c)/f,S=Math.sin(a*c)/f):(y=1-a,S=a),i[0]=y*I+S*q,i[1]=y*D+S*H,i[2]=y*R+S*X,i[3]=y*U+S*K,i},b.bn=function(i){const e=new Float64Array(9);var r,a,c,d,f,y,S,I,D,R,U,q,H,X,K,de,ze,pe;R=(c=(a=i)[0])*(S=c+c),U=(d=a[1])*S,H=(f=a[2])*S,X=f*(I=d+d),de=(y=a[3])*S,ze=y*I,pe=y*(D=f+f),(r=e)[0]=1-(q=d*I)-(K=f*D),r[3]=U-pe,r[6]=H+ze,r[1]=U+pe,r[4]=1-R-K,r[7]=X-de,r[2]=H-ze,r[5]=X+de,r[8]=1-R-q;const xe=Gr(-Math.asin(nt(e[2],-1,1)));let je,Ke;return Math.hypot(e[5],e[8])<.001?(je=0,Ke=-Gr(Math.atan2(e[3],e[4]))):(je=Gr(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),Ke=Gr(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:je,pitch:xe+90,bearing:Ke}},b.bo=function(i,e){return i.roll==e.roll&&i.pitch==e.pitch&&i.bearing==e.bearing},b.bp=Ur,b.bq=hc,b.br=ju,b.bs=Sh,b.bt=Ou,b.bu=fe,b.bv=Fe,b.bw=Un,b.bx=function(i,e,r,a,c){return fe(a,c,nt((i-e)/(r-e),0,1))},b.by=function(i,e,r,a){return i[0]=e[0]+r[0]*a,i[1]=e[1]+r[1]*a,i[2]=e[2]+r[2]*a,i},b.bz=Vt,b.c=W,b.c$=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},b.c0=class extends ea{constructor(i,e){super(i,e),this.current=Ba}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},b.c1=hu,b.c2=class extends ea{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},b.c3=class extends ea{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},b.c4=De,b.c5=function(i,e){var r=Math.sin(e),a=Math.cos(e);return i[0]=a,i[1]=r,i[2]=0,i[3]=-r,i[4]=a,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},b.c6=function(i,e,r){var a=e[0],c=e[1],d=e[2];return i[0]=a*r[0]+c*r[3]+d*r[6],i[1]=a*r[1]+c*r[4]+d*r[7],i[2]=a*r[2]+c*r[5]+d*r[8],i},b.c7=function(i,e,r,a,c,d,f){var y=1/(e-r),S=1/(a-c),I=1/(d-f);return i[0]=-2*y,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*S,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*I,i[11]=0,i[12]=(e+r)*y,i[13]=(c+a)*S,i[14]=(f+d)*I,i[15]=1,i},b.c8=class extends ea{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(4*i.length);for(let r=0;r<i.length;r++)e[4*r]=i[r].r,e[4*r+1]=i[r].g,e[4*r+2]=i[r].b,e[4*r+3]=i[r].a;this.gl.uniform4fv(this.location,e)}}},b.c9=class extends ea{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(i);this.gl.uniform1fv(this.location,e)}}},b.cA=function(i,e){var r;if(!ni[e])return!1;const a=i?.target,c=((r=a?.ownerDocument)===null||r===void 0?void 0:r.defaultView)||window;return i instanceof c.MouseEvent||i instanceof c.WheelEvent},b.cB=function(i,e){return Vr[e]&&"touches"in i},b.cC=function(i){return Vr[i]||ni[i]},b.cD=function(i,e,r){var a=e[0],c=e[1];return i[0]=r[0]*a+r[4]*c+r[12],i[1]=r[1]*a+r[5]*c+r[13],i},b.cE=function(i,e){const{x:r,y:a}=Ch.fromLngLat(e);return!(i<0||i>25||a<0||a>=1||r<0||r>=1)},b.cF=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},b.cG=class extends Tn{},b.cH=bb,b.cJ=Ce,b.cK=function(i,e){W.REGISTERED_PROTOCOLS[i]=e},b.cL=function(i){delete W.REGISTERED_PROTOCOLS[i]},b.cM=function(i,e){const r={};for(let c=0;c<i.length;c++){const d=e&&e[i[c].id]||eo(i[c]);e&&(e[i[c].id]=d);let f=r[d];f||(f=r[d]=[]),f.push(i[c])}const a=[];for(const c in r)a.push(r[c]);return a},b.cN=Ve,b.cO=ug,b.cP=Ug,b.cQ=$m,b.cR=function(i){var e;i.bucket.createArrays(),i.bucket.tilePixelRatio=gt/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const r=i.bucket.layers[0],a=r.layout,c=r._unevaluatedLayout._values,d={layoutIconSize:c["icon-size"].possiblyEvaluate(new Kr(i.bucket.zoom+1),i.canonical),layoutTextSize:c["text-size"].possiblyEvaluate(new Kr(i.bucket.zoom+1),i.canonical),textMaxSize:c["text-size"].possiblyEvaluate(new Kr(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:D,maxZoom:R}=i.bucket.textSizeData;d.compositeTextSizes=[c["text-size"].possiblyEvaluate(new Kr(D),i.canonical),c["text-size"].possiblyEvaluate(new Kr(R),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:D,maxZoom:R}=i.bucket.iconSizeData;d.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new Kr(D),i.canonical),c["icon-size"].possiblyEvaluate(new Kr(R),i.canonical)]}const f=a.get("text-line-height")*Kn,y=a.get("text-rotation-alignment")!=="viewport"&&a.get("symbol-placement")!=="point",S=a.get("text-keep-upright"),I=a.get("text-size");for(const D of i.bucket.features){const R=a.get("text-font").evaluate(D,{},i.canonical).join(","),U=I.evaluate(D,{},i.canonical),q=d.layoutTextSize.evaluate(D,{},i.canonical),H=d.layoutIconSize.evaluate(D,{},i.canonical),X={horizontal:{},vertical:void 0},K=D.text;let de,ze=[0,0];if(K){const je=K.toString(),Ke=a.get("text-letter-spacing").evaluate(D,{},i.canonical)*Kn,bt=Mr(je)?Ke:0,Bt=a.get("text-anchor").evaluate(D,{},i.canonical),Nt=t_(r,D,i.canonical);if(!Nt){const Ft=a.get("text-radial-offset").evaluate(D,{},i.canonical);ze=Ft?e_(Bt,[Ft*Kn,Gf]):a.get("text-offset").evaluate(D,{},i.canonical).map((Et=>Et*Kn))}let qt=y?"center":a.get("text-justify").evaluate(D,{},i.canonical);const ir=a.get("symbol-placement")==="point"?a.get("text-max-width").evaluate(D,{},i.canonical)*Kn:1/0,Kt=()=>{i.bucket.allowVerticalPlacement&&Yr(je)&&(X.vertical=od(K,i.glyphMap,i.glyphPositions,i.imagePositions,R,ir,f,Bt,"left",bt,ze,b.az.vertical,!0,q,U))};if(!y&&Nt){const Ft=new Set;if(qt==="auto")for(let hr=0;hr<Nt.values.length;hr+=2)Ft.add($f(Nt.values[hr]));else Ft.add(qt);let Et=!1;for(const hr of Ft)if(!X.horizontal[hr])if(Et)X.horizontal[hr]=X.horizontal[0];else{const or=od(K,i.glyphMap,i.glyphPositions,i.imagePositions,R,ir,f,"center",hr,bt,ze,b.az.horizontal,!1,q,U);or&&(X.horizontal[hr]=or,Et=or.positionedLines.length===1)}Kt()}else{qt==="auto"&&(qt=$f(Bt));const Ft=od(K,i.glyphMap,i.glyphPositions,i.imagePositions,R,ir,f,Bt,qt,bt,ze,b.az.horizontal,!1,q,U);Ft&&(X.horizontal[qt]=Ft),Kt(),Yr(je)&&y&&S&&(X.vertical=od(K,i.glyphMap,i.glyphPositions,i.imagePositions,R,ir,f,Bt,qt,bt,ze,b.az.vertical,!1,q,U))}}let pe=!1;if(D.icon&&D.icon.name){const je=i.imageMap[D.icon.name];je&&(de=Cv(i.imagePositions[D.icon.name],a.get("icon-offset").evaluate(D,{},i.canonical),a.get("icon-anchor").evaluate(D,{},i.canonical)),pe=!!je.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=pe:i.bucket.sdfIcons!==pe&&_r("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(je.pixelRatio!==i.bucket.pixelRatio||a.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const xe=i_(X.horizontal)||X.vertical;(e=i.bucket).iconsInText||(e.iconsInText=!!xe&&xe.iconsInText),(xe||de)&&yb(i.bucket,D,X,de,i.imageMap,d,q,H,ze,pe,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},b.cS=ff,b.cT=mf,b.cU=gf,b.cV=function(i){const e=new ad;return(function(r,a){for(const c in r.layers)a.writeMessage(3,nb,r.layers[c])})(i,e),e.finish()},b.cW=function(i,e,r,a,c,d){let f=$g(i,e,r,c,0);return f=$g(f,e,a,d,1),f},b.cX=class{constructor(i){this.maxEntries=i,this.map=new Map}get(i){const e=this.map.get(i);return e!==void 0&&(this.map.delete(i),this.map.set(i,e)),e}set(i,e){if(this.map.has(i))this.map.delete(i);else if(this.map.size>=this.maxEntries){const r=this.map.keys().next().value;this.map.delete(r)}this.map.set(i,e)}clear(){this.map.clear()}},b.cY=Im,b.cZ=ad,b.c_=jg,b.ca=class extends Mo{},b.cb=ov,b.cc=class extends kl{},b.cd=lf,b.ce=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},b.cf=dm,b.cg=function(i,e,r){var a=e[0],c=e[1],d=e[2],f=r[3]*a+r[7]*c+r[11]*d+r[15];return i[0]=(r[0]*a+r[4]*c+r[8]*d+r[12])/(f=f||1),i[1]=(r[1]*a+r[5]*c+r[9]*d+r[13])/f,i[2]=(r[2]*a+r[6]*c+r[10]*d+r[14])/f,i},b.ch=class extends Il{},b.ci=class extends t{},b.cj=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},b.ck=function(i,e){var r=i[0],a=i[1],c=i[2],d=i[3],f=i[4],y=i[5],S=i[6],I=i[7],D=i[8],R=i[9],U=i[10],q=i[11],H=i[12],X=i[13],K=i[14],de=i[15],ze=e[0],pe=e[1],xe=e[2],je=e[3],Ke=e[4],bt=e[5],Bt=e[6],Nt=e[7],qt=e[8],ir=e[9],Kt=e[10],Ft=e[11],Et=e[12],hr=e[13],or=e[14],gr=e[15];return Math.abs(r-ze)<=Je*Math.max(1,Math.abs(r),Math.abs(ze))&&Math.abs(a-pe)<=Je*Math.max(1,Math.abs(a),Math.abs(pe))&&Math.abs(c-xe)<=Je*Math.max(1,Math.abs(c),Math.abs(xe))&&Math.abs(d-je)<=Je*Math.max(1,Math.abs(d),Math.abs(je))&&Math.abs(f-Ke)<=Je*Math.max(1,Math.abs(f),Math.abs(Ke))&&Math.abs(y-bt)<=Je*Math.max(1,Math.abs(y),Math.abs(bt))&&Math.abs(S-Bt)<=Je*Math.max(1,Math.abs(S),Math.abs(Bt))&&Math.abs(I-Nt)<=Je*Math.max(1,Math.abs(I),Math.abs(Nt))&&Math.abs(D-qt)<=Je*Math.max(1,Math.abs(D),Math.abs(qt))&&Math.abs(R-ir)<=Je*Math.max(1,Math.abs(R),Math.abs(ir))&&Math.abs(U-Kt)<=Je*Math.max(1,Math.abs(U),Math.abs(Kt))&&Math.abs(q-Ft)<=Je*Math.max(1,Math.abs(q),Math.abs(Ft))&&Math.abs(H-Et)<=Je*Math.max(1,Math.abs(H),Math.abs(Et))&&Math.abs(X-hr)<=Je*Math.max(1,Math.abs(X),Math.abs(hr))&&Math.abs(K-or)<=Je*Math.max(1,Math.abs(K),Math.abs(or))&&Math.abs(de-gr)<=Je*Math.max(1,Math.abs(de),Math.abs(gr))},b.cl=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},b.cm=i=>i.type==="symbol",b.cn=i=>i.type==="circle",b.co=i=>i.type==="heatmap",b.cp=i=>i.type==="line",b.cq=i=>i.type==="fill",b.cr=i=>i.type==="fill-extrusion",b.cs=i=>i.type==="hillshade",b.ct=i=>i.type==="color-relief",b.cu=i=>i.type==="background",b.cv=i=>i.type==="custom",b.cw=We,b.cx=function(i,e,r){if(e<=0)return i;const a=1/e;return r===void 0||Math.abs(r)<1e-10?Math.round(i*a)/a:(r>0?Math.ceil(i*a-1e-9):Math.floor(i*a+1e-10))/a},b.cy=function(i,e,r){const a=mt(e.x-r.x,e.y-r.y),c=mt(i.x-r.x,i.y-r.y);var d,f;return Gr(Math.atan2(a[0]*c[1]-a[1]*c[0],(d=a)[0]*(f=c)[0]+d[1]*f[1]))},b.cz=tt,b.d=Y,b.d0=function(i,e,r,a,c){return s(this,void 0,void 0,(function*(){if(ye())try{return yield zr(i,e,r,a,c)}catch{}return(function(d,f,y,S,I){const D=d.width,R=d.height;yr&&Lr||(yr=new OffscreenCanvas(D,R),Lr=yr.getContext("2d",{willReadFrequently:!0})),yr.width=D,yr.height=R,Lr.drawImage(d,0,0,D,R);const U=Lr.getImageData(f,y,S,I);return Lr.clearRect(0,0,D,R),U.data})(i,e,r,a,c)}))},b.d1=mm,b.d2=F,b.d3=class{constructor(i,e){this.layers={[kh]:this},this.name=kh,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=i.length,this.features=i}feature(i){return new ib(this.features[i],this.extent)}},b.d4=Xo,b.d5=bi,b.e=ft,b.f=i=>s(void 0,void 0,void 0,(function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),b.g=te,b.h=i=>new Promise(((e,r)=>{const a=new Image;a.onload=()=>{e(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame((()=>{a.src=Yt}))},a.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(i)],{type:"image/png"});a.src=i.byteLength?URL.createObjectURL(c):Yt})),b.i=lr,b.j=(i,e)=>ht(ft(i,{type:"json"}),e),b.k=le,b.l=ee,b.m=ht,b.n=(i,e)=>ht(ft(i,{type:"arrayBuffer"}),e),b.o=function(i){return new ad(i).readFields(xv,[])},b.p=Gm,b.q=function(i){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))},b.r=yh,b.s=Cr,b.t=Fi,b.u=ie,b.v=oe,b.w=_r,b.x=mn,b.y=me,b.z=Oi})),v("worker",["./shared"],(function(b){class s{constructor(W,te){this.keyCache={},W&&this.replace(W,te)}replace(W,te){this._layerConfigs={},this._layers={},this.update(W,[],te)}update(W,te,se){for(const Oe of W){this._layerConfigs[Oe.id]=Oe;const ht=this._layers[Oe.id]=b.bT(Oe,se);ht._featureFilter=b.aj(ht.filter,se),this.keyCache[Oe.id]&&delete this.keyCache[Oe.id]}for(const Oe of te)delete this.keyCache[Oe],delete this._layerConfigs[Oe],delete this._layers[Oe];this.familiesBySource={};const Ce=b.cM(Object.values(this._layerConfigs),this.keyCache);for(const Oe of Ce){const ht=Oe.map((ge=>this._layers[ge.id])),Y=ht[0];if(Y.isHidden())continue;const P=Y.source||"";let k=this.familiesBySource[P];k||(k=this.familiesBySource[P]={});const ee=Y.sourceLayer||b.ai;let le=k[ee];le||(le=k[ee]=[]),le.push(ht)}}}class E{constructor(W){const te={},se=[];for(const Y in W){const P=W[Y],k=te[Y]={};for(const ee in P){const le=P[+ee];if(!le||le.bitmap.width===0||le.bitmap.height===0)continue;const ge={x:0,y:0,w:le.bitmap.width+2,h:le.bitmap.height+2};se.push(ge),k[ee]={rect:ge,metrics:le.metrics}}}const{w:Ce,h:Oe}=b.p(se),ht=new b.r({width:Ce||1,height:Oe||1});for(const Y in W){const P=W[Y];for(const k in P){const ee=P[+k];if(!ee||ee.bitmap.width===0||ee.bitmap.height===0)continue;const le=te[Y][k].rect;b.r.copy(ee.bitmap,ht,{x:0,y:0},{x:le.x+1,y:le.y+1},ee.bitmap)}}this.image=ht,this.positions=te}}b.cN("GlyphAtlas",E);class F{constructor(W){this.tileID=new b.a2(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId,this.inFlightDependencies=[]}parse(W,te,se,Ce,Oe){return b._(this,void 0,void 0,(function*(){this.status="parsing",this.data=W,this.collisionBoxArray=new b.ag;const ht=new b.cO(Object.keys(W.layers).sort()),Y=new b.cP(this.tileID,this.promoteId);Y.bucketLayerIDs=[];const P={},k={featureIndex:Y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:se,subdivisionGranularity:Oe},ee=te.familiesBySource[this.source];for(const Lt in ee){const wr=W.layers[Lt];if(!wr)continue;wr.version===1&&b.w(`Vector tile source "${this.source}" layer "${Lt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const zi=ht.encode(Lt),fn=[];for(let mi=0;mi<wr.length;mi++){const Xt=wr.feature(mi),Er=Y.getId(Xt,Lt);fn.push({feature:Xt,id:Er,index:mi,sourceLayerIndex:zi})}for(const mi of ee[Lt]){const Xt=mi[0];Xt.source!==this.source&&b.w(`layer.source = ${Xt.source} does not equal this.source = ${this.source}`),Xt.isHidden(this.zoom,!0)||(B(mi,this.zoom,se),(P[Xt.id]=Xt.createBucket({index:Y.bucketLayerIDs.length,layers:mi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:zi,sourceID:this.source})).populate(fn,k,this.tileID.canonical),Y.bucketLayerIDs.push(mi.map((Er=>Er.id))))}}const le=b.bY(k.glyphDependencies,(Lt=>Object.keys(Lt).map(Number)));this.inFlightDependencies.forEach((Lt=>Lt?.abort())),this.inFlightDependencies=[];let ge=Promise.resolve({});if(Object.keys(le).length){const Lt=new AbortController;this.inFlightDependencies.push(Lt),ge=Ce.sendAsync({type:"GG",data:{stacks:le,source:this.source,tileID:this.tileID,type:"glyphs"}},Lt)}const ie=Object.keys(k.iconDependencies);let ot=Promise.resolve({});if(ie.length){const Lt=new AbortController;this.inFlightDependencies.push(Lt),ot=Ce.sendAsync({type:"GI",data:{icons:ie,source:this.source,tileID:this.tileID,type:"icons"}},Lt)}const Mt=Object.keys(k.patternDependencies);let ct=Promise.resolve({});if(Mt.length){const Lt=new AbortController;this.inFlightDependencies.push(Lt),ct=Ce.sendAsync({type:"GI",data:{icons:Mt,source:this.source,tileID:this.tileID,type:"patterns"}},Lt)}const dt=k.dashDependencies;let Dt=Promise.resolve({});if(Object.keys(dt).length){const Lt=new AbortController;this.inFlightDependencies.push(Lt),Dt=Ce.sendAsync({type:"GDA",data:{dashes:dt}},Lt)}const[Ct,Ht,Gt,dr]=yield Promise.all([ge,ot,ct,Dt]),vr=new E(Ct),Nr=new b.cQ(Ht,Gt);for(const Lt in P){const wr=P[Lt];wr instanceof b.ah?(B(wr.layers,this.zoom,se),b.cR({bucket:wr,glyphMap:Ct,glyphPositions:vr.positions,imageMap:Ht,imagePositions:Nr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:k.subdivisionGranularity})):wr.hasDependencies&&(wr instanceof b.cS||wr instanceof b.cT||wr instanceof b.cU)&&(B(wr.layers,this.zoom,se),wr.addFeatures(k,this.tileID.canonical,Nr.patternPositions,dr))}return this.status="done",{buckets:Object.values(P).filter((Lt=>!Lt.isEmpty())),featureIndex:Y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:vr.image,imageAtlas:Nr,dashPositions:dr,glyphMap:this.returnDependencies?Ct:null,iconMap:this.returnDependencies?Ht:null,glyphPositions:this.returnDependencies?vr.positions:null}}))}}function B(Qe,W,te){const se=new b.H(W);for(const Ce of Qe)Ce.recalculate(se,te)}class Q{constructor(W,te,se,Ce,Oe){this.type=W,this.properties=se||{},this.extent=Oe,this.pointsArray=te,this.id=Ce}loadGeometry(){return this.pointsArray.map((W=>W.map((te=>new b.P(te.x,te.y)))))}}class ne{constructor(W,te,se){this.version=2,this._myFeatures=W,this.name=te,this.length=W.length,this.extent=se}feature(W){return this._myFeatures[W]}}class j{constructor(){this.layers={}}addLayer(W){this.layers[W.name]=W}}function Ie(Qe){let W=b.cV(Qe);return W.byteOffset===0&&W.byteLength===W.buffer.byteLength||(W=new Uint8Array(W)),{vectorTile:Qe,rawData:W.buffer}}function he(Qe,W,te){const{extent:se}=Qe,Ce=Math.pow(2,te.z-W.z),Oe=(te.x-W.x*Ce)*se,ht=(te.y-W.y*Ce)*se,Y=[];for(let P=0;P<Qe.length;P++){const k=Qe.feature(P);let ee=k.loadGeometry();for(const ge of ee)for(const ie of ge)ie.x=ie.x*Ce-Oe,ie.y=ie.y*Ce-ht;const le=128;ee=b.cW(ee,k.type,-le,-le,se+le,se+le),ee.length!==0&&Y.push(new Q(k.type,ee,k.properties,k.id,se))}return new ne(Y,Qe.name,se)}class re{constructor(W,te,se){this.actor=W,this.layerIndex=te,this.availableImages=se,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new b.cX(1e3)}loadVectorTile(W,te){return b._(this,void 0,void 0,(function*(){const se=yield b.n(W.request,te);try{return{vectorTile:W.encoding!=="mlt"?new b.cY(new b.cZ(se.data)):new b.c_(se.data),rawData:se.data,cacheControl:se.cacheControl,expires:se.expires}}catch(Ce){const Oe=new Uint8Array(se.data);let ht=`Unable to parse the tile at ${W.request.url}, `;throw ht+=Oe[0]===31&&Oe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Ce.message}`,new Error(ht)}}))}loadTile(W){return b._(this,void 0,void 0,(function*(){const{uid:te,overzoomParameters:se}=W;se&&(W.request=se.overzoomRequest);const Ce=!!(W&&W.request&&W.request.collectResourceTiming)&&new b.c$(W.request),Oe=new F(W);this.loading[te]=Oe;const ht=new AbortController;Oe.abort=ht;try{const Y=yield this.loadVectorTile(W,ht);if(delete this.loading[te],!Y)return null;if(se){const ge=this._getOverzoomTile(W,Y.vectorTile);Y.rawData=ge.rawData,Y.vectorTile=ge.vectorTile}const P=Y.rawData,k={};Y.expires&&(k.expires=Y.expires),Y.cacheControl&&(k.cacheControl=Y.cacheControl);const ee={};if(Ce){const ge=Ce.finish();ge&&(ee.resourceTiming=JSON.parse(JSON.stringify(ge)))}Oe.vectorTile=Y.vectorTile;const le=Oe.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);this.loaded[te]=Oe,this.fetching[te]={rawTileData:P,cacheControl:k,resourceTiming:ee};try{const ge=yield le;return b.e({rawTileData:P.slice(0),encoding:W.encoding},ge,k,ee)}finally{delete this.fetching[te]}}catch(Y){throw delete this.loading[te],Oe.status="done",this.loaded[te]=Oe,Y}}))}_getOverzoomTile(W,te){const{tileID:se,source:Ce,overzoomParameters:Oe}=W,{maxZoomTileID:ht}=Oe,Y=`${ht.key}_${se.key}`,P=this.overzoomedTileResultCache.get(Y);if(P)return P;const k=new j,ee=this.layerIndex.familiesBySource[Ce];for(const ge in ee){const ie=te.layers[ge];if(!ie)continue;const ot=he(ie,ht,se.canonical);ot.length>0&&k.addLayer(ot)}const le=Ie(k);return this.overzoomedTileResultCache.set(Y,le),le}reloadTile(W){return b._(this,void 0,void 0,(function*(){const te=W.uid;if(!this.loaded||!this.loaded[te])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const se=this.loaded[te];if(se.showCollisionBoxes=W.showCollisionBoxes,se.status==="parsing"){const Ce=yield se.parse(se.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);let Oe;if(this.fetching[te]){const{rawTileData:ht,cacheControl:Y,resourceTiming:P}=this.fetching[te];delete this.fetching[te],Oe=b.e({rawTileData:ht.slice(0),encoding:W.encoding},Ce,Y,P)}else Oe=Ce;return Oe}if(se.status==="done"&&se.vectorTile)return se.parse(se.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity)}))}abortTile(W){return b._(this,void 0,void 0,(function*(){const te=this.loading,se=W.uid;te&&te[se]&&te[se].abort&&(te[se].abort.abort(),delete te[se])}))}removeTile(W){return b._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[W.uid]&&delete this.loaded[W.uid]}))}}class ye{constructor(){this.loaded={}}loadTile(W){return b._(this,void 0,void 0,(function*(){const{uid:te,encoding:se,rawImageData:Ce,redFactor:Oe,greenFactor:ht,blueFactor:Y,baseShift:P}=W,k=Ce.width+2,ee=Ce.height+2,le=b.b(Ce)?new b.R({width:k,height:ee},yield b.d0(Ce,-1,-1,k,ee)):Ce,ge=new b.d1(te,le,se,Oe,ht,Y,P);return this.loaded=this.loaded||{},this.loaded[te]=ge,ge}))}removeTile(W){const te=this.loaded,se=W.uid;te&&te[se]&&delete te[se]}}var Je,Be,De=(function(){if(Be)return Je;function Qe(te,se){if(te.length!==0){W(te[0],se);for(var Ce=1;Ce<te.length;Ce++)W(te[Ce],!se)}}function W(te,se){for(var Ce=0,Oe=0,ht=0,Y=te.length,P=Y-1;ht<Y;P=ht++){var k=(te[ht][0]-te[P][0])*(te[P][1]+te[ht][1]),ee=Ce+k;Oe+=Math.abs(Ce)>=Math.abs(k)?Ce-ee+k:k-ee+Ce,Ce=ee}Ce+Oe>=0!=!!se&&te.reverse()}return Be=1,Je=function te(se,Ce){var Oe,ht=se&&se.type;if(ht==="FeatureCollection")for(Oe=0;Oe<se.features.length;Oe++)te(se.features[Oe],Ce);else if(ht==="GeometryCollection")for(Oe=0;Oe<se.geometries.length;Oe++)te(se.geometries[Oe],Ce);else if(ht==="Feature")te(se.geometry,Ce);else if(ht==="Polygon")Qe(se.coordinates,Ce);else if(ht==="MultiPolygon")for(Oe=0;Oe<se.coordinates.length;Oe++)Qe(se.coordinates[Oe],Ce);return se}})(),Ue=b.d2(De);const $e={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Qe=>Qe},st=Math.fround||(Ze=new Float32Array(1),Qe=>(Ze[0]=+Qe,Ze[0]));var Ze;class Pe{constructor(W){this.options=Object.assign(Object.create($e),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:te,minZoom:se,maxZoom:Ce}=this.options;te&&console.time("total time");const Oe=`prepare ${W.length} points`;te&&console.time(Oe),this.points=W;const ht=[];for(let P=0;P<W.length;P++){const k=W[P];if(!k.geometry)continue;const[ee,le]=k.geometry.coordinates,ge=st(we(ee)),ie=st(Ge(le));ht.push(ge,ie,1/0,P,-1,1),this.options.reduce&&ht.push(0)}let Y=this.trees[Ce+1]=this._createTree(ht);te&&console.timeEnd(Oe);for(let P=Ce;P>=se;P--){const k=+Date.now();Y=this.trees[P]=this._createTree(this._cluster(Y,P)),te&&console.log("z%d: %d clusters in %dms",P,Y.numItems,+Date.now()-k)}return te&&console.timeEnd("total time"),this}getClusters(W,te){let se=((W[0]+180)%360+360)%360-180;const Ce=Math.max(-90,Math.min(90,W[1]));let Oe=W[2]===180?180:((W[2]+180)%360+360)%360-180;const ht=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)se=-180,Oe=180;else if(se>Oe){const le=this.getClusters([se,Ce,180,ht],te),ge=this.getClusters([-180,Ce,Oe,ht],te);return le.concat(ge)}const Y=this.trees[this._limitZoom(te)],P=Y.range(we(se),Ge(ht),we(Oe),Ge(Ce)),k=Y.data,ee=[];for(const le of P){const ge=this.stride*le;ee.push(k[ge+5]>1?rt(k,ge,this.clusterProps):this.points[k[ge+3]])}return ee}getChildren(W){const te=this._getOriginId(W),se=this._getOriginZoom(W),Ce="No cluster with the specified id.",Oe=this.trees[se];if(!Oe)throw new Error(Ce);const ht=Oe.data;if(te*this.stride>=ht.length)throw new Error(Ce);const Y=this.options.radius/(this.options.extent*Math.pow(2,se-1)),P=Oe.within(ht[te*this.stride],ht[te*this.stride+1],Y),k=[];for(const ee of P){const le=ee*this.stride;ht[le+4]===W&&k.push(ht[le+5]>1?rt(ht,le,this.clusterProps):this.points[ht[le+3]])}if(k.length===0)throw new Error(Ce);return k}getLeaves(W,te,se){const Ce=[];return this._appendLeaves(Ce,W,te=te||10,se=se||0,0),Ce}getTile(W,te,se){const Ce=this.trees[this._limitZoom(W)],Oe=Math.pow(2,W),{extent:ht,radius:Y}=this.options,P=Y/ht,k=(se-P)/Oe,ee=(se+1+P)/Oe,le={features:[]};return this._addTileFeatures(Ce.range((te-P)/Oe,k,(te+1+P)/Oe,ee),Ce.data,te,se,Oe,le),te===0&&this._addTileFeatures(Ce.range(1-P/Oe,k,1,ee),Ce.data,Oe,se,Oe,le),te===Oe-1&&this._addTileFeatures(Ce.range(0,k,P/Oe,ee),Ce.data,-1,se,Oe,le),le.features.length?le:null}getClusterExpansionZoom(W){let te=this._getOriginZoom(W)-1;for(;te<=this.options.maxZoom;){const se=this.getChildren(W);if(te++,se.length!==1)break;W=se[0].properties.cluster_id}return te}_appendLeaves(W,te,se,Ce,Oe){const ht=this.getChildren(te);for(const Y of ht){const P=Y.properties;if(P&&P.cluster?Oe+P.point_count<=Ce?Oe+=P.point_count:Oe=this._appendLeaves(W,P.cluster_id,se,Ce,Oe):Oe<Ce?Oe++:W.push(Y),W.length===se)break}return Oe}_createTree(W){const te=new b.aT(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let se=0;se<W.length;se+=this.stride)te.add(W[se],W[se+1]);return te.finish(),te.data=W,te}_addTileFeatures(W,te,se,Ce,Oe,ht){for(const Y of W){const P=Y*this.stride,k=te[P+5]>1;let ee,le,ge;if(k)ee=_e(te,P,this.clusterProps),le=te[P],ge=te[P+1];else{const Mt=this.points[te[P+3]];ee=Mt.properties;const[ct,dt]=Mt.geometry.coordinates;le=we(ct),ge=Ge(dt)}const ie={type:1,geometry:[[Math.round(this.options.extent*(le*Oe-se)),Math.round(this.options.extent*(ge*Oe-Ce))]],tags:ee};let ot;ot=k||this.options.generateId?te[P+3]:this.points[te[P+3]].id,ot!==void 0&&(ie.id=ot),ht.features.push(ie)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,te){const{radius:se,extent:Ce,reduce:Oe,minPoints:ht}=this.options,Y=se/(Ce*Math.pow(2,te)),P=W.data,k=[],ee=this.stride;for(let le=0;le<P.length;le+=ee){if(P[le+2]<=te)continue;P[le+2]=te;const ge=P[le],ie=P[le+1],ot=W.within(P[le],P[le+1],Y),Mt=P[le+5];let ct=Mt;for(const dt of ot){const Dt=dt*ee;P[Dt+2]>te&&(ct+=P[Dt+5])}if(ct>Mt&&ct>=ht){let dt,Dt=ge*Mt,Ct=ie*Mt,Ht=-1;const Gt=(le/ee<<5)+(te+1)+this.points.length;for(const dr of ot){const vr=dr*ee;if(P[vr+2]<=te)continue;P[vr+2]=te;const Nr=P[vr+5];Dt+=P[vr]*Nr,Ct+=P[vr+1]*Nr,P[vr+4]=Gt,Oe&&(dt||(dt=this._map(P,le,!0),Ht=this.clusterProps.length,this.clusterProps.push(dt)),Oe(dt,this._map(P,vr)))}P[le+4]=Gt,k.push(Dt/ct,Ct/ct,1/0,Gt,-1,ct),Oe&&k.push(Ht)}else{for(let dt=0;dt<ee;dt++)k.push(P[le+dt]);if(ct>1)for(const dt of ot){const Dt=dt*ee;if(!(P[Dt+2]<=te)){P[Dt+2]=te;for(let Ct=0;Ct<ee;Ct++)k.push(P[Dt+Ct])}}}}return k}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,te,se){if(W[te+5]>1){const ht=this.clusterProps[W[te+6]];return se?Object.assign({},ht):ht}const Ce=this.points[W[te+3]].properties,Oe=this.options.map(Ce);return se&&Oe===Ce?Object.assign({},Oe):Oe}}function rt(Qe,W,te){return{type:"Feature",id:Qe[W+3],properties:_e(Qe,W,te),geometry:{type:"Point",coordinates:[(se=Qe[W],360*(se-.5)),Ye(Qe[W+1])]}};var se}function _e(Qe,W,te){const se=Qe[W+5],Ce=se>=1e4?`${Math.round(se/1e3)}k`:se>=1e3?Math.round(se/100)/10+"k":se,Oe=Qe[W+6],ht=Oe===-1?{}:Object.assign({},te[Oe]);return Object.assign(ht,{cluster:!0,cluster_id:Qe[W+3],point_count:se,point_count_abbreviated:Ce})}function we(Qe){return Qe/360+.5}function Ge(Qe){const W=Math.sin(Qe*Math.PI/180),te=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return te<0?0:te>1?1:te}function Ye(Qe){const W=(180-360*Qe)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function xt(Qe,W,te,se){let Ce=se;const Oe=W+(te-W>>1);let ht,Y=te-W;const P=Qe[W],k=Qe[W+1],ee=Qe[te],le=Qe[te+1];for(let ge=W+3;ge<te;ge+=3){const ie=kt(Qe[ge],Qe[ge+1],P,k,ee,le);if(ie>Ce)ht=ge,Ce=ie;else if(ie===Ce){const ot=Math.abs(ge-Oe);ot<Y&&(ht=ge,Y=ot)}}Ce>se&&(ht-W>3&&xt(Qe,W,ht,se),Qe[ht+2]=Ce,te-ht>3&&xt(Qe,ht,te,se))}function kt(Qe,W,te,se,Ce,Oe){let ht=Ce-te,Y=Oe-se;if(ht!==0||Y!==0){const P=((Qe-te)*ht+(W-se)*Y)/(ht*ht+Y*Y);P>1?(te=Ce,se=Oe):P>0&&(te+=ht*P,se+=Y*P)}return ht=Qe-te,Y=W-se,ht*ht+Y*Y}function yt(Qe,W,te,se){const Ce={type:W,geom:te},Oe={id:Qe??null,type:Ce.type,geometry:Ce.geom,tags:se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};switch(Ce.type){case"Point":case"MultiPoint":case"LineString":mt(Oe,Ce.geom);break;case"Polygon":mt(Oe,Ce.geom[0]);break;case"MultiLineString":for(const ht of Ce.geom)mt(Oe,ht);break;case"MultiPolygon":for(const ht of Ce.geom)mt(Oe,ht[0])}return Oe}function mt(Qe,W){for(let te=0;te<W.length;te+=3)Qe.minX=Math.min(Qe.minX,W[te]),Qe.minY=Math.min(Qe.minY,W[te+1]),Qe.maxX=Math.max(Qe.maxX,W[te]),Qe.maxY=Math.max(Qe.maxY,W[te+1])}function gt(Qe,W){const te=[];switch(Qe.type){case"FeatureCollection":for(let se=0;se<Qe.features.length;se++)Qt(te,Qe.features[se],W,se);break;case"Feature":Qt(te,Qe,W);break;default:Qt(te,{geometry:Qe,properties:void 0},W)}return te}function Qt(Qe,W,te,se){if(!W.geometry)return;if(W.geometry.type==="GeometryCollection"){for(const Y of W.geometry.geometries)Qt(Qe,{id:W.id,geometry:Y,properties:W.properties},te,se);return}if(!W.geometry.coordinates?.length)return;const Oe=Math.pow(te.tolerance/((1<<te.maxZoom)*te.extent),2);let ht=W.id;switch(te.promoteId?ht=W.properties?.[te.promoteId]:te.generateId&&(ht=se||0),W.geometry.type){case"Point":{const Y=[];return Vt(W.geometry.coordinates,Y),void Qe.push(yt(ht,W.geometry.type,Y,W.properties))}case"MultiPoint":{const Y=[];for(const P of W.geometry.coordinates)Vt(P,Y);return void Qe.push(yt(ht,W.geometry.type,Y,W.properties))}case"LineString":{const Y=[];return fe(W.geometry.coordinates,Y,Oe,!1),void Qe.push(yt(ht,W.geometry.type,Y,W.properties))}case"MultiLineString":{if(te.lineMetrics){for(const P of W.geometry.coordinates){const k=[];fe(P,k,Oe,!1),Qe.push(yt(ht,"LineString",k,W.properties))}return}const Y=[];return Fe(W.geometry.coordinates,Y,Oe,!1),void Qe.push(yt(ht,W.geometry.type,Y,W.properties))}case"Polygon":{const Y=[];return Fe(W.geometry.coordinates,Y,Oe,!0),void Qe.push(yt(ht,W.geometry.type,Y,W.properties))}case"MultiPolygon":{const Y=[];for(const P of W.geometry.coordinates){const k=[];Fe(P,k,Oe,!0),Y.push(k)}return void Qe.push(yt(ht,W.geometry.type,Y,W.properties))}default:throw new Error("Input data is not a valid GeoJSON object.")}}function Vt(Qe,W){W.push(We(Qe[0]),tt(Qe[1]),0)}function fe(Qe,W,te,se){let Ce,Oe,ht=0;for(let P=0;P<Qe.length;P++){const k=We(Qe[P][0]),ee=tt(Qe[P][1]);W.push(k,ee,0),P>0&&(ht+=se?(Ce*ee-k*Oe)/2:Math.sqrt(Math.pow(k-Ce,2)+Math.pow(ee-Oe,2))),Ce=k,Oe=ee}const Y=W.length-3;W[2]=1,te>0&&xt(W,0,Y,te),W[Y+2]=1,W.size=Math.abs(ht),W.start=0,W.end=W.size}function Fe(Qe,W,te,se){for(let Ce=0;Ce<Qe.length;Ce++){const Oe=[];fe(Qe[Ce],Oe,te,se),W.push(Oe)}}function We(Qe){return Qe/360+.5}function tt(Qe){const W=Math.sin(Qe*Math.PI/180),te=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return te<0?0:te>1?1:te}function nt(Qe,W,te,se,Ce,Oe,ht,Y){if(se/=W,Oe>=(te/=W)&&ht<se)return Qe;if(ht<te||Oe>=se)return null;const P=[];for(const k of Qe){const ee=Ce===0?k.minX:k.minY,le=Ce===0?k.maxX:k.maxY;if(ee>=te&&le<se)P.push(k);else if(!(le<te||ee>=se))switch(k.type){case"Point":case"MultiPoint":{const ge=[];if(ut(k.geometry,ge,te,se,Ce),!ge.length)continue;P.push(yt(k.id,ge.length===3?"Point":"MultiPoint",ge,k.tags));continue}case"LineString":{const ge=[];if(ft(k.geometry,ge,te,se,Ce,!1,Y.lineMetrics),!ge.length)continue;if(Y.lineMetrics){for(const ie of ge)P.push(yt(k.id,k.type,ie,k.tags));continue}if(ge.length>1){P.push(yt(k.id,"MultiLineString",ge,k.tags));continue}P.push(yt(k.id,k.type,ge[0],k.tags));continue}case"MultiLineString":{const ge=[];if(zt(k.geometry,ge,te,se,Ce,!1),!ge.length)continue;if(ge.length===1){P.push(yt(k.id,"LineString",ge[0],k.tags));continue}P.push(yt(k.id,k.type,ge,k.tags));continue}case"Polygon":{const ge=[];if(zt(k.geometry,ge,te,se,Ce,!0),!ge.length)continue;P.push(yt(k.id,k.type,ge,k.tags));continue}case"MultiPolygon":{const ge=[];for(const ie of k.geometry){const ot=[];zt(ie,ot,te,se,Ce,!0),ot.length&&ge.push(ot)}if(!ge.length)continue;P.push(yt(k.id,k.type,ge,k.tags));continue}}}return P.length?P:null}function ut(Qe,W,te,se,Ce){for(let Oe=0;Oe<Qe.length;Oe+=3){const ht=Qe[Oe+Ce];ht>=te&&ht<=se&&Zt(W,Qe[Oe],Qe[Oe+1],Qe[Oe+2])}}function ft(Qe,W,te,se,Ce,Oe,ht){let Y=It(Qe);const P=Ce===0?sr:ur;let k,ee,le=Qe.start;for(let ct=0;ct<Qe.length-3;ct+=3){const dt=Qe[ct],Dt=Qe[ct+1],Ct=Qe[ct+2],Ht=Qe[ct+3],Gt=Qe[ct+4],dr=Ce===0?dt:Dt,vr=Ce===0?Ht:Gt;let Nr=!1;ht&&(k=Math.sqrt(Math.pow(dt-Ht,2)+Math.pow(Dt-Gt,2))),dr<te?vr>te&&(ee=P(Y,dt,Dt,Ht,Gt,te),ht&&(Y.start=le+k*ee)):dr>se?vr<se&&(ee=P(Y,dt,Dt,Ht,Gt,se),ht&&(Y.start=le+k*ee)):Zt(Y,dt,Dt,Ct),vr<te&&dr>=te&&(ee=P(Y,dt,Dt,Ht,Gt,te),Nr=!0),vr>se&&dr<=se&&(ee=P(Y,dt,Dt,Ht,Gt,se),Nr=!0),!Oe&&Nr&&(ht&&(Y.end=le+k*ee),W.push(Y),Y=It(Qe)),ht&&(le+=k)}let ge=Qe.length-3;const ie=Qe[ge],ot=Qe[ge+1],Mt=Ce===0?ie:ot;Mt>=te&&Mt<=se&&Zt(Y,ie,ot,Qe[ge+2]),ge=Y.length-3,Oe&&ge>=3&&(Y[ge]!==Y[0]||Y[ge+1]!==Y[1])&&Zt(Y,Y[0],Y[1],Y[2]),Y.length&&W.push(Y)}function It(Qe){const W=[];return W.size=Qe.size,W.start=Qe.start,W.end=Qe.end,W}function zt(Qe,W,te,se,Ce,Oe){for(const ht of Qe)ft(ht,W,te,se,Ce,Oe,!1)}function Zt(Qe,W,te,se){Qe.push(W,te,se)}function sr(Qe,W,te,se,Ce,Oe){const ht=(Oe-W)/(se-W);return Zt(Qe,Oe,te+(Ce-te)*ht,1),ht}function ur(Qe,W,te,se,Ce,Oe){const ht=(Oe-te)/(Ce-te);return Zt(Qe,W+(se-W)*ht,Oe,1),ht}function _r(Qe,W){const te=W.buffer/W.extent;let se=Qe;const Ce=nt(Qe,1,-1-te,te,0,-1,2,W),Oe=nt(Qe,1,1-te,2+te,0,-1,2,W);return(Ce||Oe)&&(se=nt(Qe,1,-te,1+te,0,-1,2,W)||[],Ce&&(se=Le(Ce,1).concat(se)),Oe&&(se=se.concat(Le(Oe,-1)))),se}function Le(Qe,W){const te=[];for(const se of Qe)switch(se.type){case"Point":case"MultiPoint":case"LineString":{const Ce=lr(se.geometry,W);te.push(yt(se.id,se.type,Ce,se.tags));continue}case"MultiLineString":case"Polygon":{const Ce=[];for(const Oe of se.geometry)Ce.push(lr(Oe,W));te.push(yt(se.id,se.type,Ce,se.tags));continue}case"MultiPolygon":{const Ce=[];for(const Oe of se.geometry){const ht=[];for(const Y of Oe)ht.push(lr(Y,W));Ce.push(ht)}te.push(yt(se.id,se.type,Ce,se.tags));continue}}return te}function lr(Qe,W){const te=[];te.size=Qe.size,Qe.start!==void 0&&(te.start=Qe.start,te.end=Qe.end);for(let se=0;se<Qe.length;se+=3)te.push(Qe[se]+W,Qe[se+1],Qe[se+2]);return te}function br(Qe,W){if(Qe.transformed)return Qe;const te=1<<Qe.z,se=Qe.x,Ce=Qe.y;for(const Oe of Qe.features){if(Oe.type===1){const Y=[];for(let P=0;P<Oe.geometry.length;P+=2)Y.push(Tr(Oe.geometry[P],Oe.geometry[P+1],W,te,se,Ce));Oe.geometry=Y;continue}const ht=[];for(const Y of Oe.geometry){const P=[];for(let k=0;k<Y.length;k+=2)P.push(Tr(Y[k],Y[k+1],W,te,se,Ce));ht.push(P)}Oe.geometry=ht}return Qe.transformed=!0,Qe}function Tr(Qe,W,te,se,Ce,Oe){return[Math.round(te*(Qe*se-Ce)),Math.round(te*(W*se-Oe))]}function Yt(Qe,W,te,se,Ce){const Oe=W===Ce.maxZoom?0:Ce.tolerance/((1<<W)*Ce.extent),ht={features:[],numPoints:0,numSimplified:0,numFeatures:Qe.length,source:null,x:te,y:se,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Y of Qe)zr(ht,Y,Oe,Ce);return ht}function zr(Qe,W,te,se){Qe.minX=Math.min(Qe.minX,W.minX),Qe.minY=Math.min(Qe.minY,W.minY),Qe.maxX=Math.max(Qe.maxX,W.maxX),Qe.maxY=Math.max(Qe.maxY,W.maxY);let Ce,Oe=W.tags||null;switch(W.type){case"Point":case"MultiPoint":{const ht=[];for(let Y=0;Y<W.geometry.length;Y+=3)ht.push(W.geometry[Y],W.geometry[Y+1]),Qe.numPoints++,Qe.numSimplified++;if(!ht.length)return;Ce={type:1,tags:Oe,geometry:ht};break}case"LineString":{const ht=[];if(yr(ht,W.geometry,Qe,te,!1,!1),!ht.length)return;if(se.lineMetrics){Oe={};for(const Y in W.tags)Oe[Y]=W.tags[Y];Oe.mapbox_clip_start=W.geometry.start/W.geometry.size,Oe.mapbox_clip_end=W.geometry.end/W.geometry.size}Ce={type:2,tags:Oe,geometry:ht};break}case"MultiLineString":case"Polygon":{const ht=[];for(let Y=0;Y<W.geometry.length;Y++)yr(ht,W.geometry[Y],Qe,te,W.type==="Polygon",Y===0);if(!ht.length)return;Ce={type:W.type==="Polygon"?3:2,tags:Oe,geometry:ht};break}case"MultiPolygon":{const ht=[];for(let Y=0;Y<W.geometry.length;Y++){const P=W.geometry[Y];for(let k=0;k<P.length;k++)yr(ht,P[k],Qe,te,!0,k===0)}if(!ht.length)return;Ce={type:3,tags:Oe,geometry:ht};break}}W.id!==null&&(Ce.id=W.id),Qe.features.push(Ce)}function yr(Qe,W,te,se,Ce,Oe){const ht=se*se;if(se>0&&W.size<(Ce?ht:se))return void(te.numPoints+=W.length/3);const Y=[];for(let P=0;P<W.length;P+=3)(se===0||W[P+2]>ht)&&(te.numSimplified++,Y.push(W[P],W[P+1])),te.numPoints++;Ce&&(function(P,k){let ee=0;for(let le=0,ge=P.length,ie=ge-2;le<ge;ie=le,le+=2)ee+=(P[le]-P[ie])*(P[le+1]+P[ie+1]);if(ee>0===k)for(let le=0,ge=P.length;le<ge/2;le+=2){const ie=P[le],ot=P[le+1];P[le]=P[ge-2-le],P[le+1]=P[ge-1-le],P[ge-2-le]=ie,P[ge-1-le]=ot}})(Y,Oe),Qe.push(Y)}function Lr(Qe,W,te){const se=!!W.newGeometry,Ce=W.removeAllProperties||W.removeProperties?.length>0||W.addOrUpdateProperties?.length>0;if(se){let Oe=gt({type:"FeatureCollection",features:[{type:"Feature",id:Qe.id,geometry:W.newGeometry,properties:Ce?Cr(Qe.tags,W):Qe.tags}]},te);return Oe=_r(Oe,te),Oe[0]}if(Ce){const Oe={...Qe};return Oe.tags=Cr(Oe.tags,W),Oe}return null}function Cr(Qe,W){if(W.removeAllProperties)return{};const te={...Qe||{}};if(W.removeProperties)for(const se of W.removeProperties)delete te[se];if(W.addOrUpdateProperties)for(const{key:se,value:Ce}of W.addOrUpdateProperties)te[se]=Ce;return te}const li={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,updateable:!1,debug:0};class Gr{options;tiles;tileCoords;stats={};total=0;source;constructor(W,te){const se=(te=this.options=Object.assign({},li,te)).debug;if(se&&console.time("preprocess data"),te.maxZoom<0||te.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(te.promoteId&&te.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ce=gt(W,te);this.tiles={},this.tileCoords=[],se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",te.indexMaxZoom,te.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ce=_r(Ce,te),Ce.length&&this.splitTile(Ce,0,0,0),te.updateable&&(this.source=Ce),se&&(Ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(W,te,se,Ce,Oe,ht,Y){const P=[W,te,se,Ce],k=this.options,ee=k.debug;for(;P.length;){Ce=P.pop(),se=P.pop(),te=P.pop(),W=P.pop();const le=1<<te,ge=Vr(te,se,Ce);let ie=this.tiles[ge];if(!ie&&(ee>1&&console.time("creation"),ie=this.tiles[ge]=Yt(W,te,se,Ce,k),this.tileCoords.push({z:te,x:se,y:Ce,id:ge}),ee)){ee>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",te,se,Ce,ie.numFeatures,ie.numPoints,ie.numSimplified),console.timeEnd("creation"));const Nr=`z${te}`;this.stats[Nr]=(this.stats[Nr]||0)+1,this.total++}if(ie.source=W,Oe==null){if(te===k.indexMaxZoom||ie.numPoints<=k.indexMaxPoints)continue}else{if(te===k.maxZoom||te===Oe)continue;if(Oe!=null){const Nr=Oe-te;if(se!==ht>>Nr||Ce!==Y>>Nr)continue}}if(ie.source=null,!W.length)continue;ee>1&&console.time("clipping");const ot=.5*k.buffer/k.extent,Mt=.5-ot,ct=.5+ot,dt=1+ot;let Dt=null,Ct=null,Ht=null,Gt=null;const dr=nt(W,le,se-ot,se+ct,0,ie.minX,ie.maxX,k),vr=nt(W,le,se+Mt,se+dt,0,ie.minX,ie.maxX,k);dr&&(Dt=nt(dr,le,Ce-ot,Ce+ct,1,ie.minY,ie.maxY,k),Ct=nt(dr,le,Ce+Mt,Ce+dt,1,ie.minY,ie.maxY,k)),vr&&(Ht=nt(vr,le,Ce-ot,Ce+ct,1,ie.minY,ie.maxY,k),Gt=nt(vr,le,Ce+Mt,Ce+dt,1,ie.minY,ie.maxY,k)),ee>1&&console.timeEnd("clipping"),P.push(Dt||[],te+1,2*se,2*Ce),P.push(Ct||[],te+1,2*se,2*Ce+1),P.push(Ht||[],te+1,2*se+1,2*Ce),P.push(Gt||[],te+1,2*se+1,2*Ce+1)}}getTile(W,te,se){W=+W,te=+te,se=+se;const Ce=this.options,{extent:Oe,debug:ht}=Ce;if(W<0||W>24)return null;const Y=1<<W,P=Vr(W,te=te+Y&Y-1,se);if(this.tiles[P])return br(this.tiles[P],Oe);ht>1&&console.log("drilling down to z%d-%d-%d",W,te,se);let k,ee=W,le=te,ge=se;for(;!k&&ee>0;)ee--,le>>=1,ge>>=1,k=this.tiles[Vr(ee,le,ge)];return k?.source?(ht>1&&(console.log("found parent tile z%d-%d-%d",ee,le,ge),console.time("drilling down")),this.splitTile(k.source,ee,le,ge,W,te,se),ht>1&&console.timeEnd("drilling down"),this.tiles[P]?br(this.tiles[P],Oe):null):null}invalidateTiles(W){const te=this.options,{debug:se}=te;let Ce=1/0,Oe=-1/0,ht=1/0,Y=-1/0;for(const ee of W)Ce=Math.min(Ce,ee.minX),Oe=Math.max(Oe,ee.maxX),ht=Math.min(ht,ee.minY),Y=Math.max(Y,ee.maxY);const P=te.buffer/te.extent,k=new Set;for(const ee in this.tiles){const le=this.tiles[ee],ge=1<<le.z,ie=(le.x-P)/ge,ot=(le.x+1+P)/ge,Mt=(le.y-P)/ge,ct=(le.y+1+P)/ge;if(Oe<ie||Ce>=ot||Y<Mt||ht>=ct)continue;let dt=!1;for(const Dt of W)if(Dt.maxX>=ie&&Dt.minX<ot&&Dt.maxY>=Mt&&Dt.minY<ct){dt=!0;break}if(dt){if(se){se>1&&console.log("invalidate tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",le.z,le.x,le.y,le.numFeatures,le.numPoints,le.numSimplified);const Dt=`z${le.z}`;this.stats[Dt]=(this.stats[Dt]||0)-1,this.total--}delete this.tiles[ee],k.add(ee)}}k.size&&(this.tileCoords=this.tileCoords.filter((ee=>!k.has(ee.id))))}updateData(W){const te=this.options,se=te.debug;if(!te.updateable)throw new Error("to update tile geojson `updateable` option must be set to true");const{affected:Ce,source:Oe}=(function(le,ge,ie){const ot=(function(ct){return ct?{removeAll:ct.removeAll,remove:new Set(ct.remove||[]),add:new Map(ct.add?.map((dt=>[dt.id,dt]))),update:new Map(ct.update?.map((dt=>[dt.id,dt])))}:{remove:new Set,add:new Map,update:new Map}})(ge);let Mt=[];if(ot.removeAll&&(Mt=le,le=[]),ot.remove.size||ot.add.size){const ct=[];for(const dt of le){const{id:Dt}=dt;(ot.remove.has(Dt)||ot.add.has(Dt))&&ct.push(dt)}if(ct.length){Mt.push(...ct);const dt=new Set(ct.map((Dt=>Dt.id)));le=le.filter((Dt=>!dt.has(Dt.id)))}if(ot.add.size){let dt=gt({type:"FeatureCollection",features:Array.from(ot.add.values())},ie);dt=_r(dt,ie),Mt.push(...dt),le.push(...dt)}}if(ot.update.size)for(const[ct,dt]of ot.update){const Dt=le.findIndex((Gt=>Gt.id===ct));if(Dt===-1)continue;const Ct=le[Dt],Ht=Lr(Ct,dt,ie);Ht&&(Mt.push(Ct,Ht),le[Dt]=Ht)}return{affected:Mt,source:le}})(this.source,W,te);if(!Ce.length)return;this.source=Oe,se>1&&(console.log("invalidating tiles"),console.time("invalidating")),this.invalidateTiles(Ce),se>1&&console.timeEnd("invalidating");const[ht,Y,P]=[0,0,0],k=Yt(this.source,ht,Y,P,this.options);k.source=this.source;const ee=Vr(ht,Y,P);if(this.tiles[ee]=k,this.tileCoords.push({z:ht,x:Y,y:P,id:ee}),se){const le=`z${ht}`;this.stats[le]=(this.stats[le]||0)+1,this.total++}}}function Vr(Qe,W,te){return 32*((1<<Qe)*te+W)+Qe}class ni extends re{constructor(W,te,se,Ce=ei){super(W,te,se),this._dataUpdateable=new Map,this._createGeoJSONIndex=Ce}loadVectorTile(W,te){return b._(this,void 0,void 0,(function*(){const se=W.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Ce=this._geoJSONIndex.getTile(se.z,se.x,se.y);return Ce?Ie(new b.d3(Ce.features,{version:2,extent:b.a5})):null}))}loadData(W){return b._(this,void 0,void 0,(function*(){var te;(te=this._pendingRequest)===null||te===void 0||te.abort();const se=this._startPerformance(W);this._pendingRequest=new AbortController;try{(!this._pendingData||W.request||W.data||W.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(W,this._pendingRequest));const Ce=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(Ce,W),this.loaded={};const Oe={};return W.request&&(Oe.data=Ce),this._finishPerformance(se,W,Oe),Oe}catch(Ce){if(delete this._pendingRequest,b.Z(Ce))return{abandoned:!0};throw Ce}}))}_startPerformance(W){var te;if(!((te=W?.request)===null||te===void 0)&&te.collectResourceTiming)return new b.c$(W.request)}_finishPerformance(W,te,se){if(!W)return;const Ce=W.finish();Ce&&(se.resourceTiming={},se.resourceTiming[te.source]=JSON.parse(JSON.stringify(Ce)))}getData(){return b._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(W){const te=this.loaded;return te&&te[W.uid]?super.reloadTile(W):this.loadTile(W)}loadAndProcessGeoJSON(W,te){return b._(this,void 0,void 0,(function*(){let se;if(W.request?se=yield this.loadGeoJSONFromUrl(W.request,W.promoteId,te):W.data?se=this._loadGeoJSONFromObject(W.data,W.promoteId):W.dataDiff&&(se=this._loadGeoJSONFromDiff(W.dataDiff,W.promoteId,W.source)),delete this._pendingRequest,typeof se!="object")throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);return Ue(se,!0),W.filter&&(se=this._filterGeoJSON(se,W.filter)),se}))}loadGeoJSONFromUrl(W,te,se){return b._(this,void 0,void 0,(function*(){const Ce=yield b.j(W,se);return this._dataUpdateable=b.a7(Ce.data,te),Ce.data}))}_loadGeoJSONFromObject(W,te){return this._dataUpdateable=b.a7(W,te),W}_loadGeoJSONFromDiff(W,te,se){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${se}`);b.a8(this._dataUpdateable,W,te);const Ce=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(Ce)}_filterGeoJSON(W,te){const se=b.d4(te,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(se.result==="error")throw new Error(se.value.map((Oe=>`${Oe.key}: ${Oe.message}`)).join(", "));const Ce=W.features.filter((Oe=>se.value.evaluate({zoom:0},Oe)));return this._toFeatureCollection(Ce)}_toFeatureCollection(W){return{type:"FeatureCollection",features:W}}removeSource(W){return b._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(W){return this._geoJSONIndex.getClusterExpansionZoom(W.clusterId)}getClusterChildren(W){return this._geoJSONIndex.getChildren(W.clusterId)}getClusterLeaves(W){return this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset)}}function ei(Qe,W){return W.cluster?new Pe((function({superclusterOptions:te,clusterProperties:se}){if(!se||!te)return te;const Ce={},Oe={},ht={accumulated:null,zoom:0},Y={properties:null},P=Object.keys(se);for(const k of P){const[ee,le]=se[k],ge=b.d4(le),ie=b.d4(typeof ee=="string"?[ee,["accumulated"],["get",k]]:ee);Ce[k]=ge.value,Oe[k]=ie.value}return te.map=k=>{Y.properties=k;const ee={};for(const le of P)ee[le]=Ce[le].evaluate(ht,Y);return ee},te.reduce=(k,ee)=>{Y.properties=ee;for(const le of P)ht.accumulated=k[le],k[le]=Oe[le].evaluate(ht,Y)},te})(W)).load(Qe.features):(function(te,se){return new Gr(te,se)})(Qe,W.geojsonVtOptions)}class xr{constructor(W){this.self=W,this.actor=new b.L(W),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(te,se)=>{if(this.externalWorkerSourceTypes[te])throw new Error(`Worker source with name "${te}" already registered.`);this.externalWorkerSourceTypes[te]=se},this.self.addProtocol=b.cK,this.self.removeProtocol=b.cL,this.self.registerRTLTextPlugin=te=>{b.d5.setMethods(te)},this.actor.registerMessageHandler("LDT",((te,se)=>this._getDEMWorkerSource(te,se.source).loadTile(se))),this.actor.registerMessageHandler("RDT",((te,se)=>b._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(te,se.source).removeTile(se)})))),this.actor.registerMessageHandler("GCEZ",((te,se)=>b._(this,void 0,void 0,(function*(){return this._getWorkerSource(te,se.type,se.source).getClusterExpansionZoom(se)})))),this.actor.registerMessageHandler("GCC",((te,se)=>b._(this,void 0,void 0,(function*(){return this._getWorkerSource(te,se.type,se.source).getClusterChildren(se)})))),this.actor.registerMessageHandler("GCL",((te,se)=>b._(this,void 0,void 0,(function*(){return this._getWorkerSource(te,se.type,se.source).getClusterLeaves(se)})))),this.actor.registerMessageHandler("LD",((te,se)=>this._getWorkerSource(te,se.type,se.source).loadData(se))),this.actor.registerMessageHandler("GD",((te,se)=>this._getWorkerSource(te,se.type,se.source).getData())),this.actor.registerMessageHandler("LT",((te,se)=>this._getWorkerSource(te,se.type,se.source).loadTile(se))),this.actor.registerMessageHandler("RT",((te,se)=>this._getWorkerSource(te,se.type,se.source).reloadTile(se))),this.actor.registerMessageHandler("AT",((te,se)=>this._getWorkerSource(te,se.type,se.source).abortTile(se))),this.actor.registerMessageHandler("RMT",((te,se)=>this._getWorkerSource(te,se.type,se.source).removeTile(se))),this.actor.registerMessageHandler("RS",((te,se)=>b._(this,void 0,void 0,(function*(){if(!this.workerSources[te]||!this.workerSources[te][se.type]||!this.workerSources[te][se.type][se.source])return;const Ce=this.workerSources[te][se.type][se.source];delete this.workerSources[te][se.type][se.source],Ce.removeSource!==void 0&&Ce.removeSource(se)})))),this.actor.registerMessageHandler("RM",(te=>b._(this,void 0,void 0,(function*(){delete this.layerIndexes[te],delete this.availableImages[te],delete this.workerSources[te],delete this.demWorkerSources[te],this.globalStates.delete(te)})))),this.actor.registerMessageHandler("SR",((te,se)=>b._(this,void 0,void 0,(function*(){this.referrer=se})))),this.actor.registerMessageHandler("SRPS",((te,se)=>this._syncRTLPluginState(te,se))),this.actor.registerMessageHandler("IS",((te,se)=>b._(this,void 0,void 0,(function*(){this.self.importScripts(se)})))),this.actor.registerMessageHandler("SI",((te,se)=>this._setImages(te,se))),this.actor.registerMessageHandler("UL",((te,se)=>b._(this,void 0,void 0,(function*(){this._getLayerIndex(te).update(se.layers,se.removedIds,this._getGlobalState(te))})))),this.actor.registerMessageHandler("UGS",((te,se)=>b._(this,void 0,void 0,(function*(){const Ce=this._getGlobalState(te);for(const Oe in se)Ce[Oe]=se[Oe]})))),this.actor.registerMessageHandler("SL",((te,se)=>b._(this,void 0,void 0,(function*(){this._getLayerIndex(te).replace(se,this._getGlobalState(te))}))))}_getGlobalState(W){let te=this.globalStates.get(W);return te||(te={},this.globalStates.set(W,te)),te}_setImages(W,te){return b._(this,void 0,void 0,(function*(){this.availableImages[W]=te;for(const se in this.workerSources[W]){const Ce=this.workerSources[W][se];for(const Oe in Ce)Ce[Oe].availableImages=te}}))}_syncRTLPluginState(W,te){return b._(this,void 0,void 0,(function*(){return yield b.d5.syncState(te,this.self.importScripts)}))}_getAvailableImages(W){let te=this.availableImages[W];return te||(te=[]),te}_getLayerIndex(W){let te=this.layerIndexes[W];return te||(te=this.layerIndexes[W]=new s),te}_getWorkerSource(W,te,se){if(this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][te]||(this.workerSources[W][te]={}),!this.workerSources[W][te][se]){const Ce={sendAsync:(Oe,ht)=>(Oe.targetMapId=W,this.actor.sendAsync(Oe,ht))};switch(te){case"vector":this.workerSources[W][te][se]=new re(Ce,this._getLayerIndex(W),this._getAvailableImages(W));break;case"geojson":this.workerSources[W][te][se]=new ni(Ce,this._getLayerIndex(W),this._getAvailableImages(W));break;default:this.workerSources[W][te][se]=new this.externalWorkerSourceTypes[te](Ce,this._getLayerIndex(W),this._getAvailableImages(W))}}return this.workerSources[W][te][se]}_getDEMWorkerSource(W,te){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][te]||(this.demWorkerSources[W][te]=new ye),this.demWorkerSources[W][te]}}return b.i(self)&&(self.worker=new xr(self)),xr})),v("index",["exports","./shared"],(function(b,s){var E="5.17.0";function F(){var m=new s.A(4);return s.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let B,Q,ne;const j={frame(m,t,n,o){const h=o||window,_=h.requestAnimationFrame((A=>{w(),t(A)})),{unsubscribe:w}=s.s(m.signal,"abort",(()=>{w(),h.cancelAnimationFrame(_),n(new s.a(m.signal.reason))}),!1)},frameAsync(m,t){return new Promise(((n,o)=>{this.frame(m,n,o,t)}))},getImageData(m,t=0){return this.getImageCanvasContext(m).getImageData(-t,-t,m.width+2*t,m.height+2*t)},getImageCanvasContext(m){const t=window.document.createElement("canvas"),n=t.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return t.width=m.width,t.height=m.height,n.drawImage(m,0,0,m.width,m.height),n},resolveURL:m=>(B||(B=document.createElement("a")),B.href=m,B.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return ne!==void 0?ne:!!matchMedia&&(Q==null&&(Q=matchMedia("(prefers-reduced-motion: reduce)")),Q.matches)},set prefersReducedMotion(m){ne=m}},Ie=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(m){this._frozenAt=m}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function he(){return Ie.getCurrentTime()}class re{static testProp(t){if(!re.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in re.docStyle)return t[n];return t[0]}static create(t,n,o){const h=window.document.createElement(t);return n!==void 0&&(h.className=n),o&&o.appendChild(h),h}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){re.docStyle&&re.selectProp&&(re.userSelect=re.docStyle[re.selectProp],re.docStyle[re.selectProp]="none")}static enableDrag(){re.docStyle&&re.selectProp&&(re.docStyle[re.selectProp]=re.userSelect)}static setTransform(t,n){t.style[re.transformProp]=n}static addEventListener(t,n,o,h={}){t.addEventListener(n,o,"passive"in h?h:h.capture)}static removeEventListener(t,n,o,h={}){t.removeEventListener(n,o,"passive"in h?h:h.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",re.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",re.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",re.suppressClickInternal,!0)}),0)}static getScale(t){const n=t.getBoundingClientRect();return{x:n.width/t.offsetWidth||1,y:n.height/t.offsetHeight||1,boundingClientRect:n}}static getPoint(t,n,o){const h=n.boundingClientRect;return new s.P((o.clientX-h.left)/n.x-t.clientLeft,(o.clientY-h.top)/n.y-t.clientTop)}static mousePos(t,n){const o=re.getScale(t);return re.getPoint(t,o,n)}static touchPos(t,n){const o=[],h=re.getScale(t);for(let _=0;_<n.length;_++)o.push(re.getPoint(t,h,n[_]));return o}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const n=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),o=n.querySelectorAll("script");for(const h of o)h.remove();return re.clean(n),n.innerHTML}static isPossiblyDangerous(t,n){const o=n.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!o.includes("javascript:")&&!o.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const n=t.children;for(const o of n)re.removeAttributes(o),re.clean(o)}static removeAttributes(t){for(const{name:n,value:o}of t.attributes)re.isPossiblyDangerous(n,o)&&t.removeAttribute(n)}}re.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,re.selectProp=re.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),re.transformProp=re.testProp(["transform","WebkitTransform"]);const ye={supported:!1,testSupport:function(m){!De&&Be&&(Ue?$e(m):Je=m)}};let Je,Be,De=!1,Ue=!1;function $e(m){const t=m.createTexture();m.bindTexture(m.TEXTURE_2D,t);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,Be),m.isContextLost())return;ye.supported=!0}catch{}m.deleteTexture(t),De=!0}var st;typeof document<"u"&&(Be=document.createElement("img"),Be.onload=()=>{Je&&$e(Je),Je=null,Ue=!0},Be.onerror=()=>{De=!0,Je=null},Be.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(m){let t,n,o,h;m.resetRequestQueue=()=>{t=[],n=0,o=0,h={}},m.addThrottleControl=M=>{const z=o++;return h[z]=M,z},m.removeThrottleControl=M=>{delete h[M],w()},m.getImage=(M,z,O=!0)=>new Promise((($,G)=>{ye.supported&&(M.headers||(M.headers={}),M.headers.accept="image/webp,*/*"),s.e(M,{type:"image"}),t.push({abortController:z,requestParameters:M,supportImageRefresh:O,state:"queued",onError:J=>{G(J)},onSuccess:J=>{$(J)}}),w()}));const _=M=>s._(this,void 0,void 0,(function*(){M.state="running";const{requestParameters:z,supportImageRefresh:O,onError:$,onSuccess:G,abortController:J}=M,ce=O===!1&&!s.i(self)&&!s.g(z.url)&&(!z.headers||Object.keys(z.headers).reduce(((Se,Me)=>Se&&Me==="accept"),!0));n++;const be=ce?A(z,J):s.m(z,J);try{const Se=yield be;delete M.abortController,M.state="completed",Se.data instanceof HTMLImageElement||s.b(Se.data)?G(Se):Se.data&&G({data:yield(Te=Se.data,typeof createImageBitmap=="function"?s.f(Te):s.h(Te)),cacheControl:Se.cacheControl,expires:Se.expires})}catch(Se){delete M.abortController,$(Se)}finally{n--,w()}var Te})),w=()=>{const M=(()=>{for(const z of Object.keys(h))if(h[z]())return!0;return!1})()?s.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let z=n;z<M&&t.length>0;z++){const O=t.shift();O.abortController.signal.aborted?z--:_(O)}},A=(M,z)=>new Promise(((O,$)=>{const G=new Image,J=M.url,ce=M.credentials;ce&&ce==="include"?G.crossOrigin="use-credentials":(ce&&ce==="same-origin"||!s.d(J))&&(G.crossOrigin="anonymous"),z.signal.addEventListener("abort",(()=>{G.src="",$(new s.a(z.signal.reason))})),G.fetchPriority="high",G.onload=()=>{G.onerror=G.onload=null,O({data:G})},G.onerror=()=>{G.onerror=G.onload=null,z.signal.aborted||$(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},G.src=J}))})(st||(st={})),st.resetRequestQueue();class Ze{constructor(t){this._transformRequestFn=t??null}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Pe(m){const t=[];if(typeof m=="string")t.push({id:"default",url:m});else if(m&&m.length>0){const n=[];for(const{id:o,url:h}of m){const _=`${o}${h}`;n.indexOf(_)===-1&&(n.push(_),t.push({id:o,url:h}))}}return t}function rt(m,t,n){try{const o=new URL(m);return o.pathname+=`${t}${n}`,o.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function _e(m){const{userImage:t}=m;return!!(t&&t.render&&t.render())&&(m.data.replace(new Uint8Array(t.data.buffer)),!0)}class we extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,promiseResolve:o}of this.requestors)o(this._getImagesForIds(n));this.requestors=[]}}getImage(t){const n=this.images[t];if(n&&!n.data&&n.spriteData){const o=n.spriteData;n.data=new s.R({width:o.width,height:o.height},o.context.getImageData(o.x,o.y,o.width,o.height).data),n.spriteData=null}return n}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let o=!0;const h=n.data||n.spriteData;return this._validateStretch(n.stretchX,h&&h.width)||(this.fire(new s.k(new Error(`Image "${t}" has invalid "stretchX" value`))),o=!1),this._validateStretch(n.stretchY,h&&h.height)||(this.fire(new s.k(new Error(`Image "${t}" has invalid "stretchY" value`))),o=!1),this._validateContent(n.content,n)||(this.fire(new s.k(new Error(`Image "${t}" has invalid "content" value`))),o=!1),o}_validateStretch(t,n){if(!t)return!0;let o=0;for(const h of t){if(h[0]<o||h[1]<h[0]||n<h[1])return!1;o=h[1]}return!0}_validateContent(t,n){if(!t)return!0;if(t.length!==4)return!1;const o=n.spriteData,h=o&&o.width||n.data.width,_=o&&o.height||n.data.height;return!(t[0]<0||h<t[0]||t[1]<0||_<t[1]||t[2]<0||h<t[2]||t[3]<0||_<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,n,o=!0){const h=this.getImage(t);if(o&&(h.data.width!==n.data.width||h.data.height!==n.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=h.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((n,o)=>{let h=!0;if(!this.isLoaded())for(const _ of t)this.images[_]||(h=!1);this.isLoaded()||h?n(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:n})}))}_getImagesForIds(t){const n={};for(const o of t){let h=this.getImage(o);h||(this.fire(new s.l("styleimagemissing",{id:o})),h=this.getImage(o)),h?n[o]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,textFitWidth:h.textFitWidth,textFitHeight:h.textFitHeight,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:s.w(`Image "${o}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],o=this.getImage(t);if(!o)return null;if(n&&n.position.version===o.version)return n.position;if(n)n.position.version=o.version;else{const h={w:o.data.width+2,h:o.data.height+2,x:0,y:0},_=new s.I(h,o);this.patterns[t]={bin:h,position:_}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.T(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const _ in this.patterns)t.push(this.patterns[_].bin);const{w:n,h:o}=s.p(t),h=this.atlasImage;h.resize({width:n||1,height:o||1});for(const _ in this.patterns){const{bin:w}=this.patterns[_],A=w.x+1,M=w.y+1,z=this.getImage(_).data,O=z.width,$=z.height;s.R.copy(z,h,{x:0,y:0},{x:A,y:M},{width:O,height:$}),s.R.copy(z,h,{x:0,y:$-1},{x:A,y:M-1},{width:O,height:1}),s.R.copy(z,h,{x:0,y:0},{x:A,y:M+$},{width:O,height:1}),s.R.copy(z,h,{x:O-1,y:0},{x:A-1,y:M},{width:1,height:$}),s.R.copy(z,h,{x:0,y:0},{x:A+O,y:M},{width:1,height:$})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const o=this.getImage(n);o||s.w(`Image with ID: "${n}" was not found`),_e(o)&&this.updateImage(n,o)}}cloneImages(){const t={};for(const n in this.images){const o=this.images[n];t[n]=Object.assign(Object.assign({},o),{data:o.data?o.data.clone():null})}return t}}const Ge=1e20;function Ye(m,t,n,o,h,_,w,A,M){for(let z=t;z<t+o;z++)xt(m,n*_+z,_,h,w,A,M);for(let z=n;z<n+h;z++)xt(m,z*_+t,1,o,w,A,M)}function xt(m,t,n,o,h,_,w){_[0]=0,w[0]=-Ge,w[1]=Ge,h[0]=m[t];for(let A=1,M=0,z=0;A<o;A++){h[A]=m[t+A*n];const O=A*A;do{const $=_[M];z=(h[A]-h[$]+O-$*$)/(A-$)/2}while(z<=w[M]&&--M>-1);M++,_[M]=A,w[M]=z,w[M+1]=Ge}for(let A=0,M=0;A<o;A++){for(;w[M+1]<A;)M++;const z=_[M],O=A-z;m[t+A*n]=h[z]+O*O}}const kt=s.v.layout_symbol["text-font"].default.join(",");class yt{constructor(t,n,o){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={},this.lang=o}setURL(t){this.url=t}getGlyphs(t){return s._(this,void 0,void 0,(function*(){const n=[];for(const _ in t)for(const w of t[_])n.push(this._getAndCacheGlyphsPromise(_,w));const o=yield Promise.all(n),h={};for(const{stack:_,id:w,glyph:A}of o)h[_]||(h[_]={}),h[_][w]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};return h}))}_getAndCacheGlyphsPromise(t,n){return s._(this,void 0,void 0,(function*(){let o=this.entries[t];o||(o=this.entries[t]={glyphs:{},requests:{},ranges:{}});let h=o.glyphs[n];return h!==void 0?{stack:t,id:n,glyph:h}:!this.url||this._charUsesLocalIdeographFontFamily(n)?(h=o.glyphs[n]=this._drawGlyph(o,t,n),{stack:t,id:n,glyph:h}):yield this._downloadAndCacheRangePromise(t,n)}))}_downloadAndCacheRangePromise(t,n){return s._(this,void 0,void 0,(function*(){const o=this.entries[t],h=Math.floor(n/256);if(o.ranges[h])return{stack:t,id:n,glyph:null};if(!o.requests[h]){const _=yt.loadGlyphRange(t,h,this.url,this.requestManager);o.requests[h]=_}try{const _=yield o.requests[h];for(const w in _)o.glyphs[+w]=_[+w];return o.ranges[h]=!0,{stack:t,id:n,glyph:_[n]||null}}catch(_){const w=o.glyphs[n]=this._drawGlyph(o,t,n);return this._warnOnMissingGlyphRange(w,h,n,_),{stack:t,id:n,glyph:w}}}))}_warnOnMissingGlyphRange(t,n,o,h){const _=256*n,w=_+255,A=o.toString(16).padStart(4,"0").toUpperCase();s.w(`Unable to load glyph range ${n}, ${_}-${w}. Rendering codepoint U+${A} locally instead. ${h}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&s.q(t)}_drawGlyph(t,n,o){const h=n===kt&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(o),_=h?"ideographTinySDF":"tinySDF";t[_]||(t[_]=this._createTinySDF(h?this.localIdeographFontFamily:n));const w=t[_].draw(String.fromCodePoint(o)),A=new RegExp("^\\p{gc=Cf}+$","u").test(String.fromCodePoint(o));return{id:o,bitmap:new s.r({width:w.width||60,height:w.height||60},w.data),metrics:{width:A?0:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:A?0:w.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const n=t?t.split(","):[];n.push("sans-serif");const o=n.map((h=>/[-\w]+/.test(h)?h:`'${CSS.escape(h)}'`)).join(",");return new yt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:o,fontWeight:this._fontWeight(n[0]),fontStyle:this._fontStyle(n[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const n={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let o;for(const[h,_]of Object.entries(n))new RegExp(`\\b${h}\\b`,"i").test(t)&&(o=`${_}`);return o}destroy(){for(const t in this.entries){const n=this.entries[t];n.tinySDF&&(n.tinySDF=null),n.ideographTinySDF&&(n.ideographTinySDF=null),n.glyphs={},n.requests={},n.ranges={}}this.entries={}}}yt.loadGlyphRange=function(m,t,n,o){return s._(this,void 0,void 0,(function*(){const h=256*t,_=h+255,w=o.transformRequest(n.replace("{fontstack}",m).replace("{range}",`${h}-${_}`),"Glyphs"),A=yield s.n(w,new AbortController);if(!A||!A.data)throw new Error(`Could not load glyph range. range: ${t}, ${h}-${_}`);const M={};for(const z of s.o(A.data))M[z.id]=z;return M}))},yt.TinySDF=class{constructor({fontSize:m=24,buffer:t=3,radius:n=8,cutoff:o=.25,fontFamily:h="sans-serif",fontWeight:_="normal",fontStyle:w="normal",lang:A=null}={}){this.buffer=t,this.cutoff=o,this.radius=n,this.lang=A;const M=this.size=m+4*t,z=this._createCanvas(M),O=this.ctx=z.getContext("2d",{willReadFrequently:!0});O.font=`${w} ${_} ${m}px ${h}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(m){const t=document.createElement("canvas");return t.width=t.height=m,t}draw(m){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:h,actualBoundingBoxRight:_}=this.ctx.measureText(m),w=Math.ceil(n),A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-h))),M=Math.min(this.size-this.buffer,w+Math.ceil(o)),z=A+2*this.buffer,O=M+2*this.buffer,$=Math.max(z*O,0),G=new Uint8ClampedArray($),J={data:G,width:z,height:O,glyphWidth:A,glyphHeight:M,glyphTop:w,glyphLeft:0,glyphAdvance:t};if(A===0||M===0)return J;const{ctx:ce,buffer:be,gridInner:Te,gridOuter:Se}=this;this.lang&&(ce.lang=this.lang),ce.clearRect(be,be,A,M),ce.fillText(m,be,be+w);const Me=ce.getImageData(be,be,A,M);Se.fill(Ge,0,$),Te.fill(0,0,$);for(let He=0;He<M;He++)for(let Ee=0;Ee<A;Ee++){const Xe=Me.data[4*(He*A+Ee)+3]/255;if(Xe===0)continue;const et=(He+be)*z+Ee+be;if(Xe===1)Se[et]=0,Te[et]=Ge;else{const qe=.5-Xe;Se[et]=qe>0?qe*qe:0,Te[et]=qe<0?qe*qe:0}}Ye(Se,0,0,z,O,z,this.f,this.v,this.z),Ye(Te,be,be,A,M,z,this.f,this.v,this.z);for(let He=0;He<$;He++){const Ee=Math.sqrt(Se[He])-Math.sqrt(Te[He]);G[He]=Math.round(255-255*(Ee/this.radius+this.cutoff))}return J}};class mt{constructor(){this.specification=s.u.light.position}possiblyEvaluate(t,n){return s.F(t.expression.evaluate(n))}interpolate(t,n,o){return{x:s.G.number(t.x,n.x,o),y:s.G.number(t.y,n.y,o),z:s.G.number(t.z,n.z,o)}}}let gt;class Qt extends s.E{constructor(t){super(),gt=gt||new s.t({anchor:new s.D(s.u.light.anchor),position:new mt,color:new s.D(s.u.light.color),intensity:new s.D(s.u.light.intensity)}),this._transitionable=new s.x(gt,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(s.y,t,n))for(const o in t){const h=t[o];o.endsWith(s.z)?this._transitionable.setTransition(o.slice(0,-s.z.length),h):this._transitionable.setValue(o,h)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,o){return(!o||o.validate!==!1)&&s.B(this,t.call(s.C,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.u}))}}const Vt=new s.t({"sky-color":new s.D(s.u.sky["sky-color"]),"horizon-color":new s.D(s.u.sky["horizon-color"]),"fog-color":new s.D(s.u.sky["fog-color"]),"fog-ground-blend":new s.D(s.u.sky["fog-ground-blend"]),"horizon-fog-blend":new s.D(s.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new s.D(s.u.sky["sky-horizon-blend"]),"atmosphere-blend":new s.D(s.u.sky["atmosphere-blend"])});class fe extends s.E{constructor(t){super(),this._transitionable=new s.x(Vt,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.H(0))}setSky(t,n={}){if(!this._validate(s.J,t,n)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const o in t){const h=t[o];o.endsWith(s.z)?this._transitionable.setTransition(o.slice(0,-s.z.length),h):this._transitionable.setValue(o,h)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,o={}){return o?.validate!==!1&&s.B(this,t.call(s.C,s.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class Fe{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const o=t.join(",")+String(n);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(t,n)),this.dashEntry[o]}getDashRanges(t,n,o){const h=[];let _=t.length%2==1?-t[t.length-1]*o:0,w=t[0]*o,A=!0;h.push({left:_,right:w,isDash:A,zeroLength:t[0]===0});let M=t[0];for(let z=1;z<t.length;z++){A=!A;const O=t[z];_=M*o,M+=O,w=M*o,h.push({left:_,right:w,isDash:A,zeroLength:O===0})}return h}addRoundDash(t,n,o){const h=n/2;for(let _=-o;_<=o;_++){const w=this.width*(this.nextRow+o+_);let A=0,M=t[A];for(let z=0;z<this.width;z++){z/M.right>1&&(M=t[++A]);const O=Math.abs(z-M.left),$=Math.abs(z-M.right),G=Math.min(O,$);let J;const ce=_/o*(h+1);if(M.isDash){const be=h-Math.abs(ce);J=Math.sqrt(G*G+be*be)}else J=h-Math.sqrt(G*G+ce*ce);this.data[w+z]=Math.max(0,Math.min(255,J+128))}}}addRegularDash(t){for(let A=t.length-1;A>=0;--A){const M=t[A],z=t[A+1];M.zeroLength?t.splice(A,1):z&&z.isDash===M.isDash&&(z.left=M.left,t.splice(A,1))}const n=t[0],o=t[t.length-1];n.isDash===o.isDash&&(n.left=o.left-this.width,o.right=n.right+this.width);const h=this.width*this.nextRow;let _=0,w=t[_];for(let A=0;A<this.width;A++){A/w.right>1&&(w=t[++_]);const M=Math.abs(A-w.left),z=Math.abs(A-w.right),O=Math.min(M,z);this.data[h+A]=Math.max(0,Math.min(255,(w.isDash?O:-O)+128))}}addDash(t,n){const o=n?7:0,h=2*o+1;if(this.nextRow+h>this.height)return s.w("LineAtlas out of space"),null;let _=0;for(let A=0;A<t.length;A++)_+=t[A];if(_!==0){const A=this.width/_,M=this.getDashRanges(t,this.width,A);n?this.addRoundDash(M,A,o):this.addRegularDash(M)}const w={y:this.nextRow+o,height:2*o,width:_};return this.nextRow+=h,this.dirty=!0,w}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const We="maplibre_preloaded_worker_pool";class tt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<tt.workerCount;)this.workers.push(new Worker(s.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((n=>{n.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[We]}numActive(){return Object.keys(this.active).length}}const nt=Math.floor(j.hardwareConcurrency/2);let ut,ft;function It(){return ut||(ut=new tt),ut}tt.workerCount=s.K(globalThis)?Math.max(Math.min(nt,3),1):1;class zt{constructor(t,n){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=n;const o=this.workerPool.acquire(n);for(let h=0;h<o.length;h++){const _=new s.L(o[h],n);_.name=`Worker ${h}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n){const o=[];for(const h of this.actors)o.push(h.sendAsync({type:t,data:n}));return Promise.all(o)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((n=>{n.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,n){for(const o of this.actors)o.registerMessageHandler(t,n)}unregisterMessageHandler(t){for(const n of this.actors)n.unregisterMessageHandler(t)}}function Zt(){return ft||(ft=new zt(It(),s.M),ft.registerMessageHandler("GR",((m,t,n)=>s.m(t,n)))),ft}function sr(m,t){const n=s.N();return s.O(n,n,[1,1,0]),s.Q(n,n,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?s.S(n,n,m.calculatePosMatrix(t.toUnwrapped())):n}function ur(m,t,n,o,h,_,w){var A;const M=(function(G,J,ce){if(G)for(const be of G){const Te=J[be];if(Te&&Te.source===ce&&Te.type==="fill-extrusion")return!0}else for(const be in J){const Te=J[be];if(Te.source===ce&&Te.type==="fill-extrusion")return!0}return!1})((A=h?.layers)!==null&&A!==void 0?A:null,t,m.id),z=_.maxPitchScaleFactor(),O=m.tilesIn(o,z,M);O.sort(_r);const $=[];for(const G of O)$.push({wrappedTileID:G.tileID.wrapped().key,queryResults:G.tile.queryRenderedFeatures(t,n,m.getState(),G.queryGeometry,G.cameraQueryGeometry,G.scale,h,_,z,sr(_,G.tileID),w?(J,ce)=>w(G.tileID,J,ce):void 0)});return(function(G,J){for(const ce in G)for(const be of G[ce])Le(be,J);return G})((function(G){const J={},ce={};for(const be of G){const Te=be.queryResults,Se=be.wrappedTileID,Me=ce[Se]=ce[Se]||{};for(const He in Te){const Ee=Te[He],Xe=Me[He]=Me[He]||{},et=J[He]=J[He]||[];for(const qe of Ee)Xe[qe.featureIndex]||(Xe[qe.featureIndex]=!0,et.push(qe))}}return J})($),m)}function _r(m,t){const n=m.tileID,o=t.tileID;return n.overscaledZ-o.overscaledZ||n.canonical.y-o.canonical.y||n.wrap-o.wrap||n.canonical.x-o.canonical.x}function Le(m,t){const n=m.feature,o=t.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=o}function lr(m,t,n,o){return s._(this,void 0,void 0,(function*(){let h=m;if(m.url?h=(yield s.j(t.transformRequest(m.url,"Source"),n)).data:yield j.frameAsync(n,o),!h)return null;const _=s.U(s.e(h,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in h&&h.vector_layers&&(_.vectorLayerIds=h.vector_layers.map((w=>w.id))),_}))}class br{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof s.V?new s.V(t.lng,t.lat):s.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof s.V?new s.V(t.lng,t.lat):s.V.convert(t),this}extend(t){const n=this._sw,o=this._ne;let h,_;if(t instanceof s.V)h=t,_=t;else{if(!(t instanceof br))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(br.convert(t)):this.extend(s.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(s.V.convert(t)):this;if(h=t._sw,_=t._ne,!h||!_)return this}return n||o?(n.lng=Math.min(h.lng,n.lng),n.lat=Math.min(h.lat,n.lat),o.lng=Math.max(_.lng,o.lng),o.lat=Math.max(_.lat,o.lat)):(this._sw=new s.V(h.lng,h.lat),this._ne=new s.V(_.lng,_.lat)),this}getCenter(){return new s.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.V(this.getWest(),this.getNorth())}getSouthEast(){return new s.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:o}=s.V.convert(t);let h=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&h}intersects(t){if(!((t=br.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const n=Math.abs(this.getEast()-this.getWest()),o=Math.abs(t.getEast()-t.getWest());if(n>=360||o>=360)return!0;const h=s.W(this.getWest(),-180,180),_=s.W(this.getEast(),-180,180),w=s.W(t.getWest(),-180,180),A=s.W(t.getEast(),-180,180),M=h>=_,z=w>=A;return!(!M||!z)||(M?A>=h||w<=_:z?_>=w||h<=A:w<=_&&A>=h)}static convert(t){return t instanceof br?t:t&&new br(t)}static fromLngLat(t,n=0){const o=360*n/40075017,h=o/Math.cos(Math.PI/180*t.lat);return new br(new s.V(t.lng-h,t.lat-o),new s.V(t.lng+h,t.lat+o))}adjustAntiMeridian(){const t=new s.V(this._sw.lng,this._sw.lat),n=new s.V(this._ne.lng,this._ne.lat);return new br(t,t.lng>n.lng?new s.V(n.lng+360,n.lat):n)}}class Tr{constructor(t,n,o){this.bounds=br.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=o||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),o=Math.floor(s.Y(this.bounds.getWest())*n),h=Math.floor(s.X(this.bounds.getNorth())*n),_=Math.ceil(s.Y(this.bounds.getEast())*n),w=Math.ceil(s.X(this.bounds.getSouth())*n);return t.x>=o&&t.x<_&&t.y>=h&&t.y<w}}class Yt extends s.E{constructor(t,n,o,h){if(super(),this.id=t,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.U(n,["url","scheme","tileSize","promoteId","encoding"])),this._options=s.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield lr(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(s.e(this,t),t.bounds&&(this.tileBounds=new Tr(t.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,s.Z(t)||this.fire(new s.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(t){return s._(this,void 0,void 0,(function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),o={request:this.map._requestManager.transformRequest(n,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};o.request.collectResourceTiming=this._collectResourceTiming;let h="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((_,w)=>{t.reloadPromise={resolve:_,reject:w}}))}else t.actor=this.dispatcher.getActor(),h="LT";t.abortController=new AbortController;try{const _=yield t.actor.sendAsync({type:h,data:o},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,_)}catch(_){if(delete t.abortController,t.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const n=t.tileID.scaledTo(this.maxzoom).canonical,o=n.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:n,overzoomRequest:this.map._requestManager.transformRequest(o,"Tile")}}_afterTileLoadWorkerResponse(t,n){if(n&&n.resourceTiming&&(t.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&t.setExpiryData(n),t.loadVectorData(n,this.map.painter),t.reloadPromise){const o=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(o.resolve).catch(o.reject)}}abortTile(t){return s._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return s._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class zr extends s.E{constructor(t,n,o,h){super(),this.id=t,this.dispatcher=o,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},n),s.e(this,s.U(n,["url","scheme","tileSize"]))}load(){return s._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield lr(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,n&&(s.e(this,n),n.bounds&&(this.tileBounds=new Tr(n.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(n){this._tileJSONRequest=null,this._loaded=!0,s.Z(n)||this.fire(new s.k(n))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return s.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return s._(this,void 0,void 0,(function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const o=yield st.getImage(this.map._requestManager.transformRequest(n,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(o&&o.data){this.map._refreshExpiredTiles&&(o.cacheControl||o.expires)&&t.setExpiryData({cacheControl:o.cacheControl,expires:o.expires});const h=this.map.painter.context,_=h.gl,w=o.data;t.texture=this.map.painter.getTileTexture(w.width),t.texture?t.texture.update(w,{useMipmap:!0}):(t.texture=new s.T(h,w,_.RGBA,{useMipmap:!0}),t.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(o){if(delete t.abortController,t.aborted)t.state="unloaded";else if(o)throw t.state="errored",o}}))}abortTile(t){return s._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return s._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class yr extends zr{constructor(t,n,o,h){super(t,n,o,h),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(t){return s._(this,void 0,void 0,(function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),o=this.map._requestManager.transformRequest(n,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const h=yield st.getImage(o,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(h&&h.data){const _=h.data;this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&t.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const w=s.b(_)&&s.$()?_:yield this.readImageNow(_),A={type:this.type,uid:t.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const M=yield t.actor.sendAsync({type:"LDT",data:A});t.dem=M,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(h){if(delete t.abortController,t.aborted)t.state="unloaded";else if(h)throw t.state="errored",h}}))}readImageNow(t){return s._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&s.a0()){const n=t.width+2,o=t.height+2;try{return new s.R({width:n,height:o},yield s.a1(t,-1,-1,n,o))}catch{}}return j.getImageData(t,1)}))}_getNeighboringTiles(t){const n=t.canonical,o=Math.pow(2,n.z),h=(n.x-1+o)%o,_=n.x===0?t.wrap-1:t.wrap,w=(n.x+1+o)%o,A=n.x+1===o?t.wrap+1:t.wrap,M={};return M[new s.a2(t.overscaledZ,_,n.z,h,n.y).key]={backfilled:!1},M[new s.a2(t.overscaledZ,A,n.z,w,n.y).key]={backfilled:!1},n.y>0&&(M[new s.a2(t.overscaledZ,_,n.z,h,n.y-1).key]={backfilled:!1},M[new s.a2(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},M[new s.a2(t.overscaledZ,A,n.z,w,n.y-1).key]={backfilled:!1}),n.y+1<o&&(M[new s.a2(t.overscaledZ,_,n.z,h,n.y+1).key]={backfilled:!1},M[new s.a2(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},M[new s.a2(t.overscaledZ,A,n.z,w,n.y+1).key]={backfilled:!1}),M}unloadTile(t){return s._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function Lr(m){return m.type==="GeometryCollection"?m.geometries.map((t=>t.coordinates)).flat(1/0):m.coordinates.flat(1/0)}function Cr(m){const t=new br;let n;switch(m.type){case"FeatureCollection":n=m.features.map((o=>Lr(o.geometry))).flat(1/0);break;case"Feature":n=Lr(m.geometry);break;default:n=Lr(m)}if(n.length==0)return t;for(let o=0;o<n.length-1;o+=2)t.extend([n[o],n[o+1]]);return t}class li extends s.E{constructor(t,n,o,h){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:n.data},this.actor=o.getActor(),this.setEventedParent(h),this._data=typeof n.data=="string"?{url:n.data}:{geojson:n.data},this._options=s.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId,n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&s.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=s.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(n.buffer!==void 0?n.buffer:128),tolerance:this._pixelsToTileUnits(n.tolerance!==void 0?n.tolerance:.375),extent:s.a5,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(n.clusterMaxZoom),minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.a5,radius:this._pixelsToTileUnits(n.clusterRadius||50),log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(s.a5/this.tileSize)}_getClusterMaxZoom(t){const n=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||s.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${n}"`),n}load(){return s._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,n){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const o=this._updateWorkerData();return n?o:this}updateData(t,n){this._pendingWorkerUpdate.diff=s.a6(this._pendingWorkerUpdate.diff,t);const o=this._updateWorkerData();return n?o:this}getData(){return s._(this,void 0,void 0,(function*(){const t=s.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return s._(this,void 0,void 0,(function*(){return Cr(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,n,o){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:n,offset:o}})}_updateWorkerData(){return s._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void s.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:n}=this._pendingWorkerUpdate,o=this._getLoadGeoJSONParameters(t,n);t!==void 0?this._pendingWorkerUpdate.data=void 0:n&&(this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,yield this._dispatchWorkerUpdate(o)}))}_getLoadGeoJSONParameters(t,n){const o=s.e({type:this.type},this.workerOptions);return typeof t=="string"?(o.request=this.map._requestManager.transformRequest(j.resolveURL(t),"Source"),o.request.collectResourceTiming=this._collectResourceTiming,o):t!==void 0?(o.data=t,o):(n&&(o.dataDiff=n),o)}_dispatchWorkerUpdate(t){return s._(this,void 0,void 0,(function*(){this._isUpdatingWorker=!0,this.fire(new s.l("dataloading",{dataType:"source"}));try{const n=yield this.actor.sendAsync({type:"LD",data:t});if(this._isUpdatingWorker=!1,this._removed||n.abandoned)return void this.fire(new s.l("dataabort",{dataType:"source"}));n.data&&(this._data={geojson:n.data});const o=this._applyDiffToSource(t.dataDiff),h=this._getShouldReloadTileOptions(o),_={dataType:"source"};this._applyResourceTiming(_,n),this.fire(new s.l("data",Object.assign(Object.assign({},_),{sourceDataType:"metadata"}))),this.fire(new s.l("data",Object.assign(Object.assign({},_),{sourceDataType:"content",shouldReloadTileOptions:h})))}catch(n){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new s.l("dataabort",{dataType:"source"}));this.fire(new s.k(n))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyResourceTiming(t,n){var o;if(!this._collectResourceTiming)return;const h=(o=n.resourceTiming)===null||o===void 0?void 0:o[this.id];if(!h)return;const _=h.slice(0);_?.length&&s.e(t,{resourceTiming:_})}_applyDiffToSource(t){if(!t)return;const n=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const h=s.a7(this._data.geojson,n);if(!h)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:h}}if(!this._data.updateable)return;const o=s.a8(this._data.updateable,t,n);return t.removeAll||this._options.cluster?void 0:o}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map((n=>Cr(n)))}}shouldReloadTile(t,{affectedBounds:n}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:o,extent:h}=this.workerOptions.geojsonVtOptions,_=(function({x:w,y:A,z:M},z=0){const O=s.a3((w-z)/Math.pow(2,M)),$=s.a4((A+1+z)/Math.pow(2,M)),G=s.a3((w+1+z)/Math.pow(2,M)),J=s.a4((A-z)/Math.pow(2,M));return new br([O,$],[G,J])})(t.tileID.canonical,o/h);for(const w of n)if(_.intersects(w))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return s._(this,void 0,void 0,(function*(){const n=t.actor?"RT":"LT";t.actor=this.actor;const o={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const h=yield this.actor.sendAsync({type:n,data:o},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(h,this.map.painter,n==="RT")}))}abortTile(t){return s._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return s._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class Gr extends s.E{constructor(t,n,o,h){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=o,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=n}load(t){return s._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield st.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,t&&(this.coordinates=t),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,s.Z(n)||this.fire(new s.k(n))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const n=t.map(s.a9.fromLngLat);var o;return this.tileID=(function(h){const _=s.aa.fromPoints(h),w=_.width(),A=_.height(),M=Math.max(w,A),z=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),O=Math.pow(2,z);return new s.ac(z,Math.floor((_.minX+_.maxX)/2*O),Math.floor((_.minY+_.maxY)/2*O))})(n),this.terrainTileRanges=this._getOverlappingTileRanges(n),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=n.map((h=>this.tileID.getTilePoint(h)._round())),this.flippedWindingOrder=((o=this.tileCoords)[1].x-o[0].x)*(o[2].y-o[0].y)-(o[1].y-o[0].y)*(o[2].x-o[0].x)<0,this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,n=t.gl;this.texture||(this.texture=new s.T(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let o=!1;for(const h in this.tiles){const _=this.tiles[h];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,o=!0)}o&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return s._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:n,minY:o,maxX:h,maxY:_}=s.aa.fromPoints(t),w={};for(let A=0;A<=s.ab;A++){const M=Math.pow(2,A),z=Math.floor(n*M),O=Math.floor(o*M),$=Math.floor(h*M),G=Math.floor(_*M),J=(z%M+M)%M,ce=$%M,be=Math.floor(z/M),Te=Math.floor($/M);w[A]={minWrap:be,maxWrap:Te,minTileXWrapped:J,maxTileXWrapped:ce,minTileY:O,maxTileY:G}}return w}}class Vr extends Gr{constructor(t,n,o,h){super(t,n,o,h),this.roundZoom=!0,this.type="video",this.options=n}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const n of t.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{const n=yield s.ad(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new s.k(n))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new s.k(new s.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let o=!1;for(const h in this.tiles){const _=this.tiles[h];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,o=!0)}o&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ni extends Gr{constructor(t,n,o,h){super(t,n,o,h),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some((_=>!Array.isArray(_)||_.length!==2||_.some((w=>typeof w!="number"))))||this.fire(new s.k(new s.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.k(new s.ae(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new s.k(new s.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new s.k(new s.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.k(new s.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,o=n.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new s.T(n,this.canvas,o.RGBA,{premultiply:!0}),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let h=!1;for(const _ in this.tiles){const w=this.tiles[_];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,h=!0)}h&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const ei={},xr=m=>{switch(m){case"geojson":return li;case"image":return Gr;case"raster":return zr;case"raster-dem":return yr;case"vector":return Yt;case"video":return Vr;case"canvas":return ni}return ei[m]},Qe="RTLPluginLoaded";class W extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Zt()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((n=>{throw this.status="error",n}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return s._(this,arguments,void 0,(function*(n,o=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=j.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!o)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return s._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.l(Qe))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let te=null;function se(){return te||(te=new W),te}var Ce,Oe;(function(m){m[m.Base=0]="Base",m[m.Parent=1]="Parent"})(Ce||(Ce={})),(function(m){m[m.Departing=0]="Departing",m[m.Incoming=1]="Incoming"})(Oe||(Oe={}));class ht{constructor(t,n){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=s.af(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:n,fadingParentID:o,fadeEndTime:h}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=n,this.fadingParentID=o,this.fadeEndTime=h}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=he(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,n,o){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(h,_){const w={};if(!_)return w;for(const A of h){const M=A.layerIds.map((z=>_.getLayer(z))).filter(Boolean);if(M.length!==0){A.layers=M,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map((z=>M.filter((O=>O.id===z))[0])));for(const z of M)w[z.id]=A}}return w})(t.buckets,n?.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const _=this.buckets[h];if(_ instanceof s.ah){if(this.hasSymbolBuckets=!0,!o)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const _=this.buckets[h];if(_ instanceof s.ah&&_.hasRTLText){this.hasRTLText=!0,se().lazyLoad();break}}this.queryPadding=0;for(const h in this.buckets){const _=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(h).queryRadius(_))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new s.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const o in this.buckets){const h=this.buckets[o];h.uploadPending()&&h.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new s.T(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,o,h,_,w,A,M,z,O,$){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:_,scale:w,tileSize:this.tileSize,pixelPosMatrix:O,transform:M,params:A,queryPadding:this.queryPadding*z,getElevation:$},t,n,o):{}}querySourceFeatures(t,n){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const h=o.loadVTLayers(),_=n&&n.sourceLayer?n.sourceLayer:"",w=h[s.ai]||h[_];if(!w)return;const A=s.aj(n?.filter,n?.globalState),{z:M,x:z,y:O}=this.tileID.canonical,$={z:M,x:z,y:O};for(let G=0;G<w.length;G++){const J=w.feature(G);if(A.needGeometry){const Te=s.ak(J,!0);if(!A.filter(new s.H(this.tileID.overscaledZ),Te,this.tileID.canonical))continue}else if(!A.filter(new s.H(this.tileID.overscaledZ),J))continue;const ce=o.getId(J,_),be=new s.al(J,M,z,O,ce);be.tile=$,t.push(be)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const o=s.am(t.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const o=Date.now();let h=!1;if(this.expirationTime>o)h=!1;else if(n)if(this.expirationTime<n)h=!0;else{const _=this.expirationTime-n;_?this.expirationTime=o+Math.max(_,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const o=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!n.style.hasLayer(h))continue;const _=this.buckets[h],w=_.layers[0].sourceLayer||s.ai,A=o[w],M=t[w];if(!A||!M||Object.keys(M).length===0)continue;_.update(M,A,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const z=n&&n.style&&n.style.getLayer(h);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(_)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<he()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=he()+t}setDependencies(t,n){const o={};for(const h of n)o[h]=!0;this.dependencies[t]=o}hasDependency(t,n){for(const o of t){const h=this.dependencies[o];if(h){for(const _ of n)if(h[_])return!0}}return!1}}class Y{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,o){const h=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},s.e(this.stateChanges[t][h],o),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==h&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][h]===null){this.deletedStates[t][h]={};for(const _ in this.state[t][h])o[_]||(this.deletedStates[t][h][_]=null)}else for(const _ in o)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][_]===null&&delete this.deletedStates[t][h][_]}removeFeatureState(t,n,o){if(this.deletedStates[t]===null)return;const h=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},o&&n!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][o]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(o in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][o]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,n){const o=String(n),h=s.e({},(this.state[t]||{})[o],(this.stateChanges[t]||{})[o]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const _=this.deletedStates[t][n];if(_===null)return{};for(const w in _)delete h[w]}return h}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const o={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const _={};for(const w in this.stateChanges[h])this.state[h][w]||(this.state[h][w]={}),s.e(this.state[h][w],this.stateChanges[h][w]),_[w]=this.state[h][w];o[h]=_}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const _={};if(this.deletedStates[h]===null)for(const w in this.state[h])_[w]={},this.state[h][w]={};else for(const w in this.deletedStates[h]){if(this.deletedStates[h][w]===null)this.state[h][w]={};else for(const A of Object.keys(this.deletedStates[h][w]))delete this.state[h][w][A];_[w]=this.state[h][w]}o[h]=o[h]||{},s.e(o[h],_)}this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0&&t.setFeatureState(o,n)}}const P=89.25;function k(m,t){const n=s.an(t.lat,-s.ao,s.ao);return new s.P(s.Y(t.lng)*m,s.X(n)*m)}function ee(m,t){return new s.a9(t.x/m,t.y/m).toLngLat()}function le(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(s.ap(90-m.pitch)),Math.tan(s.ap(P-m.pitch)))}function ge(m,t){const n=m.canonical,o=t/s.aq(n.z),h=n.x+Math.pow(2,n.z)*m.wrap,_=s.ar(new Float64Array(16));return s.O(_,_,[h*o,n.y*o,0]),s.Q(_,_,[o/s.a5,o/s.a5,1]),_}function ie(m,t,n,o,h){const _=s.a9.fromLngLat(m,t),w=h*s.as(1,m.lat),{x:A,y:M,z}=ot(n,o);return new s.a9(_.x+w*-A,_.y+w*-M,_.z+w*-z)}function ot(m,t){const n=s.ap(m),o=s.ap(t),h=Math.cos(-n),_=Math.sin(n);return{x:_*Math.sin(o),y:-_*Math.cos(o),z:h}}function Mt(m,t,n){const o=t.intersectsFrustum(m);if(!n||o===0)return o;const h=t.intersectsPlane(n);return h===0?0:o===2&&h===2?2:1}function ct(m,t,n){let o=0;const h=(n-t)/10;for(let _=0;_<10;_++)o+=h*Math.pow(Math.cos(t+(_+.5)/10*(n-t)),m);return o}function dt(m,t){return function(n,o,h,_,w){const A=2*((m-1)/s.at(Math.cos(s.ap(P-w))/Math.cos(s.ap(P)))-1),M=Math.acos(h/_),z=2*ct(A-1,0,s.ap(w/2)),O=Math.min(s.ap(P),M+s.ap(w/2)),$=ct(A-1,Math.min(O,M-s.ap(w/2)),O),G=Math.atan(o/h),J=Math.hypot(o,h);let ce=n;return ce+=s.at(_/J/Math.max(.5,Math.cos(s.ap(w/2)))),ce+=A*s.at(Math.cos(G))/2,ce-=s.at(Math.max(1,$/z/t))/2,ce}}const Dt=dt(9.314,3);function Ct(m,t){const n=(t.roundZoom?Math.round:Math.floor)(m.zoom+s.at(m.tileSize/t.tileSize));return Math.max(0,n)}function Ht(m,t){const n=m.getCameraFrustum(),o=m.getClippingPlane(),h=m.screenPointToMercatorCoordinate(m.getCameraPoint()),_=s.a9.fromLngLat(m.center,m.elevation);h.z=_.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;const w=m.getCoveringTilesDetailsProvider(),A=w.allowVariableZoom(m,t),M=Ct(m,t),z=t.minzoom||0,O=t.maxzoom!==void 0?t.maxzoom:m.maxZoom,$=Math.min(Math.max(0,M),O),G=Math.pow(2,$),J=[G*h.x,G*h.y,0],ce=[G*_.x,G*_.y,0],be=Math.hypot(_.x-h.x,_.y-h.y),Te=Math.abs(_.z-h.z),Se=Math.hypot(be,Te),Me=Xe=>({zoom:0,x:0,y:0,wrap:Xe,fullyVisible:!1}),He=[],Ee=[];if(m.renderWorldCopies&&w.allowWorldCopies())for(let Xe=1;Xe<=3;Xe++)He.push(Me(-Xe)),He.push(Me(Xe));for(He.push(Me(0));He.length>0;){const Xe=He.pop(),et=Xe.x,qe=Xe.y;let lt=Xe.fullyVisible;const At={x:et,y:qe,z:Xe.zoom},vt=w.getTileBoundingVolume(At,Xe.wrap,m.elevation,t);if(!lt){const rr=Mt(n,vt,o);if(rr===0)continue;lt=rr===2}const St=w.distanceToTile2d(h.x,h.y,At,vt);let Pt=M;A&&(Pt=(t.calculateTileZoom||Dt)(m.zoom+s.at(m.tileSize/t.tileSize),St,Te,Se,m.fov)),Pt=(t.roundZoom?Math.round:Math.floor)(Pt),Pt=Math.max(0,Pt);const er=Math.min(Pt,O);if(Xe.wrap=w.getWrap(_,At,Xe.wrap),Xe.zoom>=er){if(Xe.zoom<z)continue;const rr=$-Xe.zoom,$t=J[0]-.5-(et<<rr),nr=J[1]-.5-(qe<<rr),Hr=t.reparseOverscaled?Math.max(Xe.zoom,Pt):Xe.zoom;Ee.push({tileID:new s.a2(Xe.zoom===O?Hr:Xe.zoom,Xe.wrap,Xe.zoom,et,qe),distanceSq:s.au([ce[0]-.5-et,ce[1]-.5-qe]),tileDistanceToCamera:Math.sqrt($t*$t+nr*nr)})}else for(let rr=0;rr<4;rr++)He.push({zoom:Xe.zoom+1,x:(et<<1)+rr%2,y:(qe<<1)+(rr>>1),wrap:Xe.wrap,fullyVisible:lt})}return Ee.sort(((Xe,et)=>Xe.distanceSq-et.distanceSq)).map((Xe=>Xe.tileID))}const Gt=s.aa.fromPoints([new s.P(0,0),new s.P(s.a5,s.a5)]);function dr(m){return m==="raster"||m==="image"||m==="video"}function vr(m,t,n,o,h,_,w){if(!t.hasData())return!1;const{tileID:A,fadingRole:M,fadingDirection:z,fadingParentID:O}=t;if(M===Ce.Base&&z===Oe.Incoming&&O)return n[O.key]=O,!0;const $=Math.max(A.overscaledZ-h,_);for(let G=A.overscaledZ-1;G>=$;G--){const J=A.scaledTo(G),ce=m.getLoadedTile(J);if(ce)return t.setCrossFadeLogic({fadingRole:Ce.Base,fadingDirection:Oe.Incoming,fadingParentID:ce.tileID,fadeEndTime:o+w}),ce.setCrossFadeLogic({fadingRole:Ce.Parent,fadingDirection:Oe.Departing,fadeEndTime:o+w}),n[J.key]=J,!0}return!1}function Nr(m,t,n,o,h,_){if(!t.hasData())return!1;const w=t.tileID.children(h);let A=Lt(m,t,w,n,o,h,_);if(A)return!0;for(const M of w)Lt(m,t,M.children(h),n,o,h,_)&&(A=!0);return A}function Lt(m,t,n,o,h,_,w){if(n[0].overscaledZ>=_)return!1;let A=!1;for(const M of n){const z=m.getLoadedTile(M);if(!z)continue;const{fadingRole:O,fadingDirection:$,fadingParentID:G}=z;O===Ce.Base&&$===Oe.Departing&&G||(z.setCrossFadeLogic({fadingRole:Ce.Base,fadingDirection:Oe.Departing,fadingParentID:t.tileID,fadeEndTime:h+w}),t.setCrossFadeLogic({fadingRole:Ce.Parent,fadingDirection:Oe.Incoming,fadeEndTime:h+w})),o[M.key]=M,A=!0}return A}function wr(m,t,n,o){const h=m.tileID;return!!m.selfFading||!m.hasData()&&!!t.has(h)&&(m.setSelfFadeLogic(n+o),!0)}function zi(m,t){var n;m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let o=t.tileID.canonical.x-m.tileID.canonical.x;const h=t.tileID.canonical.y-m.tileID.canonical.y,_=Math.pow(2,m.tileID.canonical.z),w=t.tileID.key;o===0&&h===0||Math.abs(h)>1||(Math.abs(o)>1&&(Math.abs(o+_)===1?o+=_:Math.abs(o-_)===1&&(o-=_)),t.dem&&m.dem&&(m.dem.backfillBorder(t.dem,o,h),!((n=m.neighboringTiles)===null||n===void 0)&&n[w]&&(m.neighboringTiles[w].backfilled=!0)))}class fn{constructor(){this._tiles={}}handleWrapJump(t){const n={};for(const o in this._tiles){const h=this._tiles[o];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+t),n[h.tileID.key]=h}this._tiles=n}setFeatureState(t,n){for(const o in this._tiles)this._tiles[o].setFeatureState(t,n)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((n=>n.tileID)).sort(s.aw).map((n=>n.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,n){this._tiles[t]=n}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const n=this.getTileById(t.key);return n?.hasData()?n:null}isIdRenderable(t,n=!1){var o;return(o=this.getTileById(t))===null||o===void 0?void 0:o.isRenderable(n)}getRenderableIds(t=0,n){const o=[];for(const h of this.getAllIds())this.isIdRenderable(h,n)&&o.push(this.getTileById(h));return n?o.sort(((h,_)=>{const w=h.tileID,A=_.tileID,M=new s.P(w.canonical.x,w.canonical.y)._rotate(-t),z=new s.P(A.canonical.x,A.canonical.y)._rotate(-t);return w.overscaledZ-A.overscaledZ||z.y-M.y||z.x-M.x})).map((h=>h.tileID.key)):o.map((h=>h.tileID)).sort(s.aw).map((h=>h.key))}}class mi extends s.E{constructor(t,n,o){super(),this.id=t,this.dispatcher=o,this.on("data",(h=>this._dataHandler(h))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((h,_,w,A)=>{const M=new(xr(_.type))(h,_,w,A);if(M.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${M.id}`);return M})(t,n,o,this),this._inViewTiles=new fn,this._outOfViewCache=new s.ax(0,(h=>this._unloadTile(h))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Y,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const n of this._inViewTiles.getAllTiles())n.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new fn}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n,o){return s._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,n,o)}catch(h){t.state="errored",h.status!==404?this._source.fire(new s.k(h,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new s.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const n of this._inViewTiles.getAllTiles())n.upload(t),n.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var n;return this._inViewTiles.getRenderableIds((n=this.transform)===null||n===void 0?void 0:n.bearingInRadians,t)}hasRenderableParent(t){const n=t.overscaledZ-1;if(n>=this._source.minzoom){const o=this.getLoadedTile(t.scaledTo(n));if(o)return this._inViewTiles.isIdRenderable(o.tileID.key)}return!1}reload(t,n=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const o of this._inViewTiles.getAllIds()){const h=this._inViewTiles.getTileById(o);n&&!this._source.shouldReloadTile(h,n)||(t?this._reloadTile(o,"expired"):h.state!=="errored"&&this._reloadTile(o,"reloading"))}}}_reloadTile(t,n){return s._(this,void 0,void 0,(function*(){const o=this._inViewTiles.getTileById(t);o&&(o.state!=="loading"&&(o.state=n),yield this._loadTile(o,t,n))}))}_tileLoaded(t,n,o){t.timeAdded=he(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),o==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&(function(h,_){var w,A;const M=_.getRenderableIds();for(const z of M){if(!h.neighboringTiles||!h.neighboringTiles[z])continue;const O=_.getTileById(z);h.neighboringTiles[z].backfilled||zi(h,O),!((A=(w=O.neighboringTiles)===null||w===void 0?void 0:w[h.tileID.key])===null||A===void 0)&&A.backfilled||zi(O,h)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new s.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,n){const o=this._getLoadedDescendents(n),h=new Set;for(const _ of n){const w=o[_.key];if(!w?.length){h.add(_);continue}const A=_.overscaledZ+mi.maxOverzooming,M=w.filter(($=>$.tileID.overscaledZ<=A));if(!M.length){h.add(_);continue}const z=Math.min(...M.map(($=>$.tileID.overscaledZ))),O=M.filter(($=>$.tileID.overscaledZ===z)).map(($=>$.tileID));for(const $ of O)t[$.key]=$;this._areDescendentsComplete(O,z,_.overscaledZ)||h.add(_)}return h}_getLoadedDescendents(t){var n;const o={};for(const h of this._inViewTiles.getAllTiles().filter((_=>_.hasData())))for(const _ of t)h.tileID.isChildOf(_)&&(o[n=_.key]||(o[n]=[])).push(h);return o}_areDescendentsComplete(t,n,o){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===n:Math.pow(4,n-o)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,o=Math.ceil(t.height/this._source.tileSize)+1,h=Math.floor(n*o*(this._maxTileCacheZoomLevels===null?s.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._outOfViewCache.setMaxSize(_)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,n&&(this._inViewTiles.handleWrapJump(n),this._resetTileReloadTimers())}update(t,n){if(!this._sourceLoaded||this._paused)return;let o;this.transform=t,this.terrain=n,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?o=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((M=>new s.a2(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y))):(o=Ht(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(o=o.filter((M=>this._source.hasTile(M))))):o=[],this.usedForTerrain&&(o=this._addTerrainIdealTiles(o));const h=o.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,h&&this.fire(new s.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const _=Ct(t,this._source),w=this._updateRetainedTiles(o,_),A=dr(this._source.type);A&&this._rasterFadeDuration>0&&!n&&(function(M,z,O,$,G,J,ce){const be=he(),Te=s.av(z);for(const Se of z){const Me=M.getTileById(Se.key);Me.fadingDirection!==Oe.Departing&&Me.fadeOpacity!==0||Me.resetFadeLogic(),vr(M,Me,O,be,$,G,ce)||Nr(M,Me,O,be,J,ce)||wr(Me,Te,be,ce)||Me.resetFadeLogic()}})(this._inViewTiles,o,w,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),A?this._cleanUpRasterTiles(w):this._cleanUpVectorTiles(w)}_cleanUpRasterTiles(t){for(const n of this._inViewTiles.getAllIds())t[n]||this._removeTile(n)}_cleanUpVectorTiles(t){for(const n of this._inViewTiles.getAllIds()){const o=this._inViewTiles.getTileById(n);t[n]?o.clearSymbolFadeHold():o.hasSymbolBuckets?o.holdingForSymbolFade()?o.symbolFadeFinished()&&this._removeTile(n):o.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(n)}}_addTerrainIdealTiles(t){const n=[];for(const o of t)if(o.canonical.z>this._source.minzoom){const h=o.scaledTo(o.canonical.z-1);n.push(h);const _=o.scaledTo(Math.max(this._source.minzoom,Math.min(o.canonical.z,5)));n.push(_)}return t.concat(n)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){var o;const h=new Set;for(const z of t)this._addTile(z).hasData()||h.add(z);const _=t.reduce(((z,O)=>(z[O.key]=O,z)),{}),w=this._retainLoadedChildren(_,h),A={},M=Math.max(n-mi.maxUnderzooming,this._source.minzoom);for(const z of w){let O=this._inViewTiles.getTileById(z.key),$=O?.wasRequested();for(let G=z.overscaledZ-1;G>=M;--G){const J=z.scaledTo(G);if(A[J.key])break;if(A[J.key]=!0,O=this.getTile(J),!O&&$&&(O=this._addTile(J)),O){const ce=O.hasData();if((ce||!(!((o=this.map)===null||o===void 0)&&o.cancelPendingTileRequestsWhileZooming)||$)&&(_[J.key]=J),$=O.wasRequested(),ce)break}}}return _}_addTile(t){let n=this._inViewTiles.getTileById(t.key);if(n)return n;n=this._outOfViewCache.getAndRemove(t),n&&(n.resetFadeLogic(),this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null));const o=n;return n||(n=new ht(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,t.key,n.state)),n.uses++,this._inViewTiles.setTile(t.key,n),o||this._source.fire(new s.l("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){this._clearTileReloadTimer(t);const o=n.getExpiryTimeout();o&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),o))}_clearTileReloadTimer(t){const n=this._timers[t];n&&(clearTimeout(n),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const n=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,n)}}refreshTiles(t){for(const n of this._inViewTiles.getAllIds()){const o=this._inViewTiles.getTileById(n);(this._inViewTiles.isIdRenderable(n)||o.state=="errored")&&t.some((h=>h.equals(o.tileID.canonical)))&&this._reloadTile(n,"expired")}}_removeTile(t){const n=this._inViewTiles.getTileById(t);n&&(n.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._outOfViewCache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,n,o){const h=[],_=this.transform;if(!_)return h;const w=_.getCoveringTilesDetailsProvider().allowWorldCopies(),A=o?_.getCameraQueryGeometry(t):t,M=J=>_.screenPointToMercatorCoordinate(J,this.terrain),z=this.transformBbox(t,M,!w),O=this.transformBbox(A,M,!w),$=this.getIds(),G=s.aa.fromPoints(O);for(let J=0;J<$.length;J++){const ce=this._inViewTiles.getTileById($[J]);if(ce.holdingForSymbolFade())continue;const be=w?[ce.tileID]:[ce.tileID.unwrapTo(-1),ce.tileID.unwrapTo(0)],Te=Math.pow(2,_.zoom-ce.tileID.overscaledZ),Se=n*ce.queryPadding*s.a5/ce.tileSize/Te;for(const Me of be){const He=G.map((Ee=>Me.getTilePoint(new s.a9(Ee.x,Ee.y))));if(He.expandBy(Se),He.intersects(Gt)){const Ee=z.map((et=>Me.getTilePoint(et))),Xe=O.map((et=>Me.getTilePoint(et)));h.push({tile:ce,tileID:w?Me:Me.unwrapTo(0),queryGeometry:Ee,cameraQueryGeometry:Xe,scale:Te})}}}return h}transformBbox(t,n,o){let h=t.map(n);if(o){const _=s.aa.fromPoints(t);_.shrinkBy(.001*Math.min(_.width(),_.height()));const w=_.map(n);s.aa.fromPoints(h).covers(w)||(h=h.map((A=>A.x>.5?new s.a9(A.x-1,A.y,A.z):A)))}return h}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map((o=>this._inViewTiles.getTileById(o).tileID));return this.transform&&this.transform.populateCache(n),n}hasTransition(){return!!this._source.hasTransition()||!(!dr(this._source.type)||!(function(t,n){if(n<=0)return!1;const o=he();for(const h of t.getAllTiles())if(h.fadeEndTime>=o)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,n,o){this._state.updateState(t=t||s.ai,n,o)}removeFeatureState(t,n,o){this._state.removeFeatureState(t=t||s.ai,n,o)}getFeatureState(t,n){return this._state.getState(t=t||s.ai,n)}setDependencies(t,n,o){const h=this._inViewTiles.getTileById(t);h&&h.setDependencies(n,o)}reloadTilesForDependencies(t,n){for(const o of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(o).hasDependency(t,n)&&this._reloadTile(o,"reloading");this._outOfViewCache.filter((o=>!o.hasDependency(t,n)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}mi.maxUnderzooming=10,mi.maxOverzooming=3;class Xt{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.an(t,0,1);let n=1,o=this._distances[n];const h=t*this.paddedLength+this.padding;for(;o<h&&n<this._distances.length;)o=this._distances[++n];const _=n-1,w=this._distances[_],A=o-w,M=A>0?(h-w)/A:0;return this.points[_].mult(1-M).add(this.points[n].mult(M))}}function Er(m,t){let n=!0;return m==="always"||m!=="never"&&t!=="never"||(n=!1),n}class Rr{constructor(t,n,o){const h=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/o),this.yCellCount=Math.ceil(n/o);for(let w=0;w<this.xCellCount*this.yCellCount;w++)h.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,o,h,_){this._forEachCell(n,o,h,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(_)}insertCircle(t,n,o,h){this._forEachCell(n-h,o-h,n+h,o+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(o),this.circles.push(h)}_insertBoxCell(t,n,o,h,_,w){this.boxCells[_].push(w)}_insertCircleCell(t,n,o,h,_,w){this.circleCells[_].push(w)}_query(t,n,o,h,_,w,A){if(o<0||t>this.width||h<0||n>this.height)return[];const M=[];if(t<=0&&n<=0&&this.width<=o&&this.height<=h){if(_)return[{key:null,x1:t,y1:n,x2:o,y2:h}];for(let z=0;z<this.boxKeys.length;z++)M.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const O=this.circles[3*z],$=this.circles[3*z+1],G=this.circles[3*z+2];M.push({key:this.circleKeys[z],x1:O-G,y1:$-G,x2:O+G,y2:$+G})}}else this._forEachCell(t,n,o,h,this._queryCell,M,{hitTest:_,overlapMode:w,seenUids:{box:{},circle:{}}},A);return M}query(t,n,o,h){return this._query(t,n,o,h,!1,null)}hitTest(t,n,o,h,_,w){return this._query(t,n,o,h,!0,_,w).length>0}hitTestCircle(t,n,o,h,_){const w=t-o,A=t+o,M=n-o,z=n+o;if(A<0||w>this.width||z<0||M>this.height)return!1;const O=[];return this._forEachCell(w,M,A,z,this._queryCellCircle,O,{hitTest:!0,overlapMode:h,circle:{x:t,y:n,radius:o},seenUids:{box:{},circle:{}}},_),O.length>0}_queryCell(t,n,o,h,_,w,A,M){const{seenUids:z,hitTest:O,overlapMode:$}=A,G=this.boxCells[_];if(G!==null){const ce=this.bboxes;for(const be of G)if(!z.box[be]){z.box[be]=!0;const Te=4*be,Se=this.boxKeys[be];if(t<=ce[Te+2]&&n<=ce[Te+3]&&o>=ce[Te+0]&&h>=ce[Te+1]&&(!M||M(Se))&&(!O||!Er($,Se.overlapMode))&&(w.push({key:Se,x1:ce[Te],y1:ce[Te+1],x2:ce[Te+2],y2:ce[Te+3]}),O))return!0}}const J=this.circleCells[_];if(J!==null){const ce=this.circles;for(const be of J)if(!z.circle[be]){z.circle[be]=!0;const Te=3*be,Se=this.circleKeys[be];if(this._circleAndRectCollide(ce[Te],ce[Te+1],ce[Te+2],t,n,o,h)&&(!M||M(Se))&&(!O||!Er($,Se.overlapMode))){const Me=ce[Te],He=ce[Te+1],Ee=ce[Te+2];if(w.push({key:Se,x1:Me-Ee,y1:He-Ee,x2:Me+Ee,y2:He+Ee}),O)return!0}}}return!1}_queryCellCircle(t,n,o,h,_,w,A,M){const{circle:z,seenUids:O,overlapMode:$}=A,G=this.boxCells[_];if(G!==null){const ce=this.bboxes;for(const be of G)if(!O.box[be]){O.box[be]=!0;const Te=4*be,Se=this.boxKeys[be];if(this._circleAndRectCollide(z.x,z.y,z.radius,ce[Te+0],ce[Te+1],ce[Te+2],ce[Te+3])&&(!M||M(Se))&&!Er($,Se.overlapMode))return w.push(!0),!0}}const J=this.circleCells[_];if(J!==null){const ce=this.circles;for(const be of J)if(!O.circle[be]){O.circle[be]=!0;const Te=3*be,Se=this.circleKeys[be];if(this._circlesCollide(ce[Te],ce[Te+1],ce[Te+2],z.x,z.y,z.radius)&&(!M||M(Se))&&!Er($,Se.overlapMode))return w.push(!0),!0}}}_forEachCell(t,n,o,h,_,w,A,M){const z=this._convertToXCellCoord(t),O=this._convertToYCellCoord(n),$=this._convertToXCellCoord(o),G=this._convertToYCellCoord(h);for(let J=z;J<=$;J++)for(let ce=O;ce<=G;ce++)if(_.call(this,t,n,o,h,this.xCellCount*ce+J,w,A,M))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,o,h,_,w){const A=h-t,M=_-n,z=o+w;return z*z>A*A+M*M}_circleAndRectCollide(t,n,o,h,_,w,A){const M=(w-h)/2,z=Math.abs(t-(h+M));if(z>M+o)return!1;const O=(A-_)/2,$=Math.abs(n-(_+O));if($>O+o)return!1;if(z<=M||$<=O)return!0;const G=z-M,J=$-O;return G*G+J*J<=o*o}}function Ni(m,t,n){const o=s.N();if(!m){const{vecSouth:$,vecEast:G}=Dn(t),J=F();J[0]=G[0],J[1]=G[1],J[2]=$[0],J[3]=$[1],h=J,(O=(w=(_=J)[0])*(z=_[3])-(M=_[2])*(A=_[1]))&&(h[0]=z*(O=1/O),h[1]=-A*O,h[2]=-M*O,h[3]=w*O),o[0]=J[0],o[1]=J[1],o[4]=J[2],o[5]=J[3]}var h,_,w,A,M,z,O;return s.Q(o,o,[1/n,1/n,1]),o}function Rs(m,t,n,o){if(m){const h=s.N();if(!t){const{vecSouth:_,vecEast:w}=Dn(n);h[0]=w[0],h[1]=w[1],h[4]=_[0],h[5]=_[1]}return s.Q(h,h,[o,o,1]),h}return n.pixelsToClipSpaceMatrix}function Dn(m){const t=Math.cos(m.rollInRadians),n=Math.sin(m.rollInRadians),o=Math.cos(m.pitchInRadians),h=Math.cos(m.bearingInRadians),_=Math.sin(m.bearingInRadians),w=s.aC();w[0]=-h*o*n-_*t,w[1]=-_*o*n+h*t;const A=s.aD(w);A<1e-9?s.aE(w):s.aF(w,w,1/A);const M=s.aC();M[0]=h*o*t-_*n,M[1]=_*o*t+h*n;const z=s.aD(M);return z<1e-9?s.aE(M):s.aF(M,M,1/z),{vecEast:M,vecSouth:w}}function $r(m,t,n,o){let h;o?(h=[m,t,o(m,t),1],s.aH(h,h,n)):(h=[m,t,0,1],pl(h,h,n));const _=h[3];return{point:new s.P(h[0]/_,h[1]/_),signedDistanceFromCamera:_,isOccluded:!1}}function wa(m,t){return .5+m/t*.5}function Sa(m,t){return m.x>=-t[0]&&m.x<=t[0]&&m.y>=-t[1]&&m.y<=t[1]}function Ua(m,t,n,o,h,_,w,A,M,z,O,$,G){const J=n?m.textSizeData:m.iconSizeData,ce=s.ay(J,t.transform.zoom),be=[256/t.width*2+1,256/t.height*2+1],Te=n?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;Te.clear();const Se=m.lineVertexArray,Me=n?m.text.placedSymbolArray:m.icon.placedSymbolArray,He=t.transform.width/t.transform.height;let Ee=!1;for(let Xe=0;Xe<Me.length;Xe++){const et=Me.get(Xe);if(et.hidden||et.writingMode===s.az.vertical&&!Ee){Bs(et.numGlyphs,Te);continue}Ee=!1;const qe=new s.P(et.anchorX,et.anchorY),lt={getElevation:G,pitchedLabelPlaneMatrix:o,lineVertexArray:Se,pitchWithMap:_,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:qe,unwrappedTileID:M,width:z,height:O,translation:$},At=Ta(et.anchorX,et.anchorY,lt);if(!Sa(At.point,be)){Bs(et.numGlyphs,Te);continue}const vt=wa(t.transform.cameraToCenterDistance,At.signedDistanceFromCamera),St=s.aA(J,ce,et),Pt=_?St*t.transform.getPitchedTextCorrection(et.anchorX,et.anchorY,M)/vt:St*vt,er=Ga({projectionContext:lt,pitchedLabelPlaneMatrixInverse:h,symbol:et,fontSize:Pt,flip:!1,keepUpright:w,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:Te,aspectRatio:He,rotateToLine:A});Ee=er.useVertical,(er.notEnoughRoom||Ee||er.needsFlipping&&Ga({projectionContext:lt,pitchedLabelPlaneMatrixInverse:h,symbol:et,fontSize:Pt,flip:!0,keepUpright:w,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:Te,aspectRatio:He,rotateToLine:A}).notEnoughRoom)&&Bs(et.numGlyphs,Te)}n?m.text.dynamicLayoutVertexBuffer.updateData(Te):m.icon.dynamicLayoutVertexBuffer.updateData(Te)}function ho(m,t,n,o,h,_,w,A){const M=_.glyphStartIndex+_.numGlyphs,z=_.lineStartIndex,O=_.lineStartIndex+_.lineLength,$=t.getoffsetX(_.glyphStartIndex),G=t.getoffsetX(M-1),J=ds(m*$,n,o,h,_.segment,z,O,A,w);if(!J)return null;const ce=ds(m*G,n,o,h,_.segment,z,O,A,w);return ce?A.projectionCache.anyProjectionOccluded?null:{first:J,last:ce}:null}function qa(m,t,n,o){return m===s.az.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*o?{useVertical:!0}:(m===s.az.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function Ga(m){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:n,symbol:o,fontSize:h,flip:_,keepUpright:w,glyphOffsetArray:A,dynamicLayoutVertexArray:M,aspectRatio:z,rotateToLine:O}=m,$=h/24,G=o.lineOffsetX*$,J=o.lineOffsetY*$;let ce;if(o.numGlyphs>1){const be=o.glyphStartIndex+o.numGlyphs,Te=o.lineStartIndex,Se=o.lineStartIndex+o.lineLength,Me=ho($,A,G,J,_,o,O,t);if(!Me)return{notEnoughRoom:!0};const He=Bo(Me.first.point.x,Me.first.point.y,t,n),Ee=Bo(Me.last.point.x,Me.last.point.y,t,n);if(w&&!_){const Xe=qa(o.writingMode,He,Ee,z);if(Xe)return Xe}ce=[Me.first];for(let Xe=o.glyphStartIndex+1;Xe<be-1;Xe++){const et=ds($*A.getoffsetX(Xe),G,J,_,o.segment,Te,Se,t,O);if(!et)return{notEnoughRoom:!0};ce.push(et)}ce.push(Me.last)}else{if(w&&!_){const Te=gi(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,Se=o.lineStartIndex+o.segment+1,Me=new s.P(t.lineVertexArray.getx(Se),t.lineVertexArray.gety(Se)),He=gi(Me.x,Me.y,t),Ee=He.signedDistanceFromCamera>0?He.point:fo(t.tileAnchorPoint,Me,Te,1,t),Xe=Bo(Te.x,Te.y,t,n),et=Bo(Ee.x,Ee.y,t,n),qe=qa(o.writingMode,Xe,et,z);if(qe)return qe}const be=ds($*A.getoffsetX(o.glyphStartIndex),G,J,_,o.segment,o.lineStartIndex,o.lineStartIndex+o.lineLength,t,O);if(!be||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ce=[be]}for(const be of ce)s.aG(M,be.point,be.angle);return{}}function fo(m,t,n,o,h){const _=m.add(m.sub(t)._unit()),w=gi(_.x,_.y,h).point,A=n.sub(w);return n.add(A._mult(o/A.mag()))}function Ri(m,t,n){const o=t.projectionCache;if(o.projections[m])return o.projections[m];const h=new s.P(t.lineVertexArray.getx(m),t.lineVertexArray.gety(m)),_=gi(h.x,h.y,t);if(_.signedDistanceFromCamera>0)return o.projections[m]=_.point,o.anyProjectionOccluded=o.anyProjectionOccluded||_.isOccluded,_.point;const w=m-n.direction;return fo(n.distanceFromAnchor===0?t.tileAnchorPoint:new s.P(t.lineVertexArray.getx(w),t.lineVertexArray.gety(w)),h,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,t)}function gi(m,t,n){const o=m+n.translation[0],h=t+n.translation[1];let _;return n.pitchWithMap?(_=$r(o,h,n.pitchedLabelPlaneMatrix,n.getElevation),_.isOccluded=!1):(_=n.transform.projectTileCoordinates(o,h,n.unwrappedTileID,n.getElevation),_.point.x=(.5*_.point.x+.5)*n.width,_.point.y=(.5*-_.point.y+.5)*n.height),_}function Bo(m,t,n,o){if(n.pitchWithMap){const h=[m,t,0,1];return s.aH(h,h,o),n.transform.projectTileCoordinates(h[0]/h[3],h[1]/h[3],n.unwrappedTileID,n.getElevation).point}return{x:m/n.width*2-1,y:1-t/n.height*2}}function Ta(m,t,n){return n.transform.projectTileCoordinates(m,t,n.unwrappedTileID,n.getElevation)}function po(m,t,n){return m._unit()._perp()._mult(t*n)}function Pa(m,t,n,o,h,_,w,A,M){if(A.projectionCache.offsets[m])return A.projectionCache.offsets[m];const z=n.add(t);if(m+M.direction<o||m+M.direction>=h)return A.projectionCache.offsets[m]=z,z;const O=Ri(m+M.direction,A,M),$=po(O.sub(n),w,M.direction),G=n.add($),J=O.add($);return A.projectionCache.offsets[m]=s.aI(_,z,G,J)||z,A.projectionCache.offsets[m]}function ds(m,t,n,o,h,_,w,A,M){const z=o?m-t:m+t;let O=z>0?1:-1,$=0;o&&(O*=-1,$=Math.PI),O<0&&($+=Math.PI);let G,J=O>0?_+h:_+h+1;A.projectionCache.cachedAnchorPoint?G=A.projectionCache.cachedAnchorPoint:(G=gi(A.tileAnchorPoint.x,A.tileAnchorPoint.y,A).point,A.projectionCache.cachedAnchorPoint=G);let ce,be,Te=G,Se=G,Me=0,He=0;const Ee=Math.abs(z),Xe=[];let et;for(;Me+He<=Ee;){if(J+=O,J<_||J>=w)return null;Me+=He,Se=Te,be=ce;const At={absOffsetX:Ee,direction:O,distanceFromAnchor:Me,previousVertex:Se};if(Te=Ri(J,A,At),n===0)Xe.push(Se),et=Te.sub(Se);else{let vt;const St=Te.sub(Se);vt=St.mag()===0?po(Ri(J+O,A,At).sub(Te),n,O):po(St,n,O),be||(be=Se.add(vt)),ce=Pa(J,vt,Te,_,w,be,n,A,At),Xe.push(be),et=ce.sub(be)}He=et.mag()}const qe=et._mult((Ee-Me)/He)._add(be||Se),lt=$+Math.atan2(Te.y-Se.y,Te.x-Se.x);return Xe.push(qe),{point:qe,angle:M?lt:0,path:Xe}}const oa=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Bs(m,t){for(let n=0;n<m;n++){const o=t.length;t.resize(o+4),t.float32.set(oa,3*o)}}function pl(m,t,n){const o=t[0],h=t[1];return m[0]=n[0]*o+n[4]*h+n[12],m[1]=n[1]*o+n[5]*h+n[13],m[3]=n[3]*o+n[7]*h+n[15],m}const ri=100;class Gl{constructor(t,n=new Rr(t.width+200,t.height+200,25),o=new Rr(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=o,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ri,this.screenBottomBoundary=t.height+ri,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,o,h,_,w,A,M,z,O,$,G){const J=this.projectAndGetPerspectiveRatio(t.anchorPointX+M[0],t.anchorPointY+M[1],_,O,G),ce=o*J.perspectiveRatio;let be;if(w||A)be=this._projectCollisionBox(t,ce,h,_,w,A,M,J,O,$,G);else{const et=J.x+($?$.x*ce:0),qe=J.y+($?$.y*ce:0);be={allPointsOccluded:!1,box:[et+t.x1*ce,qe+t.y1*ce,et+t.x2*ce,qe+t.y2*ce]}}const[Te,Se,Me,He]=be.box,Ee=w?be.allPointsOccluded:J.isOccluded;let Xe=Ee;return Xe||(Xe=J.perspectiveRatio<this.perspectiveRatioCutoff),Xe||(Xe=!this.isInsideGrid(Te,Se,Me,He)),Xe||n!=="always"&&this.grid.hitTest(Te,Se,Me,He,n,z)?{box:[Te,Se,Me,He],placeable:!1,offscreen:!1,occluded:Ee}:{box:[Te,Se,Me,He],placeable:!0,offscreen:this.isOffscreen(Te,Se,Me,He),occluded:Ee}}placeCollisionCircles(t,n,o,h,_,w,A,M,z,O,$,G,J,ce){const be=[],Te=new s.P(n.anchorX,n.anchorY),Se=this.getPerspectiveRatio(Te.x,Te.y,w,ce),Me=(z?_*this.transform.getPitchedTextCorrection(n.anchorX,n.anchorY,w)/Se:_*Se)/s.aM,He={getElevation:ce,pitchedLabelPlaneMatrix:A,lineVertexArray:o,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Te,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:J},Ee=ho(Me,h,n.lineOffsetX*Me,n.lineOffsetY*Me,!1,n,!1,He);let Xe=!1,et=!1,qe=!0;if(Ee){const lt=.5*$*Se+G,At=new s.P(-100,-100),vt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),St=new Xt,Pt=Ee.first,er=Ee.last;let rr=[];for(let Hr=Pt.path.length-1;Hr>=1;Hr--)rr.push(Pt.path[Hr]);for(let Hr=1;Hr<er.path.length;Hr++)rr.push(er.path[Hr]);const $t=2.5*lt;if(z){const Hr=this.projectPathToScreenSpace(rr,He);rr=Hr.some((Ci=>Ci.signedDistanceFromCamera<=0))?[]:Hr.map((Ci=>Ci.point))}let nr=[];if(rr.length>0){const Hr=rr[0].clone(),Ci=rr[0].clone();for(let Xi=1;Xi<rr.length;Xi++)Hr.x=Math.min(Hr.x,rr[Xi].x),Hr.y=Math.min(Hr.y,rr[Xi].y),Ci.x=Math.max(Ci.x,rr[Xi].x),Ci.y=Math.max(Ci.y,rr[Xi].y);nr=Hr.x>=At.x&&Ci.x<=vt.x&&Hr.y>=At.y&&Ci.y<=vt.y?[rr]:Ci.x<At.x||Hr.x>vt.x||Ci.y<At.y||Hr.y>vt.y?[]:s.aJ([rr],At.x,At.y,vt.x,vt.y)}for(const Hr of nr){St.reset(Hr,.25*lt);let Ci=0;Ci=St.length<=.5*lt?1:Math.ceil(St.paddedLength/$t)+1;for(let Xi=0;Xi<Ci;Xi++){const Vi=Xi/Math.max(Ci-1,1),rn=St.lerp(Vi),Ui=rn.x+ri,_n=rn.y+ri;be.push(Ui,_n,lt,0);const nn=Ui-lt,Jn=_n-lt,En=Ui+lt,Pn=_n+lt;if(qe=qe&&this.isOffscreen(nn,Jn,En,Pn),et=et||this.isInsideGrid(nn,Jn,En,Pn),t!=="always"&&this.grid.hitTestCircle(Ui,_n,lt,t,O)&&(Xe=!0,!M))return{circles:[],offscreen:!1,collisionDetected:Xe}}}}return{circles:!M&&Xe||!et||Se<this.perspectiveRatioCutoff?[]:be,offscreen:qe,collisionDetected:Xe}}projectPathToScreenSpace(t,n){const o=(function(h,_){const w=s.N();return s.aB(w,_.pitchedLabelPlaneMatrix),h.map((A=>{const M=$r(A.x,A.y,w,_.getElevation),z=_.transform.projectTileCoordinates(M.point.x,M.point.y,_.unwrappedTileID,_.getElevation);return z.point.x=(.5*z.point.x+.5)*_.width,z.point.y=(.5*-z.point.y+.5)*_.height,z}))})(t,n);return(function(h){let _=0,w=0,A=0,M=0;for(let z=0;z<h.length;z++)h[z].isOccluded?(A=z+1,M=0):(M++,M>w&&(w=M,_=A));return h.slice(_,_+w)})(o)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[],o=new s.aa;for(const $ of t){const G=new s.P($.x+ri,$.y+ri);o.extend(G),n.push(G)}const{minX:h,minY:_,maxX:w,maxY:A}=o,M=this.grid.query(h,_,w,A).concat(this.ignoredGrid.query(h,_,w,A)),z={},O={};for(const $ of M){const G=$.key;if(z[G.bucketInstanceId]===void 0&&(z[G.bucketInstanceId]={}),z[G.bucketInstanceId][G.featureIndex])continue;const J=[new s.P($.x1,$.y1),new s.P($.x2,$.y1),new s.P($.x2,$.y2),new s.P($.x1,$.y2)];s.aK(n,J)&&(z[G.bucketInstanceId][G.featureIndex]=!0,O[G.bucketInstanceId]===void 0&&(O[G.bucketInstanceId]=[]),O[G.bucketInstanceId].push(G.featureIndex))}return O}insertCollisionBox(t,n,o,h,_,w){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:_,collisionGroupID:w,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,o,h,_,w){const A=o?this.ignoredGrid:this.grid,M={bucketInstanceId:h,featureIndex:_,collisionGroupID:w,overlapMode:n};for(let z=0;z<t.length;z+=4)A.insertCircle(M,t[z],t[z+1],t[z+2])}projectAndGetPerspectiveRatio(t,n,o,h,_){if(_){let w;h?(w=[t,n,h(t,n),1],s.aH(w,w,_)):(w=[t,n,0,1],pl(w,w,_));const A=w[3];return{x:(w[0]/A+1)/2*this.transform.width+ri,y:(-w[1]/A+1)/2*this.transform.height+ri,perspectiveRatio:.5+this.transform.cameraToCenterDistance/A*.5,isOccluded:!1,signedDistanceFromCamera:A}}{const w=this.transform.projectTileCoordinates(t,n,o,h);return{x:(w.point.x+1)/2*this.transform.width+ri,y:(1-w.point.y)/2*this.transform.height+ri,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5,isOccluded:w.isOccluded,signedDistanceFromCamera:w.signedDistanceFromCamera}}}getPerspectiveRatio(t,n,o,h){const _=this.transform.projectTileCoordinates(t,n,o,h);return .5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5}isOffscreen(t,n,o,h){return o<ri||t>=this.screenRightBoundary||h<ri||n>this.screenBottomBoundary}isInsideGrid(t,n,o,h){return o>=0&&t<this.gridRightBoundary&&h>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=s.ar([]);return s.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,n,o,h,_,w,A,M,z,O,$){let G=1,J=0,ce=0,be=1;const Te=t.anchorPointX+A[0],Se=t.anchorPointY+A[1];if(w&&!_){const rr=this.projectAndGetPerspectiveRatio(Te+1,Se,h,z,$),$t=rr.x-M.x,nr=Math.atan((rr.y-M.y)/$t)+($t<0?Math.PI:0),Hr=Math.sin(nr),Ci=Math.cos(nr);G=Ci,J=Hr,ce=-Hr,be=Ci}else if(!w&&_){const rr=Dn(this.transform);G=rr.vecEast[0],J=rr.vecEast[1],ce=rr.vecSouth[0],be=rr.vecSouth[1]}let Me=M.x,He=M.y,Ee=n;_&&(Me=Te,He=Se,Ee=Math.pow(2,-(this.transform.zoom-o.overscaledZ)),Ee*=this.transform.getPitchedTextCorrection(Te,Se,h),O||(Ee*=s.an(.5+M.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),O&&(Me+=G*O.x*Ee+ce*O.y*Ee,He+=J*O.x*Ee+be*O.y*Ee);const Xe=t.x1*Ee,et=t.x2*Ee,qe=(Xe+et)/2,lt=t.y1*Ee,At=t.y2*Ee,vt=(lt+At)/2,St=[{offsetX:Xe,offsetY:lt},{offsetX:qe,offsetY:lt},{offsetX:et,offsetY:lt},{offsetX:et,offsetY:vt},{offsetX:et,offsetY:At},{offsetX:qe,offsetY:At},{offsetX:Xe,offsetY:At},{offsetX:Xe,offsetY:vt}];let Pt=[];for(const{offsetX:rr,offsetY:$t}of St)Pt.push(new s.P(Me+G*rr+ce*$t,He+J*rr+be*$t));let er=!1;if(_){const rr=Pt.map(($t=>this.projectAndGetPerspectiveRatio($t.x,$t.y,h,z,$)));er=rr.some(($t=>!$t.isOccluded)),Pt=rr.map(($t=>new s.P($t.x,$t.y)))}else er=!0;return{box:s.aL(Pt),allPointsOccluded:!er}}}class la{constructor(t,n,o,h){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):h&&o?1:0,this.placed=o}isHidden(){return this.opacity===0&&!this.placed}}class Aa{constructor(t,n,o,h,_){this.text=new la(t?t.text:null,n,o,_),this.icon=new la(t?t.icon:null,n,h,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class $l{constructor(t,n,o){this.text=t,this.icon=n,this.skipFade=o}}class As{constructor(t,n,o,h,_){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=o,this.bucketIndex=h,this.tileID=_}}class wn{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:o=>o.collisionGroupID===n}}return this.collisionGroups[t]}}function Os(m,t,n,o,h){const{horizontalAlign:_,verticalAlign:w}=s.aS(m);return new s.P(-(_-.5)*t+o[0]*h,-(w-.5)*n+o[1]*h)}class ml{constructor(t,n,o,h,_){this.transform=t.clone(),this.terrain=n,this.collisionIndex=new Gl(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new wn(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const n=this.terrain;return n?(o,h)=>n.getElevation(t,o,h):null}getBucketParts(t,n,o,h){const _=o.getBucket(n),w=o.latestFeatureIndex;if(!_||!w||n.id!==_.layerIds[0])return;const A=o.collisionBoxArray,M=_.layers[0].layout,z=_.layers[0].paint,O=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),$=o.tileSize/s.a5,G=o.tileID.toUnwrapped(),J=M.get("text-rotation-alignment")==="map",ce=s.aN(o,1,this.transform.zoom),be=s.aO(this.collisionIndex.transform,o,z.get("text-translate"),z.get("text-translate-anchor")),Te=s.aO(this.collisionIndex.transform,o,z.get("icon-translate"),z.get("icon-translate-anchor")),Se=Ni(J,this.transform,ce);this.retainedQueryData[_.bucketInstanceId]=new As(_.bucketInstanceId,w,_.sourceLayerIndex,_.index,o.tileID);const Me={bucket:_,layout:M,translationText:be,translationIcon:Te,unwrappedTileID:G,pitchedLabelPlaneMatrix:Se,scale:O,textPixelRatio:$,holdingForFade:o.holdingForSymbolFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:s.ay(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(h)for(const He of _.sortKeyRanges){const{sortKey:Ee,symbolInstanceStart:Xe,symbolInstanceEnd:et}=He;t.push({sortKey:Ee,symbolInstanceStart:Xe,symbolInstanceEnd:et,parameters:Me})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:Me})}attemptAnchorPlacement(t,n,o,h,_,w,A,M,z,O,$,G,J,ce,be,Te,Se,Me,He,Ee){const Xe=s.aP[t.textAnchor],et=[t.textOffset0,t.textOffset1],qe=Os(Xe,o,h,et,_),lt=this.collisionIndex.placeCollisionBox(n,G,M,z,O,A,w,Te,$.predicate,He,qe,Ee);if((!Me||this.collisionIndex.placeCollisionBox(Me,G,M,z,O,A,w,Se,$.predicate,He,qe,Ee).placeable)&&lt.placeable){let At;if(this.prevPlacement&&this.prevPlacement.variableOffsets[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID].text&&(At=this.prevPlacement.variableOffsets[J.crossTileID].anchor),J.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[J.crossTileID]={textOffset:et,width:o,height:h,anchor:Xe,textBoxScale:_,prevAnchor:At},this.markUsedJustification(ce,Xe,J,be),ce.allowVerticalPlacement&&(this.markUsedOrientation(ce,be,J),this.placedOrientations[J.crossTileID]=be),{shift:qe,placedGlyphBoxes:lt}}}placeLayerBucketPart(t,n,o){const{bucket:h,layout:_,translationText:w,translationIcon:A,unwrappedTileID:M,pitchedLabelPlaneMatrix:z,textPixelRatio:O,holdingForFade:$,collisionBoxArray:G,partiallyEvaluatedTextSize:J,collisionGroup:ce}=t.parameters,be=_.get("text-optional"),Te=_.get("icon-optional"),Se=s.aQ(_,"text-overlap","text-allow-overlap"),Me=Se==="always",He=s.aQ(_,"icon-overlap","icon-allow-overlap"),Ee=He==="always",Xe=_.get("text-rotation-alignment")==="map",et=_.get("text-pitch-alignment")==="map",qe=_.get("icon-text-fit")!=="none",lt=_.get("symbol-z-order")==="viewport-y",At=Me&&(Ee||!h.hasIconData()||Te),vt=Ee&&(Me||!h.hasTextData()||be);!h.collisionArrays&&G&&h.deserializeCollisionBoxes(G);const St=this.retainedQueryData[h.bucketInstanceId].tileID,Pt=this._getTerrainElevationFunc(St),er=this.transform.getFastPathSimpleProjectionMatrix(St),rr=($t,nr,Hr)=>{var Ci,Xi;if(n[$t.crossTileID])return;if($)return void(this.placements[$t.crossTileID]=new $l(!1,!1,!1));let Vi=!1,rn=!1,Ui=!0,_n=null,nn={box:null,placeable:!1,offscreen:null,occluded:!1},Jn={placeable:!1},En=null,Pn=null,us=null,zl=0,tl=0,Do=0;nr.textFeatureIndex?zl=nr.textFeatureIndex:$t.useRuntimeCollisionCircles&&(zl=$t.featureIndex),nr.verticalTextFeatureIndex&&(tl=nr.verticalTextFeatureIndex);const ea=nr.textBox;if(ea){const Ba=$i=>{let qi=s.az.horizontal;if(h.allowVerticalPlacement&&!$i&&this.prevPlacement){const qn=this.prevPlacement.placedOrientations[$t.crossTileID];qn&&(this.placedOrientations[$t.crossTileID]=qn,qi=qn,this.markUsedOrientation(h,qi,$t))}return qi},Fo=($i,qi)=>{if(h.allowVerticalPlacement&&$t.numVerticalGlyphVertices>0&&nr.verticalTextBox){for(const qn of h.writingModes)if(qn===s.az.vertical?(nn=qi(),Jn=nn):nn=$i(),nn&&nn.placeable)break}else nn=$i()},io=$t.textAnchorOffsetStartIndex,no=$t.textAnchorOffsetEndIndex;if(no===io){const $i=(qi,qn)=>{const Gn=this.collisionIndex.placeCollisionBox(qi,Se,O,St,M,et,Xe,w,ce.predicate,Pt,void 0,er);return Gn&&Gn.placeable&&(this.markUsedOrientation(h,qn,$t),this.placedOrientations[$t.crossTileID]=qn),Gn};Fo((()=>$i(ea,s.az.horizontal)),(()=>{const qi=nr.verticalTextBox;return h.allowVerticalPlacement&&$t.numVerticalGlyphVertices>0&&qi?$i(qi,s.az.vertical):{box:null,offscreen:null}})),Ba(nn&&nn.placeable)}else{let $i=s.aP[(Xi=(Ci=this.prevPlacement)===null||Ci===void 0?void 0:Ci.variableOffsets[$t.crossTileID])===null||Xi===void 0?void 0:Xi.anchor];const qi=(Gn,Xh,Yh)=>{const fc=Gn.x2-Gn.x1,tf=Gn.y2-Gn.y1,Jh=$t.textBoxScale,mh=qe&&He==="never"?Xh:null;let Nl=null,Rl=Se==="never"?1:2,Bl="never";$i&&Rl++;for(let gh=0;gh<Rl;gh++){for(let _h=io;_h<no;_h++){const Fu=h.textAnchorOffsets.get(_h);if($i&&Fu.textAnchor!==$i)continue;const zu=this.attemptAnchorPlacement(Fu,Gn,fc,tf,Jh,Xe,et,O,St,M,ce,Bl,$t,h,Yh,w,A,mh,Pt);if(zu&&(Nl=zu.placedGlyphBoxes,Nl&&Nl.placeable))return Vi=!0,_n=zu.shift,Nl}$i?$i=null:Bl=Se}return o&&!Nl&&(Nl={box:this.collisionIndex.placeCollisionBox(ea,"always",O,St,M,et,Xe,w,ce.predicate,Pt,void 0,er).box,offscreen:!1,placeable:!1,occluded:!1}),Nl};Fo((()=>qi(ea,nr.iconBox,s.az.horizontal)),(()=>{const Gn=nr.verticalTextBox;return h.allowVerticalPlacement&&(!nn||!nn.placeable)&&$t.numVerticalGlyphVertices>0&&Gn?qi(Gn,nr.verticalIconBox,s.az.vertical):{box:null,occluded:!0,offscreen:null}})),nn&&(Vi=nn.placeable,Ui=nn.offscreen);const qn=Ba(nn&&nn.placeable);if(!Vi&&this.prevPlacement){const Gn=this.prevPlacement.variableOffsets[$t.crossTileID];Gn&&(this.variableOffsets[$t.crossTileID]=Gn,this.markUsedJustification(h,Gn.anchor,$t,qn))}}}if(En=nn,Vi=En&&En.placeable,Ui=En&&En.offscreen,$t.useRuntimeCollisionCircles&&$t.centerJustifiedTextSymbolIndex>=0){const Ba=h.text.placedSymbolArray.get($t.centerJustifiedTextSymbolIndex),Fo=s.aA(h.textSizeData,J,Ba),io=_.get("text-padding");Pn=this.collisionIndex.placeCollisionCircles(Se,Ba,h.lineVertexArray,h.glyphOffsetArray,Fo,M,z,o,et,ce.predicate,$t.collisionCircleDiameter,io,w,Pt),Pn.circles.length&&Pn.collisionDetected&&!o&&s.w("Collisions detected, but collision boxes are not shown"),Vi=Me||Pn.circles.length>0&&!Pn.collisionDetected,Ui=Ui&&Pn.offscreen}if(nr.iconFeatureIndex&&(Do=nr.iconFeatureIndex),nr.iconBox){const Ba=Fo=>this.collisionIndex.placeCollisionBox(Fo,He,O,St,M,et,Xe,A,ce.predicate,Pt,qe&&_n?_n:void 0,er);Jn&&Jn.placeable&&nr.verticalIconBox?(us=Ba(nr.verticalIconBox),rn=us.placeable):(us=Ba(nr.iconBox),rn=us.placeable),Ui=Ui&&us.offscreen}const hc=be||$t.numHorizontalGlyphVertices===0&&$t.numVerticalGlyphVertices===0,hu=Te||$t.numIconVertices===0;hc||hu?hu?hc||(rn=rn&&Vi):Vi=rn&&Vi:rn=Vi=rn&&Vi;const dc=rn&&us.placeable;if(Vi&&En.placeable&&this.collisionIndex.insertCollisionBox(En.box,Se,_.get("text-ignore-placement"),h.bucketInstanceId,Jn&&Jn.placeable&&tl?tl:zl,ce.ID),dc&&this.collisionIndex.insertCollisionBox(us.box,He,_.get("icon-ignore-placement"),h.bucketInstanceId,Do,ce.ID),Pn&&Vi&&this.collisionIndex.insertCollisionCircles(Pn.circles,Se,_.get("text-ignore-placement"),h.bucketInstanceId,zl,ce.ID),o&&this.storeCollisionData(h.bucketInstanceId,Hr,nr,En,us,Pn),$t.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[$t.crossTileID]=new $l((Vi||At)&&!En?.occluded,(rn||vt)&&!us?.occluded,Ui||h.justReloaded),n[$t.crossTileID]=!0};if(lt){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const $t=h.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let nr=$t.length-1;nr>=0;--nr){const Hr=$t[nr];rr(h.symbolInstances.get(Hr),h.collisionArrays[Hr],Hr)}}else for(let $t=t.symbolInstanceStart;$t<t.symbolInstanceEnd;$t++)rr(h.symbolInstances.get($t),h.collisionArrays[$t],$t);h.justReloaded=!1}storeCollisionData(t,n,o,h,_,w){if(o.textBox||o.iconBox){let A,M;this.collisionBoxArrays.has(t)?A=this.collisionBoxArrays.get(t):(A=new Map,this.collisionBoxArrays.set(t,A)),A.has(n)?M=A.get(n):(M={text:null,icon:null},A.set(n,M)),o.textBox&&(M.text=h.box),o.iconBox&&(M.icon=_.box)}if(w){let A=this.collisionCircleArrays[t];A===void 0&&(A=this.collisionCircleArrays[t]=[]);for(let M=0;M<w.circles.length;M+=4)A.push(w.circles[M+0]-ri),A.push(w.circles[M+1]-ri),A.push(w.circles[M+2]),A.push(w.collisionDetected?1:0)}}markUsedJustification(t,n,o,h){let _;_=h===s.az.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[s.aR(n)];const w=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];for(const A of w)A>=0&&(t.text.placedSymbolArray.get(A).crossTileID=_>=0&&A!==_?0:o.crossTileID)}markUsedOrientation(t,n,o){const h=n===s.az.horizontal||n===s.az.horizontalOnly?n:0,_=n===s.az.vertical?n:0,w=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];for(const A of w)t.text.placedSymbolArray.get(A).placedOrientation=h;o.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let o=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const h=n?n.symbolFadeChange(t):1,_=n?n.opacities:{},w=n?n.variableOffsets:{},A=n?n.placedOrientations:{};for(const M in this.placements){const z=this.placements[M],O=_[M];O?(this.opacities[M]=new Aa(O,h,z.text,z.icon),o=o||z.text!==O.text.placed||z.icon!==O.icon.placed):(this.opacities[M]=new Aa(null,h,z.text,z.icon,z.skipFade),o=o||z.text||z.icon)}for(const M in _){const z=_[M];if(!this.opacities[M]){const O=new Aa(z,h,!1,!1);O.isHidden()||(this.opacities[M]=O,o=o||z.text.placed||z.icon.placed)}}for(const M in w)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=w[M]);for(const M in A)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=A[M]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");o?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const o={};for(const h of n){const _=h.getBucket(t);_&&h.latestFeatureIndex&&t.id===_.layerIds[0]&&this.updateBucketOpacities(_,h.tileID,o,h.collisionBoxArray)}}updateBucketOpacities(t,n,o,h){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const _=t.layers[0],w=_.layout,A=new Aa(null,0,!1,!1,!0),M=w.get("text-allow-overlap"),z=w.get("icon-allow-overlap"),O=_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$=w.get("text-rotation-alignment")==="map",G=w.get("text-pitch-alignment")==="map",J=w.get("icon-text-fit")!=="none",ce=new Aa(null,0,M&&(z||!t.hasIconData()||w.get("icon-optional")),z&&(M||!t.hasTextData()||w.get("text-optional")),!0);!t.collisionArrays&&h&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(h);const be=(Se,Me,He)=>{for(let Ee=0;Ee<Me/4;Ee++)Se.opacityVertexArray.emplaceBack(He);Se.hasVisibleVertices=Se.hasVisibleVertices||He!==Oo},Te=this.collisionBoxArrays.get(t.bucketInstanceId);for(let Se=0;Se<t.symbolInstances.length;Se++){const Me=t.symbolInstances.get(Se),{numHorizontalGlyphVertices:He,numVerticalGlyphVertices:Ee,crossTileID:Xe}=Me;let et=this.opacities[Xe];o[Xe]?et=A:et||(et=ce,this.opacities[Xe]=et),o[Xe]=!0;const qe=Me.numIconVertices>0,lt=this.placedOrientations[Me.crossTileID],At=lt===s.az.vertical,vt=lt===s.az.horizontal||lt===s.az.horizontalOnly;if(He>0||Ee>0){const Pt=Hl(et.text);be(t.text,He,At?Oo:Pt),be(t.text,Ee,vt?Oo:Pt);const er=et.text.isHidden();[Me.rightJustifiedTextSymbolIndex,Me.centerJustifiedTextSymbolIndex,Me.leftJustifiedTextSymbolIndex].forEach((nr=>{nr>=0&&(t.text.placedSymbolArray.get(nr).hidden=er||At?1:0)})),Me.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(Me.verticalPlacedTextSymbolIndex).hidden=er||vt?1:0);const rr=this.variableOffsets[Me.crossTileID];rr&&this.markUsedJustification(t,rr.anchor,Me,lt);const $t=this.placedOrientations[Me.crossTileID];$t&&(this.markUsedJustification(t,"left",Me,$t),this.markUsedOrientation(t,$t,Me))}if(qe){const Pt=Hl(et.icon),er=!(J&&Me.verticalPlacedIconSymbolIndex&&At);Me.placedIconSymbolIndex>=0&&(be(t.icon,Me.numIconVertices,er?Pt:Oo),t.icon.placedSymbolArray.get(Me.placedIconSymbolIndex).hidden=et.icon.isHidden()),Me.verticalPlacedIconSymbolIndex>=0&&(be(t.icon,Me.numVerticalIconVertices,er?Oo:Pt),t.icon.placedSymbolArray.get(Me.verticalPlacedIconSymbolIndex).hidden=et.icon.isHidden())}const St=Te&&Te.has(Se)?Te.get(Se):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Pt=t.collisionArrays[Se];if(Pt){let er=new s.P(0,0);if(Pt.textBox||Pt.verticalTextBox){let rr=!0;if(O){const $t=this.variableOffsets[Xe];$t?(er=Os($t.anchor,$t.width,$t.height,$t.textOffset,$t.textBoxScale),$&&er._rotate(G?-this.transform.bearingInRadians:this.transform.bearingInRadians)):rr=!1}if(Pt.textBox||Pt.verticalTextBox){let $t;Pt.textBox&&($t=At),Pt.verticalTextBox&&($t=vt),Zl(t.textCollisionBox.collisionVertexArray,et.text.placed,!rr||$t,St.text,er.x,er.y)}}if(Pt.iconBox||Pt.verticalIconBox){const rr=!!(!vt&&Pt.verticalIconBox);let $t;Pt.iconBox&&($t=rr),Pt.verticalIconBox&&($t=!rr),Zl(t.iconCollisionBox.collisionVertexArray,et.icon.placed,$t,St.icon,J?er.x:0,J?er.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const o=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*o>t}setStale(){this.stale=!0}}function Zl(m,t,n,o,h,_){o&&o.length!==0||(o=[0,0,0,0]);const w=o[0]-ri,A=o[1]-ri,M=o[2]-ri,z=o[3]-ri;m.emplaceBack(t?1:0,n?1:0,h||0,_||0,w,A),m.emplaceBack(t?1:0,n?1:0,h||0,_||0,M,A),m.emplaceBack(t?1:0,n?1:0,h||0,_||0,M,z),m.emplaceBack(t?1:0,n?1:0,h||0,_||0,w,z)}const Wl=Math.pow(2,25),js=Math.pow(2,24),wc=Math.pow(2,17),mo=Math.pow(2,16),$a=Math.pow(2,9),go=Math.pow(2,8),_o=Math.pow(2,1);function Hl(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const t=m.placed?1:0,n=Math.floor(127*m.opacity);return n*Wl+t*js+n*wc+t*mo+n*$a+t*go+n*_o+t}const Oo=0;class Vs{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,o,h,_){const w=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(w,h,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(((A,M)=>A.sortKey-M.sortKey)));this._currentPartIndex<w.length;)if(n.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,_())return!0;return!1}}class Za{constructor(t,n,o,h,_,w,A,M){this.placement=new ml(t,n,w,A,M),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,n,o){const h=he(),_=()=>!this._forceFullPlacement&&he()-h>2;for(;this._currentPlacementIndex>=0;){const w=n[t[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=A)&&(!w.maxzoom||w.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new Vs(w)),this._inProgressLayer.continuePlacement(o[w.source],this.placement,this._showCollisionBoxes,w,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ur=512/s.a5/2;class Xl{constructor(t,n,o){this.tileID=t,this.bucketInstanceId=o,this._symbolsByKey={};const h=new Map;for(let _=0;_<n.length;_++){const w=n.get(_),A=w.key,M=h.get(A);M?M.push(w):h.set(A,[w])}for(const[_,w]of h){const A={positions:w.map((M=>({x:Math.floor(M.anchorX*Ur),y:Math.floor(M.anchorY*Ur)}))),crossTileIDs:w.map((M=>M.crossTileID))};if(A.positions.length>128){const M=new s.aT(A.positions.length,16,Uint16Array);for(const{x:z,y:O}of A.positions)M.add(z,O);M.finish(),delete A.positions,A.index=M}this._symbolsByKey[_]=A}}getScaledCoordinates(t,n){const{x:o,y:h,z:_}=this.tileID.canonical,{x:w,y:A,z:M}=n.canonical,z=Ur/Math.pow(2,M-_),O=(A*s.a5+t.anchorY)*z,$=h*s.a5*Ur;return{x:Math.floor((w*s.a5+t.anchorX)*z-o*s.a5*Ur),y:Math.floor(O-$)}}findMatches(t,n,o){const h=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let _=0;_<t.length;_++){const w=t.get(_);if(w.crossTileID)continue;const A=this._symbolsByKey[w.key];if(!A)continue;const M=this.getScaledCoordinates(w,n);if(A.index){const z=A.index.range(M.x-h,M.y-h,M.x+h,M.y+h).sort();for(const O of z){const $=A.crossTileIDs[O];if(!o[$]){o[$]=!0,w.crossTileID=$;break}}}else if(A.positions)for(let z=0;z<A.positions.length;z++){const O=A.positions[z],$=A.crossTileIDs[z];if(Math.abs(O.x-M.x)<=h&&Math.abs(O.y-M.y)<=h&&!o[$]){o[$]=!0,w.crossTileID=$;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class jo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Vo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const o in this.indexes){const h=this.indexes[o],_={};for(const w in h){const A=h[w];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+n),_[A.tileID.key]=A}this.indexes[o]=_}this.lng=t}addBucket(t,n,o){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<n.symbolInstances.length;_++)n.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const h=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const w=this.indexes[_];if(Number(_)>t.overscaledZ)for(const A in w){const M=w[A];M.tileID.isChildOf(t)&&M.findMatches(n.symbolInstances,t,h)}else{const A=w[t.scaledTo(Number(_)).key];A&&A.findMatches(n.symbolInstances,t,h)}}for(let _=0;_<n.symbolInstances.length;_++){const w=n.symbolInstances.get(_);w.crossTileID||(w.crossTileID=o.generate(),h[w.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Xl(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const o of n.getCrossTileIDsLists())for(const h of o)delete this.usedCrossTileIDs[t][h]}removeStaleBuckets(t){let n=!1;for(const o in this.indexes){const h=this.indexes[o];for(const _ in h)t[h[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,h[_]),delete h[_],n=!0)}return n}}class Hn{constructor(){this.layerIndexes={},this.crossTileIDs=new jo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,o){let h=this.layerIndexes[t.id];h===void 0&&(h=this.layerIndexes[t.id]=new Vo);let _=!1;const w={};h.handleWrapJump(o);for(const A of n){const M=A.getBucket(t);M&&t.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(A.tileID,M,this.crossTileIDs)&&(_=!0),w[M.bucketInstanceId]=!0)}return h.removeStaleBuckets(w)&&(_=!0),_}pruneUnusedLayers(t){const n={};t.forEach((o=>{n[o]=!0}));for(const o in this.layerIndexes)n[o]||delete this.layerIndexes[o]}}var kr="void main() {fragColor=vec4(1.0);}";const Bi={prelude:Br(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Br("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Br("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Br(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Br(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Br(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Br(kr,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Br(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Br(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Br("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Br("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Br(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Br("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Br(kr,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Br(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Br(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Br(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Br(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Br(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Br(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Br(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Br(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Br(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Br(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Br(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Br(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:Br(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Br(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Br(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Br(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Br(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Br("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Br("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Br("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Br("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Br(`#ifdef GL_ES
precision highp float;
#endif
in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Br("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Br(m,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,o=t.match(/in ([\w]+) ([\w]+)/g),h=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=_?_.concat(h):h,A={};return{fragmentSource:m=m.replace(n,((M,z,O,$,G)=>(A[G]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${G}
in ${O} ${$} ${G};
#else
uniform ${O} ${$} u_${G};
#endif
`:`
#ifdef HAS_UNIFORM_u_${G}
    ${O} ${$} ${G} = u_${G};
#endif
`))),vertexSource:t=t.replace(n,((M,z,O,$,G)=>{const J=$==="float"?"vec2":"vec4",ce=G.match(/color/)?"color":J;return A[G]?z==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${O} ${J} a_${G};
out ${O} ${$} ${G};
#else
uniform ${O} ${$} u_${G};
#endif
`:ce==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = a_${G};
#else
    ${O} ${$} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = unpack_mix_${ce}(a_${G}, u_${G}_t);
#else
    ${O} ${$} ${G} = u_${G};
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${O} ${J} a_${G};
#else
uniform ${O} ${$} u_${G};
#endif
`:ce==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${O} ${$} ${G} = a_${G};
#else
    ${O} ${$} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${O} ${$} ${G} = unpack_mix_${ce}(a_${G}, u_${G}_t);
#else
    ${O} ${$} ${G} = u_${G};
#endif
`})),staticAttributes:o,staticUniforms:w}}class wi{constructor(t,n,o){this.vertexBuffer=t,this.indexBuffer=n,this.segments=o}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Xn=s.aU([{name:"a_pos",type:"Int16",components:2}]);const Ki="#define PROJECTION_MERCATOR",is="mercator";class Un{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return is}get shaderDefine(){return Ki}get shaderPreludeCode(){return Bi.projectionMercator}get vertexShaderPreludeCode(){return Bi.projectionMercator.vertexSource}get subdivisionGranularity(){return s.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,n,o,h,_){if(this._cachedMesh)return this._cachedMesh;const w=new s.aW;w.emplaceBack(0,0),w.emplaceBack(s.a5,0),w.emplaceBack(0,s.a5),w.emplaceBack(s.a5,s.a5);const A=t.createVertexBuffer(w,Xn.members),M=s.aX.simpleSegment(0,0,4,2),z=new s.aY;z.emplaceBack(1,0,2),z.emplaceBack(1,2,3);const O=t.createIndexBuffer(z);return this._cachedMesh=new wi(A,O,M),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class ca{constructor(t=0,n=0,o=0,h=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(o)||o<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=o,this.right=h}interpolate(t,n,o){return n.top!=null&&t.top!=null&&(this.top=s.G.number(t.top,n.top,o)),n.bottom!=null&&t.bottom!=null&&(this.bottom=s.G.number(t.bottom,n.bottom,o)),n.left!=null&&t.left!=null&&(this.left=s.G.number(t.left,n.left,o)),n.right!=null&&t.right!=null&&(this.right=s.G.number(t.right,n.right,o)),this}getCenter(t,n){const o=s.an((this.left+t-this.right)/2,0,t),h=s.an((this.top+n-this.bottom)/2,0,n);return new s.P(o,h)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ca(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Us(m,t){if(!m.renderWorldCopies||m.lngRange)return;const n=t.lng-m.center.lng;t.lng+=n>180?-360:n<-180?360:0}function Mi(m){return Math.max(0,Math.floor(m))}class Wa{constructor(t,n){var o;this.applyConstrain=(h,_)=>this._constrainOverride!==null?this._constrainOverride(h,_):this._callbacks.defaultConstrain(h,_),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=n?.renderWorldCopies===void 0||!!n?.renderWorldCopies,this._minZoom=n?.minZoom||0,this._maxZoom=n?.maxZoom||22,this._minPitch=n?.minPitch==null?0:n?.minPitch,this._maxPitch=n?.maxPitch==null?60:n?.maxPitch,this._constrainOverride=(o=n?.constrainOverride)!==null&&o!==void 0?o:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new s.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Mi(this._zoom),this._scale=s.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new ca,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,n,o){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Mi(this._zoom),this._scale=s.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new ca(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!o&&t.autoCalculateNearFarZ,n&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const n=s.W(t,-180,180)*Math.PI/180;var o,h,_,w,A,M,z,O,$;this._bearingInRadians!==n&&(this._unmodified=!1,this._bearingInRadians=n,this._calcMatrices(),this._rotationMatrix=F(),o=this._rotationMatrix,_=-this._bearingInRadians,w=(h=this._rotationMatrix)[0],A=h[1],M=h[2],z=h[3],O=Math.sin(_),$=Math.cos(_),o[0]=w*$+M*O,o[1]=A*$+z*O,o[2]=w*-O+M*$,o[3]=A*-O+z*$)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const n=s.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==n&&(this._unmodified=!1,this._pitchInRadians=n,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const n=t/180*Math.PI;this._rollInRadians!==n&&(this._unmodified=!1,this._rollInRadians=n,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return s.aZ(this._fovInRadians)}setFov(t){t=s.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=s.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const n=this.applyConstrain(this._center,t).zoom;this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this._tileZoom=Math.max(0,Math.floor(n)),this._scale=s.aq(n),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,n){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=n,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,o){this._unmodified=!1,this._edgeInsets.interpolate(t,n,o),this.constrainInternal(),this._calcMatrices()}resize(t,n,o=!0){this._width=t,this._height=n,o&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new br([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-s.ao,s.ao])}getCameraQueryGeometry(t,n){if(n.length===1)return[n[0],t];{const{minX:o,minY:h,maxX:_,maxY:w}=s.aa.fromPoints(n).extend(t);return[new s.P(o,h),new s.P(_,h),new s.P(_,w),new s.P(o,w),new s.P(o,h)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:n,zoom:o}=this.applyConstrain(this.center,this.zoom);this.setCenter(n),this.setZoom(o),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=s.ar(new Float64Array(16));s.Q(t,t,[this._width/2,-this._height/2,1]),s.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=s.ar(new Float64Array(16)),s.Q(t,t,[1,-1,1]),s.O(t,t,[-1,-1,0]),s.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,n,o,h){const _=o!==void 0?o:this.bearing,w=h=h!==void 0?h:this.pitch,{distanceToCenter:A,clampedElevation:M}=this._distanceToCenterFromAltElevationPitch(n,this.elevation,w),{x:z,y:O}=ot(w,_),$=s.a9.fromLngLat(t,n);let G,J,ce=s.a_(1,$.y),be=0;do{if(be+=1,be>10)break;J=A/ce,G=new s.a9($.x+z*J,$.y+O*J),ce=1/G.meterInMercatorCoordinateUnits()}while(Math.abs(A-J*ce)>1e-12);return{center:G.toLngLat(),elevation:M,zoom:s.at(this.height/2/Math.tan(this.fovInRadians/2)/J/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const n=1/this.worldSize,o=s.as(1,this.center.lat)*this.worldSize,h=s.a9.fromLngLat(this.center,this.elevation),_=h.x/n,w=h.y/n,A=h.z/n,M=this.pitch,z=this.bearing,{x:O,y:$,z:G}=ot(M,z),J=this.cameraToCenterDistance,ce=_+J*-O,be=w+J*-$,Te=A+J*G,{distanceToCenter:Se,clampedElevation:Me}=this._distanceToCenterFromAltElevationPitch(Te/o,t,M),He=Se*o,Ee=new s.a9((ce+O*He)*n,(be+$*He)*n,0).toLngLat(),Xe=s.as(1,Ee.lat),et=s.at(this.height/2/Math.tan(this.fovInRadians/2)/Se/Xe/this.tileSize);this._elevation=Me,this._center=Ee,this.setZoom(et)}_distanceToCenterFromAltElevationPitch(t,n,o){const h=-Math.cos(s.ap(o)),_=t-n;let w,A=n;return h*_>=0||Math.abs(h)<.1?(w=1e4,A=t+w*h):w=-_/h,{distanceToCenter:w,clampedElevation:A}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=s.as(1,this.center.lat)*this.worldSize;return ie(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const n=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/n,t.canonical.y/n,1/n/s.a5,1/n/s.a5]}}class Fn{constructor(t,n){this.min=t,this.max=n,this.center=s.a$([],s.b0([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],o=s.b1(this.min),h=s.b1(this.max);for(let _=0;_<n.length;_++)o[_]=n[_]?this.min[_]:this.center[_],h[_]=n[_]?this.center[_]:this.max[_];return h[2]=this.max[2],new Fn(o,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let n=!0;for(let o=0;o<t.planes.length;o++){const h=this.intersectsPlane(t.planes[o]);if(h===0)return 0;h===1&&(n=!1)}return n?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let n=t[3],o=t[3];for(let h=0;h<3;h++)t[h]>0?(n+=t[h]*this.min[h],o+=t[h]*this.max[h]):(o+=t[h]*this.min[h],n+=t[h]*this.max[h]);return n>=0?2:o<0?0:1}}class gl{distanceToTile2d(t,n,o,h){const _=h.distanceX([t,n]),w=h.distanceY([t,n]);return Math.hypot(_,w)}getWrap(t,n,o){return o}getTileBoundingVolume(t,n,o,h){var _,w;let A=0,M=0;if(h?.terrain){const O=new s.a2(t.z,n,t.z,t.x,t.y),$=h.terrain.getMinMaxElevation(O);A=(_=$.minElevation)!==null&&_!==void 0?_:Math.min(0,o),M=(w=$.maxElevation)!==null&&w!==void 0?w:Math.max(0,o)}const z=1<<t.z;return new Fn([n+t.x/z,t.y/z,A],[n+(t.x+1)/z,(t.y+1)/z,M])}allowVariableZoom(t,n){const o=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,h=s.an(78.5-o/2,0,60);return!!n.terrain||t.pitch>h}allowWorldCopies(){return!0}prepareNextFrame(){}}class zn{constructor(t,n,o){this.points=t,this.planes=n,this.aabb=o}static fromInvProjectionMatrix(t,n=1,o=0,h,_){const w=_?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],A=Math.pow(2,o),M=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((G=>(function(J,ce,be,Te){const Se=s.aH([],J,ce),Me=1/Se[3]/be*Te;return s.b6(Se,Se,[Me,Me,1/Se[3],Me])})(G,t,n,A)));h&&(function(G,J,ce,be){const Te=be?4:0,Se=be?0:4;let Me=0;const He=[],Ee=[];for(let qe=0;qe<4;qe++){const lt=s.b2([],G[qe+Se],G[qe+Te]),At=s.b7(lt);s.a$(lt,lt,1/At),He.push(At),Ee.push(lt)}for(let qe=0;qe<4;qe++){const lt=s.b8(G[qe+Te],Ee[qe],ce);Me=lt!==null&&lt>=0?Math.max(Me,lt):Math.max(Me,He[qe])}const Xe=(function(qe,lt){const At=s.b2([],qe[lt[0]],qe[lt[1]]),vt=s.b2([],qe[lt[2]],qe[lt[1]]),St=[0,0,0,0];return s.b3(St,s.b4([],At,vt)),St[3]=-s.b5(St,qe[lt[0]]),St})(G,J),et=(function(qe,lt){const At=s.b9(qe),vt=s.ba([],qe,1/At),St=s.b2([],lt,s.a$([],vt,s.b5(lt,vt))),Pt=s.b9(St);if(Pt>0){const er=Math.sqrt(1-vt[3]*vt[3]),rr=s.a$([],vt,-vt[3]),$t=s.b0([],rr,s.a$([],St,er/Pt));return s.bb(lt,$t)}return null})(ce,Xe);if(et!==null){const qe=et/s.b5(Ee[0],Xe);Me=Math.min(Me,qe)}for(let qe=0;qe<4;qe++){const lt=Math.min(Me,He[qe]);G[qe+Se]=[G[qe+Te][0]+Ee[qe][0]*lt,G[qe+Te][1]+Ee[qe][1]*lt,G[qe+Te][2]+Ee[qe][2]*lt,1]}})(M,w[0],h,_);const z=w.map((G=>{const J=s.b2([],M[G[0]],M[G[1]]),ce=s.b2([],M[G[2]],M[G[1]]),be=s.b3([],s.b4([],J,ce)),Te=-s.b5(be,M[G[1]]);return be.concat(Te)})),O=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],$=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const G of M)for(let J=0;J<3;J++)O[J]=Math.min(O[J],G[J]),$[J]=Math.max($[J],G[J]);return new zn(M,z,new Fn(O,$))}}class ua{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,n,o){return this._helper.interpolatePadding(t,n,o)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,n,o=!0){this._helper.resize(t,n,o)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,n){this._helper.overrideNearFarZ(t,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,n){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(n,o)=>{o=s.an(+o,this.minZoom,this.maxZoom);const h={center:new s.V(n.lng,n.lat),zoom:o};let _=this._helper._lngRange;if(!this._helper._renderWorldCopies&&_===null){const Ee=179.9999999999;_=[-Ee,Ee]}const w=this.tileSize*s.aq(h.zoom);let A=0,M=w,z=0,O=w,$=0,G=0;const{x:J,y:ce}=this.size;if(this._helper._latRange){const Ee=this._helper._latRange;A=s.X(Ee[1])*w,M=s.X(Ee[0])*w,M-A<ce&&($=ce/(M-A))}_&&(z=s.W(s.Y(_[0])*w,0,w),O=s.W(s.Y(_[1])*w,0,w),O<z&&(O+=w),O-z<J&&(G=J/(O-z)));const{x:be,y:Te}=k(w,n);let Se,Me;const He=Math.max(G||0,$||0);if(He){const Ee=new s.P(G?(O+z)/2:be,$?(M+A)/2:Te);return h.center=ee(w,Ee).wrap(),h.zoom+=s.at(He),h}if(this._helper._latRange){const Ee=ce/2;Te-Ee<A&&(Me=A+Ee),Te+Ee>M&&(Me=M-Ee)}if(_){const Ee=(z+O)/2;let Xe=be;this._helper._renderWorldCopies&&(Xe=s.W(be,Ee-w/2,Ee+w/2));const et=J/2;Xe-et<z&&(Se=z+et),Xe+et>O&&(Se=O-et)}if(Se!==void 0||Me!==void 0){const Ee=new s.P(Se??be,Me??Te);h.center=ee(w,Ee).wrap()}return h},this.applyConstrain=(n,o)=>this._helper.applyConstrain(n,o),this._helper=new Wa({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(n,o)=>this.defaultConstrain(n,o)},t),this._coveringTilesDetailsProvider=new gl}clone(){const t=new ua;return t.apply(this,!1),t}apply(t,n,o){this._helper.apply(t,n,o)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const n=[new s.bc(0,t)];if(this._helper._renderWorldCopies){const o=this.screenPointToMercatorCoordinate(new s.P(0,0)),h=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,0)),_=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,this._helper._height)),w=this.screenPointToMercatorCoordinate(new s.P(0,this._helper._height)),A=Math.floor(Math.min(o.x,h.x,_.x,w.x)),M=Math.floor(Math.max(o.x,h.x,_.x,w.x)),z=1;for(let O=A-z;O<=M+z;O++)O!==0&&n.push(new s.bc(O,t))}return n}getCameraFrustum(){return zn.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const n=this.screenPointToLocation(this.centerPoint,t),o=t?t.getElevationForLngLatZoom(n,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(o)}setLocationAtPoint(t,n){const o=s.as(this.elevation,this.center.lat),h=this.screenPointToMercatorCoordinateAtZ(n,o),_=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,o),w=s.a9.fromLngLat(t),A=new s.a9(w.x-(h.x-_.x),w.y-(h.y-_.y));this.setCenter(A?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,n){return n?this.coordinatePoint(s.a9.fromLngLat(t),n.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(s.a9.fromLngLat(t))}screenPointToLocation(t,n){var o;return(o=this.screenPointToMercatorCoordinate(t,n))===null||o===void 0?void 0:o.toLngLat()}screenPointToMercatorCoordinate(t,n){if(n){const o=n.pointCoordinate(t);if(o!=null)return o}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,n){const o=n||0,h=[t.x,t.y,0,1],_=[t.x,t.y,1,1];s.aH(h,h,this._pixelMatrixInverse),s.aH(_,_,this._pixelMatrixInverse);const w=h[3],A=_[3],M=h[1]/w,z=_[1]/A,O=h[2]/w,$=_[2]/A,G=O===$?0:(o-O)/($-O);return new s.a9(s.G.number(h[0]/w,_[0]/A,G)/this.worldSize,s.G.number(M,z,G)/this.worldSize,o)}coordinatePoint(t,n=0,o=this._pixelMatrix){const h=[t.x*this.worldSize,t.y*this.worldSize,n,1];return s.aH(h,h,o),new s.P(h[0]/h[3],h[1]/h[3])}getBounds(){const t=Math.max(0,this._helper._height/2-le(this));return new br().extend(this.screenPointToLocation(new s.P(0,t))).extend(this.screenPointToLocation(new s.P(this._helper._width,t))).extend(this.screenPointToLocation(new s.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new s.P(0,this._helper._height)))}isPointOnMapSurface(t,n){return n?n.pointCoordinate(t)!=null:t.y>this.height/2-le(this)}calculatePosMatrix(t,n=!1,o){var h;const _=(h=t.key)!==null&&h!==void 0?h:s.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),w=n?this._alignedPosMatrixCache:this._posMatrixCache;if(w.has(_)){const z=w.get(_);return o?z.f32:z.f64}const A=ge(t,this.worldSize);s.S(A,n?this._alignedProjMatrix:this._viewProjMatrix,A);const M={f64:A,f32:new Float32Array(A)};return w.set(_,M),o?M.f32:M.f64}calculateFogMatrix(t){const n=t.key,o=this._fogMatrixCacheF32;if(o.has(n))return o.get(n);const h=ge(t,this.worldSize);return s.S(h,this._fogMatrix,h),o.set(n,new Float32Array(h)),o.get(n)}calculateCenterFromCameraLngLatAlt(t,n,o,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,n,o,h)}_calculateNearFarZIfNeeded(t,n,o){if(!this._helper.autoCalculateNearFarZ)return;const h=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),_=t-h*this._helper._pixelPerMeter/Math.cos(n),w=h<0?_:t,A=Math.PI/2+this.pitchInRadians,M=s.ap(this.fov)*(Math.abs(Math.cos(s.ap(this.roll)))*this.height+Math.abs(Math.sin(s.ap(this.roll)))*this.width)/this.height*(.5+o.y/this.height),z=Math.sin(M)*w/Math.sin(s.an(Math.PI-A-M,.01,Math.PI-.01)),O=le(this),$=Math.atan(O/this._helper.cameraToCenterDistance),G=s.ap(.75),J=$>G?2*$*(.5+o.y/(2*O)):G,ce=Math.sin(J)*w/Math.sin(s.an(Math.PI-A-J,.01,Math.PI-.01)),be=Math.min(z,ce);this._helper._farZ=1.01*(Math.cos(Math.PI/2-n)*be+w),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,n=k(this.worldSize,this.center),o=n.x,h=n.y;this._helper._pixelPerMeter=s.as(1,this.center.lat)*this.worldSize;const _=s.ap(Math.min(this.pitch,P)),w=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(_));let A;this._calculateNearFarZIfNeeded(w,_,t),A=new Float64Array(16),s.be(A,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),s.aB(this._invProjMatrix,A),A[8]=2*-t.x/this._helper._width,A[9]=2*t.y/this._helper._height,this._projectionMatrix=s.bf(A),s.Q(A,A,[1,-1,1]),s.O(A,A,[0,0,-this._helper.cameraToCenterDistance]),s.bg(A,A,-this.rollInRadians),s.bh(A,A,this.pitchInRadians),s.bg(A,A,-this.bearingInRadians),s.O(A,A,[-o,-h,0]),this._mercatorMatrix=s.Q([],A,[this.worldSize,this.worldSize,this.worldSize]),s.Q(A,A,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=s.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,A),s.O(A,A,[0,0,-this.elevation]),this._viewProjMatrix=A,this._invViewProjMatrix=s.aB([],A);const M=[0,0,-1,1];s.aH(M,M,this._invViewProjMatrix),this._cameraPosition=[M[0]/M[3],M[1]/M[3],M[2]/M[3]],this._fogMatrix=new Float64Array(16),s.be(this._fogMatrix,this.fovInRadians,this.width/this.height,w,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,s.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),s.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),s.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),s.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),s.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),s.O(this._fogMatrix,this._fogMatrix,[-o,-h,0]),s.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),s.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=s.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,A);const z=this._helper._width%2/2,O=this._helper._height%2/2,$=Math.cos(this.bearingInRadians),G=Math.sin(-this.bearingInRadians),J=o-Math.round(o)+$*z+G*O,ce=h-Math.round(h)+$*O+G*z,be=new Float64Array(A);if(s.O(be,be,[J>.5?J-1:J,ce>.5?ce-1:ce,0]),this._alignedProjMatrix=be,A=s.aB(new Float64Array(16),this._pixelMatrix),!A)throw new Error("failed to invert matrix");this._pixelMatrixInverse=A,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new s.P(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return s.aH(n,n,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=s.as(1,this.center.lat)*this.worldSize;return ie(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,n){const o=s.a9.fromLngLat(t),h=[o.x*this.worldSize,o.y*this.worldSize,n,1];return s.aH(h,h,this._viewProjMatrix),h[2]/h[3]}getProjectionData(t){const{overscaledTileID:n,aligned:o,applyTerrainMatrix:h}=t,_=this._helper.getMercatorTileCoordinates(n),w=n?this.calculatePosMatrix(n,o,!0):null;let A;return A=n&&n.terrainRttPosMatrix32f&&h?n.terrainRttPosMatrix32f:w||s.bi(),{mainMatrix:A,tileMercatorCoords:_,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:A}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,n,o){return 1}transformLightDirection(t){return s.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,n,o,h){const _=this.calculatePosMatrix(o);let w;h?(w=[t,n,h(t,n),1],s.aH(w,w,_)):(w=[t,n,0,1],pl(w,w,_));const A=w[3];return{point:new s.P(w[0]/A,w[1]/A),signedDistanceFromCamera:A,isOccluded:!1}}populateCache(t){for(const n of t)this.calculatePosMatrix(n)}getMatrixForModel(t,n){const o=s.a9.fromLngLat(t,n),h=o.meterInMercatorCoordinateUnits(),_=s.bj();return s.O(_,_,[o.x,o.y,o.z]),s.bg(_,_,Math.PI),s.bh(_,_,Math.PI/2),s.Q(_,_,[-h,h,h]),_}getProjectionDataForCustomLayer(t=!0){const n=new s.a2(0,0,0,0,0),o=this.getProjectionData({overscaledTileID:n,applyGlobeMatrix:t}),h=ge(n,this.worldSize);s.S(h,this._viewProjMatrix,h),o.tileMercatorCoords=[0,0,1,1];const _=[s.a5,s.a5,this.worldSize/this._helper.pixelsPerMeter],w=s.bk();return s.Q(w,h,_),o.fallbackMatrix=w,o.mainMatrix=w,o}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function qs(){s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Ia(m){if(m.useSlerp)if(m.k<1){const t=s.bl(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),n=s.bl(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),o=new Float64Array(4);s.bm(o,t,n,m.k);const h=s.bn(o);m.tr.setRoll(h.roll),m.tr.setPitch(h.pitch),m.tr.setBearing(h.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(s.G.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(s.G.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(s.G.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function Uo(m,t,n,o,h){const _=h.padding,w=k(h.worldSize,n.getNorthWest()),A=k(h.worldSize,n.getNorthEast()),M=k(h.worldSize,n.getSouthEast()),z=k(h.worldSize,n.getSouthWest()),O=s.ap(-o),$=w.rotate(O),G=A.rotate(O),J=M.rotate(O),ce=z.rotate(O),be=new s.P(Math.max($.x,G.x,ce.x,J.x),Math.max($.y,G.y,ce.y,J.y)),Te=new s.P(Math.min($.x,G.x,ce.x,J.x),Math.min($.y,G.y,ce.y,J.y)),Se=be.sub(Te),Me=(h.width-(_.left+_.right+t.left+t.right))/Se.x,He=(h.height-(_.top+_.bottom+t.top+t.bottom))/Se.y;if(He<0||Me<0)return void qs();const Ee=Math.min(s.at(h.scale*Math.min(Me,He)),m.maxZoom),Xe=s.P.convert(m.offset),et=new s.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(s.ap(o)),qe=Xe.add(et).mult(h.scale/s.aq(Ee));return{center:ee(h.worldSize,w.add(M).div(2).sub(qe)),zoom:Ee,bearing:o}}class Gs{get useGlobeControls(){return!1}handlePanInertia(t,n){const o=t.mag(),h=Math.abs(le(n));return{easingOffset:t.mult(Math.min(.75*h/o,1)),easingCenter:n.center}}handleMapControlsRollPitchBearingZoom(t,n){t.bearingDelta&&n.setBearing(n.bearing+t.bearingDelta),t.pitchDelta&&n.setPitch(n.pitch+t.pitchDelta),t.rollDelta&&n.setRoll(n.roll+t.rollDelta),t.zoomDelta&&n.setZoom(n.zoom+t.zoomDelta)}handleMapControlsPan(t,n,o){t.around.distSqr(n.centerPoint)<.01||n.setLocationAtPoint(o,t.around)}cameraForBoxAndBearing(t,n,o,h,_){return Uo(t,n,o,h,_)}handleJumpToCenterZoom(t,n){t.zoom!==(n.zoom!==void 0?+n.zoom:t.zoom)&&t.setZoom(+n.zoom),n.center!==void 0&&t.setCenter(s.V.convert(n.center))}handleEaseTo(t,n){const o=t.zoom,h=t.padding,_={roll:t.roll,pitch:t.pitch,bearing:t.bearing},w={roll:n.roll===void 0?t.roll:n.roll,pitch:n.pitch===void 0?t.pitch:n.pitch,bearing:n.bearing===void 0?t.bearing:n.bearing},A=n.zoom!==void 0,M=!t.isPaddingEqual(n.padding);let z=!1;const O=A?+n.zoom:t.zoom;let $=t.centerPoint.add(n.offsetAsPoint);const G=t.screenPointToLocation($),{center:J,zoom:ce}=t.applyConstrain(s.V.convert(n.center||G),O??o);Us(t,J);const be=k(t.worldSize,G),Te=k(t.worldSize,J).sub(be),Se=s.aq(ce-o);return z=ce!==o,{easeFunc:Me=>{if(z&&t.setZoom(s.G.number(o,ce,Me)),s.bo(_,w)||Ia({startEulerAngles:_,endEulerAngles:w,tr:t,k:Me,useSlerp:_.roll!=w.roll}),M&&(t.interpolatePadding(h,n.padding,Me),$=t.centerPoint.add(n.offsetAsPoint)),n.around)t.setLocationAtPoint(n.around,n.aroundPoint);else{const He=s.aq(t.zoom-o),Ee=ce>o?Math.min(2,Se):Math.max(.5,Se),Xe=Math.pow(Ee,1-Me),et=ee(t.worldSize,be.add(Te.mult(Me*Xe)).mult(He));t.setLocationAtPoint(t.renderWorldCopies?et.wrap():et,$)}},isZooming:z,elevationCenter:J}}handleFlyTo(t,n){const o=n.zoom!==void 0,h=t.zoom,_=t.applyConstrain(s.V.convert(n.center||n.locationAtOffset),o?+n.zoom:h),w=_.center,A=_.zoom;Us(t,w);const M=k(t.worldSize,n.locationAtOffset),z=k(t.worldSize,w).sub(M),O=z.mag(),$=s.aq(A-h);let G;if(n.minZoom!==void 0){const J=Math.min(+n.minZoom,h,A),ce=t.applyConstrain(w,J).zoom;G=s.aq(ce-h)}return{easeFunc:(J,ce,be,Te)=>{t.setZoom(J===1?A:h+s.at(ce));const Se=J===1?w:ee(t.worldSize,M.add(z.mult(be)).mult(ce));t.setLocationAtPoint(t.renderWorldCopies?Se.wrap():Se,Te)},scaleOfZoom:$,targetCenter:w,scaleOfMinZoom:G,pixelPathLength:O}}}class vi{constructor(t,n,o){this.blendFunction=t,this.blendColor=n,this.mask=o}}vi.Replace=[1,0],vi.disabled=new vi(vi.Replace,s.bp.transparent,[!1,!1,!1,!1]),vi.unblended=new vi(vi.Replace,s.bp.transparent,[!0,!0,!0,!0]),vi.alphaBlended=new vi([1,771],s.bp.transparent,[!0,!0,!0,!0]);const $s=2305;class si{constructor(t,n,o){this.enable=t,this.mode=n,this.frontFace=o}}si.disabled=new si(!1,1029,$s),si.backCCW=new si(!0,1029,$s),si.frontCCW=new si(!0,1028,$s);class Zr{constructor(t,n,o){this.func=t,this.mask=n,this.range=o}}Zr.ReadOnly=!1,Zr.ReadWrite=!0,Zr.disabled=new Zr(519,Zr.ReadOnly,[0,1]);const Ha=7680;class Qr{constructor(t,n,o,h,_,w){this.test=t,this.ref=n,this.mask=o,this.fail=h,this.depthFail=_,this.pass=w}}Qr.disabled=new Qr({func:519,mask:0},0,0,Ha,Ha,Ha);const Is=new WeakMap;function ns(m){var t;if(Is.has(m))return Is.get(m);{const n=(t=m.getParameter(m.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Is.set(m,n),n}}class Zs{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const n=t.context,o=n.gl;this._texFormat=o.RGBA,this._texType=o.UNSIGNED_BYTE;const h=new s.aW;h.emplaceBack(-1,-1),h.emplaceBack(2,-1),h.emplaceBack(-1,2);const _=new s.aY;_.emplaceBack(0,1,2),this._fullscreenTriangle=new wi(n.createVertexBuffer(h,Xn.members),n.createIndexBuffer(_),s.aX.simpleSegment(0,0,h.length,_.length)),this._resultBuffer=new Uint8Array(4),n.activeTexture.set(o.TEXTURE1);const w=o.createTexture();o.bindTexture(o.TEXTURE_2D,w),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texImage2D(o.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=n.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(w),ns(o)&&(this._pbo=o.createBuffer(),o.bindBuffer(o.PIXEL_PACK_BUFFER,this._pbo),o.bufferData(o.PIXEL_PACK_BUFFER,4,o.STREAM_READ),o.bindBuffer(o.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,n){const o=this._updateCount;return this._readbackQueue?o>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():o>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,n),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,n=t.gl;t.activeTexture.set(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,n){const o=this._cachedRenderContext.context,h=o.gl;if(this._bindFramebuffer(),o.viewport.set([0,0,this._texWidth,this._texHeight]),o.clear({color:s.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(o,h.TRIANGLES,Zr.disabled,Qr.disabled,vi.unblended,si.disabled,((_,w)=>({u_input:_,u_output_expected:w}))(t,n),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&ns(h)){h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.readBuffer(h.COLOR_ATTACHMENT0),h.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null);const _=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:_}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&ns(t)){const n=t.clientWaitSync(this._readbackQueue.sync,0,0);if(n===t.WAIT_FAILED)return s.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(n===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Zs._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let n=0;return n+=t[0]/256,n+=t[1]/65536,n+=t[2]/16777216,t[3]<127&&(n=-n),n/128}}const ha=s.a5/128;function N(m,t){const n=m.granularity!==void 0?Math.max(m.granularity,1):1,o=n+(m.generateBorders?2:0),h=n+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),_=o+1,w=h+1,A=m.generateBorders?-1:0,M=m.generateBorders||m.extendToNorthPole?-1:0,z=n+(m.generateBorders?1:0),O=n+(m.generateBorders||m.extendToSouthPole?1:0),$=_*w,G=o*h*6,J=_*w>65536;if(J&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const ce=J||t==="32bit",be=new Int16Array(2*$);let Te=0;for(let He=M;He<=O;He++)for(let Ee=A;Ee<=z;Ee++){let Xe=Ee/n*s.a5;Ee===-1&&(Xe=-ha),Ee===n+1&&(Xe=s.a5+ha);let et=He/n*s.a5;He===-1&&(et=m.extendToNorthPole?s.br:-ha),He===n+1&&(et=m.extendToSouthPole?s.bs:s.a5+ha),be[Te++]=Xe,be[Te++]=et}const Se=ce?new Uint32Array(G):new Uint16Array(G);let Me=0;for(let He=0;He<h;He++)for(let Ee=0;Ee<o;Ee++){const Xe=Ee+1+He*_,et=Ee+(He+1)*_,qe=Ee+1+(He+1)*_;Se[Me++]=Ee+He*_,Se[Me++]=et,Se[Me++]=Xe,Se[Me++]=Xe,Se[Me++]=et,Se[Me++]=qe}return{vertices:be.buffer.slice(0),indices:Se.buffer.slice(0),uses32bitIndices:ce}}const ae=new s.aV({fill:new s.bt(128,2),line:new s.bt(512,0),tile:new s.bt(128,32),stencil:new s.bt(128,1),circle:3});class Ne{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Bi.projectionGlobe}get vertexShaderPreludeCode(){return Bi.projectionMercator.vertexSource}get subdivisionGranularity(){return ae}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new Zs(t));const n=s.X(this._errorQueryLatitudeDegrees),o=2*Math.atan(Math.exp(Math.PI-n*Math.PI*2))-.5*Math.PI,h=this._errorMeasurement.updateErrorLoop(n,o),_=he();h!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=h,this._errorMeasurementLastChangeTime=_);const w=Math.min(Math.max((_-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=s.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,s.bv(w))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,n,o,h,_){const w=(_==="stencil"?ae.stencil:ae.tile).getGranularityForZoomLevel(n.z);return this._getMesh(t,{granularity:w,generateBorders:o,extendToNorthPole:n.y===0&&h,extendToSouthPole:n.y===(1<<n.z)-1&&h})}_getMesh(t,n){const o=this._getMeshKey(n);if(o in this._tileMeshCache)return this._tileMeshCache[o];const h=(function(_,w){const A=N(w,"16bit"),M=s.aW.deserialize({arrayBuffer:A.vertices,length:A.vertices.byteLength/2/2}),z=s.aY.deserialize({arrayBuffer:A.indices,length:A.indices.byteLength/2/3});return new wi(_.createVertexBuffer(M,Xn.members),_.createIndexBuffer(z),s.aX.simpleSegment(0,0,M.length,z.length))})(t,n);return this._tileMeshCache[o]=h,h}recalculate(t){}hasTransition(){const t=he();let n=!1;return n=n||(t-this._errorMeasurementLastChangeTime)/1e3<.7,n=n||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,n}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const it=new s.t({type:new s.D(s.u.projection.type)});class pt extends s.E{constructor(t){super(),this._transitionable=new s.x(it,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.H(0)),this._mercatorProjection=new Un,this._verticalPerspectiveProjection=new Ne}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof s.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,n,o,h,_){return this.currentProjection.getMeshFromTileID(t,n,o,h,_)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function Rt(m){const t=Pr(m.worldSize,m.center.lat);return 2*Math.PI*t}function Wt(m,t,n,o,h){const _=1/(1<<h),w=t/s.a5*_+o*_,A=s.bz((m/s.a5*_+n*_)*Math.PI*2+Math.PI,2*Math.PI),M=2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI,z=Math.cos(M),O=new Float64Array(3);return O[0]=Math.sin(A)*z,O[1]=Math.sin(M),O[2]=Math.cos(A)*z,O}function ar(m){return(function(t,n){const o=Math.cos(n),h=new Float64Array(3);return h[0]=Math.sin(t)*o,h[1]=Math.sin(n),h[2]=Math.cos(t)*o,h})(m.lng*Math.PI/180,m.lat*Math.PI/180)}function Pr(m,t){return m/(2*Math.PI)/Math.cos(t*Math.PI/180)}function Wr(m){const t=Math.asin(m[1])/Math.PI*180,n=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(n>1e-6){const o=m[0]/n,h=Math.acos(m[2]/n),_=(o>0?h:-h)/Math.PI*180;return new s.V(s.W(_,-180,180),t)}return new s.V(0,t)}function Xr(m){return Math.cos(m*Math.PI/180)}function Or(m,t){const n=Xr(m),o=Xr(t);return s.at(o/n)}function Hi(m,t){const n=m.rotate(t.bearingInRadians),o=t.zoom+Or(t.center.lat,0),h=s.bu(1/Xr(t.center.lat),1/Xr(Math.min(Math.abs(t.center.lat),60)),s.bx(o,7,3,0,1)),_=360/Rt({worldSize:t.worldSize,center:{lat:t.center.lat}});return new s.V(t.center.lng-n.x*_*h,s.an(t.center.lat+n.y*_,-s.ao,s.ao))}function pn(m){const t=.5*m,n=Math.sin(t),o=Math.cos(t);return Math.log(n+o)-Math.log(o-n)}function Ei(m,t,n,o){const h=m.lat+n*o;if(Math.abs(n)>1){const _=(Math.sign(m.lat+n)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,w=Math.abs(m.lat+n)*Math.PI/180,A=pn(_+o*(w-_)),M=pn(_),z=pn(w);return new s.V(m.lng+t*((A-M)/(z-M)),h)}return new s.V(m.lng+t*o,h)}class Ln{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,n,o,h){const _=`${t.z}_${t.x}_${t.y}_${h?.terrain?"t":""}`,w=this._cache.get(_);if(w)return w;const A=this._cachePrevious.get(_);if(A)return this._cache.set(_,A),A;const M=this._boundingVolumeFactory(t,n,o,h);return this._cache.set(_,M),this._hadAnyChanges=!0,M}}class Gi{constructor(t,n,o,h){this.min=o,this.max=h,this.points=t,this.planes=n}static fromAabb(t,n){const o=[];for(let h=0;h<8;h++)o.push([1&~h?t[0]:n[0],(h>>1&1)==1?n[1]:t[1],(h>>2&1)==1?n[2]:t[2]]);return new Gi(o,[[-1,0,0,n[0]],[1,0,0,-t[0]],[0,-1,0,n[1]],[0,1,0,-t[1]],[0,0,-1,n[2]],[0,0,1,-t[2]]],t,n)}static fromCenterSizeAngles(t,n,o){const h=s.bB([],o[0],o[1],o[2]),_=s.bC([],[n[0],0,0],h),w=s.bC([],[0,n[1],0],h),A=s.bC([],[0,0,n[2]],h),M=[...t],z=[...t];for(let $=0;$<8;$++)for(let G=0;G<3;G++){const J=t[G]+_[G]*(1&~$?-1:1)+w[G]*(($>>1&1)==1?1:-1)+A[G]*(($>>2&1)==1?1:-1);M[G]=Math.min(M[G],J),z[G]=Math.max(z[G],J)}const O=[];for(let $=0;$<8;$++){const G=[...t];s.b0(G,G,s.a$([],_,1&~$?-1:1)),s.b0(G,G,s.a$([],w,($>>1&1)==1?1:-1)),s.b0(G,G,s.a$([],A,($>>2&1)==1?1:-1)),O.push(G)}return new Gi(O,[[..._,-s.b5(_,O[0])],[...w,-s.b5(w,O[0])],[...A,-s.b5(A,O[0])],[-_[0],-_[1],-_[2],-s.b5(_,O[7])],[-w[0],-w[1],-w[2],-s.b5(w,O[7])],[-A[0],-A[1],-A[2],-s.b5(A,O[7])]],M,z)}intersectsFrustum(t){let n=!0;const o=this.points.length,h=this.planes.length,_=t.planes.length,w=t.points.length;for(let A=0;A<_;A++){const M=t.planes[A];let z=0;for(let O=0;O<o;O++){const $=this.points[O];M[0]*$[0]+M[1]*$[1]+M[2]*$[2]+M[3]>=0&&z++}if(z===0)return 0;z<o&&(n=!1)}if(n)return 2;for(let A=0;A<h;A++){const M=this.planes[A];let z=0;for(let O=0;O<w;O++){const $=t.points[O];M[0]*$[0]+M[1]*$[1]+M[2]*$[2]+M[3]>=0&&z++}if(z===0)return 0}return 1}intersectsPlane(t){const n=this.points.length;let o=0;for(let h=0;h<n;h++){const _=this.points[h];t[0]*_[0]+t[1]*_[1]+t[2]*_[2]+t[3]>=0&&o++}return o===n?2:o===0?0:1}}function Sn(m,t,n){const o=m-t;return o<0?-o:Math.max(0,o-n)}function fs(m,t,n,o,h){const _=m-n;let w;return w=_<0?Math.min(-_,1+_-h):_>1?Math.min(Math.max(_-h,0),1-_):0,Math.max(w,Sn(t,o,h))}class Ls{constructor(){this._boundingVolumeCache=new Ln(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,n,o,h){const _=1<<o.z,w=1/_,A=o.x/_,M=o.y/_;let z=2;return z=Math.min(z,fs(t,n,A,M,w)),z=Math.min(z,fs(t,n,A+.5,-M-w,w)),z=Math.min(z,fs(t,n,A+.5,2-M-w,w)),z}getWrap(t,n,o){const h=1<<n.z,_=1/h,w=n.x/h,A=Sn(t.x,w,_),M=Sn(t.x,w-1,_),z=Sn(t.x,w+1,_),O=Math.min(A,M,z);return O===z?1:O===M?-1:0}allowVariableZoom(t,n){return Ct(t,n)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,n,o,h){return this._boundingVolumeCache.getTileBoundingVolume(t,n,o,h)}_computeTileBoundingVolume(t,n,o,h){var _,w;let A=0,M=0;if(h?.terrain){const z=new s.a2(t.z,n,t.z,t.x,t.y),O=h.terrain.getMinMaxElevation(z);A=(_=O.minElevation)!==null&&_!==void 0?_:Math.min(0,o),M=(w=O.maxElevation)!==null&&w!==void 0?w:Math.max(0,o)}if(A/=s.bE,M/=s.bE,A+=1,M+=1,t.z<=0)return Gi.fromAabb([-M,-M,-M],[M,M,M]);if(t.z===1)return Gi.fromAabb([t.x===0?-M:0,t.y===0?0:-M,-M],[t.x===0?0:M,t.y===0?M:0,M]);{const z=[Wt(0,0,t.x,t.y,t.z),Wt(s.a5,0,t.x,t.y,t.z),Wt(s.a5,s.a5,t.x,t.y,t.z),Wt(0,s.a5,t.x,t.y,t.z)],O=[];for(const St of z)O.push(s.a$([],St,M));if(M!==A)for(const St of z)O.push(s.a$([],St,A));t.y===0&&O.push([0,1,0]),t.y===(1<<t.z)-1&&O.push([0,-1,0]);const $=[1,1,1],G=[-1,-1,-1];for(const St of O)for(let Pt=0;Pt<3;Pt++)$[Pt]=Math.min($[Pt],St[Pt]),G[Pt]=Math.max(G[Pt],St[Pt]);const J=Wt(s.a5/2,s.a5/2,t.x,t.y,t.z),ce=s.b4([],[0,1,0],J);s.b3(ce,ce);const be=s.b4([],J,ce);s.b3(be,be);const Te=s.b4([],z[2],z[1]);s.b3(Te,Te);const Se=s.b4([],z[0],z[3]);s.b3(Se,Se),O.push(s.a$([],J,M)),t.y>=(1<<t.z)/2&&O.push(s.a$([],Wt(s.a5/2,0,t.x,t.y,t.z),M)),t.y<(1<<t.z)/2&&O.push(s.a$([],Wt(s.a5/2,s.a5,t.x,t.y,t.z),M));const Me=Cs(J,O),He=Cs(be,O),Ee=[-J[0],-J[1],-J[2],Me.max],Xe=[J[0],J[1],J[2],-Me.min],et=[-be[0],-be[1],-be[2],He.max],qe=[be[0],be[1],be[2],-He.min],lt=[...Te,0],At=[...Se,0],vt=[];return t.y===0?vt.push(s.bD(At,lt,Ee),s.bD(At,lt,Xe)):vt.push(s.bD(et,lt,Ee),s.bD(et,lt,Xe),s.bD(et,At,Ee),s.bD(et,At,Xe)),t.y===(1<<t.z)-1?vt.push(s.bD(At,lt,Ee),s.bD(At,lt,Xe)):vt.push(s.bD(qe,lt,Ee),s.bD(qe,lt,Xe),s.bD(qe,At,Ee),s.bD(qe,At,Xe)),new Gi(vt,[Ee,Xe,et,qe,lt,At],$,G)}}}function Cs(m,t){let n=1/0,o=-1/0;for(const h of t){const _=s.b5(m,h);n=Math.min(n,_),o=Math.max(o,_)}return{min:n,max:o}}class La{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,n,o){return this._helper.interpolatePadding(t,n,o)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,n){this._helper.resize(t,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,n){this._helper.overrideNearFarZ(t,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=s.bF(),this._projectionMatrix=s.bj(),this._globeViewProjMatrix32f=s.bi(),this._globeViewProjMatrixNoCorrection=s.bj(),this._globeViewProjMatrixNoCorrectionInverted=s.bj(),this._globeProjMatrixInverted=s.bj(),this._cameraPosition=s.bA(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(n,o)=>{const h=s.an(n.lat,-s.ao,s.ao),_=s.an(+o,this.minZoom+Or(0,h),this.maxZoom);return{center:new s.V(n.lng,h),zoom:_}},this.applyConstrain=(n,o)=>this._helper.applyConstrain(n,o),this._helper=new Wa({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(n,o)=>this.defaultConstrain(n,o)},t),this._coveringTilesDetailsProvider=new Ls}clone(){const t=new La;return t.apply(this,!1),t}apply(t,n,o){this._globeLatitudeErrorCorrectionRadians=o||0,this._helper.apply(t,n)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=s.bA();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:n,applyGlobeMatrix:o}=t,h=this._helper.getMercatorTileCoordinates(n);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:h,clippingPlane:this._cachedClippingPlane,projectionTransition:o?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const n=this.pitchInRadians,o=this.cameraToCenterDistance/t,h=Math.sin(n)*o,_=Math.cos(n)*o+1,w=1/Math.sqrt(h*h+_*_)*1;let A=-h,M=_;const z=Math.sqrt(A*A+M*M);A/=z,M/=z;const O=[0,A,M];s.bG(O,O,[0,0,0],-this.bearingInRadians),s.bH(O,O,[0,0,0],-1*this.center.lat*Math.PI/180),s.bI(O,O,[0,0,0],this.center.lng*Math.PI/180);const $=1/s.b7(O);return s.a$(O,O,$),[...O,-w*$]}isLocationOccluded(t){return!this.isSurfacePointVisible(ar(t))}transformLightDirection(t){const n=this._helper._center.lng*Math.PI/180,o=this._helper._center.lat*Math.PI/180,h=Math.cos(o),_=[Math.sin(n)*h,Math.sin(o),Math.cos(n)*h],w=[_[2],0,-_[0]],A=[0,0,0];s.b4(A,w,_),s.b3(w,w),s.b3(A,A);const M=[0,0,0];return s.b3(M,[w[0]*t[0]+A[0]*t[1]+_[0]*t[2],w[1]*t[0]+A[1]*t[1]+_[1]*t[2],w[2]*t[0]+A[2]*t[1]+_[2]*t[2]]),M}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,n,o){const h=(function(A,M,z){const O=1/(1<<z.z);return new s.a9(A/s.a5*O+z.x*O,M/s.a5*O+z.y*O)})(t,n,o.canonical),_=(w=h.y,[s.bz(h.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI]);var w;return this.getCircleRadiusCorrection()/Math.cos(_[1])}projectTileCoordinates(t,n,o,h){const _=o.canonical,w=Wt(t,n,_.x,_.y,_.z),A=1+(h?h(t,n):0)/s.bE,M=[w[0]*A,w[1]*A,w[2]*A,1];s.aH(M,M,this._globeViewProjMatrixNoCorrection);const z=this._cachedClippingPlane,O=z[0]*w[0]+z[1]*w[1]+z[2]*w[2]+z[3]<0;return{point:new s.P(M[0]/M[3],M[1]/M[3]),signedDistanceFromCamera:M[3],isOccluded:O}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=Pr(this.worldSize,this.center.lat),n=s.bk(),o=s.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),s.be(n,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const h=this.centerOffset;n[8]=2*-h.x/this._helper._width,n[9]=2*h.y/this._helper._height,this._projectionMatrix=s.bf(n),this._globeProjMatrixInverted=s.bk(),s.aB(this._globeProjMatrixInverted,n),s.O(n,n,[0,0,-this.cameraToCenterDistance]),s.bg(n,n,this.rollInRadians),s.bh(n,n,-this.pitchInRadians),s.bg(n,n,this.bearingInRadians),s.O(n,n,[0,0,-t]);const _=s.bA();_[0]=t,_[1]=t,_[2]=t,s.bh(o,n,this.center.lat*Math.PI/180),s.bJ(o,o,-this.center.lng*Math.PI/180),s.Q(o,o,_),this._globeViewProjMatrixNoCorrection=o,s.bh(n,n,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),s.bJ(n,n,-this.center.lng*Math.PI/180),s.Q(n,n,_),this._globeViewProjMatrix32f=new Float32Array(n),this._globeViewProjMatrixNoCorrectionInverted=s.bk(),s.aB(this._globeViewProjMatrixNoCorrectionInverted,o);const w=s.bA();this._cameraPosition=s.bA(),this._cameraPosition[2]=this.cameraToCenterDistance/t,s.bG(this._cameraPosition,this._cameraPosition,w,-this.rollInRadians),s.bH(this._cameraPosition,this._cameraPosition,w,this.pitchInRadians),s.bG(this._cameraPosition,this._cameraPosition,w,-this.bearingInRadians),s.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),s.bH(this._cameraPosition,this._cameraPosition,w,-this.center.lat*Math.PI/180),s.bI(this._cameraPosition,this._cameraPosition,w,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const A=s.bf(this._globeViewProjMatrixNoCorrectionInverted);s.Q(A,A,[1,1,-1]),this._cachedFrustum=zn.fromInvProjectionMatrix(A,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){s.w("calculateFogMatrix is not supported on globe projection.");const n=s.bk();return s.ar(n),n}getVisibleUnwrappedCoordinates(t){return[new s.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&s.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,n){if(!this._globeViewProjMatrixNoCorrection)return 1;const o=ar(t);s.a$(o,o,1+n/s.bE);const h=s.bF();return s.aH(h,[o[0],o[1],o[2],1],this._globeViewProjMatrixNoCorrection),h[2]/h[3]}populateCache(t){}getBounds(){const t=.5*this.width,n=.5*this.height,o=[new s.P(0,0),new s.P(t,0),new s.P(this.width,0),new s.P(this.width,n),new s.P(this.width,this.height),new s.P(t,this.height),new s.P(0,this.height),new s.P(0,n)],h=[];for(const $ of o)h.push(this.unprojectScreenPoint($));let _=0,w=0,A=0,M=0;const z=this.center;for(const $ of h){const G=s.bK(z.lng,$.lng),J=s.bK(z.lat,$.lat);G<w&&(w=G),G>_&&(_=G),J<M&&(M=J),J>A&&(A=J)}const O=[z.lng+w,z.lat+M,z.lng+_,z.lat+A];return this.isSurfacePointOnScreen([0,1,0])&&(O[3]=90,O[0]=-180,O[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(O[1]=-90,O[0]=-180,O[2]=180),new br(O)}calculateCenterFromCameraLngLatAlt(t,n,o,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,n,o,h)}setLocationAtPoint(t,n){const o=ar(this.unprojectScreenPoint(n)),h=ar(t),_=s.bA();s.bL(_);const w=s.bA();s.bI(w,o,_,-this.center.lng*Math.PI/180),s.bH(w,w,_,this.center.lat*Math.PI/180);const A=h[0]*h[0]+h[2]*h[2],M=w[0]*w[0];if(A<M)return;const z=Math.sqrt(A-M),O=-z,$=s.bM(h[0],h[2],w[0],z),G=s.bM(h[0],h[2],w[0],O),J=s.bA();s.bI(J,h,_,-$);const ce=s.bM(J[1],J[2],w[1],w[2]),be=s.bA();s.bI(be,h,_,-G);const Te=s.bM(be[1],be[2],w[1],w[2]),Se=.5*Math.PI,Me=ce>=-Se&&ce<=Se,He=Te>=-Se&&Te<=Se;let Ee,Xe;if(Me&&He){const At=this.center.lng*Math.PI/180,vt=this.center.lat*Math.PI/180;s.bN($,At)+s.bN(ce,vt)<s.bN(G,At)+s.bN(Te,vt)?(Ee=$,Xe=ce):(Ee=G,Xe=Te)}else if(Me)Ee=$,Xe=ce;else{if(!He)return;Ee=G,Xe=Te}const et=Ee/Math.PI*180,qe=Xe/Math.PI*180,lt=this.center.lat;this.setCenter(new s.V(et,s.an(qe,-90,90))),this.setZoom(this.zoom+Or(lt,this.center.lat))}locationToScreenPoint(t,n){const o=ar(t);if(n){const h=n.getElevationForLngLatZoom(t,this._helper._tileZoom);s.a$(o,o,1+h/s.bE)}return this._projectSurfacePointToScreen(o)}_projectSurfacePointToScreen(t){const n=s.bF();return s.aH(n,[...t,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],new s.P((.5*n[0]+.5)*this.width,(.5*-n[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,n){if(n){const o=n.pointCoordinate(t);if(o)return o}return s.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,n){var o;return(o=this.screenPointToMercatorCoordinate(t,n))===null||o===void 0?void 0:o.toLngLat()}isPointOnMapSurface(t,n){const o=this._cameraPosition,h=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(o,h)}getRayDirectionFromPixel(t){const n=s.bF();n[0]=t.x/this.width*2-1,n[1]=-1*(t.y/this.height*2-1),n[2]=1,n[3]=1,s.aH(n,n,this._globeViewProjMatrixNoCorrectionInverted),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3];const o=s.bA();o[0]=n[0]-this._cameraPosition[0],o[1]=n[1]-this._cameraPosition[1],o[2]=n[2]-this._cameraPosition[2];const h=s.bA();return s.b3(h,o),h}isSurfacePointVisible(t){const n=this._cachedClippingPlane;return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const n=s.bF();return s.aH(n,[...t,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3],n[0]>-1&&n[0]<1&&n[1]>-1&&n[1]<1&&n[2]>-1&&n[2]<1}rayPlanetIntersection(t,n){const o=s.b5(t,n),h=s.bA(),_=s.bA();s.a$(_,n,o),s.b2(h,t,_);const w=1-s.b5(h,h);if(w<0)return null;const A=s.b5(t,t)-1,M=-o+(o<0?1:-1)*Math.sqrt(w),z=A/M,O=M;return{tMin:Math.min(z,O),tMax:Math.max(z,O)}}unprojectScreenPoint(t){const n=this._cameraPosition,o=this.getRayDirectionFromPixel(t),h=this.rayPlanetIntersection(n,o);if(h){const O=s.bA();s.b0(O,n,[o[0]*h.tMin,o[1]*h.tMin,o[2]*h.tMin]);const $=s.bA();return s.b3($,O),Wr($)}const _=this._cachedClippingPlane,w=_[0]*o[0]+_[1]*o[1]+_[2]*o[2],A=-s.bb(_,n)/w,M=s.bA();if(A>0)s.b0(M,n,[o[0]*A,o[1]*A,o[2]*A]);else{const O=s.bA();s.b0(O,n,[2*o[0],2*o[1],2*o[2]]);const $=s.bb(this._cachedClippingPlane,O);s.b2(M,O,[this._cachedClippingPlane[0]*$,this._cachedClippingPlane[1]*$,this._cachedClippingPlane[2]*$])}const z=(function(O){const $=s.bA();return $[0]=O[0]*-O[3],$[1]=O[1]*-O[3],$[2]=O[2]*-O[3],{center:$,radius:Math.sqrt(1-O[3]*O[3])}})(_);return Wr((function(O,$,G){const J=s.bA();s.b2(J,G,O);const ce=s.bA();return s.by(ce,O,J,$/s.b9(J)),ce})(z.center,z.radius,M))}getMatrixForModel(t,n){const o=s.V.convert(t),h=1/s.bE,_=s.bj();return s.bJ(_,_,o.lng/180*Math.PI),s.bh(_,_,-o.lat/180*Math.PI),s.O(_,_,[0,0,1+n/s.bE]),s.bh(_,_,.5*Math.PI),s.Q(_,_,[h,h,h]),_}getProjectionDataForCustomLayer(t=!0){const n=this.getProjectionData({overscaledTileID:new s.a2(0,0,0,0,0),applyGlobeMatrix:t});return n.tileMercatorCoords=[0,0,1,1],n}getFastPathSimpleProjectionMatrix(t){}}class da{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,n,o){return this._helper.interpolatePadding(t,n,o)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,n,o=!0){this._helper.resize(t,n,o)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,n){this._helper.overrideNearFarZ(t,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,n){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=n,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(n,o)=>this.currentTransform.defaultConstrain(n,o),this.applyConstrain=(n,o)=>this._helper.applyConstrain(n,o),this._helper=new Wa({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(n,o)=>this.defaultConstrain(n,o)},t),this._globeness=1,this._mercatorTransform=new ua,this._verticalPerspectiveTransform=new La}clone(){const t=new da;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this,!1),t}apply(t,n){this._helper.apply(t,n),this._mercatorTransform.apply(this,!1),this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const n=this._mercatorTransform.getProjectionData(t),o=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?o.mainMatrix:n.mainMatrix,clippingPlane:o.clippingPlane,tileMercatorCoords:o.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:n.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return s.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return s.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,n,o){const h=this._mercatorTransform.getPitchedTextCorrection(t,n,o),_=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,n,o);return s.bu(h,_,this._globeness)}projectTileCoordinates(t,n,o,h){return this.currentTransform.projectTileCoordinates(t,n,o,h)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,n){return this.currentTransform.lngLatToCameraDepth(t,n)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,n,o,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,n,o,h)}setLocationAtPoint(t,n){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,n),void this.apply(this._mercatorTransform,!1);this._verticalPerspectiveTransform.setLocationAtPoint(t,n),this.apply(this._verticalPerspectiveTransform,!1)}locationToScreenPoint(t,n){return this.currentTransform.locationToScreenPoint(t,n)}screenPointToMercatorCoordinate(t,n){return this.currentTransform.screenPointToMercatorCoordinate(t,n)}screenPointToLocation(t,n){return this.currentTransform.screenPointToLocation(t,n)}isPointOnMapSurface(t,n){return this.currentTransform.isPointOnMapSurface(t,n)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,n){return this.currentTransform.getMatrixForModel(t,n)}getProjectionDataForCustomLayer(t=!0){const n=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return n;const o=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return o.fallbackMatrix=n.mainMatrix,o}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class ki{get useGlobeControls(){return!0}handlePanInertia(t,n){const o=Hi(t,n);return Math.abs(o.lng-n.center.lng)>180&&(o.lng=n.center.lng+179.5*Math.sign(o.lng-n.center.lng)),{easingCenter:o,easingOffset:new s.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,n){const o=t.around,h=n.screenPointToLocation(o);t.bearingDelta&&n.setBearing(n.bearing+t.bearingDelta),t.pitchDelta&&n.setPitch(n.pitch+t.pitchDelta),t.rollDelta&&n.setRoll(n.roll+t.rollDelta);const _=n.zoom;t.zoomDelta&&n.setZoom(n.zoom+t.zoomDelta);const w=n.zoom-_;if(w===0)return;const A=s.bK(n.center.lng,h.lng),M=A/(Math.abs(A/180)+1),z=s.bK(n.center.lat,h.lat),O=n.getRayDirectionFromPixel(o),$=n.cameraPosition,G=-1*s.b5($,O),J=s.bA();s.b0(J,$,[O[0]*G,O[1]*G,O[2]*G]);const ce=s.b7(J)-1,be=Math.exp(.5*-Math.max(ce-.3,0)),Te=Pr(n.worldSize,n.center.lat)/Math.min(n.width,n.height),Se=s.bx(Te,.9,.5,1,.25),Me=(1-s.aq(-w))*Math.min(be,Se),He=n.center.lat,Ee=n.zoom,Xe=new s.V(n.center.lng+M*Me,s.an(n.center.lat+z*Me,-s.ao,s.ao));n.setLocationAtPoint(h,o);const et=n.center,qe=s.bx(Math.abs(A),45,85,0,1),lt=s.bx(Te,.75,.35,0,1),At=Math.pow(Math.max(qe,lt),.25),vt=s.bK(et.lng,Xe.lng),St=s.bK(et.lat,Xe.lat);n.setCenter(new s.V(et.lng+vt*At,et.lat+St*At).wrap()),n.setZoom(Ee+Or(He,n.center.lat))}handleMapControlsPan(t,n,o){if(!t.panDelta)return;const h=n.center.lat,_=n.zoom;n.setCenter(Hi(t.panDelta,n).wrap()),n.setZoom(_+Or(h,n.center.lat))}cameraForBoxAndBearing(t,n,o,h,_){const w=Uo(t,n,o,h,_),A=n.left/_.width*2-1,M=(_.width-n.right)/_.width*2-1,z=n.top/_.height*-2+1,O=(_.height-n.bottom)/_.height*-2+1,$=s.bK(o.getWest(),o.getEast())<0,G=$?o.getEast():o.getWest(),J=$?o.getWest():o.getEast(),ce=Math.max(o.getNorth(),o.getSouth()),be=Math.min(o.getNorth(),o.getSouth()),Te=G+.5*s.bK(G,J),Se=ce+.5*s.bK(ce,be),Me=_.clone();Me.setCenter(w.center),Me.setBearing(w.bearing),Me.setPitch(0),Me.setRoll(0),Me.setZoom(w.zoom);const He=Me.modelViewProjectionMatrix,Ee=[ar(o.getNorthWest()),ar(o.getNorthEast()),ar(o.getSouthWest()),ar(o.getSouthEast()),ar(new s.V(J,Se)),ar(new s.V(G,Se)),ar(new s.V(Te,ce)),ar(new s.V(Te,be))],Xe=ar(w.center);let et=Number.POSITIVE_INFINITY;for(const qe of Ee)A<0&&(et=ki.getLesserNonNegativeNonNull(et,ki.solveVectorScale(qe,Xe,He,"x",A))),M>0&&(et=ki.getLesserNonNegativeNonNull(et,ki.solveVectorScale(qe,Xe,He,"x",M))),z>0&&(et=ki.getLesserNonNegativeNonNull(et,ki.solveVectorScale(qe,Xe,He,"y",z))),O<0&&(et=ki.getLesserNonNegativeNonNull(et,ki.solveVectorScale(qe,Xe,He,"y",O)));if(Number.isFinite(et)&&et!==0)return w.zoom=Me.zoom+s.at(et),w;qs()}handleJumpToCenterZoom(t,n){const o=t.center.lat,h=t.applyConstrain(n.center?s.V.convert(n.center):t.center,t.zoom).center;t.setCenter(h.wrap());const _=n.zoom!==void 0?+n.zoom:t.zoom+Or(o,h.lat);t.zoom!==_&&t.setZoom(_)}handleEaseTo(t,n){const o=t.zoom,h=t.center,_=t.padding,w={roll:t.roll,pitch:t.pitch,bearing:t.bearing},A={roll:n.roll===void 0?t.roll:n.roll,pitch:n.pitch===void 0?t.pitch:n.pitch,bearing:n.bearing===void 0?t.bearing:n.bearing},M=n.zoom!==void 0,z=!t.isPaddingEqual(n.padding);let O=!1;const $=n.center?s.V.convert(n.center):h,G=t.applyConstrain($,o).center;Us(t,G);const J=t.clone();J.setCenter(G),J.setZoom(M?+n.zoom:o+Or(h.lat,$.lat)),J.setBearing(n.bearing);const ce=new s.P(s.an(t.centerPoint.x+n.offsetAsPoint.x,0,t.width),s.an(t.centerPoint.y+n.offsetAsPoint.y,0,t.height));J.setLocationAtPoint(G,ce);const be=(n.offset&&n.offsetAsPoint.mag())>0?J.center:G,Te=M?+n.zoom:o+Or(h.lat,be.lat),Se=o+Or(h.lat,0),Me=Te+Or(be.lat,0),He=s.bK(h.lng,be.lng),Ee=s.bK(h.lat,be.lat),Xe=s.aq(Me-Se);return O=Te!==o,{easeFunc:et=>{if(s.bo(w,A)||Ia({startEulerAngles:w,endEulerAngles:A,tr:t,k:et,useSlerp:w.roll!=A.roll}),z&&t.interpolatePadding(_,n.padding,et),n.around)s.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(n.around,n.aroundPoint);else{const qe=Me>Se?Math.min(2,Xe):Math.max(.5,Xe),lt=Math.pow(qe,1-et),At=Ei(h,He,Ee,et*lt);t.setCenter(At.wrap())}if(O){const qe=s.G.number(Se,Me,et)+Or(0,t.center.lat);t.setZoom(qe)}},isZooming:O,elevationCenter:be}}handleFlyTo(t,n){const o=n.zoom!==void 0,h=t.center,_=t.zoom,w=t.padding,A=!t.isPaddingEqual(n.padding),M=t.applyConstrain(s.V.convert(n.center||n.locationAtOffset),_).center,z=o?+n.zoom:t.zoom+Or(t.center.lat,M.lat),O=t.clone();O.setCenter(M),O.setZoom(z),O.setBearing(n.bearing);const $=new s.P(s.an(t.centerPoint.x+n.offsetAsPoint.x,0,t.width),s.an(t.centerPoint.y+n.offsetAsPoint.y,0,t.height));O.setLocationAtPoint(M,$);const G=O.center;Us(t,G);const J=(function(Ee,Xe,et){const qe=ar(Xe),lt=ar(et),At=s.b5(qe,lt),vt=Math.acos(At),St=Rt(Ee);return vt/(2*Math.PI)*St})(t,h,G),ce=_+Or(h.lat,0),be=z+Or(G.lat,0),Te=s.aq(be-ce);let Se;if(typeof n.minZoom=="number"){const Ee=+n.minZoom+Or(G.lat,0),Xe=Math.min(Ee,ce,be)+Or(0,G.lat),et=t.applyConstrain(G,Xe).zoom+Or(G.lat,0);Se=s.aq(et-ce)}const Me=s.bK(h.lng,G.lng),He=s.bK(h.lat,G.lat);return{easeFunc:(Ee,Xe,et,qe)=>{const lt=Ei(h,Me,He,et);A&&t.interpolatePadding(w,n.padding,Ee);const At=Ee===1?G:lt;t.setCenter(At.wrap());const vt=ce+s.at(Xe);t.setZoom(Ee===1?z:vt+Or(0,At.lat))},scaleOfZoom:Te,targetCenter:G,scaleOfMinZoom:Se,pixelPathLength:J}}static solveVectorScale(t,n,o,h,_){const w=h==="x"?[o[0],o[4],o[8],o[12]]:[o[1],o[5],o[9],o[13]],A=[o[3],o[7],o[11],o[15]],M=t[0]*w[0]+t[1]*w[1]+t[2]*w[2],z=t[0]*A[0]+t[1]*A[1]+t[2]*A[2],O=n[0]*w[0]+n[1]*w[1]+n[2]*w[2],$=n[0]*A[0]+n[1]*A[1]+n[2]*A[2];return O+_*z===M+_*$||A[3]*(M-O)+w[3]*($-z)+M*$==O*z?null:(O+w[3]-_*$-_*A[3])/(O-M-_*$+_*z)}static getLesserNonNegativeNonNull(t,n){return n!==null&&n>=0&&n<t?n:t}}class yo{constructor(t){this._globe=t,this._mercatorCameraHelper=new Gs,this._verticalPerspectiveCameraHelper=new ki}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,n){return this.currentHelper.handlePanInertia(t,n)}handleMapControlsRollPitchBearingZoom(t,n){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,n)}handleMapControlsPan(t,n,o){this.currentHelper.handleMapControlsPan(t,n,o)}cameraForBoxAndBearing(t,n,o,h,_){return this.currentHelper.cameraForBoxAndBearing(t,n,o,h,_)}handleJumpToCenterZoom(t,n){this.currentHelper.handleJumpToCenterZoom(t,n)}handleEaseTo(t,n){return this.currentHelper.handleEaseTo(t,n)}handleFlyTo(t,n){return this.currentHelper.handleFlyTo(t,n)}}const Ws=(m,t)=>s.B(m,t&&t.filter((n=>n.identifier!=="source.canvas"))),Hs=s.bO();class Qi extends s.E{constructor(t,n={}){var o,h;super(),this._rtlPluginLoaded=()=>{for(const w in this.tileManagers){const A=this.tileManagers[w].getSource().type;A!=="vector"&&A!=="geojson"||this.tileManagers[w].reload()}},this.map=t,this.dispatcher=new zt(It(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((w,A)=>this.getGlyphs(w,A))),this.dispatcher.registerMessageHandler("GI",((w,A)=>this.getImages(w,A))),this.dispatcher.registerMessageHandler("GDA",((w,A)=>this.getDashes(w,A))),this.imageManager=new we,this.imageManager.setEventedParent(this);const _=((o=t._container)===null||o===void 0?void 0:o.lang)||typeof document<"u"&&((h=document.documentElement)===null||h===void 0?void 0:h.lang)||void 0;this.glyphManager=new yt(t._requestManager,n.localIdeographFontFamily,_),this.lineAtlas=new Fe(256,512),this.crossTileSymbolIndex=new Hn,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",s.bP()),se().on(Qe,this._rtlPluginLoaded),this.on("data",(w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const A=this.tileManagers[w.sourceId];if(!A)return;const M=A.getSource();if(M&&M.vectorLayerIds)for(const z in this._layers){const O=this._layers[z];O.source===M.id&&this._validateLayer(O)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new s.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,n){var o,h,_;this._checkLoaded();const w=n===null?(_=(h=(o=this.stylesheet.state)===null||o===void 0?void 0:o[t])===null||h===void 0?void 0:h.default)!==null&&_!==void 0?_:null:n;if(s.bR(w,this._globalState[t]))return this;this._globalState[t]=w,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const n=[];for(const o in t)!s.bR(this._globalState[o],t[o].default)&&(n.push(o),this._globalState[o]=t[o].default);this._applyGlobalStateChanges(n)}_applyGlobalStateChanges(t){if(t.length===0)return;const n=new Set,o={};for(const h of t){o[h]=this._globalState[h];for(const _ in this._layers){const w=this._layers[_],A=w.getLayoutAffectingGlobalStateRefs(),M=w.getPaintAffectingGlobalStateRefs(),z=w.getVisibilityAffectingGlobalStateRefs();if(A.has(h)&&n.add(w.source),M.has(h))for(const{name:O,value:$}of M.get(h))this._updatePaintProperty(w,O,$);z?.has(h)&&(w.recalculateVisibility(),this._updateLayer(w))}}this.dispatcher.broadcast("UGS",o);for(const h in this.tileManagers)n.has(h)&&(this._reloadSource(h),this._changed=!0)}loadURL(t,n={},o){this.fire(new s.l("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const h=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const _=this._loadStyleRequest;s.j(h,this._loadStyleRequest).then((w=>{this._loadStyleRequest=null,this._load(w.data,n,o)})).catch((w=>{this._loadStyleRequest=null,w&&!_.signal.aborted&&this.fire(new s.k(w))}))}loadJSON(t,n={},o){this.fire(new s.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,j.frameAsync(this._frameRequest,this.map._ownerWindow).then((()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(t,n,o)})).catch((()=>{}))}loadEmpty(){this.fire(new s.l("dataloading",{dataType:"style"})),this._load(Hs,{validate:!1})}_load(t,n,o){var h,_;let w=n.transformStyle?n.transformStyle(o,t):t;if(!n.validate||!Ws(this,s.C(w))){w=Object.assign({},w),this._loaded=!0,this.stylesheet=w;for(const A in w.sources)this.addSource(A,w.sources[A],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new Qt(this.stylesheet.light),this._setProjectionInternal(((h=this.stylesheet.projection)===null||h===void 0?void 0:h.type)||"mercator"),this.sky=new fe(this.stylesheet.sky),this.map.setTerrain((_=this.stylesheet.terrain)!==null&&_!==void 0?_:null),this.fire(new s.l("data",{dataType:"style"})),this.fire(new s.l("style.load"))}}_createLayers(){var t,n,o;const h=s.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",h),this._order=h.map((_=>_.id)),this._layers={},this._serializedLayers=null;for(const _ of h){const w=s.bT(_,this._globalState);if(w.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=w,s.bU(w)&&this.tileManagers[w.source]){const A=(o=(n=_.paint)===null||n===void 0?void 0:n["raster-fade-duration"])!==null&&o!==void 0?o:w.paint.get("raster-fade-duration");this.tileManagers[w.source].setRasterFadeDuration(A)}}}_loadSprite(t,n=!1,o=void 0){this.imageManager.setLoaded(!1);const h=new AbortController;let _;this._spriteRequest=h,(function(w,A,M,z){return s._(this,void 0,void 0,(function*(){const O=Pe(w),$=M>1?"@2x":"",G={},J={};for(const{id:ce,url:be}of O){const Te=A.transformRequest(rt(be,$,".json"),"SpriteJSON");G[ce]=s.j(Te,z);const Se=A.transformRequest(rt(be,$,".png"),"SpriteImage");J[ce]=st.getImage(Se,z)}return yield Promise.all([...Object.values(G),...Object.values(J)]),(function(ce,be){return s._(this,void 0,void 0,(function*(){const Te={};for(const Se in ce){Te[Se]={};const Me=j.getImageCanvasContext((yield be[Se]).data),He=(yield ce[Se]).data;for(const Ee in He){const{width:Xe,height:et,x:qe,y:lt,sdf:At,pixelRatio:vt,stretchX:St,stretchY:Pt,content:er,textFitWidth:rr,textFitHeight:$t}=He[Ee];Te[Se][Ee]={data:null,pixelRatio:vt,sdf:At,stretchX:St,stretchY:Pt,content:er,textFitWidth:rr,textFitHeight:$t,spriteData:{width:Xe,height:et,x:qe,y:lt,context:Me}}}}return Te}))})(G,J)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((w=>{if(this._spriteRequest=null,w)for(const A in w){this._spritesImagesIds[A]=[];const M=this._spritesImagesIds[A]?this._spritesImagesIds[A].filter((z=>!(z in w))):[];for(const z of M)this.imageManager.removeImage(z),this._changedImages[z]=!0;for(const z in w[A]){const O=A==="default"?z:`${A}:${z}`;this._spritesImagesIds[A].push(O),O in this.imageManager.images?this.imageManager.updateImage(O,w[A][z],!1):this.imageManager.addImage(O,w[A][z]),n&&(this._changedImages[O]=!0)}}})).catch((w=>{this._spriteRequest=null,_=w,h.signal.aborted||this.fire(new s.k(_))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"})),o&&o(_)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}_validateLayer(t){const n=this.tileManagers[t.source];if(!n)return;const o=t.sourceLayer;if(!o)return;const h=n.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(o)===-1)&&this.fire(new s.k(new Error(`Source layer "${o}" does not exist on source "${h.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,n=!1){const o=this._serializedAllLayers();if(!t||t.length===0)return Object.values(n?s.bV(o):o);const h=[];for(const _ of t)if(o[_]){const w=n?s.bV(o[_]):o[_];h.push(w)}return h}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const n=Object.keys(this._layers);for(const o of n){const h=this._layers[o];h.type!=="custom"&&(t[o]=h.serialize())}return t}hasTransitions(){var t,n,o;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((n=this.sky)===null||n===void 0)&&n.hasTransition()||!((o=this.projection)===null||o===void 0)&&o.hasTransition())return!0;for(const h in this.tileManagers)if(this.tileManagers[h].hasTransition())return!0;for(const h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(n){const h=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(h.length||_.length)&&this._updateWorkerLayers(h,_);for(const w in this._updatedSources){const A=this._updatedSources[w];if(A==="reload")this._reloadSource(w);else{if(A!=="clear")throw new Error(`Invalid action ${A}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const o={};for(const h in this.tileManagers){const _=this.tileManagers[h];o[h]=_.used,_.used=!1}for(const h of this._order){const _=this._layers[h];_.recalculate(t,this._availableImages),!_.isHidden(t.zoom)&&_.source&&(this.tileManagers[_.source].used=!0)}for(const h in o){const _=this.tileManagers[h];!!o[h]!=!!_.used&&_.fire(new s.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,n&&this.fire(new s.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.tileManagers)this.tileManagers[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,n={}){var o;this._checkLoaded();const h=this.serialize();if(t=n.transformStyle?n.transformStyle(h,t):t,((o=n.validate)===null||o===void 0||o)&&Ws(this,s.C(t)))return!1;(t=s.bV(t)).layers=s.bS(t.layers);const _=s.bW(h,t),w=this._getOperationsToPerform(_);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const A of w.operations)A();return this.stylesheet=t,this._serializedLayers=null,this.fire(new s.l("style.load",{style:this})),!0}_getOperationsToPerform(t){const n=[],o=[];for(const h of t)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":n.push((()=>this.addLayer.apply(this,h.args)));break;case"removeLayer":n.push((()=>this.removeLayer.apply(this,h.args)));break;case"setPaintProperty":n.push((()=>this.setPaintProperty.apply(this,h.args)));break;case"setLayoutProperty":n.push((()=>this.setLayoutProperty.apply(this,h.args)));break;case"setFilter":n.push((()=>this.setFilter.apply(this,h.args)));break;case"addSource":n.push((()=>this.addSource.apply(this,h.args)));break;case"removeSource":n.push((()=>this.removeSource.apply(this,h.args)));break;case"setLayerZoomRange":n.push((()=>this.setLayerZoomRange.apply(this,h.args)));break;case"setLight":n.push((()=>this.setLight.apply(this,h.args)));break;case"setGeoJSONSourceData":n.push((()=>this.setGeoJSONSourceData.apply(this,h.args)));break;case"setGlyphs":n.push((()=>this.setGlyphs.apply(this,h.args)));break;case"setSprite":n.push((()=>this.setSprite.apply(this,h.args)));break;case"setTerrain":n.push((()=>this.map.setTerrain.apply(this,h.args)));break;case"setSky":n.push((()=>this.setSky.apply(this,h.args)));break;case"setProjection":this.setProjection.apply(this,h.args);break;case"setGlobalState":n.push((()=>this.setGlobalState.apply(this,h.args)));break;case"setTransition":n.push((()=>{}));break;default:o.push(h.command)}return{operations:n,unimplemented:o}}addImage(t,n){if(this.getImage(t))return this.fire(new s.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new s.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,o={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(s.C.source,`sources.${t}`,n,null,o))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const h=this.tileManagers[t]=new mi(t,n,this.dispatcher);h.style=this,h.setEventedParent(this,(()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:t}))),h.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const o in this._layers)if(this._layers[o].source===t)return this.fire(new s.k(new Error(`Source "${t}" cannot be removed while layer "${o}" is using it.`)));const n=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],n.fire(new s.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const o=this.tileManagers[t].getSource();if(o.type!=="geojson")throw new Error(`geojsonSource.type is ${o.type}, which is !== 'geojson`);o.setData(n),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,n,o={}){this._checkLoaded();const h=t.id;if(this.getLayer(h))return void this.fire(new s.k(new Error(`Layer "${h}" already exists on this map.`)));let _;if(t.type==="custom"){if(Ws(this,s.bX(t)))return;_=s.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(h,t.source),t=s.bV(t),t=s.e(t,{source:h})),this._validate(s.C.layer,`layers.${h}`,t,{arrayIndex:-1},o))return;_=s.bT(t,this._globalState),this._validateLayer(_),_.setEventedParent(this,{layer:{id:h}})}const w=n?this._order.indexOf(n):this._order.length;if(n&&w===-1)this.fire(new s.k(new Error(`Cannot add layer "${h}" before non-existing layer "${n}".`)));else{if(this._order.splice(w,0,h),this._layerOrderChanged=!0,this._layers[h]=_,this._removedLayers[h]&&_.source&&_.type!=="custom"){const A=this._removedLayers[h];delete this._removedLayers[h],A.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.tileManagers[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new s.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const o=this._order.indexOf(t);this._order.splice(o,1);const h=n?this._order.indexOf(n):this._order.length;n&&h===-1?this.fire(new s.k(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(h,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new s.k(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const o=this._order.indexOf(t);this._order.splice(o,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,o){this._checkLoaded();const h=this.getLayer(t);h?h.minzoom===n&&h.maxzoom===o||(n!=null&&(h.minzoom=n),o!=null&&(h.maxzoom=o),this._updateLayer(h)):this.fire(new s.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,o={}){this._checkLoaded();const h=this.getLayer(t);if(h){if(!s.bR(h.filter,n))return n==null?(h.setFilter(void 0),void this._updateLayer(h)):void(this._validate(s.C.filter,`layers.${h.id}.filter`,n,null,o)||(h.setFilter(s.bV(n)),this._updateLayer(h)))}else this.fire(new s.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return s.bV(this.getLayer(t).filter)}setLayoutProperty(t,n,o,h={}){this._checkLoaded();const _=this.getLayer(t);_?s.bR(_.getLayoutProperty(n),o)||(_.setLayoutProperty(n,o,h),this._updateLayer(_)):this.fire(new s.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const o=this.getLayer(t);if(o)return o.getLayoutProperty(n);this.fire(new s.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,o,h={}){this._checkLoaded();const _=this.getLayer(t);_?s.bR(_.getPaintProperty(n),o)||this._updatePaintProperty(_,n,o,h):this.fire(new s.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,n,o,h={}){t.setPaintProperty(n,o,h)&&this._updateLayer(t),s.bU(t)&&n==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(o),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const o=t.source,h=t.sourceLayer,_=this.tileManagers[o];if(_===void 0)return void this.fire(new s.k(new Error(`The source '${o}' does not exist in the map's style.`)));const w=_.getSource().type;w==="geojson"&&h?this.fire(new s.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||h?(t.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),_.setFeatureState(h,t.id,n)):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const o=t.source,h=this.tileManagers[o];if(h===void 0)return void this.fire(new s.k(new Error(`The source '${o}' does not exist in the map's style.`)));const _=h.getSource().type,w=_==="vector"?t.sourceLayer:void 0;_!=="vector"||w?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new s.k(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(w,t.id,n):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,o=t.sourceLayer,h=this.tileManagers[n];if(h!==void 0)return h.getSource().type!=="vector"||o?(t.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),h.getFeatureState(o,t.id)):void this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.k(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=s.bY(this.tileManagers,(_=>_.serialize())),n=this._serializeByIds(this._order,!0),o=this.map.getTerrain()||void 0,h=this.stylesheet;return s.bZ({version:h.version,name:h.name,metadata:h.metadata,light:h.light,sky:h.sky,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,projection:h.projection,sources:t,layers:n,terrain:o},(_=>_!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=w=>this._layers[w].type==="fill-extrusion",o={},h=[];for(let w=this._order.length-1;w>=0;w--){const A=this._order[w];if(n(A)){o[A]=w;for(const M of t){const z=M[A];if(z)for(const O of z)h.push(O)}}}h.sort(((w,A)=>A.intersectionZ-w.intersectionZ));const _=[];for(let w=this._order.length-1;w>=0;w--){const A=this._order[w];if(n(A))for(let M=h.length-1;M>=0;M--){const z=h[M].feature;if(o[z.layer.id]<w)break;_.push(z),h.pop()}else for(const M of t){const z=M[A];if(z)for(const O of z)_.push(O.feature)}}return _}queryRenderedFeatures(t,n,o){n&&n.filter&&this._validate(s.C.filter,"queryRenderedFeatures.filter",n.filter,null,n);const h={};if(n&&n.layers){if(!(Array.isArray(n.layers)||n.layers instanceof Set))return this.fire(new s.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const z of n.layers){const O=this._layers[z];if(!O)return this.fire(new s.k(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];h[O.source]=!0}}const _=[];n.availableImages=this._availableImages;const w=this._serializedAllLayers(),A=n.layers instanceof Set?n.layers:Array.isArray(n.layers)?new Set(n.layers):null,M=Object.assign(Object.assign({},n),{layers:A,globalState:this._globalState});for(const z in this.tileManagers)n.layers&&!h[z]||_.push(ur(this.tileManagers[z],this._layers,w,t,M,o,this.map.terrain?(O,$,G)=>this.map.terrain.getElevation(O,$,G):void 0));return this.placement&&_.push((function(z,O,$,G,J,ce,be){const Te={},Se=ce.queryRenderedSymbols(G),Me=[];for(const He of Object.keys(Se).map(Number))Me.push(be[He]);Me.sort(_r);for(const He of Me){const Ee=He.featureIndex.lookupSymbolFeatures(Se[He.bucketInstanceId],O,He.bucketIndex,He.sourceLayerIndex,{filterSpec:J.filter,globalState:J.globalState},J.layers,J.availableImages,z);for(const Xe in Ee){const et=Te[Xe]=Te[Xe]||[],qe=Ee[Xe];qe.sort(((lt,At)=>{const vt=He.featureSortOrder;if(vt){const St=vt.indexOf(lt.featureIndex);return vt.indexOf(At.featureIndex)-St}return At.featureIndex-lt.featureIndex}));for(const lt of qe)et.push(lt)}}return(function(He,Ee,Xe){for(const et in He)for(const qe of He[et])Le(qe,Xe[Ee[et].source]);return He})(Te,z,$)})(this._layers,w,this.tileManagers,t,M,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(t,n){n?.filter&&this._validate(s.C.filter,"querySourceFeatures.filter",n.filter,null,n);const o=this.tileManagers[t];return o?(function(h,_){const w=h.getRenderableIds().map((z=>h.getTileByID(z))),A=[],M={};for(let z=0;z<w.length;z++){const O=w[z],$=O.tileID.canonical.key;M[$]||(M[$]=!0,O.querySourceFeatures(A,_))}return A})(o,n?Object.assign(Object.assign({},n),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const o=this.light.getLight();let h=!1;for(const w in t)if(!s.bR(t[w],o[w])){h=!0;break}if(!h)return;const _={now:he(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(_)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,n={}){this._checkLoaded();const o=this.getSky();let h=!1;if(!t&&!o)return;if(t&&!o)h=!0;else if(!t&&o)h=!0;else for(const w in t)if(!s.bR(t[w],o[w])){h=!0;break}if(!h)return;const _={now:he(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,n),this.sky.updateTransitions(_)}_setProjectionInternal(t){const n=(function(o,h){const _={constrainOverride:h};if(Array.isArray(o)){const w=new pt({type:o});return{projection:w,transform:new da(_),cameraHelper:new yo(w)}}switch(o){case"mercator":return{projection:new Un,transform:new ua(_),cameraHelper:new Gs};case"globe":{const w=new pt({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:w,transform:new da(_),cameraHelper:new yo(w)}}case"vertical-perspective":return{projection:new Ne,transform:new La(_),cameraHelper:new ki};default:return s.w(`Unknown projection name: ${o}. Falling back to mercator projection.`),{projection:new Un,transform:new ua(_),cameraHelper:new Gs}}})(t,this.map.transformConstrain);this.projection=n.projection,this.map.migrateProjection(n.transform,n.cameraHelper);for(const o in this.tileManagers)this.tileManagers[o].reload()}_validate(t,n,o,h,_={}){return(!_||_.validate!==!1)&&Ws(this,t.call(s.C,s.e({key:n,style:this.serialize(),value:o,styleSpec:s.u},h)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),se().off(Qe,this._rtlPluginLoaded);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.tileManagers){const o=this.tileManagers[n];o.setEventedParent(null),o.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const n in this.tileManagers)this.tileManagers[n].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,n,o,h,_=!1){let w=!1,A=!1;const M={};for(const z of this._order){const O=this._layers[z];if(O.type!=="symbol")continue;if(!M[O.source]){const G=this.tileManagers[O.source];M[O.source]=G.getRenderableIds(!0).map((J=>G.getTileByID(J))).sort(((J,ce)=>ce.tileID.overscaledZ-J.tileID.overscaledZ||(J.tileID.isLessThan(ce.tileID)?-1:1)))}const $=this.crossTileSymbolIndex.addLayer(O,M[O.source],t.center.lng);w=w||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||o===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(he(),t.zoom))&&(this.pauseablePlacement=new Za(t,this.map.terrain,this._order,_,n,o,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(he()),A=!0),w&&this.pauseablePlacement.placement.setStale()),A||w)for(const z of this._order){const O=this._layers[z];O.type==="symbol"&&this.placement.updateLayerOpacities(O,M[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(he())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,n){return s._(this,void 0,void 0,(function*(){const o=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const h=this.tileManagers[n.source];return h&&h.setDependencies(n.tileID.key,n.type,n.icons),o}))}getGlyphs(t,n){return s._(this,void 0,void 0,(function*(){const o=yield this.glyphManager.getGlyphs(n.stacks),h=this.tileManagers[n.source];return h&&h.setDependencies(n.tileID.key,n.type,[""]),o}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,n={}){this._checkLoaded(),t&&this._validate(s.C.glyphs,"glyphs",t,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,n){return s._(this,void 0,void 0,(function*(){const o={};for(const[h,_]of Object.entries(n.dashes))o[h]=this.lineAtlas.getDash(_.dasharray,_.round);return o}))}addSprite(t,n,o={},h){this._checkLoaded();const _=[{id:t,url:n}],w=[...Pe(this.stylesheet.sprite),..._];this._validate(s.C.sprite,"sprite",w,null,o)||(this.stylesheet.sprite=w,this._loadSprite(_,!0,h))}removeSprite(t){this._checkLoaded();const n=Pe(this.stylesheet.sprite);if(n.find((o=>o.id===t))){if(this._spritesImagesIds[t])for(const o of this._spritesImagesIds[t])this.imageManager.removeImage(o),this._changedImages[o]=!0;n.splice(n.findIndex((o=>o.id===t)),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}else this.fire(new s.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Pe(this.stylesheet.sprite)}setSprite(t,n={},o){this._checkLoaded(),t&&this._validate(s.C.sprite,"sprite",t,null,n)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,o):(this._unloadSprite(),o&&o(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const n=this.tileManagers[t];n.setEventedParent(null),n.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const n=this._layers[t];n.setEventedParent(null),n.onRemove&&n.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var qo=s.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ca{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,o,h,_,w,A,M,z){this.context=t;let O=this.boundPaintVertexBuffers.length!==h.length;for(let $=0;!O&&$<h.length;$++)this.boundPaintVertexBuffers[$]!==h[$]&&(O=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==o||O||this.boundIndexBuffer!==_||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==A||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==z?this.freshBind(n,o,h,_,w,A,M,z):(t.bindVertexArray.set(this.vao),A&&A.bind(),_&&_.dynamicDraw&&_.bind(),M&&M.bind(),z&&z.bind())}freshBind(t,n,o,h,_,w,A,M){const z=t.numAttributes,O=this.context,$=O.gl;this.vao&&this.destroy(),this.vao=O.createVertexArray(),O.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=h,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=A,this.boundDynamicVertexBuffer3=M,n.enableAttributes($,t);for(const G of o)G.enableAttributes($,t);w&&w.enableAttributes($,t),A&&A.enableAttributes($,t),M&&M.enableAttributes($,t),n.bind(),n.setVertexAttribPointers($,t,_);for(const G of o)G.bind(),G.setVertexAttribPointers($,t,_);w&&(w.bind(),w.setVertexAttribPointers($,t,_)),h&&h.bind(),A&&(A.bind(),A.setVertexAttribPointers($,t,_)),M&&(M.bind(),M.setVertexAttribPointers($,t,_)),O.currentNumAttributes=z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Yl=(m,t,n,o,h)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:t,u_fog_color:n?n.properties.get("fog-color"):s.bp.white,u_fog_ground_blend:n?n.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:h?0:n?n.calculateFogBlendOpacity(o):0,u_horizon_color:n?n.properties.get("horizon-color"):s.bp.white,u_horizon_fog_blend:n?n.properties.get("horizon-fog-blend"):1,u_is_globe_mode:h?1:0}),Ma={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Nn(m){const t=[];for(let n=0;n<m.length;n++){if(m[n]===null)continue;const o=m[n].split(" ");t.push(o.pop())}return t}class Ea{constructor(t,n,o,h,_,w,A,M,z=[]){const O=t.gl;this.program=O.createProgram();const $=Nn(n.staticAttributes),G=o?o.getBinderAttributes():[],J=$.concat(G),ce=Bi.prelude.staticUniforms?Nn(Bi.prelude.staticUniforms):[],be=A.staticUniforms?Nn(A.staticUniforms):[],Te=n.staticUniforms?Nn(n.staticUniforms):[],Se=o?o.getBinderUniforms():[],Me=ce.concat(be).concat(Te).concat(Se),He=[];for(const vt of Me)He.indexOf(vt)<0&&He.push(vt);const Ee=o?o.defines():[];ns(O)&&Ee.unshift("#version 300 es"),_&&Ee.push("#define OVERDRAW_INSPECTOR;"),w&&Ee.push("#define TERRAIN3D;"),M&&Ee.push(M),z&&Ee.push(...z);let Xe=Ee.concat(Bi.prelude.fragmentSource,A.fragmentSource,n.fragmentSource).join(`
`),et=Ee.concat(Bi.prelude.vertexSource,A.vertexSource,n.vertexSource).join(`
`);ns(O)||(Xe=(function(vt){return vt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(Xe),et=(function(vt){return vt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(et));const qe=O.createShader(O.FRAGMENT_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);if(O.shaderSource(qe,Xe),O.compileShader(qe),!O.getShaderParameter(qe,O.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${O.getShaderInfoLog(qe)}`);O.attachShader(this.program,qe);const lt=O.createShader(O.VERTEX_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);if(O.shaderSource(lt,et),O.compileShader(lt),!O.getShaderParameter(lt,O.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${O.getShaderInfoLog(lt)}`);O.attachShader(this.program,lt),this.attributes={};const At={};this.numAttributes=J.length;for(let vt=0;vt<this.numAttributes;vt++)J[vt]&&(O.bindAttribLocation(this.program,vt,J[vt]),this.attributes[J[vt]]=vt);if(O.linkProgram(this.program),!O.getProgramParameter(this.program,O.LINK_STATUS))throw new Error(`Program failed to link: ${O.getProgramInfoLog(this.program)}`);O.deleteShader(lt),O.deleteShader(qe);for(let vt=0;vt<He.length;vt++){const St=He[vt];if(St&&!At[St]){const Pt=O.getUniformLocation(this.program,St);Pt&&(At[St]=Pt)}}this.fixedUniforms=h(t,At),this.terrainUniforms=((vt,St)=>({u_depth:new s.b_(vt,St.u_depth),u_terrain:new s.b_(vt,St.u_terrain),u_terrain_dim:new s.bq(vt,St.u_terrain_dim),u_terrain_matrix:new s.c0(vt,St.u_terrain_matrix),u_terrain_unpack:new s.c1(vt,St.u_terrain_unpack),u_terrain_exaggeration:new s.bq(vt,St.u_terrain_exaggeration)}))(t,At),this.projectionUniforms=((vt,St)=>({u_projection_matrix:new s.c0(vt,St.u_projection_matrix),u_projection_tile_mercator_coords:new s.c1(vt,St.u_projection_tile_mercator_coords),u_projection_clipping_plane:new s.c1(vt,St.u_projection_clipping_plane),u_projection_transition:new s.bq(vt,St.u_projection_transition),u_projection_fallback_matrix:new s.c0(vt,St.u_projection_fallback_matrix)}))(t,At),this.binderUniforms=o?o.getUniforms(t,At):[]}draw(t,n,o,h,_,w,A,M,z,O,$,G,J,ce,be,Te,Se,Me,He){const Ee=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(o),t.setStencilMode(h),t.setColorMode(_),t.setCullFace(w),M){t.activeTexture.set(Ee.TEXTURE2),Ee.bindTexture(Ee.TEXTURE_2D,M.depthTexture),t.activeTexture.set(Ee.TEXTURE3),Ee.bindTexture(Ee.TEXTURE_2D,M.texture);for(const et in this.terrainUniforms)this.terrainUniforms[et].set(M[et])}if(z)for(const et in z)this.projectionUniforms[Ma[et]].set(z[et]);if(A)for(const et in this.fixedUniforms)this.fixedUniforms[et].set(A[et]);Te&&Te.setUniforms(t,this.binderUniforms,ce,{zoom:be});let Xe=0;switch(n){case Ee.LINES:Xe=2;break;case Ee.TRIANGLES:Xe=3;break;case Ee.LINE_STRIP:Xe=1}for(const et of J.get()){const qe=et.vaos||(et.vaos={});(qe[O]||(qe[O]=new Ca)).bind(t,this,$,Te?Te.getPaintVertexBuffers():[],G,et.vertexOffset,Se,Me,He),Ee.drawElements(n,et.primitiveLength*Xe,Ee.UNSIGNED_SHORT,et.primitiveOffset*Xe*2)}}}function Go(m,t,n){const o=1/s.aN(n,1,t.transform.tileZoom),h=Math.pow(2,n.tileID.overscaledZ),_=n.tileSize*Math.pow(2,t.transform.tileZoom)/h,w=_*(n.tileID.canonical.x+n.tileID.wrap*h),A=_*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[o,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[w>>16,A>>16],u_pixel_coord_lower:[65535&w,65535&A]}}const _l=(m,t,n,o)=>{const h=m.style.light,_=h.properties.get("position"),w=[_.x,_.y,_.z],A=s.c4();h.properties.get("anchor")==="viewport"&&s.c5(A,m.transform.bearingInRadians),s.c6(w,w,A);const M=m.transform.transformLightDirection(w),z=h.properties.get("color");return{u_lightpos:w,u_lightpos_globe:M,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+t,u_opacity:n,u_fill_translate:o}},ps=(m,t,n,o,h,_,w)=>s.e(_l(m,t,n,o),Go(_,m,w),{u_height_factor:-Math.pow(2,h.overscaledZ)/w.tileSize/8}),Xa=(m,t,n,o)=>s.e(Go(t,m,n),{u_fill_translate:o}),yl=(m,t)=>({u_world:m,u_fill_translate:t}),vl=(m,t,n,o,h)=>s.e(Xa(m,t,n,h),{u_world:o}),Ya=(m,t,n,o,h)=>{const _=m.transform;let w,A,M=0;if(n.paint.get("circle-pitch-alignment")==="map"){const z=s.aN(t,1,_.zoom);w=!0,A=[z,z],M=z/(s.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*h}else w=!1,A=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(n.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+w,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:A,u_globe_extrude_scale:M,u_translate:o}},Ms=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),ms=m=>({u_viewport_size:[m.width,m.height]}),ss=(m,t=1)=>({u_color:m,u_overlay:0,u_overlay_scale:t}),Es=(m,t,n,o)=>{const h=s.aN(m,1,t)/(s.a5*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*o;return{u_extrude_scale:s.aN(m,1,t),u_intensity:n,u_globe_extrude_scale:h}},ka=(m,t,n,o)=>{const h=s.N();s.c7(h,0,m.width,m.height,0,0,1);const _=m.context.gl;return{u_matrix:h,u_world:[_.drawingBufferWidth,_.drawingBufferHeight],u_image:n,u_color_ramp:o,u_opacity:t.paint.get("heatmap-opacity")}},fa=(m,t,n)=>{const o=n.paint.get("hillshade-accent-color");let h;switch(n.paint.get("hillshade-method")){case"basic":h=4;break;case"combined":h=1;break;case"igor":h=2;break;case"multidirectional":h=3;break;default:h=0}const _=n.getIlluminationProperties();for(let w=0;w<_.directionRadians.length;w++)n.paint.get("hillshade-illumination-anchor")==="viewport"&&(_.directionRadians[w]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:bl(0,t.tileID),u_exaggeration:n.paint.get("hillshade-exaggeration"),u_altitudes:_.altitudeRadians,u_azimuths:_.directionRadians,u_accent:o,u_method:h,u_highlights:_.highlightColor,u_shadows:_.shadowColor}},Jl=(m,t)=>{const n=t.stride,o=s.N();return s.c7(o,0,s.a5,-s.a5,0,0,1),s.O(o,o,[0,-s.a5,0]),{u_matrix:o,u_image:1,u_dimension:[n,n],u_zoom:m.overscaledZ,u_unpack:t.getUnpackVector()}};function bl(m,t){const n=Math.pow(2,t.canonical.z),o=t.canonical.y;return[new s.a9(0,o/n).toLngLat().lat,new s.a9(0,(o+1)/n).toLngLat().lat]}const ln=(m,t,n=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:n,u_opacity:m.paint.get("color-relief-opacity")}),vo=(m,t,n,o)=>{const h=m.transform;return{u_translation:xo(m,t,n),u_ratio:o/s.aN(t,1,h.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},pa=(m,t,n,o,h)=>s.e(vo(m,t,n,o),{u_image:0,u_image_height:h}),Xs=(m,t,n,o,h)=>{const _=m.transform,w=as(t,_);return{u_translation:xo(m,t,n),u_texsize:t.imageAtlasTexture.size,u_ratio:o/s.aN(t,1,_.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[w,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},xl=(m,t,n,o,h)=>{const _=as(t,m.transform);return s.e(vo(m,t,n,o),{u_tileratio:_,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image:0,u_mix:h.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})},bo=(m,t,n,o,h,_)=>{const w=as(t,m.transform);return s.e(vo(m,t,n,o),{u_image:0,u_image_height:_,u_tileratio:w,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image_dash:1,u_mix:h.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})};function as(m,t){return 1/s.aN(m,1,t.tileZoom)}function xo(m,t,n){return s.aO(m.transform,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Da=(m,t,n,o,h)=>{return{u_tl_parent:m,u_scale_parent:t,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*o.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:o.paint.get("raster-brightness-min"),u_brightness_high:o.paint.get("raster-brightness-max"),u_saturation_factor:(w=o.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(_=o.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:Fa(o.paint.get("raster-hue-rotate")),u_coords_top:[h[0].x,h[0].y,h[1].x,h[1].y],u_coords_bottom:[h[3].x,h[3].y,h[2].x,h[2].y]};var _,w};function Fa(m){m*=Math.PI/180;const t=Math.sin(m),n=Math.cos(m);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const za=(m,t,n,o,h,_,w,A,M,z,O,$,G)=>{const J=w.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:J.cameraToCenterDistance,u_pitch:J.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:J.width/J.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_label_plane_matrix:A,u_coord_matrix:M,u_is_text:+O,u_pitch_with_map:+o,u_is_along_line:h,u_is_variable_anchor:_,u_texsize:$,u_texture:0,u_translation:z,u_pitched_scale:G}},Na=(m,t,n,o,h,_,w,A,M,z,O,$,G,J)=>{const ce=w.transform;return s.e(za(m,t,n,o,h,_,w,A,M,z,O,$,J),{u_gamma_scale:o?Math.cos(ce.pitch*Math.PI/180)*ce.cameraToCenterDistance:1,u_device_pixel_ratio:w.pixelRatio,u_is_halo:1})},gs=(m,t,n,o,h,_,w,A,M,z,O,$,G)=>s.e(Na(m,t,n,o,h,_,w,A,M,z,!0,O,0,G),{u_texsize_icon:$,u_texture_icon:1}),Ja=(m,t)=>({u_opacity:m,u_color:t}),Ys=(m,t,n,o,h)=>s.e((function(_,w,A,M){const z=A.imageManager.getPattern(_.from.toString()),O=A.imageManager.getPattern(_.to.toString()),{width:$,height:G}=A.imageManager.getPixelSize(),J=Math.pow(2,M.tileID.overscaledZ),ce=M.tileSize*Math.pow(2,A.transform.tileZoom)/J,be=ce*(M.tileID.canonical.x+M.tileID.wrap*J),Te=ce*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[$,G],u_mix:w.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/s.aN(M,1,A.transform.tileZoom),u_pixel_coord_upper:[be>>16,Te>>16],u_pixel_coord_lower:[65535&be,65535&Te]}})(n,h,t,o),{u_opacity:m}),ma=(m,t)=>{},Si={fillExtrusion:(m,t)=>({u_lightpos:new s.c2(m,t.u_lightpos),u_lightpos_globe:new s.c2(m,t.u_lightpos_globe),u_lightintensity:new s.bq(m,t.u_lightintensity),u_lightcolor:new s.c2(m,t.u_lightcolor),u_vertical_gradient:new s.bq(m,t.u_vertical_gradient),u_opacity:new s.bq(m,t.u_opacity),u_fill_translate:new s.c3(m,t.u_fill_translate)}),fillExtrusionPattern:(m,t)=>({u_lightpos:new s.c2(m,t.u_lightpos),u_lightpos_globe:new s.c2(m,t.u_lightpos_globe),u_lightintensity:new s.bq(m,t.u_lightintensity),u_lightcolor:new s.c2(m,t.u_lightcolor),u_vertical_gradient:new s.bq(m,t.u_vertical_gradient),u_height_factor:new s.bq(m,t.u_height_factor),u_opacity:new s.bq(m,t.u_opacity),u_fill_translate:new s.c3(m,t.u_fill_translate),u_image:new s.b_(m,t.u_image),u_texsize:new s.c3(m,t.u_texsize),u_pixel_coord_upper:new s.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.c3(m,t.u_pixel_coord_lower),u_scale:new s.c2(m,t.u_scale),u_fade:new s.bq(m,t.u_fade)}),fill:(m,t)=>({u_fill_translate:new s.c3(m,t.u_fill_translate)}),fillPattern:(m,t)=>({u_image:new s.b_(m,t.u_image),u_texsize:new s.c3(m,t.u_texsize),u_pixel_coord_upper:new s.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.c3(m,t.u_pixel_coord_lower),u_scale:new s.c2(m,t.u_scale),u_fade:new s.bq(m,t.u_fade),u_fill_translate:new s.c3(m,t.u_fill_translate)}),fillOutline:(m,t)=>({u_world:new s.c3(m,t.u_world),u_fill_translate:new s.c3(m,t.u_fill_translate)}),fillOutlinePattern:(m,t)=>({u_world:new s.c3(m,t.u_world),u_image:new s.b_(m,t.u_image),u_texsize:new s.c3(m,t.u_texsize),u_pixel_coord_upper:new s.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.c3(m,t.u_pixel_coord_lower),u_scale:new s.c2(m,t.u_scale),u_fade:new s.bq(m,t.u_fade),u_fill_translate:new s.c3(m,t.u_fill_translate)}),circle:(m,t)=>({u_camera_to_center_distance:new s.bq(m,t.u_camera_to_center_distance),u_scale_with_map:new s.b_(m,t.u_scale_with_map),u_pitch_with_map:new s.b_(m,t.u_pitch_with_map),u_extrude_scale:new s.c3(m,t.u_extrude_scale),u_device_pixel_ratio:new s.bq(m,t.u_device_pixel_ratio),u_globe_extrude_scale:new s.bq(m,t.u_globe_extrude_scale),u_translate:new s.c3(m,t.u_translate)}),collisionBox:(m,t)=>({u_pixel_extrude_scale:new s.c3(m,t.u_pixel_extrude_scale)}),collisionCircle:(m,t)=>({u_viewport_size:new s.c3(m,t.u_viewport_size)}),debug:(m,t)=>({u_color:new s.b$(m,t.u_color),u_overlay:new s.b_(m,t.u_overlay),u_overlay_scale:new s.bq(m,t.u_overlay_scale)}),depth:ma,clippingMask:ma,heatmap:(m,t)=>({u_extrude_scale:new s.bq(m,t.u_extrude_scale),u_intensity:new s.bq(m,t.u_intensity),u_globe_extrude_scale:new s.bq(m,t.u_globe_extrude_scale)}),heatmapTexture:(m,t)=>({u_matrix:new s.c0(m,t.u_matrix),u_world:new s.c3(m,t.u_world),u_image:new s.b_(m,t.u_image),u_color_ramp:new s.b_(m,t.u_color_ramp),u_opacity:new s.bq(m,t.u_opacity)}),hillshade:(m,t)=>({u_image:new s.b_(m,t.u_image),u_latrange:new s.c3(m,t.u_latrange),u_exaggeration:new s.bq(m,t.u_exaggeration),u_altitudes:new s.c9(m,t.u_altitudes),u_azimuths:new s.c9(m,t.u_azimuths),u_accent:new s.b$(m,t.u_accent),u_method:new s.b_(m,t.u_method),u_shadows:new s.c8(m,t.u_shadows),u_highlights:new s.c8(m,t.u_highlights)}),hillshadePrepare:(m,t)=>({u_matrix:new s.c0(m,t.u_matrix),u_image:new s.b_(m,t.u_image),u_dimension:new s.c3(m,t.u_dimension),u_zoom:new s.bq(m,t.u_zoom),u_unpack:new s.c1(m,t.u_unpack)}),colorRelief:(m,t)=>({u_image:new s.b_(m,t.u_image),u_unpack:new s.c1(m,t.u_unpack),u_dimension:new s.c3(m,t.u_dimension),u_elevation_stops:new s.b_(m,t.u_elevation_stops),u_color_stops:new s.b_(m,t.u_color_stops),u_color_ramp_size:new s.b_(m,t.u_color_ramp_size),u_opacity:new s.bq(m,t.u_opacity)}),line:(m,t)=>({u_translation:new s.c3(m,t.u_translation),u_ratio:new s.bq(m,t.u_ratio),u_device_pixel_ratio:new s.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new s.c3(m,t.u_units_to_pixels)}),lineGradient:(m,t)=>({u_translation:new s.c3(m,t.u_translation),u_ratio:new s.bq(m,t.u_ratio),u_device_pixel_ratio:new s.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new s.c3(m,t.u_units_to_pixels),u_image:new s.b_(m,t.u_image),u_image_height:new s.bq(m,t.u_image_height)}),linePattern:(m,t)=>({u_translation:new s.c3(m,t.u_translation),u_texsize:new s.c3(m,t.u_texsize),u_ratio:new s.bq(m,t.u_ratio),u_device_pixel_ratio:new s.bq(m,t.u_device_pixel_ratio),u_image:new s.b_(m,t.u_image),u_units_to_pixels:new s.c3(m,t.u_units_to_pixels),u_scale:new s.c2(m,t.u_scale),u_fade:new s.bq(m,t.u_fade)}),lineSDF:(m,t)=>({u_translation:new s.c3(m,t.u_translation),u_ratio:new s.bq(m,t.u_ratio),u_device_pixel_ratio:new s.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new s.c3(m,t.u_units_to_pixels),u_image:new s.b_(m,t.u_image),u_mix:new s.bq(m,t.u_mix),u_tileratio:new s.bq(m,t.u_tileratio),u_crossfade_from:new s.bq(m,t.u_crossfade_from),u_crossfade_to:new s.bq(m,t.u_crossfade_to),u_lineatlas_width:new s.bq(m,t.u_lineatlas_width),u_lineatlas_height:new s.bq(m,t.u_lineatlas_height)}),lineGradientSDF:(m,t)=>({u_translation:new s.c3(m,t.u_translation),u_ratio:new s.bq(m,t.u_ratio),u_device_pixel_ratio:new s.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new s.c3(m,t.u_units_to_pixels),u_image:new s.b_(m,t.u_image),u_image_height:new s.bq(m,t.u_image_height),u_tileratio:new s.bq(m,t.u_tileratio),u_crossfade_from:new s.bq(m,t.u_crossfade_from),u_crossfade_to:new s.bq(m,t.u_crossfade_to),u_image_dash:new s.b_(m,t.u_image_dash),u_mix:new s.bq(m,t.u_mix),u_lineatlas_width:new s.bq(m,t.u_lineatlas_width),u_lineatlas_height:new s.bq(m,t.u_lineatlas_height)}),raster:(m,t)=>({u_tl_parent:new s.c3(m,t.u_tl_parent),u_scale_parent:new s.bq(m,t.u_scale_parent),u_buffer_scale:new s.bq(m,t.u_buffer_scale),u_fade_t:new s.bq(m,t.u_fade_t),u_opacity:new s.bq(m,t.u_opacity),u_image0:new s.b_(m,t.u_image0),u_image1:new s.b_(m,t.u_image1),u_brightness_low:new s.bq(m,t.u_brightness_low),u_brightness_high:new s.bq(m,t.u_brightness_high),u_saturation_factor:new s.bq(m,t.u_saturation_factor),u_contrast_factor:new s.bq(m,t.u_contrast_factor),u_spin_weights:new s.c2(m,t.u_spin_weights),u_coords_top:new s.c1(m,t.u_coords_top),u_coords_bottom:new s.c1(m,t.u_coords_bottom)}),symbolIcon:(m,t)=>({u_is_size_zoom_constant:new s.b_(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.b_(m,t.u_is_size_feature_constant),u_size_t:new s.bq(m,t.u_size_t),u_size:new s.bq(m,t.u_size),u_camera_to_center_distance:new s.bq(m,t.u_camera_to_center_distance),u_pitch:new s.bq(m,t.u_pitch),u_rotate_symbol:new s.b_(m,t.u_rotate_symbol),u_aspect_ratio:new s.bq(m,t.u_aspect_ratio),u_fade_change:new s.bq(m,t.u_fade_change),u_label_plane_matrix:new s.c0(m,t.u_label_plane_matrix),u_coord_matrix:new s.c0(m,t.u_coord_matrix),u_is_text:new s.b_(m,t.u_is_text),u_pitch_with_map:new s.b_(m,t.u_pitch_with_map),u_is_along_line:new s.b_(m,t.u_is_along_line),u_is_variable_anchor:new s.b_(m,t.u_is_variable_anchor),u_texsize:new s.c3(m,t.u_texsize),u_texture:new s.b_(m,t.u_texture),u_translation:new s.c3(m,t.u_translation),u_pitched_scale:new s.bq(m,t.u_pitched_scale)}),symbolSDF:(m,t)=>({u_is_size_zoom_constant:new s.b_(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.b_(m,t.u_is_size_feature_constant),u_size_t:new s.bq(m,t.u_size_t),u_size:new s.bq(m,t.u_size),u_camera_to_center_distance:new s.bq(m,t.u_camera_to_center_distance),u_pitch:new s.bq(m,t.u_pitch),u_rotate_symbol:new s.b_(m,t.u_rotate_symbol),u_aspect_ratio:new s.bq(m,t.u_aspect_ratio),u_fade_change:new s.bq(m,t.u_fade_change),u_label_plane_matrix:new s.c0(m,t.u_label_plane_matrix),u_coord_matrix:new s.c0(m,t.u_coord_matrix),u_is_text:new s.b_(m,t.u_is_text),u_pitch_with_map:new s.b_(m,t.u_pitch_with_map),u_is_along_line:new s.b_(m,t.u_is_along_line),u_is_variable_anchor:new s.b_(m,t.u_is_variable_anchor),u_texsize:new s.c3(m,t.u_texsize),u_texture:new s.b_(m,t.u_texture),u_gamma_scale:new s.bq(m,t.u_gamma_scale),u_device_pixel_ratio:new s.bq(m,t.u_device_pixel_ratio),u_is_halo:new s.b_(m,t.u_is_halo),u_translation:new s.c3(m,t.u_translation),u_pitched_scale:new s.bq(m,t.u_pitched_scale)}),symbolTextAndIcon:(m,t)=>({u_is_size_zoom_constant:new s.b_(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.b_(m,t.u_is_size_feature_constant),u_size_t:new s.bq(m,t.u_size_t),u_size:new s.bq(m,t.u_size),u_camera_to_center_distance:new s.bq(m,t.u_camera_to_center_distance),u_pitch:new s.bq(m,t.u_pitch),u_rotate_symbol:new s.b_(m,t.u_rotate_symbol),u_aspect_ratio:new s.bq(m,t.u_aspect_ratio),u_fade_change:new s.bq(m,t.u_fade_change),u_label_plane_matrix:new s.c0(m,t.u_label_plane_matrix),u_coord_matrix:new s.c0(m,t.u_coord_matrix),u_is_text:new s.b_(m,t.u_is_text),u_pitch_with_map:new s.b_(m,t.u_pitch_with_map),u_is_along_line:new s.b_(m,t.u_is_along_line),u_is_variable_anchor:new s.b_(m,t.u_is_variable_anchor),u_texsize:new s.c3(m,t.u_texsize),u_texsize_icon:new s.c3(m,t.u_texsize_icon),u_texture:new s.b_(m,t.u_texture),u_texture_icon:new s.b_(m,t.u_texture_icon),u_gamma_scale:new s.bq(m,t.u_gamma_scale),u_device_pixel_ratio:new s.bq(m,t.u_device_pixel_ratio),u_is_halo:new s.b_(m,t.u_is_halo),u_translation:new s.c3(m,t.u_translation),u_pitched_scale:new s.bq(m,t.u_pitched_scale)}),background:(m,t)=>({u_opacity:new s.bq(m,t.u_opacity),u_color:new s.b$(m,t.u_color)}),backgroundPattern:(m,t)=>({u_opacity:new s.bq(m,t.u_opacity),u_image:new s.b_(m,t.u_image),u_pattern_tl_a:new s.c3(m,t.u_pattern_tl_a),u_pattern_br_a:new s.c3(m,t.u_pattern_br_a),u_pattern_tl_b:new s.c3(m,t.u_pattern_tl_b),u_pattern_br_b:new s.c3(m,t.u_pattern_br_b),u_texsize:new s.c3(m,t.u_texsize),u_mix:new s.bq(m,t.u_mix),u_pattern_size_a:new s.c3(m,t.u_pattern_size_a),u_pattern_size_b:new s.c3(m,t.u_pattern_size_b),u_scale_a:new s.bq(m,t.u_scale_a),u_scale_b:new s.bq(m,t.u_scale_b),u_pixel_coord_upper:new s.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.c3(m,t.u_pixel_coord_lower),u_tile_units_to_pixels:new s.bq(m,t.u_tile_units_to_pixels)}),terrain:(m,t)=>({u_texture:new s.b_(m,t.u_texture),u_ele_delta:new s.bq(m,t.u_ele_delta),u_fog_matrix:new s.c0(m,t.u_fog_matrix),u_fog_color:new s.b$(m,t.u_fog_color),u_fog_ground_blend:new s.bq(m,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new s.bq(m,t.u_fog_ground_blend_opacity),u_horizon_color:new s.b$(m,t.u_horizon_color),u_horizon_fog_blend:new s.bq(m,t.u_horizon_fog_blend),u_is_globe_mode:new s.bq(m,t.u_is_globe_mode)}),terrainDepth:(m,t)=>({u_ele_delta:new s.bq(m,t.u_ele_delta)}),terrainCoords:(m,t)=>({u_texture:new s.b_(m,t.u_texture),u_terrain_coords_id:new s.bq(m,t.u_terrain_coords_id),u_ele_delta:new s.bq(m,t.u_ele_delta)}),projectionErrorMeasurement:(m,t)=>({u_input:new s.bq(m,t.u_input),u_output_expected:new s.bq(m,t.u_output_expected)}),atmosphere:(m,t)=>({u_sun_pos:new s.c2(m,t.u_sun_pos),u_atmosphere_blend:new s.bq(m,t.u_atmosphere_blend),u_globe_position:new s.c2(m,t.u_globe_position),u_globe_radius:new s.bq(m,t.u_globe_radius),u_inv_proj_matrix:new s.c0(m,t.u_inv_proj_matrix)}),sky:(m,t)=>({u_sky_color:new s.b$(m,t.u_sky_color),u_horizon_color:new s.b$(m,t.u_horizon_color),u_horizon:new s.c3(m,t.u_horizon),u_horizon_normal:new s.c3(m,t.u_horizon_normal),u_sky_horizon_blend:new s.bq(m,t.u_sky_horizon_blend),u_sky_blend:new s.bq(m,t.u_sky_blend)})};class Di{constructor(t,n,o){this.context=t;const h=t.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!o,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const cn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Cn{constructor(t,n,o,h){this.length=n.length,this.attributes=o,this.itemSize=n.bytesPerElement,this.dynamicDraw=h,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),t.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let o=0;o<this.attributes.length;o++){const h=n.attributes[this.attributes[o].name];h!==void 0&&t.enableVertexAttribArray(h)}}setVertexAttribPointers(t,n,o){for(let h=0;h<this.attributes.length;h++){const _=this.attributes[h],w=n.attributes[_.name];w!==void 0&&t.vertexAttribPointer(w,_.components,t[cn[_.type]],!1,this.itemSize,_.offset+this.itemSize*(o||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ai{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class wo extends ai{getDefault(){return s.bp.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ka extends ai{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class $o extends ai{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Sc extends ai{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class So extends ai{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class wl extends ai{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Zo extends ai{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ks extends ai{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Yc extends ai{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class Sl extends ai{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Tc extends ai{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class To extends ai{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Kl extends ai{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class Ql extends ai{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Tl extends ai{getDefault(){return s.bp.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ec extends ai{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Jc extends ai{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class Wo extends ai{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Po extends ai{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class tc extends ai{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class os extends ai{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class qr extends ai{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ho extends ai{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Pc extends ai{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Kc extends ai{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ao extends ai{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ac extends ai{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Qc extends ai{getDefault(){return null}set(t){var n;if(t===this.current&&!this.dirty)return;const o=this.gl;ns(o)?o.bindVertexArray(t):(n=o.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class eu extends ai{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class tu extends ai{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class rc extends ai{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Qa extends ai{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class Xo extends Qa{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ic extends Qa{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ru extends Qa{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const Lc="Framebuffer is not complete";class Cc{constructor(t,n,o,h,_){this.context=t,this.width=n,this.height=o;const w=t.gl,A=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new Xo(t,A),h)this.depthAttachment=_?new ru(t,A):new Ic(t,A);else if(_)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error(Lc)}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const o=this.depthAttachment.get();o&&t.deleteRenderbuffer(o)}t.deleteFramebuffer(this.framebuffer)}}class Mc{constructor(t){var n,o;if(this.gl=t,this.clearColor=new wo(this),this.clearDepth=new Ka(this),this.clearStencil=new $o(this),this.colorMask=new Sc(this),this.depthMask=new So(this),this.stencilMask=new wl(this),this.stencilFunc=new Zo(this),this.stencilOp=new ks(this),this.stencilTest=new Yc(this),this.depthRange=new Sl(this),this.depthTest=new Tc(this),this.depthFunc=new To(this),this.blend=new Kl(this),this.blendFunc=new Ql(this),this.blendColor=new Tl(this),this.blendEquation=new ec(this),this.cullFace=new Jc(this),this.cullFaceSide=new Wo(this),this.frontFace=new Po(this),this.program=new tc(this),this.activeTexture=new os(this),this.viewport=new qr(this),this.bindFramebuffer=new Ho(this),this.bindRenderbuffer=new Pc(this),this.bindTexture=new Kc(this),this.bindVertexBuffer=new Ao(this),this.bindElementBuffer=new Ac(this),this.bindVertexArray=new Qc(this),this.pixelStoreUnpack=new eu(this),this.pixelStoreUnpackPremultiplyAlpha=new tu(this),this.pixelStoreUnpackFlipY=new rc(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),ns(t)){this.HALF_FLOAT=t.HALF_FLOAT;const h=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=t.RGBA16F)!==null&&n!==void 0?n:h?.RGBA16F_EXT,this.RGB16F=(o=t.RGB16F)!==null&&o!==void 0?o:h?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const h=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=h?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new Di(this,t,n)}createVertexBuffer(t,n,o){return new Cn(this,t,n,o)}createRenderbuffer(t,n,o){const h=this.gl,_=h.createRenderbuffer();return this.bindRenderbuffer.set(_),h.renderbufferStorage(h.RENDERBUFFER,t,n,o),this.bindRenderbuffer.set(null),_}createFramebuffer(t,n,o,h){return new Cc(this,t,n,o,h)}clear({color:t,depth:n,stencil:o}){const h=this.gl;let _=0;t&&(_|=h.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(_|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),o!==void 0&&(_|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(o),this.stencilMask.set(255)),h.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.bR(t.blendFunction,vi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return ns(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var n;return ns(this.gl)?this.gl.deleteVertexArray(t):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Io;function Yo(m,t,n,o,h){const _=m.context,w=m.transform,A=_.gl,M=m.useProgram("collisionBox"),z=[];let O=0,$=0;for(let Se=0;Se<o.length;Se++){const Me=o[Se],He=t.getTile(Me).getBucket(n);if(!He)continue;const Ee=h?He.textCollisionBox:He.iconCollisionBox,Xe=He.collisionCircleArray;Xe.length>0&&(z.push({circleArray:Xe,circleOffset:$,coord:Me}),O+=Xe.length/4,$=O),Ee&&M.draw(_,A.LINES,Zr.disabled,Qr.disabled,m.colorModeForRenderPass(),si.disabled,Ms(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(Me),w.getProjectionData({overscaledTileID:Me,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),n.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,null,m.transform.zoom,null,null,Ee.collisionVertexBuffer)}if(!h||!z.length)return;const G=m.useProgram("collisionCircle"),J=new s.ca;J.resize(4*O),J._trim();let ce=0;for(const Se of z)for(let Me=0;Me<Se.circleArray.length/4;Me++){const He=4*Me,Ee=Se.circleArray[He+0],Xe=Se.circleArray[He+1],et=Se.circleArray[He+2],qe=Se.circleArray[He+3];J.emplace(ce++,Ee,Xe,et,qe,0),J.emplace(ce++,Ee,Xe,et,qe,1),J.emplace(ce++,Ee,Xe,et,qe,2),J.emplace(ce++,Ee,Xe,et,qe,3)}(!Io||Io.length<2*O)&&(Io=(function(Se){const Me=2*Se,He=new s.cc;He.resize(Me),He._trim();for(let Ee=0;Ee<Me;Ee++){const Xe=6*Ee;He.uint16[Xe+0]=4*Ee+0,He.uint16[Xe+1]=4*Ee+1,He.uint16[Xe+2]=4*Ee+2,He.uint16[Xe+3]=4*Ee+2,He.uint16[Xe+4]=4*Ee+3,He.uint16[Xe+5]=4*Ee+0}return He})(O));const be=_.createIndexBuffer(Io,!0),Te=_.createVertexBuffer(J,s.cb.members,!0);for(const Se of z){const Me=ms(m.transform);G.draw(_,A.TRIANGLES,Zr.disabled,Qr.disabled,m.colorModeForRenderPass(),si.disabled,Me,m.style.map.terrain&&m.style.map.terrain.getTerrainData(Se.coord),null,n.id,Te,be,s.aX.simpleSegment(0,2*Se.circleOffset,Se.circleArray.length,Se.circleArray.length/2),null,m.transform.zoom,null,null,null)}Te.destroy(),be.destroy()}const iu=s.ar(new Float32Array(16));function nu(m,t,n,o,h,_){const{horizontalAlign:w,verticalAlign:A}=s.aS(m);return new s.P((-(w-.5)*t/h+o[0])*_,(-(A-.5)*n/h+o[1])*_)}function Jo(m,t,n,o,h,_){const w=t.tileAnchorPoint.add(new s.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let A=o.mult(_);n||(A=A.rotate(-h));const M=w.add(A);return $r(M.x,M.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(n){const A=gi(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(m),M=Math.atan(A.y/A.x)+(A.x<0?Math.PI:0);return m.add(o.rotate(M))}return m.add(o)}function ic(m,t,n,o,h,_,w,A,M,z,O,$){const G=m.text.placedSymbolArray,J=m.text.dynamicLayoutVertexArray,ce=m.icon.dynamicLayoutVertexArray,be={};J.clear();for(let Te=0;Te<G.length;Te++){const Se=G.get(Te),Me=Se.hidden||!Se.crossTileID||m.allowVerticalPlacement&&!Se.placedOrientation?null:o[Se.crossTileID];if(Me){const He=new s.P(Se.anchorX,Se.anchorY),Ee={getElevation:$,width:h.width,height:h.height,pitchedLabelPlaneMatrix:_,pitchWithMap:n,transform:h,tileAnchorPoint:He,translation:z,unwrappedTileID:O},Xe=n?Ta(He.x,He.y,Ee):gi(He.x,He.y,Ee),et=wa(h.cameraToCenterDistance,Xe.signedDistanceFromCamera);let qe=s.aA(m.textSizeData,A,Se)*et/s.aM;n&&(qe*=m.tilePixelRatio/w);const{width:lt,height:At,anchor:vt,textOffset:St,textBoxScale:Pt}=Me,er=nu(vt,lt,At,St,Pt,qe),rr=h.getPitchedTextCorrection(He.x+z[0],He.y+z[1],O),$t=Jo(Xe.point,Ee,t,er,-h.bearingInRadians,rr),nr=m.allowVerticalPlacement&&Se.placedOrientation===s.az.vertical?Math.PI/2:0;for(let Hr=0;Hr<Se.numGlyphs;Hr++)s.aG(J,$t,nr);M&&Se.associatedIconIndex>=0&&(be[Se.associatedIconIndex]={shiftedAnchor:$t,angle:nr})}else Bs(Se.numGlyphs,J)}if(M){ce.clear();const Te=m.icon.placedSymbolArray;for(let Se=0;Se<Te.length;Se++){const Me=Te.get(Se);if(Me.hidden)Bs(Me.numGlyphs,ce);else{const He=be[Se];if(He)for(let Ee=0;Ee<Me.numGlyphs;Ee++)s.aG(ce,He.shiftedAnchor,He.angle);else Bs(Me.numGlyphs,ce)}}m.icon.dynamicLayoutVertexBuffer.updateData(ce)}m.text.dynamicLayoutVertexBuffer.updateData(J)}function Iu(m,t,n){return n.iconsInText&&t?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function nc(m,t,n,o,h,_,w,A,M,z,O,$,G){const J=m.context,ce=J.gl,be=m.transform,Te=A==="map",Se=M==="map",Me=A!=="viewport"&&n.layout.get("symbol-placement")!=="point",He=Te&&!Se&&!Me,Ee=!n.layout.get("symbol-sort-key").isConstant();let Xe=!1;const et=m.getDepthModeForSublayer(0,Zr.ReadOnly),qe=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),lt=[],At=be.getCircleRadiusCorrection();for(const vt of o){const St=t.getTile(vt),Pt=St.getBucket(n);if(!Pt)continue;const er=h?Pt.text:Pt.icon;if(!er||!er.segments.get().length||!er.hasVisibleVertices)continue;const rr=er.programConfigurations.get(n.id),$t=h||Pt.sdfIcons,nr=h?Pt.textSizeData:Pt.iconSizeData,Hr=Se||be.pitch!==0,Ci=m.useProgram(Iu($t,h,Pt),rr),Xi=s.ay(nr,be.zoom),Vi=m.style.map.terrain&&m.style.map.terrain.getTerrainData(vt);let rn,Ui,_n,nn,Jn=[0,0],En=null;if(h)Ui=St.glyphAtlasTexture,_n=ce.LINEAR,rn=St.glyphAtlasTexture.size,Pt.iconsInText&&(Jn=St.imageAtlasTexture.size,En=St.imageAtlasTexture,nn=Hr||m.options.rotating||m.options.zooming||nr.kind==="composite"||nr.kind==="camera"?ce.LINEAR:ce.NEAREST);else{const $i=n.layout.get("icon-size").constantOr(0)!==1||Pt.iconsNeedLinear;Ui=St.imageAtlasTexture,_n=$t||m.options.rotating||m.options.zooming||$i||Hr?ce.LINEAR:ce.NEAREST,rn=St.imageAtlasTexture.size}const Pn=s.aN(St,1,m.transform.zoom),us=Ni(Te,m.transform,Pn),zl=s.N();s.aB(zl,us);const tl=Rs(Se,Te,m.transform,Pn),Do=s.aO(be,St,_,w),ea=be.getProjectionData({overscaledTileID:vt,applyGlobeMatrix:!G,applyTerrainMatrix:!0}),hc=qe&&Pt.hasTextData(),hu=n.layout.get("icon-text-fit")!=="none"&&hc&&Pt.hasIconData();if(Me){const $i=m.style.map.terrain?(qn,Gn)=>m.style.map.terrain.getElevation(vt,qn,Gn):null,qi=n.layout.get("text-rotation-alignment")==="map";Ua(Pt,m,h,us,zl,Se,z,qi,vt.toUnwrapped(),be.width,be.height,Do,$i)}const dc=h&&qe||hu,Ba=Me||dc?iu:Se?us:m.transform.clipSpaceToPixelsMatrix,Fo=$t&&n.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let io;io=$t?Pt.iconsInText?gs(nr.kind,Xi,He,Se,Me,dc,m,Ba,tl,Do,rn,Jn,At):Na(nr.kind,Xi,He,Se,Me,dc,m,Ba,tl,Do,h,rn,0,At):za(nr.kind,Xi,He,Se,Me,dc,m,Ba,tl,Do,h,rn,At);const no={program:Ci,buffers:er,uniformValues:io,projectionData:ea,atlasTexture:Ui,atlasTextureIcon:En,atlasInterpolation:_n,atlasInterpolationIcon:nn,isSDF:$t,hasHalo:Fo};if(Ee&&Pt.canOverlap){Xe=!0;const $i=er.segments.get();for(const qi of $i)lt.push({segments:new s.aX([qi]),sortKey:qi.sortKey,state:no,terrainData:Vi})}else lt.push({segments:er.segments,sortKey:0,state:no,terrainData:Vi})}Xe&&lt.sort(((vt,St)=>vt.sortKey-St.sortKey));for(const vt of lt){const St=vt.state;if(J.activeTexture.set(ce.TEXTURE0),St.atlasTexture.bind(St.atlasInterpolation,ce.CLAMP_TO_EDGE),St.atlasTextureIcon&&(J.activeTexture.set(ce.TEXTURE1),St.atlasTextureIcon&&St.atlasTextureIcon.bind(St.atlasInterpolationIcon,ce.CLAMP_TO_EDGE)),St.isSDF){const Pt=St.uniformValues;St.hasHalo&&(Pt.u_is_halo=1,sc(St.buffers,vt.segments,n,m,St.program,et,O,$,Pt,St.projectionData,vt.terrainData)),Pt.u_is_halo=0}sc(St.buffers,vt.segments,n,m,St.program,et,O,$,St.uniformValues,St.projectionData,vt.terrainData)}}function sc(m,t,n,o,h,_,w,A,M,z,O){const $=o.context;h.draw($,$.gl.TRIANGLES,_,w,A,si.backCCW,M,O,z,n.id,m.layoutVertexBuffer,m.indexBuffer,t,n.paint,o.transform.zoom,m.programConfigurations.get(n.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Lu(m,t,n,o,h){const _=m.context,w=_.gl,A=Qr.disabled,M=new vi([w.ONE,w.ONE],s.bp.transparent,[!0,!0,!0,!0]),z=t.getBucket(n);if(!z)return;const O=o.key;let $=n.heatmapFbos.get(O);$||($=ac(_,t.tileSize,t.tileSize),n.heatmapFbos.set(O,$)),_.bindFramebuffer.set($.framebuffer),_.viewport.set([0,0,t.tileSize,t.tileSize]),_.clear({color:s.bp.transparent});const G=z.programConfigurations.get(n.id),J=m.useProgram("heatmap",G,!h),ce=m.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),be=m.style.map.terrain.getTerrainData(o);J.draw(_,w.TRIANGLES,Zr.disabled,A,M,si.disabled,Es(t,m.transform.zoom,n.paint.get("heatmap-intensity"),1),be,ce,n.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,n.paint,m.transform.zoom,G)}function Cu(m,t,n,o,h){const _=m.context,w=_.gl,A=m.transform;_.setColorMode(m.colorModeForRenderPass());const M=Ec(_,t),z=n.key,O=t.heatmapFbos.get(z);if(!O)return;_.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,O.colorAttachment.get()),_.activeTexture.set(w.TEXTURE1),M.bind(w.LINEAR,w.CLAMP_TO_EDGE);const $=A.getProjectionData({overscaledTileID:n,applyTerrainMatrix:h,applyGlobeMatrix:!o});m.useProgram("heatmapTexture").draw(_,w.TRIANGLES,Zr.disabled,Qr.disabled,m.colorModeForRenderPass(),si.disabled,ka(m,t,0,1),null,$,t.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,t.paint,A.zoom),O.destroy(),t.heatmapFbos.delete(z)}function ac(m,t,n){var o,h;const _=m.gl,w=_.createTexture();_.bindTexture(_.TEXTURE_2D,w),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR);const A=(o=m.HALF_FLOAT)!==null&&o!==void 0?o:_.UNSIGNED_BYTE,M=(h=m.RGBA16F)!==null&&h!==void 0?h:_.RGBA;_.texImage2D(_.TEXTURE_2D,0,M,t,n,0,_.RGBA,A,null);const z=m.createFramebuffer(t,n,!1,!1);return z.colorAttachment.set(w),z}function Ec(m,t){return t.colorRampTexture||(t.colorRampTexture=new s.T(m,t.colorRamp,m.gl.RGBA)),t.colorRampTexture}function eo(m,t,n,o,h,_,w,A){let M=256;if(h.stepInterpolant){const z=t.getSource().maxzoom,O=w.canonical.z===z?Math.ceil(1<<m.transform.maxZoom-w.canonical.z):1;M=s.an(s.ce(_.maxLineLength/s.a5*1024*O),256,n.maxTextureSize)}return A.gradient=s.cf({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:M,image:A.gradient||void 0,clips:_.lineClipsArray}),A.texture?A.texture.update(A.gradient):A.texture=new s.T(n,A.gradient,o.RGBA),A.version=h.gradientVersion,A.texture}function Js(m,t,n,o,h){m.activeTexture.set(t.TEXTURE0),n.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),o.updatePaintBuffers(h)}function Ti(m,t,n,o,h,_){(h||m.lineAtlas.dirty)&&(t.activeTexture.set(n.TEXTURE0),m.lineAtlas.bind(t)),o.updatePaintBuffers(_)}function Ko(m,t,n,o,h,_,w){const A=_.gradients[h.id];let M=A.texture;h.gradientVersion!==A.version&&(M=eo(m,t,n,o,h,_,w,A)),n.activeTexture.set(o.TEXTURE0),M.bind(h.stepInterpolant?o.NEAREST:o.LINEAR,o.CLAMP_TO_EDGE)}function _s(m,t,n,o,h,_,w,A,M){const z=_.gradients[h.id];let O=z.texture;h.gradientVersion!==z.version&&(O=eo(m,t,n,o,h,_,w,z)),n.activeTexture.set(o.TEXTURE0),O.bind(h.stepInterpolant?o.NEAREST:o.LINEAR,o.CLAMP_TO_EDGE),n.activeTexture.set(o.TEXTURE1),m.lineAtlas.bind(n),A.updatePaintBuffers(M)}function ga(m,t,n,o,h){if(!n||!o||!o.imageAtlas)return;const _=o.imageAtlas.patternPositions;let w=_[n.to.toString()],A=_[n.from.toString()];if(!w&&A&&(w=A),!A&&w&&(A=w),!w||!A){const M=h.getPaintProperty(t);w=_[M],A=_[M]}w&&A&&m.setConstantPatternPositions(w,A)}function Yn(m,t,n,o,h,_,w,A){const M=m.context.gl,z="fill-pattern",O=n.paint.get(z),$=O&&O.constantOr(1),G=n.getCrossfadeParameters();let J,ce,be,Te,Se;const Me=m.transform,He=n.paint.get("fill-translate"),Ee=n.paint.get("fill-translate-anchor");w?(ce=$&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",J=M.LINES):(ce=$?"fillPattern":"fill",J=M.TRIANGLES);const Xe=O.constantOr(null);for(const et of o){const qe=t.getTile(et);if($&&!qe.patternsLoaded())continue;const lt=qe.getBucket(n);if(!lt)continue;const At=lt.programConfigurations.get(n.id),vt=m.useProgram(ce,At),St=m.style.map.terrain&&m.style.map.terrain.getTerrainData(et);$&&(m.context.activeTexture.set(M.TEXTURE0),qe.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),At.updatePaintBuffers(G)),ga(At,z,Xe,qe,n);const Pt=Me.getProjectionData({overscaledTileID:et,applyGlobeMatrix:!A,applyTerrainMatrix:!0}),er=s.aO(Me,qe,He,Ee);if(w){Te=lt.indexBuffer2,Se=lt.segments2;const $t=[M.drawingBufferWidth,M.drawingBufferHeight];be=ce==="fillOutlinePattern"&&$?vl(m,G,qe,$t,er):yl($t,er)}else Te=lt.indexBuffer,Se=lt.segments,be=$?Xa(m,G,qe,er):{u_fill_translate:er};const rr=m.stencilModeForClipping(et);vt.draw(m.context,J,h,rr,_,si.backCCW,be,St,Pt,n.id,lt.layoutVertexBuffer,Te,Se,n.paint,m.transform.zoom,At)}}function kc(m,t,n,o,h,_,w,A){const M=m.context,z=M.gl,O="fill-extrusion-pattern",$=n.paint.get(O),G=$.constantOr(1),J=n.getCrossfadeParameters(),ce=n.paint.get("fill-extrusion-opacity"),be=$.constantOr(null),Te=m.transform;for(const Se of o){const Me=t.getTile(Se),He=Me.getBucket(n);if(!He)continue;const Ee=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Se),Xe=He.programConfigurations.get(n.id),et=m.useProgram(G?"fillExtrusionPattern":"fillExtrusion",Xe);G&&(m.context.activeTexture.set(z.TEXTURE0),Me.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Xe.updatePaintBuffers(J));const qe=Te.getProjectionData({overscaledTileID:Se,applyGlobeMatrix:!A,applyTerrainMatrix:!0});ga(Xe,O,be,Me,n);const lt=s.aO(Te,Me,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),At=n.paint.get("fill-extrusion-vertical-gradient"),vt=G?ps(m,At,ce,lt,Se,J,Me):_l(m,At,ce,lt);et.draw(M,M.gl.TRIANGLES,h,_,w,si.backCCW,vt,Ee,qe,n.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,n.paint,m.transform.zoom,Xe,m.style.map.terrain&&He.centroidVertexBuffer)}}function Lo(m,t,n,o,h,_,w,A,M){var z;const O=m.style.projection,$=m.context,G=m.transform,J=$.gl,ce=[`#define NUM_ILLUMINATION_SOURCES ${n.paint.get("hillshade-highlight-color").values.length}`],be=m.useProgram("hillshade",null,!1,ce),Te=!m.options.moving;for(const Se of o){const Me=t.getTile(Se),He=Me.fbo;if(!He)continue;const Ee=O.getMeshFromTileID($,Se.canonical,A,!0,"raster"),Xe=(z=m.style.map.terrain)===null||z===void 0?void 0:z.getTerrainData(Se);$.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_2D,He.colorAttachment.get());const et=G.getProjectionData({overscaledTileID:Se,aligned:Te,applyGlobeMatrix:!M,applyTerrainMatrix:!0});be.draw($,J.TRIANGLES,_,h[Se.overscaledZ],w,si.backCCW,fa(m,Me,n),Xe,et,n.id,Ee.vertexBuffer,Ee.indexBuffer,Ee.segments)}}function Pl(m,t,n,o,h,_,w,A,M){var z;const O=m.style.projection,$=m.context,G=m.transform,J=$.gl,ce=m.useProgram("colorRelief"),be=!m.options.moving;let Te=!0,Se=0;for(const Me of o){const He=t.getTile(Me),Ee=He.dem;if(Te){const vt=J.getParameter(J.MAX_TEXTURE_SIZE),{elevationTexture:St,colorTexture:Pt}=n.getColorRampTextures($,vt,Ee.getUnpackVector());$.activeTexture.set(J.TEXTURE1),St.bind(J.NEAREST,J.CLAMP_TO_EDGE),$.activeTexture.set(J.TEXTURE4),Pt.bind(J.LINEAR,J.CLAMP_TO_EDGE),Te=!1,Se=St.size[0]}if(!Ee||!Ee.data)continue;const Xe=Ee.stride,et=Ee.getPixels();if($.activeTexture.set(J.TEXTURE0),$.pixelStoreUnpackPremultiplyAlpha.set(!1),He.demTexture=He.demTexture||m.getTileTexture(Xe),He.demTexture){const vt=He.demTexture;vt.update(et,{premultiply:!1}),vt.bind(J.LINEAR,J.CLAMP_TO_EDGE)}else He.demTexture=new s.T($,et,J.RGBA,{premultiply:!1}),He.demTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const qe=O.getMeshFromTileID($,Me.canonical,A,!0,"raster"),lt=(z=m.style.map.terrain)===null||z===void 0?void 0:z.getTerrainData(Me),At=G.getProjectionData({overscaledTileID:Me,aligned:be,applyGlobeMatrix:!M,applyTerrainMatrix:!0});ce.draw($,J.TRIANGLES,_,h[Me.overscaledZ],w,si.backCCW,ln(n,He.dem,Se),lt,At,n.id,qe.vertexBuffer,qe.indexBuffer,qe.segments)}}const Co=[new s.P(0,0),new s.P(s.a5,0),new s.P(s.a5,s.a5),new s.P(0,s.a5)];function Qo(m,t,n,o,h,_,w,A,M=!1,z=!1){const O=o[o.length-1].overscaledZ,$=m.context,G=$.gl,J=m.useProgram("raster"),ce=m.transform,be=m.style.projection,Te=m.colorModeForRenderPass(),Se=!m.options.moving,Me=n.paint.get("raster-opacity"),He=n.paint.get("raster-resampling"),Ee=n.paint.get("raster-fade-duration"),Xe=!!m.style.map.terrain;for(const et of o){const qe=m.getDepthModeForSublayer(et.overscaledZ-O,Me===1?Zr.ReadWrite:Zr.ReadOnly,G.LESS),lt=t.getTile(et),At=He==="nearest"?G.NEAREST:G.LINEAR;$.activeTexture.set(G.TEXTURE0),lt.texture.bind(At,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),$.activeTexture.set(G.TEXTURE1);const{parentTile:vt,parentScaleBy:St,parentTopLeft:Pt,fadeValues:er}=su(lt,t,Ee,Xe);lt.fadeOpacity=er.tileOpacity,vt?(vt.fadeOpacity=er.parentTileOpacity,vt.texture.bind(At,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST)):lt.texture.bind(At,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),lt.texture.useMipmap&&$.extTextureFilterAnisotropic&&m.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax);const rr=m.style.map.terrain&&m.style.map.terrain.getTerrainData(et),$t=ce.getProjectionData({overscaledTileID:et,aligned:Se,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),nr=Da(Pt,St,er.fadeMix,n,A),Hr=be.getMeshFromTileID($,et.canonical,_,w,"raster");J.draw($,G.TRIANGLES,qe,h?h[et.overscaledZ]:Qr.disabled,Te,M?si.frontCCW:si.backCCW,nr,rr,$t,n.id,Hr.vertexBuffer,Hr.indexBuffer,Hr.segments)}}function su(m,t,n,o){const h={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(n===0||o)return h;if(m.fadingParentID){const _=t.getLoadedTile(m.fadingParentID);if(!_)return h;const w=Math.pow(2,_.tileID.overscaledZ-m.tileID.overscaledZ),A=[m.tileID.canonical.x*w%1,m.tileID.canonical.y*w%1],M=(function(z,O,$){const G=he(),J=(G-O.timeAdded)/$,ce=z.fadingDirection===Oe.Incoming,be=s.an((G-z.timeAdded)/$,0,1),Te=s.an(1-J,0,1),Se=ce?be:Te;return{tileOpacity:Se,parentTileOpacity:ce?Te:be,fadeMix:{opacity:1,mix:1-Se}}})(m,_,n);return{parentTile:_,parentScaleBy:w,parentTopLeft:A,fadeValues:M}}if(m.selfFading){const _=(function(w,A){const M=(he()-w.timeAdded)/A,z=s.an(M,0,1);return{tileOpacity:z,fadeMix:{opacity:z,mix:0}}})(m,n);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:_}}return h}const Mu=new s.bp(1,0,0,1),oc=new s.bp(0,1,0,1),lc=new s.bp(0,0,1,1),Al=new s.bp(1,0,1,1),Ra=new s.bp(0,1,1,1);function au(m,t,n,o){cc(m,0,t+n/2,m.transform.width,n,o)}function Dc(m,t,n,o){cc(m,t-n/2,0,n,m.transform.height,o)}function cc(m,t,n,o,h,_){const w=m.context,A=w.gl;A.enable(A.SCISSOR_TEST),A.scissor(t*m.pixelRatio,n*m.pixelRatio,o*m.pixelRatio,h*m.pixelRatio),w.clear({color:_}),A.disable(A.SCISSOR_TEST)}function Eu(m,t,n){const o=m.context,h=o.gl,_=m.useProgram("debug"),w=Zr.disabled,A=Qr.disabled,M=m.colorModeForRenderPass(),z="$debug",O=m.style.map.terrain&&m.style.map.terrain.getTerrainData(n);o.activeTexture.set(h.TEXTURE0);const $=t.getTileByID(n.key).latestRawTileData,G=Math.floor(($&&$.byteLength||0)/1024),J=t.getTile(n).tileSize,ce=512/Math.min(J,512)*(n.overscaledZ/m.transform.zoom)*.5;let be=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(be+=` => ${n.overscaledZ}`),(function(Se,Me){Se.initDebugOverlayCanvas();const He=Se.debugOverlayCanvas,Ee=Se.context.gl,Xe=Se.debugOverlayCanvas.getContext("2d");Xe.clearRect(0,0,He.width,He.height),Xe.shadowColor="white",Xe.shadowBlur=2,Xe.lineWidth=1.5,Xe.strokeStyle="white",Xe.textBaseline="top",Xe.font="bold 36px Open Sans, sans-serif",Xe.fillText(Me,5,5),Xe.strokeText(Me,5,5),Se.debugOverlayTexture.update(He),Se.debugOverlayTexture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE)})(m,`${be} ${G}kB`);const Te=m.transform.getProjectionData({overscaledTileID:n,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(o,h.TRIANGLES,w,A,vi.alphaBlended,si.disabled,ss(s.bp.transparent,ce),null,Te,z,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),_.draw(o,h.LINE_STRIP,w,A,M,si.disabled,ss(s.bp.red),O,Te,z,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function ou(m,t,n,o){const{isRenderingGlobe:h}=o,_=m.context,w=_.gl,A=m.transform,M=m.colorModeForRenderPass(),z=m.getDepthModeFor3D(),O=m.useProgram("terrain");_.bindFramebuffer.set(null),_.viewport.set([0,0,m.width,m.height]);for(const $ of n){const G=t.getTerrainMesh($.tileID),J=m.renderToTexture.getTexture($),ce=t.getTerrainData($.tileID);_.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,J.texture);const be=t.getMeshFrameDelta(A.zoom),Te=A.calculateFogMatrix($.tileID.toUnwrapped()),Se=Yl(be,Te,m.style.sky,A.pitch,h),Me=A.getProjectionData({overscaledTileID:$.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});O.draw(_,w.TRIANGLES,z,Qr.disabled,M,si.backCCW,Se,ce,Me,"terrain",G.vertexBuffer,G.indexBuffer,G.segments)}}function lu(m,t){if(!t.mesh){const n=new s.aW;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(1,1),n.emplaceBack(-1,1);const o=new s.aY;o.emplaceBack(0,1,2),o.emplaceBack(0,2,3),t.mesh=new wi(m.createVertexBuffer(n,Xn.members),m.createIndexBuffer(o),s.aX.simpleSegment(0,0,n.length,o.length))}return t.mesh}class ku{constructor(t,n){this.context=new Mc(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=mi.maxOverzooming+mi.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Hn}resize(t,n,o){if(this.width=Math.floor(t*o),this.height=Math.floor(n*o),this.pixelRatio=o,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const t=this.context,n=new s.aW;n.emplaceBack(0,0),n.emplaceBack(s.a5,0),n.emplaceBack(0,s.a5),n.emplaceBack(s.a5,s.a5),this.tileExtentBuffer=t.createVertexBuffer(n,Xn.members),this.tileExtentSegments=s.aX.simpleSegment(0,0,4,2);const o=new s.aW;o.emplaceBack(0,0),o.emplaceBack(s.a5,0),o.emplaceBack(0,s.a5),o.emplaceBack(s.a5,s.a5),this.debugBuffer=t.createVertexBuffer(o,Xn.members),this.debugSegments=s.aX.simpleSegment(0,0,4,5);const h=new s.ch;h.emplaceBack(0,0,0,0),h.emplaceBack(s.a5,0,s.a5,0),h.emplaceBack(0,s.a5,0,s.a5),h.emplaceBack(s.a5,s.a5,s.a5,s.a5),this.rasterBoundsBuffer=t.createVertexBuffer(h,qo.members),this.rasterBoundsSegments=s.aX.simpleSegment(0,0,4,2);const _=new s.aW;_.emplaceBack(0,0),_.emplaceBack(s.a5,0),_.emplaceBack(0,s.a5),_.emplaceBack(s.a5,s.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(_,Xn.members),this.rasterBoundsSegmentsPosOnly=s.aX.simpleSegment(0,0,4,5);const w=new s.aW;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(w,Xn.members),this.viewportSegments=s.aX.simpleSegment(0,0,4,2);const A=new s.ci;A.emplaceBack(0),A.emplaceBack(1),A.emplaceBack(3),A.emplaceBack(2),A.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(A);const M=new s.aY;M.emplaceBack(1,0,2),M.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(M);const z=this.context.gl;this.stencilClearMode=new Qr({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.tileExtentMesh=new wi(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const o=s.N();s.c7(o,0,this.width,this.height,0,0,1),s.Q(o,o,[n.drawingBufferWidth,n.drawingBufferHeight,0]);const h={mainMatrix:o,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:o};this.useProgram("clippingMask",null,!0).draw(t,n.TRIANGLES,Zr.disabled,this.stencilClearMode,vi.disabled,si.disabled,null,null,h,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n,o){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source,this.nextStencilID+n.length>256&&this.clearStencil();const h=this.context;h.setColorMode(vi.disabled),h.setDepthMode(Zr.disabled);const _={};for(const w of n)_[w.key]=this.nextStencilID++;this._renderTileMasks(_,n,o,!0),this._renderTileMasks(_,n,o,!1),this._tileClippingMaskIDs=_}_renderTileMasks(t,n,o,h){const _=this.context,w=_.gl,A=this.style.projection,M=this.transform,z=this.useProgram("clippingMask");for(const O of n){const $=t[O.key],G=this.style.map.terrain&&this.style.map.terrain.getTerrainData(O),J=A.getMeshFromTileID(this.context,O.canonical,h,!0,"stencil"),ce=M.getProjectionData({overscaledTileID:O,applyGlobeMatrix:!o,applyTerrainMatrix:!0});z.draw(_,w.TRIANGLES,Zr.disabled,new Qr({func:w.ALWAYS,mask:0},$,255,w.KEEP,w.KEEP,w.REPLACE),vi.disabled,o?si.disabled:si.backCCW,null,G,ce,"$clipping",J.vertexBuffer,J.indexBuffer,J.segments)}}_renderTilesDepthBuffer(){const t=this.context,n=t.gl,o=this.style.projection,h=this.transform,_=this.useProgram("depth"),w=this.getDepthModeFor3D(),A=Ht(h,{tileSize:h.tileSize});for(const M of A){const z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(M),O=o.getMeshFromTileID(this.context,M.canonical,!0,!0,"raster"),$=h.getProjectionData({overscaledTileID:M,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(t,n.TRIANGLES,w,Qr.disabled,vi.disabled,si.backCCW,null,z,$,"$clipping",O.vertexBuffer,O.indexBuffer,O.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Qr({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new Qr({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const n=this.context.gl,o=t.sort(((w,A)=>A.overscaledZ-w.overscaledZ)),h=o[o.length-1].overscaledZ,_=o[0].overscaledZ-h+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const w={};for(let A=0;A<_;A++)w[A+h]=new Qr({func:n.GEQUAL,mask:255},A+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=_,[w,o]}return[{[h]:Qr.disabled},o]}stencilConfigForOverlapTwoPass(t){const n=this.context.gl,o=t.sort(((w,A)=>A.overscaledZ-w.overscaledZ)),h=o[o.length-1].overscaledZ,_=o[0].overscaledZ-h+1;if(this.clearStencil(),_>1){const w={},A={};for(let M=0;M<_;M++)w[M+h]=new Qr({func:n.GREATER,mask:255},_+1+M,255,n.KEEP,n.KEEP,n.REPLACE),A[M+h]=new Qr({func:n.GREATER,mask:255},1+M,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID=2*_+1,[w,A,o]}return this.nextStencilID=3,[{[h]:new Qr({func:n.GREATER,mask:255},2,255,n.KEEP,n.KEEP,n.REPLACE)},{[h]:new Qr({func:n.GREATER,mask:255},1,255,n.KEEP,n.KEEP,n.REPLACE)},o]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new vi([t.CONSTANT_COLOR,t.ONE],new s.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?vi.unblended:vi.alphaBlended}getDepthModeForSublayer(t,n,o){if(!this.opaquePassEnabledForLayer())return Zr.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Zr(o||this.context.gl.LEQUAL,n,[h,h])}getDepthModeFor3D(){return new Zr(this.context.gl.LEQUAL,Zr.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){var o,h;this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(he()),this.imageManager.beginFrame();const _=this.style._order,w=this.style.tileManagers,A={},M={},z={},O={isRenderingToTexture:!1,isRenderingGlobe:((o=t.projection)===null||o===void 0?void 0:o.transitionState)>0};for(const G in w){const J=w[G];J.used&&J.prepare(this.context),A[G]=J.getVisibleCoordinates(!1),M[G]=A[G].slice().reverse(),z[G]=J.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let G=0;G<_.length;G++)if(this.style._layers[_[G]].is3D()){this.opaquePassCutoff=G;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const G of _){const J=this.style._layers[G];if(!J.hasOffscreenPass()||J.isHidden(this.transform.zoom))continue;const ce=M[J.source];(J.type==="custom"||ce.length)&&this.renderLayer(this,w[J.source],J,ce,O)}if((h=this.style.projection)===null||h===void 0||h.updateGPUdependent({context:this.context,useProgram:G=>this.useProgram(G)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?s.bp.black:s.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(G,J){const ce=G.context,be=ce.gl,Te=((et,qe,lt)=>{const At=Math.cos(qe.rollInRadians),vt=Math.sin(qe.rollInRadians),St=le(qe),Pt=qe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:et.properties.get("sky-color"),u_horizon_color:et.properties.get("horizon-color"),u_horizon:[(qe.width/2-St*vt)*lt,(qe.height/2+St*At)*lt],u_horizon_normal:[-vt,At],u_sky_horizon_blend:et.properties.get("sky-horizon-blend")*qe.height/2*lt,u_sky_blend:Pt}})(J,G.style.map.transform,G.pixelRatio),Se=new Zr(be.LEQUAL,Zr.ReadWrite,[0,1]),Me=Qr.disabled,He=G.colorModeForRenderPass(),Ee=G.useProgram("sky"),Xe=lu(ce,J);Ee.draw(ce,be.TRIANGLES,Se,Me,He,si.disabled,Te,null,void 0,"sky",Xe.vertexBuffer,Xe.indexBuffer,Xe.segments)})(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const G=this.style._layers[_[this.currentLayer]],J=w[G.source],ce=A[G.source];this._renderTileClippingMasks(G,ce,!1),this.renderLayer(this,J,G,ce,O)}this.renderPass="translucent";let $=!1;for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const G=this.style._layers[_[this.currentLayer]],J=w[G.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(G,O))continue;this.opaquePassEnabledForLayer()||$||($=!0,O.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const ce=(G.type==="symbol"?z:M)[G.source];this._renderTileClippingMasks(G,A[G.source],!!this.renderToTexture),this.renderLayer(this,J,G,ce,O)}if(O.isRenderingGlobe&&(function(G,J,ce){const be=G.context,Te=be.gl,Se=G.useProgram("atmosphere"),Me=new Zr(Te.LEQUAL,Zr.ReadOnly,[0,1]),He=G.transform,Ee=(function(Pt,er){const rr=Pt.properties.get("position"),$t=[-rr.x,-rr.y,-rr.z],nr=s.ar(new Float64Array(16));return Pt.properties.get("anchor")==="map"&&(s.bg(nr,nr,er.rollInRadians),s.bh(nr,nr,-er.pitchInRadians),s.bg(nr,nr,er.bearingInRadians),s.bh(nr,nr,er.center.lat*Math.PI/180),s.bJ(nr,nr,-er.center.lng*Math.PI/180)),s.cg($t,$t,nr),$t})(ce,G.transform),Xe=He.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),et=J.properties.get("atmosphere-blend")*Xe.projectionTransition;if(et===0)return;const qe=Pr(He.worldSize,He.center.lat),lt=He.inverseProjectionMatrix,At=new Float64Array(4);At[3]=1,s.aH(At,At,He.modelViewProjectionMatrix),At[0]/=At[3],At[1]/=At[3],At[2]/=At[3],At[3]=1,s.aH(At,At,lt),At[0]/=At[3],At[1]/=At[3],At[2]/=At[3],At[3]=1;const vt=((Pt,er,rr,$t,nr)=>({u_sun_pos:Pt,u_atmosphere_blend:er,u_globe_position:rr,u_globe_radius:$t,u_inv_proj_matrix:nr}))(Ee,et,[At[0],At[1],At[2]],qe,lt),St=lu(be,J);Se.draw(be,Te.TRIANGLES,Me,Qr.disabled,vi.alphaBlended,si.disabled,vt,null,null,"atmosphere",St.vertexBuffer,St.indexBuffer,St.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const G=(function(J,ce){let be=null;const Te=Object.values(J._layers).flatMap((Ee=>Ee.source&&!Ee.isHidden(ce)?[J.tileManagers[Ee.source]]:[])),Se=Te.filter((Ee=>Ee.getSource().type==="vector")),Me=Te.filter((Ee=>Ee.getSource().type!=="vector")),He=Ee=>{(!be||be.getSource().maxzoom<Ee.getSource().maxzoom)&&(be=Ee)};return Se.forEach((Ee=>He(Ee))),be||Me.forEach((Ee=>He(Ee))),be})(this.style,this.transform.zoom);G&&(function(J,ce,be){for(let Te=0;Te<be.length;Te++)Eu(J,ce,be[Te])})(this,G,G.getVisibleCoordinates())}this.options.showPadding&&(function(G){const J=G.transform.padding;au(G,G.transform.height-(J.top||0),3,Mu),au(G,J.bottom||0,3,oc),Dc(G,J.left||0,3,lc),Dc(G,G.transform.width-(J.right||0),3,Al);const ce=G.transform.centerPoint;(function(be,Te,Se,Me){cc(be,Te-1,Se-10,2,20,Me),cc(be,Te-10,Se-1,20,2,Me)})(G,ce.x,G.transform.height-ce.y,Ra)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,o=this.transform.modelViewProjectionMatrix;let h=this.terrainFacilitator.dirty;h||(h=t?!s.cj(n,o):!s.ck(n,o)),h||(h=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),h&&(s.cl(n,o),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(_,w){const A=_.context,M=A.gl,z=_.transform,O=vi.unblended,$=new Zr(M.LEQUAL,Zr.ReadWrite,[0,1]),G=w.tileManager.getRenderableTiles(),J=_.useProgram("terrainDepth");A.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),A.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),A.clear({color:s.bp.transparent,depth:1});for(const ce of G){const be=w.getTerrainMesh(ce.tileID),Te=w.getTerrainData(ce.tileID),Se=z.getProjectionData({overscaledTileID:ce.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Me={u_ele_delta:w.getMeshFrameDelta(z.zoom)};J.draw(A,M.TRIANGLES,$,Qr.disabled,O,si.backCCW,Me,Te,Se,"terrain",be.vertexBuffer,be.indexBuffer,be.segments)}A.bindFramebuffer.set(null),A.viewport.set([0,0,_.width,_.height])})(this,this.style.map.terrain),(function(_,w){const A=_.context,M=A.gl,z=_.transform,O=vi.unblended,$=new Zr(M.LEQUAL,Zr.ReadWrite,[0,1]),G=w.getCoordsTexture(),J=w.tileManager.getRenderableTiles(),ce=_.useProgram("terrainCoords");A.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),A.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),A.clear({color:s.bp.transparent,depth:1}),w.coordsIndex=[];for(const be of J){const Te=w.getTerrainMesh(be.tileID),Se=w.getTerrainData(be.tileID);A.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,G.texture);const Me={u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(z.zoom)},He=z.getProjectionData({overscaledTileID:be.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});ce.draw(A,M.TRIANGLES,$,Qr.disabled,O,si.backCCW,Me,Se,He,"terrain",Te.vertexBuffer,Te.indexBuffer,Te.segments),w.coordsIndex.push(be.tileID.key)}A.bindFramebuffer.set(null),A.viewport.set([0,0,_.width,_.height])})(this,this.style.map.terrain))}renderLayer(t,n,o,h,_){o.isHidden(this.transform.zoom)||(o.type==="background"||o.type==="custom"||(h||[]).length)&&(this.id=o.id,s.cm(o)?(function(w,A,M,z,O,$){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:G}=$,J=Qr.disabled,ce=w.colorModeForRenderPass();(M._unevaluatedLayout.hasValue("text-variable-anchor")||M._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(be,Te,Se,Me,He,Ee,Xe,et,qe){const lt=Te.transform,At=Te.style.map.terrain,vt=He==="map",St=Ee==="map";for(const Pt of be){const er=Me.getTile(Pt),rr=er.getBucket(Se);if(!rr||!rr.text||!rr.text.segments.get().length)continue;const $t=s.ay(rr.textSizeData,lt.zoom),nr=s.aN(er,1,Te.transform.zoom),Hr=Ni(vt,Te.transform,nr),Ci=Se.layout.get("icon-text-fit")!=="none"&&rr.hasIconData();if($t){const Xi=Math.pow(2,lt.zoom-er.tileID.overscaledZ),Vi=At?(rn,Ui)=>At.getElevation(Pt,rn,Ui):null;ic(rr,vt,St,qe,lt,Hr,Xi,$t,Ci,s.aO(lt,er,Xe,et),Pt.toUnwrapped(),Vi)}}})(z,w,M,A,M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),O),M.paint.get("icon-opacity").constantOr(1)!==0&&nc(w,A,M,z,!1,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),M.layout.get("icon-rotation-alignment"),M.layout.get("icon-pitch-alignment"),M.layout.get("icon-keep-upright"),J,ce,G),M.paint.get("text-opacity").constantOr(1)!==0&&nc(w,A,M,z,!0,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.layout.get("text-keep-upright"),J,ce,G),A.map.showCollisionBoxes&&(Yo(w,A,M,z,!0),Yo(w,A,M,z,!1))})(t,n,o,h,this.style.placement.variableOffsets,_):s.cn(o)?(function(w,A,M,z,O){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:$}=O,G=M.paint.get("circle-opacity"),J=M.paint.get("circle-stroke-width"),ce=M.paint.get("circle-stroke-opacity"),be=!M.layout.get("circle-sort-key").isConstant();if(G.constantOr(1)===0&&(J.constantOr(1)===0||ce.constantOr(1)===0))return;const Te=w.context,Se=Te.gl,Me=w.transform,He=w.getDepthModeForSublayer(0,Zr.ReadOnly),Ee=Qr.disabled,Xe=w.colorModeForRenderPass(),et=[],qe=Me.getCircleRadiusCorrection();for(let lt=0;lt<z.length;lt++){const At=z[lt],vt=A.getTile(At),St=vt.getBucket(M);if(!St)continue;const Pt=M.paint.get("circle-translate"),er=M.paint.get("circle-translate-anchor"),rr=s.aO(Me,vt,Pt,er),$t=St.programConfigurations.get(M.id),nr=w.useProgram("circle",$t),Hr=St.layoutVertexBuffer,Ci=St.indexBuffer,Xi=w.style.map.terrain&&w.style.map.terrain.getTerrainData(At),Vi={programConfiguration:$t,program:nr,layoutVertexBuffer:Hr,indexBuffer:Ci,uniformValues:Ya(w,vt,M,rr,qe),terrainData:Xi,projectionData:Me.getProjectionData({overscaledTileID:At,applyGlobeMatrix:!$,applyTerrainMatrix:!0})};if(be){const rn=St.segments.get();for(const Ui of rn)et.push({segments:new s.aX([Ui]),sortKey:Ui.sortKey,state:Vi})}else et.push({segments:St.segments,sortKey:0,state:Vi})}be&&et.sort(((lt,At)=>lt.sortKey-At.sortKey));for(const lt of et){const{programConfiguration:At,program:vt,layoutVertexBuffer:St,indexBuffer:Pt,uniformValues:er,terrainData:rr,projectionData:$t}=lt.state;vt.draw(Te,Se.TRIANGLES,He,Ee,Xe,si.backCCW,er,rr,$t,M.id,St,Pt,lt.segments,M.paint,w.transform.zoom,At)}})(t,n,o,h,_):s.co(o)?(function(w,A,M,z,O){if(M.paint.get("heatmap-opacity")===0)return;const $=w.context,{isRenderingToTexture:G,isRenderingGlobe:J}=O;if(w.style.map.terrain){for(const ce of z){const be=A.getTile(ce);A.hasRenderableParent(ce)||(w.renderPass==="offscreen"?Lu(w,be,M,ce,J):w.renderPass==="translucent"&&Cu(w,M,ce,G,J))}$.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?(function(ce,be,Te,Se){const Me=ce.context,He=Me.gl,Ee=ce.transform,Xe=Qr.disabled,et=new vi([He.ONE,He.ONE],s.bp.transparent,[!0,!0,!0,!0]);(function(qe,lt,At){const vt=qe.gl;qe.activeTexture.set(vt.TEXTURE1),qe.viewport.set([0,0,lt.width/4,lt.height/4]);let St=At.heatmapFbos.get(s.cd);St?(vt.bindTexture(vt.TEXTURE_2D,St.colorAttachment.get()),qe.bindFramebuffer.set(St.framebuffer)):(St=ac(qe,lt.width/4,lt.height/4),At.heatmapFbos.set(s.cd,St))})(Me,ce,Te),Me.clear({color:s.bp.transparent});for(let qe=0;qe<Se.length;qe++){const lt=Se[qe];if(be.hasRenderableParent(lt))continue;const At=be.getTile(lt),vt=At.getBucket(Te);if(!vt)continue;const St=vt.programConfigurations.get(Te.id),Pt=ce.useProgram("heatmap",St),er=Ee.getProjectionData({overscaledTileID:lt,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),rr=Ee.getCircleRadiusCorrection();Pt.draw(Me,He.TRIANGLES,Zr.disabled,Xe,et,si.backCCW,Es(At,Ee.zoom,Te.paint.get("heatmap-intensity"),rr),null,er,Te.id,vt.layoutVertexBuffer,vt.indexBuffer,vt.segments,Te.paint,Ee.zoom,St)}Me.viewport.set([0,0,ce.width,ce.height])})(w,A,M,z):w.renderPass==="translucent"&&(function(ce,be){const Te=ce.context,Se=Te.gl;Te.setColorMode(ce.colorModeForRenderPass());const Me=be.heatmapFbos.get(s.cd);Me&&(Te.activeTexture.set(Se.TEXTURE0),Se.bindTexture(Se.TEXTURE_2D,Me.colorAttachment.get()),Te.activeTexture.set(Se.TEXTURE1),Ec(Te,be).bind(Se.LINEAR,Se.CLAMP_TO_EDGE),ce.useProgram("heatmapTexture").draw(Te,Se.TRIANGLES,Zr.disabled,Qr.disabled,ce.colorModeForRenderPass(),si.disabled,ka(ce,be,0,1),null,null,be.id,ce.viewportBuffer,ce.quadTriangleIndexBuffer,ce.viewportSegments,be.paint,ce.transform.zoom))})(w,M)})(t,n,o,h,_):s.cp(o)?(function(w,A,M,z,O){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:$}=O,G=M.paint.get("line-opacity"),J=M.paint.get("line-width");if(G.constantOr(1)===0||J.constantOr(1)===0)return;const ce=w.getDepthModeForSublayer(0,Zr.ReadOnly),be=w.colorModeForRenderPass(),Te=M.paint.get("line-dasharray"),Se=Te.constantOr(1),Me=M.paint.get("line-pattern"),He=Me.constantOr(1),Ee=M.paint.get("line-gradient"),Xe=M.getCrossfadeParameters();let et;et=He?"linePattern":Se&&Ee?"lineGradientSDF":Se?"lineSDF":Ee?"lineGradient":"line";const qe=w.context,lt=qe.gl,At=w.transform;let vt=!0;for(const St of z){const Pt=A.getTile(St);if(He&&!Pt.patternsLoaded())continue;const er=Pt.getBucket(M);if(!er)continue;const rr=er.programConfigurations.get(M.id),$t=w.context.program.get(),nr=w.useProgram(et,rr),Hr=vt||nr.program!==$t,Ci=w.style.map.terrain&&w.style.map.terrain.getTerrainData(St),Xi=Me.constantOr(null),Vi=Te&&Te.constantOr(null);if(Xi&&Pt.imageAtlas){const Jn=Pt.imageAtlas,En=Jn.patternPositions[Xi.to.toString()],Pn=Jn.patternPositions[Xi.from.toString()];En&&Pn&&rr.setConstantPatternPositions(En,Pn)}else if(Vi){const Jn=M.layout.get("line-cap")==="round",En=w.lineAtlas.getDash(Vi.to,Jn),Pn=w.lineAtlas.getDash(Vi.from,Jn);rr.setConstantDashPositions(En,Pn)}const rn=At.getProjectionData({overscaledTileID:St,applyGlobeMatrix:!$,applyTerrainMatrix:!0}),Ui=At.getPixelScale();let _n;He?(_n=Xs(w,Pt,M,Ui,Xe),Js(qe,lt,Pt,rr,Xe)):Se&&Ee?(_n=bo(w,Pt,M,Ui,Xe,er.lineClipsArray.length),_s(w,A,qe,lt,M,er,St,rr,Xe)):Se?(_n=xl(w,Pt,M,Ui,Xe),Ti(w,qe,lt,rr,Hr,Xe)):Ee?(_n=pa(w,Pt,M,Ui,er.lineClipsArray.length),Ko(w,A,qe,lt,M,er,St)):_n=vo(w,Pt,M,Ui);const nn=w.stencilModeForClipping(St);nr.draw(qe,lt.TRIANGLES,ce,nn,be,si.disabled,_n,Ci,rn,M.id,er.layoutVertexBuffer,er.indexBuffer,er.segments,M.paint,w.transform.zoom,rr,er.layoutVertexBuffer2),vt=!1}})(t,n,o,h,_):s.cq(o)?(function(w,A,M,z,O){const $=M.paint.get("fill-color"),G=M.paint.get("fill-opacity");if(G.constantOr(1)===0)return;const{isRenderingToTexture:J}=O,ce=w.colorModeForRenderPass(),be=M.paint.get("fill-pattern"),Te=w.opaquePassEnabledForLayer()&&!be.constantOr(1)&&$.constantOr(s.bp.transparent).a===1&&G.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===Te){const Se=w.getDepthModeForSublayer(1,w.renderPass==="opaque"?Zr.ReadWrite:Zr.ReadOnly);Yn(w,A,M,z,Se,ce,!1,J)}if(w.renderPass==="translucent"&&M.paint.get("fill-antialias")){const Se=w.getDepthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,Zr.ReadOnly);Yn(w,A,M,z,Se,ce,!0,J)}})(t,n,o,h,_):s.cr(o)?(function(w,A,M,z,O){const $=M.paint.get("fill-extrusion-opacity");if($===0)return;const{isRenderingToTexture:G}=O;if(w.renderPass==="translucent"){const J=new Zr(w.context.gl.LEQUAL,Zr.ReadWrite,w.depthRangeFor3D);if($!==1||M.paint.get("fill-extrusion-pattern").constantOr(1))kc(w,A,M,z,J,Qr.disabled,vi.disabled,G),kc(w,A,M,z,J,w.stencilModeFor3D(),w.colorModeForRenderPass(),G);else{const ce=w.colorModeForRenderPass();kc(w,A,M,z,J,Qr.disabled,ce,G)}}})(t,n,o,h,_):s.cs(o)?(function(w,A,M,z,O){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const{isRenderingToTexture:$}=O,G=w.context,J=w.style.projection.useSubdivision,ce=w.getDepthModeForSublayer(0,Zr.ReadOnly),be=w.colorModeForRenderPass();if(w.renderPass==="offscreen")(function(Te,Se,Me,He,Ee,Xe,et){const qe=Te.context,lt=qe.gl;for(const At of Me){const vt=Se.getTile(At),St=vt.dem;if(!St||!St.data||!vt.needsHillshadePrepare)continue;const Pt=St.dim,er=St.stride,rr=St.getPixels();if(qe.activeTexture.set(lt.TEXTURE1),qe.pixelStoreUnpackPremultiplyAlpha.set(!1),vt.demTexture=vt.demTexture||Te.getTileTexture(er),vt.demTexture){const nr=vt.demTexture;nr.update(rr,{premultiply:!1}),nr.bind(lt.NEAREST,lt.CLAMP_TO_EDGE)}else vt.demTexture=new s.T(qe,rr,lt.RGBA,{premultiply:!1}),vt.demTexture.bind(lt.NEAREST,lt.CLAMP_TO_EDGE);qe.activeTexture.set(lt.TEXTURE0);let $t=vt.fbo;if(!$t){const nr=new s.T(qe,{width:Pt,height:Pt,data:null},lt.RGBA);nr.bind(lt.LINEAR,lt.CLAMP_TO_EDGE),$t=vt.fbo=qe.createFramebuffer(Pt,Pt,!0,!1),$t.colorAttachment.set(nr.texture)}qe.bindFramebuffer.set($t.framebuffer),qe.viewport.set([0,0,Pt,Pt]),Te.useProgram("hillshadePrepare").draw(qe,lt.TRIANGLES,Ee,Xe,et,si.disabled,Jl(vt.tileID,St),null,null,He.id,Te.rasterBoundsBuffer,Te.quadTriangleIndexBuffer,Te.rasterBoundsSegments),vt.needsHillshadePrepare=!1}})(w,A,z,M,ce,Qr.disabled,be),G.viewport.set([0,0,w.width,w.height]);else if(w.renderPass==="translucent")if(J){const[Te,Se,Me]=w.stencilConfigForOverlapTwoPass(z);Lo(w,A,M,Me,Te,ce,be,!1,$),Lo(w,A,M,Me,Se,ce,be,!0,$)}else{const[Te,Se]=w.getStencilConfigForOverlapAndUpdateStencilID(z);Lo(w,A,M,Se,Te,ce,be,!1,$)}})(t,n,o,h,_):s.ct(o)?(function(w,A,M,z,O){if(w.renderPass!=="translucent"||!z.length)return;const{isRenderingToTexture:$}=O,G=w.style.projection.useSubdivision,J=w.getDepthModeForSublayer(0,Zr.ReadOnly),ce=w.colorModeForRenderPass();if(G){const[be,Te,Se]=w.stencilConfigForOverlapTwoPass(z);Pl(w,A,M,Se,be,J,ce,!1,$),Pl(w,A,M,Se,Te,J,ce,!0,$)}else{const[be,Te]=w.getStencilConfigForOverlapAndUpdateStencilID(z);Pl(w,A,M,Te,be,J,ce,!1,$)}})(t,n,o,h,_):s.bU(o)?(function(w,A,M,z,O){if(w.renderPass!=="translucent"||M.paint.get("raster-opacity")===0||!z.length)return;const{isRenderingToTexture:$}=O,G=A.getSource(),J=w.style.projection.useSubdivision;if(G instanceof Gr)Qo(w,A,M,z,null,!1,!1,G.tileCoords,G.flippedWindingOrder,$);else if(J){const[ce,be,Te]=w.stencilConfigForOverlapTwoPass(z);Qo(w,A,M,Te,ce,!1,!0,Co,!1,$),Qo(w,A,M,Te,be,!0,!0,Co,!1,$)}else{const[ce,be]=w.getStencilConfigForOverlapAndUpdateStencilID(z);Qo(w,A,M,be,ce,!1,!0,Co,!1,$)}})(t,n,o,h,_):s.cu(o)?(function(w,A,M,z,O){const $=M.paint.get("background-color"),G=M.paint.get("background-opacity");if(G===0)return;const{isRenderingToTexture:J}=O,ce=w.context,be=ce.gl,Te=w.style.projection,Se=w.transform,Me=Se.tileSize,He=M.paint.get("background-pattern");if(w.isPatternMissing(He))return;const Ee=!He&&$.a===1&&G===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==Ee)return;const Xe=Qr.disabled,et=w.getDepthModeForSublayer(0,Ee==="opaque"?Zr.ReadWrite:Zr.ReadOnly),qe=w.colorModeForRenderPass(),lt=w.useProgram(He?"backgroundPattern":"background"),At=z||Ht(Se,{tileSize:Me,terrain:w.style.map.terrain});He&&(ce.activeTexture.set(be.TEXTURE0),w.imageManager.bind(w.context));const vt=M.getCrossfadeParameters();for(const St of At){const Pt=Se.getProjectionData({overscaledTileID:St,applyGlobeMatrix:!J,applyTerrainMatrix:!0}),er=He?Ys(G,w,He,{tileID:St,tileSize:Me},vt):Ja(G,$),rr=w.style.map.terrain&&w.style.map.terrain.getTerrainData(St),$t=Te.getMeshFromTileID(ce,St.canonical,!1,!0,"raster");lt.draw(ce,be.TRIANGLES,et,Xe,qe,si.backCCW,er,rr,Pt,M.id,$t.vertexBuffer,$t.indexBuffer,$t.segments)}})(t,0,o,h,_):s.cv(o)&&(function(w,A,M,z){const{isRenderingGlobe:O}=z,$=w.context,G=M.implementation,J=w.style.projection,ce=w.transform,be=ce.getProjectionDataForCustomLayer(O),Te={farZ:ce.farZ,nearZ:ce.nearZ,fov:ce.fov*Math.PI/180,modelViewProjectionMatrix:ce.modelViewProjectionMatrix,projectionMatrix:ce.projectionMatrix,shaderData:{variantName:J.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${J.shaderPreludeCode.vertexSource}`,define:J.shaderDefine},defaultProjectionData:be},Se=G.renderingMode?G.renderingMode:"2d";if(w.renderPass==="offscreen"){const Me=G.prerender;Me&&(w.setCustomLayerDefaults(),$.setColorMode(w.colorModeForRenderPass()),Me.call(G,$.gl,Te),$.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),$.setColorMode(w.colorModeForRenderPass()),$.setStencilMode(Qr.disabled);const Me=Se==="3d"?w.getDepthModeFor3D():w.getDepthModeForSublayer(0,Zr.ReadOnly);$.setDepthMode(Me),G.render($.gl,Te),$.setDirty(),w.setBaseState(),$.bindFramebuffer.set(null)}})(t,0,o,_))}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),o=this.imageManager.getPattern(t.to.toString());return!n||!o}useProgram(t,n,o=!1,h=[]){this.cache=this.cache||{};const _=!!this.style.map.terrain,w=this.style.projection,A=o?Bi.projectionMercator:w.shaderPreludeCode,M=o?Ki:w.shaderDefine,z=t+(n?n.cacheKey:"")+`/${o?is:w.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(_?"/terrain":"")+(h?`/${h.join("/")}`:"");return this.cache[z]||(this.cache[z]=new Ea(this.context,Bi[t],n,Si[t],this._showOverdrawInspector,_,A,M,h)),this.cache[z]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,n;if(this._tileTextures){for(const o in this._tileTextures){const h=this._tileTextures[o];if(h)for(const _ of h)_.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((n=this.tileExtentMesh.indexBuffer)===null||n===void 0||n.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const o in this.cache){const h=this.cache[o];h&&h.program&&this.context.gl.deleteProgram(h.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:n}=this.context.gl;return this.width!==t||this.height!==n}}function cu(m,t){let n,o=!1,h=null,_=null;const w=()=>{h=null,o&&(m.apply(_,n),h=setTimeout(w,t),o=!1)};return(...A)=>(o=!0,_=this,n=A,h||w(),h)}class Fc{constructor(t){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let o;return n.split("&").map((h=>h.split("="))).forEach((h=>{h[0]===this._hashName&&(o=h)})),(o&&o[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(!this._isValidHash(n))return!1;const o=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:o,pitch:+(n[4]||0)}),!0},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{const n=this._getCurrentHash();if(n.length===0)return;const o=n.join("/");let h=o;h.split("&").length>0&&(h=h.split("&")[0]),this._hashName&&(h=`${this._hashName}=${o}`);let _=window.location.hash.replace(h,"");_.startsWith("#&")?_=_.slice(0,1)+_.slice(2):_==="#"&&(_="");let w=window.location.href.replace(/(#.+)?$/,_);w=w.replace("&&","&"),window.history.replaceState(window.history.state,null,w)},this._updateHash=cu(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const n=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,h=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,h),w=Math.round(n.lng*_)/_,A=Math.round(n.lat*_)/_,M=this._map.getBearing(),z=this._map.getPitch();let O="";if(O+=t?`/${w}/${A}/${o}`:`${o}/${A}/${w}`,(M||z)&&(O+="/"+Math.round(10*M)/10),z&&(O+=`/${Math.round(z)}`),this._hashName){const $=this._hashName;let G=!1;const J=window.location.hash.slice(1).split("&").map((ce=>{const be=ce.split("=")[0];return be===$?(G=!0,`${be}=${O}`):ce})).filter((ce=>ce));return G||J.push(`${$}=${O}`),`#${J.join("&")}`}return`#${O}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new s.V(+t[2],+t[1])}catch{return!1}const n=+t[0],o=+(t[3]||0),h=+(t[4]||0);return n>=this._map.getMinZoom()&&n<=this._map.getMaxZoom()&&o>=-180&&o<=180&&h>=this._map.getMinPitch()&&h<=this._map.getMaxPitch()}}const _a={linearity:.3,easing:s.cw(0,0,.3,1)},Du=s.e({deceleration:2500,maxSpeed:1400},_a),Ks=s.e({deceleration:20,maxSpeed:1400},_a),Qs=s.e({deceleration:1e3,maxSpeed:360},_a),T=s.e({deceleration:1e3,maxSpeed:90},_a),C=s.e({deceleration:1e3,maxSpeed:360},_a);class V{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:he(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=he();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,roll:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)n.zoom+=_.zoomDelta||0,n.bearing+=_.bearingDelta||0,n.pitch+=_.pitchDelta||0,n.roll+=_.rollDelta||0,_.panDelta&&n.pan._add(_.panDelta),_.around&&(n.around=_.around),_.pinchAround&&(n.pinchAround=_.pinchAround);const o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(n.pan.mag()){const _=oe(n.pan.mag(),o,s.e({},Du,t||{})),w=n.pan.mult(_.amount/n.pan.mag()),A=this._map.cameraHelper.handlePanInertia(w,this._map.transform);h.center=A.easingCenter,h.offset=A.easingOffset,Z(h,_)}if(n.zoom){const _=oe(n.zoom,o,Ks),w=s.cx(this._map.transform.zoom+_.amount,this._map.getZoomSnap(),_.amount);h.zoom=w,Z(h,_)}if(n.bearing){const _=oe(n.bearing,o,Qs);h.bearing=this._map.transform.bearing+s.an(_.amount,-179,179),Z(h,_)}if(n.pitch){const _=oe(n.pitch,o,T);h.pitch=this._map.transform.pitch+_.amount,Z(h,_)}if(n.roll){const _=oe(n.roll,o,C);h.roll=this._map.transform.roll+s.an(_.amount,-179,179),Z(h,_)}if(h.zoom||h.bearing){const _=n.pinchAround===void 0?n.around:n.pinchAround;h.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),s.e(h,{noMoveStart:!0})}}function Z(m,t){(!m.duration||m.duration<t.duration)&&(m.duration=t.duration,m.easing=t.easing)}function oe(m,t,n){const{maxSpeed:o,linearity:h,deceleration:_}=n,w=s.an(m*h/(t/1e3),-o,o),A=Math.abs(w)/(_*h);return{easing:n.easing,duration:1e3*A,amount:w*(A/2)}}class ue extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,o,h={}){o=o instanceof MouseEvent?o:new MouseEvent(t,o);const _=re.mousePos(n.getCanvas(),o),w=n.unproject(_);super(t,s.e({point:_,lngLat:w,originalEvent:o},h)),this._defaultPrevented=!1,this.target=n}}class me extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,o){const h=t==="touchend"?o.changedTouches:o.touches,_=re.touchPos(n.getCanvasContainer(),h),w=_.map((M=>n.unproject(M))),A=_.reduce(((M,z,O,$)=>M.add(z.div($.length))),new s.P(0,0));super(t,{points:_,point:A,lngLats:w,lngLat:n.unproject(A),originalEvent:o}),this._defaultPrevented=!1}}class ve extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,o){super(t,{originalEvent:o}),this._defaultPrevented=!1}}class Ae{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new ve(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new ue(t.type,this._map,t))}mouseup(t){this._map.fire(new ue(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new ue(t.type,this._map,t))}dblclick(t){return this._firePreventable(new ue(t.type,this._map,t))}mouseover(t){this._map.fire(new ue(t.type,this._map,t))}mouseout(t){this._map.fire(new ue(t.type,this._map,t))}touchstart(t){return this._firePreventable(new me(t.type,this._map,t))}touchmove(t){this._map.fire(new me(t.type,this._map,t))}touchend(t){this._map.fire(new me(t.type,this._map,t))}touchcancel(t){this._map.fire(new me(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Re{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new ue(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ue("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new ue(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class at{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(s.P.convert(t),this._map.terrain)}}class Tt{constructor(t,n){this._map=t,this._tr=new at(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(re.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const o=n;if(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=o,this._box||(this._box=re.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(h.x,o.x),w=Math.max(h.x,o.x),A=Math.min(h.y,o.y),M=Math.max(h.y,o.y);re.setTransform(this._box,`translate(${_}px,${A}px)`),this._box.style.width=w-_+"px",this._box.style.height=M-A+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const o=this._startPos,h=n;if(this.reset(),re.suppressClick(),o.x!==h.x||o.y!==h.y)return this._map.fire(new s.l("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(o,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(re.remove(this._box),this._box=null),re.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new s.l(t,{originalEvent:n}))}}function ke(m,t){if(m.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${t.length}`);const n={};for(let o=0;o<m.length;o++)n[m[o].identifier]=t[o];return n}class Ve{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),o.length===this.numTouches&&(this.centroid=(function(h){const _=new s.P(0,0);for(const w of h)_._add(w);return _.div(h.length)})(n),this.touches=ke(o,n)))}touchmove(t,n,o){if(this.aborted||!this.centroid)return;const h=ke(o,n);for(const _ in this.touches){const w=h[_];(!w||w.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,n,o){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class _t{constructor(t){this.singleTap=new Ve(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,o){this.singleTap.touchstart(t,n,o)}touchmove(t,n,o){this.singleTap.touchmove(t,n,o)}touchend(t,n,o){const h=this.singleTap.touchend(t,n,o);if(h){const _=t.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(h)<30;if(_&&w||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class Ot{constructor(t){this._tr=new at(t),this._zoomIn=new _t({numTouches:1,numTaps:2}),this._zoomOut=new _t({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,o){this._zoomIn.touchstart(t,n,o),this._zoomOut.touchstart(t,n,o)}touchmove(t,n,o){this._zoomIn.touchmove(t,n,o),this._zoomOut.touchmove(t,n,o)}touchend(t,n,o){const h=this._zoomIn.touchend(t,n,o),_=this._zoomOut.touchend(t,n,o),w=this._tr;return h?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:s.cx(w.zoom+1,A.getZoomSnap()),around:w.unproject(h)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:s.cx(w.zoom-1,A.getZoomSnap()),around:w.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wt{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const n=this._moveFunction(...t);if(n.bearingDelta||n.pitchDelta||n.rollDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(t,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(n)?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,n){if(!this.isEnabled())return;const o=this._lastPoint;if(!o)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const h=Array.isArray(n)?n[0]:n;return!this._moved&&h.dist(o)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(o,h))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&re.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const jt=0,Ut=2,tr={[jt]:1,[Ut]:2};class Jt{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const n=re.mouseButton(t);this._eventButton=n}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(n,o){const h=tr[o];return n.buttons===void 0||(n.buttons&h)!==h})(t,this._eventButton)}isValidEndEvent(t){return re.mouseButton(t)===this._eventButton}}class Dr{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Sr{constructor(t=new Jt({checkCorrectEvent:()=>!0}),n=new Dr){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=n}_executeRelevantHandler(t,n,o){return t instanceof MouseEvent?n(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?o(t):void 0}startMove(t){this._executeRelevantHandler(t,(n=>this.mouseMoveStateManager.startMove(n)),(n=>this.oneFingerTouchMoveStateManager.startMove(n)))}endMove(t){this._executeRelevantHandler(t,(n=>this.mouseMoveStateManager.endMove(n)),(n=>this.oneFingerTouchMoveStateManager.endMove(n)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(n=>this.mouseMoveStateManager.isValidStartEvent(n)),(n=>this.oneFingerTouchMoveStateManager.isValidStartEvent(n)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(n=>this.mouseMoveStateManager.isValidMoveEvent(n)),(n=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(n)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(n=>this.mouseMoveStateManager.isValidEndEvent(n)),(n=>this.oneFingerTouchMoveStateManager.isValidEndEvent(n)))}}const Yr=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=t=>{t.preventDefault()}};class Mr{constructor(t,n){this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,n,o){return this._calculateTransform(t,n,o)}touchmove(t,n,o){if(this._active){if(!this._shouldBePrevented(o.length))return t.preventDefault(),this._calculateTransform(t,n,o);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,n,o){this._calculateTransform(t,n,o),this._active&&this._shouldBePrevented(o.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,o){o.length>0&&(this._active=!0);const h=ke(o,n),_=new s.P(0,0),w=new s.P(0,0);let A=0;for(const z in h){const O=h[z],$=this._touches[z];$&&(_._add(O),w._add(O.sub($)),A++,h[z]=O)}if(this._touches=h,this._shouldBePrevented(A)||!w.mag())return;const M=w.div(A);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(A),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hi{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,n,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,o){if(!this._firstTwoTouches)return;t.preventDefault();const[h,_]=this._firstTwoTouches,w=un(o,n,h),A=un(o,n,_);if(!w||!A)return;const M=this._aroundCenter?null:w.add(A).div(2);return this._move([w,A],M,t)}touchend(t,n,o){if(!this._firstTwoTouches)return;const[h,_]=this._firstTwoTouches,w=un(o,n,h),A=un(o,n,_);w&&A||(this._active&&re.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function un(m,t,n){for(let o=0;o<m.length;o++)if(m[o].identifier===n)return t[o]}function ii(m,t){return Math.log(m/t)/Math.LN2}class Ir extends hi{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const o=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(ii(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ii(this._distance,o),pinchAround:n}}}function fr(m,t){return 180*m.angleWith(t)/Math.PI}class en extends hi{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n,o){const h=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:fr(this._vector,h),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,o=fr(t,this._startVector);return Math.abs(o)<n}}function Jr(m){return Math.abs(m.y)>Math.abs(m.x)}class pi extends hi{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,o){super.touchstart(t,n,o),this._currentTouchCount=o.length}_start(t){this._lastPoints=t,Jr(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,o){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const h=t[0].sub(this._lastPoints[0]),_=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,_,o.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(h.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,o){if(this._valid!==void 0)return this._valid;const h=t.mag()>=2,_=n.mag()>=2;if(!h&&!_)return;if(!h||!_)return this._firstMove===void 0&&(this._firstMove=o),o-this._firstMove<100&&void 0;const w=t.y>0==n.y>0;return Jr(t)&&Jr(n)&&w}}const bi={panStep:100,bearingStep:15,pitchStep:10};class Kr{constructor(t){this._tr=new at(t);const n=bi;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,o=0,h=0,_=0,w=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?o=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?o=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?h=1:(t.preventDefault(),w=-1);break;case 40:t.shiftKey?h=-1:(t.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(o=0,h=0),{cameraAnimation:A=>{const M=this._tr;A.easeTo({duration:300,easeId:"keyboardHandler",easing:ls,zoom:n?s.cx(M.zoom+n*(t.shiftKey?2:1),A.getZoomSnap()):M.zoom,bearing:M.bearing+o*this._bearingStep,pitch:M.pitch+h*this._pitchStep,offset:[-_*this._panStep,-w*this._panStep],center:M.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ls(m){return m*(2-m)}const Oi=4.000244140625,Mn=1/450;class Rn{constructor(t,n){this._onTimeout=o=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)},this._map=t,this._tr=new at(t),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Mn}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const o=he(),h=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,n!==0&&n%Oi==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(h*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=re.mousePos(this._map.getCanvas(),t),o=this._tr;this._aroundPoint=this._aroundCenter?o.transform.locationToScreenPoint(s.V.convert(o.center)):n,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const A=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=A),typeof this._targetZoom=="number"&&(this._targetZoom+=A)}if(this._delta!==0){const A=this._type==="wheel"&&Math.abs(this._delta)>Oi?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&M!==0&&(M=1/M);const z=typeof this._targetZoom!="number"?t.scale:s.aq(this._targetZoom),O=t.applyConstrain(t.getCameraLngLat(),s.at(z*M)).zoom,$=this._map.getZoomSnap();if(this._type==="wheel"&&$>0){const G=s.cx(t.zoom,$);this._targetZoom=s.cx(O,$,O-G)}else this._targetZoom=O;this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,o=this._startZoom,h=this._easing;let _,w=!1;if(this._type==="wheel"&&o&&h){const A=he()-this._lastWheelEventTime,M=Math.min((A+5)/200,1),z=h(M);_=s.G.number(o,n,z),M<1?this._frameId||(this._frameId=!0):w=!0}else _=n,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=_,{noInertia:!0,needsRenderFrame:!w,zoomDelta:_-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=s.cz;if(this._prevEase){const o=this._prevEase,h=(he()-o.start)/o.duration,_=o.easing(h+.01)-o.easing(h),w=.27/Math.sqrt(_*_+1e-4)*.01,A=Math.sqrt(.0729-w*w);n=s.cw(w,A,.25,1)}return this._prevEase={start:he(),duration:t,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class mn{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _i{constructor(t){this._tr=new at(t),this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:o=>{o.easeTo({duration:300,zoom:s.cx(this._tr.zoom+(t.shiftKey?-1:1),o.getZoomSnap()),around:this._tr.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pi{constructor(){this._tap=new _t({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,n,o){if(!this._swipePoint)if(this._tapTime){const h=n[0],_=t.timeStamp-this._tapTime<500,w=this._tapPoint.dist(h)<30;_&&w?o.length>0&&(this._swipePoint=h,this._swipeTouch=o[0].identifier):this.reset()}else this._tap.touchstart(t,n,o)}touchmove(t,n,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;const h=n[0],_=h.y-this._swipePoint.y;return this._swipePoint=h,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,n,o)}touchend(t,n,o){if(this._tapTime)this._swipePoint&&o.length===0&&this.reset();else{const h=this._tap.touchend(t,n,o);h&&(this._tapTime=t.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tn{constructor(t,n,o){this._el=t,this._mousePan=n,this._touchPan=o}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ci{constructor(t,n,o,h){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=n,this._mousePitch=o,this._mouseRoll=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class gn{constructor(t,n,o,h){this._el=t,this._touchZoom=n,this._touchRotate=o,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class mr{constructor(t,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=re.create("div","maplibregl-cooperative-gesture-screen",t);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const o=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=n,this._container.appendChild(h);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=o,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(re.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,n){this._enabled&&(this._map.fire(new s.l("cooperativegestureprevented",{gestureType:t,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const pr=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class Bn extends s.l{}function Ai(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class hn{get _ownerDocument(){var t;return((t=this._el)===null||t===void 0?void 0:t.ownerDocument)||document}get _ownerWindow(){var t,n;return((n=(t=this._el)===null||t===void 0?void 0:t.ownerDocument)===null||n===void 0?void 0:n.defaultView)||window}constructor(t,n){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,_)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=h.type==="renderFrame"?void 0:h,A={needsRenderFrame:!1},M={},z={};for(const{handlerName:G,handler:J,allowed:ce}of this._handlers){if(!J.isEnabled())continue;let be;if(this._blockedByActive(z,ce,G))J.reset();else if(J[_||h.type]){if(s.cA(h,_||h.type)){const Te=re.mousePos(this._map.getCanvas(),h);be=J[_||h.type](h,Te)}else if(s.cB(h,_||h.type)){const Te=this._getMapTouches(h.touches),Se=re.touchPos(this._map.getCanvas(),Te);be=J[_||h.type](h,Se,Te)}else s.cC(_||h.type)||(be=J[_||h.type](h));this.mergeHandlerResult(A,M,be,G,w),be&&be.needsRenderFrame&&this._triggerRenderFrame()}(be||J.isActive())&&(z[G]=J)}const O={};for(const G in this._previousActiveHandlers)z[G]||(O[G]=w);this._previousActiveHandlers=z,(Object.keys(O).length||Ai(A))&&(this._changes.push([A,M,O]),this._triggerRenderFrame()),(Object.keys(z).length||Ai(A))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:$}=A;$&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],$(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new V(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[this._ownerDocument,"mousemove",{capture:!0}],[this._ownerDocument,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[this._ownerWindow,"blur",void 0]];for(const[h,_,w]of this._listeners)re.addEventListener(h,_,h===this._ownerDocument?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[t,n,o]of this._listeners)re.removeEventListener(t,n,t===this._ownerDocument?this.handleWindowEvent:this.handleEvent,o)}_addDefaultHandlers(t){const n=this._map,o=n.getCanvasContainer();this._add("mapEvent",new Ae(n,t));const h=n.boxZoom=new Tt(n,t);this._add("boxZoom",h),t.interactive&&t.boxZoom&&h.enable();const _=n.cooperativeGestures=new mr(n,t.cooperativeGestures);this._add("cooperativeGestures",_),t.cooperativeGestures&&_.enable();const w=new Ot(n),A=new _i(n);n.doubleClickZoom=new mn(A,w),this._add("tapZoom",w),this._add("clickZoom",A),t.interactive&&t.doubleClickZoom&&n.doubleClickZoom.enable();const M=new Pi;this._add("tapDragZoom",M);const z=n.touchPitch=new pi(n);this._add("touchPitch",z),t.interactive&&t.touchPitch&&n.touchPitch.enable(t.touchPitch);const O=()=>n.project(n.getCenter()),$=(function({enable:Ee,clickTolerance:Xe,aroundCenter:et=!0,minPixelCenterThreshold:qe=100,rotateDegreesPerPixelMoved:lt=.8},At){const vt=new Jt({checkCorrectEvent:St=>re.mouseButton(St)===0&&St.ctrlKey||re.mouseButton(St)===2&&!St.ctrlKey});return new wt({clickTolerance:Xe,move:(St,Pt)=>{const er=At();if(et&&Math.abs(er.y-St.y)>qe)return{bearingDelta:s.cy(new s.P(St.x,Pt.y),Pt,er)};let rr=(Pt.x-St.x)*lt;return et&&Pt.y<er.y&&(rr=-rr),{bearingDelta:rr}},moveStateManager:vt,enable:Ee,assignEvents:Yr})})(t,O),G=(function({enable:Ee,clickTolerance:Xe,pitchDegreesPerPixelMoved:et=-.5}){const qe=new Jt({checkCorrectEvent:lt=>re.mouseButton(lt)===0&&lt.ctrlKey||re.mouseButton(lt)===2});return new wt({clickTolerance:Xe,move:(lt,At)=>({pitchDelta:(At.y-lt.y)*et}),moveStateManager:qe,enable:Ee,assignEvents:Yr})})(t),J=(function({enable:Ee,clickTolerance:Xe,rollDegreesPerPixelMoved:et=.3},qe){const lt=new Jt({checkCorrectEvent:At=>re.mouseButton(At)===2&&At.ctrlKey});return new wt({clickTolerance:Xe,move:(At,vt)=>{const St=qe();let Pt=(vt.x-At.x)*et;return vt.y<St.y&&(Pt=-Pt),{rollDelta:Pt}},moveStateManager:lt,enable:Ee,assignEvents:Yr})})(t,O);n.dragRotate=new ci(t,$,G,J),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",G,["mouseRotate","mouseRoll"]),this._add("mouseRoll",J,["mousePitch"]),t.interactive&&t.dragRotate&&n.dragRotate.enable();const ce=(function({enable:Ee,clickTolerance:Xe}){const et=new Jt({checkCorrectEvent:qe=>re.mouseButton(qe)===0&&!qe.ctrlKey});return new wt({clickTolerance:Xe,move:(qe,lt)=>({around:lt,panDelta:lt.sub(qe)}),activateOnStart:!0,moveStateManager:et,enable:Ee,assignEvents:Yr})})(t),be=new Mr(t,n);n.dragPan=new tn(o,ce,be),this._add("mousePan",ce),this._add("touchPan",be,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&n.dragPan.enable(t.dragPan);const Te=new en,Se=new Ir;n.touchZoomRotate=new gn(o,Se,Te,M),this._add("touchRotate",Te,["touchPan","touchZoom"]),this._add("touchZoom",Se,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&n.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new Re(n));const Me=n.scrollZoom=new Rn(n,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Me,["mousePan"]),t.interactive&&t.scrollZoom&&n.scrollZoom.enable(t.scrollZoom);const He=n.keyboard=new Kr(n);this._add("keyboard",He),t.interactive&&t.keyboard&&n.keyboard.enable()}_add(t,n,o){this._handlers.push({handlerName:t,handler:n,allowed:o}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!pr(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,n,o){for(const h in t)if(h!==o&&(!n||n.indexOf(h)<0))return!0;return!1}_getMapTouches(t){const n=[];for(const o of t)this._el.contains(o.target)&&n.push(o);return n}mergeHandlerResult(t,n,o,h,_){if(!o)return;s.e(t,o);const w={handlerName:h,originalEvent:o.originalEvent||_};o.zoomDelta!==void 0&&(n.zoom=w),o.panDelta!==void 0&&(n.drag=w),o.rollDelta!==void 0&&(n.roll=w),o.pitchDelta!==void 0&&(n.pitch=w),o.bearingDelta!==void 0&&(n.rotate=w)}_applyChanges(){const t={},n={},o={};for(const[h,_,w]of this._changes)h.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(h.panDelta)),h.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+h.pitchDelta),h.rollDelta&&(t.rollDelta=(t.rollDelta||0)+h.rollDelta),h.around!==void 0&&(t.around=h.around),h.pinchAround!==void 0&&(t.pinchAround=h.pinchAround),h.noInertia&&(t.noInertia=h.noInertia),s.e(n,_),s.e(o,w);this._updateMapTransform(t,n,o),this._changes=[]}_updateMapTransform(t,n,o){const h=this._map,_=h._getTransformForUpdate(),w=h.terrain;if(!(Ai(t)||w&&this._terrainMovement))return this._fireEvents(n,o,!0);h._stop(!0);let{panDelta:A,zoomDelta:M,bearingDelta:z,pitchDelta:O,rollDelta:$,around:G,pinchAround:J}=t;J!==void 0&&(G=J),G=G||h.transform.centerPoint,w&&!_.isPointOnMapSurface(G)&&(G=_.centerPoint);const ce={panDelta:A,zoomDelta:M,rollDelta:$,pitchDelta:O,bearingDelta:z,around:G};this._map.cameraHelper.useGlobeControls&&!_.isPointOnMapSurface(G)&&(G=_.centerPoint);const be=G.distSqr(_.centerPoint)<.01?_.center:_.screenPointToLocation(A?G.sub(A):G);this._handleMapControls({terrain:w,tr:_,deltasForHelper:ce,preZoomAroundLoc:be,combinedEventsInProgress:n,panDelta:A}),h._applyUpdatedTransform(_),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,o,!0)}_handleMapControls({terrain:t,tr:n,deltasForHelper:o,preZoomAroundLoc:h,combinedEventsInProgress:_,panDelta:w}){const A=this._map.cameraHelper;if(A.handleMapControlsRollPitchBearingZoom(o,n),t)return A.useGlobeControls?(this._terrainMovement||!_.drag&&!_.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void A.handleMapControlsPan(o,n,h)):this._terrainMovement||!_.drag&&!_.zoom?void(_.drag&&this._terrainMovement&&w?n.setCenter(n.screenPointToLocation(n.centerPoint.sub(w))):A.handleMapControlsPan(o,n,h)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void A.handleMapControlsPan(o,n,h));A.handleMapControlsPan(o,n,h)}_fireEvents(t,n,o){const h=pr(this._eventsInProgress),_=pr(t),w={};for(const $ in t){const{originalEvent:G}=t[$];this._eventsInProgress[$]||(w[`${$}start`]=G),this._eventsInProgress[$]=t[$]}!h&&_&&this._fireEvent("movestart",_.originalEvent);for(const $ in w)this._fireEvent($,w[$]);_&&this._fireEvent("move",_.originalEvent);for(const $ in t){const{originalEvent:G}=t[$];this._fireEvent($,G)}const A={};let M;for(const $ in this._eventsInProgress){const{handlerName:G,originalEvent:J}=this._eventsInProgress[$];this._handlersById[G].isActive()||(delete this._eventsInProgress[$],M=n[G]||J,A[`${$}end`]=M)}for(const $ in A)this._fireEvent($,A[$]);const z=pr(this._eventsInProgress),O=(h||_)&&!z;if(O&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const $=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&$.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform($)}if(o&&O){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),G=J=>J!==0&&-this._bearingSnap<J&&J<this._bearingSnap;!$||!$.essential&&j.prefersReducedMotion?(this._map.fire(new s.l("moveend",{originalEvent:M})),G(this._map.getBearing())&&this._map.resetNorth()):(G($.bearing||this._map.getBearing())&&($.bearing=0),$.freezeElevation=!0,this._map.easeTo($,{originalEvent:M})),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new s.l(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new Bn("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Fi extends s.E{constructor(t,n,o){super(),this._renderFrameCallback=()=>{const h=Math.min((he()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=o.bearingSnap,this._zoomSnap=o.zoomSnap,this.cameraHelper=n,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,n){t.apply(this.transform,!0),this.transform=t,this.cameraHelper=n}getCenter(){return new s.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,n){return this.jumpTo({elevation:t},n),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,n,o){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,s.e({offset:t},n),o)}panTo(t,n,o){return this.easeTo(s.e({center:t},n),o)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,o){return this.easeTo(s.e({zoom:t},n),o)}zoomIn(t,n){return this.zoomTo(s.cx(this.getZoom()+1,this._zoomSnap),t,n),this}zoomOut(t,n){return this.zoomTo(s.cx(this.getZoom()-1,this._zoomSnap),t,n),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,n){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new s.l("movestart",n)).fire(new s.l("move",n)).fire(new s.l("moveend",n))),this}getBearing(){return this.transform.bearing}setZoomSnap(t){return this._zoomSnap=t,this}getZoomSnap(){return this._zoomSnap}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,o){return this.easeTo(s.e({bearing:t},n),o)}resetNorth(t,n){return this.rotateTo(0,s.e({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(s.e({bearing:0,pitch:0,roll:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}getRoll(){return this.transform.roll}setRoll(t,n){return this.jumpTo({roll:t},n),this}cameraForBounds(t,n){t=br.convert(t).adjustAntiMeridian();const o=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),o,n)}_cameraForBoxAndBearing(t,n,o,h){const _={top:0,bottom:0,right:0,left:0};if(typeof(h=s.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const z=h.padding;h.padding={top:z,bottom:z,right:z,left:z}}const w=s.e(_,h.padding);h.padding=w;const A=this.transform,M=new br(t,n);return this.cameraHelper.cameraForBoxAndBearing(h,w,M,o,A)}fitBounds(t,n,o){return this._fitInternal(this.cameraForBounds(t,n),n,o)}fitScreenCoordinates(t,n,o,h,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(s.P.convert(t)),this.transform.screenPointToLocation(s.P.convert(n)),o,h),h,_)}_fitInternal(t,n,o){return t?(delete(n=s.e(t,n)).padding,n.linear?this.easeTo(n,o):this.flyTo(n,o)):this}jumpTo(t,n){this.stop();const o=this._getTransformForUpdate();let h=!1,_=!1,w=!1;const A=o.zoom;this.cameraHelper.handleJumpToCenterZoom(o,t);const M=o.zoom!==A;return"elevation"in t&&o.elevation!==+t.elevation&&o.setElevation(+t.elevation),"bearing"in t&&o.bearing!==+t.bearing&&(h=!0,o.setBearing(+t.bearing)),"pitch"in t&&o.pitch!==+t.pitch&&(_=!0,o.setPitch(+t.pitch)),"roll"in t&&o.roll!==+t.roll&&(w=!0,o.setRoll(+t.roll)),t.padding==null||o.isPaddingEqual(t.padding)||o.setPadding(t.padding),this._applyUpdatedTransform(o),this.fire(new s.l("movestart",n)).fire(new s.l("move",n)),M&&this.fire(new s.l("zoomstart",n)).fire(new s.l("zoom",n)).fire(new s.l("zoomend",n)),h&&this.fire(new s.l("rotatestart",n)).fire(new s.l("rotate",n)).fire(new s.l("rotateend",n)),_&&this.fire(new s.l("pitchstart",n)).fire(new s.l("pitch",n)).fire(new s.l("pitchend",n)),w&&this.fire(new s.l("rollstart",n)).fire(new s.l("roll",n)).fire(new s.l("rollend",n)),this.fire(new s.l("moveend",n))}calculateCameraOptionsFromTo(t,n,o,h=0){const _=s.a9.fromLngLat(t,n),w=s.a9.fromLngLat(o,h),A=w.x-_.x,M=w.y-_.y,z=w.z-_.z,O=Math.hypot(A,M,z);if(O===0)throw new Error("Can't calculate camera options with same From and To");const $=Math.hypot(A,M),G=s.at(this.transform.cameraToCenterDistance/O/this.transform.tileSize),J=180*Math.atan2(A,-M)/Math.PI;let ce=180*Math.acos($/O)/Math.PI;return ce=z<0?90-ce:90+ce,{center:w.toLngLat(),elevation:h,zoom:G,pitch:ce,bearing:J}}calculateCameraOptionsFromCameraLngLatAltRotation(t,n,o,h,_){const w=this.transform.calculateCenterFromCameraLngLatAlt(t,n,o,h);return{center:w.center,elevation:w.elevation,zoom:w.zoom,bearing:o,pitch:h,roll:_}}easeTo(t,n){this._stop(!1,t.easeId),((t=s.e({offset:[0,0],duration:500,easing:s.cz},t)).animate===!1||!t.essential&&j.prefersReducedMotion)&&(t.duration=0);const o=this._getTransformForUpdate(),h=this.getBearing(),_=o.pitch,w=o.roll,A="bearing"in t?this._normalizeBearing(t.bearing,h):h,M="pitch"in t?+t.pitch:_,z="roll"in t?this._normalizeBearing(t.roll,w):w,O="padding"in t?t.padding:o.padding,$=s.P.convert(t.offset);let G,J;t.around&&(G=s.V.convert(t.around),J=o.locationToScreenPoint(G));const ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},be=this.cameraHelper.handleEaseTo(o,{bearing:A,pitch:M,roll:z,padding:O,around:G,aroundPoint:J,offsetAsPoint:$,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||h!==A,this._pitching=this._pitching||M!==_,this._rolling=this._rolling||z!==w,this._padding=!o.isPaddingEqual(O),this._zooming=this._zooming||be.isZooming,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,ce),this.terrain&&this._prepareElevation(be.elevationCenter),this._ease((Te=>{be.easeFunc(Te),this.terrain&&!t.freezeElevation&&this._updateElevation(Te),this._applyUpdatedTransform(o),this._fireMoveEvents(n)}),(Te=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(n,Te)}),t),this}_prepareEase(t,n,o={}){this._moving=!0,n||o.moving||this.fire(new s.l("movestart",t)),this._zooming&&!o.zooming&&this.fire(new s.l("zoomstart",t)),this._rotating&&!o.rotating&&this.fire(new s.l("rotatestart",t)),this._pitching&&!o.pitching&&this.fire(new s.l("pitchstart",t)),this._rolling&&!o.rolling&&this.fire(new s.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&n!==this._elevationTarget){const o=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(o-(n-(o*t+this._elevationStart))/(1-t)),this._elevationTarget=n}this.transform.setElevation(s.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const n=t.getCameraLngLat(),o=t.getCameraAltitude(),h=this.terrain?this.terrain.getElevationForLngLatZoom(n,t.zoom):0;if(o<h){const _=this.calculateCameraOptionsFromTo(n,h,t.center,t.elevation);return{pitch:_.pitch,zoom:_.zoom}}return{}}_applyUpdatedTransform(t){const n=[];if(n.push((h=>this._elevateCameraIfInsideTerrain(h))),this.transformCameraUpdate&&n.push((h=>this.transformCameraUpdate(h))),!n.length)return;const o=t.clone();for(const h of n){const _=o.clone(),{center:w,zoom:A,roll:M,pitch:z,bearing:O,elevation:$}=h(_);w&&_.setCenter(w),$!==void 0&&_.setElevation($),A!==void 0&&_.setZoom(A),M!==void 0&&_.setRoll(M),z!==void 0&&_.setPitch(z),O!==void 0&&_.setBearing(O),o.apply(_,!1)}this.transform.apply(o,!1)}_fireMoveEvents(t){this.fire(new s.l("move",t)),this._zooming&&this.fire(new s.l("zoom",t)),this._rotating&&this.fire(new s.l("rotate",t)),this._pitching&&this.fire(new s.l("pitch",t)),this._rolling&&this.fire(new s.l("roll",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const o=this._zooming,h=this._rotating,_=this._pitching,w=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,o&&this.fire(new s.l("zoomend",t)),h&&this.fire(new s.l("rotateend",t)),_&&this.fire(new s.l("pitchend",t)),w&&this.fire(new s.l("rollend",t)),this.fire(new s.l("moveend",t))}flyTo(t,n){if(!t.essential&&j.prefersReducedMotion){const Pt=s.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Pt,n)}this.stop(),t=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.cz},t);const o=this._getTransformForUpdate(),h=o.bearing,_=o.pitch,w=o.roll,A=o.padding,M="bearing"in t?this._normalizeBearing(t.bearing,h):h,z="pitch"in t?+t.pitch:_,O="roll"in t?this._normalizeBearing(t.roll,w):w,$="padding"in t?t.padding:o.padding,G=s.P.convert(t.offset);let J=o.centerPoint.add(G);const ce=o.screenPointToLocation(J),be=this.cameraHelper.handleFlyTo(o,{bearing:M,pitch:z,roll:O,padding:$,locationAtOffset:ce,offsetAsPoint:G,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let Te=t.curve;const Se=Math.max(o.width,o.height),Me=Se/be.scaleOfZoom,He=be.pixelPathLength;typeof be.scaleOfMinZoom=="number"&&(Te=Math.sqrt(Se/be.scaleOfMinZoom/He*2));const Ee=Te*Te;function Xe(Pt){const er=(Me*Me-Se*Se+(Pt?-1:1)*Ee*Ee*He*He)/(2*(Pt?Me:Se)*Ee*He);return Math.log(Math.sqrt(er*er+1)-er)}function et(Pt){return(Math.exp(Pt)-Math.exp(-Pt))/2}function qe(Pt){return(Math.exp(Pt)+Math.exp(-Pt))/2}const lt=Xe(!1);let At=function(Pt){return qe(lt)/qe(lt+Te*Pt)},vt=function(Pt){return Se*((qe(lt)*(et(er=lt+Te*Pt)/qe(er))-et(lt))/Ee)/He;var er},St=(Xe(!0)-lt)/Te;if(Math.abs(He)<2e-6||!isFinite(St)){if(Math.abs(Se-Me)<1e-6)return this.easeTo(t,n);const Pt=Me<Se?-1:1;St=Math.abs(Math.log(Me/Se))/Te,vt=()=>0,At=er=>Math.exp(Pt*Te*er)}return t.duration="duration"in t?+t.duration:1e3*St/("screenSpeed"in t?+t.screenSpeed/Te:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=h!==M,this._pitching=z!==_,this._rolling=O!==w,this._padding=!o.isPaddingEqual($),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(be.targetCenter),this._ease((Pt=>{const er=Pt*St,rr=1/At(er),$t=vt(er);this._rotating&&o.setBearing(s.G.number(h,M,Pt)),this._pitching&&o.setPitch(s.G.number(_,z,Pt)),this._rolling&&o.setRoll(s.G.number(w,O,Pt)),this._padding&&(o.interpolatePadding(A,$,Pt),J=o.centerPoint.add(G)),be.easeFunc(Pt,rr,$t,J),this.terrain&&!t.freezeElevation&&this._updateElevation(Pt),this._applyUpdatedTransform(o),this._fireMoveEvents(n)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(n)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){var o;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,n)}return t||(o=this.handlers)===null||o===void 0||o.stop(!1),this}_ease(t,n,o){o.animate===!1||o.duration===0?(t(1),n()):(this._easeStart=he(),this._easeOptions=o,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,n){t=s.W(t,-180,180);const o=Math.abs(t-n);return Math.abs(t-360-n)<o&&(t-=360),Math.abs(t+360-n)<o&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(s.V.convert(t),this.transform):null}}const ji={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class cs{constructor(t=ji){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=re.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=re.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=re.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){re.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const o=this._map._getUIString(`AttributionControl.${n}`);t.title=o,t.setAttribute("aria-label",o)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((h=>typeof h!="string"?"":h))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const n=this._map.style.tileManagers;for(const h in n){const _=n[h];if(_.used||_.usedForTerrain){const w=_.getSource();w.attribution&&t.indexOf(w.attribution)<0&&t.push(w.attribution)}}t=t.filter((h=>String(h).trim())),t.sort(((h,_)=>h.length-_.length)),t=t.filter(((h,_)=>{for(let w=_+1;w<t.length;w++)if(t[w].indexOf(h)>=0)return!1;return!0}));const o=t.join(" | ");o!==this._attribHTML&&(this._attribHTML=o,t.length?(this._innerContainer.innerHTML=re.sanitize(o),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ys{constructor(t={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const o=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&o.classList.add("maplibregl-compact"):o.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=re.create("div","maplibregl-ctrl");const n=re.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){re.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class vs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,o=n?this._queue.concat(n):this._queue;for(const h of o)if(h.id===t)return void(h.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const o of n)if(!o.cancelled&&(o.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Ds=s.aU([{name:"a_pos3d",type:"Int16",components:3}]);class Ii extends s.E{constructor(t){super(),this._lastTilesetChange=he(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,n){this.tileManager.update(t,n),this._renderableTilesKeys=[];const o={};for(const h of Ht(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n,calculateTileZoom:this.tileManager._source.calculateTileZoom}))o[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.terrainRttPosMatrix32f=new Float64Array(16),s.c7(h.terrainRttPosMatrix32f,0,s.a5,s.a5,0,0,1),this._tiles[h.key]=new ht(h,this.tileSize),this._lastTilesetChange=he());for(const h in this._tiles)o[h]||delete this._tiles[h]}freeRtt(t){for(const n in this._tiles){const o=this._tiles[n];(!t||o.tileID.equals(t)||o.tileID.isChildOf(t)||t.isChildOf(o.tileID))&&(o.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,n){return n?this._getTerrainCoordsForTileRanges(t,n):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const n={};for(const o of this._renderableTilesKeys){const h=this._tiles[o].tileID,_=t.clone(),w=s.bk();if(h.canonical.equals(t.canonical))s.c7(w,0,s.a5,s.a5,0,0,1);else if(h.canonical.isChildOf(t.canonical)){const A=h.canonical.z-t.canonical.z,M=h.canonical.x-(h.canonical.x>>A<<A),z=h.canonical.y-(h.canonical.y>>A<<A),O=s.a5>>A;s.c7(w,0,O,O,0,0,1),s.O(w,w,[-M*O,-z*O,0])}else{if(!t.canonical.isChildOf(h.canonical))continue;{const A=t.canonical.z-h.canonical.z,M=t.canonical.x-(t.canonical.x>>A<<A),z=t.canonical.y-(t.canonical.y>>A<<A),O=s.a5>>A;s.c7(w,0,s.a5,s.a5,0,0,1),s.O(w,w,[M*O,z*O,0]),s.Q(w,w,[1/2**A,1/2**A,0])}}_.terrainRttPosMatrix32f=new Float32Array(w),n[o]=_}return n}_getTerrainCoordsForTileRanges(t,n){const o={};for(const h of this._renderableTilesKeys){const _=this._tiles[h].tileID;if(!this._isWithinTileRanges(_,n))continue;const w=t.clone(),A=s.bk();if(_.canonical.z===t.canonical.z){const M=t.canonical.x-_.canonical.x+t.wrap*(1<<t.canonical.z),z=t.canonical.y-_.canonical.y;s.c7(A,0,s.a5,s.a5,0,0,1),s.O(A,A,[M*s.a5,z*s.a5,0])}else if(_.canonical.z>t.canonical.z){const M=_.canonical.z-t.canonical.z,z=_.canonical.x-(_.canonical.x>>M<<M)+t.wrap*(1<<_.canonical.z),O=_.canonical.y-(_.canonical.y>>M<<M),$=t.canonical.x-(_.canonical.x>>M),G=t.canonical.y-(_.canonical.y>>M),J=s.a5>>M;s.c7(A,0,J,J,0,0,1),s.O(A,A,[-z*J+$*s.a5,-O*J+G*s.a5,0])}else{const M=t.canonical.z-_.canonical.z,z=t.canonical.x-(t.canonical.x>>M<<M)+t.wrap*(1<<t.canonical.z),O=t.canonical.y-(t.canonical.y>>M<<M),$=(t.canonical.x>>M)-_.canonical.x,G=(t.canonical.y>>M)-_.canonical.y,J=s.a5<<M;s.c7(A,0,J,J,0,0,1),s.O(A,A,[z*s.a5+$*J,O*s.a5+G*J,0])}w.terrainRttPosMatrix32f=new Float32Array(A),o[h]=w}return o}getSourceTile(t,n){const o=this.tileManager._source;let h=t.overscaledZ-this.deltaZoom;if(h>o.maxzoom&&(h=o.maxzoom),h<o.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(h).key);let _=this.findTileInCaches(this._sourceTileCache[t.key]);if(!_?.dem&&n)for(;h>=o.minzoom&&!_?.dem;)_=this.findTileInCaches(t.scaledTo(h--).key);return _}findTileInCaches(t){let n=this.tileManager.getTileByID(t);return n||(n=this.tileManager._outOfViewCache.getByKey(t),n)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,n){const o=n[t.canonical.z];return!!o&&(t.wrap>o.minWrap||t.wrap<o.maxWrap||t.canonical.x>=o.minTileXWrapped&&t.canonical.x<=o.maxTileXWrapped&&t.canonical.y>=o.minTileY&&t.canonical.y<=o.maxTileY)}}class fi{constructor(t,n,o){this._meshCache={},this.painter=t,this.tileManager=new Ii(n),this.options=o,this.exaggeration=typeof o.exaggeration=="number"?o.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,n,o,h=s.a5){var _;if(!(n>=0&&n<h&&o>=0&&o<h))return 0;const w=this.getTerrainData(t),A=(_=w.tile)===null||_===void 0?void 0:_.dem;if(!A)return 0;const M=s.cD([],[n/h*s.a5,o/h*s.a5],w.u_terrain_matrix),z=[M[0]*A.dim,M[1]*A.dim],O=Math.floor(z[0]),$=Math.floor(z[1]),G=z[0]-O,J=z[1]-$;return A.get(O,$)*(1-G)*(1-J)+A.get(O+1,$)*G*(1-J)+A.get(O,$+1)*(1-G)*J+A.get(O+1,$+1)*G*J}getElevationForLngLatZoom(t,n){if(!s.cE(n,t.wrap()))return 0;const{tileID:o,mercatorX:h,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(t,n);return this.getElevation(o,h%s.a5,_%s.a5,s.a5)}getElevationForLngLat(t,n){const o=Ht(n,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let h=0;for(const _ of o)_.canonical.z>h&&(h=Math.min(_.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,h)}getElevation(t,n,o,h=s.a5){return this.getDEMElevation(t,n,o,h)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const h=this.painter.context,_=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new s.T(h,_,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new s.T(h,new s.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.ar([])}const n=this.tileManager.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const h=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new s.T(h,n.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),n.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const o=n&&n.toString()+n.tileID.key+t.key;if(o&&!this._demMatrixCache[o]){const h=this.tileManager.getSource().maxzoom;let _=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=h?_=t.canonical.z-h:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=t.canonical.x-(t.canonical.x>>_<<_),A=t.canonical.y-(t.canonical.y>>_<<_),M=s.cF(new Float64Array(16),[1/(s.a5<<_),1/(s.a5<<_),0]);s.O(M,M,[w*s.a5,A*s.a5,0]),this._demMatrixCache[t.key]={matrix:M,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:o?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(t){const n=this.painter,o=n.width/devicePixelRatio,h=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===o&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new s.T(n.context,{width:o,height:h,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new s.T(n.context,{width:o,height:h,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(o,h,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,o,h))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,w=0;_<this._coordsTextureSize;_++)for(let A=0;A<this._coordsTextureSize;A++,w+=4)n[w+0]=255&A,n[w+1]=255&_,n[w+2]=A>>8<<4|_>>8,n[w+3]=0;const o=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),h=new s.T(t,o,t.gl.RGBA,{premultiply:!1});return h.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),o=this.painter.context,h=o.gl,_=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),w=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),A=Math.round(this.painter.height/devicePixelRatio);o.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(_,A-w-1,1,1,h.RGBA,h.UNSIGNED_BYTE,n),o.bindFramebuffer.set(null);const M=n[0]+(n[2]>>4<<8),z=n[1]+((15&n[2])<<8),O=this.coordsIndex[255-n[3]],$=O&&this.tileManager.getTileByID(O);if(!$)return null;const G=this._coordsTextureSize,J=(1<<$.tileID.canonical.z)*G;return new s.a9(($.tileID.canonical.x*G+M)/J+$.tileID.wrap,($.tileID.canonical.y*G+z)/J,this.getElevation($.tileID,M,z,G))}depthAtPoint(t){const n=new Uint8Array(4),o=this.painter.context,h=o.gl;return o.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,n),o.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(t){var n;const o=((n=this.painter.style.projection)===null||n===void 0?void 0:n.transitionState)>0,h=o&&t.canonical.y===0,_=o&&t.canonical.y===(1<<t.canonical.z)-1,w=`m_${h?"n":""}_${_?"s":""}`;if(this._meshCache[w])return this._meshCache[w];const A=this.painter.context,M=new s.cG,z=new s.aY,O=this.meshSize,$=s.a5/O,G=O*O;for(let qe=0;qe<=O;qe++)for(let lt=0;lt<=O;lt++)M.emplaceBack(lt*$,qe*$,0);for(let qe=0;qe<G;qe+=O+1)for(let lt=0;lt<O;lt++)z.emplaceBack(lt+qe,O+lt+qe+1,O+lt+qe+2),z.emplaceBack(lt+qe,O+lt+qe+2,lt+qe+1);const J=M.length,ce=J+(O+1),be=(O+1)*O,Te=h?s.br:0,Se=h?0:1,Me=_?s.bs:s.a5,He=_?0:1;for(let qe=0;qe<=O;qe++)M.emplaceBack(qe*$,Te,Se);for(let qe=0;qe<=O;qe++)M.emplaceBack(qe*$,Me,He);for(let qe=0;qe<O;qe++)z.emplaceBack(be+qe,ce+qe,ce+qe+1),z.emplaceBack(be+qe,ce+qe+1,be+qe+1),z.emplaceBack(0+qe,J+qe+1,J+qe),z.emplaceBack(0+qe,0+qe+1,J+qe+1);const Ee=M.length,Xe=Ee+2*(O+1);for(const qe of[0,1])for(let lt=0;lt<=O;lt++)for(const At of[0,1])M.emplaceBack(qe*s.a5,lt*$,At);for(let qe=0;qe<2*O;qe+=2)z.emplaceBack(Ee+qe,Ee+qe+1,Ee+qe+3),z.emplaceBack(Ee+qe,Ee+qe+3,Ee+qe+2),z.emplaceBack(Xe+qe,Xe+qe+3,Xe+qe+1),z.emplaceBack(Xe+qe,Xe+qe+2,Xe+qe+3);const et=new wi(A.createVertexBuffer(M,Ds.members),A.createIndexBuffer(z),s.aX.simpleSegment(0,0,M.length,z.length));return this._meshCache[w]=et,et}getMeshFrameDelta(t){return 2*Math.PI*s.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,n){var o;if(!s.cE(n,t.wrap()))return 0;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(t,n);return(o=this.getMinMaxElevation(h).minElevation)!==null&&o!==void 0?o:0}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,o={minElevation:null,maxElevation:null};return n&&n.dem&&(o.minElevation=n.dem.min*this.exaggeration,o.maxElevation=n.dem.max*this.exaggeration),o}_getOverscaledTileIDFromLngLatZoom(t,n){const o=s.a9.fromLngLat(t.wrap()),h=(1<<n)*s.a5,_=o.x*h,w=o.y*h,A=Math.floor(_/s.a5),M=Math.floor(w/s.a5);return{tileID:new s.a2(n,0,n,A,M),mercatorX:_,mercatorY:w}}}class xi{constructor(t,n,o){this._context=t,this._size=n,this._tileSize=o,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),o=new s.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return o.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(o.texture),{id:t,fbo:n,texture:o,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((n=>t.id!==n)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const Fs={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class zs{constructor(t,n){this.painter=t,this.terrain=n,this.pool=new xi(t.context,30,n.tileManager.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((o=>!t._layers[o].isHidden(n))),this._coordsAscending={};for(const o in t.tileManagers){this._coordsAscending[o]={};const h=t.tileManagers[o].getVisibleCoordinates(),_=t.tileManagers[o].getSource(),w=_ instanceof Gr?_.terrainTileRanges:null;for(const A of h){const M=this.terrain.tileManager.getTerrainCoords(A,w);for(const z in M)this._coordsAscending[o][z]||(this._coordsAscending[o][z]=[]),this._coordsAscending[o][z].push(M[z])}}this._coordsAscendingStr={};for(const o of t._order){const h=t._layers[o],_=h.source;if(Fs[h.type]&&!this._coordsAscendingStr[_]){this._coordsAscendingStr[_]={};for(const w in this._coordsAscending[_])this._coordsAscendingStr[_][w]=this._coordsAscending[_][w].map((A=>A.key)).sort().join()}}for(const o of this._renderableTiles)for(const h in this._coordsAscendingStr){const _=this._coordsAscendingStr[h][o.tileID.key];_&&_!==o.rttCoords[h]&&(o.rtt=[])}}renderLayer(t,n){if(t.isHidden(this.painter.transform.zoom))return!1;const o=Object.assign(Object.assign({},n),{isRenderingToTexture:!0}),h=t.type,_=this.painter,w=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Fs[h]&&(this._prevType&&Fs[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(t.id),!w))return!0;if(Fs[this._prevType]||Fs[h]&&w){this._prevType=h;const A=this._stacks.length-1,M=this._stacks[A]||[];for(const z of this._renderableTiles){if(this.pool.isFull()&&(ou(this.painter,this.terrain,this._rttTiles,o),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(z),z.rtt[A]){const $=this.pool.getObjectForId(z.rtt[A].id);if($.stamp===z.rtt[A].stamp){this.pool.useObject($);continue}}const O=this.pool.getOrCreateFreeObject();this.pool.useObject(O),this.pool.stampObject(O),z.rtt[A]={id:O.id,stamp:O.stamp},_.context.bindFramebuffer.set(O.fbo.framebuffer),_.context.clear({color:s.bp.transparent,stencil:0}),_.currentStencilSource=void 0;for(let $=0;$<M.length;$++){const G=_.style._layers[M[$]],J=G.source?this._coordsAscending[G.source][z.tileID.key]:[z.tileID];_.context.viewport.set([0,0,O.fbo.width,O.fbo.height]),_._renderTileClippingMasks(G,J,!0),_.renderLayer(_,_.style.tileManagers[G.source],G,J,o),G.source&&(z.rttCoords[G.source]=this._coordsAscendingStr[G.source][z.tileID.key])}}return ou(this.painter,this.terrain,this._rttTiles,o),this._rttTiles=[],this.pool.freeAllObjects(),Fs[h]}return!1}}const Tn={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Il=E,Ll={hash:!1,interactive:!0,bearingSnap:7,zoomSnap:0,attributionControl:ji,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},Cl={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class to{constructor(t,n,o=!1){this.mousedown=_=>{this.startMove(_,re.mousePos(this.element,_)),re.addEventListener(window,"mousemove",this.mousemove),re.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.move(_,re.mousePos(this.element,_))},this.mouseup=_=>{this._rotatePitchHandler.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=re.touchPos(this.element,_.targetTouches)[0],this.startMove(_,this._startPos),re.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),re.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=re.touchPos(this.element,_.targetTouches)[0],this.move(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=n;const h=new Sr;this._rotatePitchHandler=new wt({clickTolerance:3,move:(_,w)=>{const A=n.getBoundingClientRect(),M=new s.P((A.bottom-A.top)/2,(A.right-A.left)/2);return{bearingDelta:s.cy(new s.P(_.x,w.y),w,M),pitchDelta:o?-.5*(w.y-_.y):void 0}},moveStateManager:h,enable:!0,assignEvents:()=>{}}),this.map=t,re.addEventListener(n,"mousedown",this.mousedown),re.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),re.addEventListener(n,"touchcancel",this.reset)}startMove(t,n){this._rotatePitchHandler.dragStart(t,n),re.disableDrag()}move(t,n){const o=this.map,{bearingDelta:h,pitchDelta:_}=this._rotatePitchHandler.dragMove(t,n)||{};h&&o.setBearing(o.getBearing()+h),_&&o.setPitch(o.getPitch()+_)}off(){const t=this.element;re.removeEventListener(t,"mousedown",this.mousedown),re.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),re.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),re.removeEventListener(window,"touchend",this.touchend),re.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){re.enableDrag(),re.removeEventListener(window,"mousemove",this.mousemove),re.removeEventListener(window,"mouseup",this.mouseup),re.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),re.removeEventListener(window,"touchend",this.touchend)}}let ro;function zc(m,t,n,o=!1){if(o||!n.getCoveringTilesDetailsProvider().allowWorldCopies())return m?.wrap();const h=new s.V(m.lng,m.lat);if(m=new s.V(m.lng,m.lat),t){const _=new s.V(m.lng-360,m.lat),w=new s.V(m.lng+360,m.lat),A=n.locationToScreenPoint(m).distSqr(t);n.locationToScreenPoint(_).distSqr(t)<A?m=_:n.locationToScreenPoint(w).distSqr(t)<A&&(m=w)}for(;Math.abs(m.lng-n.center.lng)>180;){const _=n.locationToScreenPoint(m);if(_.x>=0&&_.y>=0&&_.x<=n.width&&_.y<=n.height)break;m.lng>n.center.lng?m.lng-=360:m.lng+=360}return m.lng!==h.lng&&n.isPointOnMapSurface(n.locationToScreenPoint(m))?m:h}const el={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ya(m,t,n){const o=m.classList;for(const h in el)o.remove(`maplibregl-${n}-anchor-${h}`);o.add(`maplibregl-${n}-anchor-${t}`)}class uc extends s.E{constructor(t){if(super(),this._onKeyPress=n=>{const o=n.code,h=n.charCode||n.keyCode;o!=="Space"&&o!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=n=>{const o=n.originalEvent.target,h=this._element;this._popup&&(o===h||h.contains(o))&&this.togglePopup()},this._update=n=>{if(!this._map)return;const o=this._map.loaded()&&!this._map.isMoving();(n?.type==="terrain"||n?.type==="render"&&!o)&&this._map.once("render",this._update),this._lngLat=zc(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),re.setTransform(this._element,`${el[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${h}`),j.frameAsync(new AbortController,this._map._ownerWindow).then((()=>{this._updateOpacity(n&&n.type==="moveend")})).catch((()=>{}))},this._onMove=n=>{if(!this._isDragging){const o=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=o}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.l("dragstart"))),this.fire(new s.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.l("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=re.create("div");const n=re.createNS("http://www.w3.org/2000/svg","svg"),o=41,h=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${o}px`),n.setAttributeNS(null,"width",`${h}px`),n.setAttributeNS(null,"viewBox",`0 0 ${h} ${o}`);const _=re.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const w=re.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const A=re.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"transform","translate(3.0, 29.0)"),A.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Se of M){const Me=re.createNS("http://www.w3.org/2000/svg","ellipse");Me.setAttributeNS(null,"opacity","0.04"),Me.setAttributeNS(null,"cx","10.5"),Me.setAttributeNS(null,"cy","5.80029008"),Me.setAttributeNS(null,"rx",Se.rx),Me.setAttributeNS(null,"ry",Se.ry),A.appendChild(Me)}const z=re.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const O=re.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(O);const $=re.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"opacity","0.25"),$.setAttributeNS(null,"fill","#000000");const G=re.createNS("http://www.w3.org/2000/svg","path");G.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),$.appendChild(G);const J=re.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"transform","translate(6.0, 7.0)"),J.setAttributeNS(null,"fill","#FFFFFF");const ce=re.createNS("http://www.w3.org/2000/svg","g");ce.setAttributeNS(null,"transform","translate(8.0, 8.0)");const be=re.createNS("http://www.w3.org/2000/svg","circle");be.setAttributeNS(null,"fill","#000000"),be.setAttributeNS(null,"opacity","0.25"),be.setAttributeNS(null,"cx","5.5"),be.setAttributeNS(null,"cy","5.5"),be.setAttributeNS(null,"r","5.4999962");const Te=re.createNS("http://www.w3.org/2000/svg","circle");Te.setAttributeNS(null,"fill","#FFFFFF"),Te.setAttributeNS(null,"cx","5.5"),Te.setAttributeNS(null,"cy","5.5"),Te.setAttributeNS(null,"r","5.4999962"),ce.appendChild(be),ce.appendChild(Te),w.appendChild(A),w.appendChild(z),w.appendChild($),w.appendChild(J),w.appendChild(ce),n.appendChild(w),n.setAttributeNS(null,"height",o*this._scale+"px"),n.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(n),this._offset=s.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(n=>{n.preventDefault()})),this._element.addEventListener("mousedown",(n=>{n.preventDefault()})),ya(this._element,this._anchor,"marker"),t&&t.className)for(const n of t.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),re.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const h=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var n,o;const h=(n=this._map)===null||n===void 0?void 0:n.terrain,_=this._map.transform.isLocationOccluded(this._lngLat);if(!h||_){const J=_?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==J&&(this._element.style.opacity=J))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const w=this._map,A=w.terrain.depthAtPoint(this._pos),M=w.terrain.getElevationForLngLat(this._lngLat,w.transform);if(w.transform.lngLatToCameraDepth(this._lngLat,M)-A<.006)return void(this._element.style.opacity=this._opacity);const z=-this._offset.y/w.transform.pixelsPerMeter,O=Math.sin(w.getPitch()*Math.PI/180)*z,$=w.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),G=w.transform.lngLatToCameraDepth(this._lngLat,M+O)-$>.006;!((o=this._popup)===null||o===void 0)&&o.isOpen()&&G&&this._popup.remove(),this._element.style.opacity=G?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,n){return(this._opacity===void 0||t===void 0&&n===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const uu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ml=0,Mo=!1;const El={maxWidth:100,unit:"metric"};function kl(m,t,n){const o=n&&n.maxWidth||100,h=m._container.clientHeight/2,_=m._container.clientWidth/2,w=m.unproject([_-o/2,h]),A=m.unproject([_+o/2,h]),M=Math.round(m.project(A).x-m.project(w).x),z=Math.min(o,M,m._container.clientWidth),O=w.distanceTo(A);if(n&&n.unit==="imperial"){const $=3.2808*O;$>5280?Eo(t,z,$/5280,m._getUIString("ScaleControl.Miles")):Eo(t,z,$,m._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Eo(t,z,O/1852,m._getUIString("ScaleControl.NauticalMiles")):O>=1e3?Eo(t,z,O/1e3,m._getUIString("ScaleControl.Kilometers")):Eo(t,z,O,m._getUIString("ScaleControl.Meters"))}function Eo(m,t,n,o){const h=(function(_){const w=Math.pow(10,`${Math.floor(_)}`.length-1);let A=_/w;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:(function(M){const z=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*z)/z})(A),w*A})(n);m.style.width=t*(h/n)+"px",m.innerHTML=`${h}&nbsp;${o}`}const Dl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0,padding:void 0},Fl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ko(m){if(m){if(typeof m=="number"){const t=Math.round(Math.abs(m)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,m),"top-left":new s.P(t,t),"top-right":new s.P(-t,t),bottom:new s.P(0,-m),"bottom-left":new s.P(t,-t),"bottom-right":new s.P(-t,-t),left:new s.P(m,0),right:new s.P(-m,0)}}if(m instanceof s.P||Array.isArray(m)){const t=s.P.convert(m);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:s.P.convert(m.center||[0,0]),top:s.P.convert(m.top||[0,0]),"top-left":s.P.convert(m["top-left"]||[0,0]),"top-right":s.P.convert(m["top-right"]||[0,0]),bottom:s.P.convert(m.bottom||[0,0]),"bottom-left":s.P.convert(m["bottom-left"]||[0,0]),"bottom-right":s.P.convert(m["bottom-right"]||[0,0]),left:s.P.convert(m.left||[0,0]),right:s.P.convert(m.right||[0,0])}}return ko(new s.P(0,0))}const Nc=E;b.AJAXError=s.cJ,b.Event=s.l,b.Evented=s.E,b.LngLat=s.V,b.MercatorCoordinate=s.a9,b.Point=s.P,b.addProtocol=s.cK,b.config=s.c,b.removeProtocol=s.cL,b.AttributionControl=cs,b.BoxZoomHandler=Tt,b.CanvasSource=ni,b.CooperativeGesturesHandler=mr,b.DoubleClickZoomHandler=mn,b.DragPanHandler=tn,b.DragRotateHandler=ci,b.EdgeInsets=ca,b.FullscreenControl=class extends s.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var t;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=n?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=re.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){re.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=re.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);re.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},b.GeoJSONSource=li,b.GeolocateControl=class extends s.E{constructor(m){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new s.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const n=new s.V(t.coords.longitude,t.coords.latitude),o=t.coords.accuracy,h=this._map.getBearing(),_=s.e({bearing:h},this.options.fitBoundsOptions),w=br.fromLngLat(n,o);this._map.fitBounds(w,_,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const n=new s.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Mo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=re.create("button","maplibregl-ctrl-geolocate",this._container),re.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=re.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new uc({element:this._dotElement}),this._circleElement=re.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new uc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(n=>{const o=n?.[0]instanceof ResizeObserverEntry;n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.l("trackuserlocationend")),this.fire(new s.l("userlocationlostfocus")))}))}},this.options=s.e({},uu,m)}onAdd(m){return this._map=m,this._container=re.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return s._(this,arguments,void 0,(function*(t=!1){if(ro!==void 0&&!t)return ro;if(window.navigator.permissions===void 0)return ro=!!window.navigator.geolocation,ro;try{ro=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ro=!!window.navigator.geolocation}return ro}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),re.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Ml=0,Mo=!1}_isOutOfMapMaxBounds(m){const t=this._map.getMaxBounds(),n=m.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const m=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&m))return;const t=this._map.project(m),n=this._map.unproject([t.x+100,t.y]),o=m.distanceTo(n)/100,h=2*this._accuracy/o;this._circleElement.style.width=`${h.toFixed(2)}px`,this._circleElement.style.height=`${h.toFixed(2)}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ml--,Mo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.l("trackuserlocationstart")),this.fire(new s.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ml++,Ml>1?(m={maximumAge:6e5,timeout:0},Mo=!0):(m=this.options.positionOptions,Mo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},b.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;const t=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=re.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=re.create("button","maplibregl-ctrl-globe",this._container),re.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){re.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},b.Hash=Fc,b.ImageSource=Gr,b.KeyboardHandler=Kr,b.LngLatBounds=br,b.LogoControl=ys,b.Map=class extends Fi{get _ownerWindow(){var m,t;return((t=(m=this._container)===null||m===void 0?void 0:m.ownerDocument)===null||t===void 0?void 0:t.defaultView)||window}constructor(m){var t,n;s.cH.mark(s.cI.create);const o=Object.assign(Object.assign(Object.assign({},Ll),m),{canvasContextAttributes:Object.assign(Object.assign({},Ll.canvasContextAttributes),m.canvasContextAttributes)});if(o.minZoom!=null&&o.maxZoom!=null&&o.minZoom>o.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(o.minPitch!=null&&o.maxPitch!=null&&o.minPitch>o.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(o.minPitch!=null&&o.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(o.maxPitch!=null&&o.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const h=new ua,_=new Gs;o.minZoom!==void 0&&h.setMinZoom(o.minZoom),o.maxZoom!==void 0&&h.setMaxZoom(o.maxZoom),o.minPitch!==void 0&&h.setMinPitch(o.minPitch),o.maxPitch!==void 0&&h.setMaxPitch(o.maxPitch),o.renderWorldCopies!==void 0&&h.setRenderWorldCopies(o.renderWorldCopies),o.transformConstrain!==null&&h.setConstrainOverride(o.transformConstrain),super(h,_,{bearingSnap:o.bearingSnap,zoomSnap:o.zoomSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new vs,this._controls=[],this._mapId=s.af(),this._lostContextStyle={style:null,images:null},this._contextLost=A=>{A.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const M of Object.values(this.style._layers))if(M.type==="custom"&&console.warn(`Custom layer with id '${M.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),M._listeners)for(const[z]of Object.entries(M._listeners))console.warn(`Custom layer with id '${M.id}' had event listeners for event '${z}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new s.l("webglcontextlost",{originalEvent:A}))},this._contextRestored=A=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._lostContextStyle={style:null,images:null},this._setupPainter(),this.resize(),this._update(),this._resizeInternal(),this.fire(new s.l("webglcontextrestored",{originalEvent:A}))},this._onMapScroll=A=>{if(A.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=o.interactive,this._maxTileCacheSize=o.maxTileCacheSize,this._maxTileCacheZoomLevels=o.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},o.canvasContextAttributes),this._trackResize=o.trackResize===!0,this._bearingSnap=o.bearingSnap,this._zoomSnap=o.zoomSnap,this._centerClampedToGround=o.centerClampedToGround,this._refreshExpiredTiles=o.refreshExpiredTiles===!0,this._fadeDuration=o.fadeDuration,this._crossSourceCollisions=o.crossSourceCollisions===!0,this._collectResourceTiming=o.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Tn),o.locale),this._clickTolerance=o.clickTolerance,this._overridePixelRatio=o.pixelRatio,this._maxCanvasSize=o.maxCanvasSize,this._zoomLevelsToOverscale=o.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=o.transformCameraUpdate,this.transformConstrain=o.transformConstrain,this.cancelPendingTileRequestsWhileZooming=o.cancelPendingTileRequestsWhileZooming===!0,o.reduceMotion!==void 0&&(j.prefersReducedMotion=o.reduceMotion),this._imageQueueHandle=st.addThrottleControl((()=>this.isMoving())),this._requestManager=new Ze(o.transformRequest),this._container=this._resolveContainer(o.container),o.maxBounds&&this.setMaxBounds(o.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"&&(this._ownerWindow.addEventListener("online",this._onWindowOnline,!1),this._setupResizeObserver()),this.handlers=new hn(this,o),this._hash=o.hash&&new Fc(typeof o.hash=="string"&&o.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:o.center,elevation:o.elevation,zoom:o.zoom,bearing:o.bearing,pitch:o.pitch,roll:o.roll}),o.bounds&&(this.resize(),this.fitBounds(o.bounds,s.e({},o.fitBoundsOptions,{duration:0}))));const w=typeof o.style=="string"||((n=(t=o.style)===null||t===void 0?void 0:t.projection)===null||n===void 0?void 0:n.type)!=="globe";this.resize(null,w),this._localIdeographFontFamily=o.localIdeographFontFamily,this._validateStyle=o.validateStyle,o.style&&this.setStyle(o.style,{localIdeographFontFamily:o.localIdeographFontFamily}),o.attributionControl&&this.addControl(new cs(typeof o.attributionControl=="boolean"?void 0:o.attributionControl)),o.maplibreLogo&&this.addControl(new ys,o.logoPosition),this.on("style.load",(()=>{if(w||this._resizeTransform(),this.transform.unmodified){const A=s.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(A)}})),this.on("data",(A=>{this._update(A.dataType==="style"),this.fire(new s.l(`${A.dataType}data`,A))})),this.on("dataloading",(A=>{this.fire(new s.l(`${A.dataType}dataloading`,A))})),this.on("dataabort",(A=>{this.fire(new s.l("sourcedataabort",A))}))}_getMapId(){return this._mapId}setGlobalStateProperty(m,t){return this.style.setGlobalStateProperty(m,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,t){if(t===void 0&&(t=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new s.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=m.onAdd(this);this._controls.push(m);const o=this._controlPositions[t];return t.indexOf("bottom")!==-1?o.insertBefore(n,o.firstChild):o.appendChild(n),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new s.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(m);return t>-1&&this._controls.splice(t,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}coveringTiles(m){return Ht(this.transform,m)}calculateCameraOptionsFromTo(m,t,n,o){return o==null&&this.terrain&&(o=this.terrain.getElevationForLngLat(n,this.transform)),super.calculateCameraOptionsFromTo(m,t,n,o)}resize(m,t=!0){if(this._lostContextStyle.style!==null)return this;this._resizeInternal(t);const n=!this._moving;return n&&(this.stop(),this.fire(new s.l("movestart",m)).fire(new s.l("move",m))),this.fire(new s.l("resize",m)),n&&this.fire(new s.l("moveend",m)),this}_resizeInternal(m=!0){const[t,n]=this._containerDimensions(),o=this._getClampedPixelRatio(t,n);if(this._resizeCanvas(t,n,o),this.painter.resize(t,n,o),this.painter.overLimit()){const h=this.painter.context.gl;this._maxCanvasSize=[h.drawingBufferWidth,h.drawingBufferHeight];const _=this._getClampedPixelRatio(t,n);this._resizeCanvas(t,n,_),this.painter.resize(t,n,_)}this._resizeTransform(m)}_resizeTransform(m=!0){var t;const[n,o]=this._containerDimensions();this.transform.resize(n,o,m),(t=this._requestedCameraState)===null||t===void 0||t.resize(n,o,m)}_getClampedPixelRatio(m,t){const{0:n,1:o}=this._maxCanvasSize,h=this.getPixelRatio(),_=m*h,w=t*h;return Math.min(_>n?n/_:1,w>o?o/w:1)*h}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(br.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom){const t=this.transform.zoom,n=this._getTransformForUpdate();return n.setMinZoom(m),this._applyUpdatedTransform(n),this._update(),t!==this.transform.zoom&&this.fire(new s.l("zoomstart")).fire(new s.l("zoom")).fire(new s.l("zoomend")).fire(new s.l("movestart")).fire(new s.l("move")).fire(new s.l("moveend")),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom){const t=this.transform.zoom,n=this._getTransformForUpdate();return n.setMaxZoom(m),this._applyUpdatedTransform(n),this._update(),t!==this.transform.zoom&&this.fire(new s.l("zoomstart")).fire(new s.l("zoom")).fire(new s.l("zoomend")).fire(new s.l("movestart")).fire(new s.l("move")).fire(new s.l("moveend")),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch){const t=this.transform.pitch,n=this._getTransformForUpdate();return n.setMinPitch(m),this._applyUpdatedTransform(n),this._update(),t!==this.transform.pitch&&this.fire(new s.l("pitchstart")).fire(new s.l("pitch")).fire(new s.l("pitchend")).fire(new s.l("movestart")).fire(new s.l("move")).fire(new s.l("moveend")),this}throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch){const t=this.transform.pitch,n=this._getTransformForUpdate();return n.setMaxPitch(m),this._applyUpdatedTransform(n),this._update(),t!==this.transform.pitch&&this.fire(new s.l("pitchstart")).fire(new s.l("pitch")).fire(new s.l("pitchend")).fire(new s.l("movestart")).fire(new s.l("move")).fire(new s.l("moveend")),this}throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}setTransformConstrain(m){return this.transform.setConstrainOverride(m),this._update()}project(m){return this.transform.locationToScreenPoint(s.V.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(s.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,t,n){if(m==="mouseenter"||m==="mouseover"){let o=!1;return{layers:t,listener:n,delegates:{mousemove:_=>{const w=t.filter((M=>this.getLayer(M))),A=w.length!==0?this.queryRenderedFeatures(_.point,{layers:w}):[];A.length?o||(o=!0,n.call(this,new ue(m,this,_.originalEvent,{features:A}))):o=!1},mouseout:()=>{o=!1}}}}if(m==="mouseleave"||m==="mouseout"){let o=!1;return{layers:t,listener:n,delegates:{mousemove:w=>{const A=t.filter((M=>this.getLayer(M)));(A.length!==0?this.queryRenderedFeatures(w.point,{layers:A}):[]).length?o=!0:o&&(o=!1,n.call(this,new ue(m,this,w.originalEvent)))},mouseout:w=>{o&&(o=!1,n.call(this,new ue(m,this,w.originalEvent)))}}}}{const o=h=>{const _=t.filter((A=>this.getLayer(A))),w=_.length!==0?this.queryRenderedFeatures(h.point,{layers:_}):[];w.length&&(h.features=w,n.call(this,h),delete h.features)};return{layers:t,listener:n,delegates:{[m]:o}}}}_saveDelegatedListener(m,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(t)}_removeDelegatedListener(m,t,n){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const o=this._delegatedListeners[m];for(let h=0;h<o.length;h++){const _=o[h];if(_.listener===n&&_.layers.length===t.length&&_.layers.every((w=>t.includes(w)))){for(const w in _.delegates)this.off(w,_.delegates[w]);return void o.splice(h,1)}}}on(m,t,n){if(n===void 0)return super.on(m,t);const o=typeof t=="string"?[t]:t,h=this._createDelegatedListener(m,o,n);this._saveDelegatedListener(m,h);for(const _ in h.delegates)this.on(_,h.delegates[_]);return{unsubscribe:()=>{this._removeDelegatedListener(m,o,n)}}}once(m,t,n){if(n===void 0)return super.once(m,t);const o=typeof t=="string"?[t]:t,h=this._createDelegatedListener(m,o,n);for(const _ in h.delegates){const w=h.delegates[_];h.delegates[_]=(...A)=>{this._removeDelegatedListener(m,o,n),w(...A)}}this._saveDelegatedListener(m,h);for(const _ in h.delegates)this.once(_,h.delegates[_]);return this}off(m,t,n){return n===void 0?super.off(m,t):(this._removeDelegatedListener(m,typeof t=="string"?[t]:t,n),this)}queryRenderedFeatures(m,t){if(!this.style)return[];let n;const o=m instanceof s.P||Array.isArray(m),h=o?m:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(o?{}:m)||{},h instanceof s.P||typeof h[0]=="number")n=[s.P.convert(h)];else{const _=s.P.convert(h[0]),w=s.P.convert(h[1]);n=[_,new s.P(w.x,_.y),w,new s.P(_.x,w.y),_]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(m,t){return this.style.querySourceFeatures(m,t)}setStyle(m,t){return(t=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(m,t))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const t=this._locale[m];if(t==null)throw new Error(`Missing UI string '${m}'`);return t}_updateStyle(m,t){var n,o;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(m,t)));const h=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new Qi(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,t,h):this.style.loadJSON(m,t,h),this):((o=(n=this.style)===null||n===void 0?void 0:n.projection)===null||o===void 0||o.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Qi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,t){if(typeof m=="string"){const n=this._requestManager.transformRequest(m,"Style");s.j(n,new AbortController).then((o=>{this._updateDiff(o.data,t)})).catch((o=>{o&&this.fire(new s.k(o))}))}else typeof m=="object"&&this._updateDiff(m,t)}_updateDiff(m,t){try{this.style.setState(m,t)&&this._update(!0)}catch(n){s.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(m,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(m,t){return this._lazyInitEmptyStyle(),this.style.addSource(m,t),this._update(!0)}isSourceLoaded(m){const t=this.style&&this.style.tileManagers[m];if(t!==void 0)return t.loaded();this.fire(new s.k(new Error(`There is no tile manager with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const t=this.style.tileManagers[m.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&t.reload();for(const n in this.style._layers){const o=this.style._layers[n];o.type==="hillshade"&&o.source===m.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),o.type==="color-relief"&&o.source===m.source&&s.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new fi(this.painter,t,m),this.painter.renderToTexture=new zs(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=n=>{var o;n.dataType==="style"?this.terrain.tileManager.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((o=n.source)===null||o===void 0?void 0:o.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new s.l("terrain",{terrain:m})),this}getTerrain(){var m,t;return(t=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const m=this.style&&this.style.tileManagers;for(const t of Object.values(m))if(!t.areTilesLoaded())return!1;return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,t,n){if(n){const o=this.getSource(n);if(!o)throw new Error(`There is no source with ID "${n}", cannot set LOD parameters`);o.calculateTileZoom=dt(Math.max(1,m),Math.max(1,t))}else for(const o in this.style.tileManagers)this.style.tileManagers[o].getSource().calculateTileZoom=dt(Math.max(1,m),Math.max(1,t));return this._update(!0),this}refreshTiles(m,t){const n=this.style.tileManagers[m];if(!n)throw new Error(`There is no tile manager with ID "${m}", cannot refresh tile`);t===void 0?n.reload(!0):n.refreshTiles(t.map((o=>new s.ac(o.z,o.x,o.y))))}addImage(m,t,n={}){const{pixelRatio:o=1,sdf:h=!1,stretchX:_,stretchY:w,content:A,textFitWidth:M,textFitHeight:z}=n;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||s.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:O,height:$,data:G}=t,J=t;return this.style.addImage(m,{data:new s.R({width:O,height:$},new Uint8Array(G)),pixelRatio:o,stretchX:_,stretchY:w,content:A,textFitWidth:M,textFitHeight:z,sdf:h,version:0,userImage:J}),J.onAdd&&J.onAdd(this,m),this}}{const{width:O,height:$,data:G}=j.getImageData(t);this.style.addImage(m,{data:new s.R({width:O,height:$},G),pixelRatio:o,stretchX:_,stretchY:w,content:A,textFitWidth:M,textFitHeight:z,sdf:h,version:0})}}updateImage(m,t){const n=this.style.getImage(m);if(!n)return this.fire(new s.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const o=t instanceof HTMLImageElement||s.b(t)?j.getImageData(t):t,{width:h,height:_,data:w}=o;if(h===void 0||_===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==n.data.width||_!==n.data.height)return this.fire(new s.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const A=!(t instanceof HTMLImageElement||s.b(t));return n.data.replace(w,A),this.style.updateImage(m,n),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new s.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return st.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,t){return this._lazyInitEmptyStyle(),this.style.addLayer(m,t),this._update(!0)}moveLayer(m,t){return this.style.moveLayer(m,t),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,t,n){return this.style.setLayerZoomRange(m,t,n),this._update(!0)}setFilter(m,t,n={}){return this.style.setFilter(m,t,n),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,t,n,o={}){return this.style.setPaintProperty(m,t,n,o),this._update(!0)}getPaintProperty(m,t){return this.style.getPaintProperty(m,t)}setLayoutProperty(m,t,n,o={}){return this.style.setLayoutProperty(m,t,n,o),this._update(!0)}getLayoutProperty(m,t){return this.style.getLayoutProperty(m,t)}setGlyphs(m,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,t,n,(o=>{o||this._update(!0)})),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,t,(n=>{n||this._update(!0)})),this}setLight(m,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,t){return this.style.setFeatureState(m,t),this._update()}removeFeatureState(m,t){return this.style.removeFeatureState(m,t),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,t=0;return this._container&&(m=this._container.clientWidth||400,t=this._container.clientHeight||300),[m,t]}_setupResizeObserver(){var m;let t=!1;const n=cu((h=>{this._trackResize&&!this._removed&&(this.resize(h),this.redraw())}),50),o=(m=this._ownerWindow.ResizeObserver)!==null&&m!==void 0?m:ResizeObserver;this._resizeObserver=new o((h=>{t?n(h):t=!0})),this._resizeObserver.observe(this._container)}_resolveContainer(m){if(typeof m=="string"){const t=document.getElementById(m);if(!t)throw new Error(`Container '${m}' not found.`);return t}if(m instanceof HTMLElement||m&&typeof m=="object"&&m.nodeType===1)return m;throw new Error("Invalid type: 'container' must be a String or HTMLElement.")}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const t=this._canvasContainer=re.create("div","maplibregl-canvas-container",m);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=re.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),o=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],o);const h=this._controlContainer=re.create("div","maplibregl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((w=>{_[w]=re.create("div",`maplibregl-ctrl-${w} `,h)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,t,n){this._canvas.width=Math.floor(n*m),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(o=>{t={requestedAttributes:m},o&&(t.statusMessage=o.statusMessage,t.type=o.type)}),{once:!0});let n=null;if(n=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!n){const o="Failed to initialize WebGL";throw t?(t.message=o,new Error(JSON.stringify(t))):new Error(o)}this.painter=new ku(n,this.transform),ye.testSupport(n)}migrateProjection(m,t){super.migrateProjection(m,t),this.painter.transform=m,this.fire(new s.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var t,n,o,h,_;const w=this._idleTriggered?this._fadeDuration:0,A=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let M=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const $=this.transform.zoom,G=he();this.style.zoomHistory.update($,G);const J=new s.H($,{now:G,fadeDuration:w,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ce=J.crossFadingFactor();ce===1&&ce===this._crossFadingFactor||(M=!0,this._crossFadingFactor=ce),this.style.update(J)}const z=((n=this.style.projection)===null||n===void 0?void 0:n.transitionState)>0!==A;(o=this.style.projection)===null||o===void 0||o.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((h=this.style.projection)===null||h===void 0?void 0:h.transitionState,(_=this.style.projection)===null||_===void 0?void 0:_.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||z)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,z),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,showPadding:this.showPadding}),this.fire(new s.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.cH.mark(s.cI.load),this.fire(new s.l("load"))),this.style&&(this.style.hasTransitions()||M)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const O=this._sourcesDirty||this._styleDirty||this._placementDirty;return O||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.l("idle")),!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,s.cH.mark(s.cI.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&this._ownerWindow.removeEventListener("online",this._onWindowOnline,!1),st.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),re.remove(this._canvasContainer),re.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),s.cH.clearMetrics(),this._removed=!0,this.fire(new s.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,j.frame(this._frameRequest,(m=>{s.cH.frame(m),this._frameRequest=null;try{this._render(m)}catch(t){if(!s.Z(t)&&!(function(n){return n.message===Lc})(t))throw t}}),(()=>{}),this._ownerWindow))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Il}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},b.MapMouseEvent=ue,b.MapTouchEvent=me,b.MapWheelEvent=ve,b.Marker=uc,b.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const t=this._map.getZoom(),n=t===this._map.getMaxZoom(),o=t===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,n)=>{const o=this._map._getUIString(`NavigationControl.${n}`);t.title=o,t.setAttribute("aria-label",o)},this.options=s.e({},Cl,m),this._container=re.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),re.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),re.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=re.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new to(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){re.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,t){const n=re.create("button",m,this._container);return n.type="button",n.addEventListener("click",t),n}},b.Popup=class extends s.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&re.remove(this._content),this._container&&(re.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=re.create("div","maplibregl-popup",this._map.getContainer()),this._tip=re.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=zc(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const n=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let o=this.options.anchor;const h=ko(this.options.offset);if(!o){const w=this._container.offsetWidth,A=this._container.offsetHeight,M=(function(O){var $,G,J,ce;return O?{top:($=O.top)!==null&&$!==void 0?$:0,right:(G=O.right)!==null&&G!==void 0?G:0,bottom:(J=O.bottom)!==null&&J!==void 0?J:0,left:(ce=O.left)!==null&&ce!==void 0?ce:0}:{top:0,right:0,bottom:0,left:0}})(this.options.padding);let z;z=n.y+h.bottom.y<A+M.top?["top"]:n.y>this._map.transform.height-A-M.bottom?["bottom"]:[],n.x<w/2+M.left?z.push("left"):n.x>this._map.transform.width-w/2-M.right&&z.push("right"),o=z.length===0?"bottom":z.join("-")}let _=n.add(h[o]);this.options.subpixelPositioning||(_=_.round()),re.setTransform(this._container,`${el[o]} translate(${_.x}px,${_.y}px)`),ya(this._container,o,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(Dl),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=s.V.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const t=document.createDocumentFragment(),n=document.createElement("body");let o;for(n.innerHTML=m;o=n.firstChild,o;)t.appendChild(o);return this.setDOMContent(t)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=re.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}setPadding(m){this.options.padding=m,this._update()}_createCloseButton(){this.options.closeButton&&(this._closeButton=re.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Fl);m&&m.focus()}},b.RasterDEMTileSource=yr,b.RasterTileSource=zr,b.ScaleControl=class{constructor(m){this._onMove=()=>{kl(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,kl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},El),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=re.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){re.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},b.ScrollZoomHandler=Rn,b.Style=Qi,b.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=re.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=re.create("button","maplibregl-ctrl-terrain",this._container),re.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){re.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},b.TwoFingersTouchPitchHandler=pi,b.TwoFingersTouchRotateHandler=en,b.TwoFingersTouchZoomHandler=Ir,b.TwoFingersTouchZoomRotateHandler=gn,b.VectorTileSource=Yt,b.VideoSource=Vr,b.addSourceType=(m,t)=>s._(void 0,void 0,void 0,(function*(){if(xr(m))throw new Error(`A source type called "${m}" already exists.`);((n,o)=>{ei[n]=o})(m,t)})),b.clearPrewarmedResources=function(){const m=ut;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(We),ut=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},b.createTileMesh=N,b.getMaxParallelImageRequests=function(){return s.c.MAX_PARALLEL_IMAGE_REQUESTS},b.getRTLTextPluginStatus=function(){return se().getRTLTextPluginStatus()},b.getVersion=function(){return Nc},b.getWorkerCount=function(){return tt.workerCount},b.getWorkerUrl=function(){return s.c.WORKER_URL},b.importScriptInWorkers=function(m){return Zt().broadcast("IS",m)},b.isTimeFrozen=function(){return Ie.isFrozen()},b.now=he,b.prewarm=function(){It().acquire(We)},b.restoreNow=function(){Ie.restoreNow()},b.setMaxParallelImageRequests=function(m){s.c.MAX_PARALLEL_IMAGE_REQUESTS=m},b.setNow=function(m){Ie.setNow(m)},b.setRTLTextPlugin=function(m,t){return se().setRTLTextPlugin(m,t)},b.setWorkerCount=function(m){tt.workerCount=m},b.setWorkerUrl=function(m){s.c.WORKER_URL=m}}));var x=u;return x}))})(Rd)),Rd.exports}var Wy=Db();const rh=$y(Wy);function tp(p,l,u,g){function v(x){return x instanceof u?x:new u(function(b){b(x)})}return new(u||(u=Promise))(function(x,b){function s(B){try{F(g.next(B))}catch(Q){b(Q)}}function E(B){try{F(g.throw(B))}catch(Q){b(Q)}}function F(B){B.done?x(B.value):v(B.value).then(s,E)}F((g=g.apply(p,l||[])).next())})}var Pd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jd(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var rp,m_;function Hy(){if(m_)return rp;m_=1,rp=l;var p=Object.prototype.hasOwnProperty;function l(){for(var u={},g=0;g<arguments.length;g++){var v=arguments[g];for(var x in v)p.call(v,x)&&(u[x]=v[x])}return u}return rp}var ip={exports:{}},g_;function Fb(){return g_||(g_=1,(function(p,l){(function(){var u={};p.exports=u,u.simpleFilter=function(g,v){return v.filter(function(x){return u.test(g,x)})},u.test=function(g,v){return u.match(g,v)!==null},u.match=function(g,v,x){x=x||{};var b=0,s=[],E=v.length,F=0,B=0,Q=x.pre||"",ne=x.post||"",j=x.caseSensitive&&v||v.toLowerCase(),Ie;g=x.caseSensitive&&g||g.toLowerCase();for(var he=0;he<E;he++)Ie=v[he],j[he]===g[b]?(Ie=Q+Ie+ne,b+=1,B+=1+B):B=0,F+=B,s[s.length]=Ie;return b===g.length?(F=j===g?1/0:F,{rendered:s.join(""),score:F}):null},u.filter=function(g,v,x){return!v||v.length===0?[]:typeof g!="string"?v:(x=x||{},v.reduce(function(b,s,E,F){var B=s;x.extract&&(B=x.extract(s));var Q=u.match(g,B,x);return Q!=null&&(b[b.length]={string:Q.rendered,score:Q.score,index:E,original:s}),b},[]).sort(function(b,s){var E=s.score-b.score;return E||b.index-s.index}))}})()})(ip)),ip.exports}var np,__;function zb(){if(__)return np;__=1;var p=function(l){return this.component=l,this.items=[],this.active=l.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,l.el.parentNode.insertBefore(this.wrapper,l.el.nextSibling),this};return p.prototype.show=function(){this.element.style.display="block"},p.prototype.hide=function(){this.element.style.display="none"},p.prototype.add=function(l){this.items.push(l)},p.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0},p.prototype.isEmpty=function(){return!this.items.length},p.prototype.isVisible=function(){return this.element.style.display==="block"},p.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var l=0;l<this.items.length;l++)this.drawItem(this.items[l],this.active===l);this.show()},p.prototype.drawItem=function(l,u){var g=document.createElement("li"),v=document.createElement("a");u&&(g.className+=" active"),v.innerHTML=l.string,g.appendChild(v),this.element.appendChild(g),g.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),g.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,l)}).bind(this))},p.prototype.handleMouseUp=function(l){this.selectingListItem=!1,this.component.value(l.original),this.clear(),this.draw()},p.prototype.move=function(l){this.active=l,this.draw()},p.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)},p.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)},p.prototype.drawError=function(l){var u=document.createElement("li");u.innerHTML=l,this.element.appendChild(u),this.show()},np=p,np}var sp,y_;function Nb(){if(y_)return sp;y_=1;var p=Hy(),l=Fb(),u=zb(),g=function(v,x,b){return b=b||{},this.options=p({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},b),this.el=v,this.data=x||[],this.list=new u(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(s){this.handleKeyUp(s.keyCode,s)}).bind(this),!1),this.el.addEventListener("keydown",(function(s){this.handleKeyDown(s)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(s){this.handlePaste(s)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};return g.prototype.handleKeyUp=function(v,x){if(!(v===40||v===38||v===27||v===9)){if(v===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),x.stopPropagation());return}this.handleInputChange(this.el.value)}},g.prototype.handleKeyDown=function(v){switch(v.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&v.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},g.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},g.prototype.handlePaste=function(v){if(v.clipboardData)this.handleInputChange(v.clipboardData.getData("Text"));else{var x=this;setTimeout(function(){x.handleInputChange(v.target.value)},100)}},g.prototype.handleInputChange=function(v){if(this.query=this.normalize(v),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(x){for(var b=0;b<x.length&&(this.list.add(x[b]),b!==this.options.limit-1);b++);this.list.draw()}).bind(this))},g.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},g.prototype.update=function(v){this.data=v,this.handleKeyUp()},g.prototype.clear=function(){this.data=[],this.list.clear()},g.prototype.normalize=function(v){return v=v.toLowerCase(),v},g.prototype.match=function(v,x){return v.indexOf(x)>-1},g.prototype.value=function(v){if(this.selected=v,this.el.value=this.getItemValue(v||{place_name:this.query}),document.createEvent){var x=document.createEvent("HTMLEvents");x.initEvent("change",!0,!1),this.el.dispatchEvent(x)}else this.el.fireEvent("onchange")},g.prototype.getCandidates=function(v){var x={pre:"<strong>",post:"</strong>",extract:(function(s){return this.getItemValue(s)}).bind(this)},b;this.options.filter?(b=l.filter(this.query,this.data,x),b=b.map((function(s){return{original:s.original,string:this.render(s.original,s.string)}}).bind(this))):b=this.data.map((function(s){var E=this.render(s);return{original:s,string:E}}).bind(this)),v(b)},g.prototype.getItemValue=function(v){return v},g.prototype.render=function(v,x){if(x)return x;for(var b=v.original?this.getItemValue(v.original):this.getItemValue(v),s=this.normalize(b),E=s.lastIndexOf(this.query);E>-1;){var F=E+this.query.length;b=b.slice(0,E)+"<strong>"+b.slice(E,F)+"</strong>"+b.slice(F),E=s.slice(0,E).lastIndexOf(this.query)}return b},g.prototype.renderError=function(v){this.list.drawError(v)},sp=g,sp}var ap,v_;function Rb(){if(v_)return ap;v_=1;var p=Nb();return ap=p,typeof window<"u"&&(window.Suggestions=p),ap}var Bb=Rb(),Ob=Jd(Bb),Bd={exports:{}},jb=Bd.exports,b_;function Vb(){return b_||(b_=1,(function(p){(function(l,u,g){p.exports?p.exports=g():l[u]=g()})(jb,"subtag",function(){var l="",u=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function g(E){return E.match(u)||[]}function v(E){return g(E).filter(function(F,B){return F&&B})}function x(E){return E=g(E),{language:E[1]||l,extlang:E[2]||l,script:E[3]||l,region:E[4]||l}}function b(E,F,B){Object.defineProperty(E,F,{value:B,enumerable:!0})}function s(E,F,B){function Q(ne){return g(ne)[E]||l}b(Q,"pattern",F),b(x,B,Q)}return s(1,/^[a-zA-Z]{2,3}$/,"language"),s(2,/^[a-zA-Z]{3}$/,"extlang"),s(3,/^[a-zA-Z]{4}$/,"script"),s(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),b(x,"split",v),x})})(Bd)),Bd.exports}var Ub=Vb(),qb=Jd(Ub),op,x_;function Gb(){if(x_)return op;x_=1;var p="Expected a function",l=NaN,u="[object Symbol]",g=/^\s+|\s+$/g,v=/^[-+]0x[0-9a-f]+$/i,x=/^0b[01]+$/i,b=/^0o[0-7]+$/i,s=parseInt,E=typeof Pd=="object"&&Pd&&Pd.Object===Object&&Pd,F=typeof self=="object"&&self&&self.Object===Object&&self,B=E||F||Function("return this")(),Q=Object.prototype,ne=Q.toString,j=Math.max,Ie=Math.min,he=function(){return B.Date.now()};function re(Ue,$e,st){var Ze,Pe,rt,_e,we,Ge,Ye=0,xt=!1,kt=!1,yt=!0;if(typeof Ue!="function")throw new TypeError(p);$e=De($e)||0,ye(st)&&(xt=!!st.leading,kt="maxWait"in st,rt=kt?j(De(st.maxWait)||0,$e):rt,yt="trailing"in st?!!st.trailing:yt);function mt(ut){var ft=Ze,It=Pe;return Ze=Pe=void 0,Ye=ut,_e=Ue.apply(It,ft),_e}function gt(ut){return Ye=ut,we=setTimeout(fe,$e),xt?mt(ut):_e}function Qt(ut){var ft=ut-Ge,It=ut-Ye,zt=$e-ft;return kt?Ie(zt,rt-It):zt}function Vt(ut){var ft=ut-Ge,It=ut-Ye;return Ge===void 0||ft>=$e||ft<0||kt&&It>=rt}function fe(){var ut=he();if(Vt(ut))return Fe(ut);we=setTimeout(fe,Qt(ut))}function Fe(ut){return we=void 0,yt&&Ze?mt(ut):(Ze=Pe=void 0,_e)}function We(){we!==void 0&&clearTimeout(we),Ye=0,Ze=Ge=Pe=we=void 0}function tt(){return we===void 0?_e:Fe(he())}function nt(){var ut=he(),ft=Vt(ut);if(Ze=arguments,Pe=this,Ge=ut,ft){if(we===void 0)return gt(Ge);if(kt)return we=setTimeout(fe,$e),mt(Ge)}return we===void 0&&(we=setTimeout(fe,$e)),_e}return nt.cancel=We,nt.flush=tt,nt}function ye(Ue){var $e=typeof Ue;return!!Ue&&($e=="object"||$e=="function")}function Je(Ue){return!!Ue&&typeof Ue=="object"}function Be(Ue){return typeof Ue=="symbol"||Je(Ue)&&ne.call(Ue)==u}function De(Ue){if(typeof Ue=="number")return Ue;if(Be(Ue))return l;if(ye(Ue)){var $e=typeof Ue.valueOf=="function"?Ue.valueOf():Ue;Ue=ye($e)?$e+"":$e}if(typeof Ue!="string")return Ue===0?Ue:+Ue;Ue=Ue.replace(g,"");var st=x.test(Ue);return st||b.test(Ue)?s(Ue.slice(2),st?2:8):v.test(Ue)?l:+Ue}return op=re,op}var $b=Gb(),Zb=Jd($b),Wb=Hy(),ol=Jd(Wb),Ad={exports:{}},w_;function Hb(){if(w_)return Ad.exports;w_=1;var p=typeof Reflect=="object"?Reflect:null,l=p&&typeof p.apply=="function"?p.apply:function(Ue,$e,st){return Function.prototype.apply.call(Ue,$e,st)},u;p&&typeof p.ownKeys=="function"?u=p.ownKeys:Object.getOwnPropertySymbols?u=function(Ue){return Object.getOwnPropertyNames(Ue).concat(Object.getOwnPropertySymbols(Ue))}:u=function(Ue){return Object.getOwnPropertyNames(Ue)};function g(De){console&&console.warn&&console.warn(De)}var v=Number.isNaN||function(Ue){return Ue!==Ue};function x(){x.init.call(this)}Ad.exports=x,Ad.exports.once=ye,x.EventEmitter=x,x.prototype._events=void 0,x.prototype._eventsCount=0,x.prototype._maxListeners=void 0;var b=10;function s(De){if(typeof De!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof De)}Object.defineProperty(x,"defaultMaxListeners",{enumerable:!0,get:function(){return b},set:function(De){if(typeof De!="number"||De<0||v(De))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+De+".");b=De}}),x.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},x.prototype.setMaxListeners=function(Ue){if(typeof Ue!="number"||Ue<0||v(Ue))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Ue+".");return this._maxListeners=Ue,this};function E(De){return De._maxListeners===void 0?x.defaultMaxListeners:De._maxListeners}x.prototype.getMaxListeners=function(){return E(this)},x.prototype.emit=function(Ue){for(var $e=[],st=1;st<arguments.length;st++)$e.push(arguments[st]);var Ze=Ue==="error",Pe=this._events;if(Pe!==void 0)Ze=Ze&&Pe.error===void 0;else if(!Ze)return!1;if(Ze){var rt;if($e.length>0&&(rt=$e[0]),rt instanceof Error)throw rt;var _e=new Error("Unhandled error."+(rt?" ("+rt.message+")":""));throw _e.context=rt,_e}var we=Pe[Ue];if(we===void 0)return!1;if(typeof we=="function")l(we,this,$e);else for(var Ge=we.length,Ye=Ie(we,Ge),st=0;st<Ge;++st)l(Ye[st],this,$e);return!0};function F(De,Ue,$e,st){var Ze,Pe,rt;if(s($e),Pe=De._events,Pe===void 0?(Pe=De._events=Object.create(null),De._eventsCount=0):(Pe.newListener!==void 0&&(De.emit("newListener",Ue,$e.listener?$e.listener:$e),Pe=De._events),rt=Pe[Ue]),rt===void 0)rt=Pe[Ue]=$e,++De._eventsCount;else if(typeof rt=="function"?rt=Pe[Ue]=st?[$e,rt]:[rt,$e]:st?rt.unshift($e):rt.push($e),Ze=E(De),Ze>0&&rt.length>Ze&&!rt.warned){rt.warned=!0;var _e=new Error("Possible EventEmitter memory leak detected. "+rt.length+" "+String(Ue)+" listeners added. Use emitter.setMaxListeners() to increase limit");_e.name="MaxListenersExceededWarning",_e.emitter=De,_e.type=Ue,_e.count=rt.length,g(_e)}return De}x.prototype.addListener=function(Ue,$e){return F(this,Ue,$e,!1)},x.prototype.on=x.prototype.addListener,x.prototype.prependListener=function(Ue,$e){return F(this,Ue,$e,!0)};function B(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Q(De,Ue,$e){var st={fired:!1,wrapFn:void 0,target:De,type:Ue,listener:$e},Ze=B.bind(st);return Ze.listener=$e,st.wrapFn=Ze,Ze}x.prototype.once=function(Ue,$e){return s($e),this.on(Ue,Q(this,Ue,$e)),this},x.prototype.prependOnceListener=function(Ue,$e){return s($e),this.prependListener(Ue,Q(this,Ue,$e)),this},x.prototype.removeListener=function(Ue,$e){var st,Ze,Pe,rt,_e;if(s($e),Ze=this._events,Ze===void 0)return this;if(st=Ze[Ue],st===void 0)return this;if(st===$e||st.listener===$e)--this._eventsCount===0?this._events=Object.create(null):(delete Ze[Ue],Ze.removeListener&&this.emit("removeListener",Ue,st.listener||$e));else if(typeof st!="function"){for(Pe=-1,rt=st.length-1;rt>=0;rt--)if(st[rt]===$e||st[rt].listener===$e){_e=st[rt].listener,Pe=rt;break}if(Pe<0)return this;Pe===0?st.shift():he(st,Pe),st.length===1&&(Ze[Ue]=st[0]),Ze.removeListener!==void 0&&this.emit("removeListener",Ue,_e||$e)}return this},x.prototype.off=x.prototype.removeListener,x.prototype.removeAllListeners=function(Ue){var $e,st,Ze;if(st=this._events,st===void 0)return this;if(st.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):st[Ue]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete st[Ue]),this;if(arguments.length===0){var Pe=Object.keys(st),rt;for(Ze=0;Ze<Pe.length;++Ze)rt=Pe[Ze],rt!=="removeListener"&&this.removeAllListeners(rt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if($e=st[Ue],typeof $e=="function")this.removeListener(Ue,$e);else if($e!==void 0)for(Ze=$e.length-1;Ze>=0;Ze--)this.removeListener(Ue,$e[Ze]);return this};function ne(De,Ue,$e){var st=De._events;if(st===void 0)return[];var Ze=st[Ue];return Ze===void 0?[]:typeof Ze=="function"?$e?[Ze.listener||Ze]:[Ze]:$e?re(Ze):Ie(Ze,Ze.length)}x.prototype.listeners=function(Ue){return ne(this,Ue,!0)},x.prototype.rawListeners=function(Ue){return ne(this,Ue,!1)},x.listenerCount=function(De,Ue){return typeof De.listenerCount=="function"?De.listenerCount(Ue):j.call(De,Ue)},x.prototype.listenerCount=j;function j(De){var Ue=this._events;if(Ue!==void 0){var $e=Ue[De];if(typeof $e=="function")return 1;if($e!==void 0)return $e.length}return 0}x.prototype.eventNames=function(){return this._eventsCount>0?u(this._events):[]};function Ie(De,Ue){for(var $e=new Array(Ue),st=0;st<Ue;++st)$e[st]=De[st];return $e}function he(De,Ue){for(;Ue+1<De.length;Ue++)De[Ue]=De[Ue+1];De.pop()}function re(De){for(var Ue=new Array(De.length),$e=0;$e<Ue.length;++$e)Ue[$e]=De[$e].listener||De[$e];return Ue}function ye(De,Ue){return new Promise(function($e,st){function Ze(rt){De.removeListener(Ue,Pe),st(rt)}function Pe(){typeof De.removeListener=="function"&&De.removeListener("error",Ze),$e([].slice.call(arguments))}Be(De,Ue,Pe,{once:!0}),Ue!=="error"&&Je(De,Ze,{once:!0})})}function Je(De,Ue,$e){typeof De.on=="function"&&Be(De,"error",Ue,$e)}function Be(De,Ue,$e,st){if(typeof De.on=="function")st.once?De.once(Ue,$e):De.on(Ue,$e);else if(typeof De.addEventListener=="function")De.addEventListener(Ue,function Ze(Pe){st.once&&De.removeEventListener(Ue,Ze),$e(Pe)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof De)}return Ad.exports}var Xb=Hb();const S_={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},Yb={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:"",es:"Buscar"},Jb={en:"No results found",de:"Keine Ergebnisse gefunden",es:"No hay resultados",fr:"Aucun rsultat trouv"},Kb={en:"There was an error reaching the server",de:"Verbindung fehlgeschlagen",es:"Error al conectarse al servidor",fr:"Une erreur est survenue lors de la connexion au serveur"};var Nh={placeholder:Yb,errorNoResults:Jb,errorConnectionFailed:Kb};const Qb=/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/;class e2{constructor(l,u,g=(v,x,b)=>new Ob(v,x,b)){this.options={zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:void 0,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,proximityMinZoom:9,getItemValue:v=>v.text!=null?v.text:v.place_name,render:v=>{if(!("geometry"in v)){const b=v.text,s=b.toLowerCase().indexOf(this._typeahead.query.toLowerCase()),E=this._typeahead.query.length,F=b.substring(0,s),B=b.substring(s,s+E),Q=b.substring(s+E);return'<div class="maplibregl-ctrl-geocoder--suggestion"><svg class="maplibregl-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="maplibregl-ctrl-geocoder--suggestion-info"><div class="maplibregl-ctrl-geocoder--suggestion-title">'+F+'<span class="maplibregl-ctrl-geocoder--suggestion-match">'+B+"</span>"+Q+"</div></div></div>"}const x=v.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--result"><svg class="maplibregl-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="maplibregl-ctrl-geocoder--result-title">'+x[0]+'</div><div class="maplibregl-ctrl-geocoder--result-address">'+x.splice(1,x.length).join(",")+"</div></div></div>"},popupRender:v=>{const x=v.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--suggestion popup-suggestion"><div class="maplibregl-ctrl-geocoder--suggestion-title popup-suggestion-title">'+x[0]+'</div><div class="maplibregl-ctrl-geocoder--suggestion-address popup-suggestion-address">'+x.splice(1,x.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},this._eventEmitter=new Xb.EventEmitter,this.options=ol({},this.options,u),this.fresh=!0,this.lastSelected=null,this.geocoderApi=l,this.typeaheadFactory=g}addTo(l){function u(g,v){if(!document.body.contains(v))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const x=g.onAdd();v.appendChild(x)}if(l instanceof HTMLElement)u(this,l);else if(typeof l=="string"){const g=document.querySelectorAll(l);if(g.length===0)throw new Error("Element "+l+"not found.");if(g.length>1)throw new Error("Geocoder can only be added to a single html element");u(this,g[0])}else if("addControl"in l)l.addControl(this);else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")}onAdd(l){if(l&&typeof l!="string"&&(this._map=l),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);const u=this.container=document.createElement("div");u.className="maplibregl-ctrl-geocoder maplibregl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";const g=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="search",this._inputEl.className="maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",Zb(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);const v=document.createElement("div");v.classList.add("maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("type","button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="maplibregl-ctrl-geocoder--button";const x=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(x),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),v.appendChild(this._clearEl),v.appendChild(this._loadingEl),u.appendChild(g),u.appendChild(this._inputEl),u.appendChild(v),this._typeahead=this.typeaheadFactory(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.container.addEventListener("click",()=>{this._typeahead.update(this._typeahead.data)}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),u}createIcon(l,u){const g=document.createElementNS("http://www.w3.org/2000/svg","svg");if(g.setAttribute("class","maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+l),g.setAttribute("viewBox","0 0 18 18"),g.setAttribute("xml:space","preserve"),g.setAttribute("width","18"),g.setAttribute("height","18"),"innerHTML"in g)g.innerHTML=u;else{const v=document.createElement("div");v.innerHTML="<svg>"+u.valueOf().toString()+"</svg>";const x=v.firstChild,b=x.firstChild;g.appendChild(b)}return g}onRemove(){return this.container.remove(),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this}_onPaste(l){const u=(l.clipboardData||window.clipboardData).getData("text");u.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(u)}_onKeyDown(l){if(l.key==="Escape"&&this.options.clearAndBlurOnEsc){this._clear(l),this._inputEl.blur();return}const u=this._inputEl.value;if(!u){this.fresh=!0,l.key!=="Tab"&&this.clear(l),this._clearEl.style.display="none";return}if(!(l.metaKey||l.key==="Tab"||l.key==="Escape"||l.key==="ArrowLeft"||l.key==="ArrowRight"||l.key==="ArrowUp"||l.key==="ArrowDown")){if(l.key==="Enter")if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(u);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(u,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}u.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(u)}}_showButton(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")}_hideButton(){this._typeahead.selected&&(this._clearEl.style.display="none")}_onBlur(l){this.options.clearOnBlur&&this._clearOnBlur(l),this.options.collapsed&&this._collapse()}_onChange(){var l;const u=this._typeahead.selected;if(u){if(!("geometry"in u)){u.placeId?this._geocode(u.placeId,!0,!0):this._geocode(u.text,!0);return}if(JSON.stringify(u)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){let g;if(this._removeResultMarkers(),u.properties&&S_[u.properties.short_code])g=ol({},this.options.flyTo),this._map&&this._map.fitBounds(S_[u.properties.short_code].bbox,g);else if(u.bbox){const v=u.bbox;g=ol({},this.options.flyTo),this._map&&this._map.fitBounds([[v[0],v[1]],[v[2],v[3]]],g)}else{const v={zoom:this.options.zoom};g=ol({},v,this.options.flyTo),u.center?g.center=u.center:((l=u.geometry)===null||l===void 0?void 0:l.type)==="Point"&&u.geometry.coordinates&&(g.center=u.geometry.coordinates),this._map&&this._map.flyTo(g)}}this.options.marker&&this._maplibregl&&this._handleMarker(u),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(u),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:u})}}}_getConfigForRequest(){return["bbox","limit","proximity","countries","types","language","reverseMode"].reduce((g,v)=>(this.options[v]&&(["countries","types","language"].indexOf(v)>-1?g[v]=this.options[v].split(/[\s,]+/):g[v]=this.options[v],v==="proximity"&&this.options[v]&&typeof this.options[v].longitude=="number"&&typeof this.options[v].latitude=="number"&&(g[v]=[this.options[v].longitude,this.options[v].latitude])),g),{})}_geocode(l){return tp(this,arguments,void 0,function*(u,g=!1,v=!1){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:u});const x=this._getConfigForRequest(),b=this._createGeocodeRequest(x,u,g,v),s=this.options.localGeocoder?this.options.localGeocoder(u)||[]:[];try{const E=yield b;yield this._handleGeocodeResponse(E,x,u,g,s)}catch(E){this._handleGeocodeErrorResponse(E,s)}return b})}_createGeocodeRequest(l,u,g,v){return this.options.localGeocoderOnly?Promise.resolve({}):this.options.reverseGeocode&&Qb.test(u)?this._createReverseGeocodeRequest(u,l):(l.query=u,this.geocoderApi.getSuggestions?g?this.geocoderApi.searchByPlaceId&&v?this.geocoderApi.searchByPlaceId(l):this.geocoderApi.forwardGeocode(l):this.geocoderApi.getSuggestions(l):this.geocoderApi.forwardGeocode(l))}_createReverseGeocodeRequest(l,u){const g=l.split(/[\s(,)?]+/).map(v=>parseFloat(v)).reverse();return u.query=g,u.limit=1,"proximity"in u&&delete u.proximity,this.geocoderApi.reverseGeocode(u)}_handleGeocodeResponse(l,u,g,v,x){return tp(this,void 0,void 0,function*(){this._loadingEl.style.display="none";let b={};l?b=l:b={type:"FeatureCollection",features:[]},b.config=u,this.fresh&&(this.fresh=!1),b.features=b.features?x.concat(b.features):x;const s=this.options.externalGeocoder?this.options.externalGeocoder(g,b.features,u)||Promise.resolve([]):Promise.resolve([]);try{const F=yield s;b.features=b.features?F.concat(b.features):F}catch{}this.options.filter&&b.features.length&&(b.features=b.features.filter(this.options.filter));let E=[];"suggestions"in b?E=b.suggestions:"place"in b?E=Array.isArray(b.place)?b.place:[b.place]:E=b.features,E.length?(this._clearEl.style.display="block",this._typeahead.update(E),(!this.options.showResultsWhileTyping||v)&&this.options.showResultMarkers&&(b.features.length>0||"place"in b)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",b)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",b))})}_handleGeocodeErrorResponse(l,u){this._loadingEl.style.display="none",u.length&&this.options.localGeocoder?(this._clearEl.style.display="block",this._typeahead.update(u)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:u}),this._eventEmitter.emit("error",{error:l})}_clear(l){l&&l.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0}clear(l){this._clear(l),this._inputEl.focus()}_clearOnBlur(l){l.relatedTarget&&this._clear(l)}_onQueryResult(l){if(!("features"in l)||!l.features.length)return;const u=l.features[0];this._typeahead.selected=u,this._inputEl.value=u.place_name,this._onChange()}_updateProximity(){if(this._map)if(this._map.getZoom()>this.options.proximityMinZoom){const l=this._map.getCenter().wrap();this.setProximity({longitude:l.lng,latitude:l.lat})}else this.setProximity(null)}_collapse(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("maplibregl-ctrl-geocoder--collapsed")}_unCollapse(){this.container.classList.remove("maplibregl-ctrl-geocoder--collapsed")}query(l){return tp(this,void 0,void 0,function*(){const u=yield this._geocode(l);this._onQueryResult(u)})}_renderError(){const l=`<div class='maplibre-gl-geocoder--error'>${this._localize("errorConnectionFailed")}</div>`;this._renderMessage(l)}_renderNoResults(){const l=`<div class='maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>
        ${this._localize("errorNoResults")}</div>`;this._renderMessage(l)}_renderMessage(l){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(l)}_localize(l){const u=qb.language(this.options.language.split(",")[0]);return this.options.language&&Nh?.[l][u]?Nh[l][u]:Nh[l].en}_fitBoundsForMarkers(){var l;if(this._typeahead.data.length<1)return;const u=this._typeahead.data.filter(g=>typeof g!="string").slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){const v=ol({},{padding:100},this.options.flyTo),x=new this._maplibregl.LngLatBounds;for(const b of u)"geometry"in b&&((l=b.geometry)===null||l===void 0?void 0:l.type)==="Point"&&x.extend(b.geometry.coordinates);this._map.fitBounds(x,v)}return u.length>0&&this._maplibregl&&this._handleResultMarkers(u),this}setInput(l){return this._inputEl.value=l,this._typeahead.selected=null,this._typeahead.clear(),l.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(l),this}setProximity(l){return this.options.proximity=l,this}getProximity(){return this.options.proximity}setRenderFunction(l){return l&&typeof l=="function"&&(this._typeahead.render=l),this}getRenderFunction(){return this._typeahead.render}setLanguage(l){return this.options.language=l||this.options.language||navigator.language,this}getLanguage(){return this.options.language}getZoom(){return this.options.zoom}setZoom(l){return this.options.zoom=l,this}getFlyTo(){return this.options.flyTo}setFlyTo(l){return this.options.flyTo=l,this}getPlaceholder(){return this.options.placeholder}setPlaceholder(l){return this.options.placeholder=l||this.options.placeholder||this._localize("placeholder"),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this}getBbox(){return this.options.bbox}setBbox(l){return this.options.bbox=l,this}getCountries(){return this.options.countries}setCountries(l){return this.options.countries=l,this}getTypes(){return this.options.types}setTypes(l){return this.options.types=l,this}getMinLength(){return this.options.minLength}setMinLength(l){return this.options.minLength=l,this._typeahead&&(this._typeahead.options.minLength=l),this}getLimit(){return this.options.limit}setLimit(l){return this.options.limit=l,this._typeahead&&(this._typeahead.options.limit=l),this}getFilter(){return this.options.filter}setFilter(l){return this.options.filter=l,this}setGeocoderApi(l){return this.geocoderApi=l,this}getGeocoderApi(){return this.geocoderApi}_handleMarker(l){var u;if(!this._map)return;this._removeMarker();const v=ol({},{color:"#4668F2"},this.options.marker);this.mapMarker=new this._maplibregl.Marker(v);let x=null;if(this.options.popup){const s=ol({},{},this.options.popup);x=new this._maplibregl.Popup(s).setHTML(this.options.popupRender(l))}return l.center?(this.mapMarker.setLngLat(l.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(x)):((u=l.geometry)===null||u===void 0?void 0:u.type)==="Point"&&l.geometry.coordinates&&(this.mapMarker.setLngLat(l.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(x)),this}_removeMarker(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)}_handleResultMarkers(l){if(!this._map)return;this._removeResultMarkers();let g=ol({},{color:"#4668F2"},this.options.showResultMarkers);for(const v of l){let x;if(this.options.showResultMarkers){this.options.showResultMarkers&&this.options.showResultMarkers.element&&(x=this.options.showResultMarkers.element.cloneNode(!0),g=ol(g,{element:x}));const b=new this._maplibregl.Marker(ol({},g,{element:x}));let s;if(this.options.popup){const F=ol({},{},this.options.popup);s=new this._maplibregl.Popup(F).setHTML(this.options.popupRender(v))}v.center?(b.setLngLat(v.center).addTo(this._map),this.options.popup&&b.setPopup(s)):v.geometry&&v.geometry.type&&v.geometry.type==="Point"&&v.geometry.coordinates&&(b.setLngLat(v.geometry.coordinates).addTo(this._map),this.options.popup&&b.setPopup(s)),this.resultMarkers.push(b)}}return this}_removeResultMarkers(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(l){l.remove()}),this.resultMarkers=[])}on(l,u){return this._eventEmitter.on(l,u),this}once(l){return new Promise(u=>{this._eventEmitter.once(l,u)})}off(l,u){return this._eventEmitter.removeListener(l,u),this}}const t2="modulepreload",r2=function(p){return"/"+p},T_={},lp=function(l,u,g){let v=Promise.resolve();if(u&&u.length>0){let E=function(F){return Promise.all(F.map(B=>Promise.resolve(B).then(Q=>({status:"fulfilled",value:Q}),Q=>({status:"rejected",reason:Q}))))};document.getElementsByTagName("link");const b=document.querySelector("meta[property=csp-nonce]"),s=b?.nonce||b?.getAttribute("nonce");v=E(u.map(F=>{if(F=r2(F),F in T_)return;T_[F]=!0;const B=F.endsWith(".css"),Q=B?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${F}"]${Q}`))return;const ne=document.createElement("link");if(ne.rel=B?"stylesheet":t2,B||(ne.as="script"),ne.crossOrigin="",ne.href=F,s&&ne.setAttribute("nonce",s),document.head.appendChild(ne),B)return new Promise((j,Ie)=>{ne.addEventListener("load",j),ne.addEventListener("error",()=>Ie(new Error(`Unable to preload CSS for ${F}`)))})}))}function x(b){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=b,window.dispatchEvent(s),!s.defaultPrevented)throw b}return v.then(b=>{for(const s of b||[])s.status==="rejected"&&x(s.reason);return l().catch(x)})};class i2{map;width;height;svgCanvas;xLine;yLine;color="#535353";constructor(l){this.map=l,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){this.width=this.map?.getCanvas().clientWidth,this.height=this.map?.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const l=this.width/2,u=this.height/2;this.yLine.setAttribute("x1",`${l}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${l}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${u}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${u}px`)}else console.error("element value is null")}createCanvas(l){if(this.width!==void 0&&this.height!==void 0){const u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.style.position="relative",u.setAttribute("width",`${this.width}px`),u.setAttribute("height",`${this.height}px`);const g=this.width/2,v=this.height/2;this.yLine=u.appendChild(this.createLine(g,0,g,this.height,this.color,"2px")),this.xLine=u.appendChild(this.createLine(0,v,this.width,v,this.color,"2px")),l?.appendChild(u),this.svgCanvas=u}}createLine(l,u,g,v,x,b){const s=document.createElementNS("http://www.w3.org/2000/svg","line");return s.setAttribute("x1",l),s.setAttribute("y1",u),s.setAttribute("x2",g),s.setAttribute("y2",v),s.setAttribute("stroke-dasharray","5,5"),s.setAttribute("stroke",x),s.setAttribute("stroke-width",b),s}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}}const P_={72:72,96:96,200:200,300:300,400:400},xc={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},Id={Landscape:"landscape",Portrait:"portrait"},ah={LETTER:[279,216],A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},fh={mm:"mm"};class n2{map;width;height;unit;svgCanvas;svgPath;constructor(l){if(this.map=l,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const u=this.map?.getCanvas().clientWidth,g=this.map?.getCanvas().clientHeight,v=document.createElementNS("http://www.w3.org/2000/svg","svg");v.style.position="absolute",v.style.top="0px",v.style.left="0px",v.setAttribute("width",`${u}px`),v.setAttribute("height",`${g}px`);const x=document.createElementNS("http://www.w3.org/2000/svg","path");x.setAttribute("style","fill:#888888;stroke-width:0"),x.setAttribute("fill-opacity","0.5"),v.append(x),this.map?.getCanvasContainer().appendChild(v),this.svgCanvas=v,this.svgPath=x}mapResize(){this.generateCutOut()}updateArea(l,u){this.width=l,this.height=u,this.unit=fh.mm,this.generateCutOut()}generateCutOut(){if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const l=this.toPixels(this.width),u=this.toPixels(this.height),g=this.map?.getCanvas().clientWidth,v=this.map?.getCanvas().clientHeight,x=g/2-l/2,b=x+l,s=v/2-u/2,E=s+u;this.svgCanvas.setAttribute("width",`${g}px`),this.svgCanvas.setAttribute("height",`${v}px`),this.svgPath.setAttribute("d",`M 0 0 L ${g} 0 L ${g} ${v} L 0 ${v} M ${x} ${s} L ${x} ${E} L ${b} ${E} L ${b} ${s}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(l,u=96){return this.unit===fh.mm&&(u/=25.4),u*l}}const Xy={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate",LanguageName:"English",LanguageCode:"en"},s2={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Gnrer",LanguageName:"Franais",LanguageCode:"fr"},a2={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi",LanguageName:"Suomalainen",LanguageCode:"fi"},o2={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflsung",Generate:"Erstellen",LanguageName:"Deutsch",LanguageCode:"de"},l2={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera",LanguageName:"Svenska",LanguageCode:"sv"},c2={PageSize:"Tamao de pgina",PageOrientation:"Orientacin de pgina",Format:"Formato",DPI:"DPI",Generate:"Generar",LanguageName:"Espaola",LanguageCode:"es"},u2={PageSize:"Mida",PageOrientation:"Orientaci",Format:"Format",DPI:"DPI",Generate:"Genera",LanguageName:"Catalan",LanguageCode:"ca"},h2={PageSize:"Kch thc trang",PageOrientation:"Loi trang",Format:"nh dng",DPI:"Mt  im nh (DPI)",Generate:"To",LanguageName:"Ting Vit",LanguageCode:"vi"},d2={PageSize:" ",PageOrientation:" ",Format:"",DPI:"DPI",Generate:"",LanguageName:"",LanguageCode:"uk"},f2={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:"",LanguageName:"",LanguageCode:"zhHans"},p2={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:"",LanguageName:"",LanguageCode:"zhHant"},m2={PageSize:"",PageOrientation:"",Format:"",DPI:"DPI",Generate:"",LanguageName:"",LanguageCode:"ja"},g2={PageSize:"Tamanho da pgina",PageOrientation:"Orientao da pgina",Format:"Formato",DPI:"DPI",Generate:"Gerar",LanguageName:"Portugus",LanguageCode:"pt"},_2={PageSize:" ",PageOrientation:" ",Format:"",DPI:" (DPI)",Generate:"",LanguageName:"",LanguageCode:"ru"},y2=[Xy,s2,a2,o2,l2,c2,u2,h2,d2,f2,p2,m2,g2,_2],v2=p=>y2.find(l=>l.LanguageCode===p)??Xy;function Wi(p){"@babel/helpers - typeof";return Wi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},Wi(p)}var ul=Uint8Array,Ro=Uint16Array,Zp=Int32Array,Wp=new ul([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Hp=new ul([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),A_=new ul([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Yy=function(p,l){for(var u=new Ro(31),g=0;g<31;++g)u[g]=l+=1<<p[g-1];for(var v=new Zp(u[30]),g=1;g<30;++g)for(var x=u[g];x<u[g+1];++x)v[x]=x-u[g]<<5|g;return{b:u,r:v}},Jy=Yy(Wp,2),b2=Jy.b,Dp=Jy.r;b2[28]=258,Dp[258]=28;var x2=Yy(Hp,0),I_=x2.r,Ky=new Ro(32768);for(var bn=0;bn<32768;++bn){var qc=(bn&43690)>>1|(bn&21845)<<1;qc=(qc&52428)>>2|(qc&13107)<<2,qc=(qc&61680)>>4|(qc&3855)<<4,Ky[bn]=((qc&65280)>>8|(qc&255)<<8)>>1}var Vh=(function(p,l,u){for(var g=p.length,v=0,x=new Ro(l);v<g;++v)p[v]&&++x[p[v]-1];var b=new Ro(l);for(v=1;v<l;++v)b[v]=b[v-1]+x[v-1]<<1;var s;for(s=new Ro(g),v=0;v<g;++v)p[v]&&(s[v]=Ky[b[p[v]-1]++]>>15-p[v]);return s}),Su=new ul(288);for(var bn=0;bn<144;++bn)Su[bn]=8;for(var bn=144;bn<256;++bn)Su[bn]=9;for(var bn=256;bn<280;++bn)Su[bn]=7;for(var bn=280;bn<288;++bn)Su[bn]=8;var $d=new ul(32);for(var bn=0;bn<32;++bn)$d[bn]=5;var w2=Vh(Su,9),S2=Vh($d,5),Qy=function(p){return(p+7)/8|0},T2=function(p,l,u){return(u==null||u>p.length)&&(u=p.length),new ul(p.subarray(l,u))},yc=function(p,l,u){u<<=l&7;var g=l/8|0;p[g]|=u,p[g+1]|=u>>8},Rh=function(p,l,u){u<<=l&7;var g=l/8|0;p[g]|=u,p[g+1]|=u>>8,p[g+2]|=u>>16},cp=function(p,l){for(var u=[],g=0;g<p.length;++g)p[g]&&u.push({s:g,f:p[g]});var v=u.length,x=u.slice();if(!v)return{t:t0,l:0};if(v==1){var b=new ul(u[0].s+1);return b[u[0].s]=1,{t:b,l:1}}u.sort(function(Ue,$e){return Ue.f-$e.f}),u.push({s:-1,f:25001});var s=u[0],E=u[1],F=0,B=1,Q=2;for(u[0]={s:-1,f:s.f+E.f,l:s,r:E};B!=v-1;)s=u[u[F].f<u[Q].f?F++:Q++],E=u[F!=B&&u[F].f<u[Q].f?F++:Q++],u[B++]={s:-1,f:s.f+E.f,l:s,r:E};for(var ne=x[0].s,g=1;g<v;++g)x[g].s>ne&&(ne=x[g].s);var j=new Ro(ne+1),Ie=Fp(u[B-1],j,0);if(Ie>l){var g=0,he=0,re=Ie-l,ye=1<<re;for(x.sort(function($e,st){return j[st.s]-j[$e.s]||$e.f-st.f});g<v;++g){var Je=x[g].s;if(j[Je]>l)he+=ye-(1<<Ie-j[Je]),j[Je]=l;else break}for(he>>=re;he>0;){var Be=x[g].s;j[Be]<l?he-=1<<l-j[Be]++-1:++g}for(;g>=0&&he;--g){var De=x[g].s;j[De]==l&&(--j[De],++he)}Ie=l}return{t:new ul(j),l:Ie}},Fp=function(p,l,u){return p.s==-1?Math.max(Fp(p.l,l,u+1),Fp(p.r,l,u+1)):l[p.s]=u},L_=function(p){for(var l=p.length;l&&!p[--l];);for(var u=new Ro(++l),g=0,v=p[0],x=1,b=function(E){u[g++]=E},s=1;s<=l;++s)if(p[s]==v&&s!=l)++x;else{if(!v&&x>2){for(;x>138;x-=138)b(32754);x>2&&(b(x>10?x-11<<5|28690:x-3<<5|12305),x=0)}else if(x>3){for(b(v),--x;x>6;x-=6)b(8304);x>2&&(b(x-3<<5|8208),x=0)}for(;x--;)b(v);x=1,v=p[s]}return{c:u.subarray(0,g),n:l}},Bh=function(p,l){for(var u=0,g=0;g<l.length;++g)u+=p[g]*l[g];return u},e0=function(p,l,u){var g=u.length,v=Qy(l+2);p[v]=g&255,p[v+1]=g>>8,p[v+2]=p[v]^255,p[v+3]=p[v+1]^255;for(var x=0;x<g;++x)p[v+x+4]=u[x];return(v+4+g)*8},C_=function(p,l,u,g,v,x,b,s,E,F,B){yc(l,B++,u),++v[256];for(var Q=cp(v,15),ne=Q.t,j=Q.l,Ie=cp(x,15),he=Ie.t,re=Ie.l,ye=L_(ne),Je=ye.c,Be=ye.n,De=L_(he),Ue=De.c,$e=De.n,st=new Ro(19),Ze=0;Ze<Je.length;++Ze)++st[Je[Ze]&31];for(var Ze=0;Ze<Ue.length;++Ze)++st[Ue[Ze]&31];for(var Pe=cp(st,7),rt=Pe.t,_e=Pe.l,we=19;we>4&&!rt[A_[we-1]];--we);var Ge=F+5<<3,Ye=Bh(v,Su)+Bh(x,$d)+b,xt=Bh(v,ne)+Bh(x,he)+b+14+3*we+Bh(st,rt)+2*st[16]+3*st[17]+7*st[18];if(E>=0&&Ge<=Ye&&Ge<=xt)return e0(l,B,p.subarray(E,E+F));var kt,yt,mt,gt;if(yc(l,B,1+(xt<Ye)),B+=2,xt<Ye){kt=Vh(ne,j),yt=ne,mt=Vh(he,re),gt=he;var Qt=Vh(rt,_e);yc(l,B,Be-257),yc(l,B+5,$e-1),yc(l,B+10,we-4),B+=14;for(var Ze=0;Ze<we;++Ze)yc(l,B+3*Ze,rt[A_[Ze]]);B+=3*we;for(var Vt=[Je,Ue],fe=0;fe<2;++fe)for(var Fe=Vt[fe],Ze=0;Ze<Fe.length;++Ze){var We=Fe[Ze]&31;yc(l,B,Qt[We]),B+=rt[We],We>15&&(yc(l,B,Fe[Ze]>>5&127),B+=Fe[Ze]>>12)}}else kt=w2,yt=Su,mt=S2,gt=$d;for(var Ze=0;Ze<s;++Ze){var tt=g[Ze];if(tt>255){var We=tt>>18&31;Rh(l,B,kt[We+257]),B+=yt[We+257],We>7&&(yc(l,B,tt>>23&31),B+=Wp[We]);var nt=tt&31;Rh(l,B,mt[nt]),B+=gt[nt],nt>3&&(Rh(l,B,tt>>5&8191),B+=Hp[nt])}else Rh(l,B,kt[tt]),B+=yt[tt]}return Rh(l,B,kt[256]),B+yt[256]},P2=new Zp([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),t0=new ul(0),A2=function(p,l,u,g,v,x){var b=x.z||p.length,s=new ul(g+b+5*(1+Math.ceil(b/7e3))+v),E=s.subarray(g,s.length-v),F=x.l,B=(x.r||0)&7;if(l){B&&(E[0]=x.r>>3);for(var Q=P2[l-1],ne=Q>>13,j=Q&8191,Ie=(1<<u)-1,he=x.p||new Ro(32768),re=x.h||new Ro(Ie+1),ye=Math.ceil(u/3),Je=2*ye,Be=function(_r){return(p[_r]^p[_r+1]<<ye^p[_r+2]<<Je)&Ie},De=new Zp(25e3),Ue=new Ro(288),$e=new Ro(32),st=0,Ze=0,Pe=x.i||0,rt=0,_e=x.w||0,we=0;Pe+2<b;++Pe){var Ge=Be(Pe),Ye=Pe&32767,xt=re[Ge];if(he[Ye]=xt,re[Ge]=Ye,_e<=Pe){var kt=b-Pe;if((st>7e3||rt>24576)&&(kt>423||!F)){B=C_(p,E,0,De,Ue,$e,Ze,rt,we,Pe-we,B),rt=st=Ze=0,we=Pe;for(var yt=0;yt<286;++yt)Ue[yt]=0;for(var yt=0;yt<30;++yt)$e[yt]=0}var mt=2,gt=0,Qt=j,Vt=Ye-xt&32767;if(kt>2&&Ge==Be(Pe-Vt))for(var fe=Math.min(ne,kt)-1,Fe=Math.min(32767,Pe),We=Math.min(258,kt);Vt<=Fe&&--Qt&&Ye!=xt;){if(p[Pe+mt]==p[Pe+mt-Vt]){for(var tt=0;tt<We&&p[Pe+tt]==p[Pe+tt-Vt];++tt);if(tt>mt){if(mt=tt,gt=Vt,tt>fe)break;for(var nt=Math.min(Vt,tt-2),ut=0,yt=0;yt<nt;++yt){var ft=Pe-Vt+yt&32767,It=he[ft],zt=ft-It&32767;zt>ut&&(ut=zt,xt=ft)}}}Ye=xt,xt=he[Ye],Vt+=Ye-xt&32767}if(gt){De[rt++]=268435456|Dp[mt]<<18|I_[gt];var Zt=Dp[mt]&31,sr=I_[gt]&31;Ze+=Wp[Zt]+Hp[sr],++Ue[257+Zt],++$e[sr],_e=Pe+mt,++st}else De[rt++]=p[Pe],++Ue[p[Pe]]}}for(Pe=Math.max(Pe,_e);Pe<b;++Pe)De[rt++]=p[Pe],++Ue[p[Pe]];B=C_(p,E,F,De,Ue,$e,Ze,rt,we,Pe-we,B),F||(x.r=B&7|E[B/8|0]<<3,B-=7,x.h=re,x.p=he,x.i=Pe,x.w=_e)}else{for(var Pe=x.w||0;Pe<b+F;Pe+=65535){var ur=Pe+65535;ur>=b&&(E[B/8|0]=F,ur=b),B=e0(E,B+1,p.subarray(Pe,ur))}x.i=b}return T2(s,0,g+Qy(B)+v)},r0=function(){var p=1,l=0;return{p:function(u){for(var g=p,v=l,x=u.length|0,b=0;b!=x;){for(var s=Math.min(b+2655,x);b<s;++b)v+=g+=u[b];g=(g&65535)+15*(g>>16),v=(v&65535)+15*(v>>16)}p=g,l=v},d:function(){return p%=65521,l%=65521,(p&255)<<24|(p&65280)<<8|(l&255)<<8|l>>8}}},I2=function(p,l,u,g,v){if(!v&&(v={l:1},l.dictionary)){var x=l.dictionary.subarray(-32768),b=new ul(x.length+p.length);b.set(x),b.set(p,x.length),p=b,v.w=x.length}return A2(p,l.level==null?6:l.level,l.mem==null?v.l?Math.ceil(Math.max(8,Math.min(13,Math.log(p.length)))*1.5):20:12+l.mem,u,g,v)},i0=function(p,l,u){for(;u;++l)p[l]=u,u>>>=8},L2=function(p,l){var u=l.level,g=u==0?0:u<6?1:u==9?3:2;if(p[0]=120,p[1]=g<<6|(l.dictionary&&32),p[1]|=31-(p[0]<<8|p[1])%31,l.dictionary){var v=r0();v.p(l.dictionary),i0(p,2,v.d())}};function zp(p,l){l||(l={});var u=r0();u.p(p);var g=I2(p,l,l.dictionary?6:2,4);return L2(g,l),i0(g,g.length-4,u.d()),g}var C2=typeof TextDecoder<"u"&&new TextDecoder,M2=0;try{C2.decode(t0,{stream:!0}),M2=1}catch{}function E2(p){if(Array.isArray(p))return p}function k2(p,l){var u=p==null?null:typeof Symbol<"u"&&p[Symbol.iterator]||p["@@iterator"];if(u!=null){var g,v,x,b,s=[],E=!0,F=!1;try{if(x=(u=u.call(p)).next,l!==0)for(;!(E=(g=x.call(u)).done)&&(s.push(g.value),s.length!==l);E=!0);}catch(B){F=!0,v=B}finally{try{if(!E&&u.return!=null&&(b=u.return(),Object(b)!==b))return}finally{if(F)throw v}}return s}}function M_(p,l){(l==null||l>p.length)&&(l=p.length);for(var u=0,g=Array(l);u<l;u++)g[u]=p[u];return g}function D2(p,l){if(p){if(typeof p=="string")return M_(p,l);var u={}.toString.call(p).slice(8,-1);return u==="Object"&&p.constructor&&(u=p.constructor.name),u==="Map"||u==="Set"?Array.from(p):u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u)?M_(p,l):void 0}}function F2(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function E_(p,l){return E2(p)||k2(p,l)||D2(p,l)||F2()}function k_(p,l="utf8"){return new TextDecoder(l).decode(p)}const z2=new TextEncoder;function N2(p){return z2.encode(p)}const R2=1024*8,B2=(()=>{const p=new Uint8Array(4),l=new Uint32Array(p.buffer);return!((l[0]=1)&p[0])})(),up={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class Xp{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(l=R2,u={}){let g=!1;typeof l=="number"?l=new ArrayBuffer(l):(g=!0,this.lastWrittenByte=l.byteLength);const v=u.offset?u.offset>>>0:0,x=l.byteLength-v;let b=v;(ArrayBuffer.isView(l)||l instanceof Xp)&&(l.byteLength!==l.buffer.byteLength&&(b=l.byteOffset+v),l=l.buffer),g?this.lastWrittenByte=x:this.lastWrittenByte=0,this.buffer=l,this.length=x,this.byteLength=x,this.byteOffset=b,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,b,x),this._mark=0,this._marks=[]}available(l=1){return this.offset+l<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(l=1){return this.offset+=l,this}back(l=1){return this.offset-=l,this}seek(l){return this.offset=l,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const l=this._marks.pop();if(l===void 0)throw new Error("Mark stack empty");return this.seek(l),this}rewind(){return this.offset=0,this}ensureAvailable(l=1){if(!this.available(l)){const u=(this.offset+l)*2,g=new Uint8Array(u);g.set(new Uint8Array(this.buffer)),this.buffer=g.buffer,this.length=u,this.byteLength=u,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(l=1){return this.readArray(l,"uint8")}readArray(l,u){const g=up[u].BYTES_PER_ELEMENT*l,v=this.byteOffset+this.offset,x=this.buffer.slice(v,v+g);if(this.littleEndian===B2&&u!=="uint8"&&u!=="int8"){const s=new Uint8Array(this.buffer.slice(v,v+g));s.reverse();const E=new up[u](s.buffer);return this.offset+=g,E.reverse(),E}const b=new up[u](x);return this.offset+=g,b}readInt16(){const l=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,l}readUint16(){const l=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,l}readInt32(){const l=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,l}readUint32(){const l=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,l}readFloat32(){const l=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,l}readFloat64(){const l=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,l}readBigInt64(){const l=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,l}readBigUint64(){const l=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,l}readChar(){return String.fromCharCode(this.readInt8())}readChars(l=1){let u="";for(let g=0;g<l;g++)u+=this.readChar();return u}readUtf8(l=1){return k_(this.readBytes(l))}decodeText(l=1,u="utf8"){return k_(this.readBytes(l),u)}writeBoolean(l){return this.writeUint8(l?255:0),this}writeInt8(l){return this.ensureAvailable(1),this._data.setInt8(this.offset++,l),this._updateLastWrittenByte(),this}writeUint8(l){return this.ensureAvailable(1),this._data.setUint8(this.offset++,l),this._updateLastWrittenByte(),this}writeByte(l){return this.writeUint8(l)}writeBytes(l){this.ensureAvailable(l.length);for(let u=0;u<l.length;u++)this._data.setUint8(this.offset++,l[u]);return this._updateLastWrittenByte(),this}writeInt16(l){return this.ensureAvailable(2),this._data.setInt16(this.offset,l,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(l){return this.ensureAvailable(2),this._data.setUint16(this.offset,l,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(l){return this.ensureAvailable(4),this._data.setInt32(this.offset,l,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(l){return this.ensureAvailable(4),this._data.setUint32(this.offset,l,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(l){return this.ensureAvailable(4),this._data.setFloat32(this.offset,l,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(l){return this.ensureAvailable(8),this._data.setFloat64(this.offset,l,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(l){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,l,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(l){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,l,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(l){return this.writeUint8(l.charCodeAt(0))}writeChars(l){for(let u=0;u<l.length;u++)this.writeUint8(l.charCodeAt(u));return this}writeUtf8(l){return this.writeBytes(N2(l))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function ph(p){let l=p.length;for(;--l>=0;)p[l]=0}const O2=3,j2=258,n0=29,V2=256,U2=V2+1+n0,s0=30,q2=512,G2=new Array((U2+2)*2);ph(G2);const $2=new Array(s0*2);ph($2);const Z2=new Array(q2);ph(Z2);const W2=new Array(j2-O2+1);ph(W2);const H2=new Array(n0);ph(H2);const X2=new Array(s0);ph(X2);const Y2=(p,l,u,g)=>{let v=p&65535|0,x=p>>>16&65535|0,b=0;for(;u!==0;){b=u>2e3?2e3:u,u-=b;do v=v+l[g++]|0,x=x+v|0;while(--b);v%=65521,x%=65521}return v|x<<16|0};var Np=Y2;const J2=()=>{let p,l=[];for(var u=0;u<256;u++){p=u;for(var g=0;g<8;g++)p=p&1?3988292384^p>>>1:p>>>1;l[u]=p}return l},K2=new Uint32Array(J2()),Q2=(p,l,u,g)=>{const v=K2,x=g+u;p^=-1;for(let b=g;b<x;b++)p=p>>>8^v[(p^l[b])&255];return p^-1};var jl=Q2,Rp={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},a0={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const ex=(p,l)=>Object.prototype.hasOwnProperty.call(p,l);var tx=function(p){const l=Array.prototype.slice.call(arguments,1);for(;l.length;){const u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(const g in u)ex(u,g)&&(p[g]=u[g])}}return p},rx=p=>{let l=0;for(let g=0,v=p.length;g<v;g++)l+=p[g].length;const u=new Uint8Array(l);for(let g=0,v=0,x=p.length;g<x;g++){let b=p[g];u.set(b,v),v+=b.length}return u},o0={assign:tx,flattenChunks:rx};let l0=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{l0=!1}const $h=new Uint8Array(256);for(let p=0;p<256;p++)$h[p]=p>=252?6:p>=248?5:p>=240?4:p>=224?3:p>=192?2:1;$h[254]=$h[254]=1;var ix=p=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(p);let l,u,g,v,x,b=p.length,s=0;for(v=0;v<b;v++)u=p.charCodeAt(v),(u&64512)===55296&&v+1<b&&(g=p.charCodeAt(v+1),(g&64512)===56320&&(u=65536+(u-55296<<10)+(g-56320),v++)),s+=u<128?1:u<2048?2:u<65536?3:4;for(l=new Uint8Array(s),x=0,v=0;x<s;v++)u=p.charCodeAt(v),(u&64512)===55296&&v+1<b&&(g=p.charCodeAt(v+1),(g&64512)===56320&&(u=65536+(u-55296<<10)+(g-56320),v++)),u<128?l[x++]=u:u<2048?(l[x++]=192|u>>>6,l[x++]=128|u&63):u<65536?(l[x++]=224|u>>>12,l[x++]=128|u>>>6&63,l[x++]=128|u&63):(l[x++]=240|u>>>18,l[x++]=128|u>>>12&63,l[x++]=128|u>>>6&63,l[x++]=128|u&63);return l};const nx=(p,l)=>{if(l<65534&&p.subarray&&l0)return String.fromCharCode.apply(null,p.length===l?p:p.subarray(0,l));let u="";for(let g=0;g<l;g++)u+=String.fromCharCode(p[g]);return u};var sx=(p,l)=>{const u=l||p.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(p.subarray(0,l));let g,v;const x=new Array(u*2);for(v=0,g=0;g<u;){let b=p[g++];if(b<128){x[v++]=b;continue}let s=$h[b];if(s>4){x[v++]=65533,g+=s-1;continue}for(b&=s===2?31:s===3?15:7;s>1&&g<u;)b=b<<6|p[g++]&63,s--;if(s>1){x[v++]=65533;continue}b<65536?x[v++]=b:(b-=65536,x[v++]=55296|b>>10&1023,x[v++]=56320|b&1023)}return nx(x,v)},ax=(p,l)=>{l=l||p.length,l>p.length&&(l=p.length);let u=l-1;for(;u>=0&&(p[u]&192)===128;)u--;return u<0||u===0?l:u+$h[p[u]]>l?u:l},Bp={string2buf:ix,buf2string:sx,utf8border:ax};function ox(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var lx=ox;const Ld=16209,cx=16191;var ux=function(p,l){let u,g,v,x,b,s,E,F,B,Q,ne,j,Ie,he,re,ye,Je,Be,De,Ue,$e,st,Ze,Pe;const rt=p.state;u=p.next_in,Ze=p.input,g=u+(p.avail_in-5),v=p.next_out,Pe=p.output,x=v-(l-p.avail_out),b=v+(p.avail_out-257),s=rt.dmax,E=rt.wsize,F=rt.whave,B=rt.wnext,Q=rt.window,ne=rt.hold,j=rt.bits,Ie=rt.lencode,he=rt.distcode,re=(1<<rt.lenbits)-1,ye=(1<<rt.distbits)-1;e:do{j<15&&(ne+=Ze[u++]<<j,j+=8,ne+=Ze[u++]<<j,j+=8),Je=Ie[ne&re];t:for(;;){if(Be=Je>>>24,ne>>>=Be,j-=Be,Be=Je>>>16&255,Be===0)Pe[v++]=Je&65535;else if(Be&16){De=Je&65535,Be&=15,Be&&(j<Be&&(ne+=Ze[u++]<<j,j+=8),De+=ne&(1<<Be)-1,ne>>>=Be,j-=Be),j<15&&(ne+=Ze[u++]<<j,j+=8,ne+=Ze[u++]<<j,j+=8),Je=he[ne&ye];r:for(;;){if(Be=Je>>>24,ne>>>=Be,j-=Be,Be=Je>>>16&255,Be&16){if(Ue=Je&65535,Be&=15,j<Be&&(ne+=Ze[u++]<<j,j+=8,j<Be&&(ne+=Ze[u++]<<j,j+=8)),Ue+=ne&(1<<Be)-1,Ue>s){p.msg="invalid distance too far back",rt.mode=Ld;break e}if(ne>>>=Be,j-=Be,Be=v-x,Ue>Be){if(Be=Ue-Be,Be>F&&rt.sane){p.msg="invalid distance too far back",rt.mode=Ld;break e}if($e=0,st=Q,B===0){if($e+=E-Be,Be<De){De-=Be;do Pe[v++]=Q[$e++];while(--Be);$e=v-Ue,st=Pe}}else if(B<Be){if($e+=E+B-Be,Be-=B,Be<De){De-=Be;do Pe[v++]=Q[$e++];while(--Be);if($e=0,B<De){Be=B,De-=Be;do Pe[v++]=Q[$e++];while(--Be);$e=v-Ue,st=Pe}}}else if($e+=B-Be,Be<De){De-=Be;do Pe[v++]=Q[$e++];while(--Be);$e=v-Ue,st=Pe}for(;De>2;)Pe[v++]=st[$e++],Pe[v++]=st[$e++],Pe[v++]=st[$e++],De-=3;De&&(Pe[v++]=st[$e++],De>1&&(Pe[v++]=st[$e++]))}else{$e=v-Ue;do Pe[v++]=Pe[$e++],Pe[v++]=Pe[$e++],Pe[v++]=Pe[$e++],De-=3;while(De>2);De&&(Pe[v++]=Pe[$e++],De>1&&(Pe[v++]=Pe[$e++]))}}else if((Be&64)===0){Je=he[(Je&65535)+(ne&(1<<Be)-1)];continue r}else{p.msg="invalid distance code",rt.mode=Ld;break e}break}}else if((Be&64)===0){Je=Ie[(Je&65535)+(ne&(1<<Be)-1)];continue t}else if(Be&32){rt.mode=cx;break e}else{p.msg="invalid literal/length code",rt.mode=Ld;break e}break}}while(u<g&&v<b);De=j>>3,u-=De,j-=De<<3,ne&=(1<<j)-1,p.next_in=u,p.next_out=v,p.avail_in=u<g?5+(g-u):5-(u-g),p.avail_out=v<b?257+(b-v):257-(v-b),rt.hold=ne,rt.bits=j};const Qu=15,D_=852,F_=592,z_=0,hp=1,N_=2,hx=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),dx=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),fx=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),px=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),mx=(p,l,u,g,v,x,b,s)=>{const E=s.bits;let F=0,B=0,Q=0,ne=0,j=0,Ie=0,he=0,re=0,ye=0,Je=0,Be,De,Ue,$e,st,Ze=null,Pe;const rt=new Uint16Array(Qu+1),_e=new Uint16Array(Qu+1);let we=null,Ge,Ye,xt;for(F=0;F<=Qu;F++)rt[F]=0;for(B=0;B<g;B++)rt[l[u+B]]++;for(j=E,ne=Qu;ne>=1&&rt[ne]===0;ne--);if(j>ne&&(j=ne),ne===0)return v[x++]=1<<24|64<<16|0,v[x++]=1<<24|64<<16|0,s.bits=1,0;for(Q=1;Q<ne&&rt[Q]===0;Q++);for(j<Q&&(j=Q),re=1,F=1;F<=Qu;F++)if(re<<=1,re-=rt[F],re<0)return-1;if(re>0&&(p===z_||ne!==1))return-1;for(_e[1]=0,F=1;F<Qu;F++)_e[F+1]=_e[F]+rt[F];for(B=0;B<g;B++)l[u+B]!==0&&(b[_e[l[u+B]]++]=B);if(p===z_?(Ze=we=b,Pe=20):p===hp?(Ze=hx,we=dx,Pe=257):(Ze=fx,we=px,Pe=0),Je=0,B=0,F=Q,st=x,Ie=j,he=0,Ue=-1,ye=1<<j,$e=ye-1,p===hp&&ye>D_||p===N_&&ye>F_)return 1;for(;;){Ge=F-he,b[B]+1<Pe?(Ye=0,xt=b[B]):b[B]>=Pe?(Ye=we[b[B]-Pe],xt=Ze[b[B]-Pe]):(Ye=96,xt=0),Be=1<<F-he,De=1<<Ie,Q=De;do De-=Be,v[st+(Je>>he)+De]=Ge<<24|Ye<<16|xt|0;while(De!==0);for(Be=1<<F-1;Je&Be;)Be>>=1;if(Be!==0?(Je&=Be-1,Je+=Be):Je=0,B++,--rt[F]===0){if(F===ne)break;F=l[u+b[B]]}if(F>j&&(Je&$e)!==Ue){for(he===0&&(he=j),st+=Q,Ie=F-he,re=1<<Ie;Ie+he<ne&&(re-=rt[Ie+he],!(re<=0));)Ie++,re<<=1;if(ye+=1<<Ie,p===hp&&ye>D_||p===N_&&ye>F_)return 1;Ue=Je&$e,v[Ue]=j<<24|Ie<<16|st-x|0}}return Je!==0&&(v[st+Je]=F-he<<24|64<<16|0),s.bits=j,0};var Uh=mx;const gx=0,c0=1,u0=2,{Z_FINISH:R_,Z_BLOCK:_x,Z_TREES:Cd,Z_OK:Tu,Z_STREAM_END:yx,Z_NEED_DICT:vx,Z_STREAM_ERROR:hl,Z_DATA_ERROR:h0,Z_MEM_ERROR:d0,Z_BUF_ERROR:bx,Z_DEFLATED:B_}=a0,Kd=16180,O_=16181,j_=16182,V_=16183,U_=16184,q_=16185,G_=16186,$_=16187,Z_=16188,W_=16189,Zd=16190,vc=16191,dp=16192,H_=16193,fp=16194,X_=16195,Y_=16196,J_=16197,K_=16198,Md=16199,Ed=16200,Q_=16201,ey=16202,ty=16203,ry=16204,iy=16205,pp=16206,ny=16207,sy=16208,In=16209,f0=16210,p0=16211,xx=852,wx=592,Sx=15,Tx=Sx,ay=p=>(p>>>24&255)+(p>>>8&65280)+((p&65280)<<8)+((p&255)<<24);function Px(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Pu=p=>{if(!p)return 1;const l=p.state;return!l||l.strm!==p||l.mode<Kd||l.mode>p0?1:0},m0=p=>{if(Pu(p))return hl;const l=p.state;return p.total_in=p.total_out=l.total=0,p.msg="",l.wrap&&(p.adler=l.wrap&1),l.mode=Kd,l.last=0,l.havedict=0,l.flags=-1,l.dmax=32768,l.head=null,l.hold=0,l.bits=0,l.lencode=l.lendyn=new Int32Array(xx),l.distcode=l.distdyn=new Int32Array(wx),l.sane=1,l.back=-1,Tu},g0=p=>{if(Pu(p))return hl;const l=p.state;return l.wsize=0,l.whave=0,l.wnext=0,m0(p)},_0=(p,l)=>{let u;if(Pu(p))return hl;const g=p.state;return l<0?(u=0,l=-l):(u=(l>>4)+5,l<48&&(l&=15)),l&&(l<8||l>15)?hl:(g.window!==null&&g.wbits!==l&&(g.window=null),g.wrap=u,g.wbits=l,g0(p))},y0=(p,l)=>{if(!p)return hl;const u=new Px;p.state=u,u.strm=p,u.window=null,u.mode=Kd;const g=_0(p,l);return g!==Tu&&(p.state=null),g},Ax=p=>y0(p,Tx);let oy=!0,mp,gp;const Ix=p=>{if(oy){mp=new Int32Array(512),gp=new Int32Array(32);let l=0;for(;l<144;)p.lens[l++]=8;for(;l<256;)p.lens[l++]=9;for(;l<280;)p.lens[l++]=7;for(;l<288;)p.lens[l++]=8;for(Uh(c0,p.lens,0,288,mp,0,p.work,{bits:9}),l=0;l<32;)p.lens[l++]=5;Uh(u0,p.lens,0,32,gp,0,p.work,{bits:5}),oy=!1}p.lencode=mp,p.lenbits=9,p.distcode=gp,p.distbits=5},v0=(p,l,u,g)=>{let v;const x=p.state;return x.window===null&&(x.wsize=1<<x.wbits,x.wnext=0,x.whave=0,x.window=new Uint8Array(x.wsize)),g>=x.wsize?(x.window.set(l.subarray(u-x.wsize,u),0),x.wnext=0,x.whave=x.wsize):(v=x.wsize-x.wnext,v>g&&(v=g),x.window.set(l.subarray(u-g,u-g+v),x.wnext),g-=v,g?(x.window.set(l.subarray(u-g,u),0),x.wnext=g,x.whave=x.wsize):(x.wnext+=v,x.wnext===x.wsize&&(x.wnext=0),x.whave<x.wsize&&(x.whave+=v))),0},Lx=(p,l)=>{let u,g,v,x,b,s,E,F,B,Q,ne,j,Ie,he,re=0,ye,Je,Be,De,Ue,$e,st,Ze;const Pe=new Uint8Array(4);let rt,_e;const we=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Pu(p)||!p.output||!p.input&&p.avail_in!==0)return hl;u=p.state,u.mode===vc&&(u.mode=dp),b=p.next_out,v=p.output,E=p.avail_out,x=p.next_in,g=p.input,s=p.avail_in,F=u.hold,B=u.bits,Q=s,ne=E,Ze=Tu;e:for(;;)switch(u.mode){case Kd:if(u.wrap===0){u.mode=dp;break}for(;B<16;){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}if(u.wrap&2&&F===35615){u.wbits===0&&(u.wbits=15),u.check=0,Pe[0]=F&255,Pe[1]=F>>>8&255,u.check=jl(u.check,Pe,2,0),F=0,B=0,u.mode=O_;break}if(u.head&&(u.head.done=!1),!(u.wrap&1)||(((F&255)<<8)+(F>>8))%31){p.msg="incorrect header check",u.mode=In;break}if((F&15)!==B_){p.msg="unknown compression method",u.mode=In;break}if(F>>>=4,B-=4,st=(F&15)+8,u.wbits===0&&(u.wbits=st),st>15||st>u.wbits){p.msg="invalid window size",u.mode=In;break}u.dmax=1<<u.wbits,u.flags=0,p.adler=u.check=1,u.mode=F&512?W_:vc,F=0,B=0;break;case O_:for(;B<16;){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}if(u.flags=F,(u.flags&255)!==B_){p.msg="unknown compression method",u.mode=In;break}if(u.flags&57344){p.msg="unknown header flags set",u.mode=In;break}u.head&&(u.head.text=F>>8&1),u.flags&512&&u.wrap&4&&(Pe[0]=F&255,Pe[1]=F>>>8&255,u.check=jl(u.check,Pe,2,0)),F=0,B=0,u.mode=j_;case j_:for(;B<32;){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}u.head&&(u.head.time=F),u.flags&512&&u.wrap&4&&(Pe[0]=F&255,Pe[1]=F>>>8&255,Pe[2]=F>>>16&255,Pe[3]=F>>>24&255,u.check=jl(u.check,Pe,4,0)),F=0,B=0,u.mode=V_;case V_:for(;B<16;){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}u.head&&(u.head.xflags=F&255,u.head.os=F>>8),u.flags&512&&u.wrap&4&&(Pe[0]=F&255,Pe[1]=F>>>8&255,u.check=jl(u.check,Pe,2,0)),F=0,B=0,u.mode=U_;case U_:if(u.flags&1024){for(;B<16;){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}u.length=F,u.head&&(u.head.extra_len=F),u.flags&512&&u.wrap&4&&(Pe[0]=F&255,Pe[1]=F>>>8&255,u.check=jl(u.check,Pe,2,0)),F=0,B=0}else u.head&&(u.head.extra=null);u.mode=q_;case q_:if(u.flags&1024&&(j=u.length,j>s&&(j=s),j&&(u.head&&(st=u.head.extra_len-u.length,u.head.extra||(u.head.extra=new Uint8Array(u.head.extra_len)),u.head.extra.set(g.subarray(x,x+j),st)),u.flags&512&&u.wrap&4&&(u.check=jl(u.check,g,j,x)),s-=j,x+=j,u.length-=j),u.length))break e;u.length=0,u.mode=G_;case G_:if(u.flags&2048){if(s===0)break e;j=0;do st=g[x+j++],u.head&&st&&u.length<65536&&(u.head.name+=String.fromCharCode(st));while(st&&j<s);if(u.flags&512&&u.wrap&4&&(u.check=jl(u.check,g,j,x)),s-=j,x+=j,st)break e}else u.head&&(u.head.name=null);u.length=0,u.mode=$_;case $_:if(u.flags&4096){if(s===0)break e;j=0;do st=g[x+j++],u.head&&st&&u.length<65536&&(u.head.comment+=String.fromCharCode(st));while(st&&j<s);if(u.flags&512&&u.wrap&4&&(u.check=jl(u.check,g,j,x)),s-=j,x+=j,st)break e}else u.head&&(u.head.comment=null);u.mode=Z_;case Z_:if(u.flags&512){for(;B<16;){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}if(u.wrap&4&&F!==(u.check&65535)){p.msg="header crc mismatch",u.mode=In;break}F=0,B=0}u.head&&(u.head.hcrc=u.flags>>9&1,u.head.done=!0),p.adler=u.check=0,u.mode=vc;break;case W_:for(;B<32;){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}p.adler=u.check=ay(F),F=0,B=0,u.mode=Zd;case Zd:if(u.havedict===0)return p.next_out=b,p.avail_out=E,p.next_in=x,p.avail_in=s,u.hold=F,u.bits=B,vx;p.adler=u.check=1,u.mode=vc;case vc:if(l===_x||l===Cd)break e;case dp:if(u.last){F>>>=B&7,B-=B&7,u.mode=pp;break}for(;B<3;){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}switch(u.last=F&1,F>>>=1,B-=1,F&3){case 0:u.mode=H_;break;case 1:if(Ix(u),u.mode=Md,l===Cd){F>>>=2,B-=2;break e}break;case 2:u.mode=Y_;break;case 3:p.msg="invalid block type",u.mode=In}F>>>=2,B-=2;break;case H_:for(F>>>=B&7,B-=B&7;B<32;){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}if((F&65535)!==(F>>>16^65535)){p.msg="invalid stored block lengths",u.mode=In;break}if(u.length=F&65535,F=0,B=0,u.mode=fp,l===Cd)break e;case fp:u.mode=X_;case X_:if(j=u.length,j){if(j>s&&(j=s),j>E&&(j=E),j===0)break e;v.set(g.subarray(x,x+j),b),s-=j,x+=j,E-=j,b+=j,u.length-=j;break}u.mode=vc;break;case Y_:for(;B<14;){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}if(u.nlen=(F&31)+257,F>>>=5,B-=5,u.ndist=(F&31)+1,F>>>=5,B-=5,u.ncode=(F&15)+4,F>>>=4,B-=4,u.nlen>286||u.ndist>30){p.msg="too many length or distance symbols",u.mode=In;break}u.have=0,u.mode=J_;case J_:for(;u.have<u.ncode;){for(;B<3;){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}u.lens[we[u.have++]]=F&7,F>>>=3,B-=3}for(;u.have<19;)u.lens[we[u.have++]]=0;if(u.lencode=u.lendyn,u.lenbits=7,rt={bits:u.lenbits},Ze=Uh(gx,u.lens,0,19,u.lencode,0,u.work,rt),u.lenbits=rt.bits,Ze){p.msg="invalid code lengths set",u.mode=In;break}u.have=0,u.mode=K_;case K_:for(;u.have<u.nlen+u.ndist;){for(;re=u.lencode[F&(1<<u.lenbits)-1],ye=re>>>24,Je=re>>>16&255,Be=re&65535,!(ye<=B);){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}if(Be<16)F>>>=ye,B-=ye,u.lens[u.have++]=Be;else{if(Be===16){for(_e=ye+2;B<_e;){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}if(F>>>=ye,B-=ye,u.have===0){p.msg="invalid bit length repeat",u.mode=In;break}st=u.lens[u.have-1],j=3+(F&3),F>>>=2,B-=2}else if(Be===17){for(_e=ye+3;B<_e;){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}F>>>=ye,B-=ye,st=0,j=3+(F&7),F>>>=3,B-=3}else{for(_e=ye+7;B<_e;){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}F>>>=ye,B-=ye,st=0,j=11+(F&127),F>>>=7,B-=7}if(u.have+j>u.nlen+u.ndist){p.msg="invalid bit length repeat",u.mode=In;break}for(;j--;)u.lens[u.have++]=st}}if(u.mode===In)break;if(u.lens[256]===0){p.msg="invalid code -- missing end-of-block",u.mode=In;break}if(u.lenbits=9,rt={bits:u.lenbits},Ze=Uh(c0,u.lens,0,u.nlen,u.lencode,0,u.work,rt),u.lenbits=rt.bits,Ze){p.msg="invalid literal/lengths set",u.mode=In;break}if(u.distbits=6,u.distcode=u.distdyn,rt={bits:u.distbits},Ze=Uh(u0,u.lens,u.nlen,u.ndist,u.distcode,0,u.work,rt),u.distbits=rt.bits,Ze){p.msg="invalid distances set",u.mode=In;break}if(u.mode=Md,l===Cd)break e;case Md:u.mode=Ed;case Ed:if(s>=6&&E>=258){p.next_out=b,p.avail_out=E,p.next_in=x,p.avail_in=s,u.hold=F,u.bits=B,ux(p,ne),b=p.next_out,v=p.output,E=p.avail_out,x=p.next_in,g=p.input,s=p.avail_in,F=u.hold,B=u.bits,u.mode===vc&&(u.back=-1);break}for(u.back=0;re=u.lencode[F&(1<<u.lenbits)-1],ye=re>>>24,Je=re>>>16&255,Be=re&65535,!(ye<=B);){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}if(Je&&(Je&240)===0){for(De=ye,Ue=Je,$e=Be;re=u.lencode[$e+((F&(1<<De+Ue)-1)>>De)],ye=re>>>24,Je=re>>>16&255,Be=re&65535,!(De+ye<=B);){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}F>>>=De,B-=De,u.back+=De}if(F>>>=ye,B-=ye,u.back+=ye,u.length=Be,Je===0){u.mode=iy;break}if(Je&32){u.back=-1,u.mode=vc;break}if(Je&64){p.msg="invalid literal/length code",u.mode=In;break}u.extra=Je&15,u.mode=Q_;case Q_:if(u.extra){for(_e=u.extra;B<_e;){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}u.length+=F&(1<<u.extra)-1,F>>>=u.extra,B-=u.extra,u.back+=u.extra}u.was=u.length,u.mode=ey;case ey:for(;re=u.distcode[F&(1<<u.distbits)-1],ye=re>>>24,Je=re>>>16&255,Be=re&65535,!(ye<=B);){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}if((Je&240)===0){for(De=ye,Ue=Je,$e=Be;re=u.distcode[$e+((F&(1<<De+Ue)-1)>>De)],ye=re>>>24,Je=re>>>16&255,Be=re&65535,!(De+ye<=B);){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}F>>>=De,B-=De,u.back+=De}if(F>>>=ye,B-=ye,u.back+=ye,Je&64){p.msg="invalid distance code",u.mode=In;break}u.offset=Be,u.extra=Je&15,u.mode=ty;case ty:if(u.extra){for(_e=u.extra;B<_e;){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}u.offset+=F&(1<<u.extra)-1,F>>>=u.extra,B-=u.extra,u.back+=u.extra}if(u.offset>u.dmax){p.msg="invalid distance too far back",u.mode=In;break}u.mode=ry;case ry:if(E===0)break e;if(j=ne-E,u.offset>j){if(j=u.offset-j,j>u.whave&&u.sane){p.msg="invalid distance too far back",u.mode=In;break}j>u.wnext?(j-=u.wnext,Ie=u.wsize-j):Ie=u.wnext-j,j>u.length&&(j=u.length),he=u.window}else he=v,Ie=b-u.offset,j=u.length;j>E&&(j=E),E-=j,u.length-=j;do v[b++]=he[Ie++];while(--j);u.length===0&&(u.mode=Ed);break;case iy:if(E===0)break e;v[b++]=u.length,E--,u.mode=Ed;break;case pp:if(u.wrap){for(;B<32;){if(s===0)break e;s--,F|=g[x++]<<B,B+=8}if(ne-=E,p.total_out+=ne,u.total+=ne,u.wrap&4&&ne&&(p.adler=u.check=u.flags?jl(u.check,v,ne,b-ne):Np(u.check,v,ne,b-ne)),ne=E,u.wrap&4&&(u.flags?F:ay(F))!==u.check){p.msg="incorrect data check",u.mode=In;break}F=0,B=0}u.mode=ny;case ny:if(u.wrap&&u.flags){for(;B<32;){if(s===0)break e;s--,F+=g[x++]<<B,B+=8}if(u.wrap&4&&F!==(u.total&4294967295)){p.msg="incorrect length check",u.mode=In;break}F=0,B=0}u.mode=sy;case sy:Ze=yx;break e;case In:Ze=h0;break e;case f0:return d0;case p0:default:return hl}return p.next_out=b,p.avail_out=E,p.next_in=x,p.avail_in=s,u.hold=F,u.bits=B,(u.wsize||ne!==p.avail_out&&u.mode<In&&(u.mode<pp||l!==R_))&&v0(p,p.output,p.next_out,ne-p.avail_out),Q-=p.avail_in,ne-=p.avail_out,p.total_in+=Q,p.total_out+=ne,u.total+=ne,u.wrap&4&&ne&&(p.adler=u.check=u.flags?jl(u.check,v,ne,p.next_out-ne):Np(u.check,v,ne,p.next_out-ne)),p.data_type=u.bits+(u.last?64:0)+(u.mode===vc?128:0)+(u.mode===Md||u.mode===fp?256:0),(Q===0&&ne===0||l===R_)&&Ze===Tu&&(Ze=bx),Ze},Cx=p=>{if(Pu(p))return hl;let l=p.state;return l.window&&(l.window=null),p.state=null,Tu},Mx=(p,l)=>{if(Pu(p))return hl;const u=p.state;return(u.wrap&2)===0?hl:(u.head=l,l.done=!1,Tu)},Ex=(p,l)=>{const u=l.length;let g,v,x;return Pu(p)||(g=p.state,g.wrap!==0&&g.mode!==Zd)?hl:g.mode===Zd&&(v=1,v=Np(v,l,u,0),v!==g.check)?h0:(x=v0(p,l,u,u),x?(g.mode=f0,d0):(g.havedict=1,Tu))};var kx=g0,Dx=_0,Fx=m0,zx=Ax,Nx=y0,Rx=Lx,Bx=Cx,Ox=Mx,jx=Ex,Vx="pako inflate (from Nodeca project)",bc={inflateReset:kx,inflateReset2:Dx,inflateResetKeep:Fx,inflateInit:zx,inflateInit2:Nx,inflate:Rx,inflateEnd:Bx,inflateGetHeader:Ox,inflateSetDictionary:jx,inflateInfo:Vx};function Ux(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var qx=Ux;const b0=Object.prototype.toString,{Z_NO_FLUSH:Gx,Z_FINISH:$x,Z_OK:Zh,Z_STREAM_END:_p,Z_NEED_DICT:yp,Z_STREAM_ERROR:Zx,Z_DATA_ERROR:ly,Z_MEM_ERROR:Wx}=a0;function Wh(p){this.options=o0.assign({chunkSize:1024*64,windowBits:15,to:""},p||{});const l=this.options;l.raw&&l.windowBits>=0&&l.windowBits<16&&(l.windowBits=-l.windowBits,l.windowBits===0&&(l.windowBits=-15)),l.windowBits>=0&&l.windowBits<16&&!(p&&p.windowBits)&&(l.windowBits+=32),l.windowBits>15&&l.windowBits<48&&(l.windowBits&15)===0&&(l.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new lx,this.strm.avail_out=0;let u=bc.inflateInit2(this.strm,l.windowBits);if(u!==Zh)throw new Error(Rp[u]);if(this.header=new qx,bc.inflateGetHeader(this.strm,this.header),l.dictionary&&(typeof l.dictionary=="string"?l.dictionary=Bp.string2buf(l.dictionary):b0.call(l.dictionary)==="[object ArrayBuffer]"&&(l.dictionary=new Uint8Array(l.dictionary)),l.raw&&(u=bc.inflateSetDictionary(this.strm,l.dictionary),u!==Zh)))throw new Error(Rp[u])}Wh.prototype.push=function(p,l){const u=this.strm,g=this.options.chunkSize,v=this.options.dictionary;let x,b,s;if(this.ended)return!1;for(l===~~l?b=l:b=l===!0?$x:Gx,b0.call(p)==="[object ArrayBuffer]"?u.input=new Uint8Array(p):u.input=p,u.next_in=0,u.avail_in=u.input.length;;){for(u.avail_out===0&&(u.output=new Uint8Array(g),u.next_out=0,u.avail_out=g),x=bc.inflate(u,b),x===yp&&v&&(x=bc.inflateSetDictionary(u,v),x===Zh?x=bc.inflate(u,b):x===ly&&(x=yp));u.avail_in>0&&x===_p&&u.state.wrap>0&&p[u.next_in]!==0;)bc.inflateReset(u),x=bc.inflate(u,b);switch(x){case Zx:case ly:case yp:case Wx:return this.onEnd(x),this.ended=!0,!1}if(s=u.avail_out,u.next_out&&(u.avail_out===0||x===_p))if(this.options.to==="string"){let E=Bp.utf8border(u.output,u.next_out),F=u.next_out-E,B=Bp.buf2string(u.output,E);u.next_out=F,u.avail_out=g-F,F&&u.output.set(u.output.subarray(E,E+F),0),this.onData(B)}else this.onData(u.output.length===u.next_out?u.output:u.output.subarray(0,u.next_out));if(!(x===Zh&&s===0)){if(x===_p)return x=bc.inflateEnd(this.strm),this.onEnd(x),this.ended=!0,!0;if(u.avail_in===0)break}}return!0};Wh.prototype.onData=function(p){this.chunks.push(p)};Wh.prototype.onEnd=function(p){p===Zh&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o0.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg};function Hx(p,l){const u=new Wh(l);if(u.push(p),u.err)throw u.msg||Rp[u.err];return u.result}var Xx=Wh,Yx=Hx,Jx={Inflate:Xx,inflate:Yx};const{Inflate:Kx,inflate:Qx}=Jx;var cy=Kx,ew=Qx;const x0=[];for(let p=0;p<256;p++){let l=p;for(let u=0;u<8;u++)l&1?l=3988292384^l>>>1:l=l>>>1;x0[p]=l}const uy=4294967295;function tw(p,l,u){let g=p;for(let v=0;v<u;v++)g=x0[(g^l[v])&255]^g>>>8;return g}function rw(p,l){return(tw(uy,p,l)^uy)>>>0}function hy(p,l,u){const g=p.readUint32(),v=rw(new Uint8Array(p.buffer,p.byteOffset+p.offset-l-4,l),l);if(v!==g)throw new Error(`CRC mismatch for chunk ${u}. Expected ${g}, found ${v}`)}function w0(p,l,u){for(let g=0;g<u;g++)l[g]=p[g]}function S0(p,l,u,g){let v=0;for(;v<g;v++)l[v]=p[v];for(;v<u;v++)l[v]=p[v]+l[v-g]&255}function T0(p,l,u,g){let v=0;if(u.length===0)for(;v<g;v++)l[v]=p[v];else for(;v<g;v++)l[v]=p[v]+u[v]&255}function P0(p,l,u,g,v){let x=0;if(u.length===0){for(;x<v;x++)l[x]=p[x];for(;x<g;x++)l[x]=p[x]+(l[x-v]>>1)&255}else{for(;x<v;x++)l[x]=p[x]+(u[x]>>1)&255;for(;x<g;x++)l[x]=p[x]+(l[x-v]+u[x]>>1)&255}}function A0(p,l,u,g,v){let x=0;if(u.length===0){for(;x<v;x++)l[x]=p[x];for(;x<g;x++)l[x]=p[x]+l[x-v]&255}else{for(;x<v;x++)l[x]=p[x]+u[x]&255;for(;x<g;x++)l[x]=p[x]+iw(l[x-v],u[x],u[x-v])&255}}function iw(p,l,u){const g=p+l-u,v=Math.abs(g-p),x=Math.abs(g-l),b=Math.abs(g-u);return v<=x&&v<=b?p:x<=b?l:u}function nw(p,l,u,g,v,x){switch(p){case 0:w0(l,u,v);break;case 1:S0(l,u,v,x);break;case 2:T0(l,u,g,v);break;case 3:P0(l,u,g,v,x);break;case 4:A0(l,u,g,v,x);break;default:throw new Error(`Unsupported filter: ${p}`)}}const sw=new Uint16Array([255]),aw=new Uint8Array(sw.buffer),ow=aw[0]===255;function lw(p){const{data:l,width:u,height:g,channels:v,depth:x}=p,b=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],s=Math.ceil(x/8)*v,E=new Uint8Array(g*u*s);let F=0;for(let B=0;B<7;B++){const Q=b[B],ne=Math.ceil((u-Q.x)/Q.xStep),j=Math.ceil((g-Q.y)/Q.yStep);if(ne<=0||j<=0)continue;const Ie=ne*s,he=new Uint8Array(Ie);for(let re=0;re<j;re++){const ye=l[F++],Je=l.subarray(F,F+Ie);F+=Ie;const Be=new Uint8Array(Ie);nw(ye,Je,Be,he,Ie,s),he.set(Be);for(let De=0;De<ne;De++){const Ue=Q.x+De*Q.xStep,$e=Q.y+re*Q.yStep;if(!(Ue>=u||$e>=g))for(let st=0;st<s;st++)E[($e*u+Ue)*s+st]=Be[De*s+st]}}}if(x===16){const B=new Uint16Array(E.buffer);if(ow)for(let Q=0;Q<B.length;Q++)B[Q]=cw(B[Q]);return B}else return E}function cw(p){return(p&255)<<8|p>>8&255}const uw=new Uint16Array([255]),hw=new Uint8Array(uw.buffer),dw=hw[0]===255,fw=new Uint8Array(0);function dy(p){const{data:l,width:u,height:g,channels:v,depth:x}=p,b=Math.ceil(x/8)*v,s=Math.ceil(x/8*v*u),E=new Uint8Array(g*s);let F=fw,B=0,Q,ne;for(let j=0;j<g;j++){switch(Q=l.subarray(B+1,B+1+s),ne=E.subarray(j*s,(j+1)*s),l[B]){case 0:w0(Q,ne,s);break;case 1:S0(Q,ne,s,b);break;case 2:T0(Q,ne,F,s);break;case 3:P0(Q,ne,F,s,b);break;case 4:A0(Q,ne,F,s,b);break;default:throw new Error(`Unsupported filter: ${l[B]}`)}F=ne,B+=s+1}if(x===16){const j=new Uint16Array(E.buffer);if(dw)for(let Ie=0;Ie<j.length;Ie++)j[Ie]=pw(j[Ie]);return j}else return E}function pw(p){return(p&255)<<8|p>>8&255}const Od=Uint8Array.of(137,80,78,71,13,10,26,10);function fy(p){if(!mw(p.readBytes(Od.length)))throw new Error("wrong PNG signature")}function mw(p){if(p.length<Od.length)return!1;for(let l=0;l<Od.length;l++)if(p[l]!==Od[l])return!1;return!0}const gw="tEXt",_w=0,I0=new TextDecoder("latin1");function yw(p){if(bw(p),p.length===0||p.length>79)throw new Error("keyword length must be between 1 and 79")}const vw=/^[\u0000-\u00FF]*$/;function bw(p){if(!vw.test(p))throw new Error("invalid latin1 text")}function xw(p,l,u){const g=L0(l);p[g]=ww(l,u-g.length-1)}function L0(p){for(p.mark();p.readByte()!==_w;);const l=p.offset;p.reset();const u=I0.decode(p.readBytes(l-p.offset-1));return p.skip(1),yw(u),u}function ww(p,l){return I0.decode(p.readBytes(l))}const lo={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},vp={UNKNOWN:-1,DEFLATE:0},py={UNKNOWN:-1,ADAPTIVE:0},bp={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},kd={NONE:0,BACKGROUND:1,PREVIOUS:2},xp={SOURCE:0,OVER:1};class Sw extends Xp{_checkCrc;_inflator;_png;_apng;_end;_hasPalette;_palette;_hasTransparency;_transparency;_compressionMethod;_filterMethod;_interlaceMethod;_colorType;_isAnimated;_numberOfFrames;_numberOfPlays;_frames;_writingDataChunks;constructor(l,u={}){super(l);const{checkCrc:g=!1}=u;this._checkCrc=g,this._inflator=new cy,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=vp.UNKNOWN,this._filterMethod=py.UNKNOWN,this._interlaceMethod=bp.UNKNOWN,this._colorType=lo.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(fy(this);!this._end;){const l=this.readUint32(),u=this.readChars(4);this.decodeChunk(l,u)}return this.decodeImage(),this._png}decodeApng(){for(fy(this);!this._end;){const l=this.readUint32(),u=this.readChars(4);this.decodeApngChunk(l,u)}return this.decodeApngImage(),this._apng}decodeChunk(l,u){const g=this.offset;switch(u){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(l);break;case"IDAT":this.decodeIDAT(l);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(l);break;case"iCCP":this.decodeiCCP(l);break;case gw:xw(this._png.text,this,l);break;case"pHYs":this.decodepHYs();break;default:this.skip(l);break}if(this.offset-g!==l)throw new Error(`Length mismatch while decoding chunk ${u}`);this._checkCrc?hy(this,l+4,u):this.skip(4)}decodeApngChunk(l,u){const g=this.offset;switch(u!=="fdAT"&&u!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),u){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(l);break;default:this.decodeChunk(l,u),this.offset=g+l;break}if(this.offset-g!==l)throw new Error(`Length mismatch while decoding chunk ${u}`);this._checkCrc?hy(this,l+4,u):this.skip(4)}decodeIHDR(){const l=this._png;l.width=this.readUint32(),l.height=this.readUint32(),l.depth=Tw(this.readUint8());const u=this.readUint8();this._colorType=u;let g;switch(u){case lo.GREYSCALE:g=1;break;case lo.TRUECOLOUR:g=3;break;case lo.INDEXED_COLOUR:g=1;break;case lo.GREYSCALE_ALPHA:g=2;break;case lo.TRUECOLOUR_ALPHA:g=4;break;case lo.UNKNOWN:default:throw new Error(`Unknown color type: ${u}`)}if(this._png.channels=g,this._compressionMethod=this.readUint8(),this._compressionMethod!==vp.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const l={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(l)}decodePLTE(l){if(l%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${l}`);const u=l/3;this._hasPalette=!0;const g=[];this._palette=g;for(let v=0;v<u;v++)g.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(l){this._writingDataChunks=!0;const u=l,g=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,g,u)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(l)}decodeFDAT(l){this._writingDataChunks=!0;let u=l,g=this.offset+this.byteOffset;if(g+=4,u-=4,this._inflator.push(new Uint8Array(this.buffer,g,u)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(l)}decodetRNS(l){switch(this._colorType){case lo.GREYSCALE:case lo.TRUECOLOUR:{if(l%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${l}`);if(l/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${l/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(l/2);for(let u=0;u<l/2;u++)this._transparency[u]=this.readUint16();break}case lo.INDEXED_COLOUR:{if(l>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${l} vs ${this._palette.length})`);let u=0;for(;u<l;u++){const g=this.readByte();this._palette[u].push(g)}for(;u<this._palette.length;u++)this._palette[u].push(255);break}case lo.UNKNOWN:case lo.GREYSCALE_ALPHA:case lo.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(l){const u=L0(this),g=this.readUint8();if(g!==vp.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${g}`);const v=this.readBytes(l-u.length-2);this._png.iccEmbeddedProfile={name:u,profile:ew(v)}}decodepHYs(){const l=this.readUint32(),u=this.readUint32(),g=this.readByte();this._png.resolution={x:l,y:u,unit:g}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let l=0;l<this._numberOfFrames;l++){const u={sequenceNumber:this._frames[l].sequenceNumber,delayNumber:this._frames[l].delayNumber,delayDenominator:this._frames[l].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},g=this._frames.at(l);if(g){if(g.data=dy({data:g.data,width:g.width,height:g.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),l===0||g.xOffset===0&&g.yOffset===0&&g.width===this._png.width&&g.height===this._png.height)u.data=g.data;else{const v=this._apng.frames.at(l-1);this.disposeFrame(g,v,u),this.addFrameDataToCanvas(u,g)}this._apng.frames.push(u)}}return this._apng}disposeFrame(l,u,g){switch(l.disposeOp){case kd.NONE:break;case kd.BACKGROUND:for(let v=0;v<this._png.height;v++)for(let x=0;x<this._png.width;x++){const b=(v*l.width+x)*this._png.channels;for(let s=0;s<this._png.channels;s++)g.data[b+s]=0}break;case kd.PREVIOUS:g.data.set(u.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(l,u){const g=1<<this._png.depth,v=(x,b)=>{const s=((x+u.yOffset)*this._png.width+u.xOffset+b)*this._png.channels,E=(x*u.width+b)*this._png.channels;return{index:s,frameIndex:E}};switch(u.blendOp){case xp.SOURCE:for(let x=0;x<u.height;x++)for(let b=0;b<u.width;b++){const{index:s,frameIndex:E}=v(x,b);for(let F=0;F<this._png.channels;F++)l.data[s+F]=u.data[E+F]}break;case xp.OVER:for(let x=0;x<u.height;x++)for(let b=0;b<u.width;b++){const{index:s,frameIndex:E}=v(x,b);for(let F=0;F<this._png.channels;F++){const B=u.data[E+this._png.channels-1]/g,Q=F%(this._png.channels-1)===0?1:u.data[E+F],ne=Math.floor(B*Q+(1-B)*l.data[s+F]);l.data[s+F]+=ne}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const l=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(this._filterMethod!==py.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===bp.NO_INTERLACE)this._png.data=dy({data:l,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===bp.ADAM7)this._png.data=lw({data:l,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const l=this._inflator.result,u=this._frames.at(-1);u?u.data=l:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:kd.NONE,blendOp:xp.SOURCE,data:l}),this._inflator=new cy,this._writingDataChunks=!1}}function Tw(p){if(p!==1&&p!==2&&p!==4&&p!==8&&p!==16)throw new Error(`invalid bit depth: ${p}`);return p}var my;(function(p){p[p.UNKNOWN=0]="UNKNOWN",p[p.METRE=1]="METRE"})(my||(my={}));function Pw(p,l){return new Sw(p,l).decode()}var ti=(function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this})();function wp(){ti.console&&typeof ti.console.log=="function"&&ti.console.log.apply(ti.console,arguments)}var on={log:wp,warn:function(p){ti.console&&(typeof ti.console.warn=="function"?ti.console.warn.apply(ti.console,arguments):wp.call(null,arguments))},error:function(p){ti.console&&(typeof ti.console.error=="function"?ti.console.error.apply(ti.console,arguments):wp(p))}};function Sp(p,l,u){var g=new XMLHttpRequest;g.open("GET",p),g.responseType="blob",g.onload=function(){bu(g.response,l,u)},g.onerror=function(){on.error("could not download file")},g.send()}function gy(p){var l=new XMLHttpRequest;l.open("HEAD",p,!1);try{l.send()}catch{}return l.status>=200&&l.status<=299}function Dd(p){try{p.dispatchEvent(new MouseEvent("click"))}catch{var l=document.createEvent("MouseEvents");l.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),p.dispatchEvent(l)}}var bu=ti.saveAs||((typeof window>"u"?"undefined":Wi(window))!=="object"||window!==ti?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(p,l,u){var g=ti.URL||ti.webkitURL,v=document.createElement("a");l=l||p.name||"download",v.download=l,v.rel="noopener",typeof p=="string"?(v.href=p,v.origin!==location.origin?gy(v.href)?Sp(p,l,u):Dd(v,v.target="_blank"):Dd(v)):(v.href=g.createObjectURL(p),setTimeout(function(){g.revokeObjectURL(v.href)},4e4),setTimeout(function(){Dd(v)},0))}:"msSaveOrOpenBlob"in navigator?function(p,l,u){if(l=l||p.name||"download",typeof p=="string")if(gy(p))Sp(p,l,u);else{var g=document.createElement("a");g.href=p,g.target="_blank",setTimeout(function(){Dd(g)})}else navigator.msSaveOrOpenBlob((function(v,x){return x===void 0?x={autoBom:!1}:Wi(x)!=="object"&&(on.warn("Deprecated: Expected third argument to be a object"),x={autoBom:!x}),x.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(v.type)?new Blob(["\uFEFF",v],{type:v.type}):v})(p,u),l)}:function(p,l,u,g){if((g=g||open("","_blank"))&&(g.document.title=g.document.body.innerText="downloading..."),typeof p=="string")return Sp(p,l,u);var v=p.type==="application/octet-stream",x=/constructor/i.test(ti.HTMLElement)||ti.safari,b=/CriOS\/[\d]+/.test(navigator.userAgent);if((b||v&&x)&&(typeof FileReader>"u"?"undefined":Wi(FileReader))==="object"){var s=new FileReader;s.onloadend=function(){var B=s.result;B=b?B:B.replace(/^data:[^;]*;/,"data:attachment/file;"),g?g.location.href=B:location=B,g=null},s.readAsDataURL(p)}else{var E=ti.URL||ti.webkitURL,F=E.createObjectURL(p);g?g.location=F:location.href=F,g=null,setTimeout(function(){E.revokeObjectURL(F)},4e4)}});function C0(p){var l;p=p||"",this.ok=!1,p.charAt(0)=="#"&&(p=p.substr(1,6)),p={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[p=(p=p.replace(/ /g,"")).toLowerCase()]||p;for(var u=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(s){return[parseInt(s[1]),parseInt(s[2]),parseInt(s[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(s){return[parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(s){return[parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16),parseInt(s[3]+s[3],16)]}}],g=0;g<u.length;g++){var v=u[g].re,x=u[g].process,b=v.exec(p);b&&(l=x(b),this.r=l[0],this.g=l[1],this.b=l[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var s=this.r.toString(16),E=this.g.toString(16),F=this.b.toString(16);return s.length==1&&(s="0"+s),E.length==1&&(E="0"+E),F.length==1&&(F="0"+F),"#"+s+E+F}}var jd=ti.atob.bind(ti),_y=ti.btoa.bind(ti);function Tp(p,l){var u=p[0],g=p[1],v=p[2],x=p[3];u=ia(u,g,v,x,l[0],7,-680876936),x=ia(x,u,g,v,l[1],12,-389564586),v=ia(v,x,u,g,l[2],17,606105819),g=ia(g,v,x,u,l[3],22,-1044525330),u=ia(u,g,v,x,l[4],7,-176418897),x=ia(x,u,g,v,l[5],12,1200080426),v=ia(v,x,u,g,l[6],17,-1473231341),g=ia(g,v,x,u,l[7],22,-45705983),u=ia(u,g,v,x,l[8],7,1770035416),x=ia(x,u,g,v,l[9],12,-1958414417),v=ia(v,x,u,g,l[10],17,-42063),g=ia(g,v,x,u,l[11],22,-1990404162),u=ia(u,g,v,x,l[12],7,1804603682),x=ia(x,u,g,v,l[13],12,-40341101),v=ia(v,x,u,g,l[14],17,-1502002290),u=na(u,g=ia(g,v,x,u,l[15],22,1236535329),v,x,l[1],5,-165796510),x=na(x,u,g,v,l[6],9,-1069501632),v=na(v,x,u,g,l[11],14,643717713),g=na(g,v,x,u,l[0],20,-373897302),u=na(u,g,v,x,l[5],5,-701558691),x=na(x,u,g,v,l[10],9,38016083),v=na(v,x,u,g,l[15],14,-660478335),g=na(g,v,x,u,l[4],20,-405537848),u=na(u,g,v,x,l[9],5,568446438),x=na(x,u,g,v,l[14],9,-1019803690),v=na(v,x,u,g,l[3],14,-187363961),g=na(g,v,x,u,l[8],20,1163531501),u=na(u,g,v,x,l[13],5,-1444681467),x=na(x,u,g,v,l[2],9,-51403784),v=na(v,x,u,g,l[7],14,1735328473),u=sa(u,g=na(g,v,x,u,l[12],20,-1926607734),v,x,l[5],4,-378558),x=sa(x,u,g,v,l[8],11,-2022574463),v=sa(v,x,u,g,l[11],16,1839030562),g=sa(g,v,x,u,l[14],23,-35309556),u=sa(u,g,v,x,l[1],4,-1530992060),x=sa(x,u,g,v,l[4],11,1272893353),v=sa(v,x,u,g,l[7],16,-155497632),g=sa(g,v,x,u,l[10],23,-1094730640),u=sa(u,g,v,x,l[13],4,681279174),x=sa(x,u,g,v,l[0],11,-358537222),v=sa(v,x,u,g,l[3],16,-722521979),g=sa(g,v,x,u,l[6],23,76029189),u=sa(u,g,v,x,l[9],4,-640364487),x=sa(x,u,g,v,l[12],11,-421815835),v=sa(v,x,u,g,l[15],16,530742520),u=aa(u,g=sa(g,v,x,u,l[2],23,-995338651),v,x,l[0],6,-198630844),x=aa(x,u,g,v,l[7],10,1126891415),v=aa(v,x,u,g,l[14],15,-1416354905),g=aa(g,v,x,u,l[5],21,-57434055),u=aa(u,g,v,x,l[12],6,1700485571),x=aa(x,u,g,v,l[3],10,-1894986606),v=aa(v,x,u,g,l[10],15,-1051523),g=aa(g,v,x,u,l[1],21,-2054922799),u=aa(u,g,v,x,l[8],6,1873313359),x=aa(x,u,g,v,l[15],10,-30611744),v=aa(v,x,u,g,l[6],15,-1560198380),g=aa(g,v,x,u,l[13],21,1309151649),u=aa(u,g,v,x,l[4],6,-145523070),x=aa(x,u,g,v,l[11],10,-1120210379),v=aa(v,x,u,g,l[2],15,718787259),g=aa(g,v,x,u,l[9],21,-343485551),p[0]=Wc(u,p[0]),p[1]=Wc(g,p[1]),p[2]=Wc(v,p[2]),p[3]=Wc(x,p[3])}function Qd(p,l,u,g,v,x){return l=Wc(Wc(l,p),Wc(g,x)),Wc(l<<v|l>>>32-v,u)}function ia(p,l,u,g,v,x,b){return Qd(l&u|~l&g,p,l,v,x,b)}function na(p,l,u,g,v,x,b){return Qd(l&g|u&~g,p,l,v,x,b)}function sa(p,l,u,g,v,x,b){return Qd(l^u^g,p,l,v,x,b)}function aa(p,l,u,g,v,x,b){return Qd(u^(l|~g),p,l,v,x,b)}function M0(p){var l,u=p.length,g=[1732584193,-271733879,-1732584194,271733878];for(l=64;l<=p.length;l+=64)Tp(g,Aw(p.substring(l-64,l)));p=p.substring(l-64);var v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(l=0;l<p.length;l++)v[l>>2]|=p.charCodeAt(l)<<(l%4<<3);if(v[l>>2]|=128<<(l%4<<3),l>55)for(Tp(g,v),l=0;l<16;l++)v[l]=0;return v[14]=8*u,Tp(g,v),g}function Aw(p){var l,u=[];for(l=0;l<64;l+=4)u[l>>2]=p.charCodeAt(l)+(p.charCodeAt(l+1)<<8)+(p.charCodeAt(l+2)<<16)+(p.charCodeAt(l+3)<<24);return u}var yy="0123456789abcdef".split("");function Iw(p){for(var l="",u=0;u<4;u++)l+=yy[p>>8*u+4&15]+yy[p>>8*u&15];return l}function Lw(p){return String.fromCharCode(255&p,(65280&p)>>8,(16711680&p)>>16,(4278190080&p)>>24)}function Op(p){return M0(p).map(Lw).join("")}var Cw=(function(p){for(var l=0;l<p.length;l++)p[l]=Iw(p[l]);return p.join("")})(M0("hello"))!="5d41402abc4b2a76b9719d911017c592";function Wc(p,l){if(Cw){var u=(65535&p)+(65535&l);return(p>>16)+(l>>16)+(u>>16)<<16|65535&u}return p+l&4294967295}function jp(p,l){var u,g,v,x;if(p!==u){for(var b=(v=p,x=1+(256/p.length|0),new Array(x+1).join(v)),s=[],E=0;E<256;E++)s[E]=E;var F=0;for(E=0;E<256;E++){var B=s[E];F=(F+B+b.charCodeAt(E))%256,s[E]=s[F],s[F]=B}u=p,g=s}else s=g;var Q=l.length,ne=0,j=0,Ie="";for(E=0;E<Q;E++)j=(j+(B=s[ne=(ne+1)%256]))%256,s[ne]=s[j],s[j]=B,b=s[(s[ne]+s[j])%256],Ie+=String.fromCharCode(l.charCodeAt(E)^b);return Ie}var vy={print:4,modify:8,copy:16,"annot-forms":32};function ih(p,l,u,g){this.v=1,this.r=2;var v=192;p.forEach(function(s){if(vy.perm!==void 0)throw new Error("Invalid permission: "+s);v+=vy[s]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var x=(l+this.padding).substr(0,32),b=(u+this.padding).substr(0,32);this.O=this.processOwnerPassword(x,b),this.P=-(1+(255^v)),this.encryptionKey=Op(x+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(g)).substr(0,5),this.U=jp(this.encryptionKey,this.padding)}function nh(p){if(/[^\u0000-\u00ff]/.test(p))throw new Error("Invalid PDF Name Object: "+p+", Only accept ASCII characters.");for(var l="",u=p.length,g=0;g<u;g++){var v=p.charCodeAt(g);l+=v<33||v===35||v===37||v===40||v===41||v===47||v===60||v===62||v===91||v===93||v===123||v===125||v>126?"#"+("0"+v.toString(16)).slice(-2):p[g]}return l}function by(p){if(Wi(p)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var l={};this.subscribe=function(u,g,v){if(v=v||!1,typeof u!="string"||typeof g!="function"||typeof v!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");l.hasOwnProperty(u)||(l[u]={});var x=Math.random().toString(35);return l[u][x]=[g,!!v],x},this.unsubscribe=function(u){for(var g in l)if(l[g][u])return delete l[g][u],Object.keys(l[g]).length===0&&delete l[g],!0;return!1},this.publish=function(u){if(l.hasOwnProperty(u)){var g=Array.prototype.slice.call(arguments,1),v=[];for(var x in l[u]){var b=l[u][x];try{b[0].apply(p,g)}catch(s){ti.console&&on.error("jsPDF PubSub Error",s.message,s)}b[1]&&v.push(x)}v.length&&v.forEach(this.unsubscribe)}},this.getTopics=function(){return l}}function Wd(p){if(!(this instanceof Wd))return new Wd(p);var l="opacity,stroke-opacity".split(",");for(var u in p)p.hasOwnProperty(u)&&l.indexOf(u)>=0&&(this[u]=p[u]);this.id="",this.objectNumber=-1}function E0(p,l){this.gState=p,this.matrix=l,this.id="",this.objectNumber=-1}function xu(p,l,u,g,v){if(!(this instanceof xu))return new xu(p,l,u,g,v);this.type=p==="axial"?2:3,this.coords=l,this.colors=u,E0.call(this,g,v)}function oh(p,l,u,g,v){if(!(this instanceof oh))return new oh(p,l,u,g,v);this.boundingBox=p,this.xStep=l,this.yStep=u,this.stream="",this.cloneIndex=0,E0.call(this,g,v)}function jr(p){var l,u=typeof arguments[0]=="string"?arguments[0]:"p",g=arguments[1],v=arguments[2],x=arguments[3],b=[],s=1,E=16,F="S",B=null;Wi(p=p||{})==="object"&&(u=p.orientation,g=p.unit||g,v=p.format||v,x=p.compress||p.compressPdf||x,(B=p.encryption||null)!==null&&(B.userPassword=B.userPassword||"",B.ownerPassword=B.ownerPassword||"",B.userPermissions=B.userPermissions||[]),s=typeof p.userUnit=="number"?Math.abs(p.userUnit):1,p.precision!==void 0&&(l=p.precision),p.floatPrecision!==void 0&&(E=p.floatPrecision),F=p.defaultPathOperation||"S"),b=p.filters||(x===!0?["FlateEncode"]:b),g=g||"mm",u=(""+(u||"P")).toLowerCase();var Q=p.putOnlyUsedFonts||!1,ne={},j={internal:{},__private__:{}};j.__private__.PubSub=by;var Ie="1.3",he=j.__private__.getPdfVersion=function(){return Ie};j.__private__.setPdfVersion=function(N){Ie=N};var re={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};j.__private__.getPageFormats=function(){return re};var ye=j.__private__.getPageFormat=function(N){return re[N]};v=v||"a4";var Je="compat",Be="advanced",De=Je;function Ue(){this.saveGraphicsState(),Le(new Ct(Qe,0,0,-Qe,0,Zs()*Qe).toString()+" cm"),this.setFontSize(this.getFontSize()/Qe),F="n",De=Be}function $e(){this.restoreGraphicsState(),F="S",De=Je}var st=j.__private__.combineFontStyleAndFontWeight=function(N,ae){if(N=="bold"&&ae=="normal"||N=="bold"&&ae==400||N=="normal"&&ae=="italic"||N=="bold"&&ae=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return ae&&(N=ae==400||ae==="normal"?N==="italic"?"italic":"normal":ae!=700&&ae!=="bold"||N!=="normal"?(ae==700?"bold":ae)+""+N:"bold"),N};j.advancedAPI=function(N){var ae=De===Je;return ae&&Ue.call(this),typeof N!="function"||(N(this),ae&&$e.call(this)),this},j.compatAPI=function(N){var ae=De===Be;return ae&&$e.call(this),typeof N!="function"||(N(this),ae&&Ue.call(this)),this},j.isAdvancedAPI=function(){return De===Be};var Ze,Pe=function(N){if(De!==Be)throw new Error(N+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},rt=j.roundToPrecision=j.__private__.roundToPrecision=function(N,ae){var Ne=l||ae;if(isNaN(N)||isNaN(Ne))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return N.toFixed(Ne).replace(/0+$/,"")};Ze=j.hpf=j.__private__.hpf=typeof E=="number"?function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.hpf");return rt(N,E)}:E==="smart"?function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.hpf");return rt(N,N>-1&&N<1?16:5)}:function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.hpf");return rt(N,16)};var _e=j.f2=j.__private__.f2=function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.f2");return rt(N,2)},we=j.__private__.f3=function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.f3");return rt(N,3)},Ge=j.scale=j.__private__.scale=function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.scale");return De===Je?N*Qe:De===Be?N:void 0},Ye=function(N){return Ge((function(ae){return De===Je?Zs()-ae:De===Be?ae:void 0})(N))};j.__private__.setPrecision=j.setPrecision=function(N){typeof parseInt(N,10)=="number"&&(l=parseInt(N,10))};var xt,kt="00000000000000000000000000000000",yt=j.__private__.getFileId=function(){return kt},mt=j.__private__.setFileId=function(N){return kt=N!==void 0&&/^[a-fA-F0-9]{32}$/.test(N)?N.toUpperCase():kt.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),B!==null&&(wn=new ih(B.userPermissions,B.userPassword,B.ownerPassword,kt)),kt};j.setFileId=function(N){return mt(N),this},j.getFileId=function(){return yt()};var gt=j.__private__.convertDateToPDFDate=function(N){var ae=N.getTimezoneOffset(),Ne=ae<0?"+":"-",it=Math.floor(Math.abs(ae/60)),pt=Math.abs(ae%60),Rt=[Ne,We(it),"'",We(pt),"'"].join("");return["D:",N.getFullYear(),We(N.getMonth()+1),We(N.getDate()),We(N.getHours()),We(N.getMinutes()),We(N.getSeconds()),Rt].join("")},Qt=j.__private__.convertPDFDateToDate=function(N){var ae=parseInt(N.substr(2,4),10),Ne=parseInt(N.substr(6,2),10)-1,it=parseInt(N.substr(8,2),10),pt=parseInt(N.substr(10,2),10),Rt=parseInt(N.substr(12,2),10),Wt=parseInt(N.substr(14,2),10);return new Date(ae,Ne,it,pt,Rt,Wt,0)},Vt=j.__private__.setCreationDate=function(N){var ae;if(N===void 0&&(N=new Date),N instanceof Date)ae=gt(N);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(N))throw new Error("Invalid argument passed to jsPDF.setCreationDate");ae=N}return xt=ae},fe=j.__private__.getCreationDate=function(N){var ae=xt;return N==="jsDate"&&(ae=Qt(xt)),ae};j.setCreationDate=function(N){return Vt(N),this},j.getCreationDate=function(N){return fe(N)};var Fe,We=j.__private__.padd2=function(N){return("0"+parseInt(N)).slice(-2)},tt=j.__private__.padd2Hex=function(N){return("00"+(N=N.toString())).substr(N.length)},nt=0,ut=[],ft=[],It=0,zt=[],Zt=[],sr=!1,ur=ft;j.__private__.setCustomOutputDestination=function(N){sr=!0,ur=N};var _r=function(N){sr||(ur=N)};j.__private__.resetCustomOutputDestination=function(){sr=!1,ur=ft};var Le=j.__private__.out=function(N){return N=N.toString(),It+=N.length+1,ur.push(N),ur},lr=j.__private__.write=function(N){return Le(arguments.length===1?N.toString():Array.prototype.join.call(arguments," "))},br=j.__private__.getArrayBuffer=function(N){for(var ae=N.length,Ne=new ArrayBuffer(ae),it=new Uint8Array(Ne);ae--;)it[ae]=N.charCodeAt(ae);return Ne},Tr=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];j.__private__.getStandardFonts=function(){return Tr};var Yt=p.fontSize||16;j.__private__.setFontSize=j.setFontSize=function(N){return Yt=De===Be?N/Qe:N,this};var zr,yr=j.__private__.getFontSize=j.getFontSize=function(){return De===Je?Yt:Yt*Qe},Lr=p.R2L||!1;j.__private__.setR2L=j.setR2L=function(N){return Lr=N,this},j.__private__.getR2L=j.getR2L=function(){return Lr};var Cr,li=j.__private__.setZoomMode=function(N){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(N))zr=N;else if(isNaN(N)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(N)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+N+'" is not recognized.');zr=N}else zr=parseInt(N,10)};j.__private__.getZoomMode=function(){return zr};var Gr,Vr=j.__private__.setPageMode=function(N){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(N)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+N+'" is not recognized.');Cr=N};j.__private__.getPageMode=function(){return Cr};var ni=j.__private__.setLayoutMode=function(N){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(N)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+N+'" is not recognized.');Gr=N};j.__private__.getLayoutMode=function(){return Gr},j.__private__.setDisplayMode=j.setDisplayMode=function(N,ae,Ne){return li(N),ni(ae),Vr(Ne),this};var ei={title:"",subject:"",author:"",keywords:"",creator:""};j.__private__.getDocumentProperty=function(N){if(Object.keys(ei).indexOf(N)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return ei[N]},j.__private__.getDocumentProperties=function(){return ei},j.__private__.setDocumentProperties=j.setProperties=j.setDocumentProperties=function(N){for(var ae in ei)ei.hasOwnProperty(ae)&&N[ae]&&(ei[ae]=N[ae]);return this},j.__private__.setDocumentProperty=function(N,ae){if(Object.keys(ei).indexOf(N)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return ei[N]=ae};var xr,Qe,W,te,se,Ce={},Oe={},ht=[],Y={},P={},k={},ee={},le=null,ge=0,ie=[],ot=new by(j),Mt=p.hotfixes||[],ct={},dt={},Dt=[],Ct=function N(ae,Ne,it,pt,Rt,Wt){if(!(this instanceof N))return new N(ae,Ne,it,pt,Rt,Wt);isNaN(ae)&&(ae=1),isNaN(Ne)&&(Ne=0),isNaN(it)&&(it=0),isNaN(pt)&&(pt=1),isNaN(Rt)&&(Rt=0),isNaN(Wt)&&(Wt=0),this._matrix=[ae,Ne,it,pt,Rt,Wt]};Object.defineProperty(Ct.prototype,"sx",{get:function(){return this._matrix[0]},set:function(N){this._matrix[0]=N}}),Object.defineProperty(Ct.prototype,"shy",{get:function(){return this._matrix[1]},set:function(N){this._matrix[1]=N}}),Object.defineProperty(Ct.prototype,"shx",{get:function(){return this._matrix[2]},set:function(N){this._matrix[2]=N}}),Object.defineProperty(Ct.prototype,"sy",{get:function(){return this._matrix[3]},set:function(N){this._matrix[3]=N}}),Object.defineProperty(Ct.prototype,"tx",{get:function(){return this._matrix[4]},set:function(N){this._matrix[4]=N}}),Object.defineProperty(Ct.prototype,"ty",{get:function(){return this._matrix[5]},set:function(N){this._matrix[5]=N}}),Object.defineProperty(Ct.prototype,"a",{get:function(){return this._matrix[0]},set:function(N){this._matrix[0]=N}}),Object.defineProperty(Ct.prototype,"b",{get:function(){return this._matrix[1]},set:function(N){this._matrix[1]=N}}),Object.defineProperty(Ct.prototype,"c",{get:function(){return this._matrix[2]},set:function(N){this._matrix[2]=N}}),Object.defineProperty(Ct.prototype,"d",{get:function(){return this._matrix[3]},set:function(N){this._matrix[3]=N}}),Object.defineProperty(Ct.prototype,"e",{get:function(){return this._matrix[4]},set:function(N){this._matrix[4]=N}}),Object.defineProperty(Ct.prototype,"f",{get:function(){return this._matrix[5]},set:function(N){this._matrix[5]=N}}),Object.defineProperty(Ct.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Ct.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Ct.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Ct.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Ct.prototype.join=function(N){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(Ze).join(N)},Ct.prototype.multiply=function(N){var ae=N.sx*this.sx+N.shy*this.shx,Ne=N.sx*this.shy+N.shy*this.sy,it=N.shx*this.sx+N.sy*this.shx,pt=N.shx*this.shy+N.sy*this.sy,Rt=N.tx*this.sx+N.ty*this.shx+this.tx,Wt=N.tx*this.shy+N.ty*this.sy+this.ty;return new Ct(ae,Ne,it,pt,Rt,Wt)},Ct.prototype.decompose=function(){var N=this.sx,ae=this.shy,Ne=this.shx,it=this.sy,pt=this.tx,Rt=this.ty,Wt=Math.sqrt(N*N+ae*ae),ar=(N/=Wt)*Ne+(ae/=Wt)*it;Ne-=N*ar,it-=ae*ar;var Pr=Math.sqrt(Ne*Ne+it*it);return ar/=Pr,N*(it/=Pr)<ae*(Ne/=Pr)&&(N=-N,ae=-ae,ar=-ar,Wt=-Wt),{scale:new Ct(Wt,0,0,Pr,0,0),translate:new Ct(1,0,0,1,pt,Rt),rotate:new Ct(N,ae,-ae,N,0,0),skew:new Ct(1,0,ar,1,0,0)}},Ct.prototype.toString=function(N){return this.join(" ")},Ct.prototype.inversed=function(){var N=this.sx,ae=this.shy,Ne=this.shx,it=this.sy,pt=this.tx,Rt=this.ty,Wt=1/(N*it-ae*Ne),ar=it*Wt,Pr=-ae*Wt,Wr=-Ne*Wt,Xr=N*Wt;return new Ct(ar,Pr,Wr,Xr,-ar*pt-Wr*Rt,-Pr*pt-Xr*Rt)},Ct.prototype.applyToPoint=function(N){var ae=N.x*this.sx+N.y*this.shx+this.tx,Ne=N.x*this.shy+N.y*this.sy+this.ty;return new Ia(ae,Ne)},Ct.prototype.applyToRectangle=function(N){var ae=this.applyToPoint(N),Ne=this.applyToPoint(new Ia(N.x+N.w,N.y+N.h));return new Uo(ae.x,ae.y,Ne.x-ae.x,Ne.y-ae.y)},Ct.prototype.clone=function(){var N=this.sx,ae=this.shy,Ne=this.shx,it=this.sy,pt=this.tx,Rt=this.ty;return new Ct(N,ae,Ne,it,pt,Rt)},j.Matrix=Ct;var Ht=j.matrixMult=function(N,ae){return ae.multiply(N)},Gt=new Ct(1,0,0,1,0,0);j.unitMatrix=j.identityMatrix=Gt;var dr=function(N,ae){if(!P[N]){var Ne=(ae instanceof xu?"Sh":"P")+(Object.keys(Y).length+1).toString(10);ae.id=Ne,P[N]=Ne,Y[Ne]=ae,ot.publish("addPattern",ae)}};j.ShadingPattern=xu,j.TilingPattern=oh,j.addShadingPattern=function(N,ae){return Pe("addShadingPattern()"),dr(N,ae),this},j.beginTilingPattern=function(N){Pe("beginTilingPattern()"),vi(N.boundingBox[0],N.boundingBox[1],N.boundingBox[2]-N.boundingBox[0],N.boundingBox[3]-N.boundingBox[1],N.matrix)},j.endTilingPattern=function(N,ae){Pe("endTilingPattern()"),ae.stream=Zt[Fe].join(`
`),dr(N,ae),ot.publish("endTilingPattern",ae),Dt.pop().restore()};var vr,Nr=j.__private__.newObject=function(){var N=Lt();return wr(N,!0),N},Lt=j.__private__.newObjectDeferred=function(){return nt++,ut[nt]=function(){return It},nt},wr=function(N,ae){return ae=typeof ae=="boolean"&&ae,ut[N]=It,ae&&Le(N+" 0 obj"),N},zi=j.__private__.newAdditionalObject=function(){var N={objId:Lt(),content:""};return zt.push(N),N},fn=Lt(),mi=Lt(),Xt=j.__private__.decodeColorString=function(N){var ae=N.split(" ");if(ae.length!==2||ae[1]!=="g"&&ae[1]!=="G")ae.length!==5||ae[4]!=="k"&&ae[4]!=="K"||(ae=[(1-ae[0])*(1-ae[3]),(1-ae[1])*(1-ae[3]),(1-ae[2])*(1-ae[3]),"r"]);else{var Ne=parseFloat(ae[0]);ae=[Ne,Ne,Ne,"r"]}for(var it="#",pt=0;pt<3;pt++)it+=("0"+Math.floor(255*parseFloat(ae[pt])).toString(16)).slice(-2);return it},Er=j.__private__.encodeColorString=function(N){var ae;typeof N=="string"&&(N={ch1:N});var Ne=N.ch1,it=N.ch2,pt=N.ch3,Rt=N.ch4,Wt=N.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Ne=="string"&&Ne.charAt(0)!=="#"){var ar=new C0(Ne);if(ar.ok)Ne=ar.toHex();else if(!/^\d*\.?\d*$/.test(Ne))throw new Error('Invalid color "'+Ne+'" passed to jsPDF.encodeColorString.')}if(typeof Ne=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Ne)&&(Ne="#"+Ne[1]+Ne[1]+Ne[2]+Ne[2]+Ne[3]+Ne[3]),typeof Ne=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Ne)){var Pr=parseInt(Ne.substr(1),16);Ne=Pr>>16&255,it=Pr>>8&255,pt=255&Pr}if(it===void 0||Rt===void 0&&Ne===it&&it===pt)ae=typeof Ne=="string"?Ne+" "+Wt[0]:N.precision===2?_e(Ne/255)+" "+Wt[0]:we(Ne/255)+" "+Wt[0];else if(Rt===void 0||Wi(Rt)==="object"){if(Rt&&!isNaN(Rt.a)&&Rt.a===0)return["1.","1.","1.",Wt[1]].join(" ");ae=typeof Ne=="string"?[Ne,it,pt,Wt[1]].join(" "):N.precision===2?[_e(Ne/255),_e(it/255),_e(pt/255),Wt[1]].join(" "):[we(Ne/255),we(it/255),we(pt/255),Wt[1]].join(" ")}else ae=typeof Ne=="string"?[Ne,it,pt,Rt,Wt[2]].join(" "):N.precision===2?[_e(Ne),_e(it),_e(pt),_e(Rt),Wt[2]].join(" "):[we(Ne),we(it),we(pt),we(Rt),Wt[2]].join(" ");return ae},Rr=j.__private__.getFilters=function(){return b},Ni=j.__private__.putStream=function(N){var ae=(N=N||{}).data||"",Ne=N.filters||Rr(),it=N.alreadyAppliedFilters||[],pt=N.addLength1||!1,Rt=ae.length,Wt=N.objectId,ar=function(Ln){return Ln};if(B!==null&&Wt===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");B!==null&&(ar=wn.encryptor(Wt,0));var Pr={};Ne===!0&&(Ne=["FlateEncode"]);var Wr=N.additionalKeyValues||[],Xr=(Pr=jr.API.processDataByFilters!==void 0?jr.API.processDataByFilters(ae,Ne):{data:ae,reverseChain:[]}).reverseChain+(Array.isArray(it)?it.join(" "):it.toString());if(Pr.data.length!==0&&(Wr.push({key:"Length",value:Pr.data.length}),pt===!0&&Wr.push({key:"Length1",value:Rt})),Xr.length!=0)if(Xr.split("/").length-1==1)Wr.push({key:"Filter",value:Xr});else{Wr.push({key:"Filter",value:"["+Xr+"]"});for(var Or=0;Or<Wr.length;Or+=1)if(Wr[Or].key==="DecodeParms"){for(var Hi=[],pn=0;pn<Pr.reverseChain.split("/").length-1;pn+=1)Hi.push("null");Hi.push(Wr[Or].value),Wr[Or].value="["+Hi.join(" ")+"]"}}Le("<<");for(var Ei=0;Ei<Wr.length;Ei++)Le("/"+Wr[Ei].key+" "+Wr[Ei].value);Le(">>"),Pr.data.length!==0&&(Le("stream"),Le(ar(Pr.data)),Le("endstream"))},Rs=j.__private__.putPage=function(N){var ae=N.number,Ne=N.data,it=N.objId,pt=N.contentsObjId;wr(it,!0),Le("<</Type /Page"),Le("/Parent "+N.rootDictionaryObjId+" 0 R"),Le("/Resources "+N.resourceDictionaryObjId+" 0 R"),Le("/MediaBox ["+parseFloat(Ze(N.mediaBox.bottomLeftX))+" "+parseFloat(Ze(N.mediaBox.bottomLeftY))+" "+Ze(N.mediaBox.topRightX)+" "+Ze(N.mediaBox.topRightY)+"]"),N.cropBox!==null&&Le("/CropBox ["+Ze(N.cropBox.bottomLeftX)+" "+Ze(N.cropBox.bottomLeftY)+" "+Ze(N.cropBox.topRightX)+" "+Ze(N.cropBox.topRightY)+"]"),N.bleedBox!==null&&Le("/BleedBox ["+Ze(N.bleedBox.bottomLeftX)+" "+Ze(N.bleedBox.bottomLeftY)+" "+Ze(N.bleedBox.topRightX)+" "+Ze(N.bleedBox.topRightY)+"]"),N.trimBox!==null&&Le("/TrimBox ["+Ze(N.trimBox.bottomLeftX)+" "+Ze(N.trimBox.bottomLeftY)+" "+Ze(N.trimBox.topRightX)+" "+Ze(N.trimBox.topRightY)+"]"),N.artBox!==null&&Le("/ArtBox ["+Ze(N.artBox.bottomLeftX)+" "+Ze(N.artBox.bottomLeftY)+" "+Ze(N.artBox.topRightX)+" "+Ze(N.artBox.topRightY)+"]"),typeof N.userUnit=="number"&&N.userUnit!==1&&Le("/UserUnit "+N.userUnit),ot.publish("putPage",{objId:it,pageContext:ie[ae],pageNumber:ae,page:Ne}),Le("/Contents "+pt+" 0 R"),Le(">>"),Le("endobj");var Rt=Ne.join(`
`);return De===Be&&(Rt+=`
Q`),wr(pt,!0),Ni({data:Rt,filters:Rr(),objectId:pt}),Le("endobj"),it},Dn=j.__private__.putPages=function(){var N,ae,Ne=[];for(N=1;N<=ge;N++)ie[N].objId=Lt(),ie[N].contentsObjId=Lt();for(N=1;N<=ge;N++)Ne.push(Rs({number:N,data:Zt[N],objId:ie[N].objId,contentsObjId:ie[N].contentsObjId,mediaBox:ie[N].mediaBox,cropBox:ie[N].cropBox,bleedBox:ie[N].bleedBox,trimBox:ie[N].trimBox,artBox:ie[N].artBox,userUnit:ie[N].userUnit,rootDictionaryObjId:fn,resourceDictionaryObjId:mi}));wr(fn,!0),Le("<</Type /Pages");var it="/Kids [";for(ae=0;ae<ge;ae++)it+=Ne[ae]+" 0 R ";Le(it+"]"),Le("/Count "+ge),Le(">>"),Le("endobj"),ot.publish("postPutPages")},$r=function(N){ot.publish("putFont",{font:N,out:Le,newObject:Nr,putStream:Ni}),N.isAlreadyPutted!==!0&&(N.objectNumber=Nr(),Le("<<"),Le("/Type /Font"),Le("/BaseFont /"+nh(N.postScriptName)),Le("/Subtype /Type1"),typeof N.encoding=="string"&&Le("/Encoding /"+N.encoding),Le("/FirstChar 32"),Le("/LastChar 255"),Le(">>"),Le("endobj"))},wa=function(N){N.objectNumber=Nr();var ae=[];ae.push({key:"Type",value:"/XObject"}),ae.push({key:"Subtype",value:"/Form"}),ae.push({key:"BBox",value:"["+[Ze(N.x),Ze(N.y),Ze(N.x+N.width),Ze(N.y+N.height)].join(" ")+"]"}),ae.push({key:"Matrix",value:"["+N.matrix.toString()+"]"});var Ne=N.pages[1].join(`
`);Ni({data:Ne,additionalKeyValues:ae,objectId:N.objectNumber}),Le("endobj")},Sa=function(N,ae){ae||(ae=21);var Ne=Nr(),it=(function(Wt,ar){var Pr,Wr=[],Xr=1/(ar-1);for(Pr=0;Pr<1;Pr+=Xr)Wr.push(Pr);if(Wr.push(1),Wt[0].offset!=0){var Or={offset:0,color:Wt[0].color};Wt.unshift(Or)}if(Wt[Wt.length-1].offset!=1){var Hi={offset:1,color:Wt[Wt.length-1].color};Wt.push(Hi)}for(var pn="",Ei=0,Ln=0;Ln<Wr.length;Ln++){for(Pr=Wr[Ln];Pr>Wt[Ei+1].offset;)Ei++;var Gi=Wt[Ei].offset,Sn=(Pr-Gi)/(Wt[Ei+1].offset-Gi),fs=Wt[Ei].color,Ls=Wt[Ei+1].color;pn+=tt(Math.round((1-Sn)*fs[0]+Sn*Ls[0]).toString(16))+tt(Math.round((1-Sn)*fs[1]+Sn*Ls[1]).toString(16))+tt(Math.round((1-Sn)*fs[2]+Sn*Ls[2]).toString(16))}return pn.trim()})(N.colors,ae),pt=[];pt.push({key:"FunctionType",value:"0"}),pt.push({key:"Domain",value:"[0.0 1.0]"}),pt.push({key:"Size",value:"["+ae+"]"}),pt.push({key:"BitsPerSample",value:"8"}),pt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),pt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Ni({data:it,additionalKeyValues:pt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Ne}),Le("endobj"),N.objectNumber=Nr(),Le("<< /ShadingType "+N.type),Le("/ColorSpace /DeviceRGB");var Rt="/Coords ["+Ze(parseFloat(N.coords[0]))+" "+Ze(parseFloat(N.coords[1]))+" ";N.type===2?Rt+=Ze(parseFloat(N.coords[2]))+" "+Ze(parseFloat(N.coords[3])):Rt+=Ze(parseFloat(N.coords[2]))+" "+Ze(parseFloat(N.coords[3]))+" "+Ze(parseFloat(N.coords[4]))+" "+Ze(parseFloat(N.coords[5])),Le(Rt+="]"),N.matrix&&Le("/Matrix ["+N.matrix.toString()+"]"),Le("/Function "+Ne+" 0 R"),Le("/Extend [true true]"),Le(">>"),Le("endobj")},Ua=function(N,ae){var Ne=Lt(),it=Nr();ae.push({resourcesOid:Ne,objectOid:it}),N.objectNumber=it;var pt=[];pt.push({key:"Type",value:"/Pattern"}),pt.push({key:"PatternType",value:"1"}),pt.push({key:"PaintType",value:"1"}),pt.push({key:"TilingType",value:"1"}),pt.push({key:"BBox",value:"["+N.boundingBox.map(Ze).join(" ")+"]"}),pt.push({key:"XStep",value:Ze(N.xStep)}),pt.push({key:"YStep",value:Ze(N.yStep)}),pt.push({key:"Resources",value:Ne+" 0 R"}),N.matrix&&pt.push({key:"Matrix",value:"["+N.matrix.toString()+"]"}),Ni({data:N.stream,additionalKeyValues:pt,objectId:N.objectNumber}),Le("endobj")},ho=function(N){for(var ae in N.objectNumber=Nr(),Le("<<"),N)switch(ae){case"opacity":Le("/ca "+_e(N[ae]));break;case"stroke-opacity":Le("/CA "+_e(N[ae]))}Le(">>"),Le("endobj")},qa=function(N){wr(N.resourcesOid,!0),Le("<<"),Le("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),(function(){for(var ae in Le("/Font <<"),Ce)Ce.hasOwnProperty(ae)&&(Q===!1||Q===!0&&ne.hasOwnProperty(ae))&&Le("/"+ae+" "+Ce[ae].objectNumber+" 0 R");Le(">>")})(),(function(){if(Object.keys(Y).length>0){for(var ae in Le("/Shading <<"),Y)Y.hasOwnProperty(ae)&&Y[ae]instanceof xu&&Y[ae].objectNumber>=0&&Le("/"+ae+" "+Y[ae].objectNumber+" 0 R");ot.publish("putShadingPatternDict"),Le(">>")}})(),(function(ae){if(Object.keys(Y).length>0){for(var Ne in Le("/Pattern <<"),Y)Y.hasOwnProperty(Ne)&&Y[Ne]instanceof j.TilingPattern&&Y[Ne].objectNumber>=0&&Y[Ne].objectNumber<ae&&Le("/"+Ne+" "+Y[Ne].objectNumber+" 0 R");ot.publish("putTilingPatternDict"),Le(">>")}})(N.objectOid),(function(){if(Object.keys(k).length>0){var ae;for(ae in Le("/ExtGState <<"),k)k.hasOwnProperty(ae)&&k[ae].objectNumber>=0&&Le("/"+ae+" "+k[ae].objectNumber+" 0 R");ot.publish("putGStateDict"),Le(">>")}})(),(function(){for(var ae in Le("/XObject <<"),ct)ct.hasOwnProperty(ae)&&ct[ae].objectNumber>=0&&Le("/"+ae+" "+ct[ae].objectNumber+" 0 R");ot.publish("putXobjectDict"),Le(">>")})(),Le(">>"),Le("endobj")},Ga=function(N){Oe[N.fontName]=Oe[N.fontName]||{},Oe[N.fontName][N.fontStyle]=N.id},fo=function(N,ae,Ne,it,pt){var Rt={id:"F"+(Object.keys(Ce).length+1).toString(10),postScriptName:N,fontName:ae,fontStyle:Ne,encoding:it,isStandardFont:pt||!1,metadata:{}};return ot.publish("addFont",{font:Rt,instance:this}),Ce[Rt.id]=Rt,Ga(Rt),Rt.id},Ri=j.__private__.pdfEscape=j.pdfEscape=function(N,ae){return(function(Ne,it){var pt,Rt,Wt,ar,Pr,Wr,Xr,Or,Hi;if(Wt=(it=it||{}).sourceEncoding||"Unicode",Pr=it.outputEncoding,(it.autoencode||Pr)&&Ce[xr].metadata&&Ce[xr].metadata[Wt]&&Ce[xr].metadata[Wt].encoding&&(ar=Ce[xr].metadata[Wt].encoding,!Pr&&Ce[xr].encoding&&(Pr=Ce[xr].encoding),!Pr&&ar.codePages&&(Pr=ar.codePages[0]),typeof Pr=="string"&&(Pr=ar[Pr]),Pr)){for(Xr=!1,Wr=[],pt=0,Rt=Ne.length;pt<Rt;pt++)(Or=Pr[Ne.charCodeAt(pt)])?Wr.push(String.fromCharCode(Or)):Wr.push(Ne[pt]),Wr[pt].charCodeAt(0)>>8&&(Xr=!0);Ne=Wr.join("")}for(pt=Ne.length;Xr===void 0&&pt!==0;)Ne.charCodeAt(pt-1)>>8&&(Xr=!0),pt--;if(!Xr)return Ne;for(Wr=it.noBOM?[]:[254,255],pt=0,Rt=Ne.length;pt<Rt;pt++){if((Hi=(Or=Ne.charCodeAt(pt))>>8)>>8)throw new Error("Character at position "+pt+" of string '"+Ne+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");Wr.push(Hi),Wr.push(Or-(Hi<<8))}return String.fromCharCode.apply(void 0,Wr)})(N,ae).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},gi=j.__private__.beginPage=function(N){Zt[++ge]=[],ie[ge]={objId:0,contentsObjId:0,userUnit:Number(s),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(N[0]),topRightY:Number(N[1])}},po(ge),_r(Zt[Fe])},Bo=function(N,ae){var Ne,it,pt;switch(u=ae||u,typeof N=="string"&&(Ne=ye(N.toLowerCase()),Array.isArray(Ne)&&(it=Ne[0],pt=Ne[1])),Array.isArray(N)&&(it=N[0]*Qe,pt=N[1]*Qe),isNaN(it)&&(it=v[0],pt=v[1]),(it>14400||pt>14400)&&(on.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),it=Math.min(14400,it),pt=Math.min(14400,pt)),v=[it,pt],u.substr(0,1)){case"l":pt>it&&(v=[pt,it]);break;case"p":it>pt&&(v=[pt,it])}gi(v),kr(Vo),Le(ca),zn!==0&&Le(zn+" J"),ua!==0&&Le(ua+" j"),ot.publish("addPage",{pageNumber:ge})},Ta=function(N){N>0&&N<=ge&&(Zt.splice(N,1),ie.splice(N,1),ge--,Fe>ge&&(Fe=ge),this.setPage(Fe))},po=function(N){N>0&&N<=ge&&(Fe=N)},Pa=j.__private__.getNumberOfPages=j.getNumberOfPages=function(){return Zt.length-1},ds=function(N,ae,Ne){var it,pt=void 0;return Ne=Ne||{},N=N!==void 0?N:Ce[xr].fontName,ae=ae!==void 0?ae:Ce[xr].fontStyle,it=N.toLowerCase(),Oe[it]!==void 0&&Oe[it][ae]!==void 0?pt=Oe[it][ae]:Oe[N]!==void 0&&Oe[N][ae]!==void 0?pt=Oe[N][ae]:Ne.disableWarning===!1&&on.warn("Unable to look up font label for font '"+N+"', '"+ae+"'. Refer to getFontList() for available fonts."),pt||Ne.noFallback||(pt=Oe.times[ae])==null&&(pt=Oe.times.normal),pt},oa=j.__private__.putInfo=function(){var N=Nr(),ae=function(it){return it};for(var Ne in B!==null&&(ae=wn.encryptor(N,0)),Le("<<"),Le("/Producer ("+Ri(ae("jsPDF "+jr.version))+")"),ei)ei.hasOwnProperty(Ne)&&ei[Ne]&&Le("/"+Ne.substr(0,1).toUpperCase()+Ne.substr(1)+" ("+Ri(ae(ei[Ne]))+")");Le("/CreationDate ("+Ri(ae(xt))+")"),Le(">>"),Le("endobj")},Bs=j.__private__.putCatalog=function(N){var ae=(N=N||{}).rootDictionaryObjId||fn;switch(Nr(),Le("<<"),Le("/Type /Catalog"),Le("/Pages "+ae+" 0 R"),zr||(zr="fullwidth"),zr){case"fullwidth":Le("/OpenAction [3 0 R /FitH null]");break;case"fullheight":Le("/OpenAction [3 0 R /FitV null]");break;case"fullpage":Le("/OpenAction [3 0 R /Fit]");break;case"original":Le("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Ne=""+zr;Ne.substr(Ne.length-1)==="%"&&(zr=parseInt(zr)/100),typeof zr=="number"&&Le("/OpenAction [3 0 R /XYZ null null "+_e(zr)+"]")}switch(Gr||(Gr="continuous"),Gr){case"continuous":Le("/PageLayout /OneColumn");break;case"single":Le("/PageLayout /SinglePage");break;case"two":case"twoleft":Le("/PageLayout /TwoColumnLeft");break;case"tworight":Le("/PageLayout /TwoColumnRight")}Cr&&Le("/PageMode /"+Cr),ot.publish("putCatalog"),Le(">>"),Le("endobj")},pl=j.__private__.putTrailer=function(){Le("trailer"),Le("<<"),Le("/Size "+(nt+1)),Le("/Root "+nt+" 0 R"),Le("/Info "+(nt-1)+" 0 R"),B!==null&&Le("/Encrypt "+wn.oid+" 0 R"),Le("/ID [ <"+kt+"> <"+kt+"> ]"),Le(">>")},ri=j.__private__.putHeader=function(){Le("%PDF-"+Ie),Le("%")},Gl=j.__private__.putXRef=function(){var N="0000000000";Le("xref"),Le("0 "+(nt+1)),Le("0000000000 65535 f ");for(var ae=1;ae<=nt;ae++)typeof ut[ae]=="function"?Le((N+ut[ae]()).slice(-10)+" 00000 n "):ut[ae]!==void 0?Le((N+ut[ae]).slice(-10)+" 00000 n "):Le("0000000000 00000 n ")},la=j.__private__.buildDocument=function(){var N;nt=0,It=0,ft=[],ut=[],zt=[],fn=Lt(),mi=Lt(),_r(ft),ot.publish("buildDocument"),ri(),Dn(),(function(){ot.publish("putAdditionalObjects");for(var Ne=0;Ne<zt.length;Ne++){var it=zt[Ne];wr(it.objId,!0),Le(it.content),Le("endobj")}ot.publish("postPutAdditionalObjects")})(),N=[],(function(){for(var Ne in Ce)Ce.hasOwnProperty(Ne)&&(Q===!1||Q===!0&&ne.hasOwnProperty(Ne))&&$r(Ce[Ne])})(),(function(){var Ne;for(Ne in k)k.hasOwnProperty(Ne)&&ho(k[Ne])})(),(function(){for(var Ne in ct)ct.hasOwnProperty(Ne)&&wa(ct[Ne])})(),(function(Ne){var it;for(it in Y)Y.hasOwnProperty(it)&&(Y[it]instanceof xu?Sa(Y[it]):Y[it]instanceof oh&&Ua(Y[it],Ne))})(N),ot.publish("putResources"),N.forEach(qa),qa({resourcesOid:mi,objectOid:Number.MAX_SAFE_INTEGER}),ot.publish("postPutResources"),B!==null&&(wn.oid=Nr(),Le("<<"),Le("/Filter /Standard"),Le("/V "+wn.v),Le("/R "+wn.r),Le("/U <"+wn.toHexString(wn.U)+">"),Le("/O <"+wn.toHexString(wn.O)+">"),Le("/P "+wn.P),Le(">>"),Le("endobj")),oa(),Bs();var ae=It;return Gl(),pl(),Le("startxref"),Le(""+ae),Le("%%EOF"),_r(Zt[Fe]),ft.join(`
`)},Aa=j.__private__.getBlob=function(N){return new Blob([br(N)],{type:"application/pdf"})},$l=j.output=j.__private__.output=(vr=function(N,ae){switch(typeof(ae=ae||{})=="string"?ae={filename:ae}:ae.filename=ae.filename||"generated.pdf",N){case void 0:return la();case"save":j.save(ae.filename);break;case"arraybuffer":return br(la());case"blob":return Aa(la());case"bloburi":case"bloburl":if(ti.URL!==void 0&&typeof ti.URL.createObjectURL=="function")return ti.URL&&ti.URL.createObjectURL(Aa(la()))||void 0;on.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Ne="",it=la();try{Ne=_y(it)}catch{Ne=_y(unescape(encodeURIComponent(it)))}return"data:application/pdf;filename="+ae.filename+";base64,"+Ne;case"pdfobjectnewwindow":if(Object.prototype.toString.call(ti)==="[object Window]"){var pt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Rt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';ae.pdfObjectUrl&&(pt=ae.pdfObjectUrl,Rt="");var Wt='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+pt+'"'+Rt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(ae)+");<\/script></body></html>",ar=ti.open();return ar!==null&&ar.document.write(Wt),ar}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(ti)==="[object Window]"){var Pr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(ae.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+ae.filename+'" width="500px" height="400px" /></body></html>',Wr=ti.open();if(Wr!==null){Wr.document.write(Pr);var Xr=this;Wr.document.documentElement.querySelector("#pdfViewer").onload=function(){Wr.document.title=ae.filename,Wr.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Xr.output("bloburl"))}}return Wr}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(ti)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Or='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",ae)+'"></iframe></body></html>',Hi=ti.open();if(Hi!==null&&(Hi.document.write(Or),Hi.document.title=ae.filename),Hi||typeof safari>"u")return Hi;break;case"datauri":case"dataurl":return ti.document.location.href=this.output("datauristring",ae);default:return null}},vr.foo=function(){try{return vr.apply(this,arguments)}catch(Ne){var N=Ne.stack||"";~N.indexOf(" at ")&&(N=N.split(" at ")[1]);var ae="Error in function "+N.split(`
`)[0].split("<")[0]+": "+Ne.message;if(!ti.console)throw new Error(ae);ti.console.error(ae,Ne),ti.alert&&alert(ae)}},vr.foo.bar=vr,vr.foo),As=function(N){return Array.isArray(Mt)===!0&&Mt.indexOf(N)>-1};switch(g){case"pt":Qe=1;break;case"mm":Qe=72/25.4;break;case"cm":Qe=72/2.54;break;case"in":Qe=72;break;case"px":Qe=As("px_scaling")==1?.75:96/72;break;case"pc":case"em":Qe=12;break;case"ex":Qe=6;break;default:if(typeof g!="number")throw new Error("Invalid unit: "+g);Qe=g}var wn=null;Vt(),mt();var Os=j.__private__.getPageInfo=j.getPageInfo=function(N){if(isNaN(N)||N%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:ie[N].objId,pageNumber:N,pageContext:ie[N]}},ml=j.__private__.getPageInfoByObjId=function(N){if(isNaN(N)||N%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var ae in ie)if(ie[ae].objId===N)break;return Os(ae)},Zl=j.__private__.getCurrentPageInfo=j.getCurrentPageInfo=function(){return{objId:ie[Fe].objId,pageNumber:Fe,pageContext:ie[Fe]}};j.addPage=function(){return Bo.apply(this,arguments),this},j.setPage=function(){return po.apply(this,arguments),_r.call(this,Zt[Fe]),this},j.insertPage=function(N){return this.addPage(),this.movePage(Fe,N),this},j.movePage=function(N,ae){var Ne,it;if(N>ae){Ne=Zt[N],it=ie[N];for(var pt=N;pt>ae;pt--)Zt[pt]=Zt[pt-1],ie[pt]=ie[pt-1];Zt[ae]=Ne,ie[ae]=it,this.setPage(ae)}else if(N<ae){Ne=Zt[N],it=ie[N];for(var Rt=N;Rt<ae;Rt++)Zt[Rt]=Zt[Rt+1],ie[Rt]=ie[Rt+1];Zt[ae]=Ne,ie[ae]=it,this.setPage(ae)}return this},j.deletePage=function(){return Ta.apply(this,arguments),this},j.__private__.text=j.text=function(N,ae,Ne,it,pt){var Rt,Wt,ar,Pr,Wr,Xr,Or,Hi,pn,Ei=(it=it||{}).scope||this;if(typeof N=="number"&&typeof ae=="number"&&(typeof Ne=="string"||Array.isArray(Ne))){var Ln=Ne;Ne=ae,ae=N,N=Ln}if(arguments[3]instanceof Ct==0?(ar=arguments[4],Pr=arguments[5],Wi(Or=arguments[3])==="object"&&Or!==null||(typeof ar=="string"&&(Pr=ar,ar=null),typeof Or=="string"&&(Pr=Or,Or=null),typeof Or=="number"&&(ar=Or,Or=null),it={flags:Or,angle:ar,align:Pr})):(Pe("The transform parameter of text() with a Matrix value"),pn=pt),isNaN(ae)||isNaN(Ne)||N==null)throw new Error("Invalid arguments passed to jsPDF.text");if(N.length===0)return Ei;var Gi,Sn="",fs=typeof it.lineHeightFactor=="number"?it.lineHeightFactor:jo,Ls=Ei.internal.scaleFactor;function Cs(Si){return Si=Si.split("	").join(Array(it.TabLen||9).join(" ")),Ri(Si,Or)}function La(Si){for(var Di,cn=Si.concat(),Cn=[],ai=cn.length;ai--;)typeof(Di=cn.shift())=="string"?Cn.push(Di):Array.isArray(Si)&&(Di.length===1||Di[1]===void 0&&Di[2]===void 0)?Cn.push(Di[0]):Cn.push([Di[0],Di[1],Di[2]]);return Cn}function da(Si,Di){var cn;if(typeof Si=="string")cn=Di(Si)[0];else if(Array.isArray(Si)){for(var Cn,ai,wo=Si.concat(),Ka=[],$o=wo.length;$o--;)typeof(Cn=wo.shift())=="string"?Ka.push(Di(Cn)[0]):Array.isArray(Cn)&&typeof Cn[0]=="string"&&(ai=Di(Cn[0],Cn[1],Cn[2]),Ka.push([ai[0],ai[1],ai[2]]));cn=Ka}return cn}var ki=!1,yo=!0;if(typeof N=="string")ki=!0;else if(Array.isArray(N)){var Ws=N.concat();Wt=[];for(var Hs,Qi=Ws.length;Qi--;)(typeof(Hs=Ws.shift())!="string"||Array.isArray(Hs)&&typeof Hs[0]!="string")&&(yo=!1);ki=yo}if(ki===!1)throw new Error('Type of text must be string or Array. "'+N+'" is not recognized.');typeof N=="string"&&(N=N.match(/[\r?\n]/)?N.split(/\r\n|\r|\n/g):[N]);var qo=Yt/Ei.internal.scaleFactor,Ca=qo*(fs-1);switch(it.baseline){case"bottom":Ne-=Ca;break;case"top":Ne+=qo-Ca;break;case"hanging":Ne+=qo-2*Ca;break;case"middle":Ne+=qo/2-Ca}if((Xr=it.maxWidth||0)>0&&(typeof N=="string"?N=Ei.splitTextToSize(N,Xr):Object.prototype.toString.call(N)==="[object Array]"&&(N=N.reduce(function(Si,Di){return Si.concat(Ei.splitTextToSize(Di,Xr))},[]))),Rt={text:N,x:ae,y:Ne,options:it,mutex:{pdfEscape:Ri,activeFontKey:xr,fonts:Ce,activeFontSize:Yt}},ot.publish("preProcessText",Rt),N=Rt.text,ar=(it=Rt.options).angle,pn instanceof Ct==0&&ar&&typeof ar=="number"){ar*=Math.PI/180,it.rotationDirection===0&&(ar=-ar),De===Be&&(ar=-ar);var Yl=Math.cos(ar),Ma=Math.sin(ar);pn=new Ct(Yl,Ma,-Ma,Yl,0,0)}else ar&&ar instanceof Ct&&(pn=ar);De!==Be||pn||(pn=Gt),(Wr=it.charSpace||Fn)!==void 0&&(Sn+=Ze(Ge(Wr))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(Hi=it.horizontalScale)!==void 0&&(Sn+=Ze(100*Hi)+` Tz
`),it.lang;var Nn=-1,Ea=it.renderingMode!==void 0?it.renderingMode:it.stroke,Go=Ei.internal.getCurrentPageInfo().pageContext;switch(Ea){case 0:case!1:case"fill":Nn=0;break;case 1:case!0:case"stroke":Nn=1;break;case 2:case"fillThenStroke":Nn=2;break;case 3:case"invisible":Nn=3;break;case 4:case"fillAndAddForClipping":Nn=4;break;case 5:case"strokeAndAddPathForClipping":Nn=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Nn=6;break;case 7:case"addToPathForClipping":Nn=7}var _l=Go.usedRenderingMode!==void 0?Go.usedRenderingMode:-1;Nn!==-1?Sn+=Nn+` Tr
`:_l!==-1&&(Sn+=`0 Tr
`),Nn!==-1&&(Go.usedRenderingMode=Nn),Pr=it.align||"left";var ps,Xa=Yt*fs,yl=Ei.internal.pageSize.getWidth(),vl=Ce[xr];Wr=it.charSpace||Fn,Xr=it.maxWidth||0,Or=Object.assign({autoencode:!0,noBOM:!0},it.flags);var Ya=[],Ms=function(Si){return Ei.getStringUnitWidth(Si,{font:vl,charSpace:Wr,fontSize:Yt,doKerning:!1})*Yt/Ls};if(Object.prototype.toString.call(N)==="[object Array]"){var ms;Wt=La(N),Pr!=="left"&&(ps=Wt.map(Ms));var ss,Es=0;if(Pr==="right"){ae-=ps[0],N=[],Qi=Wt.length;for(var ka=0;ka<Qi;ka++)ka===0?(ss=Xn(ae),ms=Ki(Ne)):(ss=Ge(Es-ps[ka]),ms=-Xa),N.push([Wt[ka],ss,ms]),Es=ps[ka]}else if(Pr==="center"){ae-=ps[0]/2,N=[],Qi=Wt.length;for(var fa=0;fa<Qi;fa++)fa===0?(ss=Xn(ae),ms=Ki(Ne)):(ss=Ge((Es-ps[fa])/2),ms=-Xa),N.push([Wt[fa],ss,ms]),Es=ps[fa]}else if(Pr==="left"){N=[],Qi=Wt.length;for(var Jl=0;Jl<Qi;Jl++)N.push(Wt[Jl])}else if(Pr==="justify"&&vl.encoding==="Identity-H"){N=[],Qi=Wt.length,Xr=Xr!==0?Xr:yl;for(var bl=0,ln=0;ln<Qi;ln++)if(ms=ln===0?Ki(Ne):-Xa,ss=ln===0?Xn(ae):bl,ln<Qi-1){var vo=Ge((Xr-ps[ln])/(Wt[ln].split(" ").length-1)),pa=Wt[ln].split(" ");N.push([pa[0]+" ",ss,ms]),bl=0;for(var Xs=1;Xs<pa.length;Xs++){var xl=(Ms(pa[Xs-1]+" "+pa[Xs])-Ms(pa[Xs]))*Ls+vo;Xs==pa.length-1?N.push([pa[Xs],xl,0]):N.push([pa[Xs]+" ",xl,0]),bl-=xl}}else N.push([Wt[ln],ss,ms]);N.push(["",bl,0])}else{if(Pr!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(N=[],Qi=Wt.length,Xr=Xr!==0?Xr:yl,ln=0;ln<Qi;ln++){ms=ln===0?Ki(Ne):-Xa,ss=ln===0?Xn(ae):0;var bo=Wt[ln].split(" ").length-1,as=bo>0?(Xr-ps[ln])/bo:0;ln<Qi-1?Ya.push(Ze(Ge(as))):Ya.push(0),N.push([Wt[ln],ss,ms])}}}(typeof it.R2L=="boolean"?it.R2L:Lr)===!0&&(N=da(N,function(Si,Di,cn){return[Si.split("").reverse().join(""),Di,cn]})),Rt={text:N,x:ae,y:Ne,options:it,mutex:{pdfEscape:Ri,activeFontKey:xr,fonts:Ce,activeFontSize:Yt}},ot.publish("postProcessText",Rt),N=Rt.text,Gi=Rt.mutex.isHex||!1;var xo=Ce[xr].encoding;xo!=="WinAnsiEncoding"&&xo!=="StandardEncoding"||(N=da(N,function(Si,Di,cn){return[Cs(Si),Di,cn]})),Wt=La(N),N=[];for(var Da,Fa,za,Na=Array.isArray(Wt[0])?1:0,gs="",Ja=function(Si,Di,cn){var Cn="";return cn instanceof Ct?(cn=typeof it.angle=="number"?Ht(cn,new Ct(1,0,0,1,Si,Di)):Ht(new Ct(1,0,0,1,Si,Di),cn),De===Be&&(cn=Ht(new Ct(1,0,0,-1,0,0),cn)),Cn=cn.join(" ")+` Tm
`):Cn=Ze(Si)+" "+Ze(Di)+` Td
`,Cn},Ys=0;Ys<Wt.length;Ys++){switch(gs="",Na){case 1:za=(Gi?"<":"(")+Wt[Ys][0]+(Gi?">":")"),Da=parseFloat(Wt[Ys][1]),Fa=parseFloat(Wt[Ys][2]);break;case 0:za=(Gi?"<":"(")+Wt[Ys]+(Gi?">":")"),Da=Xn(ae),Fa=Ki(Ne)}Ya!==void 0&&Ya[Ys]!==void 0&&(gs=Ya[Ys]+` Tw
`),Ys===0?N.push(gs+Ja(Da,Fa,pn)+za):Na===0?N.push(gs+za):Na===1&&N.push(gs+Ja(Da,Fa,pn)+za)}N=Na===0?N.join(` Tj
T* `):N.join(` Tj
`),N+=` Tj
`;var ma=`BT
/`;return ma+=xr+" "+Yt+` Tf
`,ma+=Ze(Yt*fs)+` TL
`,ma+=Mi+`
`,ma+=Sn,ma+=N,Le(ma+="ET"),ne[xr]=!0,Ei};var Wl=j.__private__.clip=j.clip=function(N){return Le(N==="evenodd"?"W*":"W"),this};j.clipEvenOdd=function(){return Wl("evenodd")},j.__private__.discardPath=j.discardPath=function(){return Le("n"),this};var js=j.__private__.isValidStyle=function(N){var ae=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(N)!==-1&&(ae=!0),ae};j.__private__.setDefaultPathOperation=j.setDefaultPathOperation=function(N){return js(N)&&(F=N),this};var wc=j.__private__.getStyle=j.getStyle=function(N){var ae=F;switch(N){case"D":case"S":ae="S";break;case"F":ae="f";break;case"FD":case"DF":ae="B";break;case"f":case"f*":case"B":case"B*":ae=N}return ae},mo=j.close=function(){return Le("h"),this};j.stroke=function(){return Le("S"),this},j.fill=function(N){return $a("f",N),this},j.fillEvenOdd=function(N){return $a("f*",N),this},j.fillStroke=function(N){return $a("B",N),this},j.fillStrokeEvenOdd=function(N){return $a("B*",N),this};var $a=function(N,ae){Wi(ae)==="object"?Hl(ae,N):Le(N)},go=function(N){N===null||De===Be&&N===void 0||(N=wc(N),Le(N))};function _o(N,ae,Ne,it,pt){var Rt=new oh(ae||this.boundingBox,Ne||this.xStep,it||this.yStep,this.gState,pt||this.matrix);Rt.stream=this.stream;var Wt=N+"$$"+this.cloneIndex+++"$$";return dr(Wt,Rt),Rt}var Hl=function(N,ae){var Ne=P[N.key],it=Y[Ne];if(it instanceof xu)Le("q"),Le(Oo(ae)),it.gState&&j.setGState(it.gState),Le(N.matrix.toString()+" cm"),Le("/"+Ne+" sh"),Le("Q");else if(it instanceof oh){var pt=new Ct(1,0,0,-1,0,Zs());N.matrix&&(pt=pt.multiply(N.matrix||Gt),Ne=_o.call(it,N.key,N.boundingBox,N.xStep,N.yStep,pt).id),Le("q"),Le("/Pattern cs"),Le("/"+Ne+" scn"),it.gState&&j.setGState(it.gState),Le(ae),Le("Q")}},Oo=function(N){switch(N){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},Vs=j.moveTo=function(N,ae){return Le(Ze(Ge(N))+" "+Ze(Ye(ae))+" m"),this},Za=j.lineTo=function(N,ae){return Le(Ze(Ge(N))+" "+Ze(Ye(ae))+" l"),this},Ur=j.curveTo=function(N,ae,Ne,it,pt,Rt){return Le([Ze(Ge(N)),Ze(Ye(ae)),Ze(Ge(Ne)),Ze(Ye(it)),Ze(Ge(pt)),Ze(Ye(Rt)),"c"].join(" ")),this};j.__private__.line=j.line=function(N,ae,Ne,it,pt){if(isNaN(N)||isNaN(ae)||isNaN(Ne)||isNaN(it)||!js(pt))throw new Error("Invalid arguments passed to jsPDF.line");return De===Je?this.lines([[Ne-N,it-ae]],N,ae,[1,1],pt||"S"):this.lines([[Ne-N,it-ae]],N,ae,[1,1]).stroke()},j.__private__.lines=j.lines=function(N,ae,Ne,it,pt,Rt){var Wt,ar,Pr,Wr,Xr,Or,Hi,pn,Ei,Ln,Gi,Sn;if(typeof N=="number"&&(Sn=Ne,Ne=ae,ae=N,N=Sn),it=it||[1,1],Rt=Rt||!1,isNaN(ae)||isNaN(Ne)||!Array.isArray(N)||!Array.isArray(it)||!js(pt)||typeof Rt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Vs(ae,Ne),Wt=it[0],ar=it[1],Wr=N.length,Ln=ae,Gi=Ne,Pr=0;Pr<Wr;Pr++)(Xr=N[Pr]).length===2?(Ln=Xr[0]*Wt+Ln,Gi=Xr[1]*ar+Gi,Za(Ln,Gi)):(Or=Xr[0]*Wt+Ln,Hi=Xr[1]*ar+Gi,pn=Xr[2]*Wt+Ln,Ei=Xr[3]*ar+Gi,Ln=Xr[4]*Wt+Ln,Gi=Xr[5]*ar+Gi,Ur(Or,Hi,pn,Ei,Ln,Gi));return Rt&&mo(),go(pt),this},j.path=function(N){for(var ae=0;ae<N.length;ae++){var Ne=N[ae],it=Ne.c;switch(Ne.op){case"m":Vs(it[0],it[1]);break;case"l":Za(it[0],it[1]);break;case"c":Ur.apply(this,it);break;case"h":mo()}}return this},j.__private__.rect=j.rect=function(N,ae,Ne,it,pt){if(isNaN(N)||isNaN(ae)||isNaN(Ne)||isNaN(it)||!js(pt))throw new Error("Invalid arguments passed to jsPDF.rect");return De===Je&&(it=-it),Le([Ze(Ge(N)),Ze(Ye(ae)),Ze(Ge(Ne)),Ze(Ge(it)),"re"].join(" ")),go(pt),this},j.__private__.triangle=j.triangle=function(N,ae,Ne,it,pt,Rt,Wt){if(isNaN(N)||isNaN(ae)||isNaN(Ne)||isNaN(it)||isNaN(pt)||isNaN(Rt)||!js(Wt))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Ne-N,it-ae],[pt-Ne,Rt-it],[N-pt,ae-Rt]],N,ae,[1,1],Wt,!0),this},j.__private__.roundedRect=j.roundedRect=function(N,ae,Ne,it,pt,Rt,Wt){if(isNaN(N)||isNaN(ae)||isNaN(Ne)||isNaN(it)||isNaN(pt)||isNaN(Rt)||!js(Wt))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var ar=4/3*(Math.SQRT2-1);return pt=Math.min(pt,.5*Ne),Rt=Math.min(Rt,.5*it),this.lines([[Ne-2*pt,0],[pt*ar,0,pt,Rt-Rt*ar,pt,Rt],[0,it-2*Rt],[0,Rt*ar,-pt*ar,Rt,-pt,Rt],[2*pt-Ne,0],[-pt*ar,0,-pt,-Rt*ar,-pt,-Rt],[0,2*Rt-it],[0,-Rt*ar,pt*ar,-Rt,pt,-Rt]],N+pt,ae,[1,1],Wt,!0),this},j.__private__.ellipse=j.ellipse=function(N,ae,Ne,it,pt){if(isNaN(N)||isNaN(ae)||isNaN(Ne)||isNaN(it)||!js(pt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Rt=4/3*(Math.SQRT2-1)*Ne,Wt=4/3*(Math.SQRT2-1)*it;return Vs(N+Ne,ae),Ur(N+Ne,ae-Wt,N+Rt,ae-it,N,ae-it),Ur(N-Rt,ae-it,N-Ne,ae-Wt,N-Ne,ae),Ur(N-Ne,ae+Wt,N-Rt,ae+it,N,ae+it),Ur(N+Rt,ae+it,N+Ne,ae+Wt,N+Ne,ae),go(pt),this},j.__private__.circle=j.circle=function(N,ae,Ne,it){if(isNaN(N)||isNaN(ae)||isNaN(Ne)||!js(it))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(N,ae,Ne,Ne,it)},j.setFont=function(N,ae,Ne){return Ne&&(ae=st(ae,Ne)),xr=ds(N,ae,{disableWarning:!1}),this};var Xl=j.__private__.getFont=j.getFont=function(){return Ce[ds.apply(j,arguments)]};j.__private__.getFontList=j.getFontList=function(){var N,ae,Ne={};for(N in Oe)if(Oe.hasOwnProperty(N))for(ae in Ne[N]=[],Oe[N])Oe[N].hasOwnProperty(ae)&&Ne[N].push(ae);return Ne},j.addFont=function(N,ae,Ne,it,pt){var Rt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Rt.indexOf(arguments[3])!==-1?pt=arguments[3]:arguments[3]&&Rt.indexOf(arguments[3])==-1&&(Ne=st(Ne,it)),fo.call(this,N,ae,Ne,pt=pt||"Identity-H")};var jo,Vo=p.lineWidth||.200025,Hn=j.__private__.getLineWidth=j.getLineWidth=function(){return Vo},kr=j.__private__.setLineWidth=j.setLineWidth=function(N){return Vo=N,Le(Ze(Ge(N))+" w"),this};j.__private__.setLineDash=jr.API.setLineDash=jr.API.setLineDashPattern=function(N,ae){if(N=N||[],ae=ae||0,isNaN(ae)||!Array.isArray(N))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return N=N.map(function(Ne){return Ze(Ge(Ne))}).join(" "),ae=Ze(Ge(ae)),Le("["+N+"] "+ae+" d"),this};var Bi=j.__private__.getLineHeight=j.getLineHeight=function(){return Yt*jo};j.__private__.getLineHeight=j.getLineHeight=function(){return Yt*jo};var Br=j.__private__.setLineHeightFactor=j.setLineHeightFactor=function(N){return typeof(N=N||1.15)=="number"&&(jo=N),this},wi=j.__private__.getLineHeightFactor=j.getLineHeightFactor=function(){return jo};Br(p.lineHeight);var Xn=j.__private__.getHorizontalCoordinate=function(N){return Ge(N)},Ki=j.__private__.getVerticalCoordinate=function(N){return De===Be?N:ie[Fe].mediaBox.topRightY-ie[Fe].mediaBox.bottomLeftY-Ge(N)},is=j.__private__.getHorizontalCoordinateString=j.getHorizontalCoordinateString=function(N){return Ze(Xn(N))},Un=j.__private__.getVerticalCoordinateString=j.getVerticalCoordinateString=function(N){return Ze(Ki(N))},ca=p.strokeColor||"0 G";j.__private__.getStrokeColor=j.getDrawColor=function(){return Xt(ca)},j.__private__.setStrokeColor=j.setDrawColor=function(N,ae,Ne,it){return ca=Er({ch1:N,ch2:ae,ch3:Ne,ch4:it,pdfColorType:"draw",precision:2}),Le(ca),this};var Us=p.fillColor||"0 g";j.__private__.getFillColor=j.getFillColor=function(){return Xt(Us)},j.__private__.setFillColor=j.setFillColor=function(N,ae,Ne,it){return Us=Er({ch1:N,ch2:ae,ch3:Ne,ch4:it,pdfColorType:"fill",precision:2}),Le(Us),this};var Mi=p.textColor||"0 g",Wa=j.__private__.getTextColor=j.getTextColor=function(){return Xt(Mi)};j.__private__.setTextColor=j.setTextColor=function(N,ae,Ne,it){return Mi=Er({ch1:N,ch2:ae,ch3:Ne,ch4:it,pdfColorType:"text",precision:3}),this};var Fn=p.charSpace,gl=j.__private__.getCharSpace=j.getCharSpace=function(){return parseFloat(Fn||0)};j.__private__.setCharSpace=j.setCharSpace=function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Fn=N,this};var zn=0;j.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},j.__private__.setLineCap=j.setLineCap=function(N){var ae=j.CapJoinStyles[N];if(ae===void 0)throw new Error("Line cap style of '"+N+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return zn=ae,Le(ae+" J"),this};var ua=0;j.__private__.setLineJoin=j.setLineJoin=function(N){var ae=j.CapJoinStyles[N];if(ae===void 0)throw new Error("Line join style of '"+N+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return ua=ae,Le(ae+" j"),this},j.__private__.setLineMiterLimit=j.__private__.setMiterLimit=j.setLineMiterLimit=j.setMiterLimit=function(N){if(N=N||0,isNaN(N))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return Le(Ze(Ge(N))+" M"),this},j.GState=Wd,j.setGState=function(N){(N=typeof N=="string"?k[ee[N]]:qs(null,N)).equals(le)||(Le("/"+N.id+" gs"),le=N)};var qs=function(N,ae){if(!N||!ee[N]){var Ne=!1;for(var it in k)if(k.hasOwnProperty(it)&&k[it].equals(ae)){Ne=!0;break}if(Ne)ae=k[it];else{var pt="GS"+(Object.keys(k).length+1).toString(10);k[pt]=ae,ae.id=pt}return N&&(ee[N]=ae.id),ot.publish("addGState",ae),ae}};j.addGState=function(N,ae){return qs(N,ae),this},j.saveGraphicsState=function(){return Le("q"),ht.push({key:xr,size:Yt,color:Mi}),this},j.restoreGraphicsState=function(){Le("Q");var N=ht.pop();return xr=N.key,Yt=N.size,Mi=N.color,le=null,this},j.setCurrentTransformationMatrix=function(N){return Le(N.toString()+" cm"),this},j.comment=function(N){return Le("#"+N),this};var Ia=function(N,ae){var Ne=N||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Ne},set:function(Rt){isNaN(Rt)||(Ne=parseFloat(Rt))}});var it=ae||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return it},set:function(Rt){isNaN(Rt)||(it=parseFloat(Rt))}});var pt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return pt},set:function(Rt){pt=Rt.toString()}}),this},Uo=function(N,ae,Ne,it){Ia.call(this,N,ae),this.type="rect";var pt=Ne||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return pt},set:function(Wt){isNaN(Wt)||(pt=parseFloat(Wt))}});var Rt=it||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Rt},set:function(Wt){isNaN(Wt)||(Rt=parseFloat(Wt))}}),this},Gs=function(){this.page=ge,this.currentPage=Fe,this.pages=Zt.slice(0),this.pagesContext=ie.slice(0),this.x=W,this.y=te,this.matrix=se,this.width=si(Fe),this.height=Ha(Fe),this.outputDestination=ur,this.id="",this.objectNumber=-1};Gs.prototype.restore=function(){ge=this.page,Fe=this.currentPage,ie=this.pagesContext,Zt=this.pages,W=this.x,te=this.y,se=this.matrix,Zr(Fe,this.width),Qr(Fe,this.height),ur=this.outputDestination};var vi=function(N,ae,Ne,it,pt){Dt.push(new Gs),ge=Fe=0,Zt=[],W=N,te=ae,se=pt,gi([Ne,it])};for(var $s in j.beginFormObject=function(N,ae,Ne,it,pt){return vi(N,ae,Ne,it,pt),this},j.endFormObject=function(N){return(function(ae){if(dt[ae])Dt.pop().restore();else{var Ne=new Gs,it="Xo"+(Object.keys(ct).length+1).toString(10);Ne.id=it,dt[ae]=it,ct[it]=Ne,ot.publish("addFormObject",Ne),Dt.pop().restore()}})(N),this},j.doFormObject=function(N,ae){var Ne=ct[dt[N]];return Le("q"),Le(ae.toString()+" cm"),Le("/"+Ne.id+" Do"),Le("Q"),this},j.getFormObject=function(N){var ae=ct[dt[N]];return{x:ae.x,y:ae.y,width:ae.width,height:ae.height,matrix:ae.matrix}},j.save=function(N,ae){return N=N||"generated.pdf",(ae=ae||{}).returnPromise=ae.returnPromise||!1,ae.returnPromise===!1?(bu(Aa(la()),N),typeof bu.unload=="function"&&ti.setTimeout&&setTimeout(bu.unload,911),this):new Promise(function(Ne,it){try{var pt=bu(Aa(la()),N);typeof bu.unload=="function"&&ti.setTimeout&&setTimeout(bu.unload,911),Ne(pt)}catch(Rt){it(Rt.message)}})},jr.API)jr.API.hasOwnProperty($s)&&($s==="events"&&jr.API.events.length?(function(N,ae){var Ne,it,pt;for(pt=ae.length-1;pt!==-1;pt--)Ne=ae[pt][0],it=ae[pt][1],N.subscribe.apply(N,[Ne].concat(typeof it=="function"?[it]:it))})(ot,jr.API.events):j[$s]=jr.API[$s]);function si(N){return ie[N].mediaBox.topRightX-ie[N].mediaBox.bottomLeftX}function Zr(N,ae){ie[N].mediaBox.topRightX=ae+ie[N].mediaBox.bottomLeftX}function Ha(N){return ie[N].mediaBox.topRightY-ie[N].mediaBox.bottomLeftY}function Qr(N,ae){ie[N].mediaBox.topRightY=ae+ie[N].mediaBox.bottomLeftY}var Is=j.getPageWidth=function(N){return si(N=N||Fe)/Qe},ns=j.setPageWidth=function(N,ae){Zr(N,ae*Qe)},Zs=j.getPageHeight=function(N){return Ha(N=N||Fe)/Qe},ha=j.setPageHeight=function(N,ae){Qr(N,ae*Qe)};return j.internal={pdfEscape:Ri,getStyle:wc,getFont:Xl,getFontSize:yr,getCharSpace:gl,getTextColor:Wa,getLineHeight:Bi,getLineHeightFactor:wi,getLineWidth:Hn,write:lr,getHorizontalCoordinate:Xn,getVerticalCoordinate:Ki,getCoordinateString:is,getVerticalCoordinateString:Un,collections:{},newObject:Nr,newAdditionalObject:zi,newObjectDeferred:Lt,newObjectDeferredBegin:wr,getFilters:Rr,putStream:Ni,events:ot,scaleFactor:Qe,pageSize:{getWidth:function(){return Is(Fe)},setWidth:function(N){ns(Fe,N)},getHeight:function(){return Zs(Fe)},setHeight:function(N){ha(Fe,N)}},encryptionOptions:B,encryption:wn,getEncryptor:function(N){return B!==null?wn.encryptor(N,0):function(ae){return ae}},output:$l,getNumberOfPages:Pa,get pages(){return Zt},out:Le,f2:_e,f3:we,getPageInfo:Os,getPageInfoByObjId:ml,getCurrentPageInfo:Zl,getPDFVersion:he,Point:Ia,Rectangle:Uo,Matrix:Ct,hasHotfix:As},Object.defineProperty(j.internal.pageSize,"width",{get:function(){return Is(Fe)},set:function(N){ns(Fe,N)},enumerable:!0,configurable:!0}),Object.defineProperty(j.internal.pageSize,"height",{get:function(){return Zs(Fe)},set:function(N){ha(Fe,N)},enumerable:!0,configurable:!0}),(function(N){for(var ae=0,Ne=Tr.length;ae<Ne;ae++){var it=fo.call(this,N[ae][0],N[ae][1],N[ae][2],Tr[ae][3],!0);Q===!1&&(ne[it]=!0);var pt=N[ae][0].split("-");Ga({id:it,fontName:pt[0],fontStyle:pt[1]||""})}ot.publish("addFonts",{fonts:Ce,dictionary:Oe})}).call(j,Tr),xr="F1",Bo(v,u),ot.publish("initialized"),j}ih.prototype.lsbFirstWord=function(p){return String.fromCharCode(255&p,p>>8&255,p>>16&255,p>>24&255)},ih.prototype.toHexString=function(p){return p.split("").map(function(l){return("0"+(255&l.charCodeAt(0)).toString(16)).slice(-2)}).join("")},ih.prototype.hexToBytes=function(p){for(var l=[],u=0;u<p.length;u+=2)l.push(String.fromCharCode(parseInt(p.substr(u,2),16)));return l.join("")},ih.prototype.processOwnerPassword=function(p,l){return jp(Op(l).substr(0,5),p)},ih.prototype.encryptor=function(p,l){var u=Op(this.encryptionKey+String.fromCharCode(255&p,p>>8&255,p>>16&255,255&l,l>>8&255)).substr(0,10);return function(g){return jp(u,g)}},Wd.prototype.equals=function(p){var l,u="id,objectNumber,equals";if(!p||Wi(p)!==Wi(this))return!1;var g=0;for(l in this)if(!(u.indexOf(l)>=0)){if(this.hasOwnProperty(l)&&!p.hasOwnProperty(l)||this[l]!==p[l])return!1;g++}for(l in p)p.hasOwnProperty(l)&&u.indexOf(l)<0&&g--;return g===0},jr.API={events:[]},jr.version="4.0.0";var Vn=jr.API,Yp=1,Au=function(p){return p.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},eh=function(p){return p.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},oi=function(p){return p.toFixed(2)},Gc=function(p){return p.toFixed(5)};Vn.__acroform__={};var Va=function(p,l){p.prototype=Object.create(l.prototype),p.prototype.constructor=p},xy=function(p){return p*Yp},Vl=function(p){var l=new D0,u=Fr.internal.getHeight(p)||0,g=Fr.internal.getWidth(p)||0;return l.BBox=[0,0,Number(oi(g)),Number(oi(u))],l},Mw=Vn.__acroform__.setBit=function(p,l){if(p=p||0,l=l||0,isNaN(p)||isNaN(l))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return p|1<<l},Ew=Vn.__acroform__.clearBit=function(p,l){if(p=p||0,l=l||0,isNaN(p)||isNaN(l))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return p&~(1<<l)},kw=Vn.__acroform__.getBit=function(p,l){if(isNaN(p)||isNaN(l))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return p&1<<l?1:0},$n=Vn.__acroform__.getBitForPdf=function(p,l){if(isNaN(p)||isNaN(l))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return kw(p,l-1)},Zn=Vn.__acroform__.setBitForPdf=function(p,l){if(isNaN(p)||isNaN(l))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Mw(p,l-1)},Wn=Vn.__acroform__.clearBitForPdf=function(p,l){if(isNaN(p)||isNaN(l))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Ew(p,l-1)},Dw=Vn.__acroform__.calculateCoordinates=function(p,l){var u=l.internal.getHorizontalCoordinate,g=l.internal.getVerticalCoordinate,v=p[0],x=p[1],b=p[2],s=p[3],E={};return E.lowerLeft_X=u(v)||0,E.lowerLeft_Y=g(x+s)||0,E.upperRight_X=u(v+b)||0,E.upperRight_Y=g(x)||0,[Number(oi(E.lowerLeft_X)),Number(oi(E.lowerLeft_Y)),Number(oi(E.upperRight_X)),Number(oi(E.upperRight_Y))]},Fw=function(p){if(p.appearanceStreamContent)return p.appearanceStreamContent;if(p.V||p.DV){var l=[],u=p._V||p.DV,g=Vp(p,u),v=p.scope.internal.getFont(p.fontName,p.fontStyle).id;l.push("/Tx BMC"),l.push("q"),l.push("BT"),l.push(p.scope.__private__.encodeColorString(p.color)),l.push("/"+v+" "+oi(g.fontSize)+" Tf"),l.push("1 0 0 1 0 0 Tm"),l.push(g.text),l.push("ET"),l.push("Q"),l.push("EMC");var x=Vl(p);return x.scope=p.scope,x.stream=l.join(`
`),x}},Vp=function(p,l){var u=p.fontSize===0?p.maxFontSize:p.fontSize,g={text:"",fontSize:""},v=(l=(l=l.substr(0,1)=="("?l.substr(1):l).substr(l.length-1)==")"?l.substr(0,l.length-1):l).split(" ");v=p.multiline?v.map(function(_e){return _e.split(`
`)}):v.map(function(_e){return[_e]});var x=u,b=Fr.internal.getHeight(p)||0;b=b<0?-b:b;var s=Fr.internal.getWidth(p)||0;s=s<0?-s:s;var E=function(_e,we,Ge){if(_e+1<v.length){var Ye=we+" "+v[_e+1][0];return Fd(Ye,p,Ge).width<=s-4}return!1};x++;e:for(;x>0;){l="",x--;var F,B,Q=Fd("3",p,x).height,ne=p.multiline?b-x:(b-Q)/2,j=ne+=2,Ie=0,he=0,re=0;if(x<=0){l=`(...) Tj
`,l+="% Width of Text: "+Fd(l,p,x=12).width+", FieldWidth:"+s+`
`;break}for(var ye="",Je=0,Be=0;Be<v.length;Be++)if(v.hasOwnProperty(Be)){var De=!1;if(v[Be].length!==1&&re!==v[Be].length-1){if((Q+2)*(Je+2)+2>b)continue e;ye+=v[Be][re],De=!0,he=Be,Be--}else{ye=(ye+=v[Be][re]+" ").substr(ye.length-1)==" "?ye.substr(0,ye.length-1):ye;var Ue=parseInt(Be),$e=E(Ue,ye,x),st=Be>=v.length-1;if($e&&!st){ye+=" ",re=0;continue}if($e||st){if(st)he=Ue;else if(p.multiline&&(Q+2)*(Je+2)+2>b)continue e}else{if(!p.multiline||(Q+2)*(Je+2)+2>b)continue e;he=Ue}}for(var Ze="",Pe=Ie;Pe<=he;Pe++){var rt=v[Pe];if(p.multiline){if(Pe===he){Ze+=rt[re]+" ",re=(re+1)%rt.length;continue}if(Pe===Ie){Ze+=rt[rt.length-1]+" ";continue}}Ze+=rt[0]+" "}switch(Ze=Ze.substr(Ze.length-1)==" "?Ze.substr(0,Ze.length-1):Ze,B=Fd(Ze,p,x).width,p.textAlign){case"right":F=s-B-2;break;case"center":F=(s-B)/2;break;default:F=2}l+=oi(F)+" "+oi(j)+` Td
`,l+="("+Au(Ze)+`) Tj
`,l+=-oi(F)+` 0 Td
`,j=-(x+2),B=0,Ie=De?he:he+1,Je++,ye=""}break}return g.text=l,g.fontSize=x,g},Fd=function(p,l,u){var g=l.scope.internal.getFont(l.fontName,l.fontStyle),v=l.scope.getStringUnitWidth(p,{font:g,fontSize:parseFloat(u),charSpace:0})*parseFloat(u);return{height:l.scope.getStringUnitWidth("3",{font:g,fontSize:parseFloat(u),charSpace:0})*parseFloat(u)*1.5,width:v}},zw={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},Nw=function(p,l){var u={type:"reference",object:p};l.internal.getPageInfo(p.page).pageContext.annotations.find(function(g){return g.type===u.type&&g.object===u.object})===void 0&&l.internal.getPageInfo(p.page).pageContext.annotations.push(u)},Rw=function(p,l){if(l.scope=p,p.internal!==void 0&&(p.internal.acroformPlugin===void 0||p.internal.acroformPlugin.isInitialized===!1)){if(dl.FieldNum=0,p.internal.acroformPlugin=JSON.parse(JSON.stringify(zw)),p.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Yp=p.internal.scaleFactor,p.internal.acroformPlugin.acroFormDictionaryRoot=new F0,p.internal.acroformPlugin.acroFormDictionaryRoot.scope=p,p.internal.acroformPlugin.acroFormDictionaryRoot._eventID=p.internal.events.subscribe("postPutResources",function(){(function(u){u.internal.events.unsubscribe(u.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete u.internal.acroformPlugin.acroFormDictionaryRoot._eventID,u.internal.acroformPlugin.printedOut=!0})(p)}),p.internal.events.subscribe("buildDocument",function(){(function(u){u.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var g=u.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var v in g)if(g.hasOwnProperty(v)){var x=g[v];x.objId=void 0,x.hasAnnotation&&Nw(x,u)}})(p)}),p.internal.events.subscribe("putCatalog",function(){(function(u){if(u.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");u.internal.write("/AcroForm "+u.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(p)}),p.internal.events.subscribe("postPutPages",function(u){(function(g,v){var x=!g;for(var b in g||(v.internal.newObjectDeferredBegin(v.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),v.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),g=g||v.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(g.hasOwnProperty(b)){var s=g[b],E=[],F=s.Rect;if(s.Rect&&(s.Rect=Dw(s.Rect,v)),v.internal.newObjectDeferredBegin(s.objId,!0),s.DA=Fr.createDefaultAppearanceStream(s),Wi(s)==="object"&&typeof s.getKeyValueListForStream=="function"&&(E=s.getKeyValueListForStream()),s.Rect=F,s.hasAppearanceStream&&!s.appearanceStreamContent){var B=Fw(s);E.push({key:"AP",value:"<</N "+B+">>"}),v.internal.acroformPlugin.xForms.push(B)}if(s.appearanceStreamContent){var Q="";for(var ne in s.appearanceStreamContent)if(s.appearanceStreamContent.hasOwnProperty(ne)){var j=s.appearanceStreamContent[ne];if(Q+="/"+ne+" ",Q+="<<",Object.keys(j).length>=1||Array.isArray(j)){for(var b in j)if(j.hasOwnProperty(b)){var Ie=j[b];typeof Ie=="function"&&(Ie=Ie.call(v,s)),Q+="/"+b+" "+Ie+" ",v.internal.acroformPlugin.xForms.indexOf(Ie)>=0||v.internal.acroformPlugin.xForms.push(Ie)}}else typeof(Ie=j)=="function"&&(Ie=Ie.call(v,s)),Q+="/"+b+" "+Ie,v.internal.acroformPlugin.xForms.indexOf(Ie)>=0||v.internal.acroformPlugin.xForms.push(Ie);Q+=">>"}E.push({key:"AP",value:`<<
`+Q+">>"})}v.internal.putStream({additionalKeyValues:E,objectId:s.objId}),v.internal.out("endobj")}x&&(function(he,re){for(var ye in he)if(he.hasOwnProperty(ye)){var Je=ye,Be=he[ye];re.internal.newObjectDeferredBegin(Be.objId,!0),Wi(Be)==="object"&&typeof Be.putStream=="function"&&Be.putStream(),delete he[Je]}})(v.internal.acroformPlugin.xForms,v)})(u,p)}),p.internal.acroformPlugin.isInitialized=!0}},k0=Vn.__acroform__.arrayToPdfArray=function(p,l,u){var g=function(b){return b};if(Array.isArray(p)){for(var v="[",x=0;x<p.length;x++)switch(x!==0&&(v+=" "),Wi(p[x])){case"boolean":case"number":case"object":v+=p[x].toString();break;case"string":p[x].substr(0,1)!=="/"?(l!==void 0&&u&&(g=u.internal.getEncryptor(l)),v+="("+Au(g(p[x].toString()))+")"):v+=p[x].toString()}return v+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},Pp=function(p,l,u){var g=function(v){return v};return l!==void 0&&u&&(g=u.internal.getEncryptor(l)),(p=p||"").toString(),"("+Au(g(p))+")"},Ul=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(p){this._objId=p}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Ul.prototype.toString=function(){return this.objId+" 0 R"},Ul.prototype.putStream=function(){var p=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:p,objectId:this.objId}),this.scope.internal.out("endobj")},Ul.prototype.getKeyValueListForStream=function(){var p=[],l=Object.getOwnPropertyNames(this).filter(function(x){return x!="content"&&x!="appearanceStreamContent"&&x!="scope"&&x!="objId"&&x.substring(0,1)!="_"});for(var u in l)if(Object.getOwnPropertyDescriptor(this,l[u]).configurable===!1){var g=l[u],v=this[g];v&&(Array.isArray(v)?p.push({key:g,value:k0(v,this.objId,this.scope)}):v instanceof Ul?(v.scope=this.scope,p.push({key:g,value:v.objId+" 0 R"})):typeof v!="function"&&p.push({key:g,value:v}))}return p};var D0=function(){Ul.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var p,l=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return l},set:function(u){l=u}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(u){p=u.trim()},get:function(){return p||null}})};Va(D0,Ul);var F0=function(){Ul.call(this);var p,l=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return l.length>0?l:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return l}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(p){var u=function(g){return g};return this.scope&&(u=this.scope.internal.getEncryptor(this.objId)),"("+Au(u(p))+")"}},set:function(u){p=u}})};Va(F0,Ul);var dl=function p(){Ul.call(this);var l=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return l},set:function(ye){if(isNaN(ye))throw new Error('Invalid value "'+ye+'" for attribute F supplied.');l=ye}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!$n(l,3)},set:function(ye){ye?this.F=Zn(l,3):this.F=Wn(l,3)}});var u=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return u},set:function(ye){if(isNaN(ye))throw new Error('Invalid value "'+ye+'" for attribute Ff supplied.');u=ye}});var g=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(g.length!==0)return g},set:function(ye){g=ye!==void 0?ye:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!g||isNaN(g[0])?0:g[0]},set:function(ye){g[0]=ye}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!g||isNaN(g[1])?0:g[1]},set:function(ye){g[1]=ye}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!g||isNaN(g[2])?0:g[2]},set:function(ye){g[2]=ye}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!g||isNaN(g[3])?0:g[3]},set:function(ye){g[3]=ye}});var v="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return v},set:function(ye){switch(ye){case"/Btn":case"/Tx":case"/Ch":case"/Sig":v=ye;break;default:throw new Error('Invalid value "'+ye+'" for attribute FT supplied.')}}});var x=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!x||x.length<1){if(this instanceof Hd)return;x="FieldObject"+p.FieldNum++}var ye=function(Je){return Je};return this.scope&&(ye=this.scope.internal.getEncryptor(this.objId)),"("+Au(ye(x))+")"},set:function(ye){x=ye.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return x},set:function(ye){x=ye}});var b="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return b},set:function(ye){b=ye}});var s="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return s},set:function(ye){s=ye}});var E=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return E},set:function(ye){E=ye}});var F=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return F===void 0?50/Yp:F},set:function(ye){F=ye}});var B="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return B},set:function(ye){B=ye}});var Q="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!Q||this instanceof Hd||this instanceof wu))return Pp(Q,this.objId,this.scope)},set:function(ye){ye=ye.toString(),Q=ye}});var ne=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(ne)return this instanceof Ts==0?Pp(ne,this.objId,this.scope):ne},set:function(ye){ye=ye.toString(),ne=this instanceof Ts==0?ye.substr(0,1)==="("?eh(ye.substr(1,ye.length-2)):eh(ye):ye}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ts==1?eh(ne.substr(1,ne.length-1)):ne},set:function(ye){ye=ye.toString(),ne=this instanceof Ts==1?"/"+ye:ye}});var j=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(j)return j},set:function(ye){this.V=ye}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(j)return this instanceof Ts==0?Pp(j,this.objId,this.scope):j},set:function(ye){ye=ye.toString(),j=this instanceof Ts==0?ye.substr(0,1)==="("?eh(ye.substr(1,ye.length-2)):eh(ye):ye}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ts==1?eh(j.substr(1,j.length-1)):j},set:function(ye){ye=ye.toString(),j=this instanceof Ts==1?"/"+ye:ye}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var Ie,he=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return he},set:function(ye){ye=!!ye,he=ye}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(Ie)return Ie},set:function(ye){Ie=ye}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,1)},set:function(ye){ye?this.Ff=Zn(this.Ff,1):this.Ff=Wn(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,2)},set:function(ye){ye?this.Ff=Zn(this.Ff,2):this.Ff=Wn(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,3)},set:function(ye){ye?this.Ff=Zn(this.Ff,3):this.Ff=Wn(this.Ff,3)}});var re=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(re!==null)return re},set:function(ye){if([0,1,2].indexOf(ye)===-1)throw new Error('Invalid value "'+ye+'" for attribute Q supplied.');re=ye}}),Object.defineProperty(this,"textAlign",{get:function(){var ye;switch(re){case 0:default:ye="left";break;case 1:ye="center";break;case 2:ye="right"}return ye},configurable:!0,enumerable:!0,set:function(ye){switch(ye){case"right":case 2:re=2;break;case"center":case 1:re=1;break;default:re=0}}})};Va(dl,Ul);var ch=function(){dl.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var p=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return p},set:function(u){p=u}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return p},set:function(u){p=u}});var l=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return k0(l,this.objId,this.scope)},set:function(u){var g,v;v=[],typeof(g=u)=="string"&&(v=(function(x,b,s){s||(s=1);for(var E,F=[];E=b.exec(x);)F.push(E[s]);return F})(g,/\((.*?)\)/g)),l=v}}),this.getOptions=function(){return l},this.setOptions=function(u){l=u,this.sort&&l.sort()},this.addOption=function(u){u=(u=u||"").toString(),l.push(u),this.sort&&l.sort()},this.removeOption=function(u,g){for(g=g||!1,u=(u=u||"").toString();l.indexOf(u)!==-1&&(l.splice(l.indexOf(u),1),g!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,18)},set:function(u){u?this.Ff=Zn(this.Ff,18):this.Ff=Wn(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,19)},set:function(u){this.combo===!0&&(u?this.Ff=Zn(this.Ff,19):this.Ff=Wn(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,20)},set:function(u){u?(this.Ff=Zn(this.Ff,20),l.sort()):this.Ff=Wn(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,22)},set:function(u){u?this.Ff=Zn(this.Ff,22):this.Ff=Wn(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,23)},set:function(u){u?this.Ff=Zn(this.Ff,23):this.Ff=Wn(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,27)},set:function(u){u?this.Ff=Zn(this.Ff,27):this.Ff=Wn(this.Ff,27)}}),this.hasAppearanceStream=!1};Va(ch,dl);var uh=function(){ch.call(this),this.fontName="helvetica",this.combo=!1};Va(uh,ch);var hh=function(){uh.call(this),this.combo=!0};Va(hh,uh);var Vd=function(){hh.call(this),this.edit=!0};Va(Vd,hh);var Ts=function(){dl.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,15)},set:function(u){u?this.Ff=Zn(this.Ff,15):this.Ff=Wn(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,16)},set:function(u){u?this.Ff=Zn(this.Ff,16):this.Ff=Wn(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,17)},set:function(u){u?this.Ff=Zn(this.Ff,17):this.Ff=Wn(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,26)},set:function(u){u?this.Ff=Zn(this.Ff,26):this.Ff=Wn(this.Ff,26)}});var p,l={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var u=function(x){return x};if(this.scope&&(u=this.scope.internal.getEncryptor(this.objId)),Object.keys(l).length!==0){var g,v=[];for(g in v.push("<<"),l)v.push("/"+g+" ("+Au(u(l[g]))+")");return v.push(">>"),v.join(`
`)}},set:function(u){Wi(u)==="object"&&(l=u)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return l.CA||""},set:function(u){typeof u=="string"&&(l.CA=u)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return p},set:function(u){p=u}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return p.substr(1,p.length-1)},set:function(u){p="/"+u}})};Va(Ts,dl);var Ud=function(){Ts.call(this),this.pushButton=!0};Va(Ud,Ts);var dh=function(){Ts.call(this),this.radio=!0,this.pushButton=!1;var p=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return p},set:function(l){p=l!==void 0?l:[]}})};Va(dh,Ts);var Hd=function(){var p,l;dl.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return p},set:function(v){p=v}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return l},set:function(v){l=v}});var u,g={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var v=function(s){return s};this.scope&&(v=this.scope.internal.getEncryptor(this.objId));var x,b=[];for(x in b.push("<<"),g)b.push("/"+x+" ("+Au(v(g[x]))+")");return b.push(">>"),b.join(`
`)},set:function(v){Wi(v)==="object"&&(g=v)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return g.CA||""},set:function(v){typeof v=="string"&&(g.CA=v)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return u},set:function(v){u=v}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return u.substr(1,u.length-1)},set:function(v){u="/"+v}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Fr.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Va(Hd,dl),dh.prototype.setAppearance=function(p){if(!("createAppearanceStream"in p)||!("getCA"in p))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var l in this.Kids)if(this.Kids.hasOwnProperty(l)){var u=this.Kids[l];u.appearanceStreamContent=p.createAppearanceStream(u.optionName),u.caption=p.getCA()}},dh.prototype.createOption=function(p){var l=new Hd;return l.Parent=this,l.optionName=p,this.Kids.push(l),Bw.call(this.scope,l),l};var qd=function(){Ts.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Fr.CheckBox.createAppearanceStream()};Va(qd,Ts);var wu=function(){dl.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,13)},set:function(l){l?this.Ff=Zn(this.Ff,13):this.Ff=Wn(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,21)},set:function(l){l?this.Ff=Zn(this.Ff,21):this.Ff=Wn(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,23)},set:function(l){l?this.Ff=Zn(this.Ff,23):this.Ff=Wn(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,24)},set:function(l){l?this.Ff=Zn(this.Ff,24):this.Ff=Wn(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,25)},set:function(l){l?this.Ff=Zn(this.Ff,25):this.Ff=Wn(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,26)},set:function(l){l?this.Ff=Zn(this.Ff,26):this.Ff=Wn(this.Ff,26)}});var p=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return p},set:function(l){p=l}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return p},set:function(l){Number.isInteger(l)&&(p=l)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Va(wu,dl);var Gd=function(){wu.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,14)},set:function(p){p?this.Ff=Zn(this.Ff,14):this.Ff=Wn(this.Ff,14)}}),this.password=!0};Va(Gd,wu);var Fr={CheckBox:{createAppearanceStream:function(){return{N:{On:Fr.CheckBox.YesNormal},D:{On:Fr.CheckBox.YesPushDown,Off:Fr.CheckBox.OffPushDown}}},YesPushDown:function(p){var l=Vl(p);l.scope=p.scope;var u=[],g=p.scope.internal.getFont(p.fontName,p.fontStyle).id,v=p.scope.__private__.encodeColorString(p.color),x=Vp(p,p.caption);return u.push("0.749023 g"),u.push("0 0 "+oi(Fr.internal.getWidth(p))+" "+oi(Fr.internal.getHeight(p))+" re"),u.push("f"),u.push("BMC"),u.push("q"),u.push("0 0 1 rg"),u.push("/"+g+" "+oi(x.fontSize)+" Tf "+v),u.push("BT"),u.push(x.text),u.push("ET"),u.push("Q"),u.push("EMC"),l.stream=u.join(`
`),l},YesNormal:function(p){var l=Vl(p);l.scope=p.scope;var u=p.scope.internal.getFont(p.fontName,p.fontStyle).id,g=p.scope.__private__.encodeColorString(p.color),v=[],x=Fr.internal.getHeight(p),b=Fr.internal.getWidth(p),s=Vp(p,p.caption);return v.push("1 g"),v.push("0 0 "+oi(b)+" "+oi(x)+" re"),v.push("f"),v.push("q"),v.push("0 0 1 rg"),v.push("0 0 "+oi(b-1)+" "+oi(x-1)+" re"),v.push("W"),v.push("n"),v.push("0 g"),v.push("BT"),v.push("/"+u+" "+oi(s.fontSize)+" Tf "+g),v.push(s.text),v.push("ET"),v.push("Q"),l.stream=v.join(`
`),l},OffPushDown:function(p){var l=Vl(p);l.scope=p.scope;var u=[];return u.push("0.749023 g"),u.push("0 0 "+oi(Fr.internal.getWidth(p))+" "+oi(Fr.internal.getHeight(p))+" re"),u.push("f"),l.stream=u.join(`
`),l}},RadioButton:{Circle:{createAppearanceStream:function(p){var l={D:{Off:Fr.RadioButton.Circle.OffPushDown},N:{}};return l.N[p]=Fr.RadioButton.Circle.YesNormal,l.D[p]=Fr.RadioButton.Circle.YesPushDown,l},getCA:function(){return"l"},YesNormal:function(p){var l=Vl(p);l.scope=p.scope;var u=[],g=Fr.internal.getWidth(p)<=Fr.internal.getHeight(p)?Fr.internal.getWidth(p)/4:Fr.internal.getHeight(p)/4;g=Number((.9*g).toFixed(5));var v=Fr.internal.Bezier_C,x=Number((g*v).toFixed(5));return u.push("q"),u.push("1 0 0 1 "+Gc(Fr.internal.getWidth(p)/2)+" "+Gc(Fr.internal.getHeight(p)/2)+" cm"),u.push(g+" 0 m"),u.push(g+" "+x+" "+x+" "+g+" 0 "+g+" c"),u.push("-"+x+" "+g+" -"+g+" "+x+" -"+g+" 0 c"),u.push("-"+g+" -"+x+" -"+x+" -"+g+" 0 -"+g+" c"),u.push(x+" -"+g+" "+g+" -"+x+" "+g+" 0 c"),u.push("f"),u.push("Q"),l.stream=u.join(`
`),l},YesPushDown:function(p){var l=Vl(p);l.scope=p.scope;var u=[],g=Fr.internal.getWidth(p)<=Fr.internal.getHeight(p)?Fr.internal.getWidth(p)/4:Fr.internal.getHeight(p)/4;g=Number((.9*g).toFixed(5));var v=Number((2*g).toFixed(5)),x=Number((v*Fr.internal.Bezier_C).toFixed(5)),b=Number((g*Fr.internal.Bezier_C).toFixed(5));return u.push("0.749023 g"),u.push("q"),u.push("1 0 0 1 "+Gc(Fr.internal.getWidth(p)/2)+" "+Gc(Fr.internal.getHeight(p)/2)+" cm"),u.push(v+" 0 m"),u.push(v+" "+x+" "+x+" "+v+" 0 "+v+" c"),u.push("-"+x+" "+v+" -"+v+" "+x+" -"+v+" 0 c"),u.push("-"+v+" -"+x+" -"+x+" -"+v+" 0 -"+v+" c"),u.push(x+" -"+v+" "+v+" -"+x+" "+v+" 0 c"),u.push("f"),u.push("Q"),u.push("0 g"),u.push("q"),u.push("1 0 0 1 "+Gc(Fr.internal.getWidth(p)/2)+" "+Gc(Fr.internal.getHeight(p)/2)+" cm"),u.push(g+" 0 m"),u.push(g+" "+b+" "+b+" "+g+" 0 "+g+" c"),u.push("-"+b+" "+g+" -"+g+" "+b+" -"+g+" 0 c"),u.push("-"+g+" -"+b+" -"+b+" -"+g+" 0 -"+g+" c"),u.push(b+" -"+g+" "+g+" -"+b+" "+g+" 0 c"),u.push("f"),u.push("Q"),l.stream=u.join(`
`),l},OffPushDown:function(p){var l=Vl(p);l.scope=p.scope;var u=[],g=Fr.internal.getWidth(p)<=Fr.internal.getHeight(p)?Fr.internal.getWidth(p)/4:Fr.internal.getHeight(p)/4;g=Number((.9*g).toFixed(5));var v=Number((2*g).toFixed(5)),x=Number((v*Fr.internal.Bezier_C).toFixed(5));return u.push("0.749023 g"),u.push("q"),u.push("1 0 0 1 "+Gc(Fr.internal.getWidth(p)/2)+" "+Gc(Fr.internal.getHeight(p)/2)+" cm"),u.push(v+" 0 m"),u.push(v+" "+x+" "+x+" "+v+" 0 "+v+" c"),u.push("-"+x+" "+v+" -"+v+" "+x+" -"+v+" 0 c"),u.push("-"+v+" -"+x+" -"+x+" -"+v+" 0 -"+v+" c"),u.push(x+" -"+v+" "+v+" -"+x+" "+v+" 0 c"),u.push("f"),u.push("Q"),l.stream=u.join(`
`),l}},Cross:{createAppearanceStream:function(p){var l={D:{Off:Fr.RadioButton.Cross.OffPushDown},N:{}};return l.N[p]=Fr.RadioButton.Cross.YesNormal,l.D[p]=Fr.RadioButton.Cross.YesPushDown,l},getCA:function(){return"8"},YesNormal:function(p){var l=Vl(p);l.scope=p.scope;var u=[],g=Fr.internal.calculateCross(p);return u.push("q"),u.push("1 1 "+oi(Fr.internal.getWidth(p)-2)+" "+oi(Fr.internal.getHeight(p)-2)+" re"),u.push("W"),u.push("n"),u.push(oi(g.x1.x)+" "+oi(g.x1.y)+" m"),u.push(oi(g.x2.x)+" "+oi(g.x2.y)+" l"),u.push(oi(g.x4.x)+" "+oi(g.x4.y)+" m"),u.push(oi(g.x3.x)+" "+oi(g.x3.y)+" l"),u.push("s"),u.push("Q"),l.stream=u.join(`
`),l},YesPushDown:function(p){var l=Vl(p);l.scope=p.scope;var u=Fr.internal.calculateCross(p),g=[];return g.push("0.749023 g"),g.push("0 0 "+oi(Fr.internal.getWidth(p))+" "+oi(Fr.internal.getHeight(p))+" re"),g.push("f"),g.push("q"),g.push("1 1 "+oi(Fr.internal.getWidth(p)-2)+" "+oi(Fr.internal.getHeight(p)-2)+" re"),g.push("W"),g.push("n"),g.push(oi(u.x1.x)+" "+oi(u.x1.y)+" m"),g.push(oi(u.x2.x)+" "+oi(u.x2.y)+" l"),g.push(oi(u.x4.x)+" "+oi(u.x4.y)+" m"),g.push(oi(u.x3.x)+" "+oi(u.x3.y)+" l"),g.push("s"),g.push("Q"),l.stream=g.join(`
`),l},OffPushDown:function(p){var l=Vl(p);l.scope=p.scope;var u=[];return u.push("0.749023 g"),u.push("0 0 "+oi(Fr.internal.getWidth(p))+" "+oi(Fr.internal.getHeight(p))+" re"),u.push("f"),l.stream=u.join(`
`),l}}},createDefaultAppearanceStream:function(p){var l=p.scope.internal.getFont(p.fontName,p.fontStyle).id,u=p.scope.__private__.encodeColorString(p.color);return"/"+l+" "+p.fontSize+" Tf "+u}};Fr.internal={Bezier_C:.551915024494,calculateCross:function(p){var l=Fr.internal.getWidth(p),u=Fr.internal.getHeight(p),g=Math.min(l,u);return{x1:{x:(l-g)/2,y:(u-g)/2+g},x2:{x:(l-g)/2+g,y:(u-g)/2},x3:{x:(l-g)/2,y:(u-g)/2},x4:{x:(l-g)/2+g,y:(u-g)/2+g}}}},Fr.internal.getWidth=function(p){var l=0;return Wi(p)==="object"&&(l=xy(p.Rect[2])),l},Fr.internal.getHeight=function(p){var l=0;return Wi(p)==="object"&&(l=xy(p.Rect[3])),l};var Bw=Vn.addField=function(p){if(Rw(this,p),!(p instanceof dl))throw new Error("Invalid argument passed to jsPDF.addField.");var l;return(l=p).scope.internal.acroformPlugin.printedOut&&(l.scope.internal.acroformPlugin.printedOut=!1,l.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),l.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(l),p.page=p.scope.internal.getCurrentPageInfo().pageNumber,this};Vn.AcroFormChoiceField=ch,Vn.AcroFormListBox=uh,Vn.AcroFormComboBox=hh,Vn.AcroFormEditBox=Vd,Vn.AcroFormButton=Ts,Vn.AcroFormPushButton=Ud,Vn.AcroFormRadioButton=dh,Vn.AcroFormCheckBox=qd,Vn.AcroFormTextField=wu,Vn.AcroFormPasswordField=Gd,Vn.AcroFormAppearance=Fr,Vn.AcroForm={ChoiceField:ch,ListBox:uh,ComboBox:hh,EditBox:Vd,Button:Ts,PushButton:Ud,RadioButton:dh,CheckBox:qd,TextField:wu,PasswordField:Gd,Appearance:Fr},jr.AcroForm={ChoiceField:ch,ListBox:uh,ComboBox:hh,EditBox:Vd,Button:Ts,PushButton:Ud,RadioButton:dh,CheckBox:qd,TextField:wu,PasswordField:Gd,Appearance:Fr};jr.AcroForm;function z0(p){return p.reduce(function(l,u,g){return l[u]=g,l},{})}(function(p){var l="addImage_";p.__addimage__={};var u="UNKNOWN",g={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},v=p.__addimage__.getImageFileTypeByImageData=function(_e,we){var Ge,Ye,xt,kt,yt,mt=u;if((we=we||u)==="RGBA"||_e.data!==void 0&&_e.data instanceof Uint8ClampedArray&&"height"in _e&&"width"in _e)return"RGBA";if($e(_e))for(yt in g)for(xt=g[yt],Ge=0;Ge<xt.length;Ge+=1){for(kt=!0,Ye=0;Ye<xt[Ge].length;Ye+=1)if(xt[Ge][Ye]!==void 0&&xt[Ge][Ye]!==_e[Ye]){kt=!1;break}if(kt===!0){mt=yt;break}}else for(yt in g)for(xt=g[yt],Ge=0;Ge<xt.length;Ge+=1){for(kt=!0,Ye=0;Ye<xt[Ge].length;Ye+=1)if(xt[Ge][Ye]!==void 0&&xt[Ge][Ye]!==_e.charCodeAt(Ye)){kt=!1;break}if(kt===!0){mt=yt;break}}return mt===u&&we!==u&&(mt=we),mt},x=function _e(we){for(var Ge=this.internal.write,Ye=this.internal.putStream,xt=(0,this.internal.getFilters)();xt.indexOf("FlateEncode")!==-1;)xt.splice(xt.indexOf("FlateEncode"),1);we.objectId=this.internal.newObject();var kt=[];if(kt.push({key:"Type",value:"/XObject"}),kt.push({key:"Subtype",value:"/Image"}),kt.push({key:"Width",value:we.width}),kt.push({key:"Height",value:we.height}),we.colorSpace===ye.INDEXED?kt.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(we.palette.length/3-1)+" "+("sMask"in we&&we.sMask!==void 0?we.objectId+2:we.objectId+1)+" 0 R]"}):(kt.push({key:"ColorSpace",value:"/"+we.colorSpace}),we.colorSpace===ye.DEVICE_CMYK&&kt.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),kt.push({key:"BitsPerComponent",value:we.bitsPerComponent}),"decodeParameters"in we&&we.decodeParameters!==void 0&&kt.push({key:"DecodeParms",value:"<<"+we.decodeParameters+">>"}),"transparency"in we&&Array.isArray(we.transparency)&&we.transparency.length>0){for(var yt="",mt=0,gt=we.transparency.length;mt<gt;mt++)yt+=we.transparency[mt]+" "+we.transparency[mt]+" ";kt.push({key:"Mask",value:"["+yt+"]"})}we.sMask!==void 0&&kt.push({key:"SMask",value:we.objectId+1+" 0 R"});var Qt=we.filter!==void 0?["/"+we.filter]:void 0;if(Ye({data:we.data,additionalKeyValues:kt,alreadyAppliedFilters:Qt,objectId:we.objectId}),Ge("endobj"),"sMask"in we&&we.sMask!==void 0){var Vt,fe=(Vt=we.sMaskBitsPerComponent)!==null&&Vt!==void 0?Vt:we.bitsPerComponent,Fe={width:we.width,height:we.height,colorSpace:"DeviceGray",bitsPerComponent:fe,data:we.sMask};"filter"in we&&(Fe.decodeParameters="/Predictor ".concat(we.predictor," /Colors 1 /BitsPerComponent ").concat(fe," /Columns ").concat(we.width),Fe.filter=we.filter),_e.call(this,Fe)}if(we.colorSpace===ye.INDEXED){var We=this.internal.newObject();Ye({data:Ze(new Uint8Array(we.palette)),objectId:We}),Ge("endobj")}},b=function(){var _e=this.internal.collections[l+"images"];for(var we in _e)x.call(this,_e[we])},s=function(){var _e,we=this.internal.collections[l+"images"],Ge=this.internal.write;for(var Ye in we)Ge("/I"+(_e=we[Ye]).index,_e.objectId,"0","R")},E=function(){this.internal.collections[l+"images"]||(this.internal.collections[l+"images"]={},this.internal.events.subscribe("putResources",b),this.internal.events.subscribe("putXobjectDict",s))},F=function(){var _e=this.internal.collections[l+"images"];return E.call(this),_e},B=function(){return Object.keys(this.internal.collections[l+"images"]).length},Q=function(_e){return typeof p["process"+_e.toUpperCase()]=="function"},ne=function(_e){return Wi(_e)==="object"&&_e.nodeType===1},j=function(_e,we){if(_e.nodeName==="IMG"&&_e.hasAttribute("src")){var Ge=""+_e.getAttribute("src");if(Ge.indexOf("data:image/")===0)return jd(unescape(Ge).split("base64,").pop());var Ye=p.loadFile(Ge,!0);if(Ye!==void 0)return Ye}if(_e.nodeName==="CANVAS"){if(_e.width===0||_e.height===0)throw new Error("Given canvas must have data. Canvas width: "+_e.width+", height: "+_e.height);var xt;switch(we){case"PNG":xt="image/png";break;case"WEBP":xt="image/webp";break;default:xt="image/jpeg"}return jd(_e.toDataURL(xt,1).split("base64,").pop())}},Ie=function(_e){var we=this.internal.collections[l+"images"];if(we){for(var Ge in we)if(_e===we[Ge].alias)return we[Ge]}},he=function(_e,we,Ge){return _e||we||(_e=-96,we=-96),_e<0&&(_e=-1*Ge.width*72/_e/this.internal.scaleFactor),we<0&&(we=-1*Ge.height*72/we/this.internal.scaleFactor),_e===0&&(_e=we*Ge.width/Ge.height),we===0&&(we=_e*Ge.height/Ge.width),[_e,we]},re=function(_e,we,Ge,Ye,xt,kt){var yt=he.call(this,Ge,Ye,xt),mt=this.internal.getCoordinateString,gt=this.internal.getVerticalCoordinateString,Qt=F.call(this);if(Ge=yt[0],Ye=yt[1],Qt[xt.index]=xt,kt){kt*=Math.PI/180;var Vt=Math.cos(kt),fe=Math.sin(kt),Fe=function(tt){return tt.toFixed(4)},We=[Fe(Vt),Fe(fe),Fe(-1*fe),Fe(Vt),0,0,"cm"]}this.internal.write("q"),kt?(this.internal.write([1,"0","0",1,mt(_e),gt(we+Ye),"cm"].join(" ")),this.internal.write(We.join(" ")),this.internal.write([mt(Ge),"0","0",mt(Ye),"0","0","cm"].join(" "))):this.internal.write([mt(Ge),"0","0",mt(Ye),mt(_e),gt(we+Ye),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+xt.index+" Do"),this.internal.write("Q")},ye=p.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};p.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var Je=p.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},Be=p.__addimage__.sHashCode=function(_e){var we,Ge,Ye=0;if(typeof _e=="string")for(Ge=_e.length,we=0;we<Ge;we++)Ye=(Ye<<5)-Ye+_e.charCodeAt(we),Ye|=0;else if($e(_e))for(Ge=_e.byteLength/2,we=0;we<Ge;we++)Ye=(Ye<<5)-Ye+_e[we],Ye|=0;return Ye},De=p.__addimage__.validateStringAsBase64=function(_e){(_e=_e||"").toString().trim();var we=!0;return _e.length===0&&(we=!1),_e.length%4!=0&&(we=!1),/^[A-Za-z0-9+/]+$/.test(_e.substr(0,_e.length-2))===!1&&(we=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(_e.substr(-2))===!1&&(we=!1),we},Ue=p.__addimage__.extractImageFromDataUrl=function(_e){if(_e==null||!(_e=_e.trim()).startsWith("data:"))return null;var we=_e.indexOf(",");return we<0?null:_e.substring(0,we).trim().endsWith("base64")?_e.substring(we+1):null};p.__addimage__.isArrayBuffer=function(_e){return _e instanceof ArrayBuffer};var $e=p.__addimage__.isArrayBufferView=function(_e){return _e instanceof Int8Array||_e instanceof Uint8Array||_e instanceof Uint8ClampedArray||_e instanceof Int16Array||_e instanceof Uint16Array||_e instanceof Int32Array||_e instanceof Uint32Array||_e instanceof Float32Array||_e instanceof Float64Array},st=p.__addimage__.binaryStringToUint8Array=function(_e){for(var we=_e.length,Ge=new Uint8Array(we),Ye=0;Ye<we;Ye++)Ge[Ye]=_e.charCodeAt(Ye);return Ge},Ze=p.__addimage__.arrayBufferToBinaryString=function(_e){for(var we="",Ge=$e(_e)?_e:new Uint8Array(_e),Ye=0;Ye<Ge.length;Ye+=8192)we+=String.fromCharCode.apply(null,Ge.subarray(Ye,Ye+8192));return we};p.addImage=function(){var _e,we,Ge,Ye,xt,kt,yt,mt,gt;if(typeof arguments[1]=="number"?(we=u,Ge=arguments[1],Ye=arguments[2],xt=arguments[3],kt=arguments[4],yt=arguments[5],mt=arguments[6],gt=arguments[7]):(we=arguments[1],Ge=arguments[2],Ye=arguments[3],xt=arguments[4],kt=arguments[5],yt=arguments[6],mt=arguments[7],gt=arguments[8]),Wi(_e=arguments[0])==="object"&&!ne(_e)&&"imageData"in _e){var Qt=_e;_e=Qt.imageData,we=Qt.format||we||u,Ge=Qt.x||Ge||0,Ye=Qt.y||Ye||0,xt=Qt.w||Qt.width||xt,kt=Qt.h||Qt.height||kt,yt=Qt.alias||yt,mt=Qt.compression||mt,gt=Qt.rotation||Qt.angle||gt}var Vt=this.internal.getFilters();if(mt===void 0&&Vt.indexOf("FlateEncode")!==-1&&(mt="SLOW"),isNaN(Ge)||isNaN(Ye))throw new Error("Invalid coordinates passed to jsPDF.addImage");E.call(this);var fe=Pe.call(this,_e,we,yt,mt);return re.call(this,Ge,Ye,xt,kt,fe,gt),this};var Pe=function(_e,we,Ge,Ye){var xt,kt,yt;if(typeof _e=="string"&&v(_e)===u){_e=unescape(_e);var mt=rt(_e,!1);(mt!==""||(mt=p.loadFile(_e,!0))!==void 0)&&(_e=mt)}if(ne(_e)&&(_e=j(_e,we)),we=v(_e,we),!Q(we))throw new Error("addImage does not support files of type '"+we+"', please ensure that a plugin for '"+we+"' support is added.");if(((yt=Ge)==null||yt.length===0)&&(Ge=(function(gt){return typeof gt=="string"||$e(gt)?Be(gt):$e(gt.data)?Be(gt.data):null})(_e)),(xt=Ie.call(this,Ge))||(_e instanceof Uint8Array||we==="RGBA"||(kt=_e,_e=st(_e)),xt=this["process"+we.toUpperCase()](_e,B.call(this),Ge,(function(gt){return gt&&typeof gt=="string"&&(gt=gt.toUpperCase()),gt in p.image_compression?gt:Je.NONE})(Ye),kt)),!xt)throw new Error("An unknown error occurred whilst processing the image.");return xt},rt=p.__addimage__.convertBase64ToBinaryString=function(_e,we){we=typeof we!="boolean"||we;var Ge,Ye="";if(typeof _e=="string"){var xt;Ge=(xt=Ue(_e))!==null&&xt!==void 0?xt:_e;try{Ye=jd(Ge)}catch(kt){if(we)throw De(Ge)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+kt.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return Ye};p.getImageProperties=function(_e){var we,Ge,Ye="";if(ne(_e)&&(_e=j(_e)),typeof _e=="string"&&v(_e)===u&&((Ye=rt(_e,!1))===""&&(Ye=p.loadFile(_e)||""),_e=Ye),Ge=v(_e),!Q(Ge))throw new Error("addImage does not support files of type '"+Ge+"', please ensure that a plugin for '"+Ge+"' support is added.");if(_e instanceof Uint8Array||(_e=st(_e)),!(we=this["process"+Ge.toUpperCase()](_e)))throw new Error("An unknown error occurred whilst processing the image");return we.fileType=Ge,we}})(jr.API),(function(p){var l=function(u){if(u!==void 0&&u!="")return!0};jr.API.events.push(["addPage",function(u){this.internal.getPageInfo(u.pageNumber).pageContext.annotations=[]}]),p.events.push(["putPage",function(u){for(var g,v,x,b=this.internal.getCoordinateString,s=this.internal.getVerticalCoordinateString,E=this.internal.getPageInfoByObjId(u.objId),F=u.pageContext.annotations,B=!1,Q=0;Q<F.length&&!B;Q++)switch((g=F[Q]).type){case"link":(l(g.options.url)||l(g.options.pageNumber))&&(B=!0);break;case"reference":case"text":case"freetext":B=!0}if(B!=0){this.internal.write("/Annots [");for(var ne=0;ne<F.length;ne++){g=F[ne];var j=this.internal.pdfEscape,Ie=this.internal.getEncryptor(u.objId);switch(g.type){case"reference":this.internal.write(" "+g.object.objId+" 0 R ");break;case"text":var he=this.internal.newAdditionalObject(),re=this.internal.newAdditionalObject(),ye=this.internal.getEncryptor(he.objId),Je=g.title||"Note";x="<</Type /Annot /Subtype /Text "+(v="/Rect ["+b(g.bounds.x)+" "+s(g.bounds.y+g.bounds.h)+" "+b(g.bounds.x+g.bounds.w)+" "+s(g.bounds.y)+"] ")+"/Contents ("+j(ye(g.contents))+")",x+=" /Popup "+re.objId+" 0 R",x+=" /P "+E.objId+" 0 R",x+=" /T ("+j(ye(Je))+") >>",he.content=x;var Be=he.objId+" 0 R";x="<</Type /Annot /Subtype /Popup "+(v="/Rect ["+b(g.bounds.x+30)+" "+s(g.bounds.y+g.bounds.h)+" "+b(g.bounds.x+g.bounds.w+30)+" "+s(g.bounds.y)+"] ")+" /Parent "+Be,g.open&&(x+=" /Open true"),x+=" >>",re.content=x,this.internal.write(he.objId,"0 R",re.objId,"0 R");break;case"freetext":v="/Rect ["+b(g.bounds.x)+" "+s(g.bounds.y)+" "+b(g.bounds.x+g.bounds.w)+" "+s(g.bounds.y+g.bounds.h)+"] ";var De=g.color||"#000000";x="<</Type /Annot /Subtype /FreeText "+v+"/Contents ("+j(Ie(g.contents))+")",x+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+De+")",x+=" /Border [0 0 0]",x+=" >>",this.internal.write(x);break;case"link":if(g.options.name){var Ue=this.annotations._nameMap[g.options.name];g.options.pageNumber=Ue.page,g.options.top=Ue.y}else g.options.top||(g.options.top=0);if(v="/Rect ["+g.finalBounds.x+" "+g.finalBounds.y+" "+g.finalBounds.w+" "+g.finalBounds.h+"] ",x="",g.options.url)x="<</Type /Annot /Subtype /Link "+v+"/Border [0 0 0] /A <</S /URI /URI ("+j(Ie(g.options.url))+") >>";else if(g.options.pageNumber)switch(x="<</Type /Annot /Subtype /Link "+v+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(g.options.pageNumber).objId+" 0 R",g.options.magFactor=g.options.magFactor||"XYZ",g.options.magFactor){case"Fit":x+=" /Fit]";break;case"FitH":x+=" /FitH "+g.options.top+"]";break;case"FitV":g.options.left=g.options.left||0,x+=" /FitV "+g.options.left+"]";break;default:var $e=s(g.options.top);g.options.left=g.options.left||0,g.options.zoom===void 0&&(g.options.zoom=0),x+=" /XYZ "+g.options.left+" "+$e+" "+g.options.zoom+"]"}x!=""&&(x+=" >>",this.internal.write(x))}}this.internal.write("]")}}]),p.createAnnotation=function(u){var g=this.internal.getCurrentPageInfo();switch(u.type){case"link":this.link(u.bounds.x,u.bounds.y,u.bounds.w,u.bounds.h,u);break;case"text":case"freetext":g.pageContext.annotations.push(u)}},p.link=function(u,g,v,x,b){var s=this.internal.getCurrentPageInfo(),E=this.internal.getCoordinateString,F=this.internal.getVerticalCoordinateString;s.pageContext.annotations.push({finalBounds:{x:E(u),y:F(g),w:E(u+v),h:F(g+x)},options:b,type:"link"})},p.textWithLink=function(u,g,v,x){var b,s,E=this.getTextWidth(u),F=this.internal.getLineHeight()/this.internal.scaleFactor;if(x.maxWidth!==void 0){s=x.maxWidth;var B=this.splitTextToSize(u,s).length;b=Math.ceil(F*B)}else s=E,b=F;return this.text(u,g,v,x),v+=.2*F,x.align==="center"&&(g-=E/2),x.align==="right"&&(g-=E),this.link(g,v-F,s,b,x),E},p.getTextWidth=function(u){var g=this.internal.getFontSize();return this.getStringUnitWidth(u)*g/this.internal.scaleFactor}})(jr.API),(function(p){var l={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},u={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},g={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},v=[1570,1571,1573,1575];p.__arabicParser__={};var x=p.__arabicParser__.isInArabicSubstitutionA=function(he){return l[he.charCodeAt(0)]!==void 0},b=p.__arabicParser__.isArabicLetter=function(he){return typeof he=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(he)},s=p.__arabicParser__.isArabicEndLetter=function(he){return b(he)&&x(he)&&l[he.charCodeAt(0)].length<=2},E=p.__arabicParser__.isArabicAlfLetter=function(he){return b(he)&&v.indexOf(he.charCodeAt(0))>=0};p.__arabicParser__.arabicLetterHasIsolatedForm=function(he){return b(he)&&x(he)&&l[he.charCodeAt(0)].length>=1};var F=p.__arabicParser__.arabicLetterHasFinalForm=function(he){return b(he)&&x(he)&&l[he.charCodeAt(0)].length>=2};p.__arabicParser__.arabicLetterHasInitialForm=function(he){return b(he)&&x(he)&&l[he.charCodeAt(0)].length>=3};var B=p.__arabicParser__.arabicLetterHasMedialForm=function(he){return b(he)&&x(he)&&l[he.charCodeAt(0)].length==4},Q=p.__arabicParser__.resolveLigatures=function(he){var re=0,ye=u,Je="",Be=0;for(re=0;re<he.length;re+=1)ye[he.charCodeAt(re)]!==void 0?(Be++,typeof(ye=ye[he.charCodeAt(re)])=="number"&&(Je+=String.fromCharCode(ye),ye=u,Be=0),re===he.length-1&&(ye=u,Je+=he.charAt(re-(Be-1)),re-=Be-1,Be=0)):(ye=u,Je+=he.charAt(re-Be),re-=Be,Be=0);return Je};p.__arabicParser__.isArabicDiacritic=function(he){return he!==void 0&&g[he.charCodeAt(0)]!==void 0};var ne=p.__arabicParser__.getCorrectForm=function(he,re,ye){return b(he)?x(he)===!1?-1:!F(he)||!b(re)&&!b(ye)||!b(ye)&&s(re)||s(he)&&!b(re)||s(he)&&E(re)||s(he)&&s(re)?0:B(he)&&b(re)&&!s(re)&&b(ye)&&F(ye)?3:s(he)||!b(ye)?1:2:-1},j=function(he){var re=0,ye=0,Je=0,Be="",De="",Ue="",$e=(he=he||"").split("\\s+"),st=[];for(re=0;re<$e.length;re+=1){for(st.push(""),ye=0;ye<$e[re].length;ye+=1)Be=$e[re][ye],De=$e[re][ye-1],Ue=$e[re][ye+1],b(Be)?(Je=ne(Be,De,Ue),st[re]+=Je!==-1?String.fromCharCode(l[Be.charCodeAt(0)][Je]):Be):st[re]+=Be;st[re]=Q(st[re])}return st.join(" ")},Ie=p.__arabicParser__.processArabic=p.processArabic=function(){var he,re=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,ye=[];if(Array.isArray(re)){var Je=0;for(ye=[],Je=0;Je<re.length;Je+=1)Array.isArray(re[Je])?ye.push([j(re[Je][0]),re[Je][1],re[Je][2]]):ye.push([j(re[Je])]);he=ye}else he=j(re);return typeof arguments[0]=="string"?he:(arguments[0].text=he,arguments[0])};p.events.push(["preProcessText",Ie])})(jr.API),jr.API.autoPrint=function(p){var l;return(p=p||{}).variant=p.variant||"non-conform",p.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){l=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+l+" 0 R")})),this},(function(p){var l=function(){var u=void 0;Object.defineProperty(this,"pdf",{get:function(){return u},set:function(s){u=s}});var g=150;Object.defineProperty(this,"width",{get:function(){return g},set:function(s){g=isNaN(s)||Number.isInteger(s)===!1||s<0?150:s,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=g+1)}});var v=300;Object.defineProperty(this,"height",{get:function(){return v},set:function(s){v=isNaN(s)||Number.isInteger(s)===!1||s<0?300:s,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=v+1)}});var x=[];Object.defineProperty(this,"childNodes",{get:function(){return x},set:function(s){x=s}});var b={};Object.defineProperty(this,"style",{get:function(){return b},set:function(s){b=s}}),Object.defineProperty(this,"parentNode",{})};l.prototype.getContext=function(u,g){var v;if((u=u||"2d")!=="2d")return null;for(v in g)this.pdf.context2d.hasOwnProperty(v)&&(this.pdf.context2d[v]=g[v]);return this.pdf.context2d._canvas=this,this.pdf.context2d},l.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},p.events.push(["initialized",function(){this.canvas=new l,this.canvas.pdf=this}])})(jr.API),(function(p){var l={left:0,top:0,bottom:0,right:0},u=!1,g=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},l),this.internal.__cell__.margins.width=this.getPageWidth(),v.call(this))},v=function(){this.internal.__cell__.lastCell=new x,this.internal.__cell__.pages=1},x=function(){var E=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return E},set:function(he){E=he}});var F=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return F},set:function(he){F=he}});var B=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return B},set:function(he){B=he}});var Q=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return Q},set:function(he){Q=he}});var ne=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return ne},set:function(he){ne=he}});var j=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return j},set:function(he){j=he}});var Ie=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return Ie},set:function(he){Ie=he}}),this};x.prototype.clone=function(){return new x(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},x.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},p.setHeaderFunction=function(E){return g.call(this),this.internal.__cell__.headerFunction=typeof E=="function"?E:void 0,this},p.getTextDimensions=function(E,F){g.call(this);var B=(F=F||{}).fontSize||this.getFontSize(),Q=F.font||this.getFont(),ne=F.scaleFactor||this.internal.scaleFactor,j=0,Ie=0,he=0,re=this;if(!Array.isArray(E)&&typeof E!="string"){if(typeof E!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");E=String(E)}var ye=F.maxWidth;ye>0?typeof E=="string"?E=this.splitTextToSize(E,ye):Object.prototype.toString.call(E)==="[object Array]"&&(E=E.reduce(function(Be,De){return Be.concat(re.splitTextToSize(De,ye))},[])):E=Array.isArray(E)?E:[E];for(var Je=0;Je<E.length;Je++)j<(he=this.getStringUnitWidth(E[Je],{font:Q})*B)&&(j=he);return j!==0&&(Ie=E.length),{w:j/=ne,h:Math.max((Ie*B*this.getLineHeightFactor()-B*(this.getLineHeightFactor()-1))/ne,0)}},p.cellAddPage=function(){g.call(this),this.addPage();var E=this.internal.__cell__.margins||l;return this.internal.__cell__.lastCell=new x(E.left,E.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var b=p.cell=function(){var E;E=arguments[0]instanceof x?arguments[0]:new x(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]),g.call(this);var F=this.internal.__cell__.lastCell,B=this.internal.__cell__.padding,Q=this.internal.__cell__.margins||l,ne=this.internal.__cell__.tableHeaderRow,j=this.internal.__cell__.printHeaders;return F.lineNumber!==void 0&&(F.lineNumber===E.lineNumber?(E.x=(F.x||0)+(F.width||0),E.y=F.y||0):F.y+F.height+E.height+Q.bottom>this.getPageHeight()?(this.cellAddPage(),E.y=Q.top,j&&ne&&(this.printHeaderRow(E.lineNumber,!0),E.y+=ne[0].height)):E.y=F.y+F.height||E.y),E.text[0]!==void 0&&(this.rect(E.x,E.y,E.width,E.height,u===!0?"FD":void 0),E.align==="right"?this.text(E.text,E.x+E.width-B,E.y+B,{align:"right",baseline:"top"}):E.align==="center"?this.text(E.text,E.x+E.width/2,E.y+B,{align:"center",baseline:"top",maxWidth:E.width-B-B}):this.text(E.text,E.x+B,E.y+B,{align:"left",baseline:"top",maxWidth:E.width-B-B})),this.internal.__cell__.lastCell=E,this};p.table=function(E,F,B,Q,ne){if(g.call(this),!B)throw new Error("No data for PDF table.");var j,Ie,he,re,ye=[],Je=[],Be=[],De={},Ue={},$e=[],st=[],Ze=(ne=ne||{}).autoSize||!1,Pe=ne.printHeaders!==!1,rt=ne.css&&ne.css["font-size"]!==void 0?16*ne.css["font-size"]:ne.fontSize||12,_e=ne.margins||Object.assign({width:this.getPageWidth()},l),we=typeof ne.padding=="number"?ne.padding:3,Ge=ne.headerBackgroundColor||"#c8c8c8",Ye=ne.headerTextColor||"#000";if(v.call(this),this.internal.__cell__.printHeaders=Pe,this.internal.__cell__.margins=_e,this.internal.__cell__.table_font_size=rt,this.internal.__cell__.padding=we,this.internal.__cell__.headerBackgroundColor=Ge,this.internal.__cell__.headerTextColor=Ye,this.setFontSize(rt),Q==null)Je=ye=Object.keys(B[0]),Be=ye.map(function(){return"left"});else if(Array.isArray(Q)&&Wi(Q[0])==="object")for(ye=Q.map(function(Qt){return Qt.name}),Je=Q.map(function(Qt){return Qt.prompt||Qt.name||""}),Be=Q.map(function(Qt){return Qt.align||"left"}),j=0;j<Q.length;j+=1)Ue[Q[j].name]=.7499990551181103*Q[j].width;else Array.isArray(Q)&&typeof Q[0]=="string"&&(Je=ye=Q,Be=ye.map(function(){return"left"}));if(Ze||Array.isArray(Q)&&typeof Q[0]=="string")for(j=0;j<ye.length;j+=1){for(De[re=ye[j]]=B.map(function(Qt){return Qt[re]}),this.setFont(void 0,"bold"),$e.push(this.getTextDimensions(Je[j],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),Ie=De[re],this.setFont(void 0,"normal"),he=0;he<Ie.length;he+=1)$e.push(this.getTextDimensions(Ie[he],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);Ue[re]=Math.max.apply(null,$e)+we+we,$e=[]}if(Pe){var xt={};for(j=0;j<ye.length;j+=1)xt[ye[j]]={},xt[ye[j]].text=Je[j],xt[ye[j]].align=Be[j];var kt=s.call(this,xt,Ue);st=ye.map(function(Qt){return new x(E,F,Ue[Qt],kt,xt[Qt].text,void 0,xt[Qt].align)}),this.setTableHeaderRow(st),this.printHeaderRow(1,!1)}var yt=Q.reduce(function(Qt,Vt){return Qt[Vt.name]=Vt.align,Qt},{});for(j=0;j<B.length;j+=1){"rowStart"in ne&&ne.rowStart instanceof Function&&ne.rowStart({row:j,data:B[j]},this);var mt=s.call(this,B[j],Ue);for(he=0;he<ye.length;he+=1){var gt=B[j][ye[he]];"cellStart"in ne&&ne.cellStart instanceof Function&&ne.cellStart({row:j,col:he,data:gt},this),b.call(this,new x(E,F,Ue[ye[he]],mt,gt,j+2,yt[ye[he]]))}}return this.internal.__cell__.table_x=E,this.internal.__cell__.table_y=F,this};var s=function(E,F){var B=this.internal.__cell__.padding,Q=this.internal.__cell__.table_font_size,ne=this.internal.scaleFactor;return Object.keys(E).map(function(j){var Ie=E[j];return this.splitTextToSize(Ie.hasOwnProperty("text")?Ie.text:Ie,F[j]-B-B)},this).map(function(j){return this.getLineHeightFactor()*j.length*Q/ne+B+B},this).reduce(function(j,Ie){return Math.max(j,Ie)},0)};p.setTableHeaderRow=function(E){g.call(this),this.internal.__cell__.tableHeaderRow=E},p.printHeaderRow=function(E,F){if(g.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var B;if(u=!0,typeof this.internal.__cell__.headerFunction=="function"){var Q=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new x(Q[0],Q[1],Q[2],Q[3],void 0,-1)}this.setFont(void 0,"bold");for(var ne=[],j=0;j<this.internal.__cell__.tableHeaderRow.length;j+=1){B=this.internal.__cell__.tableHeaderRow[j].clone(),F&&(B.y=this.internal.__cell__.margins.top||0,ne.push(B)),B.lineNumber=E;var Ie=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),b.call(this,B),this.setTextColor(Ie)}ne.length>0&&this.setTableHeaderRow(ne),this.setFont(void 0,"normal"),u=!1}})(jr.API);var N0={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},R0=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],Up=z0(R0),B0=[100,200,300,400,500,600,700,800,900],Ow=z0(B0);function Ap(p){var l=p.family.replace(/"|'/g,"").toLowerCase(),u=(function(x){return N0[x=x||"normal"]?x:"normal"})(p.style),g=(function(x){return x?typeof x=="number"?x>=100&&x<=900&&x%100==0?x:400:/^\d00$/.test(x)?parseInt(x):x==="bold"?700:400:400})(p.weight),v=(function(x){return typeof Up[x=x||"normal"]=="number"?x:"normal"})(p.stretch);return{family:l,style:u,weight:g,stretch:v,src:p.src||[],ref:p.ref||{name:l,style:[v,u,g].join(" ")}}}function wy(p,l,u,g){var v;for(v=u;v>=0&&v<l.length;v+=g)if(p[l[v]])return p[l[v]];for(v=u;v>=0&&v<l.length;v-=g)if(p[l[v]])return p[l[v]]}var jw={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},Sy={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function Ty(p){return[p.stretch,p.style,p.weight,p.family].join(" ")}function Py(p){return p.trimLeft()}function Vw(p,l){for(var u=0;u<p.length;){if(p.charAt(u)===l)return[p.substring(0,u),p.substring(u+1)];u+=1}return null}function Uw(p){var l=p.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return l===null?null:[l[0],p.substring(l[0].length)]}var zd,Ay,Iy,th,Nd,Ly,Cy,My,Ey=["times"];function ky(p,l,u,g,v){var x=4,b=Fy;switch(v){case jr.API.image_compression.FAST:x=1,b=Dy;break;case jr.API.image_compression.MEDIUM:x=6,b=zy;break;case jr.API.image_compression.SLOW:x=9,b=Ny}p=(function(E,F,B,Q){for(var ne,j=E.length/F,Ie=new Uint8Array(E.length+j),he=[qw,Dy,Fy,zy,Ny],re=0;re<j;re+=1){var ye=re*F,Je=E.subarray(ye,ye+F);if(Q)Ie.set(Q(Je,B,ne),ye+re);else{for(var Be=he.length,De=[],Ue=0;Ue<Be;Ue+=1)De[Ue]=he[Ue](Je,B,ne);var $e=$w(De.concat());Ie.set(De[$e],ye+re)}ne=Je}return Ie})(p,l,Math.ceil(u*g/8),b);var s=zp(p,{level:x});return jr.API.__addimage__.arrayBufferToBinaryString(s)}function qw(p){var l=Array.apply([],p);return l.unshift(0),l}function Dy(p,l){var u=p.length,g=[];g[0]=1;for(var v=0;v<u;v+=1){var x=p[v-l]||0;g[v+1]=p[v]-x+256&255}return g}function Fy(p,l,u){var g=p.length,v=[];v[0]=2;for(var x=0;x<g;x+=1){var b=u&&u[x]||0;v[x+1]=p[x]-b+256&255}return v}function zy(p,l,u){var g=p.length,v=[];v[0]=3;for(var x=0;x<g;x+=1){var b=p[x-l]||0,s=u&&u[x]||0;v[x+1]=p[x]+256-(b+s>>>1)&255}return v}function Ny(p,l,u){var g=p.length,v=[];v[0]=4;for(var x=0;x<g;x+=1){var b=Gw(p[x-l]||0,u&&u[x]||0,u&&u[x-l]||0);v[x+1]=p[x]-b+256&255}return v}function Gw(p,l,u){if(p===l&&l===u)return p;var g=Math.abs(l-u),v=Math.abs(p-u),x=Math.abs(p+l-u-u);return g<=v&&g<=x?p:v<=x?l:u}function $w(p){var l=p.map(function(u){return u.reduce(function(g,v){return g+Math.abs(v)},0)});return l.indexOf(Math.min.apply(null,l))}function Ip(p,l,u){var g=l*u,v=Math.floor(g/8),x=16-(g-8*v+u),b=(1<<u)-1;return O0(p,v)>>x&b}function Ry(p,l,u,g){var v=u*g,x=Math.floor(v/8),b=16-(v-8*x+g),s=(1<<g)-1,E=(l&s)<<b;(function(F,B,Q){if(B+1<F.byteLength)F.setUint16(B,Q,!1);else{var ne=Q>>8&255;F.setUint8(B,ne)}})(p,x,O0(p,x)&~(s<<b)&65535|E)}function O0(p,l){return l+1<p.byteLength?p.getUint16(l,!1):p.getUint8(l)<<8}function Zw(p){var l=0;if(p[l++]!==71||p[l++]!==73||p[l++]!==70||p[l++]!==56||(p[l++]+1&253)!=56||p[l++]!==97)throw new Error("Invalid GIF 87a/89a header.");var u=p[l++]|p[l++]<<8,g=p[l++]|p[l++]<<8,v=p[l++],x=v>>7,b=1<<1+(7&v);p[l++],p[l++];var s=null,E=null;x&&(s=l,E=b,l+=3*b);var F=!0,B=[],Q=0,ne=null,j=0,Ie=null;for(this.width=u,this.height=g;F&&l<p.length;)switch(p[l++]){case 33:switch(p[l++]){case 255:if(p[l]!==11||p[l+1]==78&&p[l+2]==69&&p[l+3]==84&&p[l+4]==83&&p[l+5]==67&&p[l+6]==65&&p[l+7]==80&&p[l+8]==69&&p[l+9]==50&&p[l+10]==46&&p[l+11]==48&&p[l+12]==3&&p[l+13]==1&&p[l+16]==0)l+=14,Ie=p[l++]|p[l++]<<8,l++;else for(l+=12;;){if(!((_e=p[l++])>=0))throw Error("Invalid block size");if(_e===0)break;l+=_e}break;case 249:if(p[l++]!==4||p[l+4]!==0)throw new Error("Invalid graphics extension block.");var he=p[l++];Q=p[l++]|p[l++]<<8,ne=p[l++],1&he||(ne=null),j=he>>2&7,l++;break;case 254:for(;;){if(!((_e=p[l++])>=0))throw Error("Invalid block size");if(_e===0)break;l+=_e}break;default:throw new Error("Unknown graphic control label: 0x"+p[l-1].toString(16))}break;case 44:var re=p[l++]|p[l++]<<8,ye=p[l++]|p[l++]<<8,Je=p[l++]|p[l++]<<8,Be=p[l++]|p[l++]<<8,De=p[l++],Ue=De>>6&1,$e=1<<1+(7&De),st=s,Ze=E,Pe=!1;De>>7&&(Pe=!0,st=l,Ze=$e,l+=3*$e);var rt=l;for(l++;;){var _e;if(!((_e=p[l++])>=0))throw Error("Invalid block size");if(_e===0)break;l+=_e}B.push({x:re,y:ye,width:Je,height:Be,has_local_palette:Pe,palette_offset:st,palette_size:Ze,data_offset:rt,data_length:l-rt,transparent_index:ne,interlaced:!!Ue,delay:Q,disposal:j});break;case 59:F=!1;break;default:throw new Error("Unknown gif block: 0x"+p[l-1].toString(16))}this.numFrames=function(){return B.length},this.loopCount=function(){return Ie},this.frameInfo=function(we){if(we<0||we>=B.length)throw new Error("Frame index out of range.");return B[we]},this.decodeAndBlitFrameBGRA=function(we,Ge){var Ye=this.frameInfo(we),xt=Ye.width*Ye.height,kt=new Uint8Array(xt);By(p,Ye.data_offset,kt,xt);var yt=Ye.palette_offset,mt=Ye.transparent_index;mt===null&&(mt=256);var gt=Ye.width,Qt=u-gt,Vt=gt,fe=4*(Ye.y*u+Ye.x),Fe=4*((Ye.y+Ye.height)*u+Ye.x),We=fe,tt=4*Qt;Ye.interlaced===!0&&(tt+=4*u*7);for(var nt=8,ut=0,ft=kt.length;ut<ft;++ut){var It=kt[ut];if(Vt===0&&(Vt=gt,(We+=tt)>=Fe&&(tt=4*Qt+4*u*(nt-1),We=fe+(gt+Qt)*(nt<<1),nt>>=1)),It===mt)We+=4;else{var zt=p[yt+3*It],Zt=p[yt+3*It+1],sr=p[yt+3*It+2];Ge[We++]=sr,Ge[We++]=Zt,Ge[We++]=zt,Ge[We++]=255}--Vt}},this.decodeAndBlitFrameRGBA=function(we,Ge){var Ye=this.frameInfo(we),xt=Ye.width*Ye.height,kt=new Uint8Array(xt);By(p,Ye.data_offset,kt,xt);var yt=Ye.palette_offset,mt=Ye.transparent_index;mt===null&&(mt=256);var gt=Ye.width,Qt=u-gt,Vt=gt,fe=4*(Ye.y*u+Ye.x),Fe=4*((Ye.y+Ye.height)*u+Ye.x),We=fe,tt=4*Qt;Ye.interlaced===!0&&(tt+=4*u*7);for(var nt=8,ut=0,ft=kt.length;ut<ft;++ut){var It=kt[ut];if(Vt===0&&(Vt=gt,(We+=tt)>=Fe&&(tt=4*Qt+4*u*(nt-1),We=fe+(gt+Qt)*(nt<<1),nt>>=1)),It===mt)We+=4;else{var zt=p[yt+3*It],Zt=p[yt+3*It+1],sr=p[yt+3*It+2];Ge[We++]=zt,Ge[We++]=Zt,Ge[We++]=sr,Ge[We++]=255}--Vt}}}function By(p,l,u,g){for(var v=p[l++],x=1<<v,b=x+1,s=b+1,E=v+1,F=(1<<E)-1,B=0,Q=0,ne=0,j=p[l++],Ie=new Int32Array(4096),he=null;;){for(;B<16&&j!==0;)Q|=p[l++]<<B,B+=8,j===1?j=p[l++]:--j;if(B<E)break;var re=Q&F;if(Q>>=E,B-=E,re!==x){if(re===b)break;for(var ye=re<s?re:he,Je=0,Be=ye;Be>x;)Be=Ie[Be]>>8,++Je;var De=Be;if(ne+Je+(ye!==re?1:0)>g)return void on.log("Warning, gif stream longer than expected.");u[ne++]=De;var Ue=ne+=Je;for(ye!==re&&(u[ne++]=De),Be=ye;Je--;)Be=Ie[Be],u[--Ue]=255&Be,Be>>=8;he!==null&&s<4096&&(Ie[s++]=he<<8|De,s>=F+1&&E<12&&(++E,F=F<<1|1)),he=re}else s=b+1,F=(1<<(E=v+1))-1,he=null}return ne!==g&&on.log("Warning, gif stream shorter than expected."),u}function Lp(p){var l,u,g,v,x,b=Math.floor,s=new Array(64),E=new Array(64),F=new Array(64),B=new Array(64),Q=new Array(65535),ne=new Array(65535),j=new Array(64),Ie=new Array(64),he=[],re=0,ye=7,Je=new Array(64),Be=new Array(64),De=new Array(64),Ue=new Array(256),$e=new Array(2048),st=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],Ze=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],Pe=[0,1,2,3,4,5,6,7,8,9,10,11],rt=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],_e=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],we=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Ge=[0,1,2,3,4,5,6,7,8,9,10,11],Ye=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],xt=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function kt(fe,Fe){for(var We=0,tt=0,nt=new Array,ut=1;ut<=16;ut++){for(var ft=1;ft<=fe[ut];ft++)nt[Fe[tt]]=[],nt[Fe[tt]][0]=We,nt[Fe[tt]][1]=ut,tt++,We++;We*=2}return nt}function yt(fe){for(var Fe=fe[0],We=fe[1]-1;We>=0;)Fe&1<<We&&(re|=1<<ye),We--,--ye<0&&(re==255?(mt(255),mt(0)):mt(re),ye=7,re=0)}function mt(fe){he.push(fe)}function gt(fe){mt(fe>>8&255),mt(255&fe)}function Qt(fe,Fe,We,tt,nt){for(var ut,ft=nt[0],It=nt[240],zt=(function(Yt,zr){var yr,Lr,Cr,li,Gr,Vr,ni,ei,xr,Qe,W=0;for(xr=0;xr<8;++xr){yr=Yt[W],Lr=Yt[W+1],Cr=Yt[W+2],li=Yt[W+3],Gr=Yt[W+4],Vr=Yt[W+5],ni=Yt[W+6];var te=yr+(ei=Yt[W+7]),se=yr-ei,Ce=Lr+ni,Oe=Lr-ni,ht=Cr+Vr,Y=Cr-Vr,P=li+Gr,k=li-Gr,ee=te+P,le=te-P,ge=Ce+ht,ie=Ce-ht;Yt[W]=ee+ge,Yt[W+4]=ee-ge;var ot=.707106781*(ie+le);Yt[W+2]=le+ot,Yt[W+6]=le-ot;var Mt=.382683433*((ee=k+Y)-(ie=Oe+se)),ct=.5411961*ee+Mt,dt=1.306562965*ie+Mt,Dt=.707106781*(ge=Y+Oe),Ct=se+Dt,Ht=se-Dt;Yt[W+5]=Ht+ct,Yt[W+3]=Ht-ct,Yt[W+1]=Ct+dt,Yt[W+7]=Ct-dt,W+=8}for(W=0,xr=0;xr<8;++xr){yr=Yt[W],Lr=Yt[W+8],Cr=Yt[W+16],li=Yt[W+24],Gr=Yt[W+32],Vr=Yt[W+40],ni=Yt[W+48];var Gt=yr+(ei=Yt[W+56]),dr=yr-ei,vr=Lr+ni,Nr=Lr-ni,Lt=Cr+Vr,wr=Cr-Vr,zi=li+Gr,fn=li-Gr,mi=Gt+zi,Xt=Gt-zi,Er=vr+Lt,Rr=vr-Lt;Yt[W]=mi+Er,Yt[W+32]=mi-Er;var Ni=.707106781*(Rr+Xt);Yt[W+16]=Xt+Ni,Yt[W+48]=Xt-Ni;var Rs=.382683433*((mi=fn+wr)-(Rr=Nr+dr)),Dn=.5411961*mi+Rs,$r=1.306562965*Rr+Rs,wa=.707106781*(Er=wr+Nr),Sa=dr+wa,Ua=dr-wa;Yt[W+40]=Ua+Dn,Yt[W+24]=Ua-Dn,Yt[W+8]=Sa+$r,Yt[W+56]=Sa-$r,W++}for(xr=0;xr<64;++xr)Qe=Yt[xr]*zr[xr],j[xr]=Qe>0?Qe+.5|0:Qe-.5|0;return j})(fe,Fe),Zt=0;Zt<64;++Zt)Ie[st[Zt]]=zt[Zt];var sr=Ie[0]-We;We=Ie[0],sr==0?yt(tt[0]):(yt(tt[ne[ut=32767+sr]]),yt(Q[ut]));for(var ur=63;ur>0&&Ie[ur]==0;)ur--;if(ur==0)return yt(ft),We;for(var _r,Le=1;Le<=ur;){for(var lr=Le;Ie[Le]==0&&Le<=ur;)++Le;var br=Le-lr;if(br>=16){_r=br>>4;for(var Tr=1;Tr<=_r;++Tr)yt(It);br&=15}ut=32767+Ie[Le],yt(nt[(br<<4)+ne[ut]]),yt(Q[ut]),Le++}return ur!=63&&yt(ft),We}function Vt(fe){fe=Math.min(Math.max(fe,1),100),x!=fe&&((function(Fe){for(var We=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],tt=0;tt<64;tt++){var nt=b((We[tt]*Fe+50)/100);nt=Math.min(Math.max(nt,1),255),s[st[tt]]=nt}for(var ut=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],ft=0;ft<64;ft++){var It=b((ut[ft]*Fe+50)/100);It=Math.min(Math.max(It,1),255),E[st[ft]]=It}for(var zt=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Zt=0,sr=0;sr<8;sr++)for(var ur=0;ur<8;ur++)F[Zt]=1/(s[st[Zt]]*zt[sr]*zt[ur]*8),B[Zt]=1/(E[st[Zt]]*zt[sr]*zt[ur]*8),Zt++})(fe<50?Math.floor(5e3/fe):Math.floor(200-2*fe)),x=fe)}this.encode=function(fe,Fe){Fe&&Vt(Fe),he=new Array,re=0,ye=7,gt(65496),gt(65504),gt(16),mt(74),mt(70),mt(73),mt(70),mt(0),mt(1),mt(1),mt(0),gt(1),gt(1),mt(0),mt(0),(function(){gt(65499),gt(132),mt(0);for(var Lr=0;Lr<64;Lr++)mt(s[Lr]);mt(1);for(var Cr=0;Cr<64;Cr++)mt(E[Cr])})(),(function(Lr,Cr){gt(65472),gt(17),mt(8),gt(Cr),gt(Lr),mt(3),mt(1),mt(17),mt(0),mt(2),mt(17),mt(1),mt(3),mt(17),mt(1)})(fe.width,fe.height),(function(){gt(65476),gt(418),mt(0);for(var Lr=0;Lr<16;Lr++)mt(Ze[Lr+1]);for(var Cr=0;Cr<=11;Cr++)mt(Pe[Cr]);mt(16);for(var li=0;li<16;li++)mt(rt[li+1]);for(var Gr=0;Gr<=161;Gr++)mt(_e[Gr]);mt(1);for(var Vr=0;Vr<16;Vr++)mt(we[Vr+1]);for(var ni=0;ni<=11;ni++)mt(Ge[ni]);mt(17);for(var ei=0;ei<16;ei++)mt(Ye[ei+1]);for(var xr=0;xr<=161;xr++)mt(xt[xr])})(),gt(65498),gt(12),mt(3),mt(1),mt(0),mt(2),mt(17),mt(3),mt(17),mt(0),mt(63),mt(0);var We=0,tt=0,nt=0;re=0,ye=7,this.encode.displayName="_encode_";for(var ut,ft,It,zt,Zt,sr,ur,_r,Le,lr=fe.data,br=fe.width,Tr=fe.height,Yt=4*br,zr=0;zr<Tr;){for(ut=0;ut<Yt;){for(Zt=Yt*zr+ut,ur=-1,_r=0,Le=0;Le<64;Le++)sr=Zt+(_r=Le>>3)*Yt+(ur=4*(7&Le)),zr+_r>=Tr&&(sr-=Yt*(zr+1+_r-Tr)),ut+ur>=Yt&&(sr-=ut+ur-Yt+4),ft=lr[sr++],It=lr[sr++],zt=lr[sr++],Je[Le]=($e[ft]+$e[It+256|0]+$e[zt+512|0]>>16)-128,Be[Le]=($e[ft+768|0]+$e[It+1024|0]+$e[zt+1280|0]>>16)-128,De[Le]=($e[ft+1280|0]+$e[It+1536|0]+$e[zt+1792|0]>>16)-128;We=Qt(Je,F,We,l,g),tt=Qt(Be,B,tt,u,v),nt=Qt(De,B,nt,u,v),ut+=32}zr+=8}if(ye>=0){var yr=[];yr[1]=ye+1,yr[0]=(1<<ye+1)-1,yt(yr)}return gt(65497),new Uint8Array(he)},p=p||50,(function(){for(var fe=String.fromCharCode,Fe=0;Fe<256;Fe++)Ue[Fe]=fe(Fe)})(),l=kt(Ze,Pe),u=kt(we,Ge),g=kt(rt,_e),v=kt(Ye,xt),(function(){for(var fe=1,Fe=2,We=1;We<=15;We++){for(var tt=fe;tt<Fe;tt++)ne[32767+tt]=We,Q[32767+tt]=[],Q[32767+tt][1]=We,Q[32767+tt][0]=tt;for(var nt=-(Fe-1);nt<=-fe;nt++)ne[32767+nt]=We,Q[32767+nt]=[],Q[32767+nt][1]=We,Q[32767+nt][0]=Fe-1+nt;fe<<=1,Fe<<=1}})(),(function(){for(var fe=0;fe<256;fe++)$e[fe]=19595*fe,$e[fe+256|0]=38470*fe,$e[fe+512|0]=7471*fe+32768,$e[fe+768|0]=-11059*fe,$e[fe+1024|0]=-21709*fe,$e[fe+1280|0]=32768*fe+8421375,$e[fe+1536|0]=-27439*fe,$e[fe+1792|0]=-5329*fe})(),Vt(p)}function ll(p,l){if(this.pos=0,this.buffer=p,this.datav=new DataView(p.buffer),this.is_with_alpha=!!l,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function Oy(p){function l(Pe){if(!Pe)throw Error("assert :P")}function u(Pe,rt,_e){for(var we=0;4>we;we++)if(Pe[rt+we]!=_e.charCodeAt(we))return!0;return!1}function g(Pe,rt,_e,we,Ge){for(var Ye=0;Ye<Ge;Ye++)Pe[rt+Ye]=_e[we+Ye]}function v(Pe,rt,_e,we){for(var Ge=0;Ge<we;Ge++)Pe[rt+Ge]=_e}function x(Pe){return new Int32Array(Pe)}function b(Pe,rt){for(var _e=[],we=0;we<Pe;we++)_e.push(new rt);return _e}function s(Pe,rt){var _e=[];return(function we(Ge,Ye,xt){for(var kt=xt[Ye],yt=0;yt<kt&&(Ge.push(xt.length>Ye+1?[]:new rt),!(xt.length<Ye+1));yt++)we(Ge[yt],Ye+1,xt)})(_e,0,Pe),_e}var E=function(){var Pe=this;function rt(T,C){for(var V=1<<C-1>>>0;T&V;)V>>>=1;return V?(T&V-1)+V:T}function _e(T,C,V,Z,oe){l(!(Z%V));do T[C+(Z-=V)]=oe;while(0<Z)}function we(T,C,V,Z,oe){if(l(2328>=oe),512>=oe)var ue=x(512);else if((ue=x(oe))==null)return 0;return(function(me,ve,Ae,Re,at,Tt){var ke,Ve,_t=ve,Ot=1<<Ae,wt=x(16),jt=x(16);for(l(at!=0),l(Re!=null),l(me!=null),l(0<Ae),Ve=0;Ve<at;++Ve){if(15<Re[Ve])return 0;++wt[Re[Ve]]}if(wt[0]==at)return 0;for(jt[1]=0,ke=1;15>ke;++ke){if(wt[ke]>1<<ke)return 0;jt[ke+1]=jt[ke]+wt[ke]}for(Ve=0;Ve<at;++Ve)ke=Re[Ve],0<Re[Ve]&&(Tt[jt[ke]++]=Ve);if(jt[15]==1)return(Re=new Ge).g=0,Re.value=Tt[0],_e(me,_t,1,Ot,Re),Ot;var Ut,tr=-1,Jt=Ot-1,Dr=0,Sr=1,Yr=1,Mr=1<<Ae;for(Ve=0,ke=1,at=2;ke<=Ae;++ke,at<<=1){if(Sr+=Yr<<=1,0>(Yr-=wt[ke]))return 0;for(;0<wt[ke];--wt[ke])(Re=new Ge).g=ke,Re.value=Tt[Ve++],_e(me,_t+Dr,at,Mr,Re),Dr=rt(Dr,ke)}for(ke=Ae+1,at=2;15>=ke;++ke,at<<=1){if(Sr+=Yr<<=1,0>(Yr-=wt[ke]))return 0;for(;0<wt[ke];--wt[ke]){if(Re=new Ge,(Dr&Jt)!=tr){for(_t+=Mr,Ut=1<<(tr=ke)-Ae;15>tr&&!(0>=(Ut-=wt[tr]));)++tr,Ut<<=1;Ot+=Mr=1<<(Ut=tr-Ae),me[ve+(tr=Dr&Jt)].g=Ut+Ae,me[ve+tr].value=_t-ve-tr}Re.g=ke-Ae,Re.value=Tt[Ve++],_e(me,_t+(Dr>>Ae),at,Mr,Re),Dr=rt(Dr,ke)}}return Sr!=2*jt[15]-1?0:Ot})(T,C,V,Z,oe,ue)}function Ge(){this.value=this.g=0}function Ye(){this.value=this.g=0}function xt(){this.G=b(5,Ge),this.H=x(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=b(Ms,Ye)}function kt(T,C,V,Z){l(T!=null),l(C!=null),l(2147483648>Z),T.Ca=254,T.I=0,T.b=-8,T.Ka=0,T.oa=C,T.pa=V,T.Jd=C,T.Yc=V+Z,T.Zc=4<=Z?V+Z-4+1:V,ft(T)}function yt(T,C){for(var V=0;0<C--;)V|=zt(T,128)<<C;return V}function mt(T,C){var V=yt(T,C);return It(T)?-V:V}function gt(T,C,V,Z){var oe,ue=0;for(l(T!=null),l(C!=null),l(4294967288>Z),T.Sb=Z,T.Ra=0,T.u=0,T.h=0,4<Z&&(Z=4),oe=0;oe<Z;++oe)ue+=C[V+oe]<<8*oe;T.Ra=ue,T.bb=Z,T.oa=C,T.pa=V}function Qt(T){for(;8<=T.u&&T.bb<T.Sb;)T.Ra>>>=8,T.Ra+=T.oa[T.pa+T.bb]<<Es-8>>>0,++T.bb,T.u-=8;tt(T)&&(T.h=1,T.u=0)}function Vt(T,C){if(l(0<=C),!T.h&&C<=ss){var V=We(T)&ms[C];return T.u+=C,Qt(T),V}return T.h=1,T.u=0}function fe(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function Fe(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function We(T){return T.Ra>>>(T.u&Es-1)>>>0}function tt(T){return l(T.bb<=T.Sb),T.h||T.bb==T.Sb&&T.u>Es}function nt(T,C){T.u=C,T.h=tt(T)}function ut(T){T.u>=ka&&(l(T.u>=ka),Qt(T))}function ft(T){l(T!=null&&T.oa!=null),T.pa<T.Zc?(T.I=(T.oa[T.pa++]|T.I<<8)>>>0,T.b+=8):(l(T!=null&&T.oa!=null),T.pa<T.Yc?(T.b+=8,T.I=T.oa[T.pa++]|T.I<<8):T.Ka?T.b=0:(T.I<<=8,T.b+=8,T.Ka=1))}function It(T){return yt(T,1)}function zt(T,C){var V=T.Ca;0>T.b&&ft(T);var Z=T.b,oe=V*C>>>8,ue=(T.I>>>Z>oe)+0;for(ue?(V-=oe,T.I-=oe+1<<Z>>>0):V=oe+1,Z=V,oe=0;256<=Z;)oe+=8,Z>>=8;return Z=7^oe+fa[Z],T.b-=Z,T.Ca=(V<<Z)-1,ue}function Zt(T,C,V){T[C+0]=V>>24&255,T[C+1]=V>>16&255,T[C+2]=V>>8&255,T[C+3]=255&V}function sr(T,C){return T[C+0]|T[C+1]<<8}function ur(T,C){return sr(T,C)|T[C+2]<<16}function _r(T,C){return sr(T,C)|sr(T,C+2)<<16}function Le(T,C){var V=1<<C;return l(T!=null),l(0<C),T.X=x(V),T.X==null?0:(T.Mb=32-C,T.Xa=C,1)}function lr(T,C){l(T!=null),l(C!=null),l(T.Xa==C.Xa),g(C.X,0,T.X,0,1<<C.Xa)}function br(){this.X=[],this.Xa=this.Mb=0}function Tr(T,C,V,Z){l(V!=null),l(Z!=null);var oe=V[0],ue=Z[0];return oe==0&&(oe=(T*ue+C/2)/C),ue==0&&(ue=(C*oe+T/2)/T),0>=oe||0>=ue?0:(V[0]=oe,Z[0]=ue,1)}function Yt(T,C){return T+(1<<C)-1>>>C}function zr(T,C){return((4278255360&T)+(4278255360&C)>>>0&4278255360)+((16711935&T)+(16711935&C)>>>0&16711935)>>>0}function yr(T,C){Pe[C]=function(V,Z,oe,ue,me,ve,Ae){var Re;for(Re=0;Re<me;++Re){var at=Pe[T](ve[Ae+Re-1],oe,ue+Re);ve[Ae+Re]=zr(V[Z+Re],at)}}}function Lr(){this.ud=this.hd=this.jd=0}function Cr(T,C){return((4278124286&(T^C))>>>1)+(T&C)>>>0}function li(T){return 0<=T&&256>T?T:0>T?0:255<T?255:void 0}function Gr(T,C){return li(T+(T-C+.5>>1))}function Vr(T,C,V){return Math.abs(C-V)-Math.abs(T-V)}function ni(T,C,V,Z,oe,ue,me){for(Z=ue[me-1],V=0;V<oe;++V)ue[me+V]=Z=zr(T[C+V],Z)}function ei(T,C,V,Z,oe){var ue;for(ue=0;ue<V;++ue){var me=T[C+ue],ve=me>>8&255,Ae=16711935&(Ae=(Ae=16711935&me)+((ve<<16)+ve));Z[oe+ue]=(4278255360&me)+Ae>>>0}}function xr(T,C){C.jd=255&T,C.hd=T>>8&255,C.ud=T>>16&255}function Qe(T,C,V,Z,oe,ue){var me;for(me=0;me<Z;++me){var ve=C[V+me],Ae=ve>>>8,Re=ve,at=255&(at=(at=ve>>>16)+((T.jd<<24>>24)*(Ae<<24>>24)>>>5));Re=255&(Re=(Re+=(T.hd<<24>>24)*(Ae<<24>>24)>>>5)+((T.ud<<24>>24)*(at<<24>>24)>>>5)),oe[ue+me]=(4278255360&ve)+(at<<16)+Re}}function W(T,C,V,Z,oe){Pe[C]=function(ue,me,ve,Ae,Re,at,Tt,ke,Ve){for(Ae=Tt;Ae<ke;++Ae)for(Tt=0;Tt<Ve;++Tt)Re[at++]=oe(ve[Z(ue[me++])])},Pe[T]=function(ue,me,ve,Ae,Re,at,Tt){var ke=8>>ue.b,Ve=ue.Ea,_t=ue.K[0],Ot=ue.w;if(8>ke)for(ue=(1<<ue.b)-1,Ot=(1<<ke)-1;me<ve;++me){var wt,jt=0;for(wt=0;wt<Ve;++wt)wt&ue||(jt=Z(Ae[Re++])),at[Tt++]=oe(_t[jt&Ot]),jt>>=ke}else Pe["VP8LMapColor"+V](Ae,Re,_t,Ot,at,Tt,me,ve,Ve)}}function te(T,C,V,Z,oe){for(V=C+V;C<V;){var ue=T[C++];Z[oe++]=ue>>16&255,Z[oe++]=ue>>8&255,Z[oe++]=255&ue}}function se(T,C,V,Z,oe){for(V=C+V;C<V;){var ue=T[C++];Z[oe++]=ue>>16&255,Z[oe++]=ue>>8&255,Z[oe++]=255&ue,Z[oe++]=ue>>24&255}}function Ce(T,C,V,Z,oe){for(V=C+V;C<V;){var ue=(me=T[C++])>>16&240|me>>12&15,me=240&me|me>>28&15;Z[oe++]=ue,Z[oe++]=me}}function Oe(T,C,V,Z,oe){for(V=C+V;C<V;){var ue=(me=T[C++])>>16&248|me>>13&7,me=me>>5&224|me>>3&31;Z[oe++]=ue,Z[oe++]=me}}function ht(T,C,V,Z,oe){for(V=C+V;C<V;){var ue=T[C++];Z[oe++]=255&ue,Z[oe++]=ue>>8&255,Z[oe++]=ue>>16&255}}function Y(T,C,V,Z,oe,ue){if(ue==0)for(V=C+V;C<V;)Zt(Z,((ue=T[C++])[0]>>24|ue[1]>>8&65280|ue[2]<<8&16711680|ue[3]<<24)>>>0),oe+=32;else g(Z,oe,T,C,V)}function P(T,C){Pe[C][0]=Pe[T+"0"],Pe[C][1]=Pe[T+"1"],Pe[C][2]=Pe[T+"2"],Pe[C][3]=Pe[T+"3"],Pe[C][4]=Pe[T+"4"],Pe[C][5]=Pe[T+"5"],Pe[C][6]=Pe[T+"6"],Pe[C][7]=Pe[T+"7"],Pe[C][8]=Pe[T+"8"],Pe[C][9]=Pe[T+"9"],Pe[C][10]=Pe[T+"10"],Pe[C][11]=Pe[T+"11"],Pe[C][12]=Pe[T+"12"],Pe[C][13]=Pe[T+"13"],Pe[C][14]=Pe[T+"0"],Pe[C][15]=Pe[T+"0"]}function k(T){return T==tu||T==rc||T==Qa||T==Xo}function ee(){this.eb=[],this.size=this.A=this.fb=0}function le(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function ge(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new ee,this.f.kb=new le,this.sd=null}function ie(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function ot(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Mt(T){return alert("todo:WebPSamplerProcessPlane"),T.T}function ct(T,C){var V=T.T,Z=C.ba.f.RGBA,oe=Z.eb,ue=Z.fb+T.ka*Z.A,me=Yn[C.ba.S],ve=T.y,Ae=T.O,Re=T.f,at=T.N,Tt=T.ea,ke=T.W,Ve=C.cc,_t=C.dc,Ot=C.Mc,wt=C.Nc,jt=T.ka,Ut=T.ka+T.T,tr=T.U,Jt=tr+1>>1;for(jt==0?me(ve,Ae,null,null,Re,at,Tt,ke,Re,at,Tt,ke,oe,ue,null,null,tr):(me(C.ec,C.fc,ve,Ae,Ve,_t,Ot,wt,Re,at,Tt,ke,oe,ue-Z.A,oe,ue,tr),++V);jt+2<Ut;jt+=2)Ve=Re,_t=at,Ot=Tt,wt=ke,at+=T.Rc,ke+=T.Rc,ue+=2*Z.A,me(ve,(Ae+=2*T.fa)-T.fa,ve,Ae,Ve,_t,Ot,wt,Re,at,Tt,ke,oe,ue-Z.A,oe,ue,tr);return Ae+=T.fa,T.j+Ut<T.o?(g(C.ec,C.fc,ve,Ae,tr),g(C.cc,C.dc,Re,at,Jt),g(C.Mc,C.Nc,Tt,ke,Jt),V--):1&Ut||me(ve,Ae,null,null,Re,at,Tt,ke,Re,at,Tt,ke,oe,ue+Z.A,null,null,tr),V}function dt(T,C,V){var Z=T.F,oe=[T.J];if(Z!=null){var ue=T.U,me=C.ba.S,ve=me==Ac||me==Qa;C=C.ba.f.RGBA;var Ae=[0],Re=T.ka;Ae[0]=T.T,T.Kb&&(Re==0?--Ae[0]:(--Re,oe[0]-=T.width),T.j+T.ka+T.T==T.o&&(Ae[0]=T.o-T.j-Re));var at=C.eb;Re=C.fb+Re*C.A,T=To(Z,oe[0],T.width,ue,Ae,at,Re+(ve?0:3),C.A),l(V==Ae),T&&k(me)&&Sl(at,Re,ve,ue,Ae,C.A)}return 0}function Dt(T){var C=T.ma,V=C.ba.S,Z=11>V,oe=V==Pc||V==Ao||V==Ac||V==Qc||V==12||k(V);if(C.memory=null,C.Ib=null,C.Jb=null,C.Nd=null,!yl(C.Oa,T,oe?11:12))return 0;if(oe&&k(V)&&La(),T.da)alert("todo:use_scaling");else{if(Z){if(C.Ib=Mt,T.Kb){if(V=T.U+1>>1,C.memory=x(T.U+2*V),C.memory==null)return 0;C.ec=C.memory,C.fc=0,C.cc=C.ec,C.dc=C.fc+T.U,C.Mc=C.cc,C.Nc=C.dc+V,C.Ib=ct,La()}}else alert("todo:EmitYUV");oe&&(C.Jb=dt,Z&&Ls())}if(Z&&!Dc){for(T=0;256>T;++T)cc[T]=89858*(T-128)+lc>>oc,lu[T]=-22014*(T-128)+lc,ou[T]=-45773*(T-128),Eu[T]=113618*(T-128)+lc>>oc;for(T=Al;T<Ra;++T)C=76283*(T-16)+lc>>oc,ku[T-Al]=oa(C,255),cu[T-Al]=oa(C+8>>4,15);Dc=1}return 1}function Ct(T){var C=T.ma,V=T.U,Z=T.T;return l(!(1&T.ka)),0>=V||0>=Z?0:(V=C.Ib(T,C),C.Jb!=null&&C.Jb(T,C,V),C.Dc+=V,1)}function Ht(T){T.ma.memory=null}function Gt(T,C,V,Z){return Vt(T,8)!=47?0:(C[0]=Vt(T,14)+1,V[0]=Vt(T,14)+1,Z[0]=Vt(T,1),Vt(T,3)!=0?0:!T.h)}function dr(T,C){if(4>T)return T+1;var V=T-2>>1;return(2+(1&T)<<V)+Vt(C,V)+1}function vr(T,C){return 120<C?C-120:1<=(V=((V=Io[C-1])>>4)*T+(8-(15&V)))?V:1;var V}function Nr(T,C,V){var Z=We(V),oe=T[C+=255&Z].g-8;return 0<oe&&(nt(V,V.u+8),Z=We(V),C+=T[C].value,C+=Z&(1<<oe)-1),nt(V,V.u+T[C].g),T[C].value}function Lt(T,C,V){return V.g+=T.g,V.value+=T.value<<C>>>0,l(8>=V.g),T.g}function wr(T,C,V){var Z=T.xc;return l((C=Z==0?0:T.vc[T.md*(V>>Z)+(C>>Z)])<T.Wb),T.Ya[C]}function zi(T,C,V,Z){var oe=T.ab,ue=T.c*C,me=T.C;C=me+C;var ve=V,Ae=Z;for(Z=T.Ta,V=T.Ua;0<oe--;){var Re=T.gc[oe],at=me,Tt=C,ke=ve,Ve=Ae,_t=(Ae=Z,ve=V,Re.Ea);switch(l(at<Tt),l(Tt<=Re.nc),Re.hc){case 2:ln(ke,Ve,(Tt-at)*_t,Ae,ve);break;case 0:var Ot=at,wt=Tt,jt=Ae,Ut=ve,tr=(Mr=Re).Ea;Ot==0&&(Jl(ke,Ve,null,null,1,jt,Ut),ni(ke,Ve+1,0,0,tr-1,jt,Ut+1),Ve+=tr,Ut+=tr,++Ot);for(var Jt=1<<Mr.b,Dr=Jt-1,Sr=Yt(tr,Mr.b),Yr=Mr.K,Mr=Mr.w+(Ot>>Mr.b)*Sr;Ot<wt;){var hi=Yr,un=Mr,ii=1;for(bl(ke,Ve,jt,Ut-tr,1,jt,Ut);ii<tr;){var Ir=(ii&~Dr)+Jt;Ir>tr&&(Ir=tr),(0,bo[hi[un++]>>8&15])(ke,Ve+ +ii,jt,Ut+ii-tr,Ir-ii,jt,Ut+ii),ii=Ir}Ve+=tr,Ut+=tr,++Ot&Dr||(Mr+=Sr)}Tt!=Re.nc&&g(Ae,ve-_t,Ae,ve+(Tt-at-1)*_t,_t);break;case 1:for(_t=ke,wt=Ve,tr=(ke=Re.Ea)-(Ut=ke&~(jt=(Ve=1<<Re.b)-1)),Ot=Yt(ke,Re.b),Jt=Re.K,Re=Re.w+(at>>Re.b)*Ot;at<Tt;){for(Dr=Jt,Sr=Re,Yr=new Lr,Mr=wt+Ut,hi=wt+ke;wt<Mr;)xr(Dr[Sr++],Yr),as(Yr,_t,wt,Ve,Ae,ve),wt+=Ve,ve+=Ve;wt<hi&&(xr(Dr[Sr++],Yr),as(Yr,_t,wt,tr,Ae,ve),wt+=tr,ve+=tr),++at&jt||(Re+=Ot)}break;case 3:if(ke==Ae&&Ve==ve&&0<Re.b){for(wt=Ae,ke=_t=ve+(Tt-at)*_t-(Ut=(Tt-at)*Yt(Re.Ea,Re.b)),Ve=Ae,jt=ve,Ot=[],Ut=(tr=Ut)-1;0<=Ut;--Ut)Ot[Ut]=Ve[jt+Ut];for(Ut=tr-1;0<=Ut;--Ut)wt[ke+Ut]=Ot[Ut];vo(Re,at,Tt,Ae,_t,Ae,ve)}else vo(Re,at,Tt,ke,Ve,Ae,ve)}ve=Z,Ae=V}Ae!=V&&g(Z,V,ve,Ae,ue)}function fn(T,C){var V=T.V,Z=T.Ba+T.c*T.C,oe=C-T.C;if(l(C<=T.l.o),l(16>=oe),0<oe){var ue=T.l,me=T.Ta,ve=T.Ua,Ae=ue.width;if(zi(T,oe,V,Z),oe=ve=[ve],l((V=T.C)<(Z=C)),l(ue.v<ue.va),Z>ue.o&&(Z=ue.o),V<ue.j){var Re=ue.j-V;V=ue.j,oe[0]+=Re*Ae}if(V>=Z?V=0:(oe[0]+=4*ue.v,ue.ka=V-ue.j,ue.U=ue.va-ue.v,ue.T=Z-V,V=1),V){if(ve=ve[0],11>(V=T.ca).S){var at=V.f.RGBA,Tt=(Z=V.S,oe=ue.U,ue=ue.T,Re=at.eb,at.A),ke=ue;for(at=at.fb+T.Ma*at.A;0<ke--;){var Ve=me,_t=ve,Ot=oe,wt=Re,jt=at;switch(Z){case Ho:xo(Ve,_t,Ot,wt,jt);break;case Pc:Da(Ve,_t,Ot,wt,jt);break;case tu:Da(Ve,_t,Ot,wt,jt),Sl(wt,jt,0,Ot,1,0);break;case Kc:Na(Ve,_t,Ot,wt,jt);break;case Ao:Y(Ve,_t,Ot,wt,jt,1);break;case rc:Y(Ve,_t,Ot,wt,jt,1),Sl(wt,jt,0,Ot,1,0);break;case Ac:Y(Ve,_t,Ot,wt,jt,0);break;case Qa:Y(Ve,_t,Ot,wt,jt,0),Sl(wt,jt,1,Ot,1,0);break;case Qc:Fa(Ve,_t,Ot,wt,jt);break;case Xo:Fa(Ve,_t,Ot,wt,jt),Tc(wt,jt,Ot,1,0);break;case eu:za(Ve,_t,Ot,wt,jt);break;default:l(0)}ve+=Ae,at+=Tt}T.Ma+=ue}else alert("todo:EmitRescaledRowsYUVA");l(T.Ma<=V.height)}}T.C=C,l(T.C<=T.i)}function mi(T){var C;if(0<T.ua)return 0;for(C=0;C<T.Wb;++C){var V=T.Ya[C].G,Z=T.Ya[C].H;if(0<V[1][Z[1]+0].g||0<V[2][Z[2]+0].g||0<V[3][Z[3]+0].g)return 0}return 1}function Xt(T,C,V,Z,oe,ue){if(T.Z!=0){var me=T.qd,ve=T.rd;for(l(ga[T.Z]!=null);C<V;++C)ga[T.Z](me,ve,Z,oe,Z,oe,ue),me=Z,ve=oe,oe+=ue;T.qd=me,T.rd=ve}}function Er(T,C){var V=T.l.ma,Z=V.Z==0||V.Z==1?T.l.j:T.C;if(Z=T.C<Z?Z:T.C,l(C<=T.l.o),C>Z){var oe=T.l.width,ue=V.ca,me=V.tb+oe*Z,ve=T.V,Ae=T.Ba+T.c*Z,Re=T.gc;l(T.ab==1),l(Re[0].hc==3),Xs(Re[0],Z,C,ve,Ae,ue,me),Xt(V,Z,C,ue,me,oe)}T.C=T.Ma=C}function Rr(T,C,V,Z,oe,ue,me){var ve=T.$/Z,Ae=T.$%Z,Re=T.m,at=T.s,Tt=V+T.$,ke=Tt;oe=V+Z*oe;var Ve=V+Z*ue,_t=280+at.ua,Ot=T.Pb?ve:16777216,wt=0<at.ua?at.Wa:null,jt=at.wc,Ut=Tt<Ve?wr(at,Ae,ve):null;l(T.C<ue),l(Ve<=oe);var tr=!1;e:for(;;){for(;tr||Tt<Ve;){var Jt=0;if(ve>=Ot){var Dr=Tt-V;l((Ot=T).Pb),Ot.wd=Ot.m,Ot.xd=Dr,0<Ot.s.ua&&lr(Ot.s.Wa,Ot.s.vb),Ot=ve+iu}if(Ae&jt||(Ut=wr(at,Ae,ve)),l(Ut!=null),Ut.Qb&&(C[Tt]=Ut.qb,tr=!0),!tr)if(ut(Re),Ut.jc){Jt=Re,Dr=C;var Sr=Tt,Yr=Ut.pd[We(Jt)&Ms-1];l(Ut.jc),256>Yr.g?(nt(Jt,Jt.u+Yr.g),Dr[Sr]=Yr.value,Jt=0):(nt(Jt,Jt.u+Yr.g-256),l(256<=Yr.value),Jt=Yr.value),Jt==0&&(tr=!0)}else Jt=Nr(Ut.G[0],Ut.H[0],Re);if(Re.h)break;if(tr||256>Jt){if(!tr)if(Ut.nd)C[Tt]=(Ut.qb|Jt<<8)>>>0;else{if(ut(Re),tr=Nr(Ut.G[1],Ut.H[1],Re),ut(Re),Dr=Nr(Ut.G[2],Ut.H[2],Re),Sr=Nr(Ut.G[3],Ut.H[3],Re),Re.h)break;C[Tt]=(Sr<<24|tr<<16|Jt<<8|Dr)>>>0}if(tr=!1,++Tt,++Ae>=Z&&(Ae=0,++ve,me!=null&&ve<=ue&&!(ve%16)&&me(T,ve),wt!=null))for(;ke<Tt;)Jt=C[ke++],wt.X[(506832829*Jt&4294967295)>>>wt.Mb]=Jt}else if(280>Jt){if(Jt=dr(Jt-256,Re),Dr=Nr(Ut.G[4],Ut.H[4],Re),ut(Re),Dr=vr(Z,Dr=dr(Dr,Re)),Re.h)break;if(Tt-V<Dr||oe-Tt<Jt)break e;for(Sr=0;Sr<Jt;++Sr)C[Tt+Sr]=C[Tt+Sr-Dr];for(Tt+=Jt,Ae+=Jt;Ae>=Z;)Ae-=Z,++ve,me!=null&&ve<=ue&&!(ve%16)&&me(T,ve);if(l(Tt<=oe),Ae&jt&&(Ut=wr(at,Ae,ve)),wt!=null)for(;ke<Tt;)Jt=C[ke++],wt.X[(506832829*Jt&4294967295)>>>wt.Mb]=Jt}else{if(!(Jt<_t))break e;for(tr=Jt-280,l(wt!=null);ke<Tt;)Jt=C[ke++],wt.X[(506832829*Jt&4294967295)>>>wt.Mb]=Jt;Jt=Tt,l(!(tr>>>(Dr=wt).Xa)),C[Jt]=Dr.X[tr],tr=!0}tr||l(Re.h==tt(Re))}if(T.Pb&&Re.h&&Tt<oe)l(T.m.h),T.a=5,T.m=T.wd,T.$=T.xd,0<T.s.ua&&lr(T.s.vb,T.s.Wa);else{if(Re.h)break e;me?.(T,ve>ue?ue:ve),T.a=0,T.$=Tt-V}return 1}return T.a=3,0}function Ni(T){l(T!=null),T.vc=null,T.yc=null,T.Ya=null;var C=T.Wa;C!=null&&(C.X=null),T.vb=null,l(T!=null)}function Rs(){var T=new Wr;return T==null?null:(T.a=0,T.xb=_s,P("Predictor","VP8LPredictors"),P("Predictor","VP8LPredictors_C"),P("PredictorAdd","VP8LPredictorsAdd"),P("PredictorAdd","VP8LPredictorsAdd_C"),ln=ei,as=Qe,xo=te,Da=se,Fa=Ce,za=Oe,Na=ht,Pe.VP8LMapColor32b=pa,Pe.VP8LMapColor8b=xl,T)}function Dn(T,C,V,Z,oe){var ue=1,me=[T],ve=[C],Ae=Z.m,Re=Z.s,at=null,Tt=0;e:for(;;){if(V)for(;ue&&Vt(Ae,1);){var ke=me,Ve=ve,_t=Z,Ot=1,wt=_t.m,jt=_t.gc[_t.ab],Ut=Vt(wt,2);if(_t.Oc&1<<Ut)ue=0;else{switch(_t.Oc|=1<<Ut,jt.hc=Ut,jt.Ea=ke[0],jt.nc=Ve[0],jt.K=[null],++_t.ab,l(4>=_t.ab),Ut){case 0:case 1:jt.b=Vt(wt,3)+2,Ot=Dn(Yt(jt.Ea,jt.b),Yt(jt.nc,jt.b),0,_t,jt.K),jt.K=jt.K[0];break;case 3:var tr,Jt=Vt(wt,8)+1,Dr=16<Jt?0:4<Jt?1:2<Jt?2:3;if(ke[0]=Yt(jt.Ea,Dr),jt.b=Dr,tr=Ot=Dn(Jt,1,0,_t,jt.K)){var Sr,Yr=Jt,Mr=jt,hi=1<<(8>>Mr.b),un=x(hi);if(un==null)tr=0;else{var ii=Mr.K[0],Ir=Mr.w;for(un[0]=Mr.K[0][0],Sr=1;Sr<1*Yr;++Sr)un[Sr]=zr(ii[Ir+Sr],un[Sr-1]);for(;Sr<4*hi;++Sr)un[Sr]=0;Mr.K[0]=null,Mr.K[0]=un,tr=1}}Ot=tr;break;case 2:break;default:l(0)}ue=Ot}}if(me=me[0],ve=ve[0],ue&&Vt(Ae,1)&&!(ue=1<=(Tt=Vt(Ae,4))&&11>=Tt)){Z.a=3;break e}var fr;if(fr=ue)t:{var en,Jr,pi,bi=Z,Kr=me,ls=ve,Oi=Tt,Mn=V,Rn=bi.m,mn=bi.s,_i=[null],Pi=1,tn=0,ci=Yo[Oi];r:for(;;){if(Mn&&Vt(Rn,1)){var gn=Vt(Rn,3)+2,mr=Yt(Kr,gn),pr=Yt(ls,gn),Bn=mr*pr;if(!Dn(mr,pr,0,bi,_i))break r;for(_i=_i[0],mn.xc=gn,en=0;en<Bn;++en){var Ai=_i[en]>>8&65535;_i[en]=Ai,Ai>=Pi&&(Pi=Ai+1)}}if(Rn.h)break r;for(Jr=0;5>Jr;++Jr){var hn=Lc[Jr];!Jr&&0<Oi&&(hn+=1<<Oi),tn<hn&&(tn=hn)}var Fi=b(Pi*ci,Ge),ji=Pi,cs=b(ji,xt);if(cs==null)var ys=null;else l(65536>=ji),ys=cs;var vs=x(tn);if(ys==null||vs==null||Fi==null){bi.a=1;break r}var Ds=Fi;for(en=pi=0;en<Pi;++en){var Ii=ys[en],fi=Ii.G,xi=Ii.H,Fs=0,zs=1,Tn=0;for(Jr=0;5>Jr;++Jr){hn=Lc[Jr],fi[Jr]=Ds,xi[Jr]=pi,!Jr&&0<Oi&&(hn+=1<<Oi);n:{var Il,Ll=hn,Cl=bi,to=vs,ro=Ds,zc=pi,el=0,ya=Cl.m,uc=Vt(ya,1);if(v(to,0,0,Ll),uc){var uu=Vt(ya,1)+1,Ml=Vt(ya,1),Mo=Vt(ya,Ml==0?1:8);to[Mo]=1,uu==2&&(to[Mo=Vt(ya,8)]=1);var El=1}else{var kl=x(19),Eo=Vt(ya,4)+4;if(19<Eo){Cl.a=3;var Dl=0;break n}for(Il=0;Il<Eo;++Il)kl[Mc[Il]]=Vt(ya,3);var Fl=void 0,ko=void 0,Nc=Cl,m=kl,t=Ll,n=to,o=0,h=Nc.m,_=8,w=b(128,Ge);i:for(;we(w,0,7,m,19);){if(Vt(h,1)){var A=2+2*Vt(h,3);if((Fl=2+Vt(h,A))>t)break i}else Fl=t;for(ko=0;ko<t&&Fl--;){ut(h);var M=w[0+(127&We(h))];nt(h,h.u+M.g);var z=M.value;if(16>z)n[ko++]=z,z!=0&&(_=z);else{var O=z==16,$=z-16,G=ru[$],J=Vt(h,Ic[$])+G;if(ko+J>t)break i;for(var ce=O?_:0;0<J--;)n[ko++]=ce}}o=1;break i}o||(Nc.a=3),El=o}(El=El&&!ya.h)&&(el=we(ro,zc,8,to,Ll)),El&&el!=0?Dl=el:(Cl.a=3,Dl=0)}if(Dl==0)break r;if(zs&&Cc[Jr]==1&&(zs=Ds[pi].g==0),Fs+=Ds[pi].g,pi+=Dl,3>=Jr){var be,Te=vs[0];for(be=1;be<hn;++be)vs[be]>Te&&(Te=vs[be]);Tn+=Te}}if(Ii.nd=zs,Ii.Qb=0,zs&&(Ii.qb=(fi[3][xi[3]+0].value<<24|fi[1][xi[1]+0].value<<16|fi[2][xi[2]+0].value)>>>0,Fs==0&&256>fi[0][xi[0]+0].value&&(Ii.Qb=1,Ii.qb+=fi[0][xi[0]+0].value<<8)),Ii.jc=!Ii.Qb&&6>Tn,Ii.jc){var Se,Me=Ii;for(Se=0;Se<Ms;++Se){var He=Se,Ee=Me.pd[He],Xe=Me.G[0][Me.H[0]+He];256<=Xe.value?(Ee.g=Xe.g+256,Ee.value=Xe.value):(Ee.g=0,Ee.value=0,He>>=Lt(Xe,8,Ee),He>>=Lt(Me.G[1][Me.H[1]+He],16,Ee),He>>=Lt(Me.G[2][Me.H[2]+He],0,Ee),Lt(Me.G[3][Me.H[3]+He],24,Ee))}}}mn.vc=_i,mn.Wb=Pi,mn.Ya=ys,mn.yc=Fi,fr=1;break t}fr=0}if(!(ue=fr)){Z.a=3;break e}if(0<Tt){if(Re.ua=1<<Tt,!Le(Re.Wa,Tt)){Z.a=1,ue=0;break e}}else Re.ua=0;var et=Z,qe=me,lt=ve,At=et.s,vt=At.xc;if(et.c=qe,et.i=lt,At.md=Yt(qe,vt),At.wc=vt==0?-1:(1<<vt)-1,V){Z.xb=Ko;break e}if((at=x(me*ve))==null){Z.a=1,ue=0;break e}ue=(ue=Rr(Z,at,0,me,ve,ve,null))&&!Ae.h;break e}return ue?(oe!=null?oe[0]=at:(l(at==null),l(V)),Z.$=0,V||Ni(Re)):Ni(Re),ue}function $r(T,C){var V=T.c*T.i,Z=V+C+16*C;return l(T.c<=C),T.V=x(Z),T.V==null?(T.Ta=null,T.Ua=0,T.a=1,0):(T.Ta=T.V,T.Ua=T.Ba+V+C,1)}function wa(T,C){var V=T.C,Z=C-V,oe=T.V,ue=T.Ba+T.c*V;for(l(C<=T.l.o);0<Z;){var me=16<Z?16:Z,ve=T.l.ma,Ae=T.l.width,Re=Ae*me,at=ve.ca,Tt=ve.tb+Ae*V,ke=T.Ta,Ve=T.Ua;zi(T,me,oe,ue),Kl(ke,Ve,at,Tt,Re),Xt(ve,V,V+me,at,Tt,Ae),Z-=me,oe+=me*T.c,V+=me}l(V==C),T.C=T.Ma=C}function Sa(){this.ub=this.yd=this.td=this.Rb=0}function Ua(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function ho(){this.Fb=this.Bb=this.Cb=0,this.Zb=x(4),this.Lb=x(4)}function qa(){this.Yb=(function(){var T=[];return(function C(V,Z,oe){for(var ue=oe[Z],me=0;me<ue&&(V.push(oe.length>Z+1?[]:0),!(oe.length<Z+1));me++)C(V[me],Z+1,oe)})(T,0,[3,11]),T})()}function Ga(){this.jb=x(3),this.Wc=s([4,8],qa),this.Xc=s([4,17],qa)}function fo(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new x(4),this.od=new x(4)}function Ri(){this.ld=this.La=this.dd=this.tc=0}function gi(){this.Na=this.la=0}function Bo(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Ta(){this.ad=x(384),this.Za=0,this.Ob=x(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function po(){this.uc=this.M=this.Nb=0,this.wa=Array(new Ri),this.Y=0,this.ya=Array(new Ta),this.aa=0,this.l=new Bs}function Pa(){this.y=x(16),this.f=x(8),this.ea=x(8)}function ds(){this.cb=this.a=0,this.sc="",this.m=new fe,this.Od=new Sa,this.Kc=new Ua,this.ed=new fo,this.Qa=new ho,this.Ic=this.$c=this.Aa=0,this.D=new po,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=b(8,fe),this.ia=0,this.pb=b(4,Bo),this.Pa=new Ga,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Pa),this.Hd=0,this.rb=Array(new gi),this.sb=0,this.wa=Array(new Ri),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Ta),this.L=this.aa=0,this.gd=s([4,2],Ri),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function oa(T,C){return 0>T?0:T>C?C:T}function Bs(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function pl(){var T=new ds;return T!=null&&(T.a=0,T.sc="OK",T.cb=0,T.Xb=0,ic||(ic=Aa)),T}function ri(T,C,V){return T.a==0&&(T.a=C,T.sc=V,T.cb=0),0}function Gl(T,C,V){return 3<=V&&T[C+0]==157&&T[C+1]==1&&T[C+2]==42}function la(T,C){if(T==null)return 0;if(T.a=0,T.sc="OK",C==null)return ri(T,2,"null VP8Io passed to VP8GetHeaders()");var V=C.data,Z=C.w,oe=C.ha;if(4>oe)return ri(T,7,"Truncated header.");var ue=V[Z+0]|V[Z+1]<<8|V[Z+2]<<16,me=T.Od;if(me.Rb=!(1&ue),me.td=ue>>1&7,me.yd=ue>>4&1,me.ub=ue>>5,3<me.td)return ri(T,3,"Incorrect keyframe parameters.");if(!me.yd)return ri(T,4,"Frame not displayable.");Z+=3,oe-=3;var ve=T.Kc;if(me.Rb){if(7>oe)return ri(T,7,"cannot parse picture header");if(!Gl(V,Z,oe))return ri(T,3,"Bad code word");ve.c=16383&(V[Z+4]<<8|V[Z+3]),ve.Td=V[Z+4]>>6,ve.i=16383&(V[Z+6]<<8|V[Z+5]),ve.Ud=V[Z+6]>>6,Z+=7,oe-=7,T.za=ve.c+15>>4,T.Ub=ve.i+15>>4,C.width=ve.c,C.height=ve.i,C.Da=0,C.j=0,C.v=0,C.va=C.width,C.o=C.height,C.da=0,C.ib=C.width,C.hb=C.height,C.U=C.width,C.T=C.height,v((ue=T.Pa).jb,0,255,ue.jb.length),l((ue=T.Qa)!=null),ue.Cb=0,ue.Bb=0,ue.Fb=1,v(ue.Zb,0,0,ue.Zb.length),v(ue.Lb,0,0,ue.Lb)}if(me.ub>oe)return ri(T,7,"bad partition length");kt(ue=T.m,V,Z,me.ub),Z+=me.ub,oe-=me.ub,me.Rb&&(ve.Ld=It(ue),ve.Kd=It(ue)),ve=T.Qa;var Ae,Re=T.Pa;if(l(ue!=null),l(ve!=null),ve.Cb=It(ue),ve.Cb){if(ve.Bb=It(ue),It(ue)){for(ve.Fb=It(ue),Ae=0;4>Ae;++Ae)ve.Zb[Ae]=It(ue)?mt(ue,7):0;for(Ae=0;4>Ae;++Ae)ve.Lb[Ae]=It(ue)?mt(ue,6):0}if(ve.Bb)for(Ae=0;3>Ae;++Ae)Re.jb[Ae]=It(ue)?yt(ue,8):255}else ve.Bb=0;if(ue.Ka)return ri(T,3,"cannot parse segment header");if((ve=T.ed).zd=It(ue),ve.Tb=yt(ue,6),ve.wb=yt(ue,3),ve.Pc=It(ue),ve.Pc&&It(ue)){for(Re=0;4>Re;++Re)It(ue)&&(ve.vd[Re]=mt(ue,6));for(Re=0;4>Re;++Re)It(ue)&&(ve.od[Re]=mt(ue,6))}if(T.L=ve.Tb==0?0:ve.zd?1:2,ue.Ka)return ri(T,3,"cannot parse filter header");var at=oe;if(oe=Ae=Z,Z=Ae+at,ve=at,T.Xb=(1<<yt(T.m,2))-1,at<3*(Re=T.Xb))V=7;else{for(Ae+=3*Re,ve-=3*Re,at=0;at<Re;++at){var Tt=V[oe+0]|V[oe+1]<<8|V[oe+2]<<16;Tt>ve&&(Tt=ve),kt(T.Jc[+at],V,Ae,Tt),Ae+=Tt,ve-=Tt,oe+=3}kt(T.Jc[+Re],V,Ae,ve),V=Ae<Z?0:5}if(V!=0)return ri(T,V,"cannot parse partitions");for(V=yt(Ae=T.m,7),oe=It(Ae)?mt(Ae,4):0,Z=It(Ae)?mt(Ae,4):0,ve=It(Ae)?mt(Ae,4):0,Re=It(Ae)?mt(Ae,4):0,Ae=It(Ae)?mt(Ae,4):0,at=T.Qa,Tt=0;4>Tt;++Tt){if(at.Cb){var ke=at.Zb[Tt];at.Fb||(ke+=V)}else{if(0<Tt){T.pb[Tt]=T.pb[0];continue}ke=V}var Ve=T.pb[Tt];Ve.Sc[0]=nu[oa(ke+oe,127)],Ve.Sc[1]=Jo[oa(ke+0,127)],Ve.Eb[0]=2*nu[oa(ke+Z,127)],Ve.Eb[1]=101581*Jo[oa(ke+ve,127)]>>16,8>Ve.Eb[1]&&(Ve.Eb[1]=8),Ve.Qc[0]=nu[oa(ke+Re,117)],Ve.Qc[1]=Jo[oa(ke+Ae,127)],Ve.lc=ke+Ae}if(!me.Rb)return ri(T,4,"Not a key frame.");for(It(ue),me=T.Pa,V=0;4>V;++V){for(oe=0;8>oe;++oe)for(Z=0;3>Z;++Z)for(ve=0;11>ve;++ve)Re=zt(ue,ac[V][oe][Z][ve])?yt(ue,8):Lu[V][oe][Z][ve],me.Wc[V][oe].Yb[Z][ve]=Re;for(oe=0;17>oe;++oe)me.Xc[V][oe]=me.Wc[V][Ec[oe]]}return T.kc=It(ue),T.kc&&(T.Bd=yt(ue,8)),T.cb=1}function Aa(T,C,V,Z,oe,ue,me){var ve=C[oe].Yb[V];for(V=0;16>oe;++oe){if(!zt(T,ve[V+0]))return oe;for(;!zt(T,ve[V+1]);)if(ve=C[++oe].Yb[0],V=0,oe==16)return 16;var Ae=C[oe+1].Yb;if(zt(T,ve[V+2])){var Re=T,at=0;if(zt(Re,(ke=ve)[(Tt=V)+3]))if(zt(Re,ke[Tt+6])){for(ve=0,Tt=2*(at=zt(Re,ke[Tt+8]))+(ke=zt(Re,ke[Tt+9+at])),at=0,ke=Iu[Tt];ke[ve];++ve)at+=at+zt(Re,ke[ve]);at+=3+(8<<Tt)}else zt(Re,ke[Tt+7])?(at=7+2*zt(Re,165),at+=zt(Re,145)):at=5+zt(Re,159);else at=zt(Re,ke[Tt+4])?3+zt(Re,ke[Tt+5]):2;ve=Ae[2]}else at=1,ve=Ae[1];Ae=me+nc[oe],0>(Re=T).b&&ft(Re);var Tt,ke=Re.b,Ve=(Tt=Re.Ca>>1)-(Re.I>>ke)>>31;--Re.b,Re.Ca+=Ve,Re.Ca|=1,Re.I-=(Tt+1&Ve)<<ke,ue[Ae]=((at^Ve)-Ve)*Z[(0<oe)+0]}return 16}function $l(T){var C=T.rb[T.sb-1];C.la=0,C.Na=0,v(T.zc,0,0,T.zc.length),T.ja=0}function As(T,C,V,Z,oe){oe=T[C+V+32*Z]+(oe>>3),T[C+V+32*Z]=-256&oe?0>oe?0:255:oe}function wn(T,C,V,Z,oe,ue){As(T,C,0,V,Z+oe),As(T,C,1,V,Z+ue),As(T,C,2,V,Z-ue),As(T,C,3,V,Z-oe)}function Os(T){return(20091*T>>16)+T}function ml(T,C,V,Z){var oe,ue=0,me=x(16);for(oe=0;4>oe;++oe){var ve=T[C+0]+T[C+8],Ae=T[C+0]-T[C+8],Re=(35468*T[C+4]>>16)-Os(T[C+12]),at=Os(T[C+4])+(35468*T[C+12]>>16);me[ue+0]=ve+at,me[ue+1]=Ae+Re,me[ue+2]=Ae-Re,me[ue+3]=ve-at,ue+=4,C++}for(oe=ue=0;4>oe;++oe)ve=(T=me[ue+0]+4)+me[ue+8],Ae=T-me[ue+8],Re=(35468*me[ue+4]>>16)-Os(me[ue+12]),As(V,Z,0,0,ve+(at=Os(me[ue+4])+(35468*me[ue+12]>>16))),As(V,Z,1,0,Ae+Re),As(V,Z,2,0,Ae-Re),As(V,Z,3,0,ve-at),ue++,Z+=32}function Zl(T,C,V,Z){var oe=T[C+0]+4,ue=35468*T[C+4]>>16,me=Os(T[C+4]),ve=35468*T[C+1]>>16;wn(V,Z,0,oe+me,T=Os(T[C+1]),ve),wn(V,Z,1,oe+ue,T,ve),wn(V,Z,2,oe-ue,T,ve),wn(V,Z,3,oe-me,T,ve)}function Wl(T,C,V,Z,oe){ml(T,C,V,Z),oe&&ml(T,C+16,V,Z+4)}function js(T,C,V,Z){Ja(T,C+0,V,Z,1),Ja(T,C+32,V,Z+128,1)}function wc(T,C,V,Z){var oe;for(T=T[C+0]+4,oe=0;4>oe;++oe)for(C=0;4>C;++C)As(V,Z,C,oe,T)}function mo(T,C,V,Z){T[C+0]&&Si(T,C+0,V,Z),T[C+16]&&Si(T,C+16,V,Z+4),T[C+32]&&Si(T,C+32,V,Z+128),T[C+48]&&Si(T,C+48,V,Z+128+4)}function $a(T,C,V,Z){var oe,ue=x(16);for(oe=0;4>oe;++oe){var me=T[C+0+oe]+T[C+12+oe],ve=T[C+4+oe]+T[C+8+oe],Ae=T[C+4+oe]-T[C+8+oe],Re=T[C+0+oe]-T[C+12+oe];ue[0+oe]=me+ve,ue[8+oe]=me-ve,ue[4+oe]=Re+Ae,ue[12+oe]=Re-Ae}for(oe=0;4>oe;++oe)me=(T=ue[0+4*oe]+3)+ue[3+4*oe],ve=ue[1+4*oe]+ue[2+4*oe],Ae=ue[1+4*oe]-ue[2+4*oe],Re=T-ue[3+4*oe],V[Z+0]=me+ve>>3,V[Z+16]=Re+Ae>>3,V[Z+32]=me-ve>>3,V[Z+48]=Re-Ae>>3,Z+=64}function go(T,C,V){var Z,oe=C-32,ue=os,me=255-T[oe-1];for(Z=0;Z<V;++Z){var ve,Ae=ue,Re=me+T[C-1];for(ve=0;ve<V;++ve)T[C+ve]=Ae[Re+T[oe+ve]];C+=32}}function _o(T,C){go(T,C,4)}function Hl(T,C){go(T,C,8)}function Oo(T,C){go(T,C,16)}function Vs(T,C){var V;for(V=0;16>V;++V)g(T,C+32*V,T,C-32,16)}function Za(T,C){var V;for(V=16;0<V;--V)v(T,C,T[C-1],16),C+=32}function Ur(T,C,V){var Z;for(Z=0;16>Z;++Z)v(C,V+32*Z,T,16)}function Xl(T,C){var V,Z=16;for(V=0;16>V;++V)Z+=T[C-1+32*V]+T[C+V-32];Ur(Z>>5,T,C)}function jo(T,C){var V,Z=8;for(V=0;16>V;++V)Z+=T[C-1+32*V];Ur(Z>>4,T,C)}function Vo(T,C){var V,Z=8;for(V=0;16>V;++V)Z+=T[C+V-32];Ur(Z>>4,T,C)}function Hn(T,C){Ur(128,T,C)}function kr(T,C,V){return T+2*C+V+2>>2}function Bi(T,C){var V,Z=C-32;for(Z=new Uint8Array([kr(T[Z-1],T[Z+0],T[Z+1]),kr(T[Z+0],T[Z+1],T[Z+2]),kr(T[Z+1],T[Z+2],T[Z+3]),kr(T[Z+2],T[Z+3],T[Z+4])]),V=0;4>V;++V)g(T,C+32*V,Z,0,Z.length)}function Br(T,C){var V=T[C-1],Z=T[C-1+32],oe=T[C-1+64],ue=T[C-1+96];Zt(T,C+0,16843009*kr(T[C-1-32],V,Z)),Zt(T,C+32,16843009*kr(V,Z,oe)),Zt(T,C+64,16843009*kr(Z,oe,ue)),Zt(T,C+96,16843009*kr(oe,ue,ue))}function wi(T,C){var V,Z=4;for(V=0;4>V;++V)Z+=T[C+V-32]+T[C-1+32*V];for(Z>>=3,V=0;4>V;++V)v(T,C+32*V,Z,4)}function Xn(T,C){var V=T[C-1+0],Z=T[C-1+32],oe=T[C-1+64],ue=T[C-1-32],me=T[C+0-32],ve=T[C+1-32],Ae=T[C+2-32],Re=T[C+3-32];T[C+0+96]=kr(Z,oe,T[C-1+96]),T[C+1+96]=T[C+0+64]=kr(V,Z,oe),T[C+2+96]=T[C+1+64]=T[C+0+32]=kr(ue,V,Z),T[C+3+96]=T[C+2+64]=T[C+1+32]=T[C+0+0]=kr(me,ue,V),T[C+3+64]=T[C+2+32]=T[C+1+0]=kr(ve,me,ue),T[C+3+32]=T[C+2+0]=kr(Ae,ve,me),T[C+3+0]=kr(Re,Ae,ve)}function Ki(T,C){var V=T[C+1-32],Z=T[C+2-32],oe=T[C+3-32],ue=T[C+4-32],me=T[C+5-32],ve=T[C+6-32],Ae=T[C+7-32];T[C+0+0]=kr(T[C+0-32],V,Z),T[C+1+0]=T[C+0+32]=kr(V,Z,oe),T[C+2+0]=T[C+1+32]=T[C+0+64]=kr(Z,oe,ue),T[C+3+0]=T[C+2+32]=T[C+1+64]=T[C+0+96]=kr(oe,ue,me),T[C+3+32]=T[C+2+64]=T[C+1+96]=kr(ue,me,ve),T[C+3+64]=T[C+2+96]=kr(me,ve,Ae),T[C+3+96]=kr(ve,Ae,Ae)}function is(T,C){var V=T[C-1+0],Z=T[C-1+32],oe=T[C-1+64],ue=T[C-1-32],me=T[C+0-32],ve=T[C+1-32],Ae=T[C+2-32],Re=T[C+3-32];T[C+0+0]=T[C+1+64]=ue+me+1>>1,T[C+1+0]=T[C+2+64]=me+ve+1>>1,T[C+2+0]=T[C+3+64]=ve+Ae+1>>1,T[C+3+0]=Ae+Re+1>>1,T[C+0+96]=kr(oe,Z,V),T[C+0+64]=kr(Z,V,ue),T[C+0+32]=T[C+1+96]=kr(V,ue,me),T[C+1+32]=T[C+2+96]=kr(ue,me,ve),T[C+2+32]=T[C+3+96]=kr(me,ve,Ae),T[C+3+32]=kr(ve,Ae,Re)}function Un(T,C){var V=T[C+0-32],Z=T[C+1-32],oe=T[C+2-32],ue=T[C+3-32],me=T[C+4-32],ve=T[C+5-32],Ae=T[C+6-32],Re=T[C+7-32];T[C+0+0]=V+Z+1>>1,T[C+1+0]=T[C+0+64]=Z+oe+1>>1,T[C+2+0]=T[C+1+64]=oe+ue+1>>1,T[C+3+0]=T[C+2+64]=ue+me+1>>1,T[C+0+32]=kr(V,Z,oe),T[C+1+32]=T[C+0+96]=kr(Z,oe,ue),T[C+2+32]=T[C+1+96]=kr(oe,ue,me),T[C+3+32]=T[C+2+96]=kr(ue,me,ve),T[C+3+64]=kr(me,ve,Ae),T[C+3+96]=kr(ve,Ae,Re)}function ca(T,C){var V=T[C-1+0],Z=T[C-1+32],oe=T[C-1+64],ue=T[C-1+96];T[C+0+0]=V+Z+1>>1,T[C+2+0]=T[C+0+32]=Z+oe+1>>1,T[C+2+32]=T[C+0+64]=oe+ue+1>>1,T[C+1+0]=kr(V,Z,oe),T[C+3+0]=T[C+1+32]=kr(Z,oe,ue),T[C+3+32]=T[C+1+64]=kr(oe,ue,ue),T[C+3+64]=T[C+2+64]=T[C+0+96]=T[C+1+96]=T[C+2+96]=T[C+3+96]=ue}function Us(T,C){var V=T[C-1+0],Z=T[C-1+32],oe=T[C-1+64],ue=T[C-1+96],me=T[C-1-32],ve=T[C+0-32],Ae=T[C+1-32],Re=T[C+2-32];T[C+0+0]=T[C+2+32]=V+me+1>>1,T[C+0+32]=T[C+2+64]=Z+V+1>>1,T[C+0+64]=T[C+2+96]=oe+Z+1>>1,T[C+0+96]=ue+oe+1>>1,T[C+3+0]=kr(ve,Ae,Re),T[C+2+0]=kr(me,ve,Ae),T[C+1+0]=T[C+3+32]=kr(V,me,ve),T[C+1+32]=T[C+3+64]=kr(Z,V,me),T[C+1+64]=T[C+3+96]=kr(oe,Z,V),T[C+1+96]=kr(ue,oe,Z)}function Mi(T,C){var V;for(V=0;8>V;++V)g(T,C+32*V,T,C-32,8)}function Wa(T,C){var V;for(V=0;8>V;++V)v(T,C,T[C-1],8),C+=32}function Fn(T,C,V){var Z;for(Z=0;8>Z;++Z)v(C,V+32*Z,T,8)}function gl(T,C){var V,Z=8;for(V=0;8>V;++V)Z+=T[C+V-32]+T[C-1+32*V];Fn(Z>>4,T,C)}function zn(T,C){var V,Z=4;for(V=0;8>V;++V)Z+=T[C+V-32];Fn(Z>>3,T,C)}function ua(T,C){var V,Z=4;for(V=0;8>V;++V)Z+=T[C-1+32*V];Fn(Z>>3,T,C)}function qs(T,C){Fn(128,T,C)}function Ia(T,C,V){var Z=T[C-V],oe=T[C+0],ue=3*(oe-Z)+Po[1020+T[C-2*V]-T[C+V]],me=tc[112+(ue+4>>3)];T[C-V]=os[255+Z+tc[112+(ue+3>>3)]],T[C+0]=os[255+oe-me]}function Uo(T,C,V,Z){var oe=T[C+0],ue=T[C+V];return qr[255+T[C-2*V]-T[C-V]]>Z||qr[255+ue-oe]>Z}function Gs(T,C,V,Z){return 4*qr[255+T[C-V]-T[C+0]]+qr[255+T[C-2*V]-T[C+V]]<=Z}function vi(T,C,V,Z,oe){var ue=T[C-3*V],me=T[C-2*V],ve=T[C-V],Ae=T[C+0],Re=T[C+V],at=T[C+2*V],Tt=T[C+3*V];return 4*qr[255+ve-Ae]+qr[255+me-Re]>Z?0:qr[255+T[C-4*V]-ue]<=oe&&qr[255+ue-me]<=oe&&qr[255+me-ve]<=oe&&qr[255+Tt-at]<=oe&&qr[255+at-Re]<=oe&&qr[255+Re-Ae]<=oe}function $s(T,C,V,Z){var oe=2*Z+1;for(Z=0;16>Z;++Z)Gs(T,C+Z,V,oe)&&Ia(T,C+Z,V)}function si(T,C,V,Z){var oe=2*Z+1;for(Z=0;16>Z;++Z)Gs(T,C+Z*V,1,oe)&&Ia(T,C+Z*V,1)}function Zr(T,C,V,Z){var oe;for(oe=3;0<oe;--oe)$s(T,C+=4*V,V,Z)}function Ha(T,C,V,Z){var oe;for(oe=3;0<oe;--oe)si(T,C+=4,V,Z)}function Qr(T,C,V,Z,oe,ue,me,ve){for(ue=2*ue+1;0<oe--;){if(vi(T,C,V,ue,me))if(Uo(T,C,V,ve))Ia(T,C,V);else{var Ae=T,Re=C,at=V,Tt=Ae[Re-2*at],ke=Ae[Re-at],Ve=Ae[Re+0],_t=Ae[Re+at],Ot=Ae[Re+2*at],wt=27*(Ut=Po[1020+3*(Ve-ke)+Po[1020+Tt-_t]])+63>>7,jt=18*Ut+63>>7,Ut=9*Ut+63>>7;Ae[Re-3*at]=os[255+Ae[Re-3*at]+Ut],Ae[Re-2*at]=os[255+Tt+jt],Ae[Re-at]=os[255+ke+wt],Ae[Re+0]=os[255+Ve-wt],Ae[Re+at]=os[255+_t-jt],Ae[Re+2*at]=os[255+Ot-Ut]}C+=Z}}function Is(T,C,V,Z,oe,ue,me,ve){for(ue=2*ue+1;0<oe--;){if(vi(T,C,V,ue,me))if(Uo(T,C,V,ve))Ia(T,C,V);else{var Ae=T,Re=C,at=V,Tt=Ae[Re-at],ke=Ae[Re+0],Ve=Ae[Re+at],_t=tc[112+(4+(Ot=3*(ke-Tt))>>3)],Ot=tc[112+(Ot+3>>3)],wt=_t+1>>1;Ae[Re-2*at]=os[255+Ae[Re-2*at]+wt],Ae[Re-at]=os[255+Tt+Ot],Ae[Re+0]=os[255+ke-_t],Ae[Re+at]=os[255+Ve-wt]}C+=Z}}function ns(T,C,V,Z,oe,ue){Qr(T,C,V,1,16,Z,oe,ue)}function Zs(T,C,V,Z,oe,ue){Qr(T,C,1,V,16,Z,oe,ue)}function ha(T,C,V,Z,oe,ue){var me;for(me=3;0<me;--me)Is(T,C+=4*V,V,1,16,Z,oe,ue)}function N(T,C,V,Z,oe,ue){var me;for(me=3;0<me;--me)Is(T,C+=4,1,V,16,Z,oe,ue)}function ae(T,C,V,Z,oe,ue,me,ve){Qr(T,C,oe,1,8,ue,me,ve),Qr(V,Z,oe,1,8,ue,me,ve)}function Ne(T,C,V,Z,oe,ue,me,ve){Qr(T,C,1,oe,8,ue,me,ve),Qr(V,Z,1,oe,8,ue,me,ve)}function it(T,C,V,Z,oe,ue,me,ve){Is(T,C+4*oe,oe,1,8,ue,me,ve),Is(V,Z+4*oe,oe,1,8,ue,me,ve)}function pt(T,C,V,Z,oe,ue,me,ve){Is(T,C+4,1,oe,8,ue,me,ve),Is(V,Z+4,1,oe,8,ue,me,ve)}function Rt(){this.ba=new ge,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new ot,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Wt(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function ar(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Pr(){this.ua=0,this.Wa=new br,this.vb=new br,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new xt,this.yc=new Ge}function Wr(){this.xb=this.a=0,this.l=new Bs,this.ca=new ge,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new Fe,this.Pb=0,this.wd=new Fe,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Pr,this.ab=0,this.gc=b(4,ar),this.Oc=0}function Xr(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Bs,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Or(T,C,V,Z,oe,ue,me){for(T=T==null?0:T[C+0],C=0;C<me;++C)oe[ue+C]=T+V[Z+C]&255,T=oe[ue+C]}function Hi(T,C,V,Z,oe,ue,me){var ve;if(T==null)Or(null,null,V,Z,oe,ue,me);else for(ve=0;ve<me;++ve)oe[ue+ve]=T[C+ve]+V[Z+ve]&255}function pn(T,C,V,Z,oe,ue,me){if(T==null)Or(null,null,V,Z,oe,ue,me);else{var ve,Ae=T[C+0],Re=Ae,at=Ae;for(ve=0;ve<me;++ve)Re=at+(Ae=T[C+ve])-Re,at=V[Z+ve]+(-256&Re?0>Re?0:255:Re)&255,Re=Ae,oe[ue+ve]=at}}function Ei(T,C,V,Z){var oe=C.width,ue=C.o;if(l(T!=null&&C!=null),0>V||0>=Z||V+Z>ue)return null;if(!T.Cc){if(T.ga==null){var me;if(T.ga=new Xr,(me=T.ga==null)||(me=C.width*C.o,l(T.Gb.length==0),T.Gb=x(me),T.Uc=0,T.Gb==null?me=0:(T.mb=T.Gb,T.nb=T.Uc,T.rc=null,me=1),me=!me),!me){me=T.ga;var ve=T.Fa,Ae=T.P,Re=T.qc,at=T.mb,Tt=T.nb,ke=Ae+1,Ve=Re-1,_t=me.l;if(l(ve!=null&&at!=null&&C!=null),ga[0]=null,ga[1]=Or,ga[2]=Hi,ga[3]=pn,me.ca=at,me.tb=Tt,me.c=C.width,me.i=C.height,l(0<me.c&&0<me.i),1>=Re)C=0;else if(me.$a=3&ve[Ae+0],me.Z=ve[Ae+0]>>2&3,me.Lc=ve[Ae+0]>>4&3,Ae=ve[Ae+0]>>6&3,0>me.$a||1<me.$a||4<=me.Z||1<me.Lc||Ae)C=0;else if(_t.put=Ct,_t.ac=Dt,_t.bc=Ht,_t.ma=me,_t.width=C.width,_t.height=C.height,_t.Da=C.Da,_t.v=C.v,_t.va=C.va,_t.j=C.j,_t.o=C.o,me.$a)e:{l(me.$a==1),C=Rs();t:for(;;){if(C==null){C=0;break e}if(l(me!=null),me.mc=C,C.c=me.c,C.i=me.i,C.l=me.l,C.l.ma=me,C.l.width=me.c,C.l.height=me.i,C.a=0,gt(C.m,ve,ke,Ve),!Dn(me.c,me.i,1,C,null)||(C.ab==1&&C.gc[0].hc==3&&mi(C.s)?(me.ic=1,ve=C.c*C.i,C.Ta=null,C.Ua=0,C.V=x(ve),C.Ba=0,C.V==null?(C.a=1,C=0):C=1):(me.ic=0,C=$r(C,me.c)),!C))break t;C=1;break e}me.mc=null,C=0}else C=Ve>=me.c*me.i;me=!C}if(me)return null;T.ga.Lc!=1?T.Ga=0:Z=ue-V}l(T.ga!=null),l(V+Z<=ue);e:{if(C=(ve=T.ga).c,ue=ve.l.o,ve.$a==0){if(ke=T.rc,Ve=T.Vc,_t=T.Fa,Ae=T.P+1+V*C,Re=T.mb,at=T.nb+V*C,l(Ae<=T.P+T.qc),ve.Z!=0)for(l(ga[ve.Z]!=null),me=0;me<Z;++me)ga[ve.Z](ke,Ve,_t,Ae,Re,at,C),ke=Re,Ve=at,at+=C,Ae+=C;else for(me=0;me<Z;++me)g(Re,at,_t,Ae,C),ke=Re,Ve=at,at+=C,Ae+=C;T.rc=ke,T.Vc=Ve}else{if(l(ve.mc!=null),C=V+Z,l((me=ve.mc)!=null),l(C<=me.i),me.C>=C)C=1;else if(ve.ic||Ls(),ve.ic){ve=me.V,ke=me.Ba,Ve=me.c;var Ot=me.i,wt=(_t=1,Ae=me.$/Ve,Re=me.$%Ve,at=me.m,Tt=me.s,me.$),jt=Ve*Ot,Ut=Ve*C,tr=Tt.wc,Jt=wt<Ut?wr(Tt,Re,Ae):null;l(wt<=jt),l(C<=Ot),l(mi(Tt));t:for(;;){for(;!at.h&&wt<Ut;){if(Re&tr||(Jt=wr(Tt,Re,Ae)),l(Jt!=null),ut(at),256>(Ot=Nr(Jt.G[0],Jt.H[0],at)))ve[ke+wt]=Ot,++wt,++Re>=Ve&&(Re=0,++Ae<=C&&!(Ae%16)&&Er(me,Ae));else{if(!(280>Ot)){_t=0;break t}Ot=dr(Ot-256,at);var Dr,Sr=Nr(Jt.G[4],Jt.H[4],at);if(ut(at),!(wt>=(Sr=vr(Ve,Sr=dr(Sr,at)))&&jt-wt>=Ot)){_t=0;break t}for(Dr=0;Dr<Ot;++Dr)ve[ke+wt+Dr]=ve[ke+wt+Dr-Sr];for(wt+=Ot,Re+=Ot;Re>=Ve;)Re-=Ve,++Ae<=C&&!(Ae%16)&&Er(me,Ae);wt<Ut&&Re&tr&&(Jt=wr(Tt,Re,Ae))}l(at.h==tt(at))}Er(me,Ae>C?C:Ae);break t}!_t||at.h&&wt<jt?(_t=0,me.a=at.h?5:3):me.$=wt,C=_t}else C=Rr(me,me.V,me.Ba,me.c,me.i,C,wa);if(!C){Z=0;break e}}V+Z>=ue&&(T.Cc=1),Z=1}if(!Z)return null;if(T.Cc&&((Z=T.ga)!=null&&(Z.mc=null),T.ga=null,0<T.Ga))return alert("todo:WebPDequantizeLevels"),null}return T.nb+V*oe}function Ln(T,C,V,Z,oe,ue){for(;0<oe--;){var me,ve=T,Ae=C+(V?1:0),Re=T,at=C+(V?0:3);for(me=0;me<Z;++me){var Tt=Re[at+4*me];Tt!=255&&(Tt*=32897,ve[Ae+4*me+0]=ve[Ae+4*me+0]*Tt>>23,ve[Ae+4*me+1]=ve[Ae+4*me+1]*Tt>>23,ve[Ae+4*me+2]=ve[Ae+4*me+2]*Tt>>23)}C+=ue}}function Gi(T,C,V,Z,oe){for(;0<Z--;){var ue;for(ue=0;ue<V;++ue){var me=T[C+2*ue+0],ve=15&(Re=T[C+2*ue+1]),Ae=4369*ve,Re=(240&Re|Re>>4)*Ae>>16;T[C+2*ue+0]=(240&me|me>>4)*Ae>>16&240|(15&me|me<<4)*Ae>>16>>4&15,T[C+2*ue+1]=240&Re|ve}C+=oe}}function Sn(T,C,V,Z,oe,ue,me,ve){var Ae,Re,at=255;for(Re=0;Re<oe;++Re){for(Ae=0;Ae<Z;++Ae){var Tt=T[C+Ae];ue[me+4*Ae]=Tt,at&=Tt}C+=V,me+=ve}return at!=255}function fs(T,C,V,Z,oe){var ue;for(ue=0;ue<oe;++ue)V[Z+ue]=T[C+ue]>>8}function Ls(){Sl=Ln,Tc=Gi,To=Sn,Kl=fs}function Cs(T,C,V){Pe[T]=function(Z,oe,ue,me,ve,Ae,Re,at,Tt,ke,Ve,_t,Ot,wt,jt,Ut,tr){var Jt,Dr=tr-1>>1,Sr=ve[Ae+0]|Re[at+0]<<16,Yr=Tt[ke+0]|Ve[_t+0]<<16;l(Z!=null);var Mr=3*Sr+Yr+131074>>2;for(C(Z[oe+0],255&Mr,Mr>>16,Ot,wt),ue!=null&&(Mr=3*Yr+Sr+131074>>2,C(ue[me+0],255&Mr,Mr>>16,jt,Ut)),Jt=1;Jt<=Dr;++Jt){var hi=ve[Ae+Jt]|Re[at+Jt]<<16,un=Tt[ke+Jt]|Ve[_t+Jt]<<16,ii=Sr+hi+Yr+un+524296,Ir=ii+2*(hi+Yr)>>3;Mr=Ir+Sr>>1,Sr=(ii=ii+2*(Sr+un)>>3)+hi>>1,C(Z[oe+2*Jt-1],255&Mr,Mr>>16,Ot,wt+(2*Jt-1)*V),C(Z[oe+2*Jt-0],255&Sr,Sr>>16,Ot,wt+(2*Jt-0)*V),ue!=null&&(Mr=ii+Yr>>1,Sr=Ir+un>>1,C(ue[me+2*Jt-1],255&Mr,Mr>>16,jt,Ut+(2*Jt-1)*V),C(ue[me+2*Jt+0],255&Sr,Sr>>16,jt,Ut+(2*Jt+0)*V)),Sr=hi,Yr=un}1&tr||(Mr=3*Sr+Yr+131074>>2,C(Z[oe+tr-1],255&Mr,Mr>>16,Ot,wt+(tr-1)*V),ue!=null&&(Mr=3*Yr+Sr+131074>>2,C(ue[me+tr-1],255&Mr,Mr>>16,jt,Ut+(tr-1)*V)))}}function La(){Yn[Ho]=kc,Yn[Pc]=Pl,Yn[Kc]=Lo,Yn[Ao]=Co,Yn[Ac]=Qo,Yn[Qc]=su,Yn[eu]=Mu,Yn[tu]=Pl,Yn[rc]=Co,Yn[Qa]=Qo,Yn[Xo]=su}function da(T){return T&-16384?0>T?0:255:T>>au}function ki(T,C){return da((19077*T>>8)+(26149*C>>8)-14234)}function yo(T,C,V){return da((19077*T>>8)-(6419*C>>8)-(13320*V>>8)+8708)}function Ws(T,C){return da((19077*T>>8)+(33050*C>>8)-17685)}function Hs(T,C,V,Z,oe){Z[oe+0]=ki(T,V),Z[oe+1]=yo(T,C,V),Z[oe+2]=Ws(T,C)}function Qi(T,C,V,Z,oe){Z[oe+0]=Ws(T,C),Z[oe+1]=yo(T,C,V),Z[oe+2]=ki(T,V)}function qo(T,C,V,Z,oe){var ue=yo(T,C,V);C=ue<<3&224|Ws(T,C)>>3,Z[oe+0]=248&ki(T,V)|ue>>5,Z[oe+1]=C}function Ca(T,C,V,Z,oe){var ue=240&Ws(T,C)|15;Z[oe+0]=240&ki(T,V)|yo(T,C,V)>>4,Z[oe+1]=ue}function Yl(T,C,V,Z,oe){Z[oe+0]=255,Hs(T,C,V,Z,oe+1)}function Ma(T,C,V,Z,oe){Qi(T,C,V,Z,oe),Z[oe+3]=255}function Nn(T,C,V,Z,oe){Hs(T,C,V,Z,oe),Z[oe+3]=255}function Ea(T,C,V){Pe[T]=function(Z,oe,ue,me,ve,Ae,Re,at,Tt){for(var ke=at+(-2&Tt)*V;at!=ke;)C(Z[oe+0],ue[me+0],ve[Ae+0],Re,at),C(Z[oe+1],ue[me+0],ve[Ae+0],Re,at+V),oe+=2,++me,++Ae,at+=2*V;1&Tt&&C(Z[oe+0],ue[me+0],ve[Ae+0],Re,at)}}function Go(T,C,V){return V==0?T==0?C==0?6:5:C==0?4:0:V}function _l(T,C,V,Z,oe){switch(T>>>30){case 3:Ja(C,V,Z,oe,0);break;case 2:Ys(C,V,Z,oe);break;case 1:Si(C,V,Z,oe)}}function ps(T,C){var V,Z,oe=C.M,ue=C.Nb,me=T.oc,ve=T.pc+40,Ae=T.oc,Re=T.pc+584,at=T.oc,Tt=T.pc+600;for(V=0;16>V;++V)me[ve+32*V-1]=129;for(V=0;8>V;++V)Ae[Re+32*V-1]=129,at[Tt+32*V-1]=129;for(0<oe?me[ve-1-32]=Ae[Re-1-32]=at[Tt-1-32]=129:(v(me,ve-32-1,127,21),v(Ae,Re-32-1,127,9),v(at,Tt-32-1,127,9)),Z=0;Z<T.za;++Z){var ke=C.ya[C.aa+Z];if(0<Z){for(V=-1;16>V;++V)g(me,ve+32*V-4,me,ve+32*V+12,4);for(V=-1;8>V;++V)g(Ae,Re+32*V-4,Ae,Re+32*V+4,4),g(at,Tt+32*V-4,at,Tt+32*V+4,4)}var Ve=T.Gd,_t=T.Hd+Z,Ot=ke.ad,wt=ke.Hc;if(0<oe&&(g(me,ve-32,Ve[_t].y,0,16),g(Ae,Re-32,Ve[_t].f,0,8),g(at,Tt-32,Ve[_t].ea,0,8)),ke.Za){var jt=me,Ut=ve-32+16;for(0<oe&&(Z>=T.za-1?v(jt,Ut,Ve[_t].y[15],4):g(jt,Ut,Ve[_t+1].y,0,4)),V=0;4>V;V++)jt[Ut+128+V]=jt[Ut+256+V]=jt[Ut+384+V]=jt[Ut+0+V];for(V=0;16>V;++V,wt<<=2)jt=me,Ut=ve+Fc[V],Js[ke.Ob[V]](jt,Ut),_l(wt,Ot,16*+V,jt,Ut)}else if(jt=Go(Z,oe,ke.Ob[0]),eo[jt](me,ve),wt!=0)for(V=0;16>V;++V,wt<<=2)_l(wt,Ot,16*+V,me,ve+Fc[V]);for(V=ke.Gc,jt=Go(Z,oe,ke.Dd),Ti[jt](Ae,Re),Ti[jt](at,Tt),wt=Ot,jt=Ae,Ut=Re,255&(ke=0|V)&&(170&ke?ma(wt,256,jt,Ut):Di(wt,256,jt,Ut)),ke=at,wt=Tt,255&(V>>=8)&&(170&V?ma(Ot,320,ke,wt):Di(Ot,320,ke,wt)),oe<T.Ub-1&&(g(Ve[_t].y,0,me,ve+480,16),g(Ve[_t].f,0,Ae,Re+224,8),g(Ve[_t].ea,0,at,Tt+224,8)),V=8*ue*T.B,Ve=T.sa,_t=T.ta+16*Z+16*ue*T.R,Ot=T.qa,ke=T.ra+8*Z+V,wt=T.Ha,jt=T.Ia+8*Z+V,V=0;16>V;++V)g(Ve,_t+V*T.R,me,ve+32*V,16);for(V=0;8>V;++V)g(Ot,ke+V*T.B,Ae,Re+32*V,8),g(wt,jt+V*T.B,at,Tt+32*V,8)}}function Xa(T,C,V,Z,oe,ue,me,ve,Ae){var Re=[0],at=[0],Tt=0,ke=Ae!=null?Ae.kd:0,Ve=Ae??new Wt;if(T==null||12>V)return 7;Ve.data=T,Ve.w=C,Ve.ha=V,C=[C],V=[V],Ve.gb=[Ve.gb];e:{var _t=C,Ot=V,wt=Ve.gb;if(l(T!=null),l(Ot!=null),l(wt!=null),wt[0]=0,12<=Ot[0]&&!u(T,_t[0],"RIFF")){if(u(T,_t[0]+8,"WEBP")){wt=3;break e}var jt=_r(T,_t[0]+4);if(12>jt||4294967286<jt){wt=3;break e}if(ke&&jt>Ot[0]-8){wt=7;break e}wt[0]=jt,_t[0]+=12,Ot[0]-=12}wt=0}if(wt!=0)return wt;for(jt=0<Ve.gb[0],V=V[0];;){e:{var Ut=T;Ot=C,wt=V;var tr=Re,Jt=at,Dr=_t=[0];if((Mr=Tt=[Tt])[0]=0,8>wt[0])wt=7;else{if(!u(Ut,Ot[0],"VP8X")){if(_r(Ut,Ot[0]+4)!=10){wt=3;break e}if(18>wt[0]){wt=7;break e}var Sr=_r(Ut,Ot[0]+8),Yr=1+ur(Ut,Ot[0]+12);if(2147483648<=Yr*(Ut=1+ur(Ut,Ot[0]+15))){wt=3;break e}Dr!=null&&(Dr[0]=Sr),tr!=null&&(tr[0]=Yr),Jt!=null&&(Jt[0]=Ut),Ot[0]+=18,wt[0]-=18,Mr[0]=1}wt=0}}if(Tt=Tt[0],_t=_t[0],wt!=0)return wt;if(Ot=!!(2&_t),!jt&&Tt)return 3;if(ue!=null&&(ue[0]=!!(16&_t)),me!=null&&(me[0]=Ot),ve!=null&&(ve[0]=0),me=Re[0],_t=at[0],Tt&&Ot&&Ae==null){wt=0;break}if(4>V){wt=7;break}if(jt&&Tt||!jt&&!Tt&&!u(T,C[0],"ALPH")){V=[V],Ve.na=[Ve.na],Ve.P=[Ve.P],Ve.Sa=[Ve.Sa];e:{Sr=T,wt=C,jt=V;var Mr=Ve.gb;tr=Ve.na,Jt=Ve.P,Dr=Ve.Sa,Yr=22,l(Sr!=null),l(jt!=null),Ut=wt[0];var hi=jt[0];for(l(tr!=null),l(Dr!=null),tr[0]=null,Jt[0]=null,Dr[0]=0;;){if(wt[0]=Ut,jt[0]=hi,8>hi){wt=7;break e}var un=_r(Sr,Ut+4);if(4294967286<un){wt=3;break e}var ii=8+un+1&-2;if(Yr+=ii,0<Mr&&Yr>Mr){wt=3;break e}if(!u(Sr,Ut,"VP8 ")||!u(Sr,Ut,"VP8L")){wt=0;break e}if(hi[0]<ii){wt=7;break e}u(Sr,Ut,"ALPH")||(tr[0]=Sr,Jt[0]=Ut+8,Dr[0]=un),Ut+=ii,hi-=ii}}if(V=V[0],Ve.na=Ve.na[0],Ve.P=Ve.P[0],Ve.Sa=Ve.Sa[0],wt!=0)break}V=[V],Ve.Ja=[Ve.Ja],Ve.xa=[Ve.xa];e:if(Mr=T,wt=C,jt=V,tr=Ve.gb[0],Jt=Ve.Ja,Dr=Ve.xa,Sr=wt[0],Ut=!u(Mr,Sr,"VP8 "),Yr=!u(Mr,Sr,"VP8L"),l(Mr!=null),l(jt!=null),l(Jt!=null),l(Dr!=null),8>jt[0])wt=7;else{if(Ut||Yr){if(Mr=_r(Mr,Sr+4),12<=tr&&Mr>tr-12){wt=3;break e}if(ke&&Mr>jt[0]-8){wt=7;break e}Jt[0]=Mr,wt[0]+=8,jt[0]-=8,Dr[0]=Yr}else Dr[0]=5<=jt[0]&&Mr[Sr+0]==47&&!(Mr[Sr+4]>>5),Jt[0]=jt[0];wt=0}if(V=V[0],Ve.Ja=Ve.Ja[0],Ve.xa=Ve.xa[0],C=C[0],wt!=0)break;if(4294967286<Ve.Ja)return 3;if(ve==null||Ot||(ve[0]=Ve.xa?2:1),me=[me],_t=[_t],Ve.xa){if(5>V){wt=7;break}ve=me,ke=_t,Ot=ue,T==null||5>V?T=0:5<=V&&T[C+0]==47&&!(T[C+4]>>5)?(jt=[0],Mr=[0],tr=[0],gt(Jt=new Fe,T,C,V),Gt(Jt,jt,Mr,tr)?(ve!=null&&(ve[0]=jt[0]),ke!=null&&(ke[0]=Mr[0]),Ot!=null&&(Ot[0]=tr[0]),T=1):T=0):T=0}else{if(10>V){wt=7;break}ve=_t,T==null||10>V||!Gl(T,C+3,V-3)?T=0:(ke=T[C+0]|T[C+1]<<8|T[C+2]<<16,Ot=16383&(T[C+7]<<8|T[C+6]),T=16383&(T[C+9]<<8|T[C+8]),1&ke||3<(ke>>1&7)||!(ke>>4&1)||ke>>5>=Ve.Ja||!Ot||!T?T=0:(me&&(me[0]=Ot),ve&&(ve[0]=T),T=1))}if(!T||(me=me[0],_t=_t[0],Tt&&(Re[0]!=me||at[0]!=_t)))return 3;Ae!=null&&(Ae[0]=Ve,Ae.offset=C-Ae.w,l(4294967286>C-Ae.w),l(Ae.offset==Ae.ha-V));break}return wt==0||wt==7&&Tt&&Ae==null?(ue!=null&&(ue[0]|=Ve.na!=null&&0<Ve.na.length),Z!=null&&(Z[0]=me),oe!=null&&(oe[0]=_t),0):wt}function yl(T,C,V){var Z=C.width,oe=C.height,ue=0,me=0,ve=Z,Ae=oe;if(C.Da=T!=null&&0<T.Da,C.Da&&(ve=T.cd,Ae=T.bd,ue=T.v,me=T.j,11>V||(ue&=-2,me&=-2),0>ue||0>me||0>=ve||0>=Ae||ue+ve>Z||me+Ae>oe))return 0;if(C.v=ue,C.j=me,C.va=ue+ve,C.o=me+Ae,C.U=ve,C.T=Ae,C.da=T!=null&&0<T.da,C.da){if(!Tr(ve,Ae,V=[T.ib],ue=[T.hb]))return 0;C.ib=V[0],C.hb=ue[0]}return C.ob=T!=null&&T.ob,C.Kb=T==null||!T.Sd,C.da&&(C.ob=C.ib<3*Z/4&&C.hb<3*oe/4,C.Kb=0),1}function vl(T){if(T==null)return 2;if(11>T.S){var C=T.f.RGBA;C.fb+=(T.height-1)*C.A,C.A=-C.A}else C=T.f.kb,T=T.height,C.O+=(T-1)*C.fa,C.fa=-C.fa,C.N+=(T-1>>1)*C.Ab,C.Ab=-C.Ab,C.W+=(T-1>>1)*C.Db,C.Db=-C.Db,C.F!=null&&(C.J+=(T-1)*C.lb,C.lb=-C.lb);return 0}function Ya(T,C,V,Z){if(Z==null||0>=T||0>=C)return 2;if(V!=null){if(V.Da){var oe=V.cd,ue=V.bd,me=-2&V.v,ve=-2&V.j;if(0>me||0>ve||0>=oe||0>=ue||me+oe>T||ve+ue>C)return 2;T=oe,C=ue}if(V.da){if(!Tr(T,C,oe=[V.ib],ue=[V.hb]))return 2;T=oe[0],C=ue[0]}}Z.width=T,Z.height=C;e:{var Ae=Z.width,Re=Z.height;if(T=Z.S,0>=Ae||0>=Re||!(T>=Ho&&13>T))T=2;else{if(0>=Z.Rd&&Z.sd==null){me=ue=oe=C=0;var at=(ve=Ae*Qs[T])*Re;if(11>T||(ue=(Re+1)/2*(C=(Ae+1)/2),T==12&&(me=(oe=Ae)*Re)),(Re=x(at+2*ue+me))==null){T=1;break e}Z.sd=Re,11>T?((Ae=Z.f.RGBA).eb=Re,Ae.fb=0,Ae.A=ve,Ae.size=at):((Ae=Z.f.kb).y=Re,Ae.O=0,Ae.fa=ve,Ae.Fd=at,Ae.f=Re,Ae.N=0+at,Ae.Ab=C,Ae.Cd=ue,Ae.ea=Re,Ae.W=0+at+ue,Ae.Db=C,Ae.Ed=ue,T==12&&(Ae.F=Re,Ae.J=0+at+2*ue),Ae.Tc=me,Ae.lb=oe)}if(C=1,oe=Z.S,ue=Z.width,me=Z.height,oe>=Ho&&13>oe)if(11>oe)T=Z.f.RGBA,C&=(ve=Math.abs(T.A))*(me-1)+ue<=T.size,C&=ve>=ue*Qs[oe],C&=T.eb!=null;else{T=Z.f.kb,ve=(ue+1)/2,at=(me+1)/2,Ae=Math.abs(T.fa),Re=Math.abs(T.Ab);var Tt=Math.abs(T.Db),ke=Math.abs(T.lb),Ve=ke*(me-1)+ue;C&=Ae*(me-1)+ue<=T.Fd,C&=Re*(at-1)+ve<=T.Cd,C=(C&=Tt*(at-1)+ve<=T.Ed)&Ae>=ue&Re>=ve&Tt>=ve,C&=T.y!=null,C&=T.f!=null,C&=T.ea!=null,oe==12&&(C&=ke>=ue,C&=Ve<=T.Tc,C&=T.F!=null)}else C=0;T=C?0:2}}return T!=0||V!=null&&V.fd&&(T=vl(Z)),T}var Ms=64,ms=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],ss=24,Es=32,ka=8,fa=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];yr("Predictor0","PredictorAdd0"),Pe.Predictor0=function(){return 4278190080},Pe.Predictor1=function(T){return T},Pe.Predictor2=function(T,C,V){return C[V+0]},Pe.Predictor3=function(T,C,V){return C[V+1]},Pe.Predictor4=function(T,C,V){return C[V-1]},Pe.Predictor5=function(T,C,V){return Cr(Cr(T,C[V+1]),C[V+0])},Pe.Predictor6=function(T,C,V){return Cr(T,C[V-1])},Pe.Predictor7=function(T,C,V){return Cr(T,C[V+0])},Pe.Predictor8=function(T,C,V){return Cr(C[V-1],C[V+0])},Pe.Predictor9=function(T,C,V){return Cr(C[V+0],C[V+1])},Pe.Predictor10=function(T,C,V){return Cr(Cr(T,C[V-1]),Cr(C[V+0],C[V+1]))},Pe.Predictor11=function(T,C,V){var Z=C[V+0];return 0>=Vr(Z>>24&255,T>>24&255,(C=C[V-1])>>24&255)+Vr(Z>>16&255,T>>16&255,C>>16&255)+Vr(Z>>8&255,T>>8&255,C>>8&255)+Vr(255&Z,255&T,255&C)?Z:T},Pe.Predictor12=function(T,C,V){var Z=C[V+0];return(li((T>>24&255)+(Z>>24&255)-((C=C[V-1])>>24&255))<<24|li((T>>16&255)+(Z>>16&255)-(C>>16&255))<<16|li((T>>8&255)+(Z>>8&255)-(C>>8&255))<<8|li((255&T)+(255&Z)-(255&C)))>>>0},Pe.Predictor13=function(T,C,V){var Z=C[V-1];return(Gr((T=Cr(T,C[V+0]))>>24&255,Z>>24&255)<<24|Gr(T>>16&255,Z>>16&255)<<16|Gr(T>>8&255,Z>>8&255)<<8|Gr(255&T,255&Z))>>>0};var Jl=Pe.PredictorAdd0;Pe.PredictorAdd1=ni,yr("Predictor2","PredictorAdd2"),yr("Predictor3","PredictorAdd3"),yr("Predictor4","PredictorAdd4"),yr("Predictor5","PredictorAdd5"),yr("Predictor6","PredictorAdd6"),yr("Predictor7","PredictorAdd7"),yr("Predictor8","PredictorAdd8"),yr("Predictor9","PredictorAdd9"),yr("Predictor10","PredictorAdd10"),yr("Predictor11","PredictorAdd11"),yr("Predictor12","PredictorAdd12"),yr("Predictor13","PredictorAdd13");var bl=Pe.PredictorAdd2;W("ColorIndexInverseTransform","MapARGB","32b",function(T){return T>>8&255},function(T){return T}),W("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(T){return T},function(T){return T>>8&255});var ln,vo=Pe.ColorIndexInverseTransform,pa=Pe.MapARGB,Xs=Pe.VP8LColorIndexInverseTransformAlpha,xl=Pe.MapAlpha,bo=Pe.VP8LPredictorsAdd=[];bo.length=16,(Pe.VP8LPredictors=[]).length=16,(Pe.VP8LPredictorsAdd_C=[]).length=16,(Pe.VP8LPredictors_C=[]).length=16;var as,xo,Da,Fa,za,Na,gs,Ja,Ys,ma,Si,Di,cn,Cn,ai,wo,Ka,$o,Sc,So,wl,Zo,ks,Yc,Sl,Tc,To,Kl,Ql=x(511),Tl=x(2041),ec=x(225),Jc=x(767),Wo=0,Po=Tl,tc=ec,os=Jc,qr=Ql,Ho=0,Pc=1,Kc=2,Ao=3,Ac=4,Qc=5,eu=6,tu=7,rc=8,Qa=9,Xo=10,Ic=[2,3,7],ru=[3,3,11],Lc=[280,256,256,256,40],Cc=[0,1,1,1,0],Mc=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Io=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Yo=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],iu=8,nu=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Jo=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],ic=null,Iu=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],nc=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],sc=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],Lu=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Cu=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],ac=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Ec=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],eo=[],Js=[],Ti=[],Ko=1,_s=2,ga=[],Yn=[];Cs("UpsampleRgbLinePair",Hs,3),Cs("UpsampleBgrLinePair",Qi,3),Cs("UpsampleRgbaLinePair",Nn,4),Cs("UpsampleBgraLinePair",Ma,4),Cs("UpsampleArgbLinePair",Yl,4),Cs("UpsampleRgba4444LinePair",Ca,2),Cs("UpsampleRgb565LinePair",qo,2);var kc=Pe.UpsampleRgbLinePair,Lo=Pe.UpsampleBgrLinePair,Pl=Pe.UpsampleRgbaLinePair,Co=Pe.UpsampleBgraLinePair,Qo=Pe.UpsampleArgbLinePair,su=Pe.UpsampleRgba4444LinePair,Mu=Pe.UpsampleRgb565LinePair,oc=16,lc=1<<oc-1,Al=-227,Ra=482,au=6,Dc=0,cc=x(256),Eu=x(256),ou=x(256),lu=x(256),ku=x(Ra-Al),cu=x(Ra-Al);Ea("YuvToRgbRow",Hs,3),Ea("YuvToBgrRow",Qi,3),Ea("YuvToRgbaRow",Nn,4),Ea("YuvToBgraRow",Ma,4),Ea("YuvToArgbRow",Yl,4),Ea("YuvToRgba4444Row",Ca,2),Ea("YuvToRgb565Row",qo,2);var Fc=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],_a=[0,2,8],Du=[8,7,6,4,4,2,2,2,1,1,1,1],Ks=1;this.WebPDecodeRGBA=function(T,C,V,Z,oe){var ue=Pc,me=new Rt,ve=new ge;me.ba=ve,ve.S=ue,ve.width=[ve.width],ve.height=[ve.height];var Ae=ve.width,Re=ve.height,at=new ie;if(at==null||T==null)var Tt=2;else l(at!=null),Tt=Xa(T,C,V,at.width,at.height,at.Pd,at.Qd,at.format,null);if(Tt!=0?Ae=0:(Ae!=null&&(Ae[0]=at.width[0]),Re!=null&&(Re[0]=at.height[0]),Ae=1),Ae){ve.width=ve.width[0],ve.height=ve.height[0],Z!=null&&(Z[0]=ve.width),oe!=null&&(oe[0]=ve.height);e:{if(Z=new Bs,(oe=new Wt).data=T,oe.w=C,oe.ha=V,oe.kd=1,C=[0],l(oe!=null),((T=Xa(oe.data,oe.w,oe.ha,null,null,null,C,null,oe))==0||T==7)&&C[0]&&(T=4),(C=T)==0){if(l(me!=null),Z.data=oe.data,Z.w=oe.w+oe.offset,Z.ha=oe.ha-oe.offset,Z.put=Ct,Z.ac=Dt,Z.bc=Ht,Z.ma=me,oe.xa){if((T=Rs())==null){me=1;break e}if((function(ke,Ve){var _t=[0],Ot=[0],wt=[0];t:for(;;){if(ke==null)return 0;if(Ve==null)return ke.a=2,0;if(ke.l=Ve,ke.a=0,gt(ke.m,Ve.data,Ve.w,Ve.ha),!Gt(ke.m,_t,Ot,wt)){ke.a=3;break t}if(ke.xb=_s,Ve.width=_t[0],Ve.height=Ot[0],!Dn(_t[0],Ot[0],1,ke,null))break t;return 1}return l(ke.a!=0),0})(T,Z)){if(Z=(C=Ya(Z.width,Z.height,me.Oa,me.ba))==0){t:{Z=T;r:for(;;){if(Z==null){Z=0;break t}if(l(Z.s.yc!=null),l(Z.s.Ya!=null),l(0<Z.s.Wb),l((V=Z.l)!=null),l((oe=V.ma)!=null),Z.xb!=0){if(Z.ca=oe.ba,Z.tb=oe.tb,l(Z.ca!=null),!yl(oe.Oa,V,Ao)){Z.a=2;break r}if(!$r(Z,V.width)||V.da)break r;if((V.da||k(Z.ca.S))&&Ls(),11>Z.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),Z.ca.f.kb.F!=null&&Ls()),Z.Pb&&0<Z.s.ua&&Z.s.vb.X==null&&!Le(Z.s.vb,Z.s.Wa.Xa)){Z.a=1;break r}Z.xb=0}if(!Rr(Z,Z.V,Z.Ba,Z.c,Z.i,V.o,fn))break r;oe.Dc=Z.Ma,Z=1;break t}l(Z.a!=0),Z=0}Z=!Z}Z&&(C=T.a)}else C=T.a}else{if((T=new pl)==null){me=1;break e}if(T.Fa=oe.na,T.P=oe.P,T.qc=oe.Sa,la(T,Z)){if((C=Ya(Z.width,Z.height,me.Oa,me.ba))==0){if(T.Aa=0,V=me.Oa,l((oe=T)!=null),V!=null){if(0<(Ae=0>(Ae=V.Md)?0:100<Ae?255:255*Ae/100)){for(Re=at=0;4>Re;++Re)12>(Tt=oe.pb[Re]).lc&&(Tt.ia=Ae*Du[0>Tt.lc?0:Tt.lc]>>3),at|=Tt.ia;at&&(alert("todo:VP8InitRandom"),oe.ia=1)}oe.Ga=V.Id,100<oe.Ga?oe.Ga=100:0>oe.Ga&&(oe.Ga=0)}(function(ke,Ve){if(ke==null)return 0;if(Ve==null)return ri(ke,2,"NULL VP8Io parameter in VP8Decode().");if(!ke.cb&&!la(ke,Ve))return 0;if(l(ke.cb),Ve.ac==null||Ve.ac(Ve)){Ve.ob&&(ke.L=0);var _t=_a[ke.L];if(ke.L==2?(ke.yb=0,ke.zb=0):(ke.yb=Ve.v-_t>>4,ke.zb=Ve.j-_t>>4,0>ke.yb&&(ke.yb=0),0>ke.zb&&(ke.zb=0)),ke.Va=Ve.o+15+_t>>4,ke.Hb=Ve.va+15+_t>>4,ke.Hb>ke.za&&(ke.Hb=ke.za),ke.Va>ke.Ub&&(ke.Va=ke.Ub),0<ke.L){var Ot=ke.ed;for(_t=0;4>_t;++_t){var wt;if(ke.Qa.Cb){var jt=ke.Qa.Lb[_t];ke.Qa.Fb||(jt+=Ot.Tb)}else jt=Ot.Tb;for(wt=0;1>=wt;++wt){var Ut=ke.gd[_t][wt],tr=jt;if(Ot.Pc&&(tr+=Ot.vd[0],wt&&(tr+=Ot.od[0])),0<(tr=0>tr?0:63<tr?63:tr)){var Jt=tr;0<Ot.wb&&(Jt=4<Ot.wb?Jt>>2:Jt>>1)>9-Ot.wb&&(Jt=9-Ot.wb),1>Jt&&(Jt=1),Ut.dd=Jt,Ut.tc=2*tr+Jt,Ut.ld=40<=tr?2:15<=tr?1:0}else Ut.tc=0;Ut.La=wt}}}_t=0}else ri(ke,6,"Frame setup failed"),_t=ke.a;if(_t=_t==0){if(_t){ke.$c=0,0<ke.Aa||(ke.Ic=Ks);t:{_t=ke.Ic,Ot=4*(Jt=ke.za);var Dr=32*Jt,Sr=Jt+1,Yr=0<ke.L?Jt*(0<ke.Aa?2:1):0,Mr=(ke.Aa==2?2:1)*Jt;if((Ut=Ot+832+(wt=3*(16*_t+_a[ke.L])/2*Dr)+(jt=ke.Fa!=null&&0<ke.Fa.length?ke.Kc.c*ke.Kc.i:0))!=Ut)_t=0;else{if(Ut>ke.Vb){if(ke.Vb=0,ke.Ec=x(Ut),ke.Fc=0,ke.Ec==null){_t=ri(ke,1,"no memory during frame initialization.");break t}ke.Vb=Ut}Ut=ke.Ec,tr=ke.Fc,ke.Ac=Ut,ke.Bc=tr,tr+=Ot,ke.Gd=b(Dr,Pa),ke.Hd=0,ke.rb=b(Sr+1,gi),ke.sb=1,ke.wa=Yr?b(Yr,Ri):null,ke.Y=0,ke.D.Nb=0,ke.D.wa=ke.wa,ke.D.Y=ke.Y,0<ke.Aa&&(ke.D.Y+=Jt),l(!0),ke.oc=Ut,ke.pc=tr,tr+=832,ke.ya=b(Mr,Ta),ke.aa=0,ke.D.ya=ke.ya,ke.D.aa=ke.aa,ke.Aa==2&&(ke.D.aa+=Jt),ke.R=16*Jt,ke.B=8*Jt,Jt=(Dr=_a[ke.L])*ke.R,Dr=Dr/2*ke.B,ke.sa=Ut,ke.ta=tr+Jt,ke.qa=ke.sa,ke.ra=ke.ta+16*_t*ke.R+Dr,ke.Ha=ke.qa,ke.Ia=ke.ra+8*_t*ke.B+Dr,ke.$c=0,tr+=wt,ke.mb=jt?Ut:null,ke.nb=jt?tr:null,l(tr+jt<=ke.Fc+ke.Vb),$l(ke),v(ke.Ac,ke.Bc,0,Ot),_t=1}}if(_t){if(Ve.ka=0,Ve.y=ke.sa,Ve.O=ke.ta,Ve.f=ke.qa,Ve.N=ke.ra,Ve.ea=ke.Ha,Ve.Vd=ke.Ia,Ve.fa=ke.R,Ve.Rc=ke.B,Ve.F=null,Ve.J=0,!Wo){for(_t=-255;255>=_t;++_t)Ql[255+_t]=0>_t?-_t:_t;for(_t=-1020;1020>=_t;++_t)Tl[1020+_t]=-128>_t?-128:127<_t?127:_t;for(_t=-112;112>=_t;++_t)ec[112+_t]=-16>_t?-16:15<_t?15:_t;for(_t=-255;510>=_t;++_t)Jc[255+_t]=0>_t?0:255<_t?255:_t;Wo=1}gs=$a,Ja=Wl,ma=js,Si=wc,Di=mo,Ys=Zl,cn=ns,Cn=Zs,ai=ae,wo=Ne,Ka=ha,$o=N,Sc=it,So=pt,wl=$s,Zo=si,ks=Zr,Yc=Ha,Js[0]=wi,Js[1]=_o,Js[2]=Bi,Js[3]=Br,Js[4]=Xn,Js[5]=is,Js[6]=Ki,Js[7]=Un,Js[8]=Us,Js[9]=ca,eo[0]=Xl,eo[1]=Oo,eo[2]=Vs,eo[3]=Za,eo[4]=jo,eo[5]=Vo,eo[6]=Hn,Ti[0]=gl,Ti[1]=Hl,Ti[2]=Mi,Ti[3]=Wa,Ti[4]=ua,Ti[5]=zn,Ti[6]=qs,_t=1}else _t=0}_t&&(_t=(function(hi,un){for(hi.M=0;hi.M<hi.Va;++hi.M){var ii,Ir=hi.Jc[hi.M&hi.Xb],fr=hi.m,en=hi;for(ii=0;ii<en.za;++ii){var Jr=fr,pi=en,bi=pi.Ac,Kr=pi.Bc+4*ii,ls=pi.zc,Oi=pi.ya[pi.aa+ii];if(pi.Qa.Bb?Oi.$b=zt(Jr,pi.Pa.jb[0])?2+zt(Jr,pi.Pa.jb[2]):zt(Jr,pi.Pa.jb[1]):Oi.$b=0,pi.kc&&(Oi.Ad=zt(Jr,pi.Bd)),Oi.Za=!zt(Jr,145)+0,Oi.Za){var Mn=Oi.Ob,Rn=0;for(pi=0;4>pi;++pi){var mn,_i=ls[0+pi];for(mn=0;4>mn;++mn){_i=Cu[bi[Kr+mn]][_i];for(var Pi=sc[zt(Jr,_i[0])];0<Pi;)Pi=sc[2*Pi+zt(Jr,_i[Pi])];_i=-Pi,bi[Kr+mn]=_i}g(Mn,Rn,bi,Kr,4),Rn+=4,ls[0+pi]=_i}}else _i=zt(Jr,156)?zt(Jr,128)?1:3:zt(Jr,163)?2:0,Oi.Ob[0]=_i,v(bi,Kr,_i,4),v(ls,0,_i,4);Oi.Dd=zt(Jr,142)?zt(Jr,114)?zt(Jr,183)?1:3:2:0}if(en.m.Ka)return ri(hi,7,"Premature end-of-partition0 encountered.");for(;hi.ja<hi.za;++hi.ja){if(en=Ir,Jr=(fr=hi).rb[fr.sb-1],bi=fr.rb[fr.sb+fr.ja],ii=fr.ya[fr.aa+fr.ja],Kr=fr.kc?ii.Ad:0)Jr.la=bi.la=0,ii.Za||(Jr.Na=bi.Na=0),ii.Hc=0,ii.Gc=0,ii.ia=0;else{var tn,ci;if(Jr=bi,bi=en,Kr=fr.Pa.Xc,ls=fr.ya[fr.aa+fr.ja],Oi=fr.pb[ls.$b],pi=ls.ad,Mn=0,Rn=fr.rb[fr.sb-1],_i=mn=0,v(pi,Mn,0,384),ls.Za)var gn=0,mr=Kr[3];else{Pi=x(16);var pr=Jr.Na+Rn.Na;if(pr=ic(bi,Kr[1],pr,Oi.Eb,0,Pi,0),Jr.Na=Rn.Na=(0<pr)+0,1<pr)gs(Pi,0,pi,Mn);else{var Bn=Pi[0]+3>>3;for(Pi=0;256>Pi;Pi+=16)pi[Mn+Pi]=Bn}gn=1,mr=Kr[0]}var Ai=15&Jr.la,hn=15&Rn.la;for(Pi=0;4>Pi;++Pi){var Fi=1&hn;for(Bn=ci=0;4>Bn;++Bn)Ai=Ai>>1|(Fi=(pr=ic(bi,mr,pr=Fi+(1&Ai),Oi.Sc,gn,pi,Mn))>gn)<<7,ci=ci<<2|(3<pr?3:1<pr?2:pi[Mn+0]!=0),Mn+=16;Ai>>=4,hn=hn>>1|Fi<<7,mn=(mn<<8|ci)>>>0}for(mr=Ai,gn=hn>>4,tn=0;4>tn;tn+=2){for(ci=0,Ai=Jr.la>>4+tn,hn=Rn.la>>4+tn,Pi=0;2>Pi;++Pi){for(Fi=1&hn,Bn=0;2>Bn;++Bn)pr=Fi+(1&Ai),Ai=Ai>>1|(Fi=0<(pr=ic(bi,Kr[2],pr,Oi.Qc,0,pi,Mn)))<<3,ci=ci<<2|(3<pr?3:1<pr?2:pi[Mn+0]!=0),Mn+=16;Ai>>=2,hn=hn>>1|Fi<<5}_i|=ci<<4*tn,mr|=Ai<<4<<tn,gn|=(240&hn)<<tn}Jr.la=mr,Rn.la=gn,ls.Hc=mn,ls.Gc=_i,ls.ia=43690&_i?0:Oi.ia,Kr=!(mn|_i)}if(0<fr.L&&(fr.wa[fr.Y+fr.ja]=fr.gd[ii.$b][ii.Za],fr.wa[fr.Y+fr.ja].La|=!Kr),en.Ka)return ri(hi,7,"Premature end-of-file encountered.")}if($l(hi),fr=un,en=1,ii=(Ir=hi).D,Jr=0<Ir.L&&Ir.M>=Ir.zb&&Ir.M<=Ir.Va,Ir.Aa==0)t:{if(ii.M=Ir.M,ii.uc=Jr,ps(Ir,ii),en=1,ii=(ci=Ir.D).Nb,Jr=(_i=_a[Ir.L])*Ir.R,bi=_i/2*Ir.B,Pi=16*ii*Ir.R,Bn=8*ii*Ir.B,Kr=Ir.sa,ls=Ir.ta-Jr+Pi,Oi=Ir.qa,pi=Ir.ra-bi+Bn,Mn=Ir.Ha,Rn=Ir.Ia-bi+Bn,hn=(Ai=ci.M)==0,mn=Ai>=Ir.Va-1,Ir.Aa==2&&ps(Ir,ci),ci.uc)for(Fi=(pr=Ir).D.M,l(pr.D.uc),ci=pr.yb;ci<pr.Hb;++ci){gn=ci,mr=Fi;var ji=(cs=(Tn=pr).D).Nb;tn=Tn.R;var cs=cs.wa[cs.Y+gn],ys=Tn.sa,vs=Tn.ta+16*ji*tn+16*gn,Ds=cs.dd,Ii=cs.tc;if(Ii!=0)if(l(3<=Ii),Tn.L==1)0<gn&&Zo(ys,vs,tn,Ii+4),cs.La&&Yc(ys,vs,tn,Ii),0<mr&&wl(ys,vs,tn,Ii+4),cs.La&&ks(ys,vs,tn,Ii);else{var fi=Tn.B,xi=Tn.qa,Fs=Tn.ra+8*ji*fi+8*gn,zs=Tn.Ha,Tn=Tn.Ia+8*ji*fi+8*gn;ji=cs.ld,0<gn&&(Cn(ys,vs,tn,Ii+4,Ds,ji),wo(xi,Fs,zs,Tn,fi,Ii+4,Ds,ji)),cs.La&&($o(ys,vs,tn,Ii,Ds,ji),So(xi,Fs,zs,Tn,fi,Ii,Ds,ji)),0<mr&&(cn(ys,vs,tn,Ii+4,Ds,ji),ai(xi,Fs,zs,Tn,fi,Ii+4,Ds,ji)),cs.La&&(Ka(ys,vs,tn,Ii,Ds,ji),Sc(xi,Fs,zs,Tn,fi,Ii,Ds,ji))}}if(Ir.ia&&alert("todo:DitherRow"),fr.put!=null){if(ci=16*Ai,Ai=16*(Ai+1),hn?(fr.y=Ir.sa,fr.O=Ir.ta+Pi,fr.f=Ir.qa,fr.N=Ir.ra+Bn,fr.ea=Ir.Ha,fr.W=Ir.Ia+Bn):(ci-=_i,fr.y=Kr,fr.O=ls,fr.f=Oi,fr.N=pi,fr.ea=Mn,fr.W=Rn),mn||(Ai-=_i),Ai>fr.o&&(Ai=fr.o),fr.F=null,fr.J=null,Ir.Fa!=null&&0<Ir.Fa.length&&ci<Ai&&(fr.J=Ei(Ir,fr,ci,Ai-ci),fr.F=Ir.mb,fr.F==null&&fr.F.length==0)){en=ri(Ir,3,"Could not decode alpha data.");break t}ci<fr.j&&(_i=fr.j-ci,ci=fr.j,l(!(1&_i)),fr.O+=Ir.R*_i,fr.N+=Ir.B*(_i>>1),fr.W+=Ir.B*(_i>>1),fr.F!=null&&(fr.J+=fr.width*_i)),ci<Ai&&(fr.O+=fr.v,fr.N+=fr.v>>1,fr.W+=fr.v>>1,fr.F!=null&&(fr.J+=fr.v),fr.ka=ci-fr.j,fr.U=fr.va-fr.v,fr.T=Ai-ci,en=fr.put(fr))}ii+1!=Ir.Ic||mn||(g(Ir.sa,Ir.ta-Jr,Kr,ls+16*Ir.R,Jr),g(Ir.qa,Ir.ra-bi,Oi,pi+8*Ir.B,bi),g(Ir.Ha,Ir.Ia-bi,Mn,Rn+8*Ir.B,bi))}if(!en)return ri(hi,6,"Output aborted.")}return 1})(ke,Ve)),Ve.bc!=null&&Ve.bc(Ve),_t&=1}return _t?(ke.cb=0,_t):0})(T,Z)||(C=T.a)}}else C=T.a}C==0&&me.Oa!=null&&me.Oa.fd&&(C=vl(me.ba))}me=C}ue=me!=0?null:11>ue?ve.f.RGBA.eb:ve.f.kb.y}else ue=null;return ue};var Qs=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function F(Pe,rt){for(var _e="",we=0;we<4;we++)_e+=String.fromCharCode(Pe[rt++]);return _e}function B(Pe,rt){return Pe[rt+0]|Pe[rt+1]<<8}function Q(Pe,rt){return(Pe[rt+0]|Pe[rt+1]<<8|Pe[rt+2]<<16)>>>0}function ne(Pe,rt){return(Pe[rt+0]|Pe[rt+1]<<8|Pe[rt+2]<<16|Pe[rt+3]<<24)>>>0}new E;var j=[0],Ie=[0],he=[],re=new E,ye=p,Je=(function(Pe,rt){var _e={},we=0,Ge=!1,Ye=0,xt=0;if(_e.frames=[],!(function(fe,Fe){for(var We=0;We<4;We++)if(fe[Fe+We]!="RIFF".charCodeAt(We))return!0;return!1})(Pe,rt)){for(ne(Pe,rt+=4),rt+=8;rt<Pe.length;){var kt=F(Pe,rt),yt=ne(Pe,rt+=4);rt+=4;var mt=yt+(1&yt);switch(kt){case"VP8 ":case"VP8L":_e.frames[we]===void 0&&(_e.frames[we]={}),(Vt=_e.frames[we]).src_off=Ge?xt:rt-8,Vt.src_size=Ye+yt+8,we++,Ge&&(Ge=!1,Ye=0,xt=0);break;case"VP8X":(Vt=_e.header={}).feature_flags=Pe[rt];var gt=rt+4;Vt.canvas_width=1+Q(Pe,gt),gt+=3,Vt.canvas_height=1+Q(Pe,gt),gt+=3;break;case"ALPH":Ge=!0,Ye=mt+8,xt=rt-8;break;case"ANIM":(Vt=_e.header).bgcolor=ne(Pe,rt),gt=rt+4,Vt.loop_count=B(Pe,gt),gt+=2;break;case"ANMF":var Qt,Vt;(Vt=_e.frames[we]={}).offset_x=2*Q(Pe,rt),rt+=3,Vt.offset_y=2*Q(Pe,rt),rt+=3,Vt.width=1+Q(Pe,rt),rt+=3,Vt.height=1+Q(Pe,rt),rt+=3,Vt.duration=Q(Pe,rt),rt+=3,Qt=Pe[rt++],Vt.dispose=1&Qt,Vt.blend=Qt>>1&1}kt!="ANMF"&&(rt+=mt)}return _e}})(ye,0);Je.response=ye,Je.rgbaoutput=!0,Je.dataurl=!1;var Be=Je.header?Je.header:null,De=Je.frames?Je.frames:null;if(Be){Be.loop_counter=Be.loop_count,j=[Be.canvas_height],Ie=[Be.canvas_width];for(var Ue=0;Ue<De.length&&De[Ue].blend!=0;Ue++);}var $e=De[0],st=re.WebPDecodeRGBA(ye,$e.src_off,$e.src_size,Ie,j);$e.rgba=st,$e.imgwidth=Ie[0],$e.imgheight=j[0];for(var Ze=0;Ze<Ie[0]*j[0]*4;Ze++)he[Ze]=st[Ze];return this.width=Ie,this.height=j,this.data=he,this}(function(p){var l,u,g,v,x,b,s,E,F,B=function(fe){return fe=fe||{},this.isStrokeTransparent=fe.isStrokeTransparent||!1,this.strokeOpacity=fe.strokeOpacity||1,this.strokeStyle=fe.strokeStyle||"#000000",this.fillStyle=fe.fillStyle||"#000000",this.isFillTransparent=fe.isFillTransparent||!1,this.fillOpacity=fe.fillOpacity||1,this.font=fe.font||"10px sans-serif",this.textBaseline=fe.textBaseline||"alphabetic",this.textAlign=fe.textAlign||"left",this.lineWidth=fe.lineWidth||1,this.lineJoin=fe.lineJoin||"miter",this.lineCap=fe.lineCap||"butt",this.path=fe.path||[],this.transform=fe.transform!==void 0?fe.transform.clone():new E,this.globalCompositeOperation=fe.globalCompositeOperation||"normal",this.globalAlpha=fe.globalAlpha||1,this.clip_path=fe.clip_path||[],this.currentPoint=fe.currentPoint||new b,this.miterLimit=fe.miterLimit||10,this.lastPoint=fe.lastPoint||new b,this.lineDashOffset=fe.lineDashOffset||0,this.lineDash=fe.lineDash||[],this.margin=fe.margin||[0,0,0,0],this.prevPageLastElemOffset=fe.prevPageLastElemOffset||0,this.ignoreClearRect=typeof fe.ignoreClearRect!="boolean"||fe.ignoreClearRect,this};p.events.push(["initialized",function(){this.context2d=new Q(this),l=this.internal.f2,u=this.internal.getCoordinateString,g=this.internal.getVerticalCoordinateString,v=this.internal.getHorizontalCoordinate,x=this.internal.getVerticalCoordinate,b=this.internal.Point,s=this.internal.Rectangle,E=this.internal.Matrix,F=new B}]);var Q=function(fe){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Fe=fe;Object.defineProperty(this,"pdf",{get:function(){return Fe}});var We=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return We},set:function(Le){We=!!Le}});var tt=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return tt},set:function(Le){tt=!!Le}});var nt=0;Object.defineProperty(this,"posX",{get:function(){return nt},set:function(Le){isNaN(Le)||(nt=Le)}});var ut=0;Object.defineProperty(this,"posY",{get:function(){return ut},set:function(Le){isNaN(Le)||(ut=Le)}}),Object.defineProperty(this,"margin",{get:function(){return F.margin},set:function(Le){var lr;typeof Le=="number"?lr=[Le,Le,Le,Le]:((lr=new Array(4))[0]=Le[0],lr[1]=Le.length>=2?Le[1]:lr[0],lr[2]=Le.length>=3?Le[2]:lr[0],lr[3]=Le.length>=4?Le[3]:lr[1]),F.margin=lr}});var ft=!1;Object.defineProperty(this,"autoPaging",{get:function(){return ft},set:function(Le){ft=Le}});var It=0;Object.defineProperty(this,"lastBreak",{get:function(){return It},set:function(Le){It=Le}});var zt=[];Object.defineProperty(this,"pageBreaks",{get:function(){return zt},set:function(Le){zt=Le}}),Object.defineProperty(this,"ctx",{get:function(){return F},set:function(Le){Le instanceof B&&(F=Le)}}),Object.defineProperty(this,"path",{get:function(){return F.path},set:function(Le){F.path=Le}});var Zt=[];Object.defineProperty(this,"ctxStack",{get:function(){return Zt},set:function(Le){Zt=Le}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(Le){var lr;lr=ne(Le),this.ctx.fillStyle=lr.style,this.ctx.isFillTransparent=lr.a===0,this.ctx.fillOpacity=lr.a,this.pdf.setFillColor(lr.r,lr.g,lr.b,{a:lr.a}),this.pdf.setTextColor(lr.r,lr.g,lr.b,{a:lr.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(Le){var lr=ne(Le);this.ctx.strokeStyle=lr.style,this.ctx.isStrokeTransparent=lr.a===0,this.ctx.strokeOpacity=lr.a,lr.a===0?this.pdf.setDrawColor(255,255,255):(lr.a,this.pdf.setDrawColor(lr.r,lr.g,lr.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(Le){["butt","round","square"].indexOf(Le)!==-1&&(this.ctx.lineCap=Le,this.pdf.setLineCap(Le))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(Le){isNaN(Le)||(this.ctx.lineWidth=Le,this.pdf.setLineWidth(Le))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(Le){["bevel","round","miter"].indexOf(Le)!==-1&&(this.ctx.lineJoin=Le,this.pdf.setLineJoin(Le))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(Le){isNaN(Le)||(this.ctx.miterLimit=Le,this.pdf.setMiterLimit(Le))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(Le){this.ctx.textBaseline=Le}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(Le){["right","end","center","left","start"].indexOf(Le)!==-1&&(this.ctx.textAlign=Le)}});var sr=null,ur=null,_r=null;Object.defineProperty(this,"fontFaces",{get:function(){return _r},set:function(Le){sr=null,ur=null,_r=Le}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(Le){var lr;if(this.ctx.font=Le,(lr=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z0-9]+?)\s*$/i.exec(Le))!==null){var br=lr[1];lr[2];var Tr=lr[3],Yt=lr[4];lr[5];var zr=lr[6],yr=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Yt)[2];Yt=Math.floor(yr==="px"?parseFloat(Yt)*this.pdf.internal.scaleFactor:yr==="em"?parseFloat(Yt)*this.pdf.getFontSize():parseFloat(Yt)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Yt);var Lr=(function(W){var te,se,Ce=[],Oe=W.trim();if(Oe==="")return Ey;if(Oe in Sy)return[Sy[Oe]];for(;Oe!=="";){switch(se=null,te=(Oe=Py(Oe)).charAt(0)){case'"':case"'":se=Vw(Oe.substring(1),te);break;default:se=Uw(Oe)}if(se===null||(Ce.push(se[0]),(Oe=Py(se[1]))!==""&&Oe.charAt(0)!==","))return Ey;Oe=Oe.replace(/^,/,"")}return Ce})(zr);if(this.fontFaces){var Cr=(function(W,te){var se=W.getFontList(),Ce=JSON.stringify(se);if(sr===null||ur!==Ce){var Oe=(function(ht){var Y=[];return Object.keys(ht).forEach(function(P){ht[P].forEach(function(k){var ee=null;switch(k){case"bold":ee={family:P,weight:"bold"};break;case"italic":ee={family:P,style:"italic"};break;case"bolditalic":ee={family:P,weight:"bold",style:"italic"};break;case"":case"normal":ee={family:P}}ee!==null&&(ee.ref={name:P,style:k},Y.push(ee))})}),Y})(se);sr=(function(ht){for(var Y={},P=0;P<ht.length;++P){var k=Ap(ht[P]),ee=k.family,le=k.stretch,ge=k.style,ie=k.weight;Y[ee]=Y[ee]||{},Y[ee][le]=Y[ee][le]||{},Y[ee][le][ge]=Y[ee][le][ge]||{},Y[ee][le][ge][ie]=k}return Y})(Oe.concat(te)),ur=Ce}return sr})(this.pdf,this.fontFaces),li=Lr.map(function(W){return{family:W,stretch:"normal",weight:Tr,style:br}}),Gr=(function(W,te,se){for(var Ce=(se=se||{}).defaultFontFamily||"times",Oe=Object.assign({},jw,se.genericFontFamilies||{}),ht=null,Y=null,P=0;P<te.length;++P)if(Oe[(ht=Ap(te[P])).family]&&(ht.family=Oe[ht.family]),W.hasOwnProperty(ht.family)){Y=W[ht.family];break}if(!(Y=Y||W[Ce]))throw new Error("Could not find a font-family for the rule '"+Ty(ht)+"' and default family '"+Ce+"'.");if(Y=(function(k,ee){if(ee[k])return ee[k];var le=Up[k],ge=le<=Up.normal?-1:1,ie=wy(ee,R0,le,ge);if(!ie)throw new Error("Could not find a matching font-stretch value for "+k);return ie})(ht.stretch,Y),Y=(function(k,ee){if(ee[k])return ee[k];for(var le=N0[k],ge=0;ge<le.length;++ge)if(ee[le[ge]])return ee[le[ge]];throw new Error("Could not find a matching font-style for "+k)})(ht.style,Y),!(Y=(function(k,ee){if(ee[k])return ee[k];if(k===400&&ee[500])return ee[500];if(k===500&&ee[400])return ee[400];var le=Ow[k],ge=wy(ee,B0,le,k<400?-1:1);if(!ge)throw new Error("Could not find a matching font-weight for value "+k);return ge})(ht.weight,Y)))throw new Error("Failed to resolve a font for the rule '"+Ty(ht)+"'.");return Y})(Cr,li);this.pdf.setFont(Gr.ref.name,Gr.ref.style)}else{var Vr="";(Tr==="bold"||parseInt(Tr,10)>=700||br==="bold")&&(Vr="bold"),br==="italic"&&(Vr+="italic"),Vr.length===0&&(Vr="normal");for(var ni="",ei={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},xr=0;xr<Lr.length;xr++){if(this.pdf.internal.getFont(Lr[xr],Vr,{noFallback:!0,disableWarning:!0})!==void 0){ni=Lr[xr];break}if(Vr==="bolditalic"&&this.pdf.internal.getFont(Lr[xr],"bold",{noFallback:!0,disableWarning:!0})!==void 0)ni=Lr[xr],Vr="bold";else if(this.pdf.internal.getFont(Lr[xr],"normal",{noFallback:!0,disableWarning:!0})!==void 0){ni=Lr[xr],Vr="normal";break}}if(ni===""){for(var Qe=0;Qe<Lr.length;Qe++)if(ei[Lr[Qe]]){ni=ei[Lr[Qe]];break}}ni=ni===""?"Times":ni,this.pdf.setFont(ni,Vr)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(Le){this.ctx.globalCompositeOperation=Le}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(Le){this.ctx.globalAlpha=Le}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(Le){this.ctx.lineDashOffset=Le,Vt.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(Le){this.ctx.lineDash=Le,Vt.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(Le){this.ctx.ignoreClearRect=!!Le}})};Q.prototype.setLineDash=function(fe){this.lineDash=fe},Q.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},Q.prototype.fill=function(){De.call(this,"fill",!1)},Q.prototype.stroke=function(){De.call(this,"stroke",!1)},Q.prototype.beginPath=function(){this.path=[{type:"begin"}]},Q.prototype.moveTo=function(fe,Fe){if(isNaN(fe)||isNaN(Fe))throw on.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var We=this.ctx.transform.applyToPoint(new b(fe,Fe));this.path.push({type:"mt",x:We.x,y:We.y}),this.ctx.lastPoint=new b(fe,Fe)},Q.prototype.closePath=function(){var fe=new b(0,0),Fe=0;for(Fe=this.path.length-1;Fe!==-1;Fe--)if(this.path[Fe].type==="begin"&&Wi(this.path[Fe+1])==="object"&&typeof this.path[Fe+1].x=="number"){fe=new b(this.path[Fe+1].x,this.path[Fe+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new b(fe.x,fe.y)},Q.prototype.lineTo=function(fe,Fe){if(isNaN(fe)||isNaN(Fe))throw on.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var We=this.ctx.transform.applyToPoint(new b(fe,Fe));this.path.push({type:"lt",x:We.x,y:We.y}),this.ctx.lastPoint=new b(We.x,We.y)},Q.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),De.call(this,null,!0)},Q.prototype.quadraticCurveTo=function(fe,Fe,We,tt){if(isNaN(We)||isNaN(tt)||isNaN(fe)||isNaN(Fe))throw on.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var nt=this.ctx.transform.applyToPoint(new b(We,tt)),ut=this.ctx.transform.applyToPoint(new b(fe,Fe));this.path.push({type:"qct",x1:ut.x,y1:ut.y,x:nt.x,y:nt.y}),this.ctx.lastPoint=new b(nt.x,nt.y)},Q.prototype.bezierCurveTo=function(fe,Fe,We,tt,nt,ut){if(isNaN(nt)||isNaN(ut)||isNaN(fe)||isNaN(Fe)||isNaN(We)||isNaN(tt))throw on.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var ft=this.ctx.transform.applyToPoint(new b(nt,ut)),It=this.ctx.transform.applyToPoint(new b(fe,Fe)),zt=this.ctx.transform.applyToPoint(new b(We,tt));this.path.push({type:"bct",x1:It.x,y1:It.y,x2:zt.x,y2:zt.y,x:ft.x,y:ft.y}),this.ctx.lastPoint=new b(ft.x,ft.y)},Q.prototype.arc=function(fe,Fe,We,tt,nt,ut){if(isNaN(fe)||isNaN(Fe)||isNaN(We)||isNaN(tt)||isNaN(nt))throw on.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(ut=!!ut,!this.ctx.transform.isIdentity){var ft=this.ctx.transform.applyToPoint(new b(fe,Fe));fe=ft.x,Fe=ft.y;var It=this.ctx.transform.applyToPoint(new b(0,We)),zt=this.ctx.transform.applyToPoint(new b(0,0));We=Math.sqrt(Math.pow(It.x-zt.x,2)+Math.pow(It.y-zt.y,2))}Math.abs(nt-tt)>=2*Math.PI&&(tt=0,nt=2*Math.PI),this.path.push({type:"arc",x:fe,y:Fe,radius:We,startAngle:tt,endAngle:nt,counterclockwise:ut})},Q.prototype.arcTo=function(fe,Fe,We,tt,nt){throw new Error("arcTo not implemented.")},Q.prototype.rect=function(fe,Fe,We,tt){if(isNaN(fe)||isNaN(Fe)||isNaN(We)||isNaN(tt))throw on.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(fe,Fe),this.lineTo(fe+We,Fe),this.lineTo(fe+We,Fe+tt),this.lineTo(fe,Fe+tt),this.lineTo(fe,Fe),this.lineTo(fe+We,Fe),this.lineTo(fe,Fe)},Q.prototype.fillRect=function(fe,Fe,We,tt){if(isNaN(fe)||isNaN(Fe)||isNaN(We)||isNaN(tt))throw on.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!j.call(this)){var nt={};this.lineCap!=="butt"&&(nt.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(nt.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(fe,Fe,We,tt),this.fill(),nt.hasOwnProperty("lineCap")&&(this.lineCap=nt.lineCap),nt.hasOwnProperty("lineJoin")&&(this.lineJoin=nt.lineJoin)}},Q.prototype.strokeRect=function(fe,Fe,We,tt){if(isNaN(fe)||isNaN(Fe)||isNaN(We)||isNaN(tt))throw on.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");Ie.call(this)||(this.beginPath(),this.rect(fe,Fe,We,tt),this.stroke())},Q.prototype.clearRect=function(fe,Fe,We,tt){if(isNaN(fe)||isNaN(Fe)||isNaN(We)||isNaN(tt))throw on.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(fe,Fe,We,tt))},Q.prototype.save=function(fe){fe=typeof fe!="boolean"||fe;for(var Fe=this.pdf.internal.getCurrentPageInfo().pageNumber,We=0;We<this.pdf.internal.getNumberOfPages();We++)this.pdf.setPage(We+1),this.pdf.internal.out("q");if(this.pdf.setPage(Fe),fe){this.ctx.fontSize=this.pdf.internal.getFontSize();var tt=new B(this.ctx);this.ctxStack.push(this.ctx),this.ctx=tt}},Q.prototype.restore=function(fe){fe=typeof fe!="boolean"||fe;for(var Fe=this.pdf.internal.getCurrentPageInfo().pageNumber,We=0;We<this.pdf.internal.getNumberOfPages();We++)this.pdf.setPage(We+1),this.pdf.internal.out("Q");this.pdf.setPage(Fe),fe&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},Q.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var ne=function(fe){var Fe,We,tt,nt;if(fe.isCanvasGradient===!0&&(fe=fe.getColor()),!fe)return{r:0,g:0,b:0,a:0,style:fe};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(fe))Fe=0,We=0,tt=0,nt=0;else{var ut=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(fe);if(ut!==null)Fe=parseInt(ut[1]),We=parseInt(ut[2]),tt=parseInt(ut[3]),nt=1;else if((ut=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(fe))!==null)Fe=parseInt(ut[1]),We=parseInt(ut[2]),tt=parseInt(ut[3]),nt=parseFloat(ut[4]);else{if(nt=1,typeof fe=="string"&&fe.charAt(0)!=="#"){var ft=new C0(fe);fe=ft.ok?ft.toHex():"#000000"}fe.length===4?(Fe=fe.substring(1,2),Fe+=Fe,We=fe.substring(2,3),We+=We,tt=fe.substring(3,4),tt+=tt):(Fe=fe.substring(1,3),We=fe.substring(3,5),tt=fe.substring(5,7)),Fe=parseInt(Fe,16),We=parseInt(We,16),tt=parseInt(tt,16)}}return{r:Fe,g:We,b:tt,a:nt,style:fe}},j=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},Ie=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};Q.prototype.fillText=function(fe,Fe,We,tt){if(isNaN(Fe)||isNaN(We)||typeof fe!="string")throw on.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(tt=isNaN(tt)?void 0:tt,!j.call(this)){var nt=mt(this.ctx.transform.rotation),ut=this.ctx.transform.scaleX;we.call(this,{text:fe,x:Fe,y:We,scale:ut,angle:nt,align:this.textAlign,maxWidth:tt})}},Q.prototype.strokeText=function(fe,Fe,We,tt){if(isNaN(Fe)||isNaN(We)||typeof fe!="string")throw on.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!Ie.call(this)){tt=isNaN(tt)?void 0:tt;var nt=mt(this.ctx.transform.rotation),ut=this.ctx.transform.scaleX;we.call(this,{text:fe,x:Fe,y:We,scale:ut,renderingMode:"stroke",angle:nt,align:this.textAlign,maxWidth:tt})}},Q.prototype.measureText=function(fe){if(typeof fe!="string")throw on.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Fe=this.pdf,We=this.pdf.internal.scaleFactor,tt=Fe.internal.getFontSize(),nt=Fe.getStringUnitWidth(fe)*tt/Fe.internal.scaleFactor;return new function(ut){var ft=(ut=ut||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return ft}}),this}({width:nt*=Math.round(96*We/72*1e4)/1e4})},Q.prototype.scale=function(fe,Fe){if(isNaN(fe)||isNaN(Fe))throw on.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var We=new E(fe,0,0,Fe,0,0);this.ctx.transform=this.ctx.transform.multiply(We)},Q.prototype.rotate=function(fe){if(isNaN(fe))throw on.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Fe=new E(Math.cos(fe),Math.sin(fe),-Math.sin(fe),Math.cos(fe),0,0);this.ctx.transform=this.ctx.transform.multiply(Fe)},Q.prototype.translate=function(fe,Fe){if(isNaN(fe)||isNaN(Fe))throw on.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var We=new E(1,0,0,1,fe,Fe);this.ctx.transform=this.ctx.transform.multiply(We)},Q.prototype.transform=function(fe,Fe,We,tt,nt,ut){if(isNaN(fe)||isNaN(Fe)||isNaN(We)||isNaN(tt)||isNaN(nt)||isNaN(ut))throw on.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var ft=new E(fe,Fe,We,tt,nt,ut);this.ctx.transform=this.ctx.transform.multiply(ft)},Q.prototype.setTransform=function(fe,Fe,We,tt,nt,ut){fe=isNaN(fe)?1:fe,Fe=isNaN(Fe)?0:Fe,We=isNaN(We)?0:We,tt=isNaN(tt)?1:tt,nt=isNaN(nt)?0:nt,ut=isNaN(ut)?0:ut,this.ctx.transform=new E(fe,Fe,We,tt,nt,ut)};var he=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};Q.prototype.drawImage=function(fe,Fe,We,tt,nt,ut,ft,It,zt){var Zt=this.pdf.getImageProperties(fe),sr=1,ur=1,_r=1,Le=1;tt!==void 0&&It!==void 0&&(_r=It/tt,Le=zt/nt,sr=Zt.width/tt*It/tt,ur=Zt.height/nt*zt/nt),ut===void 0&&(ut=Fe,ft=We,Fe=0,We=0),tt!==void 0&&It===void 0&&(It=tt,zt=nt),tt===void 0&&It===void 0&&(It=Zt.width,zt=Zt.height);var lr=this.ctx.transform.decompose(),br=mt(lr.rotate.shx),Tr=new E,Yt=(Tr=(Tr=(Tr=Tr.multiply(lr.translate)).multiply(lr.skew)).multiply(lr.scale)).applyToRectangle(new s(ut-Fe*_r,ft-We*Le,tt*sr,nt*ur));if(this.autoPaging){for(var zr,yr=re.call(this,Yt),Lr=[],Cr=0;Cr<yr.length;Cr+=1)Lr.indexOf(yr[Cr])===-1&&Lr.push(yr[Cr]);Be(Lr);for(var li=Lr[0],Gr=Lr[Lr.length-1],Vr=li;Vr<Gr+1;Vr++){this.pdf.setPage(Vr);var ni=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],ei=Vr===1?this.posY+this.margin[0]:this.margin[0],xr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Qe=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],W=Vr===1?0:xr+(Vr-2)*Qe;if(this.ctx.clip_path.length!==0){var te=this.path;zr=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=Je(zr,this.posX+this.margin[3],-W+ei+this.ctx.prevPageLastElemOffset),Ue.call(this,"fill",!0),this.path=te}var se=JSON.parse(JSON.stringify(Yt));se=Je([se],this.posX+this.margin[3],-W+ei+this.ctx.prevPageLastElemOffset)[0];var Ce=(Vr>li||Vr<Gr)&&he.call(this);Ce&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],ni,Qe,null).clip().discardPath()),this.pdf.addImage(fe,"JPEG",se.x,se.y,se.w,se.h,null,null,br),Ce&&this.pdf.restoreGraphicsState()}}else this.pdf.addImage(fe,"JPEG",Yt.x,Yt.y,Yt.w,Yt.h,null,null,br)};var re=function(fe,Fe,We){var tt=[];Fe=Fe||this.pdf.internal.pageSize.width,We=We||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var nt=this.posY+this.ctx.prevPageLastElemOffset;switch(fe.type){default:case"mt":case"lt":tt.push(Math.floor((fe.y+nt)/We)+1);break;case"arc":tt.push(Math.floor((fe.y+nt-fe.radius)/We)+1),tt.push(Math.floor((fe.y+nt+fe.radius)/We)+1);break;case"qct":var ut=gt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,fe.x1,fe.y1,fe.x,fe.y);tt.push(Math.floor((ut.y+nt)/We)+1),tt.push(Math.floor((ut.y+ut.h+nt)/We)+1);break;case"bct":var ft=Qt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,fe.x1,fe.y1,fe.x2,fe.y2,fe.x,fe.y);tt.push(Math.floor((ft.y+nt)/We)+1),tt.push(Math.floor((ft.y+ft.h+nt)/We)+1);break;case"rect":tt.push(Math.floor((fe.y+nt)/We)+1),tt.push(Math.floor((fe.y+fe.h+nt)/We)+1)}for(var It=0;It<tt.length;It+=1)for(;this.pdf.internal.getNumberOfPages()<tt[It];)ye.call(this);return tt},ye=function(){var fe=this.fillStyle,Fe=this.strokeStyle,We=this.font,tt=this.lineCap,nt=this.lineWidth,ut=this.lineJoin;this.pdf.addPage(),this.fillStyle=fe,this.strokeStyle=Fe,this.font=We,this.lineCap=tt,this.lineWidth=nt,this.lineJoin=ut},Je=function(fe,Fe,We){for(var tt=0;tt<fe.length;tt++)switch(fe[tt].type){case"bct":fe[tt].x2+=Fe,fe[tt].y2+=We;case"qct":fe[tt].x1+=Fe,fe[tt].y1+=We;default:fe[tt].x+=Fe,fe[tt].y+=We}return fe},Be=function(fe){return fe.sort(function(Fe,We){return Fe-We})},De=function(fe,Fe){var We=this.fillStyle,tt=this.strokeStyle,nt=this.lineCap,ut=this.lineWidth,ft=Math.abs(ut*this.ctx.transform.scaleX),It=this.lineJoin;if(this.autoPaging){for(var zt,Zt,sr=JSON.parse(JSON.stringify(this.path)),ur=JSON.parse(JSON.stringify(this.path)),_r=[],Le=0;Le<ur.length;Le++)if(ur[Le].x!==void 0)for(var lr=re.call(this,ur[Le]),br=0;br<lr.length;br+=1)_r.indexOf(lr[br])===-1&&_r.push(lr[br]);for(var Tr=0;Tr<_r.length;Tr++)for(;this.pdf.internal.getNumberOfPages()<_r[Tr];)ye.call(this);Be(_r);for(var Yt=_r[0],zr=_r[_r.length-1],yr=Yt;yr<zr+1;yr++){this.pdf.setPage(yr),this.fillStyle=We,this.strokeStyle=tt,this.lineCap=nt,this.lineWidth=ft,this.lineJoin=It;var Lr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Cr=yr===1?this.posY+this.margin[0]:this.margin[0],li=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Gr=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Vr=yr===1?0:li+(yr-2)*Gr;if(this.ctx.clip_path.length!==0){var ni=this.path;zt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=Je(zt,this.posX+this.margin[3],-Vr+Cr+this.ctx.prevPageLastElemOffset),Ue.call(this,fe,!0),this.path=ni}if(Zt=JSON.parse(JSON.stringify(sr)),this.path=Je(Zt,this.posX+this.margin[3],-Vr+Cr+this.ctx.prevPageLastElemOffset),Fe===!1||yr===0){var ei=(yr>Yt||yr<zr)&&he.call(this);ei&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Lr,Gr,null).clip().discardPath()),Ue.call(this,fe,Fe),ei&&this.pdf.restoreGraphicsState()}this.lineWidth=ut}this.path=sr}else this.lineWidth=ft,Ue.call(this,fe,Fe),this.lineWidth=ut},Ue=function(fe,Fe){if((fe!=="stroke"||Fe||!Ie.call(this))&&(fe==="stroke"||Fe||!j.call(this))){for(var We,tt,nt=[],ut=this.path,ft=0;ft<ut.length;ft++){var It=ut[ft];switch(It.type){case"begin":nt.push({begin:!0});break;case"close":nt.push({close:!0});break;case"mt":nt.push({start:It,deltas:[],abs:[]});break;case"lt":var zt=nt.length;if(ut[ft-1]&&!isNaN(ut[ft-1].x)&&(We=[It.x-ut[ft-1].x,It.y-ut[ft-1].y],zt>0)){for(;zt>=0;zt--)if(nt[zt-1].close!==!0&&nt[zt-1].begin!==!0){nt[zt-1].deltas.push(We),nt[zt-1].abs.push(It);break}}break;case"bct":We=[It.x1-ut[ft-1].x,It.y1-ut[ft-1].y,It.x2-ut[ft-1].x,It.y2-ut[ft-1].y,It.x-ut[ft-1].x,It.y-ut[ft-1].y],nt[nt.length-1].deltas.push(We);break;case"qct":var Zt=ut[ft-1].x+2/3*(It.x1-ut[ft-1].x),sr=ut[ft-1].y+2/3*(It.y1-ut[ft-1].y),ur=It.x+2/3*(It.x1-It.x),_r=It.y+2/3*(It.y1-It.y),Le=It.x,lr=It.y;We=[Zt-ut[ft-1].x,sr-ut[ft-1].y,ur-ut[ft-1].x,_r-ut[ft-1].y,Le-ut[ft-1].x,lr-ut[ft-1].y],nt[nt.length-1].deltas.push(We);break;case"arc":nt.push({deltas:[],abs:[],arc:!0}),Array.isArray(nt[nt.length-1].abs)&&nt[nt.length-1].abs.push(It)}}tt=Fe?null:fe==="stroke"?"stroke":"fill";for(var br=!1,Tr=0;Tr<nt.length;Tr++)if(nt[Tr].arc)for(var Yt=nt[Tr].abs,zr=0;zr<Yt.length;zr++){var yr=Yt[zr];yr.type==="arc"?Ze.call(this,yr.x,yr.y,yr.radius,yr.startAngle,yr.endAngle,yr.counterclockwise,void 0,Fe,!br):Ge.call(this,yr.x,yr.y),br=!0}else if(nt[Tr].close===!0)this.pdf.internal.out("h"),br=!1;else if(nt[Tr].begin!==!0){var Lr=nt[Tr].start.x,Cr=nt[Tr].start.y;Ye.call(this,nt[Tr].deltas,Lr,Cr),br=!0}tt&&Pe.call(this,tt),Fe&&rt.call(this)}},$e=function(fe){var Fe=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,We=Fe*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return fe-We;case"top":return fe+Fe-We;case"hanging":return fe+Fe-2*We;case"middle":return fe+Fe/2-We;default:return fe}},st=function(fe){return fe+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};Q.prototype.createLinearGradient=function(){var fe=function(){};return fe.colorStops=[],fe.addColorStop=function(Fe,We){this.colorStops.push([Fe,We])},fe.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},fe.isCanvasGradient=!0,fe},Q.prototype.createPattern=function(){return this.createLinearGradient()},Q.prototype.createRadialGradient=function(){return this.createLinearGradient()};var Ze=function(fe,Fe,We,tt,nt,ut,ft,It,zt){for(var Zt=kt.call(this,We,tt,nt,ut),sr=0;sr<Zt.length;sr++){var ur=Zt[sr];sr===0&&(zt?_e.call(this,ur.x1+fe,ur.y1+Fe):Ge.call(this,ur.x1+fe,ur.y1+Fe)),xt.call(this,fe,Fe,ur.x2,ur.y2,ur.x3,ur.y3,ur.x4,ur.y4)}It?rt.call(this):Pe.call(this,ft)},Pe=function(fe){switch(fe){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},rt=function(){this.pdf.clip(),this.pdf.discardPath()},_e=function(fe,Fe){this.pdf.internal.out(u(fe)+" "+g(Fe)+" m")},we=function(fe){var Fe;switch(fe.align){case"right":case"end":Fe="right";break;case"center":Fe="center";break;default:Fe="left"}var We,tt,nt,ut=this.pdf.getTextDimensions(fe.text),ft=$e.call(this,fe.y),It=st.call(this,ft)-ut.h,zt=this.ctx.transform.applyToPoint(new b(fe.x,ft));if(this.autoPaging){var Zt=this.ctx.transform.decompose(),sr=new E;sr=(sr=(sr=sr.multiply(Zt.translate)).multiply(Zt.skew)).multiply(Zt.scale);for(var ur=this.ctx.transform.applyToRectangle(new s(fe.x,ft,ut.w,ut.h)),_r=sr.applyToRectangle(new s(fe.x,It,ut.w,ut.h)),Le=re.call(this,_r),lr=[],br=0;br<Le.length;br+=1)lr.indexOf(Le[br])===-1&&lr.push(Le[br]);Be(lr);for(var Tr=lr[0],Yt=lr[lr.length-1],zr=Tr;zr<Yt+1;zr++){this.pdf.setPage(zr);var yr=zr===1?this.posY+this.margin[0]:this.margin[0],Lr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Cr=this.pdf.internal.pageSize.height-this.margin[2],li=Cr-this.margin[0],Gr=this.pdf.internal.pageSize.width-this.margin[1],Vr=Gr-this.margin[3],ni=zr===1?0:Lr+(zr-2)*li;if(this.ctx.clip_path.length!==0){var ei=this.path;We=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=Je(We,this.posX+this.margin[3],-1*ni+yr),Ue.call(this,"fill",!0),this.path=ei}var xr=Je([JSON.parse(JSON.stringify(_r))],this.posX+this.margin[3],-ni+yr+this.ctx.prevPageLastElemOffset)[0];fe.scale>=.01&&(tt=this.pdf.internal.getFontSize(),this.pdf.setFontSize(tt*fe.scale),nt=this.lineWidth,this.lineWidth=nt*fe.scale);var Qe=this.autoPaging!=="text";if(Qe||xr.y+xr.h<=Cr){if(Qe||xr.y>=yr&&xr.x<=Gr){var W=Qe?fe.text:this.pdf.splitTextToSize(fe.text,fe.maxWidth||Gr-xr.x)[0],te=Je([JSON.parse(JSON.stringify(ur))],this.posX+this.margin[3],-ni+yr+this.ctx.prevPageLastElemOffset)[0],se=Qe&&(zr>Tr||zr<Yt)&&he.call(this);se&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Vr,li,null).clip().discardPath()),this.pdf.text(W,te.x,te.y,{angle:fe.angle,align:Fe,renderingMode:fe.renderingMode}),se&&this.pdf.restoreGraphicsState()}}else xr.y<Cr&&(this.ctx.prevPageLastElemOffset+=Cr-xr.y);fe.scale>=.01&&(this.pdf.setFontSize(tt),this.lineWidth=nt)}}else fe.scale>=.01&&(tt=this.pdf.internal.getFontSize(),this.pdf.setFontSize(tt*fe.scale),nt=this.lineWidth,this.lineWidth=nt*fe.scale),this.pdf.text(fe.text,zt.x+this.posX,zt.y+this.posY,{angle:fe.angle,align:Fe,renderingMode:fe.renderingMode,maxWidth:fe.maxWidth}),fe.scale>=.01&&(this.pdf.setFontSize(tt),this.lineWidth=nt)},Ge=function(fe,Fe,We,tt){We=We||0,tt=tt||0,this.pdf.internal.out(u(fe+We)+" "+g(Fe+tt)+" l")},Ye=function(fe,Fe,We){return this.pdf.lines(fe,Fe,We,null,null)},xt=function(fe,Fe,We,tt,nt,ut,ft,It){this.pdf.internal.out([l(v(We+fe)),l(x(tt+Fe)),l(v(nt+fe)),l(x(ut+Fe)),l(v(ft+fe)),l(x(It+Fe)),"c"].join(" "))},kt=function(fe,Fe,We,tt){for(var nt=2*Math.PI,ut=Math.PI/2;Fe>We;)Fe-=nt;var ft=Math.abs(We-Fe);ft<nt&&tt&&(ft=nt-ft);for(var It=[],zt=tt?-1:1,Zt=Fe;ft>1e-5;){var sr=Zt+zt*Math.min(ft,ut);It.push(yt.call(this,fe,Zt,sr)),ft-=Math.abs(sr-Zt),Zt=sr}return It},yt=function(fe,Fe,We){var tt=(We-Fe)/2,nt=fe*Math.cos(tt),ut=fe*Math.sin(tt),ft=nt,It=-ut,zt=ft*ft+It*It,Zt=zt+ft*nt+It*ut,sr=4/3*(Math.sqrt(2*zt*Zt)-Zt)/(ft*ut-It*nt),ur=ft-sr*It,_r=It+sr*ft,Le=ur,lr=-_r,br=tt+Fe,Tr=Math.cos(br),Yt=Math.sin(br);return{x1:fe*Math.cos(Fe),y1:fe*Math.sin(Fe),x2:ur*Tr-_r*Yt,y2:ur*Yt+_r*Tr,x3:Le*Tr-lr*Yt,y3:Le*Yt+lr*Tr,x4:fe*Math.cos(We),y4:fe*Math.sin(We)}},mt=function(fe){return 180*fe/Math.PI},gt=function(fe,Fe,We,tt,nt,ut){var ft=fe+.5*(We-fe),It=Fe+.5*(tt-Fe),zt=nt+.5*(We-nt),Zt=ut+.5*(tt-ut),sr=Math.min(fe,nt,ft,zt),ur=Math.max(fe,nt,ft,zt),_r=Math.min(Fe,ut,It,Zt),Le=Math.max(Fe,ut,It,Zt);return new s(sr,_r,ur-sr,Le-_r)},Qt=function(fe,Fe,We,tt,nt,ut,ft,It){var zt,Zt,sr,ur,_r,Le,lr,br,Tr,Yt,zr,yr,Lr,Cr,li=We-fe,Gr=tt-Fe,Vr=nt-We,ni=ut-tt,ei=ft-nt,xr=It-ut;for(Zt=0;Zt<41;Zt++)Tr=(lr=(sr=fe+(zt=Zt/40)*li)+zt*((_r=We+zt*Vr)-sr))+zt*(_r+zt*(nt+zt*ei-_r)-lr),Yt=(br=(ur=Fe+zt*Gr)+zt*((Le=tt+zt*ni)-ur))+zt*(Le+zt*(ut+zt*xr-Le)-br),Zt==0?(zr=Tr,yr=Yt,Lr=Tr,Cr=Yt):(zr=Math.min(zr,Tr),yr=Math.min(yr,Yt),Lr=Math.max(Lr,Tr),Cr=Math.max(Cr,Yt));return new s(Math.round(zr),Math.round(yr),Math.round(Lr-zr),Math.round(Cr-yr))},Vt=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var fe,Fe,We=(fe=this.ctx.lineDash,Fe=this.ctx.lineDashOffset,JSON.stringify({lineDash:fe,lineDashOffset:Fe}));this.prevLineDash!==We&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=We)}}})(jr.API),(function(p){var l=function(b){var s,E,F,B,Q,ne,j,Ie,he,re;for(E=[],F=0,B=(b+=s="\0\0\0\0".slice(b.length%4||4)).length;B>F;F+=4)(Q=(b.charCodeAt(F)<<24)+(b.charCodeAt(F+1)<<16)+(b.charCodeAt(F+2)<<8)+b.charCodeAt(F+3))!==0?(ne=(Q=((Q=((Q=((Q=(Q-(re=Q%85))/85)-(he=Q%85))/85)-(Ie=Q%85))/85)-(j=Q%85))/85)%85,E.push(ne+33,j+33,Ie+33,he+33,re+33)):E.push(122);return(function(ye,Je){for(var Be=Je;Be>0;Be--)ye.pop()})(E,s.length),String.fromCharCode.apply(String,E)+"~>"},u=function(b){var s,E,F,B,Q,ne=String,j="length",Ie=255,he="charCodeAt",re="slice",ye="replace";for(b[re](-2),b=b[re](0,-2)[ye](/\s/g,"")[ye]("z","!!!!!"),F=[],B=0,Q=(b+=s="uuuuu"[re](b[j]%5||5))[j];Q>B;B+=5)E=52200625*(b[he](B)-33)+614125*(b[he](B+1)-33)+7225*(b[he](B+2)-33)+85*(b[he](B+3)-33)+(b[he](B+4)-33),F.push(Ie&E>>24,Ie&E>>16,Ie&E>>8,Ie&E);return(function(Je,Be){for(var De=Be;De>0;De--)Je.pop()})(F,s[j]),ne.fromCharCode.apply(ne,F)},g=function(b){return b.split("").map(function(s){return("0"+s.charCodeAt().toString(16)).slice(-2)}).join("")+">"},v=function(b){var s=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((b=b.replace(/\s/g,"")).indexOf(">")!==-1&&(b=b.substr(0,b.indexOf(">"))),b.length%2&&(b+="0"),s.test(b)===!1)return"";for(var E="",F=0;F<b.length;F+=2)E+=String.fromCharCode("0x"+(b[F]+b[F+1]));return E},x=function(b){for(var s=new Uint8Array(b.length),E=b.length;E--;)s[E]=b.charCodeAt(E);return(s=zp(s)).reduce(function(F,B){return F+String.fromCharCode(B)},"")};p.processDataByFilters=function(b,s){var E=0,F=b||"",B=[];for(typeof(s=s||[])=="string"&&(s=[s]),E=0;E<s.length;E+=1)switch(s[E]){case"ASCII85Decode":case"/ASCII85Decode":F=u(F),B.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":F=l(F),B.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":F=v(F),B.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":F=g(F),B.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":F=x(F),B.push("/FlateDecode");break;default:throw new Error('The filter: "'+s[E]+'" is not implemented')}return{data:F,reverseChain:B.reverse().join(" ")}}})(jr.API),(function(p){p.loadFile=function(l,u,g){return(function(v,x,b){x=x!==!1,b=typeof b=="function"?b:function(){};var s=void 0;try{s=(function(E,F,B){var Q=new XMLHttpRequest,ne=0,j=function(Ie){var he=Ie.length,re=[],ye=String.fromCharCode;for(ne=0;ne<he;ne+=1)re.push(ye(255&Ie.charCodeAt(ne)));return re.join("")};if(Q.open("GET",E,!F),Q.overrideMimeType("text/plain; charset=x-user-defined"),F===!1&&(Q.onload=function(){Q.status===200?B(j(this.responseText)):B(void 0)}),Q.send(null),F&&Q.status===200)return j(Q.responseText)})(v,x,b)}catch{}return s})(l,u,g)},p.allowFsRead=void 0,p.loadImageFile=p.loadFile})(jr.API),(function(p){function l(){return(ti.html2canvas?Promise.resolve(ti.html2canvas):lp(()=>import("./html2canvas.esm-Dmi1NfiH-CJZWeQL2.js"),[])).catch(function(s){return Promise.reject(new Error("Could not load html2canvas: "+s))}).then(function(s){return s.default?s.default:s})}function u(){return(ti.DOMPurify?Promise.resolve(ti.DOMPurify):lp(()=>import("./purify.es-DHbHSKL1-BQ5ruev7.js"),[])).catch(function(s){return Promise.reject(new Error("Could not load dompurify: "+s))}).then(function(s){return s.default?s.default:s})}var g=function(s){var E=Wi(s);return E==="undefined"?"undefined":E==="string"||s instanceof String?"string":E==="number"||s instanceof Number?"number":E==="function"||s instanceof Function?"function":s&&s.constructor===Array?"array":s&&s.nodeType===1?"element":E==="object"?"object":"unknown"},v=function(s,E){var F=document.createElement(s);for(var B in E.className&&(F.className=E.className),E.innerHTML&&E.dompurify&&(F.innerHTML=E.dompurify.sanitize(E.innerHTML)),E.style)F.style[B]=E.style[B];return F},x=function s(E,F){for(var B=E.nodeType===3?document.createTextNode(E.nodeValue):E.cloneNode(!1),Q=E.firstChild;Q;Q=Q.nextSibling)F!==!0&&Q.nodeType===1&&Q.nodeName==="SCRIPT"||B.appendChild(s(Q,F));return E.nodeType===1&&(E.nodeName==="CANVAS"?(B.width=E.width,B.height=E.height,B.getContext("2d").drawImage(E,0,0)):E.nodeName!=="TEXTAREA"&&E.nodeName!=="SELECT"||(B.value=E.value),B.addEventListener("load",function(){B.scrollTop=E.scrollTop,B.scrollLeft=E.scrollLeft},!0)),B},b=function s(E){var F=Object.assign(s.convert(Promise.resolve()),JSON.parse(JSON.stringify(s.template))),B=s.convert(Promise.resolve(),F);return(B=B.setProgress(1,s,1,[s])).set(E)};(b.prototype=Object.create(Promise.prototype)).constructor=b,b.convert=function(s,E){return s.__proto__=E||b.prototype,s},b.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},b.prototype.from=function(s,E){return this.then(function(){switch(E=E||(function(F){switch(g(F)){case"string":return"string";case"element":return F.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}})(s),E){case"string":return this.then(u).then(function(F){return this.set({src:v("div",{innerHTML:s,dompurify:F})})});case"element":return this.set({src:s});case"canvas":return this.set({canvas:s});case"img":return this.set({img:s});default:return this.error("Unknown source type.")}})},b.prototype.to=function(s){switch(s){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},b.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var s={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},E=x(this.prop.src,this.opt.html2canvas.javascriptEnabled);E.tagName==="BODY"&&(s.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=v("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=v("div",{className:"html2pdf__container",style:s}),this.prop.container.appendChild(E),this.prop.container.firstChild.appendChild(v("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},b.prototype.toCanvas=function(){var s=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(s).then(l).then(function(E){var F=Object.assign({},this.opt.html2canvas);return delete F.onrendered,E(this.prop.container,F)}).then(function(E){(this.opt.html2canvas.onrendered||function(){})(E),this.prop.canvas=E,document.body.removeChild(this.prop.overlay)})},b.prototype.toContext2d=function(){var s=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(s).then(l).then(function(E){var F=this.opt.jsPDF,B=this.opt.fontFaces,Q=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,ne=Object.assign({async:!0,allowTaint:!0,scale:Q,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete ne.onrendered,F.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,F.context2d.posX=this.opt.x,F.context2d.posY=this.opt.y,F.context2d.margin=this.opt.margin,F.context2d.fontFaces=B,B)for(var j=0;j<B.length;++j){var Ie=B[j],he=Ie.src.find(function(re){return re.format==="truetype"});he&&F.addFont(he.url,Ie.ref.name,Ie.ref.style)}return ne.windowHeight=ne.windowHeight||0,ne.windowHeight=ne.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):ne.windowHeight,F.context2d.save(!0),E(this.prop.container,ne)}).then(function(E){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(E),this.prop.canvas=E,document.body.removeChild(this.prop.overlay)})},b.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var s=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=s})},b.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},b.prototype.output=function(s,E,F){return(F=F||"pdf").toLowerCase()==="img"||F.toLowerCase()==="image"?this.outputImg(s,E):this.outputPdf(s,E)},b.prototype.outputPdf=function(s,E){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(s,E)})},b.prototype.outputImg=function(s){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(s){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+s+'" is not supported.'}})},b.prototype.save=function(s){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(s?{filename:s}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},b.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},b.prototype.set=function(s){if(g(s)!=="object")return this;var E=Object.keys(s||{}).map(function(F){if(F in b.template.prop)return function(){this.prop[F]=s[F]};switch(F){case"margin":return this.setMargin.bind(this,s.margin);case"jsPDF":return function(){return this.opt.jsPDF=s.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,s.pageSize);default:return function(){this.opt[F]=s[F]}}},this);return this.then(function(){return this.thenList(E)})},b.prototype.get=function(s,E){return this.then(function(){var F=s in b.template.prop?this.prop[s]:this.opt[s];return E?E(F):F})},b.prototype.setMargin=function(s){return this.then(function(){switch(g(s)){case"number":s=[s,s,s,s];case"array":if(s.length===2&&(s=[s[0],s[1],s[0],s[1]]),s.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=s}).then(this.setPageSize)},b.prototype.setPageSize=function(s){function E(F,B){return Math.floor(F*B/72*96)}return this.then(function(){(s=s||jr.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(s.inner={width:s.width-this.opt.margin[1]-this.opt.margin[3],height:s.height-this.opt.margin[0]-this.opt.margin[2]},s.inner.px={width:E(s.inner.width,s.k),height:E(s.inner.height,s.k)},s.inner.ratio=s.inner.height/s.inner.width),this.prop.pageSize=s})},b.prototype.setProgress=function(s,E,F,B){return s!=null&&(this.progress.val=s),E!=null&&(this.progress.state=E),F!=null&&(this.progress.n=F),B!=null&&(this.progress.stack=B),this.progress.ratio=this.progress.val/this.progress.state,this},b.prototype.updateProgress=function(s,E,F,B){return this.setProgress(s?this.progress.val+s:null,E||null,F?this.progress.n+F:null,B?this.progress.stack.concat(B):null)},b.prototype.then=function(s,E){var F=this;return this.thenCore(s,E,function(B,Q){return F.updateProgress(null,null,1,[B]),Promise.prototype.then.call(this,function(ne){return F.updateProgress(null,B),ne}).then(B,Q).then(function(ne){return F.updateProgress(1),ne})})},b.prototype.thenCore=function(s,E,F){F=F||Promise.prototype.then;var B=this;s&&(s=s.bind(B)),E&&(E=E.bind(B));var Q=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?B:b.convert(Object.assign({},B),Promise.prototype),ne=F.call(Q,s,E);return b.convert(ne,B.__proto__)},b.prototype.thenExternal=function(s,E){return Promise.prototype.then.call(this,s,E)},b.prototype.thenList=function(s){var E=this;return s.forEach(function(F){E=E.thenCore(F)}),E},b.prototype.catch=function(s){s&&(s=s.bind(this));var E=Promise.prototype.catch.call(this,s);return b.convert(E,this)},b.prototype.catchExternal=function(s){return Promise.prototype.catch.call(this,s)},b.prototype.error=function(s){return this.then(function(){throw new Error(s)})},b.prototype.using=b.prototype.set,b.prototype.saveAs=b.prototype.save,b.prototype.export=b.prototype.output,b.prototype.run=b.prototype.then,jr.getPageSize=function(s,E,F){if(Wi(s)==="object"){var B=s;s=B.orientation,E=B.unit||E,F=B.format||F}E=E||"mm",F=F||"a4",s=(""+(s||"P")).toLowerCase();var Q,ne=(""+F).toLowerCase(),j={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(E){case"pt":Q=1;break;case"mm":Q=72/25.4;break;case"cm":Q=72/2.54;break;case"in":Q=72;break;case"px":Q=.75;break;case"pc":case"em":Q=12;break;case"ex":Q=6;break;default:throw"Invalid unit: "+E}var Ie,he=0,re=0;if(j.hasOwnProperty(ne))he=j[ne][1]/Q,re=j[ne][0]/Q;else try{he=F[1],re=F[0]}catch{throw new Error("Invalid format: "+F)}if(s==="p"||s==="portrait")s="p",re>he&&(Ie=re,re=he,he=Ie);else{if(s!=="l"&&s!=="landscape")throw"Invalid orientation: "+s;s="l",he>re&&(Ie=re,re=he,he=Ie)}return{width:re,height:he,unit:E,k:Q,orientation:s}},p.html=function(s,E){(E=E||{}).callback=E.callback||function(){},E.html2canvas=E.html2canvas||{},E.html2canvas.canvas=E.html2canvas.canvas||this.canvas,E.jsPDF=E.jsPDF||this,E.fontFaces=E.fontFaces?E.fontFaces.map(Ap):null;var F=new b(E);return E.worker?F:F.from(s).doCallback()}})(jr.API),jr.API.addJS=function(p){return Iy=p,this.internal.events.subscribe("postPutResources",function(){zd=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(zd+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),Ay=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+Iy+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){zd!==void 0&&Ay!==void 0&&this.internal.out("/Names <</JavaScript "+zd+" 0 R>>")}),this},(function(p){var l;p.events.push(["postPutResources",function(){var u=this,g=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var v=u.outline.render().split(/\r\n/),x=0;x<v.length;x++){var b=v[x],s=g.exec(b);if(s!=null){var E=s[1];u.internal.newObjectDeferredBegin(E,!1)}u.internal.write(b)}if(this.outline.createNamedDestinations){var F=this.internal.pages.length,B=[];for(x=0;x<F;x++){var Q=u.internal.newObject();B.push(Q);var ne=u.internal.getPageInfo(x+1);u.internal.write("<< /D["+ne.objId+" 0 R /XYZ null null null]>> endobj")}var j=u.internal.newObject();for(u.internal.write("<< /Names [ "),x=0;x<B.length;x++)u.internal.write("(page_"+(x+1)+")"+B[x]+" 0 R");u.internal.write(" ] >>","endobj"),l=u.internal.newObject(),u.internal.write("<< /Dests "+j+" 0 R"),u.internal.write(">>","endobj")}}]),p.events.push(["putCatalog",function(){var u=this;u.outline.root.children.length>0&&(u.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&u.internal.write("/Names "+l+" 0 R"))}]),p.events.push(["initialized",function(){var u=this;u.outline={createNamedDestinations:!1,root:{children:[]}},u.outline.add=function(g,v,x){var b={title:v,options:x,children:[]};return g==null&&(g=this.root),g.children.push(b),b},u.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=u,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},u.outline.genIds_r=function(g){g.id=u.internal.newObjectDeferred();for(var v=0;v<g.children.length;v++)this.genIds_r(g.children[v])},u.outline.renderRoot=function(g){this.objStart(g),this.line("/Type /Outlines"),g.children.length>0&&(this.line("/First "+this.makeRef(g.children[0])),this.line("/Last "+this.makeRef(g.children[g.children.length-1]))),this.line("/Count "+this.count_r({count:0},g)),this.objEnd()},u.outline.renderItems=function(g){for(var v=this.ctx.pdf.internal.getVerticalCoordinateString,x=0;x<g.children.length;x++){var b=g.children[x];this.objStart(b),this.line("/Title "+this.makeString(b.title)),this.line("/Parent "+this.makeRef(g)),x>0&&this.line("/Prev "+this.makeRef(g.children[x-1])),x<g.children.length-1&&this.line("/Next "+this.makeRef(g.children[x+1])),b.children.length>0&&(this.line("/First "+this.makeRef(b.children[0])),this.line("/Last "+this.makeRef(b.children[b.children.length-1])));var s=this.count=this.count_r({count:0},b);if(s>0&&this.line("/Count "+s),b.options&&b.options.pageNumber){var E=u.internal.getPageInfo(b.options.pageNumber);this.line("/Dest ["+E.objId+" 0 R /XYZ 0 "+v(0)+" 0]")}this.objEnd()}for(var F=0;F<g.children.length;F++)this.renderItems(g.children[F])},u.outline.line=function(g){this.ctx.val+=g+`\r
`},u.outline.makeRef=function(g){return g.id+" 0 R"},u.outline.makeString=function(g){return"("+u.internal.pdfEscape(g)+")"},u.outline.objStart=function(g){this.ctx.val+=`\r
`+g.id+` 0 obj\r
<<\r
`},u.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},u.outline.count_r=function(g,v){for(var x=0;x<v.children.length;x++)g.count++,this.count_r(g,v.children[x]);return g.count}}])})(jr.API),(function(p){var l=[192,193,194,195,196,197,198,199];p.processJPEG=function(u,g,v,x,b,s){var E,F=this.decode.DCT_DECODE,B=null;if(typeof u=="string"||this.__addimage__.isArrayBuffer(u)||this.__addimage__.isArrayBufferView(u)){switch(u=b||u,u=this.__addimage__.isArrayBuffer(u)?new Uint8Array(u):u,E=(function(Q){for(var ne,j=256*Q.charCodeAt(4)+Q.charCodeAt(5),Ie=Q.length,he={width:0,height:0,numcomponents:1},re=4;re<Ie;re+=2){if(re+=j,l.indexOf(Q.charCodeAt(re+1))!==-1){ne=256*Q.charCodeAt(re+5)+Q.charCodeAt(re+6),he={width:256*Q.charCodeAt(re+7)+Q.charCodeAt(re+8),height:ne,numcomponents:Q.charCodeAt(re+9)};break}j=256*Q.charCodeAt(re+2)+Q.charCodeAt(re+3)}return he})(u=this.__addimage__.isArrayBufferView(u)?this.__addimage__.arrayBufferToBinaryString(u):u),E.numcomponents){case 1:s=this.color_spaces.DEVICE_GRAY;break;case 4:s=this.color_spaces.DEVICE_CMYK;break;case 3:s=this.color_spaces.DEVICE_RGB}B={data:u,width:E.width,height:E.height,colorSpace:s,bitsPerComponent:8,filter:F,index:g,alias:v}}return B}})(jr.API),jr.API.processPNG=function(p,l,u,g){if(this.__addimage__.isArrayBuffer(p)&&(p=new Uint8Array(p)),this.__addimage__.isArrayBufferView(p)){var v,x=Pw(p,{checkCrc:!0}),b=x.width,s=x.height,E=x.channels,F=x.palette,B=x.depth;v=F&&E===1?(function(Ze){for(var Pe=Ze.width,rt=Ze.height,_e=Ze.data,we=Ze.palette,Ge=Ze.depth,Ye=!1,xt=[],kt=[],yt=void 0,mt=!1,gt=0,Qt=0;Qt<we.length;Qt++){var Vt=E_(we[Qt],4),fe=Vt[0],Fe=Vt[1],We=Vt[2],tt=Vt[3];xt.push(fe,Fe,We),tt!=null&&(tt===0?(gt++,kt.length<1&&kt.push(Qt)):tt<255&&(mt=!0))}if(mt||gt>1){Ye=!0,kt=void 0;var nt=Pe*rt;yt=new Uint8Array(nt);for(var ut=new DataView(_e.buffer),ft=0;ft<nt;ft++){var It=Ip(ut,ft,Ge),zt=E_(we[It],4)[3];yt[ft]=zt}}else gt===0&&(kt=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:Ye?8:void 0,colorBytes:_e,alphaBytes:yt,needSMask:Ye,palette:xt,mask:kt}})(x):E===2||E===4?(function(Ze){for(var Pe=Ze.data,rt=Ze.width,_e=Ze.height,we=Ze.channels,Ge=Ze.depth,Ye=we===2?"DeviceGray":"DeviceRGB",xt=we-1,kt=rt*_e,yt=xt,mt=kt*yt,gt=1*kt,Qt=Math.ceil(mt*Ge/8),Vt=Math.ceil(gt*Ge/8),fe=new Uint8Array(Qt),Fe=new Uint8Array(Vt),We=new DataView(Pe.buffer),tt=new DataView(fe.buffer),nt=new DataView(Fe.buffer),ut=!1,ft=0;ft<kt;ft++){for(var It=ft*we,zt=0;zt<yt;zt++)Ry(tt,Ip(We,It+zt,Ge),ft*yt+zt,Ge);var Zt=Ip(We,It+yt,Ge);Zt<(1<<Ge)-1&&(ut=!0),Ry(nt,Zt,1*ft,Ge)}return{colorSpace:Ye,colorsPerPixel:xt,sMaskBitsPerComponent:ut?Ge:void 0,colorBytes:fe,alphaBytes:Fe,needSMask:ut}})(x):(function(Ze){var Pe=Ze.data,rt=Ze.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:rt,colorsPerPixel:rt==="DeviceGray"?1:3,colorBytes:Pe instanceof Uint16Array?(function(_e){for(var we=_e.length,Ge=new Uint8Array(2*we),Ye=new DataView(Ge.buffer,Ge.byteOffset,Ge.byteLength),xt=0;xt<we;xt++)Ye.setUint16(2*xt,_e[xt],!1);return Ge})(Pe):Pe,needSMask:!1}})(x);var Q,ne,j,Ie=v,he=Ie.colorSpace,re=Ie.colorsPerPixel,ye=Ie.sMaskBitsPerComponent,Je=Ie.colorBytes,Be=Ie.alphaBytes,De=Ie.needSMask,Ue=Ie.palette,$e=Ie.mask,st=null;return g!==jr.API.image_compression.NONE&&typeof zp=="function"?(st=(function(Ze){var Pe;switch(Ze){case jr.API.image_compression.FAST:Pe=11;break;case jr.API.image_compression.MEDIUM:Pe=13;break;case jr.API.image_compression.SLOW:Pe=14;break;default:Pe=12}return Pe})(g),Q=this.decode.FLATE_DECODE,ne="/Predictor ".concat(st," /Colors ").concat(re," /BitsPerComponent ").concat(B," /Columns ").concat(b),p=ky(Je,Math.ceil(b*re*B/8),re,B,g),De&&(j=ky(Be,Math.ceil(b*ye/8),1,ye,g))):(Q=void 0,ne=void 0,p=Je,De&&(j=Be)),(this.__addimage__.isArrayBuffer(p)||this.__addimage__.isArrayBufferView(p))&&(p=this.__addimage__.arrayBufferToBinaryString(p)),(j&&this.__addimage__.isArrayBuffer(j)||this.__addimage__.isArrayBufferView(j))&&(j=this.__addimage__.arrayBufferToBinaryString(j)),{alias:u,data:p,index:l,filter:Q,decodeParameters:ne,transparency:$e,palette:Ue,sMask:j,predictor:st,width:b,height:s,bitsPerComponent:B,sMaskBitsPerComponent:ye,colorSpace:he}}},(function(p){p.processGIF89A=function(l,u,g,v){var x=new Zw(l),b=x.width,s=x.height,E=[];x.decodeAndBlitFrameRGBA(0,E);var F={data:E,width:b,height:s},B=new Lp(100).encode(F,100);return p.processJPEG.call(this,B,u,g,v)},p.processGIF87A=p.processGIF89A})(jr.API),ll.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var p=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(p);for(var l=0;l<p;l++){var u=this.datav.getUint8(this.pos++,!0),g=this.datav.getUint8(this.pos++,!0),v=this.datav.getUint8(this.pos++,!0),x=this.datav.getUint8(this.pos++,!0);this.palette[l]={red:v,green:g,blue:u,quad:x}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},ll.prototype.parseBGR=function(){this.pos=this.offset;try{var p="bit"+this.bitPP,l=this.width*this.height*4;this.data=new Uint8Array(l),this[p]()}catch(u){on.log("bit decode error:"+u)}},ll.prototype.bit1=function(){var p,l=Math.ceil(this.width/8),u=l%4;for(p=this.height-1;p>=0;p--){for(var g=this.bottom_up?p:this.height-1-p,v=0;v<l;v++)for(var x=this.datav.getUint8(this.pos++,!0),b=g*this.width*4+8*v*4,s=0;s<8&&8*v+s<this.width;s++){var E=this.palette[x>>7-s&1];this.data[b+4*s]=E.blue,this.data[b+4*s+1]=E.green,this.data[b+4*s+2]=E.red,this.data[b+4*s+3]=255}u!==0&&(this.pos+=4-u)}},ll.prototype.bit4=function(){for(var p=Math.ceil(this.width/2),l=p%4,u=this.height-1;u>=0;u--){for(var g=this.bottom_up?u:this.height-1-u,v=0;v<p;v++){var x=this.datav.getUint8(this.pos++,!0),b=g*this.width*4+2*v*4,s=x>>4,E=15&x,F=this.palette[s];if(this.data[b]=F.blue,this.data[b+1]=F.green,this.data[b+2]=F.red,this.data[b+3]=255,2*v+1>=this.width)break;F=this.palette[E],this.data[b+4]=F.blue,this.data[b+4+1]=F.green,this.data[b+4+2]=F.red,this.data[b+4+3]=255}l!==0&&(this.pos+=4-l)}},ll.prototype.bit8=function(){for(var p=this.width%4,l=this.height-1;l>=0;l--){for(var u=this.bottom_up?l:this.height-1-l,g=0;g<this.width;g++){var v=this.datav.getUint8(this.pos++,!0),x=u*this.width*4+4*g;if(v<this.palette.length){var b=this.palette[v];this.data[x]=b.red,this.data[x+1]=b.green,this.data[x+2]=b.blue,this.data[x+3]=255}else this.data[x]=255,this.data[x+1]=255,this.data[x+2]=255,this.data[x+3]=255}p!==0&&(this.pos+=4-p)}},ll.prototype.bit15=function(){for(var p=this.width%3,l=parseInt("11111",2),u=this.height-1;u>=0;u--){for(var g=this.bottom_up?u:this.height-1-u,v=0;v<this.width;v++){var x=this.datav.getUint16(this.pos,!0);this.pos+=2;var b=(x&l)/l*255|0,s=(x>>5&l)/l*255|0,E=(x>>10&l)/l*255|0,F=x>>15?255:0,B=g*this.width*4+4*v;this.data[B]=E,this.data[B+1]=s,this.data[B+2]=b,this.data[B+3]=F}this.pos+=p}},ll.prototype.bit16=function(){for(var p=this.width%3,l=parseInt("11111",2),u=parseInt("111111",2),g=this.height-1;g>=0;g--){for(var v=this.bottom_up?g:this.height-1-g,x=0;x<this.width;x++){var b=this.datav.getUint16(this.pos,!0);this.pos+=2;var s=(b&l)/l*255|0,E=(b>>5&u)/u*255|0,F=(b>>11)/l*255|0,B=v*this.width*4+4*x;this.data[B]=F,this.data[B+1]=E,this.data[B+2]=s,this.data[B+3]=255}this.pos+=p}},ll.prototype.bit24=function(){for(var p=this.height-1;p>=0;p--){for(var l=this.bottom_up?p:this.height-1-p,u=0;u<this.width;u++){var g=this.datav.getUint8(this.pos++,!0),v=this.datav.getUint8(this.pos++,!0),x=this.datav.getUint8(this.pos++,!0),b=l*this.width*4+4*u;this.data[b]=x,this.data[b+1]=v,this.data[b+2]=g,this.data[b+3]=255}this.pos+=this.width%4}},ll.prototype.bit32=function(){for(var p=this.height-1;p>=0;p--)for(var l=this.bottom_up?p:this.height-1-p,u=0;u<this.width;u++){var g=this.datav.getUint8(this.pos++,!0),v=this.datav.getUint8(this.pos++,!0),x=this.datav.getUint8(this.pos++,!0),b=this.datav.getUint8(this.pos++,!0),s=l*this.width*4+4*u;this.data[s]=x,this.data[s+1]=v,this.data[s+2]=g,this.data[s+3]=b}},ll.prototype.getData=function(){return this.data},(function(p){p.processBMP=function(l,u,g,v){var x=new ll(l,!1),b=x.width,s=x.height,E={data:x.getData(),width:b,height:s},F=new Lp(100).encode(E,100);return p.processJPEG.call(this,F,u,g,v)}})(jr.API),Oy.prototype.getData=function(){return this.data},(function(p){p.processWEBP=function(l,u,g,v){var x=new Oy(l),b=x.width,s=x.height,E={data:x.getData(),width:b,height:s},F=new Lp(100).encode(E,100);return p.processJPEG.call(this,F,u,g,v)}})(jr.API),jr.API.processRGBA=function(p,l,u){for(var g=p.data,v=g.length,x=new Uint8Array(v/4*3),b=new Uint8Array(v/4),s=0,E=0,F=0;F<v;F+=4){var B=g[F],Q=g[F+1],ne=g[F+2],j=g[F+3];x[s++]=B,x[s++]=Q,x[s++]=ne,b[E++]=j}var Ie=this.__addimage__.arrayBufferToBinaryString(x);return{alpha:this.__addimage__.arrayBufferToBinaryString(b),data:Ie,index:l,alias:u,colorSpace:"DeviceRGB",bitsPerComponent:8,width:p.width,height:p.height}},jr.API.setLanguage=function(p){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[p]!==void 0&&(this.internal.languageSettings.languageCode=p,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},th=jr.API,Nd=th.getCharWidthsArray=function(p,l){var u,g,v=(l=l||{}).font||this.internal.getFont(),x=l.fontSize||this.internal.getFontSize(),b=l.charSpace||this.internal.getCharSpace(),s=l.widths?l.widths:v.metadata.Unicode.widths,E=s.fof?s.fof:1,F=l.kerning?l.kerning:v.metadata.Unicode.kerning,B=F.fof?F.fof:1,Q=l.doKerning!==!1,ne=0,j=p.length,Ie=0,he=s[0]||E,re=[];for(u=0;u<j;u++)g=p.charCodeAt(u),typeof v.metadata.widthOfString=="function"?re.push((v.metadata.widthOfGlyph(v.metadata.characterToGlyph(g))+b*(1e3/x)||0)/1e3):(ne=Q&&Wi(F[g])==="object"&&!isNaN(parseInt(F[g][Ie],10))?F[g][Ie]/B:0,re.push((s[g]||he)/E+ne)),Ie=g;return re},Ly=th.getStringUnitWidth=function(p,l){var u=(l=l||{}).fontSize||this.internal.getFontSize(),g=l.font||this.internal.getFont(),v=l.charSpace||this.internal.getCharSpace();return th.processArabic&&(p=th.processArabic(p)),typeof g.metadata.widthOfString=="function"?g.metadata.widthOfString(p,u,v)/u:Nd.apply(this,arguments).reduce(function(x,b){return x+b},0)},Cy=function(p,l,u,g){for(var v=[],x=0,b=p.length,s=0;x!==b&&s+l[x]<u;)s+=l[x],x++;v.push(p.slice(0,x));var E=x;for(s=0;x!==b;)s+l[x]>g&&(v.push(p.slice(E,x)),s=0,E=x),s+=l[x],x++;return E!==x&&v.push(p.slice(E,x)),v},My=function(p,l,u){u||(u={});var g,v,x,b,s,E,F,B=[],Q=[B],ne=u.textIndent||0,j=0,Ie=0,he=p.split(" "),re=Nd.apply(this,[" ",u])[0];if(E=u.lineIndent===-1?he[0].length+2:u.lineIndent||0){var ye=Array(E).join(" "),Je=[];he.map(function(De){(De=De.split(/\s*\n/)).length>1?Je=Je.concat(De.map(function(Ue,$e){return($e&&Ue.length?`
`:"")+Ue})):Je.push(De[0])}),he=Je,E=Ly.apply(this,[ye,u])}for(x=0,b=he.length;x<b;x++){var Be=0;if(g=he[x],E&&g[0]==`
`&&(g=g.substr(1),Be=1),ne+j+(Ie=(v=Nd.apply(this,[g,u])).reduce(function(De,Ue){return De+Ue},0))>l||Be){if(Ie>l){for(s=Cy.apply(this,[g,v,l-(ne+j),l]),B.push(s.shift()),B=[s.pop()];s.length;)Q.push([s.shift()]);Ie=v.slice(g.length-(B[0]?B[0].length:0)).reduce(function(De,Ue){return De+Ue},0)}else B=[g];Q.push(B),ne=Ie+E,j=re}else B.push(g),ne+=j+Ie,j=re}return F=E?function(De,Ue){return(Ue?ye:"")+De.join(" ")}:function(De){return De.join(" ")},Q.map(F)},th.splitTextToSize=function(p,l,u){var g,v=(u=u||{}).fontSize||this.internal.getFontSize(),x=(function(B){if(B.widths&&B.kerning)return{widths:B.widths,kerning:B.kerning};var Q=this.internal.getFont(B.fontName,B.fontStyle),ne="Unicode";return Q.metadata[ne]?{widths:Q.metadata[ne].widths||{0:1},kerning:Q.metadata[ne].kerning||{}}:{font:Q.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,u);g=Array.isArray(p)?p:String(p).split(/\r?\n/);var b=1*this.internal.scaleFactor*l/v;x.textIndent=u.textIndent?1*u.textIndent*this.internal.scaleFactor/v:0,x.lineIndent=u.lineIndent;var s,E,F=[];for(s=0,E=g.length;s<E;s++)F=F.concat(My.apply(this,[g[s],b,x]));return F},(function(p){p.__fontmetrics__=p.__fontmetrics__||{};for(var l="0123456789abcdef",u="klmnopqrstuvwxyz",g={},v={},x=0;x<16;x++)g[u[x]]=l[x],v[l[x]]=u[x];var b=function(ne){return"0x"+parseInt(ne,10).toString(16)},s=p.__fontmetrics__.compress=function(ne){var j,Ie,he,re,ye=["{"];for(var Je in ne){if(j=ne[Je],isNaN(parseInt(Je,10))?Ie="'"+Je+"'":(Je=parseInt(Je,10),Ie=(Ie=b(Je).slice(2)).slice(0,-1)+v[Ie.slice(-1)]),typeof j=="number")j<0?(he=b(j).slice(3),re="-"):(he=b(j).slice(2),re=""),he=re+he.slice(0,-1)+v[he.slice(-1)];else{if(Wi(j)!=="object")throw new Error("Don't know what to do with value type "+Wi(j)+".");he=s(j)}ye.push(Ie+he)}return ye.push("}"),ye.join("")},E=p.__fontmetrics__.uncompress=function(ne){if(typeof ne!="string")throw new Error("Invalid argument passed to uncompress.");for(var j,Ie,he,re,ye={},Je=1,Be=ye,De=[],Ue="",$e="",st=ne.length-1,Ze=1;Ze<st;Ze+=1)(re=ne[Ze])=="'"?j?(he=j.join(""),j=void 0):j=[]:j?j.push(re):re=="{"?(De.push([Be,he]),Be={},he=void 0):re=="}"?((Ie=De.pop())[0][Ie[1]]=Be,he=void 0,Be=Ie[0]):re=="-"?Je=-1:he===void 0?g.hasOwnProperty(re)?(Ue+=g[re],he=parseInt(Ue,16)*Je,Je=1,Ue=""):Ue+=re:g.hasOwnProperty(re)?($e+=g[re],Be[he]=parseInt($e,16)*Je,Je=1,he=void 0,$e=""):$e+=re;return ye},F={codePages:["WinAnsiEncoding"],WinAnsiEncoding:E("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},B={Unicode:{Courier:F,"Courier-Bold":F,"Courier-BoldOblique":F,"Courier-Oblique":F,Helvetica:F,"Helvetica-Bold":F,"Helvetica-BoldOblique":F,"Helvetica-Oblique":F,"Times-Roman":F,"Times-Bold":F,"Times-BoldItalic":F,"Times-Italic":F}},Q={Unicode:{"Courier-Oblique":E("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":E("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":E("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:E("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":E("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":E("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:E("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:E("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":E("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:E("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":E("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":E("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":E("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":E("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};p.events.push(["addFont",function(ne){var j=ne.font,Ie=Q.Unicode[j.postScriptName];Ie&&(j.metadata.Unicode={},j.metadata.Unicode.widths=Ie.widths,j.metadata.Unicode.kerning=Ie.kerning);var he=B.Unicode[j.postScriptName];he&&(j.metadata.Unicode.encoding=he,j.encoding=he.codePages[0])}])})(jr.API),(function(p){var l=function(u){for(var g=u.length,v=new Uint8Array(g),x=0;x<g;x++)v[x]=u.charCodeAt(x);return v};p.API.events.push(["addFont",function(u){var g=void 0,v=u.font,x=u.instance;if(!v.isStandardFont){if(x===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+v.postScriptName+"').");if(typeof(g=x.existsFileInVFS(v.postScriptName)===!1?x.loadFile(v.postScriptName):x.getFileFromVFS(v.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+v.postScriptName+"').");(function(b,s){s=/^\x00\x01\x00\x00/.test(s)?l(s):l(jd(s)),b.metadata=p.API.TTFFont.open(s),b.metadata.Unicode=b.metadata.Unicode||{encoding:{},kerning:{},widths:[]},b.metadata.glyIdsUsed=[0]})(v,g)}}])})(jr),jr.API.addSvgAsImage=function(p,l,u,g,v,x,b,s){if(isNaN(l)||isNaN(u))throw on.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(g)||isNaN(v))throw on.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var E=document.createElement("canvas");E.width=g,E.height=v;var F=E.getContext("2d");F.fillStyle="#fff",F.fillRect(0,0,E.width,E.height);var B={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},Q=this;return(ti.canvg?Promise.resolve(ti.canvg):lp(()=>import("./index.es-B-Qk7uCx-C3qI--vl.js"),[])).catch(function(ne){return Promise.reject(new Error("Could not load canvg: "+ne))}).then(function(ne){return ne.default?ne.default:ne}).then(function(ne){return ne.fromString(F,p,B)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(ne){return ne.render(B)}).then(function(){Q.addImage(E.toDataURL("image/jpeg",1),l,u,g,v,b,s)})},jr.API.putTotalPages=function(p){var l,u=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(l=new RegExp(p,"g"),u=this.internal.getNumberOfPages()):(l=new RegExp(this.pdfEscape16(p,this.internal.getFont()),"g"),u=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var g=1;g<=this.internal.getNumberOfPages();g++)for(var v=0;v<this.internal.pages[g].length;v++)this.internal.pages[g][v]=this.internal.pages[g][v].replace(l,u);return this},jr.API.viewerPreferences=function(p,l){var u;p=p||{},l=l||!1;var g,v,x,b={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},s=Object.keys(b),E=[],F=0,B=0,Q=0;function ne(Ie,he){var re,ye=!1;for(re=0;re<Ie.length;re+=1)Ie[re]===he&&(ye=!0);return ye}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(b)),this.internal.viewerpreferences.isSubscribed=!1),u=this.internal.viewerpreferences.configuration,p==="reset"||l===!0){var j=s.length;for(Q=0;Q<j;Q+=1)u[s[Q]].value=u[s[Q]].defaultValue,u[s[Q]].explicitSet=!1}if(Wi(p)==="object"){for(v in p)if(x=p[v],ne(s,v)&&x!==void 0){if(u[v].type==="boolean"&&typeof x=="boolean")u[v].value=x;else if(u[v].type==="name"&&ne(u[v].valueSet,x))u[v].value=x;else if(u[v].type==="integer"&&Number.isInteger(x))u[v].value=x;else if(u[v].type==="array"){for(F=0;F<x.length;F+=1)if(g=!0,x[F].length===1&&typeof x[F][0]=="number")E.push(String(x[F]-1));else if(x[F].length>1){for(B=0;B<x[F].length;B+=1)typeof x[F][B]!="number"&&(g=!1);g===!0&&E.push([x[F][0]-1,x[F][1]-1].join(" "))}u[v].value="["+E.join(" ")+"]"}else u[v].value=u[v].defaultValue;u[v].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var Ie,he=[];for(Ie in u)u[Ie].explicitSet===!0&&(u[Ie].type==="name"?he.push("/"+Ie+" /"+u[Ie].value):he.push("/"+Ie+" "+u[Ie].value));he.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+he.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=u,this},(function(p){var l=function(){var g='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',v=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),x=unescape(encodeURIComponent(g)),b=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),s=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),E=unescape(encodeURIComponent("</x:xmpmeta>")),F=x.length+b.length+s.length+v.length+E.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+F+" >>"),this.internal.write("stream"),this.internal.write(v+x+b+s+E),this.internal.write("endstream"),this.internal.write("endobj")},u=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};p.addMetadata=function(g,v){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:g,namespaceuri:v||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",u),this.internal.events.subscribe("postPutResources",l)),this}})(jr.API),(function(p){var l=p.API,u=l.pdfEscape16=function(x,b){for(var s,E=b.metadata.Unicode.widths,F=["","0","00","000","0000"],B=[""],Q=0,ne=x.length;Q<ne;++Q){if(s=b.metadata.characterToGlyph(x.charCodeAt(Q)),b.metadata.glyIdsUsed.push(s),b.metadata.toUnicode[s]=x.charCodeAt(Q),E.indexOf(s)==-1&&(E.push(s),E.push([parseInt(b.metadata.widthOfGlyph(s),10)])),s=="0")return B.join("");s=s.toString(16),B.push(F[4-s.length],s)}return B.join("")},g=function(x){var b,s,E,F,B,Q,ne;for(B=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,E=[],Q=0,ne=(s=Object.keys(x).sort(function(j,Ie){return j-Ie})).length;Q<ne;Q++)b=s[Q],E.length>=100&&(B+=`
`+E.length+` beginbfchar
`+E.join(`
`)+`
endbfchar`,E=[]),x[b]!==void 0&&x[b]!==null&&typeof x[b].toString=="function"&&(F=("0000"+x[b].toString(16)).slice(-4),b=("0000"+(+b).toString(16)).slice(-4),E.push("<"+b+"><"+F+">"));return E.length&&(B+=`
`+E.length+` beginbfchar
`+E.join(`
`)+`
endbfchar
`),B+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};l.events.push(["putFont",function(x){(function(b){var s=b.font,E=b.out,F=b.newObject,B=b.putStream;if(s.metadata instanceof p.API.TTFFont&&s.encoding==="Identity-H"){for(var Q=s.metadata.Unicode.widths,ne=s.metadata.subset.encode(s.metadata.glyIdsUsed,1),j="",Ie=0;Ie<ne.length;Ie++)j+=String.fromCharCode(ne[Ie]);var he=F();B({data:j,addLength1:!0,objectId:he}),E("endobj");var re=F();B({data:g(s.metadata.toUnicode),addLength1:!0,objectId:re}),E("endobj");var ye=F();E("<<"),E("/Type /FontDescriptor"),E("/FontName /"+nh(s.fontName)),E("/FontFile2 "+he+" 0 R"),E("/FontBBox "+p.API.PDFObject.convert(s.metadata.bbox)),E("/Flags "+s.metadata.flags),E("/StemV "+s.metadata.stemV),E("/ItalicAngle "+s.metadata.italicAngle),E("/Ascent "+s.metadata.ascender),E("/Descent "+s.metadata.decender),E("/CapHeight "+s.metadata.capHeight),E(">>"),E("endobj");var Je=F();E("<<"),E("/Type /Font"),E("/BaseFont /"+nh(s.fontName)),E("/FontDescriptor "+ye+" 0 R"),E("/W "+p.API.PDFObject.convert(Q)),E("/CIDToGIDMap /Identity"),E("/DW 1000"),E("/Subtype /CIDFontType2"),E("/CIDSystemInfo"),E("<<"),E("/Supplement 0"),E("/Registry (Adobe)"),E("/Ordering ("+s.encoding+")"),E(">>"),E(">>"),E("endobj"),s.objectNumber=F(),E("<<"),E("/Type /Font"),E("/Subtype /Type0"),E("/ToUnicode "+re+" 0 R"),E("/BaseFont /"+nh(s.fontName)),E("/Encoding /"+s.encoding),E("/DescendantFonts ["+Je+" 0 R]"),E(">>"),E("endobj"),s.isAlreadyPutted=!0}})(x)}]),l.events.push(["putFont",function(x){(function(b){var s=b.font,E=b.out,F=b.newObject,B=b.putStream;if(s.metadata instanceof p.API.TTFFont&&s.encoding==="WinAnsiEncoding"){for(var Q=s.metadata.rawData,ne="",j=0;j<Q.length;j++)ne+=String.fromCharCode(Q[j]);var Ie=F();B({data:ne,addLength1:!0,objectId:Ie}),E("endobj");var he=F();B({data:g(s.metadata.toUnicode),addLength1:!0,objectId:he}),E("endobj");var re=F();E("<<"),E("/Descent "+s.metadata.decender),E("/CapHeight "+s.metadata.capHeight),E("/StemV "+s.metadata.stemV),E("/Type /FontDescriptor"),E("/FontFile2 "+Ie+" 0 R"),E("/Flags 96"),E("/FontBBox "+p.API.PDFObject.convert(s.metadata.bbox)),E("/FontName /"+nh(s.fontName)),E("/ItalicAngle "+s.metadata.italicAngle),E("/Ascent "+s.metadata.ascender),E(">>"),E("endobj"),s.objectNumber=F();for(var ye=0;ye<s.metadata.hmtx.widths.length;ye++)s.metadata.hmtx.widths[ye]=parseInt(s.metadata.hmtx.widths[ye]*(1e3/s.metadata.head.unitsPerEm));E("<</Subtype/TrueType/Type/Font/ToUnicode "+he+" 0 R/BaseFont/"+nh(s.fontName)+"/FontDescriptor "+re+" 0 R/Encoding/"+s.encoding+" /FirstChar 29 /LastChar 255 /Widths "+p.API.PDFObject.convert(s.metadata.hmtx.widths)+">>"),E("endobj"),s.isAlreadyPutted=!0}})(x)}]);var v=function(x){var b,s=x.text||"",E=x.x,F=x.y,B=x.options||{},Q=x.mutex||{},ne=Q.pdfEscape,j=Q.activeFontKey,Ie=Q.fonts,he=j,re="",ye=0,Je="",Be=Ie[he].encoding;if(Ie[he].encoding!=="Identity-H")return{text:s,x:E,y:F,options:B,mutex:Q};for(Je=s,he=j,Array.isArray(s)&&(Je=s[0]),ye=0;ye<Je.length;ye+=1)Ie[he].metadata.hasOwnProperty("cmap")&&(b=Ie[he].metadata.cmap.unicode.codeMap[Je[ye].charCodeAt(0)]),b||Je[ye].charCodeAt(0)<256&&Ie[he].metadata.hasOwnProperty("Unicode")?re+=Je[ye]:re+="";var De="";return parseInt(he.slice(1))<14||Be==="WinAnsiEncoding"?De=ne(re,he).split("").map(function(Ue){return Ue.charCodeAt(0).toString(16)}).join(""):Be==="Identity-H"&&(De=u(re,Ie[he])),Q.isHex=!0,{text:De,x:E,y:F,options:B,mutex:Q}};l.events.push(["postProcessText",function(x){var b=x.text||"",s=[],E={text:b,x:x.x,y:x.y,options:x.options,mutex:x.mutex};if(Array.isArray(b)){var F=0;for(F=0;F<b.length;F+=1)Array.isArray(b[F])&&b[F].length===3?s.push([v(Object.assign({},E,{text:b[F][0]})).text,b[F][1],b[F][2]]):s.push(v(Object.assign({},E,{text:b[F]})).text);x.text=s}else x.text=v(Object.assign({},E,{text:b})).text}])})(jr),(function(p){var l=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};p.existsFileInVFS=function(u){return l.call(this),this.internal.vFS[u]!==void 0},p.addFileToVFS=function(u,g){return l.call(this),this.internal.vFS[u]=g,this},p.getFileFromVFS=function(u){return l.call(this),this.internal.vFS[u]!==void 0?this.internal.vFS[u]:null}})(jr.API),(function(p){p.__bidiEngine__=p.prototype.__bidiEngine__=function(g){var v,x,b,s,E,F,B,Q=l,ne=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],j=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],Ie={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},he={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},re=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],ye=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),Je=!1,Be=0;this.__bidiEngine__={};var De=function(_e){var we=_e.charCodeAt(),Ge=we>>8,Ye=he[Ge];return Ye!==void 0?Q[256*Ye+(255&we)]:Ge===252||Ge===253?"AL":ye.test(Ge)?"L":Ge===8?"R":"N"},Ue=function(_e){for(var we,Ge=0;Ge<_e.length;Ge++){if((we=De(_e.charAt(Ge)))==="L")return!1;if(we==="R")return!0}return!1},$e=function(_e,we,Ge,Ye){var xt,kt,yt,mt,gt=we[Ye];switch(gt){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":Je=!1;break;case"N":case"AN":break;case"EN":Je&&(gt="AN");break;case"AL":Je=!0,gt="R";break;case"WS":case"BN":gt="N";break;case"CS":Ye<1||Ye+1>=we.length||(xt=Ge[Ye-1])!=="EN"&&xt!=="AN"||(kt=we[Ye+1])!=="EN"&&kt!=="AN"?gt="N":Je&&(kt="AN"),gt=kt===xt?kt:"N";break;case"ES":gt=(xt=Ye>0?Ge[Ye-1]:"B")==="EN"&&Ye+1<we.length&&we[Ye+1]==="EN"?"EN":"N";break;case"ET":if(Ye>0&&Ge[Ye-1]==="EN"){gt="EN";break}if(Je){gt="N";break}for(yt=Ye+1,mt=we.length;yt<mt&&we[yt]==="ET";)yt++;gt=yt<mt&&we[yt]==="EN"?"EN":"N";break;case"NSM":if(b&&!s){for(mt=we.length,yt=Ye+1;yt<mt&&we[yt]==="NSM";)yt++;if(yt<mt){var Qt=_e[Ye],Vt=Qt>=1425&&Qt<=2303||Qt===64286;if(xt=we[yt],Vt&&(xt==="R"||xt==="AL")){gt="R";break}}}gt=Ye<1||(xt=we[Ye-1])==="B"?"N":Ge[Ye-1];break;case"B":Je=!1,v=!0,gt=Be;break;case"S":x=!0,gt="N"}return gt},st=function(_e,we,Ge){var Ye=_e.split("");return Ge&&Ze(Ye,Ge,{hiLevel:Be}),Ye.reverse(),we&&we.reverse(),Ye.join("")},Ze=function(_e,we,Ge){var Ye,xt,kt,yt,mt,gt=-1,Qt=_e.length,Vt=0,fe=[],Fe=Be?j:ne,We=[];for(Je=!1,v=!1,x=!1,xt=0;xt<Qt;xt++)We[xt]=De(_e[xt]);for(kt=0;kt<Qt;kt++){if(mt=Vt,fe[kt]=$e(_e,We,fe,kt),Ye=240&(Vt=Fe[mt][Ie[fe[kt]]]),Vt&=15,we[kt]=yt=Fe[Vt][5],Ye>0)if(Ye===16){for(xt=gt;xt<kt;xt++)we[xt]=1;gt=-1}else gt=-1;if(Fe[Vt][6])gt===-1&&(gt=kt);else if(gt>-1){for(xt=gt;xt<kt;xt++)we[xt]=yt;gt=-1}We[kt]==="B"&&(we[kt]=0),Ge.hiLevel|=yt}x&&(function(tt,nt,ut){for(var ft=0;ft<ut;ft++)if(tt[ft]==="S"){nt[ft]=Be;for(var It=ft-1;It>=0&&tt[It]==="WS";It--)nt[It]=Be}})(We,we,Qt)},Pe=function(_e,we,Ge,Ye,xt){if(!(xt.hiLevel<_e)){if(_e===1&&Be===1&&!v)return we.reverse(),void(Ge&&Ge.reverse());for(var kt,yt,mt,gt,Qt=we.length,Vt=0;Vt<Qt;){if(Ye[Vt]>=_e){for(mt=Vt+1;mt<Qt&&Ye[mt]>=_e;)mt++;for(gt=Vt,yt=mt-1;gt<yt;gt++,yt--)kt=we[gt],we[gt]=we[yt],we[yt]=kt,Ge&&(kt=Ge[gt],Ge[gt]=Ge[yt],Ge[yt]=kt);Vt=mt}Vt++}}},rt=function(_e,we,Ge){var Ye=_e.split(""),xt={hiLevel:Be};return Ge||(Ge=[]),Ze(Ye,Ge,xt),(function(kt,yt,mt){if(mt.hiLevel!==0&&B)for(var gt,Qt=0;Qt<kt.length;Qt++)yt[Qt]===1&&(gt=re.indexOf(kt[Qt]))>=0&&(kt[Qt]=re[gt+1])})(Ye,Ge,xt),Pe(2,Ye,we,Ge,xt),Pe(1,Ye,we,Ge,xt),Ye.join("")};return this.__bidiEngine__.doBidiReorder=function(_e,we,Ge){if((function(xt,kt){if(kt)for(var yt=0;yt<xt.length;yt++)kt[yt]=yt;s===void 0&&(s=Ue(xt)),F===void 0&&(F=Ue(xt))})(_e,we),b||!E||F)if(b&&E&&s^F)Be=s?1:0,_e=st(_e,we,Ge);else if(!b&&E&&F)Be=s?1:0,_e=rt(_e,we,Ge),_e=st(_e,we);else if(!b||s||E||F){if(b&&!E&&s^F)_e=st(_e,we),s?(Be=0,_e=rt(_e,we,Ge)):(Be=1,_e=rt(_e,we,Ge),_e=st(_e,we));else if(b&&s&&!E&&F)Be=1,_e=rt(_e,we,Ge),_e=st(_e,we);else if(!b&&!E&&s^F){var Ye=B;s?(Be=1,_e=rt(_e,we,Ge),Be=0,B=!1,_e=rt(_e,we,Ge),B=Ye):(Be=0,_e=rt(_e,we,Ge),_e=st(_e,we),Be=1,B=!1,_e=rt(_e,we,Ge),B=Ye,_e=st(_e,we))}}else Be=0,_e=rt(_e,we,Ge);else Be=s?1:0,_e=rt(_e,we,Ge);return _e},this.__bidiEngine__.setOptions=function(_e){_e&&(b=_e.isInputVisual,E=_e.isOutputVisual,s=_e.isInputRtl,F=_e.isOutputRtl,B=_e.isSymmetricSwapping)},this.__bidiEngine__.setOptions(g),this.__bidiEngine__};var l=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],u=new p.__bidiEngine__({isInputVisual:!0});p.API.events.push(["postProcessText",function(g){var v=g.text;g.x,g.y;var x=g.options||{};g.mutex,x.lang;var b=[];if(x.isInputVisual=typeof x.isInputVisual!="boolean"||x.isInputVisual,u.setOptions(x),Object.prototype.toString.call(v)==="[object Array]"){var s=0;for(b=[],s=0;s<v.length;s+=1)Object.prototype.toString.call(v[s])==="[object Array]"?b.push([u.doBidiReorder(v[s][0]),v[s][1],v[s][2]]):b.push([u.doBidiReorder(v[s])]);g.text=b}else g.text=u.doBidiReorder(v);u.setOptions({isInputVisual:!0})}])})(jr),jr.API.TTFFont=(function(){function p(l){var u;if(this.rawData=l,u=this.contents=new Xc(l),this.contents.pos=4,u.readString(4)==="ttcf")throw new Error("TTCF not supported.");u.pos=0,this.parse(),this.subset=new o5(this),this.registerTTF()}return p.open=function(l){return new p(l)},p.prototype.parse=function(){return this.directory=new Ww(this.contents),this.head=new Xw(this),this.name=new e5(this),this.cmap=new j0(this),this.toUnicode={},this.hhea=new Yw(this),this.maxp=new t5(this),this.hmtx=new r5(this),this.post=new Kw(this),this.os2=new Jw(this),this.loca=new a5(this),this.glyf=new i5(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},p.prototype.registerTTF=function(){var l,u,g,v,x;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var b,s,E,F;for(F=[],b=0,s=(E=this.bbox).length;b<s;b++)l=E[b],F.push(Math.round(l*this.scaleFactor));return F}).call(this),this.stemV=0,this.post.exists?(g=255&(v=this.post.italic_angle),32768&(u=v>>16)&&(u=-(1+(65535^u))),this.italicAngle=+(u+"."+g)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(x=this.familyClass)===1||x===2||x===3||x===4||x===5||x===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},p.prototype.characterToGlyph=function(l){var u;return((u=this.cmap.unicode)!=null?u.codeMap[l]:void 0)||0},p.prototype.widthOfGlyph=function(l){var u;return u=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(l).advance*u},p.prototype.widthOfString=function(l,u,g){var v,x,b,s;for(b=0,x=0,s=(l=""+l).length;0<=s?x<s:x>s;x=0<=s?++x:--x)v=l.charCodeAt(x),b+=this.widthOfGlyph(this.characterToGlyph(v))+g*(1e3/u)||0;return b*(u/1e3)},p.prototype.lineHeight=function(l,u){var g;return u==null&&(u=!1),g=u?this.lineGap:0,(this.ascender+g-this.decender)/1e3*l},p})();var fl,Xc=(function(){function p(l){this.data=l??[],this.pos=0,this.length=this.data.length}return p.prototype.readByte=function(){return this.data[this.pos++]},p.prototype.writeByte=function(l){return this.data[this.pos++]=l},p.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},p.prototype.writeUInt32=function(l){return this.writeByte(l>>>24&255),this.writeByte(l>>16&255),this.writeByte(l>>8&255),this.writeByte(255&l)},p.prototype.readInt32=function(){var l;return(l=this.readUInt32())>=2147483648?l-4294967296:l},p.prototype.writeInt32=function(l){return l<0&&(l+=4294967296),this.writeUInt32(l)},p.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},p.prototype.writeUInt16=function(l){return this.writeByte(l>>8&255),this.writeByte(255&l)},p.prototype.readInt16=function(){var l;return(l=this.readUInt16())>=32768?l-65536:l},p.prototype.writeInt16=function(l){return l<0&&(l+=65536),this.writeUInt16(l)},p.prototype.readString=function(l){var u,g;for(g=[],u=0;0<=l?u<l:u>l;u=0<=l?++u:--u)g[u]=String.fromCharCode(this.readByte());return g.join("")},p.prototype.writeString=function(l){var u,g,v;for(v=[],u=0,g=l.length;0<=g?u<g:u>g;u=0<=g?++u:--u)v.push(this.writeByte(l.charCodeAt(u)));return v},p.prototype.readShort=function(){return this.readInt16()},p.prototype.writeShort=function(l){return this.writeInt16(l)},p.prototype.readLongLong=function(){var l,u,g,v,x,b,s,E;return l=this.readByte(),u=this.readByte(),g=this.readByte(),v=this.readByte(),x=this.readByte(),b=this.readByte(),s=this.readByte(),E=this.readByte(),128&l?-1*(72057594037927940*(255^l)+281474976710656*(255^u)+1099511627776*(255^g)+4294967296*(255^v)+16777216*(255^x)+65536*(255^b)+256*(255^s)+(255^E)+1):72057594037927940*l+281474976710656*u+1099511627776*g+4294967296*v+16777216*x+65536*b+256*s+E},p.prototype.writeLongLong=function(l){var u,g;return u=Math.floor(l/4294967296),g=4294967295&l,this.writeByte(u>>24&255),this.writeByte(u>>16&255),this.writeByte(u>>8&255),this.writeByte(255&u),this.writeByte(g>>24&255),this.writeByte(g>>16&255),this.writeByte(g>>8&255),this.writeByte(255&g)},p.prototype.readInt=function(){return this.readInt32()},p.prototype.writeInt=function(l){return this.writeInt32(l)},p.prototype.read=function(l){var u,g;for(u=[],g=0;0<=l?g<l:g>l;g=0<=l?++g:--g)u.push(this.readByte());return u},p.prototype.write=function(l){var u,g,v,x;for(x=[],g=0,v=l.length;g<v;g++)u=l[g],x.push(this.writeByte(u));return x},p})(),Ww=(function(){var p;function l(u){var g,v,x;for(this.scalarType=u.readInt(),this.tableCount=u.readShort(),this.searchRange=u.readShort(),this.entrySelector=u.readShort(),this.rangeShift=u.readShort(),this.tables={},v=0,x=this.tableCount;0<=x?v<x:v>x;v=0<=x?++v:--v)g={tag:u.readString(4),checksum:u.readInt(),offset:u.readInt(),length:u.readInt()},this.tables[g.tag]=g}return l.prototype.encode=function(u){var g,v,x,b,s,E,F,B,Q,ne,j,Ie,he;for(he in j=Object.keys(u).length,E=Math.log(2),Q=16*Math.floor(Math.log(j)/E),b=Math.floor(Q/E),B=16*j-Q,(v=new Xc).writeInt(this.scalarType),v.writeShort(j),v.writeShort(Q),v.writeShort(b),v.writeShort(B),x=16*j,F=v.pos+x,s=null,Ie=[],u)for(ne=u[he],v.writeString(he),v.writeInt(p(ne)),v.writeInt(F),v.writeInt(ne.length),Ie=Ie.concat(ne),he==="head"&&(s=F),F+=ne.length;F%4;)Ie.push(0),F++;return v.write(Ie),g=2981146554-p(v.data),v.pos=s+8,v.writeUInt32(g),v.data},p=function(u){var g,v,x,b;for(u=V0.call(u);u.length%4;)u.push(0);for(x=new Xc(u),v=0,g=0,b=u.length;g<b;g=g+=4)v+=x.readUInt32();return 4294967295&v},l})(),Hw={}.hasOwnProperty,ql=function(p,l){for(var u in l)Hw.call(l,u)&&(p[u]=l[u]);function g(){this.constructor=p}return g.prototype=l.prototype,p.prototype=new g,p.__super__=l.prototype,p};fl=(function(){function p(l){var u;this.file=l,u=this.file.directory.tables[this.tag],this.exists=!!u,u&&(this.offset=u.offset,this.length=u.length,this.parse(this.file.contents))}return p.prototype.parse=function(){},p.prototype.encode=function(){},p.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},p})();var Xw=(function(){function p(){return p.__super__.constructor.apply(this,arguments)}return ql(p,fl),p.prototype.tag="head",p.prototype.parse=function(l){return l.pos=this.offset,this.version=l.readInt(),this.revision=l.readInt(),this.checkSumAdjustment=l.readInt(),this.magicNumber=l.readInt(),this.flags=l.readShort(),this.unitsPerEm=l.readShort(),this.created=l.readLongLong(),this.modified=l.readLongLong(),this.xMin=l.readShort(),this.yMin=l.readShort(),this.xMax=l.readShort(),this.yMax=l.readShort(),this.macStyle=l.readShort(),this.lowestRecPPEM=l.readShort(),this.fontDirectionHint=l.readShort(),this.indexToLocFormat=l.readShort(),this.glyphDataFormat=l.readShort()},p.prototype.encode=function(l){var u;return(u=new Xc).writeInt(this.version),u.writeInt(this.revision),u.writeInt(this.checkSumAdjustment),u.writeInt(this.magicNumber),u.writeShort(this.flags),u.writeShort(this.unitsPerEm),u.writeLongLong(this.created),u.writeLongLong(this.modified),u.writeShort(this.xMin),u.writeShort(this.yMin),u.writeShort(this.xMax),u.writeShort(this.yMax),u.writeShort(this.macStyle),u.writeShort(this.lowestRecPPEM),u.writeShort(this.fontDirectionHint),u.writeShort(l),u.writeShort(this.glyphDataFormat),u.data},p})(),jy=(function(){function p(l,u){var g,v,x,b,s,E,F,B,Q,ne,j,Ie,he,re,ye,Je,Be;switch(this.platformID=l.readUInt16(),this.encodingID=l.readShort(),this.offset=u+l.readInt(),Q=l.pos,l.pos=this.offset,this.format=l.readUInt16(),this.length=l.readUInt16(),this.language=l.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(E=0;E<256;++E)this.codeMap[E]=l.readByte();break;case 4:for(j=l.readUInt16(),ne=j/2,l.pos+=6,x=(function(){var De,Ue;for(Ue=[],E=De=0;0<=ne?De<ne:De>ne;E=0<=ne?++De:--De)Ue.push(l.readUInt16());return Ue})(),l.pos+=2,he=(function(){var De,Ue;for(Ue=[],E=De=0;0<=ne?De<ne:De>ne;E=0<=ne?++De:--De)Ue.push(l.readUInt16());return Ue})(),F=(function(){var De,Ue;for(Ue=[],E=De=0;0<=ne?De<ne:De>ne;E=0<=ne?++De:--De)Ue.push(l.readUInt16());return Ue})(),B=(function(){var De,Ue;for(Ue=[],E=De=0;0<=ne?De<ne:De>ne;E=0<=ne?++De:--De)Ue.push(l.readUInt16());return Ue})(),v=(this.length-l.pos+this.offset)/2,s=(function(){var De,Ue;for(Ue=[],E=De=0;0<=v?De<v:De>v;E=0<=v?++De:--De)Ue.push(l.readUInt16());return Ue})(),E=ye=0,Be=x.length;ye<Be;E=++ye)for(re=x[E],g=Je=Ie=he[E];Ie<=re?Je<=re:Je>=re;g=Ie<=re?++Je:--Je)B[E]===0?b=g+F[E]:(b=s[B[E]/2+(g-Ie)-(ne-E)]||0)!==0&&(b+=F[E]),this.codeMap[g]=65535&b}l.pos=Q}return p.encode=function(l,u){var g,v,x,b,s,E,F,B,Q,ne,j,Ie,he,re,ye,Je,Be,De,Ue,$e,st,Ze,Pe,rt,_e,we,Ge,Ye,xt,kt,yt,mt,gt,Qt,Vt,fe,Fe,We,tt,nt,ut,ft,It,zt,Zt,sr;switch(Ye=new Xc,b=Object.keys(l).sort(function(ur,_r){return ur-_r}),u){case"macroman":for(he=0,re=(function(){var ur=[];for(Ie=0;Ie<256;++Ie)ur.push(0);return ur})(),Je={0:0},x={},xt=0,gt=b.length;xt<gt;xt++)Je[It=l[v=b[xt]]]==null&&(Je[It]=++he),x[v]={old:l[v],new:Je[l[v]]},re[v]=Je[l[v]];return Ye.writeUInt16(1),Ye.writeUInt16(0),Ye.writeUInt32(12),Ye.writeUInt16(0),Ye.writeUInt16(262),Ye.writeUInt16(0),Ye.write(re),{charMap:x,subtable:Ye.data,maxGlyphID:he+1};case"unicode":for(we=[],Q=[],Be=0,Je={},g={},ye=F=null,kt=0,Qt=b.length;kt<Qt;kt++)Je[Ue=l[v=b[kt]]]==null&&(Je[Ue]=++Be),g[v]={old:Ue,new:Je[Ue]},s=Je[Ue]-v,ye!=null&&s===F||(ye&&Q.push(ye),we.push(v),F=s),ye=v;for(ye&&Q.push(ye),Q.push(65535),we.push(65535),rt=2*(Pe=we.length),Ze=2*Math.pow(Math.log(Pe)/Math.LN2,2),ne=Math.log(Ze/2)/Math.LN2,st=2*Pe-Ze,E=[],$e=[],j=[],Ie=yt=0,Vt=we.length;yt<Vt;Ie=++yt){if(_e=we[Ie],B=Q[Ie],_e===65535){E.push(0),$e.push(0);break}if(_e-(Ge=g[_e].new)>=32768)for(E.push(0),$e.push(2*(j.length+Pe-Ie)),v=mt=_e;_e<=B?mt<=B:mt>=B;v=_e<=B?++mt:--mt)j.push(g[v].new);else E.push(Ge-_e),$e.push(0)}for(Ye.writeUInt16(3),Ye.writeUInt16(1),Ye.writeUInt32(12),Ye.writeUInt16(4),Ye.writeUInt16(16+8*Pe+2*j.length),Ye.writeUInt16(0),Ye.writeUInt16(rt),Ye.writeUInt16(Ze),Ye.writeUInt16(ne),Ye.writeUInt16(st),ut=0,fe=Q.length;ut<fe;ut++)v=Q[ut],Ye.writeUInt16(v);for(Ye.writeUInt16(0),ft=0,Fe=we.length;ft<Fe;ft++)v=we[ft],Ye.writeUInt16(v);for(zt=0,We=E.length;zt<We;zt++)s=E[zt],Ye.writeUInt16(s);for(Zt=0,tt=$e.length;Zt<tt;Zt++)De=$e[Zt],Ye.writeUInt16(De);for(sr=0,nt=j.length;sr<nt;sr++)he=j[sr],Ye.writeUInt16(he);return{charMap:g,subtable:Ye.data,maxGlyphID:Be+1}}},p})(),j0=(function(){function p(){return p.__super__.constructor.apply(this,arguments)}return ql(p,fl),p.prototype.tag="cmap",p.prototype.parse=function(l){var u,g,v;for(l.pos=this.offset,this.version=l.readUInt16(),v=l.readUInt16(),this.tables=[],this.unicode=null,g=0;0<=v?g<v:g>v;g=0<=v?++g:--g)u=new jy(l,this.offset),this.tables.push(u),u.isUnicode&&this.unicode==null&&(this.unicode=u);return!0},p.encode=function(l,u){var g,v;return u==null&&(u="macroman"),g=jy.encode(l,u),(v=new Xc).writeUInt16(0),v.writeUInt16(1),g.table=v.data.concat(g.subtable),g},p})(),Yw=(function(){function p(){return p.__super__.constructor.apply(this,arguments)}return ql(p,fl),p.prototype.tag="hhea",p.prototype.parse=function(l){return l.pos=this.offset,this.version=l.readInt(),this.ascender=l.readShort(),this.decender=l.readShort(),this.lineGap=l.readShort(),this.advanceWidthMax=l.readShort(),this.minLeftSideBearing=l.readShort(),this.minRightSideBearing=l.readShort(),this.xMaxExtent=l.readShort(),this.caretSlopeRise=l.readShort(),this.caretSlopeRun=l.readShort(),this.caretOffset=l.readShort(),l.pos+=8,this.metricDataFormat=l.readShort(),this.numberOfMetrics=l.readUInt16()},p})(),Jw=(function(){function p(){return p.__super__.constructor.apply(this,arguments)}return ql(p,fl),p.prototype.tag="OS/2",p.prototype.parse=function(l){if(l.pos=this.offset,this.version=l.readUInt16(),this.averageCharWidth=l.readShort(),this.weightClass=l.readUInt16(),this.widthClass=l.readUInt16(),this.type=l.readShort(),this.ySubscriptXSize=l.readShort(),this.ySubscriptYSize=l.readShort(),this.ySubscriptXOffset=l.readShort(),this.ySubscriptYOffset=l.readShort(),this.ySuperscriptXSize=l.readShort(),this.ySuperscriptYSize=l.readShort(),this.ySuperscriptXOffset=l.readShort(),this.ySuperscriptYOffset=l.readShort(),this.yStrikeoutSize=l.readShort(),this.yStrikeoutPosition=l.readShort(),this.familyClass=l.readShort(),this.panose=(function(){var u,g;for(g=[],u=0;u<10;++u)g.push(l.readByte());return g})(),this.charRange=(function(){var u,g;for(g=[],u=0;u<4;++u)g.push(l.readInt());return g})(),this.vendorID=l.readString(4),this.selection=l.readShort(),this.firstCharIndex=l.readShort(),this.lastCharIndex=l.readShort(),this.version>0&&(this.ascent=l.readShort(),this.descent=l.readShort(),this.lineGap=l.readShort(),this.winAscent=l.readShort(),this.winDescent=l.readShort(),this.codePageRange=(function(){var u,g;for(g=[],u=0;u<2;u=++u)g.push(l.readInt());return g})(),this.version>1))return this.xHeight=l.readShort(),this.capHeight=l.readShort(),this.defaultChar=l.readShort(),this.breakChar=l.readShort(),this.maxContext=l.readShort()},p})(),Kw=(function(){function p(){return p.__super__.constructor.apply(this,arguments)}return ql(p,fl),p.prototype.tag="post",p.prototype.parse=function(l){var u,g,v;switch(l.pos=this.offset,this.format=l.readInt(),this.italicAngle=l.readInt(),this.underlinePosition=l.readShort(),this.underlineThickness=l.readShort(),this.isFixedPitch=l.readInt(),this.minMemType42=l.readInt(),this.maxMemType42=l.readInt(),this.minMemType1=l.readInt(),this.maxMemType1=l.readInt(),this.format){case 65536:case 196608:break;case 131072:var x;for(g=l.readUInt16(),this.glyphNameIndex=[],x=0;0<=g?x<g:x>g;x=0<=g?++x:--x)this.glyphNameIndex.push(l.readUInt16());for(this.names=[],v=[];l.pos<this.offset+this.length;)u=l.readByte(),v.push(this.names.push(l.readString(u)));return v;case 151552:return g=l.readUInt16(),this.offsets=l.read(g);case 262144:return this.map=(function(){var b,s,E;for(E=[],x=b=0,s=this.file.maxp.numGlyphs;0<=s?b<s:b>s;x=0<=s?++b:--b)E.push(l.readUInt32());return E}).call(this)}},p})(),Qw=function(p,l){this.raw=p,this.length=p.length,this.platformID=l.platformID,this.encodingID=l.encodingID,this.languageID=l.languageID},e5=(function(){function p(){return p.__super__.constructor.apply(this,arguments)}return ql(p,fl),p.prototype.tag="name",p.prototype.parse=function(l){var u,g,v,x,b,s,E,F,B,Q,ne;for(l.pos=this.offset,l.readShort(),u=l.readShort(),s=l.readShort(),g=[],x=0;0<=u?x<u:x>u;x=0<=u?++x:--x)g.push({platformID:l.readShort(),encodingID:l.readShort(),languageID:l.readShort(),nameID:l.readShort(),length:l.readShort(),offset:this.offset+s+l.readShort()});for(E={},x=B=0,Q=g.length;B<Q;x=++B)v=g[x],l.pos=v.offset,F=l.readString(v.length),b=new Qw(F,v),E[ne=v.nameID]==null&&(E[ne]=[]),E[v.nameID].push(b);this.strings=E,this.copyright=E[0],this.fontFamily=E[1],this.fontSubfamily=E[2],this.uniqueSubfamily=E[3],this.fontName=E[4],this.version=E[5];try{this.postscriptName=E[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=E[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=E[7],this.manufacturer=E[8],this.designer=E[9],this.description=E[10],this.vendorUrl=E[11],this.designerUrl=E[12],this.license=E[13],this.licenseUrl=E[14],this.preferredFamily=E[15],this.preferredSubfamily=E[17],this.compatibleFull=E[18],this.sampleText=E[19]},p})(),t5=(function(){function p(){return p.__super__.constructor.apply(this,arguments)}return ql(p,fl),p.prototype.tag="maxp",p.prototype.parse=function(l){return l.pos=this.offset,this.version=l.readInt(),this.numGlyphs=l.readUInt16(),this.maxPoints=l.readUInt16(),this.maxContours=l.readUInt16(),this.maxCompositePoints=l.readUInt16(),this.maxComponentContours=l.readUInt16(),this.maxZones=l.readUInt16(),this.maxTwilightPoints=l.readUInt16(),this.maxStorage=l.readUInt16(),this.maxFunctionDefs=l.readUInt16(),this.maxInstructionDefs=l.readUInt16(),this.maxStackElements=l.readUInt16(),this.maxSizeOfInstructions=l.readUInt16(),this.maxComponentElements=l.readUInt16(),this.maxComponentDepth=l.readUInt16()},p})(),r5=(function(){function p(){return p.__super__.constructor.apply(this,arguments)}return ql(p,fl),p.prototype.tag="hmtx",p.prototype.parse=function(l){var u,g,v,x,b,s,E;for(l.pos=this.offset,this.metrics=[],u=0,s=this.file.hhea.numberOfMetrics;0<=s?u<s:u>s;u=0<=s?++u:--u)this.metrics.push({advance:l.readUInt16(),lsb:l.readInt16()});for(v=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=(function(){var F,B;for(B=[],u=F=0;0<=v?F<v:F>v;u=0<=v?++F:--F)B.push(l.readInt16());return B})(),this.widths=(function(){var F,B,Q,ne;for(ne=[],F=0,B=(Q=this.metrics).length;F<B;F++)x=Q[F],ne.push(x.advance);return ne}).call(this),g=this.widths[this.widths.length-1],E=[],u=b=0;0<=v?b<v:b>v;u=0<=v?++b:--b)E.push(this.widths.push(g));return E},p.prototype.forGlyph=function(l){return l in this.metrics?this.metrics[l]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[l-this.metrics.length]}},p})(),V0=[].slice,i5=(function(){function p(){return p.__super__.constructor.apply(this,arguments)}return ql(p,fl),p.prototype.tag="glyf",p.prototype.parse=function(){return this.cache={}},p.prototype.glyphFor=function(l){var u,g,v,x,b,s,E,F,B,Q;return l in this.cache?this.cache[l]:(x=this.file.loca,u=this.file.contents,g=x.indexOf(l),(v=x.lengthOf(l))===0?this.cache[l]=null:(u.pos=this.offset+g,b=(s=new Xc(u.read(v))).readShort(),F=s.readShort(),Q=s.readShort(),E=s.readShort(),B=s.readShort(),this.cache[l]=b===-1?new s5(s,F,Q,E,B):new n5(s,b,F,Q,E,B),this.cache[l]))},p.prototype.encode=function(l,u,g){var v,x,b,s,E;for(b=[],x=[],s=0,E=u.length;s<E;s++)v=l[u[s]],x.push(b.length),v&&(b=b.concat(v.encode(g)));return x.push(b.length),{table:b,offsets:x}},p})(),n5=(function(){function p(l,u,g,v,x,b){this.raw=l,this.numberOfContours=u,this.xMin=g,this.yMin=v,this.xMax=x,this.yMax=b,this.compound=!1}return p.prototype.encode=function(){return this.raw.data},p})(),s5=(function(){function p(l,u,g,v,x){var b,s;for(this.raw=l,this.xMin=u,this.yMin=g,this.xMax=v,this.yMax=x,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],b=this.raw;s=b.readShort(),this.glyphOffsets.push(b.pos),this.glyphIDs.push(b.readUInt16()),32&s;)b.pos+=1&s?4:2,128&s?b.pos+=8:64&s?b.pos+=4:8&s&&(b.pos+=2)}return p.prototype.encode=function(){var l,u,g;for(u=new Xc(V0.call(this.raw.data)),l=0,g=this.glyphIDs.length;l<g;++l)u.pos=this.glyphOffsets[l];return u.data},p})(),a5=(function(){function p(){return p.__super__.constructor.apply(this,arguments)}return ql(p,fl),p.prototype.tag="loca",p.prototype.parse=function(l){var u,g;return l.pos=this.offset,u=this.file.head.indexToLocFormat,this.offsets=u===0?(function(){var v,x;for(x=[],g=0,v=this.length;g<v;g+=2)x.push(2*l.readUInt16());return x}).call(this):(function(){var v,x;for(x=[],g=0,v=this.length;g<v;g+=4)x.push(l.readUInt32());return x}).call(this)},p.prototype.indexOf=function(l){return this.offsets[l]},p.prototype.lengthOf=function(l){return this.offsets[l+1]-this.offsets[l]},p.prototype.encode=function(l,u){for(var g=new Uint32Array(this.offsets.length),v=0,x=0,b=0;b<g.length;++b)if(g[b]=v,x<u.length&&u[x]==b){++x,g[b]=v;var s=this.offsets[b],E=this.offsets[b+1]-s;E>0&&(v+=E)}for(var F=new Array(4*g.length),B=0;B<g.length;++B)F[4*B+3]=255&g[B],F[4*B+2]=(65280&g[B])>>8,F[4*B+1]=(16711680&g[B])>>16,F[4*B]=(4278190080&g[B])>>24;return F},p})(),o5=(function(){function p(l){this.font=l,this.subset={},this.unicodes={},this.next=33}return p.prototype.generateCmap=function(){var l,u,g,v,x;for(u in v=this.font.cmap.tables[0].codeMap,l={},x=this.subset)g=x[u],l[u]=v[g];return l},p.prototype.glyphsFor=function(l){var u,g,v,x,b,s,E;for(v={},b=0,s=l.length;b<s;b++)v[x=l[b]]=this.font.glyf.glyphFor(x);for(x in u=[],v)(g=v[x])!=null&&g.compound&&u.push.apply(u,g.glyphIDs);if(u.length>0)for(x in E=this.glyphsFor(u))g=E[x],v[x]=g;return v},p.prototype.encode=function(l,u){var g,v,x,b,s,E,F,B,Q,ne,j,Ie,he,re,ye;for(v in g=j0.encode(this.generateCmap(),"unicode"),b=this.glyphsFor(l),j={0:0},ye=g.charMap)j[(E=ye[v]).old]=E.new;for(Ie in ne=g.maxGlyphID,b)Ie in j||(j[Ie]=ne++);return B=(function(Je){var Be,De;for(Be in De={},Je)De[Je[Be]]=Be;return De})(j),Q=Object.keys(B).sort(function(Je,Be){return Je-Be}),he=(function(){var Je,Be,De;for(De=[],Je=0,Be=Q.length;Je<Be;Je++)s=Q[Je],De.push(B[s]);return De})(),x=this.font.glyf.encode(b,he,j),F=this.font.loca.encode(x.offsets,he),re={cmap:this.font.cmap.raw(),glyf:x.table,loca:F,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(u)},this.font.os2.exists&&(re["OS/2"]=this.font.os2.raw()),this.font.directory.encode(re)},p})();jr.API.PDFObject=(function(){var p;function l(){}return p=function(u,g){return(Array(g+1).join("0")+u).slice(-g)},l.convert=function(u){var g,v,x,b;if(Array.isArray(u))return"["+(function(){var s,E,F;for(F=[],s=0,E=u.length;s<E;s++)g=u[s],F.push(l.convert(g));return F})().join(" ")+"]";if(typeof u=="string")return"/"+u;if(u?.isString)return"("+u+")";if(u instanceof Date)return"(D:"+p(u.getUTCFullYear(),4)+p(u.getUTCMonth(),2)+p(u.getUTCDate(),2)+p(u.getUTCHours(),2)+p(u.getUTCMinutes(),2)+p(u.getUTCSeconds(),2)+"Z)";if({}.toString.call(u)==="[object Object]"){for(v in x=["<<"],u)b=u[v],x.push("/"+v+" "+l.convert(b));return x.push(">>"),x.join(`
`)}return""+u},l})();const Jp={"circle-radius":8,"circle-color":"red","circle-stroke-width":1,"circle-stroke-color":"black"},Xd={style:{textSize:16,textHaloColor:"#FFFFFF",textHaloWidth:.8,textColor:"#000000",fallbackTextFont:["Open Sans Regular"]},visibility:"visible",position:"bottom-right"},Yd={image:'<svg width="800px" height="800px" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--gis" preserveAspectRatio="xMidYMid meet"><path d="M47.655 1.634l-35 95c-.828 2.24 1.659 4.255 3.68 2.98l33.667-21.228l33.666 21.228c2.02 1.271 4.503-.74 3.678-2.98l-35-95C51.907.514 51.163.006 50 .008c-1.163.001-1.99.65-2.345 1.626zm-.155 14.88v57.54L19.89 91.461z" fill="none" stroke="white" stroke-width="1.5"/><path d="M47.655 1.634l-35 95c-.828 2.24 1.659 4.255 3.68 2.98l33.667-21.228l33.666 21.228c2.02 1.271 4.503-.74 3.678-2.98l-35-95C51.907.514 51.163.006 50 .008c-1.163.001-1.99.65-2.345 1.626zm-.155 14.88v57.54L19.89 91.461z" fill="#000000" fill-rule="evenodd"></path></svg>',imageName:"gl-export-north-icon",imageSizeFraction:.05,visibility:"visible",position:"top-right"};class l5{map;width;height;dpi;format;unit;fileName;markerClassName;markerCirclePaint;attributionClassName;attributionOptions;northIconOptions;constructor(l,u=ah.A4,g=300,v=xc.PNG,x=fh.mm,b="map",s="maplibregl-marker",E=Jp,F="maplibregl-ctrl-attrib-inner",B=Xd,Q=Yd){this.map=l,this.width=u[0],this.height=u[1],this.dpi=g,this.format=v,this.unit=x,this.fileName=b,this.markerClassName=s,this.markerCirclePaint=E,this.attributionClassName=F,this.attributionOptions=B,this.northIconOptions=Q}renderMapPost(l){return l}getMarkers(){return this.map.getCanvasContainer().getElementsByClassName(this.markerClassName)}renderMarkers(l){const u=this.getMarkers();for(let g=0;g<u.length;g++){const v=u.item(g);if(!v)continue;const x=v.getAttribute("style");if(!x)continue;const b=/translate\(([^,]+)px,\s*([^,]+)px\)/,s=x.match(b);if(!s)continue;const E=parseInt(s[1]),F=parseInt(s[2]),B=this.map.unproject([E,F]),Q=`point${g}`;l.addSource(Q,{type:"geojson",data:{type:"Point",coordinates:[B.lng,B.lat]}}),l.addLayer({id:Q,source:Q,type:"circle",paint:this.markerCirclePaint})}return l}generate(){const l=this;this.addLoader(),this.showLoader();const u=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return l.dpi/96}});const g=document.createElement("div");g.className="hidden-map",document.body.appendChild(g);const v=document.createElement("div");v.style.width=this.toPixels(this.width),v.style.height=this.toPixels(this.height),g.appendChild(v);const x=this.map.getStyle();if(x&&x.sources){const s=x.sources;Object.keys(s).forEach(E=>{const F=s[E];Object.keys(F).forEach(B=>{F[B]||delete F[B]})})}let b=this.getRenderedMap(v,x);b.on("load",()=>{this.addNorthIconToMap(b).then(()=>{b.once("idle",()=>{this.addAttributions(b)?b.once("idle",()=>{b=this.renderMapPost(b),this.getMarkers().length===0?this.exportImage(b,g,u):(b=this.renderMarkers(b),b.once("idle",()=>{this.exportImage(b,g,u)}))}):(b=this.renderMapPost(b),this.getMarkers().length===0?this.exportImage(b,g,u):(b=this.renderMarkers(b),b.once("idle",()=>{this.exportImage(b,g,u)})))})})})}stripHtml(l){const u=document.createElement("div");return u.innerHTML=l,u.textContent||u.innerText||""}getIconWidth(l,u){const g=l.getContainer(),v=parseInt(g.style.width.replace("px",""));return parseInt(`${v*u}`)}getElementPosition(l,u,g=0){const v=l.getContainer();let x=0,b=0;switch(u){case"top-left":x=0+g,b=0+g;break;case"top-right":x=parseInt(v.style.width.replace("px",""))-g,b=0+g;break;case"bottom-left":x=0+g,b=parseInt(v.style.height.replace("px",""))-g;break;case"bottom-right":x=parseInt(v.style.width.replace("px",""))-g,b=parseInt(v.style.height.replace("px",""))-g;break}return[x,b]}addNorthIconImage(l){const u=this.getIconWidth(l,this.northIconOptions.imageSizeFraction??.08);return new Promise(g=>{const v=new Image(u,u);v.onload=()=>{this.northIconOptions.imageName&&l.addImage(this.northIconOptions.imageName,v),g()};function x(b){return"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(b)}this.northIconOptions.image&&(v.src=x(this.northIconOptions.image))})}addNorthIconToMap(l){let u=this.northIconOptions.visibility??"visible";return l.getZoom()<2&&this.width>this.height&&(u="none"),new Promise(g=>{this.addNorthIconImage(l).then(()=>{const v=this.getIconWidth(l,this.northIconOptions.imageSizeFraction??.08)*.8,x=this.getElementPosition(l,this.northIconOptions.position??"top-right",v),b=l.unproject(x),s=this.northIconOptions.imageName??"gl-export-north-icon";l.addSource(s,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[b.lng,b.lat]},properties:{}}}),l.addLayer({id:s,source:s,type:"symbol",layout:{"icon-image":s,"icon-size":1,"icon-rotate":l.getBearing()*-1,"icon-allow-overlap":!0,"icon-ignore-placement":!0,visibility:u},paint:{}}),g()})})}addAttributions(l){if(!this.map.getStyle().glyphs)return!1;const u=l.getContainer(),g=this.attributionOptions.position??"bottom-right",v=this.getElementPosition(l,g,5),x=v[0],b=l.unproject(v),s=u.getElementsByClassName(this.attributionClassName),E=[];if(s?.length>0){const he=s.item(0);if(he)for(let re=0;re<he.children.length;re++){const ye=he.children.item(re);ye&&E.push(this.stripHtml(ye.outerHTML))}}else{const he=this.map.getStyle().sources;Object.keys(he).forEach(re=>{const ye=he[re];if("attribution"in ye){const Je=ye.attribution;E.push(this.stripHtml(Je))}})}if(E.length===0)return!1;const F=E.join(" | "),B="attribution";l.addSource(B,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[b.lng,b.lat]},properties:{attribution:F}}});const Q=this.map.getStyle().layers.filter(he=>he.type==="symbol"&&he.layout&&"text-font"in he.layout),ne=Q.length>0&&Q[0].layout?Q[0].layout["text-font"]:this.attributionOptions.style?.fallbackTextFont;let j=this.attributionOptions.visibility??"visible";l.getZoom()<2&&this.width>this.height&&(j="none");const Ie=this.attributionOptions.style;return l.addLayer({id:B,source:B,type:"symbol",layout:{"text-field":["get","attribution"],"text-font":ne,"text-max-width":parseInt(`${x/Ie.textSize}`),"text-anchor":g,"text-justify":["top-right","bottom-right"].includes(g)?"right":"left","text-size":Ie.textSize,"text-allow-overlap":!0,visibility:j},paint:{"text-halo-color":Ie.textHaloColor,"text-halo-width":Ie.textHaloWidth,"text-color":Ie.textColor}}),!0}exportImage(l,u,g){const v=l.getCanvas(),x=`${this.fileName}.${this.format}`;switch(this.format){case xc.PNG:this.toPNG(v,x);break;case xc.JPEG:this.toJPEG(v,x);break;case xc.PDF:this.toPDF(l,x);break;case xc.SVG:this.toSVG(v,x);break;default:console.error(`Invalid file format: ${this.format}`);break}l.remove(),u.parentNode?.removeChild(u),Object.defineProperty(window,"devicePixelRatio",{get(){return g}}),u.remove(),this.hideLoader()}toPNG(l,u){const g=document.createElement("a");g.href=l.toDataURL(),g.download=u,g.click(),g.remove()}toJPEG(l,u){const g=l.toDataURL("image/jpeg",.85),v=document.createElement("a");v.href=g,v.download=u,v.click(),v.remove()}toPDF(l,u){const g=l.getCanvas(),v=new jr({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});v.addImage(g.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:x,lat:b}=l.getCenter();v.setProperties({title:l.getStyle().name,subject:`center: [${x}, ${b}], zoom: ${l.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),v.save(u)}toSVG(l,u){const g=l.toDataURL("image/png"),v=Number(this.toPixels(this.width,this.dpi).replace("px","")),x=Number(this.toPixels(this.height,this.dpi).replace("px","")),b=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${v}" 
      height="${x}" 
      viewBox="0 0 ${v} ${x}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${g}" width="${v}" height="${x}"></image>
    </svg>`,s=document.createElement("a");s.href=`data:application/xml,${encodeURIComponent(b)}`,s.download=u,s.click(),s.remove()}toPixels(l,u=96){return this.unit===fh.mm&&(u/=25.4),`${u*l}px`}addLoader(){const l=this.map.getCanvas().parentElement?.parentElement;if(!l||l.getElementsByClassName("map-export-loader").length>0)return;const u=document.createElement("span");u.classList.add("map-export-loader"),u.classList.add("loader-default"),l.appendChild(u)}showLoader(){const l=this.map.getCanvas().parentElement?.parentElement;if(!l)return;const u=l.getElementsByClassName("map-export-loader");u&&u.length>0&&u.item(0)?.classList.add("is-active")}hideLoader(){const l=this.map.getCanvas().parentElement?.parentElement;if(!l)return;const u=l.getElementsByClassName("map-export-loader");u&&u.length>0&&u.item(0)?.classList.remove("is-active")}}class c5 extends l5{constructor(l,u=ah.A4,g=300,v=xc.PNG,x=fh.mm,b="map",s=Jp,E=Xd,F=Yd){super(l,u,g,v,x,b,"maplibregl-marker",s,"maplibregl-ctrl-attrib-inner",E,F)}getRenderedMap(l,u){const g=new Wy.Map({container:l,style:u,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,canvasContextAttributes:{preserveDrawingBuffer:!0},fadeDuration:0,transformRequest:this.map._requestManager._transformRequestFn});this.map.getTerrain()&&(g.setMaxPitch(85),g.setPitch(this.map.getPitch()));const v=(this.map.style.imageManager||{}).images||[];return Object.keys(v).forEach(x=>{v[x].data&&g.addImage(x,v[x].data)}),g}renderMapPost(l){const u=this.map.getTerrain();return u&&l.setTerrain({source:u.source,exaggeration:u.exaggeration}),l}}class u5{controlContainer;exportContainer;crosshair;printableArea;map;exportButton;options={PageSize:ah.A4,PageOrientation:Id.Landscape,Format:xc.PDF,DPI:P_[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys(ah),Filename:"map",markerCirclePaint:Jp,attributionOptions:Xd,northIconOptions:Yd};MAPLIB_CSS_PREFIX="maplibregl";constructor(l){l&&(l.attributionOptions=Object.assign(Xd,l.attributionOptions),l.northIconOptions=Object.assign(Yd,l.northIconOptions),this.options=Object.assign(this.options,l)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){const l=this.options.Local??"en";return v2(l)}onAdd(l){this.map=l,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl`),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-group`),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-list`),this.exportButton=document.createElement("button"),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-icon`),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-control`),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const u=document.createElement("TABLE");u.className="print-table";const g={};this.options.AllowedSizes?.forEach(F=>{ah[F]&&(g[F]=ah[F])});const v=this.createSelection(g,this.getTranslation().PageSize,"page-size",this.options.PageSize,(F,B)=>JSON.stringify(F[B]));u.appendChild(v);const x=this.createSelection(Id,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(F,B)=>F[B]);u.appendChild(x);const b=this.createSelection(xc,this.getTranslation().Format,"format-type",this.options.Format,(F,B)=>F[B]);u.appendChild(b);const s=this.createSelection(P_,this.getTranslation().DPI,"dpi-type",this.options.DPI,(F,B)=>F[B]);u.appendChild(s),this.exportContainer.appendChild(u);const E=document.createElement("button");return E.type="button",E.textContent=this.getTranslation().Generate,E.classList.add("generate-button"),E.addEventListener("click",()=>{const F=document.getElementById("mapbox-gl-export-page-size"),B=document.getElementById("mapbox-gl-export-page-orientation"),Q=document.getElementById("mapbox-gl-export-format-type"),ne=document.getElementById("mapbox-gl-export-dpi-type"),j=B.value;let Ie=JSON.parse(F.value);j===Id.Portrait&&(Ie=Ie.reverse()),this.generateMap(l,Ie,Number(ne.value),Q.value,fh.mm,this.options.Filename)}),this.exportContainer.appendChild(E),this.controlContainer}generateMap(l,u,g,v,x,b){new c5(l,u,g,v,x,b,this.options.markerCirclePaint,this.options.attributionOptions,this.options.northIconOptions).generate()}createSelection(l,u,g,v,x){const b=document.createElement("label");b.textContent=u;const s=document.createElement("select");s.setAttribute("id",`mapbox-gl-export-${g}`),s.style.width="100%",Object.keys(l).forEach(Q=>{const ne=document.createElement("option");ne.setAttribute("value",x(l,Q)),ne.appendChild(document.createTextNode(Q)),ne.setAttribute("name",g),v===l[Q]&&(ne.selected=!0),s.appendChild(ne)}),s.addEventListener("change",()=>{this.updatePrintableArea()});const E=document.createElement("TR"),F=document.createElement("TD"),B=document.createElement("TD");return F.appendChild(b),B.appendChild(s),E.appendChild(F),E.appendChild(B),E}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0),this.map=void 0)}onDocumentClick(l){this.controlContainer&&!this.controlContainer.contains(l.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(l){this.options.Crosshair===!0&&(l===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new i2(this.map),this.crosshair.create()))}togglePrintableArea(l){this.options.PrintableArea===!0&&(l===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new n2(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const l=document.getElementById("mapbox-gl-export-page-size"),u=document.getElementById("mapbox-gl-export-page-orientation").value;let g=JSON.parse(l.value);u===Id.Portrait&&(g=g.reverse()),this.printableArea.updateArea(g[0],g[1])}}var h5=["fill-antialias","fill-opacity","fill-color","fill-outline-color","fill-translate","fill-translate-anchor","fill-pattern","fill-extrusion-opacity","fill-extrusion-color","fill-extrusion-translate","fill-extrusion-translate-anchor","fill-extrusion-pattern","fill-extrusion-height","fill-extrusion-base","fill-extrusion-vertical-gradient","line-opacity","line-color","line-translate","line-translate-anchor","line-width","line-gap-width","line-offset","line-blur","line-dasharray","line-pattern","line-gradient","circle-radius","circle-color","circle-blur","circle-opacity","circle-translate","circle-translate-anchor","circle-pitch-scale","circle-pitch-alignment","circle-stroke-width","circle-stroke-color","circle-stroke-opacity","heatmap-radius","heatmap-weight","heatmap-intensity","heatmap-color","heatmap-opacity","icon-opacity","icon-color","icon-halo-color","icon-halo-width","icon-halo-blur","icon-translate","icon-translate-anchor","text-opacity","text-color","text-halo-color","text-halo-width","text-halo-blur","text-translate","text-translate-anchor","raster-opacity","raster-hue-rotate","raster-brightness-min","raster-brightness-max","raster-saturation","raster-contrast","raster-resampling","raster-fade-duration","hillshade-illumination-direction","hillshade-illumination-anchor","hillshade-exaggeration","hillshade-shadow-color","hillshade-highlight-color","hillshade-accent-color","background-color","background-pattern","background-opacity"],d5=["visibility","fill-sort-key","circle-sort-key","line-cap","line-join","line-miter-limit","line-round-limit","line-sort-key","symbol-placement","symbol-spacing","symbol-avoid-edges","symbol-sort-key","symbol-z-order","icon-allow-overlap","icon-ignore-placement","icon-optional","icon-rotation-alignment","icon-size","icon-text-fit","icon-text-fit-padding","icon-image","icon-rotate","icon-padding","icon-keep-upright","icon-offset","icon-anchor","icon-pitch-alignment","text-pitch-alignment","text-rotation-alignment","text-field","text-font","text-size","text-max-width","text-line-height","text-letter-spacing","text-justify","text-radial-offset","text-variable-anchor","text-anchor","text-max-angle","text-writing-mode","text-rotate","text-padding","text-keep-upright","text-transform","text-offset","text-allow-overlap","text-ignore-placement","text-optional"],Hc={paints:h5,layouts:d5};const Cp=p=>p.replace(/[A-Z]/g,l=>`-${l.toLowerCase()}`),qp=p=>p.replace(/(^|-)([a-z])/g,(l,u,g)=>`${g.toUpperCase()}`);function f5(p){return Hc.paints.indexOf(p)>=0}function p5(p){return Hc.layouts.indexOf(p)>=0}function m5(p){return Hc.paints.indexOf(p)>=0?"paint":Hc.layouts.indexOf(p)>=0?"layout":"other"}function g5(p){return String(p).match(/\.(geo)?json/)||p.type==="Feature"||p.type==="FeatureCollection"?{type:"geojson",data:p}:String(p).match(/^mapbox:\/\//)?{type:"vector",url:p}:p}const qh=(p,l)=>Array.isArray(p)?p:p instanceof RegExp?l.getStyle().layers.map(u=>u.id).filter(u=>u.match(p)):p instanceof Function?l.getStyle().layers.filter(u=>p(u)).map(u=>u.id):[p],ja=p=>function(l,...u){return qh(l,this.map).forEach(v=>p.call(this,v,...u))},Oh=p=>function(l,...u){const v=qh(l,this.map).map(x=>p.call(this,x,...u));return()=>v.forEach(x=>x())},U0=["line","fill","circle","symbol","video","raster","fill-extrusion","heatmap","hillshade"];class Zc{_loaded=!1;_mapgl=null;map;update;static init(l,u){return l.U=new Zc,l.U._mapgl=u,l.U.map=l,l.U}static async newMap(l,u={},g={}){function v(F,B=[]){F.layers=[...F.layers,...B.map(Q=>this.layerStyle(Q))]}function x(F,B={}){F.sources={...F.sources,...B}}function b(F,B){F=B(F)}function s(F,B={}){Object.keys(B).forEach(Q=>{const ne=B[Q].layers;delete B[Q].layers,F.sources[Q]=B[Q],F.layers=[...F.layers,...ne.map(j=>this.layerStyle({source:Q,...j}))]})}if(u.style||(u.style={version:8,layers:[],sources:{}}),g.addLayers||g.addSources||g.transformStyle||g.mixStyles){let F=u.style,B;if(typeof F=="string"){const ne=F.replace(/^mapbox:\/\/styles\//,"https://api.mapbox.com/styles/v1/");B=await(await fetch(ne)).json()}else B=F;const Q=new Zc;v.call(Q,B,g.addLayers),x(B,g.addSources),b(B,g.transformStyle??(ne=>ne)),s.call(Q,B,g.mixStyles),u.style=B}const E=new l.Map(u);return Zc.init(E,l),E}static interpolateZoom(l,...u){return this.interpolate(["zoom"],l,...u)}static zoom=Zc.interpolateZoom;static step(l,u,g,...v){return["step",typeof l=="string"?["get",l]:l,...Array.isArray(u)&&!g?u:[u],...Array.isArray(g)?g:typeof g=="object"?Object.entries(g).map(([x,b])=>[isNaN(+x)?x:+x,b]).flat():[g,...v]]}static stepZoom(l,u,...g){return this.step(["zoom"],l,u,...g)}static interpolate(l,u,...g){return["interpolate",["linear"],typeof l=="string"?["get",l]:l,...Array.isArray(u)?u:typeof u=="object"?Object.entries(u).map(([v,x])=>[+v,x]).flat():[u,...g]]}static match(l,u,g){return u.default&&(g=u.default,delete u.default),["match",typeof l=="string"?["get",l]:l,...Object.entries(u).map(([v,x])=>[isNaN(+v)?v:+v,x]).flat(),g]}hoverPointer(l){const u=qh(l,this.map),g=b=>this.map.getCanvas().style.cursor="pointer",v=b=>{this.map.queryRenderedFeatures(b.point,{layers:u}).length===0&&(this.map.getCanvas().style.cursor=x)},x=this.map.getCanvas().style.cursor;for(const b of u)this.map.on("mouseleave",b,v),this.map.on("mouseenter",b,g);return()=>{for(const b of u)this.map.off("mouseenter",b,g),this.map.off("mouseleave",b,v);this.map.getCanvas().style.cursor=x}}hoverFeatureState=Oh(function(l,u,g,v,x){if(Array.isArray(u)){let B=u.map(([Q,ne])=>this.hoverFeatureState(l,Q,ne));return()=>B.forEach(Q=>Q())}if(u===void 0){const B=this.getLayerStyle(l);u=B.source,g=B["source-layer"]}let b;const s=B=>{b&&this.map.setFeatureState({source:u,sourceLayer:g,id:b},{hover:B})},E=B=>{const Q=B.features?.[0];Q&&Q.id===b||(s(!1),Q&&(b&&x&&x({...B,oldFeatureId:b}),b=Q.id,s(!0),v&&v(B)))},F=B=>{s(!1),B&&B.oldFeatureId&&(B.oldFeatureId=b),b=void 0,x&&x(B)};return this.map.on("mousemove",l,E),this.map.on("mouseleave",l,F),()=>{this.map.off("mousemove",l,E),this.map.off("mouseleave",l,F),F()}});hoverPopup(l,u,g={}){if(!this._mapgl)throw"Mapbox GL JS or MapLibre GL JS object required when initialising";const v=new this._mapgl.Popup({closeButton:!1,...g});return Oh(function(x,b){const s=F=>{F?.features?.[0]&&(v.setLngLat(F.lngLat),v.setHTML(b(F.features[0],v)),v.addTo(this.map))},E=F=>{v.remove()};return this.map.on("mouseenter",x,s),this.map.on("mouseout",x,E),()=>{this.map.off("mouseenter",x,s),this.map.off("mouseout",x,E),E()}}).call(this,l,u)}clickPopup(l,u,g={}){if(!this._mapgl)throw"Mapbox GL JS or Maplibre GL JS object required when initialising";const v=new this._mapgl.Popup({...g});return Oh(function(x,b){const s=E=>{E.features?.[0]&&(v.setLngLat(E.features[0].geometry.coordinates.slice()),v.setHTML(b(E.features[0],v)),v.addTo(this.map))};return this.map.on("click",x,s),()=>this.map.off("click",x,s)}).call(this,l,u)}clickLayer=Oh(function(l,u){const g=v=>{v.features=this.map.queryRenderedFeatures(v.point,{layers:[l]}),u(v)};return this.map.on("click",l,g),()=>this.map.off("click",l,g)});clickOneLayer(l,u,g){const v=qh(l,this.map),x=b=>{let s=!1;for(const E of v){const F=this.map.queryRenderedFeatures(b.point,{layers:[E]});if(F[0])try{u({event:b,layer:E,feature:F[0],features:F})}finally{s=!0;break}}!s&&g&&g(b)};return this.map.on("click",x),()=>this.map.off("click",x)}hoverLayer=Oh(function(l,u){const g=v=>{v.features=this.map.queryRenderedFeatures(v.point,{layers:[l]}),u(v)};return this.map.on("click",l,g),()=>this.map.off("click",l,g)});_mapAddLayerBefore(l,u){u?(this.map.getLayer(u)||(u=void 0),this.map.addLayer(l,u)):this.map.addLayer(l)}addLayer(l,u,g,v,x){return this._mapAddLayerBefore(this.layerStyle(l,u,g,v),x),this._makeSource(u)}add(l,u,g,v,x){if(this._mapAddLayerBefore({...this.properties(v),id:l,type:g,source:g5(u)},x),typeof u=="string")return this._makeSource(u)}setLayer(l,u,g,v,x){const b=this.layerStyle(l,u,g,v),s=this.map.getStyle();if(!s)throw"Map has no style";const E=s.layers.findIndex(B=>B.id===b.id);if(s.layers.findIndex(B=>B.id===x)<0&&(x=void 0),E>=0){this.map.removeLayer(b.id);let B=x;!x&&s.layers[E+1]&&(B=s.layers[E+1].id),this.map.addLayer(b,B)}else this.map.addLayer(b,x||void 0);return this._makeSource(u)}removeLayer=ja(function(l){const u=g=>{g.error.message.match(/does not exist/)||console.error(g.error)};this.map.once("error",u),this.map.removeLayer(l),this.map.off("error",u)});addLineLayer(l,u,g,v){}addFillLayer(l,u,g,v){}addCircleLayer(l,u,g,v){}addSymbolLayer(l,u,g,v){}addVideoLayer(l,u,g,v){}addRasterLayer(l,u,g,v){}addFillExtrusionLayer(l,u,g,v){}addHeatmapLayer(l,u,g,v){}addHillshadeLayer(l,u,g,v){}addGeoJSONSource(l,u,g){return u&&typeof u=="object"&&!(u.type==="FeatureCollection"||u.type==="GeometryCollection"||u.geometry||u.coordinates)&&(g=u,u=void 0),u||(u={type:"FeatureCollection",features:[]}),this.addSource(l,{type:"geojson",data:u??void 0,...g})}addGeoJSON(l,u,g){return this.addGeoJSONSource(l,u,g)}addSource(l,u){const g=this.map.getStyle();if(!g)throw"Map has no style";return g.sources[l]=u,this.map.setStyle(g),this._makeSource(l)}layersBySource(l){const u=this.map.getStyle();if(!u)throw"Map has no style";return u.layers.filter(g=>g.source===l).map(g=>g.id)}addVectorSource(l,u,g={}){return typeof u=="string"?u.match(/\{z\}/)?this.addSource(l,{...g,type:"vector",tiles:[u]}):this.addSource(l,{...g,type:"vector",url:u}):this.addSource(l,{...u,type:"vector"})}addVector(l,u,g={}){return this.addVectorSource(l,u,g)}addRasterSource(l,u){return this.addSource(l,{...u,type:"raster"})}addRasterDemSource(l,u){return this.addSource(l,{...u,type:"raster-dem"})}addImageSource(l,u){return this.addSource(l,{...u,type:"image"})}addVideoSource(l,u){return this.addSource(l,{...u,type:"video"})}setProperty=ja(function(l,u,g){if(typeof u=="object")Object.keys(u).forEach(v=>this.setProperty(l,v,u[v]));else{const v=Cp(u??""),x=qh(l,this.map);for(const b of x)f5(v)?this.map.setPaintProperty(b,v,g):p5(v)&&this.map.setLayoutProperty(b,v,g)}});properties(l){if(!l)return;const u={},g={paint:{},layout:{},other:{}};return Object.keys(l).forEach(v=>{const x=Cp(v);g[m5(x)][x]=l[v]}),Object.keys(g.paint).length&&(u.paint=g.paint),Object.keys(g.layout).length&&(u.layout=g.layout),Object.assign(u,g.other),u}layerStyle(...l){const[u,g,v]=l,x=l.find(s=>typeof s=="object"&&!Array.isArray(s)),b=typeof x=="object"?this.properties(x)||{}:{};return typeof u=="string"&&(b.id=u),typeof g=="string"&&(b.source=g),typeof v=="string"&&(b.type=v),b}getLayerStyle(l){return this.map.getStyle()?.layers?.find(u=>u.id===l)}setLayerStyle=ja(function(l,u){const g=(b={},s={})=>Object.keys(b).forEach(E=>{E in s||this.setProperty(l,E,void 0)});typeof l=="object"&&!Array.isArray(l)&&l.id&&!u&&(u=l,l=u.id);const v=this.getLayerStyle(l),x=this.properties(u);g(v?.paint,x?.paint),g(v?.layout,x?.layout),this.setProperty(l,{...x?.paint,...x?.layout},void 0)});setData(l,u={type:"FeatureCollection",features:[]}){this.map.getSource(l).setData(u)}show=ja(function(l){this.setVisibility(l,"visible")});hide=ja(function(l){this.setVisibility(l,"none")});toggle=ja(function(l,u){this.setVisibility(l,u?"visible":"none")});showSource=ja(function(l){this.setVisibility(this.layersBySource(l),"visible")});hideSource=ja(function(l){this.setVisibility(this.layersBySource(l),"none")});toggleSource=ja(function(l,u){this.setVisibility(this.layersBySource(l),u?"visible":"none")});setFilter=ja(function(l,u){this.map.setFilter(l,u)});removeSource=ja(function(l){const u=this.layersBySource(l);this.removeLayer(u),this.map.getSource(l)&&this.map.removeSource(l)});setLayerSource=ja(function(l,u,g){const v=this.map.getStyle().layers,x=v.findIndex(E=>E.id===l),b=v[x],s=v[x+1]&&v[x+1].id;b.source=u,g?b["source-layer"]=g:g!==void 0&&delete b["source-layer"],this.map.removeLayer(l),this._mapAddLayerBefore(b,s)});onLoad(l){if(l)this.map.loaded()||this._loaded?l():this.map.once("load",()=>{this._loaded=!0,l()});else return new Promise(u=>this.onLoad(u))}setRootProperty(l,u){const g=this.map.getStyle();g[Cp(l)]=u,this.map.setStyle(g)}setTransition(l){this.setRootProperty("transition",l)}loadImage(l,u,g){return typeof u=="string"?new Promise((v,x)=>{this.map.loadImage(u,(b,s)=>{b||!s?(console.error(`Error loading image ${u}`,b),x(`Error loading image ${u}`)):(this.map.addImage(l,s,g),v(l))})}):this.map.addImage(l,u,g)}lockOrientation(){const l=this.map.getBearing(),u=this.map.getPitch();this.map.touchZoomRotate.disableRotation(),this.map.dragRotate.disable(),this.map.on("move",()=>{this.map.getBearing()!==l&&this.map.setBearing(l),this.map.getPitch()!==u&&this.map.setPitch(u)})}fontsInUse(){function l(x){Array.isArray(x)&&(x[0]==="literal"?u.push(...x[1]):x.forEach(l))}let u=[];const g=this.map.getStyle();if(!g)throw"Map has no style";const v=g.layers.map(x=>x.type==="symbol"&&x.layout&&x.layout["text-font"]).filter(Boolean);for(const x of v)if(x.stops)try{u.push(...x.stops.flat().filter(Array.isArray).flat())}catch{console.log("Couldn't process font expression:",x)}else x.every(b=>typeof b=="string")?u.push(...x):l(x);return[...new Set(u)]}_makeSource(l){const u=new Zc;return u.map=this.map,u._mapgl=this._mapgl,U0.forEach(function(g){q0(g,u,l)}),u}}const q0=(p,l,u)=>{let g;u?g=function(x,b,s){return this.setLayer(x,u,p,b,s)}:g=function(x,b,s,E){return this.setLayer(x,b,p,s,E)};const v=qp(p);l[`add${v}`]=g,l[`add${v}Layer`]=g};function _5(p){const l=(g,v)=>{const x="set"+qp(g);p[x]=ja(function(b,s){return this.map[v](b,g,s)})},u=(g,v)=>{const x="get"+qp(g);p[x]=ja(function(b){return this.map[v](b,g)})};Hc.paints.forEach(g=>l(g,"setPaintProperty")),Hc.layouts.forEach(g=>l(g,"setLayoutProperty")),Hc.paints.forEach(g=>u(g,"getPaintProperty")),Hc.layouts.forEach(g=>u(g,"getLayoutProperty")),U0.forEach(g=>q0(g,p))}const y5=Zc.prototype;_5(y5);var uo=Uint8Array,lh=Uint16Array,v5=Int32Array,G0=new uo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),$0=new uo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),b5=new uo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Z0=function(p,l){for(var u=new lh(31),g=0;g<31;++g)u[g]=l+=1<<p[g-1];for(var v=new v5(u[30]),g=1;g<30;++g)for(var x=u[g];x<u[g+1];++x)v[x]=x-u[g]<<5|g;return{b:u,r:v}},W0=Z0(G0,2),H0=W0.b,x5=W0.r;H0[28]=258,x5[258]=28;var w5=Z0($0,0),S5=w5.b,Gp=new lh(32768);for(var xn=0;xn<32768;++xn){var $c=(xn&43690)>>1|(xn&21845)<<1;$c=($c&52428)>>2|($c&13107)<<2,$c=($c&61680)>>4|($c&3855)<<4,Gp[xn]=(($c&65280)>>8|($c&255)<<8)>>1}var Gh=(function(p,l,u){for(var g=p.length,v=0,x=new lh(l);v<g;++v)p[v]&&++x[p[v]-1];var b=new lh(l);for(v=1;v<l;++v)b[v]=b[v-1]+x[v-1]<<1;var s;if(u){s=new lh(1<<l);var E=15-l;for(v=0;v<g;++v)if(p[v])for(var F=v<<4|p[v],B=l-p[v],Q=b[p[v]-1]++<<B,ne=Q|(1<<B)-1;Q<=ne;++Q)s[Gp[Q]>>E]=F}else for(s=new lh(g),v=0;v<g;++v)p[v]&&(s[v]=Gp[b[p[v]-1]++]>>15-p[v]);return s}),Hh=new uo(288);for(var xn=0;xn<144;++xn)Hh[xn]=8;for(var xn=144;xn<256;++xn)Hh[xn]=9;for(var xn=256;xn<280;++xn)Hh[xn]=7;for(var xn=280;xn<288;++xn)Hh[xn]=8;var X0=new uo(32);for(var xn=0;xn<32;++xn)X0[xn]=5;var T5=Gh(Hh,9,1),P5=Gh(X0,5,1),Mp=function(p){for(var l=p[0],u=1;u<p.length;++u)p[u]>l&&(l=p[u]);return l},cl=function(p,l,u){var g=l/8|0;return(p[g]|p[g+1]<<8)>>(l&7)&u},Ep=function(p,l){var u=l/8|0;return(p[u]|p[u+1]<<8|p[u+2]<<16)>>(l&7)},A5=function(p){return(p+7)/8|0},I5=function(p,l,u){return(u==null||u>p.length)&&(u=p.length),new uo(p.subarray(l,u))},L5=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],co=function(p,l,u){var g=new Error(l||L5[p]);if(g.code=p,Error.captureStackTrace&&Error.captureStackTrace(g,co),!u)throw g;return g},Kp=function(p,l,u,g){var v=p.length,x=0;if(!v||l.f&&!l.l)return u||new uo(0);var b=!u,s=b||l.i!=2,E=l.i;b&&(u=new uo(v*3));var F=function(Zt){var sr=u.length;if(Zt>sr){var ur=new uo(Math.max(sr*2,Zt));ur.set(u),u=ur}},B=l.f||0,Q=l.p||0,ne=l.b||0,j=l.l,Ie=l.d,he=l.m,re=l.n,ye=v*8;do{if(!j){B=cl(p,Q,1);var Je=cl(p,Q+1,3);if(Q+=3,Je)if(Je==1)j=T5,Ie=P5,he=9,re=5;else if(Je==2){var $e=cl(p,Q,31)+257,st=cl(p,Q+10,15)+4,Ze=$e+cl(p,Q+5,31)+1;Q+=14;for(var Pe=new uo(Ze),rt=new uo(19),_e=0;_e<st;++_e)rt[b5[_e]]=cl(p,Q+_e*3,7);Q+=st*3;for(var we=Mp(rt),Ge=(1<<we)-1,Ye=Gh(rt,we,1),_e=0;_e<Ze;){var xt=Ye[cl(p,Q,Ge)];Q+=xt&15;var Be=xt>>4;if(Be<16)Pe[_e++]=Be;else{var kt=0,yt=0;for(Be==16?(yt=3+cl(p,Q,3),Q+=2,kt=Pe[_e-1]):Be==17?(yt=3+cl(p,Q,7),Q+=3):Be==18&&(yt=11+cl(p,Q,127),Q+=7);yt--;)Pe[_e++]=kt}}var mt=Pe.subarray(0,$e),gt=Pe.subarray($e);he=Mp(mt),re=Mp(gt),j=Gh(mt,he,1),Ie=Gh(gt,re,1)}else co(1);else{var Be=A5(Q)+4,De=p[Be-4]|p[Be-3]<<8,Ue=Be+De;if(Ue>v){E&&co(0);break}s&&F(ne+De),u.set(p.subarray(Be,Ue),ne),l.b=ne+=De,l.p=Q=Ue*8,l.f=B;continue}if(Q>ye){E&&co(0);break}}s&&F(ne+131072);for(var Qt=(1<<he)-1,Vt=(1<<re)-1,fe=Q;;fe=Q){var kt=j[Ep(p,Q)&Qt],Fe=kt>>4;if(Q+=kt&15,Q>ye){E&&co(0);break}if(kt||co(2),Fe<256)u[ne++]=Fe;else if(Fe==256){fe=Q,j=null;break}else{var We=Fe-254;if(Fe>264){var _e=Fe-257,tt=G0[_e];We=cl(p,Q,(1<<tt)-1)+H0[_e],Q+=tt}var nt=Ie[Ep(p,Q)&Vt],ut=nt>>4;nt||co(3),Q+=nt&15;var gt=S5[ut];if(ut>3){var tt=$0[ut];gt+=Ep(p,Q)&(1<<tt)-1,Q+=tt}if(Q>ye){E&&co(0);break}s&&F(ne+131072);var ft=ne+We;if(ne<gt){var It=x-gt,zt=Math.min(gt,ft);for(It+ne<0&&co(3);ne<zt;++ne)u[ne]=g[It+ne]}for(;ne<ft;++ne)u[ne]=u[ne-gt]}}l.l=j,l.p=fe,l.b=ne,l.f=B,j&&(B=1,l.m=he,l.d=Ie,l.n=re)}while(!B);return ne!=u.length&&b?I5(u,0,ne):u.subarray(0,ne)},C5=new uo(0),M5=function(p){(p[0]!=31||p[1]!=139||p[2]!=8)&&co(6,"invalid gzip data");var l=p[3],u=10;l&4&&(u+=(p[10]|p[11]<<8)+2);for(var g=(l>>3&1)+(l>>4&1);g>0;g-=!p[u++]);return u+(l&2)},E5=function(p){var l=p.length;return(p[l-4]|p[l-3]<<8|p[l-2]<<16|p[l-1]<<24)>>>0},k5=function(p,l){return((p[0]&15)!=8||p[0]>>4>7||(p[0]<<8|p[1])%31)&&co(6,"invalid zlib data"),(p[1]>>5&1)==1&&co(6,"invalid zlib data: "+(p[1]&32?"need":"unexpected")+" dictionary"),(p[1]>>3&4)+2};function D5(p,l){return Kp(p,{i:2},l,l)}function F5(p,l){var u=M5(p);return u+8>p.length&&co(6,"invalid gzip data"),Kp(p.subarray(u,-8),{i:2},new uo(E5(p)),l)}function z5(p,l){return Kp(p.subarray(k5(p),-4),{i:2},l,l)}function N5(p,l){return p[0]==31&&p[1]==139&&p[2]==8?F5(p,l):(p[0]&15)!=8||p[0]>>4>7||(p[0]<<8|p[1])%31?D5(p,l):z5(p,l)}var R5=typeof TextDecoder<"u"&&new TextDecoder,B5=0;try{R5.decode(C5,{stream:!0}),B5=1}catch{}var O5=Object.defineProperty,j5=Math.pow,Ji=(p,l)=>O5(p,"name",{value:l,configurable:!0}),Ps=(p,l,u)=>new Promise((g,v)=>{var x=E=>{try{s(u.next(E))}catch(F){v(F)}},b=E=>{try{s(u.throw(E))}catch(F){v(F)}},s=E=>E.done?g(E.value):Promise.resolve(E.value).then(x,b);s((u=u.apply(p,l)).next())});Ji((p,l)=>{let u=!1,g="",v=L.GridLayer.extend({createTile:Ji((x,b)=>{let s=document.createElement("img"),E=new AbortController,F=E.signal;return s.cancel=()=>{E.abort()},u||(p.getHeader().then(B=>{B.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):B.tileType===2?g="image/png":B.tileType===3?g="image/jpeg":B.tileType===4?g="image/webp":B.tileType===5&&(g="image/avif")}),u=!0),p.getZxy(x.z,x.x,x.y,F).then(B=>{if(B){let Q=new Blob([B.data],{type:g}),ne=window.URL.createObjectURL(Q);s.src=ne}else s.style.display="none";s.cancel=void 0,b(void 0,s)}).catch(B=>{if(B.name!=="AbortError")throw B}),s},"createTile"),_removeTile:Ji(function(x){let b=this._tiles[x];b&&(b.el.cancel&&b.el.cancel(),b.el.width=0,b.el.height=0,b.el.deleted=!0,L.DomUtil.remove(b.el),delete this._tiles[x],this.fire("tileunload",{tile:b.el,coords:this._keyToTileCoords(x)}))},"_removeTile")});return new v(l)},"leafletRasterLayer");var V5=Ji(p=>(l,u)=>{if(u instanceof AbortController)return p(l,u);let g=new AbortController;return p(l,g).then(v=>u(void 0,v.data,v.cacheControl||"",v.expires||""),v=>u(v)).catch(v=>u(v)),{cancel:Ji(()=>g.abort(),"cancel")}},"v3compat"),Y0=class{constructor(l){this.tilev4=Ji((u,g)=>Ps(this,null,function*(){if(u.type==="json"){let j=u.url.substr(10),Ie=this.tiles.get(j);if(Ie||(Ie=new Vy(j),this.tiles.set(j,Ie)),this.metadata){let re=yield Ie.getTileJson(u.url);return g.signal.throwIfAborted(),{data:re}}let he=yield Ie.getHeader();return g.signal.throwIfAborted(),(he.minLon>=he.maxLon||he.minLat>=he.maxLat)&&console.error(`Bounds of PMTiles archive ${he.minLon},${he.minLat},${he.maxLon},${he.maxLat} are not valid.`),{data:{tiles:[`${u.url}/{z}/{x}/{y}`],minzoom:he.minZoom,maxzoom:he.maxZoom,bounds:[he.minLon,he.minLat,he.maxLon,he.maxLat]}}}let v=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),x=u.url.match(v);if(!x)throw new Error("Invalid PMTiles protocol URL");let b=x[1],s=this.tiles.get(b);s||(s=new Vy(b),this.tiles.set(b,s));let E=x[2],F=x[3],B=x[4],Q=yield s.getHeader(),ne=yield s?.getZxy(+E,+F,+B,g.signal);if(g.signal.throwIfAborted(),ne)return{data:new Uint8Array(ne.data),cacheControl:ne.cacheControl,expires:ne.expires};if(Q.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=V5(this.tilev4),this.tiles=new Map,this.metadata=l?.metadata||!1,this.errorOnMissingTile=l?.errorOnMissingTile||!1}add(l){this.tiles.set(l.source.getKey(),l)}get(l){return this.tiles.get(l)}};Ji(Y0,"Protocol");var U5=Y0;function J0(p,l){return(l>>>0)*4294967296+(p>>>0)}Ji(J0,"toNum");function K0(p,l){let u=l.buf,g=u[l.pos++],v=(g&112)>>4;if(g<128||(g=u[l.pos++],v|=(g&127)<<3,g<128)||(g=u[l.pos++],v|=(g&127)<<10,g<128)||(g=u[l.pos++],v|=(g&127)<<17,g<128)||(g=u[l.pos++],v|=(g&127)<<24,g<128)||(g=u[l.pos++],v|=(g&1)<<31,g<128))return J0(p,v);throw new Error("Expected varint not more than 10 bytes")}Ji(K0,"readVarintRemainder");function sh(p){let l=p.buf,u=l[p.pos++],g=u&127;return u<128||(u=l[p.pos++],g|=(u&127)<<7,u<128)||(u=l[p.pos++],g|=(u&127)<<14,u<128)||(u=l[p.pos++],g|=(u&127)<<21,u<128)?g:(u=l[p.pos],g|=(u&15)<<28,K0(g,p))}Ji(sh,"readVarint");function Qp(p,l,u,g,v){return v===0?g!==0?[p-1-u,p-1-l]:[u,l]:[l,u]}Ji(Qp,"rotate");function Q0(p,l,u){if(p>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(l>=1<<p||u>=1<<p)throw new Error("tile x/y outside zoom level bounds");let g=((1<<p)*(1<<p)-1)/3,v=p-1,[x,b]=[l,u];for(let s=1<<v;s>0;s>>=1){let E=x&s,F=b&s;g+=(3*E^F)*(1<<v),[x,b]=Qp(s,x,b,E,F),v--}return g}Ji(Q0,"zxyToTileId");function e1(p){let l=3*p+1;return l<4294967296?31-Math.clz32(l):63-Math.clz32(l/4294967296)}Ji(e1,"tileIdToZ");function q5(p){let l=e1(p)>>1;if(l>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");let u=((1<<l)*(1<<l)-1)/3,g=p-u,v=0,x=0,b=1<<l;for(let s=1;s<b;s<<=1){let E=s&g/2,F=s&(g^E);[v,x]=Qp(s,v,x,E,F),g=g/2,v+=E,x+=F}return[l,v,x]}Ji(q5,"tileIdToZxy");var G5=(p=>(p[p.Unknown=0]="Unknown",p[p.None=1]="None",p[p.Gzip=2]="Gzip",p[p.Brotli=3]="Brotli",p[p.Zstd=4]="Zstd",p))(G5||{});function ef(p,l){return Ps(this,null,function*(){if(l===1||l===0)return p;if(l===2){if(typeof globalThis.DecompressionStream>"u")return N5(new Uint8Array(p));let u=new Response(p).body;if(!u)throw new Error("Failed to read response stream");let g=u.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(g).arrayBuffer()}throw new Error("Compression method not supported")})}Ji(ef,"defaultDecompress");var $5=(p=>(p[p.Unknown=0]="Unknown",p[p.Mvt=1]="Mvt",p[p.Png=2]="Png",p[p.Jpeg=3]="Jpeg",p[p.Webp=4]="Webp",p[p.Avif=5]="Avif",p[p.Mlt=6]="Mlt",p))($5||{});function t1(p){return p===1?".mvt":p===2?".png":p===3?".jpg":p===4?".webp":p===5?".avif":p===6?".mlt":""}Ji(t1,"tileTypeExt");var Z5=127;function r1(p,l){let u=0,g=p.length-1;for(;u<=g;){let v=g+u>>1,x=l-p[v].tileId;if(x>0)u=v+1;else if(x<0)g=v-1;else return p[v]}return g>=0&&(p[g].runLength===0||l-p[g].tileId<p[g].runLength)?p[g]:null}Ji(r1,"findTile");var W5=class{constructor(l){this.file=l}getKey(){return this.file.name}getBytes(l,u){return Ps(this,null,function*(){return{data:yield this.file.slice(l,l+u).arrayBuffer()}})}};Ji(W5,"FileSource");var i1=class{constructor(l,u=new Headers){var g,v;this.url=l,this.customHeaders=u,this.mustReload=!1;let x="";"navigator"in globalThis&&(x=(v=(g=globalThis.navigator)==null?void 0:g.userAgent)!=null?v:"");let b=x.indexOf("Windows")>-1,s=/Chrome|Chromium|Edg|OPR|Brave/.test(x);this.chromeWindowsNoCache=!1,b&&s&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(l){this.customHeaders=l}getBytes(l,u,g,v){return Ps(this,null,function*(){let x,b;g?b=g:(x=new AbortController,b=x.signal);let s=new Headers(this.customHeaders);s.set("range",`bytes=${l}-${l+u-1}`);let E;this.mustReload?E="reload":this.chromeWindowsNoCache&&(E="no-store");let F=yield fetch(this.url,{signal:b,cache:E,headers:s});if(l===0&&F.status===416){let ne=F.headers.get("Content-Range");if(!ne||!ne.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let j=+ne.substr(8);F=yield fetch(this.url,{signal:b,cache:"reload",headers:{range:`bytes=0-${j-1}`}})}let B=F.headers.get("Etag");if(B!=null&&B.startsWith("W/")&&(B=null),F.status===416||v&&B&&B!==v)throw this.mustReload=!0,new $p(`Server returned non-matching ETag ${v} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(F.status>=300)throw new Error(`Bad response code: ${F.status}`);let Q=F.headers.get("Content-Length");if(F.status===200&&(!Q||+Q>u))throw x&&x.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield F.arrayBuffer(),etag:B||void 0,cacheControl:F.headers.get("Cache-Control")||void 0,expires:F.headers.get("Expires")||void 0}})}};Ji(i1,"FetchSource");var H5=i1;function No(p,l){let u=p.getUint32(l+4,!0),g=p.getUint32(l+0,!0);return u*j5(2,32)+g}Ji(No,"getUint64");function n1(p,l){let u=new DataView(p),g=u.getUint8(7);if(g>3)throw new Error(`Archive is spec version ${g} but this library supports up to spec version 3`);return{specVersion:g,rootDirectoryOffset:No(u,8),rootDirectoryLength:No(u,16),jsonMetadataOffset:No(u,24),jsonMetadataLength:No(u,32),leafDirectoryOffset:No(u,40),leafDirectoryLength:No(u,48),tileDataOffset:No(u,56),tileDataLength:No(u,64),numAddressedTiles:No(u,72),numTileEntries:No(u,80),numTileContents:No(u,88),clustered:u.getUint8(96)===1,internalCompression:u.getUint8(97),tileCompression:u.getUint8(98),tileType:u.getUint8(99),minZoom:u.getUint8(100),maxZoom:u.getUint8(101),minLon:u.getInt32(102,!0)/1e7,minLat:u.getInt32(106,!0)/1e7,maxLon:u.getInt32(110,!0)/1e7,maxLat:u.getInt32(114,!0)/1e7,centerZoom:u.getUint8(118),centerLon:u.getInt32(119,!0)/1e7,centerLat:u.getInt32(123,!0)/1e7,etag:l}}Ji(n1,"bytesToHeader");function em(p){let l={buf:new Uint8Array(p),pos:0},u=sh(l),g=[],v=0;for(let x=0;x<u;x++){let b=sh(l);g.push({tileId:v+b,offset:0,length:0,runLength:1}),v+=b}for(let x=0;x<u;x++)g[x].runLength=sh(l);for(let x=0;x<u;x++)g[x].length=sh(l);for(let x=0;x<u;x++){let b=sh(l);b===0&&x>0?g[x].offset=g[x-1].offset+g[x-1].length:g[x].offset=b-1}return g}Ji(em,"deserializeIndex");var s1=class extends Error{};Ji(s1,"EtagMismatch");var $p=s1;function tm(p,l){return Ps(this,null,function*(){let u=yield p.getBytes(0,16384);if(new DataView(u.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let g=u.data.slice(0,Z5),v=n1(g,u.etag),x=u.data.slice(v.rootDirectoryOffset,v.rootDirectoryOffset+v.rootDirectoryLength),b=`${p.getKey()}|${v.etag||""}|${v.rootDirectoryOffset}|${v.rootDirectoryLength}`,s=em(yield l(x,v.internalCompression));return[v,[b,s.length,s]]})}Ji(tm,"getHeaderAndRoot");function rm(p,l,u,g,v){return Ps(this,null,function*(){let x=yield p.getBytes(u,g,void 0,v.etag),b=yield l(x.data,v.internalCompression),s=em(b);if(s.length===0)throw new Error("Empty directory is invalid");return s})}Ji(rm,"getDirectory");var X5=class{constructor(l=100,u=!0,g=ef){this.cache=new Map,this.maxCacheEntries=l,this.counter=1,this.decompress=g}getHeader(l){return Ps(this,null,function*(){let u=l.getKey(),g=this.cache.get(u);if(g)return g.lastUsed=this.counter++,g.data;let v=yield tm(l,this.decompress);return v[1]&&this.cache.set(v[1][0],{lastUsed:this.counter++,data:v[1][2]}),this.cache.set(u,{lastUsed:this.counter++,data:v[0]}),this.prune(),v[0]})}getDirectory(l,u,g,v){return Ps(this,null,function*(){let x=`${l.getKey()}|${v.etag||""}|${u}|${g}`,b=this.cache.get(x);if(b)return b.lastUsed=this.counter++,b.data;let s=yield rm(l,this.decompress,u,g,v);return this.cache.set(x,{lastUsed:this.counter++,data:s}),this.prune(),s})}prune(){if(this.cache.size>this.maxCacheEntries){let l=1/0,u;this.cache.forEach((g,v)=>{g.lastUsed<l&&(l=g.lastUsed,u=v)}),u&&this.cache.delete(u)}}invalidate(l){return Ps(this,null,function*(){this.cache.delete(l.getKey())})}};Ji(X5,"ResolvedValueCache");var a1=class{constructor(l=100,u=!0,g=ef){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=l,this.counter=1,this.decompress=g}getHeader(l){return Ps(this,null,function*(){let u=l.getKey(),g=this.cache.get(u);if(g)return g.lastUsed=this.counter++,yield g.data;let v=new Promise((x,b)=>{tm(l,this.decompress).then(s=>{s[1]&&this.cache.set(s[1][0],{lastUsed:this.counter++,data:Promise.resolve(s[1][2])}),x(s[0]),this.prune()}).catch(s=>{b(s)})});return this.cache.set(u,{lastUsed:this.counter++,data:v}),v})}getDirectory(l,u,g,v){return Ps(this,null,function*(){let x=`${l.getKey()}|${v.etag||""}|${u}|${g}`,b=this.cache.get(x);if(b)return b.lastUsed=this.counter++,yield b.data;let s=new Promise((E,F)=>{rm(l,this.decompress,u,g,v).then(B=>{E(B),this.prune()}).catch(B=>{F(B)})});return this.cache.set(x,{lastUsed:this.counter++,data:s}),s})}prune(){if(this.cache.size>=this.maxCacheEntries){let l=1/0,u;this.cache.forEach((g,v)=>{g.lastUsed<l&&(l=g.lastUsed,u=v)}),u&&this.cache.delete(u)}}invalidate(l){return Ps(this,null,function*(){let u=l.getKey();if(this.invalidations.get(u))return yield this.invalidations.get(u);this.cache.delete(l.getKey());let g=new Promise((v,x)=>{this.getHeader(l).then(b=>{v(),this.invalidations.delete(u)}).catch(b=>{x(b)})});this.invalidations.set(u,g)})}};Ji(a1,"SharedPromiseCache");var Y5=a1,o1=class{constructor(l,u,g){typeof l=="string"?this.source=new H5(l):this.source=l,g?this.decompress=g:this.decompress=ef,u?this.cache=u:this.cache=new Y5}getHeader(){return Ps(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(l,u,g,v){return Ps(this,null,function*(){let x=Q0(l,u,g),b=yield this.cache.getHeader(this.source);if(l<b.minZoom||l>b.maxZoom)return;let s=b.rootDirectoryOffset,E=b.rootDirectoryLength;for(let F=0;F<=3;F++){let B=yield this.cache.getDirectory(this.source,s,E,b),Q=r1(B,x);if(Q){if(Q.runLength>0){let ne=yield this.source.getBytes(b.tileDataOffset+Q.offset,Q.length,v,b.etag);return{data:yield this.decompress(ne.data,b.tileCompression),cacheControl:ne.cacheControl,expires:ne.expires}}s=b.leafDirectoryOffset+Q.offset,E=Q.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(l,u,g,v){return Ps(this,null,function*(){try{return yield this.getZxyAttempt(l,u,g,v)}catch(x){if(x instanceof $p)return this.cache.invalidate(this.source),yield this.getZxyAttempt(l,u,g,v);throw x}})}getMetadataAttempt(){return Ps(this,null,function*(){let l=yield this.cache.getHeader(this.source),u=yield this.source.getBytes(l.jsonMetadataOffset,l.jsonMetadataLength,void 0,l.etag),g=yield this.decompress(u.data,l.internalCompression),v=new TextDecoder("utf-8");return JSON.parse(v.decode(g))})}getMetadata(){return Ps(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(l){if(l instanceof $p)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw l}})}getTileJson(l){return Ps(this,null,function*(){let u=yield this.getHeader(),g=yield this.getMetadata(),v=t1(u.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${l}/{z}/{x}/{y}${v}`],vector_layers:g.vector_layers,attribution:g.attribution,description:g.description,name:g.name,version:g.version,bounds:[u.minLon,u.minLat,u.maxLon,u.maxLat],center:[u.centerLon,u.centerLat,u.centerZoom],minzoom:u.minZoom,maxzoom:u.maxZoom}})}};Ji(o1,"PMTiles");var Vy=o1,jh={exports:{}},J5=jh.exports,Uy;function K5(){return Uy||(Uy=1,(function(p,l){(function(u,g){g(l)})(J5,function(u){const g=new Uint8Array([102,103,98,3,102,103,98,0]),v=new Int32Array(2),x=new Float32Array(v.buffer),b=new Float64Array(v.buffer),s=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var E,F;(function(Y){Y[Y.UTF8_BYTES=1]="UTF8_BYTES",Y[Y.UTF16_STRING=2]="UTF16_STRING"})(E||(E={}));class B{constructor(P){this.bytes_=P,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(P){return new B(new Uint8Array(P))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(P){this.position_=P}capacity(){return this.bytes_.length}readInt8(P){return this.readUint8(P)<<24>>24}readUint8(P){return this.bytes_[P]}readInt16(P){return this.readUint16(P)<<16>>16}readUint16(P){return this.bytes_[P]|this.bytes_[P+1]<<8}readInt32(P){return this.bytes_[P]|this.bytes_[P+1]<<8|this.bytes_[P+2]<<16|this.bytes_[P+3]<<24}readUint32(P){return this.readInt32(P)>>>0}readInt64(P){return BigInt.asIntN(64,BigInt(this.readUint32(P))+(BigInt(this.readUint32(P+4))<<BigInt(32)))}readUint64(P){return BigInt.asUintN(64,BigInt(this.readUint32(P))+(BigInt(this.readUint32(P+4))<<BigInt(32)))}readFloat32(P){return v[0]=this.readInt32(P),x[0]}readFloat64(P){return v[s?0:1]=this.readInt32(P),v[s?1:0]=this.readInt32(P+4),b[0]}writeInt8(P,k){this.bytes_[P]=k}writeUint8(P,k){this.bytes_[P]=k}writeInt16(P,k){this.bytes_[P]=k,this.bytes_[P+1]=k>>8}writeUint16(P,k){this.bytes_[P]=k,this.bytes_[P+1]=k>>8}writeInt32(P,k){this.bytes_[P]=k,this.bytes_[P+1]=k>>8,this.bytes_[P+2]=k>>16,this.bytes_[P+3]=k>>24}writeUint32(P,k){this.bytes_[P]=k,this.bytes_[P+1]=k>>8,this.bytes_[P+2]=k>>16,this.bytes_[P+3]=k>>24}writeInt64(P,k){this.writeInt32(P,Number(BigInt.asIntN(32,k))),this.writeInt32(P+4,Number(BigInt.asIntN(32,k>>BigInt(32))))}writeUint64(P,k){this.writeUint32(P,Number(BigInt.asUintN(32,k))),this.writeUint32(P+4,Number(BigInt.asUintN(32,k>>BigInt(32))))}writeFloat32(P,k){x[0]=k,this.writeInt32(P,v[0])}writeFloat64(P,k){b[0]=k,this.writeInt32(P,v[s?0:1]),this.writeInt32(P+4,v[s?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+4+4)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let P="";for(let k=0;k<4;k++)P+=String.fromCharCode(this.readInt8(this.position_+4+k));return P}__offset(P,k){const ee=P-this.readInt32(P);return k<this.readInt16(ee)?this.readInt16(ee+k):0}__union(P,k){return P.bb_pos=k+this.readInt32(k),P.bb=this,P}__string(P,k){P+=this.readInt32(P);const ee=this.readInt32(P);P+=4;const le=this.bytes_.subarray(P,P+ee);return k===E.UTF8_BYTES?le:this.text_decoder_.decode(le)}__union_with_string(P,k){return typeof P=="string"?this.__string(k):this.__union(P,k)}__indirect(P){return P+this.readInt32(P)}__vector(P){return P+this.readInt32(P)+4}__vector_len(P){return this.readInt32(P+this.readInt32(P))}__has_identifier(P){if(P.length!=4)throw new Error("FlatBuffers: file identifier must be length 4");for(let k=0;k<4;k++)if(P.charCodeAt(k)!=this.readInt8(this.position()+4+k))return!1;return!0}createScalarList(P,k){const ee=[];for(let le=0;le<k;++le){const ge=P(le);ge!==null&&ee.push(ge)}return ee}createObjList(P,k){const ee=[];for(let le=0;le<k;++le){const ge=P(le);ge!==null&&ee.push(ge.unpack())}return ee}}class Q{constructor(P){let k;this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder,k=P||1024,this.bb=B.allocate(k),this.space=k}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(P){this.force_defaults=P}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(P,k){P>this.minalign&&(this.minalign=P);const ee=1+~(this.bb.capacity()-this.space+k)&P-1;for(;this.space<ee+P+k;){const le=this.bb.capacity();this.bb=Q.growByteBuffer(this.bb),this.space+=this.bb.capacity()-le}this.pad(ee)}pad(P){for(let k=0;k<P;k++)this.bb.writeInt8(--this.space,0)}writeInt8(P){this.bb.writeInt8(this.space-=1,P)}writeInt16(P){this.bb.writeInt16(this.space-=2,P)}writeInt32(P){this.bb.writeInt32(this.space-=4,P)}writeInt64(P){this.bb.writeInt64(this.space-=8,P)}writeFloat32(P){this.bb.writeFloat32(this.space-=4,P)}writeFloat64(P){this.bb.writeFloat64(this.space-=8,P)}addInt8(P){this.prep(1,0),this.writeInt8(P)}addInt16(P){this.prep(2,0),this.writeInt16(P)}addInt32(P){this.prep(4,0),this.writeInt32(P)}addInt64(P){this.prep(8,0),this.writeInt64(P)}addFloat32(P){this.prep(4,0),this.writeFloat32(P)}addFloat64(P){this.prep(8,0),this.writeFloat64(P)}addFieldInt8(P,k,ee){(this.force_defaults||k!=ee)&&(this.addInt8(k),this.slot(P))}addFieldInt16(P,k,ee){(this.force_defaults||k!=ee)&&(this.addInt16(k),this.slot(P))}addFieldInt32(P,k,ee){(this.force_defaults||k!=ee)&&(this.addInt32(k),this.slot(P))}addFieldInt64(P,k,ee){(this.force_defaults||k!==ee)&&(this.addInt64(k),this.slot(P))}addFieldFloat32(P,k,ee){(this.force_defaults||k!=ee)&&(this.addFloat32(k),this.slot(P))}addFieldFloat64(P,k,ee){(this.force_defaults||k!=ee)&&(this.addFloat64(k),this.slot(P))}addFieldOffset(P,k,ee){(this.force_defaults||k!=ee)&&(this.addOffset(k),this.slot(P))}addFieldStruct(P,k,ee){k!=ee&&(this.nested(k),this.slot(P))}nested(P){if(P!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(P){this.vtable!==null&&(this.vtable[P]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(P){const k=P.capacity();if(3221225472&k)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const ee=k<<1,le=B.allocate(ee);return le.setPosition(ee-k),le.bytes().set(P.bytes(),ee-k),le}addOffset(P){this.prep(4,0),this.writeInt32(this.offset()-P+4)}startObject(P){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=P;for(let k=0;k<P;k++)this.vtable[k]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const P=this.offset();let k=this.vtable_in_use-1;for(;k>=0&&this.vtable[k]==0;k--);const ee=k+1;for(;k>=0;k--)this.addInt16(this.vtable[k]!=0?P-this.vtable[k]:0);this.addInt16(P-this.object_start);const le=2*(ee+2);this.addInt16(le);let ge=0;const ie=this.space;e:for(k=0;k<this.vtables.length;k++){const ot=this.bb.capacity()-this.vtables[k];if(le==this.bb.readInt16(ot)){for(let Mt=2;Mt<le;Mt+=2)if(this.bb.readInt16(ie+Mt)!=this.bb.readInt16(ot+Mt))continue e;ge=this.vtables[k];break}}return ge?(this.space=this.bb.capacity()-P,this.bb.writeInt32(this.space,ge-P)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-P,this.offset()-P)),this.isNested=!1,P}finish(P,k,ee){const le=ee?4:0;if(k){const ge=k;if(this.prep(this.minalign,8+le),ge.length!=4)throw new TypeError("FlatBuffers: file identifier must be length 4");for(let ie=3;ie>=0;ie--)this.writeInt8(ge.charCodeAt(ie))}this.prep(this.minalign,4+le),this.addOffset(P),le&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(P,k){this.finish(P,k,!0)}requiredField(P,k){const ee=this.bb.capacity()-P,le=ee-this.bb.readInt32(ee);if(!(k<this.bb.readInt16(le)&&this.bb.readInt16(le+k)!=0))throw new TypeError("FlatBuffers: field "+k+" must be set")}startVector(P,k,ee){this.notNested(),this.vector_num_elems=k,this.prep(4,P*k),this.prep(ee,P*k)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(P){if(!P)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(P))return this.string_maps.get(P);const k=this.createString(P);return this.string_maps.set(P,k),k}createString(P){if(P==null)return 0;let k;return k=P instanceof Uint8Array?P:this.text_encoder.encode(P),this.addInt8(0),this.startVector(1,k.length,1),this.bb.setPosition(this.space-=k.length),this.bb.bytes().set(k,this.space),this.endVector()}createByteVector(P){return P==null?0:(this.startVector(1,P.length,1),this.bb.setPosition(this.space-=P.length),this.bb.bytes().set(P,this.space),this.endVector())}createObjectOffset(P){return P===null?0:typeof P=="string"?this.createString(P):P.pack(this)}createObjectOffsetList(P){const k=[];for(let ee=0;ee<P.length;++ee){const le=P[ee];if(le===null)throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.");k.push(this.createObjectOffset(le))}return k}createStructOffsetList(P,k){return k(this,P.length),this.createObjectOffsetList(P.slice().reverse()),this.endVector()}}var ne,j=((F={})[F.Byte=0]="Byte",F[F.UByte=1]="UByte",F[F.Bool=2]="Bool",F[F.Short=3]="Short",F[F.UShort=4]="UShort",F[F.Int=5]="Int",F[F.UInt=6]="UInt",F[F.Long=7]="Long",F[F.ULong=8]="ULong",F[F.Float=9]="Float",F[F.Double=10]="Double",F[F.String=11]="String",F[F.Json=12]="Json",F[F.DateTime=13]="DateTime",F[F.Binary=14]="Binary",F);class Ie{bb=null;bb_pos=0;__init(P,k){return this.bb_pos=P,this.bb=k,this}static getRootAsColumn(P,k){return(k||new Ie).__init(P.readInt32(P.position())+P.position(),P)}static getSizePrefixedRootAsColumn(P,k){return P.setPosition(P.position()+4),(k||new Ie).__init(P.readInt32(P.position())+P.position(),P)}name(P){let k=this.bb.__offset(this.bb_pos,4);return k?this.bb.__string(this.bb_pos+k,P):null}type(){let P=this.bb.__offset(this.bb_pos,6);return P?this.bb.readUint8(this.bb_pos+P):j.Byte}title(P){let k=this.bb.__offset(this.bb_pos,8);return k?this.bb.__string(this.bb_pos+k,P):null}description(P){let k=this.bb.__offset(this.bb_pos,10);return k?this.bb.__string(this.bb_pos+k,P):null}width(){let P=this.bb.__offset(this.bb_pos,12);return P?this.bb.readInt32(this.bb_pos+P):-1}precision(){let P=this.bb.__offset(this.bb_pos,14);return P?this.bb.readInt32(this.bb_pos+P):-1}scale(){let P=this.bb.__offset(this.bb_pos,16);return P?this.bb.readInt32(this.bb_pos+P):-1}nullable(){let P=this.bb.__offset(this.bb_pos,18);return!P||!!this.bb.readInt8(this.bb_pos+P)}unique(){let P=this.bb.__offset(this.bb_pos,20);return!!P&&!!this.bb.readInt8(this.bb_pos+P)}primaryKey(){let P=this.bb.__offset(this.bb_pos,22);return!!P&&!!this.bb.readInt8(this.bb_pos+P)}metadata(P){let k=this.bb.__offset(this.bb_pos,24);return k?this.bb.__string(this.bb_pos+k,P):null}static startColumn(P){P.startObject(11)}static addName(P,k){P.addFieldOffset(0,k,0)}static addType(P,k){P.addFieldInt8(1,k,j.Byte)}static addTitle(P,k){P.addFieldOffset(2,k,0)}static addDescription(P,k){P.addFieldOffset(3,k,0)}static addWidth(P,k){P.addFieldInt32(4,k,-1)}static addPrecision(P,k){P.addFieldInt32(5,k,-1)}static addScale(P,k){P.addFieldInt32(6,k,-1)}static addNullable(P,k){P.addFieldInt8(7,+k,1)}static addUnique(P,k){P.addFieldInt8(8,+k,0)}static addPrimaryKey(P,k){P.addFieldInt8(9,+k,0)}static addMetadata(P,k){P.addFieldOffset(10,k,0)}static endColumn(P){let k=P.endObject();return P.requiredField(k,4),k}static createColumn(P,k,ee,le,ge,ie,ot,Mt,ct,dt,Dt,Ct){return Ie.startColumn(P),Ie.addName(P,k),Ie.addType(P,ee),Ie.addTitle(P,le),Ie.addDescription(P,ge),Ie.addWidth(P,ie),Ie.addPrecision(P,ot),Ie.addScale(P,Mt),Ie.addNullable(P,ct),Ie.addUnique(P,dt),Ie.addPrimaryKey(P,Dt),Ie.addMetadata(P,Ct),Ie.endColumn(P)}}var he=((ne={})[ne.Unknown=0]="Unknown",ne[ne.Point=1]="Point",ne[ne.LineString=2]="LineString",ne[ne.Polygon=3]="Polygon",ne[ne.MultiPoint=4]="MultiPoint",ne[ne.MultiLineString=5]="MultiLineString",ne[ne.MultiPolygon=6]="MultiPolygon",ne[ne.GeometryCollection=7]="GeometryCollection",ne[ne.CircularString=8]="CircularString",ne[ne.CompoundCurve=9]="CompoundCurve",ne[ne.CurvePolygon=10]="CurvePolygon",ne[ne.MultiCurve=11]="MultiCurve",ne[ne.MultiSurface=12]="MultiSurface",ne[ne.Curve=13]="Curve",ne[ne.Surface=14]="Surface",ne[ne.PolyhedralSurface=15]="PolyhedralSurface",ne[ne.TIN=16]="TIN",ne[ne.Triangle=17]="Triangle",ne);class re{bb=null;bb_pos=0;__init(P,k){return this.bb_pos=P,this.bb=k,this}static getRootAsGeometry(P,k){return(k||new re).__init(P.readInt32(P.position())+P.position(),P)}static getSizePrefixedRootAsGeometry(P,k){return P.setPosition(P.position()+4),(k||new re).__init(P.readInt32(P.position())+P.position(),P)}ends(P){let k=this.bb.__offset(this.bb_pos,4);return k?this.bb.readUint32(this.bb.__vector(this.bb_pos+k)+4*P):0}endsLength(){let P=this.bb.__offset(this.bb_pos,4);return P?this.bb.__vector_len(this.bb_pos+P):0}endsArray(){let P=this.bb.__offset(this.bb_pos,4);return P?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+P),this.bb.__vector_len(this.bb_pos+P)):null}xy(P){let k=this.bb.__offset(this.bb_pos,6);return k?this.bb.readFloat64(this.bb.__vector(this.bb_pos+k)+8*P):0}xyLength(){let P=this.bb.__offset(this.bb_pos,6);return P?this.bb.__vector_len(this.bb_pos+P):0}xyArray(){let P=this.bb.__offset(this.bb_pos,6);return P?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+P),this.bb.__vector_len(this.bb_pos+P)):null}z(P){let k=this.bb.__offset(this.bb_pos,8);return k?this.bb.readFloat64(this.bb.__vector(this.bb_pos+k)+8*P):0}zLength(){let P=this.bb.__offset(this.bb_pos,8);return P?this.bb.__vector_len(this.bb_pos+P):0}zArray(){let P=this.bb.__offset(this.bb_pos,8);return P?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+P),this.bb.__vector_len(this.bb_pos+P)):null}m(P){let k=this.bb.__offset(this.bb_pos,10);return k?this.bb.readFloat64(this.bb.__vector(this.bb_pos+k)+8*P):0}mLength(){let P=this.bb.__offset(this.bb_pos,10);return P?this.bb.__vector_len(this.bb_pos+P):0}mArray(){let P=this.bb.__offset(this.bb_pos,10);return P?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+P),this.bb.__vector_len(this.bb_pos+P)):null}t(P){let k=this.bb.__offset(this.bb_pos,12);return k?this.bb.readFloat64(this.bb.__vector(this.bb_pos+k)+8*P):0}tLength(){let P=this.bb.__offset(this.bb_pos,12);return P?this.bb.__vector_len(this.bb_pos+P):0}tArray(){let P=this.bb.__offset(this.bb_pos,12);return P?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+P),this.bb.__vector_len(this.bb_pos+P)):null}tm(P){let k=this.bb.__offset(this.bb_pos,14);return k?this.bb.readUint64(this.bb.__vector(this.bb_pos+k)+8*P):BigInt(0)}tmLength(){let P=this.bb.__offset(this.bb_pos,14);return P?this.bb.__vector_len(this.bb_pos+P):0}type(){let P=this.bb.__offset(this.bb_pos,16);return P?this.bb.readUint8(this.bb_pos+P):he.Unknown}parts(P,k){let ee=this.bb.__offset(this.bb_pos,18);return ee?(k||new re).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+ee)+4*P),this.bb):null}partsLength(){let P=this.bb.__offset(this.bb_pos,18);return P?this.bb.__vector_len(this.bb_pos+P):0}static startGeometry(P){P.startObject(8)}static addEnds(P,k){P.addFieldOffset(0,k,0)}static createEndsVector(P,k){P.startVector(4,k.length,4);for(let ee=k.length-1;ee>=0;ee--)P.addInt32(k[ee]);return P.endVector()}static startEndsVector(P,k){P.startVector(4,k,4)}static addXy(P,k){P.addFieldOffset(1,k,0)}static createXyVector(P,k){P.startVector(8,k.length,8);for(let ee=k.length-1;ee>=0;ee--)P.addFloat64(k[ee]);return P.endVector()}static startXyVector(P,k){P.startVector(8,k,8)}static addZ(P,k){P.addFieldOffset(2,k,0)}static createZVector(P,k){P.startVector(8,k.length,8);for(let ee=k.length-1;ee>=0;ee--)P.addFloat64(k[ee]);return P.endVector()}static startZVector(P,k){P.startVector(8,k,8)}static addM(P,k){P.addFieldOffset(3,k,0)}static createMVector(P,k){P.startVector(8,k.length,8);for(let ee=k.length-1;ee>=0;ee--)P.addFloat64(k[ee]);return P.endVector()}static startMVector(P,k){P.startVector(8,k,8)}static addT(P,k){P.addFieldOffset(4,k,0)}static createTVector(P,k){P.startVector(8,k.length,8);for(let ee=k.length-1;ee>=0;ee--)P.addFloat64(k[ee]);return P.endVector()}static startTVector(P,k){P.startVector(8,k,8)}static addTm(P,k){P.addFieldOffset(5,k,0)}static createTmVector(P,k){P.startVector(8,k.length,8);for(let ee=k.length-1;ee>=0;ee--)P.addInt64(k[ee]);return P.endVector()}static startTmVector(P,k){P.startVector(8,k,8)}static addType(P,k){P.addFieldInt8(6,k,he.Unknown)}static addParts(P,k){P.addFieldOffset(7,k,0)}static createPartsVector(P,k){P.startVector(4,k.length,4);for(let ee=k.length-1;ee>=0;ee--)P.addOffset(k[ee]);return P.endVector()}static startPartsVector(P,k){P.startVector(4,k,4)}static endGeometry(P){return P.endObject()}static createGeometry(P,k,ee,le,ge,ie,ot,Mt,ct){return re.startGeometry(P),re.addEnds(P,k),re.addXy(P,ee),re.addZ(P,le),re.addM(P,ge),re.addT(P,ie),re.addTm(P,ot),re.addType(P,Mt),re.addParts(P,ct),re.endGeometry(P)}}class ye{bb=null;bb_pos=0;__init(P,k){return this.bb_pos=P,this.bb=k,this}static getRootAsFeature(P,k){return(k||new ye).__init(P.readInt32(P.position())+P.position(),P)}static getSizePrefixedRootAsFeature(P,k){return P.setPosition(P.position()+4),(k||new ye).__init(P.readInt32(P.position())+P.position(),P)}geometry(P){let k=this.bb.__offset(this.bb_pos,4);return k?(P||new re).__init(this.bb.__indirect(this.bb_pos+k),this.bb):null}properties(P){let k=this.bb.__offset(this.bb_pos,6);return k?this.bb.readUint8(this.bb.__vector(this.bb_pos+k)+P):0}propertiesLength(){let P=this.bb.__offset(this.bb_pos,6);return P?this.bb.__vector_len(this.bb_pos+P):0}propertiesArray(){let P=this.bb.__offset(this.bb_pos,6);return P?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+P),this.bb.__vector_len(this.bb_pos+P)):null}columns(P,k){let ee=this.bb.__offset(this.bb_pos,8);return ee?(k||new Ie).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+ee)+4*P),this.bb):null}columnsLength(){let P=this.bb.__offset(this.bb_pos,8);return P?this.bb.__vector_len(this.bb_pos+P):0}static startFeature(P){P.startObject(3)}static addGeometry(P,k){P.addFieldOffset(0,k,0)}static addProperties(P,k){P.addFieldOffset(1,k,0)}static createPropertiesVector(P,k){P.startVector(1,k.length,1);for(let ee=k.length-1;ee>=0;ee--)P.addInt8(k[ee]);return P.endVector()}static startPropertiesVector(P,k){P.startVector(1,k,1)}static addColumns(P,k){P.addFieldOffset(2,k,0)}static createColumnsVector(P,k){P.startVector(4,k.length,4);for(let ee=k.length-1;ee>=0;ee--)P.addOffset(k[ee]);return P.endVector()}static startColumnsVector(P,k){P.startVector(4,k,4)}static endFeature(P){return P.endObject()}static finishFeatureBuffer(P,k){P.finish(k)}static finishSizePrefixedFeatureBuffer(P,k){P.finish(k,void 0,!0)}static createFeature(P,k,ee,le){return ye.startFeature(P),ye.addGeometry(P,k),ye.addProperties(P,ee),ye.addColumns(P,le),ye.endFeature(P)}}function Je(Y,P){let k,ee,le,{xy:ge,z:ie,m:ot,ends:Mt,parts:ct,type:dt}=P;if(ct){let Ct=ct.map(Gt=>Je(Y,Gt)),Ht=re.createPartsVector(Y,Ct);return re.startGeometry(Y),re.addParts(Y,Ht),re.addType(Y,dt),re.endGeometry(Y)}let Dt=re.createXyVector(Y,ge);return ie&&(k=re.createZVector(Y,ie)),ot&&(ee=re.createMVector(Y,ot)),Mt&&(le=re.createEndsVector(Y,Mt)),re.startGeometry(Y),le&&re.addEnds(Y,le),re.addXy(Y,Dt),k&&re.addZ(Y,k),ee&&re.addM(Y,ee),re.addType(Y,dt),re.endGeometry(Y)}function Be(Y,P,k){if(Y.length!==0)if(Array.isArray(Y[0]))for(let ee of Y)Be(ee,P,k);else Y.length===2?P.push(...Y):(P.push(Y[0],Y[1]),k.push(Y[2]))}function De(Y,P){let k=[];for(let ee=0;ee<Y.length;ee+=2){let le=[Y[ee],Y[ee+1]];P&&le.push(P[ee>>1]),k.push(le)}return k}function Ue(Y){return Y?he[Y]:he.Unknown}let $e=new TextEncoder,st=new TextDecoder;function Ze(Y,P,k){let ee=k.columns,le=new Q,ge=0,ie=1024,ot=new Uint8Array(1024),Mt=new DataView(ot.buffer),ct=Ht=>{if(ge+Ht<ie)return;let Gt=new Uint8Array(ie=Math.max(ie+Ht,2*ie));Gt.set(ot),Mt=new DataView((ot=Gt).buffer)};if(ee)for(let Ht=0;Ht<ee.length;Ht++){let Gt=ee[Ht],dr=P[Gt.name];if(dr!==null)switch(ct(2),Mt.setUint16(ge,Ht,!0),ge+=2,Gt.type){case j.Bool:ct(1),Mt.setUint8(ge,dr),ge+=1;break;case j.Short:ct(2),Mt.setInt16(ge,dr,!0),ge+=2;break;case j.UShort:ct(2),Mt.setUint16(ge,dr,!0),ge+=2;break;case j.Int:ct(4),Mt.setInt32(ge,dr,!0),ge+=4;break;case j.UInt:ct(4),Mt.setUint32(ge,dr,!0),ge+=4;break;case j.Long:ct(8),Mt.setBigInt64(ge,BigInt(dr),!0),ge+=8;break;case j.Float:ct(4),Mt.setFloat32(ge,dr,!0),ge+=4;break;case j.Double:ct(8),Mt.setFloat64(ge,dr,!0),ge+=8;break;case j.DateTime:case j.String:{let vr=$e.encode(dr);ct(4),Mt.setUint32(ge,vr.length,!0),ge+=4,ct(vr.length),ot.set(vr,ge),ge+=vr.length;break}case j.Json:{let vr=$e.encode(JSON.stringify(dr));ct(4),Mt.setUint32(ge,vr.length,!0),ge+=4,ct(vr.length),ot.set(vr,ge),ge+=vr.length;break}case j.Binary:ct(4),Mt.setUint32(ge,dr.length,!0),ge+=4,ct(dr.length),ot.set(dr,ge),ge+=dr.length;break;default:throw Error(`Unknown type ${Gt.type}`)}}let dt=0;ge>0&&(dt=ye.createPropertiesVector(le,ot.slice(0,ge)));let Dt=Je(le,Y);ye.startFeature(le),ye.addGeometry(le,Dt),dt&&ye.addProperties(le,dt);let Ct=ye.endFeature(le);return le.finishSizePrefixed(Ct),le.asUint8Array()}function Pe(Y,P){let k={};if(!P||P.length===0)return k;let ee=Y.propertiesArray();if(!ee)return k;let le=new DataView(ee.buffer,ee.byteOffset),ge=Y.propertiesLength(),ie=0;for(;ie<ge;){let ot=le.getUint16(ie,!0);ie+=2;let Mt=P[ot],ct=Mt.name;switch(Mt.type){case j.Bool:k[ct]=!!le.getUint8(ie),ie+=1;break;case j.Byte:k[ct]=le.getInt8(ie),ie+=1;break;case j.UByte:k[ct]=le.getUint8(ie),ie+=1;break;case j.Short:k[ct]=le.getInt16(ie,!0),ie+=2;break;case j.UShort:k[ct]=le.getUint16(ie,!0),ie+=2;break;case j.Int:k[ct]=le.getInt32(ie,!0),ie+=4;break;case j.UInt:k[ct]=le.getUint32(ie,!0),ie+=4;break;case j.Long:k[ct]=Number(le.getBigInt64(ie,!0)),ie+=8;break;case j.ULong:k[ct]=Number(le.getBigUint64(ie,!0)),ie+=8;break;case j.Float:k[ct]=le.getFloat32(ie,!0),ie+=4;break;case j.Double:k[ct]=le.getFloat64(ie,!0),ie+=8;break;case j.DateTime:case j.String:{let dt=le.getUint32(ie,!0);ie+=4,k[ct]=st.decode(ee.subarray(ie,ie+dt)),ie+=dt;break}case j.Json:{let dt=le.getUint32(ie,!0);ie+=4;let Dt=st.decode(ee.subarray(ie,ie+dt));k[ct]=JSON.parse(Dt),ie+=dt;break}case j.Binary:{let dt=le.getUint32(ie,!0);ie+=4,k[ct]=ee.subarray(ie,ie+dt),ie+=dt;break}default:throw Error(`Unknown type ${Mt.type}`)}}return k}var rt=new Uint8Array(0);function _e(Y,P){if(!Y.length)return P;if(!P.length)return Y;var k=new Uint8Array(Y.length+P.length);return k.set(Y),k.set(P,Y.length),k}function we(Y){this._source=Y,this._array=rt,this._index=0}we.prototype.read=function(){var Y=this,P=Y._array.subarray(Y._index);return Y._source.read().then(function(k){return Y._array=rt,Y._index=0,k.done?P.length>0?{done:!1,value:P}:{done:!0,value:void 0}:{done:!1,value:_e(P,k.value)}})},we.prototype.slice=function(Y){if((Y|=0)<0)throw new Error("invalid length");var P=this,k=this._array.length-this._index;if(this._index+Y<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=Y));var ee=new Uint8Array(Y);return ee.set(this._array.subarray(this._index)),(function le(){return P._source.read().then(function(ge){return ge.done?(P._array=rt,P._index=0,k>0?ee.subarray(0,k):null):k+ge.value.length>=Y?(P._array=ge.value,P._index=Y-k,ee.set(ge.value.subarray(0,Y-k),k),ee):(ee.set(ge.value,k),k+=ge.value.length,le())})})()},we.prototype.cancel=function(){return this._source.cancel()};class Ge{bb=null;bb_pos=0;__init(P,k){return this.bb_pos=P,this.bb=k,this}static getRootAsCrs(P,k){return(k||new Ge).__init(P.readInt32(P.position())+P.position(),P)}static getSizePrefixedRootAsCrs(P,k){return P.setPosition(P.position()+4),(k||new Ge).__init(P.readInt32(P.position())+P.position(),P)}org(P){let k=this.bb.__offset(this.bb_pos,4);return k?this.bb.__string(this.bb_pos+k,P):null}code(){let P=this.bb.__offset(this.bb_pos,6);return P?this.bb.readInt32(this.bb_pos+P):0}name(P){let k=this.bb.__offset(this.bb_pos,8);return k?this.bb.__string(this.bb_pos+k,P):null}description(P){let k=this.bb.__offset(this.bb_pos,10);return k?this.bb.__string(this.bb_pos+k,P):null}wkt(P){let k=this.bb.__offset(this.bb_pos,12);return k?this.bb.__string(this.bb_pos+k,P):null}codeString(P){let k=this.bb.__offset(this.bb_pos,14);return k?this.bb.__string(this.bb_pos+k,P):null}static startCrs(P){P.startObject(6)}static addOrg(P,k){P.addFieldOffset(0,k,0)}static addCode(P,k){P.addFieldInt32(1,k,0)}static addName(P,k){P.addFieldOffset(2,k,0)}static addDescription(P,k){P.addFieldOffset(3,k,0)}static addWkt(P,k){P.addFieldOffset(4,k,0)}static addCodeString(P,k){P.addFieldOffset(5,k,0)}static endCrs(P){return P.endObject()}static createCrs(P,k,ee,le,ge,ie,ot){return Ge.startCrs(P),Ge.addOrg(P,k),Ge.addCode(P,ee),Ge.addName(P,le),Ge.addDescription(P,ge),Ge.addWkt(P,ie),Ge.addCodeString(P,ot),Ge.endCrs(P)}}class Ye{bb=null;bb_pos=0;__init(P,k){return this.bb_pos=P,this.bb=k,this}static getRootAsHeader(P,k){return(k||new Ye).__init(P.readInt32(P.position())+P.position(),P)}static getSizePrefixedRootAsHeader(P,k){return P.setPosition(P.position()+4),(k||new Ye).__init(P.readInt32(P.position())+P.position(),P)}name(P){let k=this.bb.__offset(this.bb_pos,4);return k?this.bb.__string(this.bb_pos+k,P):null}envelope(P){let k=this.bb.__offset(this.bb_pos,6);return k?this.bb.readFloat64(this.bb.__vector(this.bb_pos+k)+8*P):0}envelopeLength(){let P=this.bb.__offset(this.bb_pos,6);return P?this.bb.__vector_len(this.bb_pos+P):0}envelopeArray(){let P=this.bb.__offset(this.bb_pos,6);return P?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+P),this.bb.__vector_len(this.bb_pos+P)):null}geometryType(){let P=this.bb.__offset(this.bb_pos,8);return P?this.bb.readUint8(this.bb_pos+P):he.Unknown}hasZ(){let P=this.bb.__offset(this.bb_pos,10);return!!P&&!!this.bb.readInt8(this.bb_pos+P)}hasM(){let P=this.bb.__offset(this.bb_pos,12);return!!P&&!!this.bb.readInt8(this.bb_pos+P)}hasT(){let P=this.bb.__offset(this.bb_pos,14);return!!P&&!!this.bb.readInt8(this.bb_pos+P)}hasTm(){let P=this.bb.__offset(this.bb_pos,16);return!!P&&!!this.bb.readInt8(this.bb_pos+P)}columns(P,k){let ee=this.bb.__offset(this.bb_pos,18);return ee?(k||new Ie).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+ee)+4*P),this.bb):null}columnsLength(){let P=this.bb.__offset(this.bb_pos,18);return P?this.bb.__vector_len(this.bb_pos+P):0}featuresCount(){let P=this.bb.__offset(this.bb_pos,20);return P?this.bb.readUint64(this.bb_pos+P):BigInt("0")}indexNodeSize(){let P=this.bb.__offset(this.bb_pos,22);return P?this.bb.readUint16(this.bb_pos+P):16}crs(P){let k=this.bb.__offset(this.bb_pos,24);return k?(P||new Ge).__init(this.bb.__indirect(this.bb_pos+k),this.bb):null}title(P){let k=this.bb.__offset(this.bb_pos,26);return k?this.bb.__string(this.bb_pos+k,P):null}description(P){let k=this.bb.__offset(this.bb_pos,28);return k?this.bb.__string(this.bb_pos+k,P):null}metadata(P){let k=this.bb.__offset(this.bb_pos,30);return k?this.bb.__string(this.bb_pos+k,P):null}static startHeader(P){P.startObject(14)}static addName(P,k){P.addFieldOffset(0,k,0)}static addEnvelope(P,k){P.addFieldOffset(1,k,0)}static createEnvelopeVector(P,k){P.startVector(8,k.length,8);for(let ee=k.length-1;ee>=0;ee--)P.addFloat64(k[ee]);return P.endVector()}static startEnvelopeVector(P,k){P.startVector(8,k,8)}static addGeometryType(P,k){P.addFieldInt8(2,k,he.Unknown)}static addHasZ(P,k){P.addFieldInt8(3,+k,0)}static addHasM(P,k){P.addFieldInt8(4,+k,0)}static addHasT(P,k){P.addFieldInt8(5,+k,0)}static addHasTm(P,k){P.addFieldInt8(6,+k,0)}static addColumns(P,k){P.addFieldOffset(7,k,0)}static createColumnsVector(P,k){P.startVector(4,k.length,4);for(let ee=k.length-1;ee>=0;ee--)P.addOffset(k[ee]);return P.endVector()}static startColumnsVector(P,k){P.startVector(4,k,4)}static addFeaturesCount(P,k){P.addFieldInt64(8,k,BigInt("0"))}static addIndexNodeSize(P,k){P.addFieldInt16(9,k,16)}static addCrs(P,k){P.addFieldOffset(10,k,0)}static addTitle(P,k){P.addFieldOffset(11,k,0)}static addDescription(P,k){P.addFieldOffset(12,k,0)}static addMetadata(P,k){P.addFieldOffset(13,k,0)}static endHeader(P){return P.endObject()}static finishHeaderBuffer(P,k){P.finish(k)}static finishSizePrefixedHeaderBuffer(P,k){P.finish(k,void 0,!0)}}function xt(Y){let P=Ye.getSizePrefixedRootAsHeader(Y),k=P.featuresCount(),ee=P.indexNodeSize(),le=[];for(let ot=0;ot<P.columnsLength();ot++){let Mt=P.columns(ot);if(!Mt)throw Error("Column unexpectedly missing");if(!Mt.name())throw Error("Column name unexpectedly missing");le.push({name:Mt.name(),type:Mt.type(),title:Mt.title(),description:Mt.description(),width:Mt.width(),precision:Mt.precision(),scale:Mt.scale(),nullable:Mt.nullable(),unique:Mt.unique(),primary_key:Mt.primaryKey()})}let ge=P.crs(),ie=ge?{org:ge.org(),code:ge.code(),name:ge.name(),description:ge.description(),wkt:ge.wkt(),code_string:ge.codeString()}:null;return{geometryType:P.geometryType(),columns:le,envelope:P.envelopeLength()>0?P.envelopeArray():null,featuresCount:Number(k),indexNodeSize:ee,crs:ie,title:P.title(),description:P.description(),metadata:P.metadata()}}class kt{static global=new kt;_extraRequestThreshold=262144;extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(P){if(P<0)throw Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=P}}function yt(Y,P){P=Math.min(Math.max(+P,2),65535);let k=Y,ee=k;do ee+=k=Math.ceil(k/P);while(k!==1);return 40*ee}async function*mt(Y,P,k,ee){class le{_level;nodes;constructor(Ht,Gt){this._level=Gt,this.nodes=Ht}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(Ht){this.nodes[1]=Ht}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}let{minX:ge,minY:ie,maxX:ot,maxY:Mt}=k,ct=(function(Ct,Ht){if(Ht<2)throw Error("Node size must be at least 2");if(Ct===0)throw Error("Number of items must be greater than 0");let Gt=Ct,dr=Gt,vr=[Gt];do dr+=Gt=Math.ceil(Gt/Ht),vr.push(Gt);while(Gt!==1);let Nr=[];for(let wr of(Gt=dr,vr))Nr.push(Gt-wr),Gt-=wr;let Lt=[];for(let wr=0;wr<vr.length;wr++)Lt.push([Nr[wr],Nr[wr]+vr[wr]]);return Lt})(Y,P),dt=ct[0][0],Dt=[new le([0,1],ct.length-1)];for(;Dt.length!==0;){let Ct=Dt.shift(),Ht=Ct.startNodeIdx(),Gt=Ht>=dt,dr=(()=>{let[,Lt]=ct[Ct.level()],wr=Math.min(Ct.endNodeIdx()+P,Lt);return Gt&&wr<Lt?wr+1:wr})(),vr=dr-Ht,Nr=new DataView(await ee(40*Ht,40*vr));for(let Lt=Ht;Lt<dr;Lt++){let wr=Lt-Ht,zi=40*wr;if(ot<Nr.getFloat64(zi+0,!0)||Mt<Nr.getFloat64(zi+8,!0)||ge>Nr.getFloat64(zi+16,!0)||ie>Nr.getFloat64(zi+24,!0))continue;let fn=Nr.getBigUint64(zi+32,!0);if(Gt){let Rr=(()=>{if(Lt<Y-1){let Rs=40*(wr+1);return Nr.getBigUint64(Rs+32,!0)-fn}return null})(),Ni=Lt-dt;yield[Number(fn),Ni,Number(Rr)];continue}let mi=kt.global.extraRequestThreshold()/40,Xt=Dt[Dt.length-1];if(Xt!==void 0&&Xt.level()===Ct.level()-1&&fn<Xt.endNodeIdx()+mi){Xt.extendEndNodeIdx(Number(fn));continue}let Er=(()=>{let Rr=Ct.level()-1;return new le([Number(fn),Number(fn)+1],Rr)})();Xt!==void 0&&(Xt.level(),Er.level()),Dt.push(Er)}}}class gt{bytes;header;headerLength;indexLength;constructor(P,k,ee,le){this.bytes=P,this.header=k,this.headerLength=ee,this.indexLength=le}static open(P){if(!P.subarray(0,3).every((ie,ot)=>g[ot]===ie))throw Error("Not a FlatGeobuf file");let k=new DataView(P.buffer).getUint32(g.length,!0);if(k>10485760||k<8)throw Error("Invalid header size");let ee=P.subarray(g.length,g.length+4+k),le=xt(new B(ee)),ge=yt(le.featuresCount,le.indexNodeSize);return new gt(P,le,k,ge)}async*selectBbox(P){let k=this.lengthBeforeTree(),ee=async(le,ge)=>{let ie=k+le;return this.bytes.slice(ie,ie+ge).buffer};for await(let le of mt(this.header.featuresCount,this.header.indexNodeSize,P,ee)){let[ge,ie]=le,ot=this.readFeature(ge);yield{id:ie,feature:ot}}}lengthBeforeTree(){return g.length+4+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}readFeature(P){let k=P+this.lengthBeforeFeatures(),ee=new DataView(this.bytes.buffer).getUint32(k,!0),le=this.bytes.subarray(k+4,k+4+ee),ge=new Uint8Array(ee+4);ge.set(le,4);let ie=new B(ge);return ye.getSizePrefixedRootAsFeature(ie)}}var Qt=function(Y,P){return Qt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,ee){k.__proto__=ee}||function(k,ee){for(var le in ee)ee.hasOwnProperty(le)&&(k[le]=ee[le])},Qt(Y,P)};function Vt(Y,P,k,ee){return new(k||(k=Promise))(function(le,ge){function ie(ct){try{Mt(ee.next(ct))}catch(dt){ge(dt)}}function ot(ct){try{Mt(ee.throw(ct))}catch(dt){ge(dt)}}function Mt(ct){var dt;ct.done?le(ct.value):(dt=ct.value,dt instanceof k?dt:new k(function(Dt){Dt(dt)})).then(ie,ot)}Mt((ee=ee.apply(Y,[])).next())})}function fe(Y,P){var k,ee,le,ge,ie={label:0,sent:function(){if(1&le[0])throw le[1];return le[1]},trys:[],ops:[]};return ge={next:ot(0),throw:ot(1),return:ot(2)},typeof Symbol=="function"&&(ge[Symbol.iterator]=function(){return this}),ge;function ot(Mt){return function(ct){return(function(dt){if(k)throw new TypeError("Generator is already executing.");for(;ie;)try{if(k=1,ee&&(le=2&dt[0]?ee.return:dt[0]?ee.throw||((le=ee.return)&&le.call(ee),0):ee.next)&&!(le=le.call(ee,dt[1])).done)return le;switch(ee=0,le&&(dt=[2&dt[0],le.value]),dt[0]){case 0:case 1:le=dt;break;case 4:return ie.label++,{value:dt[1],done:!1};case 5:ie.label++,ee=dt[1],dt=[0];continue;case 7:dt=ie.ops.pop(),ie.trys.pop();continue;default:if(le=ie.trys,!((le=le.length>0&&le[le.length-1])||dt[0]!==6&&dt[0]!==2)){ie=0;continue}if(dt[0]===3&&(!le||dt[1]>le[0]&&dt[1]<le[3])){ie.label=dt[1];break}if(dt[0]===6&&ie.label<le[1]){ie.label=le[1],le=dt;break}if(le&&ie.label<le[2]){ie.label=le[2],ie.ops.push(dt);break}le[2]&&ie.ops.pop(),ie.trys.pop();continue}dt=P.call(Y,ie)}catch(Dt){dt=[6,Dt],ee=0}finally{k=le=0}if(5&dt[0])throw dt[1];return{value:dt[0]?dt[1]:void 0,done:!0}})([Mt,ct])}}}function Fe(Y){var P=typeof Symbol=="function"&&Symbol.iterator,k=P&&Y[P],ee=0;if(k)return k.call(Y);if(Y&&typeof Y.length=="number")return{next:function(){return Y&&ee>=Y.length&&(Y=void 0),{value:Y&&Y[ee++],done:!Y}}};throw new TypeError(P?"Object is not iterable.":"Symbol.iterator is not defined.")}function We(Y){return this instanceof We?(this.v=Y,this):new We(Y)}function tt(Y,P,k){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var ee,le=k.apply(Y,P||[]),ge=[];return ee={},ie("next"),ie("throw"),ie("return"),ee[Symbol.asyncIterator]=function(){return this},ee;function ie(Dt){le[Dt]&&(ee[Dt]=function(Ct){return new Promise(function(Ht,Gt){ge.push([Dt,Ct,Ht,Gt])>1||ot(Dt,Ct)})})}function ot(Dt,Ct){try{(function(Ht){Ht.value instanceof We?Promise.resolve(Ht.value.v).then(Mt,ct):dt(ge[0][2],Ht)})(le[Dt](Ct))}catch(Ht){dt(ge[0][3],Ht)}}function Mt(Dt){ot("next",Dt)}function ct(Dt){ot("throw",Dt)}function dt(Dt,Ct){Dt(Ct),ge.shift(),ge.length&&ot(ge[0][0],ge[0][1])}}var nt=(function(Y){function P(k){var ee=Y.call(this,k)||this;return Object.defineProperty(ee,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(ee,ee.constructor.prototype):ee.__proto__=ee.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(ee,ee.constructor),ee}return(function(k,ee){function le(){this.constructor=k}Qt(k,ee),k.prototype=ee===null?Object.create(ee):(le.prototype=ee.prototype,new le)})(P,Y),P})(Error);function ut(Y){Y!=null&&typeof Y.then=="function"&&Y.then(It,It)}(function(){function Y(P){if(P<0)throw new RangeError("Capacity may not be less than 0");this._c=P,this._q=[]}Object.defineProperty(Y.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),Y.prototype.add=function(P){if(this.full)throw new Error("Buffer full");this._q.push(P)},Y.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}})(),(function(){function Y(P){if(P<1)throw new RangeError("Capacity may not be less than 1");this._c=P,this._q=[]}Object.defineProperty(Y.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),Y.prototype.add=function(P){for(;this._q.length>=this._c;)this._q.shift();this._q.push(P)},Y.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}})(),(function(){function Y(P){if(P<1)throw new RangeError("Capacity may not be less than 1");this._c=P,this._q=[]}Object.defineProperty(Y.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),Y.prototype.add=function(P){this._q.length<this._c&&this._q.push(P)},Y.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}})();var ft=1024,It=function(){};function zt(Y){var P=Y.err,k=Promise.resolve(Y.execution).then(function(ee){if(P!=null)throw P;return ee});return Y.err=void 0,Y.execution=k.then(function(){},function(){}),Y.pending===void 0?k:Y.pending.then(function(){return k})}function Zt(Y,P){var k=Y.state>=3;return Promise.resolve(P).then(function(ee){return!k&&Y.state>=4?zt(Y).then(function(le){return{value:le,done:!0}}):{value:ee,done:k}})}function sr(Y,P){var k,ee;if(!(Y.state>=2))if(Y.state=2,Y.onnext(),Y.onstop(),Y.err==null&&(Y.err=P),Y.pushes.length!==0||Y.buffer!==void 0&&!Y.buffer.empty)try{for(var le=Fe(Y.pushes),ge=le.next();!ge.done;ge=le.next())ge.value.resolve()}catch(ie){k={error:ie}}finally{try{ge&&!ge.done&&(ee=le.return)&&ee.call(le)}finally{if(k)throw k.error}}else ur(Y)}function ur(Y){var P,k;if(!(Y.state>=3)){Y.state<2&&sr(Y),Y.state=3,Y.buffer=void 0;try{for(var ee=Fe(Y.nexts),le=ee.next();!le.done;le=ee.next()){var ge=le.value,ie=Y.pending===void 0?zt(Y):Y.pending.then(function(){return zt(Y)});ge.resolve(Zt(Y,ie))}}catch(ot){P={error:ot}}finally{try{le&&!le.done&&(k=ee.return)&&k.call(ee)}finally{if(P)throw P.error}}Y.pushes=[],Y.nexts=[]}}function _r(Y){Y.state>=4||(Y.state<3&&ur(Y),Y.state=4)}function Le(Y,P){if(ut(P),Y.pushes.length>=ft)throw new nt("No more than 1024 pending calls to push are allowed on a single repeater.");if(Y.state>=2)return Promise.resolve(void 0);var k,ee=Y.pending===void 0?Promise.resolve(P):Y.pending.then(function(){return P});ee=ee.catch(function(ot){Y.state<2&&(Y.err=ot),_r(Y)}),Y.nexts.length?(Y.nexts.shift().resolve(Zt(Y,ee)),k=Y.nexts.length?Promise.resolve(Y.nexts[0].value):Y.buffer===void 0||Y.buffer.full?new Promise(function(ot){return Y.onnext=ot}):Promise.resolve(void 0)):Y.buffer===void 0||Y.buffer.full?k=new Promise(function(ot){return Y.pushes.push({resolve:ot,value:ee})}):(Y.buffer.add(ee),k=Promise.resolve(void 0));var le=!0,ge={},ie=k.catch(function(ot){if(le)throw ot});return ge.then=function(ot,Mt){return le=!1,Promise.prototype.then.call(k,ot,Mt)},ge.catch=function(ot){return le=!1,Promise.prototype.catch.call(k,ot)},ge.finally=k.finally.bind(k),Y.pending=ee.then(function(){return ie}).catch(function(ot){Y.err=ot,_r(Y)}),ge}function lr(Y){if(!(Y.state>=1)){Y.state=1;var P=Le.bind(null,Y),k=(function(ee){var le=sr.bind(null,ee),ge=new Promise(function(ie){return ee.onstop=ie});return le.then=ge.then.bind(ge),le.catch=ge.catch.bind(ge),le.finally=ge.finally.bind(ge),le})(Y);Y.execution=new Promise(function(ee){return ee(Y.executor(P,k))}),Y.execution.catch(function(){return sr(Y)})}}var br=new WeakMap,Tr=(function(){function Y(P,k){br.set(this,{executor:P,buffer:k,err:void 0,state:0,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:It,onstop:It})}return Y.prototype.next=function(P){ut(P);var k=br.get(this);if(k===void 0)throw new Error("WeakMap error");if(k.nexts.length>=ft)throw new nt("No more than 1024 pending calls to next are allowed on a single repeater.");if(k.state<=0&&lr(k),k.onnext(P),k.buffer!==void 0&&!k.buffer.empty){var ee=Zt(k,k.buffer.remove());if(k.pushes.length){var le=k.pushes.shift();k.buffer.add(le.value),k.onnext=le.resolve}return ee}if(k.pushes.length){var ge=k.pushes.shift();return k.onnext=ge.resolve,Zt(k,ge.value)}return k.state>=2?(ur(k),Zt(k,zt(k))):new Promise(function(ie){return k.nexts.push({resolve:ie,value:P})})},Y.prototype.return=function(P){ut(P);var k=br.get(this);if(k===void 0)throw new Error("WeakMap error");return ur(k),k.execution=Promise.resolve(k.execution).then(function(){return P}),Zt(k,zt(k))},Y.prototype.throw=function(P){var k=br.get(this);if(k===void 0)throw new Error("WeakMap error");return k.state<=0||k.state>=2||k.buffer!==void 0&&!k.buffer.empty?(ur(k),k.err==null&&(k.err=P),Zt(k,zt(k))):this.next(Promise.reject(P))},Y.prototype[Symbol.asyncIterator]=function(){return this},Y.race=zr,Y.merge=yr,Y.zip=Lr,Y.latest=Cr,Y})();function Yt(Y,P){var k,ee,le=[],ge=function(Mt){Mt!=null&&typeof Mt[Symbol.asyncIterator]=="function"?le.push(Mt[Symbol.asyncIterator]()):Mt!=null&&typeof Mt[Symbol.iterator]=="function"?le.push(Mt[Symbol.iterator]()):le.push((function(){return tt(this,arguments,function(){return fe(this,function(ct){switch(ct.label){case 0:return P.yieldValues?[4,We(Mt)]:[3,3];case 1:return[4,ct.sent()];case 2:ct.sent(),ct.label=3;case 3:return P.returnValues?[4,We(Mt)]:[3,5];case 4:return[2,ct.sent()];case 5:return[2]}})})})())};try{for(var ie=Fe(Y),ot=ie.next();!ot.done;ot=ie.next())ge(ot.value)}catch(Mt){k={error:Mt}}finally{try{ot&&!ot.done&&(ee=ie.return)&&ee.call(ie)}finally{if(k)throw k.error}}return le}function zr(Y){var P=this,k=Yt(Y,{returnValues:!0});return new Tr(function(ee,le){return Vt(P,0,void 0,function(){var ge,ie,ot,Mt,ct,dt;return fe(this,function(Dt){switch(Dt.label){case 0:if(!k.length)return le(),[2];ie=!1,le.then(function(){ge(),ie=!0}),Dt.label=1;case 1:Dt.trys.push([1,,5,7]),Mt=void 0,ct=0,dt=function(){var Ct,Ht,Gt,dr,vr,Nr;return fe(this,function(Lt){switch(Lt.label){case 0:Ct=ct;try{for(vr=void 0,Ht=Fe(k),Gt=Ht.next();!Gt.done;Gt=Ht.next())dr=Gt.value,Promise.resolve(dr.next()).then(function(wr){wr.done?(le(),ot===void 0&&(ot=wr)):ct===Ct&&(ct++,ge(wr))},function(wr){return le(wr)})}catch(wr){vr={error:wr}}finally{try{Gt&&!Gt.done&&(Nr=Ht.return)&&Nr.call(Ht)}finally{if(vr)throw vr.error}}return[4,new Promise(function(wr){return ge=wr})];case 1:return(Mt=Lt.sent())===void 0?[3,3]:[4,ee(Mt.value)];case 2:Lt.sent(),Lt.label=3;case 3:return[2]}})},Dt.label=2;case 2:return ie?[3,4]:[5,dt()];case 3:return Dt.sent(),[3,2];case 4:return[2,ot&&ot.value];case 5:return le(),[4,Promise.race(k.map(function(Ct){return Ct.return&&Ct.return()}))];case 6:return Dt.sent(),[7];case 7:return[2]}})})})}function yr(Y){var P=this,k=Yt(Y,{yieldValues:!0});return new Tr(function(ee,le){return Vt(P,0,void 0,function(){var ge,ie,ot,Mt=this;return fe(this,function(ct){switch(ct.label){case 0:if(!k.length)return le(),[2];ge=[],ie=!1,le.then(function(){var dt,Dt;ie=!0;try{for(var Ct=Fe(ge),Ht=Ct.next();!Ht.done;Ht=Ct.next())(0,Ht.value)()}catch(Gt){dt={error:Gt}}finally{try{Ht&&!Ht.done&&(Dt=Ct.return)&&Dt.call(Ct)}finally{if(dt)throw dt.error}}}),ct.label=1;case 1:return ct.trys.push([1,,3,4]),[4,Promise.all(k.map(function(dt,Dt){return Vt(Mt,0,void 0,function(){var Ct;return fe(this,function(Ht){switch(Ht.label){case 0:Ht.trys.push([0,,6,9]),Ht.label=1;case 1:return ie?[3,5]:(Promise.resolve(dt.next()).then(function(Gt){return ge[Dt](Gt)},function(Gt){return le(Gt)}),[4,new Promise(function(Gt){ge[Dt]=Gt})]);case 2:return(Ct=Ht.sent())===void 0?[3,4]:Ct.done?(ot=Ct,[2]):[4,ee(Ct.value)];case 3:Ht.sent(),Ht.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return dt.return?[4,dt.return()]:[3,8];case 7:Ht.sent(),Ht.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return ct.sent(),[2,ot&&ot.value];case 3:return le(),[7];case 4:return[2]}})})})}function Lr(Y){var P=this,k=Yt(Y,{returnValues:!0});return new Tr(function(ee,le){return Vt(P,0,void 0,function(){var ge,ie,ot,Mt;return fe(this,function(ct){switch(ct.label){case 0:if(!k.length)return le(),[2,[]];ie=!1,le.then(function(){ge(),ie=!0}),ct.label=1;case 1:ct.trys.push([1,,6,8]),ct.label=2;case 2:return ie?[3,5]:(Promise.all(k.map(function(dt){return dt.next()})).then(function(dt){return ge(dt)},function(dt){return le(dt)}),[4,new Promise(function(dt){return ge=dt})]);case 3:return(ot=ct.sent())===void 0?[2]:(Mt=ot.map(function(dt){return dt.value}),ot.some(function(dt){return dt.done})?[2,Mt]:[4,ee(Mt)]);case 4:return ct.sent(),[3,2];case 5:return[3,8];case 6:return le(),[4,Promise.all(k.map(function(dt){return dt.return&&dt.return()}))];case 7:return ct.sent(),[7];case 8:return[2]}})})})}function Cr(Y){var P=this,k=Yt(Y,{yieldValues:!0,returnValues:!0});return new Tr(function(ee,le){return Vt(P,0,void 0,function(){var ge,ie,ot,Mt,ct,dt=this;return fe(this,function(Dt){switch(Dt.label){case 0:if(!k.length)return le(),[2,[]];ie=[],ot=!1,le.then(function(){var Ct,Ht;ge();try{for(var Gt=Fe(ie),dr=Gt.next();!dr.done;dr=Gt.next())(0,dr.value)()}catch(vr){Ct={error:vr}}finally{try{dr&&!dr.done&&(Ht=Gt.return)&&Ht.call(Gt)}finally{if(Ct)throw Ct.error}}ot=!0}),Dt.label=1;case 1:return Dt.trys.push([1,,5,7]),Promise.all(k.map(function(Ct){return Ct.next()})).then(function(Ct){return ge(Ct)},function(Ct){return le(Ct)}),[4,new Promise(function(Ct){return ge=Ct})];case 2:return(Mt=Dt.sent())===void 0?[2]:(ct=Mt.map(function(Ct){return Ct.value}),Mt.every(function(Ct){return Ct.done})?[2,ct]:[4,ee(ct.slice())]);case 3:return Dt.sent(),[4,Promise.all(k.map(function(Ct,Ht){return Vt(dt,0,void 0,function(){var Gt;return fe(this,function(dr){switch(dr.label){case 0:if(Mt[Ht].done)return[2,Mt[Ht].value];dr.label=1;case 1:return ot?[3,4]:(Promise.resolve(Ct.next()).then(function(vr){return ie[Ht](vr)},function(vr){return le(vr)}),[4,new Promise(function(vr){return ie[Ht]=vr})]);case 2:return(Gt=dr.sent())===void 0?[2,Mt[Ht].value]:Gt.done?[2,Gt.value]:(ct[Ht]=Gt.value,[4,ee(ct.slice())]);case 3:return dr.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,Dt.sent()];case 5:return le(),[4,Promise.all(k.map(function(Ct){return Ct.return&&Ct.return()}))];case 6:return Dt.sent(),[7];case 7:return[2]}})})})}class li{headerClient;header;headerLength;indexLength;nocache;headers;constructor(P,k,ee,le,ge,ie={}){this.headerClient=P,this.header=k,this.headerLength=ee,this.indexLength=le,this.nocache=ge,this.headers=ie}static async open(P,k,ee={}){let le,ge=new Gr(P,k,ee),ie=2024+(()=>{let dt,Dt=0;for(dt=0;dt<3;dt++)Dt+=16**dt*40;return Dt})();if(!new Uint8Array(await ge.getRange(0,8,ie,"header")).subarray(0,3).every((dt,Dt)=>g[Dt]===dt))throw Error("Not a FlatGeobuf file");if((le=new DataView(await ge.getRange(8,4,ie,"header")).getUint32(0,!0))>10485760||le<8)throw Error("Invalid header size");let ot=await ge.getRange(g.length,4+le,ie,"header"),Mt=xt(new B(new Uint8Array(ot)));if(Mt.indexNodeSize===0)throw Error("No index found, cannot read features filtered by bbox");let ct=yt(Mt.featuresCount,Mt.indexNodeSize);return new li(ge,Mt,le,ct,k,ee)}async*selectBbox(P){let k=this.lengthBeforeTree(),ee=this.headerClient,le=async(Mt,ct)=>ee.getRange(k+Mt,ct,0,"index"),ge=[],ie=[];for await(let Mt of mt(this.header.featuresCount,this.header.indexNodeSize,P,le)){let[ct,dt]=Mt,[,,Dt]=Mt;if(Dt||(Dt=4),ie.length===0){ie.push([ct,Dt,dt]);continue}let Ct=ie[ie.length-1];ct-(Ct[0]+Ct[1])>kt.global.extraRequestThreshold()&&(ge.push(ie),ie=[]),ie.push([ct,Dt,dt])}this.headerClient.logUsage("header+index"),ie.length>0&&ge.push(ie);let ot=ge.flatMap(Mt=>this.readFeatureBatch(Mt,this.nocache));yield*Tr.merge(ot)}lengthBeforeTree(){return g.length+4+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(P){return new Gr(this.headerClient.httpClient,P,this.headers)}async*readFeatureBatch(P,k){let[ee]=P[0],[le,ge]=P[P.length-1],ie=this.buildFeatureClient(k),ot=le+ge-ee;for(let[Mt,,ct]of P){let dt=await this.readFeature(ie,Mt,ot);yield{id:ct,feature:dt},ot=0}ie.logUsage("feature")}async readFeature(P,k,ee){let le,ge=k+this.lengthBeforeFeatures();le=new DataView(await P.getRange(ge,4,ee,"feature length")).getUint32(0,!0);let ie=new Uint8Array(await P.getRange(ge+4,le,ee,"feature data")),ot=new Uint8Array(le+4);ot.set(ie,4);let Mt=new B(ot);return ye.getSizePrefixedRootAsFeature(Mt)}}class Gr{httpClient;bytesEverUsed=0;bytesEverFetched=0;buffer=new ArrayBuffer(0);head=0;constructor(P,k,ee={}){if(typeof P=="string")this.httpClient=new Vr(P,k,ee);else{if(!(P instanceof Vr))throw Error("Unknown source");this.httpClient=P}}async getRange(P,k,ee,le){this.bytesEverUsed+=k;let ge=P-this.head,ie=ge+k;if(ge>=0&&ie<=this.buffer.byteLength)return this.buffer.slice(ge,ie);let ot=Math.max(k,ee);return this.bytesEverFetched+=ot,this.buffer=await this.httpClient.getRange(P,ot,le),this.head=P,this.buffer.slice(0,k)}logUsage(P){P.split(" ")[0],(100*this.bytesEverUsed/this.bytesEverFetched).toFixed(2)}}class Vr{url;nocache;headers;requestsEverMade=0;bytesEverRequested=0;constructor(P,k,ee={}){this.url=P,this.nocache=k,this.headers=ee}async getRange(P,k,ee){this.requestsEverMade+=1,this.bytesEverRequested+=k;let le=`bytes=${P}-${P+k-1}`,ge=new Headers(this.headers);return ge.set("Range",le),this.nocache&&ge.set("Cache-Control","no-cache, no-store"),await(await fetch(this.url,{headers:ge})).arrayBuffer()}}function ni(Y){let P;for(let k of Y){if(P===he.Unknown)break;let ee=k.getGeometry?Ue(k.getGeometry().getType()):Ue(k.geometry.type);P===void 0?P=ee:P!==ee&&(P=he.Unknown)}if(P===void 0)throw Error("Could not infer geometry type for collection of features.");return P}async function*ei(Y,P,k){let ee,le=typeof(ot=Y).slice=="function"?ot:new we(typeof ot.read=="function"?ot:ot.getReader()),ge=async vr=>await le.slice(vr),ie=new Uint8Array(await ge(8));var ot;if(!ie.subarray(0,3).every((vr,Nr)=>g[Nr]===vr))throw Error("Not a FlatGeobuf file");let Mt=new Uint8Array(await ge(4)),ct=new B(Mt),dt=ct.readUint32(0),Dt=new Uint8Array(await ge(dt));(ie=new Uint8Array(Mt.length+Dt.length)).set(Mt),ie.set(Dt,Mt.length);let Ct=xt(ct=new B(ie));k&&k(Ct);let{indexNodeSize:Ht,featuresCount:Gt}=Ct;if(Ht>0){let vr=yt(Gt,Ht);await ge(vr)}let dr=0;for(;ee=await xr(ge,Ct,P,dr++);)yield ee}async function xr(Y,P,k,ee){let le=new Uint8Array(await Y(4,"feature length"));if(le.byteLength===0)return;let ge=new B(le),ie=ge.readUint32(0);le=new Uint8Array(await Y(ie,"feature data"));let ot=new Uint8Array(ie+4);return ot.set(le,4),ge=new B(ot),k(ee,ye.getSizePrefixedRootAsFeature(ge),P)}function Qe(Y){let P,k,ee=Y.coordinates,le=[],ge=[],ie=Ue(Y.type),ot=0;switch(Y.type){case"Point":case"MultiPoint":case"LineString":Be(ee,le,ge);break;case"MultiLineString":case"Polygon":Be(ee,le,ge),ee.length>1&&(P=ee.map(Mt=>ot+=Mt.length));break;case"MultiPolygon":k=ee.map(Mt=>({type:"Polygon",coordinates:Mt})).map(Qe)}return{xy:le,z:ge.length>0?ge:void 0,ends:P,type:ie,parts:k}}function W(Y){let P=Ue(Y.type),k=[];for(let ee=0;ee<Y.geometries.length;ee++){let le=Y.geometries[ee];le.type==="GeometryCollection"?k.push(W(le)):k.push(Qe(le))}return{type:P,parts:k}}function te(Y,P){let k=P;if(k===he.Unknown&&(k=Y.type()),k===he.GeometryCollection){let le=[];for(let ge=0;ge<Y.partsLength();ge++){let ie=Y.parts(ge),ot=ie.type();le.push(te(ie,ot))}return{type:he[k],geometries:le}}if(k===he.MultiPolygon){let le=[];for(let ge=0;ge<Y.partsLength();ge++)le.push(te(Y.parts(ge),he.Polygon));return{type:he[k],coordinates:le.map(ge=>ge.coordinates)}}let ee=(function(le,ge){let ie=le.xyArray(),ot=le.zArray();switch(ge){case he.Point:{let Mt=Array.from(ie);return ot&&Mt.push(ot[0]),Mt}case he.MultiPoint:case he.LineString:return De(ie,ot);case he.MultiLineString:case he.Polygon:return(function(Mt,ct,dt){let Dt;if(!dt||dt.length===0)return[De(Mt,ct)];let Ct=0,Ht=Array.from(dt).map(Gt=>Mt.slice(Ct,Ct=Gt<<1));return ct&&(Ct=0,Dt=Array.from(dt).map(Gt=>ct.slice(Ct,Ct=Gt))),Ht.map((Gt,dr)=>De(Gt,Dt?Dt[dr]:void 0))})(ie,ot,le.endsArray())}})(Y,k);return{type:he[k],coordinates:ee}}function se(Y,P,k){let ee=k.columns;return{type:"Feature",id:Y,geometry:te(P.geometry(),k.geometryType),properties:Pe(P,ee)}}function Ce(Y,P=0){var k;let ee,le,ge=(ee=(k=Y).features[0].properties,le=null,ee&&(le=Object.keys(ee).map(Dt=>(function(Ct,Ht){return{name:Ht,type:(function(Gt){if(typeof Gt=="boolean")return j.Bool;if(typeof Gt=="number")return j.Double;if(typeof Gt=="string"||Gt===null)return j.String;if(Gt instanceof Uint8Array)return j.Binary;if(typeof Gt=="object")return j.Json;throw Error(`Unknown type (value '${Gt}')`)})(Ct[Ht]),title:null,description:null,width:-1,precision:-1,scale:-1,nullable:!0,unique:!1,primary_key:!1}})(ee,Dt))),{geometryType:ni(k.features),columns:le,featuresCount:k.features.length}),ie=(function(Dt,Ct=0){let Ht,Gt=new Q,dr=0;Dt.columns&&(dr=Ye.createColumnsVector(Gt,Dt.columns.map(Lt=>{let wr;return wr=Gt.createString(Lt.name),Ie.startColumn(Gt),Ie.addName(Gt,wr),Ie.addType(Gt,Lt.type),Ie.endColumn(Gt)})));let vr=Gt.createString("L1");Ct&&(Ge.startCrs(Gt),Ge.addCode(Gt,Ct),Ht=Ge.endCrs(Gt)),Ye.startHeader(Gt),Ht&&Ye.addCrs(Gt,Ht),Ye.addFeaturesCount(Gt,BigInt(Dt.featuresCount)),Ye.addGeometryType(Gt,Dt.geometryType),Ye.addIndexNodeSize(Gt,0),dr&&Ye.addColumns(Gt,dr),Ye.addName(Gt,vr);let Nr=Ye.endHeader(Gt);return Gt.finishSizePrefixed(Nr),Gt.asUint8Array()})(ge,P),ot=Y.features.map(Dt=>Ze(Dt.geometry.type==="GeometryCollection"?W(Dt.geometry):Qe(Dt.geometry),Dt.properties,ge)),Mt=ot.map(Dt=>Dt.length).reduce((Dt,Ct)=>Dt+Ct),ct=new Uint8Array(g.length+ie.length+Mt);ct.set(ie,g.length);let dt=g.length+ie.length;for(let Dt of ot)ct.set(Dt,dt),dt+=Dt.length;return ct.set(g),ct}async function*Oe(Y,P,k){yield*(async function*(ee,le,ge,ie){if(!ee.subarray(0,3).every((Gt,dr)=>g[dr]===Gt))throw Error("Not a FlatGeobuf file");if(ge){let Gt=gt.open(ee);for await(let dr of Gt.selectBbox(ge))yield le(dr.id,dr.feature,Gt.header);return}let ot=new B(ee),Mt=ot.readUint32(g.length);ot.setPosition(g.length);let ct=xt(ot);ie&&ie(ct);let dt=g.length+4+Mt,{indexNodeSize:Dt,featuresCount:Ct}=ct;Dt>0&&(dt+=yt(Ct,Dt));let Ht=0;for(;dt<ot.capacity();){let Gt=ot.readUint32(dt);ot.setPosition(dt);let dr=ye.getSizePrefixedRootAsFeature(ot);yield le(Ht++,dr,ct),dt+=4+Gt}})(Y,se,P,k)}function ht(Y,P,k,ee=!1,le={}){return(async function*(ge,ie,ot,Mt,ct=!1,dt={}){let Dt=await li.open(ge,ct,dt);for await(let Ct of(Mt&&Mt(Dt.header),Dt.selectBbox(ie)))yield ot(Ct.id,Ct.feature,Dt.header)})(Y,P,se,k,ee,le)}u.deserialize=function(Y,P,k,ee=!1,le={}){return Y instanceof Uint8Array?Oe(Y,P,k):Y instanceof ReadableStream?(function(ge,ie){return ei(ge,se,ie)})(Y,k):ht(Y,P,k,ee,le)},u.serialize=function(Y,P=0){return Ce(Y,P)}})})(jh,jh.exports)),jh.exports}var Q5=K5(),kp,qy;function e3(){if(qy)return kp;qy=1;var p="Expected a function",l=NaN,u="[object Symbol]",g=/^\s+|\s+$/g,v=/^[-+]0x[0-9a-f]+$/i,x=/^0b[01]+$/i,b=/^0o[0-7]+$/i,s=parseInt,E=typeof Td=="object"&&Td&&Td.Object===Object&&Td,F=typeof self=="object"&&self&&self.Object===Object&&self,B=E||F||Function("return this")(),Q=Object.prototype,ne=Q.toString,j=Math.max,Ie=Math.min,he=function(){return B.Date.now()};function re($e,st,Ze){var Pe,rt,_e,we,Ge,Ye,xt=0,kt=!1,yt=!1,mt=!0;if(typeof $e!="function")throw new TypeError(p);st=Ue(st)||0,Je(Ze)&&(kt=!!Ze.leading,yt="maxWait"in Ze,_e=yt?j(Ue(Ze.maxWait)||0,st):_e,mt="trailing"in Ze?!!Ze.trailing:mt);function gt(ft){var It=Pe,zt=rt;return Pe=rt=void 0,xt=ft,we=$e.apply(zt,It),we}function Qt(ft){return xt=ft,Ge=setTimeout(Fe,st),kt?gt(ft):we}function Vt(ft){var It=ft-Ye,zt=ft-xt,Zt=st-It;return yt?Ie(Zt,_e-zt):Zt}function fe(ft){var It=ft-Ye,zt=ft-xt;return Ye===void 0||It>=st||It<0||yt&&zt>=_e}function Fe(){var ft=he();if(fe(ft))return We(ft);Ge=setTimeout(Fe,Vt(ft))}function We(ft){return Ge=void 0,mt&&Pe?gt(ft):(Pe=rt=void 0,we)}function tt(){Ge!==void 0&&clearTimeout(Ge),xt=0,Pe=Ye=rt=Ge=void 0}function nt(){return Ge===void 0?we:We(he())}function ut(){var ft=he(),It=fe(ft);if(Pe=arguments,rt=this,Ye=ft,It){if(Ge===void 0)return Qt(Ye);if(yt)return Ge=setTimeout(Fe,st),gt(Ye)}return Ge===void 0&&(Ge=setTimeout(Fe,st)),we}return ut.cancel=tt,ut.flush=nt,ut}function ye($e,st,Ze){var Pe=!0,rt=!0;if(typeof $e!="function")throw new TypeError(p);return Je(Ze)&&(Pe="leading"in Ze?!!Ze.leading:Pe,rt="trailing"in Ze?!!Ze.trailing:rt),re($e,st,{leading:Pe,maxWait:st,trailing:rt})}function Je($e){var st=typeof $e;return!!$e&&(st=="object"||st=="function")}function Be($e){return!!$e&&typeof $e=="object"}function De($e){return typeof $e=="symbol"||Be($e)&&ne.call($e)==u}function Ue($e){if(typeof $e=="number")return $e;if(De($e))return l;if(Je($e)){var st=typeof $e.valueOf=="function"?$e.valueOf():$e;$e=Je(st)?st+"":st}if(typeof $e!="string")return $e===0?$e:+$e;$e=$e.replace(g,"");var Ze=x.test($e);return Ze||b.test($e)?s($e.slice(2),Ze?2:8):v.test($e)?l:+$e}return kp=ye,kp}var t3=e3();const r3=$y(t3);let i3=new U5;rh.addProtocol("pmtiles",i3.tile);const Gy=18;document.addEventListener("DOMContentLoaded",async()=>{const p=new rh.Map({container:"map",hash:!0,style:"./style.json",center:[135.57,34.777],zoom:13,maxZoom:19,minZoom:4,localIdeographFontFamily:["BIZ UDPGothic","sans-serif"]});Zc.init(p);function l(){const{_sw:E,_ne:F}=p.getBounds();return{minX:E.lng,minY:E.lat,maxX:F.lng,maxY:F.lat}}async function u(){if(p.getZoom()<Gy)return;let E=0;const F={type:"FeatureCollection",features:[]};let B=Q5.deserialize("./data/r1chikeizu.fgb",l());for await(let Q of B)F.features.push({...Q,id:E}),E+=1;p.getSource("blocks").setData(F)}p.on("load",()=>{p.on("click",E=>{const B=["senbiki-fill","youto-fill","koudoti-fill","bouka-fill"].map(j=>p.queryRenderedFeatures(E.point,{layers:[j]})[0]);if(B[0]===void 0)return;const Q=[B[0].properties.];Q[0]==""&&Q.push(`${B[1].properties.}
      <li>${B[1].properties.}</li>
      <li>${B[1].properties.}</li>
      ${B[2]?.properties?.Type??""}`),Q.push(B[3]?.properties?.??"22");const ne=Q.join("<br>");new rh.Popup().setLngLat(E.lngLat).setHTML(ne).addTo(p)}),p.addSource("blocks",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),p.addLayer({id:"blocks-line",type:"line",source:"blocks",minzoom:Gy,paint:{"line-color":["match",["get","layer"],"","#232323","","#232323","","#a8a1ad","#7b7b7d"],"line-width":["match",["get","layer"],"",2.6,"",1.6,"",1.6,.6]}}),u=r3(u,500),u(),p.on("moveend",function(E){u()})});const g={forwardGeocode:async E=>{const F=[],B=`https://geocode.csis.u-tokyo.ac.jp/cgi-bin/simple_geocode.cgi?addr=${E.query}&charset=UTF8&constraint=`,ne=await(await fetch(B)).text(),Ie=await new DOMParser().parseFromString(ne,"text/xml"),he=[Ie.getElementsByTagName("longitude")[0].firstChild.nodeValue,Ie.getElementsByTagName("latitude")[0].firstChild.nodeValue],re={type:"Feature",geometry:{type:"Point",coordinates:he},place_name:Ie.getElementsByTagName("address")[0].textContent,place_type:["place"],center:he};return F.push(re),{features:F}}};p.addControl(new e2(g,{maplibregl:rh})),p.addControl(new rh.NavigationControl),p.addControl(new u5({Format:xc.PNG,Crosshair:!0,PrintableArea:!0,Local:"ja"})),p.addControl(new rh.ScaleControl({maxWidth:200}));let v=document.getElementById("style"),x=document.getElementById("kyk"),b=document.getElementById("tyk"),s=document.getElementById("bdr");document.getElementById("style").addEventListener("click",()=>{const E=v.checked;p.U.toggle("r-raster",E),p.U.toggle(["tran-fill","bldg-fill"],!E),p.U.toggleSource("v",!E)}),document.getElementById("kyk").addEventListener("click",()=>{p.U.toggle("kyojuu-fill",x.checked),p.U.toggle("youto-fill",!(x.checked||b.checked))}),document.getElementById("tyk").addEventListener("click",()=>{p.U.toggle("toshikinou-fill",b.checked),p.U.toggle("youto-fill",!(x.checked||b.checked))}),document.getElementById("bdr").addEventListener("click",()=>{p.U.toggle(/-symbol$/,s.checked)})});export{Wi as A};
