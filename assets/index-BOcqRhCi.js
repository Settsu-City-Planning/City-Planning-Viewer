var m1=Object.defineProperty;var g1=(h,a,c)=>a in h?m1(h,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):h[a]=c;var Vr=(h,a,c)=>g1(h,typeof a!="symbol"?a+"":a,c);(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))p(v);new MutationObserver(v=>{for(const y of v)if(y.type==="childList")for(const f of y.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&p(f)}).observe(document,{childList:!0,subtree:!0});function c(v){const y={};return v.integrity&&(y.integrity=v.integrity),v.referrerPolicy&&(y.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?y.credentials="include":v.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function p(v){if(v.ep)return;v.ep=!0;const y=c(v);fetch(v.href,y)}})();(function(h,a){typeof exports=="object"&&typeof module<"u"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):a((h=typeof globalThis<"u"?globalThis:h||self).flatgeobuf={})})(void 0,function(h){var a,c=((a={})[a.Unknown=0]="Unknown",a[a.Point=1]="Point",a[a.LineString=2]="LineString",a[a.Polygon=3]="Polygon",a[a.MultiPoint=4]="MultiPoint",a[a.MultiLineString=5]="MultiLineString",a[a.MultiPolygon=6]="MultiPolygon",a[a.GeometryCollection=7]="GeometryCollection",a[a.CircularString=8]="CircularString",a[a.CompoundCurve=9]="CompoundCurve",a[a.CurvePolygon=10]="CurvePolygon",a[a.MultiCurve=11]="MultiCurve",a[a.MultiSurface=12]="MultiSurface",a[a.Curve=13]="Curve",a[a.Surface=14]="Surface",a[a.PolyhedralSurface=15]="PolyhedralSurface",a[a.TIN=16]="TIN",a[a.Triangle=17]="Triangle",a);const p=new Int32Array(2),v=new Float32Array(p.buffer),y=new Float64Array(p.buffer),f=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var s,M;(function(K){K[K.UTF8_BYTES=1]="UTF8_BYTES",K[K.UTF16_STRING=2]="UTF16_STRING"})(s||(s={}));class B{constructor(x){this.bytes_=x,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(x){return new B(new Uint8Array(x))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(x){this.position_=x}capacity(){return this.bytes_.length}readInt8(x){return this.readUint8(x)<<24>>24}readUint8(x){return this.bytes_[x]}readInt16(x){return this.readUint16(x)<<16>>16}readUint16(x){return this.bytes_[x]|this.bytes_[x+1]<<8}readInt32(x){return this.bytes_[x]|this.bytes_[x+1]<<8|this.bytes_[x+2]<<16|this.bytes_[x+3]<<24}readUint32(x){return this.readInt32(x)>>>0}readInt64(x){return BigInt.asIntN(64,BigInt(this.readUint32(x))+(BigInt(this.readUint32(x+4))<<BigInt(32)))}readUint64(x){return BigInt.asUintN(64,BigInt(this.readUint32(x))+(BigInt(this.readUint32(x+4))<<BigInt(32)))}readFloat32(x){return p[0]=this.readInt32(x),v[0]}readFloat64(x){return p[f?0:1]=this.readInt32(x),p[f?1:0]=this.readInt32(x+4),y[0]}writeInt8(x,A){this.bytes_[x]=A}writeUint8(x,A){this.bytes_[x]=A}writeInt16(x,A){this.bytes_[x]=A,this.bytes_[x+1]=A>>8}writeUint16(x,A){this.bytes_[x]=A,this.bytes_[x+1]=A>>8}writeInt32(x,A){this.bytes_[x]=A,this.bytes_[x+1]=A>>8,this.bytes_[x+2]=A>>16,this.bytes_[x+3]=A>>24}writeUint32(x,A){this.bytes_[x]=A,this.bytes_[x+1]=A>>8,this.bytes_[x+2]=A>>16,this.bytes_[x+3]=A>>24}writeInt64(x,A){this.writeInt32(x,Number(BigInt.asIntN(32,A))),this.writeInt32(x+4,Number(BigInt.asIntN(32,A>>BigInt(32))))}writeUint64(x,A){this.writeUint32(x,Number(BigInt.asUintN(32,A))),this.writeUint32(x+4,Number(BigInt.asUintN(32,A>>BigInt(32))))}writeFloat32(x,A){v[0]=A,this.writeInt32(x,p[0])}writeFloat64(x,A){y[0]=A,this.writeInt32(x,p[f?0:1]),this.writeInt32(x+4,p[f?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+4+4)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let x="";for(let A=0;A<4;A++)x+=String.fromCharCode(this.readInt8(this.position_+4+A));return x}__offset(x,A){const O=x-this.readInt32(x);return A<this.readInt16(O)?this.readInt16(O+A):0}__union(x,A){return x.bb_pos=A+this.readInt32(A),x.bb=this,x}__string(x,A){x+=this.readInt32(x);const O=this.readInt32(x);x+=4;const G=this.bytes_.subarray(x,x+O);return A===s.UTF8_BYTES?G:this.text_decoder_.decode(G)}__union_with_string(x,A){return typeof x=="string"?this.__string(A):this.__union(x,A)}__indirect(x){return x+this.readInt32(x)}__vector(x){return x+this.readInt32(x)+4}__vector_len(x){return this.readInt32(x+this.readInt32(x))}__has_identifier(x){if(x.length!=4)throw new Error("FlatBuffers: file identifier must be length 4");for(let A=0;A<4;A++)if(x.charCodeAt(A)!=this.readInt8(this.position()+4+A))return!1;return!0}createScalarList(x,A){const O=[];for(let G=0;G<A;++G){const Q=x(G);Q!==null&&O.push(Q)}return O}createObjList(x,A){const O=[];for(let G=0;G<A;++G){const Q=x(G);Q!==null&&O.push(Q.unpack())}return O}}class V{constructor(x){let A;this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder,A=x||1024,this.bb=B.allocate(A),this.space=A}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(x){this.force_defaults=x}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(x,A){x>this.minalign&&(this.minalign=x);const O=1+~(this.bb.capacity()-this.space+A)&x-1;for(;this.space<O+x+A;){const G=this.bb.capacity();this.bb=V.growByteBuffer(this.bb),this.space+=this.bb.capacity()-G}this.pad(O)}pad(x){for(let A=0;A<x;A++)this.bb.writeInt8(--this.space,0)}writeInt8(x){this.bb.writeInt8(this.space-=1,x)}writeInt16(x){this.bb.writeInt16(this.space-=2,x)}writeInt32(x){this.bb.writeInt32(this.space-=4,x)}writeInt64(x){this.bb.writeInt64(this.space-=8,x)}writeFloat32(x){this.bb.writeFloat32(this.space-=4,x)}writeFloat64(x){this.bb.writeFloat64(this.space-=8,x)}addInt8(x){this.prep(1,0),this.writeInt8(x)}addInt16(x){this.prep(2,0),this.writeInt16(x)}addInt32(x){this.prep(4,0),this.writeInt32(x)}addInt64(x){this.prep(8,0),this.writeInt64(x)}addFloat32(x){this.prep(4,0),this.writeFloat32(x)}addFloat64(x){this.prep(8,0),this.writeFloat64(x)}addFieldInt8(x,A,O){(this.force_defaults||A!=O)&&(this.addInt8(A),this.slot(x))}addFieldInt16(x,A,O){(this.force_defaults||A!=O)&&(this.addInt16(A),this.slot(x))}addFieldInt32(x,A,O){(this.force_defaults||A!=O)&&(this.addInt32(A),this.slot(x))}addFieldInt64(x,A,O){(this.force_defaults||A!==O)&&(this.addInt64(A),this.slot(x))}addFieldFloat32(x,A,O){(this.force_defaults||A!=O)&&(this.addFloat32(A),this.slot(x))}addFieldFloat64(x,A,O){(this.force_defaults||A!=O)&&(this.addFloat64(A),this.slot(x))}addFieldOffset(x,A,O){(this.force_defaults||A!=O)&&(this.addOffset(A),this.slot(x))}addFieldStruct(x,A,O){A!=O&&(this.nested(A),this.slot(x))}nested(x){if(x!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(x){this.vtable!==null&&(this.vtable[x]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(x){const A=x.capacity();if(3221225472&A)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const O=A<<1,G=B.allocate(O);return G.setPosition(O-A),G.bytes().set(x.bytes(),O-A),G}addOffset(x){this.prep(4,0),this.writeInt32(this.offset()-x+4)}startObject(x){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=x;for(let A=0;A<x;A++)this.vtable[A]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const x=this.offset();let A=this.vtable_in_use-1;for(;A>=0&&this.vtable[A]==0;A--);const O=A+1;for(;A>=0;A--)this.addInt16(this.vtable[A]!=0?x-this.vtable[A]:0);this.addInt16(x-this.object_start);const G=2*(O+2);this.addInt16(G);let Q=0;const le=this.space;e:for(A=0;A<this.vtables.length;A++){const Te=this.bb.capacity()-this.vtables[A];if(G==this.bb.readInt16(Te)){for(let ue=2;ue<G;ue+=2)if(this.bb.readInt16(le+ue)!=this.bb.readInt16(Te+ue))continue e;Q=this.vtables[A];break}}return Q?(this.space=this.bb.capacity()-x,this.bb.writeInt32(this.space,Q-x)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-x,this.offset()-x)),this.isNested=!1,x}finish(x,A,O){const G=O?4:0;if(A){const Q=A;if(this.prep(this.minalign,8+G),Q.length!=4)throw new TypeError("FlatBuffers: file identifier must be length 4");for(let le=3;le>=0;le--)this.writeInt8(Q.charCodeAt(le))}this.prep(this.minalign,4+G),this.addOffset(x),G&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(x,A){this.finish(x,A,!0)}requiredField(x,A){const O=this.bb.capacity()-x,G=O-this.bb.readInt32(O);if(!(A<this.bb.readInt16(G)&&this.bb.readInt16(G+A)!=0))throw new TypeError("FlatBuffers: field "+A+" must be set")}startVector(x,A,O){this.notNested(),this.vector_num_elems=A,this.prep(4,x*A),this.prep(O,x*A)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(x){if(!x)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(x))return this.string_maps.get(x);const A=this.createString(x);return this.string_maps.set(x,A),A}createString(x){if(x==null)return 0;let A;return A=x instanceof Uint8Array?x:this.text_encoder.encode(x),this.addInt8(0),this.startVector(1,A.length,1),this.bb.setPosition(this.space-=A.length),this.bb.bytes().set(A,this.space),this.endVector()}createByteVector(x){return x==null?0:(this.startVector(1,x.length,1),this.bb.setPosition(this.space-=x.length),this.bb.bytes().set(x,this.space),this.endVector())}createObjectOffset(x){return x===null?0:typeof x=="string"?this.createString(x):x.pack(this)}createObjectOffsetList(x){const A=[];for(let O=0;O<x.length;++O){const G=x[O];if(G===null)throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.");A.push(this.createObjectOffset(G))}return A}createStructOffsetList(x,A){return A(this,x.length),this.createObjectOffsetList(x.slice().reverse()),this.endVector()}}class U{constructor(){Vr(this,"bb",null);Vr(this,"bb_pos",0)}__init(x,A){return this.bb_pos=x,this.bb=A,this}static getRootAsGeometry(x,A){return(A||new U).__init(x.readInt32(x.position())+x.position(),x)}static getSizePrefixedRootAsGeometry(x,A){return x.setPosition(x.position()+4),(A||new U).__init(x.readInt32(x.position())+x.position(),x)}ends(x){let A=this.bb.__offset(this.bb_pos,4);return A?this.bb.readUint32(this.bb.__vector(this.bb_pos+A)+4*x):0}endsLength(){let x=this.bb.__offset(this.bb_pos,4);return x?this.bb.__vector_len(this.bb_pos+x):0}endsArray(){let x=this.bb.__offset(this.bb_pos,4);return x?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+x),this.bb.__vector_len(this.bb_pos+x)):null}xy(x){let A=this.bb.__offset(this.bb_pos,6);return A?this.bb.readFloat64(this.bb.__vector(this.bb_pos+A)+8*x):0}xyLength(){let x=this.bb.__offset(this.bb_pos,6);return x?this.bb.__vector_len(this.bb_pos+x):0}xyArray(){let x=this.bb.__offset(this.bb_pos,6);return x?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+x),this.bb.__vector_len(this.bb_pos+x)):null}z(x){let A=this.bb.__offset(this.bb_pos,8);return A?this.bb.readFloat64(this.bb.__vector(this.bb_pos+A)+8*x):0}zLength(){let x=this.bb.__offset(this.bb_pos,8);return x?this.bb.__vector_len(this.bb_pos+x):0}zArray(){let x=this.bb.__offset(this.bb_pos,8);return x?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+x),this.bb.__vector_len(this.bb_pos+x)):null}m(x){let A=this.bb.__offset(this.bb_pos,10);return A?this.bb.readFloat64(this.bb.__vector(this.bb_pos+A)+8*x):0}mLength(){let x=this.bb.__offset(this.bb_pos,10);return x?this.bb.__vector_len(this.bb_pos+x):0}mArray(){let x=this.bb.__offset(this.bb_pos,10);return x?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+x),this.bb.__vector_len(this.bb_pos+x)):null}t(x){let A=this.bb.__offset(this.bb_pos,12);return A?this.bb.readFloat64(this.bb.__vector(this.bb_pos+A)+8*x):0}tLength(){let x=this.bb.__offset(this.bb_pos,12);return x?this.bb.__vector_len(this.bb_pos+x):0}tArray(){let x=this.bb.__offset(this.bb_pos,12);return x?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+x),this.bb.__vector_len(this.bb_pos+x)):null}tm(x){let A=this.bb.__offset(this.bb_pos,14);return A?this.bb.readUint64(this.bb.__vector(this.bb_pos+A)+8*x):BigInt(0)}tmLength(){let x=this.bb.__offset(this.bb_pos,14);return x?this.bb.__vector_len(this.bb_pos+x):0}type(){let x=this.bb.__offset(this.bb_pos,16);return x?this.bb.readUint8(this.bb_pos+x):c.Unknown}parts(x,A){let O=this.bb.__offset(this.bb_pos,18);return O?(A||new U).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+O)+4*x),this.bb):null}partsLength(){let x=this.bb.__offset(this.bb_pos,18);return x?this.bb.__vector_len(this.bb_pos+x):0}static startGeometry(x){x.startObject(8)}static addEnds(x,A){x.addFieldOffset(0,A,0)}static createEndsVector(x,A){x.startVector(4,A.length,4);for(let O=A.length-1;O>=0;O--)x.addInt32(A[O]);return x.endVector()}static startEndsVector(x,A){x.startVector(4,A,4)}static addXy(x,A){x.addFieldOffset(1,A,0)}static createXyVector(x,A){x.startVector(8,A.length,8);for(let O=A.length-1;O>=0;O--)x.addFloat64(A[O]);return x.endVector()}static startXyVector(x,A){x.startVector(8,A,8)}static addZ(x,A){x.addFieldOffset(2,A,0)}static createZVector(x,A){x.startVector(8,A.length,8);for(let O=A.length-1;O>=0;O--)x.addFloat64(A[O]);return x.endVector()}static startZVector(x,A){x.startVector(8,A,8)}static addM(x,A){x.addFieldOffset(3,A,0)}static createMVector(x,A){x.startVector(8,A.length,8);for(let O=A.length-1;O>=0;O--)x.addFloat64(A[O]);return x.endVector()}static startMVector(x,A){x.startVector(8,A,8)}static addT(x,A){x.addFieldOffset(4,A,0)}static createTVector(x,A){x.startVector(8,A.length,8);for(let O=A.length-1;O>=0;O--)x.addFloat64(A[O]);return x.endVector()}static startTVector(x,A){x.startVector(8,A,8)}static addTm(x,A){x.addFieldOffset(5,A,0)}static createTmVector(x,A){x.startVector(8,A.length,8);for(let O=A.length-1;O>=0;O--)x.addInt64(A[O]);return x.endVector()}static startTmVector(x,A){x.startVector(8,A,8)}static addType(x,A){x.addFieldInt8(6,A,c.Unknown)}static addParts(x,A){x.addFieldOffset(7,A,0)}static createPartsVector(x,A){x.startVector(4,A.length,4);for(let O=A.length-1;O>=0;O--)x.addOffset(A[O]);return x.endVector()}static startPartsVector(x,A){x.startVector(4,A,4)}static endGeometry(x){return x.endObject()}static createGeometry(x,A,O,G,Q,le,Te,ue,xe){return U.startGeometry(x),U.addEnds(x,A),U.addXy(x,O),U.addZ(x,G),U.addM(x,Q),U.addT(x,le),U.addTm(x,Te),U.addType(x,ue),U.addParts(x,xe),U.endGeometry(x)}}function J(K,x){let A,O,{xy:G,z:Q,ends:le,parts:Te,type:ue}=x;if(Te){let we=Te.map(Qe=>J(K,Qe)),ze=U.createPartsVector(K,we);return U.startGeometry(K),U.addParts(K,ze),U.addType(K,ue),U.endGeometry(K)}let xe=U.createXyVector(K,G);return Q&&(A=U.createZVector(K,Q)),le&&(O=U.createEndsVector(K,le)),U.startGeometry(K),O&&U.addEnds(K,O),U.addXy(K,xe),A&&U.addZ(K,A),U.addType(K,ue),U.endGeometry(K)}function N(K,x,A){if(K.length!==0)if(Array.isArray(K[0]))for(let O of K)N(O,x,A);else K.length===2?x.push(...K):(x.push(K[0],K[1]),A.push(K[2]))}function de(K,x){let A=[];for(let O=0;O<K.length;O+=2){let G=[K[O],K[O+1]];x&&G.push(x[O>>1]),A.push(G)}return A}function pe(K){return K?c[K]:c.Unknown}function De(K){let x,A,O=K.coordinates,G=[],Q=[],le=pe(K.type),Te=0;switch(K.type){case"Point":case"MultiPoint":case"LineString":N(O,G,Q);break;case"MultiLineString":case"Polygon":N(O,G,Q),O.length>1&&(x=O.map(ue=>Te+=ue.length));break;case"MultiPolygon":A=O.map(ue=>({type:"Polygon",coordinates:ue})).map(De)}return{xy:G,z:Q.length>0?Q:void 0,ends:x,type:le,parts:A}}function fe(K){let x=pe(K.type),A=[];for(let O=0;O<K.geometries.length;O++){let G=K.geometries[O];G.type==="GeometryCollection"?A.push(fe(G)):A.push(De(G))}return{type:x,parts:A}}function ke(K,x){let A=x;if(A===c.Unknown&&(A=K.type()),A===c.GeometryCollection){let G=[];for(let Q=0;Q<K.partsLength();Q++){let le=K.parts(Q),Te=le.type();G.push(ke(le,Te))}return{type:c[A],geometries:G}}if(A===c.MultiPolygon){let G=[];for(let Q=0;Q<K.partsLength();Q++)G.push(ke(K.parts(Q),c.Polygon));return{type:c[A],coordinates:G.map(Q=>Q.coordinates)}}let O=function(G,Q){let le=G.xyArray(),Te=G.zArray();switch(Q){case c.Point:{let ue=Array.from(le);return Te&&ue.push(Te[0]),ue}case c.MultiPoint:case c.LineString:return de(le,Te);case c.MultiLineString:case c.Polygon:return function(ue,xe,we){let ze;if(!we||we.length===0)return[de(ue,xe)];let Qe=0,je=Array.from(we).map(ft=>ue.slice(Qe,Qe=ft<<1));return xe&&(Qe=0,ze=Array.from(we).map(ft=>xe.slice(Qe,Qe=ft))),je.map((ft,Pt)=>de(ft,ze?ze[Pt]:void 0))}(le,Te,G.endsArray())}}(K,A);return{type:c[A],coordinates:O}}var He=((M={})[M.Byte=0]="Byte",M[M.UByte=1]="UByte",M[M.Bool=2]="Bool",M[M.Short=3]="Short",M[M.UShort=4]="UShort",M[M.Int=5]="Int",M[M.UInt=6]="UInt",M[M.Long=7]="Long",M[M.ULong=8]="ULong",M[M.Float=9]="Float",M[M.Double=10]="Double",M[M.String=11]="String",M[M.Json=12]="Json",M[M.DateTime=13]="DateTime",M[M.Binary=14]="Binary",M);class Oe{constructor(){Vr(this,"bb",null);Vr(this,"bb_pos",0)}__init(x,A){return this.bb_pos=x,this.bb=A,this}static getRootAsColumn(x,A){return(A||new Oe).__init(x.readInt32(x.position())+x.position(),x)}static getSizePrefixedRootAsColumn(x,A){return x.setPosition(x.position()+4),(A||new Oe).__init(x.readInt32(x.position())+x.position(),x)}name(x){let A=this.bb.__offset(this.bb_pos,4);return A?this.bb.__string(this.bb_pos+A,x):null}type(){let x=this.bb.__offset(this.bb_pos,6);return x?this.bb.readUint8(this.bb_pos+x):He.Byte}title(x){let A=this.bb.__offset(this.bb_pos,8);return A?this.bb.__string(this.bb_pos+A,x):null}description(x){let A=this.bb.__offset(this.bb_pos,10);return A?this.bb.__string(this.bb_pos+A,x):null}width(){let x=this.bb.__offset(this.bb_pos,12);return x?this.bb.readInt32(this.bb_pos+x):-1}precision(){let x=this.bb.__offset(this.bb_pos,14);return x?this.bb.readInt32(this.bb_pos+x):-1}scale(){let x=this.bb.__offset(this.bb_pos,16);return x?this.bb.readInt32(this.bb_pos+x):-1}nullable(){let x=this.bb.__offset(this.bb_pos,18);return!x||!!this.bb.readInt8(this.bb_pos+x)}unique(){let x=this.bb.__offset(this.bb_pos,20);return!!x&&!!this.bb.readInt8(this.bb_pos+x)}primaryKey(){let x=this.bb.__offset(this.bb_pos,22);return!!x&&!!this.bb.readInt8(this.bb_pos+x)}metadata(x){let A=this.bb.__offset(this.bb_pos,24);return A?this.bb.__string(this.bb_pos+A,x):null}static startColumn(x){x.startObject(11)}static addName(x,A){x.addFieldOffset(0,A,0)}static addType(x,A){x.addFieldInt8(1,A,He.Byte)}static addTitle(x,A){x.addFieldOffset(2,A,0)}static addDescription(x,A){x.addFieldOffset(3,A,0)}static addWidth(x,A){x.addFieldInt32(4,A,-1)}static addPrecision(x,A){x.addFieldInt32(5,A,-1)}static addScale(x,A){x.addFieldInt32(6,A,-1)}static addNullable(x,A){x.addFieldInt8(7,+A,1)}static addUnique(x,A){x.addFieldInt8(8,+A,0)}static addPrimaryKey(x,A){x.addFieldInt8(9,+A,0)}static addMetadata(x,A){x.addFieldOffset(10,A,0)}static endColumn(x){let A=x.endObject();return x.requiredField(A,4),A}static createColumn(x,A,O,G,Q,le,Te,ue,xe,we,ze,Qe){return Oe.startColumn(x),Oe.addName(x,A),Oe.addType(x,O),Oe.addTitle(x,G),Oe.addDescription(x,Q),Oe.addWidth(x,le),Oe.addPrecision(x,Te),Oe.addScale(x,ue),Oe.addNullable(x,xe),Oe.addUnique(x,we),Oe.addPrimaryKey(x,ze),Oe.addMetadata(x,Qe),Oe.endColumn(x)}}class Le{constructor(){Vr(this,"bb",null);Vr(this,"bb_pos",0)}__init(x,A){return this.bb_pos=x,this.bb=A,this}static getRootAsFeature(x,A){return(A||new Le).__init(x.readInt32(x.position())+x.position(),x)}static getSizePrefixedRootAsFeature(x,A){return x.setPosition(x.position()+4),(A||new Le).__init(x.readInt32(x.position())+x.position(),x)}geometry(x){let A=this.bb.__offset(this.bb_pos,4);return A?(x||new U).__init(this.bb.__indirect(this.bb_pos+A),this.bb):null}properties(x){let A=this.bb.__offset(this.bb_pos,6);return A?this.bb.readUint8(this.bb.__vector(this.bb_pos+A)+x):0}propertiesLength(){let x=this.bb.__offset(this.bb_pos,6);return x?this.bb.__vector_len(this.bb_pos+x):0}propertiesArray(){let x=this.bb.__offset(this.bb_pos,6);return x?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+x),this.bb.__vector_len(this.bb_pos+x)):null}columns(x,A){let O=this.bb.__offset(this.bb_pos,8);return O?(A||new Oe).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+O)+4*x),this.bb):null}columnsLength(){let x=this.bb.__offset(this.bb_pos,8);return x?this.bb.__vector_len(this.bb_pos+x):0}static startFeature(x){x.startObject(3)}static addGeometry(x,A){x.addFieldOffset(0,A,0)}static addProperties(x,A){x.addFieldOffset(1,A,0)}static createPropertiesVector(x,A){x.startVector(1,A.length,1);for(let O=A.length-1;O>=0;O--)x.addInt8(A[O]);return x.endVector()}static startPropertiesVector(x,A){x.startVector(1,A,1)}static addColumns(x,A){x.addFieldOffset(2,A,0)}static createColumnsVector(x,A){x.startVector(4,A.length,4);for(let O=A.length-1;O>=0;O--)x.addOffset(A[O]);return x.endVector()}static startColumnsVector(x,A){x.startVector(4,A,4)}static endFeature(x){return x.endObject()}static finishFeatureBuffer(x,A){x.finish(A)}static finishSizePrefixedFeatureBuffer(x,A){x.finish(A,void 0,!0)}static createFeature(x,A,O,G){return Le.startFeature(x),Le.addGeometry(x,A),Le.addProperties(x,O),Le.addColumns(x,G),Le.endFeature(x)}}let Ke=new TextEncoder,Ue=new TextDecoder;function Ae(K,x,A){let O=A.columns,G=new V,Q=0,le=1024,Te=new Uint8Array(1024),ue=new DataView(Te.buffer),xe=function(je){if(Q+je<le)return;let ft=new Uint8Array(le=Math.max(le+je,2*le));ft.set(Te),ue=new DataView((Te=ft).buffer)};if(O)for(let je=0;je<O.length;je++){let ft=O[je],Pt=x[ft.name];if(Pt!==null)switch(xe(2),ue.setUint16(Q,je,!0),Q+=2,ft.type){case He.Bool:xe(1),ue.setUint8(Q,Pt),Q+=1;break;case He.Short:xe(2),ue.setInt16(Q,Pt,!0),Q+=2;break;case He.UShort:xe(2),ue.setUint16(Q,Pt,!0),Q+=2;break;case He.Int:xe(4),ue.setInt32(Q,Pt,!0),Q+=4;break;case He.UInt:xe(4),ue.setUint32(Q,Pt,!0),Q+=4;break;case He.Long:xe(8),ue.setBigInt64(Q,BigInt(Pt),!0),Q+=8;break;case He.Float:xe(4),ue.setFloat32(Q,Pt,!0),Q+=4;break;case He.Double:xe(8),ue.setFloat64(Q,Pt,!0),Q+=8;break;case He.DateTime:case He.String:{let rr=Ke.encode(Pt);xe(4),ue.setUint32(Q,rr.length,!0),Q+=4,xe(rr.length),Te.set(rr,Q),Q+=rr.length;break}case He.Json:{let rr=Ke.encode(JSON.stringify(Pt));xe(4),ue.setUint32(Q,rr.length,!0),Q+=4,xe(rr.length),Te.set(rr,Q),Q+=rr.length;break}case He.Binary:xe(4),ue.setUint32(Q,Pt.length,!0),Q+=4,xe(Pt.length),Te.set(Pt,Q),Q+=Pt.length;break;default:throw Error("Unknown type "+ft.type)}}let we=0;Q>0&&(we=Le.createPropertiesVector(G,Te.slice(0,Q)));let ze=J(G,K);Le.startFeature(G),Le.addGeometry(G,ze),we&&Le.addProperties(G,we);let Qe=Le.endFeature(G);return G.finishSizePrefixed(Qe),G.asUint8Array()}function lt(K,x){let A={};if(!x||x.length===0)return A;let O=K.propertiesArray();if(!O)return A;let G=new DataView(O.buffer,O.byteOffset),Q=K.propertiesLength(),le=0;for(;le<Q;){let Te=G.getUint16(le,!0);le+=2;let ue=x[Te],xe=ue.name;switch(ue.type){case He.Bool:A[xe]=!!G.getUint8(le),le+=1;break;case He.Byte:A[xe]=G.getInt8(le),le+=1;break;case He.UByte:A[xe]=G.getUint8(le),le+=1;break;case He.Short:A[xe]=G.getInt16(le,!0),le+=2;break;case He.UShort:A[xe]=G.getUint16(le,!0),le+=2;break;case He.Int:A[xe]=G.getInt32(le,!0),le+=4;break;case He.UInt:A[xe]=G.getUint32(le,!0),le+=4;break;case He.Long:A[xe]=Number(G.getBigInt64(le,!0)),le+=8;break;case He.ULong:A[xe]=Number(G.getBigUint64(le,!0)),le+=8;break;case He.Float:A[xe]=G.getFloat32(le,!0),le+=4;break;case He.Double:A[xe]=G.getFloat64(le,!0),le+=8;break;case He.DateTime:case He.String:{let we=G.getUint32(le,!0);le+=4,A[xe]=Ue.decode(O.subarray(le,le+we)),le+=we;break}case He.Json:{let we=G.getUint32(le,!0);le+=4;let ze=Ue.decode(O.subarray(le,le+we));A[xe]=JSON.parse(ze),le+=we;break}case He.Binary:{let we=G.getUint32(le,!0);le+=4,A[xe]=O.subarray(le,le+we),le+=we;break}default:throw Error("Unknown type "+ue.type)}}return A}function mt(K,x,A){let O=A.columns;return{type:"Feature",id:K,geometry:ke(x.geometry(),A.geometryType),properties:lt(x,O)}}var _e=new Uint8Array(0);function ve(K,x){if(!K.length)return x;if(!x.length)return K;var A=new Uint8Array(K.length+x.length);return A.set(K),A.set(x,K.length),A}function $e(K){this._source=K,this._array=_e,this._index=0}$e.prototype.read=function(){var K=this,x=K._array.subarray(K._index);return K._source.read().then(function(A){return K._array=_e,K._index=0,A.done?x.length>0?{done:!1,value:x}:{done:!0,value:void 0}:{done:!1,value:ve(x,A.value)}})},$e.prototype.slice=function(K){if((K|=0)<0)throw new Error("invalid length");var x=this,A=this._array.length-this._index;if(this._index+K<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=K));var O=new Uint8Array(K);return O.set(this._array.subarray(this._index)),function G(){return x._source.read().then(function(Q){return Q.done?(x._array=_e,x._index=0,A>0?O.subarray(0,A):null):A+Q.value.length>=K?(x._array=Q.value,x._index=K-A,O.set(Q.value.subarray(0,K-A),A),O):(O.set(Q.value,A),A+=Q.value.length,G())})}()},$e.prototype.cancel=function(){return this._source.cancel()};class Ne{constructor(){Vr(this,"bb",null);Vr(this,"bb_pos",0)}__init(x,A){return this.bb_pos=x,this.bb=A,this}static getRootAsCrs(x,A){return(A||new Ne).__init(x.readInt32(x.position())+x.position(),x)}static getSizePrefixedRootAsCrs(x,A){return x.setPosition(x.position()+4),(A||new Ne).__init(x.readInt32(x.position())+x.position(),x)}org(x){let A=this.bb.__offset(this.bb_pos,4);return A?this.bb.__string(this.bb_pos+A,x):null}code(){let x=this.bb.__offset(this.bb_pos,6);return x?this.bb.readInt32(this.bb_pos+x):0}name(x){let A=this.bb.__offset(this.bb_pos,8);return A?this.bb.__string(this.bb_pos+A,x):null}description(x){let A=this.bb.__offset(this.bb_pos,10);return A?this.bb.__string(this.bb_pos+A,x):null}wkt(x){let A=this.bb.__offset(this.bb_pos,12);return A?this.bb.__string(this.bb_pos+A,x):null}codeString(x){let A=this.bb.__offset(this.bb_pos,14);return A?this.bb.__string(this.bb_pos+A,x):null}static startCrs(x){x.startObject(6)}static addOrg(x,A){x.addFieldOffset(0,A,0)}static addCode(x,A){x.addFieldInt32(1,A,0)}static addName(x,A){x.addFieldOffset(2,A,0)}static addDescription(x,A){x.addFieldOffset(3,A,0)}static addWkt(x,A){x.addFieldOffset(4,A,0)}static addCodeString(x,A){x.addFieldOffset(5,A,0)}static endCrs(x){return x.endObject()}static createCrs(x,A,O,G,Q,le,Te){return Ne.startCrs(x),Ne.addOrg(x,A),Ne.addCode(x,O),Ne.addName(x,G),Ne.addDescription(x,Q),Ne.addWkt(x,le),Ne.addCodeString(x,Te),Ne.endCrs(x)}}class wt{constructor(){Vr(this,"bb",null);Vr(this,"bb_pos",0)}__init(x,A){return this.bb_pos=x,this.bb=A,this}static getRootAsHeader(x,A){return(A||new wt).__init(x.readInt32(x.position())+x.position(),x)}static getSizePrefixedRootAsHeader(x,A){return x.setPosition(x.position()+4),(A||new wt).__init(x.readInt32(x.position())+x.position(),x)}name(x){let A=this.bb.__offset(this.bb_pos,4);return A?this.bb.__string(this.bb_pos+A,x):null}envelope(x){let A=this.bb.__offset(this.bb_pos,6);return A?this.bb.readFloat64(this.bb.__vector(this.bb_pos+A)+8*x):0}envelopeLength(){let x=this.bb.__offset(this.bb_pos,6);return x?this.bb.__vector_len(this.bb_pos+x):0}envelopeArray(){let x=this.bb.__offset(this.bb_pos,6);return x?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+x),this.bb.__vector_len(this.bb_pos+x)):null}geometryType(){let x=this.bb.__offset(this.bb_pos,8);return x?this.bb.readUint8(this.bb_pos+x):c.Unknown}hasZ(){let x=this.bb.__offset(this.bb_pos,10);return!!x&&!!this.bb.readInt8(this.bb_pos+x)}hasM(){let x=this.bb.__offset(this.bb_pos,12);return!!x&&!!this.bb.readInt8(this.bb_pos+x)}hasT(){let x=this.bb.__offset(this.bb_pos,14);return!!x&&!!this.bb.readInt8(this.bb_pos+x)}hasTm(){let x=this.bb.__offset(this.bb_pos,16);return!!x&&!!this.bb.readInt8(this.bb_pos+x)}columns(x,A){let O=this.bb.__offset(this.bb_pos,18);return O?(A||new Oe).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+O)+4*x),this.bb):null}columnsLength(){let x=this.bb.__offset(this.bb_pos,18);return x?this.bb.__vector_len(this.bb_pos+x):0}featuresCount(){let x=this.bb.__offset(this.bb_pos,20);return x?this.bb.readUint64(this.bb_pos+x):BigInt("0")}indexNodeSize(){let x=this.bb.__offset(this.bb_pos,22);return x?this.bb.readUint16(this.bb_pos+x):16}crs(x){let A=this.bb.__offset(this.bb_pos,24);return A?(x||new Ne).__init(this.bb.__indirect(this.bb_pos+A),this.bb):null}title(x){let A=this.bb.__offset(this.bb_pos,26);return A?this.bb.__string(this.bb_pos+A,x):null}description(x){let A=this.bb.__offset(this.bb_pos,28);return A?this.bb.__string(this.bb_pos+A,x):null}metadata(x){let A=this.bb.__offset(this.bb_pos,30);return A?this.bb.__string(this.bb_pos+A,x):null}static startHeader(x){x.startObject(14)}static addName(x,A){x.addFieldOffset(0,A,0)}static addEnvelope(x,A){x.addFieldOffset(1,A,0)}static createEnvelopeVector(x,A){x.startVector(8,A.length,8);for(let O=A.length-1;O>=0;O--)x.addFloat64(A[O]);return x.endVector()}static startEnvelopeVector(x,A){x.startVector(8,A,8)}static addGeometryType(x,A){x.addFieldInt8(2,A,c.Unknown)}static addHasZ(x,A){x.addFieldInt8(3,+A,0)}static addHasM(x,A){x.addFieldInt8(4,+A,0)}static addHasT(x,A){x.addFieldInt8(5,+A,0)}static addHasTm(x,A){x.addFieldInt8(6,+A,0)}static addColumns(x,A){x.addFieldOffset(7,A,0)}static createColumnsVector(x,A){x.startVector(4,A.length,4);for(let O=A.length-1;O>=0;O--)x.addOffset(A[O]);return x.endVector()}static startColumnsVector(x,A){x.startVector(4,A,4)}static addFeaturesCount(x,A){x.addFieldInt64(8,A,BigInt("0"))}static addIndexNodeSize(x,A){x.addFieldInt16(9,A,16)}static addCrs(x,A){x.addFieldOffset(10,A,0)}static addTitle(x,A){x.addFieldOffset(11,A,0)}static addDescription(x,A){x.addFieldOffset(12,A,0)}static addMetadata(x,A){x.addFieldOffset(13,A,0)}static endHeader(x){return x.endObject()}static finishHeaderBuffer(x,A){x.finish(A)}static finishSizePrefixedHeaderBuffer(x,A){x.finish(A,void 0,!0)}}function ut(K){let x=wt.getRootAsHeader(K),A=x.featuresCount(),O=x.indexNodeSize(),G=[];for(let Te=0;Te<x.columnsLength();Te++){let ue=x.columns(Te);if(!ue)throw Error("Column unexpectedly missing");if(!ue.name())throw Error("Column name unexpectedly missing");G.push({name:ue.name(),type:ue.type(),title:ue.title(),description:ue.description(),width:ue.width(),precision:ue.precision(),scale:ue.scale(),nullable:ue.nullable(),unique:ue.unique(),primary_key:ue.primaryKey()})}let Q=x.crs(),le=Q?{org:Q.org(),code:Q.code(),name:Q.name(),description:Q.description(),wkt:Q.wkt(),code_string:Q.codeString()}:null;return{geometryType:x.geometryType(),columns:G,envelope:null,featuresCount:Number(A),indexNodeSize:O,crs:le,title:x.title(),description:x.description(),metadata:x.metadata()}}/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var At=function(K,x){return At=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,O){A.__proto__=O}||function(A,O){for(var G in O)O.hasOwnProperty(G)&&(A[G]=O[G])},At(K,x)};function ht(K,x,A,O){return new(A||(A=Promise))(function(G,Q){function le(xe){try{ue(O.next(xe))}catch(we){Q(we)}}function Te(xe){try{ue(O.throw(xe))}catch(we){Q(we)}}function ue(xe){var we;xe.done?G(xe.value):(we=xe.value,we instanceof A?we:new A(function(ze){ze(we)})).then(le,Te)}ue((O=O.apply(K,[])).next())})}function Tt(K,x){var A,O,G,Q,le={label:0,sent:function(){if(1&G[0])throw G[1];return G[1]},trys:[],ops:[]};return Q={next:Te(0),throw:Te(1),return:Te(2)},typeof Symbol=="function"&&(Q[Symbol.iterator]=function(){return this}),Q;function Te(ue){return function(xe){return function(we){if(A)throw new TypeError("Generator is already executing.");for(;le;)try{if(A=1,O&&(G=2&we[0]?O.return:we[0]?O.throw||((G=O.return)&&G.call(O),0):O.next)&&!(G=G.call(O,we[1])).done)return G;switch(O=0,G&&(we=[2&we[0],G.value]),we[0]){case 0:case 1:G=we;break;case 4:return le.label++,{value:we[1],done:!1};case 5:le.label++,O=we[1],we=[0];continue;case 7:we=le.ops.pop(),le.trys.pop();continue;default:if(G=le.trys,!((G=G.length>0&&G[G.length-1])||we[0]!==6&&we[0]!==2)){le=0;continue}if(we[0]===3&&(!G||we[1]>G[0]&&we[1]<G[3])){le.label=we[1];break}if(we[0]===6&&le.label<G[1]){le.label=G[1],G=we;break}if(G&&le.label<G[2]){le.label=G[2],le.ops.push(we);break}G[2]&&le.ops.pop(),le.trys.pop();continue}we=x.call(K,le)}catch(ze){we=[6,ze],O=0}finally{A=G=0}if(5&we[0])throw we[1];return{value:we[0]?we[1]:void 0,done:!0}}([ue,xe])}}}function Dt(K){var x=typeof Symbol=="function"&&Symbol.iterator,A=x&&K[x],O=0;if(A)return A.call(K);if(K&&typeof K.length=="number")return{next:function(){return K&&O>=K.length&&(K=void 0),{value:K&&K[O++],done:!K}}};throw new TypeError(x?"Object is not iterable.":"Symbol.iterator is not defined.")}function sr(K){return this instanceof sr?(this.v=K,this):new sr(K)}function ne(K,x,A){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var O,G=A.apply(K,x||[]),Q=[];return O={},le("next"),le("throw"),le("return"),O[Symbol.asyncIterator]=function(){return this},O;function le(ze){G[ze]&&(O[ze]=function(Qe){return new Promise(function(je,ft){Q.push([ze,Qe,je,ft])>1||Te(ze,Qe)})})}function Te(ze,Qe){try{(function(je){je.value instanceof sr?Promise.resolve(je.value.v).then(ue,xe):we(Q[0][2],je)})(G[ze](Qe))}catch(je){we(Q[0][3],je)}}function ue(ze){Te("next",ze)}function xe(ze){Te("throw",ze)}function we(ze,Qe){ze(Qe),Q.shift(),Q.length&&Te(Q[0][0],Q[0][1])}}var Ie=function(K){function x(A){var O=K.call(this,A)||this;return Object.defineProperty(O,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(O,O.constructor.prototype):O.__proto__=O.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(O,O.constructor),O}return function(A,O){function G(){this.constructor=A}At(A,O),A.prototype=O===null?Object.create(O):(G.prototype=O.prototype,new G)}(x,K),x}(Error);function Re(K){K!=null&&typeof K.then=="function"&&K.then(nt,nt)}(function(){function K(x){if(x<0)throw new RangeError("Capacity may not be less than 0");this._c=x,this._q=[]}Object.defineProperty(K.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(K.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),K.prototype.add=function(x){if(this.full)throw new Error("Buffer full");this._q.push(x)},K.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}})(),function(){function K(x){if(x<1)throw new RangeError("Capacity may not be less than 1");this._c=x,this._q=[]}Object.defineProperty(K.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(K.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),K.prototype.add=function(x){for(;this._q.length>=this._c;)this._q.shift();this._q.push(x)},K.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}}(),function(){function K(x){if(x<1)throw new RangeError("Capacity may not be less than 1");this._c=x,this._q=[]}Object.defineProperty(K.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(K.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),K.prototype.add=function(x){this._q.length<this._c&&this._q.push(x)},K.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}}();var We=1024,nt=function(){};function at(K){var x=K.err,A=Promise.resolve(K.execution).then(function(O){if(x!=null)throw x;return O});return K.err=void 0,K.execution=A.then(function(){},function(){}),K.pending===void 0?A:K.pending.then(function(){return A})}function pt(K,x){var A=K.state>=3;return Promise.resolve(x).then(function(O){return!A&&K.state>=4?at(K).then(function(G){return{value:G,done:!0}}):{value:O,done:A}})}function gt(K,x){var A,O;if(!(K.state>=2))if(K.state=2,K.onnext(),K.onstop(),K.err==null&&(K.err=x),K.pushes.length!==0||K.buffer!==void 0&&!K.buffer.empty)try{for(var G=Dt(K.pushes),Q=G.next();!Q.done;Q=G.next())Q.value.resolve()}catch(le){A={error:le}}finally{try{Q&&!Q.done&&(O=G.return)&&O.call(G)}finally{if(A)throw A.error}}else Ht(K)}function Ht(K){var x,A;if(!(K.state>=3)){K.state<2&&gt(K),K.state=3,K.buffer=void 0;try{for(var O=Dt(K.nexts),G=O.next();!G.done;G=O.next()){var Q=G.value,le=K.pending===void 0?at(K):K.pending.then(function(){return at(K)});Q.resolve(pt(K,le))}}catch(Te){x={error:Te}}finally{try{G&&!G.done&&(A=O.return)&&A.call(O)}finally{if(x)throw x.error}}K.pushes=[],K.nexts=[]}}function $t(K){K.state>=4||(K.state<3&&Ht(K),K.state=4)}function er(K,x){if(Re(x),K.pushes.length>=We)throw new Ie("No more than 1024 pending calls to push are allowed on a single repeater.");if(K.state>=2)return Promise.resolve(void 0);var A,O=K.pending===void 0?Promise.resolve(x):K.pending.then(function(){return x});O=O.catch(function(Te){K.state<2&&(K.err=Te),$t(K)}),K.nexts.length?(K.nexts.shift().resolve(pt(K,O)),A=K.nexts.length?Promise.resolve(K.nexts[0].value):K.buffer===void 0||K.buffer.full?new Promise(function(Te){return K.onnext=Te}):Promise.resolve(void 0)):K.buffer===void 0||K.buffer.full?A=new Promise(function(Te){return K.pushes.push({resolve:Te,value:O})}):(K.buffer.add(O),A=Promise.resolve(void 0));var G=!0,Q={},le=A.catch(function(Te){if(G)throw Te});return Q.then=function(Te,ue){return G=!1,Promise.prototype.then.call(A,Te,ue)},Q.catch=function(Te){return G=!1,Promise.prototype.catch.call(A,Te)},Q.finally=A.finally.bind(A),K.pending=O.then(function(){return le}).catch(function(Te){K.err=Te,$t(K)}),Q}function nr(K){if(!(K.state>=1)){K.state=1;var x=er.bind(null,K),A=function(O){var G=gt.bind(null,O),Q=new Promise(function(le){return O.onstop=le});return G.then=Q.then.bind(Q),G.catch=Q.catch.bind(Q),G.finally=Q.finally.bind(Q),G}(K);K.execution=new Promise(function(O){return O(K.executor(x,A))}),K.execution.catch(function(){return gt(K)})}}var dr=new WeakMap,Et=function(){function K(x,A){dr.set(this,{executor:x,buffer:A,err:void 0,state:0,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:nt,onstop:nt})}return K.prototype.next=function(x){Re(x);var A=dr.get(this);if(A===void 0)throw new Error("WeakMap error");if(A.nexts.length>=We)throw new Ie("No more than 1024 pending calls to next are allowed on a single repeater.");if(A.state<=0&&nr(A),A.onnext(x),A.buffer!==void 0&&!A.buffer.empty){var O=pt(A,A.buffer.remove());if(A.pushes.length){var G=A.pushes.shift();A.buffer.add(G.value),A.onnext=G.resolve}return O}if(A.pushes.length){var Q=A.pushes.shift();return A.onnext=Q.resolve,pt(A,Q.value)}return A.state>=2?(Ht(A),pt(A,at(A))):new Promise(function(le){return A.nexts.push({resolve:le,value:x})})},K.prototype.return=function(x){Re(x);var A=dr.get(this);if(A===void 0)throw new Error("WeakMap error");return Ht(A),A.execution=Promise.resolve(A.execution).then(function(){return x}),pt(A,at(A))},K.prototype.throw=function(x){var A=dr.get(this);if(A===void 0)throw new Error("WeakMap error");return A.state<=0||A.state>=2||A.buffer!==void 0&&!A.buffer.empty?(Ht(A),A.err==null&&(A.err=x),pt(A,at(A))):this.next(Promise.reject(x))},K.prototype[Symbol.asyncIterator]=function(){return this},K.race=zr,K.merge=yr,K.zip=Xt,K.latest=ir,K}();function qe(K,x){var A,O,G=[],Q=function(ue){ue!=null&&typeof ue[Symbol.asyncIterator]=="function"?G.push(ue[Symbol.asyncIterator]()):ue!=null&&typeof ue[Symbol.iterator]=="function"?G.push(ue[Symbol.iterator]()):G.push(function(){return ne(this,arguments,function(){return Tt(this,function(xe){switch(xe.label){case 0:return x.yieldValues?[4,sr(ue)]:[3,3];case 1:return[4,xe.sent()];case 2:xe.sent(),xe.label=3;case 3:return x.returnValues?[4,sr(ue)]:[3,5];case 4:return[2,xe.sent()];case 5:return[2]}})})}())};try{for(var le=Dt(K),Te=le.next();!Te.done;Te=le.next())Q(Te.value)}catch(ue){A={error:ue}}finally{try{Te&&!Te.done&&(O=le.return)&&O.call(le)}finally{if(A)throw A.error}}return G}function zr(K){var x=this,A=qe(K,{returnValues:!0});return new Et(function(O,G){return ht(x,0,void 0,function(){var Q,le,Te,ue,xe,we;return Tt(this,function(ze){switch(ze.label){case 0:if(!A.length)return G(),[2];le=!1,G.then(function(){Q(),le=!0}),ze.label=1;case 1:ze.trys.push([1,,5,7]),ue=void 0,xe=0,we=function(){var Qe,je,ft,Pt,rr,lr;return Tt(this,function(yt){switch(yt.label){case 0:Qe=xe;try{for(rr=void 0,je=Dt(A),ft=je.next();!ft.done;ft=je.next())Pt=ft.value,Promise.resolve(Pt.next()).then(function(Zt){Zt.done?(G(),Te===void 0&&(Te=Zt)):xe===Qe&&(xe++,Q(Zt))},function(Zt){return G(Zt)})}catch(Zt){rr={error:Zt}}finally{try{ft&&!ft.done&&(lr=je.return)&&lr.call(je)}finally{if(rr)throw rr.error}}return[4,new Promise(function(Zt){return Q=Zt})];case 1:return(ue=yt.sent())===void 0?[3,3]:[4,O(ue.value)];case 2:yt.sent(),yt.label=3;case 3:return[2]}})},ze.label=2;case 2:return le?[3,4]:[5,we()];case 3:return ze.sent(),[3,2];case 4:return[2,Te&&Te.value];case 5:return G(),[4,Promise.race(A.map(function(Qe){return Qe.return&&Qe.return()}))];case 6:return ze.sent(),[7];case 7:return[2]}})})})}function yr(K){var x=this,A=qe(K,{yieldValues:!0});return new Et(function(O,G){return ht(x,0,void 0,function(){var Q,le,Te,ue=this;return Tt(this,function(xe){switch(xe.label){case 0:if(!A.length)return G(),[2];Q=[],le=!1,G.then(function(){var we,ze;le=!0;try{for(var Qe=Dt(Q),je=Qe.next();!je.done;je=Qe.next())(0,je.value)()}catch(ft){we={error:ft}}finally{try{je&&!je.done&&(ze=Qe.return)&&ze.call(Qe)}finally{if(we)throw we.error}}}),xe.label=1;case 1:return xe.trys.push([1,,3,4]),[4,Promise.all(A.map(function(we,ze){return ht(ue,0,void 0,function(){var Qe;return Tt(this,function(je){switch(je.label){case 0:je.trys.push([0,,6,9]),je.label=1;case 1:return le?[3,5]:(Promise.resolve(we.next()).then(function(ft){return Q[ze](ft)},function(ft){return G(ft)}),[4,new Promise(function(ft){Q[ze]=ft})]);case 2:return(Qe=je.sent())===void 0?[3,4]:Qe.done?(Te=Qe,[2]):[4,O(Qe.value)];case 3:je.sent(),je.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return we.return?[4,we.return()]:[3,8];case 7:je.sent(),je.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return xe.sent(),[2,Te&&Te.value];case 3:return G(),[7];case 4:return[2]}})})})}function Xt(K){var x=this,A=qe(K,{returnValues:!0});return new Et(function(O,G){return ht(x,0,void 0,function(){var Q,le,Te,ue;return Tt(this,function(xe){switch(xe.label){case 0:if(!A.length)return G(),[2,[]];le=!1,G.then(function(){Q(),le=!0}),xe.label=1;case 1:xe.trys.push([1,,6,8]),xe.label=2;case 2:return le?[3,5]:(Promise.all(A.map(function(we){return we.next()})).then(function(we){return Q(we)},function(we){return G(we)}),[4,new Promise(function(we){return Q=we})]);case 3:return(Te=xe.sent())===void 0?[2]:(ue=Te.map(function(we){return we.value}),Te.some(function(we){return we.done})?[2,ue]:[4,O(ue)]);case 4:return xe.sent(),[3,2];case 5:return[3,8];case 6:return G(),[4,Promise.all(A.map(function(we){return we.return&&we.return()}))];case 7:return xe.sent(),[7];case 8:return[2]}})})})}function ir(K){var x=this,A=qe(K,{yieldValues:!0,returnValues:!0});return new Et(function(O,G){return ht(x,0,void 0,function(){var Q,le,Te,ue,xe,we=this;return Tt(this,function(ze){switch(ze.label){case 0:if(!A.length)return G(),[2,[]];le=[],Te=!1,G.then(function(){var Qe,je;Q();try{for(var ft=Dt(le),Pt=ft.next();!Pt.done;Pt=ft.next())(0,Pt.value)()}catch(rr){Qe={error:rr}}finally{try{Pt&&!Pt.done&&(je=ft.return)&&je.call(ft)}finally{if(Qe)throw Qe.error}}Te=!0}),ze.label=1;case 1:return ze.trys.push([1,,5,7]),Promise.all(A.map(function(Qe){return Qe.next()})).then(function(Qe){return Q(Qe)},function(Qe){return G(Qe)}),[4,new Promise(function(Qe){return Q=Qe})];case 2:return(ue=ze.sent())===void 0?[2]:(xe=ue.map(function(Qe){return Qe.value}),ue.every(function(Qe){return Qe.done})?[2,xe]:[4,O(xe.slice())]);case 3:return ze.sent(),[4,Promise.all(A.map(function(Qe,je){return ht(we,0,void 0,function(){var ft;return Tt(this,function(Pt){switch(Pt.label){case 0:if(ue[je].done)return[2,ue[je].value];Pt.label=1;case 1:return Te?[3,4]:(Promise.resolve(Qe.next()).then(function(rr){return le[je](rr)},function(rr){return G(rr)}),[4,new Promise(function(rr){return le[je]=rr})]);case 2:return(ft=Pt.sent())===void 0?[2,ue[je].value]:ft.done?[2,ft.value]:(xe[je]=ft.value,[4,O(xe.slice())]);case 3:return Pt.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,ze.sent()];case 5:return G(),[4,Promise.all(A.map(function(Qe){return Qe.return&&Qe.return()}))];case 6:return ze.sent(),[7];case 7:return[2]}})})})}const Bi=class Bi{constructor(){Vr(this,"_extraRequestThreshold",262144)}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(x){if(x<0)throw Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=x}};Vr(Bi,"global",new Bi);let ar=Bi;function or(K,x){x=Math.min(Math.max(+x,2),65535);let A=K,O=A;do O+=A=Math.ceil(A/x);while(A!==1);return 40*O}async function*xr(K,x,A,O){class G{constructor(je,ft){Vr(this,"_level");Vr(this,"nodes");this._level=ft,this.nodes=je}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(je){this.nodes[1]=je}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}let{minX:Q,minY:le,maxX:Te,maxY:ue}=A,xe=function(Qe,je){if(je<2)throw Error("Node size must be at least 2");if(Qe===0)throw Error("Number of items must be greater than 0");let ft=Qe,Pt=ft,rr=[ft];do Pt+=ft=Math.ceil(ft/je),rr.push(ft);while(ft!==1);let lr=[];for(let Zt of(ft=Pt,rr))lr.push(ft-Zt),ft-=Zt;let yt=[];for(let Zt=0;Zt<rr.length;Zt++)yt.push([lr[Zt],lr[Zt]+rr[Zt]]);return yt}(K,x),we=xe[0][0],ze=[new G([0,1],xe.length-1)];for(;ze.length!=0;){let Qe=ze.shift(),je=Qe.startNodeIdx(),ft=je>=we,Pt=(()=>{let[,yt]=xe[Qe.level()],Zt=Math.min(Qe.endNodeIdx()+x,yt);return ft&&Zt<yt?Zt+1:Zt})(),rr=Pt-je,lr=new DataView(await O(40*je,40*rr));for(let yt=je;yt<Pt;yt++){let Zt=yt-je,Qt=40*Zt;if(Te<lr.getFloat64(Qt+0,!0)||ue<lr.getFloat64(Qt+8,!0)||Q>lr.getFloat64(Qt+16,!0)||le>lr.getFloat64(Qt+24,!0))continue;let Pr=lr.getBigUint64(Qt+32,!0);if(ft){let en=(()=>{if(!(yt<K-1))return null;{let yi=40*(Zt+1);return lr.getBigUint64(yi+32,!0)-Pr}})(),di=yt-we;yield[Number(Pr),di,Number(en)];continue}let Sr=ar.global.extraRequestThreshold()/40,Ir=ze[ze.length-1];if(Ir!==void 0&&Ir.level()==Qe.level()-1&&Pr<Ir.endNodeIdx()+Sr){Ir.extendEndNodeIdx(Number(Pr));continue}let pr=(()=>{let en=Qe.level()-1;return new G([Number(Pr),Number(Pr)+1],en)})();Ir!==void 0&&(Ir.level(),pr.level()),ze.push(pr)}}}const wr=new Uint8Array([102,103,98,3,102,103,98,0]);class Dr{constructor(x,A,O,G,Q){Vr(this,"headerClient");Vr(this,"header");Vr(this,"headerLength");Vr(this,"indexLength");Vr(this,"nocache");this.headerClient=x,this.header=A,this.headerLength=O,this.indexLength=G,this.nocache=Q}static async open(x,A){let O,G=new Fr(x,A),Q=2024+(()=>{let xe,we=0;for(xe=0;xe<3;xe++)we+=16**xe*40;return we})();if(!new Uint8Array(await G.getRange(0,8,Q,"header")).subarray(0,3).every((xe,we)=>wr[we]===xe))throw Error("Not a FlatGeobuf file");if((O=new DataView(await G.getRange(8,4,Q,"header")).getUint32(0,!0))>10485760||O<8)throw Error("Invalid header size");let le=await G.getRange(12,O,Q,"header"),Te=ut(new B(new Uint8Array(le))),ue=or(Te.featuresCount,Te.indexNodeSize);return new Dr(G,Te,O,ue,A)}async*selectBbox(x){let A=this.lengthBeforeTree(),O=this.headerClient,G=async function(ue,xe){return O.getRange(A+ue,xe,0,"index")},Q=[],le=[];for await(let ue of xr(this.header.featuresCount,this.header.indexNodeSize,x,G)){let[xe,we]=ue,[,,ze]=ue;if(ze||(ze=4),le.length==0){le.push([xe,ze,we]);continue}let Qe=le[le.length-1];xe-(Qe[0]+Qe[1])>ar.global.extraRequestThreshold()&&(Q.push(le),le=[]),le.push([xe,ze,we])}this.headerClient.logUsage("header+index"),le.length>0&&Q.push(le);let Te=Q.flatMap(ue=>this.readFeatureBatch(ue,this.nocache));yield*Et.merge(Te)}lengthBeforeTree(){return wr.length+4+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(x){return new Fr(this.headerClient.httpClient,x)}async*readFeatureBatch(x,A){let[O]=x[0],[G,Q]=x[x.length-1],le=this.buildFeatureClient(A),Te=G+Q-O;for(let[ue,,xe]of x){let we=await this.readFeature(le,ue,Te);yield{id:xe,feature:we},Te=0}le.logUsage("feature")}async readFeature(x,A,O){let G,Q=A+this.lengthBeforeFeatures();G=new DataView(await x.getRange(Q,4,O,"feature length")).getUint32(0,!0);let le=new Uint8Array(await x.getRange(Q+4,G,O,"feature data")),Te=new Uint8Array(G+4);Te.set(le,4);let ue=new B(Te);return ue.setPosition(4),Le.getRootAsFeature(ue)}}class Fr{constructor(x,A){Vr(this,"httpClient");Vr(this,"bytesEverUsed",0);Vr(this,"bytesEverFetched",0);Vr(this,"buffer",new ArrayBuffer(0));Vr(this,"head",0);if(typeof x=="string")this.httpClient=new Zr(x,A);else{if(!(x instanceof Zr))throw Error("Unknown source ");this.httpClient=x}}async getRange(x,A,O,G){this.bytesEverUsed+=A;let Q=x-this.head,le=Q+A;if(Q>=0&&le<=this.buffer.byteLength)return this.buffer.slice(Q,le);let Te=Math.max(A,O);return this.bytesEverFetched+=Te,this.buffer=await this.httpClient.getRange(x,Te,G),this.head=x,this.buffer.slice(0,A)}logUsage(x){x.split(" ")[0],(100*this.bytesEverUsed/this.bytesEverFetched).toFixed(2)}}class Zr{constructor(x,A){Vr(this,"url");Vr(this,"nocache");Vr(this,"requestsEverMade",0);Vr(this,"bytesEverRequested",0);this.url=x,this.nocache=A}async getRange(x,A,O){this.requestsEverMade+=1,this.bytesEverRequested+=A;let G={Range:`bytes=${x}-${x+A-1}`};return this.nocache&&(G["Cache-Control"]="no-cache, no-store"),await(await fetch(this.url,{headers:G})).arrayBuffer()}}function Jr(K){let x;for(let A of K){if(x===c.Unknown)break;let O=A.getGeometry?pe(A.getGeometry().getType()):pe(A.geometry.type);x===void 0?x=O:x!==O&&(x=c.Unknown)}if(x===void 0)throw Error("Could not infer geometry type for collection of features.");return x}function Mr(K,x,A){if(!K.subarray(0,3).every((we,ze)=>wr[ze]===we))throw Error("Not a FlatGeobuf file");let O=new B(K),G=O.readUint32(wr.length);O.setPosition(wr.length+4);let Q=ut(O);A&&A(Q);let le=wr.length+4+G,{indexNodeSize:Te,featuresCount:ue}=Q;Te>0&&(le+=or(ue,Te));let xe=[];for(;le<O.capacity();){let we=O.readUint32(le);O.setPosition(le+4);let ze=Le.getRootAsFeature(O);xe.push(x(xe.length,ze,Q)),le+=4+we}return xe}async function*Rr(K,x,A){let O,G=typeof(Te=K).slice=="function"?Te:new $e(typeof Te.read=="function"?Te:Te.getReader()),Q=async ft=>await G.slice(ft),le=new Uint8Array(await Q(8));var Te;if(!le.subarray(0,3).every((ft,Pt)=>wr[Pt]===ft))throw Error("Not a FlatGeobuf file");le=new Uint8Array(await Q(4));let ue=new B(le),xe=ue.readUint32(0);le=new Uint8Array(await Q(xe));let we=ut(ue=new B(le));A&&A(we);let{indexNodeSize:ze,featuresCount:Qe}=we;if(ze>0){let ft=or(Qe,ze);await Q(ft)}let je=0;for(;O=await ur(Q,we,x,je++);)yield O}async function ur(K,x,A,O){let G=new Uint8Array(await K(4,"feature length"));if(G.byteLength===0)return;let Q=new B(G),le=Q.readUint32(0);G=new Uint8Array(await K(le,"feature data"));let Te=new Uint8Array(le+4);return Te.set(G,4),(Q=new B(Te)).setPosition(4),A(O,Le.getRootAsFeature(Q),x)}function Wi(K,x=0){let A=function(ue){let xe=ue.features[0].properties,we=null;return xe&&(we=Object.keys(xe).map(ze=>function(Qe,je){return{name:je,type:function(ft){if(typeof ft=="boolean")return He.Bool;if(typeof ft=="number")return ft%1==0?He.Int:He.Double;if(typeof ft=="string"||ft===null)return He.String;if(ft instanceof Uint8Array)return He.Binary;if(typeof ft=="object")return He.Json;throw Error(`Unknown type (value '${ft}')`)}(Qe[je]),title:null,description:null,width:-1,precision:-1,scale:-1,nullable:!0,unique:!1,primary_key:!1}}(xe,ze))),{geometryType:Jr(ue.features),columns:we,envelope:null,featuresCount:ue.features.length,indexNodeSize:0,crs:null,title:null,description:null,metadata:null}}(K),O=function(ue,xe=0){let we,ze=new V,Qe=0;ue.columns&&(Qe=wt.createColumnsVector(ze,ue.columns.map(Pt=>function(rr,lr){let yt=rr.createString(lr.name);return Oe.startColumn(rr),Oe.addName(rr,yt),Oe.addType(rr,lr.type),Oe.endColumn(rr)}(ze,Pt))));let je=ze.createString("L1");xe&&(Ne.startCrs(ze),Ne.addCode(ze,xe),we=Ne.endCrs(ze)),wt.startHeader(ze),we&&wt.addCrs(ze,we),wt.addFeaturesCount(ze,BigInt(ue.featuresCount)),wt.addGeometryType(ze,ue.geometryType),wt.addIndexNodeSize(ze,0),Qe&&wt.addColumns(ze,Qe),wt.addName(ze,je);let ft=wt.endHeader(ze);return ze.finishSizePrefixed(ft),ze.asUint8Array()}(A,x),G=K.features.map(ue=>Ae(ue.geometry.type==="GeometryCollection"?fe(ue.geometry):De(ue.geometry),ue.properties,A)),Q=G.map(ue=>ue.length).reduce((ue,xe)=>ue+xe),le=new Uint8Array(wr.length+O.length+Q);le.set(O,wr.length);let Te=wr.length+O.length;for(let ue of G)le.set(ue,Te),Te+=ue.length;return le.set(wr),le}function Qr(K,x,A,O=!1){return async function*(G,Q,le,Te,ue=!1){let xe=await Dr.open(G,ue);for await(let we of(Te&&Te(xe.header),xe.selectBbox(Q)))yield le(we.id,we.feature,xe.header)}(K,x,mt,A,O)}h.deserialize=function(K,x,A,O=!1){return K instanceof Uint8Array?function(G,Q){return{type:"FeatureCollection",features:Mr(G,mt,Q)}}(K,A):K instanceof ReadableStream?function(G,Q){return Rr(G,mt,Q)}(K,A):Qr(K,x,A,O)},h.serialize=function(K,x=0){return Wi(K,x)}});function _1(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var Gh={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.2.0/LICENSE.txt
 */var y1=Gh.exports,Jm;function v1(){return Jm||(Jm=1,function(h,a){(function(c,p){h.exports=p()})(y1,function(){var c={},p={};function v(f,s,M){if(p[f]=M,f==="index"){var B="var sharedModule = {}; ("+p.shared+")(sharedModule); ("+p.worker+")(sharedModule);",V={};return p.shared(V),p.index(c,V),typeof window<"u"&&c.setWorkerUrl(window.URL.createObjectURL(new Blob([B],{type:"text/javascript"}))),c}}v("shared",["exports"],function(f){function s(i,t,n,o){return new(n||(n=Promise))(function(d,_){function b(z){try{C(o.next(z))}catch(R){_(R)}}function S(z){try{C(o.throw(z))}catch(R){_(R)}}function C(z){var R;z.done?d(z.value):(R=z.value,R instanceof n?R:new n(function(j){j(R)})).then(b,S)}C((o=o.apply(i,t||[])).next())})}function M(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var B,V;function U(){if(V)return B;function i(t,n){this.x=t,this.y=n}return V=1,B=i,i.prototype={clone:function(){return new i(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,n){return this.clone()._rotateAround(t,n)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var n=t.x-this.x,o=t.y-this.y;return n*n+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)},_matMult:function(t){var n=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var n=Math.cos(t),o=Math.sin(t),d=o*this.x+n*this.y;return this.x=n*this.x-o*this.y,this.y=d,this},_rotateAround:function(t,n){var o=Math.cos(t),d=Math.sin(t),_=n.y+d*(this.x-n.x)+o*(this.y-n.y);return this.x=n.x+o*(this.x-n.x)-d*(this.y-n.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},i.convert=function(t){return t instanceof i?t:Array.isArray(t)?new i(t[0],t[1]):t},B}typeof SuppressedError=="function"&&SuppressedError;var J,N,de=M(U()),pe=function(){if(N)return J;function i(t,n,o,d){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(d-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=o,this.p2y=d}return N=1,J=i,i.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,d=0;d<8;d++){var _=this.sampleCurveX(o)-t;if(Math.abs(_)<n)return o;var b=this.sampleCurveDerivativeX(o);if(Math.abs(b)<1e-6)break;o-=_/b}var S=0,C=1;for(o=t,d=0;d<20&&(_=this.sampleCurveX(o),!(Math.abs(_-t)<n));d++)t>_?S=o:C=o,o=.5*(C-S)+S;return o},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},J}(),De=M(pe);let fe,ke;function He(){return fe==null&&(fe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),fe}function Oe(){if(ke==null&&(ke=!1,He())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<5*5;o++){const d=4*o;t.fillStyle=`rgb(${d},${d+1},${d+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&n[o]!==o){ke=!0;break}}}return ke||!1}var Le,Ke=1e-6,Ue=typeof Float32Array<"u"?Float32Array:Array;function Ae(){var i=new Ue(9);return Ue!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function lt(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function mt(){var i=new Ue(3);return Ue!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function _e(i,t,n){var o=new Ue(3);return o[0]=i,o[1]=t,o[2]=n,o}function ve(i,t,n){var o=t[0],d=t[1],_=t[2],b=t[3];return i[0]=n[0]*o+n[4]*d+n[8]*_+n[12]*b,i[1]=n[1]*o+n[5]*d+n[9]*_+n[13]*b,i[2]=n[2]*o+n[6]*d+n[10]*_+n[14]*b,i[3]=n[3]*o+n[7]*d+n[11]*_+n[15]*b,i}function $e(){var i=new Ue(4);return Ue!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Ne(){var i=new Ue(2);return Ue!=Float32Array&&(i[0]=0,i[1]=0),i}function wt(i,t){var n=new Ue(2);return n[0]=i,n[1]=t,n}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)}),mt(),Le=new Ue(4),Ue!=Float32Array&&(Le[0]=0,Le[1]=0,Le[2]=0,Le[3]=0),mt(),_e(1,0,0),_e(0,1,0),$e(),$e(),Ae(),Ne();const ut=8192;function At(i,t,n){return t*(ut/(i.tileSize*Math.pow(2,n-i.tileID.overscaledZ)))}function ht(i,t){return(i%t+t)%t}function Tt(i,t,n){return i*(1-n)+t*n}function Dt(i){if(i<=0)return 0;if(i>=1)return 1;const t=i*i,n=t*i;return 4*(i<.5?n:3*(i-t)+n-.75)}function sr(i,t,n,o){const d=new De(i,t,n,o);return _=>d.solve(_)}const ne=sr(.25,.1,.25,1);function Ie(i,t,n){return Math.min(n,Math.max(t,i))}function Re(i,t,n){const o=n-t,d=((i-t)%o+o)%o+t;return d===t?n:d}function We(i,...t){for(const n of t)for(const o in n)i[o]=n[o];return i}let nt=1;function at(i,t,n){const o={};for(const d in i)o[d]=t.call(this,i[d],d,i);return o}function pt(i,t,n){const o={};for(const d in i)t.call(this,i[d],d,i)&&(o[d]=i[d]);return o}function gt(i){return Array.isArray(i)?i.map(gt):typeof i=="object"&&i?at(i,gt):i}const Ht={};function $t(i){Ht[i]||(typeof console<"u"&&console.warn(i),Ht[i]=!0)}function er(i,t,n){return(n.y-i.y)*(t.x-i.x)>(t.y-i.y)*(n.x-i.x)}function nr(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let dr=null;function Et(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const qe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function zr(i,t,n,o,d){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const _=new VideoFrame(i,{timestamp:0});try{const b=_==null?void 0:_.format;if(!b||!b.startsWith("BGR")&&!b.startsWith("RGB"))throw new Error(`Unrecognized format ${b}`);const S=b.startsWith("BGR"),C=new Uint8ClampedArray(o*d*4);if(yield _.copyTo(C,function(z,R,j,H,Y){const ee=4*Math.max(1,0),ae=(Math.max(0,j)-j)*H*4+ee,ye=4*H,Me=Math.max(0,R),et=Math.max(0,j);return{rect:{x:Me,y:et,width:Math.min(z.width,R+H)-Me,height:Math.min(z.height,j+Y)-et},layout:[{offset:ae,stride:ye}]}}(i,t,n,o,d)),S)for(let z=0;z<C.length;z+=4){const R=C[z];C[z]=C[z+2],C[z+2]=R}return C}finally{_.close()}})}let yr,Xt;function ir(i,t,n,o){return i.addEventListener(t,n,o),{unsubscribe:()=>{i.removeEventListener(t,n,o)}}}function ar(i){return i/Math.PI*180}const or="AbortError";function xr(){return new Error(or)}const wr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Dr(i){return wr.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const Fr="global-dispatcher";class Zr extends Error{constructor(t,n,o,d){super(`AJAXError: ${n} (${t}): ${o}`),this.status=t,this.statusText=n,this.url=o,this.body=d}}const Jr=()=>nr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Mr=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const o=Dr(i.url);if(o)return o(i,t);if(nr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:Fr},t)}if(!(/^file:/.test(n=i.url)||/^file:/.test(Jr())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,d){return s(this,void 0,void 0,function*(){const _=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Jr(),signal:d.signal});let b,S;o.type!=="json"||_.headers.has("Accept")||_.headers.set("Accept","application/json");try{b=yield fetch(_)}catch(z){throw new Zr(0,z.message,o.url,new Blob)}if(!b.ok){const z=yield b.blob();throw new Zr(b.status,b.statusText,o.url,z)}S=o.type==="arrayBuffer"||o.type==="image"?b.arrayBuffer():o.type==="json"?b.json():b.text();const C=yield S;if(d.signal.aborted)throw xr();return{data:C,cacheControl:b.headers.get("Cache-Control"),expires:b.headers.get("Expires")}})}(i,t);if(nr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:Fr},t)}var n;return function(o,d){return new Promise((_,b)=>{var S;const C=new XMLHttpRequest;C.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(C.responseType="arraybuffer");for(const z in o.headers)C.setRequestHeader(z,o.headers[z]);o.type==="json"&&(C.responseType="text",!((S=o.headers)===null||S===void 0)&&S.Accept||C.setRequestHeader("Accept","application/json")),C.withCredentials=o.credentials==="include",C.onerror=()=>{b(new Error(C.statusText))},C.onload=()=>{if(!d.signal.aborted)if((C.status>=200&&C.status<300||C.status===0)&&C.response!==null){let z=C.response;if(o.type==="json")try{z=JSON.parse(C.response)}catch(R){return void b(R)}_({data:z,cacheControl:C.getResponseHeader("Cache-Control"),expires:C.getResponseHeader("Expires")})}else{const z=new Blob([C.response],{type:C.getResponseHeader("Content-Type")});b(new Zr(C.status,C.statusText,o.url,z))}},d.signal.addEventListener("abort",()=>{C.abort(),b(xr())}),C.send(o.body)})}(i,t)};function Rr(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function ur(i,t,n){n[i]&&n[i].indexOf(t)!==-1||(n[i]=n[i]||[],n[i].push(t))}function Wi(i,t,n){if(n&&n[i]){const o=n[i].indexOf(t);o!==-1&&n[i].splice(o,1)}}class Qr{constructor(t,n={}){We(this,n),this.type=t}}class Bi extends Qr{constructor(t,n={}){super("error",We({error:t},n))}}class K{on(t,n){return this._listeners=this._listeners||{},ur(t,n,this._listeners),{unsubscribe:()=>{this.off(t,n)}}}off(t,n){return Wi(t,n,this._listeners),Wi(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},ur(t,n,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,n){typeof t=="string"&&(t=new Qr(t,n||{}));const o=t.type;if(this.listens(o)){t.target=this;const d=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const S of d)S.call(this,t);const _=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const S of _)Wi(o,S,this._oneTimeListeners),S.call(this,t);const b=this._eventedParent;b&&(We(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(t))}else t instanceof Bi&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var x={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const A=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function O(i,t){const n={};for(const o in i)o!=="ref"&&(n[o]=i[o]);return A.forEach(o=>{o in t&&(n[o]=t[o])}),n}function G(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let n=0;n<i.length;n++)if(!G(i[n],t[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const n in i)if(!G(i[n],t[n]))return!1;return!0}return i===t}function Q(i,t){i.push(t)}function le(i,t,n){Q(n,{command:"addSource",args:[i,t[i]]})}function Te(i,t,n){Q(t,{command:"removeSource",args:[i]}),n[i]=!0}function ue(i,t,n,o){Te(i,n,o),le(i,t,n)}function xe(i,t,n){let o;for(o in i[n])if(Object.prototype.hasOwnProperty.call(i[n],o)&&o!=="data"&&!G(i[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!G(i[n][o],t[n][o]))return!1;return!0}function we(i,t,n,o,d,_){i=i||{},t=t||{};for(const b in i)Object.prototype.hasOwnProperty.call(i,b)&&(G(i[b],t[b])||n.push({command:_,args:[o,b,t[b],d]}));for(const b in t)Object.prototype.hasOwnProperty.call(t,b)&&!Object.prototype.hasOwnProperty.call(i,b)&&(G(i[b],t[b])||n.push({command:_,args:[o,b,t[b],d]}))}function ze(i){return i.id}function Qe(i,t){return i[t.id]=t,i}class je{constructor(t,n,o,d){this.message=(t?`${t}: `:"")+o,d&&(this.identifier=d),n!=null&&n.__line__&&(this.line=n.__line__)}}function ft(i,...t){for(const n of t)for(const o in n)i[o]=n[o];return i}class Pt extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class rr{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[o,d]of n)this.bindings[o]=d}concat(t){return new rr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const lr={kind:"null"},yt={kind:"number"},Zt={kind:"string"},Qt={kind:"boolean"},Pr={kind:"color"},Sr={kind:"projectionDefinition"},Ir={kind:"object"},pr={kind:"value"},en={kind:"collator"},di={kind:"formatted"},yi={kind:"padding"},ri={kind:"resolvedImage"},xs={kind:"variableAnchorOffsetCollection"};function cn(i,t){return{kind:"array",itemType:i,N:t}}function ci(i){if(i.kind==="array"){const t=ci(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const wo=[lr,yt,Zt,Qt,Pr,Sr,di,Ir,cn(pr),yi,ri,xs];function fa(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!fa(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const n of wo)if(!fa(n,t))return null}}return`Expected ${ci(i)} but found ${ci(t)} instead.`}function ro(i,t){return t.some(n=>n.kind===i.kind)}function Ks(i,t){return t.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}function io(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const El=.96422,Po=.82521,kl=4/29,no=6/29,tl=3*no*no,Ac=no*no*no,tc=Math.PI/180,Tc=180/Math.PI;function so(i){return(i%=360)<0&&(i+=360),i}function ao([i,t,n,o]){let d,_;const b=rl((.2225045*(i=Hi(i))+.7168786*(t=Hi(t))+.0606169*(n=Hi(n)))/1);i===t&&t===n?d=_=b:(d=rl((.4360747*i+.3850649*t+.1430804*n)/El),_=rl((.0139322*i+.0971045*t+.7141733*n)/Po));const S=116*b-16;return[S<0?0:S,500*(d-b),200*(b-_),o]}function Hi(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function rl(i){return i>Ac?Math.pow(i,1/3):i/tl+kl}function za([i,t,n,o]){let d=(i+16)/116,_=isNaN(t)?d:d+t/500,b=isNaN(n)?d:d-n/200;return d=1*So(d),_=El*So(_),b=Po*So(b),[il(3.1338561*_-1.6168667*d-.4906146*b),il(-.9787684*_+1.9161415*d+.033454*b),il(.0719453*_-.2289914*d+1.4052427*b),o]}function il(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function So(i){return i>no?i*i*i:tl*(i-kl)}function nl(i){return parseInt(i.padEnd(2,i),16)/255}function ws(i,t){return Ls(t?i/100:i,0,1)}function Ls(i,t,n){return Math.min(Math.max(t,i),n)}function Oi(i){return!i.some(Number.isNaN)}const Yr={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function qn(i,t,n){return i+n*(t-i)}function os(i,t,n){return i.map((o,d)=>qn(o,t[d],n))}class ei{constructor(t,n,o,d=1,_=!0){this.r=t,this.g=n,this.b=o,this.a=d,_||(this.r*=d,this.g*=d,this.b*=d,d||this.overwriteGetter("rgb",[t,n,o,d]))}static parse(t){if(t instanceof ei)return t;if(typeof t!="string")return;const n=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const d=Yr[o];if(d){const[b,S,C]=d;return[b/255,S/255,C/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const b=o.length<6?1:2;let S=1;return[nl(o.slice(S,S+=b)),nl(o.slice(S,S+=b)),nl(o.slice(S,S+=b)),nl(o.slice(S,S+b)||"ff")]}if(o.startsWith("rgb")){const b=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[S,C,z,R,j,H,Y,ee,ae,ye,Me,et]=b,Be=[R||" ",Y||" ",ye].join("");if(Be==="  "||Be==="  /"||Be===",,"||Be===",,,"){const X=[z,H,ae].join(""),me=X==="%%%"?100:X===""?255:0;if(me){const Ve=[Ls(+C/me,0,1),Ls(+j/me,0,1),Ls(+ee/me,0,1),Me?ws(+Me,et):1];if(Oi(Ve))return Ve}}return}}const _=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[b,S,C,z,R,j,H,Y,ee]=_,ae=[C||" ",R||" ",H].join("");if(ae==="  "||ae==="  /"||ae===",,"||ae===",,,"){const ye=[+S,Ls(+z,0,100),Ls(+j,0,100),Y?ws(+Y,ee):1];if(Oi(ye))return function([Me,et,Be,X]){function me(Ve){const xt=(Ve+Me/30)%12,qt=et*Math.min(Be,1-Be);return Be-qt*Math.max(-1,Math.min(xt-3,9-xt,1))}return Me=so(Me),et/=100,Be/=100,[me(0),me(8),me(4),X]}(ye)}}}(t);return n?new ei(...n,!1):void 0}get rgb(){const{r:t,g:n,b:o,a:d}=this,_=d||1/0;return this.overwriteGetter("rgb",[t/_,n/_,o/_,d])}get hcl(){return this.overwriteGetter("hcl",function(t){const[n,o,d,_]=ao(t),b=Math.sqrt(o*o+d*d);return[Math.round(1e4*b)?so(Math.atan2(d,o)*Tc):NaN,b,n,_]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ao(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,o,d]=this.rgb;return`rgba(${[t,n,o].map(_=>Math.round(255*_)).join(",")},${d})`}static interpolate(t,n,o,d="rgb"){switch(d){case"rgb":{const[_,b,S,C]=os(t.rgb,n.rgb,o);return new ei(_,b,S,C,!1)}case"hcl":{const[_,b,S,C]=t.hcl,[z,R,j,H]=n.hcl;let Y,ee;if(isNaN(_)||isNaN(z))isNaN(_)?isNaN(z)?Y=NaN:(Y=z,S!==1&&S!==0||(ee=R)):(Y=_,j!==1&&j!==0||(ee=b));else{let Be=z-_;z>_&&Be>180?Be-=360:z<_&&_-z>180&&(Be+=360),Y=_+o*Be}const[ae,ye,Me,et]=function([Be,X,me,Ve]){return Be=isNaN(Be)?0:Be*tc,za([me,Math.cos(Be)*X,Math.sin(Be)*X,Ve])}([Y,ee??qn(b,R,o),qn(S,j,o),qn(C,H,o)]);return new ei(ae,ye,Me,et,!1)}case"lab":{const[_,b,S,C]=za(os(t.lab,n.lab,o));return new ei(_,b,S,C,!1)}}}}ei.black=new ei(0,0,0,1),ei.white=new ei(1,1,1,1),ei.transparent=new ei(0,0,0,0),ei.red=new ei(1,0,0,1);class sl{constructor(t,n,o){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const al=["bottom","center","top"];class ls{constructor(t,n,o,d,_,b){this.text=t,this.image=n,this.scale=o,this.fontStack=d,this.textColor=_,this.verticalAlign=b}}class tn{constructor(t){this.sections=t}static fromString(t){return new tn([new ls(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof tn?t:tn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class un{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof un)return t;if(typeof t=="number")return new un([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new un(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){return new un(os(t.values,n.values,o))}}class ki{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const zl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ti{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ti)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const o=t[n],d=t[n+1];if(typeof o!="string"||!zl.has(o)||!Array.isArray(d)||d.length!==2||typeof d[0]!="number"||typeof d[1]!="number")return}return new Ti(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){const d=t.values,_=n.values;if(d.length!==_.length)throw new ki(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${n.toString()}`);const b=[];for(let S=0;S<d.length;S+=2){if(d[S]!==_[S])throw new ki(`Cannot interpolate values containing mismatched anchors. from[${S}]: ${d[S]}, to[${S}]: ${_[S]}`);b.push(d[S]);const[C,z]=d[S+1],[R,j]=_[S+1];b.push([qn(C,R,o),qn(z,j,o)])}return new Ti(b)}}class hn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new hn({name:t,available:!1}):null}}class mn{constructor(t,n,o){this.from=t,this.to=n,this.transition=o}static interpolate(t,n,o){return new mn(t,n,o)}static parse(t){return t instanceof mn?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new mn(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new mn(t.from,t.to,t.transition):typeof t=="string"?new mn(t,t,1):void 0}}function Ao(i,t,n,o){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,t,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,t,n,o]:[i,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ii(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof mn||i instanceof ei||i instanceof sl||i instanceof tn||i instanceof un||i instanceof Ti||i instanceof hn)return!0;if(Array.isArray(i)){for(const t of i)if(!Ii(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!Ii(i[t]))return!1;return!0}return!1}function Ki(i){if(i===null)return lr;if(typeof i=="string")return Zt;if(typeof i=="boolean")return Qt;if(typeof i=="number")return yt;if(i instanceof ei)return Pr;if(i instanceof mn)return Sr;if(i instanceof sl)return en;if(i instanceof tn)return di;if(i instanceof un)return yi;if(i instanceof Ti)return xs;if(i instanceof hn)return ri;if(Array.isArray(i)){const t=i.length;let n;for(const o of i){const d=Ki(o);if(n){if(n===d)continue;n=pr;break}n=d}return cn(n||pr,t)}return Ir}function Js(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof ei||i instanceof mn||i instanceof tn||i instanceof un||i instanceof Ti||i instanceof hn?i.toString():JSON.stringify(i)}class Lr{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ii(t[1]))return n.error("invalid value");const o=t[1];let d=Ki(o);const _=n.expectedType;return d.kind!=="array"||d.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(d=_),new Lr(d,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const To={string:Zt,number:yt,boolean:Qt,object:Ir};class cs{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o,d=1;const _=t[0];if(_==="array"){let S,C;if(t.length>2){const z=t[1];if(typeof z!="string"||!(z in To)||z==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);S=To[z],d++}else S=pr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);C=t[2],d++}o=cn(S,C)}else{if(!To[_])throw new Error(`Types doesn't contain name = ${_}`);o=To[_]}const b=[];for(;d<t.length;d++){const S=n.parse(t[d],d,pr);if(!S)return null;b.push(S)}return new cs(o,b)}evaluate(t){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(t);if(!fa(this.type,Ki(o)))return o;if(n===this.args.length-1)throw new ki(`Expected value to be of type ${ci(this.type)}, but found ${ci(Ki(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Es={"to-boolean":Qt,"to-color":Pr,"to-number":yt,"to-string":Zt};class us{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[0];if(!Es[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return n.error("Expected one argument.");const d=Es[o],_=[];for(let b=1;b<t.length;b++){const S=n.parse(t[b],b,pr);if(!S)return null;_.push(S)}return new us(d,_)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,o;for(const d of this.args){if(n=d.evaluate(t),o=null,n instanceof ei)return n;if(typeof n=="string"){const _=t.parseColor(n);if(_)return _}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Ao(n[0],n[1],n[2],n[3]),!o))return new ei(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new ki(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(t);const d=un.parse(n);if(d)return d}throw new ki(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(t);const d=Ti.parse(n);if(d)return d}throw new ki(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(t),n===null)return 0;const d=Number(n);if(!isNaN(d))return d}throw new ki(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return tn.fromString(Js(this.args[0].evaluate(t)));case"resolvedImage":return hn.fromString(Js(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return Js(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const wi=["Unknown","Point","LineString","Polygon"];class Da{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?wi[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=ei.parse(t)),n}}class Wr{constructor(t,n,o=[],d,_=new rr,b=[]){this.registry=t,this.path=o,this.key=o.map(S=>`[${S}]`).join(""),this.scope=_,this.errors=b,this.expectedType=d,this._isConstant=n}parse(t,n,o,d,_={}){return n?this.concat(n,o,d)._parse(t,_):this._parse(t,_)}_parse(t,n){function o(d,_,b){return b==="assert"?new cs(_,[d]):b==="coerce"?new us(_,[d]):d}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=t[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[d];if(_){let b=_.parse(t,this);if(!b)return null;if(this.expectedType){const S=this.expectedType,C=b.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||C.kind!=="value")if(S.kind!=="projectionDefinition"||C.kind!=="string"&&C.kind!=="array")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string")if(S.kind!=="padding"||C.kind!=="value"&&C.kind!=="number"&&C.kind!=="array")if(S.kind!=="variableAnchorOffsetCollection"||C.kind!=="value"&&C.kind!=="array"){if(this.checkSubtype(S,C))return null}else b=o(b,S,n.typeAnnotation||"coerce");else b=o(b,S,n.typeAnnotation||"coerce");else b=o(b,S,n.typeAnnotation||"coerce");else b=o(b,S,n.typeAnnotation||"coerce");else b=o(b,S,n.typeAnnotation||"assert")}if(!(b instanceof Lr)&&b.type.kind!=="resolvedImage"&&this._isConstant(b)){const S=new Da;try{b=new Lr(b.type,b.evaluate(S))}catch(C){return this.error(C.message),null}}return b}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,o){const d=typeof t=="number"?this.path.concat(t):this.path,_=o?this.scope.concat(o):this.scope;return new Wr(this.registry,this._isConstant,d,n||null,_,this.errors)}error(t,...n){const o=`${this.key}${n.map(d=>`[${d}]`).join("")}`;this.errors.push(new Pt(o,t))}checkSubtype(t,n){const o=fa(t,n);return o&&this.error(o),o}}class Nr{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let _=1;_<t.length-1;_+=2){const b=t[_];if(typeof b!="string")return n.error(`Expected string, but found ${typeof b} instead.`,_);if(/[^a-zA-Z0-9_]/.test(b))return n.error("Variable names must contain only alphanumeric characters or '_'.",_);const S=n.parse(t[_+1],_+1);if(!S)return null;o.push([b,S])}const d=n.parse(t[t.length-1],t.length-1,n.expectedType,o);return d?new Nr(o,d):null}outputDefined(){return this.result.outputDefined()}}class oo{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=t[1];return n.scope.has(o)?new oo(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class ti{constructor(t,n,o){this.type=t,this.index=n,this.input=o}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,yt),d=n.parse(t[2],2,cn(n.expectedType||pr));return o&&d?new ti(d.type.itemType,o,d):null}evaluate(t){const n=this.index.evaluate(t),o=this.input.evaluate(t);if(n<0)throw new ki(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new ki(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new ki(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Fa{constructor(t,n){this.type=Qt,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,pr),d=n.parse(t[2],2,pr);return o&&d?ro(o.type,[Qt,Zt,yt,lr,pr])?new Fa(o,d):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ci(o.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!Ks(n,["boolean","string","number","null"]))throw new ki(`Expected first argument to be of type boolean, string, number or null, but found ${ci(Ki(n))} instead.`);if(!Ks(o,["string","array"]))throw new ki(`Expected second argument to be of type array or string, but found ${ci(Ki(o))} instead.`);return o.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Pn{constructor(t,n,o){this.type=yt,this.needle=t,this.haystack=n,this.fromIndex=o}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,pr),d=n.parse(t[2],2,pr);if(!o||!d)return null;if(!ro(o.type,[Qt,Zt,yt,lr,pr]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ci(o.type)} instead`);if(t.length===4){const _=n.parse(t[3],3,yt);return _?new Pn(o,d,_):null}return new Pn(o,d)}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!Ks(n,["boolean","string","number","null"]))throw new ki(`Expected first argument to be of type boolean, string, number or null, but found ${ci(Ki(n))} instead.`);let d;if(this.fromIndex&&(d=this.fromIndex.evaluate(t)),Ks(o,["string"])){const _=o.indexOf(n,d);return _===-1?-1:[...o.slice(0,_)].length}if(Ks(o,["array"]))return o.indexOf(n,d);throw new ki(`Expected second argument to be of type array or string, but found ${ci(Ki(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class ks{constructor(t,n,o,d,_,b){this.inputType=t,this.type=n,this.input=o,this.cases=d,this.outputs=_,this.otherwise=b}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let o,d;n.expectedType&&n.expectedType.kind!=="value"&&(d=n.expectedType);const _={},b=[];for(let z=2;z<t.length-1;z+=2){let R=t[z];const j=t[z+1];Array.isArray(R)||(R=[R]);const H=n.concat(z);if(R.length===0)return H.error("Expected at least one branch label.");for(const ee of R){if(typeof ee!="number"&&typeof ee!="string")return H.error("Branch labels must be numbers or strings.");if(typeof ee=="number"&&Math.abs(ee)>Number.MAX_SAFE_INTEGER)return H.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ee=="number"&&Math.floor(ee)!==ee)return H.error("Numeric branch labels must be integer values.");if(o){if(H.checkSubtype(o,Ki(ee)))return null}else o=Ki(ee);if(_[String(ee)]!==void 0)return H.error("Branch labels must be unique.");_[String(ee)]=b.length}const Y=n.parse(j,z,d);if(!Y)return null;d=d||Y.type,b.push(Y)}const S=n.parse(t[1],1,pr);if(!S)return null;const C=n.parse(t[t.length-1],t.length-1,d);return C?S.type.kind!=="value"&&n.concat(1).checkSubtype(o,S.type)?null:new ks(o,d,S,_,b,C):null}evaluate(t){const n=this.input.evaluate(t);return(Ki(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class ol{constructor(t,n,o){this.type=t,this.branches=n,this.otherwise=o}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const d=[];for(let b=1;b<t.length-1;b+=2){const S=n.parse(t[b],b,Qt);if(!S)return null;const C=n.parse(t[b+1],b+1,o);if(!C)return null;d.push([S,C]),o=o||C.type}const _=n.parse(t[t.length-1],t.length-1,o);if(!_)return null;if(!o)throw new Error("Can't infer output type");return new ol(o,d,_)}evaluate(t){for(const[n,o]of this.branches)if(n.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,o]of this.branches)t(n),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class Qs{constructor(t,n,o,d){this.type=t,this.input=n,this.beginIndex=o,this.endIndex=d}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,pr),d=n.parse(t[2],2,yt);if(!o||!d)return null;if(!ro(o.type,[cn(pr),Zt,pr]))return n.error(`Expected first argument to be of type array or string, but found ${ci(o.type)} instead`);if(t.length===4){const _=n.parse(t[3],3,yt);return _?new Qs(o.type,o,d,_):null}return new Qs(o.type,o,d)}evaluate(t){const n=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let d;if(this.endIndex&&(d=this.endIndex.evaluate(t)),Ks(n,["string"]))return[...n].slice(o,d).join("");if(Ks(n,["array"]))return n.slice(o,d);throw new ki(`Expected first argument to be of type array or string, but found ${ci(Ki(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function ma(i,t){const n=i.length-1;let o,d,_=0,b=n,S=0;for(;_<=b;)if(S=Math.floor((_+b)/2),o=i[S],d=i[S+1],o<=t){if(S===n||t<d)return S;_=S+1}else{if(!(o>t))throw new ki("Input is not a number.");b=S-1}return 0}class ea{constructor(t,n,o){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[d,_]of o)this.labels.push(d),this.outputs.push(_)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(t[1],1,yt);if(!o)return null;const d=[];let _=null;n.expectedType&&n.expectedType.kind!=="value"&&(_=n.expectedType);for(let b=1;b<t.length;b+=2){const S=b===1?-1/0:t[b],C=t[b+1],z=b,R=b+1;if(typeof S!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(d.length&&d[d.length-1][0]>=S)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const j=n.parse(C,R,_);if(!j)return null;_=_||j.type,d.push([S,j])}return new ea(_,o,d)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const d=this.input.evaluate(t);if(d<=n[0])return o[0].evaluate(t);const _=n.length;return d>=n[_-1]?o[_-1].evaluate(t):o[ma(n,d)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function rc(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Io,ll,lo=function(){if(ll)return Io;function i(t,n,o,d){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(d-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=o,this.p2y=d}return ll=1,Io=i,i.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,d=0;d<8;d++){var _=this.sampleCurveX(o)-t;if(Math.abs(_)<n)return o;var b=this.sampleCurveDerivativeX(o);if(Math.abs(b)<1e-6)break;o-=_/b}var S=0,C=1;for(o=t,d=0;d<20&&(_=this.sampleCurveX(o),!(Math.abs(_-t)<n));d++)t>_?S=o:C=o,o=.5*(C-S)+S;return o},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},Io}(),zi=rc(lo);class ji{constructor(t,n,o,d,_){this.type=t,this.operator=n,this.interpolation=o,this.input=d,this.labels=[],this.outputs=[];for(const[b,S]of _)this.labels.push(b),this.outputs.push(S)}static interpolationFactor(t,n,o,d){let _=0;if(t.name==="exponential")_=cl(n,t.base,o,d);else if(t.name==="linear")_=cl(n,1,o,d);else if(t.name==="cubic-bezier"){const b=t.controlPoints;_=new zi(b[0],b[1],b[2],b[3]).solve(cl(n,1,o,d))}return _}static parse(t,n){let[o,d,_,...b]=t;if(!Array.isArray(d)||d.length===0)return n.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const z=d[1];if(typeof z!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:z}}else{if(d[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const z=d.slice(1);if(z.length!==4||z.some(R=>typeof R!="number"||R<0||R>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:z}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(_=n.parse(_,2,yt),!_)return null;const S=[];let C=null;o==="interpolate-hcl"||o==="interpolate-lab"?C=Pr:n.expectedType&&n.expectedType.kind!=="value"&&(C=n.expectedType);for(let z=0;z<b.length;z+=2){const R=b[z],j=b[z+1],H=z+3,Y=z+4;if(typeof R!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(S.length&&S[S.length-1][0]>=R)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',H);const ee=n.parse(j,Y,C);if(!ee)return null;C=C||ee.type,S.push([R,ee])}return io(C,yt)||io(C,Sr)||io(C,Pr)||io(C,yi)||io(C,xs)||io(C,cn(yt))?new ji(C,o,d,_,S):n.error(`Type ${ci(C)} is not interpolatable.`)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const d=this.input.evaluate(t);if(d<=n[0])return o[0].evaluate(t);const _=n.length;if(d>=n[_-1])return o[_-1].evaluate(t);const b=ma(n,d),S=ji.interpolationFactor(this.interpolation,d,n[b],n[b+1]),C=o[b].evaluate(t),z=o[b+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return qn(C,z,S);case"color":return ei.interpolate(C,z,S);case"padding":return un.interpolate(C,z,S);case"variableAnchorOffsetCollection":return Ti.interpolate(C,z,S);case"array":return os(C,z,S);case"projectionDefinition":return mn.interpolate(C,z,S)}case"interpolate-hcl":return ei.interpolate(C,z,S,"hcl");case"interpolate-lab":return ei.interpolate(C,z,S,"lab")}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function cl(i,t,n,o){const d=o-n,_=i-n;return d===0?0:t===1?_/d:(Math.pow(t,_)-1)/(Math.pow(t,d)-1)}const dn={color:ei.interpolate,number:qn,padding:un.interpolate,variableAnchorOffsetCollection:Ti.interpolate,array:os};class mi{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o=null;const d=n.expectedType;d&&d.kind!=="value"&&(o=d);const _=[];for(const S of t.slice(1)){const C=n.parse(S,1+_.length,o,void 0,{typeAnnotation:"omit"});if(!C)return null;o=o||C.type,_.push(C)}if(!o)throw new Error("No output type");const b=d&&_.some(S=>fa(d,S.type));return new mi(b?pr:o,_)}evaluate(t){let n,o=null,d=0;for(const _ of this.args)if(d++,o=_.evaluate(t),o&&o instanceof hn&&!o.available&&(n||(n=o.name),o=null,d===this.args.length&&(o=n)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Co(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ga(i,t,n,o){return o.compare(t,n)===0}function Na(i,t,n){const o=i!=="=="&&i!=="!=";return class Gg{constructor(_,b,S){this.type=Qt,this.lhs=_,this.rhs=b,this.collator=S,this.hasUntypedArgument=_.type.kind==="value"||b.type.kind==="value"}static parse(_,b){if(_.length!==3&&_.length!==4)return b.error("Expected two or three arguments.");const S=_[0];let C=b.parse(_[1],1,pr);if(!C)return null;if(!Co(S,C.type))return b.concat(1).error(`"${S}" comparisons are not supported for type '${ci(C.type)}'.`);let z=b.parse(_[2],2,pr);if(!z)return null;if(!Co(S,z.type))return b.concat(2).error(`"${S}" comparisons are not supported for type '${ci(z.type)}'.`);if(C.type.kind!==z.type.kind&&C.type.kind!=="value"&&z.type.kind!=="value")return b.error(`Cannot compare types '${ci(C.type)}' and '${ci(z.type)}'.`);o&&(C.type.kind==="value"&&z.type.kind!=="value"?C=new cs(z.type,[C]):C.type.kind!=="value"&&z.type.kind==="value"&&(z=new cs(C.type,[z])));let R=null;if(_.length===4){if(C.type.kind!=="string"&&z.type.kind!=="string"&&C.type.kind!=="value"&&z.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(R=b.parse(_[3],3,en),!R)return null}return new Gg(C,z,R)}evaluate(_){const b=this.lhs.evaluate(_),S=this.rhs.evaluate(_);if(o&&this.hasUntypedArgument){const C=Ki(b),z=Ki(S);if(C.kind!==z.kind||C.kind!=="string"&&C.kind!=="number")throw new ki(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${C.kind}, ${z.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const C=Ki(b),z=Ki(S);if(C.kind!=="string"||z.kind!=="string")return t(_,b,S)}return this.collator?n(_,b,S,this.collator.evaluate(_)):t(_,b,S)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}const ul=Na("==",function(i,t,n){return t===n},ga),hl=Na("!=",function(i,t,n){return t!==n},function(i,t,n,o){return!ga(0,t,n,o)}),Mo=Na("<",function(i,t,n){return t<n},function(i,t,n,o){return o.compare(t,n)<0}),Dl=Na(">",function(i,t,n){return t>n},function(i,t,n,o){return o.compare(t,n)>0}),Lo=Na("<=",function(i,t,n){return t<=n},function(i,t,n,o){return o.compare(t,n)<=0}),Ra=Na(">=",function(i,t,n){return t>=n},function(i,t,n,o){return o.compare(t,n)>=0});class Sn{constructor(t,n,o){this.type=en,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const d=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Qt);if(!d)return null;const _=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Qt);if(!_)return null;let b=null;return o.locale&&(b=n.parse(o.locale,1,Zt),!b)?null:new Sn(d,_,b)}evaluate(t){return new sl(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class co{constructor(t,n,o,d,_){this.type=Zt,this.number=t,this.locale=n,this.currency=o,this.minFractionDigits=d,this.maxFractionDigits=_}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const o=n.parse(t[1],1,yt);if(!o)return null;const d=t[2];if(typeof d!="object"||Array.isArray(d))return n.error("NumberFormat options argument must be an object.");let _=null;if(d.locale&&(_=n.parse(d.locale,1,Zt),!_))return null;let b=null;if(d.currency&&(b=n.parse(d.currency,1,Zt),!b))return null;let S=null;if(d["min-fraction-digits"]&&(S=n.parse(d["min-fraction-digits"],1,yt),!S))return null;let C=null;return d["max-fraction-digits"]&&(C=n.parse(d["max-fraction-digits"],1,yt),!C)?null:new co(o,_,b,S,C)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class _a{constructor(t){this.type=di,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const d=[];let _=!1;for(let b=1;b<=t.length-1;++b){const S=t[b];if(_&&typeof S=="object"&&!Array.isArray(S)){_=!1;let C=null;if(S["font-scale"]&&(C=n.parse(S["font-scale"],1,yt),!C))return null;let z=null;if(S["text-font"]&&(z=n.parse(S["text-font"],1,cn(Zt)),!z))return null;let R=null;if(S["text-color"]&&(R=n.parse(S["text-color"],1,Pr),!R))return null;let j=null;if(S["vertical-align"]){if(typeof S["vertical-align"]=="string"&&!al.includes(S["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${S["vertical-align"]}' instead.`);if(j=n.parse(S["vertical-align"],1,Zt),!j)return null}const H=d[d.length-1];H.scale=C,H.font=z,H.textColor=R,H.verticalAlign=j}else{const C=n.parse(t[b],1,pr);if(!C)return null;const z=C.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,d.push({content:C,scale:null,font:null,textColor:null,verticalAlign:null})}}return new _a(d)}evaluate(t){return new tn(this.sections.map(n=>{const o=n.content.evaluate(t);return Ki(o)===ri?new ls("",o,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(t):null):new ls(Js(o),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null,n.verticalAlign?n.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor),n.verticalAlign&&t(n.verticalAlign)}outputDefined(){return!1}}class Fl{constructor(t){this.type=ri,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const o=n.parse(t[1],1,Zt);return o?new Fl(o):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),o=hn.fromString(n);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(n)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class ya{constructor(t){this.type=yt,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=n.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${ci(o.type)} instead.`):new ya(o):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new ki(`Expected value to be of type string or array, but found ${ci(Ki(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Vn=8192;function Nl(i,t){const n=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,d=Math.pow(2,t.z);return[Math.round(n*d*Vn),Math.round(o*d*Vn)]}function va(i,t){const n=Math.pow(2,t.z);return[(d=(i[0]/Vn+t.x)/n,360*d-180),(o=(i[1]/Vn+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,d}function Ba(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function k(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function re(i,t,n){const o=i[0]-t[0],d=i[1]-t[1],_=i[0]-n[0],b=i[1]-n[1];return o*b-_*d==0&&o*_<=0&&d*b<=0}function Fe(i,t,n,o){return(d=[o[0]-n[0],o[1]-n[1]])[0]*(_=[t[0]-i[0],t[1]-i[1]])[1]-d[1]*_[0]!=0&&!(!Er(i,t,n,o)||!Er(n,o,i,t));var d,_}function tt(i,t,n){for(const o of n)for(let d=0;d<o.length-1;++d)if(Fe(i,t,o[d],o[d+1]))return!0;return!1}function dt(i,t,n=!1){let o=!1;for(const S of t)for(let C=0;C<S.length-1;C++){if(re(i,S[C],S[C+1]))return n;(_=S[C])[1]>(d=i)[1]!=(b=S[C+1])[1]>d[1]&&d[0]<(b[0]-_[0])*(d[1]-_[1])/(b[1]-_[1])+_[0]&&(o=!o)}var d,_,b;return o}function Rt(i,t){for(const n of t)if(dt(i,n))return!0;return!1}function Yt(i,t){for(const n of i)if(!dt(n,t))return!1;for(let n=0;n<i.length-1;++n)if(tt(i[n],i[n+1],t))return!1;return!0}function mr(i,t){for(const n of t)if(Yt(i,n))return!0;return!1}function Er(i,t,n,o){const d=o[0]-n[0],_=o[1]-n[1],b=(i[0]-n[0])*_-d*(i[1]-n[1]),S=(t[0]-n[0])*_-d*(t[1]-n[1]);return b>0&&S<0||b<0&&S>0}function Or(i,t,n){const o=[];for(let d=0;d<i.length;d++){const _=[];for(let b=0;b<i[d].length;b++){const S=Nl(i[d][b],n);Ba(t,S),_.push(S)}o.push(_)}return o}function jr(i,t,n){const o=[];for(let d=0;d<i.length;d++){const _=Or(i[d],t,n);o.push(_)}return o}function ai(i,t,n,o){if(i[0]<n[0]||i[0]>n[2]){const d=.5*o;let _=i[0]-n[0]>d?-o:n[0]-i[0]>d?o:0;_===0&&(_=i[0]-n[2]>d?-o:n[2]-i[0]>d?o:0),i[0]+=_}Ba(t,i)}function Di(i,t,n,o){const d=Math.pow(2,o.z)*Vn,_=[o.x*Vn,o.y*Vn],b=[];for(const S of i)for(const C of S){const z=[C.x+_[0],C.y+_[1]];ai(z,t,n,d),b.push(z)}return b}function Xi(i,t,n,o){const d=Math.pow(2,o.z)*Vn,_=[o.x*Vn,o.y*Vn],b=[];for(const C of i){const z=[];for(const R of C){const j=[R.x+_[0],R.y+_[1]];Ba(t,j),z.push(j)}b.push(z)}if(t[2]-t[0]<=d/2){(S=t)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const C of b)for(const z of C)ai(z,t,n,d)}var S;return b}class Ci{constructor(t,n){this.type=Qt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ii(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const d=[];for(const _ of o.features){const{type:b,coordinates:S}=_.geometry;b==="Polygon"&&d.push(S),b==="MultiPolygon"&&d.push(...S)}if(d.length)return new Ci(o,{type:"MultiPolygon",coordinates:d})}else if(o.type==="Feature"){const d=o.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Ci(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Ci(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=n.canonicalID();if(o.type==="Polygon"){const S=Or(o.coordinates,_,b),C=Di(n.geometry(),d,_,b);if(!k(d,_))return!1;for(const z of C)if(!dt(z,S))return!1}if(o.type==="MultiPolygon"){const S=jr(o.coordinates,_,b),C=Di(n.geometry(),d,_,b);if(!k(d,_))return!1;for(const z of C)if(!Rt(z,S))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=n.canonicalID();if(o.type==="Polygon"){const S=Or(o.coordinates,_,b),C=Xi(n.geometry(),d,_,b);if(!k(d,_))return!1;for(const z of C)if(!Yt(z,S))return!1}if(o.type==="MultiPolygon"){const S=jr(o.coordinates,_,b),C=Xi(n.geometry(),d,_,b);if(!k(d,_))return!1;for(const z of C)if(!mr(z,S))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Ln=class{constructor(i=[],t=(n,o)=>n<o?-1:n>o?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:n}=this,o=t[i];for(;i>0;){const d=i-1>>1,_=t[d];if(n(o,_)>=0)break;t[i]=_,i=d}t[i]=o}_down(i){const{data:t,compare:n}=this,o=this.length>>1,d=t[i];for(;i<o;){let _=1+(i<<1);const b=_+1;if(b<this.length&&n(t[b],t[_])<0&&(_=b),n(t[_],d)>=0)break;t[i]=t[_],i=_}t[i]=d}};function gn(i,t,n=0,o=i.length-1,d=zs){for(;o>n;){if(o-n>600){const C=o-n+1,z=t-n+1,R=Math.log(C),j=.5*Math.exp(2*R/3),H=.5*Math.sqrt(R*j*(C-j)/C)*(z-C/2<0?-1:1);gn(i,t,Math.max(n,Math.floor(t-z*j/C+H)),Math.min(o,Math.floor(t+(C-z)*j/C+H)),d)}const _=i[t];let b=n,S=o;for(En(i,n,t),d(i[o],_)>0&&En(i,n,o);b<S;){for(En(i,b,S),b++,S--;d(i[b],_)<0;)b++;for(;d(i[S],_)>0;)S--}d(i[n],_)===0?En(i,n,S):(S++,En(i,S,o)),S<=t&&(n=S+1),t<=S&&(o=S-1)}}function En(i,t,n){const o=i[t];i[t]=i[n],i[n]=o}function zs(i,t){return i<t?-1:i>t?1:0}function Ps(i,t){if(i.length<=1)return[i];const n=[];let o,d;for(const _ of i){const b=dl(_);b!==0&&(_.area=Math.abs(b),d===void 0&&(d=b<0),d===b<0?(o&&n.push(o),o=[_]):o.push(_))}if(o&&n.push(o),t>1)for(let _=0;_<n.length;_++)n[_].length<=t||(gn(n[_],t,1,n[_].length-1,ic),n[_]=n[_].slice(0,t));return n}function ic(i,t){return t.area-i.area}function dl(i){let t=0;for(let n,o,d=0,_=i.length,b=_-1;d<_;b=d++)n=i[d],o=i[b],t+=(o.x-n.x)*(n.y+o.y);return t}const Eo=1/298.257223563,ko=Eo*(2-Eo),pl=Math.PI/180;class uo{constructor(t){const n=6378.137*pl*1e3,o=Math.cos(t*pl),d=1/(1-ko*(1-o*o)),_=Math.sqrt(d);this.kx=n*_*o,this.ky=n*_*d*(1-ko)}distance(t,n){const o=this.wrap(t[0]-n[0])*this.kx,d=(t[1]-n[1])*this.ky;return Math.sqrt(o*o+d*d)}pointOnLine(t,n){let o,d,_,b,S=1/0;for(let C=0;C<t.length-1;C++){let z=t[C][0],R=t[C][1],j=this.wrap(t[C+1][0]-z)*this.kx,H=(t[C+1][1]-R)*this.ky,Y=0;j===0&&H===0||(Y=(this.wrap(n[0]-z)*this.kx*j+(n[1]-R)*this.ky*H)/(j*j+H*H),Y>1?(z=t[C+1][0],R=t[C+1][1]):Y>0&&(z+=j/this.kx*Y,R+=H/this.ky*Y)),j=this.wrap(n[0]-z)*this.kx,H=(n[1]-R)*this.ky;const ee=j*j+H*H;ee<S&&(S=ee,o=z,d=R,_=C,b=Y)}return{point:[o,d],index:_,t:Math.max(0,Math.min(1,b))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function ho(i,t){return t[0]-i[0]}function pn(i){return i[1]-i[0]+1}function hs(i,t){return i[1]>=i[0]&&i[1]<t}function po(i,t){if(i[0]>i[1])return[null,null];const n=pn(i);if(t){if(n===2)return[i,null];const d=Math.floor(n/2);return[[i[0],i[0]+d],[i[0]+d,i[1]]]}if(n===1)return[i,null];const o=Math.floor(n/2)-1;return[[i[0],i[0]+o],[i[0]+o+1,i[1]]]}function Oa(i,t){if(!hs(t,i.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)Ba(n,i[o]);return n}function zo(i){const t=[1/0,1/0,-1/0,-1/0];for(const n of i)for(const o of n)Ba(t,o);return t}function Yn(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Rl(i,t,n){if(!Yn(i)||!Yn(t))return NaN;let o=0,d=0;return i[2]<t[0]&&(o=t[0]-i[2]),i[0]>t[2]&&(o=i[0]-t[2]),i[1]>t[3]&&(d=i[1]-t[3]),i[3]<t[1]&&(d=t[1]-i[3]),n.distance([0,0],[o,d])}function ta(i,t,n){const o=n.pointOnLine(t,i);return n.distance(i,o.point)}function ii(i,t,n,o,d){const _=Math.min(ta(i,[n,o],d),ta(t,[n,o],d)),b=Math.min(ta(n,[i,t],d),ta(o,[i,t],d));return Math.min(_,b)}function Ds(i,t,n,o,d){if(!hs(t,i.length)||!hs(o,n.length))return 1/0;let _=1/0;for(let b=t[0];b<t[1];++b){const S=i[b],C=i[b+1];for(let z=o[0];z<o[1];++z){const R=n[z],j=n[z+1];if(Fe(S,C,R,j))return 0;_=Math.min(_,ii(S,C,R,j,d))}}return _}function fl(i,t,n,o,d){if(!hs(t,i.length)||!hs(o,n.length))return NaN;let _=1/0;for(let b=t[0];b<=t[1];++b)for(let S=o[0];S<=o[1];++S)if(_=Math.min(_,d.distance(i[b],n[S])),_===0)return _;return _}function nc(i,t,n){if(dt(i,t,!0))return 0;let o=1/0;for(const d of t){const _=d[0],b=d[d.length-1];if(_!==b&&(o=Math.min(o,ta(i,[b,_],n)),o===0))return o;const S=n.pointOnLine(d,i);if(o=Math.min(o,n.distance(i,S.point)),o===0)return o}return o}function sc(i,t,n,o){if(!hs(t,i.length))return NaN;for(let _=t[0];_<=t[1];++_)if(dt(i[_],n,!0))return 0;let d=1/0;for(let _=t[0];_<t[1];++_){const b=i[_],S=i[_+1];for(const C of n)for(let z=0,R=C.length,j=R-1;z<R;j=z++){const H=C[j],Y=C[z];if(Fe(b,S,H,Y))return 0;d=Math.min(d,ii(b,S,H,Y,o))}}return d}function ja(i,t){for(const n of i)for(const o of n)if(dt(o,t,!0))return!0;return!1}function Do(i,t,n,o=1/0){const d=zo(i),_=zo(t);if(o!==1/0&&Rl(d,_,n)>=o)return o;if(k(d,_)){if(ja(i,t))return 0}else if(ja(t,i))return 0;let b=1/0;for(const S of i)for(let C=0,z=S.length,R=z-1;C<z;R=C++){const j=S[R],H=S[C];for(const Y of t)for(let ee=0,ae=Y.length,ye=ae-1;ee<ae;ye=ee++){const Me=Y[ye],et=Y[ee];if(Fe(j,H,Me,et))return 0;b=Math.min(b,ii(j,H,Me,et,n))}}return b}function Kn(i,t,n,o,d,_){if(!_)return;const b=Rl(Oa(o,_),d,n);b<t&&i.push([b,_,[0,0]])}function An(i,t,n,o,d,_,b){if(!_||!b)return;const S=Rl(Oa(o,_),Oa(d,b),n);S<t&&i.push([S,_,b])}function ra(i,t,n,o,d=1/0){let _=Math.min(o.distance(i[0],n[0][0]),d);if(_===0)return _;const b=new Ln([[0,[0,i.length-1],[0,0]]],ho),S=zo(n);for(;b.length>0;){const C=b.pop();if(C[0]>=_)continue;const z=C[1],R=t?50:100;if(pn(z)<=R){if(!hs(z,i.length))return NaN;if(t){const j=sc(i,z,n,o);if(isNaN(j)||j===0)return j;_=Math.min(_,j)}else for(let j=z[0];j<=z[1];++j){const H=nc(i[j],n,o);if(_=Math.min(_,H),_===0)return 0}}else{const j=po(z,t);Kn(b,_,o,i,S,j[0]),Kn(b,_,o,i,S,j[1])}}return _}function Fs(i,t,n,o,d,_=1/0){let b=Math.min(_,d.distance(i[0],n[0]));if(b===0)return b;const S=new Ln([[0,[0,i.length-1],[0,n.length-1]]],ho);for(;S.length>0;){const C=S.pop();if(C[0]>=b)continue;const z=C[1],R=C[2],j=t?50:100,H=o?50:100;if(pn(z)<=j&&pn(R)<=H){if(!hs(z,i.length)&&hs(R,n.length))return NaN;let Y;if(t&&o)Y=Ds(i,z,n,R,d),b=Math.min(b,Y);else if(t&&!o){const ee=i.slice(z[0],z[1]+1);for(let ae=R[0];ae<=R[1];++ae)if(Y=ta(n[ae],ee,d),b=Math.min(b,Y),b===0)return b}else if(!t&&o){const ee=n.slice(R[0],R[1]+1);for(let ae=z[0];ae<=z[1];++ae)if(Y=ta(i[ae],ee,d),b=Math.min(b,Y),b===0)return b}else Y=fl(i,z,n,R,d),b=Math.min(b,Y)}else{const Y=po(z,t),ee=po(R,o);An(S,b,d,i,n,Y[0],ee[0]),An(S,b,d,i,n,Y[0],ee[1]),An(S,b,d,i,n,Y[1],ee[0]),An(S,b,d,i,n,Y[1],ee[1])}}return b}function ia(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class Ns{constructor(t,n){this.type=yt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ii(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new Ns(o,o.features.map(d=>ia(d.geometry)).flat());if(o.type==="Feature")return new Ns(o,ia(o.geometry));if("type"in o&&"coordinates"in o)return new Ns(o,ia(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const d=n.geometry(),_=d.flat().map(C=>va([C.x,C.y],n.canonical));if(d.length===0)return NaN;const b=new uo(_[0][1]);let S=1/0;for(const C of o){switch(C.type){case"Point":S=Math.min(S,Fs(_,!1,[C.coordinates],!1,b,S));break;case"LineString":S=Math.min(S,Fs(_,!1,C.coordinates,!0,b,S));break;case"Polygon":S=Math.min(S,ra(_,!1,C.coordinates,b,S))}if(S===0)return S}return S}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const d=n.geometry(),_=d.flat().map(C=>va([C.x,C.y],n.canonical));if(d.length===0)return NaN;const b=new uo(_[0][1]);let S=1/0;for(const C of o){switch(C.type){case"Point":S=Math.min(S,Fs(_,!0,[C.coordinates],!1,b,S));break;case"LineString":S=Math.min(S,Fs(_,!0,C.coordinates,!0,b,S));break;case"Polygon":S=Math.min(S,ra(_,!0,C.coordinates,b,S))}if(S===0)return S}return S}(t,this.geometries);if(t.geometryType()==="Polygon")return function(n,o){const d=n.geometry();if(d.length===0||d[0].length===0)return NaN;const _=Ps(d,0).map(C=>C.map(z=>z.map(R=>va([R.x,R.y],n.canonical)))),b=new uo(_[0][0][0][1]);let S=1/0;for(const C of o)for(const z of _){switch(C.type){case"Point":S=Math.min(S,ra([C.coordinates],!1,z,b,S));break;case"LineString":S=Math.min(S,ra(C.coordinates,!0,z,b,S));break;case"Polygon":S=Math.min(S,Do(z,C.coordinates,b,S))}if(S===0)return S}return S}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const ds={"==":ul,"!=":hl,">":Dl,"<":Mo,">=":Ra,"<=":Lo,array:cs,at:ti,boolean:cs,case:ol,coalesce:mi,collator:Sn,format:_a,image:Fl,in:Fa,"index-of":Pn,interpolate:ji,"interpolate-hcl":ji,"interpolate-lab":ji,length:ya,let:Nr,literal:Lr,match:ks,number:cs,"number-format":co,object:cs,slice:Qs,step:ea,string:cs,"to-boolean":us,"to-color":us,"to-number":us,"to-string":us,var:oo,within:Ci,distance:Ns};class pi{constructor(t,n,o,d){this.name=t,this.type=n,this._evaluate=o,this.args=d}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const o=t[0],d=pi.definitions[o];if(!d)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(d)?d[0]:d.type,b=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,S=b.filter(([z])=>!Array.isArray(z)||z.length===t.length-1);let C=null;for(const[z,R]of S){C=new Wr(n.registry,Fo,n.path,null,n.scope);const j=[];let H=!1;for(let Y=1;Y<t.length;Y++){const ee=t[Y],ae=Array.isArray(z)?z[Y-1]:z.type,ye=C.parse(ee,1+j.length,ae);if(!ye){H=!0;break}j.push(ye)}if(!H)if(Array.isArray(z)&&z.length!==j.length)C.error(`Expected ${z.length} arguments, but found ${j.length} instead.`);else{for(let Y=0;Y<j.length;Y++){const ee=Array.isArray(z)?z[Y]:z.type,ae=j[Y];C.concat(Y+1).checkSubtype(ee,ae.type)}if(C.errors.length===0)return new pi(o,_,R,j)}}if(S.length===1)n.errors.push(...C.errors);else{const z=(S.length?S:b).map(([j])=>{return H=j,Array.isArray(H)?`(${H.map(ci).join(", ")})`:`(${ci(H.type)}...)`;var H}).join(" | "),R=[];for(let j=1;j<t.length;j++){const H=n.parse(t[j],1+R.length);if(!H)return null;R.push(ci(H.type))}n.error(`Expected arguments of type ${z}, but found (${R.join(", ")}) instead.`)}return null}static register(t,n){pi.definitions=n;for(const o in n)t[o]=pi}}function ml(i,[t,n,o,d]){t=t.evaluate(i),n=n.evaluate(i),o=o.evaluate(i);const _=d?d.evaluate(i):1,b=Ao(t,n,o,_);if(b)throw new ki(b);return new ei(t/255,n/255,o/255,_,!1)}function Un(i,t){return i in t}function ps(i,t){const n=t[i];return n===void 0?null:n}function Rs(i){return{type:i}}function Fo(i){if(i instanceof oo)return Fo(i.boundExpression);if(i instanceof pi&&i.name==="error"||i instanceof Sn||i instanceof Ci||i instanceof Ns)return!1;const t=i instanceof us||i instanceof cs;let n=!0;return i.eachChild(o=>{n=t?n&&Fo(o):n&&o instanceof Lr}),!!n&&fo(i)&&ba(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function fo(i){if(i instanceof pi&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Ci||i instanceof Ns)return!1;let t=!0;return i.eachChild(n=>{t&&!fo(n)&&(t=!1)}),t}function na(i){if(i instanceof pi&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(n=>{t&&!na(n)&&(t=!1)}),t}function ba(i,t){if(i instanceof pi&&t.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(o=>{n&&!ba(o,t)&&(n=!1)}),n}function qa(i){return{result:"success",value:i}}function Bs(i){return{result:"error",value:i}}function sa(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function mo(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function xa(i){return!!i.expression&&i.expression.interpolated}function Kr(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Jn(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Os(i){return i}function Si(i,t){const n=t.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",d=o||!(o||i.property!==void 0),_=i.type||(xa(t)?"exponential":"interval");if(n||t.type==="padding"){const R=n?ei.parse:un.parse;(i=ft({},i)).stops&&(i.stops=i.stops.map(j=>[j[0],R(j[1])])),i.default=R(i.default?i.default:t.default)}if(i.colorSpace&&(b=i.colorSpace)!=="rgb"&&b!=="hcl"&&b!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var b;let S,C,z;if(_==="exponential")S=wa;else if(_==="interval")S=_n;else if(_==="categorical"){S=rn,C=Object.create(null);for(const R of i.stops)C[R[0]]=R[1];z=typeof i.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);S=gl}if(o){const R={},j=[];for(let ee=0;ee<i.stops.length;ee++){const ae=i.stops[ee],ye=ae[0].zoom;R[ye]===void 0&&(R[ye]={zoom:ye,type:i.type,property:i.property,default:i.default,stops:[]},j.push(ye)),R[ye].stops.push([ae[0].value,ae[1]])}const H=[];for(const ee of j)H.push([R[ee].zoom,Si(R[ee],t)]);const Y={name:"linear"};return{kind:"composite",interpolationType:Y,interpolationFactor:ji.interpolationFactor.bind(void 0,Y),zoomStops:H.map(ee=>ee[0]),evaluate:({zoom:ee},ae)=>wa({stops:H,base:i.base},t,ee).evaluate(ee,ae)}}if(d){const R=_==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:ji.interpolationFactor.bind(void 0,R),zoomStops:i.stops.map(j=>j[0]),evaluate:({zoom:j})=>S(i,t,j,C,z)}}return{kind:"source",evaluate(R,j){const H=j&&j.properties?j.properties[i.property]:void 0;return H===void 0?fi(i.default,t.default):S(i,t,H,C,z)}}}function fi(i,t,n){return i!==void 0?i:t!==void 0?t:n!==void 0?n:void 0}function rn(i,t,n,o,d){return fi(typeof n===d?o[n]:void 0,i.default,t.default)}function _n(i,t,n){if(Kr(n)!=="number")return fi(i.default,t.default);const o=i.stops.length;if(o===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[o-1][0])return i.stops[o-1][1];const d=ma(i.stops.map(_=>_[0]),n);return i.stops[d][1]}function wa(i,t,n){const o=i.base!==void 0?i.base:1;if(Kr(n)!=="number")return fi(i.default,t.default);const d=i.stops.length;if(d===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[d-1][0])return i.stops[d-1][1];const _=ma(i.stops.map(R=>R[0]),n),b=function(R,j,H,Y){const ee=Y-H,ae=R-H;return ee===0?0:j===1?ae/ee:(Math.pow(j,ae)-1)/(Math.pow(j,ee)-1)}(n,o,i.stops[_][0],i.stops[_+1][0]),S=i.stops[_][1],C=i.stops[_+1][1],z=dn[t.type]||Os;return typeof S.evaluate=="function"?{evaluate(...R){const j=S.evaluate.apply(void 0,R),H=C.evaluate.apply(void 0,R);if(j!==void 0&&H!==void 0)return z(j,H,b,i.colorSpace)}}:z(S,C,b,i.colorSpace)}function gl(i,t,n){switch(t.type){case"color":n=ei.parse(n);break;case"formatted":n=tn.fromString(n.toString());break;case"resolvedImage":n=hn.fromString(n.toString());break;case"padding":n=un.parse(n);break;default:Kr(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return fi(n,i.default,t.default)}pi.register(ds,{error:[{kind:"error"},[Zt],(i,[t])=>{throw new ki(t.evaluate(i))}],typeof:[Zt,[pr],(i,[t])=>ci(Ki(t.evaluate(i)))],"to-rgba":[cn(yt,4),[Pr],(i,[t])=>{const[n,o,d,_]=t.evaluate(i).rgb;return[255*n,255*o,255*d,_]}],rgb:[Pr,[yt,yt,yt],ml],rgba:[Pr,[yt,yt,yt,yt],ml],has:{type:Qt,overloads:[[[Zt],(i,[t])=>Un(t.evaluate(i),i.properties())],[[Zt,Ir],(i,[t,n])=>Un(t.evaluate(i),n.evaluate(i))]]},get:{type:pr,overloads:[[[Zt],(i,[t])=>ps(t.evaluate(i),i.properties())],[[Zt,Ir],(i,[t,n])=>ps(t.evaluate(i),n.evaluate(i))]]},"feature-state":[pr,[Zt],(i,[t])=>ps(t.evaluate(i),i.featureState||{})],properties:[Ir,[],i=>i.properties()],"geometry-type":[Zt,[],i=>i.geometryType()],id:[pr,[],i=>i.id()],zoom:[yt,[],i=>i.globals.zoom],"heatmap-density":[yt,[],i=>i.globals.heatmapDensity||0],"line-progress":[yt,[],i=>i.globals.lineProgress||0],accumulated:[pr,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[yt,Rs(yt),(i,t)=>{let n=0;for(const o of t)n+=o.evaluate(i);return n}],"*":[yt,Rs(yt),(i,t)=>{let n=1;for(const o of t)n*=o.evaluate(i);return n}],"-":{type:yt,overloads:[[[yt,yt],(i,[t,n])=>t.evaluate(i)-n.evaluate(i)],[[yt],(i,[t])=>-t.evaluate(i)]]},"/":[yt,[yt,yt],(i,[t,n])=>t.evaluate(i)/n.evaluate(i)],"%":[yt,[yt,yt],(i,[t,n])=>t.evaluate(i)%n.evaluate(i)],ln2:[yt,[],()=>Math.LN2],pi:[yt,[],()=>Math.PI],e:[yt,[],()=>Math.E],"^":[yt,[yt,yt],(i,[t,n])=>Math.pow(t.evaluate(i),n.evaluate(i))],sqrt:[yt,[yt],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[yt,[yt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[yt,[yt],(i,[t])=>Math.log(t.evaluate(i))],log2:[yt,[yt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[yt,[yt],(i,[t])=>Math.sin(t.evaluate(i))],cos:[yt,[yt],(i,[t])=>Math.cos(t.evaluate(i))],tan:[yt,[yt],(i,[t])=>Math.tan(t.evaluate(i))],asin:[yt,[yt],(i,[t])=>Math.asin(t.evaluate(i))],acos:[yt,[yt],(i,[t])=>Math.acos(t.evaluate(i))],atan:[yt,[yt],(i,[t])=>Math.atan(t.evaluate(i))],min:[yt,Rs(yt),(i,t)=>Math.min(...t.map(n=>n.evaluate(i)))],max:[yt,Rs(yt),(i,t)=>Math.max(...t.map(n=>n.evaluate(i)))],abs:[yt,[yt],(i,[t])=>Math.abs(t.evaluate(i))],round:[yt,[yt],(i,[t])=>{const n=t.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[yt,[yt],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[yt,[yt],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Qt,[Zt,pr],(i,[t,n])=>i.properties()[t.value]===n.value],"filter-id-==":[Qt,[pr],(i,[t])=>i.id()===t.value],"filter-type-==":[Qt,[Zt],(i,[t])=>i.geometryType()===t.value],"filter-<":[Qt,[Zt,pr],(i,[t,n])=>{const o=i.properties()[t.value],d=n.value;return typeof o==typeof d&&o<d}],"filter-id-<":[Qt,[pr],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n<o}],"filter->":[Qt,[Zt,pr],(i,[t,n])=>{const o=i.properties()[t.value],d=n.value;return typeof o==typeof d&&o>d}],"filter-id->":[Qt,[pr],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n>o}],"filter-<=":[Qt,[Zt,pr],(i,[t,n])=>{const o=i.properties()[t.value],d=n.value;return typeof o==typeof d&&o<=d}],"filter-id-<=":[Qt,[pr],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n<=o}],"filter->=":[Qt,[Zt,pr],(i,[t,n])=>{const o=i.properties()[t.value],d=n.value;return typeof o==typeof d&&o>=d}],"filter-id->=":[Qt,[pr],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n>=o}],"filter-has":[Qt,[pr],(i,[t])=>t.value in i.properties()],"filter-has-id":[Qt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Qt,[cn(Zt)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Qt,[cn(pr)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Qt,[Zt,cn(pr)],(i,[t,n])=>n.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Qt,[Zt,cn(pr)],(i,[t,n])=>function(o,d,_,b){for(;_<=b;){const S=_+b>>1;if(d[S]===o)return!0;d[S]>o?b=S-1:_=S+1}return!1}(i.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Qt,overloads:[[[Qt,Qt],(i,[t,n])=>t.evaluate(i)&&n.evaluate(i)],[Rs(Qt),(i,t)=>{for(const n of t)if(!n.evaluate(i))return!1;return!0}]]},any:{type:Qt,overloads:[[[Qt,Qt],(i,[t,n])=>t.evaluate(i)||n.evaluate(i)],[Rs(Qt),(i,t)=>{for(const n of t)if(n.evaluate(i))return!0;return!1}]]},"!":[Qt,[Qt],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Qt,[Zt],(i,[t])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(t.evaluate(i))}],upcase:[Zt,[Zt],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[Zt,[Zt],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[Zt,Rs(pr),(i,t)=>t.map(n=>Js(n.evaluate(i))).join("")],"resolved-locale":[Zt,[en],(i,[t])=>t.evaluate(i).resolvedLocale()]});class go{constructor(t,n){var o;this.expression=t,this._warningHistory={},this._evaluator=new Da,this._defaultValue=n?(o=n).type==="color"&&Jn(o.default)?new ei(0,0,0,0):o.type==="color"?ei.parse(o.default)||null:o.type==="padding"?un.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?Ti.parse(o.default)||null:o.type==="projectionDefinition"?mn.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,o,d,_,b){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(t,n,o,d,_,b){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new ki(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function No(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ds}function Va(i,t){const n=new Wr(ds,Fo,[],t?function(d){const _={color:Pr,string:Zt,number:yt,enum:Zt,boolean:Qt,formatted:di,padding:yi,projectionDefinition:Sr,resolvedImage:ri,variableAnchorOffsetCollection:xs};return d.type==="array"?cn(_[d.value]||pr,d.length):_[d.type]}(t):void 0),o=n.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?qa(new go(o,t)):Bs(n.errors)}class Ro{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!na(n.expression)}evaluateWithoutErrorHandling(t,n,o,d,_,b){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,d,_,b)}evaluate(t,n,o,d,_,b){return this._styleExpression.evaluate(t,n,o,d,_,b)}}class Qn{constructor(t,n,o,d){this.kind=t,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!na(n.expression),this.interpolationType=d}evaluateWithoutErrorHandling(t,n,o,d,_,b){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,d,_,b)}evaluate(t,n,o,d,_,b){return this._styleExpression.evaluate(t,n,o,d,_,b)}interpolationFactor(t,n,o){return this.interpolationType?ji.interpolationFactor(this.interpolationType,t,n,o):0}}function Ss(i,t){const n=Va(i,t);if(n.result==="error")return n;const o=n.value.expression,d=fo(o);if(!d&&!sa(t))return Bs([new Pt("","data expressions not supported")]);const _=ba(o,["zoom"]);if(!_&&!mo(t))return Bs([new Pt("","zoom expressions not supported")]);const b=Oo(o);return b||_?b instanceof Pt?Bs([b]):b instanceof ji&&!xa(t)?Bs([new Pt("",'"interpolate" expressions cannot be used with this property')]):qa(b?new Qn(d?"camera":"composite",n.value,b.labels,b instanceof ji?b.interpolation:void 0):new Ro(d?"constant":"source",n.value)):Bs([new Pt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Bo{constructor(t,n){this._parameters=t,this._specification=n,ft(this,Si(this._parameters,this._specification))}static deserialize(t){return new Bo(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Oo(i){let t=null;if(i instanceof Nr)t=Oo(i.result);else if(i instanceof mi){for(const n of i.args)if(t=Oo(n),t)break}else(i instanceof ea||i instanceof ji)&&i.input instanceof pi&&i.input.name==="zoom"&&(t=i);return t instanceof Pt||i.eachChild(n=>{const o=Oo(n);o instanceof Pt?t=o:!t&&o?t=new Pt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new Pt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function ac(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!ac(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Bl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function jo(i){if(i==null)return{filter:()=>!0,needGeometry:!1};ac(i)||(i=qo(i));const t=Va(i,Bl);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,o,d)=>t.value.evaluate(n,o,{},d),needGeometry:Cc(i)}}function Ic(i,t){return i<t?-1:i>t?1:0}function Cc(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(Cc(i[t]))return!0;return!1}function qo(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?_l(i[1],i[2],"=="):t==="!="?vl(_l(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?_l(i[1],i[2],t):t==="any"?(n=i.slice(1),["any"].concat(n.map(qo))):t==="all"?["all"].concat(i.slice(1).map(qo)):t==="none"?["all"].concat(i.slice(1).map(qo).map(vl)):t==="in"?yl(i[1],i.slice(2)):t==="!in"?vl(yl(i[1],i.slice(2))):t==="has"?Ol(i[1]):t!=="!has"||vl(Ol(i[1]));var n}function _l(i,t,n){switch(i){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,i,t]}}function yl(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",i,["literal",t.sort(Ic)]]:["filter-in-small",i,["literal",t]]}}function Ol(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function vl(i){return["!",i]}function jl(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let d="[";for(const _ of i)d+=`${jl(_)},`;return`${d}]`}const n=Object.keys(i).sort();let o="{";for(let d=0;d<n.length;d++)o+=`${JSON.stringify(n[d])}:${jl(i[n[d]])},`;return`${o}}`}function oc(i){let t="";for(const n of A)t+=`/${jl(i[n])}`;return t}function ql(i){const t=i.value;return t?[new je(i.key,t,"constants have been deprecated as of v8")]:[]}function Ji(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Vo(i){if(Array.isArray(i))return i.map(Vo);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const n in i)t[n]=Vo(i[n]);return t}return Ji(i)}function js(i){const t=i.key,n=i.value,o=i.valueSpec||{},d=i.objectElementValidators||{},_=i.style,b=i.styleSpec,S=i.validateSpec;let C=[];const z=Kr(n);if(z!=="object")return[new je(t,n,`object expected, ${z} found`)];for(const R in n){const j=R.split(".")[0],H=o[j]||o["*"];let Y;if(d[j])Y=d[j];else if(o[j])Y=S;else if(d["*"])Y=d["*"];else{if(!o["*"]){C.push(new je(t,n[R],`unknown property "${R}"`));continue}Y=S}C=C.concat(Y({key:(t&&`${t}.`)+R,value:n[R],valueSpec:H,style:_,styleSpec:b,object:n,objectKey:R,validateSpec:S},n))}for(const R in o)d[R]||o[R].required&&o[R].default===void 0&&n[R]===void 0&&C.push(new je(t,n,`missing required property "${R}"`));return C}function Mc(i){const t=i.value,n=i.valueSpec,o=i.style,d=i.styleSpec,_=i.key,b=i.arrayElementValidator||i.validateSpec;if(Kr(t)!=="array")return[new je(_,t,`array expected, ${Kr(t)} found`)];if(n.length&&t.length!==n.length)return[new je(_,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new je(_,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let S={type:n.value,values:n.values};d.$version<7&&(S.function=n.function),Kr(n.value)==="object"&&(S=n.value);let C=[];for(let z=0;z<t.length;z++)C=C.concat(b({array:t,arrayIndex:z,value:t[z],valueSpec:S,validateSpec:i.validateSpec,style:o,styleSpec:d,key:`${_}[${z}]`}));return C}function Vl(i){const t=i.key,n=i.value,o=i.valueSpec;let d=Kr(n);return d==="number"&&n!=n&&(d="NaN"),d!=="number"?[new je(t,n,`number expected, ${d} found`)]:"minimum"in o&&n<o.minimum?[new je(t,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new je(t,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function lc(i){const t=i.valueSpec,n=Ji(i.value.type);let o,d,_,b={};const S=n!=="categorical"&&i.value.property===void 0,C=!S,z=Kr(i.value.stops)==="array"&&Kr(i.value.stops[0])==="array"&&Kr(i.value.stops[0][0])==="object",R=js({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(Y){if(n==="identity")return[new je(Y.key,Y.value,'identity function may not have a "stops" property')];let ee=[];const ae=Y.value;return ee=ee.concat(Mc({key:Y.key,value:ae,valueSpec:Y.valueSpec,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:j})),Kr(ae)==="array"&&ae.length===0&&ee.push(new je(Y.key,ae,"array must have at least one stop")),ee},default:function(Y){return Y.validateSpec({key:Y.key,value:Y.value,valueSpec:t,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec})}}});return n==="identity"&&S&&R.push(new je(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||R.push(new je(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!xa(i.valueSpec)&&R.push(new je(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(C&&!sa(i.valueSpec)?R.push(new je(i.key,i.value,"property functions not supported")):S&&!mo(i.valueSpec)&&R.push(new je(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!z||i.value.property!==void 0||R.push(new je(i.key,i.value,'"property" property is required')),R;function j(Y){let ee=[];const ae=Y.value,ye=Y.key;if(Kr(ae)!=="array")return[new je(ye,ae,`array expected, ${Kr(ae)} found`)];if(ae.length!==2)return[new je(ye,ae,`array length 2 expected, length ${ae.length} found`)];if(z){if(Kr(ae[0])!=="object")return[new je(ye,ae,`object expected, ${Kr(ae[0])} found`)];if(ae[0].zoom===void 0)return[new je(ye,ae,"object stop key must have zoom")];if(ae[0].value===void 0)return[new je(ye,ae,"object stop key must have value")];if(_&&_>Ji(ae[0].zoom))return[new je(ye,ae[0].zoom,"stop zoom values must appear in ascending order")];Ji(ae[0].zoom)!==_&&(_=Ji(ae[0].zoom),d=void 0,b={}),ee=ee.concat(js({key:`${ye}[0]`,value:ae[0],valueSpec:{zoom:{}},validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:Vl,value:H}}))}else ee=ee.concat(H({key:`${ye}[0]`,value:ae[0],validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec},ae));return No(Vo(ae[1]))?ee.concat([new je(`${ye}[1]`,ae[1],"expressions are not allowed in function stops.")]):ee.concat(Y.validateSpec({key:`${ye}[1]`,value:ae[1],valueSpec:t,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec}))}function H(Y,ee){const ae=Kr(Y.value),ye=Ji(Y.value),Me=Y.value!==null?Y.value:ee;if(o){if(ae!==o)return[new je(Y.key,Me,`${ae} stop domain type must match previous stop domain type ${o}`)]}else o=ae;if(ae!=="number"&&ae!=="string"&&ae!=="boolean")return[new je(Y.key,Me,"stop domain value must be a number, string, or boolean")];if(ae!=="number"&&n!=="categorical"){let et=`number expected, ${ae} found`;return sa(t)&&n===void 0&&(et+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new je(Y.key,Me,et)]}return n!=="categorical"||ae!=="number"||isFinite(ye)&&Math.floor(ye)===ye?n!=="categorical"&&ae==="number"&&d!==void 0&&ye<d?[new je(Y.key,Me,"stop domain values must appear in ascending order")]:(d=ye,n==="categorical"&&ye in b?[new je(Y.key,Me,"stop domain values must be unique")]:(b[ye]=!0,[])):[new je(Y.key,Me,`integer expected, found ${ye}`)]}}function aa(i){const t=(i.expressionContext==="property"?Ss:Va)(Vo(i.value),i.valueSpec);if(t.result==="error")return t.value.map(o=>new je(`${i.key}${o.key}`,i.value,o.message));const n=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new je(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!na(n))return[new je(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!na(n))return[new je(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ba(n,["zoom","feature-state"]))return[new je(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!fo(n))return[new je(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function bl(i){const t=i.key,n=i.value,o=i.valueSpec,d=[];return Array.isArray(o.values)?o.values.indexOf(Ji(n))===-1&&d.push(new je(t,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(Ji(n))===-1&&d.push(new je(t,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),d}function xl(i){return ac(Vo(i.value))?aa(ft({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Lc(i)}function Lc(i){const t=i.value,n=i.key;if(Kr(t)!=="array")return[new je(n,t,`array expected, ${Kr(t)} found`)];const o=i.styleSpec;let d,_=[];if(t.length<1)return[new je(n,t,"filter array must have at least 1 element")];switch(_=_.concat(bl({key:`${n}[0]`,value:t[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),Ji(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Ji(t[1])==="$type"&&_.push(new je(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new je(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(d=Kr(t[1]),d!=="string"&&_.push(new je(`${n}[1]`,t[1],`string expected, ${d} found`)));for(let b=2;b<t.length;b++)d=Kr(t[b]),Ji(t[1])==="$type"?_=_.concat(bl({key:`${n}[${b}]`,value:t[b],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&_.push(new je(`${n}[${b}]`,t[b],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let b=1;b<t.length;b++)_=_.concat(Lc({key:`${n}[${b}]`,value:t[b],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":d=Kr(t[1]),t.length!==2?_.push(new je(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):d!=="string"&&_.push(new je(`${n}[1]`,t[1],`string expected, ${d} found`))}return _}function Ec(i,t){const n=i.key,o=i.validateSpec,d=i.style,_=i.styleSpec,b=i.value,S=i.objectKey,C=_[`${t}_${i.layerType}`];if(!C)return[];const z=S.match(/^(.*)-transition$/);if(t==="paint"&&z&&C[z[1]]&&C[z[1]].transition)return o({key:n,value:b,valueSpec:_.transition,style:d,styleSpec:_});const R=i.valueSpec||C[S];if(!R)return[new je(n,b,`unknown property "${S}"`)];let j;if(Kr(b)==="string"&&sa(R)&&!R.tokens&&(j=/^{([^}]+)}$/.exec(b)))return[new je(n,b,`"${S}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(j[1])} }\`.`)];const H=[];return i.layerType==="symbol"&&(S==="text-field"&&d&&!d.glyphs&&H.push(new je(n,b,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Jn(Vo(b))&&Ji(b.type)==="identity"&&H.push(new je(n,b,'"text-font" does not support identity functions'))),H.concat(o({key:i.key,value:b,valueSpec:R,style:d,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:S}))}function kc(i){return Ec(i,"paint")}function Xc(i){return Ec(i,"layout")}function zc(i){let t=[];const n=i.value,o=i.key,d=i.style,_=i.styleSpec;n.type||n.ref||t.push(new je(o,n,'either "type" or "ref" is required'));let b=Ji(n.type);const S=Ji(n.ref);if(n.id){const C=Ji(n.id);for(let z=0;z<i.arrayIndex;z++){const R=d.layers[z];Ji(R.id)===C&&t.push(new je(o,n.id,`duplicate layer id "${n.id}", previously used at line ${R.id.__line__}`))}}if("ref"in n){let C;["type","source","source-layer","filter","layout"].forEach(z=>{z in n&&t.push(new je(o,n[z],`"${z}" is prohibited for ref layers`))}),d.layers.forEach(z=>{Ji(z.id)===S&&(C=z)}),C?C.ref?t.push(new je(o,n.ref,"ref cannot reference another ref layer")):b=Ji(C.type):t.push(new je(o,n.ref,`ref layer "${S}" not found`))}else if(b!=="background")if(n.source){const C=d.sources&&d.sources[n.source],z=C&&Ji(C.type);C?z==="vector"&&b==="raster"?t.push(new je(o,n.source,`layer "${n.id}" requires a raster source`)):z!=="raster-dem"&&b==="hillshade"?t.push(new je(o,n.source,`layer "${n.id}" requires a raster-dem source`)):z==="raster"&&b!=="raster"?t.push(new je(o,n.source,`layer "${n.id}" requires a vector source`)):z!=="vector"||n["source-layer"]?z==="raster-dem"&&b!=="hillshade"?t.push(new je(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):b!=="line"||!n.paint||!n.paint["line-gradient"]||z==="geojson"&&C.lineMetrics||t.push(new je(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new je(o,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new je(o,n.source,`source "${n.source}" not found`))}else t.push(new je(o,n,'missing required property "source"'));return t=t.concat(js({key:o,value:n,valueSpec:_.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${o}.type`,value:n.type,valueSpec:_.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:xl,layout:C=>js({layer:n,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":z=>Xc(ft({layerType:b},z))}}),paint:C=>js({layer:n,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":z=>kc(ft({layerType:b},z))}})}})),t}function es(i){const t=i.value,n=i.key,o=Kr(t);return o!=="string"?[new je(n,t,`string expected, ${o} found`)]:[]}const Zn={promoteId:function({key:i,value:t}){if(Kr(t)==="string")return es({key:i,value:t});{const n=[];for(const o in t)n.push(...es({key:`${i}.${o}`,value:t[o]}));return n}}};function Pa(i){const t=i.value,n=i.key,o=i.styleSpec,d=i.style,_=i.validateSpec;if(!t.type)return[new je(n,t,'"type" is required')];const b=Ji(t.type);let S;switch(b){case"vector":case"raster":return S=js({key:n,value:t,valueSpec:o[`source_${b.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:Zn,validateSpec:_}),S;case"raster-dem":return S=function(C){var z;const R=(z=C.sourceName)!==null&&z!==void 0?z:"",j=C.value,H=C.styleSpec,Y=H.source_raster_dem,ee=C.style;let ae=[];const ye=Kr(j);if(j===void 0)return ae;if(ye!=="object")return ae.push(new je("source_raster_dem",j,`object expected, ${ye} found`)),ae;const Me=Ji(j.encoding)==="custom",et=["redFactor","greenFactor","blueFactor","baseShift"],Be=C.value.encoding?`"${C.value.encoding}"`:"Default";for(const X in j)!Me&&et.includes(X)?ae.push(new je(X,j[X],`In "${R}": "${X}" is only valid when "encoding" is set to "custom". ${Be} encoding found`)):Y[X]?ae=ae.concat(C.validateSpec({key:X,value:j[X],valueSpec:Y[X],validateSpec:C.validateSpec,style:ee,styleSpec:H})):ae.push(new je(X,j[X],`unknown property "${X}"`));return ae}({sourceName:n,value:t,style:i.style,styleSpec:o,validateSpec:_}),S;case"geojson":if(S=js({key:n,value:t,valueSpec:o.source_geojson,style:d,styleSpec:o,validateSpec:_,objectElementValidators:Zn}),t.cluster)for(const C in t.clusterProperties){const[z,R]=t.clusterProperties[C],j=typeof z=="string"?[z,["accumulated"],["get",C]]:z;S.push(...aa({key:`${n}.${C}.map`,value:R,expressionContext:"cluster-map"})),S.push(...aa({key:`${n}.${C}.reduce`,value:j,expressionContext:"cluster-reduce"}))}return S;case"video":return js({key:n,value:t,valueSpec:o.source_video,style:d,validateSpec:_,styleSpec:o});case"image":return js({key:n,value:t,valueSpec:o.source_image,style:d,validateSpec:_,styleSpec:o});case"canvas":return[new je(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return bl({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Yc(i){const t=i.value,n=i.styleSpec,o=n.light,d=i.style;let _=[];const b=Kr(t);if(t===void 0)return _;if(b!=="object")return _=_.concat([new je("light",t,`object expected, ${b} found`)]),_;for(const S in t){const C=S.match(/^(.*)-transition$/);_=_.concat(C&&o[C[1]]&&o[C[1]].transition?i.validateSpec({key:S,value:t[S],valueSpec:n.transition,validateSpec:i.validateSpec,style:d,styleSpec:n}):o[S]?i.validateSpec({key:S,value:t[S],valueSpec:o[S],validateSpec:i.validateSpec,style:d,styleSpec:n}):[new je(S,t[S],`unknown property "${S}"`)])}return _}function Dc(i){const t=i.value,n=i.styleSpec,o=n.sky,d=i.style,_=Kr(t);if(t===void 0)return[];if(_!=="object")return[new je("sky",t,`object expected, ${_} found`)];let b=[];for(const S in t)b=b.concat(o[S]?i.validateSpec({key:S,value:t[S],valueSpec:o[S],style:d,styleSpec:n}):[new je(S,t[S],`unknown property "${S}"`)]);return b}function Ua(i){const t=i.value,n=i.styleSpec,o=n.terrain,d=i.style;let _=[];const b=Kr(t);if(t===void 0)return _;if(b!=="object")return _=_.concat([new je("terrain",t,`object expected, ${b} found`)]),_;for(const S in t)_=_.concat(o[S]?i.validateSpec({key:S,value:t[S],valueSpec:o[S],validateSpec:i.validateSpec,style:d,styleSpec:n}):[new je(S,t[S],`unknown property "${S}"`)]);return _}function As(i){let t=[];const n=i.value,o=i.key;if(Array.isArray(n)){const d=[],_=[];for(const b in n)n[b].id&&d.includes(n[b].id)&&t.push(new je(o,n,`all the sprites' ids must be unique, but ${n[b].id} is duplicated`)),d.push(n[b].id),n[b].url&&_.includes(n[b].url)&&t.push(new je(o,n,`all the sprites' URLs must be unique, but ${n[b].url} is duplicated`)),_.push(n[b].url),t=t.concat(js({key:`${o}[${b}]`,value:n[b],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return es({key:o,value:n})}const Kc={"*":()=>[],array:Mc,boolean:function(i){const t=i.value,n=i.key,o=Kr(t);return o!=="boolean"?[new je(n,t,`boolean expected, ${o} found`)]:[]},number:Vl,color:function(i){const t=i.key,n=i.value,o=Kr(n);return o!=="string"?[new je(t,n,`color expected, ${o} found`)]:ei.parse(String(n))?[]:[new je(t,n,`color expected, "${n}" found`)]},constants:ql,enum:bl,filter:xl,function:lc,layer:zc,object:js,source:Pa,light:Yc,sky:Dc,terrain:Ua,projection:function(i){const t=i.value,n=i.styleSpec,o=n.projection,d=i.style,_=Kr(t);if(t===void 0)return[];if(_!=="object")return[new je("projection",t,`object expected, ${_} found`)];let b=[];for(const S in t)b=b.concat(o[S]?i.validateSpec({key:S,value:t[S],valueSpec:o[S],style:d,styleSpec:n}):[new je(S,t[S],`unknown property "${S}"`)]);return b},projectionDefinition:function(i){const t=i.key;let n=i.value;n=n instanceof String?n.valueOf():n;const o=Kr(n);return o!=="array"||function(d){return Array.isArray(d)&&d.length===3&&typeof d[0]=="string"&&typeof d[1]=="string"&&typeof d[2]=="number"}(n)||function(d){return!!["interpolate","step","literal"].includes(d[0])}(n)?["array","string"].includes(o)?[]:[new je(t,n,`projection expected, invalid type "${o}" found`)]:[new je(t,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:es,formatted:function(i){return es(i).length===0?[]:aa(i)},resolvedImage:function(i){return es(i).length===0?[]:aa(i)},padding:function(i){const t=i.key,n=i.value;if(Kr(n)==="array"){if(n.length<1||n.length>4)return[new je(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let d=[];for(let _=0;_<n.length;_++)d=d.concat(i.validateSpec({key:`${t}[${_}]`,value:n[_],validateSpec:i.validateSpec,valueSpec:o}));return d}return Vl({key:t,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,n=i.value,o=Kr(n),d=i.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new je(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let b=0;b<n.length;b+=2)_=_.concat(bl({key:`${t}[${b}]`,value:n[b],valueSpec:d.layout_symbol["text-anchor"]})),_=_.concat(Mc({key:`${t}[${b+1}]`,value:n[b+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:d}));return _},sprite:As};function _o(i){const t=i.value,n=i.valueSpec,o=i.styleSpec;return i.validateSpec=_o,n.expression&&Jn(Ji(t))?lc(i):n.expression&&No(Vo(t))?aa(i):n.type&&Kc[n.type]?Kc[n.type](i):js(ft({},i,{valueSpec:n.type?o[n.type]:n}))}function Uo(i){const t=i.value,n=i.key,o=es(i);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new je(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new je(n,t,'"glyphs" url must include a "{range}" token'))),o}function qi(i,t=x){let n=[];return n=n.concat(_o({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:_o,objectElementValidators:{glyphs:Uo,"*":()=>[]}})),i.constants&&(n=n.concat(ql({key:"constants",value:i.constants}))),cc(n)}function ts(i){return function(t){return i({...t,validateSpec:_o})}}function cc(i){return[].concat(i).sort((t,n)=>t.line-n.line)}function Sa(i){return function(...t){return cc(i.apply(this,t))}}qi.source=Sa(ts(Pa)),qi.sprite=Sa(ts(As)),qi.glyphs=Sa(ts(Uo)),qi.light=Sa(ts(Yc)),qi.sky=Sa(ts(Dc)),qi.terrain=Sa(ts(Ua)),qi.layer=Sa(ts(zc)),qi.filter=Sa(ts(xl)),qi.paintProperty=Sa(ts(kc)),qi.layoutProperty=Sa(ts(Xc));const Za=qi,yo=Za.light,wl=Za.sky,Ul=Za.paintProperty,ku=Za.layoutProperty;function Zl(i,t){let n=!1;if(t&&t.length)for(const o of t)i.fire(new Bi(new Error(o.message))),n=!0;return n}class Gl{constructor(t,n,o){const d=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const b=new Int32Array(this.arrayBuffer);t=b[0],this.d=(n=b[1])+2*(o=b[2]);for(let C=0;C<this.d*this.d;C++){const z=b[3+C],R=b[3+C+1];d.push(z===R?null:b.subarray(z,R))}const S=b[3+d.length+1];this.keys=b.subarray(b[3+d.length],S),this.bboxes=b.subarray(S),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let b=0;b<this.d*this.d;b++)d.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=o,this.scale=n/t,this.uid=0;const _=o/n*t;this.min=-_,this.max=t+_}insert(t,n,o,d,_){this._forEachCell(n,o,d,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(d),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,o,d,_,b){this.cells[_].push(b)}query(t,n,o,d,_){const b=this.min,S=this.max;if(t<=b&&n<=b&&S<=o&&S<=d&&!_)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(t,n,o,d,this._queryCell,C,{},_),C}}_queryCell(t,n,o,d,_,b,S,C){const z=this.cells[_];if(z!==null){const R=this.keys,j=this.bboxes;for(let H=0;H<z.length;H++){const Y=z[H];if(S[Y]===void 0){const ee=4*Y;(C?C(j[ee+0],j[ee+1],j[ee+2],j[ee+3]):t<=j[ee+2]&&n<=j[ee+3]&&o>=j[ee+0]&&d>=j[ee+1])?(S[Y]=!0,b.push(R[Y])):S[Y]=!1}}}}_forEachCell(t,n,o,d,_,b,S,C){const z=this._convertToCellCoord(t),R=this._convertToCellCoord(n),j=this._convertToCellCoord(o),H=this._convertToCellCoord(d);for(let Y=z;Y<=j;Y++)for(let ee=R;ee<=H;ee++){const ae=this.d*ee+Y;if((!C||C(this._convertFromCellCoord(Y),this._convertFromCellCoord(ee),this._convertFromCellCoord(Y+1),this._convertFromCellCoord(ee+1)))&&_.call(this,t,n,o,d,ae,b,S,C))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let o=0;for(let b=0;b<this.cells.length;b++)o+=this.cells[b].length;const d=new Int32Array(n+o+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let _=n;for(let b=0;b<t.length;b++){const S=t[b];d[3+b]=_,d.set(S,_),_+=S.length}return d[3+t.length]=_,d.set(this.keys,_),_+=this.keys.length,d[3+t.length+1]=_,d.set(this.bboxes,_),_+=this.bboxes.length,d.buffer}static serialize(t,n){const o=t.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(t){return new Gl(t.buffer)}}const Ts={};function hr(i,t,n={}){if(Ts[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),Ts[i]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}hr("Object",Object),hr("TransferableGridIndex",Gl),hr("Color",ei),hr("Error",Error),hr("AJAXError",Zr),hr("ResolvedImage",hn),hr("StylePropertyFunction",Bo),hr("StyleExpression",go,{omit:["_evaluator"]}),hr("ZoomDependentExpression",Qn),hr("ZoomConstantExpression",Ro),hr("CompoundExpression",pi,{omit:["_evaluate"]});for(const i in ds)ds[i]._classRegistryKey||hr(`Expression_${i}`,ds[i]);function Pl(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Fc(i){return i.$name||i.constructor._classRegistryKey}function Jc(i){return!function(t){if(t===null||typeof t!="object")return!1;const n=Fc(t);return!(!n||n==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||Pl(i)||Et(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function Ga(i,t){if(Jc(i))return(Pl(i)||Et(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const _=[];for(const b of i)_.push(Ga(b,t));return _}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const n=Fc(i);if(!n)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!Ts[n])throw new Error(`${n} is not registered.`);const{klass:o}=Ts[n],d=o.serialize?o.serialize(i,t):{};if(o.serialize){if(t&&d===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const _ in i){if(!i.hasOwnProperty(_)||Ts[n].omit.indexOf(_)>=0)continue;const b=i[_];d[_]=Ts[n].shallow.indexOf(_)>=0?b:Ga(b,t)}i instanceof Error&&(d.message=i.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(d.$name=n),d}function vo(i){if(Jc(i))return i;if(Array.isArray(i))return i.map(vo);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=Fc(i)||"Object";if(!Ts[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=Ts[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(i);const o=Object.create(n.prototype);for(const d of Object.keys(i)){if(d==="$name")continue;const _=i[d];o[d]=Ts[t].shallow.indexOf(d)>=0?_:vo(_)}return o}class uc{constructor(){this.first=!0}update(t,n){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const Gr={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Hangul Syllables":i=>i>=44032&&i<=55215,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function $l(i){for(const t of i)if(oe(t.charCodeAt(0)))return!0;return!1}function w(i){for(const t of i)if(!Z(t.charCodeAt(0)))return!1;return!0}function T(i){const t=i.map(n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}}).filter(n=>n);return new RegExp(t.join("|"),"u")}const F=T(["Arab","Dupl","Mong","Ougr","Syrc"]);function Z(i){return!F.test(String.fromCodePoint(i))}const te=T(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function oe(i){return!(i!==746&&i!==747&&(i<4352||!(Gr["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Gr["CJK Compatibility"](i)||Gr["CJK Strokes"](i)||!(!Gr["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Gr["Enclosed CJK Letters and Months"](i)||Gr["Ideographic Description Characters"](i)||Gr.Kanbun(i)||Gr.Katakana(i)&&i!==12540||!(!Gr["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Gr["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Gr["Vertical Forms"](i)||Gr["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||te.test(String.fromCodePoint(i)))))}function ce(i){return!(oe(i)||function(t){return!!(Gr["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Gr["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Gr["Letterlike Symbols"](t)||Gr["Number Forms"](t)||Gr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Gr["Control Pictures"](t)&&t!==9251||Gr["Optical Character Recognition"](t)||Gr["Enclosed Alphanumerics"](t)||Gr["Geometric Shapes"](t)||Gr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Gr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Gr["CJK Symbols and Punctuation"](t)||Gr.Katakana(t)||Gr["Private Use Area"](t)||Gr["CJK Compatibility Forms"](t)||Gr["Small Form Variants"](t)||Gr["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}const he=T(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function ge(i){return he.test(String.fromCodePoint(i))}function Ce(i,t){return!(!t&&ge(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Gr.Khmer(i))}function rt(i){for(const t of i)if(ge(t.charCodeAt(0)))return!0;return!1}const _t=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(_t.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,t){return s(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;const n=i.pluginURL,o=new Promise(_=>{this.loadScriptResolve=_});t(n);const d=new Promise(_=>setTimeout(()=>_(),this.TIMEOUT));if(yield Promise.race([o,d]),this.isParsed()){const _={pluginStatus:"loaded",pluginURL:n};return this.setState(_),_}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)})}};class ct{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new uc,this.transition={})}isSupportedScript(t){return function(n,o){for(const d of n)if(!Ce(d.charCodeAt(0),o))return!1;return!0}(t,_t.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class ot{constructor(t,n){this.property=t,this.value=n,this.expression=function(o,d){if(Jn(o))return new Bo(o,d);if(No(o)){const _=Ss(o,d);if(_.result==="error")throw new Error(_.value.map(b=>`${b.key}: ${b.message}`).join(", "));return _.value}{let _=o;return d.type==="color"&&typeof o=="string"?_=ei.parse(o):d.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?d.type==="variableAnchorOffsetCollection"&&Array.isArray(o)?_=Ti.parse(o):d.type==="projectionDefinition"&&typeof o=="string"&&(_=mn.parse(o)):_=un.parse(o),{kind:"constant",evaluate:()=>_}}}(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,o){return this.property.possiblyEvaluate(this,t,n,o)}}class Vt{constructor(t){this.property=t,this.value=new ot(t,void 0)}transitioned(t,n){return new it(this.property,this.value,n,We({},t.transition,this.transition),t.now)}untransitioned(){return new it(this.property,this.value,null,{},0)}}class kt{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return gt(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Vt(this._values[t].property)),this._values[t].value=new ot(this._values[t].property,n===null?void 0:gt(n))}getTransition(t){return gt(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Vt(this._values[t].property)),this._values[t].transition=gt(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o);const d=this.getTransition(n);d!==void 0&&(t[`${n}-transition`]=d)}return t}transitioned(t,n){const o=new st(this._properties);for(const d of Object.keys(this._values))o._values[d]=this._values[d].transitioned(t,n._values[d]);return o}untransitioned(){const t=new st(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class it{constructor(t,n,o,d,_){this.property=t,this.value=n,this.begin=_+d.delay||0,this.end=this.begin+d.duration||0,t.specification.transition&&(d.delay||d.duration)&&(this.prior=o)}possiblyEvaluate(t,n,o){const d=t.now||0,_=this.value.possiblyEvaluate(t,n,o),b=this.prior;if(b){if(d>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(d<this.begin)return b.possiblyEvaluate(t,n,o);{const S=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,n,o),_,Dt(S))}}return _}}class st{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,o){const d=new jt(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(t,n,o);return d}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Ut{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return gt(this._values[t].value)}setValue(t,n){this._values[t]=new ot(this._values[t].property,n===null?void 0:gt(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o)}return t}possiblyEvaluate(t,n,o){const d=new jt(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(t,n,o);return d}}class Ot{constructor(t,n,o){this.property=t,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,o,d){return this.property.evaluate(this.value,this.parameters,t,n,o,d)}}class jt{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ft{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,o){const d=dn[this.specification.type];return d?d(t,n,o):t}}class zt{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,o,d){return new Ot(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},o,d)}:t.expression,n)}interpolate(t,n,o){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new Ot(this,{kind:"constant",value:void 0},t.parameters);const d=dn[this.specification.type];if(d){const _=d(t.value.value,n.value.value,o);return new Ot(this,{kind:"constant",value:_},t.parameters)}return t}evaluate(t,n,o,d,_,b){return t.kind==="constant"?t.value:t.evaluate(n,o,d,_,b)}}class kr extends zt{possiblyEvaluate(t,n,o,d){if(t.value===void 0)return new Ot(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const _=t.expression.evaluate(n,null,{},o,d),b=t.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,S=this._calculate(b,b,b,n);return new Ot(this,{kind:"constant",value:S},n)}if(t.expression.kind==="camera"){const _=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new Ot(this,{kind:"constant",value:_},n)}return new Ot(this,t.expression,n)}evaluate(t,n,o,d,_,b){if(t.kind==="source"){const S=t.evaluate(n,o,d,_,b);return this._calculate(S,S,S,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},o,d),t.evaluate({zoom:Math.floor(n.zoom)},o,d),t.evaluate({zoom:Math.floor(n.zoom)+1},o,d),n):t.value}_calculate(t,n,o,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class cr{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,d){if(t.value!==void 0){if(t.expression.kind==="constant"){const _=t.expression.evaluate(n,null,{},o,d);return this._calculate(_,_,_,n)}return this._calculate(t.expression.evaluate(new ct(Math.floor(n.zoom-1),n)),t.expression.evaluate(new ct(Math.floor(n.zoom),n)),t.expression.evaluate(new ct(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,o,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class ui{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,d){return!!t.expression.evaluate(n,null,{},o,d)}interpolate(){return!1}}class $r{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const o=t[n];o.specification.overridable&&this.overridableProperties.push(n);const d=this.defaultPropertyValues[n]=new ot(o,void 0),_=this.defaultTransitionablePropertyValues[n]=new Vt(o);this.defaultTransitioningPropertyValues[n]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=d.possiblyEvaluate({})}}}hr("DataDrivenProperty",zt),hr("DataConstantProperty",Ft),hr("CrossFadedDataDrivenProperty",kr),hr("CrossFadedProperty",cr),hr("ColorRampProperty",ui);const li="-transition";class qr extends K{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new Ut(n.layout)),n.paint)){this._transitionablePaint=new kt(n.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new jt(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,o={}){n!=null&&this._validate(ku,`layers.${this.id}.layout.${t}`,t,n,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(li)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,o={}){if(n!=null&&this._validate(Ul,`layers.${this.id}.paint.${t}`,t,n,o))return!1;if(t.endsWith(li))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const d=this._transitionablePaint._values[t],_=d.property.specification["property-type"]==="cross-faded-data-driven",b=d.value.isDataDriven(),S=d.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const C=this._transitionablePaint._values[t].value;return C.isDataDriven()||b||_||this._handleOverridablePaintPropertyUpdate(t,S,C)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),pt(t,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(t,n,o,d,_={}){return(!_||_.validate!==!1)&&Zl(this,t.call(Za,{key:n,layerType:this.type,objectKey:o,value:d,styleSpec:x,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof Ot&&sa(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const Ai={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ni{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class br{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Hr(i,t=1){let n=0,o=0;return{members:i.map(d=>{const _=Ai[d.type].BYTES_PER_ELEMENT,b=n=rs(n,Math.max(t,_)),S=d.components||1;return o=Math.max(o,_),n+=_*S,{name:d.name,type:d.type,components:S,offset:b}}),size:rs(n,Math.max(o,t)),alignment:t}}function rs(i,t){return Math.ceil(i/t)*t}class Fi extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const d=2*t;return this.int16[d+0]=n,this.int16[d+1]=o,t}}Fi.prototype.bytesPerElement=4,hr("StructArrayLayout2i4",Fi);class kn extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,o)}emplace(t,n,o,d){const _=3*t;return this.int16[_+0]=n,this.int16[_+1]=o,this.int16[_+2]=d,t}}kn.prototype.bytesPerElement=6,hr("StructArrayLayout3i6",kn);class gi extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,d)}emplace(t,n,o,d,_){const b=4*t;return this.int16[b+0]=n,this.int16[b+1]=o,this.int16[b+2]=d,this.int16[b+3]=_,t}}gi.prototype.bytesPerElement=8,hr("StructArrayLayout4i8",gi);class nn extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,d,_,b){const S=this.length;return this.resize(S+1),this.emplace(S,t,n,o,d,_,b)}emplace(t,n,o,d,_,b,S){const C=6*t;return this.int16[C+0]=n,this.int16[C+1]=o,this.int16[C+2]=d,this.int16[C+3]=_,this.int16[C+4]=b,this.int16[C+5]=S,t}}nn.prototype.bytesPerElement=12,hr("StructArrayLayout2i4i12",nn);class Gn extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,d,_,b){const S=this.length;return this.resize(S+1),this.emplace(S,t,n,o,d,_,b)}emplace(t,n,o,d,_,b,S){const C=4*t,z=8*t;return this.int16[C+0]=n,this.int16[C+1]=o,this.uint8[z+4]=d,this.uint8[z+5]=_,this.uint8[z+6]=b,this.uint8[z+7]=S,t}}Gn.prototype.bytesPerElement=8,hr("StructArrayLayout2i4ub8",Gn);class Vi extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const d=2*t;return this.float32[d+0]=n,this.float32[d+1]=o,t}}Vi.prototype.bytesPerElement=8,hr("StructArrayLayout2f8",Vi);class fn extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,d,_,b,S,C,z,R){const j=this.length;return this.resize(j+1),this.emplace(j,t,n,o,d,_,b,S,C,z,R)}emplace(t,n,o,d,_,b,S,C,z,R,j){const H=10*t;return this.uint16[H+0]=n,this.uint16[H+1]=o,this.uint16[H+2]=d,this.uint16[H+3]=_,this.uint16[H+4]=b,this.uint16[H+5]=S,this.uint16[H+6]=C,this.uint16[H+7]=z,this.uint16[H+8]=R,this.uint16[H+9]=j,t}}fn.prototype.bytesPerElement=20,hr("StructArrayLayout10ui20",fn);class yn extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,d,_,b,S,C,z,R,j,H){const Y=this.length;return this.resize(Y+1),this.emplace(Y,t,n,o,d,_,b,S,C,z,R,j,H)}emplace(t,n,o,d,_,b,S,C,z,R,j,H,Y){const ee=12*t;return this.int16[ee+0]=n,this.int16[ee+1]=o,this.int16[ee+2]=d,this.int16[ee+3]=_,this.uint16[ee+4]=b,this.uint16[ee+5]=S,this.uint16[ee+6]=C,this.uint16[ee+7]=z,this.int16[ee+8]=R,this.int16[ee+9]=j,this.int16[ee+10]=H,this.int16[ee+11]=Y,t}}yn.prototype.bytesPerElement=24,hr("StructArrayLayout4i4ui4i24",yn);class fs extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,o)}emplace(t,n,o,d){const _=3*t;return this.float32[_+0]=n,this.float32[_+1]=o,this.float32[_+2]=d,t}}fs.prototype.bytesPerElement=12,hr("StructArrayLayout3f12",fs);class is extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}is.prototype.bytesPerElement=4,hr("StructArrayLayout1ul4",is);class Ui extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,d,_,b,S,C,z){const R=this.length;return this.resize(R+1),this.emplace(R,t,n,o,d,_,b,S,C,z)}emplace(t,n,o,d,_,b,S,C,z,R){const j=10*t,H=5*t;return this.int16[j+0]=n,this.int16[j+1]=o,this.int16[j+2]=d,this.int16[j+3]=_,this.int16[j+4]=b,this.int16[j+5]=S,this.uint32[H+3]=C,this.uint16[j+8]=z,this.uint16[j+9]=R,t}}Ui.prototype.bytesPerElement=20,hr("StructArrayLayout6i1ul2ui20",Ui);class oa extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,d,_,b){const S=this.length;return this.resize(S+1),this.emplace(S,t,n,o,d,_,b)}emplace(t,n,o,d,_,b,S){const C=6*t;return this.int16[C+0]=n,this.int16[C+1]=o,this.int16[C+2]=d,this.int16[C+3]=_,this.int16[C+4]=b,this.int16[C+5]=S,t}}oa.prototype.bytesPerElement=12,hr("StructArrayLayout2i2i2i12",oa);class Aa extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,d,_){const b=this.length;return this.resize(b+1),this.emplace(b,t,n,o,d,_)}emplace(t,n,o,d,_,b){const S=4*t,C=8*t;return this.float32[S+0]=n,this.float32[S+1]=o,this.float32[S+2]=d,this.int16[C+6]=_,this.int16[C+7]=b,t}}Aa.prototype.bytesPerElement=16,hr("StructArrayLayout2f1f2i16",Aa);class qs extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,d,_,b){const S=this.length;return this.resize(S+1),this.emplace(S,t,n,o,d,_,b)}emplace(t,n,o,d,_,b,S){const C=16*t,z=4*t,R=8*t;return this.uint8[C+0]=n,this.uint8[C+1]=o,this.float32[z+1]=d,this.float32[z+2]=_,this.int16[R+6]=b,this.int16[R+7]=S,t}}qs.prototype.bytesPerElement=16,hr("StructArrayLayout2ub2f2i16",qs);class la extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,o)}emplace(t,n,o,d){const _=3*t;return this.uint16[_+0]=n,this.uint16[_+1]=o,this.uint16[_+2]=d,t}}la.prototype.bytesPerElement=6,hr("StructArrayLayout3ui6",la);class Zi extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,d,_,b,S,C,z,R,j,H,Y,ee,ae,ye,Me){const et=this.length;return this.resize(et+1),this.emplace(et,t,n,o,d,_,b,S,C,z,R,j,H,Y,ee,ae,ye,Me)}emplace(t,n,o,d,_,b,S,C,z,R,j,H,Y,ee,ae,ye,Me,et){const Be=24*t,X=12*t,me=48*t;return this.int16[Be+0]=n,this.int16[Be+1]=o,this.uint16[Be+2]=d,this.uint16[Be+3]=_,this.uint32[X+2]=b,this.uint32[X+3]=S,this.uint32[X+4]=C,this.uint16[Be+10]=z,this.uint16[Be+11]=R,this.uint16[Be+12]=j,this.float32[X+7]=H,this.float32[X+8]=Y,this.uint8[me+36]=ee,this.uint8[me+37]=ae,this.uint8[me+38]=ye,this.uint32[X+10]=Me,this.int16[Be+22]=et,t}}Zi.prototype.bytesPerElement=48,hr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Zi);class Sl extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,d,_,b,S,C,z,R,j,H,Y,ee,ae,ye,Me,et,Be,X,me,Ve,xt,qt,St,Ct,Wt,Gt){const Jt=this.length;return this.resize(Jt+1),this.emplace(Jt,t,n,o,d,_,b,S,C,z,R,j,H,Y,ee,ae,ye,Me,et,Be,X,me,Ve,xt,qt,St,Ct,Wt,Gt)}emplace(t,n,o,d,_,b,S,C,z,R,j,H,Y,ee,ae,ye,Me,et,Be,X,me,Ve,xt,qt,St,Ct,Wt,Gt,Jt){const Nt=32*t,fr=16*t;return this.int16[Nt+0]=n,this.int16[Nt+1]=o,this.int16[Nt+2]=d,this.int16[Nt+3]=_,this.int16[Nt+4]=b,this.int16[Nt+5]=S,this.int16[Nt+6]=C,this.int16[Nt+7]=z,this.uint16[Nt+8]=R,this.uint16[Nt+9]=j,this.uint16[Nt+10]=H,this.uint16[Nt+11]=Y,this.uint16[Nt+12]=ee,this.uint16[Nt+13]=ae,this.uint16[Nt+14]=ye,this.uint16[Nt+15]=Me,this.uint16[Nt+16]=et,this.uint16[Nt+17]=Be,this.uint16[Nt+18]=X,this.uint16[Nt+19]=me,this.uint16[Nt+20]=Ve,this.uint16[Nt+21]=xt,this.uint16[Nt+22]=qt,this.uint32[fr+12]=St,this.float32[fr+13]=Ct,this.float32[fr+14]=Wt,this.uint16[Nt+30]=Gt,this.uint16[Nt+31]=Jt,t}}Sl.prototype.bytesPerElement=64,hr("StructArrayLayout8i15ui1ul2f2ui64",Sl);class Wl extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}Wl.prototype.bytesPerElement=4,hr("StructArrayLayout1f4",Wl);class m extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,o)}emplace(t,n,o,d){const _=3*t;return this.uint16[6*t+0]=n,this.float32[_+1]=o,this.float32[_+2]=d,t}}m.prototype.bytesPerElement=12,hr("StructArrayLayout1ui2f12",m);class e extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,o)}emplace(t,n,o,d){const _=4*t;return this.uint32[2*t+0]=n,this.uint16[_+2]=o,this.uint16[_+3]=d,t}}e.prototype.bytesPerElement=8,hr("StructArrayLayout1ul2ui8",e);class r extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const d=2*t;return this.uint16[d+0]=n,this.uint16[d+1]=o,t}}r.prototype.bytesPerElement=4,hr("StructArrayLayout2ui4",r);class l extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}l.prototype.bytesPerElement=2,hr("StructArrayLayout1ui2",l);class u extends br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,d)}emplace(t,n,o,d,_){const b=4*t;return this.float32[b+0]=n,this.float32[b+1]=o,this.float32[b+2]=d,this.float32[b+3]=_,t}}u.prototype.bytesPerElement=16,hr("StructArrayLayout4f16",u);class g extends ni{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new de(this.anchorPointX,this.anchorPointY)}}g.prototype.size=20;class P extends Ui{get(t){return new g(this,t)}}hr("CollisionBoxArray",P);class I extends ni{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}I.prototype.size=48;class E extends Zi{get(t){return new I(this,t)}}hr("PlacedSymbolArray",E);class D extends ni{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}D.prototype.size=64;class q extends Sl{get(t){return new D(this,t)}}hr("SymbolInstanceArray",q);class $ extends Wl{getoffsetX(t){return this.float32[1*t+0]}}hr("GlyphOffsetArray",$);class W extends kn{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}hr("SymbolLineVertexArray",W);class ie extends ni{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ie.prototype.size=12;class se extends m{get(t){return new ie(this,t)}}hr("TextAnchorOffsetArray",se);class Pe extends ni{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Pe.prototype.size=8;class be extends e{get(t){return new Pe(this,t)}}hr("FeatureIndexArray",be);class Se extends Fi{}class Ee extends Fi{}class Ze extends Fi{}class Ge extends nn{}class Xe extends Gn{}class Je extends Vi{}class Ye extends fn{}class vt extends yn{}class bt extends fs{}class Mt extends is{}class Lt extends oa{}class It extends qs{}class tr extends la{}class Kt extends r{}const Bt=Hr([{name:"a_pos",components:2,type:"Int16"}],4),{members:gr}=Bt;class _r{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,n,o,d){const _=this.segments[this.segments.length-1];return t>_r.MAX_VERTEX_ARRAY_LENGTH&&$t(`Max vertices per segment is ${_r.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${_r.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!_||_.vertexLength+t>_r.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==d?this.createNewSegment(n,o,d):_}createNewSegment(t,n,o){const d={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(d.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(d),d}getOrCreateLatestSegment(t,n,o){return this.prepareSegment(0,t,n,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,o,d){return new _r([{vertexOffset:t,primitiveOffset:n,vertexLength:o,primitiveLength:d,vaos:{},sortKey:0}])}}function oi(i,t){return 256*(i=Ie(Math.floor(i),0,255))+Ie(Math.floor(t),0,255)}_r.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,hr("SegmentVector",_r);const Pi=Hr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var bi,Mi,_i,hi={exports:{}},vi={exports:{}},Tn={exports:{}},vn=function(){if(_i)return hi.exports;_i=1;var i=(bi||(bi=1,vi.exports=function(n,o){var d,_,b,S,C,z,R,j;for(_=n.length-(d=3&n.length),b=o,C=3432918353,z=461845907,j=0;j<_;)R=255&n.charCodeAt(j)|(255&n.charCodeAt(++j))<<8|(255&n.charCodeAt(++j))<<16|(255&n.charCodeAt(++j))<<24,++j,b=27492+(65535&(S=5*(65535&(b=(b^=R=(65535&(R=(R=(65535&R)*C+(((R>>>16)*C&65535)<<16)&4294967295)<<15|R>>>17))*z+(((R>>>16)*z&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(R=0,d){case 3:R^=(255&n.charCodeAt(j+2))<<16;case 2:R^=(255&n.charCodeAt(j+1))<<8;case 1:b^=R=(65535&(R=(R=(65535&(R^=255&n.charCodeAt(j)))*C+(((R>>>16)*C&65535)<<16)&4294967295)<<15|R>>>17))*z+(((R>>>16)*z&65535)<<16)&4294967295}return b^=n.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}),vi.exports),t=(Mi||(Mi=1,Tn.exports=function(n,o){for(var d,_=n.length,b=o^_,S=0;_>=4;)d=1540483477*(65535&(d=255&n.charCodeAt(S)|(255&n.charCodeAt(++S))<<8|(255&n.charCodeAt(++S))<<16|(255&n.charCodeAt(++S))<<24))+((1540483477*(d>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),_-=4,++S;switch(_){case 3:b^=(255&n.charCodeAt(S+2))<<16;case 2:b^=(255&n.charCodeAt(S+1))<<8;case 1:b=1540483477*(65535&(b^=255&n.charCodeAt(S)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}),Tn.exports);return hi.exports=i,hi.exports.murmur3=i,hi.exports.murmur2=t,hi.exports}(),bn=M(vn);class sn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,o,d){this.ids.push(Ta(t)),this.positions.push(n,o,d)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Ta(t);let o=0,d=this.ids.length-1;for(;o<d;){const b=o+d>>1;this.ids[b]>=n?d=b:o=b+1}const _=[];for(;this.ids[o]===n;)_.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return _}static serialize(t,n){const o=new Float64Array(t.ids),d=new Uint32Array(t.positions);return Vs(o,d,0,o.length-1),n&&n.push(o.buffer,d.buffer),{ids:o,positions:d}}static deserialize(t){const n=new sn;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function Ta(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:bn(String(i))}function Vs(i,t,n,o){for(;n<o;){const d=i[n+o>>1];let _=n-1,b=o+1;for(;;){do _++;while(i[_]<d);do b--;while(i[b]>d);if(_>=b)break;In(i,_,b),In(t,3*_,3*b),In(t,3*_+1,3*b+1),In(t,3*_+2,3*b+2)}b-n<o-b?(Vs(i,t,n,b),n=b+1):(Vs(i,t,b+1,o),o=b)}}function In(i,t,n){const o=i[t];i[t]=i[n],i[n]=o}hr("FeaturePositionMap",sn);class xn{constructor(t,n){this.gl=t.gl,this.location=n}}class ms extends xn{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class bo extends xn{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class $a extends xn{constructor(t,n){super(t,n),this.current=ei.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Is=new Float32Array(16);function Ia(i){return[oi(255*i.r,255*i.g),oi(255*i.b,255*i.a)]}class Cs{constructor(t,n,o){this.value=t,this.uniformNames=n.map(d=>`u_${d}`),this.type=o}setUniform(t,n,o){t.set(o.constantOr(this.value))}getBinding(t,n,o){return this.type==="color"?new $a(t,n):new ms(t,n)}}class Us{constructor(t,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,o,d){const _=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&t.set(_)}getBinding(t,n,o){return o.substr(0,9)==="u_pattern"?new bo(t,n):new ms(t,n)}}class Ni{constructor(t,n,o,d){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(_=>({name:`a_${_}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(t,n,o,d,_){const b=this.paintVertexArray.length,S=this.expression.evaluate(new ct(0),n,{},d,[],_);this.paintVertexArray.resize(t),this._setPaintValue(b,t,S)}updatePaintArray(t,n,o,d){const _=this.expression.evaluate({zoom:0},o,d);this._setPaintValue(t,n,_)}_setPaintValue(t,n,o){if(this.type==="color"){const d=Ia(o);for(let _=t;_<n;_++)this.paintVertexArray.emplace(_,d[0],d[1])}else{for(let d=t;d<n;d++)this.paintVertexArray.emplace(d,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Li{constructor(t,n,o,d,_,b){this.expression=t,this.uniformNames=n.map(S=>`u_${S}_t`),this.type=o,this.useIntegerZoom=d,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=n.map(S=>({name:`a_${S}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(t,n,o,d,_){const b=this.expression.evaluate(new ct(this.zoom),n,{},d,[],_),S=this.expression.evaluate(new ct(this.zoom+1),n,{},d,[],_),C=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(C,t,b,S)}updatePaintArray(t,n,o,d){const _=this.expression.evaluate({zoom:this.zoom},o,d),b=this.expression.evaluate({zoom:this.zoom+1},o,d);this._setPaintValue(t,n,_,b)}_setPaintValue(t,n,o,d){if(this.type==="color"){const _=Ia(o),b=Ia(d);for(let S=t;S<n;S++)this.paintVertexArray.emplace(S,_[0],_[1],b[0],b[1])}else{for(let _=t;_<n;_++)this.paintVertexArray.emplace(_,o,d);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(d))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,d=Ie(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(d)}getBinding(t,n,o){return new ms(t,n)}}class zn{constructor(t,n,o,d,_,b){this.expression=t,this.type=n,this.useIntegerZoom=o,this.zoom=d,this.layerId=b,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(t,n,o){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(d,t,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(t,n,o,d,_){this._setPaintValues(t,n,o.patterns&&o.patterns[this.layerId],_)}_setPaintValues(t,n,o,d){if(!d||!o)return;const{min:_,mid:b,max:S}=o,C=d[_],z=d[b],R=d[S];if(C&&z&&R)for(let j=t;j<n;j++)this.zoomInPaintVertexArray.emplace(j,z.tl[0],z.tl[1],z.br[0],z.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],z.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(j,z.tl[0],z.tl[1],z.br[0],z.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],z.pixelRatio,R.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Pi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Pi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Dn{constructor(t,n,o){this.binders={},this._buffers=[];const d=[];for(const _ in t.paint._values){if(!o(_))continue;const b=t.paint.get(_);if(!(b instanceof Ot&&sa(b.property.specification)))continue;const S=pd(_,t.type),C=b.value,z=b.property.specification.type,R=b.property.useIntegerZoom,j=b.property.specification["property-type"],H=j==="cross-faded"||j==="cross-faded-data-driven";if(C.kind==="constant")this.binders[_]=H?new Us(C.value,S):new Cs(C.value,S,z),d.push(`/u_${_}`);else if(C.kind==="source"||H){const Y=gh(_,z,"source");this.binders[_]=H?new zn(C,z,R,n,Y,t.id):new Ni(C,S,z,Y),d.push(`/a_${_}`)}else{const Y=gh(_,z,"composite");this.binders[_]=new Li(C,S,z,R,n,Y),d.push(`/z_${_}`)}}this.cacheKey=d.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof Ni||n instanceof Li?n.maxValue:0}populatePaintArrays(t,n,o,d,_){for(const b in this.binders){const S=this.binders[b];(S instanceof Ni||S instanceof Li||S instanceof zn)&&S.populatePaintArray(t,n,o,d,_)}}setConstantPatternPositions(t,n){for(const o in this.binders){const d=this.binders[o];d instanceof Us&&d.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,o,d,_){let b=!1;for(const S in t){const C=n.getPositions(S);for(const z of C){const R=o.feature(z.index);for(const j in this.binders){const H=this.binders[j];if((H instanceof Ni||H instanceof Li||H instanceof zn)&&H.expression.isStateDependent===!0){const Y=d.paint.get(j);H.expression=Y.value,H.updatePaintArray(z.start,z.end,R,t[S],_),b=!0}}}}return b}defines(){const t=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Cs||o instanceof Us)&&t.push(...o.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Ni||o instanceof Li)for(let d=0;d<o.paintVertexAttributes.length;d++)t.push(o.paintVertexAttributes[d].name);else if(o instanceof zn)for(let d=0;d<Pi.members.length;d++)t.push(Pi.members[d].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Cs||o instanceof Us||o instanceof Li)for(const d of o.uniformNames)t.push(d)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const o=[];for(const d in this.binders){const _=this.binders[d];if(_ instanceof Cs||_ instanceof Us||_ instanceof Li){for(const b of _.uniformNames)if(n[b]){const S=_.getBinding(t,n[b],b);o.push({name:b,property:d,binding:S})}}}return o}setUniforms(t,n,o,d){for(const{name:_,property:b,binding:S}of n)this.binders[b].setUniform(S,d,o.get(b),_)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(t&&o instanceof zn){const d=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(o instanceof Ni||o instanceof Li)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const n in this.binders){const o=this.binders[n];(o instanceof Ni||o instanceof Li||o instanceof zn)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof Ni||n instanceof Li||n instanceof zn)&&n.destroy()}}}class Hl{constructor(t,n,o=()=>!0){this.programConfigurations={};for(const d of t)this.programConfigurations[d.id]=new Dn(d,n,o);this.needsUpload=!1,this._featureMap=new sn,this._bufferOffset=0}populatePaintArrays(t,n,o,d,_,b){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,n,d,_,b);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,o,d){for(const _ of o)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(t,this._featureMap,n,_,d)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function pd(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function gh(i,t,n){const o={color:{source:Vi,composite:u},number:{source:Wl,composite:Vi}},d=function(_){return{"line-pattern":{source:Ye,composite:Ye},"fill-pattern":{source:Ye,composite:Ye},"fill-extrusion-pattern":{source:Ye,composite:Ye}}[_]}(i);return d&&d[n]||o[t][n]}hr("ConstantBinder",Cs),hr("CrossFadedConstantBinder",Us),hr("SourceExpressionBinder",Ni),hr("CrossFadedCompositeBinder",zn),hr("CompositeExpressionBinder",Li),hr("ProgramConfiguration",Dn,{omit:["_buffers"]}),hr("ProgramConfigurationSet",Hl);const zu=Math.pow(2,14)-1,_h=-zu-1;function Xl(i){const t=ut/i.extent,n=i.loadGeometry();for(let o=0;o<n.length;o++){const d=n[o];for(let _=0;_<d.length;_++){const b=d[_],S=Math.round(b.x*t),C=Math.round(b.y*t);b.x=Ie(S,_h,zu),b.y=Ie(C,_h,zu),(S<b.x||S>b.x+1||C<b.y||C>b.y+1)&&$t("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function ca(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?Xl(i):[]}}const Du=-32768;function yh(i,t,n,o,d){i.emplaceBack(Du+8*t+o,Du+8*n+d)}class Qc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ee,this.indexArray=new tr,this.segments=new _r,this.programConfigurations=new Hl(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){const d=this.layers[0],_=[];let b=null,S=!1,C=d.type==="heatmap";if(d.type==="circle"){const R=d;b=R.layout.get("circle-sort-key"),S=!b.isConstant(),C=C||R.paint.get("circle-pitch-alignment")==="map"}const z=C?n.subdivisionGranularity.circle:1;for(const{feature:R,id:j,index:H,sourceLayerIndex:Y}of t){const ee=this.layers[0]._featureFilter.needGeometry,ae=ca(R,ee);if(!this.layers[0]._featureFilter.filter(new ct(this.zoom),ae,o))continue;const ye=S?b.evaluate(ae,{},o):void 0,Me={id:j,properties:R.properties,type:R.type,sourceLayerIndex:Y,index:H,geometry:ee?ae.geometry:Xl(R),patterns:{},sortKey:ye};_.push(Me)}S&&_.sort((R,j)=>R.sortKey-j.sortKey);for(const R of _){const{geometry:j,index:H,sourceLayerIndex:Y}=R,ee=t[H].feature;this.addFeature(R,j,H,o,z),n.featureIndex.insert(ee,j,H,Y,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gr),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,o,d,_=1){let b;switch(_){case 1:b=[0,7];break;case 3:b=[0,2,5,7];break;case 5:b=[0,1,3,4,6,7];break;case 7:b=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${_}; valid values are 1, 3, 5, 7.`)}const S=b.length;for(const C of n)for(const z of C){const R=z.x,j=z.y;if(R<0||R>=ut||j<0||j>=ut)continue;const H=this.segments.prepareSegment(S*S,this.layoutVertexArray,this.indexArray,t.sortKey),Y=H.vertexLength;for(let ee=0;ee<S;ee++)for(let ae=0;ae<S;ae++)yh(this.layoutVertexArray,R,j,b[ae],b[ee]);for(let ee=0;ee<S-1;ee++)for(let ae=0;ae<S-1;ae++){const ye=Y+ee*S+ae,Me=Y+(ee+1)*S+ae;this.indexArray.emplaceBack(ye,Me+1,ye+1),this.indexArray.emplaceBack(ye,Me,Me+1)}H.vertexLength+=S*S,H.primitiveLength+=(S-1)*(S-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},d)}}function eu(i,t){for(let n=0;n<i.length;n++)if(ru(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(ru(i,t[n]))return!0;return!!fd(i,t)}function vh(i,t,n){return!!ru(i,t)||!!md(t,i,n)}function tu(i,t){if(i.length===1)return yf(t,i[0]);for(let n=0;n<t.length;n++){const o=t[n];for(let d=0;d<o.length;d++)if(ru(i,o[d]))return!0}for(let n=0;n<i.length;n++)if(yf(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(fd(i,t[n]))return!0;return!1}function zy(i,t,n){if(i.length>1){if(fd(i,t))return!0;for(let o=0;o<t.length;o++)if(md(t[o],i,n))return!0}for(let o=0;o<i.length;o++)if(md(i[o],t,n))return!0;return!1}function fd(i,t){if(i.length===0||t.length===0)return!1;for(let n=0;n<i.length-1;n++){const o=i[n],d=i[n+1];for(let _=0;_<t.length-1;_++)if(Dy(o,d,t[_],t[_+1]))return!0}return!1}function Dy(i,t,n,o){return er(i,n,o)!==er(t,n,o)&&er(i,t,n)!==er(i,t,o)}function md(i,t,n){const o=n*n;if(t.length===1)return i.distSqr(t[0])<o;for(let d=1;d<t.length;d++)if(_f(i,t[d-1],t[d])<o)return!0;return!1}function _f(i,t,n){const o=t.distSqr(n);if(o===0)return i.distSqr(t);const d=((i.x-t.x)*(n.x-t.x)+(i.y-t.y)*(n.y-t.y))/o;return i.distSqr(d<0?t:d>1?n:n.sub(t)._mult(d)._add(t))}function yf(i,t){let n,o,d,_=!1;for(let b=0;b<i.length;b++){n=i[b];for(let S=0,C=n.length-1;S<n.length;C=S++)o=n[S],d=n[C],o.y>t.y!=d.y>t.y&&t.x<(d.x-o.x)*(t.y-o.y)/(d.y-o.y)+o.x&&(_=!_)}return _}function ru(i,t){let n=!1;for(let o=0,d=i.length-1;o<i.length;d=o++){const _=i[o],b=i[d];_.y>t.y!=b.y>t.y&&t.x<(b.x-_.x)*(t.y-_.y)/(b.y-_.y)+_.x&&(n=!n)}return n}function Fy(i,t,n){const o=n[0],d=n[2];if(i.x<o.x&&t.x<o.x||i.x>d.x&&t.x>d.x||i.y<o.y&&t.y<o.y||i.y>d.y&&t.y>d.y)return!1;const _=er(i,t,n[0]);return _!==er(i,t,n[1])||_!==er(i,t,n[2])||_!==er(i,t,n[3])}function Fu(i,t,n){const o=t.paint.get(i).value;return o.kind==="constant"?o.value:n.programConfigurations.get(t.id).getMaxValue(i)}function bh(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function xh(i,t,n,o,d){if(!t[0]&&!t[1])return i;const _=de.convert(t)._mult(d);n==="viewport"&&_._rotate(-o);const b=[];for(let S=0;S<i.length;S++)b.push(i[S].sub(_));return b}let vf,bf;hr("CircleBucket",Qc,{omit:["layers"]});var Ny={get paint(){return bf=bf||new $r({"circle-radius":new zt(x.paint_circle["circle-radius"]),"circle-color":new zt(x.paint_circle["circle-color"]),"circle-blur":new zt(x.paint_circle["circle-blur"]),"circle-opacity":new zt(x.paint_circle["circle-opacity"]),"circle-translate":new Ft(x.paint_circle["circle-translate"]),"circle-translate-anchor":new Ft(x.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ft(x.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ft(x.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new zt(x.paint_circle["circle-stroke-width"]),"circle-stroke-color":new zt(x.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new zt(x.paint_circle["circle-stroke-opacity"])})},get layout(){return vf=vf||new $r({"circle-sort-key":new zt(x.layout_circle["circle-sort-key"])})}};class Ry extends qr{constructor(t){super(t,Ny)}createBucket(t){return new Qc(t)}queryRadius(t){const n=t;return Fu("circle-radius",this,n)+Fu("circle-stroke-width",this,n)+bh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:d,transform:_,pixelsToTileUnits:b,pixelPosMatrix:S}){const C=xh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-_.bearingInRadians,b),z=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),R=this.paint.get("circle-pitch-alignment")==="map",j=R?C:function(Y,ee){return Y.map(ae=>xf(ae,ee))}(C,S),H=R?z*b:z;for(const Y of d)for(const ee of Y){const ae=R?ee:xf(ee,S);let ye=H;const Me=ve([],[ee.x,ee.y,0,1],S);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ye*=Me[3]/_.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ye*=_.cameraToCenterDistance/Me[3]),vh(j,ae,ye))return!0}return!1}}function xf(i,t){const n=ve([],[i.x,i.y,0,1],t);return new de(n[0]/n[3],n[1]/n[3])}class wf extends Qc{}let Pf;hr("HeatmapBucket",wf,{omit:["layers"]});var By={get paint(){return Pf=Pf||new $r({"heatmap-radius":new zt(x.paint_heatmap["heatmap-radius"]),"heatmap-weight":new zt(x.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ft(x.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ui(x.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ft(x.paint_heatmap["heatmap-opacity"])})}};function gd(i,{width:t,height:n},o,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==t*n*o)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${t*n*o}`)}else d=new Uint8Array(t*n*o);return i.width=t,i.height=n,i.data=d,i}function Sf(i,{width:t,height:n},o){if(t===i.width&&n===i.height)return;const d=gd({},{width:t,height:n},o);_d(i,d,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,n)},o),i.width=t,i.height=n,i.data=d.data}function _d(i,t,n,o,d,_){if(d.width===0||d.height===0)return t;if(d.width>i.width||d.height>i.height||n.x>i.width-d.width||n.y>i.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>t.width||d.height>t.height||o.x>t.width-d.width||o.y>t.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const b=i.data,S=t.data;if(b===S)throw new Error("srcData equals dstData, so image is already copied");for(let C=0;C<d.height;C++){const z=((n.y+C)*i.width+n.x)*_,R=((o.y+C)*t.width+o.x)*_;for(let j=0;j<d.width*_;j++)S[R+j]=b[z+j]}return t}class Nu{constructor(t,n){gd(this,t,1,n)}resize(t){Sf(this,t,1)}clone(){return new Nu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,d,_){_d(t,n,o,d,_,1)}}class Wa{constructor(t,n){gd(this,t,4,n)}resize(t){Sf(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Wa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,d,_){_d(t,n,o,d,_,4)}}function Af(i){const t={},n=i.resolution||256,o=i.clips?i.clips.length:1,d=i.image||new Wa({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const _=(b,S,C)=>{t[i.evaluationKey]=C;const z=i.expression.evaluate(t);d.data[b+S+0]=Math.floor(255*z.r/z.a),d.data[b+S+1]=Math.floor(255*z.g/z.a),d.data[b+S+2]=Math.floor(255*z.b/z.a),d.data[b+S+3]=Math.floor(255*z.a)};if(i.clips)for(let b=0,S=0;b<o;++b,S+=4*n)for(let C=0,z=0;C<n;C++,z+=4){const R=C/(n-1),{start:j,end:H}=i.clips[b];_(S,z,j*(1-R)+H*R)}else for(let b=0,S=0;b<n;b++,S+=4)_(0,S,b/(n-1));return d}hr("AlphaImage",Nu),hr("RGBAImage",Wa);const yd="big-fb";class Oy extends qr{createBucket(t){return new wf(t)}constructor(t){super(t,By),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Af({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(yd)&&this.heatmapFbos.delete(yd)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Tf;var jy={get paint(){return Tf=Tf||new $r({"hillshade-illumination-direction":new Ft(x.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ft(x.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ft(x.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ft(x.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ft(x.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ft(x.paint_hillshade["hillshade-accent-color"])})}};class qy extends qr{constructor(t){super(t,jy)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Vy=Hr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Uy}=Vy;function vd(i,t,n){const o=n.patternDependencies;let d=!1;for(const _ of t){const b=_.paint.get(`${i}-pattern`);b.isConstant()||(d=!0);const S=b.constantOr(null);S&&(d=!0,o[S.to]=!0,o[S.from]=!0)}return d}function bd(i,t,n,o,d){const _=d.patternDependencies;for(const b of t){const S=b.paint.get(`${i}-pattern`).value;if(S.kind!=="constant"){let C=S.evaluate({zoom:o-1},n,{},d.availableImages),z=S.evaluate({zoom:o},n,{},d.availableImages),R=S.evaluate({zoom:o+1},n,{},d.availableImages);C=C&&C.name?C.name:C,z=z&&z.name?z.name:z,R=R&&R.name?R.name:R,_[C]=!0,_[z]=!0,_[R]=!0,n.patterns[b.id]={min:C,mid:z,max:R}}}return n}function If(i,t,n,o,d){let _;if(d===function(b,S,C,z){let R=0;for(let j=S,H=C-z;j<C;j+=z)R+=(b[H]-b[j])*(b[j+1]+b[H+1]),H=j;return R}(i,t,n,o)>0)for(let b=t;b<n;b+=o)_=Ef(b/o|0,i[b],i[b+1],_);else for(let b=n-o;b>=t;b-=o)_=Ef(b/o|0,i[b],i[b+1],_);return _&&iu(_,_.next)&&(ju(_),_=_.next),_}function Nc(i,t){if(!i)return i;t||(t=i);let n,o=i;do if(n=!1,o.steiner||!iu(o,o.next)&&wn(o.prev,o,o.next)!==0)o=o.next;else{if(ju(o),o=t=o.prev,o===o.next)break;n=!0}while(n||o!==t);return t}function Ru(i,t,n,o,d,_,b){if(!i)return;!b&&_&&function(C,z,R,j){let H=C;do H.z===0&&(H.z=xd(H.x,H.y,z,R,j)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next;while(H!==C);H.prevZ.nextZ=null,H.prevZ=null,function(Y){let ee,ae=1;do{let ye,Me=Y;Y=null;let et=null;for(ee=0;Me;){ee++;let Be=Me,X=0;for(let Ve=0;Ve<ae&&(X++,Be=Be.nextZ,Be);Ve++);let me=ae;for(;X>0||me>0&&Be;)X!==0&&(me===0||!Be||Me.z<=Be.z)?(ye=Me,Me=Me.nextZ,X--):(ye=Be,Be=Be.nextZ,me--),et?et.nextZ=ye:Y=ye,ye.prevZ=et,et=ye;Me=Be}et.nextZ=null,ae*=2}while(ee>1)}(H)}(i,o,d,_);let S=i;for(;i.prev!==i.next;){const C=i.prev,z=i.next;if(_?Gy(i,o,d,_):Zy(i))t.push(C.i,i.i,z.i),ju(i),i=z.next,S=z.next;else if((i=z)===S){b?b===1?Ru(i=$y(Nc(i),t),t,n,o,d,_,2):b===2&&Wy(i,t,n,o,d,_):Ru(Nc(i),t,n,o,d,_,1);break}}}function Zy(i){const t=i.prev,n=i,o=i.next;if(wn(t,n,o)>=0)return!1;const d=t.x,_=n.x,b=o.x,S=t.y,C=n.y,z=o.y,R=Math.min(d,_,b),j=Math.min(S,C,z),H=Math.max(d,_,b),Y=Math.max(S,C,z);let ee=o.next;for(;ee!==t;){if(ee.x>=R&&ee.x<=H&&ee.y>=j&&ee.y<=Y&&Bu(d,S,_,C,b,z,ee.x,ee.y)&&wn(ee.prev,ee,ee.next)>=0)return!1;ee=ee.next}return!0}function Gy(i,t,n,o){const d=i.prev,_=i,b=i.next;if(wn(d,_,b)>=0)return!1;const S=d.x,C=_.x,z=b.x,R=d.y,j=_.y,H=b.y,Y=Math.min(S,C,z),ee=Math.min(R,j,H),ae=Math.max(S,C,z),ye=Math.max(R,j,H),Me=xd(Y,ee,t,n,o),et=xd(ae,ye,t,n,o);let Be=i.prevZ,X=i.nextZ;for(;Be&&Be.z>=Me&&X&&X.z<=et;){if(Be.x>=Y&&Be.x<=ae&&Be.y>=ee&&Be.y<=ye&&Be!==d&&Be!==b&&Bu(S,R,C,j,z,H,Be.x,Be.y)&&wn(Be.prev,Be,Be.next)>=0||(Be=Be.prevZ,X.x>=Y&&X.x<=ae&&X.y>=ee&&X.y<=ye&&X!==d&&X!==b&&Bu(S,R,C,j,z,H,X.x,X.y)&&wn(X.prev,X,X.next)>=0))return!1;X=X.nextZ}for(;Be&&Be.z>=Me;){if(Be.x>=Y&&Be.x<=ae&&Be.y>=ee&&Be.y<=ye&&Be!==d&&Be!==b&&Bu(S,R,C,j,z,H,Be.x,Be.y)&&wn(Be.prev,Be,Be.next)>=0)return!1;Be=Be.prevZ}for(;X&&X.z<=et;){if(X.x>=Y&&X.x<=ae&&X.y>=ee&&X.y<=ye&&X!==d&&X!==b&&Bu(S,R,C,j,z,H,X.x,X.y)&&wn(X.prev,X,X.next)>=0)return!1;X=X.nextZ}return!0}function $y(i,t){let n=i;do{const o=n.prev,d=n.next.next;!iu(o,d)&&Mf(o,n,n.next,d)&&Ou(o,d)&&Ou(d,o)&&(t.push(o.i,n.i,d.i),ju(n),ju(n.next),n=i=d),n=n.next}while(n!==i);return Nc(n)}function Wy(i,t,n,o,d,_){let b=i;do{let S=b.next.next;for(;S!==b.prev;){if(b.i!==S.i&&Jy(b,S)){let C=Lf(b,S);return b=Nc(b,b.next),C=Nc(C,C.next),Ru(b,t,n,o,d,_,0),void Ru(C,t,n,o,d,_,0)}S=S.next}b=b.next}while(b!==i)}function Hy(i,t){let n=i.x-t.x;return n===0&&(n=i.y-t.y,n===0)&&(n=(i.next.y-i.y)/(i.next.x-i.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function Xy(i,t){const n=function(d,_){let b=_;const S=d.x,C=d.y;let z,R=-1/0;if(iu(d,b))return b;do{if(iu(d,b.next))return b.next;if(C<=b.y&&C>=b.next.y&&b.next.y!==b.y){const ae=b.x+(C-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(ae<=S&&ae>R&&(R=ae,z=b.x<b.next.x?b:b.next,ae===S))return z}b=b.next}while(b!==_);if(!z)return null;const j=z,H=z.x,Y=z.y;let ee=1/0;b=z;do{if(S>=b.x&&b.x>=H&&S!==b.x&&Cf(C<Y?S:R,C,H,Y,C<Y?R:S,C,b.x,b.y)){const ae=Math.abs(C-b.y)/(S-b.x);Ou(b,d)&&(ae<ee||ae===ee&&(b.x>z.x||b.x===z.x&&Yy(z,b)))&&(z=b,ee=ae)}b=b.next}while(b!==j);return z}(i,t);if(!n)return t;const o=Lf(n,i);return Nc(o,o.next),Nc(n,n.next)}function Yy(i,t){return wn(i.prev,i,t.prev)<0&&wn(t.next,i,i.next)<0}function xd(i,t,n,o,d){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*d|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*d|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ky(i){let t=i,n=i;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==i);return n}function Cf(i,t,n,o,d,_,b,S){return(d-b)*(t-S)>=(i-b)*(_-S)&&(i-b)*(o-S)>=(n-b)*(t-S)&&(n-b)*(_-S)>=(d-b)*(o-S)}function Bu(i,t,n,o,d,_,b,S){return!(i===b&&t===S)&&Cf(i,t,n,o,d,_,b,S)}function Jy(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(n,o){let d=n;do{if(d.i!==n.i&&d.next.i!==n.i&&d.i!==o.i&&d.next.i!==o.i&&Mf(d,d.next,n,o))return!0;d=d.next}while(d!==n);return!1}(i,t)&&(Ou(i,t)&&Ou(t,i)&&function(n,o){let d=n,_=!1;const b=(n.x+o.x)/2,S=(n.y+o.y)/2;do d.y>S!=d.next.y>S&&d.next.y!==d.y&&b<(d.next.x-d.x)*(S-d.y)/(d.next.y-d.y)+d.x&&(_=!_),d=d.next;while(d!==n);return _}(i,t)&&(wn(i.prev,i,t.prev)||wn(i,t.prev,t))||iu(i,t)&&wn(i.prev,i,i.next)>0&&wn(t.prev,t,t.next)>0)}function wn(i,t,n){return(t.y-i.y)*(n.x-t.x)-(t.x-i.x)*(n.y-t.y)}function iu(i,t){return i.x===t.x&&i.y===t.y}function Mf(i,t,n,o){const d=Ph(wn(i,t,n)),_=Ph(wn(i,t,o)),b=Ph(wn(n,o,i)),S=Ph(wn(n,o,t));return d!==_&&b!==S||!(d!==0||!wh(i,n,t))||!(_!==0||!wh(i,o,t))||!(b!==0||!wh(n,i,o))||!(S!==0||!wh(n,t,o))}function wh(i,t,n){return t.x<=Math.max(i.x,n.x)&&t.x>=Math.min(i.x,n.x)&&t.y<=Math.max(i.y,n.y)&&t.y>=Math.min(i.y,n.y)}function Ph(i){return i>0?1:i<0?-1:0}function Ou(i,t){return wn(i.prev,i,i.next)<0?wn(i,t,i.next)>=0&&wn(i,i.prev,t)>=0:wn(i,t,i.prev)<0||wn(i,i.next,t)<0}function Lf(i,t){const n=wd(i.i,i.x,i.y),o=wd(t.i,t.x,t.y),d=i.next,_=t.prev;return i.next=t,t.prev=i,n.next=d,d.prev=n,o.next=n,n.prev=o,_.next=o,o.prev=_,o}function Ef(i,t,n,o){const d=wd(i,t,n);return o?(d.next=o.next,d.prev=o,o.next.prev=d,o.next=d):(d.prev=d,d.next=d),d}function ju(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function wd(i,t,n){return{i,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class nu{constructor(t,n){if(n>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=n}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class Sh{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}Sh.noSubdivision=new Sh({fill:new nu(0,0),line:new nu(0,0),tile:new nu(0,0),stencil:new nu(0,0),circle:1}),hr("SubdivisionGranularityExpression",nu),hr("SubdivisionGranularitySetting",Sh);const su=-32768,qu=32767;class Qy{constructor(t,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=ut/t,this._canonical=n}_getKey(t,n){return(t+=32768)<<16|(n+=32768)<<0}_vertexToIndex(t,n){if(t<-32768||n<-32768||t>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(t),d=0|Math.round(n),_=this._getKey(o,d);if(this._vertexDictionary.has(_))return this._vertexDictionary.get(_);const b=this._vertexBuffer.length/2;return this._vertexDictionary.set(_,b),this._vertexBuffer.push(o,d),b}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(d,_){const b=[];for(let S=0;S<_.length;S+=3){const C=_[S],z=_[S+1],R=_[S+2],j=d[2*C],H=d[2*C+1];(d[2*z]-j)*(d[2*R+1]-H)-(d[2*z+1]-H)*(d[2*R]-j)>0?(b.push(C),b.push(R),b.push(z)):(b.push(C),b.push(z),b.push(R))}return b}(this._vertexBuffer,t);const n=[],o=t.length;for(let d=0;d<o;d+=3){const _=[t[d+0],t[d+1],t[d+2]],b=[this._vertexBuffer[2*t[d+0]+0],this._vertexBuffer[2*t[d+0]+1],this._vertexBuffer[2*t[d+1]+0],this._vertexBuffer[2*t[d+1]+1],this._vertexBuffer[2*t[d+2]+0],this._vertexBuffer[2*t[d+2]+1]];let S=1/0,C=1/0,z=-1/0,R=-1/0;for(let ae=0;ae<3;ae++){const ye=b[2*ae],Me=b[2*ae+1];S=Math.min(S,ye),z=Math.max(z,ye),C=Math.min(C,Me),R=Math.max(R,Me)}if(S===z||C===R)continue;const j=Math.floor(S/this._granularityCellSize),H=Math.ceil(z/this._granularityCellSize),Y=Math.floor(C/this._granularityCellSize),ee=Math.ceil(R/this._granularityCellSize);if(j!==H||Y!==ee)for(let ae=Y;ae<ee;ae++){const ye=this._scanlineGenerateVertexRingForCellRow(ae,b,_);e0(this._vertexBuffer,ye,n)}else n.push(..._)}return n}_scanlineGenerateVertexRingForCellRow(t,n,o){const d=t*this._granularityCellSize,_=d+this._granularityCellSize,b=[];for(let S=0;S<3;S++){const C=n[2*S],z=n[2*S+1],R=n[2*(S+1)%6],j=n[(2*(S+1)+1)%6],H=n[2*(S+2)%6],Y=n[(2*(S+2)+1)%6],ee=R-C,ae=j-z,ye=ee===0,Me=ae===0,et=(d-z)/ae,Be=(_-z)/ae,X=Math.min(et,Be),me=Math.max(et,Be);if(!Me&&(X>=1||me<=0)||Me&&(z<d||z>_)){j>=d&&j<=_&&b.push(o[(S+1)%3]);continue}!Me&&X>0&&b.push(this._vertexToIndex(C+ee*X,z+ae*X));const Ve=C+ee*Math.max(X,0),xt=C+ee*Math.min(me,1);ye||this._generateIntraEdgeVertices(b,C,z,R,j,Ve,xt),!Me&&me<1&&b.push(this._vertexToIndex(C+ee*me,z+ae*me)),(Me||j>=d&&j<=_)&&b.push(o[(S+1)%3]),!Me&&(j<=d||j>=_)&&this._generateInterEdgeVertices(b,C,z,R,j,H,Y,xt,d,_)}return b}_generateIntraEdgeVertices(t,n,o,d,_,b,S){const C=d-n,z=_-o,R=z===0,j=R?Math.min(n,d):Math.min(b,S),H=R?Math.max(n,d):Math.max(b,S),Y=Math.floor(j/this._granularityCellSize)+1,ee=Math.ceil(H/this._granularityCellSize)-1;if(R?n<d:b<S)for(let ae=Y;ae<=ee;ae++){const ye=ae*this._granularityCellSize;t.push(this._vertexToIndex(ye,o+z*(ye-n)/C))}else for(let ae=ee;ae>=Y;ae--){const ye=ae*this._granularityCellSize;t.push(this._vertexToIndex(ye,o+z*(ye-n)/C))}}_generateInterEdgeVertices(t,n,o,d,_,b,S,C,z,R){const j=_-o,H=b-d,Y=S-_,ee=(z-_)/Y,ae=(R-_)/Y,ye=Math.min(ee,ae),Me=Math.max(ee,ae),et=d+H*ye;let Be=Math.floor(Math.min(et,C)/this._granularityCellSize)+1,X=Math.ceil(Math.max(et,C)/this._granularityCellSize)-1,me=C<et;const Ve=Y===0;if(Ve&&(S===z||S===R))return;if(Ve||ye>=1||Me<=0){const qt=o-S,St=b+(n-b)*Math.min((z-S)/qt,(R-S)/qt);Be=Math.floor(Math.min(St,C)/this._granularityCellSize)+1,X=Math.ceil(Math.max(St,C)/this._granularityCellSize)-1,me=C<St}const xt=j>0?R:z;if(me)for(let qt=Be;qt<=X;qt++)t.push(this._vertexToIndex(qt*this._granularityCellSize,xt));else for(let qt=X;qt>=Be;qt--)t.push(this._vertexToIndex(qt*this._granularityCellSize,xt))}_generateOutline(t){const n=[];for(const o of t){const d=Rc(o,this._granularity,!0),_=this._pointArrayToIndices(d),b=[];for(let S=1;S<_.length;S++)b.push(_[S-1]),b.push(_[S]);n.push(b)}return n}_handlePoles(t){let n=!1,o=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(n||o)&&this._fillPoles(t,n,o)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let n=0;n<t.length;n+=2){const o=t[n+1];o===su&&(t[n+1]=-32767),o===qu&&(t[n+1]=32766)}}_generatePoleQuad(t,n,o,d,_,b){d>_!=(b===su)?(t.push(n),t.push(o),t.push(this._vertexToIndex(d,b)),t.push(o),t.push(this._vertexToIndex(_,b)),t.push(this._vertexToIndex(d,b))):(t.push(o),t.push(n),t.push(this._vertexToIndex(d,b)),t.push(this._vertexToIndex(_,b)),t.push(o),t.push(this._vertexToIndex(d,b)))}_fillPoles(t,n,o){const d=this._vertexBuffer,_=ut,b=t.length;for(let S=2;S<b;S+=3){const C=t[S-2],z=t[S-1],R=t[S],j=d[2*C],H=d[2*C+1],Y=d[2*z],ee=d[2*z+1],ae=d[2*R],ye=d[2*R+1];n&&(H===0&&ee===0&&this._generatePoleQuad(t,C,z,j,Y,su),ee===0&&ye===0&&this._generatePoleQuad(t,z,R,Y,ae,su),ye===0&&H===0&&this._generatePoleQuad(t,R,C,ae,j,su)),o&&(H===_&&ee===_&&this._generatePoleQuad(t,C,z,j,Y,qu),ee===_&&ye===_&&this._generatePoleQuad(t,z,R,Y,ae,qu),ye===_&&H===_&&this._generatePoleQuad(t,R,C,ae,j,qu))}}_initializeVertices(t){for(let n=0;n<t.length;n+=2)this._vertexToIndex(t[n],t[n+1])}subdividePolygonInternal(t,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:d}=function(S){const C=[],z=[];for(const R of S)if(R.length!==0){R!==S[0]&&C.push(z.length/2);for(let j=0;j<R.length;j++)z.push(R[j].x),z.push(R[j].y)}return{flattened:z,holeIndices:C}}(t);let _;this._initializeVertices(o);try{const S=function(z,R,j=2){const H=R&&R.length,Y=H?R[0]*j:z.length;let ee=If(z,0,Y,j,!0);const ae=[];if(!ee||ee.next===ee.prev)return ae;let ye,Me,et;if(H&&(ee=function(Be,X,me,Ve){const xt=[];for(let qt=0,St=X.length;qt<St;qt++){const Ct=If(Be,X[qt]*Ve,qt<St-1?X[qt+1]*Ve:Be.length,Ve,!1);Ct===Ct.next&&(Ct.steiner=!0),xt.push(Ky(Ct))}xt.sort(Hy);for(let qt=0;qt<xt.length;qt++)me=Xy(xt[qt],me);return me}(z,R,ee,j)),z.length>80*j){ye=1/0,Me=1/0;let Be=-1/0,X=-1/0;for(let me=j;me<Y;me+=j){const Ve=z[me],xt=z[me+1];Ve<ye&&(ye=Ve),xt<Me&&(Me=xt),Ve>Be&&(Be=Ve),xt>X&&(X=xt)}et=Math.max(Be-ye,X-Me),et=et!==0?32767/et:0}return Ru(ee,ae,j,ye,Me,et,0),ae}(o,d),C=this._convertIndices(o,S);_=this._subdivideTrianglesScanline(C)}catch(S){console.error(S)}let b=[];return n&&(b=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(_),{verticesFlattened:this._vertexBuffer,indicesTriangles:_,indicesLineList:b}}_convertIndices(t,n){const o=[];for(let d=0;d<n.length;d++)o.push(this._vertexToIndex(t[2*n[d]],t[2*n[d]+1]));return o}_pointArrayToIndices(t){const n=[];for(let o=0;o<t.length;o++){const d=t[o];n.push(this._vertexToIndex(d.x,d.y))}return n}}function kf(i,t,n,o=!0){return new Qy(n,t).subdividePolygonInternal(i,o)}function Rc(i,t,n=!1){if(!i||i.length<1)return[];if(i.length<2)return[];const o=i[0],d=i[i.length-1],_=n&&(o.x!==d.x||o.y!==d.y);if(t<2)return _?[...i,i[0]]:[...i];const b=Math.floor(ut/t),S=[];S.push(new de(i[0].x,i[0].y));const C=i.length,z=_?C:C-1;for(let R=0;R<z;R++){const j=i[R],H=R<C-1?i[R+1]:i[0],Y=j.x,ee=j.y,ae=H.x,ye=H.y,Me=Y!==ae,et=ee!==ye;if(!Me&&!et)continue;const Be=ae-Y,X=ye-ee,me=Math.abs(Be),Ve=Math.abs(X);let xt=Y,qt=ee;for(;;){const Ct=Be>0?(Math.floor(xt/b)+1)*b:(Math.ceil(xt/b)-1)*b,Wt=X>0?(Math.floor(qt/b)+1)*b:(Math.ceil(qt/b)-1)*b,Gt=Math.abs(xt-Ct),Jt=Math.abs(qt-Wt),Nt=Math.abs(xt-ae),fr=Math.abs(qt-ye),Cr=Me?Gt/me:Number.POSITIVE_INFINITY,Tr=et?Jt/Ve:Number.POSITIVE_INFINITY;if((Nt<=Gt||!Me)&&(fr<=Jt||!et))break;if(Cr<Tr&&Me||!et){xt=Ct,qt+=X*Cr;const vr=new de(xt,Math.round(qt));S[S.length-1].x===vr.x&&S[S.length-1].y===vr.y||S.push(vr)}else{xt+=Be*Tr,qt=Wt;const vr=new de(Math.round(xt),qt);S[S.length-1].x===vr.x&&S[S.length-1].y===vr.y||S.push(vr)}}const St=new de(ae,ye);S[S.length-1].x===St.x&&S[S.length-1].y===St.y||S.push(St)}return S}function e0(i,t,n){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,d=i[2*t[0]];for(let C=1;C<t.length;C++){const z=i[2*t[C]];z<d&&(d=z,o=C)}const _=t.length;let b=o,S=(b+1)%_;for(;;){const C=b-1>=0?b-1:_-1,z=(S+1)%_,R=i[2*t[C]],j=i[2*t[z]],H=i[2*t[b]],Y=i[2*t[b]+1],ee=i[2*t[S]+1];let ae=!1;if(R<j)ae=!0;else if(R>j)ae=!1;else{const ye=ee-Y,Me=-(i[2*t[S]]-H),et=Y<ee?1:-1;((R-H)*ye+(i[2*t[C]+1]-Y)*Me)*et>((j-H)*ye+(i[2*t[z]+1]-Y)*Me)*et&&(ae=!0)}if(ae){const ye=t[C],Me=t[b],et=t[S];ye!==Me&&ye!==et&&Me!==et&&n.push(et,Me,ye),b--,b<0&&(b=_-1)}else{const ye=t[z],Me=t[b],et=t[S];ye!==Me&&ye!==et&&Me!==et&&n.push(et,Me,ye),S++,S>=_&&(S=0)}if(C===z)break}}function zf(i,t,n,o,d,_,b,S,C){const z=d.length/2,R=b&&S&&C;if(z<_r.MAX_VERTEX_ARRAY_LENGTH){const j=t.prepareSegment(z,n,o),H=j.vertexLength;for(let ae=0;ae<_.length;ae+=3)o.emplaceBack(H+_[ae],H+_[ae+1],H+_[ae+2]);let Y,ee;j.vertexLength+=z,j.primitiveLength+=_.length/3,R&&(ee=b.prepareSegment(z,n,S),Y=ee.vertexLength,ee.vertexLength+=z);for(let ae=0;ae<d.length;ae+=2)i(d[ae],d[ae+1]);if(R)for(let ae=0;ae<C.length;ae++){const ye=C[ae];for(let Me=1;Me<ye.length;Me+=2)S.emplaceBack(Y+ye[Me-1],Y+ye[Me]);ee.primitiveLength+=ye.length/2}}else(function(j,H,Y,ee,ae,ye){const Me=[];for(let Ve=0;Ve<ee.length/2;Ve++)Me.push(-1);const et={count:0};let Be=0,X=j.getOrCreateLatestSegment(H,Y),me=X.vertexLength;for(let Ve=2;Ve<ae.length;Ve+=3){const xt=ae[Ve-2],qt=ae[Ve-1],St=ae[Ve];let Ct=Me[xt]<Be,Wt=Me[qt]<Be,Gt=Me[St]<Be;X.vertexLength+((Ct?1:0)+(Wt?1:0)+(Gt?1:0))>_r.MAX_VERTEX_ARRAY_LENGTH&&(X=j.createNewSegment(H,Y),Be=et.count,Ct=!0,Wt=!0,Gt=!0,me=0);const Jt=Vu(Me,ee,ye,et,xt,Ct,X),Nt=Vu(Me,ee,ye,et,qt,Wt,X),fr=Vu(Me,ee,ye,et,St,Gt,X);Y.emplaceBack(me+Jt-Be,me+Nt-Be,me+fr-Be),X.primitiveLength++}})(t,n,o,d,_,i),R&&function(j,H,Y,ee,ae,ye){const Me=[];for(let Ve=0;Ve<ee.length/2;Ve++)Me.push(-1);const et={count:0};let Be=0,X=j.getOrCreateLatestSegment(H,Y),me=X.vertexLength;for(let Ve=0;Ve<ae.length;Ve++){const xt=ae[Ve];for(let qt=1;qt<ae[Ve].length;qt+=2){const St=xt[qt-1],Ct=xt[qt];let Wt=Me[St]<Be,Gt=Me[Ct]<Be;X.vertexLength+((Wt?1:0)+(Gt?1:0))>_r.MAX_VERTEX_ARRAY_LENGTH&&(X=j.createNewSegment(H,Y),Be=et.count,Wt=!0,Gt=!0,me=0);const Jt=Vu(Me,ee,ye,et,St,Wt,X),Nt=Vu(Me,ee,ye,et,Ct,Gt,X);Y.emplaceBack(me+Jt-Be,me+Nt-Be),X.primitiveLength++}}}(b,n,S,d,C,i),t.forceNewSegmentOnNextPrepare(),b==null||b.forceNewSegmentOnNextPrepare()}function Vu(i,t,n,o,d,_,b){if(_){const S=o.count;return n(t[2*d],t[2*d+1]),i[d]=o.count,o.count++,b.vertexLength++,S}return i[d]}class Pd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ze,this.indexArray=new tr,this.indexArray2=new Kt,this.programConfigurations=new Hl(t.layers,t.zoom),this.segments=new _r,this.segments2=new _r,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=vd("fill",this.layers,n);const d=this.layers[0].layout.get("fill-sort-key"),_=!d.isConstant(),b=[];for(const{feature:S,id:C,index:z,sourceLayerIndex:R}of t){const j=this.layers[0]._featureFilter.needGeometry,H=ca(S,j);if(!this.layers[0]._featureFilter.filter(new ct(this.zoom),H,o))continue;const Y=_?d.evaluate(H,{},o,n.availableImages):void 0,ee={id:C,properties:S.properties,type:S.type,sourceLayerIndex:R,index:z,geometry:j?H.geometry:Xl(S),patterns:{},sortKey:Y};b.push(ee)}_&&b.sort((S,C)=>S.sortKey-C.sortKey);for(const S of b){const{geometry:C,index:z,sourceLayerIndex:R}=S;if(this.hasPattern){const j=bd("fill",this.layers,S,this.zoom,n);this.patternFeatures.push(j)}else this.addFeature(S,C,z,o,{},n.subdivisionGranularity);n.featureIndex.insert(t[z].feature,C,z,R,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,n,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Uy),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,o,d,_,b){for(const S of Ps(n,500)){const C=kf(S,d,b.fill.getGranularityForZoomLevel(d.z)),z=this.layoutVertexArray;zf((R,j)=>{z.emplaceBack(R,j)},this.segments,this.layoutVertexArray,this.indexArray,C.verticesFlattened,C.indicesTriangles,this.segments2,this.indexArray2,C.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,_,d)}}let Df,Ff;hr("FillBucket",Pd,{omit:["layers","patternFeatures"]});var t0={get paint(){return Ff=Ff||new $r({"fill-antialias":new Ft(x.paint_fill["fill-antialias"]),"fill-opacity":new zt(x.paint_fill["fill-opacity"]),"fill-color":new zt(x.paint_fill["fill-color"]),"fill-outline-color":new zt(x.paint_fill["fill-outline-color"]),"fill-translate":new Ft(x.paint_fill["fill-translate"]),"fill-translate-anchor":new Ft(x.paint_fill["fill-translate-anchor"]),"fill-pattern":new kr(x.paint_fill["fill-pattern"])})},get layout(){return Df=Df||new $r({"fill-sort-key":new zt(x.layout_fill["fill-sort-key"])})}};class r0 extends qr{constructor(t){super(t,t0)}recalculate(t,n){super.recalculate(t,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Pd(t)}queryRadius(){return bh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:n,transform:o,pixelsToTileUnits:d}){return tu(xh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,d),n)}isTileClipped(){return!0}}const i0=Hr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),n0=Hr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:s0}=i0;var Sd,Nf,Ad,Rf,Td,Bf,Of,Ah={};function jf(){if(Nf)return Sd;Nf=1;var i=U();function t(d,_,b,S,C){this.properties={},this.extent=b,this.type=0,this._pbf=d,this._geometry=-1,this._keys=S,this._values=C,d.readFields(n,this,_)}function n(d,_,b){d==1?_.id=b.readVarint():d==2?function(S,C){for(var z=S.readVarint()+S.pos;S.pos<z;){var R=C._keys[S.readVarint()],j=C._values[S.readVarint()];C.properties[R]=j}}(b,_):d==3?_.type=b.readVarint():d==4&&(_._geometry=b.pos)}function o(d){for(var _,b,S=0,C=0,z=d.length,R=z-1;C<z;R=C++)S+=((b=d[R]).x-(_=d[C]).x)*(_.y+b.y);return S}return Sd=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var d=this._pbf;d.pos=this._geometry;for(var _,b=d.readVarint()+d.pos,S=1,C=0,z=0,R=0,j=[];d.pos<b;){if(C<=0){var H=d.readVarint();S=7&H,C=H>>3}if(C--,S===1||S===2)z+=d.readSVarint(),R+=d.readSVarint(),S===1&&(_&&j.push(_),_=[]),_.push(new i(z,R));else{if(S!==7)throw new Error("unknown command "+S);_&&_.push(_[0].clone())}}return _&&j.push(_),j},t.prototype.bbox=function(){var d=this._pbf;d.pos=this._geometry;for(var _=d.readVarint()+d.pos,b=1,S=0,C=0,z=0,R=1/0,j=-1/0,H=1/0,Y=-1/0;d.pos<_;){if(S<=0){var ee=d.readVarint();b=7&ee,S=ee>>3}if(S--,b===1||b===2)(C+=d.readSVarint())<R&&(R=C),C>j&&(j=C),(z+=d.readSVarint())<H&&(H=z),z>Y&&(Y=z);else if(b!==7)throw new Error("unknown command "+b)}return[R,H,j,Y]},t.prototype.toGeoJSON=function(d,_,b){var S,C,z=this.extent*Math.pow(2,b),R=this.extent*d,j=this.extent*_,H=this.loadGeometry(),Y=t.types[this.type];function ee(Me){for(var et=0;et<Me.length;et++){var Be=Me[et];Me[et]=[360*(Be.x+R)/z-180,360/Math.PI*Math.atan(Math.exp((180-360*(Be.y+j)/z)*Math.PI/180))-90]}}switch(this.type){case 1:var ae=[];for(S=0;S<H.length;S++)ae[S]=H[S][0];ee(H=ae);break;case 2:for(S=0;S<H.length;S++)ee(H[S]);break;case 3:for(H=function(Me){var et=Me.length;if(et<=1)return[Me];for(var Be,X,me=[],Ve=0;Ve<et;Ve++){var xt=o(Me[Ve]);xt!==0&&(X===void 0&&(X=xt<0),X===xt<0?(Be&&me.push(Be),Be=[Me[Ve]]):Be.push(Me[Ve]))}return Be&&me.push(Be),me}(H),S=0;S<H.length;S++)for(C=0;C<H[S].length;C++)ee(H[S][C])}H.length===1?H=H[0]:Y="Multi"+Y;var ye={type:"Feature",geometry:{type:Y,coordinates:H},properties:this.properties};return"id"in this&&(ye.id=this.id),ye},Sd}function qf(){if(Rf)return Ad;Rf=1;var i=jf();function t(o,d){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(n,this,d),this.length=this._features.length}function n(o,d,_){o===15?d.version=_.readVarint():o===1?d.name=_.readString():o===5?d.extent=_.readVarint():o===2?d._features.push(_.pos):o===3?d._keys.push(_.readString()):o===4&&d._values.push(function(b){for(var S=null,C=b.readVarint()+b.pos;b.pos<C;){var z=b.readVarint()>>3;S=z===1?b.readString():z===2?b.readFloat():z===3?b.readDouble():z===4?b.readVarint64():z===5?b.readVarint():z===6?b.readSVarint():z===7?b.readBoolean():null}return S}(_))}return Ad=t,t.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var d=this._pbf.readVarint()+this._pbf.pos;return new i(this._pbf,d,this.extent,this._keys,this._values)},Ad}function Vf(){return Of||(Of=1,Ah.VectorTile=function(){if(Bf)return Td;Bf=1;var i=qf();function t(n,o,d){if(n===3){var _=new i(d,d.readVarint()+d.pos);_.length&&(o[_.name]=_)}}return Td=function(n,o){this.layers=n.readFields(t,{},o)},Td}(),Ah.VectorTileFeature=jf(),Ah.VectorTileLayer=qf()),Ah}var Uu=M(Vf());const a0=Uu.VectorTileFeature.types,Id=Math.pow(2,13);function Zu(i,t,n,o,d,_,b,S){i.emplaceBack(t,n,2*Math.floor(o*Id)+b,d*Id*2,_*Id*2,Math.round(S))}class Cd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ge,this.centroidVertexArray=new Se,this.indexArray=new tr,this.programConfigurations=new Hl(t.layers,t.zoom),this.segments=new _r,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.features=[],this.hasPattern=vd("fill-extrusion",this.layers,n);for(const{feature:d,id:_,index:b,sourceLayerIndex:S}of t){const C=this.layers[0]._featureFilter.needGeometry,z=ca(d,C);if(!this.layers[0]._featureFilter.filter(new ct(this.zoom),z,o))continue;const R={id:_,sourceLayerIndex:S,index:b,geometry:C?z.geometry:Xl(d),properties:d.properties,type:d.type,patterns:{}};this.hasPattern?this.features.push(bd("fill-extrusion",this.layers,R,this.zoom,n)):this.addFeature(R,R.geometry,b,o,{},n.subdivisionGranularity),n.featureIndex.insert(d,R.geometry,b,S,this.index,!0)}}addFeatures(t,n,o){for(const d of this.features){const{geometry:_}=d;this.addFeature(d,_,d.index,n,o,t.subdivisionGranularity)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,s0),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,n0.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,o,d,_,b){for(const S of Ps(n,500)){const C={x:0,y:0,sampleCount:0},z=this.layoutVertexArray.length;this.processPolygon(C,d,t,S,b);const R=this.layoutVertexArray.length-z,j=Math.floor(C.x/C.sampleCount),H=Math.floor(C.y/C.sampleCount);for(let Y=0;Y<R;Y++)this.centroidVertexArray.emplaceBack(j,H)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,_,d)}processPolygon(t,n,o,d,_){if(d.length<1||Uf(d[0]))return;for(const j of d)j.length!==0&&o0(t,j);const b={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},S=_.fill.getGranularityForZoomLevel(n.z),C=a0[o.type]==="Polygon";for(const j of d){if(j.length===0||Uf(j))continue;const H=Rc(j,S,C);this._generateSideFaces(H,b)}if(!C)return;const z=kf(d,n,S,!1),R=this.layoutVertexArray;zf((j,H)=>{Zu(R,j,H,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,z.verticesFlattened,z.indicesTriangles)}_generateSideFaces(t,n){let o=0;for(let d=1;d<t.length;d++){const _=t[d],b=t[d-1];if(l0(_,b))continue;n.segment.vertexLength+4>_r.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const S=_.sub(b)._perp()._unit(),C=b.dist(_);o+C>32768&&(o=0),Zu(this.layoutVertexArray,_.x,_.y,S.x,S.y,0,0,o),Zu(this.layoutVertexArray,_.x,_.y,S.x,S.y,0,1,o),o+=C,Zu(this.layoutVertexArray,b.x,b.y,S.x,S.y,0,0,o),Zu(this.layoutVertexArray,b.x,b.y,S.x,S.y,0,1,o);const z=n.segment.vertexLength;this.indexArray.emplaceBack(z,z+2,z+1),this.indexArray.emplaceBack(z+1,z+2,z+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function o0(i,t){for(let n=0;n<t.length;n++){const o=t[n];n===t.length-1&&t[0].x===o.x&&t[0].y===o.y||(i.x+=o.x,i.y+=o.y,i.sampleCount++)}}function l0(i,t){return i.x===t.x&&(i.x<0||i.x>ut)||i.y===t.y&&(i.y<0||i.y>ut)}function Uf(i){return i.every(t=>t.x<0)||i.every(t=>t.x>ut)||i.every(t=>t.y<0)||i.every(t=>t.y>ut)}let Zf;hr("FillExtrusionBucket",Cd,{omit:["layers","features"]});var c0={get paint(){return Zf=Zf||new $r({"fill-extrusion-opacity":new Ft(x["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new zt(x["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ft(x["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ft(x["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new kr(x["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new zt(x["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new zt(x["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ft(x["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class u0 extends qr{constructor(t){super(t,c0)}createBucket(t){return new Cd(t)}queryRadius(){return bh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:d,transform:_,pixelsToTileUnits:b,pixelPosMatrix:S}){const C=xh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-_.bearingInRadians,b),z=this.paint.get("fill-extrusion-height").evaluate(n,o),R=this.paint.get("fill-extrusion-base").evaluate(n,o),j=function(Y,ee,ae){const ye=[];for(const Me of Y){const et=[Me.x,Me.y,0,1];ve(et,et,ee),ye.push(new de(et[0]/et[3],et[1]/et[3]))}return ye}(C,S),H=function(Y,ee,ae,ye){const Me=[],et=[],Be=ye[8]*ee,X=ye[9]*ee,me=ye[10]*ee,Ve=ye[11]*ee,xt=ye[8]*ae,qt=ye[9]*ae,St=ye[10]*ae,Ct=ye[11]*ae;for(const Wt of Y){const Gt=[],Jt=[];for(const Nt of Wt){const fr=Nt.x,Cr=Nt.y,Tr=ye[0]*fr+ye[4]*Cr+ye[12],vr=ye[1]*fr+ye[5]*Cr+ye[13],si=ye[2]*fr+ye[6]*Cr+ye[14],an=ye[3]*fr+ye[7]*Cr+ye[15],Nn=si+me,_s=an+Ve,Xa=Tr+xt,ha=vr+qt,ns=si+St,Qi=an+Ct,$n=new de((Tr+Be)/_s,(vr+X)/_s);$n.z=Nn/_s,Gt.push($n);const ss=new de(Xa/Qi,ha/Qi);ss.z=ns/Qi,Jt.push(ss)}Me.push(Gt),et.push(Jt)}return[Me,et]}(d,R,z,S);return function(Y,ee,ae){let ye=1/0;tu(ae,ee)&&(ye=Gf(ae,ee[0]));for(let Me=0;Me<ee.length;Me++){const et=ee[Me],Be=Y[Me];for(let X=0;X<et.length-1;X++){const me=et[X],Ve=[me,et[X+1],Be[X+1],Be[X],me];eu(ae,Ve)&&(ye=Math.min(ye,Gf(ae,Ve)))}}return ye!==1/0&&ye}(H[0],H[1],j)}}function Gu(i,t){return i.x*t.x+i.y*t.y}function Gf(i,t){if(i.length===1){let n=0;const o=t[n++];let d;for(;!d||o.equals(d);)if(d=t[n++],!d)return 1/0;for(;n<t.length;n++){const _=t[n],b=i[0],S=d.sub(o),C=_.sub(o),z=b.sub(o),R=Gu(S,S),j=Gu(S,C),H=Gu(C,C),Y=Gu(z,S),ee=Gu(z,C),ae=R*H-j*j,ye=(H*Y-j*ee)/ae,Me=(R*ee-j*Y)/ae,et=o.z*(1-ye-Me)+d.z*ye+_.z*Me;if(isFinite(et))return et}return 1/0}{let n=1/0;for(const o of t)n=Math.min(n,o.z);return n}}const h0=Hr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:d0}=h0,p0=Hr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:f0}=p0,m0=Uu.VectorTileFeature.types,g0=Math.cos(Math.PI/180*37.5),$f=Math.pow(2,14)/.5;class Md{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Xe,this.layoutVertexArray2=new Je,this.indexArray=new tr,this.programConfigurations=new Hl(t.layers,t.zoom),this.segments=new _r,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=vd("line",this.layers,n);const d=this.layers[0].layout.get("line-sort-key"),_=!d.isConstant(),b=[];for(const{feature:S,id:C,index:z,sourceLayerIndex:R}of t){const j=this.layers[0]._featureFilter.needGeometry,H=ca(S,j);if(!this.layers[0]._featureFilter.filter(new ct(this.zoom),H,o))continue;const Y=_?d.evaluate(H,{},o):void 0,ee={id:C,properties:S.properties,type:S.type,sourceLayerIndex:R,index:z,geometry:j?H.geometry:Xl(S),patterns:{},sortKey:Y};b.push(ee)}_&&b.sort((S,C)=>S.sortKey-C.sortKey);for(const S of b){const{geometry:C,index:z,sourceLayerIndex:R}=S;if(this.hasPattern){const j=bd("line",this.layers,S,this.zoom,n);this.patternFeatures.push(j)}else this.addFeature(S,C,z,o,{},n.subdivisionGranularity);n.featureIndex.insert(t[z].feature,C,z,R,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,n,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,f0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,d0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,o,d,_,b){const S=this.layers[0].layout,C=S.get("line-join").evaluate(t,{}),z=S.get("line-cap"),R=S.get("line-miter-limit"),j=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const H of n)this.addLine(H,t,C,z,R,j,d,b);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,_,d)}addLine(t,n,o,d,_,b,S,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Rc(t,S?C.line.getGranularityForZoomLevel(S.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Be=0;Be<t.length-1;Be++)this.totalDistance+=t[Be].dist(t[Be+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const z=m0[n.type]==="Polygon";let R=t.length;for(;R>=2&&t[R-1].equals(t[R-2]);)R--;let j=0;for(;j<R-1&&t[j].equals(t[j+1]);)j++;if(R<(z?3:2))return;o==="bevel"&&(_=1.05);const H=this.overscaling<=16?15*ut/(512*this.overscaling):0,Y=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let ee,ae,ye,Me,et;this.e1=this.e2=-1,z&&(ee=t[R-2],et=t[j].sub(ee)._unit()._perp());for(let Be=j;Be<R;Be++){if(ye=Be===R-1?z?t[j+1]:void 0:t[Be+1],ye&&t[Be].equals(ye))continue;et&&(Me=et),ee&&(ae=ee),ee=t[Be],et=ye?ye.sub(ee)._unit()._perp():Me,Me=Me||et;let X=Me.add(et);X.x===0&&X.y===0||X._unit();const me=Me.x*et.x+Me.y*et.y,Ve=X.x*et.x+X.y*et.y,xt=Ve!==0?1/Ve:1/0,qt=2*Math.sqrt(2-2*Ve),St=Ve<g0&&ae&&ye,Ct=Me.x*et.y-Me.y*et.x>0;if(St&&Be>j){const Jt=ee.dist(ae);if(Jt>2*H){const Nt=ee.sub(ee.sub(ae)._mult(H/Jt)._round());this.updateDistance(ae,Nt),this.addCurrentVertex(Nt,Me,0,0,Y),ae=Nt}}const Wt=ae&&ye;let Gt=Wt?o:z?"butt":d;if(Wt&&Gt==="round"&&(xt<b?Gt="miter":xt<=2&&(Gt="fakeround")),Gt==="miter"&&xt>_&&(Gt="bevel"),Gt==="bevel"&&(xt>2&&(Gt="flipbevel"),xt<_&&(Gt="miter")),ae&&this.updateDistance(ae,ee),Gt==="miter")X._mult(xt),this.addCurrentVertex(ee,X,0,0,Y);else if(Gt==="flipbevel"){if(xt>100)X=et.mult(-1);else{const Jt=xt*Me.add(et).mag()/Me.sub(et).mag();X._perp()._mult(Jt*(Ct?-1:1))}this.addCurrentVertex(ee,X,0,0,Y),this.addCurrentVertex(ee,X.mult(-1),0,0,Y)}else if(Gt==="bevel"||Gt==="fakeround"){const Jt=-Math.sqrt(xt*xt-1),Nt=Ct?Jt:0,fr=Ct?0:Jt;if(ae&&this.addCurrentVertex(ee,Me,Nt,fr,Y),Gt==="fakeround"){const Cr=Math.round(180*qt/Math.PI/20);for(let Tr=1;Tr<Cr;Tr++){let vr=Tr/Cr;if(vr!==.5){const an=vr-.5;vr+=vr*an*(vr-1)*((1.0904+me*(me*(3.55645-1.43519*me)-3.2452))*an*an+(.848013+me*(.215638*me-1.06021)))}const si=et.sub(Me)._mult(vr)._add(Me)._unit()._mult(Ct?-1:1);this.addHalfVertex(ee,si.x,si.y,!1,Ct,0,Y)}}ye&&this.addCurrentVertex(ee,et,-Nt,-fr,Y)}else if(Gt==="butt")this.addCurrentVertex(ee,X,0,0,Y);else if(Gt==="square"){const Jt=ae?1:-1;this.addCurrentVertex(ee,X,Jt,Jt,Y)}else Gt==="round"&&(ae&&(this.addCurrentVertex(ee,Me,0,0,Y),this.addCurrentVertex(ee,Me,1,1,Y,!0)),ye&&(this.addCurrentVertex(ee,et,-1,-1,Y,!0),this.addCurrentVertex(ee,et,0,0,Y)));if(St&&Be<R-1){const Jt=ee.dist(ye);if(Jt>2*H){const Nt=ee.add(ye.sub(ee)._mult(H/Jt)._round());this.updateDistance(ee,Nt),this.addCurrentVertex(Nt,et,0,0,Y),ee=Nt}}}}addCurrentVertex(t,n,o,d,_,b=!1){const S=n.y*d-n.x,C=-n.y-n.x*d;this.addHalfVertex(t,n.x+n.y*o,n.y-n.x*o,b,!1,o,_),this.addHalfVertex(t,S,C,b,!0,-d,_),this.distance>$f/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,o,d,_,b))}addHalfVertex({x:t,y:n},o,d,_,b,S,C){const z=.5*(this.lineClips?this.scaledDistance*($f-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(_?1:0),(n<<1)+(b?1:0),Math.round(63*o)+128,Math.round(63*d)+128,1+(S===0?0:S<0?-1:1)|(63&z)<<2,z>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const R=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,R,this.e2),C.primitiveLength++),b?this.e2=R:this.e1=R}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let Wf,Hf;hr("LineBucket",Md,{omit:["layers","patternFeatures"]});var Xf={get paint(){return Hf=Hf||new $r({"line-opacity":new zt(x.paint_line["line-opacity"]),"line-color":new zt(x.paint_line["line-color"]),"line-translate":new Ft(x.paint_line["line-translate"]),"line-translate-anchor":new Ft(x.paint_line["line-translate-anchor"]),"line-width":new zt(x.paint_line["line-width"]),"line-gap-width":new zt(x.paint_line["line-gap-width"]),"line-offset":new zt(x.paint_line["line-offset"]),"line-blur":new zt(x.paint_line["line-blur"]),"line-dasharray":new cr(x.paint_line["line-dasharray"]),"line-pattern":new kr(x.paint_line["line-pattern"]),"line-gradient":new ui(x.paint_line["line-gradient"])})},get layout(){return Wf=Wf||new $r({"line-cap":new Ft(x.layout_line["line-cap"]),"line-join":new zt(x.layout_line["line-join"]),"line-miter-limit":new Ft(x.layout_line["line-miter-limit"]),"line-round-limit":new Ft(x.layout_line["line-round-limit"]),"line-sort-key":new zt(x.layout_line["line-sort-key"])})}};class _0 extends zt{possiblyEvaluate(t,n){return n=new ct(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,o,d){return n=We({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,o,d)}}let Th;class y0 extends qr{constructor(t){super(t,Xf),this.gradientVersion=0,Th||(Th=new _0(Xf.paint.properties["line-width"].specification),Th.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof ea,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=Th.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Md(t)}queryRadius(t){const n=t,o=Yf(Fu("line-width",this,n),Fu("line-gap-width",this,n)),d=Fu("line-offset",this,n);return o/2+Math.abs(d)+bh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:d,transform:_,pixelsToTileUnits:b}){const S=xh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-_.bearingInRadians,b),C=b/2*Yf(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),z=this.paint.get("line-offset").evaluate(n,o);return z&&(d=function(R,j){const H=[];for(let Y=0;Y<R.length;Y++){const ee=R[Y],ae=[];for(let ye=0;ye<ee.length;ye++){const Me=ee[ye-1],et=ee[ye],Be=ee[ye+1],X=ye===0?new de(0,0):et.sub(Me)._unit()._perp(),me=ye===ee.length-1?new de(0,0):Be.sub(et)._unit()._perp(),Ve=X._add(me)._unit(),xt=Ve.x*me.x+Ve.y*me.y;xt!==0&&Ve._mult(1/xt),ae.push(Ve._mult(j)._add(et))}H.push(ae)}return H}(d,z*b)),function(R,j,H){for(let Y=0;Y<j.length;Y++){const ee=j[Y];if(R.length>=3){for(let ae=0;ae<ee.length;ae++)if(ru(R,ee[ae]))return!0}if(zy(R,ee,H))return!0}return!1}(S,d,C)}isTileClipped(){return!0}}function Yf(i,t){return t>0?t+2*i:i}const v0=Hr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),b0=Hr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Hr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const x0=Hr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Hr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Kf=Hr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),w0=Hr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function P0(i,t,n){return i.sections.forEach(o=>{o.text=function(d,_,b){const S=_.layout.get("text-transform").evaluate(b,{});return S==="uppercase"?d=d.toLocaleUpperCase():S==="lowercase"&&(d=d.toLocaleLowerCase()),_t.applyArabicShaping&&(d=_t.applyArabicShaping(d)),d}(o.text,t,n)}),i}Hr([{name:"triangle",components:3,type:"Uint16"}]),Hr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Hr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Hr([{type:"Float32",name:"offsetX"}]),Hr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Hr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const $u={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Jf,Ld,Qf,Fn=24,Ed={};function S0(){return Jf||(Jf=1,Ed.read=function(i,t,n,o,d){var _,b,S=8*d-o-1,C=(1<<S)-1,z=C>>1,R=-7,j=n?d-1:0,H=n?-1:1,Y=i[t+j];for(j+=H,_=Y&(1<<-R)-1,Y>>=-R,R+=S;R>0;_=256*_+i[t+j],j+=H,R-=8);for(b=_&(1<<-R)-1,_>>=-R,R+=o;R>0;b=256*b+i[t+j],j+=H,R-=8);if(_===0)_=1-z;else{if(_===C)return b?NaN:1/0*(Y?-1:1);b+=Math.pow(2,o),_-=z}return(Y?-1:1)*b*Math.pow(2,_-o)},Ed.write=function(i,t,n,o,d,_){var b,S,C,z=8*_-d-1,R=(1<<z)-1,j=R>>1,H=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,Y=o?0:_-1,ee=o?1:-1,ae=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(S=isNaN(t)?1:0,b=R):(b=Math.floor(Math.log(t)/Math.LN2),t*(C=Math.pow(2,-b))<1&&(b--,C*=2),(t+=b+j>=1?H/C:H*Math.pow(2,1-j))*C>=2&&(b++,C/=2),b+j>=R?(S=0,b=R):b+j>=1?(S=(t*C-1)*Math.pow(2,d),b+=j):(S=t*Math.pow(2,j-1)*Math.pow(2,d),b=0));d>=8;i[n+Y]=255&S,Y+=ee,S/=256,d-=8);for(b=b<<d|S,z+=d;z>0;i[n+Y]=255&b,Y+=ee,b/=256,z-=8);i[n+Y-ee]|=128*ae}),Ed}function em(){if(Qf)return Ld;Qf=1,Ld=t;var i=S0();function t(X){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(X)?X:new Uint8Array(X||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var n=4294967296,o=1/n,d=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function _(X){return X.type===t.Bytes?X.readVarint()+X.pos:X.pos+1}function b(X,me,Ve){return Ve?4294967296*me+(X>>>0):4294967296*(me>>>0)+(X>>>0)}function S(X,me,Ve){var xt=me<=16383?1:me<=2097151?2:me<=268435455?3:Math.floor(Math.log(me)/(7*Math.LN2));Ve.realloc(xt);for(var qt=Ve.pos-1;qt>=X;qt--)Ve.buf[qt+xt]=Ve.buf[qt]}function C(X,me){for(var Ve=0;Ve<X.length;Ve++)me.writeVarint(X[Ve])}function z(X,me){for(var Ve=0;Ve<X.length;Ve++)me.writeSVarint(X[Ve])}function R(X,me){for(var Ve=0;Ve<X.length;Ve++)me.writeFloat(X[Ve])}function j(X,me){for(var Ve=0;Ve<X.length;Ve++)me.writeDouble(X[Ve])}function H(X,me){for(var Ve=0;Ve<X.length;Ve++)me.writeBoolean(X[Ve])}function Y(X,me){for(var Ve=0;Ve<X.length;Ve++)me.writeFixed32(X[Ve])}function ee(X,me){for(var Ve=0;Ve<X.length;Ve++)me.writeSFixed32(X[Ve])}function ae(X,me){for(var Ve=0;Ve<X.length;Ve++)me.writeFixed64(X[Ve])}function ye(X,me){for(var Ve=0;Ve<X.length;Ve++)me.writeSFixed64(X[Ve])}function Me(X,me){return(X[me]|X[me+1]<<8|X[me+2]<<16)+16777216*X[me+3]}function et(X,me,Ve){X[Ve]=me,X[Ve+1]=me>>>8,X[Ve+2]=me>>>16,X[Ve+3]=me>>>24}function Be(X,me){return(X[me]|X[me+1]<<8|X[me+2]<<16)+(X[me+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(X,me,Ve){for(Ve=Ve||this.length;this.pos<Ve;){var xt=this.readVarint(),qt=xt>>3,St=this.pos;this.type=7&xt,X(qt,me,this),this.pos===St&&this.skip(xt)}return me},readMessage:function(X,me){return this.readFields(X,me,this.readVarint()+this.pos)},readFixed32:function(){var X=Me(this.buf,this.pos);return this.pos+=4,X},readSFixed32:function(){var X=Be(this.buf,this.pos);return this.pos+=4,X},readFixed64:function(){var X=Me(this.buf,this.pos)+Me(this.buf,this.pos+4)*n;return this.pos+=8,X},readSFixed64:function(){var X=Me(this.buf,this.pos)+Be(this.buf,this.pos+4)*n;return this.pos+=8,X},readFloat:function(){var X=i.read(this.buf,this.pos,!0,23,4);return this.pos+=4,X},readDouble:function(){var X=i.read(this.buf,this.pos,!0,52,8);return this.pos+=8,X},readVarint:function(X){var me,Ve,xt=this.buf;return me=127&(Ve=xt[this.pos++]),Ve<128?me:(me|=(127&(Ve=xt[this.pos++]))<<7,Ve<128?me:(me|=(127&(Ve=xt[this.pos++]))<<14,Ve<128?me:(me|=(127&(Ve=xt[this.pos++]))<<21,Ve<128?me:function(qt,St,Ct){var Wt,Gt,Jt=Ct.buf;if(Wt=(112&(Gt=Jt[Ct.pos++]))>>4,Gt<128||(Wt|=(127&(Gt=Jt[Ct.pos++]))<<3,Gt<128)||(Wt|=(127&(Gt=Jt[Ct.pos++]))<<10,Gt<128)||(Wt|=(127&(Gt=Jt[Ct.pos++]))<<17,Gt<128)||(Wt|=(127&(Gt=Jt[Ct.pos++]))<<24,Gt<128)||(Wt|=(1&(Gt=Jt[Ct.pos++]))<<31,Gt<128))return b(qt,Wt,St);throw new Error("Expected varint not more than 10 bytes")}(me|=(15&(Ve=xt[this.pos]))<<28,X,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var X=this.readVarint();return X%2==1?(X+1)/-2:X/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var X=this.readVarint()+this.pos,me=this.pos;return this.pos=X,X-me>=12&&d?function(Ve,xt,qt){return d.decode(Ve.subarray(xt,qt))}(this.buf,me,X):function(Ve,xt,qt){for(var St="",Ct=xt;Ct<qt;){var Wt,Gt,Jt,Nt=Ve[Ct],fr=null,Cr=Nt>239?4:Nt>223?3:Nt>191?2:1;if(Ct+Cr>qt)break;Cr===1?Nt<128&&(fr=Nt):Cr===2?(192&(Wt=Ve[Ct+1]))==128&&(fr=(31&Nt)<<6|63&Wt)<=127&&(fr=null):Cr===3?(Gt=Ve[Ct+2],(192&(Wt=Ve[Ct+1]))==128&&(192&Gt)==128&&((fr=(15&Nt)<<12|(63&Wt)<<6|63&Gt)<=2047||fr>=55296&&fr<=57343)&&(fr=null)):Cr===4&&(Gt=Ve[Ct+2],Jt=Ve[Ct+3],(192&(Wt=Ve[Ct+1]))==128&&(192&Gt)==128&&(192&Jt)==128&&((fr=(15&Nt)<<18|(63&Wt)<<12|(63&Gt)<<6|63&Jt)<=65535||fr>=1114112)&&(fr=null)),fr===null?(fr=65533,Cr=1):fr>65535&&(fr-=65536,St+=String.fromCharCode(fr>>>10&1023|55296),fr=56320|1023&fr),St+=String.fromCharCode(fr),Ct+=Cr}return St}(this.buf,me,X)},readBytes:function(){var X=this.readVarint()+this.pos,me=this.buf.subarray(this.pos,X);return this.pos=X,me},readPackedVarint:function(X,me){if(this.type!==t.Bytes)return X.push(this.readVarint(me));var Ve=_(this);for(X=X||[];this.pos<Ve;)X.push(this.readVarint(me));return X},readPackedSVarint:function(X){if(this.type!==t.Bytes)return X.push(this.readSVarint());var me=_(this);for(X=X||[];this.pos<me;)X.push(this.readSVarint());return X},readPackedBoolean:function(X){if(this.type!==t.Bytes)return X.push(this.readBoolean());var me=_(this);for(X=X||[];this.pos<me;)X.push(this.readBoolean());return X},readPackedFloat:function(X){if(this.type!==t.Bytes)return X.push(this.readFloat());var me=_(this);for(X=X||[];this.pos<me;)X.push(this.readFloat());return X},readPackedDouble:function(X){if(this.type!==t.Bytes)return X.push(this.readDouble());var me=_(this);for(X=X||[];this.pos<me;)X.push(this.readDouble());return X},readPackedFixed32:function(X){if(this.type!==t.Bytes)return X.push(this.readFixed32());var me=_(this);for(X=X||[];this.pos<me;)X.push(this.readFixed32());return X},readPackedSFixed32:function(X){if(this.type!==t.Bytes)return X.push(this.readSFixed32());var me=_(this);for(X=X||[];this.pos<me;)X.push(this.readSFixed32());return X},readPackedFixed64:function(X){if(this.type!==t.Bytes)return X.push(this.readFixed64());var me=_(this);for(X=X||[];this.pos<me;)X.push(this.readFixed64());return X},readPackedSFixed64:function(X){if(this.type!==t.Bytes)return X.push(this.readSFixed64());var me=_(this);for(X=X||[];this.pos<me;)X.push(this.readSFixed64());return X},skip:function(X){var me=7&X;if(me===t.Varint)for(;this.buf[this.pos++]>127;);else if(me===t.Bytes)this.pos=this.readVarint()+this.pos;else if(me===t.Fixed32)this.pos+=4;else{if(me!==t.Fixed64)throw new Error("Unimplemented type: "+me);this.pos+=8}},writeTag:function(X,me){this.writeVarint(X<<3|me)},realloc:function(X){for(var me=this.length||16;me<this.pos+X;)me*=2;if(me!==this.length){var Ve=new Uint8Array(me);Ve.set(this.buf),this.buf=Ve,this.length=me}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(X){this.realloc(4),et(this.buf,X,this.pos),this.pos+=4},writeSFixed32:function(X){this.realloc(4),et(this.buf,X,this.pos),this.pos+=4},writeFixed64:function(X){this.realloc(8),et(this.buf,-1&X,this.pos),et(this.buf,Math.floor(X*o),this.pos+4),this.pos+=8},writeSFixed64:function(X){this.realloc(8),et(this.buf,-1&X,this.pos),et(this.buf,Math.floor(X*o),this.pos+4),this.pos+=8},writeVarint:function(X){(X=+X||0)>268435455||X<0?function(me,Ve){var xt,qt;if(me>=0?(xt=me%4294967296|0,qt=me/4294967296|0):(qt=~(-me/4294967296),4294967295^(xt=~(-me%4294967296))?xt=xt+1|0:(xt=0,qt=qt+1|0)),me>=18446744073709552e3||me<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Ve.realloc(10),function(St,Ct,Wt){Wt.buf[Wt.pos++]=127&St|128,St>>>=7,Wt.buf[Wt.pos++]=127&St|128,St>>>=7,Wt.buf[Wt.pos++]=127&St|128,St>>>=7,Wt.buf[Wt.pos++]=127&St|128,Wt.buf[Wt.pos]=127&(St>>>=7)}(xt,0,Ve),function(St,Ct){var Wt=(7&St)<<4;Ct.buf[Ct.pos++]|=Wt|((St>>>=3)?128:0),St&&(Ct.buf[Ct.pos++]=127&St|((St>>>=7)?128:0),St&&(Ct.buf[Ct.pos++]=127&St|((St>>>=7)?128:0),St&&(Ct.buf[Ct.pos++]=127&St|((St>>>=7)?128:0),St&&(Ct.buf[Ct.pos++]=127&St|((St>>>=7)?128:0),St&&(Ct.buf[Ct.pos++]=127&St)))))}(qt,Ve)}(X,this):(this.realloc(4),this.buf[this.pos++]=127&X|(X>127?128:0),X<=127||(this.buf[this.pos++]=127&(X>>>=7)|(X>127?128:0),X<=127||(this.buf[this.pos++]=127&(X>>>=7)|(X>127?128:0),X<=127||(this.buf[this.pos++]=X>>>7&127))))},writeSVarint:function(X){this.writeVarint(X<0?2*-X-1:2*X)},writeBoolean:function(X){this.writeVarint(!!X)},writeString:function(X){X=String(X),this.realloc(4*X.length),this.pos++;var me=this.pos;this.pos=function(xt,qt,St){for(var Ct,Wt,Gt=0;Gt<qt.length;Gt++){if((Ct=qt.charCodeAt(Gt))>55295&&Ct<57344){if(!Wt){Ct>56319||Gt+1===qt.length?(xt[St++]=239,xt[St++]=191,xt[St++]=189):Wt=Ct;continue}if(Ct<56320){xt[St++]=239,xt[St++]=191,xt[St++]=189,Wt=Ct;continue}Ct=Wt-55296<<10|Ct-56320|65536,Wt=null}else Wt&&(xt[St++]=239,xt[St++]=191,xt[St++]=189,Wt=null);Ct<128?xt[St++]=Ct:(Ct<2048?xt[St++]=Ct>>6|192:(Ct<65536?xt[St++]=Ct>>12|224:(xt[St++]=Ct>>18|240,xt[St++]=Ct>>12&63|128),xt[St++]=Ct>>6&63|128),xt[St++]=63&Ct|128)}return St}(this.buf,X,this.pos);var Ve=this.pos-me;Ve>=128&&S(me,Ve,this),this.pos=me-1,this.writeVarint(Ve),this.pos+=Ve},writeFloat:function(X){this.realloc(4),i.write(this.buf,X,this.pos,!0,23,4),this.pos+=4},writeDouble:function(X){this.realloc(8),i.write(this.buf,X,this.pos,!0,52,8),this.pos+=8},writeBytes:function(X){var me=X.length;this.writeVarint(me),this.realloc(me);for(var Ve=0;Ve<me;Ve++)this.buf[this.pos++]=X[Ve]},writeRawMessage:function(X,me){this.pos++;var Ve=this.pos;X(me,this);var xt=this.pos-Ve;xt>=128&&S(Ve,xt,this),this.pos=Ve-1,this.writeVarint(xt),this.pos+=xt},writeMessage:function(X,me,Ve){this.writeTag(X,t.Bytes),this.writeRawMessage(me,Ve)},writePackedVarint:function(X,me){me.length&&this.writeMessage(X,C,me)},writePackedSVarint:function(X,me){me.length&&this.writeMessage(X,z,me)},writePackedBoolean:function(X,me){me.length&&this.writeMessage(X,H,me)},writePackedFloat:function(X,me){me.length&&this.writeMessage(X,R,me)},writePackedDouble:function(X,me){me.length&&this.writeMessage(X,j,me)},writePackedFixed32:function(X,me){me.length&&this.writeMessage(X,Y,me)},writePackedSFixed32:function(X,me){me.length&&this.writeMessage(X,ee,me)},writePackedFixed64:function(X,me){me.length&&this.writeMessage(X,ae,me)},writePackedSFixed64:function(X,me){me.length&&this.writeMessage(X,ye,me)},writeBytesField:function(X,me){this.writeTag(X,t.Bytes),this.writeBytes(me)},writeFixed32Field:function(X,me){this.writeTag(X,t.Fixed32),this.writeFixed32(me)},writeSFixed32Field:function(X,me){this.writeTag(X,t.Fixed32),this.writeSFixed32(me)},writeFixed64Field:function(X,me){this.writeTag(X,t.Fixed64),this.writeFixed64(me)},writeSFixed64Field:function(X,me){this.writeTag(X,t.Fixed64),this.writeSFixed64(me)},writeVarintField:function(X,me){this.writeTag(X,t.Varint),this.writeVarint(me)},writeSVarintField:function(X,me){this.writeTag(X,t.Varint),this.writeSVarint(me)},writeStringField:function(X,me){this.writeTag(X,t.Bytes),this.writeString(me)},writeFloatField:function(X,me){this.writeTag(X,t.Fixed32),this.writeFloat(me)},writeDoubleField:function(X,me){this.writeTag(X,t.Fixed64),this.writeDouble(me)},writeBooleanField:function(X,me){this.writeVarintField(X,!!me)}},Ld}var kd=M(em());const zd=3;function A0(i,t,n){i===1&&n.readMessage(T0,t)}function T0(i,t,n){if(i===3){const{id:o,bitmap:d,width:_,height:b,left:S,top:C,advance:z}=n.readMessage(I0,{});t.push({id:o,bitmap:new Nu({width:_+2*zd,height:b+2*zd},d),metrics:{width:_,height:b,left:S,top:C,advance:z}})}}function I0(i,t,n){i===1?t.id=n.readVarint():i===2?t.bitmap=n.readBytes():i===3?t.width=n.readVarint():i===4?t.height=n.readVarint():i===5?t.left=n.readSVarint():i===6?t.top=n.readSVarint():i===7&&(t.advance=n.readVarint())}const C0=zd;function tm(i){let t=0,n=0;for(const b of i)t+=b.w*b.h,n=Math.max(n,b.w);i.sort((b,S)=>S.h-b.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let d=0,_=0;for(const b of i)for(let S=o.length-1;S>=0;S--){const C=o[S];if(!(b.w>C.w||b.h>C.h)){if(b.x=C.x,b.y=C.y,_=Math.max(_,b.y+b.h),d=Math.max(d,b.x+b.w),b.w===C.w&&b.h===C.h){const z=o.pop();S<o.length&&(o[S]=z)}else b.h===C.h?(C.x+=b.w,C.w-=b.w):b.w===C.w?(C.y+=b.h,C.h-=b.h):(o.push({x:C.x+b.w,y:C.y,w:C.w-b.w,h:b.h}),C.y+=b.h,C.h-=b.h);break}}return{w:d,h:_,fill:t/(d*_)||0}}const ua=1;class Dd{constructor(t,{pixelRatio:n,version:o,stretchX:d,stretchY:_,content:b,textFitWidth:S,textFitHeight:C}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=d,this.stretchY=_,this.content=b,this.version=o,this.textFitWidth=S,this.textFitHeight=C}get tl(){return[this.paddedRect.x+ua,this.paddedRect.y+ua]}get br(){return[this.paddedRect.x+this.paddedRect.w-ua,this.paddedRect.y+this.paddedRect.h-ua]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ua)/this.pixelRatio,(this.paddedRect.h-2*ua)/this.pixelRatio]}}class rm{constructor(t,n){const o={},d={};this.haveRenderCallbacks=[];const _=[];this.addImages(t,o,_),this.addImages(n,d,_);const{w:b,h:S}=tm(_),C=new Wa({width:b||1,height:S||1});for(const z in t){const R=t[z],j=o[z].paddedRect;Wa.copy(R.data,C,{x:0,y:0},{x:j.x+ua,y:j.y+ua},R.data)}for(const z in n){const R=n[z],j=d[z].paddedRect,H=j.x+ua,Y=j.y+ua,ee=R.data.width,ae=R.data.height;Wa.copy(R.data,C,{x:0,y:0},{x:H,y:Y},R.data),Wa.copy(R.data,C,{x:0,y:ae-1},{x:H,y:Y-1},{width:ee,height:1}),Wa.copy(R.data,C,{x:0,y:0},{x:H,y:Y+ae},{width:ee,height:1}),Wa.copy(R.data,C,{x:ee-1,y:0},{x:H-1,y:Y},{width:1,height:ae}),Wa.copy(R.data,C,{x:0,y:0},{x:H+ee,y:Y},{width:1,height:ae})}this.image=C,this.iconPositions=o,this.patternPositions=d}addImages(t,n,o){for(const d in t){const _=t[d],b={x:0,y:0,w:_.data.width+2*ua,h:_.data.height+2*ua};o.push(b),n[d]=new Dd(b,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),n)}patchUpdatedImage(t,n,o){if(!t||!n||t.version===n.version)return;t.version=n.version;const[d,_]=t.tl;o.update(n.data,void 0,{x:d,y:_})}}var hc;hr("ImagePosition",Dd),hr("ImageAtlas",rm),f.ag=void 0,(hc=f.ag||(f.ag={}))[hc.none=0]="none",hc[hc.horizontal=1]="horizontal",hc[hc.vertical=2]="vertical",hc[hc.horizontalOnly=3]="horizontalOnly";const Ih=-17;class Wu{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,n,o){const d=new Wu;return d.scale=t||1,d.fontStack=n,d.verticalAlign=o||"bottom",d}static forImage(t,n){const o=new Wu;return o.imageName=t,o.verticalAlign=n||"bottom",o}}class au{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const o=new au;for(let d=0;d<t.sections.length;d++){const _=t.sections[d];_.image?o.addImageSection(_):o.addTextSection(_,n)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let n="";for(let o=0;o<t.length;o++){const d=t.charCodeAt(o+1)||null,_=t.charCodeAt(o-1)||null;n+=d&&ce(d)&&!$u[t[o+1]]||_&&ce(_)&&!$u[t[o-1]]||!$u[t[o]]?t[o]:$u[t[o]]}return n}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&Mh[this.text.charCodeAt(o)];o++)t++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&Mh[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const o=new au;return o.text=this.text.substring(t,n),o.sectionIndex=this.sectionIndex.slice(t,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}getMaxImageSize(t){let n=0,o=0;for(let d=0;d<this.length();d++){const _=this.getSection(d);if(_.imageName){const b=t[_.imageName];if(!b)continue;const S=b.displaySize;n=Math.max(n,S[0]),o=Math.max(o,S[1])}}return{maxImageWidth:n,maxImageHeight:o}}addTextSection(t,n){this.text+=t.text,this.sections.push(Wu.forText(t.scale,t.fontStack||n,t.verticalAlign));const o=this.sections.length-1;for(let d=0;d<t.text.length;++d)this.sectionIndex.push(o)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void $t("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Wu.forImage(n,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):$t("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ch(i,t,n,o,d,_,b,S,C,z,R,j,H,Y,ee){const ae=au.fromFeature(i,d);let ye;j===f.ag.vertical&&ae.verticalizePunctuation();const{processBidirectionalText:Me,processStyledBidirectionalText:et}=_t;if(Me&&ae.sections.length===1){ye=[];const me=Me(ae.toString(),Fd(ae,z,_,t,o,Y));for(const Ve of me){const xt=new au;xt.text=Ve,xt.sections=ae.sections;for(let qt=0;qt<Ve.length;qt++)xt.sectionIndex.push(0);ye.push(xt)}}else if(et){ye=[];const me=et(ae.text,ae.sectionIndex,Fd(ae,z,_,t,o,Y));for(const Ve of me){const xt=new au;xt.text=Ve[0],xt.sectionIndex=Ve[1],xt.sections=ae.sections,ye.push(xt)}}else ye=function(me,Ve){const xt=[],qt=me.text;let St=0;for(const Ct of Ve)xt.push(me.substring(St,Ct)),St=Ct;return St<qt.length&&xt.push(me.substring(St,qt.length)),xt}(ae,Fd(ae,z,_,t,o,Y));const Be=[],X={positionedLines:Be,text:ae.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:j,iconsInText:!1,verticalizable:!1};return function(me,Ve,xt,qt,St,Ct,Wt,Gt,Jt,Nt,fr,Cr){let Tr=0,vr=0,si=0,an=0;const Nn=Gt==="right"?1:Gt==="left"?0:.5,_s=Fn/Cr;let Xa=0;for(const Qi of St){Qi.trim();const $n=Qi.getMaxScale(),ss={positionedGlyphs:[],lineOffset:0};me.positionedLines[Xa]=ss;const as=ss.positionedGlyphs;let Zs=0;if(!Qi.length()){vr+=Ct,++Xa;continue}const Ya=k0(qt,Qi,_s);for(let da=0;da<Qi.length();da++){const Rn=Qi.getSection(da),Hn=Qi.getSectionIndex(da),Xn=Qi.getCharCode(da),Cn=z0(Jt,fr,Xn);let Gi;if(Rn.imageName){if(me.iconsInText=!0,Rn.scale=Rn.scale*_s,Gi=F0(Rn,Cn,$n,Ya,qt),!Gi)continue;Zs=Math.max(Zs,Gi.imageOffset)}else if(Gi=D0(Rn,Xn,Cn,Ya,Ve,xt),!Gi)continue;const{rect:Zo,metrics:uu,baselineOffset:Go}=Gi;as.push({glyph:Xn,imageName:Rn.imageName,x:Tr,y:vr+Go+Ih,vertical:Cn,scale:Rn.scale,fontStack:Rn.fontStack,sectionIndex:Hn,metrics:uu,rect:Zo}),Cn?(me.verticalizable=!0,Tr+=(Rn.imageName?uu.advance:Fn)*Rn.scale+Nt):Tr+=uu.advance*Rn.scale+Nt}as.length!==0&&(si=Math.max(Tr-Nt,si),N0(as,0,as.length-1,Nn)),Tr=0,ss.lineOffset=Math.max(Zs,($n-1)*Fn);const Wn=Ct*$n+Zs;vr+=Wn,an=Math.max(Wn,an),++Xa}const{horizontalAlign:ha,verticalAlign:ns}=Nd(Wt);(function(Qi,$n,ss,as,Zs,Ya,Wn,da,Rn){const Hn=($n-ss)*Zs;let Xn=0;Xn=Ya!==Wn?-da*as-Ih:-as*Rn*Wn+.5*Wn;for(const Cn of Qi)for(const Gi of Cn.positionedGlyphs)Gi.x+=Hn,Gi.y+=Xn})(me.positionedLines,Nn,ha,ns,si,an,Ct,vr,St.length),me.top+=-ns*vr,me.bottom=me.top+vr,me.left+=-ha*si,me.right=me.left+si}(X,t,n,o,ye,b,S,C,j,z,H,ee),!function(me){for(const Ve of me)if(Ve.positionedGlyphs.length!==0)return!1;return!0}(Be)&&X}const Mh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},M0={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},L0={40:!0};function im(i,t,n,o,d,_){if(t.imageName){const b=o[t.imageName];return b?b.displaySize[0]*t.scale*Fn/_+d:0}{const b=n[t.fontStack],S=b&&b[i];return S?S.metrics.advance*t.scale+d:0}}function nm(i,t,n,o){const d=Math.pow(i-t,2);return o?i<t?d/2:2*d:d+Math.abs(n)*n}function E0(i,t,n){let o=0;return i===10&&(o-=1e4),n&&(o+=150),i!==40&&i!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function sm(i,t,n,o,d,_){let b=null,S=nm(t,n,d,_);for(const C of o){const z=nm(t-C.x,n,d,_)+C.badness;z<=S&&(b=C,S=z)}return{index:i,x:t,priorBreak:b,badness:S}}function am(i){return i?am(i.priorBreak).concat(i.index):[]}function Fd(i,t,n,o,d,_){if(!i)return[];const b=[],S=function(j,H,Y,ee,ae,ye){let Me=0;for(let et=0;et<j.length();et++){const Be=j.getSection(et);Me+=im(j.getCharCode(et),Be,ee,ae,H,ye)}return Me/Math.max(1,Math.ceil(Me/Y))}(i,t,n,o,d,_),C=i.text.indexOf("​")>=0;let z=0;for(let j=0;j<i.length();j++){const H=i.getSection(j),Y=i.getCharCode(j);if(Mh[Y]||(z+=im(Y,H,o,d,t,_)),j<i.length()-1){const ee=!((R=Y)<11904)&&(!!Gr["CJK Compatibility Forms"](R)||!!Gr["CJK Compatibility"](R)||!!Gr["CJK Strokes"](R)||!!Gr["CJK Symbols and Punctuation"](R)||!!Gr["Enclosed CJK Letters and Months"](R)||!!Gr["Halfwidth and Fullwidth Forms"](R)||!!Gr["Ideographic Description Characters"](R)||!!Gr["Vertical Forms"](R)||te.test(String.fromCodePoint(R)));(M0[Y]||ee||H.imageName||j!==i.length()-2&&L0[i.getCharCode(j+1)])&&b.push(sm(j+1,z,S,b,E0(Y,i.getCharCode(j+1),ee&&C),!1))}}var R;return am(sm(i.length(),z,S,b,0,!0))}function Nd(i){let t=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function k0(i,t,n){const o=t.getMaxScale()*Fn,{maxImageWidth:d,maxImageHeight:_}=t.getMaxImageSize(i),b=Math.max(o,_*n);return{verticalLineContentWidth:Math.max(o,d*n),horizontalLineContentHeight:b}}function om(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function z0(i,t,n){return!(i===f.ag.horizontal||!t&&!oe(n)||t&&(Mh[n]||(o=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function D0(i,t,n,o,d,_){const b=_[i.fontStack],S=function(z,R,j,H){if(z&&z.rect)return z;const Y=R[j.fontStack],ee=Y&&Y[H];return ee?{rect:null,metrics:ee.metrics}:null}(b&&b[t],d,i,t);if(S===null)return null;let C;if(n)C=o.verticalLineContentWidth-i.scale*Fn;else{const z=om(i.verticalAlign);C=(o.horizontalLineContentHeight-i.scale*Fn)*z}return{rect:S.rect,metrics:S.metrics,baselineOffset:C}}function F0(i,t,n,o,d){const _=d[i.imageName];if(!_)return null;const b=_.paddedRect,S=_.displaySize,C={width:S[0],height:S[1],left:ua,top:-3,advance:t?S[1]:S[0]};let z;if(t)z=o.verticalLineContentWidth-S[1]*i.scale;else{const R=om(i.verticalAlign);z=(o.horizontalLineContentHeight-S[1]*i.scale)*R}return{rect:b,metrics:C,baselineOffset:z,imageOffset:(t?S[0]:S[1])*i.scale-Fn*n}}function N0(i,t,n,o){if(o===0)return;const d=i[n],_=(i[n].x+d.metrics.advance*d.scale)*o;for(let b=t;b<=n;b++)i[b].x-=_}function R0(i,t,n){const{horizontalAlign:o,verticalAlign:d}=Nd(n),_=t[0]-i.displaySize[0]*o,b=t[1]-i.displaySize[1]*d;return{image:i,top:b,bottom:b+i.displaySize[1],left:_,right:_+i.displaySize[0]}}function lm(i){var t,n;let o=i.left,d=i.top,_=i.right-o,b=i.bottom-d;const S=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",C=(n=i.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",z=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(C==="proportional"){if(S==="stretchOnly"&&_/b<z||S==="proportional"){const R=Math.ceil(b*z);o*=R/_,_=R}}else if(S==="proportional"&&C==="stretchOnly"&&z!==0&&_/b>z){const R=Math.ceil(_/z);d*=R/b,b=R}return{x1:o,y1:d,x2:o+_,y2:d+b}}function cm(i,t,n,o,d,_){const b=i.image;let S;if(b.content){const ye=b.content,Me=b.pixelRatio||1;S=[ye[0]/Me,ye[1]/Me,b.displaySize[0]-ye[2]/Me,b.displaySize[1]-ye[3]/Me]}const C=t.left*_,z=t.right*_;let R,j,H,Y;n==="width"||n==="both"?(Y=d[0]+C-o[3],j=d[0]+z+o[1]):(Y=d[0]+(C+z-b.displaySize[0])/2,j=Y+b.displaySize[0]);const ee=t.top*_,ae=t.bottom*_;return n==="height"||n==="both"?(R=d[1]+ee-o[0],H=d[1]+ae+o[2]):(R=d[1]+(ee+ae-b.displaySize[1])/2,H=R+b.displaySize[1]),{image:b,top:R,right:j,bottom:H,left:Y,collisionPadding:S}}const Hu=255,Al=128,dc=Hu*Al;function um(i,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new ct(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:d}=n;let _=0;for(;_<o.length&&o[_]<=i;)_++;_=Math.max(0,_-1);let b=_;for(;b<o.length&&o[b]<i+1;)b++;b=Math.min(o.length-1,b);const S=o[_],C=o[b];return n.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:C,interpolationType:d}:{kind:"camera",minZoom:S,maxZoom:C,minSize:n.evaluate(new ct(S)),maxSize:n.evaluate(new ct(C)),interpolationType:d}}}function Rd(i,t,n){let o="never";const d=i.get(t);return d?o=d:i.get(n)&&(o="always"),o}const B0=Uu.VectorTileFeature.types,O0=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Lh(i,t,n,o,d,_,b,S,C,z,R,j,H){const Y=S?Math.min(dc,Math.round(S[0])):0,ee=S?Math.min(dc,Math.round(S[1])):0;i.emplaceBack(t,n,Math.round(32*o),Math.round(32*d),_,b,(Y<<1)+(C?1:0),ee,16*z,16*R,256*j,256*H)}function Bd(i,t,n){i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n)}function j0(i){for(const t of i.sections)if(rt(t.text))return!0;return!1}class Od{constructor(t){this.layoutVertexArray=new vt,this.indexArray=new tr,this.programConfigurations=t,this.segments=new _r,this.dynamicLayoutVertexArray=new bt,this.opacityVertexArray=new Mt,this.hasVisibleVertices=!1,this.placedSymbolArray=new E}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,o,d){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,v0.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,b0.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,O0,!0),this.opacityVertexBuffer.itemSize=1),(o||d)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}hr("SymbolBuffers",Od);class jd{constructor(t,n,o){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new o,this.segments=new _r,this.collisionVertexArray=new It}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,x0.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}hr("CollisionBuffers",jd);class ou{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(b=>b.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=um(this.zoom,n["text-size"]),this.iconSizeData=um(this.zoom,n["icon-size"]);const o=this.layers[0].layout,d=o.get("symbol-sort-key"),_=o.get("symbol-z-order");this.canOverlap=Rd(o,"text-overlap","text-allow-overlap")!=="never"||Rd(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(b=>f.ag[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=t.sourceID}createArrays(){this.text=new Od(new Hl(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Od(new Hl(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new $,this.lineVertexArray=new W,this.symbolInstances=new q,this.textAnchorOffsets=new se}calculateGlyphDependencies(t,n,o,d,_){for(let b=0;b<t.length;b++)if(n[t.charCodeAt(b)]=!0,(o||d)&&_){const S=$u[t.charAt(b)];S&&(n[S.charCodeAt(0)]=!0)}}populate(t,n,o){const d=this.layers[0],_=d.layout,b=_.get("text-font"),S=_.get("text-field"),C=_.get("icon-image"),z=(S.value.kind!=="constant"||S.value.value instanceof tn&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),R=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,j=_.get("symbol-sort-key");if(this.features=[],!z&&!R)return;const H=n.iconDependencies,Y=n.glyphDependencies,ee=n.availableImages,ae=new ct(this.zoom);for(const{feature:ye,id:Me,index:et,sourceLayerIndex:Be}of t){const X=d._featureFilter.needGeometry,me=ca(ye,X);if(!d._featureFilter.filter(ae,me,o))continue;let Ve,xt;if(X||(me.geometry=Xl(ye)),z){const St=d.getValueAndResolveTokens("text-field",me,o,ee),Ct=tn.factory(St),Wt=this.hasRTLText=this.hasRTLText||j0(Ct);(!Wt||_t.getRTLTextPluginStatus()==="unavailable"||Wt&&_t.isParsed())&&(Ve=P0(Ct,d,me))}if(R){const St=d.getValueAndResolveTokens("icon-image",me,o,ee);xt=St instanceof hn?St:hn.fromString(St)}if(!Ve&&!xt)continue;const qt=this.sortFeaturesByKey?j.evaluate(me,{},o):void 0;if(this.features.push({id:Me,text:Ve,icon:xt,index:et,sourceLayerIndex:Be,geometry:me.geometry,properties:ye.properties,type:B0[ye.type],sortKey:qt}),xt&&(H[xt.name]=!0),Ve){const St=b.evaluate(me,{},o).join(","),Ct=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(f.ag.vertical)>=0;for(const Wt of Ve.sections)if(Wt.image)H[Wt.image.name]=!0;else{const Gt=$l(Ve.toString()),Jt=Wt.fontStack||St,Nt=Y[Jt]=Y[Jt]||{};this.calculateGlyphDependencies(Wt.text,Nt,Ct,this.allowVerticalPlacement,Gt)}}}_.get("symbol-placement")==="line"&&(this.features=function(ye){const Me={},et={},Be=[];let X=0;function me(St){Be.push(ye[St]),X++}function Ve(St,Ct,Wt){const Gt=et[St];return delete et[St],et[Ct]=Gt,Be[Gt].geometry[0].pop(),Be[Gt].geometry[0]=Be[Gt].geometry[0].concat(Wt[0]),Gt}function xt(St,Ct,Wt){const Gt=Me[Ct];return delete Me[Ct],Me[St]=Gt,Be[Gt].geometry[0].shift(),Be[Gt].geometry[0]=Wt[0].concat(Be[Gt].geometry[0]),Gt}function qt(St,Ct,Wt){const Gt=Wt?Ct[0][Ct[0].length-1]:Ct[0][0];return`${St}:${Gt.x}:${Gt.y}`}for(let St=0;St<ye.length;St++){const Ct=ye[St],Wt=Ct.geometry,Gt=Ct.text?Ct.text.toString():null;if(!Gt){me(St);continue}const Jt=qt(Gt,Wt),Nt=qt(Gt,Wt,!0);if(Jt in et&&Nt in Me&&et[Jt]!==Me[Nt]){const fr=xt(Jt,Nt,Wt),Cr=Ve(Jt,Nt,Be[fr].geometry);delete Me[Jt],delete et[Nt],et[qt(Gt,Be[Cr].geometry,!0)]=Cr,Be[fr].geometry=null}else Jt in et?Ve(Jt,Nt,Wt):Nt in Me?xt(Jt,Nt,Wt):(me(St),Me[Jt]=X-1,et[Nt]=X-1)}return Be.filter(St=>St.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ye,Me)=>ye.sortKey-Me.sortKey)}update(t,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const o=this.lineVertexArray.length;if(t.segment!==void 0){let d=t.dist(n[t.segment+1]),_=t.dist(n[t.segment]);const b={};for(let S=t.segment+1;S<n.length;S++)b[S]={x:n[S].x,y:n[S].y,tileUnitDistanceFromAnchor:d},S<n.length-1&&(d+=n[S+1].dist(n[S]));for(let S=t.segment||0;S>=0;S--)b[S]={x:n[S].x,y:n[S].y,tileUnitDistanceFromAnchor:_},S>0&&(_+=n[S-1].dist(n[S]));for(let S=0;S<n.length;S++){const C=b[S];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,n,o,d,_,b,S,C,z,R,j,H){const Y=t.indexArray,ee=t.layoutVertexArray,ae=t.segments.prepareSegment(4*n.length,ee,Y,this.canOverlap?b.sortKey:void 0),ye=this.glyphOffsetArray.length,Me=ae.vertexLength,et=this.allowVerticalPlacement&&S===f.ag.vertical?Math.PI/2:0,Be=b.text&&b.text.sections;for(let X=0;X<n.length;X++){const{tl:me,tr:Ve,bl:xt,br:qt,tex:St,pixelOffsetTL:Ct,pixelOffsetBR:Wt,minFontScaleX:Gt,minFontScaleY:Jt,glyphOffset:Nt,isSDF:fr,sectionIndex:Cr}=n[X],Tr=ae.vertexLength,vr=Nt[1];Lh(ee,C.x,C.y,me.x,vr+me.y,St.x,St.y,o,fr,Ct.x,Ct.y,Gt,Jt),Lh(ee,C.x,C.y,Ve.x,vr+Ve.y,St.x+St.w,St.y,o,fr,Wt.x,Ct.y,Gt,Jt),Lh(ee,C.x,C.y,xt.x,vr+xt.y,St.x,St.y+St.h,o,fr,Ct.x,Wt.y,Gt,Jt),Lh(ee,C.x,C.y,qt.x,vr+qt.y,St.x+St.w,St.y+St.h,o,fr,Wt.x,Wt.y,Gt,Jt),Bd(t.dynamicLayoutVertexArray,C,et),Y.emplaceBack(Tr,Tr+2,Tr+1),Y.emplaceBack(Tr+1,Tr+2,Tr+3),ae.vertexLength+=4,ae.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Nt[0]),X!==n.length-1&&Cr===n[X+1].sectionIndex||t.programConfigurations.populatePaintArrays(ee.length,b,b.index,{},H,Be&&Be[Cr])}t.placedSymbolArray.emplaceBack(C.x,C.y,ye,this.glyphOffsetArray.length-ye,Me,z,R,C.segment,o?o[0]:0,o?o[1]:0,d[0],d[1],S,0,!1,0,j)}_addCollisionDebugVertex(t,n,o,d,_,b){return n.emplaceBack(0,0),t.emplaceBack(o.x,o.y,d,_,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(t,n,o,d,_,b,S){const C=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),z=C.vertexLength,R=_.layoutVertexArray,j=_.collisionVertexArray,H=S.anchorX,Y=S.anchorY;this._addCollisionDebugVertex(R,j,b,H,Y,new de(t,n)),this._addCollisionDebugVertex(R,j,b,H,Y,new de(o,n)),this._addCollisionDebugVertex(R,j,b,H,Y,new de(o,d)),this._addCollisionDebugVertex(R,j,b,H,Y,new de(t,d)),C.vertexLength+=4;const ee=_.indexArray;ee.emplaceBack(z,z+1),ee.emplaceBack(z+1,z+2),ee.emplaceBack(z+2,z+3),ee.emplaceBack(z+3,z),C.primitiveLength+=4}addDebugCollisionBoxes(t,n,o,d){for(let _=t;_<n;_++){const b=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,d?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new jd(Lt,Kf.members,Kt),this.iconCollisionBox=new jd(Lt,Kf.members,Kt);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,o,d,_,b,S,C,z){const R={};for(let j=n;j<o;j++){const H=t.get(j);R.textBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},R.textFeatureIndex=H.featureIndex;break}for(let j=d;j<_;j++){const H=t.get(j);R.verticalTextBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},R.verticalTextFeatureIndex=H.featureIndex;break}for(let j=b;j<S;j++){const H=t.get(j);R.iconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},R.iconFeatureIndex=H.featureIndex;break}for(let j=C;j<z;j++){const H=t.get(j);R.verticalIconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},R.verticalIconFeatureIndex=H.featureIndex;break}return R}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const o=t.placedSymbolArray.get(n),d=o.vertexStartIndex+4*o.numGlyphs;for(let _=o.vertexStartIndex;_<d;_+=4)t.indexArray.emplaceBack(_,_+2,_+1),t.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),o=Math.cos(t),d=[],_=[],b=[];for(let S=0;S<this.symbolInstances.length;++S){b.push(S);const C=this.symbolInstances.get(S);d.push(0|Math.round(n*C.anchorX+o*C.anchorY)),_.push(C.featureIndex)}return b.sort((S,C)=>d[S]-d[C]||_[C]-_[S]),b}addToSortKeyRanges(t,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((d,_,b)=>{d>=0&&b.indexOf(d)===_&&this.addIndicesForPlacedSymbol(this.text,d)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let hm,dm;hr("SymbolBucket",ou,{omit:["layers","collisionBoxArray","features","compareText"]}),ou.MAX_GLYPHS=65535,ou.addDynamicAttributes=Bd;var qd={get paint(){return dm=dm||new $r({"icon-opacity":new zt(x.paint_symbol["icon-opacity"]),"icon-color":new zt(x.paint_symbol["icon-color"]),"icon-halo-color":new zt(x.paint_symbol["icon-halo-color"]),"icon-halo-width":new zt(x.paint_symbol["icon-halo-width"]),"icon-halo-blur":new zt(x.paint_symbol["icon-halo-blur"]),"icon-translate":new Ft(x.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ft(x.paint_symbol["icon-translate-anchor"]),"text-opacity":new zt(x.paint_symbol["text-opacity"]),"text-color":new zt(x.paint_symbol["text-color"],{runtimeType:Pr,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new zt(x.paint_symbol["text-halo-color"]),"text-halo-width":new zt(x.paint_symbol["text-halo-width"]),"text-halo-blur":new zt(x.paint_symbol["text-halo-blur"]),"text-translate":new Ft(x.paint_symbol["text-translate"]),"text-translate-anchor":new Ft(x.paint_symbol["text-translate-anchor"])})},get layout(){return hm=hm||new $r({"symbol-placement":new Ft(x.layout_symbol["symbol-placement"]),"symbol-spacing":new Ft(x.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ft(x.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new zt(x.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ft(x.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ft(x.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ft(x.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ft(x.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ft(x.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ft(x.layout_symbol["icon-rotation-alignment"]),"icon-size":new zt(x.layout_symbol["icon-size"]),"icon-text-fit":new Ft(x.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ft(x.layout_symbol["icon-text-fit-padding"]),"icon-image":new zt(x.layout_symbol["icon-image"]),"icon-rotate":new zt(x.layout_symbol["icon-rotate"]),"icon-padding":new zt(x.layout_symbol["icon-padding"]),"icon-keep-upright":new Ft(x.layout_symbol["icon-keep-upright"]),"icon-offset":new zt(x.layout_symbol["icon-offset"]),"icon-anchor":new zt(x.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ft(x.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ft(x.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ft(x.layout_symbol["text-rotation-alignment"]),"text-field":new zt(x.layout_symbol["text-field"]),"text-font":new zt(x.layout_symbol["text-font"]),"text-size":new zt(x.layout_symbol["text-size"]),"text-max-width":new zt(x.layout_symbol["text-max-width"]),"text-line-height":new Ft(x.layout_symbol["text-line-height"]),"text-letter-spacing":new zt(x.layout_symbol["text-letter-spacing"]),"text-justify":new zt(x.layout_symbol["text-justify"]),"text-radial-offset":new zt(x.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ft(x.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new zt(x.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new zt(x.layout_symbol["text-anchor"]),"text-max-angle":new Ft(x.layout_symbol["text-max-angle"]),"text-writing-mode":new Ft(x.layout_symbol["text-writing-mode"]),"text-rotate":new zt(x.layout_symbol["text-rotate"]),"text-padding":new Ft(x.layout_symbol["text-padding"]),"text-keep-upright":new Ft(x.layout_symbol["text-keep-upright"]),"text-transform":new zt(x.layout_symbol["text-transform"]),"text-offset":new zt(x.layout_symbol["text-offset"]),"text-allow-overlap":new Ft(x.layout_symbol["text-allow-overlap"]),"text-overlap":new Ft(x.layout_symbol["text-overlap"]),"text-ignore-placement":new Ft(x.layout_symbol["text-ignore-placement"]),"text-optional":new Ft(x.layout_symbol["text-optional"])})}};class pm{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:lr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}hr("FormatSectionOverride",pm,{omit:["defaultValue"]});class Eh extends qr{constructor(t){super(t,qd)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const d=[];for(const _ of o)d.indexOf(_)<0&&d.push(_);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,o,d){const _=this.layout.get(t).evaluate(n,{},o,d),b=this._unevaluatedLayout._values[t];return b.isDataDriven()||No(b.value)||!_?_:function(S,C){return C.replace(/{([^{}]+)}/g,(z,R)=>S&&R in S?String(S[R]):"")}(n.properties,_)}createBucket(t){return new ou(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of qd.paint.overridableProperties){if(!Eh.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),o=new pm(n),d=new go(o,n.property.specification);let _=null;_=n.value.kind==="constant"||n.value.kind==="source"?new Ro("source",d):new Qn("composite",d,n.value.zoomStops),this.paint._values[t]=new Ot(n.property,_,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Eh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const o=t.get("text-field"),d=qd.paint.properties[n];let _=!1;const b=S=>{for(const C of S)if(d.overrides&&d.overrides.hasOverride(C))return void(_=!0)};if(o.value.kind==="constant"&&o.value.value instanceof tn)b(o.value.value.sections);else if(o.value.kind==="source"){const S=z=>{_||(z instanceof Lr&&Ki(z.value)===di?b(z.value.sections):z instanceof _a?b(z.sections):z.eachChild(S))},C=o.value;C._styleExpression&&S(C._styleExpression.expression)}return _}}let fm;var q0={get paint(){return fm=fm||new $r({"background-color":new Ft(x.paint_background["background-color"]),"background-pattern":new cr(x.paint_background["background-pattern"]),"background-opacity":new Ft(x.paint_background["background-opacity"])})}};class V0 extends qr{constructor(t){super(t,q0)}}let mm;var U0={get paint(){return mm=mm||new $r({"raster-opacity":new Ft(x.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ft(x.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ft(x.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ft(x.paint_raster["raster-brightness-max"]),"raster-saturation":new Ft(x.paint_raster["raster-saturation"]),"raster-contrast":new Ft(x.paint_raster["raster-contrast"]),"raster-resampling":new Ft(x.paint_raster["raster-resampling"]),"raster-fade-duration":new Ft(x.paint_raster["raster-fade-duration"])})}};class Z0 extends qr{constructor(t){super(t,U0)}}class G0 extends qr{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class $0{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const W0={once:!0},Vd=63710088e-1;class pc{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new pc(Re(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,o=this.lat*n,d=t.lat*n,_=Math.sin(o)*Math.sin(d)+Math.cos(o)*Math.cos(d)*Math.cos((t.lng-this.lng)*n);return Vd*Math.acos(Math.min(_,1))}static convert(t){if(t instanceof pc)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new pc(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new pc(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const gm=2*Math.PI*Vd;function _m(i){return gm*Math.cos(i*Math.PI/180)}function ym(i){return(180+i)/360}function vm(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function bm(i,t){return i/_m(t)}function Ud(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function xm(i,t){return i*_m(Ud(t))}class Xu{constructor(t,n,o=0){this.x=+t,this.y=+n,this.z=+o}static fromLngLat(t,n=0){const o=pc.convert(t);return new Xu(ym(o.lng),vm(o.lat),bm(n,o.lat))}toLngLat(){return new pc(360*this.x-180,Ud(this.y))}toAltitude(){return xm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/gm*(t=Ud(this.y),1/Math.cos(t*Math.PI/180));var t}}function wm(i,t,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[i*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class Zd{constructor(t,n,o){if(!function(d,_,b){return!(d<0||d>25||b<0||b>=Math.pow(2,d)||_<0||_>=Math.pow(2,d))}(t,n,o))throw new Error(`x=${n}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=o,this.key=lu(0,t,t,n,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,o){const d=(b=this.y,S=this.z,C=wm(256*(_=this.x),256*(b=Math.pow(2,S)-b-1),S),z=wm(256*(_+1),256*(b+1),S),C[0]+","+C[1]+","+z[0]+","+z[1]);var _,b,S,C,z;const R=function(j,H,Y){let ee,ae="";for(let ye=j;ye>0;ye--)ee=1<<ye-1,ae+=(H&ee?1:0)+(Y&ee?2:0);return ae}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,R).replace(/{bbox-epsg-3857}/g,d)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new de((t.x*n-this.x)*ut,(t.y*n-this.y)*ut)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Pm{constructor(t,n){this.wrap=t,this.canonical=n,this.key=lu(t,n.z,n.z,n.x,n.y)}}class Ha{constructor(t,n,o,d,_){if(this.terrainRttPosMatrix32f=null,t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=n,this.canonical=new Zd(o,+d,+_),this.key=lu(n,t,o,d,_)}clone(){return new Ha(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new Ha(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ha(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?lu(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):lu(this.wrap*+n,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new Ha(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,d=2*this.canonical.y;return[new Ha(n,this.wrap,n,o,d),new Ha(n,this.wrap,n,o+1,d),new Ha(n,this.wrap,n,o,d+1),new Ha(n,this.wrap,n,o+1,d+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Ha(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Ha(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Pm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Xu(t.x-this.wrap,t.y))}}function lu(i,t,n,o,d){(i*=2)<0&&(i=-1*i-1);const _=1<<n;return(_*_*i+_*d+o).toString(36)+n.toString(36)+t.toString(36)}hr("CanonicalTileID",Zd),hr("OverscaledTileID",Ha,{omit:["terrainRttPosMatrix32f"]});class Sm{constructor(t,n,o,d=1,_=1,b=1,S=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void $t(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const C=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=d,this.greenFactor=_,this.blueFactor=b,this.baseShift=S;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let z=0;z<C;z++)this.data[this._idx(-1,z)]=this.data[this._idx(0,z)],this.data[this._idx(C,z)]=this.data[this._idx(C-1,z)],this.data[this._idx(z,-1)]=this.data[this._idx(z,0)],this.data[this._idx(z,C)]=this.data[this._idx(z,C-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(C,-1)]=this.data[this._idx(C-1,0)],this.data[this._idx(-1,C)]=this.data[this._idx(0,C-1)],this.data[this._idx(C,C)]=this.data[this._idx(C-1,C-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let z=0;z<C;z++)for(let R=0;R<C;R++){const j=this.get(z,R);j>this.max&&(this.max=j),j<this.min&&(this.min=j)}}get(t,n){const o=new Uint8Array(this.data.buffer),d=4*this._idx(t,n);return this.unpack(o[d],o[d+1],o[d+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,o){return t*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new Wa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let d=n*this.dim,_=n*this.dim+this.dim,b=o*this.dim,S=o*this.dim+this.dim;switch(n){case-1:d=_-1;break;case 1:_=d+1}switch(o){case-1:b=S-1;break;case 1:S=b+1}const C=-n*this.dim,z=-o*this.dim;for(let R=b;R<S;R++)for(let j=d;j<_;j++)this.data[this._idx(j,R)]=t.data[this._idx(j+C,R+z)]}}hr("DEMData",Sm);class Am{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const o=t[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Tm{constructor(t,n,o,d,_){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=o,t._y=d,this.properties=t.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class Im{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Gl(ut,16,0),this.grid3D=new Gl(ut,16,0),this.featureIndexArray=new be,this.promoteId=n}insert(t,n,o,d,_,b){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,d,_);const C=b?this.grid3D:this.grid;for(let z=0;z<n.length;z++){const R=n[z],j=[1/0,1/0,-1/0,-1/0];for(let H=0;H<R.length;H++){const Y=R[H];j[0]=Math.min(j[0],Y.x),j[1]=Math.min(j[1],Y.y),j[2]=Math.max(j[2],Y.x),j[3]=Math.max(j[3],Y.y)}j[0]<ut&&j[1]<ut&&j[2]>=0&&j[3]>=0&&C.insert(S,j[0],j[1],j[2],j[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Uu.VectorTile(new kd(this.rawTileData)).layers,this.sourceLayerCoder=new Am(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,o,d){this.loadVTLayers();const _=t.params,b=ut/t.tileSize/t.scale,S=jo(_.filter),C=t.queryGeometry,z=t.queryPadding*b,R=Mm(C),j=this.grid.query(R.minX-z,R.minY-z,R.maxX+z,R.maxY+z),H=Mm(t.cameraQueryGeometry),Y=this.grid3D.query(H.minX-z,H.minY-z,H.maxX+z,H.maxY+z,(ye,Me,et,Be)=>function(X,me,Ve,xt,qt){for(const Ct of X)if(me<=Ct.x&&Ve<=Ct.y&&xt>=Ct.x&&qt>=Ct.y)return!0;const St=[new de(me,Ve),new de(me,qt),new de(xt,qt),new de(xt,Ve)];if(X.length>2){for(const Ct of St)if(ru(X,Ct))return!0}for(let Ct=0;Ct<X.length-1;Ct++)if(Fy(X[Ct],X[Ct+1],St))return!0;return!1}(t.cameraQueryGeometry,ye-z,Me-z,et+z,Be+z));for(const ye of Y)j.push(ye);j.sort(H0);const ee={};let ae;for(let ye=0;ye<j.length;ye++){const Me=j[ye];if(Me===ae)continue;ae=Me;const et=this.featureIndexArray.get(Me);let Be=null;this.loadMatchingFeature(ee,et.bucketIndex,et.sourceLayerIndex,et.featureIndex,S,_.layers,_.availableImages,n,o,d,(X,me,Ve)=>(Be||(Be=Xl(X)),me.queryIntersectsFeature({queryGeometry:C,feature:X,featureState:Ve,geometry:Be,zoom:this.z,transform:t.transform,pixelsToTileUnits:b,pixelPosMatrix:t.pixelPosMatrix})))}return ee}loadMatchingFeature(t,n,o,d,_,b,S,C,z,R,j){const H=this.bucketLayerIDs[n];if(b&&!H.some(ye=>b.has(ye)))return;const Y=this.sourceLayerCoder.decode(o),ee=this.vtLayers[Y].feature(d);if(_.needGeometry){const ye=ca(ee,!0);if(!_.filter(new ct(this.tileID.overscaledZ),ye,this.tileID.canonical))return}else if(!_.filter(new ct(this.tileID.overscaledZ),ee))return;const ae=this.getId(ee,Y);for(let ye=0;ye<H.length;ye++){const Me=H[ye];if(b&&!b.has(Me))continue;const et=C[Me];if(!et)continue;let Be={};ae&&R&&(Be=R.getState(et.sourceLayer||"_geojsonTileLayer",ae));const X=We({},z[Me]);X.paint=Cm(X.paint,et.paint,ee,Be,S),X.layout=Cm(X.layout,et.layout,ee,Be,S);const me=!j||j(ee,et,Be);if(!me)continue;const Ve=new Tm(ee,this.z,this.x,this.y,ae);Ve.layer=X;let xt=t[Me];xt===void 0&&(xt=t[Me]=[]),xt.push({featureIndex:d,feature:Ve,intersectionZ:me})}}lookupSymbolFeatures(t,n,o,d,_,b,S,C){const z={};this.loadVTLayers();const R=jo(_);for(const j of t)this.loadMatchingFeature(z,o,d,j,R,b,S,C,n);return z}hasLayer(t){for(const n of this.bucketLayerIDs)for(const o of n)if(t===o)return!0;return!1}getId(t,n){var o;let d=t.id;return this.promoteId&&(d=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof d=="boolean"&&(d=Number(d)),d===void 0&&(!((o=t.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(d=Number(t.properties.cluster_id))),d}}function Cm(i,t,n,o,d){return at(i,(_,b)=>{const S=t instanceof jt?t.get(b):null;return S&&S.evaluate?S.evaluate(n,o,d):S})}function Mm(i){let t=1/0,n=1/0,o=-1/0,d=-1/0;for(const _ of i)t=Math.min(t,_.x),n=Math.min(n,_.y),o=Math.max(o,_.x),d=Math.max(d,_.y);return{minX:t,minY:n,maxX:o,maxY:d}}function H0(i,t){return t-i}function Lm(i,t,n,o,d){const _=[];for(let b=0;b<i.length;b++){const S=i[b];let C;for(let z=0;z<S.length-1;z++){let R=S[z],j=S[z+1];R.x<t&&j.x<t||(R.x<t?R=new de(t,R.y+(t-R.x)/(j.x-R.x)*(j.y-R.y))._round():j.x<t&&(j=new de(t,R.y+(t-R.x)/(j.x-R.x)*(j.y-R.y))._round()),R.y<n&&j.y<n||(R.y<n?R=new de(R.x+(n-R.y)/(j.y-R.y)*(j.x-R.x),n)._round():j.y<n&&(j=new de(R.x+(n-R.y)/(j.y-R.y)*(j.x-R.x),n)._round()),R.x>=o&&j.x>=o||(R.x>=o?R=new de(o,R.y+(o-R.x)/(j.x-R.x)*(j.y-R.y))._round():j.x>=o&&(j=new de(o,R.y+(o-R.x)/(j.x-R.x)*(j.y-R.y))._round()),R.y>=d&&j.y>=d||(R.y>=d?R=new de(R.x+(d-R.y)/(j.y-R.y)*(j.x-R.x),d)._round():j.y>=d&&(j=new de(R.x+(d-R.y)/(j.y-R.y)*(j.x-R.x),d)._round()),C&&R.equals(C[C.length-1])||(C=[R],_.push(C)),C.push(j)))))}}return _}hr("FeatureIndex",Im,{omit:["rawTileData","sourceLayerCoder"]});class fc extends de{constructor(t,n,o,d){super(t,n),this.angle=o,d!==void 0&&(this.segment=d)}clone(){return new fc(this.x,this.y,this.angle,this.segment)}}function Em(i,t,n,o,d){if(t.segment===void 0||n===0)return!0;let _=t,b=t.segment+1,S=0;for(;S>-n/2;){if(b--,b<0)return!1;S-=i[b].dist(_),_=i[b]}S+=i[b].dist(i[b+1]),b++;const C=[];let z=0;for(;S<n/2;){const R=i[b],j=i[b+1];if(!j)return!1;let H=i[b-1].angleTo(R)-R.angleTo(j);for(H=Math.abs((H+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:S,angleDelta:H}),z+=H;S-C[0].distance>o;)z-=C.shift().angleDelta;if(z>d)return!1;b++,S+=R.dist(j)}return!0}function km(i){let t=0;for(let n=0;n<i.length-1;n++)t+=i[n].dist(i[n+1]);return t}function zm(i,t,n){return i?.6*t*n:0}function Dm(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function X0(i,t,n,o,d,_){const b=zm(n,d,_),S=Dm(n,o)*_;let C=0;const z=km(i)/2;for(let R=0;R<i.length-1;R++){const j=i[R],H=i[R+1],Y=j.dist(H);if(C+Y>z){const ee=(z-C)/Y,ae=dn.number(j.x,H.x,ee),ye=dn.number(j.y,H.y,ee),Me=new fc(ae,ye,H.angleTo(j),R);return Me._round(),!b||Em(i,Me,S,b,t)?Me:void 0}C+=Y}}function Y0(i,t,n,o,d,_,b,S,C){const z=zm(o,_,b),R=Dm(o,d),j=R*b,H=i[0].x===0||i[0].x===C||i[0].y===0||i[0].y===C;return t-j<t/4&&(t=j+t/4),Fm(i,H?t/2*S%t:(R/2+2*_)*b*S%t,t,z,n,j,H,!1,C)}function Fm(i,t,n,o,d,_,b,S,C){const z=_/2,R=km(i);let j=0,H=t-n,Y=[];for(let ee=0;ee<i.length-1;ee++){const ae=i[ee],ye=i[ee+1],Me=ae.dist(ye),et=ye.angleTo(ae);for(;H+n<j+Me;){H+=n;const Be=(H-j)/Me,X=dn.number(ae.x,ye.x,Be),me=dn.number(ae.y,ye.y,Be);if(X>=0&&X<C&&me>=0&&me<C&&H-z>=0&&H+z<=R){const Ve=new fc(X,me,et,ee);Ve._round(),o&&!Em(i,Ve,_,o,d)||Y.push(Ve)}}j+=Me}return S||Y.length||b||(Y=Fm(i,j/2,n,o,d,_,b,!0,C)),Y}hr("Anchor",fc);const Yu=ua;function Nm(i,t,n,o){const d=[],_=i.image,b=_.pixelRatio,S=_.paddedRect.w-2*Yu,C=_.paddedRect.h-2*Yu;let z={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const R=_.stretchX||[[0,S]],j=_.stretchY||[[0,C]],H=(Nt,fr)=>Nt+fr[1]-fr[0],Y=R.reduce(H,0),ee=j.reduce(H,0),ae=S-Y,ye=C-ee;let Me=0,et=Y,Be=0,X=ee,me=0,Ve=ae,xt=0,qt=ye;if(_.content&&o){const Nt=_.content,fr=Nt[2]-Nt[0],Cr=Nt[3]-Nt[1];(_.textFitWidth||_.textFitHeight)&&(z=lm(i)),Me=kh(R,0,Nt[0]),Be=kh(j,0,Nt[1]),et=kh(R,Nt[0],Nt[2]),X=kh(j,Nt[1],Nt[3]),me=Nt[0]-Me,xt=Nt[1]-Be,Ve=fr-et,qt=Cr-X}const St=z.x1,Ct=z.y1,Wt=z.x2-St,Gt=z.y2-Ct,Jt=(Nt,fr,Cr,Tr)=>{const vr=zh(Nt.stretch-Me,et,Wt,St),si=Dh(Nt.fixed-me,Ve,Nt.stretch,Y),an=zh(fr.stretch-Be,X,Gt,Ct),Nn=Dh(fr.fixed-xt,qt,fr.stretch,ee),_s=zh(Cr.stretch-Me,et,Wt,St),Xa=Dh(Cr.fixed-me,Ve,Cr.stretch,Y),ha=zh(Tr.stretch-Be,X,Gt,Ct),ns=Dh(Tr.fixed-xt,qt,Tr.stretch,ee),Qi=new de(vr,an),$n=new de(_s,an),ss=new de(_s,ha),as=new de(vr,ha),Zs=new de(si/b,Nn/b),Ya=new de(Xa/b,ns/b),Wn=t*Math.PI/180;if(Wn){const Hn=Math.sin(Wn),Xn=Math.cos(Wn),Cn=[Xn,-Hn,Hn,Xn];Qi._matMult(Cn),$n._matMult(Cn),as._matMult(Cn),ss._matMult(Cn)}const da=Nt.stretch+Nt.fixed,Rn=fr.stretch+fr.fixed;return{tl:Qi,tr:$n,bl:as,br:ss,tex:{x:_.paddedRect.x+Yu+da,y:_.paddedRect.y+Yu+Rn,w:Cr.stretch+Cr.fixed-da,h:Tr.stretch+Tr.fixed-Rn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zs,pixelOffsetBR:Ya,minFontScaleX:Ve/b/Wt,minFontScaleY:qt/b/Gt,isSDF:n}};if(o&&(_.stretchX||_.stretchY)){const Nt=Rm(R,ae,Y),fr=Rm(j,ye,ee);for(let Cr=0;Cr<Nt.length-1;Cr++){const Tr=Nt[Cr],vr=Nt[Cr+1];for(let si=0;si<fr.length-1;si++)d.push(Jt(Tr,fr[si],vr,fr[si+1]))}}else d.push(Jt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:C+1}));return d}function kh(i,t,n){let o=0;for(const d of i)o+=Math.max(t,Math.min(n,d[1]))-Math.max(t,Math.min(n,d[0]));return o}function Rm(i,t,n){const o=[{fixed:-1,stretch:0}];for(const[d,_]of i){const b=o[o.length-1];o.push({fixed:d-b.stretch,stretch:b.stretch}),o.push({fixed:d-b.stretch,stretch:b.stretch+(_-d)})}return o.push({fixed:t+Yu,stretch:n}),o}function zh(i,t,n,o){return i/t*n+o}function Dh(i,t,n,o){return i-t*n/o}class Fh{constructor(t,n,o,d,_,b,S,C,z,R){var j;if(this.boxStartIndex=t.length,z){let H=b.top,Y=b.bottom;const ee=b.collisionPadding;ee&&(H-=ee[1],Y+=ee[3]);let ae=Y-H;ae>0&&(ae=Math.max(10,ae),this.circleDiameter=ae)}else{const H=!((j=b.image)===null||j===void 0)&&j.content&&(b.image.textFitWidth||b.image.textFitHeight)?lm(b):{x1:b.left,y1:b.top,x2:b.right,y2:b.bottom};H.y1=H.y1*S-C[0],H.y2=H.y2*S+C[2],H.x1=H.x1*S-C[3],H.x2=H.x2*S+C[1];const Y=b.collisionPadding;if(Y&&(H.x1-=Y[0]*S,H.y1-=Y[1]*S,H.x2+=Y[2]*S,H.y2+=Y[3]*S),R){const ee=new de(H.x1,H.y1),ae=new de(H.x2,H.y1),ye=new de(H.x1,H.y2),Me=new de(H.x2,H.y2),et=R*Math.PI/180;ee._rotate(et),ae._rotate(et),ye._rotate(et),Me._rotate(et),H.x1=Math.min(ee.x,ae.x,ye.x,Me.x),H.x2=Math.max(ee.x,ae.x,ye.x,Me.x),H.y1=Math.min(ee.y,ae.y,ye.y,Me.y),H.y2=Math.max(ee.y,ae.y,ye.y,Me.y)}t.emplaceBack(n.x,n.y,H.x1,H.y1,H.x2,H.y2,o,d,_)}this.boxEndIndex=t.length}}class K0{constructor(t=[],n=(o,d)=>o<d?-1:o>d?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:o}=this,d=n[t];for(;t>0;){const _=t-1>>1,b=n[_];if(o(d,b)>=0)break;n[t]=b,t=_}n[t]=d}_down(t){const{data:n,compare:o}=this,d=this.length>>1,_=n[t];for(;t<d;){let b=1+(t<<1);const S=b+1;if(S<this.length&&o(n[S],n[b])<0&&(b=S),o(n[b],_)>=0)break;n[t]=n[b],t=b}n[t]=_}}function J0(i,t=1,n=!1){let o=1/0,d=1/0,_=-1/0,b=-1/0;const S=i[0];for(let Y=0;Y<S.length;Y++){const ee=S[Y];(!Y||ee.x<o)&&(o=ee.x),(!Y||ee.y<d)&&(d=ee.y),(!Y||ee.x>_)&&(_=ee.x),(!Y||ee.y>b)&&(b=ee.y)}const C=Math.min(_-o,b-d);let z=C/2;const R=new K0([],Q0);if(C===0)return new de(o,d);for(let Y=o;Y<_;Y+=C)for(let ee=d;ee<b;ee+=C)R.push(new cu(Y+z,ee+z,z,i));let j=function(Y){let ee=0,ae=0,ye=0;const Me=Y[0];for(let et=0,Be=Me.length,X=Be-1;et<Be;X=et++){const me=Me[et],Ve=Me[X],xt=me.x*Ve.y-Ve.x*me.y;ae+=(me.x+Ve.x)*xt,ye+=(me.y+Ve.y)*xt,ee+=3*xt}return new cu(ae/ee,ye/ee,0,Y)}(i),H=R.length;for(;R.length;){const Y=R.pop();(Y.d>j.d||!j.d)&&(j=Y,n&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,H)),Y.max-j.d<=t||(z=Y.h/2,R.push(new cu(Y.p.x-z,Y.p.y-z,z,i)),R.push(new cu(Y.p.x+z,Y.p.y-z,z,i)),R.push(new cu(Y.p.x-z,Y.p.y+z,z,i)),R.push(new cu(Y.p.x+z,Y.p.y+z,z,i)),H+=4)}return n&&(console.log(`num probes: ${H}`),console.log(`best distance: ${j.d}`)),j.p}function Q0(i,t){return t.max-i.max}function cu(i,t,n,o){this.p=new de(i,t),this.h=n,this.d=function(d,_){let b=!1,S=1/0;for(let C=0;C<_.length;C++){const z=_[C];for(let R=0,j=z.length,H=j-1;R<j;H=R++){const Y=z[R],ee=z[H];Y.y>d.y!=ee.y>d.y&&d.x<(ee.x-Y.x)*(d.y-Y.y)/(ee.y-Y.y)+Y.x&&(b=!b),S=Math.min(S,_f(d,Y,ee))}}return(b?1:-1)*Math.sqrt(S)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var gs;f.ax=void 0,(gs=f.ax||(f.ax={}))[gs.center=1]="center",gs[gs.left=2]="left",gs[gs.right=3]="right",gs[gs.top=4]="top",gs[gs.bottom=5]="bottom",gs[gs["top-left"]=6]="top-left",gs[gs["top-right"]=7]="top-right",gs[gs["bottom-left"]=8]="bottom-left",gs[gs["bottom-right"]=9]="bottom-right";const mc=7,Gd=Number.POSITIVE_INFINITY;function Bm(i,t){return t[1]!==Gd?function(n,o,d){let _=0,b=0;switch(o=Math.abs(o),d=Math.abs(d),n){case"top-right":case"top-left":case"top":b=d-mc;break;case"bottom-right":case"bottom-left":case"bottom":b=-d+mc}switch(n){case"top-right":case"bottom-right":case"right":_=-o;break;case"top-left":case"bottom-left":case"left":_=o}return[_,b]}(i,t[0],t[1]):function(n,o){let d=0,_=0;o<0&&(o=0);const b=o/Math.SQRT2;switch(n){case"top-right":case"top-left":_=b-mc;break;case"bottom-right":case"bottom-left":_=-b+mc;break;case"bottom":_=-o+mc;break;case"top":_=o-mc}switch(n){case"top-right":case"bottom-right":d=-b;break;case"top-left":case"bottom-left":d=b;break;case"left":d=o;break;case"right":d=-o}return[d,_]}(i,t[0])}function Om(i,t,n){var o;const d=i.layout,_=(o=d.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},n);if(_){const S=_.values,C=[];for(let z=0;z<S.length;z+=2){const R=C[z]=S[z],j=S[z+1].map(H=>H*Fn);R.startsWith("top")?j[1]-=mc:R.startsWith("bottom")&&(j[1]+=mc),C[z+1]=j}return new Ti(C)}const b=d.get("text-variable-anchor");if(b){let S;S=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[d.get("text-radial-offset").evaluate(t,{},n)*Fn,Gd]:d.get("text-offset").evaluate(t,{},n).map(z=>z*Fn);const C=[];for(const z of b)C.push(z,Bm(z,S));return new Ti(C)}return null}function $d(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function e1(i,t,n,o,d,_,b,S,C,z,R,j){let H=_.textMaxSize.evaluate(t,{});H===void 0&&(H=b);const Y=i.layers[0].layout,ee=Y.get("icon-offset").evaluate(t,{},R),ae=qm(n.horizontal),ye=b/24,Me=i.tilePixelRatio*ye,et=i.tilePixelRatio*H/24,Be=i.tilePixelRatio*S,X=i.tilePixelRatio*Y.get("symbol-spacing"),me=Y.get("text-padding")*i.tilePixelRatio,Ve=function(Cr,Tr,vr,si=1){const an=Cr.get("icon-padding").evaluate(Tr,{},vr),Nn=an&&an.values;return[Nn[0]*si,Nn[1]*si,Nn[2]*si,Nn[3]*si]}(Y,t,R,i.tilePixelRatio),xt=Y.get("text-max-angle")/180*Math.PI,qt=Y.get("text-rotation-alignment")!=="viewport"&&Y.get("symbol-placement")!=="point",St=Y.get("icon-rotation-alignment")==="map"&&Y.get("symbol-placement")!=="point",Ct=Y.get("symbol-placement"),Wt=X/2,Gt=Y.get("icon-text-fit");let Jt;o&&Gt!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(Jt=cm(o,n.vertical,Gt,Y.get("icon-text-fit-padding"),ee,ye)),ae&&(o=cm(o,ae,Gt,Y.get("icon-text-fit-padding"),ee,ye)));const Nt=R?j.line.getGranularityForZoomLevel(R.z):1,fr=(Cr,Tr)=>{Tr.x<0||Tr.x>=ut||Tr.y<0||Tr.y>=ut||function(vr,si,an,Nn,_s,Xa,ha,ns,Qi,$n,ss,as,Zs,Ya,Wn,da,Rn,Hn,Xn,Cn,Gi,Zo,uu,Go,i1){const hu=vr.addToLineVertexArray(si,an);let Bc,du,pu,fu,Gm=0,$m=0,Wm=0,Hm=0,ep=-1,tp=-1;const Yl={};let Xm=bn("");if(vr.allowVerticalPlacement&&Nn.vertical){const Ms=ns.layout.get("text-rotate").evaluate(Gi,{},Go)+90;pu=new Fh(Qi,si,$n,ss,as,Nn.vertical,Zs,Ya,Wn,Ms),ha&&(fu=new Fh(Qi,si,$n,ss,as,ha,Rn,Hn,Wn,Ms))}if(_s){const Ms=ns.layout.get("icon-rotate").evaluate(Gi,{}),Ka=ns.layout.get("icon-text-fit")!=="none",Oc=Nm(_s,Ms,uu,Ka),Wo=ha?Nm(ha,Ms,uu,Ka):void 0;du=new Fh(Qi,si,$n,ss,as,_s,Rn,Hn,!1,Ms),Gm=4*Oc.length;const jc=vr.iconSizeData;let Tl=null;jc.kind==="source"?(Tl=[Al*ns.layout.get("icon-size").evaluate(Gi,{})],Tl[0]>dc&&$t(`${vr.layerIds[0]}: Value for "icon-size" is >= ${Hu}. Reduce your "icon-size".`)):jc.kind==="composite"&&(Tl=[Al*Zo.compositeIconSizes[0].evaluate(Gi,{},Go),Al*Zo.compositeIconSizes[1].evaluate(Gi,{},Go)],(Tl[0]>dc||Tl[1]>dc)&&$t(`${vr.layerIds[0]}: Value for "icon-size" is >= ${Hu}. Reduce your "icon-size".`)),vr.addSymbols(vr.icon,Oc,Tl,Cn,Xn,Gi,f.ag.none,si,hu.lineStartIndex,hu.lineLength,-1,Go),ep=vr.icon.placedSymbolArray.length-1,Wo&&($m=4*Wo.length,vr.addSymbols(vr.icon,Wo,Tl,Cn,Xn,Gi,f.ag.vertical,si,hu.lineStartIndex,hu.lineLength,-1,Go),tp=vr.icon.placedSymbolArray.length-1)}const Ym=Object.keys(Nn.horizontal);for(const Ms of Ym){const Ka=Nn.horizontal[Ms];if(!Bc){Xm=bn(Ka.text);const Wo=ns.layout.get("text-rotate").evaluate(Gi,{},Go);Bc=new Fh(Qi,si,$n,ss,as,Ka,Zs,Ya,Wn,Wo)}const Oc=Ka.positionedLines.length===1;if(Wm+=jm(vr,si,Ka,Xa,ns,Wn,Gi,da,hu,Nn.vertical?f.ag.horizontal:f.ag.horizontalOnly,Oc?Ym:[Ms],Yl,ep,Zo,Go),Oc)break}Nn.vertical&&(Hm+=jm(vr,si,Nn.vertical,Xa,ns,Wn,Gi,da,hu,f.ag.vertical,["vertical"],Yl,tp,Zo,Go));const n1=Bc?Bc.boxStartIndex:vr.collisionBoxArray.length,s1=Bc?Bc.boxEndIndex:vr.collisionBoxArray.length,a1=pu?pu.boxStartIndex:vr.collisionBoxArray.length,o1=pu?pu.boxEndIndex:vr.collisionBoxArray.length,l1=du?du.boxStartIndex:vr.collisionBoxArray.length,c1=du?du.boxEndIndex:vr.collisionBoxArray.length,u1=fu?fu.boxStartIndex:vr.collisionBoxArray.length,h1=fu?fu.boxEndIndex:vr.collisionBoxArray.length;let $o=-1;const Rh=(Ms,Ka)=>Ms&&Ms.circleDiameter?Math.max(Ms.circleDiameter,Ka):Ka;$o=Rh(Bc,$o),$o=Rh(pu,$o),$o=Rh(du,$o),$o=Rh(fu,$o);const Km=$o>-1?1:0;Km&&($o*=i1/Fn),vr.glyphOffsetArray.length>=ou.MAX_GLYPHS&&$t("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Gi.sortKey!==void 0&&vr.addToSortKeyRanges(vr.symbolInstances.length,Gi.sortKey);const d1=Om(ns,Gi,Go),[p1,f1]=function(Ms,Ka){const Oc=Ms.length,Wo=Ka==null?void 0:Ka.values;if((Wo==null?void 0:Wo.length)>0)for(let jc=0;jc<Wo.length;jc+=2){const Tl=Wo[jc+1];Ms.emplaceBack(f.ax[Wo[jc]],Tl[0],Tl[1])}return[Oc,Ms.length]}(vr.textAnchorOffsets,d1);vr.symbolInstances.emplaceBack(si.x,si.y,Yl.right>=0?Yl.right:-1,Yl.center>=0?Yl.center:-1,Yl.left>=0?Yl.left:-1,Yl.vertical||-1,ep,tp,Xm,n1,s1,a1,o1,l1,c1,u1,h1,$n,Wm,Hm,Gm,$m,Km,0,Zs,$o,p1,f1)}(i,Tr,Cr,n,o,d,Jt,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,Me,[me,me,me,me],qt,C,Be,Ve,St,ee,t,_,z,R,b)};if(Ct==="line")for(const Cr of Lm(t.geometry,0,0,ut,ut)){const Tr=Rc(Cr,Nt),vr=Y0(Tr,X,xt,n.vertical||ae,o,24,et,i.overscaling,ut);for(const si of vr)ae&&t1(i,ae.text,Wt,si)||fr(Tr,si)}else if(Ct==="line-center"){for(const Cr of t.geometry)if(Cr.length>1){const Tr=Rc(Cr,Nt),vr=X0(Tr,xt,n.vertical||ae,o,24,et);vr&&fr(Tr,vr)}}else if(t.type==="Polygon")for(const Cr of Ps(t.geometry,0)){const Tr=J0(Cr,16);fr(Rc(Cr[0],Nt,!0),new fc(Tr.x,Tr.y,0))}else if(t.type==="LineString")for(const Cr of t.geometry){const Tr=Rc(Cr,Nt);fr(Tr,new fc(Tr[0].x,Tr[0].y,0))}else if(t.type==="Point")for(const Cr of t.geometry)for(const Tr of Cr)fr([Tr],new fc(Tr.x,Tr.y,0))}function jm(i,t,n,o,d,_,b,S,C,z,R,j,H,Y,ee){const ae=function(et,Be,X,me,Ve,xt,qt,St){const Ct=me.layout.get("text-rotate").evaluate(xt,{})*Math.PI/180,Wt=[];for(const Gt of Be.positionedLines)for(const Jt of Gt.positionedGlyphs){if(!Jt.rect)continue;const Nt=Jt.rect||{};let fr=C0+1,Cr=!0,Tr=1,vr=0;const si=(Ve||St)&&Jt.vertical,an=Jt.metrics.advance*Jt.scale/2;if(St&&Be.verticalizable&&(vr=Gt.lineOffset/2-(Jt.imageName?-(Fn-Jt.metrics.width*Jt.scale)/2:(Jt.scale-1)*Fn)),Jt.imageName){const Hn=qt[Jt.imageName];Cr=Hn.sdf,Tr=Hn.pixelRatio,fr=ua/Tr}const Nn=Ve?[Jt.x+an,Jt.y]:[0,0];let _s=Ve?[0,0]:[Jt.x+an+X[0],Jt.y+X[1]-vr],Xa=[0,0];si&&(Xa=_s,_s=[0,0]);const ha=Jt.metrics.isDoubleResolution?2:1,ns=(Jt.metrics.left-fr)*Jt.scale-an+_s[0],Qi=(-Jt.metrics.top-fr)*Jt.scale+_s[1],$n=ns+Nt.w/ha*Jt.scale/Tr,ss=Qi+Nt.h/ha*Jt.scale/Tr,as=new de(ns,Qi),Zs=new de($n,Qi),Ya=new de(ns,ss),Wn=new de($n,ss);if(si){const Hn=new de(-an,an-Ih),Xn=-Math.PI/2,Cn=Fn/2-an,Gi=new de(5-Ih-Cn,-(Jt.imageName?Cn:0)),Zo=new de(...Xa);as._rotateAround(Xn,Hn)._add(Gi)._add(Zo),Zs._rotateAround(Xn,Hn)._add(Gi)._add(Zo),Ya._rotateAround(Xn,Hn)._add(Gi)._add(Zo),Wn._rotateAround(Xn,Hn)._add(Gi)._add(Zo)}if(Ct){const Hn=Math.sin(Ct),Xn=Math.cos(Ct),Cn=[Xn,-Hn,Hn,Xn];as._matMult(Cn),Zs._matMult(Cn),Ya._matMult(Cn),Wn._matMult(Cn)}const da=new de(0,0),Rn=new de(0,0);Wt.push({tl:as,tr:Zs,bl:Ya,br:Wn,tex:Nt,writingMode:Be.writingMode,glyphOffset:Nn,sectionIndex:Jt.sectionIndex,isSDF:Cr,pixelOffsetTL:da,pixelOffsetBR:Rn,minFontScaleX:0,minFontScaleY:0})}return Wt}(0,n,S,d,_,b,o,i.allowVerticalPlacement),ye=i.textSizeData;let Me=null;ye.kind==="source"?(Me=[Al*d.layout.get("text-size").evaluate(b,{})],Me[0]>dc&&$t(`${i.layerIds[0]}: Value for "text-size" is >= ${Hu}. Reduce your "text-size".`)):ye.kind==="composite"&&(Me=[Al*Y.compositeTextSizes[0].evaluate(b,{},ee),Al*Y.compositeTextSizes[1].evaluate(b,{},ee)],(Me[0]>dc||Me[1]>dc)&&$t(`${i.layerIds[0]}: Value for "text-size" is >= ${Hu}. Reduce your "text-size".`)),i.addSymbols(i.text,ae,Me,S,_,b,z,t,C.lineStartIndex,C.lineLength,H,ee);for(const et of R)j[et]=i.text.placedSymbolArray.length-1;return 4*ae.length}function qm(i){for(const t in i)return i[t];return null}function t1(i,t,n,o){const d=i.compareText;if(t in d){const _=d[t];for(let b=_.length-1;b>=0;b--)if(o.dist(_[b])<n)return!0}else d[t]=[];return d[t].push(o),!1}const Vm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Wd{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=o>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const _=Vm[15&o];if(!_)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(t,2,1),[S]=new Uint32Array(t,4,1);return new Wd(S,b,_,t)}constructor(t,n=64,o=Float64Array,d){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const _=Vm.indexOf(this.ArrayType),b=2*t*this.ArrayType.BYTES_PER_ELEMENT,S=t*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-S%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${o}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+S+C,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+b+S+C),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+S+C,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=n,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Hd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,o,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:b,nodeSize:S}=this,C=[0,_.length-1,0],z=[];for(;C.length;){const R=C.pop()||0,j=C.pop()||0,H=C.pop()||0;if(j-H<=S){for(let ye=H;ye<=j;ye++){const Me=b[2*ye],et=b[2*ye+1];Me>=t&&Me<=o&&et>=n&&et<=d&&z.push(_[ye])}continue}const Y=H+j>>1,ee=b[2*Y],ae=b[2*Y+1];ee>=t&&ee<=o&&ae>=n&&ae<=d&&z.push(_[Y]),(R===0?t<=ee:n<=ae)&&(C.push(H),C.push(Y-1),C.push(1-R)),(R===0?o>=ee:d>=ae)&&(C.push(Y+1),C.push(j),C.push(1-R))}return z}within(t,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:_,nodeSize:b}=this,S=[0,d.length-1,0],C=[],z=o*o;for(;S.length;){const R=S.pop()||0,j=S.pop()||0,H=S.pop()||0;if(j-H<=b){for(let ye=H;ye<=j;ye++)Zm(_[2*ye],_[2*ye+1],t,n)<=z&&C.push(d[ye]);continue}const Y=H+j>>1,ee=_[2*Y],ae=_[2*Y+1];Zm(ee,ae,t,n)<=z&&C.push(d[Y]),(R===0?t-o<=ee:n-o<=ae)&&(S.push(H),S.push(Y-1),S.push(1-R)),(R===0?t+o>=ee:n+o>=ae)&&(S.push(Y+1),S.push(j),S.push(1-R))}return C}}function Hd(i,t,n,o,d,_){if(d-o<=n)return;const b=o+d>>1;Um(i,t,b,o,d,_),Hd(i,t,n,o,b-1,1-_),Hd(i,t,n,b+1,d,1-_)}function Um(i,t,n,o,d,_){for(;d>o;){if(d-o>600){const z=d-o+1,R=n-o+1,j=Math.log(z),H=.5*Math.exp(2*j/3),Y=.5*Math.sqrt(j*H*(z-H)/z)*(R-z/2<0?-1:1);Um(i,t,n,Math.max(o,Math.floor(n-R*H/z+Y)),Math.min(d,Math.floor(n+(z-R)*H/z+Y)),_)}const b=t[2*n+_];let S=o,C=d;for(Ku(i,t,o,n),t[2*d+_]>b&&Ku(i,t,o,d);S<C;){for(Ku(i,t,S,C),S++,C--;t[2*S+_]<b;)S++;for(;t[2*C+_]>b;)C--}t[2*o+_]===b?Ku(i,t,o,C):(C++,Ku(i,t,C,d)),C<=n&&(o=C+1),n<=C&&(d=C-1)}}function Ku(i,t,n,o){Xd(i,n,o),Xd(t,2*n,2*o),Xd(t,2*n+1,2*o+1)}function Xd(i,t,n){const o=i[t];i[t]=i[n],i[n]=o}function Zm(i,t,n,o){const d=i-n,_=t-o;return d*d+_*_}var Yd;f.cg=void 0,(Yd=f.cg||(f.cg={})).create="create",Yd.load="load",Yd.fullLoad="fullLoad";let Nh=null,Ju=[];const Kd=1e3/60,Jd="loadTime",Qd="fullLoadTime",r1={mark(i){performance.mark(i)},frame(i){const t=i;Nh!=null&&Ju.push(t-Nh),Nh=t},clearMetrics(){Nh=null,Ju=[],performance.clearMeasures(Jd),performance.clearMeasures(Qd);for(const i in f.cg)performance.clearMarks(f.cg[i])},getPerformanceMetrics(){performance.measure(Jd,f.cg.create,f.cg.load),performance.measure(Qd,f.cg.create,f.cg.fullLoad);const i=performance.getEntriesByName(Jd)[0].duration,t=performance.getEntriesByName(Qd)[0].duration,n=Ju.length,o=1/(Ju.reduce((_,b)=>_+b,0)/n/1e3),d=Ju.filter(_=>_>Kd).reduce((_,b)=>_+(b-Kd)/Kd,0);return{loadTime:i,fullLoadTime:t,fps:o,percentDroppedFrames:d/(n+d)*100,totalFrames:n}}};f.$=Xu,f.A=Ue,f.B=dn,f.C=ct,f.D=Ft,f.E=K,f.F=wl,f.G=function(i){if(dr==null){const t=i.navigator?i.navigator.userAgent:null;dr=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return dr},f.H=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new $0(()=>this.process()),this.subscription=ir(this.target,"message",n=>this.receive(n),!1),this.globalScope=nr(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((n,o)=>{const d=Math.round(1e18*Math.random()).toString(36).substring(0,10),_=t?ir(t.signal,"abort",()=>{_==null||_.unsubscribe(),delete this.resolveRejects[d];const C={id:d,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(C)},W0):null;this.resolveRejects[d]={resolve:C=>{_==null||_.unsubscribe(),n(C)},reject:C=>{_==null||_.unsubscribe(),o(C)}};const b=[],S=Object.assign(Object.assign({},i),{id:d,sourceMapId:this.mapId,origin:location.origin,data:Ga(i.data,b)});this.target.postMessage(S,{transfer:b})})}receive(i){const t=i.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if(nr(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return s(this,void 0,void 0,function*(){if(t.type==="<response>"){const d=this.resolveRejects[i];return delete this.resolveRejects[i],d?void(t.error?d.reject(vo(t.error)):d.resolve(vo(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=vo(t.data),o=new AbortController;this.abortControllers[i]=o;try{const d=yield this.messageHandlers[t.type](t.sourceMapId,n,o);this.completeTask(i,null,d)}catch(d){this.completeTask(i,d)}})}completeTask(i,t,n){const o=[];delete this.abortControllers[i];const d={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Ga(t):null,data:Ga(n,o)};this.target.postMessage(d,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},f.I=Dd,f.J=Fr,f.K=function(){var i=new Ue(16);return Ue!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},f.L=function(i,t,n){var o,d,_,b,S,C,z,R,j,H,Y,ee,ae=n[0],ye=n[1],Me=n[2];return t===i?(i[12]=t[0]*ae+t[4]*ye+t[8]*Me+t[12],i[13]=t[1]*ae+t[5]*ye+t[9]*Me+t[13],i[14]=t[2]*ae+t[6]*ye+t[10]*Me+t[14],i[15]=t[3]*ae+t[7]*ye+t[11]*Me+t[15]):(d=t[1],_=t[2],b=t[3],S=t[4],C=t[5],z=t[6],R=t[7],j=t[8],H=t[9],Y=t[10],ee=t[11],i[0]=o=t[0],i[1]=d,i[2]=_,i[3]=b,i[4]=S,i[5]=C,i[6]=z,i[7]=R,i[8]=j,i[9]=H,i[10]=Y,i[11]=ee,i[12]=o*ae+S*ye+j*Me+t[12],i[13]=d*ae+C*ye+H*Me+t[13],i[14]=_*ae+z*ye+Y*Me+t[14],i[15]=b*ae+R*ye+ee*Me+t[15]),i},f.M=function(i,t,n){var o=n[0],d=n[1],_=n[2];return i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i[3]=t[3]*o,i[4]=t[4]*d,i[5]=t[5]*d,i[6]=t[6]*d,i[7]=t[7]*d,i[8]=t[8]*_,i[9]=t[9]*_,i[10]=t[10]*_,i[11]=t[11]*_,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},f.N=function(i,t,n){var o=t[0],d=t[1],_=t[2],b=t[3],S=t[4],C=t[5],z=t[6],R=t[7],j=t[8],H=t[9],Y=t[10],ee=t[11],ae=t[12],ye=t[13],Me=t[14],et=t[15],Be=n[0],X=n[1],me=n[2],Ve=n[3];return i[0]=Be*o+X*S+me*j+Ve*ae,i[1]=Be*d+X*C+me*H+Ve*ye,i[2]=Be*_+X*z+me*Y+Ve*Me,i[3]=Be*b+X*R+me*ee+Ve*et,i[4]=(Be=n[4])*o+(X=n[5])*S+(me=n[6])*j+(Ve=n[7])*ae,i[5]=Be*d+X*C+me*H+Ve*ye,i[6]=Be*_+X*z+me*Y+Ve*Me,i[7]=Be*b+X*R+me*ee+Ve*et,i[8]=(Be=n[8])*o+(X=n[9])*S+(me=n[10])*j+(Ve=n[11])*ae,i[9]=Be*d+X*C+me*H+Ve*ye,i[10]=Be*_+X*z+me*Y+Ve*Me,i[11]=Be*b+X*R+me*ee+Ve*et,i[12]=(Be=n[12])*o+(X=n[13])*S+(me=n[14])*j+(Ve=n[15])*ae,i[13]=Be*d+X*C+me*H+Ve*ye,i[14]=Be*_+X*z+me*Y+Ve*Me,i[15]=Be*b+X*R+me*ee+Ve*et,i},f.O=function(i,t){const n={};for(let o=0;o<t.length;o++){const d=t[o];d in i&&(n[d]=i[d])}return n},f.P=de,f.Q=pc,f.R=Wa,f.S=vm,f.T=kt,f.U=ym,f.V=He,f.W=Oe,f.X=zr,f.Y=Ha,f.Z=ut,f._=s,f.a=wr,f.a$=function(){const i=new Float32Array(16);return lt(i),i},f.a0=Zd,f.a1=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(n=>{t.onloadstart=()=>{n(t)};for(const o of i){const d=window.document.createElement("source");Rr(o)||(t.crossOrigin="Anonymous"),d.src=o,t.appendChild(d)}})},f.a2=je,f.a3=function(){return nt++},f.a4=P,f.a5=ou,f.a6=jo,f.a7=ca,f.a8=Tm,f.a9=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,d,_)=>{const b=d||_;return t[o]=!b||b.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},f.aA=Nd,f.aB=Wd,f.aC=Hr,f.aD=Sh,f.aE=Se,f.aF=_r,f.aG=tr,f.aH=function(i){return Math.pow(2,i)},f.aI=85.051129,f.aJ=bm,f.aK=Re,f.aL=ar,f.aM=xm,f.aN=function(i,t,n){return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i},f.aO=function(i,t,n){return i[0]=t[0]+n[0],i[1]=t[1]+n[1],i[2]=t[2]+n[2],i},f.aP=function(i){var t=new Ue(3);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t},f.aQ=function(i,t,n){return i[0]=t[0]*n[0],i[1]=t[1]*n[1],i[2]=t[2]*n[2],i[3]=t[3]*n[3],i},f.aR=function(i,t,n){return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],i},f.aS=function(i,t){var n=t[0],o=t[1],d=t[2],_=n*n+o*o+d*d;return _>0&&(_=1/Math.sqrt(_)),i[0]=t[0]*_,i[1]=t[1]*_,i[2]=t[2]*_,i},f.aT=function(i,t,n){var o=t[0],d=t[1],_=t[2],b=n[0],S=n[1],C=n[2];return i[0]=d*C-_*S,i[1]=_*b-o*C,i[2]=o*S-d*b,i},f.aU=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]},f.aV=Pm,f.aW=lu,f.aX=function(i,t,n,o,d){var _,b=1/Math.tan(t/2);return i[0]=b/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,d!=null&&d!==1/0?(i[10]=(d+o)*(_=1/(o-d)),i[14]=2*d*o*_):(i[10]=-1,i[14]=-2*o),i},f.aY=function(i){var t=new Ue(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},f.aZ=function(i,t,n){var o=Math.sin(n),d=Math.cos(n),_=t[0],b=t[1],S=t[2],C=t[3],z=t[4],R=t[5],j=t[6],H=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=_*d+z*o,i[1]=b*d+R*o,i[2]=S*d+j*o,i[3]=C*d+H*o,i[4]=z*d-_*o,i[5]=R*d-b*o,i[6]=j*d-S*o,i[7]=H*d-C*o,i},f.a_=function(i,t,n){var o=Math.sin(n),d=Math.cos(n),_=t[4],b=t[5],S=t[6],C=t[7],z=t[8],R=t[9],j=t[10],H=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=_*d+z*o,i[5]=b*d+R*o,i[6]=S*d+j*o,i[7]=C*d+H*o,i[8]=z*d-_*o,i[9]=R*d-b*o,i[10]=j*d-S*o,i[11]=H*d-C*o,i},f.aa=function(i){return Math.log(i)/Math.LN2},f.ab=function(i){var t=i[0],n=i[1];return t*t+n*n},f.ac=function(i){return i*Math.PI/180},f.ad=Ie,f.ae=function(i,t){const n=[];for(const o in i)o in t||n.push(o);return n},f.af=function(i,t){let n=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:d,minZoom:_,maxZoom:b}=i,S=d?Ie(ji.interpolationFactor(d,t,_,b),0,1):0;i.kind==="camera"?o=dn.number(i.minSize,i.maxSize,S):n=S}return{uSizeT:n,uSize:o}},f.ah=function(i,{uSize:t,uSizeT:n},{lowerSize:o,upperSize:d}){return i.kind==="source"?o/Al:i.kind==="composite"?dn.number(o/Al,d/Al,n):t},f.ai=function(i,t){var n=t[0],o=t[1],d=t[2],_=t[3],b=t[4],S=t[5],C=t[6],z=t[7],R=t[8],j=t[9],H=t[10],Y=t[11],ee=t[12],ae=t[13],ye=t[14],Me=t[15],et=n*S-o*b,Be=n*C-d*b,X=n*z-_*b,me=o*C-d*S,Ve=o*z-_*S,xt=d*z-_*C,qt=R*ae-j*ee,St=R*ye-H*ee,Ct=R*Me-Y*ee,Wt=j*ye-H*ae,Gt=j*Me-Y*ae,Jt=H*Me-Y*ye,Nt=et*Jt-Be*Gt+X*Wt+me*Ct-Ve*St+xt*qt;return Nt?(i[0]=(S*Jt-C*Gt+z*Wt)*(Nt=1/Nt),i[1]=(d*Gt-o*Jt-_*Wt)*Nt,i[2]=(ae*xt-ye*Ve+Me*me)*Nt,i[3]=(H*Ve-j*xt-Y*me)*Nt,i[4]=(C*Ct-b*Jt-z*St)*Nt,i[5]=(n*Jt-d*Ct+_*St)*Nt,i[6]=(ye*X-ee*xt-Me*Be)*Nt,i[7]=(R*xt-H*X+Y*Be)*Nt,i[8]=(b*Gt-S*Ct+z*qt)*Nt,i[9]=(o*Ct-n*Gt-_*qt)*Nt,i[10]=(ee*Ve-ae*X+Me*et)*Nt,i[11]=(j*X-R*Ve-Y*et)*Nt,i[12]=(S*St-b*Wt-C*qt)*Nt,i[13]=(n*Wt-o*St+d*qt)*Nt,i[14]=(ae*Be-ee*me-ye*et)*Nt,i[15]=(R*me-j*Be+H*et)*Nt,i):null},f.aj=Ne,f.ak=function(i){return Math.hypot(i[0],i[1])},f.al=function(i){return i[0]=0,i[1]=0,i},f.am=function(i,t,n){return i[0]=t[0]*n,i[1]=t[1]*n,i},f.an=Bd,f.ao=ve,f.ap=function(i,t,n,o){const d=t.y-i.y,_=t.x-i.x,b=o.y-n.y,S=o.x-n.x,C=b*_-S*d;if(C===0)return null;const z=(S*(i.y-n.y)-b*(i.x-n.x))/C;return new de(i.x+z*_,i.y+z*d)},f.aq=Lm,f.ar=eu,f.as=lt,f.at=function(i){let t=1/0,n=1/0,o=-1/0,d=-1/0;for(const _ of i)t=Math.min(t,_.x),n=Math.min(n,_.y),o=Math.max(o,_.x),d=Math.max(d,_.y);return[t,n,o,d]},f.au=Fn,f.av=At,f.aw=function(i,t,n,o,d=!1){if(!n[0]&&!n[1])return[0,0];const _=d?o==="map"?-i.bearingInRadians:0:o==="viewport"?i.bearingInRadians:0;if(_){const b=Math.sin(_),S=Math.cos(_);n=[n[0]*S-n[1]*b,n[0]*b+n[1]*S]}return[d?n[0]:At(t,n[0],i.zoom),d?n[1]:At(t,n[1],i.zoom)]},f.ay=Rd,f.az=$d,f.b=Et,f.b$=i=>i.type==="circle",f.b0=function(){const i=new Float64Array(16);return lt(i),i},f.b1=function(){return new Float64Array(16)},f.b2=function(i,t,n){const o=new Float64Array(4);return function(d,_,b,S){var C=.5*Math.PI/180;_*=C,b*=C,S*=C;var z=Math.sin(_),R=Math.cos(_),j=Math.sin(b),H=Math.cos(b),Y=Math.sin(S),ee=Math.cos(S);d[0]=z*H*ee-R*j*Y,d[1]=R*j*ee+z*H*Y,d[2]=R*H*Y-z*j*ee,d[3]=R*H*ee+z*j*Y}(o,i,t-90,n),o},f.b3=function(i,t,n,o){var d,_,b,S,C,z=t[0],R=t[1],j=t[2],H=t[3],Y=n[0],ee=n[1],ae=n[2],ye=n[3];return(_=z*Y+R*ee+j*ae+H*ye)<0&&(_=-_,Y=-Y,ee=-ee,ae=-ae,ye=-ye),1-_>Ke?(d=Math.acos(_),b=Math.sin(d),S=Math.sin((1-o)*d)/b,C=Math.sin(o*d)/b):(S=1-o,C=o),i[0]=S*z+C*Y,i[1]=S*R+C*ee,i[2]=S*j+C*ae,i[3]=S*H+C*ye,i},f.b4=function(i){const t=new Float64Array(9);var n,o,d,_,b,S,C,z,R,j,H,Y,ee,ae,ye,Me,et,Be;j=(d=(o=i)[0])*(C=d+d),H=(_=o[1])*C,ee=(b=o[2])*C,ae=b*(z=_+_),Me=(S=o[3])*C,et=S*z,Be=S*(R=b+b),(n=t)[0]=1-(Y=_*z)-(ye=b*R),n[3]=H-Be,n[6]=ee+et,n[1]=H+Be,n[4]=1-j-ye,n[7]=ae-Me,n[2]=ee-et,n[5]=ae+Me,n[8]=1-j-Y;const X=ar(-Math.asin(Ie(t[2],-1,1)));let me,Ve;return Math.hypot(t[5],t[8])<.001?(me=0,Ve=-ar(Math.atan2(t[3],t[4]))):(me=ar(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),Ve=ar(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:me,pitch:X+90,bearing:Ve}},f.b5=function(i,t){return i.roll==t.roll&&i.pitch==t.pitch&&i.bearing==t.bearing},f.b6=ei,f.b7=ms,f.b8=su,f.b9=qu,f.bA=function(i){const t=[],n=i.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},f.bB=function i(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(!i(t[o],n[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const o in t)if(!i(t[o],n[o]))return!1;return!0}return t===n},f.bC=at,f.bD=pt,f.bE=class extends xn{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},f.bF=$a,f.bG=class extends xn{constructor(i,t){super(i,t),this.current=Is}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},f.bH=bo,f.bI=class extends xn{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},f.bJ=class extends xn{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},f.bK=Ae,f.bL=function(i,t){var n=Math.sin(t),o=Math.cos(t);return i[0]=o,i[1]=n,i[2]=0,i[3]=-n,i[4]=o,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},f.bM=function(i,t,n){var o=t[0],d=t[1],_=t[2];return i[0]=o*n[0]+d*n[3]+_*n[6],i[1]=o*n[1]+d*n[4]+_*n[7],i[2]=o*n[2]+d*n[5]+_*n[8],i},f.bN=function(i,t,n,o,d,_,b){var S=1/(t-n),C=1/(o-d),z=1/(_-b);return i[0]=-2*S,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*C,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*z,i[11]=0,i[12]=(t+n)*S,i[13]=(d+o)*C,i[14]=(b+_)*z,i[15]=1,i},f.bO=class extends Aa{},f.bP=w0,f.bQ=class extends la{},f.bR=yd,f.bS=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},f.bT=Af,f.bU=function(i,t,n){var o=t[0],d=t[1],_=t[2],b=n[3]*o+n[7]*d+n[11]*_+n[15];return i[0]=(n[0]*o+n[4]*d+n[8]*_+n[12])/(b=b||1),i[1]=(n[1]*o+n[5]*d+n[9]*_+n[13])/b,i[2]=(n[2]*o+n[6]*d+n[10]*_+n[14])/b,i},f.bV=class extends gi{},f.bW=class extends l{},f.bX=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},f.bY=function(i,t){var n=i[0],o=i[1],d=i[2],_=i[3],b=i[4],S=i[5],C=i[6],z=i[7],R=i[8],j=i[9],H=i[10],Y=i[11],ee=i[12],ae=i[13],ye=i[14],Me=i[15],et=t[0],Be=t[1],X=t[2],me=t[3],Ve=t[4],xt=t[5],qt=t[6],St=t[7],Ct=t[8],Wt=t[9],Gt=t[10],Jt=t[11],Nt=t[12],fr=t[13],Cr=t[14],Tr=t[15];return Math.abs(n-et)<=Ke*Math.max(1,Math.abs(n),Math.abs(et))&&Math.abs(o-Be)<=Ke*Math.max(1,Math.abs(o),Math.abs(Be))&&Math.abs(d-X)<=Ke*Math.max(1,Math.abs(d),Math.abs(X))&&Math.abs(_-me)<=Ke*Math.max(1,Math.abs(_),Math.abs(me))&&Math.abs(b-Ve)<=Ke*Math.max(1,Math.abs(b),Math.abs(Ve))&&Math.abs(S-xt)<=Ke*Math.max(1,Math.abs(S),Math.abs(xt))&&Math.abs(C-qt)<=Ke*Math.max(1,Math.abs(C),Math.abs(qt))&&Math.abs(z-St)<=Ke*Math.max(1,Math.abs(z),Math.abs(St))&&Math.abs(R-Ct)<=Ke*Math.max(1,Math.abs(R),Math.abs(Ct))&&Math.abs(j-Wt)<=Ke*Math.max(1,Math.abs(j),Math.abs(Wt))&&Math.abs(H-Gt)<=Ke*Math.max(1,Math.abs(H),Math.abs(Gt))&&Math.abs(Y-Jt)<=Ke*Math.max(1,Math.abs(Y),Math.abs(Jt))&&Math.abs(ee-Nt)<=Ke*Math.max(1,Math.abs(ee),Math.abs(Nt))&&Math.abs(ae-fr)<=Ke*Math.max(1,Math.abs(ae),Math.abs(fr))&&Math.abs(ye-Cr)<=Ke*Math.max(1,Math.abs(ye),Math.abs(Cr))&&Math.abs(Me-Tr)<=Ke*Math.max(1,Math.abs(Me),Math.abs(Tr))},f.bZ=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},f.b_=i=>i.type==="symbol",f.ba=nu,f.bb=Tt,f.bc=Dt,f.bd=mn,f.be=function(i,t,n,o,d){return Tt(o,d,Ie((i-t)/(n-t),0,1))},f.bf=ht,f.bg=function(){return new Float64Array(4)},f.bh=function(){return new Float64Array(3)},f.bi=function(i,t,n,o){var d=[],_=[];return d[0]=t[0]-n[0],d[1]=t[1]-n[1],d[2]=t[2]-n[2],_[0]=d[0]*Math.cos(o)-d[1]*Math.sin(o),_[1]=d[0]*Math.sin(o)+d[1]*Math.cos(o),_[2]=d[2],i[0]=_[0]+n[0],i[1]=_[1]+n[1],i[2]=_[2]+n[2],i},f.bj=function(i,t,n,o){var d=[],_=[];return d[0]=t[0]-n[0],d[1]=t[1]-n[1],d[2]=t[2]-n[2],_[0]=d[0],_[1]=d[1]*Math.cos(o)-d[2]*Math.sin(o),_[2]=d[1]*Math.sin(o)+d[2]*Math.cos(o),i[0]=_[0]+n[0],i[1]=_[1]+n[1],i[2]=_[2]+n[2],i},f.bk=function(i,t,n,o){var d=[],_=[];return d[0]=t[0]-n[0],d[1]=t[1]-n[1],d[2]=t[2]-n[2],_[0]=d[2]*Math.sin(o)+d[0]*Math.cos(o),_[1]=d[1],_[2]=d[2]*Math.cos(o)-d[0]*Math.sin(o),i[0]=_[0]+n[0],i[1]=_[1]+n[1],i[2]=_[2]+n[2],i},f.bl=function(i,t,n){var o=Math.sin(n),d=Math.cos(n),_=t[0],b=t[1],S=t[2],C=t[3],z=t[8],R=t[9],j=t[10],H=t[11];return t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=_*d-z*o,i[1]=b*d-R*o,i[2]=S*d-j*o,i[3]=C*d-H*o,i[8]=_*o+z*d,i[9]=b*o+R*d,i[10]=S*o+j*d,i[11]=C*o+H*d,i},f.bm=function(i,t){const n=ht(i,360),o=ht(t,360),d=o-n,_=o>n?d-360:d+360;return Math.abs(d)<Math.abs(_)?d:_},f.bn=function(i){return i[0]=0,i[1]=0,i[2]=0,i},f.bo=function(i,t,n,o){const d=Math.sqrt(i*i+t*t),_=Math.sqrt(n*n+o*o);i/=d,t/=d,n/=_,o/=_;const b=Math.acos(i*n+t*o);return-t*n+i*o>0?b:-b},f.bp=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]},f.bq=Vd,f.br=function(i,t){const n=ht(i,2*Math.PI),o=ht(t,2*Math.PI);return Math.min(Math.abs(n-o),Math.abs(n-o+2*Math.PI),Math.abs(n-o-2*Math.PI))},f.bs=function(i){return Math.hypot(i[0],i[1],i[2])},f.bt=function(){const i={},t=x.$version;for(const n in x.$root){const o=x.$root[n];if(o.required){let d=null;d=n==="version"?t:o.type==="array"?[]:{},d!=null&&(i[n]=d)}}return i},f.bu=uc,f.bv=Jr,f.bw=function(i){i=i.slice();const t=Object.create(null);for(let n=0;n<i.length;n++)t[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=O(i[n],t[i[n].ref]));return i},f.bx=function(i){if(i.type==="custom")return new G0(i);switch(i.type){case"background":return new V0(i);case"circle":return new Ry(i);case"fill":return new r0(i);case"fill-extrusion":return new u0(i);case"heatmap":return new Oy(i);case"hillshade":return new qy(i);case"line":return new y0(i);case"raster":return new Z0(i);case"symbol":return new Eh(i)}},f.by=gt,f.bz=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let n=[];try{if(!G(i.version,t.version))return[{command:"setStyle",args:[t]}];G(i.center,t.center)||n.push({command:"setCenter",args:[t.center]}),G(i.centerAltitude,t.centerAltitude)||n.push({command:"setCenterAltitude",args:[t.centerAltitude]}),G(i.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),G(i.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),G(i.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),G(i.roll,t.roll)||n.push({command:"setRoll",args:[t.roll]}),G(i.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),G(i.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),G(i.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),G(i.light,t.light)||n.push({command:"setLight",args:[t.light]}),G(i.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),G(i.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),G(i.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const o={},d=[];(function(b,S,C,z){let R;for(R in S=S||{},b=b||{})Object.prototype.hasOwnProperty.call(b,R)&&(Object.prototype.hasOwnProperty.call(S,R)||Te(R,C,z));for(R in S)Object.prototype.hasOwnProperty.call(S,R)&&(Object.prototype.hasOwnProperty.call(b,R)?G(b[R],S[R])||(b[R].type==="geojson"&&S[R].type==="geojson"&&xe(b,S,R)?Q(C,{command:"setGeoJSONSourceData",args:[R,S[R].data]}):ue(R,S,C,z)):le(R,S,C))})(i.sources,t.sources,d,o);const _=[];i.layers&&i.layers.forEach(b=>{"source"in b&&o[b.source]?n.push({command:"removeLayer",args:[b.id]}):_.push(b)}),n=n.concat(d),function(b,S,C){S=S||[];const z=(b=b||[]).map(ze),R=S.map(ze),j=b.reduce(Qe,{}),H=S.reduce(Qe,{}),Y=z.slice(),ee=Object.create(null);let ae,ye,Me,et,Be;for(let X=0,me=0;X<z.length;X++)ae=z[X],Object.prototype.hasOwnProperty.call(H,ae)?me++:(Q(C,{command:"removeLayer",args:[ae]}),Y.splice(Y.indexOf(ae,me),1));for(let X=0,me=0;X<R.length;X++)ae=R[R.length-1-X],Y[Y.length-1-X]!==ae&&(Object.prototype.hasOwnProperty.call(j,ae)?(Q(C,{command:"removeLayer",args:[ae]}),Y.splice(Y.lastIndexOf(ae,Y.length-me),1)):me++,et=Y[Y.length-X],Q(C,{command:"addLayer",args:[H[ae],et]}),Y.splice(Y.length-X,0,ae),ee[ae]=!0);for(let X=0;X<R.length;X++)if(ae=R[X],ye=j[ae],Me=H[ae],!ee[ae]&&!G(ye,Me))if(G(ye.source,Me.source)&&G(ye["source-layer"],Me["source-layer"])&&G(ye.type,Me.type)){for(Be in we(ye.layout,Me.layout,C,ae,null,"setLayoutProperty"),we(ye.paint,Me.paint,C,ae,null,"setPaintProperty"),G(ye.filter,Me.filter)||Q(C,{command:"setFilter",args:[ae,Me.filter]}),G(ye.minzoom,Me.minzoom)&&G(ye.maxzoom,Me.maxzoom)||Q(C,{command:"setLayerZoomRange",args:[ae,Me.minzoom,Me.maxzoom]}),ye)Object.prototype.hasOwnProperty.call(ye,Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&(Be.indexOf("paint.")===0?we(ye[Be],Me[Be],C,ae,Be.slice(6),"setPaintProperty"):G(ye[Be],Me[Be])||Q(C,{command:"setLayerProperty",args:[ae,Be,Me[Be]]}));for(Be in Me)Object.prototype.hasOwnProperty.call(Me,Be)&&!Object.prototype.hasOwnProperty.call(ye,Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&(Be.indexOf("paint.")===0?we(ye[Be],Me[Be],C,ae,Be.slice(6),"setPaintProperty"):G(ye[Be],Me[Be])||Q(C,{command:"setLayerProperty",args:[ae,Be,Me[Be]]}))}else Q(C,{command:"removeLayer",args:[ae]}),et=Y[Y.lastIndexOf(ae)+1],Q(C,{command:"addLayer",args:[Me,et]})}(_,t.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[t]}]}return n},f.c=xr,f.c0=i=>i.type==="heatmap",f.c1=i=>i.type==="line",f.c2=i=>i.type==="fill",f.c3=i=>i.type==="fill-extrusion",f.c4=i=>i.type==="hillshade",f.c5=i=>i.type==="raster",f.c6=i=>i.type==="background",f.c7=i=>i.type==="custom",f.c8=sr,f.c9=function(i,t,n){const o=wt(t.x-n.x,t.y-n.y),d=wt(i.x-n.x,i.y-n.y);var _,b;return ar(Math.atan2(o[0]*d[1]-o[1]*d[0],(_=o)[0]*(b=d)[0]+_[1]*b[1]))},f.cA=U,f.cB=Vf,f.cC=em,f.cD=Va,f.cE=_t,f.ca=ne,f.cb=function(i,t,n){var o=t[0],d=t[1];return i[0]=n[0]*o+n[4]*d+n[12],i[1]=n[1]*o+n[5]*d+n[13],i},f.cc=function(i,t){const{x:n,y:o}=Xu.fromLngLat(t);return!(i<0||i>25||o<0||o>=1||n<0||n>=1)},f.cd=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},f.ce=class extends kn{},f.cf=r1,f.ch=function(i){return i.message===or},f.ci=Zr,f.cj=function(i,t){wr.REGISTERED_PROTOCOLS[i]=t},f.ck=function(i){delete wr.REGISTERED_PROTOCOLS[i]},f.cl=function(i,t){const n={};for(let d=0;d<i.length;d++){const _=t&&t[i[d].id]||oc(i[d]);t&&(t[i[d].id]=_);let b=n[_];b||(b=n[_]=[]),b.push(i[d])}const o=[];for(const d in n)o.push(n[d]);return o},f.cm=hr,f.cn=Am,f.co=Im,f.cp=rm,f.cq=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=ut/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],n=t.layout,o=t._unevaluatedLayout._values,d={layoutIconSize:o["icon-size"].possiblyEvaluate(new ct(i.bucket.zoom+1),i.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new ct(i.bucket.zoom+1),i.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new ct(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:z,maxZoom:R}=i.bucket.textSizeData;d.compositeTextSizes=[o["text-size"].possiblyEvaluate(new ct(z),i.canonical),o["text-size"].possiblyEvaluate(new ct(R),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:z,maxZoom:R}=i.bucket.iconSizeData;d.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new ct(z),i.canonical),o["icon-size"].possiblyEvaluate(new ct(R),i.canonical)]}const _=n.get("text-line-height")*Fn,b=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",S=n.get("text-keep-upright"),C=n.get("text-size");for(const z of i.bucket.features){const R=n.get("text-font").evaluate(z,{},i.canonical).join(","),j=C.evaluate(z,{},i.canonical),H=d.layoutTextSize.evaluate(z,{},i.canonical),Y=d.layoutIconSize.evaluate(z,{},i.canonical),ee={horizontal:{},vertical:void 0},ae=z.text;let ye,Me=[0,0];if(ae){const X=ae.toString(),me=n.get("text-letter-spacing").evaluate(z,{},i.canonical)*Fn,Ve=w(X)?me:0,xt=n.get("text-anchor").evaluate(z,{},i.canonical),qt=Om(t,z,i.canonical);if(!qt){const Gt=n.get("text-radial-offset").evaluate(z,{},i.canonical);Me=Gt?Bm(xt,[Gt*Fn,Gd]):n.get("text-offset").evaluate(z,{},i.canonical).map(Jt=>Jt*Fn)}let St=b?"center":n.get("text-justify").evaluate(z,{},i.canonical);const Ct=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(z,{},i.canonical)*Fn:1/0,Wt=()=>{i.bucket.allowVerticalPlacement&&$l(X)&&(ee.vertical=Ch(ae,i.glyphMap,i.glyphPositions,i.imagePositions,R,Ct,_,xt,"left",Ve,Me,f.ag.vertical,!0,H,j))};if(!b&&qt){const Gt=new Set;if(St==="auto")for(let Nt=0;Nt<qt.values.length;Nt+=2)Gt.add($d(qt.values[Nt]));else Gt.add(St);let Jt=!1;for(const Nt of Gt)if(!ee.horizontal[Nt])if(Jt)ee.horizontal[Nt]=ee.horizontal[0];else{const fr=Ch(ae,i.glyphMap,i.glyphPositions,i.imagePositions,R,Ct,_,"center",Nt,Ve,Me,f.ag.horizontal,!1,H,j);fr&&(ee.horizontal[Nt]=fr,Jt=fr.positionedLines.length===1)}Wt()}else{St==="auto"&&(St=$d(xt));const Gt=Ch(ae,i.glyphMap,i.glyphPositions,i.imagePositions,R,Ct,_,xt,St,Ve,Me,f.ag.horizontal,!1,H,j);Gt&&(ee.horizontal[St]=Gt),Wt(),$l(X)&&b&&S&&(ee.vertical=Ch(ae,i.glyphMap,i.glyphPositions,i.imagePositions,R,Ct,_,xt,St,Ve,Me,f.ag.vertical,!1,H,j))}}let et=!1;if(z.icon&&z.icon.name){const X=i.imageMap[z.icon.name];X&&(ye=R0(i.imagePositions[z.icon.name],n.get("icon-offset").evaluate(z,{},i.canonical),n.get("icon-anchor").evaluate(z,{},i.canonical)),et=!!X.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=et:i.bucket.sdfIcons!==et&&$t("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(X.pixelRatio!==i.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const Be=qm(ee.horizontal)||ee.vertical;i.bucket.iconsInText=!!Be&&Be.iconsInText,(Be||ye)&&e1(i.bucket,z,ee,ye,i.imageMap,d,H,Y,Me,et,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},f.cr=Md,f.cs=Pd,f.ct=Cd,f.cu=Uu,f.cv=kd,f.cw=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},f.cx=function(i,t,n,o,d){return s(this,void 0,void 0,function*(){if(Oe())try{return yield zr(i,t,n,o,d)}catch{}return function(_,b,S,C,z){const R=_.width,j=_.height;yr&&Xt||(yr=new OffscreenCanvas(R,j),Xt=yr.getContext("2d",{willReadFrequently:!0})),yr.width=R,yr.height=j,Xt.drawImage(_,0,0,R,j);const H=Xt.getImageData(b,S,C,z);return Xt.clearRect(0,0,R,j),H.data}(i,t,n,o,d)})},f.cy=Sm,f.cz=M,f.d=Rr,f.e=We,f.f=i=>s(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),f.g=Dr,f.h=i=>new Promise((t,n)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=qe})},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const d=new Blob([new Uint8Array(i)],{type:"image/png"});o.src=i.byteLength?URL.createObjectURL(d):qe}),f.i=nr,f.j=(i,t)=>Mr(We(i,{type:"json"}),t),f.k=Bi,f.l=Qr,f.m=Mr,f.n=(i,t)=>Mr(We(i,{type:"arrayBuffer"}),t),f.o=function(i){return new kd(i).readFields(A0,[])},f.p=tm,f.q=Nu,f.r=$r,f.s=ir,f.t=yo,f.u=Gr,f.v=x,f.w=$t,f.x=Zl,f.y=Za,f.z=function([i,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(n),y:i*Math.sin(t)*Math.sin(n),z:i*Math.cos(n)}}}),v("worker",["./shared"],function(f){class s{constructor(x){this.keyCache={},x&&this.replace(x)}replace(x){this._layerConfigs={},this._layers={},this.update(x,[])}update(x,A){for(const G of x){this._layerConfigs[G.id]=G;const Q=this._layers[G.id]=f.bx(G);Q._featureFilter=f.a6(Q.filter),this.keyCache[G.id]&&delete this.keyCache[G.id]}for(const G of A)delete this.keyCache[G],delete this._layerConfigs[G],delete this._layers[G];this.familiesBySource={};const O=f.cl(Object.values(this._layerConfigs),this.keyCache);for(const G of O){const Q=G.map(ze=>this._layers[ze.id]),le=Q[0];if(le.visibility==="none")continue;const Te=le.source||"";let ue=this.familiesBySource[Te];ue||(ue=this.familiesBySource[Te]={});const xe=le.sourceLayer||"_geojsonTileLayer";let we=ue[xe];we||(we=ue[xe]=[]),we.push(Q)}}}class M{constructor(x){const A={},O=[];for(const Te in x){const ue=x[Te],xe=A[Te]={};for(const we in ue){const ze=ue[+we];if(!ze||ze.bitmap.width===0||ze.bitmap.height===0)continue;const Qe={x:0,y:0,w:ze.bitmap.width+2,h:ze.bitmap.height+2};O.push(Qe),xe[we]={rect:Qe,metrics:ze.metrics}}}const{w:G,h:Q}=f.p(O),le=new f.q({width:G||1,height:Q||1});for(const Te in x){const ue=x[Te];for(const xe in ue){const we=ue[+xe];if(!we||we.bitmap.width===0||we.bitmap.height===0)continue;const ze=A[Te][xe].rect;f.q.copy(we.bitmap,le,{x:0,y:0},{x:ze.x+1,y:ze.y+1},we.bitmap)}}this.image=le,this.positions=A}}f.cm("GlyphAtlas",M);class B{constructor(x){this.tileID=new f.Y(x.tileID.overscaledZ,x.tileID.wrap,x.tileID.canonical.z,x.tileID.canonical.x,x.tileID.canonical.y),this.uid=x.uid,this.zoom=x.zoom,this.pixelRatio=x.pixelRatio,this.tileSize=x.tileSize,this.source=x.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=x.showCollisionBoxes,this.collectResourceTiming=!!x.collectResourceTiming,this.returnDependencies=!!x.returnDependencies,this.promoteId=x.promoteId,this.inFlightDependencies=[]}parse(x,A,O,G,Q){return f._(this,void 0,void 0,function*(){this.status="parsing",this.data=x,this.collisionBoxArray=new f.a4;const le=new f.cn(Object.keys(x.layers).sort()),Te=new f.co(this.tileID,this.promoteId);Te.bucketLayerIDs=[];const ue={},xe={featureIndex:Te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:O,subdivisionGranularity:Q},we=A.familiesBySource[this.source];for(const Sr in we){const Ir=x.layers[Sr];if(!Ir)continue;Ir.version===1&&f.w(`Vector tile source "${this.source}" layer "${Sr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const pr=le.encode(Sr),en=[];for(let di=0;di<Ir.length;di++){const yi=Ir.feature(di),ri=Te.getId(yi,Sr);en.push({feature:yi,id:ri,index:di,sourceLayerIndex:pr})}for(const di of we[Sr]){const yi=di[0];yi.source!==this.source&&f.w(`layer.source = ${yi.source} does not equal this.source = ${this.source}`),yi.minzoom&&this.zoom<Math.floor(yi.minzoom)||yi.maxzoom&&this.zoom>=yi.maxzoom||yi.visibility!=="none"&&(V(di,this.zoom,O),(ue[yi.id]=yi.createBucket({index:Te.bucketLayerIDs.length,layers:di,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:pr,sourceID:this.source})).populate(en,xe,this.tileID.canonical),Te.bucketLayerIDs.push(di.map(ri=>ri.id)))}}const ze=f.bC(xe.glyphDependencies,Sr=>Object.keys(Sr).map(Number));this.inFlightDependencies.forEach(Sr=>Sr==null?void 0:Sr.abort()),this.inFlightDependencies=[];let Qe=Promise.resolve({});if(Object.keys(ze).length){const Sr=new AbortController;this.inFlightDependencies.push(Sr),Qe=G.sendAsync({type:"GG",data:{stacks:ze,source:this.source,tileID:this.tileID,type:"glyphs"}},Sr)}const je=Object.keys(xe.iconDependencies);let ft=Promise.resolve({});if(je.length){const Sr=new AbortController;this.inFlightDependencies.push(Sr),ft=G.sendAsync({type:"GI",data:{icons:je,source:this.source,tileID:this.tileID,type:"icons"}},Sr)}const Pt=Object.keys(xe.patternDependencies);let rr=Promise.resolve({});if(Pt.length){const Sr=new AbortController;this.inFlightDependencies.push(Sr),rr=G.sendAsync({type:"GI",data:{icons:Pt,source:this.source,tileID:this.tileID,type:"patterns"}},Sr)}const[lr,yt,Zt]=yield Promise.all([Qe,ft,rr]),Qt=new M(lr),Pr=new f.cp(yt,Zt);for(const Sr in ue){const Ir=ue[Sr];Ir instanceof f.a5?(V(Ir.layers,this.zoom,O),f.cq({bucket:Ir,glyphMap:lr,glyphPositions:Qt.positions,imageMap:yt,imagePositions:Pr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:xe.subdivisionGranularity})):Ir.hasPattern&&(Ir instanceof f.cr||Ir instanceof f.cs||Ir instanceof f.ct)&&(V(Ir.layers,this.zoom,O),Ir.addFeatures(xe,this.tileID.canonical,Pr.patternPositions))}return this.status="done",{buckets:Object.values(ue).filter(Sr=>!Sr.isEmpty()),featureIndex:Te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Qt.image,imageAtlas:Pr,glyphMap:this.returnDependencies?lr:null,iconMap:this.returnDependencies?yt:null,glyphPositions:this.returnDependencies?Qt.positions:null}})}}function V(K,x,A){const O=new f.C(x);for(const G of K)G.recalculate(O,A)}class U{constructor(x,A,O){this.actor=x,this.layerIndex=A,this.availableImages=O,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(x,A){return f._(this,void 0,void 0,function*(){const O=yield f.n(x.request,A);try{return{vectorTile:new f.cu.VectorTile(new f.cv(O.data)),rawData:O.data,cacheControl:O.cacheControl,expires:O.expires}}catch(G){const Q=new Uint8Array(O.data);let le=`Unable to parse the tile at ${x.request.url}, `;throw le+=Q[0]===31&&Q[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${G.message}`,new Error(le)}})}loadTile(x){return f._(this,void 0,void 0,function*(){const A=x.uid,O=!!(x&&x.request&&x.request.collectResourceTiming)&&new f.cw(x.request),G=new B(x);this.loading[A]=G;const Q=new AbortController;G.abort=Q;try{const le=yield this.loadVectorTile(x,Q);if(delete this.loading[A],!le)return null;const Te=le.rawData,ue={};le.expires&&(ue.expires=le.expires),le.cacheControl&&(ue.cacheControl=le.cacheControl);const xe={};if(O){const ze=O.finish();ze&&(xe.resourceTiming=JSON.parse(JSON.stringify(ze)))}G.vectorTile=le.vectorTile;const we=G.parse(le.vectorTile,this.layerIndex,this.availableImages,this.actor,x.subdivisionGranularity);this.loaded[A]=G,this.fetching[A]={rawTileData:Te,cacheControl:ue,resourceTiming:xe};try{const ze=yield we;return f.e({rawTileData:Te.slice(0)},ze,ue,xe)}finally{delete this.fetching[A]}}catch(le){throw delete this.loading[A],G.status="done",this.loaded[A]=G,le}})}reloadTile(x){return f._(this,void 0,void 0,function*(){const A=x.uid;if(!this.loaded||!this.loaded[A])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const O=this.loaded[A];if(O.showCollisionBoxes=x.showCollisionBoxes,O.status==="parsing"){const G=yield O.parse(O.vectorTile,this.layerIndex,this.availableImages,this.actor,x.subdivisionGranularity);let Q;if(this.fetching[A]){const{rawTileData:le,cacheControl:Te,resourceTiming:ue}=this.fetching[A];delete this.fetching[A],Q=f.e({rawTileData:le.slice(0)},G,Te,ue)}else Q=G;return Q}if(O.status==="done"&&O.vectorTile)return O.parse(O.vectorTile,this.layerIndex,this.availableImages,this.actor,x.subdivisionGranularity)})}abortTile(x){return f._(this,void 0,void 0,function*(){const A=this.loading,O=x.uid;A&&A[O]&&A[O].abort&&(A[O].abort.abort(),delete A[O])})}removeTile(x){return f._(this,void 0,void 0,function*(){this.loaded&&this.loaded[x.uid]&&delete this.loaded[x.uid]})}}class J{constructor(){this.loaded={}}loadTile(x){return f._(this,void 0,void 0,function*(){const{uid:A,encoding:O,rawImageData:G,redFactor:Q,greenFactor:le,blueFactor:Te,baseShift:ue}=x,xe=G.width+2,we=G.height+2,ze=f.b(G)?new f.R({width:xe,height:we},yield f.cx(G,-1,-1,xe,we)):G,Qe=new f.cy(A,ze,O,Q,le,Te,ue);return this.loaded=this.loaded||{},this.loaded[A]=Qe,Qe})}removeTile(x){const A=this.loaded,O=x.uid;A&&A[O]&&delete A[O]}}var N,de,pe=function(){if(de)return N;function K(A,O){if(A.length!==0){x(A[0],O);for(var G=1;G<A.length;G++)x(A[G],!O)}}function x(A,O){for(var G=0,Q=0,le=0,Te=A.length,ue=Te-1;le<Te;ue=le++){var xe=(A[le][0]-A[ue][0])*(A[ue][1]+A[le][1]),we=G+xe;Q+=Math.abs(G)>=Math.abs(xe)?G-we+xe:xe-we+G,G=we}G+Q>=0!=!!O&&A.reverse()}return de=1,N=function A(O,G){var Q,le=O&&O.type;if(le==="FeatureCollection")for(Q=0;Q<O.features.length;Q++)A(O.features[Q],G);else if(le==="GeometryCollection")for(Q=0;Q<O.geometries.length;Q++)A(O.geometries[Q],G);else if(le==="Feature")A(O.geometry,G);else if(le==="Polygon")K(O.coordinates,G);else if(le==="MultiPolygon")for(Q=0;Q<O.coordinates.length;Q++)K(O.coordinates[Q],G);return O}}(),De=f.cz(pe);const fe=f.cu.VectorTileFeature.prototype.toGeoJSON;class ke{constructor(x){this._feature=x,this.extent=f.Z,this.type=x.type,this.properties=x.tags,"id"in x&&!isNaN(x.id)&&(this.id=parseInt(x.id,10))}loadGeometry(){if(this._feature.type===1){const x=[];for(const A of this._feature.geometry)x.push([new f.P(A[0],A[1])]);return x}{const x=[];for(const A of this._feature.geometry){const O=[];for(const G of A)O.push(new f.P(G[0],G[1]));x.push(O)}return x}}toGeoJSON(x,A,O){return fe.call(this,x,A,O)}}class He{constructor(x){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.Z,this.length=x.length,this._features=x}feature(x){return new ke(this._features[x])}}var Oe,Le,Ke,Ue={exports:{}},Ae=function(){if(Ke)return Ue.exports;Ke=1;var K=f.cC(),x=function(){if(Le)return Oe;Le=1;var we=f.cA(),ze=f.cB().VectorTileFeature;function Qe(ft,Pt){this.options=Pt||{},this.features=ft,this.length=ft.length}function je(ft,Pt){this.id=typeof ft.id=="number"?ft.id:void 0,this.type=ft.type,this.rawGeometry=ft.type===1?[ft.geometry]:ft.geometry,this.properties=ft.tags,this.extent=Pt||4096}return Oe=Qe,Qe.prototype.feature=function(ft){return new je(this.features[ft],this.options.extent)},je.prototype.loadGeometry=function(){var ft=this.rawGeometry;this.geometry=[];for(var Pt=0;Pt<ft.length;Pt++){for(var rr=ft[Pt],lr=[],yt=0;yt<rr.length;yt++)lr.push(new we(rr[yt][0],rr[yt][1]));this.geometry.push(lr)}return this.geometry},je.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ft=this.geometry,Pt=1/0,rr=-1/0,lr=1/0,yt=-1/0,Zt=0;Zt<ft.length;Zt++)for(var Qt=ft[Zt],Pr=0;Pr<Qt.length;Pr++){var Sr=Qt[Pr];Pt=Math.min(Pt,Sr.x),rr=Math.max(rr,Sr.x),lr=Math.min(lr,Sr.y),yt=Math.max(yt,Sr.y)}return[Pt,lr,rr,yt]},je.prototype.toGeoJSON=ze.prototype.toGeoJSON,Oe}();function A(we){var ze=new K;return function(Qe,je){for(var ft in Qe.layers)je.writeMessage(3,O,Qe.layers[ft])}(we,ze),ze.finish()}function O(we,ze){var Qe;ze.writeVarintField(15,we.version||1),ze.writeStringField(1,we.name||""),ze.writeVarintField(5,we.extent||4096);var je={keys:[],values:[],keycache:{},valuecache:{}};for(Qe=0;Qe<we.length;Qe++)je.feature=we.feature(Qe),ze.writeMessage(2,G,je);var ft=je.keys;for(Qe=0;Qe<ft.length;Qe++)ze.writeStringField(3,ft[Qe]);var Pt=je.values;for(Qe=0;Qe<Pt.length;Qe++)ze.writeMessage(4,xe,Pt[Qe])}function G(we,ze){var Qe=we.feature;Qe.id!==void 0&&ze.writeVarintField(1,Qe.id),ze.writeMessage(2,Q,we),ze.writeVarintField(3,Qe.type),ze.writeMessage(4,ue,Qe)}function Q(we,ze){var Qe=we.feature,je=we.keys,ft=we.values,Pt=we.keycache,rr=we.valuecache;for(var lr in Qe.properties){var yt=Qe.properties[lr],Zt=Pt[lr];if(yt!==null){Zt===void 0&&(je.push(lr),Pt[lr]=Zt=je.length-1),ze.writeVarint(Zt);var Qt=typeof yt;Qt!=="string"&&Qt!=="boolean"&&Qt!=="number"&&(yt=JSON.stringify(yt));var Pr=Qt+":"+yt,Sr=rr[Pr];Sr===void 0&&(ft.push(yt),rr[Pr]=Sr=ft.length-1),ze.writeVarint(Sr)}}}function le(we,ze){return(ze<<3)+(7&we)}function Te(we){return we<<1^we>>31}function ue(we,ze){for(var Qe=we.loadGeometry(),je=we.type,ft=0,Pt=0,rr=Qe.length,lr=0;lr<rr;lr++){var yt=Qe[lr],Zt=1;je===1&&(Zt=yt.length),ze.writeVarint(le(1,Zt));for(var Qt=je===3?yt.length-1:yt.length,Pr=0;Pr<Qt;Pr++){Pr===1&&je!==1&&ze.writeVarint(le(2,Qt-1));var Sr=yt[Pr].x-ft,Ir=yt[Pr].y-Pt;ze.writeVarint(Te(Sr)),ze.writeVarint(Te(Ir)),ft+=Sr,Pt+=Ir}je===3&&ze.writeVarint(le(7,1))}}function xe(we,ze){var Qe=typeof we;Qe==="string"?ze.writeStringField(1,we):Qe==="boolean"?ze.writeBooleanField(7,we):Qe==="number"&&(we%1!=0?ze.writeDoubleField(3,we):we<0?ze.writeSVarintField(6,we):ze.writeVarintField(5,we))}return Ue.exports=A,Ue.exports.fromVectorTileJs=A,Ue.exports.fromGeojsonVt=function(we,ze){ze=ze||{};var Qe={};for(var je in we)Qe[je]=new x(we[je].features,ze),Qe[je].name=je,Qe[je].version=ze.version,Qe[je].extent=ze.extent;return A({layers:Qe})},Ue.exports.GeoJSONWrapper=x,Ue.exports}(),lt=f.cz(Ae);const mt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:K=>K},_e=Math.fround||(ve=new Float32Array(1),K=>(ve[0]=+K,ve[0]));var ve;const $e=3,Ne=5,wt=6;class ut{constructor(x){this.options=Object.assign(Object.create(mt),x),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(x){const{log:A,minZoom:O,maxZoom:G}=this.options;A&&console.time("total time");const Q=`prepare ${x.length} points`;A&&console.time(Q),this.points=x;const le=[];for(let ue=0;ue<x.length;ue++){const xe=x[ue];if(!xe.geometry)continue;const[we,ze]=xe.geometry.coordinates,Qe=_e(Tt(we)),je=_e(Dt(ze));le.push(Qe,je,1/0,ue,-1,1),this.options.reduce&&le.push(0)}let Te=this.trees[G+1]=this._createTree(le);A&&console.timeEnd(Q);for(let ue=G;ue>=O;ue--){const xe=+Date.now();Te=this.trees[ue]=this._createTree(this._cluster(Te,ue)),A&&console.log("z%d: %d clusters in %dms",ue,Te.numItems,+Date.now()-xe)}return A&&console.timeEnd("total time"),this}getClusters(x,A){let O=((x[0]+180)%360+360)%360-180;const G=Math.max(-90,Math.min(90,x[1]));let Q=x[2]===180?180:((x[2]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,x[3]));if(x[2]-x[0]>=360)O=-180,Q=180;else if(O>Q){const ze=this.getClusters([O,G,180,le],A),Qe=this.getClusters([-180,G,Q,le],A);return ze.concat(Qe)}const Te=this.trees[this._limitZoom(A)],ue=Te.range(Tt(O),Dt(le),Tt(Q),Dt(G)),xe=Te.data,we=[];for(const ze of ue){const Qe=this.stride*ze;we.push(xe[Qe+Ne]>1?At(xe,Qe,this.clusterProps):this.points[xe[Qe+$e]])}return we}getChildren(x){const A=this._getOriginId(x),O=this._getOriginZoom(x),G="No cluster with the specified id.",Q=this.trees[O];if(!Q)throw new Error(G);const le=Q.data;if(A*this.stride>=le.length)throw new Error(G);const Te=this.options.radius/(this.options.extent*Math.pow(2,O-1)),ue=Q.within(le[A*this.stride],le[A*this.stride+1],Te),xe=[];for(const we of ue){const ze=we*this.stride;le[ze+4]===x&&xe.push(le[ze+Ne]>1?At(le,ze,this.clusterProps):this.points[le[ze+$e]])}if(xe.length===0)throw new Error(G);return xe}getLeaves(x,A,O){const G=[];return this._appendLeaves(G,x,A=A||10,O=O||0,0),G}getTile(x,A,O){const G=this.trees[this._limitZoom(x)],Q=Math.pow(2,x),{extent:le,radius:Te}=this.options,ue=Te/le,xe=(O-ue)/Q,we=(O+1+ue)/Q,ze={features:[]};return this._addTileFeatures(G.range((A-ue)/Q,xe,(A+1+ue)/Q,we),G.data,A,O,Q,ze),A===0&&this._addTileFeatures(G.range(1-ue/Q,xe,1,we),G.data,Q,O,Q,ze),A===Q-1&&this._addTileFeatures(G.range(0,xe,ue/Q,we),G.data,-1,O,Q,ze),ze.features.length?ze:null}getClusterExpansionZoom(x){let A=this._getOriginZoom(x)-1;for(;A<=this.options.maxZoom;){const O=this.getChildren(x);if(A++,O.length!==1)break;x=O[0].properties.cluster_id}return A}_appendLeaves(x,A,O,G,Q){const le=this.getChildren(A);for(const Te of le){const ue=Te.properties;if(ue&&ue.cluster?Q+ue.point_count<=G?Q+=ue.point_count:Q=this._appendLeaves(x,ue.cluster_id,O,G,Q):Q<G?Q++:x.push(Te),x.length===O)break}return Q}_createTree(x){const A=new f.aB(x.length/this.stride|0,this.options.nodeSize,Float32Array);for(let O=0;O<x.length;O+=this.stride)A.add(x[O],x[O+1]);return A.finish(),A.data=x,A}_addTileFeatures(x,A,O,G,Q,le){for(const Te of x){const ue=Te*this.stride,xe=A[ue+Ne]>1;let we,ze,Qe;if(xe)we=ht(A,ue,this.clusterProps),ze=A[ue],Qe=A[ue+1];else{const Pt=this.points[A[ue+$e]];we=Pt.properties;const[rr,lr]=Pt.geometry.coordinates;ze=Tt(rr),Qe=Dt(lr)}const je={type:1,geometry:[[Math.round(this.options.extent*(ze*Q-O)),Math.round(this.options.extent*(Qe*Q-G))]],tags:we};let ft;ft=xe||this.options.generateId?A[ue+$e]:this.points[A[ue+$e]].id,ft!==void 0&&(je.id=ft),le.features.push(je)}}_limitZoom(x){return Math.max(this.options.minZoom,Math.min(Math.floor(+x),this.options.maxZoom+1))}_cluster(x,A){const{radius:O,extent:G,reduce:Q,minPoints:le}=this.options,Te=O/(G*Math.pow(2,A)),ue=x.data,xe=[],we=this.stride;for(let ze=0;ze<ue.length;ze+=we){if(ue[ze+2]<=A)continue;ue[ze+2]=A;const Qe=ue[ze],je=ue[ze+1],ft=x.within(ue[ze],ue[ze+1],Te),Pt=ue[ze+Ne];let rr=Pt;for(const lr of ft){const yt=lr*we;ue[yt+2]>A&&(rr+=ue[yt+Ne])}if(rr>Pt&&rr>=le){let lr,yt=Qe*Pt,Zt=je*Pt,Qt=-1;const Pr=((ze/we|0)<<5)+(A+1)+this.points.length;for(const Sr of ft){const Ir=Sr*we;if(ue[Ir+2]<=A)continue;ue[Ir+2]=A;const pr=ue[Ir+Ne];yt+=ue[Ir]*pr,Zt+=ue[Ir+1]*pr,ue[Ir+4]=Pr,Q&&(lr||(lr=this._map(ue,ze,!0),Qt=this.clusterProps.length,this.clusterProps.push(lr)),Q(lr,this._map(ue,Ir)))}ue[ze+4]=Pr,xe.push(yt/rr,Zt/rr,1/0,Pr,-1,rr),Q&&xe.push(Qt)}else{for(let lr=0;lr<we;lr++)xe.push(ue[ze+lr]);if(rr>1)for(const lr of ft){const yt=lr*we;if(!(ue[yt+2]<=A)){ue[yt+2]=A;for(let Zt=0;Zt<we;Zt++)xe.push(ue[yt+Zt])}}}}return xe}_getOriginId(x){return x-this.points.length>>5}_getOriginZoom(x){return(x-this.points.length)%32}_map(x,A,O){if(x[A+Ne]>1){const le=this.clusterProps[x[A+wt]];return O?Object.assign({},le):le}const G=this.points[x[A+$e]].properties,Q=this.options.map(G);return O&&Q===G?Object.assign({},Q):Q}}function At(K,x,A){return{type:"Feature",id:K[x+$e],properties:ht(K,x,A),geometry:{type:"Point",coordinates:[(O=K[x],360*(O-.5)),sr(K[x+1])]}};var O}function ht(K,x,A){const O=K[x+Ne],G=O>=1e4?`${Math.round(O/1e3)}k`:O>=1e3?Math.round(O/100)/10+"k":O,Q=K[x+wt],le=Q===-1?{}:Object.assign({},A[Q]);return Object.assign(le,{cluster:!0,cluster_id:K[x+$e],point_count:O,point_count_abbreviated:G})}function Tt(K){return K/360+.5}function Dt(K){const x=Math.sin(K*Math.PI/180),A=.5-.25*Math.log((1+x)/(1-x))/Math.PI;return A<0?0:A>1?1:A}function sr(K){const x=(180-360*K)*Math.PI/180;return 360*Math.atan(Math.exp(x))/Math.PI-90}function ne(K,x,A,O){let G=O;const Q=x+(A-x>>1);let le,Te=A-x;const ue=K[x],xe=K[x+1],we=K[A],ze=K[A+1];for(let Qe=x+3;Qe<A;Qe+=3){const je=Ie(K[Qe],K[Qe+1],ue,xe,we,ze);if(je>G)le=Qe,G=je;else if(je===G){const ft=Math.abs(Qe-Q);ft<Te&&(le=Qe,Te=ft)}}G>O&&(le-x>3&&ne(K,x,le,O),K[le+2]=G,A-le>3&&ne(K,le,A,O))}function Ie(K,x,A,O,G,Q){let le=G-A,Te=Q-O;if(le!==0||Te!==0){const ue=((K-A)*le+(x-O)*Te)/(le*le+Te*Te);ue>1?(A=G,O=Q):ue>0&&(A+=le*ue,O+=Te*ue)}return le=K-A,Te=x-O,le*le+Te*Te}function Re(K,x,A,O){const G={id:K??null,type:x,geometry:A,tags:O,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(x==="Point"||x==="MultiPoint"||x==="LineString")We(G,A);else if(x==="Polygon")We(G,A[0]);else if(x==="MultiLineString")for(const Q of A)We(G,Q);else if(x==="MultiPolygon")for(const Q of A)We(G,Q[0]);return G}function We(K,x){for(let A=0;A<x.length;A+=3)K.minX=Math.min(K.minX,x[A]),K.minY=Math.min(K.minY,x[A+1]),K.maxX=Math.max(K.maxX,x[A]),K.maxY=Math.max(K.maxY,x[A+1])}function nt(K,x,A,O){if(!x.geometry)return;const G=x.geometry.coordinates;if(G&&G.length===0)return;const Q=x.geometry.type,le=Math.pow(A.tolerance/((1<<A.maxZoom)*A.extent),2);let Te=[],ue=x.id;if(A.promoteId?ue=x.properties[A.promoteId]:A.generateId&&(ue=O||0),Q==="Point")at(G,Te);else if(Q==="MultiPoint")for(const xe of G)at(xe,Te);else if(Q==="LineString")pt(G,Te,le,!1);else if(Q==="MultiLineString"){if(A.lineMetrics){for(const xe of G)Te=[],pt(xe,Te,le,!1),K.push(Re(ue,"LineString",Te,x.properties));return}gt(G,Te,le,!1)}else if(Q==="Polygon")gt(G,Te,le,!0);else{if(Q!=="MultiPolygon"){if(Q==="GeometryCollection"){for(const xe of x.geometry.geometries)nt(K,{id:ue,geometry:xe,properties:x.properties},A,O);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const xe of G){const we=[];gt(xe,we,le,!0),Te.push(we)}}K.push(Re(ue,Q,Te,x.properties))}function at(K,x){x.push(Ht(K[0]),$t(K[1]),0)}function pt(K,x,A,O){let G,Q,le=0;for(let ue=0;ue<K.length;ue++){const xe=Ht(K[ue][0]),we=$t(K[ue][1]);x.push(xe,we,0),ue>0&&(le+=O?(G*we-xe*Q)/2:Math.sqrt(Math.pow(xe-G,2)+Math.pow(we-Q,2))),G=xe,Q=we}const Te=x.length-3;x[2]=1,ne(x,0,Te,A),x[Te+2]=1,x.size=Math.abs(le),x.start=0,x.end=x.size}function gt(K,x,A,O){for(let G=0;G<K.length;G++){const Q=[];pt(K[G],Q,A,O),x.push(Q)}}function Ht(K){return K/360+.5}function $t(K){const x=Math.sin(K*Math.PI/180),A=.5-.25*Math.log((1+x)/(1-x))/Math.PI;return A<0?0:A>1?1:A}function er(K,x,A,O,G,Q,le,Te){if(O/=x,Q>=(A/=x)&&le<O)return K;if(le<A||Q>=O)return null;const ue=[];for(const xe of K){const we=xe.geometry;let ze=xe.type;const Qe=G===0?xe.minX:xe.minY,je=G===0?xe.maxX:xe.maxY;if(Qe>=A&&je<O){ue.push(xe);continue}if(je<A||Qe>=O)continue;let ft=[];if(ze==="Point"||ze==="MultiPoint")nr(we,ft,A,O,G);else if(ze==="LineString")dr(we,ft,A,O,G,!1,Te.lineMetrics);else if(ze==="MultiLineString")qe(we,ft,A,O,G,!1);else if(ze==="Polygon")qe(we,ft,A,O,G,!0);else if(ze==="MultiPolygon")for(const Pt of we){const rr=[];qe(Pt,rr,A,O,G,!0),rr.length&&ft.push(rr)}if(ft.length){if(Te.lineMetrics&&ze==="LineString"){for(const Pt of ft)ue.push(Re(xe.id,ze,Pt,xe.tags));continue}ze!=="LineString"&&ze!=="MultiLineString"||(ft.length===1?(ze="LineString",ft=ft[0]):ze="MultiLineString"),ze!=="Point"&&ze!=="MultiPoint"||(ze=ft.length===3?"Point":"MultiPoint"),ue.push(Re(xe.id,ze,ft,xe.tags))}}return ue.length?ue:null}function nr(K,x,A,O,G){for(let Q=0;Q<K.length;Q+=3){const le=K[Q+G];le>=A&&le<=O&&zr(x,K[Q],K[Q+1],K[Q+2])}}function dr(K,x,A,O,G,Q,le){let Te=Et(K);const ue=G===0?yr:Xt;let xe,we,ze=K.start;for(let rr=0;rr<K.length-3;rr+=3){const lr=K[rr],yt=K[rr+1],Zt=K[rr+2],Qt=K[rr+3],Pr=K[rr+4],Sr=G===0?lr:yt,Ir=G===0?Qt:Pr;let pr=!1;le&&(xe=Math.sqrt(Math.pow(lr-Qt,2)+Math.pow(yt-Pr,2))),Sr<A?Ir>A&&(we=ue(Te,lr,yt,Qt,Pr,A),le&&(Te.start=ze+xe*we)):Sr>O?Ir<O&&(we=ue(Te,lr,yt,Qt,Pr,O),le&&(Te.start=ze+xe*we)):zr(Te,lr,yt,Zt),Ir<A&&Sr>=A&&(we=ue(Te,lr,yt,Qt,Pr,A),pr=!0),Ir>O&&Sr<=O&&(we=ue(Te,lr,yt,Qt,Pr,O),pr=!0),!Q&&pr&&(le&&(Te.end=ze+xe*we),x.push(Te),Te=Et(K)),le&&(ze+=xe)}let Qe=K.length-3;const je=K[Qe],ft=K[Qe+1],Pt=G===0?je:ft;Pt>=A&&Pt<=O&&zr(Te,je,ft,K[Qe+2]),Qe=Te.length-3,Q&&Qe>=3&&(Te[Qe]!==Te[0]||Te[Qe+1]!==Te[1])&&zr(Te,Te[0],Te[1],Te[2]),Te.length&&x.push(Te)}function Et(K){const x=[];return x.size=K.size,x.start=K.start,x.end=K.end,x}function qe(K,x,A,O,G,Q){for(const le of K)dr(le,x,A,O,G,Q,!1)}function zr(K,x,A,O){K.push(x,A,O)}function yr(K,x,A,O,G,Q){const le=(Q-x)/(O-x);return zr(K,Q,A+(G-A)*le,1),le}function Xt(K,x,A,O,G,Q){const le=(Q-A)/(G-A);return zr(K,x+(O-x)*le,Q,1),le}function ir(K,x){const A=[];for(let O=0;O<K.length;O++){const G=K[O],Q=G.type;let le;if(Q==="Point"||Q==="MultiPoint"||Q==="LineString")le=ar(G.geometry,x);else if(Q==="MultiLineString"||Q==="Polygon"){le=[];for(const Te of G.geometry)le.push(ar(Te,x))}else if(Q==="MultiPolygon"){le=[];for(const Te of G.geometry){const ue=[];for(const xe of Te)ue.push(ar(xe,x));le.push(ue)}}A.push(Re(G.id,Q,le,G.tags))}return A}function ar(K,x){const A=[];A.size=K.size,K.start!==void 0&&(A.start=K.start,A.end=K.end);for(let O=0;O<K.length;O+=3)A.push(K[O]+x,K[O+1],K[O+2]);return A}function or(K,x){if(K.transformed)return K;const A=1<<K.z,O=K.x,G=K.y;for(const Q of K.features){const le=Q.geometry,Te=Q.type;if(Q.geometry=[],Te===1)for(let ue=0;ue<le.length;ue+=2)Q.geometry.push(xr(le[ue],le[ue+1],x,A,O,G));else for(let ue=0;ue<le.length;ue++){const xe=[];for(let we=0;we<le[ue].length;we+=2)xe.push(xr(le[ue][we],le[ue][we+1],x,A,O,G));Q.geometry.push(xe)}}return K.transformed=!0,K}function xr(K,x,A,O,G,Q){return[Math.round(A*(K*O-G)),Math.round(A*(x*O-Q))]}function wr(K,x,A,O,G){const Q=x===G.maxZoom?0:G.tolerance/((1<<x)*G.extent),le={features:[],numPoints:0,numSimplified:0,numFeatures:K.length,source:null,x:A,y:O,z:x,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Te of K)Dr(le,Te,Q,G);return le}function Dr(K,x,A,O){const G=x.geometry,Q=x.type,le=[];if(K.minX=Math.min(K.minX,x.minX),K.minY=Math.min(K.minY,x.minY),K.maxX=Math.max(K.maxX,x.maxX),K.maxY=Math.max(K.maxY,x.maxY),Q==="Point"||Q==="MultiPoint")for(let Te=0;Te<G.length;Te+=3)le.push(G[Te],G[Te+1]),K.numPoints++,K.numSimplified++;else if(Q==="LineString")Fr(le,G,K,A,!1,!1);else if(Q==="MultiLineString"||Q==="Polygon")for(let Te=0;Te<G.length;Te++)Fr(le,G[Te],K,A,Q==="Polygon",Te===0);else if(Q==="MultiPolygon")for(let Te=0;Te<G.length;Te++){const ue=G[Te];for(let xe=0;xe<ue.length;xe++)Fr(le,ue[xe],K,A,!0,xe===0)}if(le.length){let Te=x.tags||null;if(Q==="LineString"&&O.lineMetrics){Te={};for(const xe in x.tags)Te[xe]=x.tags[xe];Te.mapbox_clip_start=G.start/G.size,Te.mapbox_clip_end=G.end/G.size}const ue={geometry:le,type:Q==="Polygon"||Q==="MultiPolygon"?3:Q==="LineString"||Q==="MultiLineString"?2:1,tags:Te};x.id!==null&&(ue.id=x.id),K.features.push(ue)}}function Fr(K,x,A,O,G,Q){const le=O*O;if(O>0&&x.size<(G?le:O))return void(A.numPoints+=x.length/3);const Te=[];for(let ue=0;ue<x.length;ue+=3)(O===0||x[ue+2]>le)&&(A.numSimplified++,Te.push(x[ue],x[ue+1])),A.numPoints++;G&&function(ue,xe){let we=0;for(let ze=0,Qe=ue.length,je=Qe-2;ze<Qe;je=ze,ze+=2)we+=(ue[ze]-ue[je])*(ue[ze+1]+ue[je+1]);if(we>0===xe)for(let ze=0,Qe=ue.length;ze<Qe/2;ze+=2){const je=ue[ze],ft=ue[ze+1];ue[ze]=ue[Qe-2-ze],ue[ze+1]=ue[Qe-1-ze],ue[Qe-2-ze]=je,ue[Qe-1-ze]=ft}}(Te,Q),K.push(Te)}const Zr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Jr{constructor(x,A){const O=(A=this.options=function(Q,le){for(const Te in le)Q[Te]=le[Te];return Q}(Object.create(Zr),A)).debug;if(O&&console.time("preprocess data"),A.maxZoom<0||A.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(A.promoteId&&A.generateId)throw new Error("promoteId and generateId cannot be used together.");let G=function(Q,le){const Te=[];if(Q.type==="FeatureCollection")for(let ue=0;ue<Q.features.length;ue++)nt(Te,Q.features[ue],le,ue);else nt(Te,Q.type==="Feature"?Q:{geometry:Q},le);return Te}(x,A);this.tiles={},this.tileCoords=[],O&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",A.indexMaxZoom,A.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),G=function(Q,le){const Te=le.buffer/le.extent;let ue=Q;const xe=er(Q,1,-1-Te,Te,0,-1,2,le),we=er(Q,1,1-Te,2+Te,0,-1,2,le);return(xe||we)&&(ue=er(Q,1,-Te,1+Te,0,-1,2,le)||[],xe&&(ue=ir(xe,1).concat(ue)),we&&(ue=ue.concat(ir(we,-1)))),ue}(G,A),G.length&&this.splitTile(G,0,0,0),O&&(G.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(x,A,O,G,Q,le,Te){const ue=[x,A,O,G],xe=this.options,we=xe.debug;for(;ue.length;){G=ue.pop(),O=ue.pop(),A=ue.pop(),x=ue.pop();const ze=1<<A,Qe=Mr(A,O,G);let je=this.tiles[Qe];if(!je&&(we>1&&console.time("creation"),je=this.tiles[Qe]=wr(x,A,O,G,xe),this.tileCoords.push({z:A,x:O,y:G}),we)){we>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",A,O,G,je.numFeatures,je.numPoints,je.numSimplified),console.timeEnd("creation"));const pr=`z${A}`;this.stats[pr]=(this.stats[pr]||0)+1,this.total++}if(je.source=x,Q==null){if(A===xe.indexMaxZoom||je.numPoints<=xe.indexMaxPoints)continue}else{if(A===xe.maxZoom||A===Q)continue;if(Q!=null){const pr=Q-A;if(O!==le>>pr||G!==Te>>pr)continue}}if(je.source=null,x.length===0)continue;we>1&&console.time("clipping");const ft=.5*xe.buffer/xe.extent,Pt=.5-ft,rr=.5+ft,lr=1+ft;let yt=null,Zt=null,Qt=null,Pr=null,Sr=er(x,ze,O-ft,O+rr,0,je.minX,je.maxX,xe),Ir=er(x,ze,O+Pt,O+lr,0,je.minX,je.maxX,xe);x=null,Sr&&(yt=er(Sr,ze,G-ft,G+rr,1,je.minY,je.maxY,xe),Zt=er(Sr,ze,G+Pt,G+lr,1,je.minY,je.maxY,xe),Sr=null),Ir&&(Qt=er(Ir,ze,G-ft,G+rr,1,je.minY,je.maxY,xe),Pr=er(Ir,ze,G+Pt,G+lr,1,je.minY,je.maxY,xe),Ir=null),we>1&&console.timeEnd("clipping"),ue.push(yt||[],A+1,2*O,2*G),ue.push(Zt||[],A+1,2*O,2*G+1),ue.push(Qt||[],A+1,2*O+1,2*G),ue.push(Pr||[],A+1,2*O+1,2*G+1)}}getTile(x,A,O){x=+x,A=+A,O=+O;const G=this.options,{extent:Q,debug:le}=G;if(x<0||x>24)return null;const Te=1<<x,ue=Mr(x,A=A+Te&Te-1,O);if(this.tiles[ue])return or(this.tiles[ue],Q);le>1&&console.log("drilling down to z%d-%d-%d",x,A,O);let xe,we=x,ze=A,Qe=O;for(;!xe&&we>0;)we--,ze>>=1,Qe>>=1,xe=this.tiles[Mr(we,ze,Qe)];return xe&&xe.source?(le>1&&(console.log("found parent tile z%d-%d-%d",we,ze,Qe),console.time("drilling down")),this.splitTile(xe.source,we,ze,Qe,x,A,O),le>1&&console.timeEnd("drilling down"),this.tiles[ue]?or(this.tiles[ue],Q):null):null}}function Mr(K,x,A){return 32*((1<<K)*A+x)+K}function Rr(K,x){return x?K.properties[x]:K.id}function ur(K,x){if(K==null)return!0;if(K.type==="Feature")return Rr(K,x)!=null;if(K.type==="FeatureCollection"){const A=new Set;for(const O of K.features){const G=Rr(O,x);if(G==null||A.has(G))return!1;A.add(G)}return!0}return!1}function Wi(K,x){const A=new Map;if(K!=null)if(K.type==="Feature")A.set(Rr(K,x),K);else for(const O of K.features)A.set(Rr(O,x),O);return A}class Qr extends U{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(x,A){return f._(this,void 0,void 0,function*(){const O=x.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const G=this._geoJSONIndex.getTile(O.z,O.x,O.y);if(!G)return null;const Q=new He(G.features);let le=lt(Q);return le.byteOffset===0&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),{vectorTile:Q,rawData:le.buffer}})}loadData(x){return f._(this,void 0,void 0,function*(){var A;(A=this._pendingRequest)===null||A===void 0||A.abort();const O=!!(x&&x.request&&x.request.collectResourceTiming)&&new f.cw(x.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(x,this._pendingRequest),this._geoJSONIndex=x.cluster?new ut(function({superclusterOptions:le,clusterProperties:Te}){if(!Te||!le)return le;const ue={},xe={},we={accumulated:null,zoom:0},ze={properties:null},Qe=Object.keys(Te);for(const je of Qe){const[ft,Pt]=Te[je],rr=f.cD(Pt),lr=f.cD(typeof ft=="string"?[ft,["accumulated"],["get",je]]:ft);ue[je]=rr.value,xe[je]=lr.value}return le.map=je=>{ze.properties=je;const ft={};for(const Pt of Qe)ft[Pt]=ue[Pt].evaluate(we,ze);return ft},le.reduce=(je,ft)=>{ze.properties=ft;for(const Pt of Qe)we.accumulated=je[Pt],je[Pt]=xe[Pt].evaluate(we,ze)},le}(x)).load((yield this._pendingData).features):(G=yield this._pendingData,new Jr(G,x.geojsonVtOptions)),this.loaded={};const Q={};if(O){const le=O.finish();le&&(Q.resourceTiming={},Q.resourceTiming[x.source]=JSON.parse(JSON.stringify(le)))}return Q}catch(Q){if(delete this._pendingRequest,f.ch(Q))return{abandoned:!0};throw Q}var G})}getData(){return f._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(x){const A=this.loaded;return A&&A[x.uid]?super.reloadTile(x):this.loadTile(x)}loadAndProcessGeoJSON(x,A){return f._(this,void 0,void 0,function*(){let O=yield this.loadGeoJSON(x,A);if(delete this._pendingRequest,typeof O!="object")throw new Error(`Input data given to '${x.source}' is not a valid GeoJSON object.`);if(De(O,!0),x.filter){const G=f.cD(x.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(G.result==="error")throw new Error(G.value.map(le=>`${le.key}: ${le.message}`).join(", "));O={type:"FeatureCollection",features:O.features.filter(le=>G.value.evaluate({zoom:0},le))}}return O})}loadGeoJSON(x,A){return f._(this,void 0,void 0,function*(){const{promoteId:O}=x;if(x.request){const G=yield f.j(x.request,A);return this._dataUpdateable=ur(G.data,O)?Wi(G.data,O):void 0,G.data}if(typeof x.data=="string")try{const G=JSON.parse(x.data);return this._dataUpdateable=ur(G,O)?Wi(G,O):void 0,G}catch{throw new Error(`Input data given to '${x.source}' is not a valid GeoJSON object.`)}if(!x.dataDiff)throw new Error(`Input data given to '${x.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${x.source}`);return function(G,Q,le){var Te,ue,xe,we;if(Q.removeAll&&G.clear(),Q.remove)for(const ze of Q.remove)G.delete(ze);if(Q.add)for(const ze of Q.add){const Qe=Rr(ze,le);Qe!=null&&G.set(Qe,ze)}if(Q.update)for(const ze of Q.update){let Qe=G.get(ze.id);if(Qe==null)continue;const je=!ze.removeAllProperties&&(((Te=ze.removeProperties)===null||Te===void 0?void 0:Te.length)>0||((ue=ze.addOrUpdateProperties)===null||ue===void 0?void 0:ue.length)>0);if((ze.newGeometry||ze.removeAllProperties||je)&&(Qe=Object.assign({},Qe),G.set(ze.id,Qe),je&&(Qe.properties=Object.assign({},Qe.properties))),ze.newGeometry&&(Qe.geometry=ze.newGeometry),ze.removeAllProperties)Qe.properties={};else if(((xe=ze.removeProperties)===null||xe===void 0?void 0:xe.length)>0)for(const ft of ze.removeProperties)Object.prototype.hasOwnProperty.call(Qe.properties,ft)&&delete Qe.properties[ft];if(((we=ze.addOrUpdateProperties)===null||we===void 0?void 0:we.length)>0)for(const{key:ft,value:Pt}of ze.addOrUpdateProperties)Qe.properties[ft]=Pt}}(this._dataUpdateable,x.dataDiff,O),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(x){return f._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(x){return this._geoJSONIndex.getClusterExpansionZoom(x.clusterId)}getClusterChildren(x){return this._geoJSONIndex.getChildren(x.clusterId)}getClusterLeaves(x){return this._geoJSONIndex.getLeaves(x.clusterId,x.limit,x.offset)}}class Bi{constructor(x){this.self=x,this.actor=new f.H(x),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(A,O)=>{if(this.externalWorkerSourceTypes[A])throw new Error(`Worker source with name "${A}" already registered.`);this.externalWorkerSourceTypes[A]=O},this.self.addProtocol=f.cj,this.self.removeProtocol=f.ck,this.self.registerRTLTextPlugin=A=>{f.cE.setMethods(A)},this.actor.registerMessageHandler("LDT",(A,O)=>this._getDEMWorkerSource(A,O.source).loadTile(O)),this.actor.registerMessageHandler("RDT",(A,O)=>f._(this,void 0,void 0,function*(){this._getDEMWorkerSource(A,O.source).removeTile(O)})),this.actor.registerMessageHandler("GCEZ",(A,O)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(A,O.type,O.source).getClusterExpansionZoom(O)})),this.actor.registerMessageHandler("GCC",(A,O)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(A,O.type,O.source).getClusterChildren(O)})),this.actor.registerMessageHandler("GCL",(A,O)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(A,O.type,O.source).getClusterLeaves(O)})),this.actor.registerMessageHandler("LD",(A,O)=>this._getWorkerSource(A,O.type,O.source).loadData(O)),this.actor.registerMessageHandler("GD",(A,O)=>this._getWorkerSource(A,O.type,O.source).getData()),this.actor.registerMessageHandler("LT",(A,O)=>this._getWorkerSource(A,O.type,O.source).loadTile(O)),this.actor.registerMessageHandler("RT",(A,O)=>this._getWorkerSource(A,O.type,O.source).reloadTile(O)),this.actor.registerMessageHandler("AT",(A,O)=>this._getWorkerSource(A,O.type,O.source).abortTile(O)),this.actor.registerMessageHandler("RMT",(A,O)=>this._getWorkerSource(A,O.type,O.source).removeTile(O)),this.actor.registerMessageHandler("RS",(A,O)=>f._(this,void 0,void 0,function*(){if(!this.workerSources[A]||!this.workerSources[A][O.type]||!this.workerSources[A][O.type][O.source])return;const G=this.workerSources[A][O.type][O.source];delete this.workerSources[A][O.type][O.source],G.removeSource!==void 0&&G.removeSource(O)})),this.actor.registerMessageHandler("RM",A=>f._(this,void 0,void 0,function*(){delete this.layerIndexes[A],delete this.availableImages[A],delete this.workerSources[A],delete this.demWorkerSources[A]})),this.actor.registerMessageHandler("SR",(A,O)=>f._(this,void 0,void 0,function*(){this.referrer=O})),this.actor.registerMessageHandler("SRPS",(A,O)=>this._syncRTLPluginState(A,O)),this.actor.registerMessageHandler("IS",(A,O)=>f._(this,void 0,void 0,function*(){this.self.importScripts(O)})),this.actor.registerMessageHandler("SI",(A,O)=>this._setImages(A,O)),this.actor.registerMessageHandler("UL",(A,O)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(A).update(O.layers,O.removedIds)})),this.actor.registerMessageHandler("SL",(A,O)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(A).replace(O)}))}_setImages(x,A){return f._(this,void 0,void 0,function*(){this.availableImages[x]=A;for(const O in this.workerSources[x]){const G=this.workerSources[x][O];for(const Q in G)G[Q].availableImages=A}})}_syncRTLPluginState(x,A){return f._(this,void 0,void 0,function*(){return yield f.cE.syncState(A,this.self.importScripts)})}_getAvailableImages(x){let A=this.availableImages[x];return A||(A=[]),A}_getLayerIndex(x){let A=this.layerIndexes[x];return A||(A=this.layerIndexes[x]=new s),A}_getWorkerSource(x,A,O){if(this.workerSources[x]||(this.workerSources[x]={}),this.workerSources[x][A]||(this.workerSources[x][A]={}),!this.workerSources[x][A][O]){const G={sendAsync:(Q,le)=>(Q.targetMapId=x,this.actor.sendAsync(Q,le))};switch(A){case"vector":this.workerSources[x][A][O]=new U(G,this._getLayerIndex(x),this._getAvailableImages(x));break;case"geojson":this.workerSources[x][A][O]=new Qr(G,this._getLayerIndex(x),this._getAvailableImages(x));break;default:this.workerSources[x][A][O]=new this.externalWorkerSourceTypes[A](G,this._getLayerIndex(x),this._getAvailableImages(x))}}return this.workerSources[x][A][O]}_getDEMWorkerSource(x,A){return this.demWorkerSources[x]||(this.demWorkerSources[x]={}),this.demWorkerSources[x][A]||(this.demWorkerSources[x][A]=new J),this.demWorkerSources[x][A]}}return f.i(self)&&(self.worker=new Bi(self)),Bi}),v("index",["exports","./shared"],function(f,s){var M="5.2.0";function B(){var m=new s.A(4);return s.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let V,U;const J={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(m,e,r){const l=requestAnimationFrame(g=>{u(),e(g)}),{unsubscribe:u}=s.s(m.signal,"abort",()=>{u(),cancelAnimationFrame(l),r(s.c())},!1)},frameAsync(m){return new Promise((e,r)=>{this.frame(m,e,r)})},getImageData(m,e=0){return this.getImageCanvasContext(m).getImageData(-e,-e,m.width+2*e,m.height+2*e)},getImageCanvasContext(m){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=m.width,e.height=m.height,r.drawImage(m,0,0,m.width,m.height),r},resolveURL:m=>(V||(V=document.createElement("a")),V.href=m,V.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(U==null&&(U=matchMedia("(prefers-reduced-motion: reduce)")),U.matches)}};class N{static testProp(e){if(!N.docStyle)return e[0];for(let r=0;r<e.length;r++)if(e[r]in N.docStyle)return e[r];return e[0]}static create(e,r,l){const u=window.document.createElement(e);return r!==void 0&&(u.className=r),l&&l.appendChild(u),u}static createNS(e,r){return window.document.createElementNS(e,r)}static disableDrag(){N.docStyle&&N.selectProp&&(N.userSelect=N.docStyle[N.selectProp],N.docStyle[N.selectProp]="none")}static enableDrag(){N.docStyle&&N.selectProp&&(N.docStyle[N.selectProp]=N.userSelect)}static setTransform(e,r){e.style[N.transformProp]=r}static addEventListener(e,r,l,u={}){e.addEventListener(r,l,"passive"in u?u:u.capture)}static removeEventListener(e,r,l,u={}){e.removeEventListener(r,l,"passive"in u?u:u.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",N.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",N.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",N.suppressClickInternal,!0)},0)}static getScale(e){const r=e.getBoundingClientRect();return{x:r.width/e.offsetWidth||1,y:r.height/e.offsetHeight||1,boundingClientRect:r}}static getPoint(e,r,l){const u=r.boundingClientRect;return new s.P((l.clientX-u.left)/r.x-e.clientLeft,(l.clientY-u.top)/r.y-e.clientTop)}static mousePos(e,r){const l=N.getScale(e);return N.getPoint(e,l,r)}static touchPos(e,r){const l=[],u=N.getScale(e);for(let g=0;g<r.length;g++)l.push(N.getPoint(e,u,r[g]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const r=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),l=r.querySelectorAll("script");for(const u of l)u.remove();return N.clean(r),r.innerHTML}static isPossiblyDangerous(e,r){const l=r.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!l.includes("javascript:")&&!l.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const r=e.children;for(const l of r)N.removeAttributes(l),N.clean(l)}static removeAttributes(e){for(const{name:r,value:l}of e.attributes)N.isPossiblyDangerous(r,l)&&e.removeAttribute(r)}}N.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,N.selectProp=N.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),N.transformProp=N.testProp(["transform","WebkitTransform"]);const de={supported:!1,testSupport:function(m){!fe&&De&&(ke?He(m):pe=m)}};let pe,De,fe=!1,ke=!1;function He(m){const e=m.createTexture();m.bindTexture(m.TEXTURE_2D,e);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,De),m.isContextLost())return;de.supported=!0}catch{}m.deleteTexture(e),fe=!0}var Oe;typeof document<"u"&&(De=document.createElement("img"),De.onload=()=>{pe&&He(pe),pe=null,ke=!0},De.onerror=()=>{fe=!0,pe=null},De.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(m){let e,r,l,u;m.resetRequestQueue=()=>{e=[],r=0,l=0,u={}},m.addThrottleControl=E=>{const D=l++;return u[D]=E,D},m.removeThrottleControl=E=>{delete u[E],P()},m.getImage=(E,D,q=!0)=>new Promise(($,W)=>{de.supported&&(E.headers||(E.headers={}),E.headers.accept="image/webp,*/*"),s.e(E,{type:"image"}),e.push({abortController:D,requestParameters:E,supportImageRefresh:q,state:"queued",onError:ie=>{W(ie)},onSuccess:ie=>{$(ie)}}),P()});const g=E=>s._(this,void 0,void 0,function*(){E.state="running";const{requestParameters:D,supportImageRefresh:q,onError:$,onSuccess:W,abortController:ie}=E,se=q===!1&&!s.i(self)&&!s.g(D.url)&&(!D.headers||Object.keys(D.headers).reduce((Se,Ee)=>Se&&Ee==="accept",!0));r++;const Pe=se?I(D,ie):s.m(D,ie);try{const Se=yield Pe;delete E.abortController,E.state="completed",Se.data instanceof HTMLImageElement||s.b(Se.data)?W(Se):Se.data&&W({data:yield(be=Se.data,typeof createImageBitmap=="function"?s.f(be):s.h(be)),cacheControl:Se.cacheControl,expires:Se.expires})}catch(Se){delete E.abortController,$(Se)}finally{r--,P()}var be}),P=()=>{const E=(()=>{for(const D of Object.keys(u))if(u[D]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let D=r;D<E&&e.length>0;D++){const q=e.shift();q.abortController.signal.aborted?D--:g(q)}},I=(E,D)=>new Promise((q,$)=>{const W=new Image,ie=E.url,se=E.credentials;se&&se==="include"?W.crossOrigin="use-credentials":(se&&se==="same-origin"||!s.d(ie))&&(W.crossOrigin="anonymous"),D.signal.addEventListener("abort",()=>{W.src="",$(s.c())}),W.fetchPriority="high",W.onload=()=>{W.onerror=W.onload=null,q({data:W})},W.onerror=()=>{W.onerror=W.onload=null,D.signal.aborted||$(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},W.src=ie})}(Oe||(Oe={})),Oe.resetRequestQueue();class Le{constructor(e){this._transformRequestFn=e}transformRequest(e,r){return this._transformRequestFn&&this._transformRequestFn(e,r)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Ke(m){const e=[];if(typeof m=="string")e.push({id:"default",url:m});else if(m&&m.length>0){const r=[];for(const{id:l,url:u}of m){const g=`${l}${u}`;r.indexOf(g)===-1&&(r.push(g),e.push({id:l,url:u}))}}return e}function Ue(m,e,r){try{const l=new URL(m);return l.pathname+=`${e}${r}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class Ae{constructor(e,r,l,u){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(r,u)}update(e,r,l){const{width:u,height:g}=e,P=!(this.size&&this.size[0]===u&&this.size[1]===g||l),{context:I}=this,{gl:E}=I;if(this.useMipmap=!!(r&&r.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),I.pixelStoreUnpackFlipY.set(!1),I.pixelStoreUnpack.set(1),I.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!r||r.premultiply!==!1)),P)this.size=[u,g],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||s.b(e)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,e):E.texImage2D(E.TEXTURE_2D,0,this.format,u,g,0,this.format,E.UNSIGNED_BYTE,e.data);else{const{x:D,y:q}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||s.b(e)?E.texSubImage2D(E.TEXTURE_2D,0,D,q,E.RGBA,E.UNSIGNED_BYTE,e):E.texSubImage2D(E.TEXTURE_2D,0,D,q,u,g,E.RGBA,E.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D)}bind(e,r,l){const{context:u}=this,{gl:g}=u;g.bindTexture(g.TEXTURE_2D,this.texture),l!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=g.LINEAR),e!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,e),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,l||e),this.filter=e),r!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,r),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function lt(m){const{userImage:e}=m;return!!(e&&e.render&&e.render())&&(m.data.replace(new Uint8Array(e.data.buffer)),!0)}class mt extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:r,promiseResolve:l}of this.requestors)l(this._getImagesForIds(r));this.requestors=[]}}getImage(e){const r=this.images[e];if(r&&!r.data&&r.spriteData){const l=r.spriteData;r.data=new s.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),r.spriteData=null}return r}addImage(e,r){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,r)&&(this.images[e]=r)}_validate(e,r){let l=!0;const u=r.data||r.spriteData;return this._validateStretch(r.stretchX,u&&u.width)||(this.fire(new s.k(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(r.stretchY,u&&u.height)||(this.fire(new s.k(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(r.content,r)||(this.fire(new s.k(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,r){if(!e)return!0;let l=0;for(const u of e){if(u[0]<l||u[1]<u[0]||r<u[1])return!1;l=u[1]}return!0}_validateContent(e,r){if(!e)return!0;if(e.length!==4)return!1;const l=r.spriteData,u=l&&l.width||r.data.width,g=l&&l.height||r.data.height;return!(e[0]<0||u<e[0]||e[1]<0||g<e[1]||e[2]<0||u<e[2]||e[3]<0||g<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,r,l=!0){const u=this.getImage(e);if(l&&(u.data.width!==r.data.width||u.data.height!==r.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=u.version+1,this.images[e]=r,this.updatedImages[e]=!0}removeImage(e){const r=this.images[e];delete this.images[e],delete this.patterns[e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((r,l)=>{let u=!0;if(!this.isLoaded())for(const g of e)this.images[g]||(u=!1);this.isLoaded()||u?r(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:r})})}_getImagesForIds(e){const r={};for(const l of e){let u=this.getImage(l);u||(this.fire(new s.l("styleimagemissing",{id:l})),u=this.getImage(l)),u?r[l]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,textFitWidth:u.textFitWidth,textFitHeight:u.textFitHeight,hasRenderCallback:!!(u.userImage&&u.userImage.render)}:s.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){const{width:e,height:r}=this.atlasImage;return{width:e,height:r}}getPattern(e){const r=this.patterns[e],l=this.getImage(e);if(!l)return null;if(r&&r.position.version===l.version)return r.position;if(r)r.position.version=l.version;else{const u={w:l.data.width+2,h:l.data.height+2,x:0,y:0},g=new s.I(u,l);this.patterns[e]={bin:u,position:g}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ae(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const g in this.patterns)e.push(this.patterns[g].bin);const{w:r,h:l}=s.p(e),u=this.atlasImage;u.resize({width:r||1,height:l||1});for(const g in this.patterns){const{bin:P}=this.patterns[g],I=P.x+1,E=P.y+1,D=this.getImage(g).data,q=D.width,$=D.height;s.R.copy(D,u,{x:0,y:0},{x:I,y:E},{width:q,height:$}),s.R.copy(D,u,{x:0,y:$-1},{x:I,y:E-1},{width:q,height:1}),s.R.copy(D,u,{x:0,y:0},{x:I,y:E+$},{width:q,height:1}),s.R.copy(D,u,{x:q-1,y:0},{x:I-1,y:E},{width:1,height:$}),s.R.copy(D,u,{x:0,y:0},{x:I+q,y:E},{width:1,height:$})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const r of e){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const l=this.getImage(r);l||s.w(`Image with ID: "${r}" was not found`),lt(l)&&this.updateImage(r,l)}}}const _e=1e20;function ve(m,e,r,l,u,g,P,I,E){for(let D=e;D<e+l;D++)$e(m,r*g+D,g,u,P,I,E);for(let D=r;D<r+u;D++)$e(m,D*g+e,1,l,P,I,E)}function $e(m,e,r,l,u,g,P){g[0]=0,P[0]=-1e20,P[1]=_e,u[0]=m[e];for(let I=1,E=0,D=0;I<l;I++){u[I]=m[e+I*r];const q=I*I;do{const $=g[E];D=(u[I]-u[$]+q-$*$)/(I-$)/2}while(D<=P[E]&&--E>-1);E++,g[E]=I,P[E]=D,P[E+1]=_e}for(let I=0,E=0;I<l;I++){for(;P[E+1]<I;)E++;const D=g[E],q=I-D;m[e+I*r]=u[D]+q*q}}class Ne{constructor(e,r){this.requestManager=e,this.localIdeographFontFamily=r,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return s._(this,void 0,void 0,function*(){const r=[];for(const g in e)for(const P of e[g])r.push(this._getAndCacheGlyphsPromise(g,P));const l=yield Promise.all(r),u={};for(const{stack:g,id:P,glyph:I}of l)u[g]||(u[g]={}),u[g][P]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics};return u})}_getAndCacheGlyphsPromise(e,r){return s._(this,void 0,void 0,function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let u=l.glyphs[r];if(u!==void 0)return{stack:e,id:r,glyph:u};if(u=this._tinySDF(l,e,r),u)return l.glyphs[r]=u,{stack:e,id:r,glyph:u};const g=Math.floor(r/256);if(256*g>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[g])return{stack:e,id:r,glyph:u};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[g]){const I=Ne.loadGlyphRange(e,g,this.url,this.requestManager);l.requests[g]=I}const P=yield l.requests[g];for(const I in P)this._doesCharSupportLocalGlyph(+I)||(l.glyphs[+I]=P[+I]);return l.ranges[g]=!0,{stack:e,id:r,glyph:P[r]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||s.u["CJK Unified Ideographs"](e)||s.u["Hangul Syllables"](e)||s.u.Hiragana(e)||s.u.Katakana(e)||s.u["CJK Symbols and Punctuation"](e)||s.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,r,l){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let g=e.tinySDF;if(!g){let I="400";/bold/i.test(r)?I="900":/medium/i.test(r)?I="500":/light/i.test(r)&&(I="200"),g=e.tinySDF=new Ne.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:I})}const P=g.draw(String.fromCharCode(l));return{id:l,bitmap:new s.q({width:P.width||60,height:P.height||60},P.data),metrics:{width:P.glyphWidth/2||24,height:P.glyphHeight/2||24,left:P.glyphLeft/2+.5||0,top:P.glyphTop/2-27.5||-8,advance:P.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ne.loadGlyphRange=function(m,e,r,l){return s._(this,void 0,void 0,function*(){const u=256*e,g=u+255,P=l.transformRequest(r.replace("{fontstack}",m).replace("{range}",`${u}-${g}`),"Glyphs"),I=yield s.n(P,new AbortController);if(!I||!I.data)throw new Error(`Could not load glyph range. range: ${e}, ${u}-${g}`);const E={};for(const D of s.o(I.data))E[D.id]=D;return E})},Ne.TinySDF=class{constructor({fontSize:m=24,buffer:e=3,radius:r=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:g="normal",fontStyle:P="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=r;const I=this.size=m+4*e,E=this._createCanvas(I),D=this.ctx=E.getContext("2d",{willReadFrequently:!0});D.font=`${P} ${g} ${m}px ${u}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(m){const e=document.createElement("canvas");return e.width=e.height=m,e}draw(m){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:g}=this.ctx.measureText(m),P=Math.ceil(r),I=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-u))),E=Math.min(this.size-this.buffer,P+Math.ceil(l)),D=I+2*this.buffer,q=E+2*this.buffer,$=Math.max(D*q,0),W=new Uint8ClampedArray($),ie={data:W,width:D,height:q,glyphWidth:I,glyphHeight:E,glyphTop:P,glyphLeft:0,glyphAdvance:e};if(I===0||E===0)return ie;const{ctx:se,buffer:Pe,gridInner:be,gridOuter:Se}=this;se.clearRect(Pe,Pe,I,E),se.fillText(m,Pe,Pe+P);const Ee=se.getImageData(Pe,Pe,I,E);Se.fill(_e,0,$),be.fill(0,0,$);for(let Ze=0;Ze<E;Ze++)for(let Ge=0;Ge<I;Ge++){const Xe=Ee.data[4*(Ze*I+Ge)+3]/255;if(Xe===0)continue;const Je=(Ze+Pe)*D+Ge+Pe;if(Xe===1)Se[Je]=0,be[Je]=_e;else{const Ye=.5-Xe;Se[Je]=Ye>0?Ye*Ye:0,be[Je]=Ye<0?Ye*Ye:0}}ve(Se,0,0,D,q,D,this.f,this.v,this.z),ve(be,Pe,Pe,I,E,D,this.f,this.v,this.z);for(let Ze=0;Ze<$;Ze++){const Ge=Math.sqrt(Se[Ze])-Math.sqrt(be[Ze]);W[Ze]=Math.round(255-255*(Ge/this.radius+this.cutoff))}return ie}};class wt{constructor(){this.specification=s.v.light.position}possiblyEvaluate(e,r){return s.z(e.expression.evaluate(r))}interpolate(e,r,l){return{x:s.B.number(e.x,r.x,l),y:s.B.number(e.y,r.y,l),z:s.B.number(e.z,r.z,l)}}}let ut;class At extends s.E{constructor(e){super(),ut=ut||new s.r({anchor:new s.D(s.v.light.anchor),position:new wt,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(ut),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,r={}){if(!this._validate(s.t,e,r))for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,l){return(!l||l.validate!==!1)&&s.x(this,e.call(s.y,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}const ht=new s.r({"sky-color":new s.D(s.v.sky["sky-color"]),"horizon-color":new s.D(s.v.sky["horizon-color"]),"fog-color":new s.D(s.v.sky["fog-color"]),"fog-ground-blend":new s.D(s.v.sky["fog-ground-blend"]),"horizon-fog-blend":new s.D(s.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new s.D(s.v.sky["sky-horizon-blend"]),"atmosphere-blend":new s.D(s.v.sky["atmosphere-blend"])});class Tt extends s.E{constructor(e){super(),this._transitionable=new s.T(ht),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.C(0))}setSky(e,r={}){if(!this._validate(s.F,e,r)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,l={}){return(l==null?void 0:l.validate)!==!1&&s.x(this,e.call(s.y,s.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Dt{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,r){const l=e.join(",")+String(r);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,r)),this.dashEntry[l]}getDashRanges(e,r,l){const u=[];let g=e.length%2==1?-e[e.length-1]*l:0,P=e[0]*l,I=!0;u.push({left:g,right:P,isDash:I,zeroLength:e[0]===0});let E=e[0];for(let D=1;D<e.length;D++){I=!I;const q=e[D];g=E*l,E+=q,P=E*l,u.push({left:g,right:P,isDash:I,zeroLength:q===0})}return u}addRoundDash(e,r,l){const u=r/2;for(let g=-l;g<=l;g++){const P=this.width*(this.nextRow+l+g);let I=0,E=e[I];for(let D=0;D<this.width;D++){D/E.right>1&&(E=e[++I]);const q=Math.abs(D-E.left),$=Math.abs(D-E.right),W=Math.min(q,$);let ie;const se=g/l*(u+1);if(E.isDash){const Pe=u-Math.abs(se);ie=Math.sqrt(W*W+Pe*Pe)}else ie=u-Math.sqrt(W*W+se*se);this.data[P+D]=Math.max(0,Math.min(255,ie+128))}}}addRegularDash(e){for(let I=e.length-1;I>=0;--I){const E=e[I],D=e[I+1];E.zeroLength?e.splice(I,1):D&&D.isDash===E.isDash&&(D.left=E.left,e.splice(I,1))}const r=e[0],l=e[e.length-1];r.isDash===l.isDash&&(r.left=l.left-this.width,l.right=r.right+this.width);const u=this.width*this.nextRow;let g=0,P=e[g];for(let I=0;I<this.width;I++){I/P.right>1&&(P=e[++g]);const E=Math.abs(I-P.left),D=Math.abs(I-P.right),q=Math.min(E,D);this.data[u+I]=Math.max(0,Math.min(255,(P.isDash?q:-q)+128))}}addDash(e,r){const l=r?7:0,u=2*l+1;if(this.nextRow+u>this.height)return s.w("LineAtlas out of space"),null;let g=0;for(let I=0;I<e.length;I++)g+=e[I];if(g!==0){const I=this.width/g,E=this.getDashRanges(e,this.width,I);r?this.addRoundDash(E,I,l):this.addRegularDash(E)}const P={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:g};return this.nextRow+=u,this.dirty=!0,P}bind(e){const r=e.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}const sr="maplibre_preloaded_worker_pool";class ne{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<ne.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[sr]}numActive(){return Object.keys(this.active).length}}const Ie=Math.floor(J.hardwareConcurrency/2);let Re,We;function nt(){return Re||(Re=new ne),Re}ne.workerCount=s.G(globalThis)?Math.max(Math.min(Ie,3),1):1;class at{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=r;const l=this.workerPool.acquire(r);for(let u=0;u<l.length;u++){const g=new s.H(l[u],r);g.name=`Worker ${u}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,r){const l=[];for(const u of this.actors)l.push(u.sendAsync({type:e,data:r}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(r=>{r.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,r){for(const l of this.actors)l.registerMessageHandler(e,r)}}function pt(){return We||(We=new at(nt(),s.J),We.registerMessageHandler("GR",(m,e,r)=>s.m(e,r))),We}function gt(m,e){const r=s.K();return s.L(r,r,[1,1,0]),s.M(r,r,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?s.N(r,r,m.calculatePosMatrix(e.toUnwrapped())):r}function Ht(m,e,r,l,u,g){var P;const I=function($,W,ie){if($)for(const se of $){const Pe=W[se];if(Pe&&Pe.source===ie&&Pe.type==="fill-extrusion")return!0}else for(const se in W){const Pe=W[se];if(Pe.source===ie&&Pe.type==="fill-extrusion")return!0}return!1}((P=u==null?void 0:u.layers)!==null&&P!==void 0?P:null,e,m.id),E=g.maxPitchScaleFactor(),D=m.tilesIn(l,E,I);D.sort($t);const q=[];for(const $ of D)q.push({wrappedTileID:$.tileID.wrapped().key,queryResults:$.tile.queryRenderedFeatures(e,r,m._state,$.queryGeometry,$.cameraQueryGeometry,$.scale,u,g,E,gt(m.transform,$.tileID))});return function($,W){for(const ie in $)for(const se of $[ie])er(se,W);return $}(function($){const W={},ie={};for(const se of $){const Pe=se.queryResults,be=se.wrappedTileID,Se=ie[be]=ie[be]||{};for(const Ee in Pe){const Ze=Pe[Ee],Ge=Se[Ee]=Se[Ee]||{},Xe=W[Ee]=W[Ee]||[];for(const Je of Ze)Ge[Je.featureIndex]||(Ge[Je.featureIndex]=!0,Xe.push(Je))}}return W}(q),m)}function $t(m,e){const r=m.tileID,l=e.tileID;return r.overscaledZ-l.overscaledZ||r.canonical.y-l.canonical.y||r.wrap-l.wrap||r.canonical.x-l.canonical.x}function er(m,e){const r=m.feature,l=e.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=l}function nr(m,e,r){return s._(this,void 0,void 0,function*(){let l=m;if(m.url?l=(yield s.j(e.transformRequest(m.url,"Source"),r)).data:yield J.frameAsync(r),!l)return null;const u=s.O(s.e(l,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(u.vectorLayerIds=l.vector_layers.map(g=>g.id)),u})}class dr{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof s.Q?new s.Q(e.lng,e.lat):s.Q.convert(e),this}setSouthWest(e){return this._sw=e instanceof s.Q?new s.Q(e.lng,e.lat):s.Q.convert(e),this}extend(e){const r=this._sw,l=this._ne;let u,g;if(e instanceof s.Q)u=e,g=e;else{if(!(e instanceof dr))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(dr.convert(e)):this.extend(s.Q.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(s.Q.convert(e)):this;if(u=e._sw,g=e._ne,!u||!g)return this}return r||l?(r.lng=Math.min(u.lng,r.lng),r.lat=Math.min(u.lat,r.lat),l.lng=Math.max(g.lng,l.lng),l.lat=Math.max(g.lat,l.lat)):(this._sw=new s.Q(u.lng,u.lat),this._ne=new s.Q(g.lng,g.lat)),this}getCenter(){return new s.Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.Q(this.getWest(),this.getNorth())}getSouthEast(){return new s.Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:l}=s.Q.convert(e);let u=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){return e instanceof dr?e:e&&new dr(e)}static fromLngLat(e,r=0){const l=360*r/40075017,u=l/Math.cos(Math.PI/180*e.lat);return new dr(new s.Q(e.lng-u,e.lat-l),new s.Q(e.lng+u,e.lat+l))}adjustAntiMeridian(){const e=new s.Q(this._sw.lng,this._sw.lat),r=new s.Q(this._ne.lng,this._ne.lat);return new dr(e,e.lng>r.lng?new s.Q(r.lng+360,r.lat):r)}}class Et{constructor(e,r,l){this.bounds=dr.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const r=Math.pow(2,e.z),l=Math.floor(s.U(this.bounds.getWest())*r),u=Math.floor(s.S(this.bounds.getNorth())*r),g=Math.ceil(s.U(this.bounds.getEast())*r),P=Math.ceil(s.S(this.bounds.getSouth())*r);return e.x>=l&&e.x<g&&e.y>=u&&e.y<P}}class qe extends s.E{constructor(e,r,l,u){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.O(r,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield nr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(s.e(this,e),e.bounds&&(this.tileBounds=new Et(e.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new s.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(e){return s._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(r,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};l.request.collectResourceTiming=this._collectResourceTiming;let u="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((g,P)=>{e.reloadPromise={resolve:g,reject:P}})}else e.actor=this.dispatcher.getActor(),u="LT";e.abortController=new AbortController;try{const g=yield e.actor.sendAsync({type:u,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,g)}catch(g){if(delete e.abortController,e.aborted)return;if(g&&g.status!==404)throw g;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,r){if(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return s._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return s._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class zr extends s.E{constructor(e,r,l,u){super(),this.id=e,this.dispatcher=l,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},r),s.e(this,s.O(r,["url","scheme","tileSize"]))}load(){return s._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield nr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(s.e(this,r),r.bounds&&(this.tileBounds=new Et(r.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(r){this._tileJSONRequest=null,this.fire(new s.k(r))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return s.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return s._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield Oe.getImage(this.map._requestManager.transformRequest(r,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const u=this.map.painter.context,g=u.gl,P=l.data;e.texture=this.map.painter.getTileTexture(P.width),e.texture?e.texture.update(P,{useMipmap:!0}):(e.texture=new Ae(u,P,g.RGBA,{useMipmap:!0}),e.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}abortTile(e){return s._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return s._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class yr extends zr{constructor(e,r,l,u){super(e,r,l,u),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(e){return s._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(r,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const u=yield Oe.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){const g=u.data;this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const P=s.b(g)&&s.V()?g:yield this.readImageNow(g),I={type:this.type,uid:e.uid,source:this.id,rawImageData:P,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const E=yield e.actor.sendAsync({type:"LDT",data:I});e.dem=E,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}readImageNow(e){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.W()){const r=e.width+2,l=e.height+2;try{return new s.R({width:r,height:l},yield s.X(e,-1,-1,r,l))}catch{}}return J.getImageData(e,1)})}_getNeighboringTiles(e){const r=e.canonical,l=Math.pow(2,r.z),u=(r.x-1+l)%l,g=r.x===0?e.wrap-1:e.wrap,P=(r.x+1+l)%l,I=r.x+1===l?e.wrap+1:e.wrap,E={};return E[new s.Y(e.overscaledZ,g,r.z,u,r.y).key]={backfilled:!1},E[new s.Y(e.overscaledZ,I,r.z,P,r.y).key]={backfilled:!1},r.y>0&&(E[new s.Y(e.overscaledZ,g,r.z,u,r.y-1).key]={backfilled:!1},E[new s.Y(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},E[new s.Y(e.overscaledZ,I,r.z,P,r.y-1).key]={backfilled:!1}),r.y+1<l&&(E[new s.Y(e.overscaledZ,g,r.z,u,r.y+1).key]={backfilled:!1},E[new s.Y(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},E[new s.Y(e.overscaledZ,I,r.z,P,r.y+1).key]={backfilled:!1}),E}unloadTile(e){return s._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Xt extends s.E{constructor(e,r,l,u){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(u),this._data=r.data,this._options=s.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId,r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&s.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=s.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(r.buffer!==void 0?r.buffer:128),tolerance:this._pixelsToTileUnits(r.tolerance!==void 0?r.tolerance:.375),extent:s.Z,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:s.Z,radius:this._pixelsToTileUnits(r.clusterRadius||50),log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(s.Z/this.tileSize)}load(){return s._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return s._(this,void 0,void 0,function*(){const e=s.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,r,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:r,offset:l}})}_updateWorkerData(e){return s._(this,void 0,void 0,function*(){const r=s.e({type:this.type},this.workerOptions);e?r.dataDiff=e:typeof this._data=="string"?(r.request=this.map._requestManager.transformRequest(J.resolveURL(this._data),"Source"),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.l("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:r});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new s.l("dataabort",{dataType:"source"}));let u=null;l.resourceTiming&&l.resourceTiming[this.id]&&(u=l.resourceTiming[this.id].slice(0));const g={dataType:"source"};this._collectResourceTiming&&u&&u.length>0&&s.e(g,{resourceTiming:u}),this.fire(new s.l("data",Object.assign(Object.assign({},g),{sourceDataType:"metadata"}))),this.fire(new s.l("data",Object.assign(Object.assign({},g),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new s.l("dataabort",{dataType:"source"}));this.fire(new s.k(l))}})}loaded(){return this._pendingLoads===0}loadTile(e){return s._(this,void 0,void 0,function*(){const r=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const u=yield this.actor.sendAsync({type:r,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(u,this.map.painter,r==="RT")})}abortTile(e){return s._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return s._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class ir extends s.E{constructor(e,r,l,u){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=l,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=r}load(e){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const r=yield Oe.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,e&&(this.coordinates=e),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,this.fire(new s.k(r))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const r=e.map(s.$.fromLngLat);var l;return this.tileID=function(u){let g=1/0,P=1/0,I=-1/0,E=-1/0;for(const W of u)g=Math.min(g,W.x),P=Math.min(P,W.y),I=Math.max(I,W.x),E=Math.max(E,W.y);const D=Math.max(I-g,E-P),q=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),$=Math.pow(2,q);return new s.a0(q,Math.floor((g+I)/2*$),Math.floor((P+E)/2*$))}(r),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=r.map(u=>this.tileID.getTilePoint(u)._round()),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,r=e.gl;this.texture||(this.texture=new Ae(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const g=this.tiles[u];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,l=!0)}l&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return s._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class ar extends ir{constructor(e,r,l,u){super(e,r,l,u),this.roundZoom=!0,this.type="video",this.options=r}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const r of e.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{const r=yield s.a1(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new s.k(r))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new s.k(new s.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,r=e.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new Ae(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const g=this.tiles[u];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,l=!0)}l&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class or extends ir{constructor(e,r,l,u){super(e,r,l,u),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(P=>typeof P!="number"))||this.fire(new s.k(new s.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.k(new s.a2(`sources.${e}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new s.k(new s.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new s.k(new s.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.k(new s.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return s._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,l=r.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ae(r,this.canvas,l.RGBA,{premultiply:!0});let u=!1;for(const g in this.tiles){const P=this.tiles[g];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture,u=!0)}u&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const xr={},wr=m=>{switch(m){case"geojson":return Xt;case"image":return ir;case"raster":return zr;case"raster-dem":return yr;case"vector":return qe;case"video":return ar;case"canvas":return or}return xr[m]},Dr="RTLPluginLoaded";class Fr extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=pt()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(r=>{throw this.status="error",r})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return s._(this,arguments,void 0,function*(r,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=J.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return s._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.l(Dr))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Zr=null;function Jr(){return Zr||(Zr=new Fr),Zr}class Mr{constructor(e,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=s.a3(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const r=e+this.timeAdded;r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,r,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,g){const P={};if(!g)return P;for(const I of u){const E=I.layerIds.map(D=>g.getLayer(D)).filter(Boolean);if(E.length!==0){I.layers=E,I.stateDependentLayerIds&&(I.stateDependentLayers=I.stateDependentLayerIds.map(D=>E.filter(q=>q.id===D)[0]));for(const D of E)P[D.id]=I}}return P}(e.buckets,r==null?void 0:r.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const g=this.buckets[u];if(g instanceof s.a5){if(this.hasSymbolBuckets=!0,!l)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const g=this.buckets[u];if(g instanceof s.a5&&g.hasRTLText){this.hasRTLText=!0,Jr().lazyLoad();break}}this.queryPadding=0;for(const u in this.buckets){const g=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(u).queryRadius(g))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new s.a4}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ae(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ae(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,l,u,g,P,I,E,D,q){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:g,scale:P,tileSize:this.tileSize,pixelPosMatrix:q,transform:E,params:I,queryPadding:this.queryPadding*D},e,r,l):{}}querySourceFeatures(e,r){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),g=r&&r.sourceLayer?r.sourceLayer:"",P=u._geojsonTileLayer||u[g];if(!P)return;const I=s.a6(r&&r.filter),{z:E,x:D,y:q}=this.tileID.canonical,$={z:E,x:D,y:q};for(let W=0;W<P.length;W++){const ie=P.feature(W);if(I.needGeometry){const be=s.a7(ie,!0);if(!I.filter(new s.C(this.tileID.overscaledZ),be,this.tileID.canonical))continue}else if(!I.filter(new s.C(this.tileID.overscaledZ),ie))continue;const se=l.getId(ie,g),Pe=new s.a8(ie,E,D,q,se);Pe.tile=$,e.push(Pe)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const l=s.a9(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(r)if(this.expirationTime<r)u=!0;else{const g=this.expirationTime-r;g?this.expirationTime=l+Math.max(g,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!r.style.hasLayer(u))continue;const g=this.buckets[u],P=g.layers[0].sourceLayer||"_geojsonTileLayer",I=l[P],E=e[P];if(!I||!E||Object.keys(E).length===0)continue;g.update(E,I,this.imageAtlas&&this.imageAtlas.patternPositions||{});const D=r&&r.style&&r.style.getLayer(u);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<J.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=J.now()+e}setDependencies(e,r){const l={};for(const u of r)l[u]=!0;this.dependencies[e]=l}hasDependency(e,r){for(const l of e){const u=this.dependencies[l];if(u){for(const g of r)if(u[g])return!0}}return!1}}class Rr{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,l){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const g={value:r,timeout:void 0};if(l!==void 0&&(g.timeout=setTimeout(()=>{this.remove(e,g)},l)),this.data[u].push(g),this.order.push(u),this.order.length>this.max){const P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const l=e.wrapped().key,u=r===void 0?0:this.data[l].indexOf(r),g=this.data[l][u];return this.data[l].splice(u,1),g.timeout&&clearTimeout(g.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(g.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const l in this.data)for(const u of this.data[l])e(u.value)||r.push(u);for(const l of r)this.remove(l.value.tileID,l)}}class ur{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,l){const u=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},s.e(this.stateChanges[e][u],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const g in this.state[e])g!==u&&(this.deletedStates[e][g]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const g in this.state[e][u])l[g]||(this.deletedStates[e][u][g]=null)}else for(const g in l)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][g]===null&&delete this.deletedStates[e][u][g]}removeFeatureState(e,r,l){if(this.deletedStates[e]===null)return;const u=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&r!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][l]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(l in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][l]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,r){const l=String(r),u=s.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const g=this.deletedStates[e][r];if(g===null)return{};for(const P in g)delete u[P]}return u}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const g={};for(const P in this.stateChanges[u])this.state[u][P]||(this.state[u][P]={}),s.e(this.state[u][P],this.stateChanges[u][P]),g[P]=this.state[u][P];l[u]=g}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const g={};if(this.deletedStates[u]===null)for(const P in this.state[u])g[P]={},this.state[u][P]={};else for(const P in this.deletedStates[u]){if(this.deletedStates[u][P]===null)this.state[u][P]={};else for(const I of Object.keys(this.deletedStates[u][P]))delete this.state[u][P][I];g[P]=this.state[u][P]}l[u]=l[u]||{},s.e(l[u],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in e)e[u].setFeatureState(l,r)}}function Wi(m,e,r){const l=e.intersectsFrustum(m);if(!r)return l;const u=e.intersectsPlane(r);return l===0||u===0?0:l===2&&u===2?2:1}function Qr(m,e,r,l,u){let g=m;const P=Math.atan(e/r),I=Math.hypot(e,r);return g=m+s.aa(l/I/Math.max(.5,Math.cos(s.ac(u/2)))),g+=1*s.aa(Math.cos(P))/2,g+=s.ad(m-g,-0,0),g}function Bi(m,e){const r=(e.roundZoom?Math.round:Math.floor)(m.zoom+s.aa(m.tileSize/e.tileSize));return Math.max(0,r)}function K(m,e){const r=m.getCameraFrustum(),l=m.getClippingPlane(),u=m.screenPointToMercatorCoordinate(m.getCameraPoint()),g=s.$.fromLngLat(m.center,m.elevation);u.z=g.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;const P=m.getCoveringTilesDetailsProvider(),I=P.allowVariableZoom(m,e),E=Bi(m,e),D=e.minzoom||0,q=e.maxzoom!==void 0?e.maxzoom:m.maxZoom,$=Math.min(Math.max(0,E),q),W=Math.pow(2,$),ie=[W*u.x,W*u.y,0],se=[W*g.x,W*g.y,0],Pe=Math.hypot(g.x-u.x,g.y-u.y),be=Math.abs(g.z-u.z),Se=Math.hypot(Pe,be),Ee=Xe=>({zoom:0,x:0,y:0,wrap:Xe,fullyVisible:!1}),Ze=[],Ge=[];if(m.renderWorldCopies&&P.allowWorldCopies())for(let Xe=1;Xe<=3;Xe++)Ze.push(Ee(-Xe)),Ze.push(Ee(Xe));for(Ze.push(Ee(0));Ze.length>0;){const Xe=Ze.pop(),Je=Xe.x,Ye=Xe.y;let vt=Xe.fullyVisible;const bt={x:Je,y:Ye,z:Xe.zoom},Mt=P.getTileAABB(bt,Xe.wrap,m.elevation,e);if(!vt){const Kt=Wi(r,Mt,l);if(Kt===0)continue;vt=Kt===2}const Lt=P.distanceToTile2d(u.x,u.y,bt,Mt);let It=E;I&&(It=(e.calculateTileZoom||Qr)(m.zoom+s.aa(m.tileSize/e.tileSize),Lt,be,Se,m.fov)),It=(e.roundZoom?Math.round:Math.floor)(It),It=Math.max(0,It);const tr=Math.min(It,q);if(Xe.wrap=P.getWrap(g,bt,Xe.wrap),Xe.zoom>=tr){if(Xe.zoom<D)continue;const Kt=$-Xe.zoom,Bt=ie[0]-.5-(Je<<Kt),gr=ie[1]-.5-(Ye<<Kt),_r=e.reparseOverscaled?Math.max(Xe.zoom,It):Xe.zoom;Ge.push({tileID:new s.Y(Xe.zoom===q?_r:Xe.zoom,Xe.wrap,Xe.zoom,Je,Ye),distanceSq:s.ab([se[0]-.5-Je,se[1]-.5-Ye]),tileDistanceToCamera:Math.sqrt(Bt*Bt+gr*gr)})}else for(let Kt=0;Kt<4;Kt++)Ze.push({zoom:Xe.zoom+1,x:(Je<<1)+Kt%2,y:(Ye<<1)+(Kt>>1),wrap:Xe.wrap,fullyVisible:vt})}return Ge.sort((Xe,Je)=>Xe.distanceSq-Je.distanceSq).map(Xe=>Xe.tileID)}class x extends s.E{constructor(e,r,l){super(),this.id=e,this.dispatcher=l,this.on("data",u=>this._dataHandler(u)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((u,g,P,I)=>{const E=new(wr(g.type))(u,g,P,I);if(E.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${E.id}`);return E})(e,r,l,this),this._tiles={},this._cache=new Rr(0,u=>this._unloadTile(u)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ur,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,r,l){return s._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,r,l)}catch(u){e.state="errored",u.status!==404?this._source.fire(new s.k(u,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new s.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const l=this._tiles[r];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(A).map(e=>e.key)}getRenderableIds(e){const r=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&r.push(this._tiles[l]);return e?r.sort((l,u)=>{const g=l.tileID,P=u.tileID,I=new s.P(g.canonical.x,g.canonical.y)._rotate(-this.transform.bearingInRadians),E=new s.P(P.canonical.x,P.canonical.y)._rotate(-this.transform.bearingInRadians);return g.overscaledZ-P.overscaledZ||E.y-I.y||E.x-I.x}).map(l=>l.tileID.key):r.map(l=>l.tileID).sort(A).map(l=>l.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)(e||this._tiles[r].state!=="errored")&&this._reloadTile(r,"reloading")}}_reloadTile(e,r){return s._(this,void 0,void 0,function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=r),yield this._loadTile(l,e,r))})}_tileLoaded(e,r,l){e.timeAdded=J.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new s.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const r=this.getRenderableIds();for(let u=0;u<r.length;u++){const g=r[u];if(e.neighboringTiles&&e.neighboringTiles[g]){const P=this.getTileByID(g);l(e,P),l(P,e)}}function l(u,g){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let P=g.tileID.canonical.x-u.tileID.canonical.x;const I=g.tileID.canonical.y-u.tileID.canonical.y,E=Math.pow(2,u.tileID.canonical.z),D=g.tileID.key;P===0&&I===0||Math.abs(I)>1||(Math.abs(P)>1&&(Math.abs(P+E)===1?P+=E:Math.abs(P-E)===1&&(P-=E)),g.dem&&u.dem&&(u.dem.backfillBorder(g.dem,P,I),u.neighboringTiles&&u.neighboringTiles[D]&&(u.neighboringTiles[D].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,l,u){for(const g in this._tiles){let P=this._tiles[g];if(u[g]||!P.hasData()||P.tileID.overscaledZ<=r||P.tileID.overscaledZ>l)continue;let I=P.tileID;for(;P&&P.tileID.overscaledZ>r+1;){const D=P.tileID.scaledTo(P.tileID.overscaledZ-1);P=this._tiles[D.key],P&&P.hasData()&&(I=D)}let E=I;for(;E.overscaledZ>r;)if(E=E.scaledTo(E.overscaledZ-1),e[E.key]||e[E.canonical.key]){u[I.key]=I;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=r?l:null}for(let l=e.overscaledZ-1;l>=r;l--){const u=e.scaledTo(l),g=this._getLoadedTile(u);if(g)return g}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const r=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,u=Math.floor(r*l*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(g)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const l={};for(const u in this._tiles){const g=this._tiles[u];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+r),l[g.tileID.key]=g}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}_updateCoveredAndRetainedTiles(e,r,l,u,g,P){const I={},E={},D=Object.keys(e),q=J.now();for(const $ of D){const W=e[$],ie=this._tiles[$];if(!ie||ie.fadeEndTime!==0&&ie.fadeEndTime<=q)continue;const se=this.findLoadedParent(W,r),Pe=this.findLoadedSibling(W),be=se||Pe||null;be&&(this._addTile(be.tileID),I[be.tileID.key]=be.tileID),E[$]=W}this._retainLoadedChildren(E,u,l,e);for(const $ in I)e[$]||(this._coveredTiles[$]=!0,e[$]=I[$]);if(P){const $={},W={};for(const ie of g)this._tiles[ie.key].hasData()?$[ie.key]=ie:W[ie.key]=ie;for(const ie in W){const se=W[ie].children(this._source.maxzoom);this._tiles[se[0].key]&&this._tiles[se[1].key]&&this._tiles[se[2].key]&&this._tiles[se[3].key]&&($[se[0].key]=e[se[0].key]=se[0],$[se[1].key]=e[se[1].key]=se[1],$[se[2].key]=e[se[2].key]=se[2],$[se[3].key]=e[se[3].key]=se[3],delete W[ie])}for(const ie in W){const se=W[ie],Pe=this.findLoadedParent(se,this._source.minzoom),be=this.findLoadedSibling(se),Se=Pe||be||null;if(Se){$[Se.tileID.key]=e[Se.tileID.key]=Se.tileID;for(const Ee in $)$[Ee].isChildOf(Se.tileID)&&delete $[Ee]}}for(const ie in this._tiles)$[ie]||(this._coveredTiles[ie]=!0)}}update(e,r){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=r,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(q=>new s.Y(q.canonical.z,q.wrap,q.canonical.z,q.canonical.x,q.canonical.y)):(l=K(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter(q=>this._source.hasTile(q)))):l=[];const u=Bi(e,this._source),g=Math.max(u-x.maxOverzooming,this._source.minzoom),P=Math.max(u+x.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const q={};for(const $ of l)if($.canonical.z>this._source.minzoom){const W=$.scaledTo($.canonical.z-1);q[W.key]=W;const ie=$.scaledTo(Math.max(this._source.minzoom,Math.min($.canonical.z,5)));q[ie.key]=ie}l=l.concat(Object.values(q))}const I=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,I&&this.fire(new s.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const E=this._updateRetainedTiles(l,u);O(this._source.type)&&this._updateCoveredAndRetainedTiles(E,g,P,u,l,r);for(const q in E)this._tiles[q].clearFadeHold();const D=s.ae(this._tiles,E);for(const q of D){const $=this._tiles[q];$.hasSymbolBuckets&&!$.holdingForFade()?$.setHoldDuration(this.map._fadeDuration):$.hasSymbolBuckets&&!$.symbolFadeFinished()||this._removeTile(q)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,r){var l;const u={},g={},P=Math.max(r-x.maxOverzooming,this._source.minzoom),I=Math.max(r+x.maxUnderzooming,this._source.minzoom),E={};for(const D of e){const q=this._addTile(D);u[D.key]=D,q.hasData()||r<this._source.maxzoom&&(E[D.key]=D)}this._retainLoadedChildren(E,r,I,u);for(const D of e){let q=this._tiles[D.key];if(q.hasData())continue;if(r+1>this._source.maxzoom){const W=D.children(this._source.maxzoom)[0],ie=this.getTile(W);if(ie&&ie.hasData()){u[W.key]=W;continue}}else{const W=D.children(this._source.maxzoom);if(u[W[0].key]&&u[W[1].key]&&u[W[2].key]&&u[W[3].key])continue}let $=q.wasRequested();for(let W=D.overscaledZ-1;W>=P;--W){const ie=D.scaledTo(W);if(g[ie.key])break;if(g[ie.key]=!0,q=this.getTile(ie),!q&&$&&(q=this._addTile(ie)),q){const se=q.hasData();if((se||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||$)&&(u[ie.key]=ie),$=q.wasRequested(),se)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let l,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}r.push(u.key);const g=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(g),l)break;u=g}for(const g of r)this._loadedParentTiles[g]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const r=this._tiles[e].tileID,l=this._getLoadedTile(r);this._loadedSiblingTiles[r.key]=l}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const l=r;return r||(r=new Mr(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,e.key,r.state)),r.uses++,this._tiles[e.key]=r,l||this._source.fire(new s.l("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=r.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(e){const r=e.sourceDataType;e.dataType==="source"&&r==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&r==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,r,l){const u=[],g=this.transform;if(!g)return u;const P=l?g.getCameraQueryGeometry(e):e,I=e.map(se=>g.screenPointToMercatorCoordinate(se,this.terrain)),E=P.map(se=>g.screenPointToMercatorCoordinate(se,this.terrain)),D=this.getIds();let q=1/0,$=1/0,W=-1/0,ie=-1/0;for(const se of E)q=Math.min(q,se.x),$=Math.min($,se.y),W=Math.max(W,se.x),ie=Math.max(ie,se.y);for(let se=0;se<D.length;se++){const Pe=this._tiles[D[se]];if(Pe.holdingForFade())continue;const be=Pe.tileID,Se=Math.pow(2,g.zoom-Pe.tileID.overscaledZ),Ee=r*Pe.queryPadding*s.Z/Pe.tileSize/Se,Ze=[be.getTilePoint(new s.$(q,$)),be.getTilePoint(new s.$(W,ie))];if(Ze[0].x-Ee<s.Z&&Ze[0].y-Ee<s.Z&&Ze[1].x+Ee>=0&&Ze[1].y+Ee>=0){const Ge=I.map(Je=>be.getTilePoint(Je)),Xe=E.map(Je=>be.getTilePoint(Je));u.push({tile:Pe,tileID:be,queryGeometry:Ge,cameraQueryGeometry:Xe,scale:Se})}}return u}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);return this.transform&&this.transform.populateCache(r),r}hasTransition(){if(this._source.hasTransition())return!0;if(O(this._source.type)){const e=J.now();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=e)return!0}return!1}setFeatureState(e,r,l){this._state.updateState(e=e||"_geojsonTileLayer",r,l)}removeFeatureState(e,r,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,l)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,l){const u=this._tiles[e];u&&u.setDependencies(r,l)}reloadTilesForDependencies(e,r){for(const l in this._tiles)this._tiles[l].hasDependency(e,r)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(e,r))}}function A(m,e){const r=Math.abs(2*m.wrap)-+(m.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return m.overscaledZ-e.overscaledZ||l-r||e.canonical.y-m.canonical.y||e.canonical.x-m.canonical.x}function O(m){return m==="raster"||m==="image"||m==="video"}x.maxOverzooming=10,x.maxUnderzooming=3;class G{constructor(e,r){this.reset(e,r)}reset(e,r){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=s.ad(e,0,1);let r=1,l=this._distances[r];const u=e*this.paddedLength+this.padding;for(;l<u&&r<this._distances.length;)l=this._distances[++r];const g=r-1,P=this._distances[g],I=l-P,E=I>0?(u-P)/I:0;return this.points[g].mult(1-E).add(this.points[r].mult(E))}}function Q(m,e){let r=!0;return m==="always"||m!=="never"&&e!=="never"||(r=!1),r}class le{constructor(e,r,l){const u=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(r/l);for(let P=0;P<this.xCellCount*this.yCellCount;P++)u.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=r,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,r,l,u,g){this._forEachCell(r,l,u,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(g)}insertCircle(e,r,l,u){this._forEachCell(r-u,l-u,r+u,l+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(r),this.circles.push(l),this.circles.push(u)}_insertBoxCell(e,r,l,u,g,P){this.boxCells[g].push(P)}_insertCircleCell(e,r,l,u,g,P){this.circleCells[g].push(P)}_query(e,r,l,u,g,P,I){if(l<0||e>this.width||u<0||r>this.height)return[];const E=[];if(e<=0&&r<=0&&this.width<=l&&this.height<=u){if(g)return[{key:null,x1:e,y1:r,x2:l,y2:u}];for(let D=0;D<this.boxKeys.length;D++)E.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const q=this.circles[3*D],$=this.circles[3*D+1],W=this.circles[3*D+2];E.push({key:this.circleKeys[D],x1:q-W,y1:$-W,x2:q+W,y2:$+W})}}else this._forEachCell(e,r,l,u,this._queryCell,E,{hitTest:g,overlapMode:P,seenUids:{box:{},circle:{}}},I);return E}query(e,r,l,u){return this._query(e,r,l,u,!1,null)}hitTest(e,r,l,u,g,P){return this._query(e,r,l,u,!0,g,P).length>0}hitTestCircle(e,r,l,u,g){const P=e-l,I=e+l,E=r-l,D=r+l;if(I<0||P>this.width||D<0||E>this.height)return!1;const q=[];return this._forEachCell(P,E,I,D,this._queryCellCircle,q,{hitTest:!0,overlapMode:u,circle:{x:e,y:r,radius:l},seenUids:{box:{},circle:{}}},g),q.length>0}_queryCell(e,r,l,u,g,P,I,E){const{seenUids:D,hitTest:q,overlapMode:$}=I,W=this.boxCells[g];if(W!==null){const se=this.bboxes;for(const Pe of W)if(!D.box[Pe]){D.box[Pe]=!0;const be=4*Pe,Se=this.boxKeys[Pe];if(e<=se[be+2]&&r<=se[be+3]&&l>=se[be+0]&&u>=se[be+1]&&(!E||E(Se))&&(!q||!Q($,Se.overlapMode))&&(P.push({key:Se,x1:se[be],y1:se[be+1],x2:se[be+2],y2:se[be+3]}),q))return!0}}const ie=this.circleCells[g];if(ie!==null){const se=this.circles;for(const Pe of ie)if(!D.circle[Pe]){D.circle[Pe]=!0;const be=3*Pe,Se=this.circleKeys[Pe];if(this._circleAndRectCollide(se[be],se[be+1],se[be+2],e,r,l,u)&&(!E||E(Se))&&(!q||!Q($,Se.overlapMode))){const Ee=se[be],Ze=se[be+1],Ge=se[be+2];if(P.push({key:Se,x1:Ee-Ge,y1:Ze-Ge,x2:Ee+Ge,y2:Ze+Ge}),q)return!0}}}return!1}_queryCellCircle(e,r,l,u,g,P,I,E){const{circle:D,seenUids:q,overlapMode:$}=I,W=this.boxCells[g];if(W!==null){const se=this.bboxes;for(const Pe of W)if(!q.box[Pe]){q.box[Pe]=!0;const be=4*Pe,Se=this.boxKeys[Pe];if(this._circleAndRectCollide(D.x,D.y,D.radius,se[be+0],se[be+1],se[be+2],se[be+3])&&(!E||E(Se))&&!Q($,Se.overlapMode))return P.push(!0),!0}}const ie=this.circleCells[g];if(ie!==null){const se=this.circles;for(const Pe of ie)if(!q.circle[Pe]){q.circle[Pe]=!0;const be=3*Pe,Se=this.circleKeys[Pe];if(this._circlesCollide(se[be],se[be+1],se[be+2],D.x,D.y,D.radius)&&(!E||E(Se))&&!Q($,Se.overlapMode))return P.push(!0),!0}}}_forEachCell(e,r,l,u,g,P,I,E){const D=this._convertToXCellCoord(e),q=this._convertToYCellCoord(r),$=this._convertToXCellCoord(l),W=this._convertToYCellCoord(u);for(let ie=D;ie<=$;ie++)for(let se=q;se<=W;se++)if(g.call(this,e,r,l,u,this.xCellCount*se+ie,P,I,E))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,r,l,u,g,P){const I=u-e,E=g-r,D=l+P;return D*D>I*I+E*E}_circleAndRectCollide(e,r,l,u,g,P,I){const E=(P-u)/2,D=Math.abs(e-(u+E));if(D>E+l)return!1;const q=(I-g)/2,$=Math.abs(r-(g+q));if($>q+l)return!1;if(D<=E||$<=q)return!0;const W=D-E,ie=$-q;return W*W+ie*ie<=l*l}}function Te(m,e,r){const l=s.K();if(!m){const{vecSouth:$,vecEast:W}=xe(e),ie=B();ie[0]=W[0],ie[1]=W[1],ie[2]=$[0],ie[3]=$[1],u=ie,(q=(P=(g=ie)[0])*(D=g[3])-(E=g[2])*(I=g[1]))&&(u[0]=D*(q=1/q),u[1]=-I*q,u[2]=-E*q,u[3]=P*q),l[0]=ie[0],l[1]=ie[1],l[4]=ie[2],l[5]=ie[3]}var u,g,P,I,E,D,q;return s.M(l,l,[1/r,1/r,1]),l}function ue(m,e,r,l){if(m){const u=s.K();if(!e){const{vecSouth:g,vecEast:P}=xe(r);u[0]=P[0],u[1]=P[1],u[4]=g[0],u[5]=g[1]}return s.M(u,u,[l,l,1]),u}return r.pixelsToClipSpaceMatrix}function xe(m){const e=Math.cos(m.rollInRadians),r=Math.sin(m.rollInRadians),l=Math.cos(m.pitchInRadians),u=Math.cos(m.bearingInRadians),g=Math.sin(m.bearingInRadians),P=s.aj();P[0]=-u*l*r-g*e,P[1]=-g*l*r+u*e;const I=s.ak(P);I<1e-9?s.al(P):s.am(P,P,1/I);const E=s.aj();E[0]=u*l*e-g*r,E[1]=g*l*e+u*r;const D=s.ak(E);return D<1e-9?s.al(E):s.am(E,E,1/D),{vecEast:E,vecSouth:P}}function we(m,e,r,l){let u;l?(u=[m,e,l(m,e),1],s.ao(u,u,r)):(u=[m,e,0,1],yi(u,u,r));const g=u[3];return{point:new s.P(u[0]/g,u[1]/g),signedDistanceFromCamera:g,isOccluded:!1}}function ze(m,e){return .5+m/e*.5}function Qe(m,e){return m.x>=-e[0]&&m.x<=e[0]&&m.y>=-e[1]&&m.y<=e[1]}function je(m,e,r,l,u,g,P,I,E,D,q,$,W){const ie=r?m.textSizeData:m.iconSizeData,se=s.af(ie,e.transform.zoom),Pe=[256/e.width*2+1,256/e.height*2+1],be=r?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;be.clear();const Se=m.lineVertexArray,Ee=r?m.text.placedSymbolArray:m.icon.placedSymbolArray,Ze=e.transform.width/e.transform.height;let Ge=!1;for(let Xe=0;Xe<Ee.length;Xe++){const Je=Ee.get(Xe);if(Je.hidden||Je.writingMode===s.ag.vertical&&!Ge){di(Je.numGlyphs,be);continue}Ge=!1;const Ye=new s.P(Je.anchorX,Je.anchorY),vt={getElevation:W,pitchedLabelPlaneMatrix:l,lineVertexArray:Se,pitchWithMap:g,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:Ye,unwrappedTileID:E,width:D,height:q,translation:$},bt=Pr(Je.anchorX,Je.anchorY,vt);if(!Qe(bt.point,Pe)){di(Je.numGlyphs,be);continue}const Mt=ze(e.transform.cameraToCenterDistance,bt.signedDistanceFromCamera),Lt=s.ah(ie,se,Je),It=g?Lt*e.transform.getPitchedTextCorrection(Je.anchorX,Je.anchorY,E)/Mt:Lt*Mt,tr=rr({projectionContext:vt,pitchedLabelPlaneMatrixInverse:u,symbol:Je,fontSize:It,flip:!1,keepUpright:P,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:be,aspectRatio:Ze,rotateToLine:I});Ge=tr.useVertical,(tr.notEnoughRoom||Ge||tr.needsFlipping&&rr({projectionContext:vt,pitchedLabelPlaneMatrixInverse:u,symbol:Je,fontSize:It,flip:!0,keepUpright:P,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:be,aspectRatio:Ze,rotateToLine:I}).notEnoughRoom)&&di(Je.numGlyphs,be)}r?m.text.dynamicLayoutVertexBuffer.updateData(be):m.icon.dynamicLayoutVertexBuffer.updateData(be)}function ft(m,e,r,l,u,g,P,I){const E=g.glyphStartIndex+g.numGlyphs,D=g.lineStartIndex,q=g.lineStartIndex+g.lineLength,$=e.getoffsetX(g.glyphStartIndex),W=e.getoffsetX(E-1),ie=pr(m*$,r,l,u,g.segment,D,q,I,P);if(!ie)return null;const se=pr(m*W,r,l,u,g.segment,D,q,I,P);return se?I.projectionCache.anyProjectionOccluded?null:{first:ie,last:se}:null}function Pt(m,e,r,l){return m===s.ag.horizontal&&Math.abs(r.y-e.y)>Math.abs(r.x-e.x)*l?{useVertical:!0}:(m===s.ag.vertical?e.y<r.y:e.x>r.x)?{needsFlipping:!0}:null}function rr(m){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:r,symbol:l,fontSize:u,flip:g,keepUpright:P,glyphOffsetArray:I,dynamicLayoutVertexArray:E,aspectRatio:D,rotateToLine:q}=m,$=u/24,W=l.lineOffsetX*$,ie=l.lineOffsetY*$;let se;if(l.numGlyphs>1){const Pe=l.glyphStartIndex+l.numGlyphs,be=l.lineStartIndex,Se=l.lineStartIndex+l.lineLength,Ee=ft($,I,W,ie,g,l,q,e);if(!Ee)return{notEnoughRoom:!0};const Ze=Qt(Ee.first.point.x,Ee.first.point.y,e,r),Ge=Qt(Ee.last.point.x,Ee.last.point.y,e,r);if(P&&!g){const Xe=Pt(l.writingMode,Ze,Ge,D);if(Xe)return Xe}se=[Ee.first];for(let Xe=l.glyphStartIndex+1;Xe<Pe-1;Xe++)se.push(pr($*I.getoffsetX(Xe),W,ie,g,l.segment,be,Se,e,q));se.push(Ee.last)}else{if(P&&!g){const be=Zt(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,Se=l.lineStartIndex+l.segment+1,Ee=new s.P(e.lineVertexArray.getx(Se),e.lineVertexArray.gety(Se)),Ze=Zt(Ee.x,Ee.y,e),Ge=Ze.signedDistanceFromCamera>0?Ze.point:lr(e.tileAnchorPoint,Ee,be,1,e),Xe=Qt(be.x,be.y,e,r),Je=Qt(Ge.x,Ge.y,e,r),Ye=Pt(l.writingMode,Xe,Je,D);if(Ye)return Ye}const Pe=pr($*I.getoffsetX(l.glyphStartIndex),W,ie,g,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,e,q);if(!Pe||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};se=[Pe]}for(const Pe of se)s.an(E,Pe.point,Pe.angle);return{}}function lr(m,e,r,l,u){const g=m.add(m.sub(e)._unit()),P=Zt(g.x,g.y,u).point,I=r.sub(P);return r.add(I._mult(l/I.mag()))}function yt(m,e,r){const l=e.projectionCache;if(l.projections[m])return l.projections[m];const u=new s.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),g=Zt(u.x,u.y,e);if(g.signedDistanceFromCamera>0)return l.projections[m]=g.point,l.anyProjectionOccluded=l.anyProjectionOccluded||g.isOccluded,g.point;const P=m-r.direction;return lr(r.distanceFromAnchor===0?e.tileAnchorPoint:new s.P(e.lineVertexArray.getx(P),e.lineVertexArray.gety(P)),u,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,e)}function Zt(m,e,r){const l=m+r.translation[0],u=e+r.translation[1];let g;return r.pitchWithMap?(g=we(l,u,r.pitchedLabelPlaneMatrix,r.getElevation),g.isOccluded=!1):(g=r.transform.projectTileCoordinates(l,u,r.unwrappedTileID,r.getElevation),g.point.x=(.5*g.point.x+.5)*r.width,g.point.y=(.5*-g.point.y+.5)*r.height),g}function Qt(m,e,r,l){if(r.pitchWithMap){const u=[m,e,0,1];return s.ao(u,u,l),r.transform.projectTileCoordinates(u[0]/u[3],u[1]/u[3],r.unwrappedTileID,r.getElevation).point}return{x:m/r.width*2-1,y:e/r.height*2-1}}function Pr(m,e,r){return r.transform.projectTileCoordinates(m,e,r.unwrappedTileID,r.getElevation)}function Sr(m,e,r){return m._unit()._perp()._mult(e*r)}function Ir(m,e,r,l,u,g,P,I,E){if(I.projectionCache.offsets[m])return I.projectionCache.offsets[m];const D=r.add(e);if(m+E.direction<l||m+E.direction>=u)return I.projectionCache.offsets[m]=D,D;const q=yt(m+E.direction,I,E),$=Sr(q.sub(r),P,E.direction),W=r.add($),ie=q.add($);return I.projectionCache.offsets[m]=s.ap(g,D,W,ie)||D,I.projectionCache.offsets[m]}function pr(m,e,r,l,u,g,P,I,E){const D=l?m-e:m+e;let q=D>0?1:-1,$=0;l&&(q*=-1,$=Math.PI),q<0&&($+=Math.PI);let W,ie=q>0?g+u:g+u+1;I.projectionCache.cachedAnchorPoint?W=I.projectionCache.cachedAnchorPoint:(W=Zt(I.tileAnchorPoint.x,I.tileAnchorPoint.y,I).point,I.projectionCache.cachedAnchorPoint=W);let se,Pe,be=W,Se=W,Ee=0,Ze=0;const Ge=Math.abs(D),Xe=[];let Je;for(;Ee+Ze<=Ge;){if(ie+=q,ie<g||ie>=P)return null;Ee+=Ze,Se=be,Pe=se;const bt={absOffsetX:Ge,direction:q,distanceFromAnchor:Ee,previousVertex:Se};if(be=yt(ie,I,bt),r===0)Xe.push(Se),Je=be.sub(Se);else{let Mt;const Lt=be.sub(Se);Mt=Lt.mag()===0?Sr(yt(ie+q,I,bt).sub(be),r,q):Sr(Lt,r,q),Pe||(Pe=Se.add(Mt)),se=Ir(ie,Mt,be,g,P,Pe,r,I,bt),Xe.push(Pe),Je=se.sub(Pe)}Ze=Je.mag()}const Ye=Je._mult((Ge-Ee)/Ze)._add(Pe||Se),vt=$+Math.atan2(be.y-Se.y,be.x-Se.x);return Xe.push(Ye),{point:Ye,angle:E?vt:0,path:Xe}}const en=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function di(m,e){for(let r=0;r<m;r++){const l=e.length;e.resize(l+4),e.float32.set(en,3*l)}}function yi(m,e,r){const l=e[0],u=e[1];return m[0]=r[0]*l+r[4]*u+r[12],m[1]=r[1]*l+r[5]*u+r[13],m[3]=r[3]*l+r[7]*u+r[15],m}const ri=100;class xs{constructor(e,r=new le(e.width+200,e.height+200,25),l=new le(e.width+200,e.height+200,25)){this.transform=e,this.grid=r,this.ignoredGrid=l,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+ri,this.screenBottomBoundary=e.height+ri,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,r,l,u,g,P,I,E,D,q,$,W){const ie=this.projectAndGetPerspectiveRatio(e.anchorPointX+E[0],e.anchorPointY+E[1],g,q,W),se=l*ie.perspectiveRatio;let Pe;if(P||I)Pe=this._projectCollisionBox(e,se,u,g,P,I,E,ie,q,$,W);else{const Je=ie.x+($?$.x*se:0),Ye=ie.y+($?$.y*se:0);Pe={allPointsOccluded:!1,box:[Je+e.x1*se,Ye+e.y1*se,Je+e.x2*se,Ye+e.y2*se]}}const[be,Se,Ee,Ze]=Pe.box,Ge=P?Pe.allPointsOccluded:ie.isOccluded;let Xe=Ge;return Xe||(Xe=ie.perspectiveRatio<this.perspectiveRatioCutoff),Xe||(Xe=!this.isInsideGrid(be,Se,Ee,Ze)),Xe||r!=="always"&&this.grid.hitTest(be,Se,Ee,Ze,r,D)?{box:[be,Se,Ee,Ze],placeable:!1,offscreen:!1,occluded:Ge}:{box:[be,Se,Ee,Ze],placeable:!0,offscreen:this.isOffscreen(be,Se,Ee,Ze),occluded:Ge}}placeCollisionCircles(e,r,l,u,g,P,I,E,D,q,$,W,ie,se){const Pe=[],be=new s.P(r.anchorX,r.anchorY),Se=this.getPerspectiveRatio(be.x,be.y,P,se),Ee=(D?g*this.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,P)/Se:g*Se)/s.au,Ze={getElevation:se,pitchedLabelPlaneMatrix:I,lineVertexArray:l,pitchWithMap:D,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:be,unwrappedTileID:P,width:this.transform.width,height:this.transform.height,translation:ie},Ge=ft(Ee,u,r.lineOffsetX*Ee,r.lineOffsetY*Ee,!1,r,!1,Ze);let Xe=!1,Je=!1,Ye=!0;if(Ge){const vt=.5*$*Se+W,bt=new s.P(-100,-100),Mt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Lt=new G,It=Ge.first,tr=Ge.last;let Kt=[];for(let _r=It.path.length-1;_r>=1;_r--)Kt.push(It.path[_r]);for(let _r=1;_r<tr.path.length;_r++)Kt.push(tr.path[_r]);const Bt=2.5*vt;if(D){const _r=this.projectPathToScreenSpace(Kt,Ze);Kt=_r.some(oi=>oi.signedDistanceFromCamera<=0)?[]:_r.map(oi=>oi.point)}let gr=[];if(Kt.length>0){const _r=Kt[0].clone(),oi=Kt[0].clone();for(let Pi=1;Pi<Kt.length;Pi++)_r.x=Math.min(_r.x,Kt[Pi].x),_r.y=Math.min(_r.y,Kt[Pi].y),oi.x=Math.max(oi.x,Kt[Pi].x),oi.y=Math.max(oi.y,Kt[Pi].y);gr=_r.x>=bt.x&&oi.x<=Mt.x&&_r.y>=bt.y&&oi.y<=Mt.y?[Kt]:oi.x<bt.x||_r.x>Mt.x||oi.y<bt.y||_r.y>Mt.y?[]:s.aq([Kt],bt.x,bt.y,Mt.x,Mt.y)}for(const _r of gr){Lt.reset(_r,.25*vt);let oi=0;oi=Lt.length<=.5*vt?1:Math.ceil(Lt.paddedLength/Bt)+1;for(let Pi=0;Pi<oi;Pi++){const bi=Pi/Math.max(oi-1,1),Mi=Lt.lerp(bi),_i=Mi.x+ri,hi=Mi.y+ri;Pe.push(_i,hi,vt,0);const vi=_i-vt,Tn=hi-vt,vn=_i+vt,bn=hi+vt;if(Ye=Ye&&this.isOffscreen(vi,Tn,vn,bn),Je=Je||this.isInsideGrid(vi,Tn,vn,bn),e!=="always"&&this.grid.hitTestCircle(_i,hi,vt,e,q)&&(Xe=!0,!E))return{circles:[],offscreen:!1,collisionDetected:Xe}}}}return{circles:!E&&Xe||!Je||Se<this.perspectiveRatioCutoff?[]:Pe,offscreen:Ye,collisionDetected:Xe}}projectPathToScreenSpace(e,r){const l=function(u,g){const P=s.K();return s.ai(P,g.pitchedLabelPlaneMatrix),u.map(I=>{const E=we(I.x,I.y,P,g.getElevation),D=g.transform.projectTileCoordinates(E.point.x,E.point.y,g.unwrappedTileID,g.getElevation);return D.point.x=(.5*D.point.x+.5)*g.width,D.point.y=(.5*-D.point.y+.5)*g.height,D})}(e,r);return function(u){let g=0,P=0,I=0,E=0;for(let D=0;D<u.length;D++)u[D].isOccluded?(I=D+1,E=0):(E++,E>P&&(P=E,g=I));return u.slice(g,g+P)}(l)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let l=1/0,u=1/0,g=-1/0,P=-1/0;for(const q of e){const $=new s.P(q.x+ri,q.y+ri);l=Math.min(l,$.x),u=Math.min(u,$.y),g=Math.max(g,$.x),P=Math.max(P,$.y),r.push($)}const I=this.grid.query(l,u,g,P).concat(this.ignoredGrid.query(l,u,g,P)),E={},D={};for(const q of I){const $=q.key;if(E[$.bucketInstanceId]===void 0&&(E[$.bucketInstanceId]={}),E[$.bucketInstanceId][$.featureIndex])continue;const W=[new s.P(q.x1,q.y1),new s.P(q.x2,q.y1),new s.P(q.x2,q.y2),new s.P(q.x1,q.y2)];s.ar(r,W)&&(E[$.bucketInstanceId][$.featureIndex]=!0,D[$.bucketInstanceId]===void 0&&(D[$.bucketInstanceId]=[]),D[$.bucketInstanceId].push($.featureIndex))}return D}insertCollisionBox(e,r,l,u,g,P){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:g,collisionGroupID:P,overlapMode:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,r,l,u,g,P){const I=l?this.ignoredGrid:this.grid,E={bucketInstanceId:u,featureIndex:g,collisionGroupID:P,overlapMode:r};for(let D=0;D<e.length;D+=4)I.insertCircle(E,e[D],e[D+1],e[D+2])}projectAndGetPerspectiveRatio(e,r,l,u,g){if(g){let P;u?(P=[e,r,u(e,r),1],s.ao(P,P,g)):(P=[e,r,0,1],yi(P,P,g));const I=P[3];return{x:(P[0]/I+1)/2*this.transform.width+ri,y:(-P[1]/I+1)/2*this.transform.height+ri,perspectiveRatio:.5+this.transform.cameraToCenterDistance/I*.5,isOccluded:!1,signedDistanceFromCamera:I}}{const P=this.transform.projectTileCoordinates(e,r,l,u);return{x:(P.point.x+1)/2*this.transform.width+ri,y:(1-P.point.y)/2*this.transform.height+ri,perspectiveRatio:.5+this.transform.cameraToCenterDistance/P.signedDistanceFromCamera*.5,isOccluded:P.isOccluded,signedDistanceFromCamera:P.signedDistanceFromCamera}}}getPerspectiveRatio(e,r,l,u){const g=this.transform.projectTileCoordinates(e,r,l,u);return .5+this.transform.cameraToCenterDistance/g.signedDistanceFromCamera*.5}isOffscreen(e,r,l,u){return l<ri||e>=this.screenRightBoundary||u<ri||r>this.screenBottomBoundary}isInsideGrid(e,r,l,u){return l>=0&&e<this.gridRightBoundary&&u>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const e=s.as([]);return s.L(e,e,[-100,-100,0]),e}_projectCollisionBox(e,r,l,u,g,P,I,E,D,q,$){let W=1,ie=0,se=0,Pe=1;const be=e.anchorPointX+I[0],Se=e.anchorPointY+I[1];if(P&&!g){const Kt=this.projectAndGetPerspectiveRatio(be+1,Se,u,D,$),Bt=Kt.x-E.x,gr=Math.atan((Kt.y-E.y)/Bt)+(Bt<0?Math.PI:0),_r=Math.sin(gr),oi=Math.cos(gr);W=oi,ie=_r,se=-_r,Pe=oi}else if(!P&&g){const Kt=xe(this.transform);W=Kt.vecEast[0],ie=Kt.vecEast[1],se=Kt.vecSouth[0],Pe=Kt.vecSouth[1]}let Ee=E.x,Ze=E.y,Ge=r;g&&(Ee=be,Ze=Se,Ge=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),Ge*=this.transform.getPitchedTextCorrection(be,Se,u),q||(Ge*=s.ad(.5+E.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),q&&(Ee+=W*q.x*Ge+se*q.y*Ge,Ze+=ie*q.x*Ge+Pe*q.y*Ge);const Xe=e.x1*Ge,Je=e.x2*Ge,Ye=(Xe+Je)/2,vt=e.y1*Ge,bt=e.y2*Ge,Mt=(vt+bt)/2,Lt=[{offsetX:Xe,offsetY:vt},{offsetX:Ye,offsetY:vt},{offsetX:Je,offsetY:vt},{offsetX:Je,offsetY:Mt},{offsetX:Je,offsetY:bt},{offsetX:Ye,offsetY:bt},{offsetX:Xe,offsetY:bt},{offsetX:Xe,offsetY:Mt}];let It=[];for(const{offsetX:Kt,offsetY:Bt}of Lt)It.push(new s.P(Ee+W*Kt+se*Bt,Ze+ie*Kt+Pe*Bt));let tr=!1;if(g){const Kt=It.map(Bt=>this.projectAndGetPerspectiveRatio(Bt.x,Bt.y,u,D,$));tr=Kt.some(Bt=>!Bt.isOccluded),It=Kt.map(Bt=>new s.P(Bt.x,Bt.y))}else tr=!0;return{box:s.at(It),allPointsOccluded:!tr}}}class cn{constructor(e,r,l,u){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?r:-r))):u&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class ci{constructor(e,r,l,u,g){this.text=new cn(e?e.text:null,r,l,g),this.icon=new cn(e?e.icon:null,r,u,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class wo{constructor(e,r,l){this.text=e,this.icon=r,this.skipFade=l}}class fa{constructor(e,r,l,u,g){this.bucketInstanceId=e,this.featureIndex=r,this.sourceLayerIndex=l,this.bucketIndex=u,this.tileID=g}}class ro{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const r=++this.maxGroupID;this.collisionGroups[e]={ID:r,predicate:l=>l.collisionGroupID===r}}return this.collisionGroups[e]}}function Ks(m,e,r,l,u){const{horizontalAlign:g,verticalAlign:P}=s.aA(m);return new s.P(-(g-.5)*e+l[0]*u,-(P-.5)*r+l[1]*u)}class io{constructor(e,r,l,u,g){this.transform=e.clone(),this.terrain=r,this.collisionIndex=new xs(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new ro(u),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const r=this.terrain;return r?(l,u)=>r.getElevation(e,l,u):null}getBucketParts(e,r,l,u){const g=l.getBucket(r),P=l.latestFeatureIndex;if(!g||!P||r.id!==g.layerIds[0])return;const I=l.collisionBoxArray,E=g.layers[0].layout,D=g.layers[0].paint,q=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),$=l.tileSize/s.Z,W=l.tileID.toUnwrapped(),ie=E.get("text-rotation-alignment")==="map",se=s.av(l,1,this.transform.zoom),Pe=s.aw(this.collisionIndex.transform,l,D.get("text-translate"),D.get("text-translate-anchor")),be=s.aw(this.collisionIndex.transform,l,D.get("icon-translate"),D.get("icon-translate-anchor")),Se=Te(ie,this.transform,se);this.retainedQueryData[g.bucketInstanceId]=new fa(g.bucketInstanceId,P,g.sourceLayerIndex,g.index,l.tileID);const Ee={bucket:g,layout:E,translationText:Pe,translationIcon:be,unwrappedTileID:W,pitchedLabelPlaneMatrix:Se,scale:q,textPixelRatio:$,holdingForFade:l.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:s.af(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(u)for(const Ze of g.sortKeyRanges){const{sortKey:Ge,symbolInstanceStart:Xe,symbolInstanceEnd:Je}=Ze;e.push({sortKey:Ge,symbolInstanceStart:Xe,symbolInstanceEnd:Je,parameters:Ee})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:Ee})}attemptAnchorPlacement(e,r,l,u,g,P,I,E,D,q,$,W,ie,se,Pe,be,Se,Ee,Ze,Ge){const Xe=s.ax[e.textAnchor],Je=[e.textOffset0,e.textOffset1],Ye=Ks(Xe,l,u,Je,g),vt=this.collisionIndex.placeCollisionBox(r,W,E,D,q,I,P,be,$.predicate,Ze,Ye,Ge);if((!Ee||this.collisionIndex.placeCollisionBox(Ee,W,E,D,q,I,P,Se,$.predicate,Ze,Ye,Ge).placeable)&&vt.placeable){let bt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ie.crossTileID]&&this.prevPlacement.placements[ie.crossTileID]&&this.prevPlacement.placements[ie.crossTileID].text&&(bt=this.prevPlacement.variableOffsets[ie.crossTileID].anchor),ie.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ie.crossTileID]={textOffset:Je,width:l,height:u,anchor:Xe,textBoxScale:g,prevAnchor:bt},this.markUsedJustification(se,Xe,ie,Pe),se.allowVerticalPlacement&&(this.markUsedOrientation(se,Pe,ie),this.placedOrientations[ie.crossTileID]=Pe),{shift:Ye,placedGlyphBoxes:vt}}}placeLayerBucketPart(e,r,l){const{bucket:u,layout:g,translationText:P,translationIcon:I,unwrappedTileID:E,pitchedLabelPlaneMatrix:D,textPixelRatio:q,holdingForFade:$,collisionBoxArray:W,partiallyEvaluatedTextSize:ie,collisionGroup:se}=e.parameters,Pe=g.get("text-optional"),be=g.get("icon-optional"),Se=s.ay(g,"text-overlap","text-allow-overlap"),Ee=Se==="always",Ze=s.ay(g,"icon-overlap","icon-allow-overlap"),Ge=Ze==="always",Xe=g.get("text-rotation-alignment")==="map",Je=g.get("text-pitch-alignment")==="map",Ye=g.get("icon-text-fit")!=="none",vt=g.get("symbol-z-order")==="viewport-y",bt=Ee&&(Ge||!u.hasIconData()||be),Mt=Ge&&(Ee||!u.hasTextData()||Pe);!u.collisionArrays&&W&&u.deserializeCollisionBoxes(W);const Lt=this.retainedQueryData[u.bucketInstanceId].tileID,It=this._getTerrainElevationFunc(Lt),tr=this.transform.getFastPathSimpleProjectionMatrix(Lt),Kt=(Bt,gr,_r)=>{var oi,Pi;if(r[Bt.crossTileID])return;if($)return void(this.placements[Bt.crossTileID]=new wo(!1,!1,!1));let bi=!1,Mi=!1,_i=!0,hi=null,vi={box:null,placeable:!1,offscreen:null,occluded:!1},Tn={placeable:!1},vn=null,bn=null,sn=null,Ta=0,Vs=0,In=0;gr.textFeatureIndex?Ta=gr.textFeatureIndex:Bt.useRuntimeCollisionCircles&&(Ta=Bt.featureIndex),gr.verticalTextFeatureIndex&&(Vs=gr.verticalTextFeatureIndex);const xn=gr.textBox;if(xn){const Is=Ni=>{let Li=s.ag.horizontal;if(u.allowVerticalPlacement&&!Ni&&this.prevPlacement){const zn=this.prevPlacement.placedOrientations[Bt.crossTileID];zn&&(this.placedOrientations[Bt.crossTileID]=zn,Li=zn,this.markUsedOrientation(u,Li,Bt))}return Li},Ia=(Ni,Li)=>{if(u.allowVerticalPlacement&&Bt.numVerticalGlyphVertices>0&&gr.verticalTextBox){for(const zn of u.writingModes)if(zn===s.ag.vertical?(vi=Li(),Tn=vi):vi=Ni(),vi&&vi.placeable)break}else vi=Ni()},Cs=Bt.textAnchorOffsetStartIndex,Us=Bt.textAnchorOffsetEndIndex;if(Us===Cs){const Ni=(Li,zn)=>{const Dn=this.collisionIndex.placeCollisionBox(Li,Se,q,Lt,E,Je,Xe,P,se.predicate,It,void 0,tr);return Dn&&Dn.placeable&&(this.markUsedOrientation(u,zn,Bt),this.placedOrientations[Bt.crossTileID]=zn),Dn};Ia(()=>Ni(xn,s.ag.horizontal),()=>{const Li=gr.verticalTextBox;return u.allowVerticalPlacement&&Bt.numVerticalGlyphVertices>0&&Li?Ni(Li,s.ag.vertical):{box:null,offscreen:null}}),Is(vi&&vi.placeable)}else{let Ni=s.ax[(Pi=(oi=this.prevPlacement)===null||oi===void 0?void 0:oi.variableOffsets[Bt.crossTileID])===null||Pi===void 0?void 0:Pi.anchor];const Li=(Dn,Hl,pd)=>{const gh=Dn.x2-Dn.x1,zu=Dn.y2-Dn.y1,_h=Bt.textBoxScale,Xl=Ye&&Ze==="never"?Hl:null;let ca=null,Du=Se==="never"?1:2,yh="never";Ni&&Du++;for(let Qc=0;Qc<Du;Qc++){for(let eu=Cs;eu<Us;eu++){const vh=u.textAnchorOffsets.get(eu);if(Ni&&vh.textAnchor!==Ni)continue;const tu=this.attemptAnchorPlacement(vh,Dn,gh,zu,_h,Xe,Je,q,Lt,E,se,yh,Bt,u,pd,P,I,Xl,It);if(tu&&(ca=tu.placedGlyphBoxes,ca&&ca.placeable))return bi=!0,hi=tu.shift,ca}Ni?Ni=null:yh=Se}return l&&!ca&&(ca={box:this.collisionIndex.placeCollisionBox(xn,"always",q,Lt,E,Je,Xe,P,se.predicate,It,void 0,tr).box,offscreen:!1,placeable:!1,occluded:!1}),ca};Ia(()=>Li(xn,gr.iconBox,s.ag.horizontal),()=>{const Dn=gr.verticalTextBox;return u.allowVerticalPlacement&&(!vi||!vi.placeable)&&Bt.numVerticalGlyphVertices>0&&Dn?Li(Dn,gr.verticalIconBox,s.ag.vertical):{box:null,occluded:!0,offscreen:null}}),vi&&(bi=vi.placeable,_i=vi.offscreen);const zn=Is(vi&&vi.placeable);if(!bi&&this.prevPlacement){const Dn=this.prevPlacement.variableOffsets[Bt.crossTileID];Dn&&(this.variableOffsets[Bt.crossTileID]=Dn,this.markUsedJustification(u,Dn.anchor,Bt,zn))}}}if(vn=vi,bi=vn&&vn.placeable,_i=vn&&vn.offscreen,Bt.useRuntimeCollisionCircles){const Is=u.text.placedSymbolArray.get(Bt.centerJustifiedTextSymbolIndex),Ia=s.ah(u.textSizeData,ie,Is),Cs=g.get("text-padding");bn=this.collisionIndex.placeCollisionCircles(Se,Is,u.lineVertexArray,u.glyphOffsetArray,Ia,E,D,l,Je,se.predicate,Bt.collisionCircleDiameter,Cs,P,It),bn.circles.length&&bn.collisionDetected&&!l&&s.w("Collisions detected, but collision boxes are not shown"),bi=Ee||bn.circles.length>0&&!bn.collisionDetected,_i=_i&&bn.offscreen}if(gr.iconFeatureIndex&&(In=gr.iconFeatureIndex),gr.iconBox){const Is=Ia=>this.collisionIndex.placeCollisionBox(Ia,Ze,q,Lt,E,Je,Xe,I,se.predicate,It,Ye&&hi?hi:void 0,tr);Tn&&Tn.placeable&&gr.verticalIconBox?(sn=Is(gr.verticalIconBox),Mi=sn.placeable):(sn=Is(gr.iconBox),Mi=sn.placeable),_i=_i&&sn.offscreen}const ms=Pe||Bt.numHorizontalGlyphVertices===0&&Bt.numVerticalGlyphVertices===0,bo=be||Bt.numIconVertices===0;ms||bo?bo?ms||(Mi=Mi&&bi):bi=Mi&&bi:Mi=bi=Mi&&bi;const $a=Mi&&sn.placeable;if(bi&&vn.placeable&&this.collisionIndex.insertCollisionBox(vn.box,Se,g.get("text-ignore-placement"),u.bucketInstanceId,Tn&&Tn.placeable&&Vs?Vs:Ta,se.ID),$a&&this.collisionIndex.insertCollisionBox(sn.box,Ze,g.get("icon-ignore-placement"),u.bucketInstanceId,In,se.ID),bn&&bi&&this.collisionIndex.insertCollisionCircles(bn.circles,Se,g.get("text-ignore-placement"),u.bucketInstanceId,Ta,se.ID),l&&this.storeCollisionData(u.bucketInstanceId,_r,gr,vn,sn,bn),Bt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Bt.crossTileID]=new wo((bi||bt)&&!(vn!=null&&vn.occluded),(Mi||Mt)&&!(sn!=null&&sn.occluded),_i||u.justReloaded),r[Bt.crossTileID]=!0};if(vt){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Bt=u.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let gr=Bt.length-1;gr>=0;--gr){const _r=Bt[gr];Kt(u.symbolInstances.get(_r),u.collisionArrays[_r],_r)}}else for(let Bt=e.symbolInstanceStart;Bt<e.symbolInstanceEnd;Bt++)Kt(u.symbolInstances.get(Bt),u.collisionArrays[Bt],Bt);u.justReloaded=!1}storeCollisionData(e,r,l,u,g,P){if(l.textBox||l.iconBox){let I,E;this.collisionBoxArrays.has(e)?I=this.collisionBoxArrays.get(e):(I=new Map,this.collisionBoxArrays.set(e,I)),I.has(r)?E=I.get(r):(E={text:null,icon:null},I.set(r,E)),l.textBox&&(E.text=u.box),l.iconBox&&(E.icon=g.box)}if(P){let I=this.collisionCircleArrays[e];I===void 0&&(I=this.collisionCircleArrays[e]=[]);for(let E=0;E<P.circles.length;E+=4)I.push(P.circles[E+0]-ri),I.push(P.circles[E+1]-ri),I.push(P.circles[E+2]),I.push(P.collisionDetected?1:0)}}markUsedJustification(e,r,l,u){let g;g=u===s.ag.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[s.az(r)];const P=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const I of P)I>=0&&(e.text.placedSymbolArray.get(I).crossTileID=g>=0&&I!==g?0:l.crossTileID)}markUsedOrientation(e,r,l){const u=r===s.ag.horizontal||r===s.ag.horizontalOnly?r:0,g=r===s.ag.vertical?r:0,P=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const I of P)e.text.placedSymbolArray.get(I).placedOrientation=u;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let l=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const u=r?r.symbolFadeChange(e):1,g=r?r.opacities:{},P=r?r.variableOffsets:{},I=r?r.placedOrientations:{};for(const E in this.placements){const D=this.placements[E],q=g[E];q?(this.opacities[E]=new ci(q,u,D.text,D.icon),l=l||D.text!==q.text.placed||D.icon!==q.icon.placed):(this.opacities[E]=new ci(null,u,D.text,D.icon,D.skipFade),l=l||D.text||D.icon)}for(const E in g){const D=g[E];if(!this.opacities[E]){const q=new ci(D,u,!1,!1);q.isHidden()||(this.opacities[E]=q,l=l||D.text.placed||D.icon.placed)}}for(const E in P)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=P[E]);for(const E in I)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=I[E]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:e)}updateLayerOpacities(e,r){const l={};for(const u of r){const g=u.getBucket(e);g&&u.latestFeatureIndex&&e.id===g.layerIds[0]&&this.updateBucketOpacities(g,u.tileID,l,u.collisionBoxArray)}}updateBucketOpacities(e,r,l,u){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const g=e.layers[0],P=g.layout,I=new ci(null,0,!1,!1,!0),E=P.get("text-allow-overlap"),D=P.get("icon-allow-overlap"),q=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$=P.get("text-rotation-alignment")==="map",W=P.get("text-pitch-alignment")==="map",ie=P.get("icon-text-fit")!=="none",se=new ci(null,0,E&&(D||!e.hasIconData()||P.get("icon-optional")),D&&(E||!e.hasTextData()||P.get("text-optional")),!0);!e.collisionArrays&&u&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(u);const Pe=(Se,Ee,Ze)=>{for(let Ge=0;Ge<Ee/4;Ge++)Se.opacityVertexArray.emplaceBack(Ze);Se.hasVisibleVertices=Se.hasVisibleVertices||Ze!==ao},be=this.collisionBoxArrays.get(e.bucketInstanceId);for(let Se=0;Se<e.symbolInstances.length;Se++){const Ee=e.symbolInstances.get(Se),{numHorizontalGlyphVertices:Ze,numVerticalGlyphVertices:Ge,crossTileID:Xe}=Ee;let Je=this.opacities[Xe];l[Xe]?Je=I:Je||(Je=se,this.opacities[Xe]=Je),l[Xe]=!0;const Ye=Ee.numIconVertices>0,vt=this.placedOrientations[Ee.crossTileID],bt=vt===s.ag.vertical,Mt=vt===s.ag.horizontal||vt===s.ag.horizontalOnly;if(Ze>0||Ge>0){const It=so(Je.text);Pe(e.text,Ze,bt?ao:It),Pe(e.text,Ge,Mt?ao:It);const tr=Je.text.isHidden();[Ee.rightJustifiedTextSymbolIndex,Ee.centerJustifiedTextSymbolIndex,Ee.leftJustifiedTextSymbolIndex].forEach(gr=>{gr>=0&&(e.text.placedSymbolArray.get(gr).hidden=tr||bt?1:0)}),Ee.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(Ee.verticalPlacedTextSymbolIndex).hidden=tr||Mt?1:0);const Kt=this.variableOffsets[Ee.crossTileID];Kt&&this.markUsedJustification(e,Kt.anchor,Ee,vt);const Bt=this.placedOrientations[Ee.crossTileID];Bt&&(this.markUsedJustification(e,"left",Ee,Bt),this.markUsedOrientation(e,Bt,Ee))}if(Ye){const It=so(Je.icon),tr=!(ie&&Ee.verticalPlacedIconSymbolIndex&&bt);Ee.placedIconSymbolIndex>=0&&(Pe(e.icon,Ee.numIconVertices,tr?It:ao),e.icon.placedSymbolArray.get(Ee.placedIconSymbolIndex).hidden=Je.icon.isHidden()),Ee.verticalPlacedIconSymbolIndex>=0&&(Pe(e.icon,Ee.numVerticalIconVertices,tr?ao:It),e.icon.placedSymbolArray.get(Ee.verticalPlacedIconSymbolIndex).hidden=Je.icon.isHidden())}const Lt=be&&be.has(Se)?be.get(Se):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const It=e.collisionArrays[Se];if(It){let tr=new s.P(0,0);if(It.textBox||It.verticalTextBox){let Kt=!0;if(q){const Bt=this.variableOffsets[Xe];Bt?(tr=Ks(Bt.anchor,Bt.width,Bt.height,Bt.textOffset,Bt.textBoxScale),$&&tr._rotate(W?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Kt=!1}if(It.textBox||It.verticalTextBox){let Bt;It.textBox&&(Bt=bt),It.verticalTextBox&&(Bt=Mt),El(e.textCollisionBox.collisionVertexArray,Je.text.placed,!Kt||Bt,Lt.text,tr.x,tr.y)}}if(It.iconBox||It.verticalIconBox){const Kt=!!(!Mt&&It.verticalIconBox);let Bt;It.iconBox&&(Bt=Kt),It.verticalIconBox&&(Bt=!Kt),El(e.iconCollisionBox.collisionVertexArray,Je.icon.placed,Bt,Lt.icon,ie?tr.x:0,ie?tr.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,r){const l=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function El(m,e,r,l,u,g){l&&l.length!==0||(l=[0,0,0,0]);const P=l[0]-ri,I=l[1]-ri,E=l[2]-ri,D=l[3]-ri;m.emplaceBack(e?1:0,r?1:0,u||0,g||0,P,I),m.emplaceBack(e?1:0,r?1:0,u||0,g||0,E,I),m.emplaceBack(e?1:0,r?1:0,u||0,g||0,E,D),m.emplaceBack(e?1:0,r?1:0,u||0,g||0,P,D)}const Po=Math.pow(2,25),kl=Math.pow(2,24),no=Math.pow(2,17),tl=Math.pow(2,16),Ac=Math.pow(2,9),tc=Math.pow(2,8),Tc=Math.pow(2,1);function so(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const e=m.placed?1:0,r=Math.floor(127*m.opacity);return r*Po+e*kl+r*no+e*tl+r*Ac+e*tc+r*Tc+e}const ao=0;class Hi{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,r,l,u,g){const P=this._bucketParts;for(;this._currentTileIndex<e.length;)if(r.getBucketParts(P,u,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((I,E)=>I.sortKey-E.sortKey));this._currentPartIndex<P.length;)if(r.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,g())return!0;return!1}}class rl{constructor(e,r,l,u,g,P,I,E){this.placement=new io(e,r,P,I,E),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(e,r,l){const u=J.now(),g=()=>!this._forceFullPlacement&&J.now()-u>2;for(;this._currentPlacementIndex>=0;){const P=r[e[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=I)&&(!P.maxzoom||P.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new Hi(P)),this._inProgressLayer.continuePlacement(l[P.source],this.placement,this._showCollisionBoxes,P,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const za=512/s.Z/2;class il{constructor(e,r,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const u=new Map;for(let g=0;g<r.length;g++){const P=r.get(g),I=P.key,E=u.get(I);E?E.push(P):u.set(I,[P])}for(const[g,P]of u){const I={positions:P.map(E=>({x:Math.floor(E.anchorX*za),y:Math.floor(E.anchorY*za)})),crossTileIDs:P.map(E=>E.crossTileID)};if(I.positions.length>128){const E=new s.aB(I.positions.length,16,Uint16Array);for(const{x:D,y:q}of I.positions)E.add(D,q);E.finish(),delete I.positions,I.index=E}this._symbolsByKey[g]=I}}getScaledCoordinates(e,r){const{x:l,y:u,z:g}=this.tileID.canonical,{x:P,y:I,z:E}=r.canonical,D=za/Math.pow(2,E-g),q=(I*s.Z+e.anchorY)*D,$=u*s.Z*za;return{x:Math.floor((P*s.Z+e.anchorX)*D-l*s.Z*za),y:Math.floor(q-$)}}findMatches(e,r,l){const u=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let g=0;g<e.length;g++){const P=e.get(g);if(P.crossTileID)continue;const I=this._symbolsByKey[P.key];if(!I)continue;const E=this.getScaledCoordinates(P,r);if(I.index){const D=I.index.range(E.x-u,E.y-u,E.x+u,E.y+u).sort();for(const q of D){const $=I.crossTileIDs[q];if(!l[$]){l[$]=!0,P.crossTileID=$;break}}}else if(I.positions)for(let D=0;D<I.positions.length;D++){const q=I.positions[D],$=I.crossTileIDs[D];if(Math.abs(q.x-E.x)<=u&&Math.abs(q.y-E.y)<=u&&!l[$]){l[$]=!0,P.crossTileID=$;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class So{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class nl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const r=Math.round((e-this.lng)/360);if(r!==0)for(const l in this.indexes){const u=this.indexes[l],g={};for(const P in u){const I=u[P];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+r),g[I.tileID.key]=I}this.indexes[l]=g}this.lng=e}addBucket(e,r,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let g=0;g<r.symbolInstances.length;g++)r.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const u=this.usedCrossTileIDs[e.overscaledZ];for(const g in this.indexes){const P=this.indexes[g];if(Number(g)>e.overscaledZ)for(const I in P){const E=P[I];E.tileID.isChildOf(e)&&E.findMatches(r.symbolInstances,e,u)}else{const I=P[e.scaledTo(Number(g)).key];I&&I.findMatches(r.symbolInstances,e,u)}}for(let g=0;g<r.symbolInstances.length;g++){const P=r.symbolInstances.get(g);P.crossTileID||(P.crossTileID=l.generate(),u[P.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new il(e,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(e,r){for(const l of r.getCrossTileIDsLists())for(const u of l)delete this.usedCrossTileIDs[e][u]}removeStaleBuckets(e){let r=!1;for(const l in this.indexes){const u=this.indexes[l];for(const g in u)e[u[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,u[g]),delete u[g],r=!0)}return r}}class ws{constructor(){this.layerIndexes={},this.crossTileIDs=new So,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,r,l){let u=this.layerIndexes[e.id];u===void 0&&(u=this.layerIndexes[e.id]=new nl);let g=!1;const P={};u.handleWrapJump(l);for(const I of r){const E=I.getBucket(e);E&&e.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(I.tileID,E,this.crossTileIDs)&&(g=!0),P[E.bucketInstanceId]=!0)}return u.removeStaleBuckets(P)&&(g=!0),g}pruneUnusedLayers(e){const r={};e.forEach(l=>{r[l]=!0});for(const l in this.layerIndexes)r[l]||delete this.layerIndexes[l]}}var Ls="void main() {fragColor=vec4(1.0);}";const Oi={prelude:Yr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Yr("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Yr("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Yr(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Yr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Yr(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Yr(Ls,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Yr(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Yr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Yr("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Yr("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Yr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Yr(Ls,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Yr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Yr(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Yr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Yr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Yr(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Yr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Yr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Yr(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Yr(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Yr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Yr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Yr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Yr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Yr(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Yr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Yr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Yr("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Yr("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Yr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Yr("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Yr(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Yr("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Yr(m,e){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/in ([\w]+) ([\w]+)/g),u=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=g?g.concat(u):u,I={};return{fragmentSource:m=m.replace(r,(E,D,q,$,W)=>(I[W]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${W}
in ${q} ${$} ${W};
#else
uniform ${q} ${$} u_${W};
#endif
`:`
#ifdef HAS_UNIFORM_u_${W}
    ${q} ${$} ${W} = u_${W};
#endif
`)),vertexSource:e=e.replace(r,(E,D,q,$,W)=>{const ie=$==="float"?"vec2":"vec4",se=W.match(/color/)?"color":ie;return I[W]?D==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
in ${q} ${ie} a_${W};
out ${q} ${$} ${W};
#else
uniform ${q} ${$} u_${W};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = a_${W};
#else
    ${q} ${$} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = unpack_mix_${se}(a_${W}, u_${W}_t);
#else
    ${q} ${$} ${W} = u_${W};
#endif
`:D==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
in ${q} ${ie} a_${W};
#else
uniform ${q} ${$} u_${W};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${q} ${$} ${W} = a_${W};
#else
    ${q} ${$} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${q} ${$} ${W} = unpack_mix_${se}(a_${W}, u_${W}_t);
#else
    ${q} ${$} ${W} = u_${W};
#endif
`}),staticAttributes:l,staticUniforms:P}}class qn{constructor(e,r,l){this.vertexBuffer=e,this.indexBuffer=r,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var os=s.aC([{name:"a_pos",type:"Int16",components:2}]);const ei="#define PROJECTION_MERCATOR",sl="mercator";class al{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return sl}get shaderDefine(){return ei}get shaderPreludeCode(){return Oi.projectionMercator}get vertexShaderPreludeCode(){return Oi.projectionMercator.vertexSource}get subdivisionGranularity(){return s.aD.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,r,l,u,g){if(this._cachedMesh)return this._cachedMesh;const P=new s.aE;P.emplaceBack(0,0),P.emplaceBack(s.Z,0),P.emplaceBack(0,s.Z),P.emplaceBack(s.Z,s.Z);const I=e.createVertexBuffer(P,os.members),E=s.aF.simpleSegment(0,0,4,2),D=new s.aG;D.emplaceBack(1,0,2),D.emplaceBack(1,2,3);const q=e.createIndexBuffer(D);return this._cachedMesh=new qn(I,q,E),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}function ls(m,e){const r=s.ad(e.lat,-85.051129,s.aI);return new s.P(s.U(e.lng)*m,s.S(r)*m)}function tn(m,e){return new s.$(e.x/m,e.y/m).toLngLat()}function un(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(s.ac(90-m.pitch)),Math.tan(s.ac(89.25-m.pitch)))}function ki(m,e){const r=m.canonical,l=e/s.aH(r.z),u=r.x+Math.pow(2,r.z)*m.wrap,g=s.as(new Float64Array(16));return s.L(g,g,[u*l,r.y*l,0]),s.M(g,g,[l/s.Z,l/s.Z,1]),g}function zl(m,e,r,l,u){const g=s.$.fromLngLat(m,e),P=u*s.aJ(1,m.lat),I=P*Math.cos(s.ac(r)),E=Math.sqrt(P*P-I*I),D=E*Math.sin(s.ac(-l)),q=E*Math.cos(s.ac(-l));return new s.$(g.x+D,g.y+q,g.z+I)}class Ti{constructor(e=0,r=0,l=0,u=0){if(isNaN(e)||e<0||isNaN(r)||r<0||isNaN(l)||l<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=r,this.left=l,this.right=u}interpolate(e,r,l){return r.top!=null&&e.top!=null&&(this.top=s.B.number(e.top,r.top,l)),r.bottom!=null&&e.bottom!=null&&(this.bottom=s.B.number(e.bottom,r.bottom,l)),r.left!=null&&e.left!=null&&(this.left=s.B.number(e.left,r.left,l)),r.right!=null&&e.right!=null&&(this.right=s.B.number(e.right,r.right,l)),this}getCenter(e,r){const l=s.ad((this.left+e-this.right)/2,0,e),u=s.ad((this.top+r-this.bottom)/2,0,r);return new s.P(l,u)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Ti(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function hn(m,e){if(!m.renderWorldCopies||m.lngRange)return;const r=e.lng-m.center.lng;e.lng+=r>180?-360:r<-180?360:0}function mn(m){return Math.max(0,Math.floor(m))}class Ao{constructor(e,r,l,u,g,P){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=P===void 0||!!P,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=u??0,this._maxPitch=g??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new s.Q(0,0),this._elevation=0,this._zoom=0,this._tileZoom=mn(this._zoom),this._scale=s.aH(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ti,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,r,l){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=mn(this._zoom),this._scale=s.aH(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Ti(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!l&&e.autoCalculateNearFarZ,r&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const r=s.aK(e,-180,180)*Math.PI/180;var l,u,g,P,I,E,D,q,$;this._bearingInRadians!==r&&(this._unmodified=!1,this._bearingInRadians=r,this._calcMatrices(),this._rotationMatrix=B(),l=this._rotationMatrix,g=-this._bearingInRadians,P=(u=this._rotationMatrix)[0],I=u[1],E=u[2],D=u[3],q=Math.sin(g),$=Math.cos(g),l[0]=P*$+E*q,l[1]=I*$+D*q,l[2]=P*-q+E*$,l[3]=I*-q+D*$)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const r=s.ad(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==r&&(this._unmodified=!1,this._pitchInRadians=r,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const r=e/180*Math.PI;this._rollInRadians!==r&&(this._unmodified=!1,this._rollInRadians=r,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return s.aL(this._fovInRadians)}setFov(e){e=s.ad(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=s.ac(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const r=this.getConstrained(this._center,e).zoom;this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this._tileZoom=Math.max(0,Math.floor(r)),this._scale=s.aH(r),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,r){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=r,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,r,l){this._unmodified=!1,this._edgeInsets.interpolate(e,r,l),this._constrain(),this._calcMatrices()}resize(e,r,l=!0){this._width=e,this._height=r,l&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new dr([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,s.aI])}getConstrained(e,r){return this._callbacks.getConstrained(e,r)}getCameraQueryGeometry(e,r){if(r.length===1)return[r[0],e];{let l=e.x,u=e.y,g=e.x,P=e.y;for(const I of r)l=Math.min(l,I.x),u=Math.min(u,I.y),g=Math.max(g,I.x),P=Math.max(P,I.y);return[new s.P(l,u),new s.P(g,u),new s.P(g,P),new s.P(l,P),new s.P(l,u)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:r,zoom:l}=this.getConstrained(this.center,this.zoom);this.setCenter(r),this.setZoom(l),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=s.as(new Float64Array(16));s.M(e,e,[this._width/2,-this._height/2,1]),s.L(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=s.as(new Float64Array(16)),s.M(e,e,[1,-1,1]),s.L(e,e,[-1,-1,0]),s.M(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,r,l,u){const g=l!==void 0?l:this.bearing,P=u=u!==void 0?u:this.pitch,I=s.$.fromLngLat(e,r),E=-Math.cos(s.ac(P)),D=Math.sin(s.ac(P)),q=D*Math.sin(s.ac(g)),$=-D*Math.cos(s.ac(g));let W=this.elevation;const ie=r-W;let se;E*ie>=0||Math.abs(E)<.1?(se=1e4,W=r+se*E):se=-ie/E;let Pe,be,Se=s.aM(1,I.y),Ee=0;do{if(Ee+=1,Ee>10)break;be=se/Se,Pe=new s.$(I.x+q*be,I.y+$*be),Se=1/Pe.meterInMercatorCoordinateUnits()}while(Math.abs(se-be*Se)>1e-12);return{center:Pe.toLngLat(),elevation:W,zoom:s.aa(this.height/2/Math.tan(this.fovInRadians/2)/be/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const r=s.aJ(1,this.center.lat)*this.worldSize,l=this.cameraToCenterDistance/r,u=s.$.fromLngLat(this.center,this.elevation),g=zl(this.center,this.elevation,this.pitch,this.bearing,l);this._elevation=e;const P=this.calculateCenterFromCameraLngLatAlt(g.toLngLat(),s.aM(g.z,u.y),this.bearing,this.pitch);this._elevation=P.elevation,this._center=P.center,this.setZoom(P.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=s.aJ(1,this.center.lat)*this.worldSize;return zl(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const r=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/r,e.canonical.y/r,1/r/s.Z,1/r/s.Z]}}class Ii{constructor(e,r){this.min=e,this.max=r,this.center=s.aN([],s.aO([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],l=s.aP(this.min),u=s.aP(this.max);for(let g=0;g<r.length;g++)l[g]=r[g]?this.min[g]:this.center[g],u[g]=r[g]?this.center[g]:this.max[g];return u[2]=this.max[2],new Ii(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let r=!0;for(let l=0;l<e.planes.length;l++){const u=this.intersectsPlane(e.planes[l]);if(u===0)return 0;u===1&&(r=!1)}return r?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let r=e[3],l=e[3];for(let u=0;u<3;u++)e[u]>0?(r+=e[u]*this.min[u],l+=e[u]*this.max[u]):(l+=e[u]*this.min[u],r+=e[u]*this.max[u]);return r>=0?2:l<0?0:1}}class Ki{distanceToTile2d(e,r,l,u){const g=u.distanceX([e,r]),P=u.distanceY([e,r]);return Math.hypot(g,P)}getWrap(e,r,l){return l}getTileAABB(e,r,l,u){var g,P;let I=l,E=l;if(u.terrain){const q=new s.Y(e.z,r,e.z,e.x,e.y),$=u.terrain.getMinMaxElevation(q);I=(g=$.minElevation)!==null&&g!==void 0?g:l,E=(P=$.maxElevation)!==null&&P!==void 0?P:l}const D=1<<e.z;return new Ii([r+e.x/D,e.y/D,I],[r+(e.x+1)/D,(e.y+1)/D,E])}allowVariableZoom(e,r){const l=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,u=s.ad(78.5-l/2,0,60);return!!r.terrain||e.pitch>u}allowWorldCopies(){return!0}recalculateCache(){}}class Js{constructor(e,r,l){this.points=e,this.planes=r,this.aabb=l}static fromInvProjectionMatrix(e,r=1,l=0){const u=Math.pow(2,l),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const q=1/(D=s.ao([],D,e))[3]/r*u;return s.aQ(D,D,[q,q,1/D[3],q])}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const q=s.aR([],g[D[0]],g[D[1]]),$=s.aR([],g[D[2]],g[D[1]]),W=s.aS([],s.aT([],q,$)),ie=-s.aU(W,g[D[1]]);return W.concat(ie)}),I=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],E=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const D of g)for(let q=0;q<3;q++)I[q]=Math.min(I[q],D[q]),E[q]=Math.max(E[q],D[q]);return new Js(g,P,new Ii(I,E))}}class Lr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,l){return this._helper.interpolatePadding(e,r,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,l=!0){this._helper.resize(e,r,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,r){}constructor(e,r,l,u,g){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Ao({calcMatrices:()=>{this._calcMatrices()},getConstrained:(P,I)=>this.getConstrained(P,I)},e,r,l,u,g),this._coveringTilesDetailsProvider=new Ki}clone(){const e=new Lr;return e.apply(this),e}apply(e,r,l){this._helper.apply(e,r,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const r=[new s.aV(0,e)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new s.P(0,0)),u=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,0)),g=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,this._helper._height)),P=this.screenPointToMercatorCoordinate(new s.P(0,this._helper._height)),I=Math.floor(Math.min(l.x,u.x,g.x,P.x)),E=Math.floor(Math.max(l.x,u.x,g.x,P.x)),D=1;for(let q=I-D;q<=E+D;q++)q!==0&&r.push(new s.aV(q,e))}return r}getCameraFrustum(){return Js.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const r=this.screenPointToLocation(this.centerPoint,e),l=e?e.getElevationForLngLatZoom(r,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(e,r){const l=s.aJ(this.elevation,this.center.lat),u=this.screenPointToMercatorCoordinateAtZ(r,l),g=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),P=s.$.fromLngLat(e),I=new s.$(P.x-(u.x-g.x),P.y-(u.y-g.y));this.setCenter(I==null?void 0:I.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,r){return r?this.coordinatePoint(s.$.fromLngLat(e),r.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(s.$.fromLngLat(e))}screenPointToLocation(e,r){var l;return(l=this.screenPointToMercatorCoordinate(e,r))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(e,r){if(r){const l=r.pointCoordinate(e);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,r){const l=r||0,u=[e.x,e.y,0,1],g=[e.x,e.y,1,1];s.ao(u,u,this._pixelMatrixInverse),s.ao(g,g,this._pixelMatrixInverse);const P=u[3],I=g[3],E=u[1]/P,D=g[1]/I,q=u[2]/P,$=g[2]/I,W=q===$?0:(l-q)/($-q);return new s.$(s.B.number(u[0]/P,g[0]/I,W)/this.worldSize,s.B.number(E,D,W)/this.worldSize,l)}coordinatePoint(e,r=0,l=this._pixelMatrix){const u=[e.x*this.worldSize,e.y*this.worldSize,r,1];return s.ao(u,u,l),new s.P(u[0]/u[3],u[1]/u[3])}getBounds(){const e=Math.max(0,this._helper._height/2-un(this));return new dr().extend(this.screenPointToLocation(new s.P(0,e))).extend(this.screenPointToLocation(new s.P(this._helper._width,e))).extend(this.screenPointToLocation(new s.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new s.P(0,this._helper._height)))}isPointOnMapSurface(e,r){return r?r.pointCoordinate(e)!=null:e.y>this.height/2-un(this)}calculatePosMatrix(e,r=!1,l){var u;const g=(u=e.key)!==null&&u!==void 0?u:s.aW(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),P=r?this._alignedPosMatrixCache:this._posMatrixCache;if(P.has(g)){const D=P.get(g);return l?D.f32:D.f64}const I=ki(e,this.worldSize);s.N(I,r?this._alignedProjMatrix:this._viewProjMatrix,I);const E={f64:I,f32:new Float32Array(I)};return P.set(g,E),l?E.f32:E.f64}calculateFogMatrix(e){const r=e.key,l=this._fogMatrixCacheF32;if(l.has(r))return l.get(r);const u=ki(e,this.worldSize);return s.N(u,this._fogMatrix,u),l.set(r,new Float32Array(u)),l.get(r)}getConstrained(e,r){r=s.ad(+r,this.minZoom,this.maxZoom);const l={center:new s.Q(e.lng,e.lat),zoom:r};let u=this._helper._lngRange;this._helper._renderWorldCopies||u!==null||(u=[-179.9999999999,180-1e-10]);const g=this.tileSize*s.aH(l.zoom);let P=0,I=g,E=0,D=g,q=0,$=0;const{x:W,y:ie}=this.size;if(this._helper._latRange){const Ze=this._helper._latRange;P=s.S(Ze[1])*g,I=s.S(Ze[0])*g,I-P<ie&&(q=ie/(I-P))}u&&(E=s.aK(s.U(u[0])*g,0,g),D=s.aK(s.U(u[1])*g,0,g),D<E&&(D+=g),D-E<W&&($=W/(D-E)));const{x:se,y:Pe}=ls(g,e);let be,Se;const Ee=Math.max($||0,q||0);if(Ee){const Ze=new s.P($?(D+E)/2:se,q?(I+P)/2:Pe);return l.center=tn(g,Ze).wrap(),l.zoom+=s.aa(Ee),l}if(this._helper._latRange){const Ze=ie/2;Pe-Ze<P&&(Se=P+Ze),Pe+Ze>I&&(Se=I-Ze)}if(u){const Ze=(E+D)/2;let Ge=se;this._helper._renderWorldCopies&&(Ge=s.aK(se,Ze-g/2,Ze+g/2));const Xe=W/2;Ge-Xe<E&&(be=E+Xe),Ge+Xe>D&&(be=D-Xe)}if(be!==void 0||Se!==void 0){const Ze=new s.P(be??se,Se??Pe);l.center=tn(g,Ze).wrap()}return l}calculateCenterFromCameraLngLatAlt(e,r,l,u){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,l,u)}_calculateNearFarZIfNeeded(e,r,l){if(!this._helper.autoCalculateNearFarZ)return;const u=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),g=e-u*this._helper._pixelPerMeter/Math.cos(r),P=u<0?g:e,I=Math.PI/2+this.pitchInRadians,E=s.ac(this.fov)*(Math.abs(Math.cos(s.ac(this.roll)))*this.height+Math.abs(Math.sin(s.ac(this.roll)))*this.width)/this.height*(.5+l.y/this.height),D=Math.sin(E)*P/Math.sin(s.ad(Math.PI-I-E,.01,Math.PI-.01)),q=un(this),$=Math.atan(q/this._helper.cameraToCenterDistance),W=s.ac(.75),ie=$>W?2*$*(.5+l.y/(2*q)):W,se=Math.sin(ie)*P/Math.sin(s.ad(Math.PI-I-ie,.01,Math.PI-.01)),Pe=Math.min(D,se);this._helper._farZ=1.01*(Math.cos(Math.PI/2-r)*Pe+P),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,r=ls(this.worldSize,this.center),l=r.x,u=r.y;this._helper._pixelPerMeter=s.aJ(1,this.center.lat)*this.worldSize;const g=s.ac(Math.min(this.pitch,89.25)),P=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(g));let I;this._calculateNearFarZIfNeeded(P,g,e),I=new Float64Array(16),s.aX(I,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),s.ai(this._invProjMatrix,I),I[8]=2*-e.x/this._helper._width,I[9]=2*e.y/this._helper._height,this._projectionMatrix=s.aY(I),s.M(I,I,[1,-1,1]),s.L(I,I,[0,0,-this._helper.cameraToCenterDistance]),s.aZ(I,I,-this.rollInRadians),s.a_(I,I,this.pitchInRadians),s.aZ(I,I,-this.bearingInRadians),s.L(I,I,[-l,-u,0]),this._mercatorMatrix=s.M([],I,[this.worldSize,this.worldSize,this.worldSize]),s.M(I,I,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=s.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,I),s.L(I,I,[0,0,-this.elevation]),this._viewProjMatrix=I,this._invViewProjMatrix=s.ai([],I);const E=[0,0,-1,1];s.ao(E,E,this._invViewProjMatrix),this._cameraPosition=[E[0]/E[3],E[1]/E[3],E[2]/E[3]],this._fogMatrix=new Float64Array(16),s.aX(this._fogMatrix,this.fovInRadians,this.width/this.height,P,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,s.M(this._fogMatrix,this._fogMatrix,[1,-1,1]),s.L(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),s.aZ(this._fogMatrix,this._fogMatrix,-this.rollInRadians),s.a_(this._fogMatrix,this._fogMatrix,this.pitchInRadians),s.aZ(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),s.L(this._fogMatrix,this._fogMatrix,[-l,-u,0]),s.M(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),s.L(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=s.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,I);const D=this._helper._width%2/2,q=this._helper._height%2/2,$=Math.cos(this.bearingInRadians),W=Math.sin(-this.bearingInRadians),ie=l-Math.round(l)+$*D+W*q,se=u-Math.round(u)+$*q+W*D,Pe=new Float64Array(I);if(s.L(Pe,Pe,[ie>.5?ie-1:ie,se>.5?se-1:se,0]),this._alignedProjMatrix=Pe,I=s.ai(new Float64Array(16),this._pixelMatrix),!I)throw new Error("failed to invert matrix");this._pixelMatrixInverse=I,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new s.P(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return s.ao(r,r,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=s.aJ(1,this.center.lat)*this.worldSize;return zl(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,r){const l=s.$.fromLngLat(e),u=[l.x*this.worldSize,l.y*this.worldSize,r,1];return s.ao(u,u,this._viewProjMatrix),u[2]/u[3]}getProjectionData(e){const{overscaledTileID:r,aligned:l,applyTerrainMatrix:u}=e,g=this._helper.getMercatorTileCoordinates(r),P=r?this.calculatePosMatrix(r,l,!0):null;let I;return I=r&&r.terrainRttPosMatrix32f&&u?r.terrainRttPosMatrix32f:P||s.a$(),{mainMatrix:I,tileMercatorCoords:g,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:I}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,r,l){return 1}transformLightDirection(e){return s.aP(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,r,l,u){const g=this.calculatePosMatrix(l);let P;u?(P=[e,r,u(e,r),1],s.ao(P,P,g)):(P=[e,r,0,1],yi(P,P,g));const I=P[3];return{point:new s.P(P[0]/I,P[1]/I),signedDistanceFromCamera:I,isOccluded:!1}}populateCache(e){for(const r of e)this.calculatePosMatrix(r)}getMatrixForModel(e,r){const l=s.$.fromLngLat(e,r),u=l.meterInMercatorCoordinateUnits(),g=s.b0();return s.L(g,g,[l.x,l.y,l.z]),s.aZ(g,g,Math.PI),s.a_(g,g,Math.PI/2),s.M(g,g,[-u,u,u]),g}getProjectionDataForCustomLayer(e=!0){const r=new s.Y(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:r,applyGlobeMatrix:e}),u=ki(r,this.worldSize);s.N(u,this._viewProjMatrix,u),l.tileMercatorCoords=[0,0,1,1];const g=[s.Z,s.Z,this.worldSize/this._helper.pixelsPerMeter],P=s.b1();return s.M(P,u,g),l.fallbackMatrix=P,l.mainMatrix=P,l}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function To(){s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function cs(m){if(m.useSlerp)if(m.k<1){const e=s.b2(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),r=s.b2(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),l=new Float64Array(4);s.b3(l,e,r,m.k);const u=s.b4(l);m.tr.setRoll(u.roll),m.tr.setPitch(u.pitch),m.tr.setBearing(u.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(s.B.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(s.B.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(s.B.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function Es(m,e,r,l,u){const g=u.padding,P=ls(u.worldSize,r.getNorthWest()),I=ls(u.worldSize,r.getNorthEast()),E=ls(u.worldSize,r.getSouthEast()),D=ls(u.worldSize,r.getSouthWest()),q=s.ac(-l),$=P.rotate(q),W=I.rotate(q),ie=E.rotate(q),se=D.rotate(q),Pe=new s.P(Math.max($.x,W.x,se.x,ie.x),Math.max($.y,W.y,se.y,ie.y)),be=new s.P(Math.min($.x,W.x,se.x,ie.x),Math.min($.y,W.y,se.y,ie.y)),Se=Pe.sub(be),Ee=(u.width-(g.left+g.right+e.left+e.right))/Se.x,Ze=(u.height-(g.top+g.bottom+e.top+e.bottom))/Se.y;if(Ze<0||Ee<0)return void To();const Ge=Math.min(s.aa(u.scale*Math.min(Ee,Ze)),m.maxZoom),Xe=s.P.convert(m.offset),Je=new s.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(s.ac(l)),Ye=Xe.add(Je).mult(u.scale/s.aH(Ge));return{center:tn(u.worldSize,P.add(E).div(2).sub(Ye)),zoom:Ge,bearing:l}}class us{get useGlobeControls(){return!1}handlePanInertia(e,r){return{easingOffset:e,easingCenter:r.center}}handleMapControlsRollPitchBearingZoom(e,r){e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta),e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta)}handleMapControlsPan(e,r,l){e.around.distSqr(r.centerPoint)<.01||r.setLocationAtPoint(l,e.around)}cameraForBoxAndBearing(e,r,l,u,g){return Es(e,r,l,u,g)}handleJumpToCenterZoom(e,r){e.zoom!==(r.zoom!==void 0?+r.zoom:e.zoom)&&e.setZoom(+r.zoom),r.center!==void 0&&e.setCenter(s.Q.convert(r.center))}handleEaseTo(e,r){const l=e.zoom,u=e.padding,g={roll:e.roll,pitch:e.pitch,bearing:e.bearing},P={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},I=r.zoom!==void 0,E=!e.isPaddingEqual(r.padding);let D=!1;const q=I?+r.zoom:e.zoom;let $=e.centerPoint.add(r.offsetAsPoint);const W=e.screenPointToLocation($),{center:ie,zoom:se}=e.getConstrained(s.Q.convert(r.center||W),q??l);hn(e,ie);const Pe=ls(e.worldSize,W),be=ls(e.worldSize,ie).sub(Pe),Se=s.aH(se-l);return D=se!==l,{easeFunc:Ee=>{if(D&&e.setZoom(s.B.number(l,se,Ee)),s.b5(g,P)||cs({startEulerAngles:g,endEulerAngles:P,tr:e,k:Ee,useSlerp:g.roll!=P.roll}),E&&(e.interpolatePadding(u,r.padding,Ee),$=e.centerPoint.add(r.offsetAsPoint)),r.around)e.setLocationAtPoint(r.around,r.aroundPoint);else{const Ze=s.aH(e.zoom-l),Ge=se>l?Math.min(2,Se):Math.max(.5,Se),Xe=Math.pow(Ge,1-Ee),Je=tn(e.worldSize,Pe.add(be.mult(Ee*Xe)).mult(Ze));e.setLocationAtPoint(e.renderWorldCopies?Je.wrap():Je,$)}},isZooming:D,elevationCenter:ie}}handleFlyTo(e,r){const l=r.zoom!==void 0,u=e.zoom,g=e.getConstrained(s.Q.convert(r.center||r.locationAtOffset),l?+r.zoom:u),P=g.center,I=g.zoom;hn(e,P);const E=ls(e.worldSize,r.locationAtOffset),D=ls(e.worldSize,P).sub(E),q=D.mag(),$=s.aH(I-u);let W;if(r.minZoom!==void 0){const ie=Math.min(+r.minZoom,u,I),se=e.getConstrained(P,ie).zoom;W=s.aH(se-u)}return{easeFunc:(ie,se,Pe,be)=>{e.setZoom(ie===1?I:u+s.aa(se));const Se=ie===1?P:tn(e.worldSize,E.add(D.mult(Pe)).mult(se));e.setLocationAtPoint(e.renderWorldCopies?Se.wrap():Se,be)},scaleOfZoom:$,targetCenter:P,scaleOfMinZoom:W,pixelPathLength:q}}}class wi{constructor(e,r,l){this.blendFunction=e,this.blendColor=r,this.mask=l}}wi.Replace=[1,0],wi.disabled=new wi(wi.Replace,s.b6.transparent,[!1,!1,!1,!1]),wi.unblended=new wi(wi.Replace,s.b6.transparent,[!0,!0,!0,!0]),wi.alphaBlended=new wi([1,771],s.b6.transparent,[!0,!0,!0,!0]);const Da=2305;class Wr{constructor(e,r,l){this.enable=e,this.mode=r,this.frontFace=l}}Wr.disabled=new Wr(!1,1029,Da),Wr.backCCW=new Wr(!0,1029,Da),Wr.frontCCW=new Wr(!0,1028,Da);class Nr{constructor(e,r,l){this.func=e,this.mask=r,this.range=l}}Nr.ReadOnly=!1,Nr.ReadWrite=!0,Nr.disabled=new Nr(519,Nr.ReadOnly,[0,1]);const oo=7680;class ti{constructor(e,r,l,u,g,P){this.test=e,this.ref=r,this.mask=l,this.fail=u,this.depthFail=g,this.pass=P}}ti.disabled=new ti({func:519,mask:0},0,0,oo,oo,oo);const Fa=new WeakMap;function Pn(m){var e;if(Fa.has(m))return Fa.get(m);{const r=(e=m.getParameter(m.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Fa.set(m,r),r}}class ks{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const r=e.context,l=r.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const u=new s.aE;u.emplaceBack(-1,-1),u.emplaceBack(2,-1),u.emplaceBack(-1,2);const g=new s.aG;g.emplaceBack(0,1,2),this._fullscreenTriangle=new qn(r.createVertexBuffer(u,os.members),r.createIndexBuffer(g),s.aF.simpleSegment(0,0,u.length,g.length)),this._resultBuffer=new Uint8Array(4),r.activeTexture.set(l.TEXTURE1);const P=l.createTexture();l.bindTexture(l.TEXTURE_2D,P),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=r.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(P),Pn(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,r){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,r),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,r=e.gl;e.activeTexture.set(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,r){const l=this._cachedRenderContext.context,u=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:s.b6.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,u.TRIANGLES,Nr.disabled,ti.disabled,wi.unblended,Wr.disabled,((g,P)=>({u_input:g,u_output_expected:P}))(e,r),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Pn(u)){u.bindBuffer(u.PIXEL_PACK_BUFFER,this._pbo),u.readBuffer(u.COLOR_ATTACHMENT0),u.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),u.bindBuffer(u.PIXEL_PACK_BUFFER,null);const g=u.fenceSync(u.SYNC_GPU_COMMANDS_COMPLETE,0);u.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:g}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Pn(e)){const r=e.clientWaitSync(this._readbackQueue.sync,0,0);if(r===e.WAIT_FAILED)return s.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(r===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=ks._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let r=0;return r+=e[0]/256,r+=e[1]/65536,r+=e[2]/16777216,e[3]<127&&(r=-r),r/128}}const ol=s.Z/128;function Qs(m,e){const r=m.granularity!==void 0?Math.max(m.granularity,1):1,l=r+(m.generateBorders?2:0),u=r+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),g=l+1,P=u+1,I=m.generateBorders?-1:0,E=m.generateBorders||m.extendToNorthPole?-1:0,D=r+(m.generateBorders?1:0),q=r+(m.generateBorders||m.extendToSouthPole?1:0),$=g*P,W=l*u*6,ie=g*P>65536;if(ie&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const se=ie||e==="32bit",Pe=new Int16Array(2*$);let be=0;for(let Ze=E;Ze<=q;Ze++)for(let Ge=I;Ge<=D;Ge++){let Xe=Ge/r*s.Z;Ge===-1&&(Xe=-64),Ge===r+1&&(Xe=s.Z+ol);let Je=Ze/r*s.Z;Ze===-1&&(Je=m.extendToNorthPole?s.b8:-64),Ze===r+1&&(Je=m.extendToSouthPole?s.b9:s.Z+ol),Pe[be++]=Xe,Pe[be++]=Je}const Se=se?new Uint32Array(W):new Uint16Array(W);let Ee=0;for(let Ze=0;Ze<u;Ze++)for(let Ge=0;Ge<l;Ge++){const Xe=Ge+1+Ze*g,Je=Ge+(Ze+1)*g,Ye=Ge+1+(Ze+1)*g;Se[Ee++]=Ge+Ze*g,Se[Ee++]=Je,Se[Ee++]=Xe,Se[Ee++]=Xe,Se[Ee++]=Je,Se[Ee++]=Ye}return{vertices:Pe.buffer.slice(0),indices:Se.buffer.slice(0),uses32bitIndices:se}}const ma=new s.aD({fill:new s.ba(128,2),line:new s.ba(512,0),tile:new s.ba(128,32),stencil:new s.ba(128,1),circle:3});class ea{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Oi.projectionGlobe}get vertexShaderPreludeCode(){return Oi.projectionMercator.vertexSource}get subdivisionGranularity(){return ma}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new ks(e));const r=s.S(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-r*Math.PI*2))-.5*Math.PI,u=this._errorMeasurement.updateErrorLoop(r,l),g=J.now();u!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=u,this._errorMeasurementLastChangeTime=g);const P=Math.min(Math.max((g-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=s.bb(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,s.bc(P))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,r,l,u,g){const P=(g==="stencil"?ma.stencil:ma.tile).getGranularityForZoomLevel(r.z);return this._getMesh(e,{granularity:P,generateBorders:l,extendToNorthPole:r.y===0&&u,extendToSouthPole:r.y===(1<<r.z)-1&&u})}_getMesh(e,r){const l=this._getMeshKey(r);if(l in this._tileMeshCache)return this._tileMeshCache[l];const u=function(g,P){const I=Qs(P,"16bit"),E=s.aE.deserialize({arrayBuffer:I.vertices,length:I.vertices.byteLength/2/2}),D=s.aG.deserialize({arrayBuffer:I.indices,length:I.indices.byteLength/2/3});return new qn(g.createVertexBuffer(E,os.members),g.createIndexBuffer(D),s.aF.simpleSegment(0,0,E.length,D.length))}(e,r);return this._tileMeshCache[l]=u,u}recalculate(e){}hasTransition(){const e=J.now();let r=!1;return r=r||(e-this._errorMeasurementLastChangeTime)/1e3<.7,r=r||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,r}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const rc=new s.r({type:new s.D(s.v.projection.type)});class Io extends s.E{constructor(e){super(),this._transitionable=new s.T(rc),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.C(0)),this._mercatorProjection=new al,this._verticalPerspectiveProjection=new ea}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof s.bd){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,r,l,u,g){return this.currentProjection.getMeshFromTileID(e,r,l,u,g)}setProjection(e){this._transitionable.setValue("type",(e==null?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function ll(m){const e=ji(m.worldSize,m.center.lat);return 2*Math.PI*e}function lo(m,e,r,l,u){const g=1/(1<<u),P=e/s.Z*g+l*g,I=s.bf((m/s.Z*g+r*g)*Math.PI*2+Math.PI,2*Math.PI),E=2*Math.atan(Math.exp(Math.PI-P*Math.PI*2))-.5*Math.PI,D=Math.cos(E),q=new Float64Array(3);return q[0]=Math.sin(I)*D,q[1]=Math.sin(E),q[2]=Math.cos(I)*D,q}function zi(m){return function(e,r){const l=Math.cos(r),u=new Float64Array(3);return u[0]=Math.sin(e)*l,u[1]=Math.sin(r),u[2]=Math.cos(e)*l,u}(m.lng*Math.PI/180,m.lat*Math.PI/180)}function ji(m,e){return m/(2*Math.PI)/Math.cos(e*Math.PI/180)}function cl(m){const e=Math.asin(m[1])/Math.PI*180,r=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(r>1e-6){const l=m[0]/r,u=Math.acos(m[2]/r),g=(l>0?u:-u)/Math.PI*180;return new s.Q(s.aK(g,-180,180),e)}return new s.Q(0,e)}function dn(m){return Math.cos(m*Math.PI/180)}function mi(m,e){const r=dn(m),l=dn(e);return s.aa(l/r)}function Co(m,e){const r=m.rotate(e.bearingInRadians),l=e.zoom+mi(e.center.lat,0),u=s.bb(1/dn(e.center.lat),1/dn(Math.min(Math.abs(e.center.lat),60)),s.be(l,7,3,0,1)),g=360/ll({worldSize:e.worldSize,center:{lat:e.center.lat}});return new s.Q(e.center.lng-r.x*g*u,s.ad(e.center.lat+r.y*g,-85.051129,s.aI))}function ga(m){const e=.5*m,r=Math.sin(e),l=Math.cos(e);return Math.log(r+l)-Math.log(l-r)}function Na(m,e,r,l){const u=m.lat+r*l;if(Math.abs(r)>1){const g=(Math.sign(m.lat+r)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,P=Math.abs(m.lat+r)*Math.PI/180,I=ga(g+l*(P-g)),E=ga(g),D=ga(P);return new s.Q(m.lng+e*((I-E)/(D-E)),u)}return new s.Q(m.lng+e*l,u)}class ul{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=e}recalculateCache(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(e,r,l,u){const g=`${e.z}_${e.x}_${e.y}`,P=this._cache.get(g);if(P)return P;const I=this._cachePrevious.get(g);if(I)return this._cache.set(g,I),I;const E=this._aabbFactory(e,r,l,u);return this._cache.set(g,E),this._hadAnyChanges=!0,E}}function hl(m,e,r){const l=m-e;return l<0?-l:Math.max(0,l-r)}function Mo(m,e,r,l,u){const g=m-r;let P;return P=g<0?Math.min(-g,1+g-u):g>1?Math.min(Math.max(g-u,0),1-g):0,Math.max(P,hl(e,l,u))}class Dl{constructor(){this._aabbCache=new ul(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(e,r,l,u){const g=1<<l.z,P=1/g,I=l.x/g,E=l.y/g;let D=2;return D=Math.min(D,Mo(e,r,I,E,P)),D=Math.min(D,Mo(e,r,I+.5,-E-P,P)),D=Math.min(D,Mo(e,r,I+.5,2-E-P,P)),D}getWrap(e,r,l){const u=1<<r.z,g=1/u,P=r.x/u,I=hl(e.x,P,g),E=hl(e.x,P-1,g),D=hl(e.x,P+1,g),q=Math.min(I,E,D);return q===D?1:q===E?-1:0}allowVariableZoom(e,r){return Bi(e,r)>4}allowWorldCopies(){return!1}getTileAABB(e,r,l,u){return this._aabbCache.getTileAABB(e,r,l,u)}_computeTileAABB(e,r,l,u){if(e.z<=0)return new Ii([-1,-1,-1],[1,1,1]);if(e.z===1)return new Ii([e.x===0?-1:0,e.y===0?0:-1,-1],[e.x===0?0:1,e.y===0?1:0,1]);{const g=[lo(0,0,e.x,e.y,e.z),lo(s.Z,0,e.x,e.y,e.z),lo(s.Z,s.Z,e.x,e.y,e.z),lo(0,s.Z,e.x,e.y,e.z)],P=[1,1,1],I=[-1,-1,-1];for(const E of g)for(let D=0;D<3;D++)P[D]=Math.min(P[D],E[D]),I[D]=Math.max(I[D],E[D]);if(e.y===0||e.y===(1<<e.z)-1){const E=[0,e.y===0?1:-1,0];for(let D=0;D<3;D++)P[D]=Math.min(P[D],E[D]),I[D]=Math.max(I[D],E[D])}return new Ii(P,I)}}}class Lo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,l){return this._helper.interpolatePadding(e,r,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r){this._helper.resize(e,r)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=s.bg(),this._projectionMatrix=s.b0(),this._globeViewProjMatrix32f=s.a$(),this._globeViewProjMatrixNoCorrection=s.b0(),this._globeViewProjMatrixNoCorrectionInverted=s.b0(),this._globeProjMatrixInverted=s.b0(),this._cameraPosition=s.bh(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Ao({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,r)=>this.getConstrained(e,r)}),this._coveringTilesDetailsProvider=new Dl}clone(){const e=new Lo;return e.apply(this),e}apply(e,r){this._globeLatitudeErrorCorrectionRadians=r||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=s.bh();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:r,applyGlobeMatrix:l}=e,u=this._helper.getMercatorTileCoordinates(r);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:u,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const r=this.pitchInRadians,l=this.cameraToCenterDistance/e,u=Math.sin(r)*l,g=Math.cos(r)*l+1,P=1/Math.sqrt(u*u+g*g)*1;let I=-u,E=g;const D=Math.sqrt(I*I+E*E);I/=D,E/=D;const q=[0,I,E];return s.bi(q,q,[0,0,0],-this.bearingInRadians),s.bj(q,q,[0,0,0],-1*this.center.lat*Math.PI/180),s.bk(q,q,[0,0,0],this.center.lng*Math.PI/180),s.aN(q,q,.25),[...q,.25*-P]}isLocationOccluded(e){return!this.isSurfacePointVisible(zi(e))}transformLightDirection(e){const r=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,u=Math.cos(l),g=[Math.sin(r)*u,Math.sin(l),Math.cos(r)*u],P=[g[2],0,-g[0]],I=[0,0,0];s.aT(I,P,g),s.aS(P,P),s.aS(I,I);const E=[0,0,0];return s.aS(E,[P[0]*e[0]+I[0]*e[1]+g[0]*e[2],P[1]*e[0]+I[1]*e[1]+g[1]*e[2],P[2]*e[0]+I[2]*e[1]+g[2]*e[2]]),E}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,r,l){const u=function(I,E,D){const q=1/(1<<D.z);return new s.$(I/s.Z*q+D.x*q,E/s.Z*q+D.y*q)}(e,r,l.canonical),g=(P=u.y,[s.bf(u.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-P*Math.PI*2))-.5*Math.PI]);var P;return this.getCircleRadiusCorrection()/Math.cos(g[1])}projectTileCoordinates(e,r,l,u){const g=l.canonical,P=lo(e,r,g.x,g.y,g.z),I=1+(u?u(e,r):0)/s.bq,E=[P[0]*I,P[1]*I,P[2]*I,1];s.ao(E,E,this._globeViewProjMatrixNoCorrection);const D=this._cachedClippingPlane,q=D[0]*P[0]+D[1]*P[1]+D[2]*P[2]+D[3]<0;return{point:new s.P(E[0]/E[3],E[1]/E[3]),signedDistanceFromCamera:E[3],isOccluded:q}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=ji(this.worldSize,this.center.lat),r=s.b1(),l=s.b1();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),s.aX(r,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const u=this.centerOffset;r[8]=2*-u.x/this._helper._width,r[9]=2*u.y/this._helper._height,this._projectionMatrix=s.aY(r),this._globeProjMatrixInverted=s.b1(),s.ai(this._globeProjMatrixInverted,r),s.L(r,r,[0,0,-this.cameraToCenterDistance]),s.aZ(r,r,this.rollInRadians),s.a_(r,r,-this.pitchInRadians),s.aZ(r,r,this.bearingInRadians),s.L(r,r,[0,0,-e]);const g=s.bh();g[0]=e,g[1]=e,g[2]=e,s.a_(l,r,this.center.lat*Math.PI/180),s.bl(l,l,-this.center.lng*Math.PI/180),s.M(l,l,g),this._globeViewProjMatrixNoCorrection=l,s.a_(r,r,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),s.bl(r,r,-this.center.lng*Math.PI/180),s.M(r,r,g),this._globeViewProjMatrix32f=new Float32Array(r),this._globeViewProjMatrixNoCorrectionInverted=s.b1(),s.ai(this._globeViewProjMatrixNoCorrectionInverted,l);const P=s.bh();this._cameraPosition=s.bh(),this._cameraPosition[2]=this.cameraToCenterDistance/e,s.bi(this._cameraPosition,this._cameraPosition,P,-this.rollInRadians),s.bj(this._cameraPosition,this._cameraPosition,P,this.pitchInRadians),s.bi(this._cameraPosition,this._cameraPosition,P,-this.bearingInRadians),s.aO(this._cameraPosition,this._cameraPosition,[0,0,1]),s.bj(this._cameraPosition,this._cameraPosition,P,-this.center.lat*Math.PI/180),s.bk(this._cameraPosition,this._cameraPosition,P,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const I=s.aY(this._globeViewProjMatrixNoCorrectionInverted);s.M(I,I,[1,1,-1]),this._cachedFrustum=Js.fromInvProjectionMatrix(I)}calculateFogMatrix(e){s.w("calculateFogMatrix is not supported on globe projection.");const r=s.b1();return s.as(r),r}getVisibleUnwrappedCoordinates(e){return[new s.aV(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&s.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=zi(e);s.aN(l,l,1+r/s.bq);const u=s.bg();return s.ao(u,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),u[2]/u[3]}populateCache(e){}getBounds(){const e=.5*this.width,r=.5*this.height,l=[new s.P(0,0),new s.P(e,0),new s.P(this.width,0),new s.P(this.width,r),new s.P(this.width,this.height),new s.P(e,this.height),new s.P(0,this.height),new s.P(0,r)],u=[];for(const $ of l)u.push(this.unprojectScreenPoint($));let g=0,P=0,I=0,E=0;const D=this.center;for(const $ of u){const W=s.bm(D.lng,$.lng),ie=s.bm(D.lat,$.lat);W<P&&(P=W),W>g&&(g=W),ie<E&&(E=ie),ie>I&&(I=ie)}const q=[D.lng+P,D.lat+E,D.lng+g,D.lat+I];return this.isSurfacePointOnScreen([0,1,0])&&(q[3]=90,q[0]=-180,q[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(q[1]=-90,q[0]=-180,q[2]=180),new dr(q)}getConstrained(e,r){const l=s.ad(e.lat,-85.051129,s.aI),u=s.ad(+r,this.minZoom+mi(0,l),this.maxZoom);return{center:new s.Q(e.lng,l),zoom:u}}calculateCenterFromCameraLngLatAlt(e,r,l,u){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,l,u)}setLocationAtPoint(e,r){const l=zi(this.unprojectScreenPoint(r)),u=zi(e),g=s.bh();s.bn(g);const P=s.bh();s.bk(P,l,g,-this.center.lng*Math.PI/180),s.bj(P,P,g,this.center.lat*Math.PI/180);const I=u[0]*u[0]+u[2]*u[2],E=P[0]*P[0];if(I<E)return;const D=Math.sqrt(I-E),q=-D,$=s.bo(u[0],u[2],P[0],D),W=s.bo(u[0],u[2],P[0],q),ie=s.bh();s.bk(ie,u,g,-$);const se=s.bo(ie[1],ie[2],P[1],P[2]),Pe=s.bh();s.bk(Pe,u,g,-W);const be=s.bo(Pe[1],Pe[2],P[1],P[2]),Se=.5*Math.PI,Ee=se>=-Se&&se<=Se,Ze=be>=-Se&&be<=Se;let Ge,Xe;if(Ee&&Ze){const bt=this.center.lng*Math.PI/180,Mt=this.center.lat*Math.PI/180;s.br($,bt)+s.br(se,Mt)<s.br(W,bt)+s.br(be,Mt)?(Ge=$,Xe=se):(Ge=W,Xe=be)}else if(Ee)Ge=$,Xe=se;else{if(!Ze)return;Ge=W,Xe=be}const Je=Ge/Math.PI*180,Ye=Xe/Math.PI*180,vt=this.center.lat;this.setCenter(new s.Q(Je,s.ad(Ye,-90,90))),this.setZoom(this.zoom+mi(vt,this.center.lat))}locationToScreenPoint(e,r){const l=zi(e);if(r){const u=r.getElevationForLngLatZoom(e,this._helper._tileZoom);s.aN(l,l,1+u/s.bq)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(e){const r=s.bg();return s.ao(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],new s.P((.5*r[0]+.5)*this.width,(.5*-r[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,r){if(r){const l=r.pointCoordinate(e);if(l)return l}return s.$.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,r){var l;return(l=this.screenPointToMercatorCoordinate(e,r))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(e,r){const l=this._cameraPosition,u=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(l,u)}getRayDirectionFromPixel(e){const r=s.bg();r[0]=e.x/this.width*2-1,r[1]=-1*(e.y/this.height*2-1),r[2]=1,r[3]=1,s.ao(r,r,this._globeViewProjMatrixNoCorrectionInverted),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3];const l=s.bh();l[0]=r[0]-this._cameraPosition[0],l[1]=r[1]-this._cameraPosition[1],l[2]=r[2]-this._cameraPosition[2];const u=s.bh();return s.aS(u,l),u}isSurfacePointVisible(e){const r=this._cachedClippingPlane;return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const r=s.bg();return s.ao(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3],r[0]>-1&&r[0]<1&&r[1]>-1&&r[1]<1&&r[2]>-1&&r[2]<1}rayPlanetIntersection(e,r){const l=s.aU(e,r),u=s.bh(),g=s.bh();s.aN(g,r,l),s.aR(u,e,g);const P=1-s.aU(u,u);if(P<0)return null;const I=s.aU(e,e)-1,E=-l+(l<0?1:-1)*Math.sqrt(P),D=I/E,q=E;return{tMin:Math.min(D,q),tMax:Math.max(D,q)}}unprojectScreenPoint(e){const r=this._cameraPosition,l=this.getRayDirectionFromPixel(e),u=this.rayPlanetIntersection(r,l);if(u){const D=s.bh();s.aO(D,r,[l[0]*u.tMin,l[1]*u.tMin,l[2]*u.tMin]);const q=s.bh();return s.aS(q,D),cl(q)}const g=this._cachedClippingPlane[0]*l[0]+this._cachedClippingPlane[1]*l[1]+this._cachedClippingPlane[2]*l[2],P=-s.bp(this._cachedClippingPlane,r)/g,I=s.bh();if(P>0)s.aO(I,r,[l[0]*P,l[1]*P,l[2]*P]);else{const D=s.bh();s.aO(D,r,[2*l[0],2*l[1],2*l[2]]);const q=s.bp(this._cachedClippingPlane,D);s.aR(I,D,[this._cachedClippingPlane[0]*q,this._cachedClippingPlane[1]*q,this._cachedClippingPlane[2]*q])}const E=s.bh();return s.aS(E,I),cl(E)}getMatrixForModel(e,r){const l=s.Q.convert(e),u=1/s.bq,g=s.b0();return s.bl(g,g,l.lng/180*Math.PI),s.a_(g,g,-l.lat/180*Math.PI),s.L(g,g,[0,0,1+r/s.bq]),s.a_(g,g,.5*Math.PI),s.M(g,g,[u,u,u]),g}getProjectionDataForCustomLayer(e=!0){const r=this.getProjectionData({overscaledTileID:new s.Y(0,0,0,0,0),applyGlobeMatrix:e});return r.tileMercatorCoords=[0,0,1,1],r}getFastPathSimpleProjectionMatrix(e){}}class Ra{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,l){return this._helper.interpolatePadding(e,r,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,l=!0){this._helper.resize(e,r,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,r){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=r,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Ao({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,r)=>this.getConstrained(e,r)}),this._globeness=1,this._mercatorTransform=new Lr,this._verticalPerspectiveTransform=new Lo}clone(){const e=new Ra;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const r=this._mercatorTransform.getProjectionData(e),l=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:r.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:r.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return s.bb(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return s.bb(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,r,l){const u=this._mercatorTransform.getPitchedTextCorrection(e,r,l),g=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,r,l);return s.bb(u,g,this._globeness)}projectTileCoordinates(e,r,l,u){return this.currentTransform.projectTileCoordinates(e,r,l,u)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){return this.currentTransform.lngLatToCameraDepth(e,r)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,r){return this.currentTransform.getConstrained(e,r)}calculateCenterFromCameraLngLatAlt(e,r,l,u){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,l,u)}setLocationAtPoint(e,r){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,r),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,r),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,r){return this.currentTransform.locationToScreenPoint(e,r)}screenPointToMercatorCoordinate(e,r){return this.currentTransform.screenPointToMercatorCoordinate(e,r)}screenPointToLocation(e,r){return this.currentTransform.screenPointToLocation(e,r)}isPointOnMapSurface(e,r){return this.currentTransform.isPointOnMapSurface(e,r)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,r){return this.currentTransform.getMatrixForModel(e,r)}getProjectionDataForCustomLayer(e=!0){const r=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return r;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return l.fallbackMatrix=r.mainMatrix,l}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Sn{get useGlobeControls(){return!0}handlePanInertia(e,r){const l=Co(e,r);return Math.abs(l.lng-r.center.lng)>180&&(l.lng=r.center.lng+179.5*Math.sign(l.lng-r.center.lng)),{easingCenter:l,easingOffset:new s.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,r){const l=e.around,u=r.screenPointToLocation(l);e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta);const g=r.zoom;e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta);const P=r.zoom-g;if(P===0)return;const I=s.bm(r.center.lng,u.lng),E=I/(Math.abs(I/180)+1),D=s.bm(r.center.lat,u.lat),q=r.getRayDirectionFromPixel(l),$=r.cameraPosition,W=-1*s.aU($,q),ie=s.bh();s.aO(ie,$,[q[0]*W,q[1]*W,q[2]*W]);const se=s.bs(ie)-1,Pe=Math.exp(.5*-Math.max(se-.3,0)),be=ji(r.worldSize,r.center.lat)/Math.min(r.width,r.height),Se=s.be(be,.9,.5,1,.25),Ee=(1-s.aH(-P))*Math.min(Pe,Se),Ze=r.center.lat,Ge=r.zoom,Xe=new s.Q(r.center.lng+E*Ee,s.ad(r.center.lat+D*Ee,-85.051129,s.aI));r.setLocationAtPoint(u,l);const Je=r.center,Ye=s.be(Math.abs(I),45,85,0,1),vt=s.be(be,.75,.35,0,1),bt=Math.pow(Math.max(Ye,vt),.25),Mt=s.bm(Je.lng,Xe.lng),Lt=s.bm(Je.lat,Xe.lat);r.setCenter(new s.Q(Je.lng+Mt*bt,Je.lat+Lt*bt).wrap()),r.setZoom(Ge+mi(Ze,r.center.lat))}handleMapControlsPan(e,r,l){if(!e.panDelta)return;const u=r.center.lat,g=r.zoom;r.setCenter(Co(e.panDelta,r).wrap()),r.setZoom(g+mi(u,r.center.lat))}cameraForBoxAndBearing(e,r,l,u,g){const P=Es(e,r,l,u,g),I=r.left/g.width*2-1,E=(g.width-r.right)/g.width*2-1,D=r.top/g.height*-2+1,q=(g.height-r.bottom)/g.height*-2+1,$=s.bm(l.getWest(),l.getEast())<0,W=$?l.getEast():l.getWest(),ie=$?l.getWest():l.getEast(),se=Math.max(l.getNorth(),l.getSouth()),Pe=Math.min(l.getNorth(),l.getSouth()),be=W+.5*s.bm(W,ie),Se=se+.5*s.bm(se,Pe),Ee=g.clone();Ee.setCenter(P.center),Ee.setBearing(P.bearing),Ee.setPitch(0),Ee.setRoll(0),Ee.setZoom(P.zoom);const Ze=Ee.modelViewProjectionMatrix,Ge=[zi(l.getNorthWest()),zi(l.getNorthEast()),zi(l.getSouthWest()),zi(l.getSouthEast()),zi(new s.Q(ie,Se)),zi(new s.Q(W,Se)),zi(new s.Q(be,se)),zi(new s.Q(be,Pe))],Xe=zi(P.center);let Je=Number.POSITIVE_INFINITY;for(const Ye of Ge)I<0&&(Je=Sn.getLesserNonNegativeNonNull(Je,Sn.solveVectorScale(Ye,Xe,Ze,"x",I))),E>0&&(Je=Sn.getLesserNonNegativeNonNull(Je,Sn.solveVectorScale(Ye,Xe,Ze,"x",E))),D>0&&(Je=Sn.getLesserNonNegativeNonNull(Je,Sn.solveVectorScale(Ye,Xe,Ze,"y",D))),q<0&&(Je=Sn.getLesserNonNegativeNonNull(Je,Sn.solveVectorScale(Ye,Xe,Ze,"y",q)));if(Number.isFinite(Je)&&Je!==0)return P.zoom=Ee.zoom+s.aa(Je),P;To()}handleJumpToCenterZoom(e,r){const l=e.center.lat,u=e.getConstrained(r.center?s.Q.convert(r.center):e.center,e.zoom).center;e.setCenter(u.wrap());const g=r.zoom!==void 0?+r.zoom:e.zoom+mi(l,u.lat);e.zoom!==g&&e.setZoom(g)}handleEaseTo(e,r){const l=e.zoom,u=e.center,g=e.padding,P={roll:e.roll,pitch:e.pitch,bearing:e.bearing},I={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},E=r.zoom!==void 0,D=!e.isPaddingEqual(r.padding);let q=!1;const $=r.center?s.Q.convert(r.center):u,W=e.getConstrained($,l).center;hn(e,W);const ie=e.clone();ie.setCenter(W),ie.setZoom(E?+r.zoom:l+mi(u.lat,$.lat)),ie.setBearing(r.bearing);const se=new s.P(s.ad(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),s.ad(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));ie.setLocationAtPoint(W,se);const Pe=(r.offset&&r.offsetAsPoint.mag())>0?ie.center:W,be=E?+r.zoom:l+mi(u.lat,Pe.lat),Se=l+mi(u.lat,0),Ee=be+mi(Pe.lat,0),Ze=s.bm(u.lng,Pe.lng),Ge=s.bm(u.lat,Pe.lat),Xe=s.aH(Ee-Se);return q=be!==l,{easeFunc:Je=>{if(s.b5(P,I)||cs({startEulerAngles:P,endEulerAngles:I,tr:e,k:Je,useSlerp:P.roll!=I.roll}),D&&e.interpolatePadding(g,r.padding,Je),r.around)s.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(r.around,r.aroundPoint);else{const Ye=Ee>Se?Math.min(2,Xe):Math.max(.5,Xe),vt=Math.pow(Ye,1-Je),bt=Na(u,Ze,Ge,Je*vt);e.setCenter(bt.wrap())}if(q){const Ye=s.B.number(Se,Ee,Je)+mi(0,e.center.lat);e.setZoom(Ye)}},isZooming:q,elevationCenter:Pe}}handleFlyTo(e,r){const l=r.zoom!==void 0,u=e.center,g=e.zoom,P=e.padding,I=!e.isPaddingEqual(r.padding),E=e.getConstrained(s.Q.convert(r.center||r.locationAtOffset),g).center,D=l?+r.zoom:e.zoom+mi(e.center.lat,E.lat),q=e.clone();q.setCenter(E),q.setZoom(D),q.setBearing(r.bearing);const $=new s.P(s.ad(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),s.ad(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));q.setLocationAtPoint(E,$);const W=q.center;hn(e,W);const ie=function(Ge,Xe,Je){const Ye=zi(Xe),vt=zi(Je),bt=s.aU(Ye,vt),Mt=Math.acos(bt),Lt=ll(Ge);return Mt/(2*Math.PI)*Lt}(e,u,W),se=g+mi(u.lat,0),Pe=D+mi(W.lat,0),be=s.aH(Pe-se);let Se;if(typeof r.minZoom=="number"){const Ge=+r.minZoom+mi(W.lat,0),Xe=Math.min(Ge,se,Pe)+mi(0,W.lat),Je=e.getConstrained(W,Xe).zoom+mi(W.lat,0);Se=s.aH(Je-se)}const Ee=s.bm(u.lng,W.lng),Ze=s.bm(u.lat,W.lat);return{easeFunc:(Ge,Xe,Je,Ye)=>{const vt=Na(u,Ee,Ze,Je);I&&e.interpolatePadding(P,r.padding,Ge);const bt=Ge===1?W:vt;e.setCenter(bt.wrap());const Mt=se+s.aa(Xe);e.setZoom(Ge===1?D:Mt+mi(0,bt.lat))},scaleOfZoom:be,targetCenter:W,scaleOfMinZoom:Se,pixelPathLength:ie}}static solveVectorScale(e,r,l,u,g){const P=u==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],I=[l[3],l[7],l[11],l[15]],E=e[0]*P[0]+e[1]*P[1]+e[2]*P[2],D=e[0]*I[0]+e[1]*I[1]+e[2]*I[2],q=r[0]*P[0]+r[1]*P[1]+r[2]*P[2],$=r[0]*I[0]+r[1]*I[1]+r[2]*I[2];return q+g*D===E+g*$||I[3]*(E-q)+P[3]*($-D)+E*$==q*D?null:(q+P[3]-g*$-g*I[3])/(q-E-g*$+g*D)}static getLesserNonNegativeNonNull(e,r){return r!==null&&r>=0&&r<e?r:e}}class co{constructor(e){this._globe=e,this._mercatorCameraHelper=new us,this._verticalPerspectiveCameraHelper=new Sn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,r){return this.currentHelper.handlePanInertia(e,r)}handleMapControlsRollPitchBearingZoom(e,r){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,r)}handleMapControlsPan(e,r,l){this.currentHelper.handleMapControlsPan(e,r,l)}cameraForBoxAndBearing(e,r,l,u,g){return this.currentHelper.cameraForBoxAndBearing(e,r,l,u,g)}handleJumpToCenterZoom(e,r){this.currentHelper.handleJumpToCenterZoom(e,r)}handleEaseTo(e,r){return this.currentHelper.handleEaseTo(e,r)}handleFlyTo(e,r){return this.currentHelper.handleFlyTo(e,r)}}const _a=(m,e)=>s.x(m,e&&e.filter(r=>r.identifier!=="source.canvas")),Fl=s.bt();class ya extends s.E{constructor(e,r={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const u=this.sourceCaches[l].getSource().type;u!=="vector"&&u!=="geojson"||this.sourceCaches[l].reload()}},this.map=e,this.dispatcher=new at(nt(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(l,u)=>this.getGlyphs(l,u)),this.dispatcher.registerMessageHandler("GI",(l,u)=>this.getImages(l,u)),this.imageManager=new mt,this.imageManager.setEventedParent(this),this.glyphManager=new Ne(e._requestManager,r.localIdeographFontFamily),this.lineAtlas=new Dt(256,512),this.crossTileSymbolIndex=new ws,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.bu,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",s.bv()),Jr().on(Dr,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const u=this.sourceCaches[l.sourceId];if(!u)return;const g=u.getSource();if(g&&g.vectorLayerIds)for(const P in this._layers){const I=this._layers[P];I.source===g.id&&this._validateLayer(I)}})}loadURL(e,r={},l){this.fire(new s.l("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const u=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const g=this._loadStyleRequest;s.j(u,this._loadStyleRequest).then(P=>{this._loadStyleRequest=null,this._load(P.data,r,l)}).catch(P=>{this._loadStyleRequest=null,P&&!g.signal.aborted&&this.fire(new s.k(P))})}loadJSON(e,r={},l){this.fire(new s.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,J.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(e,r,l)}).catch(()=>{})}loadEmpty(){this.fire(new s.l("dataloading",{dataType:"style"})),this._load(Fl,{validate:!1})}_load(e,r,l){var u,g;const P=r.transformStyle?r.transformStyle(l,e):e;if(!r.validate||!_a(this,s.y(P))){this._loaded=!0,this.stylesheet=P;for(const I in P.sources)this.addSource(I,P.sources[I],{validate:!1});P.sprite?this._loadSprite(P.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(P.glyphs),this._createLayers(),this.light=new At(this.stylesheet.light),this._setProjectionInternal(((u=this.stylesheet.projection)===null||u===void 0?void 0:u.type)||"mercator"),this.sky=new Tt(this.stylesheet.sky),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new s.l("data",{dataType:"style"})),this.fire(new s.l("style.load"))}}_createLayers(){const e=s.bw(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(r=>r.id),this._layers={},this._serializedLayers=null;for(const r of e){const l=s.bx(r);l.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=l}}_loadSprite(e,r=!1,l=void 0){let u;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(g,P,I,E){return s._(this,void 0,void 0,function*(){const D=Ke(g),q=I>1?"@2x":"",$={},W={};for(const{id:ie,url:se}of D){const Pe=P.transformRequest(Ue(se,q,".json"),"SpriteJSON");$[ie]=s.j(Pe,E);const be=P.transformRequest(Ue(se,q,".png"),"SpriteImage");W[ie]=Oe.getImage(be,E)}return yield Promise.all([...Object.values($),...Object.values(W)]),function(ie,se){return s._(this,void 0,void 0,function*(){const Pe={};for(const be in ie){Pe[be]={};const Se=J.getImageCanvasContext((yield se[be]).data),Ee=(yield ie[be]).data;for(const Ze in Ee){const{width:Ge,height:Xe,x:Je,y:Ye,sdf:vt,pixelRatio:bt,stretchX:Mt,stretchY:Lt,content:It,textFitWidth:tr,textFitHeight:Kt}=Ee[Ze];Pe[be][Ze]={data:null,pixelRatio:bt,sdf:vt,stretchX:Mt,stretchY:Lt,content:It,textFitWidth:tr,textFitHeight:Kt,spriteData:{width:Ge,height:Xe,x:Je,y:Ye,context:Se}}}}return Pe})}($,W)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(g=>{if(this._spriteRequest=null,g)for(const P in g){this._spritesImagesIds[P]=[];const I=this._spritesImagesIds[P]?this._spritesImagesIds[P].filter(E=>!(E in g)):[];for(const E of I)this.imageManager.removeImage(E),this._changedImages[E]=!0;for(const E in g[P]){const D=P==="default"?E:`${P}:${E}`;this._spritesImagesIds[P].push(D),D in this.imageManager.images?this.imageManager.updateImage(D,g[P][E],!1):this.imageManager.addImage(D,g[P][E]),r&&(this._changedImages[D]=!0)}}}).catch(g=>{this._spriteRequest=null,u=g,this.fire(new s.k(u))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"})),l&&l(u)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}_validateLayer(e){const r=this.sourceCaches[e.source];if(!r)return;const l=e.sourceLayer;if(!l)return;const u=r.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(l)===-1)&&this.fire(new s.k(new Error(`Source layer "${l}" does not exist on source "${u.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,r=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(r?s.by(l):l);const u=[];for(const g of e)if(l[g]){const P=r?s.by(l[g]):l[g];u.push(P)}return u}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const r=Object.keys(this._layers);for(const l of r){const u=this._layers[l];u.type!=="custom"&&(e[l]=u.serialize())}return e}hasTransitions(){var e,r,l;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((r=this.sky)===null||r===void 0)&&r.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const u in this.sourceCaches)if(this.sourceCaches[u].hasTransition())return!0;for(const u in this._layers)if(this._layers[u].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const r=this._changed;if(r){const u=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(u.length||g.length)&&this._updateWorkerLayers(u,g);for(const P in this._updatedSources){const I=this._updatedSources[P];if(I==="reload")this._reloadSource(P);else{if(I!=="clear")throw new Error(`Invalid action ${I}`);this._clearSource(P)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const P in this._updatedPaintProps)this._layers[P].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const u in this.sourceCaches){const g=this.sourceCaches[u];l[u]=g.used,g.used=!1}for(const u of this._order){const g=this._layers[u];g.recalculate(e,this._availableImages),!g.isHidden(e.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(const u in l){const g=this.sourceCaches[u];!!l[u]!=!!g.used&&g.fire(new s.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,r&&this.fire(new s.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,r={}){var l;this._checkLoaded();const u=this.serialize();if(e=r.transformStyle?r.transformStyle(u,e):e,((l=r.validate)===null||l===void 0||l)&&_a(this,s.y(e)))return!1;(e=s.by(e)).layers=s.bw(e.layers);const g=s.bz(u,e),P=this._getOperationsToPerform(g);if(P.unimplemented.length>0)throw new Error(`Unimplemented: ${P.unimplemented.join(", ")}.`);if(P.operations.length===0)return!1;for(const I of P.operations)I();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const r=[],l=[];for(const u of e)switch(u.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":r.push(()=>this.addLayer.apply(this,u.args));break;case"removeLayer":r.push(()=>this.removeLayer.apply(this,u.args));break;case"setPaintProperty":r.push(()=>this.setPaintProperty.apply(this,u.args));break;case"setLayoutProperty":r.push(()=>this.setLayoutProperty.apply(this,u.args));break;case"setFilter":r.push(()=>this.setFilter.apply(this,u.args));break;case"addSource":r.push(()=>this.addSource.apply(this,u.args));break;case"removeSource":r.push(()=>this.removeSource.apply(this,u.args));break;case"setLayerZoomRange":r.push(()=>this.setLayerZoomRange.apply(this,u.args));break;case"setLight":r.push(()=>this.setLight.apply(this,u.args));break;case"setGeoJSONSourceData":r.push(()=>this.setGeoJSONSourceData.apply(this,u.args));break;case"setGlyphs":r.push(()=>this.setGlyphs.apply(this,u.args));break;case"setSprite":r.push(()=>this.setSprite.apply(this,u.args));break;case"setTerrain":r.push(()=>this.map.setTerrain.apply(this,u.args));break;case"setSky":r.push(()=>this.setSky.apply(this,u.args));break;case"setProjection":this.setProjection.apply(this,u.args);break;case"setTransition":r.push(()=>{});break;default:l.push(u.command)}return{operations:r,unimplemented:l}}addImage(e,r){if(this.getImage(e))return this.fire(new s.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,r),this._afterImageUpdated(e)}updateImage(e,r){this.imageManager.updateImage(e,r)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new s.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,r,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(s.y.source,`sources.${e}`,r,null,l))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const u=this.sourceCaches[e]=new x(e,r,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:e})),u.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new s.k(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const r=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],r.fire(new s.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,r){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(r),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,r,l={}){this._checkLoaded();const u=e.id;if(this.getLayer(u))return void this.fire(new s.k(new Error(`Layer "${u}" already exists on this map.`)));let g;if(e.type==="custom"){if(_a(this,s.bA(e)))return;g=s.bx(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(u,e.source),e=s.by(e),e=s.e(e,{source:u})),this._validate(s.y.layer,`layers.${u}`,e,{arrayIndex:-1},l))return;g=s.bx(e),this._validateLayer(g),g.setEventedParent(this,{layer:{id:u}})}const P=r?this._order.indexOf(r):this._order.length;if(r&&P===-1)this.fire(new s.k(new Error(`Cannot add layer "${u}" before non-existing layer "${r}".`)));else{if(this._order.splice(P,0,u),this._layerOrderChanged=!0,this._layers[u]=g,this._removedLayers[u]&&g.source&&g.type!=="custom"){const I=this._removedLayers[u];delete this._removedLayers[u],I.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(e,r){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new s.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===r)return;const l=this._order.indexOf(e);this._order.splice(l,1);const u=r?this._order.indexOf(r):this._order.length;r&&u===-1?this.fire(new s.k(new Error(`Cannot move layer "${e}" before non-existing layer "${r}".`))):(this._order.splice(u,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const r=this._layers[e];if(!r)return void this.fire(new s.k(new Error(`Cannot remove non-existing layer "${e}".`)));r.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,r,l){this._checkLoaded();const u=this.getLayer(e);u?u.minzoom===r&&u.maxzoom===l||(r!=null&&(u.minzoom=r),l!=null&&(u.maxzoom=l),this._updateLayer(u)):this.fire(new s.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,r,l={}){this._checkLoaded();const u=this.getLayer(e);if(u){if(!s.bB(u.filter,r))return r==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(s.y.filter,`layers.${u.id}.filter`,r,null,l)||(u.filter=s.by(r),this._updateLayer(u)))}else this.fire(new s.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return s.by(this.getLayer(e).filter)}setLayoutProperty(e,r,l,u={}){this._checkLoaded();const g=this.getLayer(e);g?s.bB(g.getLayoutProperty(r),l)||(g.setLayoutProperty(r,l,u),this._updateLayer(g)):this.fire(new s.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,r){const l=this.getLayer(e);if(l)return l.getLayoutProperty(r);this.fire(new s.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,r,l,u={}){this._checkLoaded();const g=this.getLayer(e);g?s.bB(g.getPaintProperty(r),l)||(g.setPaintProperty(r,l,u)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new s.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,r){return this.getLayer(e).getPaintProperty(r)}setFeatureState(e,r){this._checkLoaded();const l=e.source,u=e.sourceLayer,g=this.sourceCaches[l];if(g===void 0)return void this.fire(new s.k(new Error(`The source '${l}' does not exist in the map's style.`)));const P=g.getSource().type;P==="geojson"&&u?this.fire(new s.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):P!=="vector"||u?(e.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),g.setFeatureState(u,e.id,r)):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,r){this._checkLoaded();const l=e.source,u=this.sourceCaches[l];if(u===void 0)return void this.fire(new s.k(new Error(`The source '${l}' does not exist in the map's style.`)));const g=u.getSource().type,P=g==="vector"?e.sourceLayer:void 0;g!=="vector"||P?r&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new s.k(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(P,e.id,r):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const r=e.source,l=e.sourceLayer,u=this.sourceCaches[r];if(u!==void 0)return u.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),u.getFeatureState(l,e.id)):void this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.k(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=s.bC(this.sourceCaches,g=>g.serialize()),r=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,u=this.stylesheet;return s.bD({version:u.version,name:u.name,metadata:u.metadata,light:u.light,sky:u.sky,center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,sprite:u.sprite,glyphs:u.glyphs,transition:u.transition,projection:u.projection,sources:e,layers:r,terrain:l},g=>g!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const r=P=>this._layers[P].type==="fill-extrusion",l={},u=[];for(let P=this._order.length-1;P>=0;P--){const I=this._order[P];if(r(I)){l[I]=P;for(const E of e){const D=E[I];if(D)for(const q of D)u.push(q)}}}u.sort((P,I)=>I.intersectionZ-P.intersectionZ);const g=[];for(let P=this._order.length-1;P>=0;P--){const I=this._order[P];if(r(I))for(let E=u.length-1;E>=0;E--){const D=u[E].feature;if(l[D.layer.id]<P)break;g.push(D),u.pop()}else for(const E of e){const D=E[I];if(D)for(const q of D)g.push(q.feature)}}return g}queryRenderedFeatures(e,r,l){r&&r.filter&&this._validate(s.y.filter,"queryRenderedFeatures.filter",r.filter,null,r);const u={};if(r&&r.layers){if(!(Array.isArray(r.layers)||r.layers instanceof Set))return this.fire(new s.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const D of r.layers){const q=this._layers[D];if(!q)return this.fire(new s.k(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];u[q.source]=!0}}const g=[];r.availableImages=this._availableImages;const P=this._serializedAllLayers(),I=r.layers instanceof Set?r.layers:Array.isArray(r.layers)?new Set(r.layers):null,E=Object.assign(Object.assign({},r),{layers:I});for(const D in this.sourceCaches)r.layers&&!u[D]||g.push(Ht(this.sourceCaches[D],this._layers,P,e,E,l));return this.placement&&g.push(function(D,q,$,W,ie,se,Pe){const be={},Se=se.queryRenderedSymbols(W),Ee=[];for(const Ze of Object.keys(Se).map(Number))Ee.push(Pe[Ze]);Ee.sort($t);for(const Ze of Ee){const Ge=Ze.featureIndex.lookupSymbolFeatures(Se[Ze.bucketInstanceId],q,Ze.bucketIndex,Ze.sourceLayerIndex,ie.filter,ie.layers,ie.availableImages,D);for(const Xe in Ge){const Je=be[Xe]=be[Xe]||[],Ye=Ge[Xe];Ye.sort((vt,bt)=>{const Mt=Ze.featureSortOrder;if(Mt){const Lt=Mt.indexOf(vt.featureIndex);return Mt.indexOf(bt.featureIndex)-Lt}return bt.featureIndex-vt.featureIndex});for(const vt of Ye)Je.push(vt)}}return function(Ze,Ge,Xe){for(const Je in Ze)for(const Ye of Ze[Je])er(Ye,Xe[Ge[Je].source]);return Ze}(be,D,$)}(this._layers,P,this.sourceCaches,e,E,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(e,r){r&&r.filter&&this._validate(s.y.filter,"querySourceFeatures.filter",r.filter,null,r);const l=this.sourceCaches[e];return l?function(u,g){const P=u.getRenderableIds().map(D=>u.getTileByID(D)),I=[],E={};for(let D=0;D<P.length;D++){const q=P[D],$=q.tileID.canonical.key;E[$]||(E[$]=!0,q.querySourceFeatures(I,g))}return I}(l,r):[]}getLight(){return this.light.getLight()}setLight(e,r={}){this._checkLoaded();const l=this.light.getLight();let u=!1;for(const P in e)if(!s.bB(e[P],l[P])){u=!0;break}if(!u)return;const g={now:J.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(g)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,r={}){this._checkLoaded();const l=this.getSky();let u=!1;if(!e&&!l)return;if(e&&!l)u=!0;else if(!e&&l)u=!0;else for(const P in e)if(!s.bB(e[P],l[P])){u=!0;break}if(!u)return;const g={now:J.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,r),this.sky.updateTransitions(g)}_setProjectionInternal(e){const r=function(l){if(Array.isArray(l)){const u=new Io({type:l});return{projection:u,transform:new Ra,cameraHelper:new co(u)}}switch(l){case"mercator":return{projection:new al,transform:new Lr,cameraHelper:new us};case"globe":{const u=new Io({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:u,transform:new Ra,cameraHelper:new co(u)}}case"vertical-perspective":return{projection:new ea,transform:new Lo,cameraHelper:new Sn};default:return s.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new al,transform:new Lr,cameraHelper:new us}}}(e);this.projection=r.projection,this.map.migrateProjection(r.transform,r.cameraHelper);for(const l in this.sourceCaches)this.sourceCaches[l].reload()}_validate(e,r,l,u,g={}){return(!g||g.validate!==!1)&&_a(this,e.call(s.y,s.e({key:r,style:this.serialize(),value:l,styleSpec:s.v},u)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Jr().off(Dr,this._rtlPluginLoaded);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const l=this.sourceCaches[r];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const r in this.sourceCaches)this.sourceCaches[r].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,r,l,u,g=!1){let P=!1,I=!1;const E={};for(const D of this._order){const q=this._layers[D];if(q.type!=="symbol")continue;if(!E[q.source]){const W=this.sourceCaches[q.source];E[q.source]=W.getRenderableIds(!0).map(ie=>W.getTileByID(ie)).sort((ie,se)=>se.tileID.overscaledZ-ie.tileID.overscaledZ||(ie.tileID.isLessThan(se.tileID)?-1:1))}const $=this.crossTileSymbolIndex.addLayer(q,E[q.source],e.center.lng);P=P||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(J.now(),e.zoom))&&(this.pauseablePlacement=new rl(e,this.map.terrain,this._order,g,r,l,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(J.now()),I=!0),P&&this.pauseablePlacement.placement.setStale()),I||P)for(const D of this._order){const q=this._layers[D];q.type==="symbol"&&this.placement.updateLayerOpacities(q,E[q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(J.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,r){return s._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();const u=this.sourceCaches[r.source];return u&&u.setDependencies(r.tileID.key,r.type,r.icons),l})}getGlyphs(e,r){return s._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(r.stacks),u=this.sourceCaches[r.source];return u&&u.setDependencies(r.tileID.key,r.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,r={}){this._checkLoaded(),e&&this._validate(s.y.glyphs,"glyphs",e,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,r,l={},u){this._checkLoaded();const g=[{id:e,url:r}],P=[...Ke(this.stylesheet.sprite),...g];this._validate(s.y.sprite,"sprite",P,null,l)||(this.stylesheet.sprite=P,this._loadSprite(g,!0,u))}removeSprite(e){this._checkLoaded();const r=Ke(this.stylesheet.sprite);if(r.find(l=>l.id===e)){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;r.splice(r.findIndex(l=>l.id===e),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}else this.fire(new s.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Ke(this.stylesheet.sprite)}setSprite(e,r={},l){this._checkLoaded(),e&&this._validate(s.y.sprite,"sprite",e,null,r)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var Vn=s.aC([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Nl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,r,l,u,g,P,I,E,D){this.context=e;let q=this.boundPaintVertexBuffers.length!==u.length;for(let $=0;!q&&$<u.length;$++)this.boundPaintVertexBuffers[$]!==u[$]&&(q=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==l||q||this.boundIndexBuffer!==g||this.boundVertexOffset!==P||this.boundDynamicVertexBuffer!==I||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==D?this.freshBind(r,l,u,g,P,I,E,D):(e.bindVertexArray.set(this.vao),I&&I.bind(),g&&g.dynamicDraw&&g.bind(),E&&E.bind(),D&&D.bind())}freshBind(e,r,l,u,g,P,I,E){const D=e.numAttributes,q=this.context,$=q.gl;this.vao&&this.destroy(),this.vao=q.createVertexArray(),q.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=u,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=I,this.boundDynamicVertexBuffer3=E,r.enableAttributes($,e);for(const W of l)W.enableAttributes($,e);P&&P.enableAttributes($,e),I&&I.enableAttributes($,e),E&&E.enableAttributes($,e),r.bind(),r.setVertexAttribPointers($,e,g);for(const W of l)W.bind(),W.setVertexAttribPointers($,e,g);P&&(P.bind(),P.setVertexAttribPointers($,e,g)),u&&u.bind(),I&&(I.bind(),I.setVertexAttribPointers($,e,g)),E&&(E.bind(),E.setVertexAttribPointers($,e,g)),q.currentNumAttributes=D}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const va=(m,e,r,l,u)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:e,u_fog_color:r?r.properties.get("fog-color"):s.b6.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:u?0:r?r.calculateFogBlendOpacity(l):0,u_horizon_color:r?r.properties.get("horizon-color"):s.b6.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:u?1:0}),Ba={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function k(m){const e=[];for(let r=0;r<m.length;r++){if(m[r]===null)continue;const l=m[r].split(" ");e.push(l.pop())}return e}class re{constructor(e,r,l,u,g,P,I,E){const D=e.gl;this.program=D.createProgram();const q=k(r.staticAttributes),$=l?l.getBinderAttributes():[],W=q.concat($),ie=Oi.prelude.staticUniforms?k(Oi.prelude.staticUniforms):[],se=I.staticUniforms?k(I.staticUniforms):[],Pe=r.staticUniforms?k(r.staticUniforms):[],be=l?l.getBinderUniforms():[],Se=ie.concat(se).concat(Pe).concat(be),Ee=[];for(const bt of Se)Ee.indexOf(bt)<0&&Ee.push(bt);const Ze=l?l.defines():[];Pn(D)&&Ze.unshift("#version 300 es"),g&&Ze.push("#define OVERDRAW_INSPECTOR;"),P&&Ze.push("#define TERRAIN3D;"),E&&Ze.push(E);let Ge=Ze.concat(Oi.prelude.fragmentSource,I.fragmentSource,r.fragmentSource).join(`
`),Xe=Ze.concat(Oi.prelude.vertexSource,I.vertexSource,r.vertexSource).join(`
`);Pn(D)||(Ge=function(bt){return bt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(Ge),Xe=function(bt){return bt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(Xe));const Je=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Je,Ge),D.compileShader(Je),!D.getShaderParameter(Je,D.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${D.getShaderInfoLog(Je)}`);D.attachShader(this.program,Je);const Ye=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Ye,Xe),D.compileShader(Ye),!D.getShaderParameter(Ye,D.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${D.getShaderInfoLog(Ye)}`);D.attachShader(this.program,Ye),this.attributes={};const vt={};this.numAttributes=W.length;for(let bt=0;bt<this.numAttributes;bt++)W[bt]&&(D.bindAttribLocation(this.program,bt,W[bt]),this.attributes[W[bt]]=bt);if(D.linkProgram(this.program),!D.getProgramParameter(this.program,D.LINK_STATUS))throw new Error(`Program failed to link: ${D.getProgramInfoLog(this.program)}`);D.deleteShader(Ye),D.deleteShader(Je);for(let bt=0;bt<Ee.length;bt++){const Mt=Ee[bt];if(Mt&&!vt[Mt]){const Lt=D.getUniformLocation(this.program,Mt);Lt&&(vt[Mt]=Lt)}}this.fixedUniforms=u(e,vt),this.terrainUniforms=((bt,Mt)=>({u_depth:new s.bE(bt,Mt.u_depth),u_terrain:new s.bE(bt,Mt.u_terrain),u_terrain_dim:new s.b7(bt,Mt.u_terrain_dim),u_terrain_matrix:new s.bG(bt,Mt.u_terrain_matrix),u_terrain_unpack:new s.bH(bt,Mt.u_terrain_unpack),u_terrain_exaggeration:new s.b7(bt,Mt.u_terrain_exaggeration)}))(e,vt),this.projectionUniforms=((bt,Mt)=>({u_projection_matrix:new s.bG(bt,Mt.u_projection_matrix),u_projection_tile_mercator_coords:new s.bH(bt,Mt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new s.bH(bt,Mt.u_projection_clipping_plane),u_projection_transition:new s.b7(bt,Mt.u_projection_transition),u_projection_fallback_matrix:new s.bG(bt,Mt.u_projection_fallback_matrix)}))(e,vt),this.binderUniforms=l?l.getUniforms(e,vt):[]}draw(e,r,l,u,g,P,I,E,D,q,$,W,ie,se,Pe,be,Se,Ee,Ze){const Ge=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(u),e.setColorMode(g),e.setCullFace(P),E){e.activeTexture.set(Ge.TEXTURE2),Ge.bindTexture(Ge.TEXTURE_2D,E.depthTexture),e.activeTexture.set(Ge.TEXTURE3),Ge.bindTexture(Ge.TEXTURE_2D,E.texture);for(const Je in this.terrainUniforms)this.terrainUniforms[Je].set(E[Je])}if(D)for(const Je in D)this.projectionUniforms[Ba[Je]].set(D[Je]);if(I)for(const Je in this.fixedUniforms)this.fixedUniforms[Je].set(I[Je]);be&&be.setUniforms(e,this.binderUniforms,se,{zoom:Pe});let Xe=0;switch(r){case Ge.LINES:Xe=2;break;case Ge.TRIANGLES:Xe=3;break;case Ge.LINE_STRIP:Xe=1}for(const Je of ie.get()){const Ye=Je.vaos||(Je.vaos={});(Ye[q]||(Ye[q]=new Nl)).bind(e,this,$,be?be.getPaintVertexBuffers():[],W,Je.vertexOffset,Se,Ee,Ze),Ge.drawElements(r,Je.primitiveLength*Xe,Ge.UNSIGNED_SHORT,Je.primitiveOffset*Xe*2)}}}function Fe(m,e,r){const l=1/s.av(r,1,e.transform.tileZoom),u=Math.pow(2,r.tileID.overscaledZ),g=r.tileSize*Math.pow(2,e.transform.tileZoom)/u,P=g*(r.tileID.canonical.x+r.tileID.wrap*u),I=g*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[l,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[P>>16,I>>16],u_pixel_coord_lower:[65535&P,65535&I]}}const tt=(m,e,r,l)=>{const u=m.style.light,g=u.properties.get("position"),P=[g.x,g.y,g.z],I=s.bK();u.properties.get("anchor")==="viewport"&&s.bL(I,m.transform.bearingInRadians),s.bM(P,P,I);const E=m.transform.transformLightDirection(P),D=u.properties.get("color");return{u_lightpos:P,u_lightpos_globe:E,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[D.r,D.g,D.b],u_vertical_gradient:+e,u_opacity:r,u_fill_translate:l}},dt=(m,e,r,l,u,g,P)=>s.e(tt(m,e,r,l),Fe(g,m,P),{u_height_factor:-Math.pow(2,u.overscaledZ)/P.tileSize/8}),Rt=(m,e,r,l)=>s.e(Fe(e,m,r),{u_fill_translate:l}),Yt=(m,e)=>({u_world:m,u_fill_translate:e}),mr=(m,e,r,l,u)=>s.e(Rt(m,e,r,u),{u_world:l}),Er=(m,e,r,l,u)=>{const g=m.transform;let P,I,E=0;if(r.paint.get("circle-pitch-alignment")==="map"){const D=s.av(e,1,g.zoom);P=!0,I=[D,D],E=D/(s.Z*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*u}else P=!1,I=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(r.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+P,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:I,u_globe_extrude_scale:E,u_translate:l}},Or=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),jr=m=>({u_viewport_size:[m.width,m.height]}),ai=(m,e=1)=>({u_color:m,u_overlay:0,u_overlay_scale:e}),Di=(m,e,r,l)=>{const u=s.av(m,1,e)/(s.Z*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:s.av(m,1,e),u_intensity:r,u_globe_extrude_scale:u}},Xi=(m,e,r,l)=>{const u=s.K();s.bN(u,0,m.width,m.height,0,0,1);const g=m.context.gl;return{u_matrix:u,u_world:[g.drawingBufferWidth,g.drawingBufferHeight],u_image:r,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}},Ci=(m,e,r)=>{const l=r.paint.get("hillshade-shadow-color"),u=r.paint.get("hillshade-highlight-color"),g=r.paint.get("hillshade-accent-color");let P=r.paint.get("hillshade-illumination-direction")*(Math.PI/180);return r.paint.get("hillshade-illumination-anchor")==="viewport"&&(P+=m.transform.bearingInRadians),{u_image:0,u_latrange:gn(0,e.tileID),u_light:[r.paint.get("hillshade-exaggeration"),P],u_shadow:l,u_highlight:u,u_accent:g}},Ln=(m,e)=>{const r=e.stride,l=s.K();return s.bN(l,0,s.Z,-8192,0,0,1),s.L(l,l,[0,-8192,0]),{u_matrix:l,u_image:1,u_dimension:[r,r],u_zoom:m.overscaledZ,u_unpack:e.getUnpackVector()}};function gn(m,e){const r=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new s.$(0,l/r).toLngLat().lat,new s.$(0,(l+1)/r).toLngLat().lat]}const En=(m,e,r,l)=>{const u=m.transform;return{u_translation:Eo(m,e,r),u_ratio:l/s.av(e,1,u.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},zs=(m,e,r,l,u)=>s.e(En(m,e,r,l),{u_image:0,u_image_height:u}),Ps=(m,e,r,l,u)=>{const g=m.transform,P=dl(e,g);return{u_translation:Eo(m,e,r),u_texsize:e.imageAtlasTexture.size,u_ratio:l/s.av(e,1,g.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[P,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},ic=(m,e,r,l,u,g)=>{const P=m.lineAtlas,I=dl(e,m.transform),E=r.layout.get("line-cap")==="round",D=P.getDash(u.from,E),q=P.getDash(u.to,E),$=D.width*g.fromScale,W=q.width*g.toScale;return s.e(En(m,e,r,l),{u_patternscale_a:[I/$,-D.height/2],u_patternscale_b:[I/W,-q.height/2],u_sdfgamma:P.width/(256*Math.min($,W)*m.pixelRatio)/2,u_image:0,u_tex_y_a:D.y,u_tex_y_b:q.y,u_mix:g.t})};function dl(m,e){return 1/s.av(m,1,e.tileZoom)}function Eo(m,e,r){return s.aw(m.transform,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const ko=(m,e,r,l,u)=>{return{u_tl_parent:m,u_scale_parent:e,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(P=l.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(g=l.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:pl(l.paint.get("raster-hue-rotate")),u_coords_top:[u[0].x,u[0].y,u[1].x,u[1].y],u_coords_bottom:[u[3].x,u[3].y,u[2].x,u[2].y]};var g,P};function pl(m){m*=Math.PI/180;const e=Math.sin(m),r=Math.cos(m);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}const uo=(m,e,r,l,u,g,P,I,E,D,q,$,W)=>{const ie=P.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:ie.cameraToCenterDistance,u_pitch:ie.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:ie.width/ie.height,u_fade_change:P.options.fadeDuration?P.symbolFadeChange:1,u_label_plane_matrix:I,u_coord_matrix:E,u_is_text:+q,u_pitch_with_map:+l,u_is_along_line:u,u_is_variable_anchor:g,u_texsize:$,u_texture:0,u_translation:D,u_pitched_scale:W}},ho=(m,e,r,l,u,g,P,I,E,D,q,$,W,ie)=>{const se=P.transform;return s.e(uo(m,e,r,l,u,g,P,I,E,D,q,$,ie),{u_gamma_scale:l?Math.cos(se.pitch*Math.PI/180)*se.cameraToCenterDistance:1,u_device_pixel_ratio:P.pixelRatio,u_is_halo:1})},pn=(m,e,r,l,u,g,P,I,E,D,q,$,W)=>s.e(ho(m,e,r,l,u,g,P,I,E,D,!0,q,0,W),{u_texsize_icon:$,u_texture_icon:1}),hs=(m,e)=>({u_opacity:m,u_color:e}),po=(m,e,r,l,u)=>s.e(function(g,P,I,E){const D=I.imageManager.getPattern(g.from.toString()),q=I.imageManager.getPattern(g.to.toString()),{width:$,height:W}=I.imageManager.getPixelSize(),ie=Math.pow(2,E.tileID.overscaledZ),se=E.tileSize*Math.pow(2,I.transform.tileZoom)/ie,Pe=se*(E.tileID.canonical.x+E.tileID.wrap*ie),be=se*E.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:q.tl,u_pattern_br_b:q.br,u_texsize:[$,W],u_mix:P.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:q.displaySize,u_scale_a:P.fromScale,u_scale_b:P.toScale,u_tile_units_to_pixels:1/s.av(E,1,I.transform.tileZoom),u_pixel_coord_upper:[Pe>>16,be>>16],u_pixel_coord_lower:[65535&Pe,65535&be]}}(r,u,e,l),{u_opacity:m}),Oa=(m,e)=>{},zo={fillExtrusion:(m,e)=>({u_lightpos:new s.bI(m,e.u_lightpos),u_lightpos_globe:new s.bI(m,e.u_lightpos_globe),u_lightintensity:new s.b7(m,e.u_lightintensity),u_lightcolor:new s.bI(m,e.u_lightcolor),u_vertical_gradient:new s.b7(m,e.u_vertical_gradient),u_opacity:new s.b7(m,e.u_opacity),u_fill_translate:new s.bJ(m,e.u_fill_translate)}),fillExtrusionPattern:(m,e)=>({u_lightpos:new s.bI(m,e.u_lightpos),u_lightpos_globe:new s.bI(m,e.u_lightpos_globe),u_lightintensity:new s.b7(m,e.u_lightintensity),u_lightcolor:new s.bI(m,e.u_lightcolor),u_vertical_gradient:new s.b7(m,e.u_vertical_gradient),u_height_factor:new s.b7(m,e.u_height_factor),u_opacity:new s.b7(m,e.u_opacity),u_fill_translate:new s.bJ(m,e.u_fill_translate),u_image:new s.bE(m,e.u_image),u_texsize:new s.bJ(m,e.u_texsize),u_pixel_coord_upper:new s.bJ(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new s.bJ(m,e.u_pixel_coord_lower),u_scale:new s.bI(m,e.u_scale),u_fade:new s.b7(m,e.u_fade)}),fill:(m,e)=>({u_fill_translate:new s.bJ(m,e.u_fill_translate)}),fillPattern:(m,e)=>({u_image:new s.bE(m,e.u_image),u_texsize:new s.bJ(m,e.u_texsize),u_pixel_coord_upper:new s.bJ(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new s.bJ(m,e.u_pixel_coord_lower),u_scale:new s.bI(m,e.u_scale),u_fade:new s.b7(m,e.u_fade),u_fill_translate:new s.bJ(m,e.u_fill_translate)}),fillOutline:(m,e)=>({u_world:new s.bJ(m,e.u_world),u_fill_translate:new s.bJ(m,e.u_fill_translate)}),fillOutlinePattern:(m,e)=>({u_world:new s.bJ(m,e.u_world),u_image:new s.bE(m,e.u_image),u_texsize:new s.bJ(m,e.u_texsize),u_pixel_coord_upper:new s.bJ(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new s.bJ(m,e.u_pixel_coord_lower),u_scale:new s.bI(m,e.u_scale),u_fade:new s.b7(m,e.u_fade),u_fill_translate:new s.bJ(m,e.u_fill_translate)}),circle:(m,e)=>({u_camera_to_center_distance:new s.b7(m,e.u_camera_to_center_distance),u_scale_with_map:new s.bE(m,e.u_scale_with_map),u_pitch_with_map:new s.bE(m,e.u_pitch_with_map),u_extrude_scale:new s.bJ(m,e.u_extrude_scale),u_device_pixel_ratio:new s.b7(m,e.u_device_pixel_ratio),u_globe_extrude_scale:new s.b7(m,e.u_globe_extrude_scale),u_translate:new s.bJ(m,e.u_translate)}),collisionBox:(m,e)=>({u_pixel_extrude_scale:new s.bJ(m,e.u_pixel_extrude_scale)}),collisionCircle:(m,e)=>({u_viewport_size:new s.bJ(m,e.u_viewport_size)}),debug:(m,e)=>({u_color:new s.bF(m,e.u_color),u_overlay:new s.bE(m,e.u_overlay),u_overlay_scale:new s.b7(m,e.u_overlay_scale)}),depth:Oa,clippingMask:Oa,heatmap:(m,e)=>({u_extrude_scale:new s.b7(m,e.u_extrude_scale),u_intensity:new s.b7(m,e.u_intensity),u_globe_extrude_scale:new s.b7(m,e.u_globe_extrude_scale)}),heatmapTexture:(m,e)=>({u_matrix:new s.bG(m,e.u_matrix),u_world:new s.bJ(m,e.u_world),u_image:new s.bE(m,e.u_image),u_color_ramp:new s.bE(m,e.u_color_ramp),u_opacity:new s.b7(m,e.u_opacity)}),hillshade:(m,e)=>({u_image:new s.bE(m,e.u_image),u_latrange:new s.bJ(m,e.u_latrange),u_light:new s.bJ(m,e.u_light),u_shadow:new s.bF(m,e.u_shadow),u_highlight:new s.bF(m,e.u_highlight),u_accent:new s.bF(m,e.u_accent)}),hillshadePrepare:(m,e)=>({u_matrix:new s.bG(m,e.u_matrix),u_image:new s.bE(m,e.u_image),u_dimension:new s.bJ(m,e.u_dimension),u_zoom:new s.b7(m,e.u_zoom),u_unpack:new s.bH(m,e.u_unpack)}),line:(m,e)=>({u_translation:new s.bJ(m,e.u_translation),u_ratio:new s.b7(m,e.u_ratio),u_device_pixel_ratio:new s.b7(m,e.u_device_pixel_ratio),u_units_to_pixels:new s.bJ(m,e.u_units_to_pixels)}),lineGradient:(m,e)=>({u_translation:new s.bJ(m,e.u_translation),u_ratio:new s.b7(m,e.u_ratio),u_device_pixel_ratio:new s.b7(m,e.u_device_pixel_ratio),u_units_to_pixels:new s.bJ(m,e.u_units_to_pixels),u_image:new s.bE(m,e.u_image),u_image_height:new s.b7(m,e.u_image_height)}),linePattern:(m,e)=>({u_translation:new s.bJ(m,e.u_translation),u_texsize:new s.bJ(m,e.u_texsize),u_ratio:new s.b7(m,e.u_ratio),u_device_pixel_ratio:new s.b7(m,e.u_device_pixel_ratio),u_image:new s.bE(m,e.u_image),u_units_to_pixels:new s.bJ(m,e.u_units_to_pixels),u_scale:new s.bI(m,e.u_scale),u_fade:new s.b7(m,e.u_fade)}),lineSDF:(m,e)=>({u_translation:new s.bJ(m,e.u_translation),u_ratio:new s.b7(m,e.u_ratio),u_device_pixel_ratio:new s.b7(m,e.u_device_pixel_ratio),u_units_to_pixels:new s.bJ(m,e.u_units_to_pixels),u_patternscale_a:new s.bJ(m,e.u_patternscale_a),u_patternscale_b:new s.bJ(m,e.u_patternscale_b),u_sdfgamma:new s.b7(m,e.u_sdfgamma),u_image:new s.bE(m,e.u_image),u_tex_y_a:new s.b7(m,e.u_tex_y_a),u_tex_y_b:new s.b7(m,e.u_tex_y_b),u_mix:new s.b7(m,e.u_mix)}),raster:(m,e)=>({u_tl_parent:new s.bJ(m,e.u_tl_parent),u_scale_parent:new s.b7(m,e.u_scale_parent),u_buffer_scale:new s.b7(m,e.u_buffer_scale),u_fade_t:new s.b7(m,e.u_fade_t),u_opacity:new s.b7(m,e.u_opacity),u_image0:new s.bE(m,e.u_image0),u_image1:new s.bE(m,e.u_image1),u_brightness_low:new s.b7(m,e.u_brightness_low),u_brightness_high:new s.b7(m,e.u_brightness_high),u_saturation_factor:new s.b7(m,e.u_saturation_factor),u_contrast_factor:new s.b7(m,e.u_contrast_factor),u_spin_weights:new s.bI(m,e.u_spin_weights),u_coords_top:new s.bH(m,e.u_coords_top),u_coords_bottom:new s.bH(m,e.u_coords_bottom)}),symbolIcon:(m,e)=>({u_is_size_zoom_constant:new s.bE(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bE(m,e.u_is_size_feature_constant),u_size_t:new s.b7(m,e.u_size_t),u_size:new s.b7(m,e.u_size),u_camera_to_center_distance:new s.b7(m,e.u_camera_to_center_distance),u_pitch:new s.b7(m,e.u_pitch),u_rotate_symbol:new s.bE(m,e.u_rotate_symbol),u_aspect_ratio:new s.b7(m,e.u_aspect_ratio),u_fade_change:new s.b7(m,e.u_fade_change),u_label_plane_matrix:new s.bG(m,e.u_label_plane_matrix),u_coord_matrix:new s.bG(m,e.u_coord_matrix),u_is_text:new s.bE(m,e.u_is_text),u_pitch_with_map:new s.bE(m,e.u_pitch_with_map),u_is_along_line:new s.bE(m,e.u_is_along_line),u_is_variable_anchor:new s.bE(m,e.u_is_variable_anchor),u_texsize:new s.bJ(m,e.u_texsize),u_texture:new s.bE(m,e.u_texture),u_translation:new s.bJ(m,e.u_translation),u_pitched_scale:new s.b7(m,e.u_pitched_scale)}),symbolSDF:(m,e)=>({u_is_size_zoom_constant:new s.bE(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bE(m,e.u_is_size_feature_constant),u_size_t:new s.b7(m,e.u_size_t),u_size:new s.b7(m,e.u_size),u_camera_to_center_distance:new s.b7(m,e.u_camera_to_center_distance),u_pitch:new s.b7(m,e.u_pitch),u_rotate_symbol:new s.bE(m,e.u_rotate_symbol),u_aspect_ratio:new s.b7(m,e.u_aspect_ratio),u_fade_change:new s.b7(m,e.u_fade_change),u_label_plane_matrix:new s.bG(m,e.u_label_plane_matrix),u_coord_matrix:new s.bG(m,e.u_coord_matrix),u_is_text:new s.bE(m,e.u_is_text),u_pitch_with_map:new s.bE(m,e.u_pitch_with_map),u_is_along_line:new s.bE(m,e.u_is_along_line),u_is_variable_anchor:new s.bE(m,e.u_is_variable_anchor),u_texsize:new s.bJ(m,e.u_texsize),u_texture:new s.bE(m,e.u_texture),u_gamma_scale:new s.b7(m,e.u_gamma_scale),u_device_pixel_ratio:new s.b7(m,e.u_device_pixel_ratio),u_is_halo:new s.bE(m,e.u_is_halo),u_translation:new s.bJ(m,e.u_translation),u_pitched_scale:new s.b7(m,e.u_pitched_scale)}),symbolTextAndIcon:(m,e)=>({u_is_size_zoom_constant:new s.bE(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bE(m,e.u_is_size_feature_constant),u_size_t:new s.b7(m,e.u_size_t),u_size:new s.b7(m,e.u_size),u_camera_to_center_distance:new s.b7(m,e.u_camera_to_center_distance),u_pitch:new s.b7(m,e.u_pitch),u_rotate_symbol:new s.bE(m,e.u_rotate_symbol),u_aspect_ratio:new s.b7(m,e.u_aspect_ratio),u_fade_change:new s.b7(m,e.u_fade_change),u_label_plane_matrix:new s.bG(m,e.u_label_plane_matrix),u_coord_matrix:new s.bG(m,e.u_coord_matrix),u_is_text:new s.bE(m,e.u_is_text),u_pitch_with_map:new s.bE(m,e.u_pitch_with_map),u_is_along_line:new s.bE(m,e.u_is_along_line),u_is_variable_anchor:new s.bE(m,e.u_is_variable_anchor),u_texsize:new s.bJ(m,e.u_texsize),u_texsize_icon:new s.bJ(m,e.u_texsize_icon),u_texture:new s.bE(m,e.u_texture),u_texture_icon:new s.bE(m,e.u_texture_icon),u_gamma_scale:new s.b7(m,e.u_gamma_scale),u_device_pixel_ratio:new s.b7(m,e.u_device_pixel_ratio),u_is_halo:new s.bE(m,e.u_is_halo),u_translation:new s.bJ(m,e.u_translation),u_pitched_scale:new s.b7(m,e.u_pitched_scale)}),background:(m,e)=>({u_opacity:new s.b7(m,e.u_opacity),u_color:new s.bF(m,e.u_color)}),backgroundPattern:(m,e)=>({u_opacity:new s.b7(m,e.u_opacity),u_image:new s.bE(m,e.u_image),u_pattern_tl_a:new s.bJ(m,e.u_pattern_tl_a),u_pattern_br_a:new s.bJ(m,e.u_pattern_br_a),u_pattern_tl_b:new s.bJ(m,e.u_pattern_tl_b),u_pattern_br_b:new s.bJ(m,e.u_pattern_br_b),u_texsize:new s.bJ(m,e.u_texsize),u_mix:new s.b7(m,e.u_mix),u_pattern_size_a:new s.bJ(m,e.u_pattern_size_a),u_pattern_size_b:new s.bJ(m,e.u_pattern_size_b),u_scale_a:new s.b7(m,e.u_scale_a),u_scale_b:new s.b7(m,e.u_scale_b),u_pixel_coord_upper:new s.bJ(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new s.bJ(m,e.u_pixel_coord_lower),u_tile_units_to_pixels:new s.b7(m,e.u_tile_units_to_pixels)}),terrain:(m,e)=>({u_texture:new s.bE(m,e.u_texture),u_ele_delta:new s.b7(m,e.u_ele_delta),u_fog_matrix:new s.bG(m,e.u_fog_matrix),u_fog_color:new s.bF(m,e.u_fog_color),u_fog_ground_blend:new s.b7(m,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new s.b7(m,e.u_fog_ground_blend_opacity),u_horizon_color:new s.bF(m,e.u_horizon_color),u_horizon_fog_blend:new s.b7(m,e.u_horizon_fog_blend),u_is_globe_mode:new s.b7(m,e.u_is_globe_mode)}),terrainDepth:(m,e)=>({u_ele_delta:new s.b7(m,e.u_ele_delta)}),terrainCoords:(m,e)=>({u_texture:new s.bE(m,e.u_texture),u_terrain_coords_id:new s.b7(m,e.u_terrain_coords_id),u_ele_delta:new s.b7(m,e.u_ele_delta)}),projectionErrorMeasurement:(m,e)=>({u_input:new s.b7(m,e.u_input),u_output_expected:new s.b7(m,e.u_output_expected)}),atmosphere:(m,e)=>({u_sun_pos:new s.bI(m,e.u_sun_pos),u_atmosphere_blend:new s.b7(m,e.u_atmosphere_blend),u_globe_position:new s.bI(m,e.u_globe_position),u_globe_radius:new s.b7(m,e.u_globe_radius),u_inv_proj_matrix:new s.bG(m,e.u_inv_proj_matrix)}),sky:(m,e)=>({u_sky_color:new s.bF(m,e.u_sky_color),u_horizon_color:new s.bF(m,e.u_horizon_color),u_horizon:new s.bJ(m,e.u_horizon),u_horizon_normal:new s.bJ(m,e.u_horizon_normal),u_sky_horizon_blend:new s.b7(m,e.u_sky_horizon_blend),u_sky_blend:new s.b7(m,e.u_sky_blend)})};class Yn{constructor(e,r,l){this.context=e;const u=e.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Rl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ta{constructor(e,r,l,u){this.length=r.length,this.attributes=l,this.itemSize=r.bytesPerElement,this.dynamicDraw=u,this.context=e;const g=e.gl;this.buffer=g.createBuffer(),e.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,r){for(let l=0;l<this.attributes.length;l++){const u=r.attributes[this.attributes[l].name];u!==void 0&&e.enableVertexAttribArray(u)}}setVertexAttribPointers(e,r,l){for(let u=0;u<this.attributes.length;u++){const g=this.attributes[u],P=r.attributes[g.name];P!==void 0&&e.vertexAttribPointer(P,g.components,e[Rl[g.type]],!1,this.itemSize,g.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ii{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ds extends ii{getDefault(){return s.b6.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class fl extends ii{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class nc extends ii{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class sc extends ii{getDefault(){return[!0,!0,!0,!0]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ja extends ii{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Do extends ii{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Kn extends ii{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const r=this.current;(e.func!==r.func||e.ref!==r.ref||e.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class An extends ii{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class ra extends ii{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=e,this.dirty=!1}}class Fs extends ii{getDefault(){return[0,1]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ia extends ii{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=e,this.dirty=!1}}class Ns extends ii{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class ds extends ii{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.BLEND):r.disable(r.BLEND),this.current=e,this.dirty=!1}}class pi extends ii{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class ml extends ii{getDefault(){return s.b6.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Un extends ii{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ps extends ii{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=e,this.dirty=!1}}class Rs extends ii{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Fo extends ii{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class fo extends ii{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class na extends ii{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class ba extends ii{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class qa extends ii{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Bs extends ii{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class sa extends ii{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class mo extends ii{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class xa extends ii{getDefault(){return null}set(e){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Kr extends ii{getDefault(){return null}set(e){var r;if(e===this.current&&!this.dirty)return;const l=this.gl;Pn(l)?l.bindVertexArray(e):(r=l.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Jn extends ii{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Os extends ii{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Si extends ii{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class fi extends ii{constructor(e,r){super(e),this.context=e,this.parent=r}getDefault(){return null}}class rn extends fi{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class _n extends fi{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class wa extends fi{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const gl="Framebuffer is not complete";class go{constructor(e,r,l,u,g){this.context=e,this.width=r,this.height=l;const P=e.gl,I=this.framebuffer=P.createFramebuffer();if(this.colorAttachment=new rn(e,I),u)this.depthAttachment=g?new wa(e,I):new _n(e,I);else if(g)throw new Error("Stencil cannot be set without depth");if(P.checkFramebufferStatus(P.FRAMEBUFFER)!==P.FRAMEBUFFER_COMPLETE)throw new Error(gl)}destroy(){const e=this.context.gl,r=this.colorAttachment.get();if(r&&e.deleteTexture(r),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class No{constructor(e){var r,l;if(this.gl=e,this.clearColor=new Ds(this),this.clearDepth=new fl(this),this.clearStencil=new nc(this),this.colorMask=new sc(this),this.depthMask=new ja(this),this.stencilMask=new Do(this),this.stencilFunc=new Kn(this),this.stencilOp=new An(this),this.stencilTest=new ra(this),this.depthRange=new Fs(this),this.depthTest=new ia(this),this.depthFunc=new Ns(this),this.blend=new ds(this),this.blendFunc=new pi(this),this.blendColor=new ml(this),this.blendEquation=new Un(this),this.cullFace=new ps(this),this.cullFaceSide=new Rs(this),this.frontFace=new Fo(this),this.program=new fo(this),this.activeTexture=new na(this),this.viewport=new ba(this),this.bindFramebuffer=new qa(this),this.bindRenderbuffer=new Bs(this),this.bindTexture=new sa(this),this.bindVertexBuffer=new mo(this),this.bindElementBuffer=new xa(this),this.bindVertexArray=new Kr(this),this.pixelStoreUnpack=new Jn(this),this.pixelStoreUnpackPremultiplyAlpha=new Os(this),this.pixelStoreUnpackFlipY=new Si(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Pn(e)){this.HALF_FLOAT=e.HALF_FLOAT;const u=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=e.RGBA16F)!==null&&r!==void 0?r:u==null?void 0:u.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:u==null?void 0:u.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const u=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=u==null?void 0:u.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,r){return new Yn(this,e,r)}createVertexBuffer(e,r,l){return new ta(this,e,r,l)}createRenderbuffer(e,r,l){const u=this.gl,g=u.createRenderbuffer();return this.bindRenderbuffer.set(g),u.renderbufferStorage(u.RENDERBUFFER,e,r,l),this.bindRenderbuffer.set(null),g}createFramebuffer(e,r,l,u){return new go(this,e,r,l,u)}clear({color:e,depth:r,stencil:l}){const u=this.gl;let g=0;e&&(g|=u.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(g|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),l!==void 0&&(g|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),u.clear(g)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){s.bB(e.blendFunction,wi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Pn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var r;return Pn(this.gl)?this.gl.deleteVertexArray(e):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let Va;function Ro(m,e,r,l,u){const g=m.context,P=m.transform,I=g.gl,E=m.useProgram("collisionBox"),D=[];let q=0,$=0;for(let Se=0;Se<l.length;Se++){const Ee=l[Se],Ze=e.getTile(Ee).getBucket(r);if(!Ze)continue;const Ge=u?Ze.textCollisionBox:Ze.iconCollisionBox,Xe=Ze.collisionCircleArray;Xe.length>0&&(D.push({circleArray:Xe,circleOffset:$,coord:Ee}),q+=Xe.length/4,$=q),Ge&&E.draw(g,I.LINES,Nr.disabled,ti.disabled,m.colorModeForRenderPass(),Wr.disabled,Or(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(Ee),P.getProjectionData({overscaledTileID:Ee,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,null,m.transform.zoom,null,null,Ge.collisionVertexBuffer)}if(!u||!D.length)return;const W=m.useProgram("collisionCircle"),ie=new s.bO;ie.resize(4*q),ie._trim();let se=0;for(const Se of D)for(let Ee=0;Ee<Se.circleArray.length/4;Ee++){const Ze=4*Ee,Ge=Se.circleArray[Ze+0],Xe=Se.circleArray[Ze+1],Je=Se.circleArray[Ze+2],Ye=Se.circleArray[Ze+3];ie.emplace(se++,Ge,Xe,Je,Ye,0),ie.emplace(se++,Ge,Xe,Je,Ye,1),ie.emplace(se++,Ge,Xe,Je,Ye,2),ie.emplace(se++,Ge,Xe,Je,Ye,3)}(!Va||Va.length<2*q)&&(Va=function(Se){const Ee=2*Se,Ze=new s.bQ;Ze.resize(Ee),Ze._trim();for(let Ge=0;Ge<Ee;Ge++){const Xe=6*Ge;Ze.uint16[Xe+0]=4*Ge+0,Ze.uint16[Xe+1]=4*Ge+1,Ze.uint16[Xe+2]=4*Ge+2,Ze.uint16[Xe+3]=4*Ge+2,Ze.uint16[Xe+4]=4*Ge+3,Ze.uint16[Xe+5]=4*Ge+0}return Ze}(q));const Pe=g.createIndexBuffer(Va,!0),be=g.createVertexBuffer(ie,s.bP.members,!0);for(const Se of D){const Ee=jr(m.transform);W.draw(g,I.TRIANGLES,Nr.disabled,ti.disabled,m.colorModeForRenderPass(),Wr.disabled,Ee,m.style.map.terrain&&m.style.map.terrain.getTerrainData(Se.coord),null,r.id,be,Pe,s.aF.simpleSegment(0,2*Se.circleOffset,Se.circleArray.length,Se.circleArray.length/2),null,m.transform.zoom,null,null,null)}be.destroy(),Pe.destroy()}const Qn=s.as(new Float32Array(16));function Ss(m,e,r,l,u,g){const{horizontalAlign:P,verticalAlign:I}=s.aA(m);return new s.P((-(P-.5)*e/u+l[0])*g,(-(I-.5)*r/u+l[1])*g)}function Bo(m,e,r,l,u,g){const P=e.tileAnchorPoint.add(new s.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let I=l.mult(g);r||(I=I.rotate(-u));const E=P.add(I);return we(E.x,E.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(r){const I=Zt(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(m),E=Math.atan(I.y/I.x)+(I.x<0?Math.PI:0);return m.add(l.rotate(E))}return m.add(l)}function Oo(m,e,r,l,u,g,P,I,E,D,q,$){const W=m.text.placedSymbolArray,ie=m.text.dynamicLayoutVertexArray,se=m.icon.dynamicLayoutVertexArray,Pe={};ie.clear();for(let be=0;be<W.length;be++){const Se=W.get(be),Ee=Se.hidden||!Se.crossTileID||m.allowVerticalPlacement&&!Se.placedOrientation?null:l[Se.crossTileID];if(Ee){const Ze=new s.P(Se.anchorX,Se.anchorY),Ge={getElevation:$,width:u.width,height:u.height,pitchedLabelPlaneMatrix:g,pitchWithMap:r,transform:u,tileAnchorPoint:Ze,translation:D,unwrappedTileID:q},Xe=r?Pr(Ze.x,Ze.y,Ge):Zt(Ze.x,Ze.y,Ge),Je=ze(u.cameraToCenterDistance,Xe.signedDistanceFromCamera);let Ye=s.ah(m.textSizeData,I,Se)*Je/s.au;r&&(Ye*=m.tilePixelRatio/P);const{width:vt,height:bt,anchor:Mt,textOffset:Lt,textBoxScale:It}=Ee,tr=Ss(Mt,vt,bt,Lt,It,Ye),Kt=u.getPitchedTextCorrection(Ze.x+D[0],Ze.y+D[1],q),Bt=Bo(Xe.point,Ge,e,tr,-u.bearingInRadians,Kt),gr=m.allowVerticalPlacement&&Se.placedOrientation===s.ag.vertical?Math.PI/2:0;for(let _r=0;_r<Se.numGlyphs;_r++)s.an(ie,Bt,gr);E&&Se.associatedIconIndex>=0&&(Pe[Se.associatedIconIndex]={shiftedAnchor:Bt,angle:gr})}else di(Se.numGlyphs,ie)}if(E){se.clear();const be=m.icon.placedSymbolArray;for(let Se=0;Se<be.length;Se++){const Ee=be.get(Se);if(Ee.hidden)di(Ee.numGlyphs,se);else{const Ze=Pe[Se];if(Ze)for(let Ge=0;Ge<Ee.numGlyphs;Ge++)s.an(se,Ze.shiftedAnchor,Ze.angle);else di(Ee.numGlyphs,se)}}m.icon.dynamicLayoutVertexBuffer.updateData(se)}m.text.dynamicLayoutVertexBuffer.updateData(ie)}function ac(m,e,r){return r.iconsInText&&e?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Bl(m,e,r,l,u,g,P,I,E,D,q,$,W){const ie=m.context,se=ie.gl,Pe=m.transform,be=I==="map",Se=E==="map",Ee=I!=="viewport"&&r.layout.get("symbol-placement")!=="point",Ze=be&&!Se&&!Ee,Ge=!r.layout.get("symbol-sort-key").isConstant();let Xe=!1;const Je=m.getDepthModeForSublayer(0,Nr.ReadOnly),Ye=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),vt=[],bt=Pe.getCircleRadiusCorrection();for(const Mt of l){const Lt=e.getTile(Mt),It=Lt.getBucket(r);if(!It)continue;const tr=u?It.text:It.icon;if(!tr||!tr.segments.get().length||!tr.hasVisibleVertices)continue;const Kt=tr.programConfigurations.get(r.id),Bt=u||It.sdfIcons,gr=u?It.textSizeData:It.iconSizeData,_r=Se||Pe.pitch!==0,oi=m.useProgram(ac(Bt,u,It),Kt),Pi=s.af(gr,Pe.zoom),bi=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Mt);let Mi,_i,hi,vi,Tn=[0,0],vn=null;if(u)_i=Lt.glyphAtlasTexture,hi=se.LINEAR,Mi=Lt.glyphAtlasTexture.size,It.iconsInText&&(Tn=Lt.imageAtlasTexture.size,vn=Lt.imageAtlasTexture,vi=_r||m.options.rotating||m.options.zooming||gr.kind==="composite"||gr.kind==="camera"?se.LINEAR:se.NEAREST);else{const Ni=r.layout.get("icon-size").constantOr(0)!==1||It.iconsNeedLinear;_i=Lt.imageAtlasTexture,hi=Bt||m.options.rotating||m.options.zooming||Ni||_r?se.LINEAR:se.NEAREST,Mi=Lt.imageAtlasTexture.size}const bn=s.av(Lt,1,m.transform.zoom),sn=Te(be,m.transform,bn),Ta=s.K();s.ai(Ta,sn);const Vs=ue(Se,be,m.transform,bn),In=s.aw(Pe,Lt,g,P),xn=Pe.getProjectionData({overscaledTileID:Mt,applyGlobeMatrix:!W,applyTerrainMatrix:!0}),ms=Ye&&It.hasTextData(),bo=r.layout.get("icon-text-fit")!=="none"&&ms&&It.hasIconData();if(Ee){const Ni=m.style.map.terrain?(zn,Dn)=>m.style.map.terrain.getElevation(Mt,zn,Dn):null,Li=r.layout.get("text-rotation-alignment")==="map";je(It,m,u,sn,Ta,Se,D,Li,Mt.toUnwrapped(),Pe.width,Pe.height,In,Ni)}const $a=u&&Ye||bo,Is=Ee||$a?Qn:Se?sn:m.transform.clipSpaceToPixelsMatrix,Ia=Bt&&r.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Cs;Cs=Bt?It.iconsInText?pn(gr.kind,Pi,Ze,Se,Ee,$a,m,Is,Vs,In,Mi,Tn,bt):ho(gr.kind,Pi,Ze,Se,Ee,$a,m,Is,Vs,In,u,Mi,0,bt):uo(gr.kind,Pi,Ze,Se,Ee,$a,m,Is,Vs,In,u,Mi,bt);const Us={program:oi,buffers:tr,uniformValues:Cs,projectionData:xn,atlasTexture:_i,atlasTextureIcon:vn,atlasInterpolation:hi,atlasInterpolationIcon:vi,isSDF:Bt,hasHalo:Ia};if(Ge&&It.canOverlap){Xe=!0;const Ni=tr.segments.get();for(const Li of Ni)vt.push({segments:new s.aF([Li]),sortKey:Li.sortKey,state:Us,terrainData:bi})}else vt.push({segments:tr.segments,sortKey:0,state:Us,terrainData:bi})}Xe&&vt.sort((Mt,Lt)=>Mt.sortKey-Lt.sortKey);for(const Mt of vt){const Lt=Mt.state;if(ie.activeTexture.set(se.TEXTURE0),Lt.atlasTexture.bind(Lt.atlasInterpolation,se.CLAMP_TO_EDGE),Lt.atlasTextureIcon&&(ie.activeTexture.set(se.TEXTURE1),Lt.atlasTextureIcon&&Lt.atlasTextureIcon.bind(Lt.atlasInterpolationIcon,se.CLAMP_TO_EDGE)),Lt.isSDF){const It=Lt.uniformValues;Lt.hasHalo&&(It.u_is_halo=1,jo(Lt.buffers,Mt.segments,r,m,Lt.program,Je,q,$,It,Lt.projectionData,Mt.terrainData)),It.u_is_halo=0}jo(Lt.buffers,Mt.segments,r,m,Lt.program,Je,q,$,Lt.uniformValues,Lt.projectionData,Mt.terrainData)}}function jo(m,e,r,l,u,g,P,I,E,D,q){const $=l.context;u.draw($,$.gl.TRIANGLES,g,P,I,Wr.backCCW,E,q,D,r.id,m.layoutVertexBuffer,m.indexBuffer,e,r.paint,l.transform.zoom,m.programConfigurations.get(r.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Ic(m,e,r,l,u){const g=m.context,P=g.gl,I=ti.disabled,E=new wi([P.ONE,P.ONE],s.b6.transparent,[!0,!0,!0,!0]),D=e.getBucket(r);if(!D)return;const q=l.key;let $=r.heatmapFbos.get(q);$||($=qo(g,e.tileSize,e.tileSize),r.heatmapFbos.set(q,$)),g.bindFramebuffer.set($.framebuffer),g.viewport.set([0,0,e.tileSize,e.tileSize]),g.clear({color:s.b6.transparent});const W=D.programConfigurations.get(r.id),ie=m.useProgram("heatmap",W,!u),se=m.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Pe=m.style.map.terrain.getTerrainData(l);ie.draw(g,P.TRIANGLES,Nr.disabled,I,E,Wr.disabled,Di(e,m.transform.zoom,r.paint.get("heatmap-intensity"),1),Pe,se,r.id,D.layoutVertexBuffer,D.indexBuffer,D.segments,r.paint,m.transform.zoom,W)}function Cc(m,e,r,l,u){const g=m.context,P=g.gl,I=m.transform;g.setColorMode(m.colorModeForRenderPass());const E=_l(g,e),D=r.key,q=e.heatmapFbos.get(D);if(!q)return;g.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,q.colorAttachment.get()),g.activeTexture.set(P.TEXTURE1),E.bind(P.LINEAR,P.CLAMP_TO_EDGE);const $=I.getProjectionData({overscaledTileID:r,applyTerrainMatrix:u,applyGlobeMatrix:!l});m.useProgram("heatmapTexture").draw(g,P.TRIANGLES,Nr.disabled,ti.disabled,m.colorModeForRenderPass(),Wr.disabled,Xi(m,e,0,1),null,$,e.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,e.paint,I.zoom),q.destroy(),e.heatmapFbos.delete(D)}function qo(m,e,r){var l,u;const g=m.gl,P=g.createTexture();g.bindTexture(g.TEXTURE_2D,P),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);const I=(l=m.HALF_FLOAT)!==null&&l!==void 0?l:g.UNSIGNED_BYTE,E=(u=m.RGBA16F)!==null&&u!==void 0?u:g.RGBA;g.texImage2D(g.TEXTURE_2D,0,E,e,r,0,g.RGBA,I,null);const D=m.createFramebuffer(e,r,!1,!1);return D.colorAttachment.set(P),D}function _l(m,e){return e.colorRampTexture||(e.colorRampTexture=new Ae(m,e.colorRamp,m.gl.RGBA)),e.colorRampTexture}function yl(m,e,r,l,u){if(!r||!l||!l.imageAtlas)return;const g=l.imageAtlas.patternPositions;let P=g[r.to.toString()],I=g[r.from.toString()];if(!P&&I&&(P=I),!I&&P&&(I=P),!P||!I){const E=u.getPaintProperty(e);P=g[E],I=g[E]}P&&I&&m.setConstantPatternPositions(P,I)}function Ol(m,e,r,l,u,g,P,I){const E=m.context.gl,D="fill-pattern",q=r.paint.get(D),$=q&&q.constantOr(1),W=r.getCrossfadeParameters();let ie,se,Pe,be,Se;const Ee=m.transform,Ze=r.paint.get("fill-translate"),Ge=r.paint.get("fill-translate-anchor");P?(se=$&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ie=E.LINES):(se=$?"fillPattern":"fill",ie=E.TRIANGLES);const Xe=q.constantOr(null);for(const Je of l){const Ye=e.getTile(Je);if($&&!Ye.patternsLoaded())continue;const vt=Ye.getBucket(r);if(!vt)continue;const bt=vt.programConfigurations.get(r.id),Mt=m.useProgram(se,bt),Lt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Je);$&&(m.context.activeTexture.set(E.TEXTURE0),Ye.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),bt.updatePaintBuffers(W)),yl(bt,D,Xe,Ye,r);const It=Ee.getProjectionData({overscaledTileID:Je,applyGlobeMatrix:!I,applyTerrainMatrix:!0}),tr=s.aw(Ee,Ye,Ze,Ge);if(P){be=vt.indexBuffer2,Se=vt.segments2;const Bt=[E.drawingBufferWidth,E.drawingBufferHeight];Pe=se==="fillOutlinePattern"&&$?mr(m,W,Ye,Bt,tr):Yt(Bt,tr)}else be=vt.indexBuffer,Se=vt.segments,Pe=$?Rt(m,W,Ye,tr):{u_fill_translate:tr};let Kt;if(m.renderPass==="translucent"&&I){const[Bt]=m.getStencilConfigForOverlapAndUpdateStencilID(l);Kt=Bt[Je.overscaledZ]}else Kt=m.stencilModeForClipping(Je);Mt.draw(m.context,ie,u,Kt,g,Wr.backCCW,Pe,Lt,It,r.id,vt.layoutVertexBuffer,be,Se,r.paint,m.transform.zoom,bt)}}function vl(m,e,r,l,u,g,P,I){const E=m.context,D=E.gl,q="fill-extrusion-pattern",$=r.paint.get(q),W=$.constantOr(1),ie=r.getCrossfadeParameters(),se=r.paint.get("fill-extrusion-opacity"),Pe=$.constantOr(null),be=m.transform;for(const Se of l){const Ee=e.getTile(Se),Ze=Ee.getBucket(r);if(!Ze)continue;const Ge=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Se),Xe=Ze.programConfigurations.get(r.id),Je=m.useProgram(W?"fillExtrusionPattern":"fillExtrusion",Xe);W&&(m.context.activeTexture.set(D.TEXTURE0),Ee.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Xe.updatePaintBuffers(ie));const Ye=be.getProjectionData({overscaledTileID:Se,applyGlobeMatrix:!I,applyTerrainMatrix:!0});yl(Xe,q,Pe,Ee,r);const vt=s.aw(be,Ee,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),bt=r.paint.get("fill-extrusion-vertical-gradient"),Mt=W?dt(m,bt,se,vt,Se,ie,Ee):tt(m,bt,se,vt);Je.draw(E,E.gl.TRIANGLES,u,g,P,Wr.backCCW,Mt,Ge,Ye,r.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,r.paint,m.transform.zoom,Xe,m.style.map.terrain&&Ze.centroidVertexBuffer)}}function jl(m,e,r,l,u,g,P,I,E){var D;const q=m.style.projection,$=m.context,W=m.transform,ie=$.gl,se=m.useProgram("hillshade"),Pe=!m.options.moving;for(const be of l){const Se=e.getTile(be),Ee=Se.fbo;if(!Ee)continue;const Ze=q.getMeshFromTileID($,be.canonical,I,!0,"raster"),Ge=(D=m.style.map.terrain)===null||D===void 0?void 0:D.getTerrainData(be);$.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_2D,Ee.colorAttachment.get());const Xe=W.getProjectionData({overscaledTileID:be,aligned:Pe,applyGlobeMatrix:!E,applyTerrainMatrix:!0});se.draw($,ie.TRIANGLES,g,u[be.overscaledZ],P,Wr.backCCW,Ci(m,Se,r),Ge,Xe,r.id,Ze.vertexBuffer,Ze.indexBuffer,Ze.segments)}}const oc=[new s.P(0,0),new s.P(s.Z,0),new s.P(s.Z,s.Z),new s.P(0,s.Z)];function ql(m,e,r,l,u,g,P,I,E=!1,D=!1){const q=l[l.length-1].overscaledZ,$=m.context,W=$.gl,ie=m.useProgram("raster"),se=m.transform,Pe=m.style.projection,be=m.colorModeForRenderPass(),Se=!m.options.moving;for(const Ee of l){const Ze=m.getDepthModeForSublayer(Ee.overscaledZ-q,r.paint.get("raster-opacity")===1?Nr.ReadWrite:Nr.ReadOnly,W.LESS),Ge=e.getTile(Ee);Ge.registerFadeDuration(r.paint.get("raster-fade-duration"));const Xe=e.findLoadedParent(Ee,0),Je=e.findLoadedSibling(Ee),Ye=Ji(Ge,Xe||Je||null,e,r,m.transform,m.style.map.terrain);let vt,bt;const Mt=r.paint.get("raster-resampling")==="nearest"?W.NEAREST:W.LINEAR;$.activeTexture.set(W.TEXTURE0),Ge.texture.bind(Mt,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),$.activeTexture.set(W.TEXTURE1),Xe?(Xe.texture.bind(Mt,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),vt=Math.pow(2,Xe.tileID.overscaledZ-Ge.tileID.overscaledZ),bt=[Ge.tileID.canonical.x*vt%1,Ge.tileID.canonical.y*vt%1]):Ge.texture.bind(Mt,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),Ge.texture.useMipmap&&$.extTextureFilterAnisotropic&&m.transform.pitch>20&&W.texParameterf(W.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax);const Lt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Ee),It=se.getProjectionData({overscaledTileID:Ee,aligned:Se,applyGlobeMatrix:!D,applyTerrainMatrix:!0}),tr=ko(bt||[0,0],vt||1,Ye,r,I),Kt=Pe.getMeshFromTileID($,Ee.canonical,g,P,"raster");ie.draw($,W.TRIANGLES,Ze,u?u[Ee.overscaledZ]:ti.disabled,be,E?Wr.frontCCW:Wr.backCCW,tr,Lt,It,r.id,Kt.vertexBuffer,Kt.indexBuffer,Kt.segments)}}function Ji(m,e,r,l,u,g){const P=l.paint.get("raster-fade-duration");if(!g&&P>0){const I=J.now(),E=(I-m.timeAdded)/P,D=e?(I-e.timeAdded)/P:-1,q=r.getSource(),$=Bi(u,{tileSize:q.tileSize,roundZoom:q.roundZoom}),W=!e||Math.abs(e.tileID.overscaledZ-$)>Math.abs(m.tileID.overscaledZ-$),ie=W&&m.refreshedUponExpiration?1:s.ad(W?E:1-D,0,1);return m.refreshedUponExpiration&&E>=1&&(m.refreshedUponExpiration=!1),e?{opacity:1,mix:1-ie}:{opacity:ie,mix:0}}return{opacity:1,mix:0}}const Vo=new s.b6(1,0,0,1),js=new s.b6(0,1,0,1),Mc=new s.b6(0,0,1,1),Vl=new s.b6(1,0,1,1),lc=new s.b6(0,1,1,1);function aa(m,e,r,l){xl(m,0,e+r/2,m.transform.width,r,l)}function bl(m,e,r,l){xl(m,e-r/2,0,r,m.transform.height,l)}function xl(m,e,r,l,u,g){const P=m.context,I=P.gl;I.enable(I.SCISSOR_TEST),I.scissor(e*m.pixelRatio,r*m.pixelRatio,l*m.pixelRatio,u*m.pixelRatio),P.clear({color:g}),I.disable(I.SCISSOR_TEST)}function Lc(m,e,r){const l=m.context,u=l.gl,g=m.useProgram("debug"),P=Nr.disabled,I=ti.disabled,E=m.colorModeForRenderPass(),D="$debug",q=m.style.map.terrain&&m.style.map.terrain.getTerrainData(r);l.activeTexture.set(u.TEXTURE0);const $=e.getTileByID(r.key).latestRawTileData,W=Math.floor(($&&$.byteLength||0)/1024),ie=e.getTile(r).tileSize,se=512/Math.min(ie,512)*(r.overscaledZ/m.transform.zoom)*.5;let Pe=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(Pe+=` => ${r.overscaledZ}`),function(Se,Ee){Se.initDebugOverlayCanvas();const Ze=Se.debugOverlayCanvas,Ge=Se.context.gl,Xe=Se.debugOverlayCanvas.getContext("2d");Xe.clearRect(0,0,Ze.width,Ze.height),Xe.shadowColor="white",Xe.shadowBlur=2,Xe.lineWidth=1.5,Xe.strokeStyle="white",Xe.textBaseline="top",Xe.font="bold 36px Open Sans, sans-serif",Xe.fillText(Ee,5,5),Xe.strokeText(Ee,5,5),Se.debugOverlayTexture.update(Ze),Se.debugOverlayTexture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE)}(m,`${Pe} ${W}kB`);const be=m.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(l,u.TRIANGLES,P,I,wi.alphaBlended,Wr.disabled,ai(s.b6.transparent,se),null,be,D,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),g.draw(l,u.LINE_STRIP,P,I,E,Wr.disabled,ai(s.b6.red),q,be,D,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function Ec(m,e,r,l){const{isRenderingGlobe:u}=l,g=m.context,P=g.gl,I=m.transform,E=m.colorModeForRenderPass(),D=m.getDepthModeFor3D(),q=m.useProgram("terrain");g.bindFramebuffer.set(null),g.viewport.set([0,0,m.width,m.height]);for(const $ of r){const W=e.getTerrainMesh($.tileID),ie=m.renderToTexture.getTexture($),se=e.getTerrainData($.tileID);g.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,ie.texture);const Pe=e.getMeshFrameDelta(I.zoom),be=I.calculateFogMatrix($.tileID.toUnwrapped()),Se=va(Pe,be,m.style.sky,I.pitch,u),Ee=I.getProjectionData({overscaledTileID:$.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});q.draw(g,P.TRIANGLES,D,ti.disabled,E,Wr.backCCW,Se,se,Ee,"terrain",W.vertexBuffer,W.indexBuffer,W.segments)}}function kc(m,e){if(!e.mesh){const r=new s.aE;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const l=new s.aG;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),e.mesh=new qn(m.createVertexBuffer(r,os.members),m.createIndexBuffer(l),s.aF.simpleSegment(0,0,r.length,l.length))}return e.mesh}class Xc{constructor(e,r){this.context=new No(e),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.as(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=x.maxUnderzooming+x.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ws}resize(e,r,l){if(this.width=Math.floor(e*l),this.height=Math.floor(r*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const e=this.context,r=new s.aE;r.emplaceBack(0,0),r.emplaceBack(s.Z,0),r.emplaceBack(0,s.Z),r.emplaceBack(s.Z,s.Z),this.tileExtentBuffer=e.createVertexBuffer(r,os.members),this.tileExtentSegments=s.aF.simpleSegment(0,0,4,2);const l=new s.aE;l.emplaceBack(0,0),l.emplaceBack(s.Z,0),l.emplaceBack(0,s.Z),l.emplaceBack(s.Z,s.Z),this.debugBuffer=e.createVertexBuffer(l,os.members),this.debugSegments=s.aF.simpleSegment(0,0,4,5);const u=new s.bV;u.emplaceBack(0,0,0,0),u.emplaceBack(s.Z,0,s.Z,0),u.emplaceBack(0,s.Z,0,s.Z),u.emplaceBack(s.Z,s.Z,s.Z,s.Z),this.rasterBoundsBuffer=e.createVertexBuffer(u,Vn.members),this.rasterBoundsSegments=s.aF.simpleSegment(0,0,4,2);const g=new s.aE;g.emplaceBack(0,0),g.emplaceBack(s.Z,0),g.emplaceBack(0,s.Z),g.emplaceBack(s.Z,s.Z),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(g,os.members),this.rasterBoundsSegmentsPosOnly=s.aF.simpleSegment(0,0,4,5);const P=new s.aE;P.emplaceBack(0,0),P.emplaceBack(1,0),P.emplaceBack(0,1),P.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(P,os.members),this.viewportSegments=s.aF.simpleSegment(0,0,4,2);const I=new s.bW;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(I);const E=new s.aG;E.emplaceBack(1,0,2),E.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(E);const D=this.context.gl;this.stencilClearMode=new ti({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.tileExtentMesh=new qn(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=s.K();s.bN(l,0,this.width,this.height,0,0,1),s.M(l,l,[r.drawingBufferWidth,r.drawingBufferHeight,0]);const u={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(e,r.TRIANGLES,Nr.disabled,this.stencilClearMode,wi.disabled,Wr.disabled,null,null,u,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,r,l){if(this.currentStencilSource===e.source||!e.isTileClipped()||!r||!r.length)return;this.currentStencilSource=e.source,this.nextStencilID+r.length>256&&this.clearStencil();const u=this.context;u.setColorMode(wi.disabled),u.setDepthMode(Nr.disabled);const g={};for(const P of r)g[P.key]=this.nextStencilID++;this._renderTileMasks(g,r,l,!0),this._renderTileMasks(g,r,l,!1),this._tileClippingMaskIDs=g}_renderTileMasks(e,r,l,u){const g=this.context,P=g.gl,I=this.style.projection,E=this.transform,D=this.useProgram("clippingMask");for(const q of r){const $=e[q.key],W=this.style.map.terrain&&this.style.map.terrain.getTerrainData(q),ie=I.getMeshFromTileID(this.context,q.canonical,u,!0,"stencil"),se=E.getProjectionData({overscaledTileID:q,applyGlobeMatrix:!0,applyTerrainMatrix:!0});D.draw(g,P.TRIANGLES,Nr.disabled,new ti({func:P.ALWAYS,mask:0},$,255,P.KEEP,P.KEEP,P.REPLACE),wi.disabled,l?Wr.disabled:Wr.backCCW,null,W,se,"$clipping",ie.vertexBuffer,ie.indexBuffer,ie.segments)}}_renderTilesDepthBuffer(){const e=this.context,r=e.gl,l=this.style.projection,u=this.transform,g=this.useProgram("depth"),P=this.getDepthModeFor3D(),I=K(u,{tileSize:u.tileSize});for(const E of I){const D=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E),q=l.getMeshFromTileID(this.context,E.canonical,!0,!0,"raster"),$=u.getProjectionData({overscaledTileID:E,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(e,r.TRIANGLES,P,ti.disabled,wi.disabled,Wr.backCCW,null,D,$,"$clipping",q.vertexBuffer,q.indexBuffer,q.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,r=this.context.gl;return new ti({func:r.NOTEQUAL,mask:255},e,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(e){const r=this.context.gl;return new ti({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,r.KEEP,r.KEEP,r.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const r=this.context.gl,l=e.sort((P,I)=>I.overscaledZ-P.overscaledZ),u=l[l.length-1].overscaledZ,g=l[0].overscaledZ-u+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const P={};for(let I=0;I<g;I++)P[I+u]=new ti({func:r.GEQUAL,mask:255},I+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=g,[P,l]}return[{[u]:ti.disabled},l]}stencilConfigForOverlapTwoPass(e){const r=this.context.gl,l=e.sort((P,I)=>I.overscaledZ-P.overscaledZ),u=l[l.length-1].overscaledZ,g=l[0].overscaledZ-u+1;if(this.clearStencil(),g>1){const P={},I={};for(let E=0;E<g;E++)P[E+u]=new ti({func:r.GREATER,mask:255},g+1+E,255,r.KEEP,r.KEEP,r.REPLACE),I[E+u]=new ti({func:r.GREATER,mask:255},1+E,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID=2*g+1,[P,I,l]}return this.nextStencilID=3,[{[u]:new ti({func:r.GREATER,mask:255},2,255,r.KEEP,r.KEEP,r.REPLACE)},{[u]:new ti({func:r.GREATER,mask:255},1,255,r.KEEP,r.KEEP,r.REPLACE)},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new wi([e.CONSTANT_COLOR,e.ONE],new s.b6(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?wi.unblended:wi.alphaBlended}getDepthModeForSublayer(e,r,l){if(!this.opaquePassEnabledForLayer())return Nr.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Nr(l||this.context.gl.LEQUAL,r,[u,u])}getDepthModeFor3D(){return new Nr(this.context.gl.LEQUAL,Nr.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,r){var l,u;this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(J.now()),this.imageManager.beginFrame();const g=this.style._order,P=this.style.sourceCaches,I={},E={},D={},q={isRenderingToTexture:!1,isRenderingGlobe:((l=e.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const W in P){const ie=P[W];ie.used&&ie.prepare(this.context),I[W]=ie.getVisibleCoordinates(!1),E[W]=I[W].slice().reverse(),D[W]=ie.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let W=0;W<g.length;W++)if(this.style._layers[g[W]].is3D()){this.opaquePassCutoff=W;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const W of g){const ie=this.style._layers[W];if(!ie.hasOffscreenPass()||ie.isHidden(this.transform.zoom))continue;const se=E[ie.source];(ie.type==="custom"||se.length)&&this.renderLayer(this,P[ie.source],ie,se,q)}if((u=this.style.projection)===null||u===void 0||u.updateGPUdependent({context:this.context,useProgram:W=>this.useProgram(W)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?s.b6.black:s.b6.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(W,ie){const se=W.context,Pe=se.gl,be=((Je,Ye,vt)=>{const bt=Math.cos(Ye.rollInRadians),Mt=Math.sin(Ye.rollInRadians),Lt=un(Ye),It=Ye.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Je.properties.get("sky-color"),u_horizon_color:Je.properties.get("horizon-color"),u_horizon:[(Ye.width/2-Lt*Mt)*vt,(Ye.height/2+Lt*bt)*vt],u_horizon_normal:[-Mt,bt],u_sky_horizon_blend:Je.properties.get("sky-horizon-blend")*Ye.height/2*vt,u_sky_blend:It}})(ie,W.style.map.transform,W.pixelRatio),Se=new Nr(Pe.LEQUAL,Nr.ReadWrite,[0,1]),Ee=ti.disabled,Ze=W.colorModeForRenderPass(),Ge=W.useProgram("sky"),Xe=kc(se,ie);Ge.draw(se,Pe.TRIANGLES,Se,Ee,Ze,Wr.disabled,be,null,void 0,"sky",Xe.vertexBuffer,Xe.indexBuffer,Xe.segments)}(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const W=this.style._layers[g[this.currentLayer]],ie=P[W.source],se=I[W.source];this._renderTileClippingMasks(W,se,!1),this.renderLayer(this,ie,W,se,q)}this.renderPass="translucent";let $=!1;for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const W=this.style._layers[g[this.currentLayer]],ie=P[W.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(W,q))continue;this.opaquePassEnabledForLayer()||$||($=!0,q.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const se=(W.type==="symbol"?D:E)[W.source];this._renderTileClippingMasks(W,I[W.source],!1),this.renderLayer(this,ie,W,se,q)}if(q.isRenderingGlobe&&function(W,ie,se){const Pe=W.context,be=Pe.gl,Se=W.useProgram("atmosphere"),Ee=new Nr(be.LEQUAL,Nr.ReadOnly,[0,1]),Ze=W.transform,Ge=function(It,tr){const Kt=It.properties.get("position"),Bt=[-Kt.x,-Kt.y,-Kt.z],gr=s.as(new Float64Array(16));return It.properties.get("anchor")==="map"&&(s.aZ(gr,gr,tr.rollInRadians),s.a_(gr,gr,-tr.pitchInRadians),s.aZ(gr,gr,tr.bearingInRadians),s.a_(gr,gr,tr.center.lat*Math.PI/180),s.bl(gr,gr,-tr.center.lng*Math.PI/180)),s.bU(Bt,Bt,gr),Bt}(se,W.transform),Xe=Ze.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Je=ie.properties.get("atmosphere-blend")*Xe.projectionTransition;if(Je===0)return;const Ye=ji(Ze.worldSize,Ze.center.lat),vt=Ze.inverseProjectionMatrix,bt=new Float64Array(4);bt[3]=1,s.ao(bt,bt,Ze.modelViewProjectionMatrix),bt[0]/=bt[3],bt[1]/=bt[3],bt[2]/=bt[3],bt[3]=1,s.ao(bt,bt,vt),bt[0]/=bt[3],bt[1]/=bt[3],bt[2]/=bt[3],bt[3]=1;const Mt=((It,tr,Kt,Bt,gr)=>({u_sun_pos:It,u_atmosphere_blend:tr,u_globe_position:Kt,u_globe_radius:Bt,u_inv_proj_matrix:gr}))(Ge,Je,[bt[0],bt[1],bt[2]],Ye,vt),Lt=kc(Pe,ie);Se.draw(Pe,be.TRIANGLES,Ee,ti.disabled,wi.alphaBlended,Wr.disabled,Mt,null,null,"atmosphere",Lt.vertexBuffer,Lt.indexBuffer,Lt.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const W=function(ie,se){let Pe=null;const be=Object.values(ie._layers).flatMap(Ge=>Ge.source&&!Ge.isHidden(se)?[ie.sourceCaches[Ge.source]]:[]),Se=be.filter(Ge=>Ge.getSource().type==="vector"),Ee=be.filter(Ge=>Ge.getSource().type!=="vector"),Ze=Ge=>{(!Pe||Pe.getSource().maxzoom<Ge.getSource().maxzoom)&&(Pe=Ge)};return Se.forEach(Ge=>Ze(Ge)),Pe||Ee.forEach(Ge=>Ze(Ge)),Pe}(this.style,this.transform.zoom);W&&function(ie,se,Pe){for(let be=0;be<Pe.length;be++)Lc(ie,se,Pe[be])}(this,W,W.getVisibleCoordinates())}this.options.showPadding&&function(W){const ie=W.transform.padding;aa(W,W.transform.height-(ie.top||0),3,Vo),aa(W,ie.bottom||0,3,js),bl(W,ie.left||0,3,Mc),bl(W,W.transform.width-(ie.right||0),3,Vl);const se=W.transform.centerPoint;(function(Pe,be,Se,Ee){xl(Pe,be-1,Se-10,2,20,Ee),xl(Pe,be-10,Se-1,20,2,Ee)})(W,se.x,W.transform.height-se.y,lc)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const r=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let u=this.terrainFacilitator.dirty;u||(u=e?!s.bX(r,l):!s.bY(r,l)),u||(u=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),u&&(s.bZ(r,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(g,P){const I=g.context,E=I.gl,D=g.transform,q=wi.unblended,$=new Nr(E.LEQUAL,Nr.ReadWrite,[0,1]),W=P.sourceCache.getRenderableTiles(),ie=g.useProgram("terrainDepth");I.bindFramebuffer.set(P.getFramebuffer("depth").framebuffer),I.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),I.clear({color:s.b6.transparent,depth:1});for(const se of W){const Pe=P.getTerrainMesh(se.tileID),be=P.getTerrainData(se.tileID),Se=D.getProjectionData({overscaledTileID:se.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Ee={u_ele_delta:P.getMeshFrameDelta(D.zoom)};ie.draw(I,E.TRIANGLES,$,ti.disabled,q,Wr.backCCW,Ee,be,Se,"terrain",Pe.vertexBuffer,Pe.indexBuffer,Pe.segments)}I.bindFramebuffer.set(null),I.viewport.set([0,0,g.width,g.height])}(this,this.style.map.terrain),function(g,P){const I=g.context,E=I.gl,D=g.transform,q=wi.unblended,$=new Nr(E.LEQUAL,Nr.ReadWrite,[0,1]),W=P.getCoordsTexture(),ie=P.sourceCache.getRenderableTiles(),se=g.useProgram("terrainCoords");I.bindFramebuffer.set(P.getFramebuffer("coords").framebuffer),I.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),I.clear({color:s.b6.transparent,depth:1}),P.coordsIndex=[];for(const Pe of ie){const be=P.getTerrainMesh(Pe.tileID),Se=P.getTerrainData(Pe.tileID);I.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,W.texture);const Ee={u_terrain_coords_id:(255-P.coordsIndex.length)/255,u_texture:0,u_ele_delta:P.getMeshFrameDelta(D.zoom)},Ze=D.getProjectionData({overscaledTileID:Pe.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});se.draw(I,E.TRIANGLES,$,ti.disabled,q,Wr.backCCW,Ee,Se,Ze,"terrain",be.vertexBuffer,be.indexBuffer,be.segments),P.coordsIndex.push(Pe.tileID.key)}I.bindFramebuffer.set(null),I.viewport.set([0,0,g.width,g.height])}(this,this.style.map.terrain))}renderLayer(e,r,l,u,g){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(u||[]).length)&&(this.id=l.id,s.b_(l)?function(P,I,E,D,q,$){if(P.renderPass!=="translucent")return;const{isRenderingToTexture:W}=$,ie=ti.disabled,se=P.colorModeForRenderPass();(E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Pe,be,Se,Ee,Ze,Ge,Xe,Je,Ye){const vt=be.transform,bt=be.style.map.terrain,Mt=Ze==="map",Lt=Ge==="map";for(const It of Pe){const tr=Ee.getTile(It),Kt=tr.getBucket(Se);if(!Kt||!Kt.text||!Kt.text.segments.get().length)continue;const Bt=s.af(Kt.textSizeData,vt.zoom),gr=s.av(tr,1,be.transform.zoom),_r=Te(Mt,be.transform,gr),oi=Se.layout.get("icon-text-fit")!=="none"&&Kt.hasIconData();if(Bt){const Pi=Math.pow(2,vt.zoom-tr.tileID.overscaledZ),bi=bt?(Mi,_i)=>bt.getElevation(It,Mi,_i):null;Oo(Kt,Mt,Lt,Ye,vt,_r,Pi,Bt,oi,s.aw(vt,tr,Xe,Je),It.toUnwrapped(),bi)}}}(D,P,E,I,E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),q),E.paint.get("icon-opacity").constantOr(1)!==0&&Bl(P,I,E,D,!1,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),E.layout.get("icon-rotation-alignment"),E.layout.get("icon-pitch-alignment"),E.layout.get("icon-keep-upright"),ie,se,W),E.paint.get("text-opacity").constantOr(1)!==0&&Bl(P,I,E,D,!0,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.layout.get("text-keep-upright"),ie,se,W),I.map.showCollisionBoxes&&(Ro(P,I,E,D,!0),Ro(P,I,E,D,!1))}(e,r,l,u,this.style.placement.variableOffsets,g):s.b$(l)?function(P,I,E,D,q){if(P.renderPass!=="translucent")return;const{isRenderingToTexture:$}=q,W=E.paint.get("circle-opacity"),ie=E.paint.get("circle-stroke-width"),se=E.paint.get("circle-stroke-opacity"),Pe=!E.layout.get("circle-sort-key").isConstant();if(W.constantOr(1)===0&&(ie.constantOr(1)===0||se.constantOr(1)===0))return;const be=P.context,Se=be.gl,Ee=P.transform,Ze=P.getDepthModeForSublayer(0,Nr.ReadOnly),Ge=ti.disabled,Xe=P.colorModeForRenderPass(),Je=[],Ye=Ee.getCircleRadiusCorrection();for(let vt=0;vt<D.length;vt++){const bt=D[vt],Mt=I.getTile(bt),Lt=Mt.getBucket(E);if(!Lt)continue;const It=E.paint.get("circle-translate"),tr=E.paint.get("circle-translate-anchor"),Kt=s.aw(Ee,Mt,It,tr),Bt=Lt.programConfigurations.get(E.id),gr=P.useProgram("circle",Bt),_r=Lt.layoutVertexBuffer,oi=Lt.indexBuffer,Pi=P.style.map.terrain&&P.style.map.terrain.getTerrainData(bt),bi={programConfiguration:Bt,program:gr,layoutVertexBuffer:_r,indexBuffer:oi,uniformValues:Er(P,Mt,E,Kt,Ye),terrainData:Pi,projectionData:Ee.getProjectionData({overscaledTileID:bt,applyGlobeMatrix:!$,applyTerrainMatrix:!0})};if(Pe){const Mi=Lt.segments.get();for(const _i of Mi)Je.push({segments:new s.aF([_i]),sortKey:_i.sortKey,state:bi})}else Je.push({segments:Lt.segments,sortKey:0,state:bi})}Pe&&Je.sort((vt,bt)=>vt.sortKey-bt.sortKey);for(const vt of Je){const{programConfiguration:bt,program:Mt,layoutVertexBuffer:Lt,indexBuffer:It,uniformValues:tr,terrainData:Kt,projectionData:Bt}=vt.state;Mt.draw(be,Se.TRIANGLES,Ze,Ge,Xe,Wr.backCCW,tr,Kt,Bt,E.id,Lt,It,vt.segments,E.paint,P.transform.zoom,bt)}}(e,r,l,u,g):s.c0(l)?function(P,I,E,D,q){if(E.paint.get("heatmap-opacity")===0)return;const $=P.context,{isRenderingToTexture:W,isRenderingGlobe:ie}=q;if(P.style.map.terrain){for(const se of D){const Pe=I.getTile(se);I.hasRenderableParent(se)||(P.renderPass==="offscreen"?Ic(P,Pe,E,se,ie):P.renderPass==="translucent"&&Cc(P,E,se,W,ie))}$.viewport.set([0,0,P.width,P.height])}else P.renderPass==="offscreen"?function(se,Pe,be,Se){const Ee=se.context,Ze=Ee.gl,Ge=se.transform,Xe=ti.disabled,Je=new wi([Ze.ONE,Ze.ONE],s.b6.transparent,[!0,!0,!0,!0]);(function(Ye,vt,bt){const Mt=Ye.gl;Ye.activeTexture.set(Mt.TEXTURE1),Ye.viewport.set([0,0,vt.width/4,vt.height/4]);let Lt=bt.heatmapFbos.get(s.bR);Lt?(Mt.bindTexture(Mt.TEXTURE_2D,Lt.colorAttachment.get()),Ye.bindFramebuffer.set(Lt.framebuffer)):(Lt=qo(Ye,vt.width/4,vt.height/4),bt.heatmapFbos.set(s.bR,Lt))})(Ee,se,be),Ee.clear({color:s.b6.transparent});for(let Ye=0;Ye<Se.length;Ye++){const vt=Se[Ye];if(Pe.hasRenderableParent(vt))continue;const bt=Pe.getTile(vt),Mt=bt.getBucket(be);if(!Mt)continue;const Lt=Mt.programConfigurations.get(be.id),It=se.useProgram("heatmap",Lt),tr=Ge.getProjectionData({overscaledTileID:vt,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Kt=Ge.getCircleRadiusCorrection();It.draw(Ee,Ze.TRIANGLES,Nr.disabled,Xe,Je,Wr.backCCW,Di(bt,Ge.zoom,be.paint.get("heatmap-intensity"),Kt),null,tr,be.id,Mt.layoutVertexBuffer,Mt.indexBuffer,Mt.segments,be.paint,Ge.zoom,Lt)}Ee.viewport.set([0,0,se.width,se.height])}(P,I,E,D):P.renderPass==="translucent"&&function(se,Pe){const be=se.context,Se=be.gl;be.setColorMode(se.colorModeForRenderPass());const Ee=Pe.heatmapFbos.get(s.bR);Ee&&(be.activeTexture.set(Se.TEXTURE0),Se.bindTexture(Se.TEXTURE_2D,Ee.colorAttachment.get()),be.activeTexture.set(Se.TEXTURE1),_l(be,Pe).bind(Se.LINEAR,Se.CLAMP_TO_EDGE),se.useProgram("heatmapTexture").draw(be,Se.TRIANGLES,Nr.disabled,ti.disabled,se.colorModeForRenderPass(),Wr.disabled,Xi(se,Pe,0,1),null,null,Pe.id,se.viewportBuffer,se.quadTriangleIndexBuffer,se.viewportSegments,Pe.paint,se.transform.zoom))}(P,E)}(e,r,l,u,g):s.c1(l)?function(P,I,E,D,q){if(P.renderPass!=="translucent")return;const{isRenderingToTexture:$}=q,W=E.paint.get("line-opacity"),ie=E.paint.get("line-width");if(W.constantOr(1)===0||ie.constantOr(1)===0)return;const se=P.getDepthModeForSublayer(0,Nr.ReadOnly),Pe=P.colorModeForRenderPass(),be=E.paint.get("line-dasharray"),Se=E.paint.get("line-pattern"),Ee=Se.constantOr(1),Ze=E.paint.get("line-gradient"),Ge=E.getCrossfadeParameters(),Xe=Ee?"linePattern":be?"lineSDF":Ze?"lineGradient":"line",Je=P.context,Ye=Je.gl,vt=P.transform;let bt=!0;for(const Mt of D){const Lt=I.getTile(Mt);if(Ee&&!Lt.patternsLoaded())continue;const It=Lt.getBucket(E);if(!It)continue;const tr=It.programConfigurations.get(E.id),Kt=P.context.program.get(),Bt=P.useProgram(Xe,tr),gr=bt||Bt.program!==Kt,_r=P.style.map.terrain&&P.style.map.terrain.getTerrainData(Mt),oi=Se.constantOr(null);if(oi&&Lt.imageAtlas){const hi=Lt.imageAtlas,vi=hi.patternPositions[oi.to.toString()],Tn=hi.patternPositions[oi.from.toString()];vi&&Tn&&tr.setConstantPatternPositions(vi,Tn)}const Pi=vt.getProjectionData({overscaledTileID:Mt,applyGlobeMatrix:!$,applyTerrainMatrix:!0}),bi=vt.getPixelScale(),Mi=Ee?Ps(P,Lt,E,bi,Ge):be?ic(P,Lt,E,bi,be,Ge):Ze?zs(P,Lt,E,bi,It.lineClipsArray.length):En(P,Lt,E,bi);if(Ee)Je.activeTexture.set(Ye.TEXTURE0),Lt.imageAtlasTexture.bind(Ye.LINEAR,Ye.CLAMP_TO_EDGE),tr.updatePaintBuffers(Ge);else if(be&&(gr||P.lineAtlas.dirty))Je.activeTexture.set(Ye.TEXTURE0),P.lineAtlas.bind(Je);else if(Ze){const hi=It.gradients[E.id];let vi=hi.texture;if(E.gradientVersion!==hi.version){let Tn=256;if(E.stepInterpolant){const vn=I.getSource().maxzoom,bn=Mt.canonical.z===vn?Math.ceil(1<<P.transform.maxZoom-Mt.canonical.z):1;Tn=s.ad(s.bS(It.maxLineLength/s.Z*1024*bn),256,Je.maxTextureSize)}hi.gradient=s.bT({expression:E.gradientExpression(),evaluationKey:"lineProgress",resolution:Tn,image:hi.gradient||void 0,clips:It.lineClipsArray}),hi.texture?hi.texture.update(hi.gradient):hi.texture=new Ae(Je,hi.gradient,Ye.RGBA),hi.version=E.gradientVersion,vi=hi.texture}Je.activeTexture.set(Ye.TEXTURE0),vi.bind(E.stepInterpolant?Ye.NEAREST:Ye.LINEAR,Ye.CLAMP_TO_EDGE)}let _i;if($){const[hi]=P.getStencilConfigForOverlapAndUpdateStencilID(D);_i=hi[Mt.overscaledZ]}else _i=P.stencilModeForClipping(Mt);Bt.draw(Je,Ye.TRIANGLES,se,_i,Pe,Wr.disabled,Mi,_r,Pi,E.id,It.layoutVertexBuffer,It.indexBuffer,It.segments,E.paint,P.transform.zoom,tr,It.layoutVertexBuffer2),bt=!1}}(e,r,l,u,g):s.c2(l)?function(P,I,E,D,q){const $=E.paint.get("fill-color"),W=E.paint.get("fill-opacity");if(W.constantOr(1)===0)return;const{isRenderingToTexture:ie}=q,se=P.colorModeForRenderPass(),Pe=E.paint.get("fill-pattern"),be=P.opaquePassEnabledForLayer()&&!Pe.constantOr(1)&&$.constantOr(s.b6.transparent).a===1&&W.constantOr(0)===1?"opaque":"translucent";if(P.renderPass===be){const Se=P.getDepthModeForSublayer(1,P.renderPass==="opaque"?Nr.ReadWrite:Nr.ReadOnly);Ol(P,I,E,D,Se,se,!1,ie)}if(P.renderPass==="translucent"&&E.paint.get("fill-antialias")){const Se=P.getDepthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,Nr.ReadOnly);Ol(P,I,E,D,Se,se,!0,ie)}}(e,r,l,u,g):s.c3(l)?function(P,I,E,D,q){const $=E.paint.get("fill-extrusion-opacity");if($===0)return;const{isRenderingToTexture:W}=q;if(P.renderPass==="translucent"){const ie=new Nr(P.context.gl.LEQUAL,Nr.ReadWrite,P.depthRangeFor3D);if($!==1||E.paint.get("fill-extrusion-pattern").constantOr(1))vl(P,I,E,D,ie,ti.disabled,wi.disabled,W),vl(P,I,E,D,ie,P.stencilModeFor3D(),P.colorModeForRenderPass(),W);else{const se=P.colorModeForRenderPass();vl(P,I,E,D,ie,ti.disabled,se,W)}}}(e,r,l,u,g):s.c4(l)?function(P,I,E,D,q){if(P.renderPass!=="offscreen"&&P.renderPass!=="translucent")return;const{isRenderingToTexture:$}=q,W=P.context,ie=P.style.projection.useSubdivision,se=P.getDepthModeForSublayer(0,Nr.ReadOnly),Pe=P.colorModeForRenderPass();if(P.renderPass==="offscreen")(function(be,Se,Ee,Ze,Ge,Xe,Je){const Ye=be.context,vt=Ye.gl;for(const bt of Ee){const Mt=Se.getTile(bt),Lt=Mt.dem;if(!Lt||!Lt.data||!Mt.needsHillshadePrepare)continue;const It=Lt.dim,tr=Lt.stride,Kt=Lt.getPixels();if(Ye.activeTexture.set(vt.TEXTURE1),Ye.pixelStoreUnpackPremultiplyAlpha.set(!1),Mt.demTexture=Mt.demTexture||be.getTileTexture(tr),Mt.demTexture){const gr=Mt.demTexture;gr.update(Kt,{premultiply:!1}),gr.bind(vt.NEAREST,vt.CLAMP_TO_EDGE)}else Mt.demTexture=new Ae(Ye,Kt,vt.RGBA,{premultiply:!1}),Mt.demTexture.bind(vt.NEAREST,vt.CLAMP_TO_EDGE);Ye.activeTexture.set(vt.TEXTURE0);let Bt=Mt.fbo;if(!Bt){const gr=new Ae(Ye,{width:It,height:It,data:null},vt.RGBA);gr.bind(vt.LINEAR,vt.CLAMP_TO_EDGE),Bt=Mt.fbo=Ye.createFramebuffer(It,It,!0,!1),Bt.colorAttachment.set(gr.texture)}Ye.bindFramebuffer.set(Bt.framebuffer),Ye.viewport.set([0,0,It,It]),be.useProgram("hillshadePrepare").draw(Ye,vt.TRIANGLES,Ge,Xe,Je,Wr.disabled,Ln(Mt.tileID,Lt),null,null,Ze.id,be.rasterBoundsBuffer,be.quadTriangleIndexBuffer,be.rasterBoundsSegments),Mt.needsHillshadePrepare=!1}})(P,I,D,E,se,ti.disabled,Pe),W.viewport.set([0,0,P.width,P.height]);else if(P.renderPass==="translucent")if(ie){const[be,Se,Ee]=P.stencilConfigForOverlapTwoPass(D);jl(P,I,E,Ee,be,se,Pe,!1,$),jl(P,I,E,Ee,Se,se,Pe,!0,$)}else{const[be,Se]=P.getStencilConfigForOverlapAndUpdateStencilID(D);jl(P,I,E,Se,be,se,Pe,!1,$)}}(e,r,l,u,g):s.c5(l)?function(P,I,E,D,q){if(P.renderPass!=="translucent"||E.paint.get("raster-opacity")===0||!D.length)return;const{isRenderingToTexture:$}=q,W=I.getSource(),ie=P.style.projection.useSubdivision;if(W instanceof ir)ql(P,I,E,D,null,!1,!1,W.tileCoords,W.flippedWindingOrder,$);else if(ie){const[se,Pe,be]=P.stencilConfigForOverlapTwoPass(D);ql(P,I,E,be,se,!1,!0,oc,!1,$),ql(P,I,E,be,Pe,!0,!0,oc,!1,$)}else{const[se,Pe]=P.getStencilConfigForOverlapAndUpdateStencilID(D);ql(P,I,E,Pe,se,!1,!0,oc,!1,$)}}(e,r,l,u,g):s.c6(l)?function(P,I,E,D,q){const $=E.paint.get("background-color"),W=E.paint.get("background-opacity");if(W===0)return;const{isRenderingToTexture:ie}=q,se=P.context,Pe=se.gl,be=P.style.projection,Se=P.transform,Ee=Se.tileSize,Ze=E.paint.get("background-pattern");if(P.isPatternMissing(Ze))return;const Ge=!Ze&&$.a===1&&W===1&&P.opaquePassEnabledForLayer()?"opaque":"translucent";if(P.renderPass!==Ge)return;const Xe=ti.disabled,Je=P.getDepthModeForSublayer(0,Ge==="opaque"?Nr.ReadWrite:Nr.ReadOnly),Ye=P.colorModeForRenderPass(),vt=P.useProgram(Ze?"backgroundPattern":"background"),bt=D||K(Se,{tileSize:Ee,terrain:P.style.map.terrain});Ze&&(se.activeTexture.set(Pe.TEXTURE0),P.imageManager.bind(P.context));const Mt=E.getCrossfadeParameters();for(const Lt of bt){const It=Se.getProjectionData({overscaledTileID:Lt,applyGlobeMatrix:!ie,applyTerrainMatrix:!0}),tr=Ze?po(W,P,Ze,{tileID:Lt,tileSize:Ee},Mt):hs(W,$),Kt=P.style.map.terrain&&P.style.map.terrain.getTerrainData(Lt),Bt=be.getMeshFromTileID(se,Lt.canonical,!1,!0,"raster");vt.draw(se,Pe.TRIANGLES,Je,Xe,Ye,Wr.backCCW,tr,Kt,It,E.id,Bt.vertexBuffer,Bt.indexBuffer,Bt.segments)}}(e,0,l,u,g):s.c7(l)&&function(P,I,E,D){const{isRenderingGlobe:q}=D,$=P.context,W=E.implementation,ie=P.style.projection,se=P.transform,Pe=se.getProjectionDataForCustomLayer(q),be={farZ:se.farZ,nearZ:se.nearZ,fov:se.fov*Math.PI/180,modelViewProjectionMatrix:se.modelViewProjectionMatrix,projectionMatrix:se.projectionMatrix,shaderData:{variantName:ie.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${ie.shaderPreludeCode.vertexSource}`,define:ie.shaderDefine},defaultProjectionData:Pe},Se=W.renderingMode?W.renderingMode:"2d";if(P.renderPass==="offscreen"){const Ee=W.prerender;Ee&&(P.setCustomLayerDefaults(),$.setColorMode(P.colorModeForRenderPass()),Ee.call(W,$.gl,be),$.setDirty(),P.setBaseState())}else if(P.renderPass==="translucent"){P.setCustomLayerDefaults(),$.setColorMode(P.colorModeForRenderPass()),$.setStencilMode(ti.disabled);const Ee=Se==="3d"?P.getDepthModeFor3D():P.getDepthModeForSublayer(0,Nr.ReadOnly);$.setDepthMode(Ee),W.render($.gl,be),$.setDirty(),P.setBaseState(),$.bindFramebuffer.set(null)}}(e,0,l,g))}saveTileTexture(e){const r=this._tileTextures[e.size[0]];r?r.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const r=this._tileTextures[e];return r&&r.length>0?r.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const r=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!r||!l}useProgram(e,r,l=!1){this.cache=this.cache||{};const u=!!this.style.map.terrain,g=this.style.projection,P=e+(r?r.cacheKey:"")+`/${l?sl:g.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(u?"/terrain":"");return this.cache[P]||(this.cache[P]=new re(this.context,Oi[e],r,zo[e],this._showOverdrawInspector,u,l?Oi.projectionMercator:g.shaderPreludeCode,l?ei:g.shaderDefine)),this.cache[P]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ae(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:r}=this.context.gl;return this.width!==e||this.height!==r}}function zc(m,e){let r,l=!1,u=null,g=null;const P=()=>{u=null,l&&(m.apply(g,r),u=setTimeout(P,e),l=!1)};return(...I)=>(l=!0,g=this,r=I,u||P(),u)}class es{constructor(e){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(l=u)}),(l&&l[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(!this._isValidHash(r))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:l,pitch:+(r[4]||0)}),!0},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{const r=this._getCurrentHash();if(r.length===0)return;const l=r.join("/");let u=l;u.split("&").length>0&&(u=u.split("&")[0]),this._hashName&&(u=`${this._hashName}=${l}`);let g=window.location.hash.replace(u,"");g.startsWith("#&")?g=g.slice(0,1)+g.slice(2):g==="#"&&(g="");let P=window.location.href.replace(/(#.+)?$/,g);P=P.replace("&&","&"),window.history.replaceState(window.history.state,null,P)},this._updateHash=zc(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const r=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,u=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,u),P=Math.round(r.lng*g)/g,I=Math.round(r.lat*g)/g,E=this._map.getBearing(),D=this._map.getPitch();let q="";if(q+=e?`/${P}/${I}/${l}`:`${l}/${I}/${P}`,(E||D)&&(q+="/"+Math.round(10*E)/10),D&&(q+=`/${Math.round(D)}`),this._hashName){const $=this._hashName;let W=!1;const ie=window.location.hash.slice(1).split("&").map(se=>{const Pe=se.split("=")[0];return Pe===$?(W=!0,`${Pe}=${q}`):se}).filter(se=>se);return W||ie.push(`${$}=${q}`),`#${ie.join("&")}`}return`#${q}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new s.Q(+e[2],+e[1])}catch{return!1}const r=+e[0],l=+(e[3]||0),u=+(e[4]||0);return r>=this._map.getMinZoom()&&r<=this._map.getMaxZoom()&&l>=-180&&l<=180&&u>=this._map.getMinPitch()&&u<=this._map.getMaxPitch()}}const Zn={linearity:.3,easing:s.c8(0,0,.3,1)},Pa=s.e({deceleration:2500,maxSpeed:1400},Zn),Yc=s.e({deceleration:20,maxSpeed:1400},Zn),Dc=s.e({deceleration:1e3,maxSpeed:360},Zn),Ua=s.e({deceleration:1e3,maxSpeed:90},Zn),As=s.e({deceleration:1e3,maxSpeed:360},Zn);class Kc{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:J.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,r=J.now();for(;e.length>0&&r-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,roll:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)r.zoom+=g.zoomDelta||0,r.bearing+=g.bearingDelta||0,r.pitch+=g.pitchDelta||0,r.roll+=g.rollDelta||0,g.panDelta&&r.pan._add(g.panDelta),g.around&&(r.around=g.around),g.pinchAround&&(r.pinchAround=g.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(r.pan.mag()){const g=Uo(r.pan.mag(),l,s.e({},Pa,e||{})),P=r.pan.mult(g.amount/r.pan.mag()),I=this._map.cameraHelper.handlePanInertia(P,this._map.transform);u.center=I.easingCenter,u.offset=I.easingOffset,_o(u,g)}if(r.zoom){const g=Uo(r.zoom,l,Yc);u.zoom=this._map.transform.zoom+g.amount,_o(u,g)}if(r.bearing){const g=Uo(r.bearing,l,Dc);u.bearing=this._map.transform.bearing+s.ad(g.amount,-179,179),_o(u,g)}if(r.pitch){const g=Uo(r.pitch,l,Ua);u.pitch=this._map.transform.pitch+g.amount,_o(u,g)}if(r.roll){const g=Uo(r.roll,l,As);u.roll=this._map.transform.roll+s.ad(g.amount,-179,179),_o(u,g)}if(u.zoom||u.bearing){const g=r.pinchAround===void 0?r.around:r.pinchAround;u.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),s.e(u,{noMoveStart:!0})}}function _o(m,e){(!m.duration||m.duration<e.duration)&&(m.duration=e.duration,m.easing=e.easing)}function Uo(m,e,r){const{maxSpeed:l,linearity:u,deceleration:g}=r,P=s.ad(m*u/(e/1e3),-l,l),I=Math.abs(P)/(g*u);return{easing:r.easing,duration:1e3*I,amount:P*(I/2)}}class qi extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,l,u={}){const g=N.mousePos(r.getCanvas(),l),P=r.unproject(g);super(e,s.e({point:g,lngLat:P,originalEvent:l},u)),this._defaultPrevented=!1,this.target=r}}class ts extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,l){const u=e==="touchend"?l.changedTouches:l.touches,g=N.touchPos(r.getCanvasContainer(),u),P=g.map(E=>r.unproject(E)),I=g.reduce((E,D,q,$)=>E.add(D.div($.length)),new s.P(0,0));super(e,{points:g,point:I,lngLats:P,lngLat:r.unproject(I),originalEvent:l}),this._defaultPrevented=!1}}class cc extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class Sa{constructor(e,r){this._map=e,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new cc(e.type,this._map,e))}mousedown(e,r){return this._mousedownPos=r,this._firePreventable(new qi(e.type,this._map,e))}mouseup(e){this._map.fire(new qi(e.type,this._map,e))}click(e,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new qi(e.type,this._map,e))}dblclick(e){return this._firePreventable(new qi(e.type,this._map,e))}mouseover(e){this._map.fire(new qi(e.type,this._map,e))}mouseout(e){this._map.fire(new qi(e.type,this._map,e))}touchstart(e){return this._firePreventable(new ts(e.type,this._map,e))}touchmove(e){this._map.fire(new ts(e.type,this._map,e))}touchend(e){this._map.fire(new ts(e.type,this._map,e))}touchcancel(e){this._map.fire(new ts(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Za{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new qi(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new qi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new qi(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yo{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(s.P.convert(e),this._map.terrain)}}class wl{constructor(e,r){this._map=e,this._tr=new yo(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,r){this.isEnabled()&&e.shiftKey&&e.button===0&&(N.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(e,r){if(!this._active)return;const l=r;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=l,this._box||(this._box=N.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const g=Math.min(u.x,l.x),P=Math.max(u.x,l.x),I=Math.min(u.y,l.y),E=Math.max(u.y,l.y);N.setTransform(this._box,`translate(${g}px,${I}px)`),this._box.style.width=P-g+"px",this._box.style.height=E-I+"px"}mouseupWindow(e,r){if(!this._active||e.button!==0)return;const l=this._startPos,u=r;if(this.reset(),N.suppressClick(),l.x!==u.x||l.y!==u.y)return this._map.fire(new s.l("boxzoomend",{originalEvent:e})),{cameraAnimation:g=>g.fitScreenCoordinates(l,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(N.remove(this._box),this._box=null),N.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,r){return this._map.fire(new s.l(e,{originalEvent:r}))}}function Ul(m,e){if(m.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${e.length}`);const r={};for(let l=0;l<m.length;l++)r[m[l].identifier]=e[l];return r}class ku{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,r,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=function(u){const g=new s.P(0,0);for(const P of u)g._add(P);return g.div(u.length)}(r),this.touches=Ul(l,r)))}touchmove(e,r,l){if(this.aborted||!this.centroid)return;const u=Ul(l,r);for(const g in this.touches){const P=u[g];(!P||P.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(e,r,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class Zl{constructor(e){this.singleTap=new ku(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,r,l){this.singleTap.touchstart(e,r,l)}touchmove(e,r,l){this.singleTap.touchmove(e,r,l)}touchend(e,r,l){const u=this.singleTap.touchend(e,r,l);if(u){const g=e.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(u)<30;if(g&&P||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class Gl{constructor(e){this._tr=new yo(e),this._zoomIn=new Zl({numTouches:1,numTaps:2}),this._zoomOut=new Zl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,r,l){this._zoomIn.touchstart(e,r,l),this._zoomOut.touchstart(e,r,l)}touchmove(e,r,l){this._zoomIn.touchmove(e,r,l),this._zoomOut.touchmove(e,r,l)}touchend(e,r,l){const u=this._zoomIn.touchend(e,r,l),g=this._zoomOut.touchend(e,r,l),P=this._tr;return u?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:P.zoom+1,around:P.unproject(u)},{originalEvent:e})}):g?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:P.zoom-1,around:P.unproject(g)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ts{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const r=this._moveFunction(...e);if(r.bearingDelta||r.pitchDelta||r.rollDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(e,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(r)?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,r){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const u=Array.isArray(r)?r[0]:r;return!this._moved&&u.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(l,u))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&N.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const hr={0:1,2:2};class Pl{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const r=N.mouseButton(e);this._eventButton=r}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(r,l){const u=hr[l];return r.buttons===void 0||(r.buttons&u)!==u}(e,this._eventButton)}isValidEndEvent(e){return N.mouseButton(e)===this._eventButton}}class Fc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Jc{constructor(e=new Pl({checkCorrectEvent:()=>!0}),r=new Fc){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=r}_executeRelevantHandler(e,r,l){return e instanceof MouseEvent?r(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?l(e):void 0}startMove(e){this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.startMove(r),r=>this.oneFingerTouchMoveStateManager.startMove(r))}endMove(e){this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.endMove(r),r=>this.oneFingerTouchMoveStateManager.endMove(r))}isValidStartEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidStartEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidStartEvent(r))}isValidMoveEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidMoveEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(r))}isValidEndEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidEndEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidEndEvent(r))}}const Ga=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=e=>{e.preventDefault()}};class vo{constructor(e,r){this._clickTolerance=e.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,r,l){return this._calculateTransform(e,r,l)}touchmove(e,r,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,r,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,r,l){this._calculateTransform(e,r,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,r,l){l.length>0&&(this._active=!0);const u=Ul(l,r),g=new s.P(0,0),P=new s.P(0,0);let I=0;for(const D in u){const q=u[D],$=this._touches[D];$&&(g._add(q),P._add(q.sub($)),I++,u[D]=q)}if(this._touches=u,this._shouldBePrevented(I)||!P.mag())return;const E=P.div(I);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(I),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,r,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([r[0],r[1]]))}touchmove(e,r,l){if(!this._firstTwoTouches)return;e.preventDefault();const[u,g]=this._firstTwoTouches,P=Gr(l,r,u),I=Gr(l,r,g);if(!P||!I)return;const E=this._aroundCenter?null:P.add(I).div(2);return this._move([P,I],E,e)}touchend(e,r,l){if(!this._firstTwoTouches)return;const[u,g]=this._firstTwoTouches,P=Gr(l,r,u),I=Gr(l,r,g);P&&I||(this._active&&N.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Gr(m,e,r){for(let l=0;l<m.length;l++)if(m[l].identifier===r)return e[l]}function $l(m,e){return Math.log(m/e)/Math.LN2}class w extends uc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,r){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs($l(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:$l(this._distance,l),pinchAround:r}}}function T(m,e){return 180*m.angleWith(e)/Math.PI}class F extends uc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,r,l){const u=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:T(this._vector,u),pinchAround:r}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const r=25/(Math.PI*this._minDiameter)*360,l=T(e,this._startVector);return Math.abs(l)<r}}function Z(m){return Math.abs(m.y)>Math.abs(m.x)}class te extends uc{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,r,l){super.touchstart(e,r,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,Z(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,r,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const u=e[0].sub(this._lastPoints[0]),g=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,g,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(u.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(e,r,l){if(this._valid!==void 0)return this._valid;const u=e.mag()>=2,g=r.mag()>=2;if(!u&&!g)return;if(!u||!g)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const P=e.y>0==r.y>0;return Z(e)&&Z(r)&&P}}const oe={panStep:100,bearingStep:15,pitchStep:10};class ce{constructor(e){this._tr=new yo(e);const r=oe;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let r=0,l=0,u=0,g=0,P=0;switch(e.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),g=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),g=1);break;case 38:e.shiftKey?u=1:(e.preventDefault(),P=-1);break;case 40:e.shiftKey?u=-1:(e.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(l=0,u=0),{cameraAnimation:I=>{const E=this._tr;I.easeTo({duration:300,easeId:"keyboardHandler",easing:he,zoom:r?Math.round(E.zoom)+r*(e.shiftKey?2:1):E.zoom,bearing:E.bearing+l*this._bearingStep,pitch:E.pitch+u*this._pitchStep,offset:[-g*this._panStep,-P*this._panStep],center:E.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function he(m){return m*(2-m)}const ge=4.000244140625;class Ce{constructor(e,r){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new yo(e),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let r=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=J.now(),u=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,r!==0&&r%ge==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(u*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=N.mousePos(this._map.getCanvas(),e),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(s.Q.convert(l.center)):r,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const I=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=I),typeof this._targetZoom=="number"&&(this._targetZoom+=I)}if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>ge?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&E!==0&&(E=1/E);const D=typeof this._targetZoom!="number"?e.scale:s.aH(this._targetZoom);this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,s.aa(D*E))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,l=this._startZoom,u=this._easing;let g,P=!1;if(this._type==="wheel"&&l&&u){const I=J.now()-this._lastWheelEventTime,E=Math.min((I+5)/200,1),D=u(E);g=s.B.number(l,r,D),E<1?this._frameId||(this._frameId=!0):P=!0}else g=r,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=g,{noInertia:!0,needsRenderFrame:!P,zoomDelta:g-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let r=s.ca;if(this._prevEase){const l=this._prevEase,u=(J.now()-l.start)/l.duration,g=l.easing(u+.01)-l.easing(u),P=.27/Math.sqrt(g*g+1e-4)*.01,I=Math.sqrt(.0729-P*P);r=s.c8(P,I,.25,1)}return this._prevEase={start:J.now(),duration:e,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class rt{constructor(e,r){this._clickZoom=e,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _t{constructor(e){this._tr=new yo(e),this.reset()}reset(){this._active=!1}dblclick(e,r){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ct{constructor(){this._tap=new Zl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,r,l){if(!this._swipePoint)if(this._tapTime){const u=r[0],g=e.timeStamp-this._tapTime<500,P=this._tapPoint.dist(u)<30;g&&P?l.length>0&&(this._swipePoint=u,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,r,l)}touchmove(e,r,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const u=r[0],g=u.y-this._swipePoint.y;return this._swipePoint=u,e.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(e,r,l)}touchend(e,r,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const u=this._tap.touchend(e,r,l);u&&(this._tapTime=e.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ot{constructor(e,r,l){this._el=e,this._mousePan=r,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Vt{constructor(e,r,l,u){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=r,this._mousePitch=l,this._mouseRoll=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class kt{constructor(e,r,l,u){this._el=e,this._touchZoom=r,this._touchRotate=l,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class it{constructor(e,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=N.create("div","maplibregl-cooperative-gesture-screen",e);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),u=document.createElement("div");u.className="maplibregl-desktop-message",u.textContent=r,this._container.appendChild(u);const g=document.createElement("div");g.className="maplibregl-mobile-message",g.textContent=l,this._container.appendChild(g),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(N.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,r){this._enabled&&(this._map.fire(new s.l("cooperativegestureprevented",{gestureType:e,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const st=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class Ut extends s.l{}function Ot(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class jt{constructor(e,r){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,g)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const P=u.type==="renderFrame"?void 0:u,I={needsRenderFrame:!1},E={},D={},q=u.touches,$=q?this._getMapTouches(q):void 0,W=$?N.touchPos(this._map.getCanvas(),$):N.mousePos(this._map.getCanvas(),u);for(const{handlerName:Pe,handler:be,allowed:Se}of this._handlers){if(!be.isEnabled())continue;let Ee;this._blockedByActive(D,Se,Pe)?be.reset():be[g||u.type]&&(Ee=be[g||u.type](u,W,$),this.mergeHandlerResult(I,E,Ee,Pe,P),Ee&&Ee.needsRenderFrame&&this._triggerRenderFrame()),(Ee||be.isActive())&&(D[Pe]=be)}const ie={};for(const Pe in this._previousActiveHandlers)D[Pe]||(ie[Pe]=P);this._previousActiveHandlers=D,(Object.keys(ie).length||Ot(I))&&(this._changes.push([I,E,ie]),this._triggerRenderFrame()),(Object.keys(D).length||Ot(I))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:se}=I;se&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],se(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Kc(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,g,P]of this._listeners)N.addEventListener(u,g,u===document?this.handleWindowEvent:this.handleEvent,P)}destroy(){for(const[e,r,l]of this._listeners)N.removeEventListener(e,r,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const r=this._map,l=r.getCanvasContainer();this._add("mapEvent",new Sa(r,e));const u=r.boxZoom=new wl(r,e);this._add("boxZoom",u),e.interactive&&e.boxZoom&&u.enable();const g=r.cooperativeGestures=new it(r,e.cooperativeGestures);this._add("cooperativeGestures",g),e.cooperativeGestures&&g.enable();const P=new Gl(r),I=new _t(r);r.doubleClickZoom=new rt(I,P),this._add("tapZoom",P),this._add("clickZoom",I),e.interactive&&e.doubleClickZoom&&r.doubleClickZoom.enable();const E=new ct;this._add("tapDragZoom",E);const D=r.touchPitch=new te(r);this._add("touchPitch",D),e.interactive&&e.touchPitch&&r.touchPitch.enable(e.touchPitch);const q=()=>r.project(r.getCenter()),$=function({enable:Ge,clickTolerance:Xe,aroundCenter:Je=!0,minPixelCenterThreshold:Ye=100,rotateDegreesPerPixelMoved:vt=.8},bt){const Mt=new Pl({checkCorrectEvent:Lt=>N.mouseButton(Lt)===0&&Lt.ctrlKey||N.mouseButton(Lt)===2&&!Lt.ctrlKey});return new Ts({clickTolerance:Xe,move:(Lt,It)=>{const tr=bt();if(Je&&Math.abs(tr.y-Lt.y)>Ye)return{bearingDelta:s.c9(new s.P(Lt.x,It.y),It,tr)};let Kt=(It.x-Lt.x)*vt;return Je&&It.y<tr.y&&(Kt=-Kt),{bearingDelta:Kt}},moveStateManager:Mt,enable:Ge,assignEvents:Ga})}(e,q),W=function({enable:Ge,clickTolerance:Xe,pitchDegreesPerPixelMoved:Je=-.5}){const Ye=new Pl({checkCorrectEvent:vt=>N.mouseButton(vt)===0&&vt.ctrlKey||N.mouseButton(vt)===2});return new Ts({clickTolerance:Xe,move:(vt,bt)=>({pitchDelta:(bt.y-vt.y)*Je}),moveStateManager:Ye,enable:Ge,assignEvents:Ga})}(e),ie=function({enable:Ge,clickTolerance:Xe,rollDegreesPerPixelMoved:Je=.3},Ye){const vt=new Pl({checkCorrectEvent:bt=>N.mouseButton(bt)===2&&bt.ctrlKey});return new Ts({clickTolerance:Xe,move:(bt,Mt)=>{const Lt=Ye();let It=(Mt.x-bt.x)*Je;return Mt.y<Lt.y&&(It=-It),{rollDelta:It}},moveStateManager:vt,enable:Ge,assignEvents:Ga})}(e,q);r.dragRotate=new Vt(e,$,W,ie),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",W,["mouseRotate","mouseRoll"]),this._add("mouseRoll",ie,["mousePitch"]),e.interactive&&e.dragRotate&&r.dragRotate.enable();const se=function({enable:Ge,clickTolerance:Xe}){const Je=new Pl({checkCorrectEvent:Ye=>N.mouseButton(Ye)===0&&!Ye.ctrlKey});return new Ts({clickTolerance:Xe,move:(Ye,vt)=>({around:vt,panDelta:vt.sub(Ye)}),activateOnStart:!0,moveStateManager:Je,enable:Ge,assignEvents:Ga})}(e),Pe=new vo(e,r);r.dragPan=new ot(l,se,Pe),this._add("mousePan",se),this._add("touchPan",Pe,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&r.dragPan.enable(e.dragPan);const be=new F,Se=new w;r.touchZoomRotate=new kt(l,Se,be,E),this._add("touchRotate",be,["touchPan","touchZoom"]),this._add("touchZoom",Se,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&r.touchZoomRotate.enable(e.touchZoomRotate);const Ee=r.scrollZoom=new Ce(r,()=>this._triggerRenderFrame());this._add("scrollZoom",Ee,["mousePan"]),e.interactive&&e.scrollZoom&&r.scrollZoom.enable(e.scrollZoom);const Ze=r.keyboard=new ce(r);this._add("keyboard",Ze),e.interactive&&e.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new Za(r))}_add(e,r,l){this._handlers.push({handlerName:e,handler:r,allowed:l}),this._handlersById[e]=r}stop(e){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!st(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,r,l){for(const u in e)if(u!==l&&(!r||r.indexOf(u)<0))return!0;return!1}_getMapTouches(e){const r=[];for(const l of e)this._el.contains(l.target)&&r.push(l);return r}mergeHandlerResult(e,r,l,u,g){if(!l)return;s.e(e,l);const P={handlerName:u,originalEvent:l.originalEvent||g};l.zoomDelta!==void 0&&(r.zoom=P),l.panDelta!==void 0&&(r.drag=P),l.rollDelta!==void 0&&(r.roll=P),l.pitchDelta!==void 0&&(r.pitch=P),l.bearingDelta!==void 0&&(r.rotate=P)}_applyChanges(){const e={},r={},l={};for(const[u,g,P]of this._changes)u.panDelta&&(e.panDelta=(e.panDelta||new s.P(0,0))._add(u.panDelta)),u.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+u.pitchDelta),u.rollDelta&&(e.rollDelta=(e.rollDelta||0)+u.rollDelta),u.around!==void 0&&(e.around=u.around),u.pinchAround!==void 0&&(e.pinchAround=u.pinchAround),u.noInertia&&(e.noInertia=u.noInertia),s.e(r,g),s.e(l,P);this._updateMapTransform(e,r,l),this._changes=[]}_updateMapTransform(e,r,l){const u=this._map,g=u._getTransformForUpdate(),P=u.terrain;if(!(Ot(e)||P&&this._terrainMovement))return this._fireEvents(r,l,!0);u._stop(!0);let{panDelta:I,zoomDelta:E,bearingDelta:D,pitchDelta:q,rollDelta:$,around:W,pinchAround:ie}=e;ie!==void 0&&(W=ie),W=W||u.transform.centerPoint,P&&!g.isPointOnMapSurface(W)&&(W=g.centerPoint);const se={panDelta:I,zoomDelta:E,rollDelta:$,pitchDelta:q,bearingDelta:D,around:W};this._map.cameraHelper.useGlobeControls&&!g.isPointOnMapSurface(W)&&(W=g.centerPoint);const Pe=W.distSqr(g.centerPoint)<.01?g.center:g.screenPointToLocation(I?W.sub(I):W);P?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(se,g),this._terrainMovement||!r.drag&&!r.zoom?r.drag&&this._terrainMovement?g.setCenter(g.screenPointToLocation(g.centerPoint.sub(I))):this._map.cameraHelper.handleMapControlsPan(se,g,Pe):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(se,g,Pe))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(se,g),this._map.cameraHelper.handleMapControlsPan(se,g,Pe)),u._applyUpdatedTransform(g),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(r,l,!0)}_fireEvents(e,r,l){const u=st(this._eventsInProgress),g=st(e),P={};for(const $ in e){const{originalEvent:W}=e[$];this._eventsInProgress[$]||(P[`${$}start`]=W),this._eventsInProgress[$]=e[$]}!u&&g&&this._fireEvent("movestart",g.originalEvent);for(const $ in P)this._fireEvent($,P[$]);g&&this._fireEvent("move",g.originalEvent);for(const $ in e){const{originalEvent:W}=e[$];this._fireEvent($,W)}const I={};let E;for(const $ in this._eventsInProgress){const{handlerName:W,originalEvent:ie}=this._eventsInProgress[$];this._handlersById[W].isActive()||(delete this._eventsInProgress[$],E=r[W]||ie,I[`${$}end`]=E)}for(const $ in I)this._fireEvent($,I[$]);const D=st(this._eventsInProgress),q=(u||g)&&!D;if(q&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const $=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&$.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform($)}if(l&&q){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),W=ie=>ie!==0&&-this._bearingSnap<ie&&ie<this._bearingSnap;!$||!$.essential&&J.prefersReducedMotion?(this._map.fire(new s.l("moveend",{originalEvent:E})),W(this._map.getBearing())&&this._map.resetNorth()):(W($.bearing||this._map.getBearing())&&($.bearing=0),$.freezeElevation=!0,this._map.easeTo($,{originalEvent:E})),this._updatingCamera=!1}}_fireEvent(e,r){this._map.fire(new s.l(e,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Ut("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ft extends s.E{constructor(e,r,l){super(),this._renderFrameCallback=()=>{const u=Math.min((J.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=l.bearingSnap,this.cameraHelper=r,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,r){e.apply(this.transform),this.transform=e,this.cameraHelper=r}getCenter(){return new s.Q(this.transform.center.lng,this.transform.center.lat)}setCenter(e,r){return this.jumpTo({center:e},r)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,r){return this.jumpTo({elevation:e},r),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,r,l){return e=s.P.convert(e).mult(-1),this.panTo(this.transform.center,s.e({offset:e},r),l)}panTo(e,r,l){return this.easeTo(s.e({center:e},r),l)}getZoom(){return this.transform.zoom}setZoom(e,r){return this.jumpTo({zoom:e},r),this}zoomTo(e,r,l){return this.easeTo(s.e({zoom:e},r),l)}zoomIn(e,r){return this.zoomTo(this.getZoom()+1,e,r),this}zoomOut(e,r){return this.zoomTo(this.getZoom()-1,e,r),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,r){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new s.l("movestart",r)).fire(new s.l("move",r)).fire(new s.l("moveend",r))),this}getBearing(){return this.transform.bearing}setBearing(e,r){return this.jumpTo({bearing:e},r),this}getPadding(){return this.transform.padding}setPadding(e,r){return this.jumpTo({padding:e},r),this}rotateTo(e,r,l){return this.easeTo(s.e({bearing:e},r),l)}resetNorth(e,r){return this.rotateTo(0,s.e({duration:1e3},e),r),this}resetNorthPitch(e,r){return this.easeTo(s.e({bearing:0,pitch:0,roll:0,duration:1e3},e),r),this}snapToNorth(e,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,r):this}getPitch(){return this.transform.pitch}setPitch(e,r){return this.jumpTo({pitch:e},r),this}getRoll(){return this.transform.roll}setRoll(e,r){return this.jumpTo({roll:e},r),this}cameraForBounds(e,r){e=dr.convert(e).adjustAntiMeridian();const l=r&&r.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,r)}_cameraForBoxAndBearing(e,r,l,u){const g={top:0,bottom:0,right:0,left:0};if(typeof(u=s.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const D=u.padding;u.padding={top:D,bottom:D,right:D,left:D}}const P=s.e(g,u.padding);u.padding=P;const I=this.transform,E=new dr(e,r);return this.cameraHelper.cameraForBoxAndBearing(u,P,E,l,I)}fitBounds(e,r,l){return this._fitInternal(this.cameraForBounds(e,r),r,l)}fitScreenCoordinates(e,r,l,u,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(s.P.convert(e)),this.transform.screenPointToLocation(s.P.convert(r)),l,u),u,g)}_fitInternal(e,r,l){return e?(delete(r=s.e(e,r)).padding,r.linear?this.easeTo(r,l):this.flyTo(r,l)):this}jumpTo(e,r){this.stop();const l=this._getTransformForUpdate();let u=!1,g=!1,P=!1;const I=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,e);const E=l.zoom!==I;return"elevation"in e&&l.elevation!==+e.elevation&&l.setElevation(+e.elevation),"bearing"in e&&l.bearing!==+e.bearing&&(u=!0,l.setBearing(+e.bearing)),"pitch"in e&&l.pitch!==+e.pitch&&(g=!0,l.setPitch(+e.pitch)),"roll"in e&&l.roll!==+e.roll&&(P=!0,l.setRoll(+e.roll)),e.padding==null||l.isPaddingEqual(e.padding)||l.setPadding(e.padding),this._applyUpdatedTransform(l),this.fire(new s.l("movestart",r)).fire(new s.l("move",r)),E&&this.fire(new s.l("zoomstart",r)).fire(new s.l("zoom",r)).fire(new s.l("zoomend",r)),u&&this.fire(new s.l("rotatestart",r)).fire(new s.l("rotate",r)).fire(new s.l("rotateend",r)),g&&this.fire(new s.l("pitchstart",r)).fire(new s.l("pitch",r)).fire(new s.l("pitchend",r)),P&&this.fire(new s.l("rollstart",r)).fire(new s.l("roll",r)).fire(new s.l("rollend",r)),this.fire(new s.l("moveend",r))}calculateCameraOptionsFromTo(e,r,l,u=0){const g=s.$.fromLngLat(e,r),P=s.$.fromLngLat(l,u),I=P.x-g.x,E=P.y-g.y,D=P.z-g.z,q=Math.hypot(I,E,D);if(q===0)throw new Error("Can't calculate camera options with same From and To");const $=Math.hypot(I,E),W=s.aa(this.transform.cameraToCenterDistance/q/this.transform.tileSize),ie=180*Math.atan2(I,-E)/Math.PI;let se=180*Math.acos($/q)/Math.PI;return se=D<0?90-se:90+se,{center:P.toLngLat(),elevation:u,zoom:W,pitch:se,bearing:ie}}calculateCameraOptionsFromCameraLngLatAltRotation(e,r,l,u,g){const P=this.transform.calculateCenterFromCameraLngLatAlt(e,r,l,u);return{center:P.center,elevation:P.elevation,zoom:P.zoom,bearing:l,pitch:u,roll:g}}easeTo(e,r){this._stop(!1,e.easeId),((e=s.e({offset:[0,0],duration:500,easing:s.ca},e)).animate===!1||!e.essential&&J.prefersReducedMotion)&&(e.duration=0);const l=this._getTransformForUpdate(),u=this.getBearing(),g=l.pitch,P=l.roll,I="bearing"in e?this._normalizeBearing(e.bearing,u):u,E="pitch"in e?+e.pitch:g,D="roll"in e?this._normalizeBearing(e.roll,P):P,q="padding"in e?e.padding:l.padding,$=s.P.convert(e.offset);let W,ie;e.around&&(W=s.Q.convert(e.around),ie=l.locationToScreenPoint(W));const se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Pe=this.cameraHelper.handleEaseTo(l,{bearing:I,pitch:E,roll:D,padding:q,around:W,aroundPoint:ie,offsetAsPoint:$,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||u!==I,this._pitching=this._pitching||E!==g,this._rolling=this._rolling||D!==P,this._padding=!l.isPaddingEqual(q),this._zooming=this._zooming||Pe.isZooming,this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,se),this.terrain&&this._prepareElevation(Pe.elevationCenter),this._ease(be=>{Pe.easeFunc(be),this.terrain&&!e.freezeElevation&&this._updateElevation(be),this._applyUpdatedTransform(l),this._fireMoveEvents(r)},be=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r,be)},e),this}_prepareEase(e,r,l={}){this._moving=!0,r||l.moving||this.fire(new s.l("movestart",e)),this._zooming&&!l.zooming&&this.fire(new s.l("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new s.l("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new s.l("pitchstart",e)),this._rolling&&!l.rolling&&this.fire(new s.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&r!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(r-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=r}this.transform.setElevation(s.B.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const r=e.getCameraLngLat(),l=e.getCameraAltitude(),u=this.terrain?this.terrain.getElevationForLngLatZoom(r,e.zoom):0;if(l<u){const g=this.calculateCameraOptionsFromTo(r,u,e.center,e.elevation);return{pitch:g.pitch,zoom:g.zoom}}return{}}_applyUpdatedTransform(e){const r=[];if(r.push(u=>this._elevateCameraIfInsideTerrain(u)),this.transformCameraUpdate&&r.push(u=>this.transformCameraUpdate(u)),!r.length)return;const l=e.clone();for(const u of r){const g=l.clone(),{center:P,zoom:I,roll:E,pitch:D,bearing:q,elevation:$}=u(g);P&&g.setCenter(P),$!==void 0&&g.setElevation($),I!==void 0&&g.setZoom(I),E!==void 0&&g.setRoll(E),D!==void 0&&g.setPitch(D),q!==void 0&&g.setBearing(q),l.apply(g)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new s.l("move",e)),this._zooming&&this.fire(new s.l("zoom",e)),this._rotating&&this.fire(new s.l("rotate",e)),this._pitching&&this.fire(new s.l("pitch",e)),this._rolling&&this.fire(new s.l("roll",e))}_afterEase(e,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const l=this._zooming,u=this._rotating,g=this._pitching,P=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new s.l("zoomend",e)),u&&this.fire(new s.l("rotateend",e)),g&&this.fire(new s.l("pitchend",e)),P&&this.fire(new s.l("rollend",e)),this.fire(new s.l("moveend",e))}flyTo(e,r){if(!e.essential&&J.prefersReducedMotion){const It=s.O(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(It,r)}this.stop(),e=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.ca},e);const l=this._getTransformForUpdate(),u=l.bearing,g=l.pitch,P=l.roll,I=l.padding,E="bearing"in e?this._normalizeBearing(e.bearing,u):u,D="pitch"in e?+e.pitch:g,q="roll"in e?this._normalizeBearing(e.roll,P):P,$="padding"in e?e.padding:l.padding,W=s.P.convert(e.offset);let ie=l.centerPoint.add(W);const se=l.screenPointToLocation(ie),Pe=this.cameraHelper.handleFlyTo(l,{bearing:E,pitch:D,roll:q,padding:$,locationAtOffset:se,offsetAsPoint:W,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let be=e.curve;const Se=Math.max(l.width,l.height),Ee=Se/Pe.scaleOfZoom,Ze=Pe.pixelPathLength;typeof Pe.scaleOfMinZoom=="number"&&(be=Math.sqrt(Se/Pe.scaleOfMinZoom/Ze*2));const Ge=be*be;function Xe(It){const tr=(Ee*Ee-Se*Se+(It?-1:1)*Ge*Ge*Ze*Ze)/(2*(It?Ee:Se)*Ge*Ze);return Math.log(Math.sqrt(tr*tr+1)-tr)}function Je(It){return(Math.exp(It)-Math.exp(-It))/2}function Ye(It){return(Math.exp(It)+Math.exp(-It))/2}const vt=Xe(!1);let bt=function(It){return Ye(vt)/Ye(vt+be*It)},Mt=function(It){return Se*((Ye(vt)*(Je(tr=vt+be*It)/Ye(tr))-Je(vt))/Ge)/Ze;var tr},Lt=(Xe(!0)-vt)/be;if(Math.abs(Ze)<2e-6||!isFinite(Lt)){if(Math.abs(Se-Ee)<1e-6)return this.easeTo(e,r);const It=Ee<Se?-1:1;Lt=Math.abs(Math.log(Ee/Se))/be,Mt=()=>0,bt=tr=>Math.exp(It*be*tr)}return e.duration="duration"in e?+e.duration:1e3*Lt/("screenSpeed"in e?+e.screenSpeed/be:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=u!==E,this._pitching=D!==g,this._rolling=q!==P,this._padding=!l.isPaddingEqual($),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(Pe.targetCenter),this._ease(It=>{const tr=It*Lt,Kt=1/bt(tr),Bt=Mt(tr);this._rotating&&l.setBearing(s.B.number(u,E,It)),this._pitching&&l.setPitch(s.B.number(g,D,It)),this._rolling&&l.setRoll(s.B.number(P,q,It)),this._padding&&(l.interpolatePadding(I,$,It),ie=l.centerPoint.add(W)),Pe.easeFunc(It,Kt,Bt,ie),this.terrain&&!e.freezeElevation&&this._updateElevation(It),this._applyUpdatedTransform(l),this._fireMoveEvents(r)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,r){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,r)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,r,l){l.animate===!1||l.duration===0?(e(1),r()):(this._easeStart=J.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,r){e=s.aK(e,-180,180);const l=Math.abs(e-r);return Math.abs(e-360-r)<l&&(e-=360),Math.abs(e+360-r)<l&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(s.Q.convert(e),this.transform.tileZoom):null}}const zt={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class kr{constructor(e=zt){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=N.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=N.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=N.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){N.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._sanitizedAttributionHTML=void 0}_setElementTitle(e,r){const l=this._map._getUIString(`AttributionControl.${r}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const r=this._map.style.sourceCaches;for(const u in r){const g=r[u];if(g.used||g.usedForTerrain){const P=g.getSource();P.attribution&&e.indexOf(P.attribution)<0&&e.push(P.attribution)}}e=e.filter(u=>String(u).trim()),e.sort((u,g)=>u.length-g.length),e=e.filter((u,g)=>{for(let P=g+1;P<e.length;P++)if(e[P].indexOf(u)>=0)return!1;return!0});const l=e.join(" | ");l!==this._sanitizedAttributionHTML&&(this._sanitizedAttributionHTML=N.sanitize(l),e.length?(this._innerContainer.innerHTML=this._sanitizedAttributionHTML,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class cr{constructor(e={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=N.create("div","maplibregl-ctrl");const r=N.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){N.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ui{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const r=++this._id;return this._queue.push({callback:e,id:r,cancelled:!1}),r}remove(e){const r=this._currentlyRunning,l=r?this._queue.concat(r):this._queue;for(const u of l)if(u.id===e)return void(u.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const l of r)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var $r=s.aC([{name:"a_pos3d",type:"Int16",components:3}]);class li extends s.E{constructor(e){super(),this._lastTilesetChange=J.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,r){this.sourceCache.update(e,r),this._renderableTilesKeys=[];const l={};for(const u of K(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))l[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.terrainRttPosMatrix32f=new Float64Array(16),s.bN(u.terrainRttPosMatrix32f,0,s.Z,s.Z,0,0,1),this._tiles[u.key]=new Mr(u,this.tileSize),this._lastTilesetChange=J.now());for(const u in this._tiles)l[u]||delete this._tiles[u]}freeRtt(e){for(const r in this._tiles){const l=this._tiles[r];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const r={};for(const l of this._renderableTilesKeys){const u=this._tiles[l].tileID,g=e.clone(),P=s.b1();if(u.canonical.equals(e.canonical))s.bN(P,0,s.Z,s.Z,0,0,1);else if(u.canonical.isChildOf(e.canonical)){const I=u.canonical.z-e.canonical.z,E=u.canonical.x-(u.canonical.x>>I<<I),D=u.canonical.y-(u.canonical.y>>I<<I),q=s.Z>>I;s.bN(P,0,q,q,0,0,1),s.L(P,P,[-E*q,-D*q,0])}else{if(!e.canonical.isChildOf(u.canonical))continue;{const I=e.canonical.z-u.canonical.z,E=e.canonical.x-(e.canonical.x>>I<<I),D=e.canonical.y-(e.canonical.y>>I<<I),q=s.Z>>I;s.bN(P,0,s.Z,s.Z,0,0,1),s.L(P,P,[E*q,D*q,0]),s.M(P,P,[1/2**I,1/2**I,0])}}g.terrainRttPosMatrix32f=new Float32Array(P),r[l]=g}return r}getSourceTile(e,r){const l=this.sourceCache._source;let u=e.overscaledZ-this.deltaZoom;if(u>l.maxzoom&&(u=l.maxzoom),u<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(u).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!g||!g.dem)&&r)for(;u>=l.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(e.scaledTo(u--).key);return g}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}}class qr{constructor(e,r,l){this._meshCache={},this.painter=e,this.sourceCache=new li(r),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,r,l,u=s.Z){var g;if(!(r>=0&&r<u&&l>=0&&l<u))return 0;const P=this.getTerrainData(e),I=(g=P.tile)===null||g===void 0?void 0:g.dem;if(!I)return 0;const E=s.cb([],[r/u*s.Z,l/u*s.Z],P.u_terrain_matrix),D=[E[0]*I.dim,E[1]*I.dim],q=Math.floor(D[0]),$=Math.floor(D[1]),W=D[0]-q,ie=D[1]-$;return I.get(q,$)*(1-W)*(1-ie)+I.get(q+1,$)*W*(1-ie)+I.get(q,$+1)*(1-W)*ie+I.get(q+1,$+1)*W*ie}getElevationForLngLatZoom(e,r){if(!s.cc(r,e.wrap()))return 0;const{tileID:l,mercatorX:u,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(e,r);return this.getElevation(l,u%s.Z,g%s.Z,s.Z)}getElevation(e,r,l,u=s.Z){return this.getDEMElevation(e,r,l,u)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const u=this.painter.context,g=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ae(u,g,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ae(u,new s.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.as([])}const r=this.sourceCache.getSourceTile(e,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const u=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new Ae(u,r.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),r.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const l=r&&r+r.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const u=this.sourceCache.sourceCache._source.maxzoom;let g=e.canonical.z-r.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=u?g=e.canonical.z-u:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const P=e.canonical.x-(e.canonical.x>>g<<g),I=e.canonical.y-(e.canonical.y>>g<<g),E=s.cd(new Float64Array(16),[1/(s.Z<<g),1/(s.Z<<g),0]);s.L(E,E,[P*s.Z,I*s.Z,0]),this._demMatrixCache[e.key]={matrix:E,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(e){const r=this.painter,l=r.width/devicePixelRatio,u=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ae(r.context,{width:l,height:u,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ae(r.context,{width:l,height:u,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(l,u,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,l,u))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,P=0;g<this._coordsTextureSize;g++)for(let I=0;I<this._coordsTextureSize;I++,P+=4)r[P+0]=255&I,r[P+1]=255&g,r[P+2]=I>>8<<4|g>>8,r[P+3]=0;const l=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),u=new Ae(e,l,e.gl.RGBA,{premultiply:!1});return u.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const r=new Uint8Array(4),l=this.painter.context,u=l.gl,g=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),P=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),I=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(g,I-P-1,1,1,u.RGBA,u.UNSIGNED_BYTE,r),l.bindFramebuffer.set(null);const E=r[0]+(r[2]>>4<<8),D=r[1]+((15&r[2])<<8),q=this.coordsIndex[255-r[3]],$=q&&this.sourceCache.getTileByID(q);if(!$)return null;const W=this._coordsTextureSize,ie=(1<<$.tileID.canonical.z)*W;return new s.$(($.tileID.canonical.x*W+E)/ie+$.tileID.wrap,($.tileID.canonical.y*W+D)/ie,this.getElevation($.tileID,E,D,W))}depthAtPoint(e){const r=new Uint8Array(4),l=this.painter.context,u=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),u.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,r),l.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(e){var r;const l=((r=this.painter.style.projection)===null||r===void 0?void 0:r.transitionState)>0,u=l&&e.canonical.y===0,g=l&&e.canonical.y===(1<<e.canonical.z)-1,P=`m_${u?"n":""}_${g?"s":""}`;if(this._meshCache[P])return this._meshCache[P];const I=this.painter.context,E=new s.ce,D=new s.aG,q=this.meshSize,$=s.Z/q,W=q*q;for(let Ye=0;Ye<=q;Ye++)for(let vt=0;vt<=q;vt++)E.emplaceBack(vt*$,Ye*$,0);for(let Ye=0;Ye<W;Ye+=q+1)for(let vt=0;vt<q;vt++)D.emplaceBack(vt+Ye,q+vt+Ye+1,q+vt+Ye+2),D.emplaceBack(vt+Ye,q+vt+Ye+2,vt+Ye+1);const ie=E.length,se=ie+(q+1),Pe=(q+1)*q,be=u?s.b8:0,Se=u?0:1,Ee=g?s.b9:s.Z,Ze=g?0:1;for(let Ye=0;Ye<=q;Ye++)E.emplaceBack(Ye*$,be,Se);for(let Ye=0;Ye<=q;Ye++)E.emplaceBack(Ye*$,Ee,Ze);for(let Ye=0;Ye<q;Ye++)D.emplaceBack(Pe+Ye,se+Ye,se+Ye+1),D.emplaceBack(Pe+Ye,se+Ye+1,Pe+Ye+1),D.emplaceBack(0+Ye,ie+Ye+1,ie+Ye),D.emplaceBack(0+Ye,0+Ye+1,ie+Ye+1);const Ge=E.length,Xe=Ge+2*(q+1);for(const Ye of[0,1])for(let vt=0;vt<=q;vt++)for(const bt of[0,1])E.emplaceBack(Ye*s.Z,vt*$,bt);for(let Ye=0;Ye<2*q;Ye+=2)D.emplaceBack(Ge+Ye,Ge+Ye+1,Ge+Ye+3),D.emplaceBack(Ge+Ye,Ge+Ye+3,Ge+Ye+2),D.emplaceBack(Xe+Ye,Xe+Ye+3,Xe+Ye+1),D.emplaceBack(Xe+Ye,Xe+Ye+2,Xe+Ye+3);const Je=new qn(I.createVertexBuffer(E,$r.members),I.createIndexBuffer(D),s.aF.simpleSegment(0,0,E.length,D.length));return this._meshCache[P]=Je,Je}getMeshFrameDelta(e){return 2*Math.PI*s.bq/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,r){var l;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(e,r);return(l=this.getMinMaxElevation(u).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const r=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return r&&r.dem&&(l.minElevation=r.dem.min*this.exaggeration,l.maxElevation=r.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,r){const l=s.$.fromLngLat(e.wrap()),u=(1<<r)*s.Z,g=l.x*u,P=l.y*u,I=Math.floor(g/s.Z),E=Math.floor(P/s.Z);return{tileID:new s.Y(r,0,r,I,E),mercatorX:g,mercatorY:P}}}class Ai{constructor(e,r,l){this._context=e,this._size=r,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new Ae(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(l.texture),{id:e,fbo:r,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(r=>e.id!==r),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const ni={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class br{constructor(e,r){this.painter=e,this.terrain=r,this.pool=new Ai(e.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(l=>!e._layers[l].isHidden(r)),this._coordsAscending={};for(const l in e.sourceCaches){this._coordsAscending[l]={};const u=e.sourceCaches[l].getVisibleCoordinates();for(const g of u){const P=this.terrain.sourceCache.getTerrainCoords(g);for(const I in P)this._coordsAscending[l][I]||(this._coordsAscending[l][I]=[]),this._coordsAscending[l][I].push(P[I])}}this._coordsAscendingStr={};for(const l of e._order){const u=e._layers[l],g=u.source;if(ni[u.type]&&!this._coordsAscendingStr[g]){this._coordsAscendingStr[g]={};for(const P in this._coordsAscending[g])this._coordsAscendingStr[g][P]=this._coordsAscending[g][P].map(I=>I.key).sort().join()}}for(const l of this._renderableTiles)for(const u in this._coordsAscendingStr){const g=this._coordsAscendingStr[u][l.tileID.key];g&&g!==l.rttCoords[u]&&(l.rtt=[])}}renderLayer(e,r){if(e.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},r),{isRenderingToTexture:!0}),u=e.type,g=this.painter,P=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(ni[u]&&(this._prevType&&ni[this._prevType]||this._stacks.push([]),this._prevType=u,this._stacks[this._stacks.length-1].push(e.id),!P))return!0;if(ni[this._prevType]||ni[u]&&P){this._prevType=u;const I=this._stacks.length-1,E=this._stacks[I]||[];for(const D of this._renderableTiles){if(this.pool.isFull()&&(Ec(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(D),D.rtt[I]){const $=this.pool.getObjectForId(D.rtt[I].id);if($.stamp===D.rtt[I].stamp){this.pool.useObject($);continue}}const q=this.pool.getOrCreateFreeObject();this.pool.useObject(q),this.pool.stampObject(q),D.rtt[I]={id:q.id,stamp:q.stamp},g.context.bindFramebuffer.set(q.fbo.framebuffer),g.context.clear({color:s.b6.transparent,stencil:0}),g.currentStencilSource=void 0;for(let $=0;$<E.length;$++){const W=g.style._layers[E[$]],ie=W.source?this._coordsAscending[W.source][D.tileID.key]:[D.tileID];g.context.viewport.set([0,0,q.fbo.width,q.fbo.height]),g._renderTileClippingMasks(W,ie,!0),g.renderLayer(g,g.style.sourceCaches[W.source],W,ie,l),W.source&&(D.rttCoords[W.source]=this._coordsAscendingStr[W.source][D.tileID.key])}}return Ec(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),ni[u]}return!1}}const Hr={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},rs=M,Fi={hash:!1,interactive:!0,bearingSnap:7,attributionControl:zt,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},kn={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class gi{constructor(e,r,l=!1){this.mousedown=g=>{this.startMove(g,N.mousePos(this.element,g)),N.addEventListener(window,"mousemove",this.mousemove),N.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=g=>{this.move(g,N.mousePos(this.element,g))},this.mouseup=g=>{this._rotatePitchHanlder.dragEnd(g),this.offTemp()},this.touchstart=g=>{g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=N.touchPos(this.element,g.targetTouches)[0],this.startMove(g,this._startPos),N.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.addEventListener(window,"touchend",this.touchend))},this.touchmove=g=>{g.targetTouches.length!==1?this.reset():(this._lastPos=N.touchPos(this.element,g.targetTouches)[0],this.move(g,this._lastPos))},this.touchend=g=>{g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=r;const u=new Jc;this._rotatePitchHanlder=new Ts({clickTolerance:3,move:(g,P)=>{const I=r.getBoundingClientRect(),E=new s.P((I.bottom-I.top)/2,(I.right-I.left)/2);return{bearingDelta:s.c9(new s.P(g.x,P.y),P,E),pitchDelta:l?-.5*(P.y-g.y):void 0}},moveStateManager:u,enable:!0,assignEvents:()=>{}}),this.map=e,N.addEventListener(r,"mousedown",this.mousedown),N.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),N.addEventListener(r,"touchcancel",this.reset)}startMove(e,r){this._rotatePitchHanlder.dragStart(e,r),N.disableDrag()}move(e,r){const l=this.map,{bearingDelta:u,pitchDelta:g}=this._rotatePitchHanlder.dragMove(e,r)||{};u&&l.setBearing(l.getBearing()+u),g&&l.setPitch(l.getPitch()+g)}off(){const e=this.element;N.removeEventListener(e,"mousedown",this.mousedown),N.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend),N.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){N.enableDrag(),N.removeEventListener(window,"mousemove",this.mousemove),N.removeEventListener(window,"mouseup",this.mouseup),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend)}}let nn;function Gn(m,e,r){const l=new s.Q(m.lng,m.lat);if(m=new s.Q(m.lng,m.lat),e){const u=new s.Q(m.lng-360,m.lat),g=new s.Q(m.lng+360,m.lat),P=r.locationToScreenPoint(m).distSqr(e);r.locationToScreenPoint(u).distSqr(e)<P?m=u:r.locationToScreenPoint(g).distSqr(e)<P&&(m=g)}for(;Math.abs(m.lng-r.center.lng)>180;){const u=r.locationToScreenPoint(m);if(u.x>=0&&u.y>=0&&u.x<=r.width&&u.y<=r.height)break;m.lng>r.center.lng?m.lng-=360:m.lng+=360}return m.lng!==l.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(m))?m:l}const Vi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function fn(m,e,r){const l=m.classList;for(const u in Vi)l.remove(`maplibregl-${r}-anchor-${u}`);l.add(`maplibregl-${r}-anchor-${e}`)}class yn extends s.E{constructor(e){if(super(),this._onKeyPress=r=>{const l=r.code,u=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=r=>{const l=r.originalEvent.target,u=this._element;this._popup&&(l===u||u.contains(l))&&this.togglePopup()},this._update=r=>{var l;if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();((r==null?void 0:r.type)==="terrain"||(r==null?void 0:r.type)==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Gn(this._lngLat,this._flatPos,this._map.transform):(l=this._lngLat)===null||l===void 0?void 0:l.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(g=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let P="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?P="rotateX(0deg)":this._pitchAlignment==="map"&&(P=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),N.setTransform(this._element,`${Vi[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${P} ${g}`),J.frameAsync(new AbortController).then(()=>{this._updateOpacity(r&&r.type==="moveend")}).catch(()=>{})},this._onMove=r=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.l("dragstart"))),this.fire(new s.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.l("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=s.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=N.create("div");const r=N.createNS("http://www.w3.org/2000/svg","svg"),l=41,u=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${l}px`),r.setAttributeNS(null,"width",`${u}px`),r.setAttributeNS(null,"viewBox",`0 0 ${u} ${l}`);const g=N.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const P=N.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");const I=N.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Se of E){const Ee=N.createNS("http://www.w3.org/2000/svg","ellipse");Ee.setAttributeNS(null,"opacity","0.04"),Ee.setAttributeNS(null,"cx","10.5"),Ee.setAttributeNS(null,"cy","5.80029008"),Ee.setAttributeNS(null,"rx",Se.rx),Ee.setAttributeNS(null,"ry",Se.ry),I.appendChild(Ee)}const D=N.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill",this._color);const q=N.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),D.appendChild(q);const $=N.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"opacity","0.25"),$.setAttributeNS(null,"fill","#000000");const W=N.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),$.appendChild(W);const ie=N.createNS("http://www.w3.org/2000/svg","g");ie.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ie.setAttributeNS(null,"fill","#FFFFFF");const se=N.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Pe=N.createNS("http://www.w3.org/2000/svg","circle");Pe.setAttributeNS(null,"fill","#000000"),Pe.setAttributeNS(null,"opacity","0.25"),Pe.setAttributeNS(null,"cx","5.5"),Pe.setAttributeNS(null,"cy","5.5"),Pe.setAttributeNS(null,"r","5.4999962");const be=N.createNS("http://www.w3.org/2000/svg","circle");be.setAttributeNS(null,"fill","#FFFFFF"),be.setAttributeNS(null,"cx","5.5"),be.setAttributeNS(null,"cy","5.5"),be.setAttributeNS(null,"r","5.4999962"),se.appendChild(Pe),se.appendChild(be),P.appendChild(I),P.appendChild(D),P.appendChild($),P.appendChild(ie),P.appendChild(se),r.appendChild(P),r.setAttributeNS(null,"height",l*this._scale+"px"),r.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(r),this._offset=s.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",r=>{r.preventDefault()}),this._element.addEventListener("mousedown",r=>{r.preventDefault()}),fn(this._element,this._anchor,"marker"),e&&e.className)for(const r of e.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),N.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=s.Q.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const u=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var r,l;if(!(!((r=this._map)===null||r===void 0)&&r.terrain)){const $=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==$&&(this._element.style.opacity=$))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const u=this._map,g=u.terrain.depthAtPoint(this._pos),P=u.terrain.getElevationForLngLatZoom(this._lngLat,u.transform.tileZoom);if(u.transform.lngLatToCameraDepth(this._lngLat,P)-g<.006)return void(this._element.style.opacity=this._opacity);const I=-this._offset.y/u.transform.pixelsPerMeter,E=Math.sin(u.getPitch()*Math.PI/180)*I,D=u.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),q=u.transform.lngLatToCameraDepth(this._lngLat,P+E)-D>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&q&&this._popup.remove(),this._element.style.opacity=q?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=s.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,r){return(this._opacity===void 0||e===void 0&&r===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}const fs={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let is=0,Ui=!1;const oa={maxWidth:100,unit:"metric"};function Aa(m,e,r){const l=r&&r.maxWidth||100,u=m._container.clientHeight/2,g=m._container.clientWidth/2,P=m.unproject([g-l/2,u]),I=m.unproject([g+l/2,u]),E=Math.round(m.project(I).x-m.project(P).x),D=Math.min(l,E,m._container.clientWidth),q=P.distanceTo(I);if(r&&r.unit==="imperial"){const $=3.2808*q;$>5280?qs(e,D,$/5280,m._getUIString("ScaleControl.Miles")):qs(e,D,$,m._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?qs(e,D,q/1852,m._getUIString("ScaleControl.NauticalMiles")):q>=1e3?qs(e,D,q/1e3,m._getUIString("ScaleControl.Kilometers")):qs(e,D,q,m._getUIString("ScaleControl.Meters"))}function qs(m,e,r,l){const u=function(g){const P=Math.pow(10,`${Math.floor(g)}`.length-1);let I=g/P;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(E){const D=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*D)/D}(I),P*I}(r);m.style.width=e*(u/r)+"px",m.innerHTML=`${u}&nbsp;${l}`}const la={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Zi=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Sl(m){if(m){if(typeof m=="number"){const e=Math.round(Math.abs(m)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,m),"top-left":new s.P(e,e),"top-right":new s.P(-e,e),bottom:new s.P(0,-m),"bottom-left":new s.P(e,-e),"bottom-right":new s.P(-e,-e),left:new s.P(m,0),right:new s.P(-m,0)}}if(m instanceof s.P||Array.isArray(m)){const e=s.P.convert(m);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:s.P.convert(m.center||[0,0]),top:s.P.convert(m.top||[0,0]),"top-left":s.P.convert(m["top-left"]||[0,0]),"top-right":s.P.convert(m["top-right"]||[0,0]),bottom:s.P.convert(m.bottom||[0,0]),"bottom-left":s.P.convert(m["bottom-left"]||[0,0]),"bottom-right":s.P.convert(m["bottom-right"]||[0,0]),left:s.P.convert(m.left||[0,0]),right:s.P.convert(m.right||[0,0])}}return Sl(new s.P(0,0))}const Wl=M;f.AJAXError=s.ci,f.Event=s.l,f.Evented=s.E,f.LngLat=s.Q,f.MercatorCoordinate=s.$,f.Point=s.P,f.addProtocol=s.cj,f.config=s.a,f.removeProtocol=s.ck,f.AttributionControl=kr,f.BoxZoomHandler=wl,f.CanvasSource=or,f.CooperativeGesturesHandler=it,f.DoubleClickZoomHandler=rt,f.DragPanHandler=ot,f.DragRotateHandler=Vt,f.EdgeInsets=Ti,f.FullscreenControl=class extends s.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var e;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=r==null?void 0:r.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){N.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=N.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);N.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},f.GeoJSONSource=Xt,f.GeolocateControl=class extends s.E{constructor(m){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new s.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const r=new s.Q(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,u=this._map.getBearing(),g=s.e({bearing:u},this.options.fitBoundsOptions),P=dr.fromLngLat(r,l);this._map.fitBounds(P,g,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const r=new s.Q(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Ui)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=N.create("button","maplibregl-ctrl-geolocate",this._container),N.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=N.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new yn({element:this._dotElement}),this._circleElement=N.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new yn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.l("trackuserlocationend")),this.fire(new s.l("userlocationlostfocus")))})}},this.options=s.e({},fs,m)}onAdd(m){return this._map=m,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return s._(this,arguments,void 0,function*(e=!1){if(nn!==void 0&&!e)return nn;if(window.navigator.permissions===void 0)return nn=!!window.navigator.geolocation,nn;try{nn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{nn=!!window.navigator.geolocation}return nn})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),N.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,is=0,Ui=!1}_isOutOfMapMaxBounds(m){const e=this._map.getMaxBounds(),r=m.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const m=this._map.getBounds(),e=m.getSouthEast(),r=m.getNorthEast(),l=e.distanceTo(r),u=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":is--,Ui=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.l("trackuserlocationstart")),this.fire(new s.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),is++,is>1?(m={maximumAge:6e5,timeout:0},Ui=!0):(m=this.options.positionOptions,Ui=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},f.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;const e=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=N.create("button","maplibregl-ctrl-globe",this._container),N.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){N.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},f.Hash=es,f.ImageSource=ir,f.KeyboardHandler=ce,f.LngLatBounds=dr,f.LogoControl=cr,f.Map=class extends Ft{constructor(m){var e,r;s.cf.mark(s.cg.create);const l=Object.assign(Object.assign(Object.assign({},Fi),m),{canvasContextAttributes:Object.assign(Object.assign({},Fi.canvasContextAttributes),m.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const u=new Lr,g=new us;if(l.minZoom!==void 0&&u.setMinZoom(l.minZoom),l.maxZoom!==void 0&&u.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&u.setMinPitch(l.minPitch),l.maxPitch!==void 0&&u.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&u.setRenderWorldCopies(l.renderWorldCopies),super(u,g,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new ui,this._controls=[],this._mapId=s.a3(),this._contextLost=I=>{I.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.l("webglcontextlost",{originalEvent:I}))},this._contextRestored=I=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.l("webglcontextrestored",{originalEvent:I}))},this._onMapScroll=I=>{if(I.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Hr),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this.transformCameraUpdate=l.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Oe.addThrottleControl(()=>this.isMoving()),this._requestManager=new Le(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let I=!1;const E=zc(D=>{this._trackResize&&!this._removed&&(this.resize(D),this.redraw())},50);this._resizeObserver=new ResizeObserver(D=>{I?E(D):I=!0}),this._resizeObserver.observe(this._container)}this.handlers=new jt(this,l),this._hash=l.hash&&new es(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,s.e({},l.fitBoundsOptions,{duration:0}))));const P=typeof l.style=="string"||((r=(e=l.style)===null||e===void 0?void 0:e.projection)===null||r===void 0?void 0:r.type)!=="globe";this.resize(null,P),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new kr(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new cr,l.logoPosition),this.on("style.load",()=>{if(P||this._resizeTransform(),this.transform.unmodified){const I=s.O(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(I)}}),this.on("data",I=>{this._update(I.dataType==="style"),this.fire(new s.l(`${I.dataType}data`,I))}),this.on("dataloading",I=>{this.fire(new s.l(`${I.dataType}dataloading`,I))}),this.on("dataabort",I=>{this.fire(new s.l("sourcedataabort",I))})}_getMapId(){return this._mapId}addControl(m,e){if(e===void 0&&(e=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new s.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=m.onAdd(this);this._controls.push(m);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(r,l.firstChild):l.appendChild(r),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new s.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(m);return e>-1&&this._controls.splice(e,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,e,r,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,e,r,l)}resize(m,e=!0){const[r,l]=this._containerDimensions(),u=this._getClampedPixelRatio(r,l);if(this._resizeCanvas(r,l,u),this.painter.resize(r,l,u),this.painter.overLimit()){const P=this.painter.context.gl;this._maxCanvasSize=[P.drawingBufferWidth,P.drawingBufferHeight];const I=this._getClampedPixelRatio(r,l);this._resizeCanvas(r,l,I),this.painter.resize(r,l,I)}this._resizeTransform(e);const g=!this._moving;return g&&(this.stop(),this.fire(new s.l("movestart",m)).fire(new s.l("move",m))),this.fire(new s.l("resize",m)),g&&this.fire(new s.l("moveend",m)),this}_resizeTransform(m=!0){var e;const[r,l]=this._containerDimensions();this.transform.resize(r,l,m),(e=this._requestedCameraState)===null||e===void 0||e.resize(r,l,m)}_getClampedPixelRatio(m,e){const{0:r,1:l}=this._maxCanvasSize,u=this.getPixelRatio(),g=m*u,P=e*u;return Math.min(g>r?r/g:1,P>l?l/P:1)*u}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(dr.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.setMinZoom(m),this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.setMaxZoom(m),this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}project(m){return this.transform.locationToScreenPoint(s.Q.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(s.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,e,r){if(m==="mouseenter"||m==="mouseover"){let l=!1;return{layers:e,listener:r,delegates:{mousemove:g=>{const P=e.filter(E=>this.getLayer(E)),I=P.length!==0?this.queryRenderedFeatures(g.point,{layers:P}):[];I.length?l||(l=!0,r.call(this,new qi(m,this,g.originalEvent,{features:I}))):l=!1},mouseout:()=>{l=!1}}}}if(m==="mouseleave"||m==="mouseout"){let l=!1;return{layers:e,listener:r,delegates:{mousemove:P=>{const I=e.filter(E=>this.getLayer(E));(I.length!==0?this.queryRenderedFeatures(P.point,{layers:I}):[]).length?l=!0:l&&(l=!1,r.call(this,new qi(m,this,P.originalEvent)))},mouseout:P=>{l&&(l=!1,r.call(this,new qi(m,this,P.originalEvent)))}}}}{const l=u=>{const g=e.filter(I=>this.getLayer(I)),P=g.length!==0?this.queryRenderedFeatures(u.point,{layers:g}):[];P.length&&(u.features=P,r.call(this,u),delete u.features)};return{layers:e,listener:r,delegates:{[m]:l}}}}_saveDelegatedListener(m,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(e)}_removeDelegatedListener(m,e,r){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const l=this._delegatedListeners[m];for(let u=0;u<l.length;u++){const g=l[u];if(g.listener===r&&g.layers.length===e.length&&g.layers.every(P=>e.includes(P))){for(const P in g.delegates)this.off(P,g.delegates[P]);return void l.splice(u,1)}}}on(m,e,r){if(r===void 0)return super.on(m,e);const l=typeof e=="string"?[e]:e,u=this._createDelegatedListener(m,l,r);this._saveDelegatedListener(m,u);for(const g in u.delegates)this.on(g,u.delegates[g]);return{unsubscribe:()=>{this._removeDelegatedListener(m,l,r)}}}once(m,e,r){if(r===void 0)return super.once(m,e);const l=typeof e=="string"?[e]:e,u=this._createDelegatedListener(m,l,r);for(const g in u.delegates){const P=u.delegates[g];u.delegates[g]=(...I)=>{this._removeDelegatedListener(m,l,r),P(...I)}}this._saveDelegatedListener(m,u);for(const g in u.delegates)this.once(g,u.delegates[g]);return this}off(m,e,r){return r===void 0?super.off(m,e):(this._removeDelegatedListener(m,typeof e=="string"?[e]:e,r),this)}queryRenderedFeatures(m,e){if(!this.style)return[];let r;const l=m instanceof s.P||Array.isArray(m),u=l?m:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:m)||{},u instanceof s.P||typeof u[0]=="number")r=[s.P.convert(u)];else{const g=s.P.convert(u[0]),P=s.P.convert(u[1]);r=[g,new s.P(P.x,g.y),P,new s.P(g.x,P.y),g]}return this.style.queryRenderedFeatures(r,e,this.transform)}querySourceFeatures(m,e){return this.style.querySourceFeatures(m,e)}setStyle(m,e){return(e=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(m,e))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const e=this._locale[m];if(e==null)throw new Error(`Missing UI string '${m}'`);return e}_updateStyle(m,e){var r,l;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(m,e));const u=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new ya(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,e,u):this.style.loadJSON(m,e,u),this):((l=(r=this.style)===null||r===void 0?void 0:r.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ya(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,e){if(typeof m=="string"){const r=this._requestManager.transformRequest(m,"Style");s.j(r,new AbortController).then(l=>{this._updateDiff(l.data,e)}).catch(l=>{l&&this.fire(new s.k(l))})}else typeof m=="object"&&this._updateDiff(m,e)}_updateDiff(m,e){try{this.style.setState(m,e)&&this._update(!0)}catch(r){s.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(m,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(m,e){return this._lazyInitEmptyStyle(),this.style.addSource(m,e),this._update(!0)}isSourceLoaded(m){const e=this.style&&this.style.sourceCaches[m];if(e!==void 0)return e.loaded();this.fire(new s.k(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const e=this.style.sourceCaches[m.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&e.reload();for(const r in this.style._layers){const l=this.style._layers[r];l.type==="hillshade"&&l.source===m.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new qr(this.painter,e,m),this.painter.renderToTexture=new br(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=r=>{r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new s.l("terrain",{terrain:m})),this}getTerrain(){var m,e;return(e=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const e in m){const r=m[e]._tiles;for(const l in r){const u=r[l];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,e,r={}){const{pixelRatio:l=1,sdf:u=!1,stretchX:g,stretchY:P,content:I,textFitWidth:E,textFitHeight:D}=r;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||s.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:q,height:$,data:W}=e,ie=e;return this.style.addImage(m,{data:new s.R({width:q,height:$},new Uint8Array(W)),pixelRatio:l,stretchX:g,stretchY:P,content:I,textFitWidth:E,textFitHeight:D,sdf:u,version:0,userImage:ie}),ie.onAdd&&ie.onAdd(this,m),this}}{const{width:q,height:$,data:W}=J.getImageData(e);this.style.addImage(m,{data:new s.R({width:q,height:$},W),pixelRatio:l,stretchX:g,stretchY:P,content:I,textFitWidth:E,textFitHeight:D,sdf:u,version:0})}}updateImage(m,e){const r=this.style.getImage(m);if(!r)return this.fire(new s.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||s.b(e)?J.getImageData(e):e,{width:u,height:g,data:P}=l;if(u===void 0||g===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==r.data.width||g!==r.data.height)return this.fire(new s.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const I=!(e instanceof HTMLImageElement||s.b(e));return r.data.replace(P,I),this.style.updateImage(m,r),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new s.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return Oe.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,e){return this._lazyInitEmptyStyle(),this.style.addLayer(m,e),this._update(!0)}moveLayer(m,e){return this.style.moveLayer(m,e),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,e,r){return this.style.setLayerZoomRange(m,e,r),this._update(!0)}setFilter(m,e,r={}){return this.style.setFilter(m,e,r),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,e,r,l={}){return this.style.setPaintProperty(m,e,r,l),this._update(!0)}getPaintProperty(m,e){return this.style.getPaintProperty(m,e)}setLayoutProperty(m,e,r,l={}){return this.style.setLayoutProperty(m,e,r,l),this._update(!0)}getLayoutProperty(m,e){return this.style.getLayoutProperty(m,e)}setGlyphs(m,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,e,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,e,r,l=>{l||this._update(!0)}),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,e,r=>{r||this._update(!0)}),this}setLight(m,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,e){return this.style.setFeatureState(m,e),this._update()}removeFeatureState(m,e){return this.style.removeFeatureState(m,e),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,e=0;return this._container&&(m=this._container.clientWidth||400,e=this._container.clientHeight||300),[m,e]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const e=this._canvasContainer=N.create("div","maplibregl-canvas-container",m);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=N.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),l=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],l);const u=this._controlContainer=N.create("div","maplibregl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(P=>{g[P]=N.create("div",`maplibregl-ctrl-${P} `,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,e,r){this._canvas.width=Math.floor(r*m),this._canvas.height=Math.floor(r*e),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{e={requestedAttributes:m},l&&(e.statusMessage=l.statusMessage,e.type=l.type)},{once:!0});let r=null;if(r=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!r){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new Xc(r,this.transform),de.testSupport(r)}migrateProjection(m,e){super.migrateProjection(m,e),this.painter.transform=m,this.fire(new s.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var e,r,l,u,g;const P=this._idleTriggered?this._fadeDuration:0,I=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let E=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const $=this.transform.zoom,W=J.now();this.style.zoomHistory.update($,W);const ie=new s.C($,{now:W,fadeDuration:P,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),se=ie.crossFadingFactor();se===1&&se===this._crossFadingFactor||(E=!0,this._crossFadingFactor=se),this.style.update(ie)}const D=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0!==I;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((u=this.style.projection)===null||u===void 0?void 0:u.transitionState,(g=this.style.projection)===null||g===void 0?void 0:g.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||D)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,P,this._crossSourceCollisions,D),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:P,showPadding:this.showPadding}),this.fire(new s.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.cf.mark(s.cg.load),this.fire(new s.l("load"))),this.style&&(this.style.hasTransitions()||E)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const q=this._sourcesDirty||this._styleDirty||this._placementDirty;return q||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.l("idle")),!this._loaded||this._fullyLoaded||q||(this._fullyLoaded=!0,s.cf.mark(s.cg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Oe.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),N.remove(this._canvasContainer),N.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),s.cf.clearMetrics(),this._removed=!0,this.fire(new s.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,J.frame(this._frameRequest,m=>{s.cf.frame(m),this._frameRequest=null;try{this._render(m)}catch(e){if(!s.ch(e)&&!function(r){return r.message===gl}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return rs}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},f.MapMouseEvent=qi,f.MapTouchEvent=ts,f.MapWheelEvent=cc,f.Marker=yn,f.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const e=this._map.getZoom(),r=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,r)=>{const l=this._map._getUIString(`NavigationControl.${r}`);e.title=l,e.setAttribute("aria-label",l)},this.options=s.e({},kn,m),this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),N.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),N.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=N.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new gi(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){N.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,e){const r=N.create("button",m,this._container);return r.type="button",r.addEventListener("click",e),r}},f.Popup=class extends s.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&N.remove(this._content),this._container&&(N.remove(this._container),delete this._container),this._closeButton&&this._closeButton.removeEventListener("click",this._onClose),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var r;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=N.create("div","maplibregl-popup",this._map.getContainer()),this._tip=N.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const I of this.options.className.split(" "))this._container.classList.add(I);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Gn(this._lngLat,this._flatPos,this._map.transform):(r=this._lngLat)===null||r===void 0?void 0:r.wrap(),this._trackPointer&&!e)return;const l=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let u=this.options.anchor;const g=Sl(this.options.offset);if(!u){const I=this._container.offsetWidth,E=this._container.offsetHeight;let D;D=l.y+g.bottom.y<E?["top"]:l.y>this._map.transform.height-E?["bottom"]:[],l.x<I/2?D.push("left"):l.x>this._map.transform.width-I/2&&D.push("right"),u=D.length===0?"bottom":D.join("-")}let P=l.add(g[u]);this.options.subpixelPositioning||(P=P.round()),N.setTransform(this._container,`${Vi[u]} translate(${P.x}px,${P.y}px)`),fn(this._container,u,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(la),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=s.Q.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const e=document.createDocumentFragment(),r=document.createElement("body");let l;for(r.innerHTML=m;l=r.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=N.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=N.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Zi);m&&m.focus()}},f.RasterDEMTileSource=yr,f.RasterTileSource=zr,f.ScaleControl=class{constructor(m){this._onMove=()=>{Aa(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Aa(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},oa),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){N.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},f.ScrollZoomHandler=Ce,f.Style=ya,f.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=N.create("button","maplibregl-ctrl-terrain",this._container),N.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){N.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},f.TwoFingersTouchPitchHandler=te,f.TwoFingersTouchRotateHandler=F,f.TwoFingersTouchZoomHandler=w,f.TwoFingersTouchZoomRotateHandler=kt,f.VectorTileSource=qe,f.VideoSource=ar,f.addSourceType=(m,e)=>s._(void 0,void 0,void 0,function*(){if(wr(m))throw new Error(`A source type called "${m}" already exists.`);((r,l)=>{xr[r]=l})(m,e)}),f.clearPrewarmedResources=function(){const m=Re;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(sr),Re=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},f.createTileMesh=Qs,f.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},f.getRTLTextPluginStatus=function(){return Jr().getRTLTextPluginStatus()},f.getVersion=function(){return Wl},f.getWorkerCount=function(){return ne.workerCount},f.getWorkerUrl=function(){return s.a.WORKER_URL},f.importScriptInWorkers=function(m){return pt().broadcast("IS",m)},f.prewarm=function(){nt().acquire(sr)},f.setMaxParallelImageRequests=function(m){s.a.MAX_PARALLEL_IMAGE_REQUESTS=m},f.setRTLTextPlugin=function(m,e){return Jr().setRTLTextPlugin(m,e)},f.setWorkerCount=function(m){ne.workerCount=m},f.setWorkerUrl=function(m){s.a.WORKER_URL=m}});var y=c;return y})}(Gh)),Gh.exports}var $g=v1();const _u=_1($g);function rp(h,a,c,p){function v(y){return y instanceof c?y:new c(function(f){f(y)})}return new(c||(c=Promise))(function(y,f){function s(V){try{B(p.next(V))}catch(U){f(U)}}function M(V){try{B(p.throw(V))}catch(U){f(U)}}function B(V){V.done?y(V.value):v(V.value).then(s,M)}B((p=p.apply(h,a||[])).next())})}var Bh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ad(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var ip,Qm;function Wg(){if(Qm)return ip;Qm=1,ip=a;var h=Object.prototype.hasOwnProperty;function a(){for(var c={},p=0;p<arguments.length;p++){var v=arguments[p];for(var y in v)h.call(v,y)&&(c[y]=v[y])}return c}return ip}var np={exports:{}},eg;function b1(){return eg||(eg=1,function(h,a){(function(){var c={};h.exports=c,c.simpleFilter=function(p,v){return v.filter(function(y){return c.test(p,y)})},c.test=function(p,v){return c.match(p,v)!==null},c.match=function(p,v,y){y=y||{};var f=0,s=[],M=v.length,B=0,V=0,U=y.pre||"",J=y.post||"",N=y.caseSensitive&&v||v.toLowerCase(),de;p=y.caseSensitive&&p||p.toLowerCase();for(var pe=0;pe<M;pe++)de=v[pe],N[pe]===p[f]?(de=U+de+J,f+=1,V+=1+V):V=0,B+=V,s[s.length]=de;return f===p.length?(B=N===p?1/0:B,{rendered:s.join(""),score:B}):null},c.filter=function(p,v,y){return!v||v.length===0?[]:typeof p!="string"?v:(y=y||{},v.reduce(function(f,s,M,B){var V=s;y.extract&&(V=y.extract(s));var U=c.match(p,V,y);return U!=null&&(f[f.length]={string:U.rendered,score:U.score,index:M,original:s}),f},[]).sort(function(f,s){var M=s.score-f.score;return M||f.index-s.index}))}})()}(np)),np.exports}var sp,tg;function x1(){if(tg)return sp;tg=1;var h=function(a){return this.component=a,this.items=[],this.active=a.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,a.el.parentNode.insertBefore(this.wrapper,a.el.nextSibling),this};return h.prototype.show=function(){this.element.style.display="block"},h.prototype.hide=function(){this.element.style.display="none"},h.prototype.add=function(a){this.items.push(a)},h.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0},h.prototype.isEmpty=function(){return!this.items.length},h.prototype.isVisible=function(){return this.element.style.display==="block"},h.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var a=0;a<this.items.length;a++)this.drawItem(this.items[a],this.active===a);this.show()},h.prototype.drawItem=function(a,c){var p=document.createElement("li"),v=document.createElement("a");c&&(p.className+=" active"),v.innerHTML=a.string,p.appendChild(v),this.element.appendChild(p),p.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),p.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,a)}).bind(this))},h.prototype.handleMouseUp=function(a){this.selectingListItem=!1,this.component.value(a.original),this.clear(),this.draw()},h.prototype.move=function(a){this.active=a,this.draw()},h.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)},h.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)},h.prototype.drawError=function(a){var c=document.createElement("li");c.innerHTML=a,this.element.appendChild(c),this.show()},sp=h,sp}var ap,rg;function w1(){if(rg)return ap;rg=1;var h=Wg(),a=b1(),c=x1(),p=function(v,y,f){return f=f||{},this.options=h({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},f),this.el=v,this.data=y||[],this.list=new c(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(s){this.handleKeyUp(s.keyCode,s)}).bind(this),!1),this.el.addEventListener("keydown",(function(s){this.handleKeyDown(s)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(s){this.handlePaste(s)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};return p.prototype.handleKeyUp=function(v,y){if(!(v===40||v===38||v===27||v===9)){if(v===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),y.stopPropagation());return}this.handleInputChange(this.el.value)}},p.prototype.handleKeyDown=function(v){switch(v.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&v.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},p.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},p.prototype.handlePaste=function(v){if(v.clipboardData)this.handleInputChange(v.clipboardData.getData("Text"));else{var y=this;setTimeout(function(){y.handleInputChange(v.target.value)},100)}},p.prototype.handleInputChange=function(v){if(this.query=this.normalize(v),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(y){for(var f=0;f<y.length&&(this.list.add(y[f]),f!==this.options.limit-1);f++);this.list.draw()}).bind(this))},p.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},p.prototype.update=function(v){this.data=v,this.handleKeyUp()},p.prototype.clear=function(){this.data=[],this.list.clear()},p.prototype.normalize=function(v){return v=v.toLowerCase(),v},p.prototype.match=function(v,y){return v.indexOf(y)>-1},p.prototype.value=function(v){if(this.selected=v,this.el.value=this.getItemValue(v||{place_name:this.query}),document.createEvent){var y=document.createEvent("HTMLEvents");y.initEvent("change",!0,!1),this.el.dispatchEvent(y)}else this.el.fireEvent("onchange")},p.prototype.getCandidates=function(v){var y={pre:"<strong>",post:"</strong>",extract:(function(s){return this.getItemValue(s)}).bind(this)},f;this.options.filter?(f=a.filter(this.query,this.data,y),f=f.map((function(s){return{original:s.original,string:this.render(s.original,s.string)}}).bind(this))):f=this.data.map((function(s){var M=this.render(s);return{original:s,string:M}}).bind(this)),v(f)},p.prototype.getItemValue=function(v){return v},p.prototype.render=function(v,y){if(y)return y;for(var f=v.original?this.getItemValue(v.original):this.getItemValue(v),s=this.normalize(f),M=s.lastIndexOf(this.query);M>-1;){var B=M+this.query.length;f=f.slice(0,M)+"<strong>"+f.slice(M,B)+"</strong>"+f.slice(B),M=s.slice(0,M).lastIndexOf(this.query)}return f},p.prototype.renderError=function(v){this.list.drawError(v)},ap=p,ap}var op,ig;function P1(){if(ig)return op;ig=1;var h=w1();return op=h,typeof window<"u"&&(window.Suggestions=h),op}var S1=P1(),A1=ad(S1),$h={exports:{}},T1=$h.exports,ng;function I1(){return ng||(ng=1,function(h){(function(a,c,p){h.exports?h.exports=p():a[c]=p()})(T1,"subtag",function(){var a="",c=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function p(M){return M.match(c)||[]}function v(M){return p(M).filter(function(B,V){return B&&V})}function y(M){return M=p(M),{language:M[1]||a,extlang:M[2]||a,script:M[3]||a,region:M[4]||a}}function f(M,B,V){Object.defineProperty(M,B,{value:V,enumerable:!0})}function s(M,B,V){function U(J){return p(J)[M]||a}f(U,"pattern",B),f(y,V,U)}return s(1,/^[a-zA-Z]{2,3}$/,"language"),s(2,/^[a-zA-Z]{3}$/,"extlang"),s(3,/^[a-zA-Z]{4}$/,"script"),s(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),f(y,"split",v),y})}($h)),$h.exports}var C1=I1(),M1=ad(C1),lp,sg;function L1(){if(sg)return lp;sg=1;var h="Expected a function",a=NaN,c="[object Symbol]",p=/^\s+|\s+$/g,v=/^[-+]0x[0-9a-f]+$/i,y=/^0b[01]+$/i,f=/^0o[0-7]+$/i,s=parseInt,M=typeof Bh=="object"&&Bh&&Bh.Object===Object&&Bh,B=typeof self=="object"&&self&&self.Object===Object&&self,V=M||B||Function("return this")(),U=Object.prototype,J=U.toString,N=Math.max,de=Math.min,pe=function(){return V.Date.now()};function De(Le,Ke,Ue){var Ae,lt,mt,_e,ve,$e,Ne=0,wt=!1,ut=!1,At=!0;if(typeof Le!="function")throw new TypeError(h);Ke=Oe(Ke)||0,fe(Ue)&&(wt=!!Ue.leading,ut="maxWait"in Ue,mt=ut?N(Oe(Ue.maxWait)||0,Ke):mt,At="trailing"in Ue?!!Ue.trailing:At);function ht(at){var pt=Ae,gt=lt;return Ae=lt=void 0,Ne=at,_e=Le.apply(gt,pt),_e}function Tt(at){return Ne=at,ve=setTimeout(ne,Ke),wt?ht(at):_e}function Dt(at){var pt=at-$e,gt=at-Ne,Ht=Ke-pt;return ut?de(Ht,mt-gt):Ht}function sr(at){var pt=at-$e,gt=at-Ne;return $e===void 0||pt>=Ke||pt<0||ut&&gt>=mt}function ne(){var at=pe();if(sr(at))return Ie(at);ve=setTimeout(ne,Dt(at))}function Ie(at){return ve=void 0,At&&Ae?ht(at):(Ae=lt=void 0,_e)}function Re(){ve!==void 0&&clearTimeout(ve),Ne=0,Ae=$e=lt=ve=void 0}function We(){return ve===void 0?_e:Ie(pe())}function nt(){var at=pe(),pt=sr(at);if(Ae=arguments,lt=this,$e=at,pt){if(ve===void 0)return Tt($e);if(ut)return ve=setTimeout(ne,Ke),ht($e)}return ve===void 0&&(ve=setTimeout(ne,Ke)),_e}return nt.cancel=Re,nt.flush=We,nt}function fe(Le){var Ke=typeof Le;return!!Le&&(Ke=="object"||Ke=="function")}function ke(Le){return!!Le&&typeof Le=="object"}function He(Le){return typeof Le=="symbol"||ke(Le)&&J.call(Le)==c}function Oe(Le){if(typeof Le=="number")return Le;if(He(Le))return a;if(fe(Le)){var Ke=typeof Le.valueOf=="function"?Le.valueOf():Le;Le=fe(Ke)?Ke+"":Ke}if(typeof Le!="string")return Le===0?Le:+Le;Le=Le.replace(p,"");var Ue=y.test(Le);return Ue||f.test(Le)?s(Le.slice(2),Ue?2:8):v.test(Le)?a:+Le}return lp=De,lp}var E1=L1(),k1=ad(E1),z1=Wg(),Ho=ad(z1),Oh={exports:{}},ag;function D1(){if(ag)return Oh.exports;ag=1;var h=typeof Reflect=="object"?Reflect:null,a=h&&typeof h.apply=="function"?h.apply:function(Le,Ke,Ue){return Function.prototype.apply.call(Le,Ke,Ue)},c;h&&typeof h.ownKeys=="function"?c=h.ownKeys:Object.getOwnPropertySymbols?c=function(Le){return Object.getOwnPropertyNames(Le).concat(Object.getOwnPropertySymbols(Le))}:c=function(Le){return Object.getOwnPropertyNames(Le)};function p(Oe){console&&console.warn&&console.warn(Oe)}var v=Number.isNaN||function(Le){return Le!==Le};function y(){y.init.call(this)}Oh.exports=y,Oh.exports.once=fe,y.EventEmitter=y,y.prototype._events=void 0,y.prototype._eventsCount=0,y.prototype._maxListeners=void 0;var f=10;function s(Oe){if(typeof Oe!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Oe)}Object.defineProperty(y,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(Oe){if(typeof Oe!="number"||Oe<0||v(Oe))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Oe+".");f=Oe}}),y.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},y.prototype.setMaxListeners=function(Le){if(typeof Le!="number"||Le<0||v(Le))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Le+".");return this._maxListeners=Le,this};function M(Oe){return Oe._maxListeners===void 0?y.defaultMaxListeners:Oe._maxListeners}y.prototype.getMaxListeners=function(){return M(this)},y.prototype.emit=function(Le){for(var Ke=[],Ue=1;Ue<arguments.length;Ue++)Ke.push(arguments[Ue]);var Ae=Le==="error",lt=this._events;if(lt!==void 0)Ae=Ae&&lt.error===void 0;else if(!Ae)return!1;if(Ae){var mt;if(Ke.length>0&&(mt=Ke[0]),mt instanceof Error)throw mt;var _e=new Error("Unhandled error."+(mt?" ("+mt.message+")":""));throw _e.context=mt,_e}var ve=lt[Le];if(ve===void 0)return!1;if(typeof ve=="function")a(ve,this,Ke);else for(var $e=ve.length,Ne=de(ve,$e),Ue=0;Ue<$e;++Ue)a(Ne[Ue],this,Ke);return!0};function B(Oe,Le,Ke,Ue){var Ae,lt,mt;if(s(Ke),lt=Oe._events,lt===void 0?(lt=Oe._events=Object.create(null),Oe._eventsCount=0):(lt.newListener!==void 0&&(Oe.emit("newListener",Le,Ke.listener?Ke.listener:Ke),lt=Oe._events),mt=lt[Le]),mt===void 0)mt=lt[Le]=Ke,++Oe._eventsCount;else if(typeof mt=="function"?mt=lt[Le]=Ue?[Ke,mt]:[mt,Ke]:Ue?mt.unshift(Ke):mt.push(Ke),Ae=M(Oe),Ae>0&&mt.length>Ae&&!mt.warned){mt.warned=!0;var _e=new Error("Possible EventEmitter memory leak detected. "+mt.length+" "+String(Le)+" listeners added. Use emitter.setMaxListeners() to increase limit");_e.name="MaxListenersExceededWarning",_e.emitter=Oe,_e.type=Le,_e.count=mt.length,p(_e)}return Oe}y.prototype.addListener=function(Le,Ke){return B(this,Le,Ke,!1)},y.prototype.on=y.prototype.addListener,y.prototype.prependListener=function(Le,Ke){return B(this,Le,Ke,!0)};function V(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function U(Oe,Le,Ke){var Ue={fired:!1,wrapFn:void 0,target:Oe,type:Le,listener:Ke},Ae=V.bind(Ue);return Ae.listener=Ke,Ue.wrapFn=Ae,Ae}y.prototype.once=function(Le,Ke){return s(Ke),this.on(Le,U(this,Le,Ke)),this},y.prototype.prependOnceListener=function(Le,Ke){return s(Ke),this.prependListener(Le,U(this,Le,Ke)),this},y.prototype.removeListener=function(Le,Ke){var Ue,Ae,lt,mt,_e;if(s(Ke),Ae=this._events,Ae===void 0)return this;if(Ue=Ae[Le],Ue===void 0)return this;if(Ue===Ke||Ue.listener===Ke)--this._eventsCount===0?this._events=Object.create(null):(delete Ae[Le],Ae.removeListener&&this.emit("removeListener",Le,Ue.listener||Ke));else if(typeof Ue!="function"){for(lt=-1,mt=Ue.length-1;mt>=0;mt--)if(Ue[mt]===Ke||Ue[mt].listener===Ke){_e=Ue[mt].listener,lt=mt;break}if(lt<0)return this;lt===0?Ue.shift():pe(Ue,lt),Ue.length===1&&(Ae[Le]=Ue[0]),Ae.removeListener!==void 0&&this.emit("removeListener",Le,_e||Ke)}return this},y.prototype.off=y.prototype.removeListener,y.prototype.removeAllListeners=function(Le){var Ke,Ue,Ae;if(Ue=this._events,Ue===void 0)return this;if(Ue.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):Ue[Le]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete Ue[Le]),this;if(arguments.length===0){var lt=Object.keys(Ue),mt;for(Ae=0;Ae<lt.length;++Ae)mt=lt[Ae],mt!=="removeListener"&&this.removeAllListeners(mt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(Ke=Ue[Le],typeof Ke=="function")this.removeListener(Le,Ke);else if(Ke!==void 0)for(Ae=Ke.length-1;Ae>=0;Ae--)this.removeListener(Le,Ke[Ae]);return this};function J(Oe,Le,Ke){var Ue=Oe._events;if(Ue===void 0)return[];var Ae=Ue[Le];return Ae===void 0?[]:typeof Ae=="function"?Ke?[Ae.listener||Ae]:[Ae]:Ke?De(Ae):de(Ae,Ae.length)}y.prototype.listeners=function(Le){return J(this,Le,!0)},y.prototype.rawListeners=function(Le){return J(this,Le,!1)},y.listenerCount=function(Oe,Le){return typeof Oe.listenerCount=="function"?Oe.listenerCount(Le):N.call(Oe,Le)},y.prototype.listenerCount=N;function N(Oe){var Le=this._events;if(Le!==void 0){var Ke=Le[Oe];if(typeof Ke=="function")return 1;if(Ke!==void 0)return Ke.length}return 0}y.prototype.eventNames=function(){return this._eventsCount>0?c(this._events):[]};function de(Oe,Le){for(var Ke=new Array(Le),Ue=0;Ue<Le;++Ue)Ke[Ue]=Oe[Ue];return Ke}function pe(Oe,Le){for(;Le+1<Oe.length;Le++)Oe[Le]=Oe[Le+1];Oe.pop()}function De(Oe){for(var Le=new Array(Oe.length),Ke=0;Ke<Le.length;++Ke)Le[Ke]=Oe[Ke].listener||Oe[Ke];return Le}function fe(Oe,Le){return new Promise(function(Ke,Ue){function Ae(mt){Oe.removeListener(Le,lt),Ue(mt)}function lt(){typeof Oe.removeListener=="function"&&Oe.removeListener("error",Ae),Ke([].slice.call(arguments))}He(Oe,Le,lt,{once:!0}),Le!=="error"&&ke(Oe,Ae,{once:!0})})}function ke(Oe,Le,Ke){typeof Oe.on=="function"&&He(Oe,"error",Le,Ke)}function He(Oe,Le,Ke,Ue){if(typeof Oe.on=="function")Ue.once?Oe.once(Le,Ke):Oe.on(Le,Ke);else if(typeof Oe.addEventListener=="function")Oe.addEventListener(Le,function Ae(lt){Ue.once&&Oe.removeEventListener(Le,Ae),Ke(lt)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Oe)}return Oh.exports}var F1=D1();const og={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},N1={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},R1={en:"No results found",de:"Keine Ergebnisse gefunden"},B1={en:"There was an error reaching the server",de:"Verbindung fehlgeschlagen"};var Qu={placeholder:N1,errorNoResults:R1,errorConnectionFailed:B1};const O1=/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/;class j1{constructor(a,c){this.options={zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:void 0,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,proximityMinZoom:9,getItemValue:p=>p.text!==void 0?p.text:p.place_name,render:function(p){if(!p.geometry){const y=p.text,f=y.toLowerCase().indexOf(this.query.toLowerCase()),s=this.query.length,M=y.substring(0,f),B=y.substring(f,f+s),V=y.substring(f+s);return'<div class="maplibregl-ctrl-geocoder--suggestion"><svg class="maplibregl-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="maplibregl-ctrl-geocoder--suggestion-info"><div class="maplibregl-ctrl-geocoder--suggestion-title">'+M+'<span class="maplibregl-ctrl-geocoder--suggestion-match">'+B+"</span>"+V+"</div></div></div>"}const v=p.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--result"><svg class="maplibregl-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="maplibregl-ctrl-geocoder--result-title">'+v[0]+'</div><div class="maplibregl-ctrl-geocoder--result-address">'+v.splice(1,v.length).join(",")+"</div></div></div>"},popupRender:p=>{const v=p.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--suggestion popup-suggestion"><div class="maplibregl-ctrl-geocoder--suggestion-title popup-suggestion-title">'+v[0]+'</div><div class="maplibregl-ctrl-geocoder--suggestion-address popup-suggestion-address">'+v.splice(1,v.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},this._eventEmitter=new F1.EventEmitter,this.options=Ho({},this.options,c),this.fresh=!0,this.lastSelected=null,this.geocoderApi=a}addTo(a){function c(p,v){if(!document.body.contains(v))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const y=p.onAdd();v.appendChild(y)}if(a instanceof HTMLElement)c(this,a);else if(typeof a=="string"){const p=document.querySelectorAll(a);if(p.length===0)throw new Error("Element "+a+"not found.");if(p.length>1)throw new Error("Geocoder can only be added to a single html element");c(this,p[0])}else if("addControl"in a)a.addControl(this);else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")}onAdd(a){if(a&&typeof a!="string"&&(this._map=a),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);const c=this.container=document.createElement("div");c.className="maplibregl-ctrl-geocoder maplibregl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";const p=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",k1(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);const v=document.createElement("div");v.classList.add("maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("type","button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="maplibregl-ctrl-geocoder--button";const y=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(y),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),v.appendChild(this._clearEl),v.appendChild(this._loadingEl),c.appendChild(p),c.appendChild(this._inputEl),c.appendChild(v),this._typeahead=new A1(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),c}createIcon(a,c){const p=document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.setAttribute("class","maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+a),p.setAttribute("viewBox","0 0 18 18"),p.setAttribute("xml:space","preserve"),p.setAttribute("width","18"),p.setAttribute("height","18"),"innerHTML"in p)p.innerHTML=c;else{const v=document.createElement("div");v.innerHTML="<svg>"+c.valueOf().toString()+"</svg>";const y=v.firstChild,f=y.firstChild;p.appendChild(f)}return p}onRemove(){return this.container.remove(),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this}_onPaste(a){const c=(a.clipboardData||window.clipboardData).getData("text");c.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(c)}_onKeyDown(a){if(a.keyCode===27&&this.options.clearAndBlurOnEsc)return this._clear(a),this._inputEl.blur();const y=this._inputEl.value;if(!y)return this.fresh=!0,a.keyCode!==9&&this.clear(a),this._clearEl.style.display="none";if(!(a.metaKey||[9,27,37,39,38,40].indexOf(a.keyCode)!==-1)){if(a.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(y);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(y,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}y.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(y)}}_showButton(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")}_hideButton(){this._typeahead.selected&&(this._clearEl.style.display="none")}_onBlur(a){this.options.clearOnBlur&&this._clearOnBlur(a),this.options.collapsed&&this._collapse()}_onChange(){const a=this._typeahead.selected;if(a&&!a.geometry)a.placeId?this._geocode(a.placeId,!0,!0):this._geocode(a.text,!0);else if(a&&JSON.stringify(a)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){let c;if(this._removeResultMarkers(),a.properties&&og[a.properties.short_code])c=Ho({},this.options.flyTo),this._map&&this._map.fitBounds(og[a.properties.short_code].bbox,c);else if(a.bbox){const p=a.bbox;c=Ho({},this.options.flyTo),this._map&&this._map.fitBounds([[p[0],p[1]],[p[2],p[3]]],c)}else{const p={zoom:this.options.zoom};c=Ho({},p,this.options.flyTo),a.center?c.center=a.center:a.geometry&&a.geometry.type&&a.geometry.type==="Point"&&a.geometry.coordinates&&(c.center=a.geometry.coordinates),this._map&&this._map.flyTo(c)}}this.options.marker&&this._maplibregl&&this._handleMarker(a),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(a),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:a})}}_getConfigForRequest(){return["bbox","limit","proximity","countries","types","language","reverseMode"].reduce((p,v)=>(this.options[v]&&(["countries","types","language"].indexOf(v)>-1?p[v]=this.options[v].split(/[\s,]+/):p[v]=this.options[v],v==="proximity"&&this.options[v]&&typeof this.options[v].longitude=="number"&&typeof this.options[v].latitude=="number"&&(p[v]=[this.options[v].longitude,this.options[v].latitude])),p),{})}_geocode(a){return rp(this,arguments,void 0,function*(c,p=!1,v=!1){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:c});const y=this._getConfigForRequest(),f=this._createGeocodeRequest(y,c,p,v),s=this.options.localGeocoder?this.options.localGeocoder(c)||[]:[];try{const M=yield f;yield this._handleGeocodeResponse(M,y,c,p,s)}catch(M){this._handleGeocodeErrorResponse(M,s)}return f})}_createGeocodeRequest(a,c,p,v){return this.options.localGeocoderOnly?Promise.resolve({}):this.options.reverseGeocode&&O1.test(c)?this._createReverseGeocodeRequest(c,a):(a.query=c,this.geocoderApi.getSuggestions?p?this.geocoderApi.searchByPlaceId&&v?this.geocoderApi.searchByPlaceId(a):this.geocoderApi.forwardGeocode(a):this.geocoderApi.getSuggestions(a):this.geocoderApi.forwardGeocode(a))}_createReverseGeocodeRequest(a,c){const p=a.split(/[\s(,)?]+/).map(v=>parseFloat(v)).reverse();return c.query=p,c.limit=1,"proximity"in c&&delete c.proximity,this.geocoderApi.reverseGeocode(c)}_handleGeocodeResponse(a,c,p,v,y){return rp(this,void 0,void 0,function*(){this._loadingEl.style.display="none";let f={};a?f=a:f={type:"FeatureCollection",features:[]},f.config=c,this.fresh&&(this.fresh=!1),f.features=f.features?y.concat(f.features):y;const s=this.options.externalGeocoder?this.options.externalGeocoder(p,f.features,c)||Promise.resolve([]):Promise.resolve([]);try{const B=yield s;f.features=f.features?B.concat(f.features):B}catch{}this.options.filter&&f.features.length&&(f.features=f.features.filter(this.options.filter));let M=[];"suggestions"in f?M=f.suggestions:"place"in f?M=[f.place]:M=f.features,M.length?(this._clearEl.style.display="block",this._typeahead.update(M),(!this.options.showResultsWhileTyping||v)&&this.options.showResultMarkers&&(f.features.length>0||"place"in f)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",f)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",f))})}_handleGeocodeErrorResponse(a,c){this._loadingEl.style.display="none",c.length&&this.options.localGeocoder?(this._clearEl.style.display="block",this._typeahead.update(c)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:c}),this._eventEmitter.emit("error",{error:a})}_clear(a){a&&a.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0}clear(a){this._clear(a),this._inputEl.focus()}_clearOnBlur(a){a.relatedTarget&&this._clear(a)}_onQueryResult(a){if(!("features"in a)||!a.features.length)return;const c=a.features[0];this._typeahead.selected=c,this._inputEl.value=c.place_name,this._onChange()}_updateProximity(){if(this._map)if(this._map.getZoom()>this.options.proximityMinZoom){const a=this._map.getCenter().wrap();this.setProximity({longitude:a.lng,latitude:a.lat})}else this.setProximity(null)}_collapse(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("maplibregl-ctrl-geocoder--collapsed")}_unCollapse(){this.container.classList.remove("maplibregl-ctrl-geocoder--collapsed")}query(a){return rp(this,void 0,void 0,function*(){const c=yield this._geocode(a);this._onQueryResult(c)})}_renderError(){const a=`<div class='maplibre-gl-geocoder--error'>${this._localize("errorConnectionFailed")}</div>`;this._renderMessage(a)}_renderNoResults(){const a=`<div class='maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>
        ${this._localize("errorNoResults")}</div>`;this._renderMessage(a)}_renderMessage(a){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(a)}_localize(a){const c=M1.language(this.options.language.split(",")[0]);return this.options.language&&(Qu!=null&&Qu[a][c])?Qu[a][c]:Qu[a].en}_fitBoundsForMarkers(){if(this._typeahead.data.length<1)return;const a=this._typeahead.data.filter(c=>typeof c!="string").slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){const p=Ho({},{padding:100},this.options.flyTo),v=new this._maplibregl.LngLatBounds;for(const y of a)v.extend(y.geometry.coordinates);this._map.fitBounds(v,p)}return a.length>0&&this._maplibregl&&this._handleResultMarkers(a),this}setInput(a){return this._inputEl.value=a,this._typeahead.selected=null,this._typeahead.clear(),a.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(a),this}setProximity(a){return this.options.proximity=a,this}getProximity(){return this.options.proximity}setRenderFunction(a){return a&&typeof a=="function"&&(this._typeahead.render=a),this}getRenderFunction(){return this._typeahead.render}setLanguage(a){return this.options.language=a||this.options.language||navigator.language,this}getLanguage(){return this.options.language}getZoom(){return this.options.zoom}setZoom(a){return this.options.zoom=a,this}getFlyTo(){return this.options.flyTo}setFlyTo(a){return this.options.flyTo=a,this}getPlaceholder(){return this.options.placeholder}setPlaceholder(a){return this.placeholder=a||this.options.placeholder||this._localize("placeholder"),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this}getBbox(){return this.options.bbox}setBbox(a){return this.options.bbox=a,this}getCountries(){return this.options.countries}setCountries(a){return this.options.countries=a,this}getTypes(){return this.options.types}setTypes(a){return this.options.types=a,this}getMinLength(){return this.options.minLength}setMinLength(a){return this.options.minLength=a,this._typeahead&&(this._typeahead.options.minLength=a),this}getLimit(){return this.options.limit}setLimit(a){return this.options.limit=a,this._typeahead&&(this._typeahead.options.limit=a),this}getFilter(){return this.options.filter}setFilter(a){return this.options.filter=a,this}setGeocoderApi(a){return this.geocoderApi=a,this}getGeocoderApi(){return this.geocoderApi}_handleMarker(a){if(!this._map)return;this._removeMarker();const p=Ho({},{color:"#4668F2"},this.options.marker);this.mapMarker=new this._maplibregl.Marker(p);let v;if(this.options.popup){const f=Ho({},{},this.options.popup);v=new this._maplibregl.Popup(f).setHTML(this.options.popupRender(a))}return a.center?(this.mapMarker.setLngLat(a.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(v)):a.geometry&&a.geometry.type&&a.geometry.type==="Point"&&a.geometry.coordinates&&(this.mapMarker.setLngLat(a.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(v)),this}_removeMarker(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)}_handleResultMarkers(a){if(!this._map)return;this._removeResultMarkers();let p=Ho({},{color:"#4668F2"},this.options.showResultMarkers);for(const v of a){let y;if(this.options.showResultMarkers){this.options.showResultMarkers&&this.options.showResultMarkers.element&&(y=this.options.showResultMarkers.element.cloneNode(!0),p=Ho(p,{element:y}));const f=new this._maplibregl.Marker(Ho({},p,{element:y}));let s;if(this.options.popup){const B=Ho({},{},this.options.popup);s=new this._maplibregl.Popup(B).setHTML(this.options.popupRender(v))}v.center?(f.setLngLat(v.center).addTo(this._map),this.options.popup&&f.setPopup(s)):v.geometry&&v.geometry.type&&v.geometry.type==="Point"&&v.geometry.coordinates&&(f.setLngLat(v.geometry.coordinates).addTo(this._map),this.options.popup&&f.setPopup(s)),this.resultMarkers.push(f)}}return this}_removeResultMarkers(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(a){a.remove()}),this.resultMarkers=[])}on(a,c){return this._eventEmitter.on(a,c),this}once(a){return new Promise(c=>{this._eventEmitter.once(a,c)})}off(a,c){return this._eventEmitter.removeListener(a,c),this}}const q1="modulepreload",V1=function(h){return"/"+h},lg={},Pp=function(a,c,p){let v=Promise.resolve();if(c&&c.length>0){document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),s=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));v=Promise.allSettled(c.map(M=>{if(M=V1(M),M in lg)return;lg[M]=!0;const B=M.endsWith(".css"),V=B?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${M}"]${V}`))return;const U=document.createElement("link");if(U.rel=B?"stylesheet":q1,B||(U.as="script"),U.crossOrigin="",U.href=M,s&&U.setAttribute("nonce",s),document.head.appendChild(U),B)return new Promise((J,N)=>{U.addEventListener("load",J),U.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${M}`)))})}))}function y(f){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=f,window.dispatchEvent(s),!s.defaultPrevented)throw f}return v.then(f=>{for(const s of f||[])s.status==="rejected"&&y(s.reason);return a().catch(y)})};var U1=Object.defineProperty,Z1=(h,a,c)=>a in h?U1(h,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):h[a]=c,xi=(h,a,c)=>Z1(h,typeof a!="symbol"?a+"":a,c);class G1{constructor(a){xi(this,"map"),xi(this,"width"),xi(this,"height"),xi(this,"svgCanvas"),xi(this,"xLine"),xi(this,"yLine"),xi(this,"color","#535353"),this.map=a,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var a,c;this.width=(a=this.map)==null?void 0:a.getCanvas().clientWidth,this.height=(c=this.map)==null?void 0:c.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const a=this.width/2,c=this.height/2;this.yLine.setAttribute("x1",`${a}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${a}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${c}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${c}px`)}else console.error("element value is null")}createCanvas(a){if(this.width!==void 0&&this.height!==void 0){const c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.style.position="relative",c.setAttribute("width",`${this.width}px`),c.setAttribute("height",`${this.height}px`);const p=this.width/2,v=this.height/2;this.yLine=c.appendChild(this.createLine(p,0,p,this.height,this.color,"2px")),this.xLine=c.appendChild(this.createLine(0,v,this.width,v,this.color,"2px")),a==null||a.appendChild(c),this.svgCanvas=c}}createLine(a,c,p,v,y,f){const s=document.createElementNS("http://www.w3.org/2000/svg","line");return s.setAttribute("x1",a),s.setAttribute("y1",c),s.setAttribute("x2",p),s.setAttribute("y2",v),s.setAttribute("stroke-dasharray","5,5"),s.setAttribute("stroke",y),s.setAttribute("stroke-width",f),s}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}}const cg={72:72,96:96,200:200,300:300,400:400},Jl={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},jh={Landscape:"landscape",Portrait:"portrait"},xu={LETTER:[279,216],A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},Cu={mm:"mm"};class $1{constructor(a){xi(this,"map"),xi(this,"width"),xi(this,"height"),xi(this,"unit"),xi(this,"svgCanvas"),xi(this,"svgPath");var c,p,v;if(this.map=a,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const y=(c=this.map)==null?void 0:c.getCanvas().clientWidth,f=(p=this.map)==null?void 0:p.getCanvas().clientHeight,s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.style.position="absolute",s.style.top="0px",s.style.left="0px",s.setAttribute("width",`${y}px`),s.setAttribute("height",`${f}px`);const M=document.createElementNS("http://www.w3.org/2000/svg","path");M.setAttribute("style","fill:#888888;stroke-width:0"),M.setAttribute("fill-opacity","0.5"),s.append(M),(v=this.map)==null||v.getCanvasContainer().appendChild(s),this.svgCanvas=s,this.svgPath=M}mapResize(){this.generateCutOut()}updateArea(a,c){this.width=a,this.height=c,this.unit=Cu.mm,this.generateCutOut()}generateCutOut(){var a,c;if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const p=this.toPixels(this.width),v=this.toPixels(this.height),y=(a=this.map)==null?void 0:a.getCanvas().clientWidth,f=(c=this.map)==null?void 0:c.getCanvas().clientHeight,s=y/2-p/2,M=s+p,B=f/2-v/2,V=B+v;this.svgCanvas.setAttribute("width",`${y}px`),this.svgCanvas.setAttribute("height",`${f}px`),this.svgPath.setAttribute("d",`M 0 0 L ${y} 0 L ${y} ${f} L 0 ${f} M ${s} ${B} L ${s} ${V} L ${M} ${V} L ${M} ${B}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(a,c=96){return this.unit===Cu.mm&&(c/=25.4),c*a}}const Hg={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate",LanguageName:"English",LanguageCode:"en"},W1={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Générer",LanguageName:"Français",LanguageCode:"fr"},H1={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi",LanguageName:"Suomalainen",LanguageCode:"fi"},X1={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflösung",Generate:"Erstellen",LanguageName:"Deutsch",LanguageCode:"de"},Y1={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera",LanguageName:"Svenska",LanguageCode:"sv"},K1={PageSize:"Tamaño de página",PageOrientation:"Orientación de página",Format:"Formato",DPI:"DPI",Generate:"Generar",LanguageName:"Española",LanguageCode:"es"},J1={PageSize:"Mida",PageOrientation:"Orientació",Format:"Format",DPI:"DPI",Generate:"Genera",LanguageName:"Catalan",LanguageCode:"ca"},Q1={PageSize:"Kích thước trang",PageOrientation:"Loại trang",Format:"Định dạng",DPI:"Mật độ điểm ảnh (DPI)",Generate:"Tạo",LanguageName:"Tiếng Việt",LanguageCode:"vi"},ev={PageSize:"Розмір сторінки",PageOrientation:"Орієнтація сторінки",Format:"Формат",DPI:"DPI",Generate:"Згенерувати",LanguageName:"українська",LanguageCode:"uk"},tv={PageSize:"页面大小",PageOrientation:"页面方向",Format:"格式",DPI:"像素",Generate:"导出",LanguageName:"简体字",LanguageCode:"zhHans"},rv={PageSize:"頁面大小",PageOrientation:"頁面方向",Format:"格式",DPI:"像素",Generate:"導出",LanguageName:"繁体字",LanguageCode:"zhHant"},iv={PageSize:"ページサイズ",PageOrientation:"ページ方向",Format:"フォーマット",DPI:"DPI（解像度）",Generate:"出力",LanguageName:"日本語",LanguageCode:"ja"},nv={PageSize:"Tamanho da página",PageOrientation:"Orientação da página",Format:"Formato",DPI:"DPI",Generate:"Gerar",LanguageName:"Português",LanguageCode:"pt"},sv=[Hg,W1,H1,X1,Y1,K1,J1,Q1,ev,tv,rv,iv,nv],av=h=>sv.find(a=>a.LanguageCode===h)??Hg;function Ri(h){"@babel/helpers - typeof";return Ri=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Ri(h)}var Xs=Uint8Array,eo=Uint16Array,Gp=Int32Array,od=new Xs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ld=new Xs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Sp=new Xs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Xg=function(h,a){for(var c=new eo(31),p=0;p<31;++p)c[p]=a+=1<<h[p-1];for(var v=new Gp(c[30]),p=1;p<30;++p)for(var y=c[p];y<c[p+1];++y)v[y]=y-c[p]<<5|p;return{b:c,r:v}},Yg=Xg(od,2),Kg=Yg.b,Ap=Yg.r;Kg[28]=258,Ap[258]=28;var Jg=Xg(ld,0),ov=Jg.b,ug=Jg.r,Tp=new eo(32768);for(var on=0;on<32768;++on){var gc=(on&43690)>>1|(on&21845)<<1;gc=(gc&52428)>>2|(gc&13107)<<2,gc=(gc&61680)>>4|(gc&3855)<<4,Tp[on]=((gc&65280)>>8|(gc&255)<<8)>>1}var Ml=function(h,a,c){for(var p=h.length,v=0,y=new eo(a);v<p;++v)h[v]&&++y[h[v]-1];var f=new eo(a);for(v=1;v<a;++v)f[v]=f[v-1]+y[v-1]<<1;var s;if(c){s=new eo(1<<a);var M=15-a;for(v=0;v<p;++v)if(h[v])for(var B=v<<4|h[v],V=a-h[v],U=f[h[v]-1]++<<V,J=U|(1<<V)-1;U<=J;++U)s[Tp[U]>>M]=B}else for(s=new eo(p),v=0;v<p;++v)h[v]&&(s[v]=Tp[f[h[v]-1]++]>>15-h[v]);return s},wc=new Xs(288);for(var on=0;on<144;++on)wc[on]=8;for(var on=144;on<256;++on)wc[on]=9;for(var on=256;on<280;++on)wc[on]=7;for(var on=280;on<288;++on)wc[on]=8;var oh=new Xs(32);for(var on=0;on<32;++on)oh[on]=5;var lv=Ml(wc,9,0),cv=Ml(wc,9,1),uv=Ml(oh,5,0),hv=Ml(oh,5,1),cp=function(h){for(var a=h[0],c=1;c<h.length;++c)h[c]>a&&(a=h[c]);return a},Xo=function(h,a,c){var p=a/8|0;return(h[p]|h[p+1]<<8)>>(a&7)&c},up=function(h,a){var c=a/8|0;return(h[c]|h[c+1]<<8|h[c+2]<<16)>>(a&7)},$p=function(h){return(h+7)/8|0},Qg=function(h,a,c){return(c==null||c>h.length)&&(c=h.length),new Xs(h.subarray(a,c))},dv=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Jo=function(h,a,c){var p=new Error(a||dv[h]);if(p.code=h,Error.captureStackTrace&&Error.captureStackTrace(p,Jo),!c)throw p;return p},pv=function(h,a,c,p){var v=h.length,y=0;if(!v||a.f&&!a.l)return c||new Xs(0);var f=!c,s=f||a.i!=2,M=a.i;f&&(c=new Xs(v*3));var B=function($t){var er=c.length;if($t>er){var nr=new Xs(Math.max(er*2,$t));nr.set(c),c=nr}},V=a.f||0,U=a.p||0,J=a.b||0,N=a.l,de=a.d,pe=a.m,De=a.n,fe=v*8;do{if(!N){V=Xo(h,U,1);var ke=Xo(h,U+1,3);if(U+=3,ke)if(ke==1)N=cv,de=hv,pe=9,De=5;else if(ke==2){var He=Xo(h,U,31)+257,Oe=Xo(h,U+10,15)+4,Le=He+Xo(h,U+5,31)+1;U+=14;for(var Ke=new Xs(Le),Ue=new Xs(19),Ae=0;Ae<Oe;++Ae)Ue[Sp[Ae]]=Xo(h,U+Ae*3,7);U+=Oe*3;for(var lt=cp(Ue),mt=(1<<lt)-1,_e=Ml(Ue,lt,1),Ae=0;Ae<Le;){var ve=_e[Xo(h,U,mt)];U+=ve&15;var $e=ve>>4;if($e<16)Ke[Ae++]=$e;else{var Ne=0,wt=0;for($e==16?(wt=3+Xo(h,U,3),U+=2,Ne=Ke[Ae-1]):$e==17?(wt=3+Xo(h,U,7),U+=3):$e==18&&(wt=11+Xo(h,U,127),U+=7);wt--;)Ke[Ae++]=Ne}}var ut=Ke.subarray(0,He),At=Ke.subarray(He);pe=cp(ut),De=cp(At),N=Ml(ut,pe,1),de=Ml(At,De,1)}else Jo(1);else{var $e=$p(U)+4,ht=h[$e-4]|h[$e-3]<<8,Tt=$e+ht;if(Tt>v){M&&Jo(0);break}s&&B(J+ht),c.set(h.subarray($e,Tt),J),a.b=J+=ht,a.p=U=Tt*8,a.f=V;continue}if(U>fe){M&&Jo(0);break}}s&&B(J+131072);for(var Dt=(1<<pe)-1,sr=(1<<De)-1,ne=U;;ne=U){var Ne=N[up(h,U)&Dt],Ie=Ne>>4;if(U+=Ne&15,U>fe){M&&Jo(0);break}if(Ne||Jo(2),Ie<256)c[J++]=Ie;else if(Ie==256){ne=U,N=null;break}else{var Re=Ie-254;if(Ie>264){var Ae=Ie-257,We=od[Ae];Re=Xo(h,U,(1<<We)-1)+Kg[Ae],U+=We}var nt=de[up(h,U)&sr],at=nt>>4;nt||Jo(3),U+=nt&15;var At=ov[at];if(at>3){var We=ld[at];At+=up(h,U)&(1<<We)-1,U+=We}if(U>fe){M&&Jo(0);break}s&&B(J+131072);var pt=J+Re;if(J<At){var gt=y-At,Ht=Math.min(At,pt);for(gt+J<0&&Jo(3);J<Ht;++J)c[J]=p[gt+J]}for(;J<pt;++J)c[J]=c[J-At]}}a.l=N,a.p=ne,a.b=J,a.f=V,N&&(V=1,a.m=pe,a.d=de,a.n=De)}while(!V);return J!=c.length&&f?Qg(c,0,J):c.subarray(0,J)},Kl=function(h,a,c){c<<=a&7;var p=a/8|0;h[p]|=c,h[p+1]|=c>>8},eh=function(h,a,c){c<<=a&7;var p=a/8|0;h[p]|=c,h[p+1]|=c>>8,h[p+2]|=c>>16},hp=function(h,a){for(var c=[],p=0;p<h.length;++p)h[p]&&c.push({s:p,f:h[p]});var v=c.length,y=c.slice();if(!v)return{t:t_,l:0};if(v==1){var f=new Xs(c[0].s+1);return f[c[0].s]=1,{t:f,l:1}}c.sort(function(Le,Ke){return Le.f-Ke.f}),c.push({s:-1,f:25001});var s=c[0],M=c[1],B=0,V=1,U=2;for(c[0]={s:-1,f:s.f+M.f,l:s,r:M};V!=v-1;)s=c[c[B].f<c[U].f?B++:U++],M=c[B!=V&&c[B].f<c[U].f?B++:U++],c[V++]={s:-1,f:s.f+M.f,l:s,r:M};for(var J=y[0].s,p=1;p<v;++p)y[p].s>J&&(J=y[p].s);var N=new eo(J+1),de=Ip(c[V-1],N,0);if(de>a){var p=0,pe=0,De=de-a,fe=1<<De;for(y.sort(function(Ke,Ue){return N[Ue.s]-N[Ke.s]||Ke.f-Ue.f});p<v;++p){var ke=y[p].s;if(N[ke]>a)pe+=fe-(1<<de-N[ke]),N[ke]=a;else break}for(pe>>=De;pe>0;){var He=y[p].s;N[He]<a?pe-=1<<a-N[He]++-1:++p}for(;p>=0&&pe;--p){var Oe=y[p].s;N[Oe]==a&&(--N[Oe],++pe)}de=a}return{t:new Xs(N),l:de}},Ip=function(h,a,c){return h.s==-1?Math.max(Ip(h.l,a,c+1),Ip(h.r,a,c+1)):a[h.s]=c},hg=function(h){for(var a=h.length;a&&!h[--a];);for(var c=new eo(++a),p=0,v=h[0],y=1,f=function(M){c[p++]=M},s=1;s<=a;++s)if(h[s]==v&&s!=a)++y;else{if(!v&&y>2){for(;y>138;y-=138)f(32754);y>2&&(f(y>10?y-11<<5|28690:y-3<<5|12305),y=0)}else if(y>3){for(f(v),--y;y>6;y-=6)f(8304);y>2&&(f(y-3<<5|8208),y=0)}for(;y--;)f(v);y=1,v=h[s]}return{c:c.subarray(0,p),n:a}},th=function(h,a){for(var c=0,p=0;p<a.length;++p)c+=h[p]*a[p];return c},e_=function(h,a,c){var p=c.length,v=$p(a+2);h[v]=p&255,h[v+1]=p>>8,h[v+2]=h[v]^255,h[v+3]=h[v+1]^255;for(var y=0;y<p;++y)h[v+y+4]=c[y];return(v+4+p)*8},dg=function(h,a,c,p,v,y,f,s,M,B,V){Kl(a,V++,c),++v[256];for(var U=hp(v,15),J=U.t,N=U.l,de=hp(y,15),pe=de.t,De=de.l,fe=hg(J),ke=fe.c,He=fe.n,Oe=hg(pe),Le=Oe.c,Ke=Oe.n,Ue=new eo(19),Ae=0;Ae<ke.length;++Ae)++Ue[ke[Ae]&31];for(var Ae=0;Ae<Le.length;++Ae)++Ue[Le[Ae]&31];for(var lt=hp(Ue,7),mt=lt.t,_e=lt.l,ve=19;ve>4&&!mt[Sp[ve-1]];--ve);var $e=B+5<<3,Ne=th(v,wc)+th(y,oh)+f,wt=th(v,J)+th(y,pe)+f+14+3*ve+th(Ue,mt)+2*Ue[16]+3*Ue[17]+7*Ue[18];if(M>=0&&$e<=Ne&&$e<=wt)return e_(a,V,h.subarray(M,M+B));var ut,At,ht,Tt;if(Kl(a,V,1+(wt<Ne)),V+=2,wt<Ne){ut=Ml(J,N,0),At=J,ht=Ml(pe,De,0),Tt=pe;var Dt=Ml(mt,_e,0);Kl(a,V,He-257),Kl(a,V+5,Ke-1),Kl(a,V+10,ve-4),V+=14;for(var Ae=0;Ae<ve;++Ae)Kl(a,V+3*Ae,mt[Sp[Ae]]);V+=3*ve;for(var sr=[ke,Le],ne=0;ne<2;++ne)for(var Ie=sr[ne],Ae=0;Ae<Ie.length;++Ae){var Re=Ie[Ae]&31;Kl(a,V,Dt[Re]),V+=mt[Re],Re>15&&(Kl(a,V,Ie[Ae]>>5&127),V+=Ie[Ae]>>12)}}else ut=lv,At=wc,ht=uv,Tt=oh;for(var Ae=0;Ae<s;++Ae){var We=p[Ae];if(We>255){var Re=We>>18&31;eh(a,V,ut[Re+257]),V+=At[Re+257],Re>7&&(Kl(a,V,We>>23&31),V+=od[Re]);var nt=We&31;eh(a,V,ht[nt]),V+=Tt[nt],nt>3&&(eh(a,V,We>>5&8191),V+=ld[nt])}else eh(a,V,ut[We]),V+=At[We]}return eh(a,V,ut[256]),V+At[256]},fv=new Gp([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),t_=new Xs(0),mv=function(h,a,c,p,v,y){var f=y.z||h.length,s=new Xs(p+f+5*(1+Math.ceil(f/7e3))+v),M=s.subarray(p,s.length-v),B=y.l,V=(y.r||0)&7;if(a){V&&(M[0]=y.r>>3);for(var U=fv[a-1],J=U>>13,N=U&8191,de=(1<<c)-1,pe=y.p||new eo(32768),De=y.h||new eo(de+1),fe=Math.ceil(c/3),ke=2*fe,He=function(dr){return(h[dr]^h[dr+1]<<fe^h[dr+2]<<ke)&de},Oe=new Gp(25e3),Le=new eo(288),Ke=new eo(32),Ue=0,Ae=0,lt=y.i||0,mt=0,_e=y.w||0,ve=0;lt+2<f;++lt){var $e=He(lt),Ne=lt&32767,wt=De[$e];if(pe[Ne]=wt,De[$e]=Ne,_e<=lt){var ut=f-lt;if((Ue>7e3||mt>24576)&&(ut>423||!B)){V=dg(h,M,0,Oe,Le,Ke,Ae,mt,ve,lt-ve,V),mt=Ue=Ae=0,ve=lt;for(var At=0;At<286;++At)Le[At]=0;for(var At=0;At<30;++At)Ke[At]=0}var ht=2,Tt=0,Dt=N,sr=Ne-wt&32767;if(ut>2&&$e==He(lt-sr))for(var ne=Math.min(J,ut)-1,Ie=Math.min(32767,lt),Re=Math.min(258,ut);sr<=Ie&&--Dt&&Ne!=wt;){if(h[lt+ht]==h[lt+ht-sr]){for(var We=0;We<Re&&h[lt+We]==h[lt+We-sr];++We);if(We>ht){if(ht=We,Tt=sr,We>ne)break;for(var nt=Math.min(sr,We-2),at=0,At=0;At<nt;++At){var pt=lt-sr+At&32767,gt=pe[pt],Ht=pt-gt&32767;Ht>at&&(at=Ht,wt=pt)}}}Ne=wt,wt=pe[Ne],sr+=Ne-wt&32767}if(Tt){Oe[mt++]=268435456|Ap[ht]<<18|ug[Tt];var $t=Ap[ht]&31,er=ug[Tt]&31;Ae+=od[$t]+ld[er],++Le[257+$t],++Ke[er],_e=lt+ht,++Ue}else Oe[mt++]=h[lt],++Le[h[lt]]}}for(lt=Math.max(lt,_e);lt<f;++lt)Oe[mt++]=h[lt],++Le[h[lt]];V=dg(h,M,B,Oe,Le,Ke,Ae,mt,ve,lt-ve,V),B||(y.r=V&7|M[V/8|0]<<3,V-=7,y.h=De,y.p=pe,y.i=lt,y.w=_e)}else{for(var lt=y.w||0;lt<f+B;lt+=65535){var nr=lt+65535;nr>=f&&(M[V/8|0]=B,nr=f),V=e_(M,V+1,h.subarray(lt,nr))}y.i=f}return Qg(s,0,p+$p(V)+v)},r_=function(){var h=1,a=0;return{p:function(c){for(var p=h,v=a,y=c.length|0,f=0;f!=y;){for(var s=Math.min(f+2655,y);f<s;++f)v+=p+=c[f];p=(p&65535)+15*(p>>16),v=(v&65535)+15*(v>>16)}h=p,a=v},d:function(){return h%=65521,a%=65521,(h&255)<<24|(h&65280)<<8|(a&255)<<8|a>>8}}},gv=function(h,a,c,p,v){if(!v&&(v={l:1},a.dictionary)){var y=a.dictionary.subarray(-32768),f=new Xs(y.length+h.length);f.set(y),f.set(h,y.length),h=f,v.w=y.length}return mv(h,a.level==null?6:a.level,a.mem==null?v.l?Math.ceil(Math.max(8,Math.min(13,Math.log(h.length)))*1.5):20:12+a.mem,c,p,v)},i_=function(h,a,c){for(;c;++a)h[a]=c,c>>>=8},_v=function(h,a){var c=a.level,p=c==0?0:c<6?1:c==9?3:2;if(h[0]=120,h[1]=p<<6|(a.dictionary&&32),h[1]|=31-(h[0]<<8|h[1])%31,a.dictionary){var v=r_();v.p(a.dictionary),i_(h,2,v.d())}},yv=function(h,a){return((h[0]&15)!=8||h[0]>>4>7||(h[0]<<8|h[1])%31)&&Jo(6,"invalid zlib data"),(h[1]>>5&1)==1&&Jo(6,"invalid zlib data: "+(h[1]&32?"need":"unexpected")+" dictionary"),(h[1]>>3&4)+2};function Cp(h,a){a||(a={});var c=r_();c.p(h);var p=gv(h,a,a.dictionary?6:2,4);return _v(p,a),i_(p,p.length-4,c.d()),p}function vv(h,a){return pv(h.subarray(yv(h),-4),{i:2},a,a)}var bv=typeof TextDecoder<"u"&&new TextDecoder,xv=0;try{bv.decode(t_,{stream:!0}),xv=1}catch{}/** @license
 *
 * jsPDF - PDF Document creation from JavaScript
 * Version 3.0.0 Built on 2025-02-19T09:26:58.791Z
 *                      CommitID 00000000
 *
 * Copyright (c) 2010-2021 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
 *               2015-2021 yWorks GmbH, http://www.yworks.com
 *               2015-2021 Lukas Holländer <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
 *               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
 *               2010 Aaron Spike, https://github.com/acspike
 *               2012 Willow Systems Corporation, https://github.com/willowsystems
 *               2012 Pablo Hess, https://github.com/pablohess
 *               2012 Florian Jenett, https://github.com/fjenett
 *               2013 Warren Weckesser, https://github.com/warrenweckesser
 *               2013 Youssef Beddad, https://github.com/lifof
 *               2013 Lee Driscoll, https://github.com/lsdriscoll
 *               2013 Stefan Slonevskiy, https://github.com/stefslon
 *               2013 Jeremy Morel, https://github.com/jmorel
 *               2013 Christoph Hartmann, https://github.com/chris-rock
 *               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
 *               2014 James Makes, https://github.com/dollaruw
 *               2014 Diego Casorran, https://github.com/diegocr
 *               2014 Steven Spungin, https://github.com/Flamenco
 *               2014 Kenneth Glassey, https://github.com/Gavvers
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 * Contributor(s):
 *    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
 *    kim3er, mfo, alnorth, Flamenco
 */var Ur=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function dp(){Ur.console&&typeof Ur.console.log=="function"&&Ur.console.log.apply(Ur.console,arguments)}var Yi={log:dp,warn:function(h){Ur.console&&(typeof Ur.console.warn=="function"?Ur.console.warn.apply(Ur.console,arguments):dp.call(null,arguments))},error:function(h){Ur.console&&(typeof Ur.console.error=="function"?Ur.console.error.apply(Ur.console,arguments):dp(h))}};function pp(h,a,c){var p=new XMLHttpRequest;p.open("GET",h),p.responseType="blob",p.onload=function(){qc(p.response,a,c)},p.onerror=function(){Yi.error("could not download file")},p.send()}function pg(h){var a=new XMLHttpRequest;a.open("HEAD",h,!1);try{a.send()}catch{}return a.status>=200&&a.status<=299}function qh(h){try{h.dispatchEvent(new MouseEvent("click"))}catch{var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),h.dispatchEvent(a)}}var ih,Mp,qc=Ur.saveAs||((typeof window>"u"?"undefined":Ri(window))!=="object"||window!==Ur?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(h,a,c){var p=Ur.URL||Ur.webkitURL,v=document.createElement("a");a=a||h.name||"download",v.download=a,v.rel="noopener",typeof h=="string"?(v.href=h,v.origin!==location.origin?pg(v.href)?pp(h,a,c):qh(v,v.target="_blank"):qh(v)):(v.href=p.createObjectURL(h),setTimeout(function(){p.revokeObjectURL(v.href)},4e4),setTimeout(function(){qh(v)},0))}:"msSaveOrOpenBlob"in navigator?function(h,a,c){if(a=a||h.name||"download",typeof h=="string")if(pg(h))pp(h,a,c);else{var p=document.createElement("a");p.href=h,p.target="_blank",setTimeout(function(){qh(p)})}else navigator.msSaveOrOpenBlob(function(v,y){return y===void 0?y={autoBom:!1}:Ri(y)!=="object"&&(Yi.warn("Deprecated: Expected third argument to be a object"),y={autoBom:!y}),y.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(v.type)?new Blob(["\uFEFF",v],{type:v.type}):v}(h,c),a)}:function(h,a,c,p){if((p=p||open("","_blank"))&&(p.document.title=p.document.body.innerText="downloading..."),typeof h=="string")return pp(h,a,c);var v=h.type==="application/octet-stream",y=/constructor/i.test(Ur.HTMLElement)||Ur.safari,f=/CriOS\/[\d]+/.test(navigator.userAgent);if((f||v&&y)&&(typeof FileReader>"u"?"undefined":Ri(FileReader))==="object"){var s=new FileReader;s.onloadend=function(){var V=s.result;V=f?V:V.replace(/^data:[^;]*;/,"data:attachment/file;"),p?p.location.href=V:location=V,p=null},s.readAsDataURL(h)}else{var M=Ur.URL||Ur.webkitURL,B=M.createObjectURL(h);p?p.location=B:location.href=B,p=null,setTimeout(function(){M.revokeObjectURL(B)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function n_(h){var a;h=h||"",this.ok=!1,h.charAt(0)=="#"&&(h=h.substr(1,6)),h={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[h=(h=h.replace(/ /g,"")).toLowerCase()]||h;for(var c=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(s){return[parseInt(s[1]),parseInt(s[2]),parseInt(s[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(s){return[parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(s){return[parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16),parseInt(s[3]+s[3],16)]}}],p=0;p<c.length;p++){var v=c[p].re,y=c[p].process,f=v.exec(h);f&&(a=y(f),this.r=a[0],this.g=a[1],this.b=a[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var s=this.r.toString(16),M=this.g.toString(16),B=this.b.toString(16);return s.length==1&&(s="0"+s),M.length==1&&(M="0"+M),B.length==1&&(B="0"+B),"#"+s+M+B}}/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function fp(h,a){var c=h[0],p=h[1],v=h[2],y=h[3];c=Gs(c,p,v,y,a[0],7,-680876936),y=Gs(y,c,p,v,a[1],12,-389564586),v=Gs(v,y,c,p,a[2],17,606105819),p=Gs(p,v,y,c,a[3],22,-1044525330),c=Gs(c,p,v,y,a[4],7,-176418897),y=Gs(y,c,p,v,a[5],12,1200080426),v=Gs(v,y,c,p,a[6],17,-1473231341),p=Gs(p,v,y,c,a[7],22,-45705983),c=Gs(c,p,v,y,a[8],7,1770035416),y=Gs(y,c,p,v,a[9],12,-1958414417),v=Gs(v,y,c,p,a[10],17,-42063),p=Gs(p,v,y,c,a[11],22,-1990404162),c=Gs(c,p,v,y,a[12],7,1804603682),y=Gs(y,c,p,v,a[13],12,-40341101),v=Gs(v,y,c,p,a[14],17,-1502002290),c=$s(c,p=Gs(p,v,y,c,a[15],22,1236535329),v,y,a[1],5,-165796510),y=$s(y,c,p,v,a[6],9,-1069501632),v=$s(v,y,c,p,a[11],14,643717713),p=$s(p,v,y,c,a[0],20,-373897302),c=$s(c,p,v,y,a[5],5,-701558691),y=$s(y,c,p,v,a[10],9,38016083),v=$s(v,y,c,p,a[15],14,-660478335),p=$s(p,v,y,c,a[4],20,-405537848),c=$s(c,p,v,y,a[9],5,568446438),y=$s(y,c,p,v,a[14],9,-1019803690),v=$s(v,y,c,p,a[3],14,-187363961),p=$s(p,v,y,c,a[8],20,1163531501),c=$s(c,p,v,y,a[13],5,-1444681467),y=$s(y,c,p,v,a[2],9,-51403784),v=$s(v,y,c,p,a[7],14,1735328473),c=Ws(c,p=$s(p,v,y,c,a[12],20,-1926607734),v,y,a[5],4,-378558),y=Ws(y,c,p,v,a[8],11,-2022574463),v=Ws(v,y,c,p,a[11],16,1839030562),p=Ws(p,v,y,c,a[14],23,-35309556),c=Ws(c,p,v,y,a[1],4,-1530992060),y=Ws(y,c,p,v,a[4],11,1272893353),v=Ws(v,y,c,p,a[7],16,-155497632),p=Ws(p,v,y,c,a[10],23,-1094730640),c=Ws(c,p,v,y,a[13],4,681279174),y=Ws(y,c,p,v,a[0],11,-358537222),v=Ws(v,y,c,p,a[3],16,-722521979),p=Ws(p,v,y,c,a[6],23,76029189),c=Ws(c,p,v,y,a[9],4,-640364487),y=Ws(y,c,p,v,a[12],11,-421815835),v=Ws(v,y,c,p,a[15],16,530742520),c=Hs(c,p=Ws(p,v,y,c,a[2],23,-995338651),v,y,a[0],6,-198630844),y=Hs(y,c,p,v,a[7],10,1126891415),v=Hs(v,y,c,p,a[14],15,-1416354905),p=Hs(p,v,y,c,a[5],21,-57434055),c=Hs(c,p,v,y,a[12],6,1700485571),y=Hs(y,c,p,v,a[3],10,-1894986606),v=Hs(v,y,c,p,a[10],15,-1051523),p=Hs(p,v,y,c,a[1],21,-2054922799),c=Hs(c,p,v,y,a[8],6,1873313359),y=Hs(y,c,p,v,a[15],10,-30611744),v=Hs(v,y,c,p,a[6],15,-1560198380),p=Hs(p,v,y,c,a[13],21,1309151649),c=Hs(c,p,v,y,a[4],6,-145523070),y=Hs(y,c,p,v,a[11],10,-1120210379),v=Hs(v,y,c,p,a[2],15,718787259),p=Hs(p,v,y,c,a[9],21,-343485551),h[0]=bc(c,h[0]),h[1]=bc(p,h[1]),h[2]=bc(v,h[2]),h[3]=bc(y,h[3])}function cd(h,a,c,p,v,y){return a=bc(bc(a,h),bc(p,y)),bc(a<<v|a>>>32-v,c)}function Gs(h,a,c,p,v,y,f){return cd(a&c|~a&p,h,a,v,y,f)}function $s(h,a,c,p,v,y,f){return cd(a&p|c&~p,h,a,v,y,f)}function Ws(h,a,c,p,v,y,f){return cd(a^c^p,h,a,v,y,f)}function Hs(h,a,c,p,v,y,f){return cd(c^(a|~p),h,a,v,y,f)}function s_(h){var a,c=h.length,p=[1732584193,-271733879,-1732584194,271733878];for(a=64;a<=h.length;a+=64)fp(p,wv(h.substring(a-64,a)));h=h.substring(a-64);var v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(a=0;a<h.length;a++)v[a>>2]|=h.charCodeAt(a)<<(a%4<<3);if(v[a>>2]|=128<<(a%4<<3),a>55)for(fp(p,v),a=0;a<16;a++)v[a]=0;return v[14]=8*c,fp(p,v),p}function wv(h){var a,c=[];for(a=0;a<64;a+=4)c[a>>2]=h.charCodeAt(a)+(h.charCodeAt(a+1)<<8)+(h.charCodeAt(a+2)<<16)+(h.charCodeAt(a+3)<<24);return c}ih=Ur.atob.bind(Ur),Mp=Ur.btoa.bind(Ur);var fg="0123456789abcdef".split("");function Pv(h){for(var a="",c=0;c<4;c++)a+=fg[h>>8*c+4&15]+fg[h>>8*c&15];return a}function Sv(h){return String.fromCharCode((255&h)>>0,(65280&h)>>8,(16711680&h)>>16,(4278190080&h)>>24)}function Lp(h){return s_(h).map(Sv).join("")}var Av=function(h){for(var a=0;a<h.length;a++)h[a]=Pv(h[a]);return h.join("")}(s_("hello"))!="5d41402abc4b2a76b9719d911017c592";function bc(h,a){if(Av){var c=(65535&h)+(65535&a);return(h>>16)+(a>>16)+(c>>16)<<16|65535&c}return h+a&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function Ep(h,a){var c,p,v,y;if(h!==c){for(var f=(v=h,y=1+(256/h.length>>0),new Array(y+1).join(v)),s=[],M=0;M<256;M++)s[M]=M;var B=0;for(M=0;M<256;M++){var V=s[M];B=(B+V+f.charCodeAt(M))%256,s[M]=s[B],s[B]=V}c=h,p=s}else s=p;var U=a.length,J=0,N=0,de="";for(M=0;M<U;M++)N=(N+(V=s[J=(J+1)%256]))%256,s[J]=s[N],s[N]=V,f=s[(s[J]+s[N])%256],de+=String.fromCharCode(a.charCodeAt(M)^f);return de}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var mg={print:4,modify:8,copy:16,"annot-forms":32};function yu(h,a,c,p){this.v=1,this.r=2;var v=192;h.forEach(function(s){if(mg.perm!==void 0)throw new Error("Invalid permission: "+s);v+=mg[s]}),this.padding="(¿N^NuAd\0NVÿú\b..\0¶Ðh>/\f©þdSiz";var y=(a+this.padding).substr(0,32),f=(c+this.padding).substr(0,32);this.O=this.processOwnerPassword(y,f),this.P=-(1+(255^v)),this.encryptionKey=Lp(y+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(p)).substr(0,5),this.U=Ep(this.encryptionKey,this.padding)}function vu(h){if(/[^\u0000-\u00ff]/.test(h))throw new Error("Invalid PDF Name Object: "+h+", Only accept ASCII characters.");for(var a="",c=h.length,p=0;p<c;p++){var v=h.charCodeAt(p);v<33||v===35||v===37||v===40||v===41||v===47||v===60||v===62||v===91||v===93||v===123||v===125||v>126?a+="#"+("0"+v.toString(16)).slice(-2):a+=h[p]}return a}function gg(h){if(Ri(h)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var a={};this.subscribe=function(c,p,v){if(v=v||!1,typeof c!="string"||typeof p!="function"||typeof v!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");a.hasOwnProperty(c)||(a[c]={});var y=Math.random().toString(35);return a[c][y]=[p,!!v],y},this.unsubscribe=function(c){for(var p in a)if(a[p][c])return delete a[p][c],Object.keys(a[p]).length===0&&delete a[p],!0;return!1},this.publish=function(c){if(a.hasOwnProperty(c)){var p=Array.prototype.slice.call(arguments,1),v=[];for(var y in a[c]){var f=a[c][y];try{f[0].apply(h,p)}catch(s){Ur.console&&Yi.error("jsPDF PubSub Error",s.message,s)}f[1]&&v.push(y)}v.length&&v.forEach(this.unsubscribe)}},this.getTopics=function(){return a}}function Jh(h){if(!(this instanceof Jh))return new Jh(h);var a="opacity,stroke-opacity".split(",");for(var c in h)h.hasOwnProperty(c)&&a.indexOf(c)>=0&&(this[c]=h[c]);this.id="",this.objectNumber=-1}function a_(h,a){this.gState=h,this.matrix=a,this.id="",this.objectNumber=-1}function Vc(h,a,c,p,v){if(!(this instanceof Vc))return new Vc(h,a,c,p,v);this.type=h==="axial"?2:3,this.coords=a,this.colors=c,a_.call(this,p,v)}function wu(h,a,c,p,v){if(!(this instanceof wu))return new wu(h,a,c,p,v);this.boundingBox=h,this.xStep=a,this.yStep=c,this.stream="",this.cloneIndex=0,a_.call(this,p,v)}function Br(h){var a,c=typeof arguments[0]=="string"?arguments[0]:"p",p=arguments[1],v=arguments[2],y=arguments[3],f=[],s=1,M=16,B="S",V=null;Ri(h=h||{})==="object"&&(c=h.orientation,p=h.unit||p,v=h.format||v,y=h.compress||h.compressPdf||y,(V=h.encryption||null)!==null&&(V.userPassword=V.userPassword||"",V.ownerPassword=V.ownerPassword||"",V.userPermissions=V.userPermissions||[]),s=typeof h.userUnit=="number"?Math.abs(h.userUnit):1,h.precision!==void 0&&(a=h.precision),h.floatPrecision!==void 0&&(M=h.floatPrecision),B=h.defaultPathOperation||"S"),f=h.filters||(y===!0?["FlateEncode"]:f),p=p||"mm",c=(""+(c||"P")).toLowerCase();var U=h.putOnlyUsedFonts||!1,J={},N={internal:{},__private__:{}};N.__private__.PubSub=gg;var de="1.3",pe=N.__private__.getPdfVersion=function(){return de};N.__private__.setPdfVersion=function(k){de=k};var De={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};N.__private__.getPageFormats=function(){return De};var fe=N.__private__.getPageFormat=function(k){return De[k]};v=v||"a4";var ke={COMPAT:"compat",ADVANCED:"advanced"},He=ke.COMPAT;function Oe(){this.saveGraphicsState(),qe(new Pt(ur,0,0,-ur,0,va()*ur).toString()+" cm"),this.setFontSize(this.getFontSize()/ur),B="n",He=ke.ADVANCED}function Le(){this.restoreGraphicsState(),B="S",He=ke.COMPAT}var Ke=N.__private__.combineFontStyleAndFontWeight=function(k,re){if(k=="bold"&&re=="normal"||k=="bold"&&re==400||k=="normal"&&re=="italic"||k=="bold"&&re=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return re&&(k=re==400||re==="normal"?k==="italic"?"italic":"normal":re!=700&&re!=="bold"||k!=="normal"?(re==700?"bold":re)+""+k:"bold"),k};N.advancedAPI=function(k){var re=He===ke.COMPAT;return re&&Oe.call(this),typeof k!="function"||(k(this),re&&Le.call(this)),this},N.compatAPI=function(k){var re=He===ke.ADVANCED;return re&&Le.call(this),typeof k!="function"||(k(this),re&&Oe.call(this)),this},N.isAdvancedAPI=function(){return He===ke.ADVANCED};var Ue,Ae=function(k){if(He!==ke.ADVANCED)throw new Error(k+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},lt=N.roundToPrecision=N.__private__.roundToPrecision=function(k,re){var Fe=a||re;if(isNaN(k)||isNaN(Fe))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return k.toFixed(Fe).replace(/0+$/,"")};Ue=N.hpf=N.__private__.hpf=typeof M=="number"?function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.hpf");return lt(k,M)}:M==="smart"?function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.hpf");return lt(k,k>-1&&k<1?16:5)}:function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.hpf");return lt(k,16)};var mt=N.f2=N.__private__.f2=function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.f2");return lt(k,2)},_e=N.__private__.f3=function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.f3");return lt(k,3)},ve=N.scale=N.__private__.scale=function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.scale");return He===ke.COMPAT?k*ur:He===ke.ADVANCED?k:void 0},$e=function(k){return He===ke.COMPAT?va()-k:He===ke.ADVANCED?k:void 0},Ne=function(k){return ve($e(k))};N.__private__.setPrecision=N.setPrecision=function(k){typeof parseInt(k,10)=="number"&&(a=parseInt(k,10))};var wt,ut="00000000000000000000000000000000",At=N.__private__.getFileId=function(){return ut},ht=N.__private__.setFileId=function(k){return ut=k!==void 0&&/^[a-fA-F0-9]{32}$/.test(k)?k.toUpperCase():ut.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),V!==null&&(Ii=new yu(V.userPermissions,V.userPassword,V.ownerPassword,ut)),ut};N.setFileId=function(k){return ht(k),this},N.getFileId=function(){return At()};var Tt=N.__private__.convertDateToPDFDate=function(k){var re=k.getTimezoneOffset(),Fe=re<0?"+":"-",tt=Math.floor(Math.abs(re/60)),dt=Math.abs(re%60),Rt=[Fe,Re(tt),"'",Re(dt),"'"].join("");return["D:",k.getFullYear(),Re(k.getMonth()+1),Re(k.getDate()),Re(k.getHours()),Re(k.getMinutes()),Re(k.getSeconds()),Rt].join("")},Dt=N.__private__.convertPDFDateToDate=function(k){var re=parseInt(k.substr(2,4),10),Fe=parseInt(k.substr(6,2),10)-1,tt=parseInt(k.substr(8,2),10),dt=parseInt(k.substr(10,2),10),Rt=parseInt(k.substr(12,2),10),Yt=parseInt(k.substr(14,2),10);return new Date(re,Fe,tt,dt,Rt,Yt,0)},sr=N.__private__.setCreationDate=function(k){var re;if(k===void 0&&(k=new Date),k instanceof Date)re=Tt(k);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(k))throw new Error("Invalid argument passed to jsPDF.setCreationDate");re=k}return wt=re},ne=N.__private__.getCreationDate=function(k){var re=wt;return k==="jsDate"&&(re=Dt(wt)),re};N.setCreationDate=function(k){return sr(k),this},N.getCreationDate=function(k){return ne(k)};var Ie,Re=N.__private__.padd2=function(k){return("0"+parseInt(k)).slice(-2)},We=N.__private__.padd2Hex=function(k){return("00"+(k=k.toString())).substr(k.length)},nt=0,at=[],pt=[],gt=0,Ht=[],$t=[],er=!1,nr=pt,dr=function(){nt=0,gt=0,pt=[],at=[],Ht=[],Ir=Qt(),pr=Qt()};N.__private__.setCustomOutputDestination=function(k){er=!0,nr=k};var Et=function(k){er||(nr=k)};N.__private__.resetCustomOutputDestination=function(){er=!1,nr=pt};var qe=N.__private__.out=function(k){return k=k.toString(),gt+=k.length+1,nr.push(k),nr},zr=N.__private__.write=function(k){return qe(arguments.length===1?k.toString():Array.prototype.join.call(arguments," "))},yr=N.__private__.getArrayBuffer=function(k){for(var re=k.length,Fe=new ArrayBuffer(re),tt=new Uint8Array(Fe);re--;)tt[re]=k.charCodeAt(re);return Fe},Xt=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];N.__private__.getStandardFonts=function(){return Xt};var ir=h.fontSize||16;N.__private__.setFontSize=N.setFontSize=function(k){return ir=He===ke.ADVANCED?k/ur:k,this};var ar,or=N.__private__.getFontSize=N.getFontSize=function(){return He===ke.COMPAT?ir:ir*ur},xr=h.R2L||!1;N.__private__.setR2L=N.setR2L=function(k){return xr=k,this},N.__private__.getR2L=N.getR2L=function(){return xr};var wr,Dr=N.__private__.setZoomMode=function(k){var re=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(k))ar=k;else if(isNaN(k)){if(re.indexOf(k)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+k+'" is not recognized.');ar=k}else ar=parseInt(k,10)};N.__private__.getZoomMode=function(){return ar};var Fr,Zr=N.__private__.setPageMode=function(k){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(k)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+k+'" is not recognized.');wr=k};N.__private__.getPageMode=function(){return wr};var Jr=N.__private__.setLayoutMode=function(k){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(k)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+k+'" is not recognized.');Fr=k};N.__private__.getLayoutMode=function(){return Fr},N.__private__.setDisplayMode=N.setDisplayMode=function(k,re,Fe){return Dr(k),Jr(re),Zr(Fe),this};var Mr={title:"",subject:"",author:"",keywords:"",creator:""};N.__private__.getDocumentProperty=function(k){if(Object.keys(Mr).indexOf(k)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return Mr[k]},N.__private__.getDocumentProperties=function(){return Mr},N.__private__.setDocumentProperties=N.setProperties=N.setDocumentProperties=function(k){for(var re in Mr)Mr.hasOwnProperty(re)&&k[re]&&(Mr[re]=k[re]);return this},N.__private__.setDocumentProperty=function(k,re){if(Object.keys(Mr).indexOf(k)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return Mr[k]=re};var Rr,ur,Wi,Qr,Bi,K={},x={},A=[],O={},G={},Q={},le={},Te=null,ue=0,xe=[],we=new gg(N),ze=h.hotfixes||[],Qe={},je={},ft=[],Pt=function k(re,Fe,tt,dt,Rt,Yt){if(!(this instanceof k))return new k(re,Fe,tt,dt,Rt,Yt);isNaN(re)&&(re=1),isNaN(Fe)&&(Fe=0),isNaN(tt)&&(tt=0),isNaN(dt)&&(dt=1),isNaN(Rt)&&(Rt=0),isNaN(Yt)&&(Yt=0),this._matrix=[re,Fe,tt,dt,Rt,Yt]};Object.defineProperty(Pt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(k){this._matrix[0]=k}}),Object.defineProperty(Pt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(k){this._matrix[1]=k}}),Object.defineProperty(Pt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(k){this._matrix[2]=k}}),Object.defineProperty(Pt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(k){this._matrix[3]=k}}),Object.defineProperty(Pt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(k){this._matrix[4]=k}}),Object.defineProperty(Pt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(k){this._matrix[5]=k}}),Object.defineProperty(Pt.prototype,"a",{get:function(){return this._matrix[0]},set:function(k){this._matrix[0]=k}}),Object.defineProperty(Pt.prototype,"b",{get:function(){return this._matrix[1]},set:function(k){this._matrix[1]=k}}),Object.defineProperty(Pt.prototype,"c",{get:function(){return this._matrix[2]},set:function(k){this._matrix[2]=k}}),Object.defineProperty(Pt.prototype,"d",{get:function(){return this._matrix[3]},set:function(k){this._matrix[3]=k}}),Object.defineProperty(Pt.prototype,"e",{get:function(){return this._matrix[4]},set:function(k){this._matrix[4]=k}}),Object.defineProperty(Pt.prototype,"f",{get:function(){return this._matrix[5]},set:function(k){this._matrix[5]=k}}),Object.defineProperty(Pt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Pt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Pt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Pt.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Pt.prototype.join=function(k){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(Ue).join(k)},Pt.prototype.multiply=function(k){var re=k.sx*this.sx+k.shy*this.shx,Fe=k.sx*this.shy+k.shy*this.sy,tt=k.shx*this.sx+k.sy*this.shx,dt=k.shx*this.shy+k.sy*this.sy,Rt=k.tx*this.sx+k.ty*this.shx+this.tx,Yt=k.tx*this.shy+k.ty*this.sy+this.ty;return new Pt(re,Fe,tt,dt,Rt,Yt)},Pt.prototype.decompose=function(){var k=this.sx,re=this.shy,Fe=this.shx,tt=this.sy,dt=this.tx,Rt=this.ty,Yt=Math.sqrt(k*k+re*re),mr=(k/=Yt)*Fe+(re/=Yt)*tt;Fe-=k*mr,tt-=re*mr;var Er=Math.sqrt(Fe*Fe+tt*tt);return mr/=Er,k*(tt/=Er)<re*(Fe/=Er)&&(k=-k,re=-re,mr=-mr,Yt=-Yt),{scale:new Pt(Yt,0,0,Er,0,0),translate:new Pt(1,0,0,1,dt,Rt),rotate:new Pt(k,re,-re,k,0,0),skew:new Pt(1,0,mr,1,0,0)}},Pt.prototype.toString=function(k){return this.join(" ")},Pt.prototype.inversed=function(){var k=this.sx,re=this.shy,Fe=this.shx,tt=this.sy,dt=this.tx,Rt=this.ty,Yt=1/(k*tt-re*Fe),mr=tt*Yt,Er=-re*Yt,Or=-Fe*Yt,jr=k*Yt;return new Pt(mr,Er,Or,jr,-mr*dt-Or*Rt,-Er*dt-jr*Rt)},Pt.prototype.applyToPoint=function(k){var re=k.x*this.sx+k.y*this.shx+this.tx,Fe=k.x*this.shy+k.y*this.sy+this.ty;return new Ra(re,Fe)},Pt.prototype.applyToRectangle=function(k){var re=this.applyToPoint(k),Fe=this.applyToPoint(new Ra(k.x+k.w,k.y+k.h));return new Sn(re.x,re.y,Fe.x-re.x,Fe.y-re.y)},Pt.prototype.clone=function(){var k=this.sx,re=this.shy,Fe=this.shx,tt=this.sy,dt=this.tx,Rt=this.ty;return new Pt(k,re,Fe,tt,dt,Rt)},N.Matrix=Pt;var rr=N.matrixMult=function(k,re){return re.multiply(k)},lr=new Pt(1,0,0,1,0,0);N.unitMatrix=N.identityMatrix=lr;var yt=function(k,re){if(!G[k]){var Fe=(re instanceof Vc?"Sh":"P")+(Object.keys(O).length+1).toString(10);re.id=Fe,G[k]=Fe,O[Fe]=re,we.publish("addPattern",re)}};N.ShadingPattern=Vc,N.TilingPattern=wu,N.addShadingPattern=function(k,re){return Ae("addShadingPattern()"),yt(k,re),this},N.beginTilingPattern=function(k){Ae("beginTilingPattern()"),_a(k.boundingBox[0],k.boundingBox[1],k.boundingBox[2]-k.boundingBox[0],k.boundingBox[3]-k.boundingBox[1],k.matrix)},N.endTilingPattern=function(k,re){Ae("endTilingPattern()"),re.stream=$t[Ie].join(`
`),yt(k,re),we.publish("endTilingPattern",re),ft.pop().restore()};var Zt=N.__private__.newObject=function(){var k=Qt();return Pr(k,!0),k},Qt=N.__private__.newObjectDeferred=function(){return nt++,at[nt]=function(){return gt},nt},Pr=function(k,re){return re=typeof re=="boolean"&&re,at[k]=gt,re&&qe(k+" 0 obj"),k},Sr=N.__private__.newAdditionalObject=function(){var k={objId:Qt(),content:""};return Ht.push(k),k},Ir=Qt(),pr=Qt(),en=N.__private__.decodeColorString=function(k){var re=k.split(" ");if(re.length!==2||re[1]!=="g"&&re[1]!=="G")re.length===5&&(re[4]==="k"||re[4]==="K")&&(re=[(1-re[0])*(1-re[3]),(1-re[1])*(1-re[3]),(1-re[2])*(1-re[3]),"r"]);else{var Fe=parseFloat(re[0]);re=[Fe,Fe,Fe,"r"]}for(var tt="#",dt=0;dt<3;dt++)tt+=("0"+Math.floor(255*parseFloat(re[dt])).toString(16)).slice(-2);return tt},di=N.__private__.encodeColorString=function(k){var re;typeof k=="string"&&(k={ch1:k});var Fe=k.ch1,tt=k.ch2,dt=k.ch3,Rt=k.ch4,Yt=k.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Fe=="string"&&Fe.charAt(0)!=="#"){var mr=new n_(Fe);if(mr.ok)Fe=mr.toHex();else if(!/^\d*\.?\d*$/.test(Fe))throw new Error('Invalid color "'+Fe+'" passed to jsPDF.encodeColorString.')}if(typeof Fe=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Fe)&&(Fe="#"+Fe[1]+Fe[1]+Fe[2]+Fe[2]+Fe[3]+Fe[3]),typeof Fe=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Fe)){var Er=parseInt(Fe.substr(1),16);Fe=Er>>16&255,tt=Er>>8&255,dt=255&Er}if(tt===void 0||Rt===void 0&&Fe===tt&&tt===dt)if(typeof Fe=="string")re=Fe+" "+Yt[0];else switch(k.precision){case 2:re=mt(Fe/255)+" "+Yt[0];break;case 3:default:re=_e(Fe/255)+" "+Yt[0]}else if(Rt===void 0||Ri(Rt)==="object"){if(Rt&&!isNaN(Rt.a)&&Rt.a===0)return re=["1.","1.","1.",Yt[1]].join(" ");if(typeof Fe=="string")re=[Fe,tt,dt,Yt[1]].join(" ");else switch(k.precision){case 2:re=[mt(Fe/255),mt(tt/255),mt(dt/255),Yt[1]].join(" ");break;default:case 3:re=[_e(Fe/255),_e(tt/255),_e(dt/255),Yt[1]].join(" ")}}else if(typeof Fe=="string")re=[Fe,tt,dt,Rt,Yt[2]].join(" ");else switch(k.precision){case 2:re=[mt(Fe),mt(tt),mt(dt),mt(Rt),Yt[2]].join(" ");break;case 3:default:re=[_e(Fe),_e(tt),_e(dt),_e(Rt),Yt[2]].join(" ")}return re},yi=N.__private__.getFilters=function(){return f},ri=N.__private__.putStream=function(k){var re=(k=k||{}).data||"",Fe=k.filters||yi(),tt=k.alreadyAppliedFilters||[],dt=k.addLength1||!1,Rt=re.length,Yt=k.objectId,mr=function(Ln){return Ln};if(V!==null&&Yt===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");V!==null&&(mr=Ii.encryptor(Yt,0));var Er={};Fe===!0&&(Fe=["FlateEncode"]);var Or=k.additionalKeyValues||[],jr=(Er=Br.API.processDataByFilters!==void 0?Br.API.processDataByFilters(re,Fe):{data:re,reverseChain:[]}).reverseChain+(Array.isArray(tt)?tt.join(" "):tt.toString());if(Er.data.length!==0&&(Or.push({key:"Length",value:Er.data.length}),dt===!0&&Or.push({key:"Length1",value:Rt})),jr.length!=0)if(jr.split("/").length-1==1)Or.push({key:"Filter",value:jr});else{Or.push({key:"Filter",value:"["+jr+"]"});for(var ai=0;ai<Or.length;ai+=1)if(Or[ai].key==="DecodeParms"){for(var Di=[],Xi=0;Xi<Er.reverseChain.split("/").length-1;Xi+=1)Di.push("null");Di.push(Or[ai].value),Or[ai].value="["+Di.join(" ")+"]"}}qe("<<");for(var Ci=0;Ci<Or.length;Ci++)qe("/"+Or[Ci].key+" "+Or[Ci].value);qe(">>"),Er.data.length!==0&&(qe("stream"),qe(mr(Er.data)),qe("endstream"))},xs=N.__private__.putPage=function(k){var re=k.number,Fe=k.data,tt=k.objId,dt=k.contentsObjId;Pr(tt,!0),qe("<</Type /Page"),qe("/Parent "+k.rootDictionaryObjId+" 0 R"),qe("/Resources "+k.resourceDictionaryObjId+" 0 R"),qe("/MediaBox ["+parseFloat(Ue(k.mediaBox.bottomLeftX))+" "+parseFloat(Ue(k.mediaBox.bottomLeftY))+" "+Ue(k.mediaBox.topRightX)+" "+Ue(k.mediaBox.topRightY)+"]"),k.cropBox!==null&&qe("/CropBox ["+Ue(k.cropBox.bottomLeftX)+" "+Ue(k.cropBox.bottomLeftY)+" "+Ue(k.cropBox.topRightX)+" "+Ue(k.cropBox.topRightY)+"]"),k.bleedBox!==null&&qe("/BleedBox ["+Ue(k.bleedBox.bottomLeftX)+" "+Ue(k.bleedBox.bottomLeftY)+" "+Ue(k.bleedBox.topRightX)+" "+Ue(k.bleedBox.topRightY)+"]"),k.trimBox!==null&&qe("/TrimBox ["+Ue(k.trimBox.bottomLeftX)+" "+Ue(k.trimBox.bottomLeftY)+" "+Ue(k.trimBox.topRightX)+" "+Ue(k.trimBox.topRightY)+"]"),k.artBox!==null&&qe("/ArtBox ["+Ue(k.artBox.bottomLeftX)+" "+Ue(k.artBox.bottomLeftY)+" "+Ue(k.artBox.topRightX)+" "+Ue(k.artBox.topRightY)+"]"),typeof k.userUnit=="number"&&k.userUnit!==1&&qe("/UserUnit "+k.userUnit),we.publish("putPage",{objId:tt,pageContext:xe[re],pageNumber:re,page:Fe}),qe("/Contents "+dt+" 0 R"),qe(">>"),qe("endobj");var Rt=Fe.join(`
`);return He===ke.ADVANCED&&(Rt+=`
Q`),Pr(dt,!0),ri({data:Rt,filters:yi(),objectId:dt}),qe("endobj"),tt},cn=N.__private__.putPages=function(){var k,re,Fe=[];for(k=1;k<=ue;k++)xe[k].objId=Qt(),xe[k].contentsObjId=Qt();for(k=1;k<=ue;k++)Fe.push(xs({number:k,data:$t[k],objId:xe[k].objId,contentsObjId:xe[k].contentsObjId,mediaBox:xe[k].mediaBox,cropBox:xe[k].cropBox,bleedBox:xe[k].bleedBox,trimBox:xe[k].trimBox,artBox:xe[k].artBox,userUnit:xe[k].userUnit,rootDictionaryObjId:Ir,resourceDictionaryObjId:pr}));Pr(Ir,!0),qe("<</Type /Pages");var tt="/Kids [";for(re=0;re<ue;re++)tt+=Fe[re]+" 0 R ";qe(tt+"]"),qe("/Count "+ue),qe(">>"),qe("endobj"),we.publish("postPutPages")},ci=function(k){we.publish("putFont",{font:k,out:qe,newObject:Zt,putStream:ri}),k.isAlreadyPutted!==!0&&(k.objectNumber=Zt(),qe("<<"),qe("/Type /Font"),qe("/BaseFont /"+vu(k.postScriptName)),qe("/Subtype /Type1"),typeof k.encoding=="string"&&qe("/Encoding /"+k.encoding),qe("/FirstChar 32"),qe("/LastChar 255"),qe(">>"),qe("endobj"))},wo=function(){for(var k in K)K.hasOwnProperty(k)&&(U===!1||U===!0&&J.hasOwnProperty(k))&&ci(K[k])},fa=function(k){k.objectNumber=Zt();var re=[];re.push({key:"Type",value:"/XObject"}),re.push({key:"Subtype",value:"/Form"}),re.push({key:"BBox",value:"["+[Ue(k.x),Ue(k.y),Ue(k.x+k.width),Ue(k.y+k.height)].join(" ")+"]"}),re.push({key:"Matrix",value:"["+k.matrix.toString()+"]"});var Fe=k.pages[1].join(`
`);ri({data:Fe,additionalKeyValues:re,objectId:k.objectNumber}),qe("endobj")},ro=function(){for(var k in Qe)Qe.hasOwnProperty(k)&&fa(Qe[k])},Ks=function(k,re){var Fe,tt=[],dt=1/(re-1);for(Fe=0;Fe<1;Fe+=dt)tt.push(Fe);if(tt.push(1),k[0].offset!=0){var Rt={offset:0,color:k[0].color};k.unshift(Rt)}if(k[k.length-1].offset!=1){var Yt={offset:1,color:k[k.length-1].color};k.push(Yt)}for(var mr="",Er=0,Or=0;Or<tt.length;Or++){for(Fe=tt[Or];Fe>k[Er+1].offset;)Er++;var jr=k[Er].offset,ai=(Fe-jr)/(k[Er+1].offset-jr),Di=k[Er].color,Xi=k[Er+1].color;mr+=We(Math.round((1-ai)*Di[0]+ai*Xi[0]).toString(16))+We(Math.round((1-ai)*Di[1]+ai*Xi[1]).toString(16))+We(Math.round((1-ai)*Di[2]+ai*Xi[2]).toString(16))}return mr.trim()},io=function(k,re){re||(re=21);var Fe=Zt(),tt=Ks(k.colors,re),dt=[];dt.push({key:"FunctionType",value:"0"}),dt.push({key:"Domain",value:"[0.0 1.0]"}),dt.push({key:"Size",value:"["+re+"]"}),dt.push({key:"BitsPerSample",value:"8"}),dt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),dt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),ri({data:tt,additionalKeyValues:dt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Fe}),qe("endobj"),k.objectNumber=Zt(),qe("<< /ShadingType "+k.type),qe("/ColorSpace /DeviceRGB");var Rt="/Coords ["+Ue(parseFloat(k.coords[0]))+" "+Ue(parseFloat(k.coords[1]))+" ";k.type===2?Rt+=Ue(parseFloat(k.coords[2]))+" "+Ue(parseFloat(k.coords[3])):Rt+=Ue(parseFloat(k.coords[2]))+" "+Ue(parseFloat(k.coords[3]))+" "+Ue(parseFloat(k.coords[4]))+" "+Ue(parseFloat(k.coords[5])),qe(Rt+="]"),k.matrix&&qe("/Matrix ["+k.matrix.toString()+"]"),qe("/Function "+Fe+" 0 R"),qe("/Extend [true true]"),qe(">>"),qe("endobj")},El=function(k,re){var Fe=Qt(),tt=Zt();re.push({resourcesOid:Fe,objectOid:tt}),k.objectNumber=tt;var dt=[];dt.push({key:"Type",value:"/Pattern"}),dt.push({key:"PatternType",value:"1"}),dt.push({key:"PaintType",value:"1"}),dt.push({key:"TilingType",value:"1"}),dt.push({key:"BBox",value:"["+k.boundingBox.map(Ue).join(" ")+"]"}),dt.push({key:"XStep",value:Ue(k.xStep)}),dt.push({key:"YStep",value:Ue(k.yStep)}),dt.push({key:"Resources",value:Fe+" 0 R"}),k.matrix&&dt.push({key:"Matrix",value:"["+k.matrix.toString()+"]"}),ri({data:k.stream,additionalKeyValues:dt,objectId:k.objectNumber}),qe("endobj")},Po=function(k){var re;for(re in O)O.hasOwnProperty(re)&&(O[re]instanceof Vc?io(O[re]):O[re]instanceof wu&&El(O[re],k))},kl=function(k){for(var re in k.objectNumber=Zt(),qe("<<"),k)switch(re){case"opacity":qe("/ca "+mt(k[re]));break;case"stroke-opacity":qe("/CA "+mt(k[re]))}qe(">>"),qe("endobj")},no=function(){var k;for(k in Q)Q.hasOwnProperty(k)&&kl(Q[k])},tl=function(){for(var k in qe("/XObject <<"),Qe)Qe.hasOwnProperty(k)&&Qe[k].objectNumber>=0&&qe("/"+k+" "+Qe[k].objectNumber+" 0 R");we.publish("putXobjectDict"),qe(">>")},Ac=function(){Ii.oid=Zt(),qe("<<"),qe("/Filter /Standard"),qe("/V "+Ii.v),qe("/R "+Ii.r),qe("/U <"+Ii.toHexString(Ii.U)+">"),qe("/O <"+Ii.toHexString(Ii.O)+">"),qe("/P "+Ii.P),qe(">>"),qe("endobj")},tc=function(){for(var k in qe("/Font <<"),K)K.hasOwnProperty(k)&&(U===!1||U===!0&&J.hasOwnProperty(k))&&qe("/"+k+" "+K[k].objectNumber+" 0 R");qe(">>")},Tc=function(){if(Object.keys(O).length>0){for(var k in qe("/Shading <<"),O)O.hasOwnProperty(k)&&O[k]instanceof Vc&&O[k].objectNumber>=0&&qe("/"+k+" "+O[k].objectNumber+" 0 R");we.publish("putShadingPatternDict"),qe(">>")}},so=function(k){if(Object.keys(O).length>0){for(var re in qe("/Pattern <<"),O)O.hasOwnProperty(re)&&O[re]instanceof N.TilingPattern&&O[re].objectNumber>=0&&O[re].objectNumber<k&&qe("/"+re+" "+O[re].objectNumber+" 0 R");we.publish("putTilingPatternDict"),qe(">>")}},ao=function(){if(Object.keys(Q).length>0){var k;for(k in qe("/ExtGState <<"),Q)Q.hasOwnProperty(k)&&Q[k].objectNumber>=0&&qe("/"+k+" "+Q[k].objectNumber+" 0 R");we.publish("putGStateDict"),qe(">>")}},Hi=function(k){Pr(k.resourcesOid,!0),qe("<<"),qe("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),tc(),Tc(),so(k.objectOid),ao(),tl(),qe(">>"),qe("endobj")},rl=function(){var k=[];wo(),no(),ro(),Po(k),we.publish("putResources"),k.forEach(Hi),Hi({resourcesOid:pr,objectOid:Number.MAX_SAFE_INTEGER}),we.publish("postPutResources")},za=function(){we.publish("putAdditionalObjects");for(var k=0;k<Ht.length;k++){var re=Ht[k];Pr(re.objId,!0),qe(re.content),qe("endobj")}we.publish("postPutAdditionalObjects")},il=function(k){x[k.fontName]=x[k.fontName]||{},x[k.fontName][k.fontStyle]=k.id},So=function(k,re,Fe,tt,dt){var Rt={id:"F"+(Object.keys(K).length+1).toString(10),postScriptName:k,fontName:re,fontStyle:Fe,encoding:tt,isStandardFont:dt||!1,metadata:{}};return we.publish("addFont",{font:Rt,instance:this}),K[Rt.id]=Rt,il(Rt),Rt.id},nl=function(k){for(var re=0,Fe=Xt.length;re<Fe;re++){var tt=So.call(this,k[re][0],k[re][1],k[re][2],Xt[re][3],!0);U===!1&&(J[tt]=!0);var dt=k[re][0].split("-");il({id:tt,fontName:dt[0],fontStyle:dt[1]||""})}we.publish("addFonts",{fonts:K,dictionary:x})},ws=function(k){return k.foo=function(){try{return k.apply(this,arguments)}catch(tt){var re=tt.stack||"";~re.indexOf(" at ")&&(re=re.split(" at ")[1]);var Fe="Error in function "+re.split(`
`)[0].split("<")[0]+": "+tt.message;if(!Ur.console)throw new Error(Fe);Ur.console.error(Fe,tt),Ur.alert&&alert(Fe)}},k.foo.bar=k,k.foo},Ls=function(k,re){var Fe,tt,dt,Rt,Yt,mr,Er,Or,jr;if(dt=(re=re||{}).sourceEncoding||"Unicode",Yt=re.outputEncoding,(re.autoencode||Yt)&&K[Rr].metadata&&K[Rr].metadata[dt]&&K[Rr].metadata[dt].encoding&&(Rt=K[Rr].metadata[dt].encoding,!Yt&&K[Rr].encoding&&(Yt=K[Rr].encoding),!Yt&&Rt.codePages&&(Yt=Rt.codePages[0]),typeof Yt=="string"&&(Yt=Rt[Yt]),Yt)){for(Er=!1,mr=[],Fe=0,tt=k.length;Fe<tt;Fe++)(Or=Yt[k.charCodeAt(Fe)])?mr.push(String.fromCharCode(Or)):mr.push(k[Fe]),mr[Fe].charCodeAt(0)>>8&&(Er=!0);k=mr.join("")}for(Fe=k.length;Er===void 0&&Fe!==0;)k.charCodeAt(Fe-1)>>8&&(Er=!0),Fe--;if(!Er)return k;for(mr=re.noBOM?[]:[254,255],Fe=0,tt=k.length;Fe<tt;Fe++){if((jr=(Or=k.charCodeAt(Fe))>>8)>>8)throw new Error("Character at position "+Fe+" of string '"+k+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");mr.push(jr),mr.push(Or-(jr<<8))}return String.fromCharCode.apply(void 0,mr)},Oi=N.__private__.pdfEscape=N.pdfEscape=function(k,re){return Ls(k,re).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Yr=N.__private__.beginPage=function(k){$t[++ue]=[],xe[ue]={objId:0,contentsObjId:0,userUnit:Number(s),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(k[0]),topRightY:Number(k[1])}},ei(ue),Et($t[Ie])},qn=function(k,re){var Fe,tt,dt;switch(c=re||c,typeof k=="string"&&(Fe=fe(k.toLowerCase()),Array.isArray(Fe)&&(tt=Fe[0],dt=Fe[1])),Array.isArray(k)&&(tt=k[0]*ur,dt=k[1]*ur),isNaN(tt)&&(tt=v[0],dt=v[1]),(tt>14400||dt>14400)&&(Yi.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),tt=Math.min(14400,tt),dt=Math.min(14400,dt)),v=[tt,dt],c.substr(0,1)){case"l":dt>tt&&(v=[dt,tt]);break;case"p":tt>dt&&(v=[dt,tt])}Yr(v),rc(ma),qe(mi),Mo!==0&&qe(Mo+" J"),Dl!==0&&qe(Dl+" j"),we.publish("addPage",{pageNumber:ue})},os=function(k){k>0&&k<=ue&&($t.splice(k,1),xe.splice(k,1),ue--,Ie>ue&&(Ie=ue),this.setPage(Ie))},ei=function(k){k>0&&k<=ue&&(Ie=k)},sl=N.__private__.getNumberOfPages=N.getNumberOfPages=function(){return $t.length-1},al=function(k,re,Fe){var tt,dt=void 0;return Fe=Fe||{},k=k!==void 0?k:K[Rr].fontName,re=re!==void 0?re:K[Rr].fontStyle,tt=k.toLowerCase(),x[tt]!==void 0&&x[tt][re]!==void 0?dt=x[tt][re]:x[k]!==void 0&&x[k][re]!==void 0?dt=x[k][re]:Fe.disableWarning===!1&&Yi.warn("Unable to look up font label for font '"+k+"', '"+re+"'. Refer to getFontList() for available fonts."),dt||Fe.noFallback||(dt=x.times[re])==null&&(dt=x.times.normal),dt},ls=N.__private__.putInfo=function(){var k=Zt(),re=function(tt){return tt};for(var Fe in V!==null&&(re=Ii.encryptor(k,0)),qe("<<"),qe("/Producer ("+Oi(re("jsPDF "+Br.version))+")"),Mr)Mr.hasOwnProperty(Fe)&&Mr[Fe]&&qe("/"+Fe.substr(0,1).toUpperCase()+Fe.substr(1)+" ("+Oi(re(Mr[Fe]))+")");qe("/CreationDate ("+Oi(re(wt))+")"),qe(">>"),qe("endobj")},tn=N.__private__.putCatalog=function(k){var re=(k=k||{}).rootDictionaryObjId||Ir;switch(Zt(),qe("<<"),qe("/Type /Catalog"),qe("/Pages "+re+" 0 R"),ar||(ar="fullwidth"),ar){case"fullwidth":qe("/OpenAction [3 0 R /FitH null]");break;case"fullheight":qe("/OpenAction [3 0 R /FitV null]");break;case"fullpage":qe("/OpenAction [3 0 R /Fit]");break;case"original":qe("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Fe=""+ar;Fe.substr(Fe.length-1)==="%"&&(ar=parseInt(ar)/100),typeof ar=="number"&&qe("/OpenAction [3 0 R /XYZ null null "+mt(ar)+"]")}switch(Fr||(Fr="continuous"),Fr){case"continuous":qe("/PageLayout /OneColumn");break;case"single":qe("/PageLayout /SinglePage");break;case"two":case"twoleft":qe("/PageLayout /TwoColumnLeft");break;case"tworight":qe("/PageLayout /TwoColumnRight")}wr&&qe("/PageMode /"+wr),we.publish("putCatalog"),qe(">>"),qe("endobj")},un=N.__private__.putTrailer=function(){qe("trailer"),qe("<<"),qe("/Size "+(nt+1)),qe("/Root "+nt+" 0 R"),qe("/Info "+(nt-1)+" 0 R"),V!==null&&qe("/Encrypt "+Ii.oid+" 0 R"),qe("/ID [ <"+ut+"> <"+ut+"> ]"),qe(">>")},ki=N.__private__.putHeader=function(){qe("%PDF-"+de),qe("%ºß¬à")},zl=N.__private__.putXRef=function(){var k="0000000000";qe("xref"),qe("0 "+(nt+1)),qe("0000000000 65535 f ");for(var re=1;re<=nt;re++)typeof at[re]=="function"?qe((k+at[re]()).slice(-10)+" 00000 n "):at[re]!==void 0?qe((k+at[re]).slice(-10)+" 00000 n "):qe("0000000000 00000 n ")},Ti=N.__private__.buildDocument=function(){dr(),Et(pt),we.publish("buildDocument"),ki(),cn(),za(),rl(),V!==null&&Ac(),ls(),tn();var k=gt;return zl(),un(),qe("startxref"),qe(""+k),qe("%%EOF"),Et($t[Ie]),pt.join(`
`)},hn=N.__private__.getBlob=function(k){return new Blob([yr(k)],{type:"application/pdf"})},mn=N.output=N.__private__.output=ws(function(k,re){switch(typeof(re=re||{})=="string"?re={filename:re}:re.filename=re.filename||"generated.pdf",k){case void 0:return Ti();case"save":N.save(re.filename);break;case"arraybuffer":return yr(Ti());case"blob":return hn(Ti());case"bloburi":case"bloburl":if(Ur.URL!==void 0&&typeof Ur.URL.createObjectURL=="function")return Ur.URL&&Ur.URL.createObjectURL(hn(Ti()))||void 0;Yi.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Fe="",tt=Ti();try{Fe=Mp(tt)}catch{Fe=Mp(unescape(encodeURIComponent(tt)))}return"data:application/pdf;filename="+re.filename+";base64,"+Fe;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Ur)==="[object Window]"){var dt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Rt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';re.pdfObjectUrl&&(dt=re.pdfObjectUrl,Rt="");var Yt='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+dt+'"'+Rt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(re)+");<\/script></body></html>",mr=Ur.open();return mr!==null&&mr.document.write(Yt),mr}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Ur)==="[object Window]"){var Er='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(re.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+re.filename+'" width="500px" height="400px" /></body></html>',Or=Ur.open();if(Or!==null){Or.document.write(Er);var jr=this;Or.document.documentElement.querySelector("#pdfViewer").onload=function(){Or.document.title=re.filename,Or.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(jr.output("bloburl"))}}return Or}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Ur)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var ai='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",re)+'"></iframe></body></html>',Di=Ur.open();if(Di!==null&&(Di.document.write(ai),Di.document.title=re.filename),Di||typeof safari>"u")return Di;break;case"datauri":case"dataurl":return Ur.document.location.href=this.output("datauristring",re);default:return null}}),Ao=function(k){return Array.isArray(ze)===!0&&ze.indexOf(k)>-1};switch(p){case"pt":ur=1;break;case"mm":ur=72/25.4;break;case"cm":ur=72/2.54;break;case"in":ur=72;break;case"px":ur=Ao("px_scaling")==1?.75:96/72;break;case"pc":case"em":ur=12;break;case"ex":ur=6;break;default:if(typeof p!="number")throw new Error("Invalid unit: "+p);ur=p}var Ii=null;sr(),ht();var Ki=function(k){return V!==null?Ii.encryptor(k,0):function(re){return re}},Js=N.__private__.getPageInfo=N.getPageInfo=function(k){if(isNaN(k)||k%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:xe[k].objId,pageNumber:k,pageContext:xe[k]}},Lr=N.__private__.getPageInfoByObjId=function(k){if(isNaN(k)||k%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var re in xe)if(xe[re].objId===k)break;return Js(re)},To=N.__private__.getCurrentPageInfo=N.getCurrentPageInfo=function(){return{objId:xe[Ie].objId,pageNumber:Ie,pageContext:xe[Ie]}};N.addPage=function(){return qn.apply(this,arguments),this},N.setPage=function(){return ei.apply(this,arguments),Et.call(this,$t[Ie]),this},N.insertPage=function(k){return this.addPage(),this.movePage(Ie,k),this},N.movePage=function(k,re){var Fe,tt;if(k>re){Fe=$t[k],tt=xe[k];for(var dt=k;dt>re;dt--)$t[dt]=$t[dt-1],xe[dt]=xe[dt-1];$t[re]=Fe,xe[re]=tt,this.setPage(re)}else if(k<re){Fe=$t[k],tt=xe[k];for(var Rt=k;Rt<re;Rt++)$t[Rt]=$t[Rt+1],xe[Rt]=xe[Rt+1];$t[re]=Fe,xe[re]=tt,this.setPage(re)}return this},N.deletePage=function(){return os.apply(this,arguments),this},N.__private__.text=N.text=function(k,re,Fe,tt,dt){var Rt,Yt,mr,Er,Or,jr,ai,Di,Xi,Ci=(tt=tt||{}).scope||this;if(typeof k=="number"&&typeof re=="number"&&(typeof Fe=="string"||Array.isArray(Fe))){var Ln=Fe;Fe=re,re=k,k=Ln}if(arguments[3]instanceof Pt?(Ae("The transform parameter of text() with a Matrix value"),Xi=dt):(mr=arguments[4],Er=arguments[5],Ri(ai=arguments[3])==="object"&&ai!==null||(typeof mr=="string"&&(Er=mr,mr=null),typeof ai=="string"&&(Er=ai,ai=null),typeof ai=="number"&&(mr=ai,ai=null),tt={flags:ai,angle:mr,align:Er})),isNaN(re)||isNaN(Fe)||k==null)throw new Error("Invalid arguments passed to jsPDF.text");if(k.length===0)return Ci;var gn="",En=!1,zs=typeof tt.lineHeightFactor=="number"?tt.lineHeightFactor:Qs,Ps=Ci.internal.scaleFactor;function ic(Si){return Si=Si.split("	").join(Array(tt.TabLen||9).join(" ")),Oi(Si,ai)}function dl(Si){for(var fi,rn=Si.concat(),_n=[],wa=rn.length;wa--;)typeof(fi=rn.shift())=="string"?_n.push(fi):Array.isArray(Si)&&(fi.length===1||fi[1]===void 0&&fi[2]===void 0)?_n.push(fi[0]):_n.push([fi[0],fi[1],fi[2]]);return _n}function Eo(Si,fi){var rn;if(typeof Si=="string")rn=fi(Si)[0];else if(Array.isArray(Si)){for(var _n,wa,gl=Si.concat(),go=[],No=gl.length;No--;)typeof(_n=gl.shift())=="string"?go.push(fi(_n)[0]):Array.isArray(_n)&&typeof _n[0]=="string"&&(wa=fi(_n[0],_n[1],_n[2]),go.push([wa[0],wa[1],wa[2]]));rn=go}return rn}var ko=!1,pl=!0;if(typeof k=="string")ko=!0;else if(Array.isArray(k)){var uo=k.concat();Yt=[];for(var ho,pn=uo.length;pn--;)(typeof(ho=uo.shift())!="string"||Array.isArray(ho)&&typeof ho[0]!="string")&&(pl=!1);ko=pl}if(ko===!1)throw new Error('Type of text must be string or Array. "'+k+'" is not recognized.');typeof k=="string"&&(k=k.match(/[\r?\n]/)?k.split(/\r\n|\r|\n/g):[k]);var hs=ir/Ci.internal.scaleFactor,po=hs*(zs-1);switch(tt.baseline){case"bottom":Fe-=po;break;case"top":Fe+=hs-po;break;case"hanging":Fe+=hs-2*po;break;case"middle":Fe+=hs/2-po}if((jr=tt.maxWidth||0)>0&&(typeof k=="string"?k=Ci.splitTextToSize(k,jr):Object.prototype.toString.call(k)==="[object Array]"&&(k=k.reduce(function(Si,fi){return Si.concat(Ci.splitTextToSize(fi,jr))},[]))),Rt={text:k,x:re,y:Fe,options:tt,mutex:{pdfEscape:Oi,activeFontKey:Rr,fonts:K,activeFontSize:ir}},we.publish("preProcessText",Rt),k=Rt.text,mr=(tt=Rt.options).angle,!(Xi instanceof Pt)&&mr&&typeof mr=="number"){mr*=Math.PI/180,tt.rotationDirection===0&&(mr=-mr),He===ke.ADVANCED&&(mr=-mr);var Oa=Math.cos(mr),zo=Math.sin(mr);Xi=new Pt(Oa,zo,-zo,Oa,0,0)}else mr&&mr instanceof Pt&&(Xi=mr);He!==ke.ADVANCED||Xi||(Xi=lr),(Or=tt.charSpace||ul)!==void 0&&(gn+=Ue(ve(Or))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(Di=tt.horizontalScale)!==void 0&&(gn+=Ue(100*Di)+` Tz
`),tt.lang;var Yn=-1,Rl=tt.renderingMode!==void 0?tt.renderingMode:tt.stroke,ta=Ci.internal.getCurrentPageInfo().pageContext;switch(Rl){case 0:case!1:case"fill":Yn=0;break;case 1:case!0:case"stroke":Yn=1;break;case 2:case"fillThenStroke":Yn=2;break;case 3:case"invisible":Yn=3;break;case 4:case"fillAndAddForClipping":Yn=4;break;case 5:case"strokeAndAddPathForClipping":Yn=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Yn=6;break;case 7:case"addToPathForClipping":Yn=7}var ii=ta.usedRenderingMode!==void 0?ta.usedRenderingMode:-1;Yn!==-1?gn+=Yn+` Tr
`:ii!==-1&&(gn+=`0 Tr
`),Yn!==-1&&(ta.usedRenderingMode=Yn),Er=tt.align||"left";var Ds,fl=ir*zs,nc=Ci.internal.pageSize.getWidth(),sc=K[Rr];Or=tt.charSpace||ul,jr=tt.maxWidth||0,ai=Object.assign({autoencode:!0,noBOM:!0},tt.flags);var ja=[],Do=function(Si){return Ci.getStringUnitWidth(Si,{font:sc,charSpace:Or,fontSize:ir,doKerning:!1})*ir/Ps};if(Object.prototype.toString.call(k)==="[object Array]"){var Kn;Yt=dl(k),Er!=="left"&&(Ds=Yt.map(Do));var An,ra=0;if(Er==="right"){re-=Ds[0],k=[],pn=Yt.length;for(var Fs=0;Fs<pn;Fs++)Fs===0?(An=zi(re),Kn=ji(Fe)):(An=ve(ra-Ds[Fs]),Kn=-fl),k.push([Yt[Fs],An,Kn]),ra=Ds[Fs]}else if(Er==="center"){re-=Ds[0]/2,k=[],pn=Yt.length;for(var ia=0;ia<pn;ia++)ia===0?(An=zi(re),Kn=ji(Fe)):(An=ve((ra-Ds[ia])/2),Kn=-fl),k.push([Yt[ia],An,Kn]),ra=Ds[ia]}else if(Er==="left"){k=[],pn=Yt.length;for(var Ns=0;Ns<pn;Ns++)k.push(Yt[Ns])}else if(Er==="justify"&&sc.encoding==="Identity-H"){k=[],pn=Yt.length,jr=jr!==0?jr:nc;for(var ds=0,pi=0;pi<pn;pi++)if(Kn=pi===0?ji(Fe):-fl,An=pi===0?zi(re):ds,pi<pn-1){var ml=ve((jr-Ds[pi])/(Yt[pi].split(" ").length-1)),Un=Yt[pi].split(" ");k.push([Un[0]+" ",An,Kn]),ds=0;for(var ps=1;ps<Un.length;ps++){var Rs=(Do(Un[ps-1]+" "+Un[ps])-Do(Un[ps]))*Ps+ml;ps==Un.length-1?k.push([Un[ps],Rs,0]):k.push([Un[ps]+" ",Rs,0]),ds-=Rs}}else k.push([Yt[pi],An,Kn]);k.push(["",ds,0])}else{if(Er!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(k=[],pn=Yt.length,jr=jr!==0?jr:nc,pi=0;pi<pn;pi++)Kn=pi===0?ji(Fe):-fl,An=pi===0?zi(re):0,pi<pn-1?ja.push(Ue(ve((jr-Ds[pi])/(Yt[pi].split(" ").length-1)))):ja.push(0),k.push([Yt[pi],An,Kn])}}var Fo=typeof tt.R2L=="boolean"?tt.R2L:xr;Fo===!0&&(k=Eo(k,function(Si,fi,rn){return[Si.split("").reverse().join(""),fi,rn]})),Rt={text:k,x:re,y:Fe,options:tt,mutex:{pdfEscape:Oi,activeFontKey:Rr,fonts:K,activeFontSize:ir}},we.publish("postProcessText",Rt),k=Rt.text,En=Rt.mutex.isHex||!1;var fo=K[Rr].encoding;fo!=="WinAnsiEncoding"&&fo!=="StandardEncoding"||(k=Eo(k,function(Si,fi,rn){return[ic(Si),fi,rn]})),Yt=dl(k),k=[];for(var na,ba,qa,Bs=0,sa=1,mo=Array.isArray(Yt[0])?sa:Bs,xa="",Kr=function(Si,fi,rn){var _n="";return rn instanceof Pt?(rn=typeof tt.angle=="number"?rr(rn,new Pt(1,0,0,1,Si,fi)):rr(new Pt(1,0,0,1,Si,fi),rn),He===ke.ADVANCED&&(rn=rr(new Pt(1,0,0,-1,0,0),rn)),_n=rn.join(" ")+` Tm
`):_n=Ue(Si)+" "+Ue(fi)+` Td
`,_n},Jn=0;Jn<Yt.length;Jn++){switch(xa="",mo){case sa:qa=(En?"<":"(")+Yt[Jn][0]+(En?">":")"),na=parseFloat(Yt[Jn][1]),ba=parseFloat(Yt[Jn][2]);break;case Bs:qa=(En?"<":"(")+Yt[Jn]+(En?">":")"),na=zi(re),ba=ji(Fe)}ja!==void 0&&ja[Jn]!==void 0&&(xa=ja[Jn]+` Tw
`),Jn===0?k.push(xa+Kr(na,ba,Xi)+qa):mo===Bs?k.push(xa+qa):mo===sa&&k.push(xa+Kr(na,ba,Xi)+qa)}k=mo===Bs?k.join(` Tj
T* `):k.join(` Tj
`),k+=` Tj
`;var Os=`BT
/`;return Os+=Rr+" "+ir+` Tf
`,Os+=Ue(ir*zs)+` TL
`,Os+=ga+`
`,Os+=gn,Os+=k,qe(Os+="ET"),J[Rr]=!0,Ci};var cs=N.__private__.clip=N.clip=function(k){return qe(k==="evenodd"?"W*":"W"),this};N.clipEvenOdd=function(){return cs("evenodd")},N.__private__.discardPath=N.discardPath=function(){return qe("n"),this};var Es=N.__private__.isValidStyle=function(k){var re=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(k)!==-1&&(re=!0),re};N.__private__.setDefaultPathOperation=N.setDefaultPathOperation=function(k){return Es(k)&&(B=k),this};var us=N.__private__.getStyle=N.getStyle=function(k){var re=B;switch(k){case"D":case"S":re="S";break;case"F":re="f";break;case"FD":case"DF":re="B";break;case"f":case"f*":case"B":case"B*":re=k}return re},wi=N.close=function(){return qe("h"),this};N.stroke=function(){return qe("S"),this},N.fill=function(k){return Da("f",k),this},N.fillEvenOdd=function(k){return Da("f*",k),this},N.fillStroke=function(k){return Da("B",k),this},N.fillStrokeEvenOdd=function(k){return Da("B*",k),this};var Da=function(k,re){Ri(re)==="object"?oo(re,k):qe(k)},Wr=function(k){k===null||He===ke.ADVANCED&&k===void 0||(k=us(k),qe(k))};function Nr(k,re,Fe,tt,dt){var Rt=new wu(re||this.boundingBox,Fe||this.xStep,tt||this.yStep,this.gState,dt||this.matrix);Rt.stream=this.stream;var Yt=k+"$$"+this.cloneIndex+++"$$";return yt(Yt,Rt),Rt}var oo=function(k,re){var Fe=G[k.key],tt=O[Fe];if(tt instanceof Vc)qe("q"),qe(ti(re)),tt.gState&&N.setGState(tt.gState),qe(k.matrix.toString()+" cm"),qe("/"+Fe+" sh"),qe("Q");else if(tt instanceof wu){var dt=new Pt(1,0,0,-1,0,va());k.matrix&&(dt=dt.multiply(k.matrix||lr),Fe=Nr.call(tt,k.key,k.boundingBox,k.xStep,k.yStep,dt).id),qe("q"),qe("/Pattern cs"),qe("/"+Fe+" scn"),tt.gState&&N.setGState(tt.gState),qe(re),qe("Q")}},ti=function(k){switch(k){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},Fa=N.moveTo=function(k,re){return qe(Ue(ve(k))+" "+Ue(Ne(re))+" m"),this},Pn=N.lineTo=function(k,re){return qe(Ue(ve(k))+" "+Ue(Ne(re))+" l"),this},ks=N.curveTo=function(k,re,Fe,tt,dt,Rt){return qe([Ue(ve(k)),Ue(Ne(re)),Ue(ve(Fe)),Ue(Ne(tt)),Ue(ve(dt)),Ue(Ne(Rt)),"c"].join(" ")),this};N.__private__.line=N.line=function(k,re,Fe,tt,dt){if(isNaN(k)||isNaN(re)||isNaN(Fe)||isNaN(tt)||!Es(dt))throw new Error("Invalid arguments passed to jsPDF.line");return He===ke.COMPAT?this.lines([[Fe-k,tt-re]],k,re,[1,1],dt||"S"):this.lines([[Fe-k,tt-re]],k,re,[1,1]).stroke()},N.__private__.lines=N.lines=function(k,re,Fe,tt,dt,Rt){var Yt,mr,Er,Or,jr,ai,Di,Xi,Ci,Ln,gn,En;if(typeof k=="number"&&(En=Fe,Fe=re,re=k,k=En),tt=tt||[1,1],Rt=Rt||!1,isNaN(re)||isNaN(Fe)||!Array.isArray(k)||!Array.isArray(tt)||!Es(dt)||typeof Rt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Fa(re,Fe),Yt=tt[0],mr=tt[1],Or=k.length,Ln=re,gn=Fe,Er=0;Er<Or;Er++)(jr=k[Er]).length===2?(Ln=jr[0]*Yt+Ln,gn=jr[1]*mr+gn,Pn(Ln,gn)):(ai=jr[0]*Yt+Ln,Di=jr[1]*mr+gn,Xi=jr[2]*Yt+Ln,Ci=jr[3]*mr+gn,Ln=jr[4]*Yt+Ln,gn=jr[5]*mr+gn,ks(ai,Di,Xi,Ci,Ln,gn));return Rt&&wi(),Wr(dt),this},N.path=function(k){for(var re=0;re<k.length;re++){var Fe=k[re],tt=Fe.c;switch(Fe.op){case"m":Fa(tt[0],tt[1]);break;case"l":Pn(tt[0],tt[1]);break;case"c":ks.apply(this,tt);break;case"h":wi()}}return this},N.__private__.rect=N.rect=function(k,re,Fe,tt,dt){if(isNaN(k)||isNaN(re)||isNaN(Fe)||isNaN(tt)||!Es(dt))throw new Error("Invalid arguments passed to jsPDF.rect");return He===ke.COMPAT&&(tt=-tt),qe([Ue(ve(k)),Ue(Ne(re)),Ue(ve(Fe)),Ue(ve(tt)),"re"].join(" ")),Wr(dt),this},N.__private__.triangle=N.triangle=function(k,re,Fe,tt,dt,Rt,Yt){if(isNaN(k)||isNaN(re)||isNaN(Fe)||isNaN(tt)||isNaN(dt)||isNaN(Rt)||!Es(Yt))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Fe-k,tt-re],[dt-Fe,Rt-tt],[k-dt,re-Rt]],k,re,[1,1],Yt,!0),this},N.__private__.roundedRect=N.roundedRect=function(k,re,Fe,tt,dt,Rt,Yt){if(isNaN(k)||isNaN(re)||isNaN(Fe)||isNaN(tt)||isNaN(dt)||isNaN(Rt)||!Es(Yt))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var mr=4/3*(Math.SQRT2-1);return dt=Math.min(dt,.5*Fe),Rt=Math.min(Rt,.5*tt),this.lines([[Fe-2*dt,0],[dt*mr,0,dt,Rt-Rt*mr,dt,Rt],[0,tt-2*Rt],[0,Rt*mr,-dt*mr,Rt,-dt,Rt],[2*dt-Fe,0],[-dt*mr,0,-dt,-Rt*mr,-dt,-Rt],[0,2*Rt-tt],[0,-Rt*mr,dt*mr,-Rt,dt,-Rt]],k+dt,re,[1,1],Yt,!0),this},N.__private__.ellipse=N.ellipse=function(k,re,Fe,tt,dt){if(isNaN(k)||isNaN(re)||isNaN(Fe)||isNaN(tt)||!Es(dt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Rt=4/3*(Math.SQRT2-1)*Fe,Yt=4/3*(Math.SQRT2-1)*tt;return Fa(k+Fe,re),ks(k+Fe,re-Yt,k+Rt,re-tt,k,re-tt),ks(k-Rt,re-tt,k-Fe,re-Yt,k-Fe,re),ks(k-Fe,re+Yt,k-Rt,re+tt,k,re+tt),ks(k+Rt,re+tt,k+Fe,re+Yt,k+Fe,re),Wr(dt),this},N.__private__.circle=N.circle=function(k,re,Fe,tt){if(isNaN(k)||isNaN(re)||isNaN(Fe)||!Es(tt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(k,re,Fe,Fe,tt)},N.setFont=function(k,re,Fe){return Fe&&(re=Ke(re,Fe)),Rr=al(k,re,{disableWarning:!1}),this};var ol=N.__private__.getFont=N.getFont=function(){return K[al.apply(N,arguments)]};N.__private__.getFontList=N.getFontList=function(){var k,re,Fe={};for(k in x)if(x.hasOwnProperty(k))for(re in Fe[k]=[],x[k])x[k].hasOwnProperty(re)&&Fe[k].push(re);return Fe},N.addFont=function(k,re,Fe,tt,dt){var Rt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Rt.indexOf(arguments[3])!==-1?dt=arguments[3]:arguments[3]&&Rt.indexOf(arguments[3])==-1&&(Fe=Ke(Fe,tt)),dt=dt||"Identity-H",So.call(this,k,re,Fe,dt)};var Qs,ma=h.lineWidth||.200025,ea=N.__private__.getLineWidth=N.getLineWidth=function(){return ma},rc=N.__private__.setLineWidth=N.setLineWidth=function(k){return ma=k,qe(Ue(ve(k))+" w"),this};N.__private__.setLineDash=Br.API.setLineDash=Br.API.setLineDashPattern=function(k,re){if(k=k||[],re=re||0,isNaN(re)||!Array.isArray(k))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return k=k.map(function(Fe){return Ue(ve(Fe))}).join(" "),re=Ue(ve(re)),qe("["+k+"] "+re+" d"),this};var Io=N.__private__.getLineHeight=N.getLineHeight=function(){return ir*Qs};N.__private__.getLineHeight=N.getLineHeight=function(){return ir*Qs};var ll=N.__private__.setLineHeightFactor=N.setLineHeightFactor=function(k){return typeof(k=k||1.15)=="number"&&(Qs=k),this},lo=N.__private__.getLineHeightFactor=N.getLineHeightFactor=function(){return Qs};ll(h.lineHeight);var zi=N.__private__.getHorizontalCoordinate=function(k){return ve(k)},ji=N.__private__.getVerticalCoordinate=function(k){return He===ke.ADVANCED?k:xe[Ie].mediaBox.topRightY-xe[Ie].mediaBox.bottomLeftY-ve(k)},cl=N.__private__.getHorizontalCoordinateString=N.getHorizontalCoordinateString=function(k){return Ue(zi(k))},dn=N.__private__.getVerticalCoordinateString=N.getVerticalCoordinateString=function(k){return Ue(ji(k))},mi=h.strokeColor||"0 G";N.__private__.getStrokeColor=N.getDrawColor=function(){return en(mi)},N.__private__.setStrokeColor=N.setDrawColor=function(k,re,Fe,tt){return mi=di({ch1:k,ch2:re,ch3:Fe,ch4:tt,pdfColorType:"draw",precision:2}),qe(mi),this};var Co=h.fillColor||"0 g";N.__private__.getFillColor=N.getFillColor=function(){return en(Co)},N.__private__.setFillColor=N.setFillColor=function(k,re,Fe,tt){return Co=di({ch1:k,ch2:re,ch3:Fe,ch4:tt,pdfColorType:"fill",precision:2}),qe(Co),this};var ga=h.textColor||"0 g",Na=N.__private__.getTextColor=N.getTextColor=function(){return en(ga)};N.__private__.setTextColor=N.setTextColor=function(k,re,Fe,tt){return ga=di({ch1:k,ch2:re,ch3:Fe,ch4:tt,pdfColorType:"text",precision:3}),this};var ul=h.charSpace,hl=N.__private__.getCharSpace=N.getCharSpace=function(){return parseFloat(ul||0)};N.__private__.setCharSpace=N.setCharSpace=function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return ul=k,this};var Mo=0;N.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},N.__private__.setLineCap=N.setLineCap=function(k){var re=N.CapJoinStyles[k];if(re===void 0)throw new Error("Line cap style of '"+k+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Mo=re,qe(re+" J"),this};var Dl=0;N.__private__.setLineJoin=N.setLineJoin=function(k){var re=N.CapJoinStyles[k];if(re===void 0)throw new Error("Line join style of '"+k+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Dl=re,qe(re+" j"),this},N.__private__.setLineMiterLimit=N.__private__.setMiterLimit=N.setLineMiterLimit=N.setMiterLimit=function(k){if(k=k||0,isNaN(k))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return qe(Ue(ve(k))+" M"),this},N.GState=Jh,N.setGState=function(k){(k=typeof k=="string"?Q[le[k]]:Lo(null,k)).equals(Te)||(qe("/"+k.id+" gs"),Te=k)};var Lo=function(k,re){if(!k||!le[k]){var Fe=!1;for(var tt in Q)if(Q.hasOwnProperty(tt)&&Q[tt].equals(re)){Fe=!0;break}if(Fe)re=Q[tt];else{var dt="GS"+(Object.keys(Q).length+1).toString(10);Q[dt]=re,re.id=dt}return k&&(le[k]=re.id),we.publish("addGState",re),re}};N.addGState=function(k,re){return Lo(k,re),this},N.saveGraphicsState=function(){return qe("q"),A.push({key:Rr,size:ir,color:ga}),this},N.restoreGraphicsState=function(){qe("Q");var k=A.pop();return Rr=k.key,ir=k.size,ga=k.color,Te=null,this},N.setCurrentTransformationMatrix=function(k){return qe(k.toString()+" cm"),this},N.comment=function(k){return qe("#"+k),this};var Ra=function(k,re){var Fe=k||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Fe},set:function(Rt){isNaN(Rt)||(Fe=parseFloat(Rt))}});var tt=re||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return tt},set:function(Rt){isNaN(Rt)||(tt=parseFloat(Rt))}});var dt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return dt},set:function(Rt){dt=Rt.toString()}}),this},Sn=function(k,re,Fe,tt){Ra.call(this,k,re),this.type="rect";var dt=Fe||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return dt},set:function(Yt){isNaN(Yt)||(dt=parseFloat(Yt))}});var Rt=tt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Rt},set:function(Yt){isNaN(Yt)||(Rt=parseFloat(Yt))}}),this},co=function(){this.page=ue,this.currentPage=Ie,this.pages=$t.slice(0),this.pagesContext=xe.slice(0),this.x=Wi,this.y=Qr,this.matrix=Bi,this.width=Vn(Ie),this.height=va(Ie),this.outputDestination=nr,this.id="",this.objectNumber=-1};co.prototype.restore=function(){ue=this.page,Ie=this.currentPage,xe=this.pagesContext,$t=this.pages,Wi=this.x,Qr=this.y,Bi=this.matrix,Nl(Ie,this.width),Ba(Ie,this.height),nr=this.outputDestination};var _a=function(k,re,Fe,tt,dt){ft.push(new co),ue=Ie=0,$t=[],Wi=k,Qr=re,Bi=dt,Yr([Fe,tt])},Fl=function(k){if(je[k])ft.pop().restore();else{var re=new co,Fe="Xo"+(Object.keys(Qe).length+1).toString(10);re.id=Fe,je[k]=Fe,Qe[Fe]=re,we.publish("addFormObject",re),ft.pop().restore()}};for(var ya in N.beginFormObject=function(k,re,Fe,tt,dt){return _a(k,re,Fe,tt,dt),this},N.endFormObject=function(k){return Fl(k),this},N.doFormObject=function(k,re){var Fe=Qe[je[k]];return qe("q"),qe(re.toString()+" cm"),qe("/"+Fe.id+" Do"),qe("Q"),this},N.getFormObject=function(k){var re=Qe[je[k]];return{x:re.x,y:re.y,width:re.width,height:re.height,matrix:re.matrix}},N.save=function(k,re){return k=k||"generated.pdf",(re=re||{}).returnPromise=re.returnPromise||!1,re.returnPromise===!1?(qc(hn(Ti()),k),typeof qc.unload=="function"&&Ur.setTimeout&&setTimeout(qc.unload,911),this):new Promise(function(Fe,tt){try{var dt=qc(hn(Ti()),k);typeof qc.unload=="function"&&Ur.setTimeout&&setTimeout(qc.unload,911),Fe(dt)}catch(Rt){tt(Rt.message)}})},Br.API)Br.API.hasOwnProperty(ya)&&(ya==="events"&&Br.API.events.length?function(k,re){var Fe,tt,dt;for(dt=re.length-1;dt!==-1;dt--)Fe=re[dt][0],tt=re[dt][1],k.subscribe.apply(k,[Fe].concat(typeof tt=="function"?[tt]:tt))}(we,Br.API.events):N[ya]=Br.API[ya]);var Vn=N.getPageWidth=function(k){return(xe[k=k||Ie].mediaBox.topRightX-xe[k].mediaBox.bottomLeftX)/ur},Nl=N.setPageWidth=function(k,re){xe[k].mediaBox.topRightX=re*ur+xe[k].mediaBox.bottomLeftX},va=N.getPageHeight=function(k){return(xe[k=k||Ie].mediaBox.topRightY-xe[k].mediaBox.bottomLeftY)/ur},Ba=N.setPageHeight=function(k,re){xe[k].mediaBox.topRightY=re*ur+xe[k].mediaBox.bottomLeftY};return N.internal={pdfEscape:Oi,getStyle:us,getFont:ol,getFontSize:or,getCharSpace:hl,getTextColor:Na,getLineHeight:Io,getLineHeightFactor:lo,getLineWidth:ea,write:zr,getHorizontalCoordinate:zi,getVerticalCoordinate:ji,getCoordinateString:cl,getVerticalCoordinateString:dn,collections:{},newObject:Zt,newAdditionalObject:Sr,newObjectDeferred:Qt,newObjectDeferredBegin:Pr,getFilters:yi,putStream:ri,events:we,scaleFactor:ur,pageSize:{getWidth:function(){return Vn(Ie)},setWidth:function(k){Nl(Ie,k)},getHeight:function(){return va(Ie)},setHeight:function(k){Ba(Ie,k)}},encryptionOptions:V,encryption:Ii,getEncryptor:Ki,output:mn,getNumberOfPages:sl,pages:$t,out:qe,f2:mt,f3:_e,getPageInfo:Js,getPageInfoByObjId:Lr,getCurrentPageInfo:To,getPDFVersion:pe,Point:Ra,Rectangle:Sn,Matrix:Pt,hasHotfix:Ao},Object.defineProperty(N.internal.pageSize,"width",{get:function(){return Vn(Ie)},set:function(k){Nl(Ie,k)},enumerable:!0,configurable:!0}),Object.defineProperty(N.internal.pageSize,"height",{get:function(){return va(Ie)},set:function(k){Ba(Ie,k)},enumerable:!0,configurable:!0}),nl.call(N,Xt),Rr="F1",qn(v,c),we.publish("initialized"),N}yu.prototype.lsbFirstWord=function(h){return String.fromCharCode(h>>0&255,h>>8&255,h>>16&255,h>>24&255)},yu.prototype.toHexString=function(h){return h.split("").map(function(a){return("0"+(255&a.charCodeAt(0)).toString(16)).slice(-2)}).join("")},yu.prototype.hexToBytes=function(h){for(var a=[],c=0;c<h.length;c+=2)a.push(String.fromCharCode(parseInt(h.substr(c,2),16)));return a.join("")},yu.prototype.processOwnerPassword=function(h,a){return Ep(Lp(a).substr(0,5),h)},yu.prototype.encryptor=function(h,a){var c=Lp(this.encryptionKey+String.fromCharCode(255&h,h>>8&255,h>>16&255,255&a,a>>8&255)).substr(0,10);return function(p){return Ep(c,p)}},Jh.prototype.equals=function(h){var a,c="id,objectNumber,equals";if(!h||Ri(h)!==Ri(this))return!1;var p=0;for(a in this)if(!(c.indexOf(a)>=0)){if(this.hasOwnProperty(a)&&!h.hasOwnProperty(a)||this[a]!==h[a])return!1;p++}for(a in h)h.hasOwnProperty(a)&&c.indexOf(a)<0&&p--;return p===0},Br.API={events:[]},Br.version="3.0.0";var Mn=Br.API,Wp=1,Gc=function(h){return h.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},mu=function(h){return h.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Xr=function(h){return h.toFixed(2)},_c=function(h){return h.toFixed(5)};Mn.__acroform__={};var Ea=function(h,a){h.prototype=Object.create(a.prototype),h.prototype.constructor=h},_g=function(h){return h*Wp},Il=function(h){var a=new l_,c=Ar.internal.getHeight(h)||0,p=Ar.internal.getWidth(h)||0;return a.BBox=[0,0,Number(Xr(p)),Number(Xr(c))],a},Tv=Mn.__acroform__.setBit=function(h,a){if(h=h||0,a=a||0,isNaN(h)||isNaN(a))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return h|=1<<a},Iv=Mn.__acroform__.clearBit=function(h,a){if(h=h||0,a=a||0,isNaN(h)||isNaN(a))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return h&=~(1<<a)},Cv=Mn.__acroform__.getBit=function(h,a){if(isNaN(h)||isNaN(a))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return(h&1<<a)==0?0:1},Bn=Mn.__acroform__.getBitForPdf=function(h,a){if(isNaN(h)||isNaN(a))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Cv(h,a-1)},On=Mn.__acroform__.setBitForPdf=function(h,a){if(isNaN(h)||isNaN(a))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Tv(h,a-1)},jn=Mn.__acroform__.clearBitForPdf=function(h,a){if(isNaN(h)||isNaN(a))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Iv(h,a-1)},Mv=Mn.__acroform__.calculateCoordinates=function(h,a){var c=a.internal.getHorizontalCoordinate,p=a.internal.getVerticalCoordinate,v=h[0],y=h[1],f=h[2],s=h[3],M={};return M.lowerLeft_X=c(v)||0,M.lowerLeft_Y=p(y+s)||0,M.upperRight_X=c(v+f)||0,M.upperRight_Y=p(y)||0,[Number(Xr(M.lowerLeft_X)),Number(Xr(M.lowerLeft_Y)),Number(Xr(M.upperRight_X)),Number(Xr(M.upperRight_Y))]},Lv=function(h){if(h.appearanceStreamContent)return h.appearanceStreamContent;if(h.V||h.DV){var a=[],c=h._V||h.DV,p=kp(h,c),v=h.scope.internal.getFont(h.fontName,h.fontStyle).id;a.push("/Tx BMC"),a.push("q"),a.push("BT"),a.push(h.scope.__private__.encodeColorString(h.color)),a.push("/"+v+" "+Xr(p.fontSize)+" Tf"),a.push("1 0 0 1 0 0 Tm"),a.push(p.text),a.push("ET"),a.push("Q"),a.push("EMC");var y=Il(h);return y.scope=h.scope,y.stream=a.join(`
`),y}},kp=function(h,a){var c=h.fontSize===0?h.maxFontSize:h.fontSize,p={text:"",fontSize:""},v=(a=(a=a.substr(0,1)=="("?a.substr(1):a).substr(a.length-1)==")"?a.substr(0,a.length-1):a).split(" ");v=h.multiline?v.map(function(_e){return _e.split(`
`)}):v.map(function(_e){return[_e]});var y=c,f=Ar.internal.getHeight(h)||0;f=f<0?-f:f;var s=Ar.internal.getWidth(h)||0;s=s<0?-s:s;var M=function(_e,ve,$e){if(_e+1<v.length){var Ne=ve+" "+v[_e+1][0];return Vh(Ne,h,$e).width<=s-4}return!1};y++;e:for(;y>0;){a="",y--;var B,V,U=Vh("3",h,y).height,J=h.multiline?f-y:(f-U)/2,N=J+=2,de=0,pe=0,De=0;if(y<=0){a=`(...) Tj
`,a+="% Width of Text: "+Vh(a,h,y=12).width+", FieldWidth:"+s+`
`;break}for(var fe="",ke=0,He=0;He<v.length;He++)if(v.hasOwnProperty(He)){var Oe=!1;if(v[He].length!==1&&De!==v[He].length-1){if((U+2)*(ke+2)+2>f)continue e;fe+=v[He][De],Oe=!0,pe=He,He--}else{fe=(fe+=v[He][De]+" ").substr(fe.length-1)==" "?fe.substr(0,fe.length-1):fe;var Le=parseInt(He),Ke=M(Le,fe,y),Ue=He>=v.length-1;if(Ke&&!Ue){fe+=" ",De=0;continue}if(Ke||Ue){if(Ue)pe=Le;else if(h.multiline&&(U+2)*(ke+2)+2>f)continue e}else{if(!h.multiline||(U+2)*(ke+2)+2>f)continue e;pe=Le}}for(var Ae="",lt=de;lt<=pe;lt++){var mt=v[lt];if(h.multiline){if(lt===pe){Ae+=mt[De]+" ",De=(De+1)%mt.length;continue}if(lt===de){Ae+=mt[mt.length-1]+" ";continue}}Ae+=mt[0]+" "}switch(Ae=Ae.substr(Ae.length-1)==" "?Ae.substr(0,Ae.length-1):Ae,V=Vh(Ae,h,y).width,h.textAlign){case"right":B=s-V-2;break;case"center":B=(s-V)/2;break;case"left":default:B=2}a+=Xr(B)+" "+Xr(N)+` Td
`,a+="("+Gc(Ae)+`) Tj
`,a+=-Xr(B)+` 0 Td
`,N=-(y+2),V=0,de=Oe?pe:pe+1,ke++,fe=""}break}return p.text=a,p.fontSize=y,p},Vh=function(h,a,c){var p=a.scope.internal.getFont(a.fontName,a.fontStyle),v=a.scope.getStringUnitWidth(h,{font:p,fontSize:parseFloat(c),charSpace:0})*parseFloat(c);return{height:a.scope.getStringUnitWidth("3",{font:p,fontSize:parseFloat(c),charSpace:0})*parseFloat(c)*1.5,width:v}},Ev={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},kv=function(h,a){var c={type:"reference",object:h};a.internal.getPageInfo(h.page).pageContext.annotations.find(function(p){return p.type===c.type&&p.object===c.object})===void 0&&a.internal.getPageInfo(h.page).pageContext.annotations.push(c)},zv=function(h,a){for(var c in h)if(h.hasOwnProperty(c)){var p=c,v=h[c];a.internal.newObjectDeferredBegin(v.objId,!0),Ri(v)==="object"&&typeof v.putStream=="function"&&v.putStream(),delete h[p]}},Dv=function(h,a){if(a.scope=h,h.internal!==void 0&&(h.internal.acroformPlugin===void 0||h.internal.acroformPlugin.isInitialized===!1)){if(Qo.FieldNum=0,h.internal.acroformPlugin=JSON.parse(JSON.stringify(Ev)),h.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Wp=h.internal.scaleFactor,h.internal.acroformPlugin.acroFormDictionaryRoot=new c_,h.internal.acroformPlugin.acroFormDictionaryRoot.scope=h,h.internal.acroformPlugin.acroFormDictionaryRoot._eventID=h.internal.events.subscribe("postPutResources",function(){(function(c){c.internal.events.unsubscribe(c.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete c.internal.acroformPlugin.acroFormDictionaryRoot._eventID,c.internal.acroformPlugin.printedOut=!0})(h)}),h.internal.events.subscribe("buildDocument",function(){(function(c){c.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var p=c.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var v in p)if(p.hasOwnProperty(v)){var y=p[v];y.objId=void 0,y.hasAnnotation&&kv(y,c)}})(h)}),h.internal.events.subscribe("putCatalog",function(){(function(c){if(c.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");c.internal.write("/AcroForm "+c.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(h)}),h.internal.events.subscribe("postPutPages",function(c){(function(p,v){var y=!p;for(var f in p||(v.internal.newObjectDeferredBegin(v.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),v.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),p=p||v.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(p.hasOwnProperty(f)){var s=p[f],M=[],B=s.Rect;if(s.Rect&&(s.Rect=Mv(s.Rect,v)),v.internal.newObjectDeferredBegin(s.objId,!0),s.DA=Ar.createDefaultAppearanceStream(s),Ri(s)==="object"&&typeof s.getKeyValueListForStream=="function"&&(M=s.getKeyValueListForStream()),s.Rect=B,s.hasAppearanceStream&&!s.appearanceStreamContent){var V=Lv(s);M.push({key:"AP",value:"<</N "+V+">>"}),v.internal.acroformPlugin.xForms.push(V)}if(s.appearanceStreamContent){var U="";for(var J in s.appearanceStreamContent)if(s.appearanceStreamContent.hasOwnProperty(J)){var N=s.appearanceStreamContent[J];if(U+="/"+J+" ",U+="<<",Object.keys(N).length>=1||Array.isArray(N)){for(var f in N)if(N.hasOwnProperty(f)){var de=N[f];typeof de=="function"&&(de=de.call(v,s)),U+="/"+f+" "+de+" ",v.internal.acroformPlugin.xForms.indexOf(de)>=0||v.internal.acroformPlugin.xForms.push(de)}}else typeof(de=N)=="function"&&(de=de.call(v,s)),U+="/"+f+" "+de,v.internal.acroformPlugin.xForms.indexOf(de)>=0||v.internal.acroformPlugin.xForms.push(de);U+=">>"}M.push({key:"AP",value:`<<
`+U+">>"})}v.internal.putStream({additionalKeyValues:M,objectId:s.objId}),v.internal.out("endobj")}y&&zv(v.internal.acroformPlugin.xForms,v)})(c,h)}),h.internal.acroformPlugin.isInitialized=!0}},o_=Mn.__acroform__.arrayToPdfArray=function(h,a,c){var p=function(f){return f};if(Array.isArray(h)){for(var v="[",y=0;y<h.length;y++)switch(y!==0&&(v+=" "),Ri(h[y])){case"boolean":case"number":case"object":v+=h[y].toString();break;case"string":h[y].substr(0,1)!=="/"?(a!==void 0&&c&&(p=c.internal.getEncryptor(a)),v+="("+Gc(p(h[y].toString()))+")"):v+=h[y].toString()}return v+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},mp=function(h,a,c){var p=function(v){return v};return a!==void 0&&c&&(p=c.internal.getEncryptor(a)),(h=h||"").toString(),h="("+Gc(p(h))+")"},Cl=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(h){this._objId=h}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Cl.prototype.toString=function(){return this.objId+" 0 R"},Cl.prototype.putStream=function(){var h=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:h,objectId:this.objId}),this.scope.internal.out("endobj")},Cl.prototype.getKeyValueListForStream=function(){var h=[],a=Object.getOwnPropertyNames(this).filter(function(y){return y!="content"&&y!="appearanceStreamContent"&&y!="scope"&&y!="objId"&&y.substring(0,1)!="_"});for(var c in a)if(Object.getOwnPropertyDescriptor(this,a[c]).configurable===!1){var p=a[c],v=this[p];v&&(Array.isArray(v)?h.push({key:p,value:o_(v,this.objId,this.scope)}):v instanceof Cl?(v.scope=this.scope,h.push({key:p,value:v.objId+" 0 R"})):typeof v!="function"&&h.push({key:p,value:v}))}return h};var l_=function(){Cl.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var h,a=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return a},set:function(c){a=c}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(c){h=c.trim()},get:function(){return h||null}})};Ea(l_,Cl);var c_=function(){Cl.call(this);var h,a=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return a.length>0?a:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return a}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(h){var c=function(p){return p};return this.scope&&(c=this.scope.internal.getEncryptor(this.objId)),"("+Gc(c(h))+")"}},set:function(c){h=c}})};Ea(c_,Cl);var Qo=function h(){Cl.call(this);var a=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return a},set:function(fe){if(isNaN(fe))throw new Error('Invalid value "'+fe+'" for attribute F supplied.');a=fe}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Bn(a,3)},set:function(fe){fe?this.F=On(a,3):this.F=jn(a,3)}});var c=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return c},set:function(fe){if(isNaN(fe))throw new Error('Invalid value "'+fe+'" for attribute Ff supplied.');c=fe}});var p=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(p.length!==0)return p},set:function(fe){p=fe!==void 0?fe:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!p||isNaN(p[0])?0:p[0]},set:function(fe){p[0]=fe}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!p||isNaN(p[1])?0:p[1]},set:function(fe){p[1]=fe}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!p||isNaN(p[2])?0:p[2]},set:function(fe){p[2]=fe}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!p||isNaN(p[3])?0:p[3]},set:function(fe){p[3]=fe}});var v="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return v},set:function(fe){switch(fe){case"/Btn":case"/Tx":case"/Ch":case"/Sig":v=fe;break;default:throw new Error('Invalid value "'+fe+'" for attribute FT supplied.')}}});var y=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!y||y.length<1){if(this instanceof Qh)return;y="FieldObject"+h.FieldNum++}var fe=function(ke){return ke};return this.scope&&(fe=this.scope.internal.getEncryptor(this.objId)),"("+Gc(fe(y))+")"},set:function(fe){y=fe.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return y},set:function(fe){y=fe}});var f="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return f},set:function(fe){f=fe}});var s="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return s},set:function(fe){s=fe}});var M=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return M},set:function(fe){M=fe}});var B=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return B===void 0?50/Wp:B},set:function(fe){B=fe}});var V="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return V},set:function(fe){V=fe}});var U="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!U||this instanceof Qh||this instanceof Uc))return mp(U,this.objId,this.scope)},set:function(fe){fe=fe.toString(),U=fe}});var J=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(J)return this instanceof ys?J:mp(J,this.objId,this.scope)},set:function(fe){fe=fe.toString(),J=this instanceof ys?fe:fe.substr(0,1)==="("?mu(fe.substr(1,fe.length-2)):mu(fe)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof ys?mu(J.substr(1,J.length-1)):J},set:function(fe){fe=fe.toString(),J=this instanceof ys?"/"+fe:fe}});var N=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(N)return N},set:function(fe){this.V=fe}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(N)return this instanceof ys?N:mp(N,this.objId,this.scope)},set:function(fe){fe=fe.toString(),N=this instanceof ys?fe:fe.substr(0,1)==="("?mu(fe.substr(1,fe.length-2)):mu(fe)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof ys?mu(N.substr(1,N.length-1)):N},set:function(fe){fe=fe.toString(),N=this instanceof ys?"/"+fe:fe}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var de,pe=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return pe},set:function(fe){fe=!!fe,pe=fe}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(de)return de},set:function(fe){de=fe}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,1)},set:function(fe){fe?this.Ff=On(this.Ff,1):this.Ff=jn(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,2)},set:function(fe){fe?this.Ff=On(this.Ff,2):this.Ff=jn(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,3)},set:function(fe){fe?this.Ff=On(this.Ff,3):this.Ff=jn(this.Ff,3)}});var De=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(De!==null)return De},set:function(fe){if([0,1,2].indexOf(fe)===-1)throw new Error('Invalid value "'+fe+'" for attribute Q supplied.');De=fe}}),Object.defineProperty(this,"textAlign",{get:function(){var fe;switch(De){case 0:default:fe="left";break;case 1:fe="center";break;case 2:fe="right"}return fe},configurable:!0,enumerable:!0,set:function(fe){switch(fe){case"right":case 2:De=2;break;case"center":case 1:De=1;break;case"left":case 0:default:De=0}}})};Ea(Qo,Cl);var Su=function(){Qo.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var h=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return h},set:function(c){h=c}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return h},set:function(c){h=c}});var a=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return o_(a,this.objId,this.scope)},set:function(c){var p,v;v=[],typeof(p=c)=="string"&&(v=function(y,f,s){s||(s=1);for(var M,B=[];M=f.exec(y);)B.push(M[s]);return B}(p,/\((.*?)\)/g)),a=v}}),this.getOptions=function(){return a},this.setOptions=function(c){a=c,this.sort&&a.sort()},this.addOption=function(c){c=(c=c||"").toString(),a.push(c),this.sort&&a.sort()},this.removeOption=function(c,p){for(p=p||!1,c=(c=c||"").toString();a.indexOf(c)!==-1&&(a.splice(a.indexOf(c),1),p!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,18)},set:function(c){c?this.Ff=On(this.Ff,18):this.Ff=jn(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,19)},set:function(c){this.combo===!0&&(c?this.Ff=On(this.Ff,19):this.Ff=jn(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,20)},set:function(c){c?(this.Ff=On(this.Ff,20),a.sort()):this.Ff=jn(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,22)},set:function(c){c?this.Ff=On(this.Ff,22):this.Ff=jn(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,23)},set:function(c){c?this.Ff=On(this.Ff,23):this.Ff=jn(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,27)},set:function(c){c?this.Ff=On(this.Ff,27):this.Ff=jn(this.Ff,27)}}),this.hasAppearanceStream=!1};Ea(Su,Qo);var Au=function(){Su.call(this),this.fontName="helvetica",this.combo=!1};Ea(Au,Su);var Tu=function(){Au.call(this),this.combo=!0};Ea(Tu,Au);var Wh=function(){Tu.call(this),this.edit=!0};Ea(Wh,Tu);var ys=function(){Qo.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,15)},set:function(c){c?this.Ff=On(this.Ff,15):this.Ff=jn(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,16)},set:function(c){c?this.Ff=On(this.Ff,16):this.Ff=jn(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,17)},set:function(c){c?this.Ff=On(this.Ff,17):this.Ff=jn(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,26)},set:function(c){c?this.Ff=On(this.Ff,26):this.Ff=jn(this.Ff,26)}});var h,a={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var c=function(y){return y};if(this.scope&&(c=this.scope.internal.getEncryptor(this.objId)),Object.keys(a).length!==0){var p,v=[];for(p in v.push("<<"),a)v.push("/"+p+" ("+Gc(c(a[p]))+")");return v.push(">>"),v.join(`
`)}},set:function(c){Ri(c)==="object"&&(a=c)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return a.CA||""},set:function(c){typeof c=="string"&&(a.CA=c)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return h},set:function(c){h=c}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return h.substr(1,h.length-1)},set:function(c){h="/"+c}})};Ea(ys,Qo);var Hh=function(){ys.call(this),this.pushButton=!0};Ea(Hh,ys);var Iu=function(){ys.call(this),this.radio=!0,this.pushButton=!1;var h=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return h},set:function(a){h=a!==void 0?a:[]}})};Ea(Iu,ys);var Qh=function(){var h,a;Qo.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return h},set:function(v){h=v}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return a},set:function(v){a=v}});var c,p={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var v=function(s){return s};this.scope&&(v=this.scope.internal.getEncryptor(this.objId));var y,f=[];for(y in f.push("<<"),p)f.push("/"+y+" ("+Gc(v(p[y]))+")");return f.push(">>"),f.join(`
`)},set:function(v){Ri(v)==="object"&&(p=v)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return p.CA||""},set:function(v){typeof v=="string"&&(p.CA=v)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return c},set:function(v){c=v}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return c.substr(1,c.length-1)},set:function(v){c="/"+v}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Ar.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Ea(Qh,Qo),Iu.prototype.setAppearance=function(h){if(!("createAppearanceStream"in h)||!("getCA"in h))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var a in this.Kids)if(this.Kids.hasOwnProperty(a)){var c=this.Kids[a];c.appearanceStreamContent=h.createAppearanceStream(c.optionName),c.caption=h.getCA()}},Iu.prototype.createOption=function(h){var a=new Qh;return a.Parent=this,a.optionName=h,this.Kids.push(a),Fv.call(this.scope,a),a};var Xh=function(){ys.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Ar.CheckBox.createAppearanceStream()};Ea(Xh,ys);var Uc=function(){Qo.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,13)},set:function(a){a?this.Ff=On(this.Ff,13):this.Ff=jn(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,21)},set:function(a){a?this.Ff=On(this.Ff,21):this.Ff=jn(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,23)},set:function(a){a?this.Ff=On(this.Ff,23):this.Ff=jn(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,24)},set:function(a){a?this.Ff=On(this.Ff,24):this.Ff=jn(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,25)},set:function(a){a?this.Ff=On(this.Ff,25):this.Ff=jn(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,26)},set:function(a){a?this.Ff=On(this.Ff,26):this.Ff=jn(this.Ff,26)}});var h=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return h},set:function(a){h=a}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return h},set:function(a){Number.isInteger(a)&&(h=a)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Ea(Uc,Qo);var Yh=function(){Uc.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,14)},set:function(h){h?this.Ff=On(this.Ff,14):this.Ff=jn(this.Ff,14)}}),this.password=!0};Ea(Yh,Uc);var Ar={CheckBox:{createAppearanceStream:function(){return{N:{On:Ar.CheckBox.YesNormal},D:{On:Ar.CheckBox.YesPushDown,Off:Ar.CheckBox.OffPushDown}}},YesPushDown:function(h){var a=Il(h);a.scope=h.scope;var c=[],p=h.scope.internal.getFont(h.fontName,h.fontStyle).id,v=h.scope.__private__.encodeColorString(h.color),y=kp(h,h.caption);return c.push("0.749023 g"),c.push("0 0 "+Xr(Ar.internal.getWidth(h))+" "+Xr(Ar.internal.getHeight(h))+" re"),c.push("f"),c.push("BMC"),c.push("q"),c.push("0 0 1 rg"),c.push("/"+p+" "+Xr(y.fontSize)+" Tf "+v),c.push("BT"),c.push(y.text),c.push("ET"),c.push("Q"),c.push("EMC"),a.stream=c.join(`
`),a},YesNormal:function(h){var a=Il(h);a.scope=h.scope;var c=h.scope.internal.getFont(h.fontName,h.fontStyle).id,p=h.scope.__private__.encodeColorString(h.color),v=[],y=Ar.internal.getHeight(h),f=Ar.internal.getWidth(h),s=kp(h,h.caption);return v.push("1 g"),v.push("0 0 "+Xr(f)+" "+Xr(y)+" re"),v.push("f"),v.push("q"),v.push("0 0 1 rg"),v.push("0 0 "+Xr(f-1)+" "+Xr(y-1)+" re"),v.push("W"),v.push("n"),v.push("0 g"),v.push("BT"),v.push("/"+c+" "+Xr(s.fontSize)+" Tf "+p),v.push(s.text),v.push("ET"),v.push("Q"),a.stream=v.join(`
`),a},OffPushDown:function(h){var a=Il(h);a.scope=h.scope;var c=[];return c.push("0.749023 g"),c.push("0 0 "+Xr(Ar.internal.getWidth(h))+" "+Xr(Ar.internal.getHeight(h))+" re"),c.push("f"),a.stream=c.join(`
`),a}},RadioButton:{Circle:{createAppearanceStream:function(h){var a={D:{Off:Ar.RadioButton.Circle.OffPushDown},N:{}};return a.N[h]=Ar.RadioButton.Circle.YesNormal,a.D[h]=Ar.RadioButton.Circle.YesPushDown,a},getCA:function(){return"l"},YesNormal:function(h){var a=Il(h);a.scope=h.scope;var c=[],p=Ar.internal.getWidth(h)<=Ar.internal.getHeight(h)?Ar.internal.getWidth(h)/4:Ar.internal.getHeight(h)/4;p=Number((.9*p).toFixed(5));var v=Ar.internal.Bezier_C,y=Number((p*v).toFixed(5));return c.push("q"),c.push("1 0 0 1 "+_c(Ar.internal.getWidth(h)/2)+" "+_c(Ar.internal.getHeight(h)/2)+" cm"),c.push(p+" 0 m"),c.push(p+" "+y+" "+y+" "+p+" 0 "+p+" c"),c.push("-"+y+" "+p+" -"+p+" "+y+" -"+p+" 0 c"),c.push("-"+p+" -"+y+" -"+y+" -"+p+" 0 -"+p+" c"),c.push(y+" -"+p+" "+p+" -"+y+" "+p+" 0 c"),c.push("f"),c.push("Q"),a.stream=c.join(`
`),a},YesPushDown:function(h){var a=Il(h);a.scope=h.scope;var c=[],p=Ar.internal.getWidth(h)<=Ar.internal.getHeight(h)?Ar.internal.getWidth(h)/4:Ar.internal.getHeight(h)/4;p=Number((.9*p).toFixed(5));var v=Number((2*p).toFixed(5)),y=Number((v*Ar.internal.Bezier_C).toFixed(5)),f=Number((p*Ar.internal.Bezier_C).toFixed(5));return c.push("0.749023 g"),c.push("q"),c.push("1 0 0 1 "+_c(Ar.internal.getWidth(h)/2)+" "+_c(Ar.internal.getHeight(h)/2)+" cm"),c.push(v+" 0 m"),c.push(v+" "+y+" "+y+" "+v+" 0 "+v+" c"),c.push("-"+y+" "+v+" -"+v+" "+y+" -"+v+" 0 c"),c.push("-"+v+" -"+y+" -"+y+" -"+v+" 0 -"+v+" c"),c.push(y+" -"+v+" "+v+" -"+y+" "+v+" 0 c"),c.push("f"),c.push("Q"),c.push("0 g"),c.push("q"),c.push("1 0 0 1 "+_c(Ar.internal.getWidth(h)/2)+" "+_c(Ar.internal.getHeight(h)/2)+" cm"),c.push(p+" 0 m"),c.push(p+" "+f+" "+f+" "+p+" 0 "+p+" c"),c.push("-"+f+" "+p+" -"+p+" "+f+" -"+p+" 0 c"),c.push("-"+p+" -"+f+" -"+f+" -"+p+" 0 -"+p+" c"),c.push(f+" -"+p+" "+p+" -"+f+" "+p+" 0 c"),c.push("f"),c.push("Q"),a.stream=c.join(`
`),a},OffPushDown:function(h){var a=Il(h);a.scope=h.scope;var c=[],p=Ar.internal.getWidth(h)<=Ar.internal.getHeight(h)?Ar.internal.getWidth(h)/4:Ar.internal.getHeight(h)/4;p=Number((.9*p).toFixed(5));var v=Number((2*p).toFixed(5)),y=Number((v*Ar.internal.Bezier_C).toFixed(5));return c.push("0.749023 g"),c.push("q"),c.push("1 0 0 1 "+_c(Ar.internal.getWidth(h)/2)+" "+_c(Ar.internal.getHeight(h)/2)+" cm"),c.push(v+" 0 m"),c.push(v+" "+y+" "+y+" "+v+" 0 "+v+" c"),c.push("-"+y+" "+v+" -"+v+" "+y+" -"+v+" 0 c"),c.push("-"+v+" -"+y+" -"+y+" -"+v+" 0 -"+v+" c"),c.push(y+" -"+v+" "+v+" -"+y+" "+v+" 0 c"),c.push("f"),c.push("Q"),a.stream=c.join(`
`),a}},Cross:{createAppearanceStream:function(h){var a={D:{Off:Ar.RadioButton.Cross.OffPushDown},N:{}};return a.N[h]=Ar.RadioButton.Cross.YesNormal,a.D[h]=Ar.RadioButton.Cross.YesPushDown,a},getCA:function(){return"8"},YesNormal:function(h){var a=Il(h);a.scope=h.scope;var c=[],p=Ar.internal.calculateCross(h);return c.push("q"),c.push("1 1 "+Xr(Ar.internal.getWidth(h)-2)+" "+Xr(Ar.internal.getHeight(h)-2)+" re"),c.push("W"),c.push("n"),c.push(Xr(p.x1.x)+" "+Xr(p.x1.y)+" m"),c.push(Xr(p.x2.x)+" "+Xr(p.x2.y)+" l"),c.push(Xr(p.x4.x)+" "+Xr(p.x4.y)+" m"),c.push(Xr(p.x3.x)+" "+Xr(p.x3.y)+" l"),c.push("s"),c.push("Q"),a.stream=c.join(`
`),a},YesPushDown:function(h){var a=Il(h);a.scope=h.scope;var c=Ar.internal.calculateCross(h),p=[];return p.push("0.749023 g"),p.push("0 0 "+Xr(Ar.internal.getWidth(h))+" "+Xr(Ar.internal.getHeight(h))+" re"),p.push("f"),p.push("q"),p.push("1 1 "+Xr(Ar.internal.getWidth(h)-2)+" "+Xr(Ar.internal.getHeight(h)-2)+" re"),p.push("W"),p.push("n"),p.push(Xr(c.x1.x)+" "+Xr(c.x1.y)+" m"),p.push(Xr(c.x2.x)+" "+Xr(c.x2.y)+" l"),p.push(Xr(c.x4.x)+" "+Xr(c.x4.y)+" m"),p.push(Xr(c.x3.x)+" "+Xr(c.x3.y)+" l"),p.push("s"),p.push("Q"),a.stream=p.join(`
`),a},OffPushDown:function(h){var a=Il(h);a.scope=h.scope;var c=[];return c.push("0.749023 g"),c.push("0 0 "+Xr(Ar.internal.getWidth(h))+" "+Xr(Ar.internal.getHeight(h))+" re"),c.push("f"),a.stream=c.join(`
`),a}}},createDefaultAppearanceStream:function(h){var a=h.scope.internal.getFont(h.fontName,h.fontStyle).id,c=h.scope.__private__.encodeColorString(h.color);return"/"+a+" "+h.fontSize+" Tf "+c}};Ar.internal={Bezier_C:.551915024494,calculateCross:function(h){var a=Ar.internal.getWidth(h),c=Ar.internal.getHeight(h),p=Math.min(a,c);return{x1:{x:(a-p)/2,y:(c-p)/2+p},x2:{x:(a-p)/2+p,y:(c-p)/2},x3:{x:(a-p)/2,y:(c-p)/2},x4:{x:(a-p)/2+p,y:(c-p)/2+p}}}},Ar.internal.getWidth=function(h){var a=0;return Ri(h)==="object"&&(a=_g(h.Rect[2])),a},Ar.internal.getHeight=function(h){var a=0;return Ri(h)==="object"&&(a=_g(h.Rect[3])),a};var Fv=Mn.addField=function(h){if(Dv(this,h),!(h instanceof Qo))throw new Error("Invalid argument passed to jsPDF.addField.");var a;return(a=h).scope.internal.acroformPlugin.printedOut&&(a.scope.internal.acroformPlugin.printedOut=!1,a.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),a.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(a),h.page=h.scope.internal.getCurrentPageInfo().pageNumber,this};Mn.AcroFormChoiceField=Su,Mn.AcroFormListBox=Au,Mn.AcroFormComboBox=Tu,Mn.AcroFormEditBox=Wh,Mn.AcroFormButton=ys,Mn.AcroFormPushButton=Hh,Mn.AcroFormRadioButton=Iu,Mn.AcroFormCheckBox=Xh,Mn.AcroFormTextField=Uc,Mn.AcroFormPasswordField=Yh,Mn.AcroFormAppearance=Ar,Mn.AcroForm={ChoiceField:Su,ListBox:Au,ComboBox:Tu,EditBox:Wh,Button:ys,PushButton:Hh,RadioButton:Iu,CheckBox:Xh,TextField:Uc,PasswordField:Yh,Appearance:Ar},Br.AcroForm={ChoiceField:Su,ListBox:Au,ComboBox:Tu,EditBox:Wh,Button:ys,PushButton:Hh,RadioButton:Iu,CheckBox:Xh,TextField:Uc,PasswordField:Yh,Appearance:Ar};Br.AcroForm;function u_(h){return h.reduce(function(a,c,p){return a[c]=p,a},{})}(function(h){h.__addimage__={};var a="UNKNOWN",c={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},p=h.__addimage__.getImageFileTypeByImageData=function(_e,ve){var $e,Ne,wt,ut,At,ht=a;if((ve=ve||a)==="RGBA"||_e.data!==void 0&&_e.data instanceof Uint8ClampedArray&&"height"in _e&&"width"in _e)return"RGBA";if(Ke(_e))for(At in c)for(wt=c[At],$e=0;$e<wt.length;$e+=1){for(ut=!0,Ne=0;Ne<wt[$e].length;Ne+=1)if(wt[$e][Ne]!==void 0&&wt[$e][Ne]!==_e[Ne]){ut=!1;break}if(ut===!0){ht=At;break}}else for(At in c)for(wt=c[At],$e=0;$e<wt.length;$e+=1){for(ut=!0,Ne=0;Ne<wt[$e].length;Ne+=1)if(wt[$e][Ne]!==void 0&&wt[$e][Ne]!==_e.charCodeAt(Ne)){ut=!1;break}if(ut===!0){ht=At;break}}return ht===a&&ve!==a&&(ht=ve),ht},v=function _e(ve){for(var $e=this.internal.write,Ne=this.internal.putStream,wt=(0,this.internal.getFilters)();wt.indexOf("FlateEncode")!==-1;)wt.splice(wt.indexOf("FlateEncode"),1);ve.objectId=this.internal.newObject();var ut=[];if(ut.push({key:"Type",value:"/XObject"}),ut.push({key:"Subtype",value:"/Image"}),ut.push({key:"Width",value:ve.width}),ut.push({key:"Height",value:ve.height}),ve.colorSpace===De.INDEXED?ut.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(ve.palette.length/3-1)+" "+("sMask"in ve&&ve.sMask!==void 0?ve.objectId+2:ve.objectId+1)+" 0 R]"}):(ut.push({key:"ColorSpace",value:"/"+ve.colorSpace}),ve.colorSpace===De.DEVICE_CMYK&&ut.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),ut.push({key:"BitsPerComponent",value:ve.bitsPerComponent}),"decodeParameters"in ve&&ve.decodeParameters!==void 0&&ut.push({key:"DecodeParms",value:"<<"+ve.decodeParameters+">>"}),"transparency"in ve&&Array.isArray(ve.transparency)){for(var At="",ht=0,Tt=ve.transparency.length;ht<Tt;ht++)At+=ve.transparency[ht]+" "+ve.transparency[ht]+" ";ut.push({key:"Mask",value:"["+At+"]"})}ve.sMask!==void 0&&ut.push({key:"SMask",value:ve.objectId+1+" 0 R"});var Dt=ve.filter!==void 0?["/"+ve.filter]:void 0;if(Ne({data:ve.data,additionalKeyValues:ut,alreadyAppliedFilters:Dt,objectId:ve.objectId}),$e("endobj"),"sMask"in ve&&ve.sMask!==void 0){var sr="/Predictor "+ve.predictor+" /Colors 1 /BitsPerComponent "+ve.bitsPerComponent+" /Columns "+ve.width,ne={width:ve.width,height:ve.height,colorSpace:"DeviceGray",bitsPerComponent:ve.bitsPerComponent,decodeParameters:sr,data:ve.sMask};"filter"in ve&&(ne.filter=ve.filter),_e.call(this,ne)}if(ve.colorSpace===De.INDEXED){var Ie=this.internal.newObject();Ne({data:Ae(new Uint8Array(ve.palette)),objectId:Ie}),$e("endobj")}},y=function(){var _e=this.internal.collections.addImage_images;for(var ve in _e)v.call(this,_e[ve])},f=function(){var _e,ve=this.internal.collections.addImage_images,$e=this.internal.write;for(var Ne in ve)$e("/I"+(_e=ve[Ne]).index,_e.objectId,"0","R")},s=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",y),this.internal.events.subscribe("putXobjectDict",f))},M=function(){var _e=this.internal.collections.addImage_images;return s.call(this),_e},B=function(){return Object.keys(this.internal.collections.addImage_images).length},V=function(_e){return typeof h["process"+_e.toUpperCase()]=="function"},U=function(_e){return Ri(_e)==="object"&&_e.nodeType===1},J=function(_e,ve){if(_e.nodeName==="IMG"&&_e.hasAttribute("src")){var $e=""+_e.getAttribute("src");if($e.indexOf("data:image/")===0)return ih(unescape($e).split("base64,").pop());var Ne=h.loadFile($e,!0);if(Ne!==void 0)return Ne}if(_e.nodeName==="CANVAS"){if(_e.width===0||_e.height===0)throw new Error("Given canvas must have data. Canvas width: "+_e.width+", height: "+_e.height);var wt;switch(ve){case"PNG":wt="image/png";break;case"WEBP":wt="image/webp";break;case"JPEG":case"JPG":default:wt="image/jpeg"}return ih(_e.toDataURL(wt,1).split("base64,").pop())}},N=function(_e){var ve=this.internal.collections.addImage_images;if(ve){for(var $e in ve)if(_e===ve[$e].alias)return ve[$e]}},de=function(_e,ve,$e){return _e||ve||(_e=-96,ve=-96),_e<0&&(_e=-1*$e.width*72/_e/this.internal.scaleFactor),ve<0&&(ve=-1*$e.height*72/ve/this.internal.scaleFactor),_e===0&&(_e=ve*$e.width/$e.height),ve===0&&(ve=_e*$e.height/$e.width),[_e,ve]},pe=function(_e,ve,$e,Ne,wt,ut){var At=de.call(this,$e,Ne,wt),ht=this.internal.getCoordinateString,Tt=this.internal.getVerticalCoordinateString,Dt=M.call(this);if($e=At[0],Ne=At[1],Dt[wt.index]=wt,ut){ut*=Math.PI/180;var sr=Math.cos(ut),ne=Math.sin(ut),Ie=function(We){return We.toFixed(4)},Re=[Ie(sr),Ie(ne),Ie(-1*ne),Ie(sr),0,0,"cm"]}this.internal.write("q"),ut?(this.internal.write([1,"0","0",1,ht(_e),Tt(ve+Ne),"cm"].join(" ")),this.internal.write(Re.join(" ")),this.internal.write([ht($e),"0","0",ht(Ne),"0","0","cm"].join(" "))):this.internal.write([ht($e),"0","0",ht(Ne),ht(_e),Tt(ve+Ne),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+wt.index+" Do"),this.internal.write("Q")},De=h.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};h.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var fe=h.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},ke=h.__addimage__.sHashCode=function(_e){var ve,$e,Ne=0;if(typeof _e=="string")for($e=_e.length,ve=0;ve<$e;ve++)Ne=(Ne<<5)-Ne+_e.charCodeAt(ve),Ne|=0;else if(Ke(_e))for($e=_e.byteLength/2,ve=0;ve<$e;ve++)Ne=(Ne<<5)-Ne+_e[ve],Ne|=0;return Ne},He=h.__addimage__.validateStringAsBase64=function(_e){(_e=_e||"").toString().trim();var ve=!0;return _e.length===0&&(ve=!1),_e.length%4!=0&&(ve=!1),/^[A-Za-z0-9+/]+$/.test(_e.substr(0,_e.length-2))===!1&&(ve=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(_e.substr(-2))===!1&&(ve=!1),ve},Oe=h.__addimage__.extractImageFromDataUrl=function(_e){var ve=(_e=_e||"").split("base64,"),$e=null;if(ve.length===2){var Ne=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(ve[0]);Array.isArray(Ne)&&($e={mimeType:Ne[1],charset:Ne[2],data:ve[1]})}return $e},Le=h.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};h.__addimage__.isArrayBuffer=function(_e){return Le()&&_e instanceof ArrayBuffer};var Ke=h.__addimage__.isArrayBufferView=function(_e){return Le()&&typeof Uint32Array<"u"&&(_e instanceof Int8Array||_e instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&_e instanceof Uint8ClampedArray||_e instanceof Int16Array||_e instanceof Uint16Array||_e instanceof Int32Array||_e instanceof Uint32Array||_e instanceof Float32Array||_e instanceof Float64Array)},Ue=h.__addimage__.binaryStringToUint8Array=function(_e){for(var ve=_e.length,$e=new Uint8Array(ve),Ne=0;Ne<ve;Ne++)$e[Ne]=_e.charCodeAt(Ne);return $e},Ae=h.__addimage__.arrayBufferToBinaryString=function(_e){for(var ve="",$e=Ke(_e)?_e:new Uint8Array(_e),Ne=0;Ne<$e.length;Ne+=8192)ve+=String.fromCharCode.apply(null,$e.subarray(Ne,Ne+8192));return ve};h.addImage=function(){var _e,ve,$e,Ne,wt,ut,At,ht,Tt;if(typeof arguments[1]=="number"?(ve=a,$e=arguments[1],Ne=arguments[2],wt=arguments[3],ut=arguments[4],At=arguments[5],ht=arguments[6],Tt=arguments[7]):(ve=arguments[1],$e=arguments[2],Ne=arguments[3],wt=arguments[4],ut=arguments[5],At=arguments[6],ht=arguments[7],Tt=arguments[8]),Ri(_e=arguments[0])==="object"&&!U(_e)&&"imageData"in _e){var Dt=_e;_e=Dt.imageData,ve=Dt.format||ve||a,$e=Dt.x||$e||0,Ne=Dt.y||Ne||0,wt=Dt.w||Dt.width||wt,ut=Dt.h||Dt.height||ut,At=Dt.alias||At,ht=Dt.compression||ht,Tt=Dt.rotation||Dt.angle||Tt}var sr=this.internal.getFilters();if(ht===void 0&&sr.indexOf("FlateEncode")!==-1&&(ht="SLOW"),isNaN($e)||isNaN(Ne))throw new Error("Invalid coordinates passed to jsPDF.addImage");s.call(this);var ne=lt.call(this,_e,ve,At,ht);return pe.call(this,$e,Ne,wt,ut,ne,Tt),this};var lt=function(_e,ve,$e,Ne){var wt,ut,At;if(typeof _e=="string"&&p(_e)===a){_e=unescape(_e);var ht=mt(_e,!1);(ht!==""||(ht=h.loadFile(_e,!0))!==void 0)&&(_e=ht)}if(U(_e)&&(_e=J(_e,ve)),ve=p(_e,ve),!V(ve))throw new Error("addImage does not support files of type '"+ve+"', please ensure that a plugin for '"+ve+"' support is added.");if(((At=$e)==null||At.length===0)&&($e=function(Tt){return typeof Tt=="string"||Ke(Tt)?ke(Tt):Ke(Tt.data)?ke(Tt.data):null}(_e)),(wt=N.call(this,$e))||(Le()&&(_e instanceof Uint8Array||ve==="RGBA"||(ut=_e,_e=Ue(_e))),wt=this["process"+ve.toUpperCase()](_e,B.call(this),$e,function(Tt){return Tt&&typeof Tt=="string"&&(Tt=Tt.toUpperCase()),Tt in h.image_compression?Tt:fe.NONE}(Ne),ut)),!wt)throw new Error("An unknown error occurred whilst processing the image.");return wt},mt=h.__addimage__.convertBase64ToBinaryString=function(_e,ve){var $e;ve=typeof ve!="boolean"||ve;var Ne,wt="";if(typeof _e=="string"){Ne=($e=Oe(_e))!==null?$e.data:_e;try{wt=ih(Ne)}catch(ut){if(ve)throw He(Ne)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+ut.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return wt};h.getImageProperties=function(_e){var ve,$e,Ne="";if(U(_e)&&(_e=J(_e)),typeof _e=="string"&&p(_e)===a&&((Ne=mt(_e,!1))===""&&(Ne=h.loadFile(_e)||""),_e=Ne),$e=p(_e),!V($e))throw new Error("addImage does not support files of type '"+$e+"', please ensure that a plugin for '"+$e+"' support is added.");if(!Le()||_e instanceof Uint8Array||(_e=Ue(_e)),!(ve=this["process"+$e.toUpperCase()](_e)))throw new Error("An unknown error occurred whilst processing the image");return ve.fileType=$e,ve}})(Br.API),function(h){var a=function(c){if(c!==void 0&&c!="")return!0};Br.API.events.push(["addPage",function(c){this.internal.getPageInfo(c.pageNumber).pageContext.annotations=[]}]),h.events.push(["putPage",function(c){for(var p,v,y,f=this.internal.getCoordinateString,s=this.internal.getVerticalCoordinateString,M=this.internal.getPageInfoByObjId(c.objId),B=c.pageContext.annotations,V=!1,U=0;U<B.length&&!V;U++)switch((p=B[U]).type){case"link":(a(p.options.url)||a(p.options.pageNumber))&&(V=!0);break;case"reference":case"text":case"freetext":V=!0}if(V!=0){this.internal.write("/Annots [");for(var J=0;J<B.length;J++){p=B[J];var N=this.internal.pdfEscape,de=this.internal.getEncryptor(c.objId);switch(p.type){case"reference":this.internal.write(" "+p.object.objId+" 0 R ");break;case"text":var pe=this.internal.newAdditionalObject(),De=this.internal.newAdditionalObject(),fe=this.internal.getEncryptor(pe.objId),ke=p.title||"Note";y="<</Type /Annot /Subtype /Text "+(v="/Rect ["+f(p.bounds.x)+" "+s(p.bounds.y+p.bounds.h)+" "+f(p.bounds.x+p.bounds.w)+" "+s(p.bounds.y)+"] ")+"/Contents ("+N(fe(p.contents))+")",y+=" /Popup "+De.objId+" 0 R",y+=" /P "+M.objId+" 0 R",y+=" /T ("+N(fe(ke))+") >>",pe.content=y;var He=pe.objId+" 0 R";y="<</Type /Annot /Subtype /Popup "+(v="/Rect ["+f(p.bounds.x+30)+" "+s(p.bounds.y+p.bounds.h)+" "+f(p.bounds.x+p.bounds.w+30)+" "+s(p.bounds.y)+"] ")+" /Parent "+He,p.open&&(y+=" /Open true"),y+=" >>",De.content=y,this.internal.write(pe.objId,"0 R",De.objId,"0 R");break;case"freetext":v="/Rect ["+f(p.bounds.x)+" "+s(p.bounds.y)+" "+f(p.bounds.x+p.bounds.w)+" "+s(p.bounds.y+p.bounds.h)+"] ";var Oe=p.color||"#000000";y="<</Type /Annot /Subtype /FreeText "+v+"/Contents ("+N(de(p.contents))+")",y+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+Oe+")",y+=" /Border [0 0 0]",y+=" >>",this.internal.write(y);break;case"link":if(p.options.name){var Le=this.annotations._nameMap[p.options.name];p.options.pageNumber=Le.page,p.options.top=Le.y}else p.options.top||(p.options.top=0);if(v="/Rect ["+p.finalBounds.x+" "+p.finalBounds.y+" "+p.finalBounds.w+" "+p.finalBounds.h+"] ",y="",p.options.url)y="<</Type /Annot /Subtype /Link "+v+"/Border [0 0 0] /A <</S /URI /URI ("+N(de(p.options.url))+") >>";else if(p.options.pageNumber)switch(y="<</Type /Annot /Subtype /Link "+v+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(p.options.pageNumber).objId+" 0 R",p.options.magFactor=p.options.magFactor||"XYZ",p.options.magFactor){case"Fit":y+=" /Fit]";break;case"FitH":y+=" /FitH "+p.options.top+"]";break;case"FitV":p.options.left=p.options.left||0,y+=" /FitV "+p.options.left+"]";break;case"XYZ":default:var Ke=s(p.options.top);p.options.left=p.options.left||0,p.options.zoom===void 0&&(p.options.zoom=0),y+=" /XYZ "+p.options.left+" "+Ke+" "+p.options.zoom+"]"}y!=""&&(y+=" >>",this.internal.write(y))}}this.internal.write("]")}}]),h.createAnnotation=function(c){var p=this.internal.getCurrentPageInfo();switch(c.type){case"link":this.link(c.bounds.x,c.bounds.y,c.bounds.w,c.bounds.h,c);break;case"text":case"freetext":p.pageContext.annotations.push(c)}},h.link=function(c,p,v,y,f){var s=this.internal.getCurrentPageInfo(),M=this.internal.getCoordinateString,B=this.internal.getVerticalCoordinateString;s.pageContext.annotations.push({finalBounds:{x:M(c),y:B(p),w:M(c+v),h:B(p+y)},options:f,type:"link"})},h.textWithLink=function(c,p,v,y){var f,s,M=this.getTextWidth(c),B=this.internal.getLineHeight()/this.internal.scaleFactor;if(y.maxWidth!==void 0){s=y.maxWidth;var V=this.splitTextToSize(c,s).length;f=Math.ceil(B*V)}else s=M,f=B;return this.text(c,p,v,y),v+=.2*B,y.align==="center"&&(p-=M/2),y.align==="right"&&(p-=M),this.link(p,v-B,s,f,y),M},h.getTextWidth=function(c){var p=this.internal.getFontSize();return this.getStringUnitWidth(c)*p/this.internal.scaleFactor}}(Br.API),function(h){var a={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},c={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},p={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},v=[1570,1571,1573,1575];h.__arabicParser__={};var y=h.__arabicParser__.isInArabicSubstitutionA=function(pe){return a[pe.charCodeAt(0)]!==void 0},f=h.__arabicParser__.isArabicLetter=function(pe){return typeof pe=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(pe)},s=h.__arabicParser__.isArabicEndLetter=function(pe){return f(pe)&&y(pe)&&a[pe.charCodeAt(0)].length<=2},M=h.__arabicParser__.isArabicAlfLetter=function(pe){return f(pe)&&v.indexOf(pe.charCodeAt(0))>=0};h.__arabicParser__.arabicLetterHasIsolatedForm=function(pe){return f(pe)&&y(pe)&&a[pe.charCodeAt(0)].length>=1};var B=h.__arabicParser__.arabicLetterHasFinalForm=function(pe){return f(pe)&&y(pe)&&a[pe.charCodeAt(0)].length>=2};h.__arabicParser__.arabicLetterHasInitialForm=function(pe){return f(pe)&&y(pe)&&a[pe.charCodeAt(0)].length>=3};var V=h.__arabicParser__.arabicLetterHasMedialForm=function(pe){return f(pe)&&y(pe)&&a[pe.charCodeAt(0)].length==4},U=h.__arabicParser__.resolveLigatures=function(pe){var De=0,fe=c,ke="",He=0;for(De=0;De<pe.length;De+=1)fe[pe.charCodeAt(De)]!==void 0?(He++,typeof(fe=fe[pe.charCodeAt(De)])=="number"&&(ke+=String.fromCharCode(fe),fe=c,He=0),De===pe.length-1&&(fe=c,ke+=pe.charAt(De-(He-1)),De-=He-1,He=0)):(fe=c,ke+=pe.charAt(De-He),De-=He,He=0);return ke};h.__arabicParser__.isArabicDiacritic=function(pe){return pe!==void 0&&p[pe.charCodeAt(0)]!==void 0};var J=h.__arabicParser__.getCorrectForm=function(pe,De,fe){return f(pe)?y(pe)===!1?-1:!B(pe)||!f(De)&&!f(fe)||!f(fe)&&s(De)||s(pe)&&!f(De)||s(pe)&&M(De)||s(pe)&&s(De)?0:V(pe)&&f(De)&&!s(De)&&f(fe)&&B(fe)?3:s(pe)||!f(fe)?1:2:-1},N=function(pe){var De=0,fe=0,ke=0,He="",Oe="",Le="",Ke=(pe=pe||"").split("\\s+"),Ue=[];for(De=0;De<Ke.length;De+=1){for(Ue.push(""),fe=0;fe<Ke[De].length;fe+=1)He=Ke[De][fe],Oe=Ke[De][fe-1],Le=Ke[De][fe+1],f(He)?(ke=J(He,Oe,Le),Ue[De]+=ke!==-1?String.fromCharCode(a[He.charCodeAt(0)][ke]):He):Ue[De]+=He;Ue[De]=U(Ue[De])}return Ue.join(" ")},de=h.__arabicParser__.processArabic=h.processArabic=function(){var pe,De=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,fe=[];if(Array.isArray(De)){var ke=0;for(fe=[],ke=0;ke<De.length;ke+=1)Array.isArray(De[ke])?fe.push([N(De[ke][0]),De[ke][1],De[ke][2]]):fe.push([N(De[ke])]);pe=fe}else pe=N(De);return typeof arguments[0]=="string"?pe:(arguments[0].text=pe,arguments[0])};h.events.push(["preProcessText",de])}(Br.API),Br.API.autoPrint=function(h){var a;switch((h=h||{}).variant=h.variant||"non-conform",h.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){a=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+a+" 0 R")})}return this},function(h){var a=function(){var c=void 0;Object.defineProperty(this,"pdf",{get:function(){return c},set:function(s){c=s}});var p=150;Object.defineProperty(this,"width",{get:function(){return p},set:function(s){p=isNaN(s)||Number.isInteger(s)===!1||s<0?150:s,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=p+1)}});var v=300;Object.defineProperty(this,"height",{get:function(){return v},set:function(s){v=isNaN(s)||Number.isInteger(s)===!1||s<0?300:s,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=v+1)}});var y=[];Object.defineProperty(this,"childNodes",{get:function(){return y},set:function(s){y=s}});var f={};Object.defineProperty(this,"style",{get:function(){return f},set:function(s){f=s}}),Object.defineProperty(this,"parentNode",{})};a.prototype.getContext=function(c,p){var v;if((c=c||"2d")!=="2d")return null;for(v in p)this.pdf.context2d.hasOwnProperty(v)&&(this.pdf.context2d[v]=p[v]);return this.pdf.context2d._canvas=this,this.pdf.context2d},a.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},h.events.push(["initialized",function(){this.canvas=new a,this.canvas.pdf=this}])}(Br.API),function(h){var a={left:0,top:0,bottom:0,right:0},c=!1,p=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},a),this.internal.__cell__.margins.width=this.getPageWidth(),v.call(this))},v=function(){this.internal.__cell__.lastCell=new y,this.internal.__cell__.pages=1},y=function(){var M=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return M},set:function(pe){M=pe}});var B=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return B},set:function(pe){B=pe}});var V=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return V},set:function(pe){V=pe}});var U=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return U},set:function(pe){U=pe}});var J=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return J},set:function(pe){J=pe}});var N=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return N},set:function(pe){N=pe}});var de=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return de},set:function(pe){de=pe}}),this};y.prototype.clone=function(){return new y(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},y.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},h.setHeaderFunction=function(M){return p.call(this),this.internal.__cell__.headerFunction=typeof M=="function"?M:void 0,this},h.getTextDimensions=function(M,B){p.call(this);var V=(B=B||{}).fontSize||this.getFontSize(),U=B.font||this.getFont(),J=B.scaleFactor||this.internal.scaleFactor,N=0,de=0,pe=0,De=this;if(!Array.isArray(M)&&typeof M!="string"){if(typeof M!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");M=String(M)}var fe=B.maxWidth;fe>0?typeof M=="string"?M=this.splitTextToSize(M,fe):Object.prototype.toString.call(M)==="[object Array]"&&(M=M.reduce(function(He,Oe){return He.concat(De.splitTextToSize(Oe,fe))},[])):M=Array.isArray(M)?M:[M];for(var ke=0;ke<M.length;ke++)N<(pe=this.getStringUnitWidth(M[ke],{font:U})*V)&&(N=pe);return N!==0&&(de=M.length),{w:N/=J,h:Math.max((de*V*this.getLineHeightFactor()-V*(this.getLineHeightFactor()-1))/J,0)}},h.cellAddPage=function(){p.call(this),this.addPage();var M=this.internal.__cell__.margins||a;return this.internal.__cell__.lastCell=new y(M.left,M.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var f=h.cell=function(){var M;M=arguments[0]instanceof y?arguments[0]:new y(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),p.call(this);var B=this.internal.__cell__.lastCell,V=this.internal.__cell__.padding,U=this.internal.__cell__.margins||a,J=this.internal.__cell__.tableHeaderRow,N=this.internal.__cell__.printHeaders;return B.lineNumber!==void 0&&(B.lineNumber===M.lineNumber?(M.x=(B.x||0)+(B.width||0),M.y=B.y||0):B.y+B.height+M.height+U.bottom>this.getPageHeight()?(this.cellAddPage(),M.y=U.top,N&&J&&(this.printHeaderRow(M.lineNumber,!0),M.y+=J[0].height)):M.y=B.y+B.height||M.y),M.text[0]!==void 0&&(this.rect(M.x,M.y,M.width,M.height,c===!0?"FD":void 0),M.align==="right"?this.text(M.text,M.x+M.width-V,M.y+V,{align:"right",baseline:"top"}):M.align==="center"?this.text(M.text,M.x+M.width/2,M.y+V,{align:"center",baseline:"top",maxWidth:M.width-V-V}):this.text(M.text,M.x+V,M.y+V,{align:"left",baseline:"top",maxWidth:M.width-V-V})),this.internal.__cell__.lastCell=M,this};h.table=function(M,B,V,U,J){if(p.call(this),!V)throw new Error("No data for PDF table.");var N,de,pe,De,fe=[],ke=[],He=[],Oe={},Le={},Ke=[],Ue=[],Ae=(J=J||{}).autoSize||!1,lt=J.printHeaders!==!1,mt=J.css&&J.css["font-size"]!==void 0?16*J.css["font-size"]:J.fontSize||12,_e=J.margins||Object.assign({width:this.getPageWidth()},a),ve=typeof J.padding=="number"?J.padding:3,$e=J.headerBackgroundColor||"#c8c8c8",Ne=J.headerTextColor||"#000";if(v.call(this),this.internal.__cell__.printHeaders=lt,this.internal.__cell__.margins=_e,this.internal.__cell__.table_font_size=mt,this.internal.__cell__.padding=ve,this.internal.__cell__.headerBackgroundColor=$e,this.internal.__cell__.headerTextColor=Ne,this.setFontSize(mt),U==null)ke=fe=Object.keys(V[0]),He=fe.map(function(){return"left"});else if(Array.isArray(U)&&Ri(U[0])==="object")for(fe=U.map(function(Dt){return Dt.name}),ke=U.map(function(Dt){return Dt.prompt||Dt.name||""}),He=U.map(function(Dt){return Dt.align||"left"}),N=0;N<U.length;N+=1)Le[U[N].name]=U[N].width*(19.049976/25.4);else Array.isArray(U)&&typeof U[0]=="string"&&(ke=fe=U,He=fe.map(function(){return"left"}));if(Ae||Array.isArray(U)&&typeof U[0]=="string")for(N=0;N<fe.length;N+=1){for(Oe[De=fe[N]]=V.map(function(Dt){return Dt[De]}),this.setFont(void 0,"bold"),Ke.push(this.getTextDimensions(ke[N],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),de=Oe[De],this.setFont(void 0,"normal"),pe=0;pe<de.length;pe+=1)Ke.push(this.getTextDimensions(de[pe],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);Le[De]=Math.max.apply(null,Ke)+ve+ve,Ke=[]}if(lt){var wt={};for(N=0;N<fe.length;N+=1)wt[fe[N]]={},wt[fe[N]].text=ke[N],wt[fe[N]].align=He[N];var ut=s.call(this,wt,Le);Ue=fe.map(function(Dt){return new y(M,B,Le[Dt],ut,wt[Dt].text,void 0,wt[Dt].align)}),this.setTableHeaderRow(Ue),this.printHeaderRow(1,!1)}var At=U.reduce(function(Dt,sr){return Dt[sr.name]=sr.align,Dt},{});for(N=0;N<V.length;N+=1){"rowStart"in J&&J.rowStart instanceof Function&&J.rowStart({row:N,data:V[N]},this);var ht=s.call(this,V[N],Le);for(pe=0;pe<fe.length;pe+=1){var Tt=V[N][fe[pe]];"cellStart"in J&&J.cellStart instanceof Function&&J.cellStart({row:N,col:pe,data:Tt},this),f.call(this,new y(M,B,Le[fe[pe]],ht,Tt,N+2,At[fe[pe]]))}}return this.internal.__cell__.table_x=M,this.internal.__cell__.table_y=B,this};var s=function(M,B){var V=this.internal.__cell__.padding,U=this.internal.__cell__.table_font_size,J=this.internal.scaleFactor;return Object.keys(M).map(function(N){var de=M[N];return this.splitTextToSize(de.hasOwnProperty("text")?de.text:de,B[N]-V-V)},this).map(function(N){return this.getLineHeightFactor()*N.length*U/J+V+V},this).reduce(function(N,de){return Math.max(N,de)},0)};h.setTableHeaderRow=function(M){p.call(this),this.internal.__cell__.tableHeaderRow=M},h.printHeaderRow=function(M,B){if(p.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var V;if(c=!0,typeof this.internal.__cell__.headerFunction=="function"){var U=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new y(U[0],U[1],U[2],U[3],void 0,-1)}this.setFont(void 0,"bold");for(var J=[],N=0;N<this.internal.__cell__.tableHeaderRow.length;N+=1){V=this.internal.__cell__.tableHeaderRow[N].clone(),B&&(V.y=this.internal.__cell__.margins.top||0,J.push(V)),V.lineNumber=M;var de=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),f.call(this,V),this.setTextColor(de)}J.length>0&&this.setTableHeaderRow(J),this.setFont(void 0,"normal"),c=!1}}(Br.API);var h_={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},d_=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],zp=u_(d_),p_=[100,200,300,400,500,600,700,800,900],Nv=u_(p_);function Dp(h){var a=h.family.replace(/"|'/g,"").toLowerCase(),c=function(y){return h_[y=y||"normal"]?y:"normal"}(h.style),p=function(y){if(!y)return 400;if(typeof y=="number")return y>=100&&y<=900&&y%100==0?y:400;if(/^\d00$/.test(y))return parseInt(y);switch(y){case"bold":return 700;case"normal":default:return 400}}(h.weight),v=function(y){return typeof zp[y=y||"normal"]=="number"?y:"normal"}(h.stretch);return{family:a,style:c,weight:p,stretch:v,src:h.src||[],ref:h.ref||{name:a,style:[v,c,p].join(" ")}}}function yg(h,a,c,p){var v;for(v=c;v>=0&&v<a.length;v+=p)if(h[a[v]])return h[a[v]];for(v=c;v>=0&&v<a.length;v-=p)if(h[a[v]])return h[a[v]]}var Rv={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},vg={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function bg(h){return[h.stretch,h.style,h.weight,h.family].join(" ")}function Bv(h,a,c){for(var p=(c=c||{}).defaultFontFamily||"times",v=Object.assign({},Rv,c.genericFontFamilies||{}),y=null,f=null,s=0;s<a.length;++s)if(v[(y=Dp(a[s])).family]&&(y.family=v[y.family]),h.hasOwnProperty(y.family)){f=h[y.family];break}if(!(f=f||h[p]))throw new Error("Could not find a font-family for the rule '"+bg(y)+"' and default family '"+p+"'.");if(f=function(M,B){if(B[M])return B[M];var V=zp[M],U=V<=zp.normal?-1:1,J=yg(B,d_,V,U);if(!J)throw new Error("Could not find a matching font-stretch value for "+M);return J}(y.stretch,f),f=function(M,B){if(B[M])return B[M];for(var V=h_[M],U=0;U<V.length;++U)if(B[V[U]])return B[V[U]];throw new Error("Could not find a matching font-style for "+M)}(y.style,f),!(f=function(M,B){if(B[M])return B[M];if(M===400&&B[500])return B[500];if(M===500&&B[400])return B[400];var V=Nv[M],U=yg(B,p_,V,M<400?-1:1);if(!U)throw new Error("Could not find a matching font-weight for value "+M);return U}(y.weight,f)))throw new Error("Failed to resolve a font for the rule '"+bg(y)+"'.");return f}function xg(h){return h.trimLeft()}function Ov(h,a){for(var c=0;c<h.length;){if(h.charAt(c)===a)return[h.substring(0,c),h.substring(c+1)];c+=1}return null}function jv(h){var a=h.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return a===null?null:[a[0],h.substring(a[0].length)]}var Uh,wg,Pg,Sg=["times"];(function(h){var a,c,p,v,y,f,s,M,B,V=function(ne){return ne=ne||{},this.isStrokeTransparent=ne.isStrokeTransparent||!1,this.strokeOpacity=ne.strokeOpacity||1,this.strokeStyle=ne.strokeStyle||"#000000",this.fillStyle=ne.fillStyle||"#000000",this.isFillTransparent=ne.isFillTransparent||!1,this.fillOpacity=ne.fillOpacity||1,this.font=ne.font||"10px sans-serif",this.textBaseline=ne.textBaseline||"alphabetic",this.textAlign=ne.textAlign||"left",this.lineWidth=ne.lineWidth||1,this.lineJoin=ne.lineJoin||"miter",this.lineCap=ne.lineCap||"butt",this.path=ne.path||[],this.transform=ne.transform!==void 0?ne.transform.clone():new M,this.globalCompositeOperation=ne.globalCompositeOperation||"normal",this.globalAlpha=ne.globalAlpha||1,this.clip_path=ne.clip_path||[],this.currentPoint=ne.currentPoint||new f,this.miterLimit=ne.miterLimit||10,this.lastPoint=ne.lastPoint||new f,this.lineDashOffset=ne.lineDashOffset||0,this.lineDash=ne.lineDash||[],this.margin=ne.margin||[0,0,0,0],this.prevPageLastElemOffset=ne.prevPageLastElemOffset||0,this.ignoreClearRect=typeof ne.ignoreClearRect!="boolean"||ne.ignoreClearRect,this};h.events.push(["initialized",function(){this.context2d=new U(this),a=this.internal.f2,c=this.internal.getCoordinateString,p=this.internal.getVerticalCoordinateString,v=this.internal.getHorizontalCoordinate,y=this.internal.getVerticalCoordinate,f=this.internal.Point,s=this.internal.Rectangle,M=this.internal.Matrix,B=new V}]);var U=function(ne){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Ie=ne;Object.defineProperty(this,"pdf",{get:function(){return Ie}});var Re=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Re},set:function(Et){Re=!!Et}});var We=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return We},set:function(Et){We=!!Et}});var nt=0;Object.defineProperty(this,"posX",{get:function(){return nt},set:function(Et){isNaN(Et)||(nt=Et)}});var at=0;Object.defineProperty(this,"posY",{get:function(){return at},set:function(Et){isNaN(Et)||(at=Et)}}),Object.defineProperty(this,"margin",{get:function(){return B.margin},set:function(Et){var qe;typeof Et=="number"?qe=[Et,Et,Et,Et]:((qe=new Array(4))[0]=Et[0],qe[1]=Et.length>=2?Et[1]:qe[0],qe[2]=Et.length>=3?Et[2]:qe[0],qe[3]=Et.length>=4?Et[3]:qe[1]),B.margin=qe}});var pt=!1;Object.defineProperty(this,"autoPaging",{get:function(){return pt},set:function(Et){pt=Et}});var gt=0;Object.defineProperty(this,"lastBreak",{get:function(){return gt},set:function(Et){gt=Et}});var Ht=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Ht},set:function(Et){Ht=Et}}),Object.defineProperty(this,"ctx",{get:function(){return B},set:function(Et){Et instanceof V&&(B=Et)}}),Object.defineProperty(this,"path",{get:function(){return B.path},set:function(Et){B.path=Et}});var $t=[];Object.defineProperty(this,"ctxStack",{get:function(){return $t},set:function(Et){$t=Et}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(Et){var qe;qe=J(Et),this.ctx.fillStyle=qe.style,this.ctx.isFillTransparent=qe.a===0,this.ctx.fillOpacity=qe.a,this.pdf.setFillColor(qe.r,qe.g,qe.b,{a:qe.a}),this.pdf.setTextColor(qe.r,qe.g,qe.b,{a:qe.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(Et){var qe=J(Et);this.ctx.strokeStyle=qe.style,this.ctx.isStrokeTransparent=qe.a===0,this.ctx.strokeOpacity=qe.a,qe.a===0?this.pdf.setDrawColor(255,255,255):(qe.a,this.pdf.setDrawColor(qe.r,qe.g,qe.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(Et){["butt","round","square"].indexOf(Et)!==-1&&(this.ctx.lineCap=Et,this.pdf.setLineCap(Et))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(Et){isNaN(Et)||(this.ctx.lineWidth=Et,this.pdf.setLineWidth(Et))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(Et){["bevel","round","miter"].indexOf(Et)!==-1&&(this.ctx.lineJoin=Et,this.pdf.setLineJoin(Et))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(Et){isNaN(Et)||(this.ctx.miterLimit=Et,this.pdf.setMiterLimit(Et))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(Et){this.ctx.textBaseline=Et}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(Et){["right","end","center","left","start"].indexOf(Et)!==-1&&(this.ctx.textAlign=Et)}});var er=null;function nr(Et,qe){if(er===null){var zr=function(yr){var Xt=[];return Object.keys(yr).forEach(function(ir){yr[ir].forEach(function(ar){var or=null;switch(ar){case"bold":or={family:ir,weight:"bold"};break;case"italic":or={family:ir,style:"italic"};break;case"bolditalic":or={family:ir,weight:"bold",style:"italic"};break;case"":case"normal":or={family:ir}}or!==null&&(or.ref={name:ir,style:ar},Xt.push(or))})}),Xt}(Et.getFontList());er=function(yr){for(var Xt={},ir=0;ir<yr.length;++ir){var ar=Dp(yr[ir]),or=ar.family,xr=ar.stretch,wr=ar.style,Dr=ar.weight;Xt[or]=Xt[or]||{},Xt[or][xr]=Xt[or][xr]||{},Xt[or][xr][wr]=Xt[or][xr][wr]||{},Xt[or][xr][wr][Dr]=ar}return Xt}(zr.concat(qe))}return er}var dr=null;Object.defineProperty(this,"fontFaces",{get:function(){return dr},set:function(Et){er=null,dr=Et}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(Et){var qe;if(this.ctx.font=Et,(qe=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(Et))!==null){var zr=qe[1],yr=(qe[2],qe[3]),Xt=qe[4],ir=(qe[5],qe[6]),ar=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Xt)[2];Xt=Math.floor(ar==="px"?parseFloat(Xt)*this.pdf.internal.scaleFactor:ar==="em"?parseFloat(Xt)*this.pdf.getFontSize():parseFloat(Xt)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Xt);var or=function(Mr){var Rr,ur,Wi=[],Qr=Mr.trim();if(Qr==="")return Sg;if(Qr in vg)return[vg[Qr]];for(;Qr!=="";){switch(ur=null,Rr=(Qr=xg(Qr)).charAt(0)){case'"':case"'":ur=Ov(Qr.substring(1),Rr);break;default:ur=jv(Qr)}if(ur===null||(Wi.push(ur[0]),(Qr=xg(ur[1]))!==""&&Qr.charAt(0)!==","))return Sg;Qr=Qr.replace(/^,/,"")}return Wi}(ir);if(this.fontFaces){var xr=Bv(nr(this.pdf,this.fontFaces),or.map(function(Mr){return{family:Mr,stretch:"normal",weight:yr,style:zr}}));this.pdf.setFont(xr.ref.name,xr.ref.style)}else{var wr="";(yr==="bold"||parseInt(yr,10)>=700||zr==="bold")&&(wr="bold"),zr==="italic"&&(wr+="italic"),wr.length===0&&(wr="normal");for(var Dr="",Fr={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Zr=0;Zr<or.length;Zr++){if(this.pdf.internal.getFont(or[Zr],wr,{noFallback:!0,disableWarning:!0})!==void 0){Dr=or[Zr];break}if(wr==="bolditalic"&&this.pdf.internal.getFont(or[Zr],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Dr=or[Zr],wr="bold";else if(this.pdf.internal.getFont(or[Zr],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Dr=or[Zr],wr="normal";break}}if(Dr===""){for(var Jr=0;Jr<or.length;Jr++)if(Fr[or[Jr]]){Dr=Fr[or[Jr]];break}}Dr=Dr===""?"Times":Dr,this.pdf.setFont(Dr,wr)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(Et){this.ctx.globalCompositeOperation=Et}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(Et){this.ctx.globalAlpha=Et}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(Et){this.ctx.lineDashOffset=Et,sr.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(Et){this.ctx.lineDash=Et,sr.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(Et){this.ctx.ignoreClearRect=!!Et}})};U.prototype.setLineDash=function(ne){this.lineDash=ne},U.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},U.prototype.fill=function(){Oe.call(this,"fill",!1)},U.prototype.stroke=function(){Oe.call(this,"stroke",!1)},U.prototype.beginPath=function(){this.path=[{type:"begin"}]},U.prototype.moveTo=function(ne,Ie){if(isNaN(ne)||isNaN(Ie))throw Yi.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Re=this.ctx.transform.applyToPoint(new f(ne,Ie));this.path.push({type:"mt",x:Re.x,y:Re.y}),this.ctx.lastPoint=new f(ne,Ie)},U.prototype.closePath=function(){var ne=new f(0,0),Ie=0;for(Ie=this.path.length-1;Ie!==-1;Ie--)if(this.path[Ie].type==="begin"&&Ri(this.path[Ie+1])==="object"&&typeof this.path[Ie+1].x=="number"){ne=new f(this.path[Ie+1].x,this.path[Ie+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new f(ne.x,ne.y)},U.prototype.lineTo=function(ne,Ie){if(isNaN(ne)||isNaN(Ie))throw Yi.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Re=this.ctx.transform.applyToPoint(new f(ne,Ie));this.path.push({type:"lt",x:Re.x,y:Re.y}),this.ctx.lastPoint=new f(Re.x,Re.y)},U.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),Oe.call(this,null,!0)},U.prototype.quadraticCurveTo=function(ne,Ie,Re,We){if(isNaN(Re)||isNaN(We)||isNaN(ne)||isNaN(Ie))throw Yi.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var nt=this.ctx.transform.applyToPoint(new f(Re,We)),at=this.ctx.transform.applyToPoint(new f(ne,Ie));this.path.push({type:"qct",x1:at.x,y1:at.y,x:nt.x,y:nt.y}),this.ctx.lastPoint=new f(nt.x,nt.y)},U.prototype.bezierCurveTo=function(ne,Ie,Re,We,nt,at){if(isNaN(nt)||isNaN(at)||isNaN(ne)||isNaN(Ie)||isNaN(Re)||isNaN(We))throw Yi.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var pt=this.ctx.transform.applyToPoint(new f(nt,at)),gt=this.ctx.transform.applyToPoint(new f(ne,Ie)),Ht=this.ctx.transform.applyToPoint(new f(Re,We));this.path.push({type:"bct",x1:gt.x,y1:gt.y,x2:Ht.x,y2:Ht.y,x:pt.x,y:pt.y}),this.ctx.lastPoint=new f(pt.x,pt.y)},U.prototype.arc=function(ne,Ie,Re,We,nt,at){if(isNaN(ne)||isNaN(Ie)||isNaN(Re)||isNaN(We)||isNaN(nt))throw Yi.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(at=!!at,!this.ctx.transform.isIdentity){var pt=this.ctx.transform.applyToPoint(new f(ne,Ie));ne=pt.x,Ie=pt.y;var gt=this.ctx.transform.applyToPoint(new f(0,Re)),Ht=this.ctx.transform.applyToPoint(new f(0,0));Re=Math.sqrt(Math.pow(gt.x-Ht.x,2)+Math.pow(gt.y-Ht.y,2))}Math.abs(nt-We)>=2*Math.PI&&(We=0,nt=2*Math.PI),this.path.push({type:"arc",x:ne,y:Ie,radius:Re,startAngle:We,endAngle:nt,counterclockwise:at})},U.prototype.arcTo=function(ne,Ie,Re,We,nt){throw new Error("arcTo not implemented.")},U.prototype.rect=function(ne,Ie,Re,We){if(isNaN(ne)||isNaN(Ie)||isNaN(Re)||isNaN(We))throw Yi.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(ne,Ie),this.lineTo(ne+Re,Ie),this.lineTo(ne+Re,Ie+We),this.lineTo(ne,Ie+We),this.lineTo(ne,Ie),this.lineTo(ne+Re,Ie),this.lineTo(ne,Ie)},U.prototype.fillRect=function(ne,Ie,Re,We){if(isNaN(ne)||isNaN(Ie)||isNaN(Re)||isNaN(We))throw Yi.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!N.call(this)){var nt={};this.lineCap!=="butt"&&(nt.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(nt.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(ne,Ie,Re,We),this.fill(),nt.hasOwnProperty("lineCap")&&(this.lineCap=nt.lineCap),nt.hasOwnProperty("lineJoin")&&(this.lineJoin=nt.lineJoin)}},U.prototype.strokeRect=function(ne,Ie,Re,We){if(isNaN(ne)||isNaN(Ie)||isNaN(Re)||isNaN(We))throw Yi.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");de.call(this)||(this.beginPath(),this.rect(ne,Ie,Re,We),this.stroke())},U.prototype.clearRect=function(ne,Ie,Re,We){if(isNaN(ne)||isNaN(Ie)||isNaN(Re)||isNaN(We))throw Yi.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(ne,Ie,Re,We))},U.prototype.save=function(ne){ne=typeof ne!="boolean"||ne;for(var Ie=this.pdf.internal.getCurrentPageInfo().pageNumber,Re=0;Re<this.pdf.internal.getNumberOfPages();Re++)this.pdf.setPage(Re+1),this.pdf.internal.out("q");if(this.pdf.setPage(Ie),ne){this.ctx.fontSize=this.pdf.internal.getFontSize();var We=new V(this.ctx);this.ctxStack.push(this.ctx),this.ctx=We}},U.prototype.restore=function(ne){ne=typeof ne!="boolean"||ne;for(var Ie=this.pdf.internal.getCurrentPageInfo().pageNumber,Re=0;Re<this.pdf.internal.getNumberOfPages();Re++)this.pdf.setPage(Re+1),this.pdf.internal.out("Q");this.pdf.setPage(Ie),ne&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},U.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var J=function(ne){var Ie,Re,We,nt;if(ne.isCanvasGradient===!0&&(ne=ne.getColor()),!ne)return{r:0,g:0,b:0,a:0,style:ne};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(ne))Ie=0,Re=0,We=0,nt=0;else{var at=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(ne);if(at!==null)Ie=parseInt(at[1]),Re=parseInt(at[2]),We=parseInt(at[3]),nt=1;else if((at=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(ne))!==null)Ie=parseInt(at[1]),Re=parseInt(at[2]),We=parseInt(at[3]),nt=parseFloat(at[4]);else{if(nt=1,typeof ne=="string"&&ne.charAt(0)!=="#"){var pt=new n_(ne);ne=pt.ok?pt.toHex():"#000000"}ne.length===4?(Ie=ne.substring(1,2),Ie+=Ie,Re=ne.substring(2,3),Re+=Re,We=ne.substring(3,4),We+=We):(Ie=ne.substring(1,3),Re=ne.substring(3,5),We=ne.substring(5,7)),Ie=parseInt(Ie,16),Re=parseInt(Re,16),We=parseInt(We,16)}}return{r:Ie,g:Re,b:We,a:nt,style:ne}},N=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},de=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};U.prototype.fillText=function(ne,Ie,Re,We){if(isNaN(Ie)||isNaN(Re)||typeof ne!="string")throw Yi.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(We=isNaN(We)?void 0:We,!N.call(this)){var nt=ht(this.ctx.transform.rotation),at=this.ctx.transform.scaleX;ve.call(this,{text:ne,x:Ie,y:Re,scale:at,angle:nt,align:this.textAlign,maxWidth:We})}},U.prototype.strokeText=function(ne,Ie,Re,We){if(isNaN(Ie)||isNaN(Re)||typeof ne!="string")throw Yi.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!de.call(this)){We=isNaN(We)?void 0:We;var nt=ht(this.ctx.transform.rotation),at=this.ctx.transform.scaleX;ve.call(this,{text:ne,x:Ie,y:Re,scale:at,renderingMode:"stroke",angle:nt,align:this.textAlign,maxWidth:We})}},U.prototype.measureText=function(ne){if(typeof ne!="string")throw Yi.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Ie=this.pdf,Re=this.pdf.internal.scaleFactor,We=Ie.internal.getFontSize(),nt=Ie.getStringUnitWidth(ne)*We/Ie.internal.scaleFactor,at=function(pt){var gt=(pt=pt||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return gt}}),this};return new at({width:nt*=Math.round(96*Re/72*1e4)/1e4})},U.prototype.scale=function(ne,Ie){if(isNaN(ne)||isNaN(Ie))throw Yi.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Re=new M(ne,0,0,Ie,0,0);this.ctx.transform=this.ctx.transform.multiply(Re)},U.prototype.rotate=function(ne){if(isNaN(ne))throw Yi.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Ie=new M(Math.cos(ne),Math.sin(ne),-Math.sin(ne),Math.cos(ne),0,0);this.ctx.transform=this.ctx.transform.multiply(Ie)},U.prototype.translate=function(ne,Ie){if(isNaN(ne)||isNaN(Ie))throw Yi.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Re=new M(1,0,0,1,ne,Ie);this.ctx.transform=this.ctx.transform.multiply(Re)},U.prototype.transform=function(ne,Ie,Re,We,nt,at){if(isNaN(ne)||isNaN(Ie)||isNaN(Re)||isNaN(We)||isNaN(nt)||isNaN(at))throw Yi.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var pt=new M(ne,Ie,Re,We,nt,at);this.ctx.transform=this.ctx.transform.multiply(pt)},U.prototype.setTransform=function(ne,Ie,Re,We,nt,at){ne=isNaN(ne)?1:ne,Ie=isNaN(Ie)?0:Ie,Re=isNaN(Re)?0:Re,We=isNaN(We)?1:We,nt=isNaN(nt)?0:nt,at=isNaN(at)?0:at,this.ctx.transform=new M(ne,Ie,Re,We,nt,at)};var pe=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};U.prototype.drawImage=function(ne,Ie,Re,We,nt,at,pt,gt,Ht){var $t=this.pdf.getImageProperties(ne),er=1,nr=1,dr=1,Et=1;We!==void 0&&gt!==void 0&&(dr=gt/We,Et=Ht/nt,er=$t.width/We*gt/We,nr=$t.height/nt*Ht/nt),at===void 0&&(at=Ie,pt=Re,Ie=0,Re=0),We!==void 0&&gt===void 0&&(gt=We,Ht=nt),We===void 0&&gt===void 0&&(gt=$t.width,Ht=$t.height);for(var qe,zr=this.ctx.transform.decompose(),yr=ht(zr.rotate.shx),Xt=new M,ir=(Xt=(Xt=(Xt=Xt.multiply(zr.translate)).multiply(zr.skew)).multiply(zr.scale)).applyToRectangle(new s(at-Ie*dr,pt-Re*Et,We*er,nt*nr)),ar=De.call(this,ir),or=[],xr=0;xr<ar.length;xr+=1)or.indexOf(ar[xr])===-1&&or.push(ar[xr]);if(He(or),this.autoPaging)for(var wr=or[0],Dr=or[or.length-1],Fr=wr;Fr<Dr+1;Fr++){this.pdf.setPage(Fr);var Zr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Jr=Fr===1?this.posY+this.margin[0]:this.margin[0],Mr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Rr=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],ur=Fr===1?0:Mr+(Fr-2)*Rr;if(this.ctx.clip_path.length!==0){var Wi=this.path;qe=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ke(qe,this.posX+this.margin[3],-ur+Jr+this.ctx.prevPageLastElemOffset),Le.call(this,"fill",!0),this.path=Wi}var Qr=JSON.parse(JSON.stringify(ir));Qr=ke([Qr],this.posX+this.margin[3],-ur+Jr+this.ctx.prevPageLastElemOffset)[0];var Bi=(Fr>wr||Fr<Dr)&&pe.call(this);Bi&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Zr,Rr,null).clip().discardPath()),this.pdf.addImage(ne,"JPEG",Qr.x,Qr.y,Qr.w,Qr.h,null,null,yr),Bi&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(ne,"JPEG",ir.x,ir.y,ir.w,ir.h,null,null,yr)};var De=function(ne,Ie,Re){var We=[];Ie=Ie||this.pdf.internal.pageSize.width,Re=Re||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var nt=this.posY+this.ctx.prevPageLastElemOffset;switch(ne.type){default:case"mt":case"lt":We.push(Math.floor((ne.y+nt)/Re)+1);break;case"arc":We.push(Math.floor((ne.y+nt-ne.radius)/Re)+1),We.push(Math.floor((ne.y+nt+ne.radius)/Re)+1);break;case"qct":var at=Tt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,ne.x1,ne.y1,ne.x,ne.y);We.push(Math.floor((at.y+nt)/Re)+1),We.push(Math.floor((at.y+at.h+nt)/Re)+1);break;case"bct":var pt=Dt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,ne.x1,ne.y1,ne.x2,ne.y2,ne.x,ne.y);We.push(Math.floor((pt.y+nt)/Re)+1),We.push(Math.floor((pt.y+pt.h+nt)/Re)+1);break;case"rect":We.push(Math.floor((ne.y+nt)/Re)+1),We.push(Math.floor((ne.y+ne.h+nt)/Re)+1)}for(var gt=0;gt<We.length;gt+=1)for(;this.pdf.internal.getNumberOfPages()<We[gt];)fe.call(this);return We},fe=function(){var ne=this.fillStyle,Ie=this.strokeStyle,Re=this.font,We=this.lineCap,nt=this.lineWidth,at=this.lineJoin;this.pdf.addPage(),this.fillStyle=ne,this.strokeStyle=Ie,this.font=Re,this.lineCap=We,this.lineWidth=nt,this.lineJoin=at},ke=function(ne,Ie,Re){for(var We=0;We<ne.length;We++)switch(ne[We].type){case"bct":ne[We].x2+=Ie,ne[We].y2+=Re;case"qct":ne[We].x1+=Ie,ne[We].y1+=Re;case"mt":case"lt":case"arc":default:ne[We].x+=Ie,ne[We].y+=Re}return ne},He=function(ne){return ne.sort(function(Ie,Re){return Ie-Re})},Oe=function(ne,Ie){for(var Re,We,nt=this.fillStyle,at=this.strokeStyle,pt=this.lineCap,gt=this.lineWidth,Ht=Math.abs(gt*this.ctx.transform.scaleX),$t=this.lineJoin,er=JSON.parse(JSON.stringify(this.path)),nr=JSON.parse(JSON.stringify(this.path)),dr=[],Et=0;Et<nr.length;Et++)if(nr[Et].x!==void 0)for(var qe=De.call(this,nr[Et]),zr=0;zr<qe.length;zr+=1)dr.indexOf(qe[zr])===-1&&dr.push(qe[zr]);for(var yr=0;yr<dr.length;yr++)for(;this.pdf.internal.getNumberOfPages()<dr[yr];)fe.call(this);if(He(dr),this.autoPaging)for(var Xt=dr[0],ir=dr[dr.length-1],ar=Xt;ar<ir+1;ar++){this.pdf.setPage(ar),this.fillStyle=nt,this.strokeStyle=at,this.lineCap=pt,this.lineWidth=Ht,this.lineJoin=$t;var or=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],xr=ar===1?this.posY+this.margin[0]:this.margin[0],wr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Dr=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Fr=ar===1?0:wr+(ar-2)*Dr;if(this.ctx.clip_path.length!==0){var Zr=this.path;Re=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ke(Re,this.posX+this.margin[3],-Fr+xr+this.ctx.prevPageLastElemOffset),Le.call(this,ne,!0),this.path=Zr}if(We=JSON.parse(JSON.stringify(er)),this.path=ke(We,this.posX+this.margin[3],-Fr+xr+this.ctx.prevPageLastElemOffset),Ie===!1||ar===0){var Jr=(ar>Xt||ar<ir)&&pe.call(this);Jr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],or,Dr,null).clip().discardPath()),Le.call(this,ne,Ie),Jr&&this.pdf.restoreGraphicsState()}this.lineWidth=gt}else this.lineWidth=Ht,Le.call(this,ne,Ie),this.lineWidth=gt;this.path=er},Le=function(ne,Ie){if((ne!=="stroke"||Ie||!de.call(this))&&(ne==="stroke"||Ie||!N.call(this))){for(var Re,We,nt=[],at=this.path,pt=0;pt<at.length;pt++){var gt=at[pt];switch(gt.type){case"begin":nt.push({begin:!0});break;case"close":nt.push({close:!0});break;case"mt":nt.push({start:gt,deltas:[],abs:[]});break;case"lt":var Ht=nt.length;if(at[pt-1]&&!isNaN(at[pt-1].x)&&(Re=[gt.x-at[pt-1].x,gt.y-at[pt-1].y],Ht>0)){for(;Ht>=0;Ht--)if(nt[Ht-1].close!==!0&&nt[Ht-1].begin!==!0){nt[Ht-1].deltas.push(Re),nt[Ht-1].abs.push(gt);break}}break;case"bct":Re=[gt.x1-at[pt-1].x,gt.y1-at[pt-1].y,gt.x2-at[pt-1].x,gt.y2-at[pt-1].y,gt.x-at[pt-1].x,gt.y-at[pt-1].y],nt[nt.length-1].deltas.push(Re);break;case"qct":var $t=at[pt-1].x+2/3*(gt.x1-at[pt-1].x),er=at[pt-1].y+2/3*(gt.y1-at[pt-1].y),nr=gt.x+2/3*(gt.x1-gt.x),dr=gt.y+2/3*(gt.y1-gt.y),Et=gt.x,qe=gt.y;Re=[$t-at[pt-1].x,er-at[pt-1].y,nr-at[pt-1].x,dr-at[pt-1].y,Et-at[pt-1].x,qe-at[pt-1].y],nt[nt.length-1].deltas.push(Re);break;case"arc":nt.push({deltas:[],abs:[],arc:!0}),Array.isArray(nt[nt.length-1].abs)&&nt[nt.length-1].abs.push(gt)}}We=Ie?null:ne==="stroke"?"stroke":"fill";for(var zr=!1,yr=0;yr<nt.length;yr++)if(nt[yr].arc)for(var Xt=nt[yr].abs,ir=0;ir<Xt.length;ir++){var ar=Xt[ir];ar.type==="arc"?Ae.call(this,ar.x,ar.y,ar.radius,ar.startAngle,ar.endAngle,ar.counterclockwise,void 0,Ie,!zr):$e.call(this,ar.x,ar.y),zr=!0}else if(nt[yr].close===!0)this.pdf.internal.out("h"),zr=!1;else if(nt[yr].begin!==!0){var or=nt[yr].start.x,xr=nt[yr].start.y;Ne.call(this,nt[yr].deltas,or,xr),zr=!0}We&&lt.call(this,We),Ie&&mt.call(this)}},Ke=function(ne){var Ie=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Re=Ie*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return ne-Re;case"top":return ne+Ie-Re;case"hanging":return ne+Ie-2*Re;case"middle":return ne+Ie/2-Re;case"ideographic":return ne;case"alphabetic":default:return ne}},Ue=function(ne){return ne+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};U.prototype.createLinearGradient=function(){var ne=function(){};return ne.colorStops=[],ne.addColorStop=function(Ie,Re){this.colorStops.push([Ie,Re])},ne.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},ne.isCanvasGradient=!0,ne},U.prototype.createPattern=function(){return this.createLinearGradient()},U.prototype.createRadialGradient=function(){return this.createLinearGradient()};var Ae=function(ne,Ie,Re,We,nt,at,pt,gt,Ht){for(var $t=ut.call(this,Re,We,nt,at),er=0;er<$t.length;er++){var nr=$t[er];er===0&&(Ht?_e.call(this,nr.x1+ne,nr.y1+Ie):$e.call(this,nr.x1+ne,nr.y1+Ie)),wt.call(this,ne,Ie,nr.x2,nr.y2,nr.x3,nr.y3,nr.x4,nr.y4)}gt?mt.call(this):lt.call(this,pt)},lt=function(ne){switch(ne){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},mt=function(){this.pdf.clip(),this.pdf.discardPath()},_e=function(ne,Ie){this.pdf.internal.out(c(ne)+" "+p(Ie)+" m")},ve=function(ne){var Ie;switch(ne.align){case"right":case"end":Ie="right";break;case"center":Ie="center";break;case"left":case"start":default:Ie="left"}var Re=this.pdf.getTextDimensions(ne.text),We=Ke.call(this,ne.y),nt=Ue.call(this,We)-Re.h,at=this.ctx.transform.applyToPoint(new f(ne.x,We)),pt=this.ctx.transform.decompose(),gt=new M;gt=(gt=(gt=gt.multiply(pt.translate)).multiply(pt.skew)).multiply(pt.scale);for(var Ht,$t,er,nr=this.ctx.transform.applyToRectangle(new s(ne.x,We,Re.w,Re.h)),dr=gt.applyToRectangle(new s(ne.x,nt,Re.w,Re.h)),Et=De.call(this,dr),qe=[],zr=0;zr<Et.length;zr+=1)qe.indexOf(Et[zr])===-1&&qe.push(Et[zr]);if(He(qe),this.autoPaging)for(var yr=qe[0],Xt=qe[qe.length-1],ir=yr;ir<Xt+1;ir++){this.pdf.setPage(ir);var ar=ir===1?this.posY+this.margin[0]:this.margin[0],or=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],xr=this.pdf.internal.pageSize.height-this.margin[2],wr=xr-this.margin[0],Dr=this.pdf.internal.pageSize.width-this.margin[1],Fr=Dr-this.margin[3],Zr=ir===1?0:or+(ir-2)*wr;if(this.ctx.clip_path.length!==0){var Jr=this.path;Ht=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ke(Ht,this.posX+this.margin[3],-1*Zr+ar),Le.call(this,"fill",!0),this.path=Jr}var Mr=ke([JSON.parse(JSON.stringify(dr))],this.posX+this.margin[3],-Zr+ar+this.ctx.prevPageLastElemOffset)[0];ne.scale>=.01&&($t=this.pdf.internal.getFontSize(),this.pdf.setFontSize($t*ne.scale),er=this.lineWidth,this.lineWidth=er*ne.scale);var Rr=this.autoPaging!=="text";if(Rr||Mr.y+Mr.h<=xr){if(Rr||Mr.y>=ar&&Mr.x<=Dr){var ur=Rr?ne.text:this.pdf.splitTextToSize(ne.text,ne.maxWidth||Dr-Mr.x)[0],Wi=ke([JSON.parse(JSON.stringify(nr))],this.posX+this.margin[3],-Zr+ar+this.ctx.prevPageLastElemOffset)[0],Qr=Rr&&(ir>yr||ir<Xt)&&pe.call(this);Qr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Fr,wr,null).clip().discardPath()),this.pdf.text(ur,Wi.x,Wi.y,{angle:ne.angle,align:Ie,renderingMode:ne.renderingMode}),Qr&&this.pdf.restoreGraphicsState()}}else Mr.y<xr&&(this.ctx.prevPageLastElemOffset+=xr-Mr.y);ne.scale>=.01&&(this.pdf.setFontSize($t),this.lineWidth=er)}else ne.scale>=.01&&($t=this.pdf.internal.getFontSize(),this.pdf.setFontSize($t*ne.scale),er=this.lineWidth,this.lineWidth=er*ne.scale),this.pdf.text(ne.text,at.x+this.posX,at.y+this.posY,{angle:ne.angle,align:Ie,renderingMode:ne.renderingMode,maxWidth:ne.maxWidth}),ne.scale>=.01&&(this.pdf.setFontSize($t),this.lineWidth=er)},$e=function(ne,Ie,Re,We){Re=Re||0,We=We||0,this.pdf.internal.out(c(ne+Re)+" "+p(Ie+We)+" l")},Ne=function(ne,Ie,Re){return this.pdf.lines(ne,Ie,Re,null,null)},wt=function(ne,Ie,Re,We,nt,at,pt,gt){this.pdf.internal.out([a(v(Re+ne)),a(y(We+Ie)),a(v(nt+ne)),a(y(at+Ie)),a(v(pt+ne)),a(y(gt+Ie)),"c"].join(" "))},ut=function(ne,Ie,Re,We){for(var nt=2*Math.PI,at=Math.PI/2;Ie>Re;)Ie-=nt;var pt=Math.abs(Re-Ie);pt<nt&&We&&(pt=nt-pt);for(var gt=[],Ht=We?-1:1,$t=Ie;pt>1e-5;){var er=$t+Ht*Math.min(pt,at);gt.push(At.call(this,ne,$t,er)),pt-=Math.abs(er-$t),$t=er}return gt},At=function(ne,Ie,Re){var We=(Re-Ie)/2,nt=ne*Math.cos(We),at=ne*Math.sin(We),pt=nt,gt=-at,Ht=pt*pt+gt*gt,$t=Ht+pt*nt+gt*at,er=4/3*(Math.sqrt(2*Ht*$t)-$t)/(pt*at-gt*nt),nr=pt-er*gt,dr=gt+er*pt,Et=nr,qe=-dr,zr=We+Ie,yr=Math.cos(zr),Xt=Math.sin(zr);return{x1:ne*Math.cos(Ie),y1:ne*Math.sin(Ie),x2:nr*yr-dr*Xt,y2:nr*Xt+dr*yr,x3:Et*yr-qe*Xt,y3:Et*Xt+qe*yr,x4:ne*Math.cos(Re),y4:ne*Math.sin(Re)}},ht=function(ne){return 180*ne/Math.PI},Tt=function(ne,Ie,Re,We,nt,at){var pt=ne+.5*(Re-ne),gt=Ie+.5*(We-Ie),Ht=nt+.5*(Re-nt),$t=at+.5*(We-at),er=Math.min(ne,nt,pt,Ht),nr=Math.max(ne,nt,pt,Ht),dr=Math.min(Ie,at,gt,$t),Et=Math.max(Ie,at,gt,$t);return new s(er,dr,nr-er,Et-dr)},Dt=function(ne,Ie,Re,We,nt,at,pt,gt){var Ht,$t,er,nr,dr,Et,qe,zr,yr,Xt,ir,ar,or,xr,wr=Re-ne,Dr=We-Ie,Fr=nt-Re,Zr=at-We,Jr=pt-nt,Mr=gt-at;for($t=0;$t<41;$t++)yr=(qe=(er=ne+(Ht=$t/40)*wr)+Ht*((dr=Re+Ht*Fr)-er))+Ht*(dr+Ht*(nt+Ht*Jr-dr)-qe),Xt=(zr=(nr=Ie+Ht*Dr)+Ht*((Et=We+Ht*Zr)-nr))+Ht*(Et+Ht*(at+Ht*Mr-Et)-zr),$t==0?(ir=yr,ar=Xt,or=yr,xr=Xt):(ir=Math.min(ir,yr),ar=Math.min(ar,Xt),or=Math.max(or,yr),xr=Math.max(xr,Xt));return new s(Math.round(ir),Math.round(ar),Math.round(or-ir),Math.round(xr-ar))},sr=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var ne,Ie,Re=(ne=this.ctx.lineDash,Ie=this.ctx.lineDashOffset,JSON.stringify({lineDash:ne,lineDashOffset:Ie}));this.prevLineDash!==Re&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Re)}}})(Br.API),function(h){var a=function(y){var f,s,M,B,V,U,J,N,de,pe;for(s=[],M=0,B=(y+=f="\0\0\0\0".slice(y.length%4||4)).length;B>M;M+=4)(V=(y.charCodeAt(M)<<24)+(y.charCodeAt(M+1)<<16)+(y.charCodeAt(M+2)<<8)+y.charCodeAt(M+3))!==0?(U=(V=((V=((V=((V=(V-(pe=V%85))/85)-(de=V%85))/85)-(N=V%85))/85)-(J=V%85))/85)%85,s.push(U+33,J+33,N+33,de+33,pe+33)):s.push(122);return function(De,fe){for(var ke=fe;ke>0;ke--)De.pop()}(s,f.length),String.fromCharCode.apply(String,s)+"~>"},c=function(y){var f,s,M,B,V,U=String,J="length",N=255,de="charCodeAt",pe="slice",De="replace";for(y[pe](-2),y=y[pe](0,-2)[De](/\s/g,"")[De]("z","!!!!!"),M=[],B=0,V=(y+=f="uuuuu"[pe](y[J]%5||5))[J];V>B;B+=5)s=52200625*(y[de](B)-33)+614125*(y[de](B+1)-33)+7225*(y[de](B+2)-33)+85*(y[de](B+3)-33)+(y[de](B+4)-33),M.push(N&s>>24,N&s>>16,N&s>>8,N&s);return function(fe,ke){for(var He=ke;He>0;He--)fe.pop()}(M,f[J]),U.fromCharCode.apply(U,M)},p=function(y){var f=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((y=y.replace(/\s/g,"")).indexOf(">")!==-1&&(y=y.substr(0,y.indexOf(">"))),y.length%2&&(y+="0"),f.test(y)===!1)return"";for(var s="",M=0;M<y.length;M+=2)s+=String.fromCharCode("0x"+(y[M]+y[M+1]));return s},v=function(y){for(var f=new Uint8Array(y.length),s=y.length;s--;)f[s]=y.charCodeAt(s);return y=(f=Cp(f)).reduce(function(M,B){return M+String.fromCharCode(B)},"")};h.processDataByFilters=function(y,f){var s=0,M=y||"",B=[];for(typeof(f=f||[])=="string"&&(f=[f]),s=0;s<f.length;s+=1)switch(f[s]){case"ASCII85Decode":case"/ASCII85Decode":M=c(M),B.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":M=a(M),B.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":M=p(M),B.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":M=M.split("").map(function(V){return("0"+V.charCodeAt().toString(16)).slice(-2)}).join("")+">",B.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":M=v(M),B.push("/FlateDecode");break;default:throw new Error('The filter: "'+f[s]+'" is not implemented')}return{data:M,reverseChain:B.reverse().join(" ")}}}(Br.API),function(h){h.loadFile=function(a,c,p){return function(v,y,f){y=y!==!1,f=typeof f=="function"?f:function(){};var s=void 0;try{s=function(M,B,V){var U=new XMLHttpRequest,J=0,N=function(de){var pe=de.length,De=[],fe=String.fromCharCode;for(J=0;J<pe;J+=1)De.push(fe(255&de.charCodeAt(J)));return De.join("")};if(U.open("GET",M,!B),U.overrideMimeType("text/plain; charset=x-user-defined"),B===!1&&(U.onload=function(){U.status===200?V(N(this.responseText)):V(void 0)}),U.send(null),B&&U.status===200)return N(U.responseText)}(v,y,f)}catch{}return s}(a,c,p)},h.loadImageFile=h.loadFile}(Br.API),function(h){function a(){return(Ur.html2canvas?Promise.resolve(Ur.html2canvas):Pp(()=>import("./html2canvas.esm-DgdJBc_o-tnAx6l3B.js"),[])).catch(function(f){return Promise.reject(new Error("Could not load html2canvas: "+f))}).then(function(f){return f.default?f.default:f})}function c(){return(Ur.DOMPurify?Promise.resolve(Ur.DOMPurify):Pp(()=>import("./purify.es-BGDLgQxM-CrAUe_or.js"),[])).catch(function(f){return Promise.reject(new Error("Could not load dompurify: "+f))}).then(function(f){return f.default?f.default:f})}var p=function(f){var s=Ri(f);return s==="undefined"?"undefined":s==="string"||f instanceof String?"string":s==="number"||f instanceof Number?"number":s==="function"||f instanceof Function?"function":f&&f.constructor===Array?"array":f&&f.nodeType===1?"element":s==="object"?"object":"unknown"},v=function(f,s){var M=document.createElement(f);for(var B in s.className&&(M.className=s.className),s.innerHTML&&s.dompurify&&(M.innerHTML=s.dompurify.sanitize(s.innerHTML)),s.style)M.style[B]=s.style[B];return M},y=function f(s){var M=Object.assign(f.convert(Promise.resolve()),JSON.parse(JSON.stringify(f.template))),B=f.convert(Promise.resolve(),M);return B=(B=B.setProgress(1,f,1,[f])).set(s)};(y.prototype=Object.create(Promise.prototype)).constructor=y,y.convert=function(f,s){return f.__proto__=s||y.prototype,f},y.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},y.prototype.from=function(f,s){return this.then(function(){switch(s=s||function(M){switch(p(M)){case"string":return"string";case"element":return M.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(f)){case"string":return this.then(c).then(function(M){return this.set({src:v("div",{innerHTML:f,dompurify:M})})});case"element":return this.set({src:f});case"canvas":return this.set({canvas:f});case"img":return this.set({img:f});default:return this.error("Unknown source type.")}})},y.prototype.to=function(f){switch(f){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},y.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var f={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},s=function M(B,V){for(var U=B.nodeType===3?document.createTextNode(B.nodeValue):B.cloneNode(!1),J=B.firstChild;J;J=J.nextSibling)V!==!0&&J.nodeType===1&&J.nodeName==="SCRIPT"||U.appendChild(M(J,V));return B.nodeType===1&&(B.nodeName==="CANVAS"?(U.width=B.width,U.height=B.height,U.getContext("2d").drawImage(B,0,0)):B.nodeName!=="TEXTAREA"&&B.nodeName!=="SELECT"||(U.value=B.value),U.addEventListener("load",function(){U.scrollTop=B.scrollTop,U.scrollLeft=B.scrollLeft},!0)),U}(this.prop.src,this.opt.html2canvas.javascriptEnabled);s.tagName==="BODY"&&(f.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=v("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=v("div",{className:"html2pdf__container",style:f}),this.prop.container.appendChild(s),this.prop.container.firstChild.appendChild(v("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},y.prototype.toCanvas=function(){var f=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(f).then(a).then(function(s){var M=Object.assign({},this.opt.html2canvas);return delete M.onrendered,s(this.prop.container,M)}).then(function(s){(this.opt.html2canvas.onrendered||function(){})(s),this.prop.canvas=s,document.body.removeChild(this.prop.overlay)})},y.prototype.toContext2d=function(){var f=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(f).then(a).then(function(s){var M=this.opt.jsPDF,B=this.opt.fontFaces,V=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,U=Object.assign({async:!0,allowTaint:!0,scale:V,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete U.onrendered,M.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,M.context2d.posX=this.opt.x,M.context2d.posY=this.opt.y,M.context2d.margin=this.opt.margin,M.context2d.fontFaces=B,B)for(var J=0;J<B.length;++J){var N=B[J],de=N.src.find(function(pe){return pe.format==="truetype"});de&&M.addFont(de.url,N.ref.name,N.ref.style)}return U.windowHeight=U.windowHeight||0,U.windowHeight=U.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):U.windowHeight,M.context2d.save(!0),s(this.prop.container,U)}).then(function(s){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(s),this.prop.canvas=s,document.body.removeChild(this.prop.overlay)})},y.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var f=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=f})},y.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},y.prototype.output=function(f,s,M){return(M=M||"pdf").toLowerCase()==="img"||M.toLowerCase()==="image"?this.outputImg(f,s):this.outputPdf(f,s)},y.prototype.outputPdf=function(f,s){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(f,s)})},y.prototype.outputImg=function(f){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(f){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+f+'" is not supported.'}})},y.prototype.save=function(f){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(f?{filename:f}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},y.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},y.prototype.set=function(f){if(p(f)!=="object")return this;var s=Object.keys(f||{}).map(function(M){if(M in y.template.prop)return function(){this.prop[M]=f[M]};switch(M){case"margin":return this.setMargin.bind(this,f.margin);case"jsPDF":return function(){return this.opt.jsPDF=f.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,f.pageSize);default:return function(){this.opt[M]=f[M]}}},this);return this.then(function(){return this.thenList(s)})},y.prototype.get=function(f,s){return this.then(function(){var M=f in y.template.prop?this.prop[f]:this.opt[f];return s?s(M):M})},y.prototype.setMargin=function(f){return this.then(function(){switch(p(f)){case"number":f=[f,f,f,f];case"array":if(f.length===2&&(f=[f[0],f[1],f[0],f[1]]),f.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=f}).then(this.setPageSize)},y.prototype.setPageSize=function(f){function s(M,B){return Math.floor(M*B/72*96)}return this.then(function(){(f=f||Br.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(f.inner={width:f.width-this.opt.margin[1]-this.opt.margin[3],height:f.height-this.opt.margin[0]-this.opt.margin[2]},f.inner.px={width:s(f.inner.width,f.k),height:s(f.inner.height,f.k)},f.inner.ratio=f.inner.height/f.inner.width),this.prop.pageSize=f})},y.prototype.setProgress=function(f,s,M,B){return f!=null&&(this.progress.val=f),s!=null&&(this.progress.state=s),M!=null&&(this.progress.n=M),B!=null&&(this.progress.stack=B),this.progress.ratio=this.progress.val/this.progress.state,this},y.prototype.updateProgress=function(f,s,M,B){return this.setProgress(f?this.progress.val+f:null,s||null,M?this.progress.n+M:null,B?this.progress.stack.concat(B):null)},y.prototype.then=function(f,s){var M=this;return this.thenCore(f,s,function(B,V){return M.updateProgress(null,null,1,[B]),Promise.prototype.then.call(this,function(U){return M.updateProgress(null,B),U}).then(B,V).then(function(U){return M.updateProgress(1),U})})},y.prototype.thenCore=function(f,s,M){M=M||Promise.prototype.then,f&&(f=f.bind(this)),s&&(s=s.bind(this));var B=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:y.convert(Object.assign({},this),Promise.prototype),V=M.call(B,f,s);return y.convert(V,this.__proto__)},y.prototype.thenExternal=function(f,s){return Promise.prototype.then.call(this,f,s)},y.prototype.thenList=function(f){var s=this;return f.forEach(function(M){s=s.thenCore(M)}),s},y.prototype.catch=function(f){f&&(f=f.bind(this));var s=Promise.prototype.catch.call(this,f);return y.convert(s,this)},y.prototype.catchExternal=function(f){return Promise.prototype.catch.call(this,f)},y.prototype.error=function(f){return this.then(function(){throw new Error(f)})},y.prototype.using=y.prototype.set,y.prototype.saveAs=y.prototype.save,y.prototype.export=y.prototype.output,y.prototype.run=y.prototype.then,Br.getPageSize=function(f,s,M){if(Ri(f)==="object"){var B=f;f=B.orientation,s=B.unit||s,M=B.format||M}s=s||"mm",M=M||"a4",f=(""+(f||"P")).toLowerCase();var V,U=(""+M).toLowerCase(),J={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(s){case"pt":V=1;break;case"mm":V=72/25.4;break;case"cm":V=72/2.54;break;case"in":V=72;break;case"px":V=.75;break;case"pc":case"em":V=12;break;case"ex":V=6;break;default:throw"Invalid unit: "+s}var N,de=0,pe=0;if(J.hasOwnProperty(U))de=J[U][1]/V,pe=J[U][0]/V;else try{de=M[1],pe=M[0]}catch{throw new Error("Invalid format: "+M)}if(f==="p"||f==="portrait")f="p",pe>de&&(N=pe,pe=de,de=N);else{if(f!=="l"&&f!=="landscape")throw"Invalid orientation: "+f;f="l",de>pe&&(N=pe,pe=de,de=N)}return{width:pe,height:de,unit:s,k:V,orientation:f}},h.html=function(f,s){(s=s||{}).callback=s.callback||function(){},s.html2canvas=s.html2canvas||{},s.html2canvas.canvas=s.html2canvas.canvas||this.canvas,s.jsPDF=s.jsPDF||this,s.fontFaces=s.fontFaces?s.fontFaces.map(Dp):null;var M=new y(s);return s.worker?M:M.from(f).doCallback()}}(Br.API),Br.API.addJS=function(h){return Pg=h,this.internal.events.subscribe("postPutResources",function(){Uh=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Uh+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),wg=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+Pg+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Uh!==void 0&&wg!==void 0&&this.internal.out("/Names <</JavaScript "+Uh+" 0 R>>")}),this},function(h){var a;h.events.push(["postPutResources",function(){var c=this,p=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var v=c.outline.render().split(/\r\n/),y=0;y<v.length;y++){var f=v[y],s=p.exec(f);if(s!=null){var M=s[1];c.internal.newObjectDeferredBegin(M,!1)}c.internal.write(f)}if(this.outline.createNamedDestinations){var B=this.internal.pages.length,V=[];for(y=0;y<B;y++){var U=c.internal.newObject();V.push(U);var J=c.internal.getPageInfo(y+1);c.internal.write("<< /D["+J.objId+" 0 R /XYZ null null null]>> endobj")}var N=c.internal.newObject();for(c.internal.write("<< /Names [ "),y=0;y<V.length;y++)c.internal.write("(page_"+(y+1)+")"+V[y]+" 0 R");c.internal.write(" ] >>","endobj"),a=c.internal.newObject(),c.internal.write("<< /Dests "+N+" 0 R"),c.internal.write(">>","endobj")}}]),h.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+a+" 0 R"))}]),h.events.push(["initialized",function(){var c=this;c.outline={createNamedDestinations:!1,root:{children:[]}},c.outline.add=function(p,v,y){var f={title:v,options:y,children:[]};return p==null&&(p=this.root),p.children.push(f),f},c.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=c,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},c.outline.genIds_r=function(p){p.id=c.internal.newObjectDeferred();for(var v=0;v<p.children.length;v++)this.genIds_r(p.children[v])},c.outline.renderRoot=function(p){this.objStart(p),this.line("/Type /Outlines"),p.children.length>0&&(this.line("/First "+this.makeRef(p.children[0])),this.line("/Last "+this.makeRef(p.children[p.children.length-1]))),this.line("/Count "+this.count_r({count:0},p)),this.objEnd()},c.outline.renderItems=function(p){for(var v=this.ctx.pdf.internal.getVerticalCoordinateString,y=0;y<p.children.length;y++){var f=p.children[y];this.objStart(f),this.line("/Title "+this.makeString(f.title)),this.line("/Parent "+this.makeRef(p)),y>0&&this.line("/Prev "+this.makeRef(p.children[y-1])),y<p.children.length-1&&this.line("/Next "+this.makeRef(p.children[y+1])),f.children.length>0&&(this.line("/First "+this.makeRef(f.children[0])),this.line("/Last "+this.makeRef(f.children[f.children.length-1])));var s=this.count=this.count_r({count:0},f);if(s>0&&this.line("/Count "+s),f.options&&f.options.pageNumber){var M=c.internal.getPageInfo(f.options.pageNumber);this.line("/Dest ["+M.objId+" 0 R /XYZ 0 "+v(0)+" 0]")}this.objEnd()}for(var B=0;B<p.children.length;B++)this.renderItems(p.children[B])},c.outline.line=function(p){this.ctx.val+=p+`\r
`},c.outline.makeRef=function(p){return p.id+" 0 R"},c.outline.makeString=function(p){return"("+c.internal.pdfEscape(p)+")"},c.outline.objStart=function(p){this.ctx.val+=`\r
`+p.id+` 0 obj\r
<<\r
`},c.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},c.outline.count_r=function(p,v){for(var y=0;y<v.children.length;y++)p.count++,this.count_r(p,v.children[y]);return p.count}}])}(Br.API),function(h){var a=[192,193,194,195,196,197,198,199];h.processJPEG=function(c,p,v,y,f,s){var M,B=this.decode.DCT_DECODE,V=null;if(typeof c=="string"||this.__addimage__.isArrayBuffer(c)||this.__addimage__.isArrayBufferView(c)){switch(c=f||c,c=this.__addimage__.isArrayBuffer(c)?new Uint8Array(c):c,(M=function(U){for(var J,N=256*U.charCodeAt(4)+U.charCodeAt(5),de=U.length,pe={width:0,height:0,numcomponents:1},De=4;De<de;De+=2){if(De+=N,a.indexOf(U.charCodeAt(De+1))!==-1){J=256*U.charCodeAt(De+5)+U.charCodeAt(De+6),pe={width:256*U.charCodeAt(De+7)+U.charCodeAt(De+8),height:J,numcomponents:U.charCodeAt(De+9)};break}N=256*U.charCodeAt(De+2)+U.charCodeAt(De+3)}return pe}(c=this.__addimage__.isArrayBufferView(c)?this.__addimage__.arrayBufferToBinaryString(c):c)).numcomponents){case 1:s=this.color_spaces.DEVICE_GRAY;break;case 4:s=this.color_spaces.DEVICE_CMYK;break;case 3:s=this.color_spaces.DEVICE_RGB}V={data:c,width:M.width,height:M.height,colorSpace:s,bitsPerComponent:8,filter:B,index:p,alias:v}}return V}}(Br.API);var gu,Zh,Ag,Tg,Ig,qv=function(){var h,a,c;function p(y){var f,s,M,B,V,U,J,N,de,pe,De,fe,ke,He;for(this.data=y,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},U=null;;){switch(f=this.readUInt32(),de=(function(){var Oe,Le;for(Le=[],Oe=0;Oe<4;++Oe)Le.push(String.fromCharCode(this.data[this.pos++]));return Le}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(f);break;case"fcTL":U&&this.animation.frames.push(U),this.pos+=4,U={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},V=this.readUInt16(),B=this.readUInt16()||100,U.delay=1e3*V/B,U.disposeOp=this.data[this.pos++],U.blendOp=this.data[this.pos++],U.data=[];break;case"IDAT":case"fdAT":for(de==="fdAT"&&(this.pos+=4,f-=4),y=(U!=null?U.data:void 0)||this.imgData,fe=0;0<=f?fe<f:fe>f;0<=f?++fe:--fe)y.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(M=this.palette.length/3,this.transparency.indexed=this.read(f),this.transparency.indexed.length>M)throw new Error("More transparent colors than palette size");if((pe=M-this.transparency.indexed.length)>0)for(ke=0;0<=pe?ke<pe:ke>pe;0<=pe?++ke:--ke)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(f)[0];break;case 2:this.transparency.rgb=this.read(f)}break;case"tEXt":J=(De=this.read(f)).indexOf(0),N=String.fromCharCode.apply(String,De.slice(0,J)),this.text[N]=String.fromCharCode.apply(String,De.slice(J+1));break;case"IEND":return U&&this.animation.frames.push(U),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(He=this.colorType)===4||He===6,s=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*s,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=f}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}p.prototype.read=function(y){var f,s;for(s=[],f=0;0<=y?f<y:f>y;0<=y?++f:--f)s.push(this.data[this.pos++]);return s},p.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},p.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},p.prototype.decodePixels=function(y){var f=this.pixelBitlength/8,s=new Uint8Array(this.width*this.height*f),M=0,B=this;if(y==null&&(y=this.imgData),y.length===0)return new Uint8Array(0);function V(U,J,N,de){var pe,De,fe,ke,He,Oe,Le,Ke,Ue,Ae,lt,mt,_e,ve,$e,Ne,wt,ut,At,ht,Tt,Dt=Math.ceil((B.width-U)/N),sr=Math.ceil((B.height-J)/de),ne=B.width==Dt&&B.height==sr;for(ve=f*Dt,mt=ne?s:new Uint8Array(ve*sr),Oe=y.length,_e=0,De=0;_e<sr&&M<Oe;){switch(y[M++]){case 0:for(ke=wt=0;wt<ve;ke=wt+=1)mt[De++]=y[M++];break;case 1:for(ke=ut=0;ut<ve;ke=ut+=1)pe=y[M++],He=ke<f?0:mt[De-f],mt[De++]=(pe+He)%256;break;case 2:for(ke=At=0;At<ve;ke=At+=1)pe=y[M++],fe=(ke-ke%f)/f,$e=_e&&mt[(_e-1)*ve+fe*f+ke%f],mt[De++]=($e+pe)%256;break;case 3:for(ke=ht=0;ht<ve;ke=ht+=1)pe=y[M++],fe=(ke-ke%f)/f,He=ke<f?0:mt[De-f],$e=_e&&mt[(_e-1)*ve+fe*f+ke%f],mt[De++]=(pe+Math.floor((He+$e)/2))%256;break;case 4:for(ke=Tt=0;Tt<ve;ke=Tt+=1)pe=y[M++],fe=(ke-ke%f)/f,He=ke<f?0:mt[De-f],_e===0?$e=Ne=0:($e=mt[(_e-1)*ve+fe*f+ke%f],Ne=fe&&mt[(_e-1)*ve+(fe-1)*f+ke%f]),Le=He+$e-Ne,Ke=Math.abs(Le-He),Ae=Math.abs(Le-$e),lt=Math.abs(Le-Ne),Ue=Ke<=Ae&&Ke<=lt?He:Ae<=lt?$e:Ne,mt[De++]=(pe+Ue)%256;break;default:throw new Error("Invalid filter algorithm: "+y[M-1])}if(!ne){var Ie=((J+_e*de)*B.width+U)*f,Re=_e*ve;for(ke=0;ke<Dt;ke+=1){for(var We=0;We<f;We+=1)s[Ie++]=mt[Re++];Ie+=(N-1)*f}}_e++}}return y=vv(y),B.interlaceMethod==1?(V(0,0,8,8),V(4,0,8,8),V(0,4,4,8),V(2,0,4,4),V(0,2,2,4),V(1,0,2,2),V(0,1,1,2)):V(0,0,1,1),s},p.prototype.decodePalette=function(){var y,f,s,M,B,V,U,J,N;for(s=this.palette,V=this.transparency.indexed||[],B=new Uint8Array((V.length||0)+s.length),M=0,y=0,f=U=0,J=s.length;U<J;f=U+=3)B[M++]=s[f],B[M++]=s[f+1],B[M++]=s[f+2],B[M++]=(N=V[y++])!=null?N:255;return B},p.prototype.copyToImageData=function(y,f){var s,M,B,V,U,J,N,de,pe,De,fe;if(M=this.colors,pe=null,s=this.hasAlphaChannel,this.palette.length&&(pe=(fe=this._decodedPalette)!=null?fe:this._decodedPalette=this.decodePalette(),M=4,s=!0),de=(B=y.data||y).length,U=pe||f,V=J=0,M===1)for(;V<de;)N=pe?4*f[V/4]:J,De=U[N++],B[V++]=De,B[V++]=De,B[V++]=De,B[V++]=s?U[N++]:255,J=N;else for(;V<de;)N=pe?4*f[V/4]:J,B[V++]=U[N++],B[V++]=U[N++],B[V++]=U[N++],B[V++]=s?U[N++]:255,J=N},p.prototype.decode=function(){var y;return y=new Uint8Array(this.width*this.height*4),this.copyToImageData(y,this.decodePixels()),y};var v=function(){if(Object.prototype.toString.call(Ur)==="[object Window]"){try{a=Ur.document.createElement("canvas"),c=a.getContext("2d")}catch{return!1}return!0}return!1};return v(),h=function(y){var f;if(v()===!0)return c.width=y.width,c.height=y.height,c.clearRect(0,0,y.width,y.height),c.putImageData(y,0,0),(f=new Image).src=a.toDataURL(),f;throw new Error("This method requires a Browser with Canvas-capability.")},p.prototype.decodeFrames=function(y){var f,s,M,B,V,U,J,N;if(this.animation){for(N=[],s=V=0,U=(J=this.animation.frames).length;V<U;s=++V)f=J[s],M=y.createImageData(f.width,f.height),B=this.decodePixels(new Uint8Array(f.data)),this.copyToImageData(M,B),f.imageData=M,N.push(f.image=h(M));return N}},p.prototype.renderFrame=function(y,f){var s,M,B;return s=(M=this.animation.frames)[f],B=M[f-1],f===0&&y.clearRect(0,0,this.width,this.height),(B!=null?B.disposeOp:void 0)===1?y.clearRect(B.xOffset,B.yOffset,B.width,B.height):(B!=null?B.disposeOp:void 0)===2&&y.putImageData(B.imageData,B.xOffset,B.yOffset),s.blendOp===0&&y.clearRect(s.xOffset,s.yOffset,s.width,s.height),y.drawImage(s.image,s.xOffset,s.yOffset)},p.prototype.animate=function(y){var f,s,M,B,V,U,J=this;return s=0,U=this.animation,B=U.numFrames,M=U.frames,V=U.numPlays,(f=function(){var N,de;if(N=s++%B,de=M[N],J.renderFrame(y,N),B>1&&s/B<V)return J.animation._timeout=setTimeout(f,de.delay)})()},p.prototype.stopAnimation=function(){var y;return clearTimeout((y=this.animation)!=null?y._timeout:void 0)},p.prototype.render=function(y){var f,s;return y._png&&y._png.stopAnimation(),y._png=this,y.width=this.width,y.height=this.height,f=y.getContext("2d"),this.animation?(this.decodeFrames(f),this.animate(f)):(s=f.createImageData(this.width,this.height),this.copyToImageData(s,this.decodePixels()),f.putImageData(s,0,0))},p}();/**
 * @license
 *
 * Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 *//**
 * @license
 * (c) Dean McNamee <dean@gmail.com>, 2013.
 *
 * https://github.com/deanm/omggif
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *
 * omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
 * including animation and compression.  It does not rely on any specific
 * underlying system, so should run in the browser, Node, or Plask.
 */function Vv(h){var a=0;if(h[a++]!==71||h[a++]!==73||h[a++]!==70||h[a++]!==56||(h[a++]+1&253)!=56||h[a++]!==97)throw new Error("Invalid GIF 87a/89a header.");var c=h[a++]|h[a++]<<8,p=h[a++]|h[a++]<<8,v=h[a++],y=v>>7,f=1<<(7&v)+1;h[a++],h[a++];var s=null,M=null;y&&(s=a,M=f,a+=3*f);var B=!0,V=[],U=0,J=null,N=0,de=null;for(this.width=c,this.height=p;B&&a<h.length;)switch(h[a++]){case 33:switch(h[a++]){case 255:if(h[a]!==11||h[a+1]==78&&h[a+2]==69&&h[a+3]==84&&h[a+4]==83&&h[a+5]==67&&h[a+6]==65&&h[a+7]==80&&h[a+8]==69&&h[a+9]==50&&h[a+10]==46&&h[a+11]==48&&h[a+12]==3&&h[a+13]==1&&h[a+16]==0)a+=14,de=h[a++]|h[a++]<<8,a++;else for(a+=12;;){if(!((_e=h[a++])>=0))throw Error("Invalid block size");if(_e===0)break;a+=_e}break;case 249:if(h[a++]!==4||h[a+4]!==0)throw new Error("Invalid graphics extension block.");var pe=h[a++];U=h[a++]|h[a++]<<8,J=h[a++],(1&pe)==0&&(J=null),N=pe>>2&7,a++;break;case 254:for(;;){if(!((_e=h[a++])>=0))throw Error("Invalid block size");if(_e===0)break;a+=_e}break;default:throw new Error("Unknown graphic control label: 0x"+h[a-1].toString(16))}break;case 44:var De=h[a++]|h[a++]<<8,fe=h[a++]|h[a++]<<8,ke=h[a++]|h[a++]<<8,He=h[a++]|h[a++]<<8,Oe=h[a++],Le=Oe>>6&1,Ke=1<<(7&Oe)+1,Ue=s,Ae=M,lt=!1;Oe>>7&&(lt=!0,Ue=a,Ae=Ke,a+=3*Ke);var mt=a;for(a++;;){var _e;if(!((_e=h[a++])>=0))throw Error("Invalid block size");if(_e===0)break;a+=_e}V.push({x:De,y:fe,width:ke,height:He,has_local_palette:lt,palette_offset:Ue,palette_size:Ae,data_offset:mt,data_length:a-mt,transparent_index:J,interlaced:!!Le,delay:U,disposal:N});break;case 59:B=!1;break;default:throw new Error("Unknown gif block: 0x"+h[a-1].toString(16))}this.numFrames=function(){return V.length},this.loopCount=function(){return de},this.frameInfo=function(ve){if(ve<0||ve>=V.length)throw new Error("Frame index out of range.");return V[ve]},this.decodeAndBlitFrameBGRA=function(ve,$e){var Ne=this.frameInfo(ve),wt=Ne.width*Ne.height,ut=new Uint8Array(wt);Cg(h,Ne.data_offset,ut,wt);var At=Ne.palette_offset,ht=Ne.transparent_index;ht===null&&(ht=256);var Tt=Ne.width,Dt=c-Tt,sr=Tt,ne=4*(Ne.y*c+Ne.x),Ie=4*((Ne.y+Ne.height)*c+Ne.x),Re=ne,We=4*Dt;Ne.interlaced===!0&&(We+=4*c*7);for(var nt=8,at=0,pt=ut.length;at<pt;++at){var gt=ut[at];if(sr===0&&(sr=Tt,(Re+=We)>=Ie&&(We=4*Dt+4*c*(nt-1),Re=ne+(Tt+Dt)*(nt<<1),nt>>=1)),gt===ht)Re+=4;else{var Ht=h[At+3*gt],$t=h[At+3*gt+1],er=h[At+3*gt+2];$e[Re++]=er,$e[Re++]=$t,$e[Re++]=Ht,$e[Re++]=255}--sr}},this.decodeAndBlitFrameRGBA=function(ve,$e){var Ne=this.frameInfo(ve),wt=Ne.width*Ne.height,ut=new Uint8Array(wt);Cg(h,Ne.data_offset,ut,wt);var At=Ne.palette_offset,ht=Ne.transparent_index;ht===null&&(ht=256);var Tt=Ne.width,Dt=c-Tt,sr=Tt,ne=4*(Ne.y*c+Ne.x),Ie=4*((Ne.y+Ne.height)*c+Ne.x),Re=ne,We=4*Dt;Ne.interlaced===!0&&(We+=4*c*7);for(var nt=8,at=0,pt=ut.length;at<pt;++at){var gt=ut[at];if(sr===0&&(sr=Tt,(Re+=We)>=Ie&&(We=4*Dt+4*c*(nt-1),Re=ne+(Tt+Dt)*(nt<<1),nt>>=1)),gt===ht)Re+=4;else{var Ht=h[At+3*gt],$t=h[At+3*gt+1],er=h[At+3*gt+2];$e[Re++]=Ht,$e[Re++]=$t,$e[Re++]=er,$e[Re++]=255}--sr}}}function Cg(h,a,c,p){for(var v=h[a++],y=1<<v,f=y+1,s=f+1,M=v+1,B=(1<<M)-1,V=0,U=0,J=0,N=h[a++],de=new Int32Array(4096),pe=null;;){for(;V<16&&N!==0;)U|=h[a++]<<V,V+=8,N===1?N=h[a++]:--N;if(V<M)break;var De=U&B;if(U>>=M,V-=M,De!==y){if(De===f)break;for(var fe=De<s?De:pe,ke=0,He=fe;He>y;)He=de[He]>>8,++ke;var Oe=He;if(J+ke+(fe!==De?1:0)>p)return void Yi.log("Warning, gif stream longer than expected.");c[J++]=Oe;var Le=J+=ke;for(fe!==De&&(c[J++]=Oe),He=fe;ke--;)He=de[He],c[--Le]=255&He,He>>=8;pe!==null&&s<4096&&(de[s++]=pe<<8|Oe,s>=B+1&&M<12&&(++M,B=B<<1|1)),pe=De}else s=f+1,B=(1<<(M=v+1))-1,pe=null}return J!==p&&Yi.log("Warning, gif stream shorter than expected."),c}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function gp(h){var a,c,p,v,y,f=Math.floor,s=new Array(64),M=new Array(64),B=new Array(64),V=new Array(64),U=new Array(65535),J=new Array(65535),N=new Array(64),de=new Array(64),pe=[],De=0,fe=7,ke=new Array(64),He=new Array(64),Oe=new Array(64),Le=new Array(256),Ke=new Array(2048),Ue=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],Ae=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],lt=[0,1,2,3,4,5,6,7,8,9,10,11],mt=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],_e=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],ve=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],$e=[0,1,2,3,4,5,6,7,8,9,10,11],Ne=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],wt=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function ut(ne,Ie){for(var Re=0,We=0,nt=new Array,at=1;at<=16;at++){for(var pt=1;pt<=ne[at];pt++)nt[Ie[We]]=[],nt[Ie[We]][0]=Re,nt[Ie[We]][1]=at,We++,Re++;Re*=2}return nt}function At(ne){for(var Ie=ne[0],Re=ne[1]-1;Re>=0;)Ie&1<<Re&&(De|=1<<fe),Re--,--fe<0&&(De==255?(ht(255),ht(0)):ht(De),fe=7,De=0)}function ht(ne){pe.push(ne)}function Tt(ne){ht(ne>>8&255),ht(255&ne)}function Dt(ne,Ie,Re,We,nt){for(var at,pt=nt[0],gt=nt[240],Ht=function(Xt,ir){var ar,or,xr,wr,Dr,Fr,Zr,Jr,Mr,Rr,ur=0;for(Mr=0;Mr<8;++Mr){ar=Xt[ur],or=Xt[ur+1],xr=Xt[ur+2],wr=Xt[ur+3],Dr=Xt[ur+4],Fr=Xt[ur+5],Zr=Xt[ur+6];var Wi=ar+(Jr=Xt[ur+7]),Qr=ar-Jr,Bi=or+Zr,K=or-Zr,x=xr+Fr,A=xr-Fr,O=wr+Dr,G=wr-Dr,Q=Wi+O,le=Wi-O,Te=Bi+x,ue=Bi-x;Xt[ur]=Q+Te,Xt[ur+4]=Q-Te;var xe=.707106781*(ue+le);Xt[ur+2]=le+xe,Xt[ur+6]=le-xe;var we=.382683433*((Q=G+A)-(ue=K+Qr)),ze=.5411961*Q+we,Qe=1.306562965*ue+we,je=.707106781*(Te=A+K),ft=Qr+je,Pt=Qr-je;Xt[ur+5]=Pt+ze,Xt[ur+3]=Pt-ze,Xt[ur+1]=ft+Qe,Xt[ur+7]=ft-Qe,ur+=8}for(ur=0,Mr=0;Mr<8;++Mr){ar=Xt[ur],or=Xt[ur+8],xr=Xt[ur+16],wr=Xt[ur+24],Dr=Xt[ur+32],Fr=Xt[ur+40],Zr=Xt[ur+48];var rr=ar+(Jr=Xt[ur+56]),lr=ar-Jr,yt=or+Zr,Zt=or-Zr,Qt=xr+Fr,Pr=xr-Fr,Sr=wr+Dr,Ir=wr-Dr,pr=rr+Sr,en=rr-Sr,di=yt+Qt,yi=yt-Qt;Xt[ur]=pr+di,Xt[ur+32]=pr-di;var ri=.707106781*(yi+en);Xt[ur+16]=en+ri,Xt[ur+48]=en-ri;var xs=.382683433*((pr=Ir+Pr)-(yi=Zt+lr)),cn=.5411961*pr+xs,ci=1.306562965*yi+xs,wo=.707106781*(di=Pr+Zt),fa=lr+wo,ro=lr-wo;Xt[ur+40]=ro+cn,Xt[ur+24]=ro-cn,Xt[ur+8]=fa+ci,Xt[ur+56]=fa-ci,ur++}for(Mr=0;Mr<64;++Mr)Rr=Xt[Mr]*ir[Mr],N[Mr]=Rr>0?Rr+.5|0:Rr-.5|0;return N}(ne,Ie),$t=0;$t<64;++$t)de[Ue[$t]]=Ht[$t];var er=de[0]-Re;Re=de[0],er==0?At(We[0]):(At(We[J[at=32767+er]]),At(U[at]));for(var nr=63;nr>0&&de[nr]==0;)nr--;if(nr==0)return At(pt),Re;for(var dr,Et=1;Et<=nr;){for(var qe=Et;de[Et]==0&&Et<=nr;)++Et;var zr=Et-qe;if(zr>=16){dr=zr>>4;for(var yr=1;yr<=dr;++yr)At(gt);zr&=15}at=32767+de[Et],At(nt[(zr<<4)+J[at]]),At(U[at]),Et++}return nr!=63&&At(pt),Re}function sr(ne){ne=Math.min(Math.max(ne,1),100),y!=ne&&(function(Ie){for(var Re=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],We=0;We<64;We++){var nt=f((Re[We]*Ie+50)/100);nt=Math.min(Math.max(nt,1),255),s[Ue[We]]=nt}for(var at=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],pt=0;pt<64;pt++){var gt=f((at[pt]*Ie+50)/100);gt=Math.min(Math.max(gt,1),255),M[Ue[pt]]=gt}for(var Ht=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],$t=0,er=0;er<8;er++)for(var nr=0;nr<8;nr++)B[$t]=1/(s[Ue[$t]]*Ht[er]*Ht[nr]*8),V[$t]=1/(M[Ue[$t]]*Ht[er]*Ht[nr]*8),$t++}(ne<50?Math.floor(5e3/ne):Math.floor(200-2*ne)),y=ne)}this.encode=function(ne,Ie){Ie&&sr(Ie),pe=new Array,De=0,fe=7,Tt(65496),Tt(65504),Tt(16),ht(74),ht(70),ht(73),ht(70),ht(0),ht(1),ht(1),ht(0),Tt(1),Tt(1),ht(0),ht(0),function(){Tt(65499),Tt(132),ht(0);for(var or=0;or<64;or++)ht(s[or]);ht(1);for(var xr=0;xr<64;xr++)ht(M[xr])}(),function(or,xr){Tt(65472),Tt(17),ht(8),Tt(xr),Tt(or),ht(3),ht(1),ht(17),ht(0),ht(2),ht(17),ht(1),ht(3),ht(17),ht(1)}(ne.width,ne.height),function(){Tt(65476),Tt(418),ht(0);for(var or=0;or<16;or++)ht(Ae[or+1]);for(var xr=0;xr<=11;xr++)ht(lt[xr]);ht(16);for(var wr=0;wr<16;wr++)ht(mt[wr+1]);for(var Dr=0;Dr<=161;Dr++)ht(_e[Dr]);ht(1);for(var Fr=0;Fr<16;Fr++)ht(ve[Fr+1]);for(var Zr=0;Zr<=11;Zr++)ht($e[Zr]);ht(17);for(var Jr=0;Jr<16;Jr++)ht(Ne[Jr+1]);for(var Mr=0;Mr<=161;Mr++)ht(wt[Mr])}(),Tt(65498),Tt(12),ht(3),ht(1),ht(0),ht(2),ht(17),ht(3),ht(17),ht(0),ht(63),ht(0);var Re=0,We=0,nt=0;De=0,fe=7,this.encode.displayName="_encode_";for(var at,pt,gt,Ht,$t,er,nr,dr,Et,qe=ne.data,zr=ne.width,yr=ne.height,Xt=4*zr,ir=0;ir<yr;){for(at=0;at<Xt;){for($t=Xt*ir+at,nr=-1,dr=0,Et=0;Et<64;Et++)er=$t+(dr=Et>>3)*Xt+(nr=4*(7&Et)),ir+dr>=yr&&(er-=Xt*(ir+1+dr-yr)),at+nr>=Xt&&(er-=at+nr-Xt+4),pt=qe[er++],gt=qe[er++],Ht=qe[er++],ke[Et]=(Ke[pt]+Ke[gt+256>>0]+Ke[Ht+512>>0]>>16)-128,He[Et]=(Ke[pt+768>>0]+Ke[gt+1024>>0]+Ke[Ht+1280>>0]>>16)-128,Oe[Et]=(Ke[pt+1280>>0]+Ke[gt+1536>>0]+Ke[Ht+1792>>0]>>16)-128;Re=Dt(ke,B,Re,a,p),We=Dt(He,V,We,c,v),nt=Dt(Oe,V,nt,c,v),at+=32}ir+=8}if(fe>=0){var ar=[];ar[1]=fe+1,ar[0]=(1<<fe+1)-1,At(ar)}return Tt(65497),new Uint8Array(pe)},h=h||50,function(){for(var ne=String.fromCharCode,Ie=0;Ie<256;Ie++)Le[Ie]=ne(Ie)}(),a=ut(Ae,lt),c=ut(ve,$e),p=ut(mt,_e),v=ut(Ne,wt),function(){for(var ne=1,Ie=2,Re=1;Re<=15;Re++){for(var We=ne;We<Ie;We++)J[32767+We]=Re,U[32767+We]=[],U[32767+We][1]=Re,U[32767+We][0]=We;for(var nt=-(Ie-1);nt<=-ne;nt++)J[32767+nt]=Re,U[32767+nt]=[],U[32767+nt][1]=Re,U[32767+nt][0]=Ie-1+nt;ne<<=1,Ie<<=1}}(),function(){for(var ne=0;ne<256;ne++)Ke[ne]=19595*ne,Ke[ne+256>>0]=38470*ne,Ke[ne+512>>0]=7471*ne+32768,Ke[ne+768>>0]=-11059*ne,Ke[ne+1024>>0]=-21709*ne,Ke[ne+1280>>0]=32768*ne+8421375,Ke[ne+1536>>0]=-27439*ne,Ke[ne+1792>>0]=-5329*ne}(),sr(h)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function Yo(h,a){if(this.pos=0,this.buffer=h,this.datav=new DataView(h.buffer),this.is_with_alpha=!!a,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function Mg(h){function a(Ae){if(!Ae)throw Error("assert :P")}function c(Ae,lt,mt){for(var _e=0;4>_e;_e++)if(Ae[lt+_e]!=mt.charCodeAt(_e))return!0;return!1}function p(Ae,lt,mt,_e,ve){for(var $e=0;$e<ve;$e++)Ae[lt+$e]=mt[_e+$e]}function v(Ae,lt,mt,_e){for(var ve=0;ve<_e;ve++)Ae[lt+ve]=mt}function y(Ae){return new Int32Array(Ae)}function f(Ae,lt){for(var mt=[],_e=0;_e<Ae;_e++)mt.push(new lt);return mt}function s(Ae,lt){var mt=[];return function _e(ve,$e,Ne){for(var wt=Ne[$e],ut=0;ut<wt&&(ve.push(Ne.length>$e+1?[]:new lt),!(Ne.length<$e+1));ut++)_e(ve[ut],$e+1,Ne)}(mt,0,Ae),mt}var M=function(){var Ae=this;function lt(w,T){for(var F=1<<T-1>>>0;w&F;)F>>>=1;return F?(w&F-1)+F:w}function mt(w,T,F,Z,te){a(!(Z%F));do w[T+(Z-=F)]=te;while(0<Z)}function _e(w,T,F,Z,te){if(a(2328>=te),512>=te)var oe=y(512);else if((oe=y(te))==null)return 0;return function(ce,he,ge,Ce,rt,_t){var ct,ot,Vt=he,kt=1<<ge,it=y(16),st=y(16);for(a(rt!=0),a(Ce!=null),a(ce!=null),a(0<ge),ot=0;ot<rt;++ot){if(15<Ce[ot])return 0;++it[Ce[ot]]}if(it[0]==rt)return 0;for(st[1]=0,ct=1;15>ct;++ct){if(it[ct]>1<<ct)return 0;st[ct+1]=st[ct]+it[ct]}for(ot=0;ot<rt;++ot)ct=Ce[ot],0<Ce[ot]&&(_t[st[ct]++]=ot);if(st[15]==1)return(Ce=new ve).g=0,Ce.value=_t[0],mt(ce,Vt,1,kt,Ce),kt;var Ut,Ot=-1,jt=kt-1,Ft=0,zt=1,kr=1,cr=1<<ge;for(ot=0,ct=1,rt=2;ct<=ge;++ct,rt<<=1){if(zt+=kr<<=1,0>(kr-=it[ct]))return 0;for(;0<it[ct];--it[ct])(Ce=new ve).g=ct,Ce.value=_t[ot++],mt(ce,Vt+Ft,rt,cr,Ce),Ft=lt(Ft,ct)}for(ct=ge+1,rt=2;15>=ct;++ct,rt<<=1){if(zt+=kr<<=1,0>(kr-=it[ct]))return 0;for(;0<it[ct];--it[ct]){if(Ce=new ve,(Ft&jt)!=Ot){for(Vt+=cr,Ut=1<<(Ot=ct)-ge;15>Ot&&!(0>=(Ut-=it[Ot]));)++Ot,Ut<<=1;kt+=cr=1<<(Ut=Ot-ge),ce[he+(Ot=Ft&jt)].g=Ut+ge,ce[he+Ot].value=Vt-he-Ot}Ce.g=ct-ge,Ce.value=_t[ot++],mt(ce,Vt+(Ft>>ge),rt,cr,Ce),Ft=lt(Ft,ct)}}return zt!=2*st[15]-1?0:kt}(w,T,F,Z,te,oe)}function ve(){this.value=this.g=0}function $e(){this.value=this.g=0}function Ne(){this.G=f(5,ve),this.H=y(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=f(pn,$e)}function wt(w,T,F,Z){a(w!=null),a(T!=null),a(2147483648>Z),w.Ca=254,w.I=0,w.b=-8,w.Ka=0,w.oa=T,w.pa=F,w.Jd=T,w.Yc=F+Z,w.Zc=4<=Z?F+Z-4+1:F,at(w)}function ut(w,T){for(var F=0;0<T--;)F|=gt(w,128)<<T;return F}function At(w,T){var F=ut(w,T);return pt(w)?-F:F}function ht(w,T,F,Z){var te,oe=0;for(a(w!=null),a(T!=null),a(4294967288>Z),w.Sb=Z,w.Ra=0,w.u=0,w.h=0,4<Z&&(Z=4),te=0;te<Z;++te)oe+=T[F+te]<<8*te;w.Ra=oe,w.bb=Z,w.oa=T,w.pa=F}function Tt(w){for(;8<=w.u&&w.bb<w.Sb;)w.Ra>>>=8,w.Ra+=w.oa[w.pa+w.bb]<<Oa-8>>>0,++w.bb,w.u-=8;Re(w)&&(w.h=1,w.u=0)}function Dt(w,T){if(a(0<=T),!w.h&&T<=po){var F=Ie(w)&hs[T];return w.u+=T,Tt(w),F}return w.h=1,w.u=0}function sr(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function ne(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Ie(w){return w.Ra>>>(w.u&Oa-1)>>>0}function Re(w){return a(w.bb<=w.Sb),w.h||w.bb==w.Sb&&w.u>Oa}function We(w,T){w.u=T,w.h=Re(w)}function nt(w){w.u>=zo&&(a(w.u>=zo),Tt(w))}function at(w){a(w!=null&&w.oa!=null),w.pa<w.Zc?(w.I=(w.oa[w.pa++]|w.I<<8)>>>0,w.b+=8):(a(w!=null&&w.oa!=null),w.pa<w.Yc?(w.b+=8,w.I=w.oa[w.pa++]|w.I<<8):w.Ka?w.b=0:(w.I<<=8,w.b+=8,w.Ka=1))}function pt(w){return ut(w,1)}function gt(w,T){var F=w.Ca;0>w.b&&at(w);var Z=w.b,te=F*T>>>8,oe=(w.I>>>Z>te)+0;for(oe?(F-=te,w.I-=te+1<<Z>>>0):F=te+1,Z=F,te=0;256<=Z;)te+=8,Z>>=8;return Z=7^te+Yn[Z],w.b-=Z,w.Ca=(F<<Z)-1,oe}function Ht(w,T,F){w[T+0]=F>>24&255,w[T+1]=F>>16&255,w[T+2]=F>>8&255,w[T+3]=F>>0&255}function $t(w,T){return w[T+0]<<0|w[T+1]<<8}function er(w,T){return $t(w,T)|w[T+2]<<16}function nr(w,T){return $t(w,T)|$t(w,T+2)<<16}function dr(w,T){var F=1<<T;return a(w!=null),a(0<T),w.X=y(F),w.X==null?0:(w.Mb=32-T,w.Xa=T,1)}function Et(w,T){a(w!=null),a(T!=null),a(w.Xa==T.Xa),p(T.X,0,w.X,0,1<<T.Xa)}function qe(){this.X=[],this.Xa=this.Mb=0}function zr(w,T,F,Z){a(F!=null),a(Z!=null);var te=F[0],oe=Z[0];return te==0&&(te=(w*oe+T/2)/T),oe==0&&(oe=(T*te+w/2)/w),0>=te||0>=oe?0:(F[0]=te,Z[0]=oe,1)}function yr(w,T){return w+(1<<T)-1>>>T}function Xt(w,T){return((4278255360&w)+(4278255360&T)>>>0&4278255360)+((16711935&w)+(16711935&T)>>>0&16711935)>>>0}function ir(w,T){Ae[T]=function(F,Z,te,oe,ce,he,ge){var Ce;for(Ce=0;Ce<ce;++Ce){var rt=Ae[w](he[ge+Ce-1],te,oe+Ce);he[ge+Ce]=Xt(F[Z+Ce],rt)}}}function ar(){this.ud=this.hd=this.jd=0}function or(w,T){return((4278124286&(w^T))>>>1)+(w&T)>>>0}function xr(w){return 0<=w&&256>w?w:0>w?0:255<w?255:void 0}function wr(w,T){return xr(w+(w-T+.5>>1))}function Dr(w,T,F){return Math.abs(T-F)-Math.abs(w-F)}function Fr(w,T,F,Z,te,oe,ce){for(Z=oe[ce-1],F=0;F<te;++F)oe[ce+F]=Z=Xt(w[T+F],Z)}function Zr(w,T,F,Z,te){var oe;for(oe=0;oe<F;++oe){var ce=w[T+oe],he=ce>>8&255,ge=16711935&(ge=(ge=16711935&ce)+((he<<16)+he));Z[te+oe]=(4278255360&ce)+ge>>>0}}function Jr(w,T){T.jd=w>>0&255,T.hd=w>>8&255,T.ud=w>>16&255}function Mr(w,T,F,Z,te,oe){var ce;for(ce=0;ce<Z;++ce){var he=T[F+ce],ge=he>>>8,Ce=he,rt=255&(rt=(rt=he>>>16)+((w.jd<<24>>24)*(ge<<24>>24)>>>5));Ce=255&(Ce=(Ce=Ce+((w.hd<<24>>24)*(ge<<24>>24)>>>5))+((w.ud<<24>>24)*(rt<<24>>24)>>>5)),te[oe+ce]=(4278255360&he)+(rt<<16)+Ce}}function Rr(w,T,F,Z,te){Ae[T]=function(oe,ce,he,ge,Ce,rt,_t,ct,ot){for(ge=_t;ge<ct;++ge)for(_t=0;_t<ot;++_t)Ce[rt++]=te(he[Z(oe[ce++])])},Ae[w]=function(oe,ce,he,ge,Ce,rt,_t){var ct=8>>oe.b,ot=oe.Ea,Vt=oe.K[0],kt=oe.w;if(8>ct)for(oe=(1<<oe.b)-1,kt=(1<<ct)-1;ce<he;++ce){var it,st=0;for(it=0;it<ot;++it)it&oe||(st=Z(ge[Ce++])),rt[_t++]=te(Vt[st&kt]),st>>=ct}else Ae["VP8LMapColor"+F](ge,Ce,Vt,kt,rt,_t,ce,he,ot)}}function ur(w,T,F,Z,te){for(F=T+F;T<F;){var oe=w[T++];Z[te++]=oe>>16&255,Z[te++]=oe>>8&255,Z[te++]=oe>>0&255}}function Wi(w,T,F,Z,te){for(F=T+F;T<F;){var oe=w[T++];Z[te++]=oe>>16&255,Z[te++]=oe>>8&255,Z[te++]=oe>>0&255,Z[te++]=oe>>24&255}}function Qr(w,T,F,Z,te){for(F=T+F;T<F;){var oe=(ce=w[T++])>>16&240|ce>>12&15,ce=ce>>0&240|ce>>28&15;Z[te++]=oe,Z[te++]=ce}}function Bi(w,T,F,Z,te){for(F=T+F;T<F;){var oe=(ce=w[T++])>>16&248|ce>>13&7,ce=ce>>5&224|ce>>3&31;Z[te++]=oe,Z[te++]=ce}}function K(w,T,F,Z,te){for(F=T+F;T<F;){var oe=w[T++];Z[te++]=oe>>0&255,Z[te++]=oe>>8&255,Z[te++]=oe>>16&255}}function x(w,T,F,Z,te,oe){if(oe==0)for(F=T+F;T<F;)Ht(Z,((oe=w[T++])[0]>>24|oe[1]>>8&65280|oe[2]<<8&16711680|oe[3]<<24)>>>0),te+=32;else p(Z,te,w,T,F)}function A(w,T){Ae[T][0]=Ae[w+"0"],Ae[T][1]=Ae[w+"1"],Ae[T][2]=Ae[w+"2"],Ae[T][3]=Ae[w+"3"],Ae[T][4]=Ae[w+"4"],Ae[T][5]=Ae[w+"5"],Ae[T][6]=Ae[w+"6"],Ae[T][7]=Ae[w+"7"],Ae[T][8]=Ae[w+"8"],Ae[T][9]=Ae[w+"9"],Ae[T][10]=Ae[w+"10"],Ae[T][11]=Ae[w+"11"],Ae[T][12]=Ae[w+"12"],Ae[T][13]=Ae[w+"13"],Ae[T][14]=Ae[w+"0"],Ae[T][15]=Ae[w+"0"]}function O(w){return w==qo||w==_l||w==yl||w==Ol}function G(){this.eb=[],this.size=this.A=this.fb=0}function Q(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function le(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new G,this.f.kb=new Q,this.sd=null}function Te(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function ue(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function xe(w){return alert("todo:WebPSamplerProcessPlane"),w.T}function we(w,T){var F=w.T,Z=T.ba.f.RGBA,te=Z.eb,oe=Z.fb+w.ka*Z.A,ce=As[T.ba.S],he=w.y,ge=w.O,Ce=w.f,rt=w.N,_t=w.ea,ct=w.W,ot=T.cc,Vt=T.dc,kt=T.Mc,it=T.Nc,st=w.ka,Ut=w.ka+w.T,Ot=w.U,jt=Ot+1>>1;for(st==0?ce(he,ge,null,null,Ce,rt,_t,ct,Ce,rt,_t,ct,te,oe,null,null,Ot):(ce(T.ec,T.fc,he,ge,ot,Vt,kt,it,Ce,rt,_t,ct,te,oe-Z.A,te,oe,Ot),++F);st+2<Ut;st+=2)ot=Ce,Vt=rt,kt=_t,it=ct,rt+=w.Rc,ct+=w.Rc,oe+=2*Z.A,ce(he,(ge+=2*w.fa)-w.fa,he,ge,ot,Vt,kt,it,Ce,rt,_t,ct,te,oe-Z.A,te,oe,Ot);return ge+=w.fa,w.j+Ut<w.o?(p(T.ec,T.fc,he,ge,Ot),p(T.cc,T.dc,Ce,rt,jt),p(T.Mc,T.Nc,_t,ct,jt),F--):1&Ut||ce(he,ge,null,null,Ce,rt,_t,ct,Ce,rt,_t,ct,te,oe+Z.A,null,null,Ot),F}function ze(w,T,F){var Z=w.F,te=[w.J];if(Z!=null){var oe=w.U,ce=T.ba.S,he=ce==jo||ce==yl;T=T.ba.f.RGBA;var ge=[0],Ce=w.ka;ge[0]=w.T,w.Kb&&(Ce==0?--ge[0]:(--Ce,te[0]-=w.width),w.j+w.ka+w.T==w.o&&(ge[0]=w.o-w.j-Ce));var rt=T.eb;Ce=T.fb+Ce*T.A,w=fi(Z,te[0],w.width,oe,ge,rt,Ce+(he?0:3),T.A),a(F==ge),w&&O(ce)&&Os(rt,Ce,he,oe,ge,T.A)}return 0}function Qe(w){var T=w.ma,F=T.ba.S,Z=11>F,te=F==Oo||F==Bl||F==jo||F==Ic||F==12||O(F);if(T.memory=null,T.Ib=null,T.Jb=null,T.Nd=null,!pl(T.Oa,w,te?11:12))return 0;if(te&&O(F)&&Yt(),w.da)alert("todo:use_scaling");else{if(Z){if(T.Ib=xe,w.Kb){if(F=w.U+1>>1,T.memory=y(w.U+2*F),T.memory==null)return 0;T.ec=T.memory,T.fc=0,T.cc=T.ec,T.dc=T.fc+w.U,T.Mc=T.cc,T.Nc=T.dc+F,T.Ib=we,Yt()}}else alert("todo:EmitYUV");te&&(T.Jb=ze,Z&&dt())}if(Z&&!Zl){for(w=0;256>w;++w)Gl[w]=89858*(w-128)+yo>>Za,Pl[w]=-22014*(w-128)+yo,hr[w]=-45773*(w-128),Ts[w]=113618*(w-128)+yo>>Za;for(w=wl;w<Ul;++w)T=76283*(w-16)+yo>>Za,Fc[w-wl]=zs(T,255),Jc[w-wl]=zs(T+8>>4,15);Zl=1}return 1}function je(w){var T=w.ma,F=w.U,Z=w.T;return a(!(1&w.ka)),0>=F||0>=Z?0:(F=T.Ib(w,T),T.Jb!=null&&T.Jb(w,T,F),T.Dc+=F,1)}function ft(w){w.ma.memory=null}function Pt(w,T,F,Z){return Dt(w,8)!=47?0:(T[0]=Dt(w,14)+1,F[0]=Dt(w,14)+1,Z[0]=Dt(w,1),Dt(w,3)!=0?0:!w.h)}function rr(w,T){if(4>w)return w+1;var F=w-2>>1;return(2+(1&w)<<F)+Dt(T,F)+1}function lr(w,T){return 120<T?T-120:1<=(F=((F=Vo[T-1])>>4)*w+(8-(15&F)))?F:1;var F}function yt(w,T,F){var Z=Ie(F),te=w[T+=255&Z].g-8;return 0<te&&(We(F,F.u+8),Z=Ie(F),T+=w[T].value,T+=Z&(1<<te)-1),We(F,F.u+w[T].g),w[T].value}function Zt(w,T,F){return F.g+=w.g,F.value+=w.value<<T>>>0,a(8>=F.g),w.g}function Qt(w,T,F){var Z=w.xc;return a((T=Z==0?0:w.vc[w.md*(F>>Z)+(T>>Z)])<w.Wb),w.Ya[T]}function Pr(w,T,F,Z){var te=w.ab,oe=w.c*T,ce=w.C;T=ce+T;var he=F,ge=Z;for(Z=w.Ta,F=w.Ua;0<te--;){var Ce=w.gc[te],rt=ce,_t=T,ct=he,ot=ge,Vt=(ge=Z,he=F,Ce.Ea);switch(a(rt<_t),a(_t<=Ce.nc),Ce.hc){case 2:ii(ct,ot,(_t-rt)*Vt,ge,he);break;case 0:var kt=rt,it=_t,st=ge,Ut=he,Ot=(cr=Ce).Ea;kt==0&&(Rl(ct,ot,null,null,1,st,Ut),Fr(ct,ot+1,0,0,Ot-1,st,Ut+1),ot+=Ot,Ut+=Ot,++kt);for(var jt=1<<cr.b,Ft=jt-1,zt=yr(Ot,cr.b),kr=cr.K,cr=cr.w+(kt>>cr.b)*zt;kt<it;){var ui=kr,$r=cr,li=1;for(ta(ct,ot,st,Ut-Ot,1,st,Ut);li<Ot;){var qr=(li&~Ft)+jt;qr>Ot&&(qr=Ot),(0,ja[ui[$r++]>>8&15])(ct,ot+ +li,st,Ut+li-Ot,qr-li,st,Ut+li),li=qr}ot+=Ot,Ut+=Ot,++kt&Ft||(cr+=zt)}_t!=Ce.nc&&p(ge,he-Vt,ge,he+(_t-rt-1)*Vt,Vt);break;case 1:for(Vt=ct,it=ot,Ot=(ct=Ce.Ea)-(Ut=ct&~(st=(ot=1<<Ce.b)-1)),kt=yr(ct,Ce.b),jt=Ce.K,Ce=Ce.w+(rt>>Ce.b)*kt;rt<_t;){for(Ft=jt,zt=Ce,kr=new ar,cr=it+Ut,ui=it+ct;it<cr;)Jr(Ft[zt++],kr),Do(kr,Vt,it,ot,ge,he),it+=ot,he+=ot;it<ui&&(Jr(Ft[zt++],kr),Do(kr,Vt,it,Ot,ge,he),it+=Ot,he+=Ot),++rt&st||(Ce+=kt)}break;case 3:if(ct==ge&&ot==he&&0<Ce.b){for(it=ge,ct=Vt=he+(_t-rt)*Vt-(Ut=(_t-rt)*yr(Ce.Ea,Ce.b)),ot=ge,st=he,kt=[],Ut=(Ot=Ut)-1;0<=Ut;--Ut)kt[Ut]=ot[st+Ut];for(Ut=Ot-1;0<=Ut;--Ut)it[ct+Ut]=kt[Ut];Ds(Ce,rt,_t,ge,Vt,ge,he)}else Ds(Ce,rt,_t,ct,ot,ge,he)}he=Z,ge=F}ge!=F&&p(Z,F,he,ge,oe)}function Sr(w,T){var F=w.V,Z=w.Ba+w.c*w.C,te=T-w.C;if(a(T<=w.l.o),a(16>=te),0<te){var oe=w.l,ce=w.Ta,he=w.Ua,ge=oe.width;if(Pr(w,te,F,Z),te=he=[he],a((F=w.C)<(Z=T)),a(oe.v<oe.va),Z>oe.o&&(Z=oe.o),F<oe.j){var Ce=oe.j-F;F=oe.j,te[0]+=Ce*ge}if(F>=Z?F=0:(te[0]+=4*oe.v,oe.ka=F-oe.j,oe.U=oe.va-oe.v,oe.T=Z-F,F=1),F){if(he=he[0],11>(F=w.ca).S){var rt=F.f.RGBA,_t=(Z=F.S,te=oe.U,oe=oe.T,Ce=rt.eb,rt.A),ct=oe;for(rt=rt.fb+w.Ma*rt.A;0<ct--;){var ot=ce,Vt=he,kt=te,it=Ce,st=rt;switch(Z){case Bo:Kn(ot,Vt,kt,it,st);break;case Oo:An(ot,Vt,kt,it,st);break;case qo:An(ot,Vt,kt,it,st),Os(it,st,0,kt,1,0);break;case ac:ia(ot,Vt,kt,it,st);break;case Bl:x(ot,Vt,kt,it,st,1);break;case _l:x(ot,Vt,kt,it,st,1),Os(it,st,0,kt,1,0);break;case jo:x(ot,Vt,kt,it,st,0);break;case yl:x(ot,Vt,kt,it,st,0),Os(it,st,1,kt,1,0);break;case Ic:ra(ot,Vt,kt,it,st);break;case Ol:ra(ot,Vt,kt,it,st),Si(it,st,kt,1,0);break;case Cc:Fs(ot,Vt,kt,it,st);break;default:a(0)}he+=ge,rt+=_t}w.Ma+=oe}else alert("todo:EmitRescaledRowsYUVA");a(w.Ma<=F.height)}}w.C=T,a(w.C<=w.i)}function Ir(w){var T;if(0<w.ua)return 0;for(T=0;T<w.Wb;++T){var F=w.Ya[T].G,Z=w.Ya[T].H;if(0<F[1][Z[1]+0].g||0<F[2][Z[2]+0].g||0<F[3][Z[3]+0].g)return 0}return 1}function pr(w,T,F,Z,te,oe){if(w.Z!=0){var ce=w.qd,he=w.rd;for(a(Ua[w.Z]!=null);T<F;++T)Ua[w.Z](ce,he,Z,te,Z,te,oe),ce=Z,he=te,te+=oe;w.qd=ce,w.rd=he}}function en(w,T){var F=w.l.ma,Z=F.Z==0||F.Z==1?w.l.j:w.C;if(Z=w.C<Z?Z:w.C,a(T<=w.l.o),T>Z){var te=w.l.width,oe=F.ca,ce=F.tb+te*Z,he=w.V,ge=w.Ba+w.c*Z,Ce=w.gc;a(w.ab==1),a(Ce[0].hc==3),nc(Ce[0],Z,T,he,ge,oe,ce),pr(F,Z,T,oe,ce,te)}w.C=w.Ma=T}function di(w,T,F,Z,te,oe,ce){var he=w.$/Z,ge=w.$%Z,Ce=w.m,rt=w.s,_t=F+w.$,ct=_t;te=F+Z*te;var ot=F+Z*oe,Vt=280+rt.ua,kt=w.Pb?he:16777216,it=0<rt.ua?rt.Wa:null,st=rt.wc,Ut=_t<ot?Qt(rt,ge,he):null;a(w.C<oe),a(ot<=te);var Ot=!1;e:for(;;){for(;Ot||_t<ot;){var jt=0;if(he>=kt){var Ft=_t-F;a((kt=w).Pb),kt.wd=kt.m,kt.xd=Ft,0<kt.s.ua&&Et(kt.s.Wa,kt.s.vb),kt=he+Mc}if(ge&st||(Ut=Qt(rt,ge,he)),a(Ut!=null),Ut.Qb&&(T[_t]=Ut.qb,Ot=!0),!Ot)if(nt(Ce),Ut.jc){jt=Ce,Ft=T;var zt=_t,kr=Ut.pd[Ie(jt)&pn-1];a(Ut.jc),256>kr.g?(We(jt,jt.u+kr.g),Ft[zt]=kr.value,jt=0):(We(jt,jt.u+kr.g-256),a(256<=kr.value),jt=kr.value),jt==0&&(Ot=!0)}else jt=yt(Ut.G[0],Ut.H[0],Ce);if(Ce.h)break;if(Ot||256>jt){if(!Ot)if(Ut.nd)T[_t]=(Ut.qb|jt<<8)>>>0;else{if(nt(Ce),Ot=yt(Ut.G[1],Ut.H[1],Ce),nt(Ce),Ft=yt(Ut.G[2],Ut.H[2],Ce),zt=yt(Ut.G[3],Ut.H[3],Ce),Ce.h)break;T[_t]=(zt<<24|Ot<<16|jt<<8|Ft)>>>0}if(Ot=!1,++_t,++ge>=Z&&(ge=0,++he,ce!=null&&he<=oe&&!(he%16)&&ce(w,he),it!=null))for(;ct<_t;)jt=T[ct++],it.X[(506832829*jt&4294967295)>>>it.Mb]=jt}else if(280>jt){if(jt=rr(jt-256,Ce),Ft=yt(Ut.G[4],Ut.H[4],Ce),nt(Ce),Ft=lr(Z,Ft=rr(Ft,Ce)),Ce.h)break;if(_t-F<Ft||te-_t<jt)break e;for(zt=0;zt<jt;++zt)T[_t+zt]=T[_t+zt-Ft];for(_t+=jt,ge+=jt;ge>=Z;)ge-=Z,++he,ce!=null&&he<=oe&&!(he%16)&&ce(w,he);if(a(_t<=te),ge&st&&(Ut=Qt(rt,ge,he)),it!=null)for(;ct<_t;)jt=T[ct++],it.X[(506832829*jt&4294967295)>>>it.Mb]=jt}else{if(!(jt<Vt))break e;for(Ot=jt-280,a(it!=null);ct<_t;)jt=T[ct++],it.X[(506832829*jt&4294967295)>>>it.Mb]=jt;jt=_t,a(!(Ot>>>(Ft=it).Xa)),T[jt]=Ft.X[Ot],Ot=!0}Ot||a(Ce.h==Re(Ce))}if(w.Pb&&Ce.h&&_t<te)a(w.m.h),w.a=5,w.m=w.wd,w.$=w.xd,0<w.s.ua&&Et(w.s.vb,w.s.Wa);else{if(Ce.h)break e;ce!=null&&ce(w,he>oe?oe:he),w.a=0,w.$=_t-F}return 1}return w.a=3,0}function yi(w){a(w!=null),w.vc=null,w.yc=null,w.Ya=null;var T=w.Wa;T!=null&&(T.X=null),w.vb=null,a(w!=null)}function ri(){var w=new Fl;return w==null?null:(w.a=0,w.xb=Dc,A("Predictor","VP8LPredictors"),A("Predictor","VP8LPredictors_C"),A("PredictorAdd","VP8LPredictorsAdd"),A("PredictorAdd","VP8LPredictorsAdd_C"),ii=Zr,Do=Mr,Kn=ur,An=Wi,ra=Qr,Fs=Bi,ia=K,Ae.VP8LMapColor32b=fl,Ae.VP8LMapColor8b=sc,w)}function xs(w,T,F,Z,te){var oe=1,ce=[w],he=[T],ge=Z.m,Ce=Z.s,rt=null,_t=0;e:for(;;){if(F)for(;oe&&Dt(ge,1);){var ct=ce,ot=he,Vt=Z,kt=1,it=Vt.m,st=Vt.gc[Vt.ab],Ut=Dt(it,2);if(Vt.Oc&1<<Ut)oe=0;else{switch(Vt.Oc|=1<<Ut,st.hc=Ut,st.Ea=ct[0],st.nc=ot[0],st.K=[null],++Vt.ab,a(4>=Vt.ab),Ut){case 0:case 1:st.b=Dt(it,3)+2,kt=xs(yr(st.Ea,st.b),yr(st.nc,st.b),0,Vt,st.K),st.K=st.K[0];break;case 3:var Ot,jt=Dt(it,8)+1,Ft=16<jt?0:4<jt?1:2<jt?2:3;if(ct[0]=yr(st.Ea,Ft),st.b=Ft,Ot=kt=xs(jt,1,0,Vt,st.K)){var zt,kr=jt,cr=st,ui=1<<(8>>cr.b),$r=y(ui);if($r==null)Ot=0;else{var li=cr.K[0],qr=cr.w;for($r[0]=cr.K[0][0],zt=1;zt<1*kr;++zt)$r[zt]=Xt(li[qr+zt],$r[zt-1]);for(;zt<4*ui;++zt)$r[zt]=0;cr.K[0]=null,cr.K[0]=$r,Ot=1}}kt=Ot;break;case 2:break;default:a(0)}oe=kt}}if(ce=ce[0],he=he[0],oe&&Dt(ge,1)&&!(oe=1<=(_t=Dt(ge,4))&&11>=_t)){Z.a=3;break e}var Ai;if(Ai=oe)t:{var ni,br,Hr,rs=Z,Fi=ce,kn=he,gi=_t,nn=F,Gn=rs.m,Vi=rs.s,fn=[null],yn=1,fs=0,is=js[gi];r:for(;;){if(nn&&Dt(Gn,1)){var Ui=Dt(Gn,3)+2,oa=yr(Fi,Ui),Aa=yr(kn,Ui),qs=oa*Aa;if(!xs(oa,Aa,0,rs,fn))break r;for(fn=fn[0],Vi.xc=Ui,ni=0;ni<qs;++ni){var la=fn[ni]>>8&65535;fn[ni]=la,la>=yn&&(yn=la+1)}}if(Gn.h)break r;for(br=0;5>br;++br){var Zi=oc[br];!br&&0<gi&&(Zi+=1<<gi),fs<Zi&&(fs=Zi)}var Sl=f(yn*is,ve),Wl=yn,m=f(Wl,Ne);if(m==null)var e=null;else a(65536>=Wl),e=m;var r=y(fs);if(e==null||r==null||Sl==null){rs.a=1;break r}var l=Sl;for(ni=Hr=0;ni<yn;++ni){var u=e[ni],g=u.G,P=u.H,I=0,E=1,D=0;for(br=0;5>br;++br){Zi=oc[br],g[br]=l,P[br]=Hr,!br&&0<gi&&(Zi+=1<<gi);n:{var q,$=Zi,W=rs,ie=r,se=l,Pe=Hr,be=0,Se=W.m,Ee=Dt(Se,1);if(v(ie,0,0,$),Ee){var Ze=Dt(Se,1)+1,Ge=Dt(Se,1),Xe=Dt(Se,Ge==0?1:8);ie[Xe]=1,Ze==2&&(ie[Xe=Dt(Se,8)]=1);var Je=1}else{var Ye=y(19),vt=Dt(Se,4)+4;if(19<vt){W.a=3;var bt=0;break n}for(q=0;q<vt;++q)Ye[Ji[q]]=Dt(Se,3);var Mt=void 0,Lt=void 0,It=W,tr=Ye,Kt=$,Bt=ie,gr=0,_r=It.m,oi=8,Pi=f(128,ve);i:for(;_e(Pi,0,7,tr,19);){if(Dt(_r,1)){var bi=2+2*Dt(_r,3);if((Mt=2+Dt(_r,bi))>Kt)break i}else Mt=Kt;for(Lt=0;Lt<Kt&&Mt--;){nt(_r);var Mi=Pi[0+(127&Ie(_r))];We(_r,_r.u+Mi.g);var _i=Mi.value;if(16>_i)Bt[Lt++]=_i,_i!=0&&(oi=_i);else{var hi=_i==16,vi=_i-16,Tn=jl[vi],vn=Dt(_r,vl[vi])+Tn;if(Lt+vn>Kt)break i;for(var bn=hi?oi:0;0<vn--;)Bt[Lt++]=bn}}gr=1;break i}gr||(It.a=3),Je=gr}(Je=Je&&!Se.h)&&(be=_e(se,Pe,8,ie,$)),Je&&be!=0?bt=be:(W.a=3,bt=0)}if(bt==0)break r;if(E&&ql[br]==1&&(E=l[Hr].g==0),I+=l[Hr].g,Hr+=bt,3>=br){var sn,Ta=r[0];for(sn=1;sn<Zi;++sn)r[sn]>Ta&&(Ta=r[sn]);D+=Ta}}if(u.nd=E,u.Qb=0,E&&(u.qb=(g[3][P[3]+0].value<<24|g[1][P[1]+0].value<<16|g[2][P[2]+0].value)>>>0,I==0&&256>g[0][P[0]+0].value&&(u.Qb=1,u.qb+=g[0][P[0]+0].value<<8)),u.jc=!u.Qb&&6>D,u.jc){var Vs,In=u;for(Vs=0;Vs<pn;++Vs){var xn=Vs,ms=In.pd[xn],bo=In.G[0][In.H[0]+xn];256<=bo.value?(ms.g=bo.g+256,ms.value=bo.value):(ms.g=0,ms.value=0,xn>>=Zt(bo,8,ms),xn>>=Zt(In.G[1][In.H[1]+xn],16,ms),xn>>=Zt(In.G[2][In.H[2]+xn],0,ms),Zt(In.G[3][In.H[3]+xn],24,ms))}}}Vi.vc=fn,Vi.Wb=yn,Vi.Ya=e,Vi.yc=Sl,Ai=1;break t}Ai=0}if(!(oe=Ai)){Z.a=3;break e}if(0<_t){if(Ce.ua=1<<_t,!dr(Ce.Wa,_t)){Z.a=1,oe=0;break e}}else Ce.ua=0;var $a=Z,Is=ce,Ia=he,Cs=$a.s,Us=Cs.xc;if($a.c=Is,$a.i=Ia,Cs.md=yr(Is,Us),Cs.wc=Us==0?-1:(1<<Us)-1,F){Z.xb=Yc;break e}if((rt=y(ce*he))==null){Z.a=1,oe=0;break e}oe=(oe=di(Z,rt,0,ce,he,he,null))&&!ge.h;break e}return oe?(te!=null?te[0]=rt:(a(rt==null),a(F)),Z.$=0,F||yi(Ce)):yi(Ce),oe}function cn(w,T){var F=w.c*w.i,Z=F+T+16*T;return a(w.c<=T),w.V=y(Z),w.V==null?(w.Ta=null,w.Ua=0,w.a=1,0):(w.Ta=w.V,w.Ua=w.Ba+F+T,1)}function ci(w,T){var F=w.C,Z=T-F,te=w.V,oe=w.Ba+w.c*F;for(a(T<=w.l.o);0<Z;){var ce=16<Z?16:Z,he=w.l.ma,ge=w.l.width,Ce=ge*ce,rt=he.ca,_t=he.tb+ge*F,ct=w.Ta,ot=w.Ua;Pr(w,ce,te,oe),rn(ct,ot,rt,_t,Ce),pr(he,F,F+ce,rt,_t,ge),Z-=ce,te+=ce*w.c,F+=ce}a(F==T),w.C=w.Ma=T}function wo(){this.ub=this.yd=this.td=this.Rb=0}function fa(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function ro(){this.Fb=this.Bb=this.Cb=0,this.Zb=y(4),this.Lb=y(4)}function Ks(){this.Yb=function(){var w=[];return function T(F,Z,te){for(var oe=te[Z],ce=0;ce<oe&&(F.push(te.length>Z+1?[]:0),!(te.length<Z+1));ce++)T(F[ce],Z+1,te)}(w,0,[3,11]),w}()}function io(){this.jb=y(3),this.Wc=s([4,8],Ks),this.Xc=s([4,17],Ks)}function El(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new y(4),this.od=new y(4)}function Po(){this.ld=this.La=this.dd=this.tc=0}function kl(){this.Na=this.la=0}function no(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function tl(){this.ad=y(384),this.Za=0,this.Ob=y(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Ac(){this.uc=this.M=this.Nb=0,this.wa=Array(new Po),this.Y=0,this.ya=Array(new tl),this.aa=0,this.l=new so}function tc(){this.y=y(16),this.f=y(8),this.ea=y(8)}function Tc(){this.cb=this.a=0,this.sc="",this.m=new sr,this.Od=new wo,this.Kc=new fa,this.ed=new El,this.Qa=new ro,this.Ic=this.$c=this.Aa=0,this.D=new Ac,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=f(8,sr),this.ia=0,this.pb=f(4,no),this.Pa=new io,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new tc),this.Hd=0,this.rb=Array(new kl),this.sb=0,this.wa=Array(new Po),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new tl),this.L=this.aa=0,this.gd=s([4,2],Po),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function so(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function ao(){var w=new Tc;return w!=null&&(w.a=0,w.sc="OK",w.cb=0,w.Xb=0,aa||(aa=il)),w}function Hi(w,T,F){return w.a==0&&(w.a=T,w.sc=F,w.cb=0),0}function rl(w,T,F){return 3<=F&&w[T+0]==157&&w[T+1]==1&&w[T+2]==42}function za(w,T){if(w==null)return 0;if(w.a=0,w.sc="OK",T==null)return Hi(w,2,"null VP8Io passed to VP8GetHeaders()");var F=T.data,Z=T.w,te=T.ha;if(4>te)return Hi(w,7,"Truncated header.");var oe=F[Z+0]|F[Z+1]<<8|F[Z+2]<<16,ce=w.Od;if(ce.Rb=!(1&oe),ce.td=oe>>1&7,ce.yd=oe>>4&1,ce.ub=oe>>5,3<ce.td)return Hi(w,3,"Incorrect keyframe parameters.");if(!ce.yd)return Hi(w,4,"Frame not displayable.");Z+=3,te-=3;var he=w.Kc;if(ce.Rb){if(7>te)return Hi(w,7,"cannot parse picture header");if(!rl(F,Z,te))return Hi(w,3,"Bad code word");he.c=16383&(F[Z+4]<<8|F[Z+3]),he.Td=F[Z+4]>>6,he.i=16383&(F[Z+6]<<8|F[Z+5]),he.Ud=F[Z+6]>>6,Z+=7,te-=7,w.za=he.c+15>>4,w.Ub=he.i+15>>4,T.width=he.c,T.height=he.i,T.Da=0,T.j=0,T.v=0,T.va=T.width,T.o=T.height,T.da=0,T.ib=T.width,T.hb=T.height,T.U=T.width,T.T=T.height,v((oe=w.Pa).jb,0,255,oe.jb.length),a((oe=w.Qa)!=null),oe.Cb=0,oe.Bb=0,oe.Fb=1,v(oe.Zb,0,0,oe.Zb.length),v(oe.Lb,0,0,oe.Lb)}if(ce.ub>te)return Hi(w,7,"bad partition length");wt(oe=w.m,F,Z,ce.ub),Z+=ce.ub,te-=ce.ub,ce.Rb&&(he.Ld=pt(oe),he.Kd=pt(oe)),he=w.Qa;var ge,Ce=w.Pa;if(a(oe!=null),a(he!=null),he.Cb=pt(oe),he.Cb){if(he.Bb=pt(oe),pt(oe)){for(he.Fb=pt(oe),ge=0;4>ge;++ge)he.Zb[ge]=pt(oe)?At(oe,7):0;for(ge=0;4>ge;++ge)he.Lb[ge]=pt(oe)?At(oe,6):0}if(he.Bb)for(ge=0;3>ge;++ge)Ce.jb[ge]=pt(oe)?ut(oe,8):255}else he.Bb=0;if(oe.Ka)return Hi(w,3,"cannot parse segment header");if((he=w.ed).zd=pt(oe),he.Tb=ut(oe,6),he.wb=ut(oe,3),he.Pc=pt(oe),he.Pc&&pt(oe)){for(Ce=0;4>Ce;++Ce)pt(oe)&&(he.vd[Ce]=At(oe,6));for(Ce=0;4>Ce;++Ce)pt(oe)&&(he.od[Ce]=At(oe,6))}if(w.L=he.Tb==0?0:he.zd?1:2,oe.Ka)return Hi(w,3,"cannot parse filter header");var rt=te;if(te=ge=Z,Z=ge+rt,he=rt,w.Xb=(1<<ut(w.m,2))-1,rt<3*(Ce=w.Xb))F=7;else{for(ge+=3*Ce,he-=3*Ce,rt=0;rt<Ce;++rt){var _t=F[te+0]|F[te+1]<<8|F[te+2]<<16;_t>he&&(_t=he),wt(w.Jc[+rt],F,ge,_t),ge+=_t,he-=_t,te+=3}wt(w.Jc[+Ce],F,ge,he),F=ge<Z?0:5}if(F!=0)return Hi(w,F,"cannot parse partitions");for(F=ut(ge=w.m,7),te=pt(ge)?At(ge,4):0,Z=pt(ge)?At(ge,4):0,he=pt(ge)?At(ge,4):0,Ce=pt(ge)?At(ge,4):0,ge=pt(ge)?At(ge,4):0,rt=w.Qa,_t=0;4>_t;++_t){if(rt.Cb){var ct=rt.Zb[_t];rt.Fb||(ct+=F)}else{if(0<_t){w.pb[_t]=w.pb[0];continue}ct=F}var ot=w.pb[_t];ot.Sc[0]=Vl[zs(ct+te,127)],ot.Sc[1]=lc[zs(ct+0,127)],ot.Eb[0]=2*Vl[zs(ct+Z,127)],ot.Eb[1]=101581*lc[zs(ct+he,127)]>>16,8>ot.Eb[1]&&(ot.Eb[1]=8),ot.Qc[0]=Vl[zs(ct+Ce,117)],ot.Qc[1]=lc[zs(ct+ge,127)],ot.lc=ct+ge}if(!ce.Rb)return Hi(w,4,"Not a key frame.");for(pt(oe),ce=w.Pa,F=0;4>F;++F){for(te=0;8>te;++te)for(Z=0;3>Z;++Z)for(he=0;11>he;++he)Ce=gt(oe,Xc[F][te][Z][he])?ut(oe,8):Ec[F][te][Z][he],ce.Wc[F][te].Yb[Z][he]=Ce;for(te=0;17>te;++te)ce.Xc[F][te]=ce.Wc[F][zc[te]]}return w.kc=pt(oe),w.kc&&(w.Bd=ut(oe,8)),w.cb=1}function il(w,T,F,Z,te,oe,ce){var he=T[te].Yb[F];for(F=0;16>te;++te){if(!gt(w,he[F+0]))return te;for(;!gt(w,he[F+1]);)if(he=T[++te].Yb[0],F=0,te==16)return 16;var ge=T[te+1].Yb;if(gt(w,he[F+2])){var Ce=w,rt=0;if(gt(Ce,(ct=he)[(_t=F)+3]))if(gt(Ce,ct[_t+6])){for(he=0,_t=2*(rt=gt(Ce,ct[_t+8]))+(ct=gt(Ce,ct[_t+9+rt])),rt=0,ct=bl[_t];ct[he];++he)rt+=rt+gt(Ce,ct[he]);rt+=3+(8<<_t)}else gt(Ce,ct[_t+7])?(rt=7+2*gt(Ce,165),rt+=gt(Ce,145)):rt=5+gt(Ce,159);else rt=gt(Ce,ct[_t+4])?3+gt(Ce,ct[_t+5]):2;he=ge[2]}else rt=1,he=ge[1];ge=ce+xl[te],0>(Ce=w).b&&at(Ce);var _t,ct=Ce.b,ot=(_t=Ce.Ca>>1)-(Ce.I>>ct)>>31;--Ce.b,Ce.Ca+=ot,Ce.Ca|=1,Ce.I-=(_t+1&ot)<<ct,oe[ge]=((rt^ot)-ot)*Z[(0<te)+0]}return 16}function So(w){var T=w.rb[w.sb-1];T.la=0,T.Na=0,v(w.zc,0,0,w.zc.length),w.ja=0}function nl(w,T){if(w==null)return 0;if(T==null)return Hi(w,2,"NULL VP8Io parameter in VP8Decode().");if(!w.cb&&!za(w,T))return 0;if(a(w.cb),T.ac==null||T.ac(T)){T.ob&&(w.L=0);var F=vo[w.L];if(w.L==2?(w.yb=0,w.zb=0):(w.yb=T.v-F>>4,w.zb=T.j-F>>4,0>w.yb&&(w.yb=0),0>w.zb&&(w.zb=0)),w.Va=T.o+15+F>>4,w.Hb=T.va+15+F>>4,w.Hb>w.za&&(w.Hb=w.za),w.Va>w.Ub&&(w.Va=w.Ub),0<w.L){var Z=w.ed;for(F=0;4>F;++F){var te;if(w.Qa.Cb){var oe=w.Qa.Lb[F];w.Qa.Fb||(oe+=Z.Tb)}else oe=Z.Tb;for(te=0;1>=te;++te){var ce=w.gd[F][te],he=oe;if(Z.Pc&&(he+=Z.vd[0],te&&(he+=Z.od[0])),0<(he=0>he?0:63<he?63:he)){var ge=he;0<Z.wb&&(ge=4<Z.wb?ge>>2:ge>>1)>9-Z.wb&&(ge=9-Z.wb),1>ge&&(ge=1),ce.dd=ge,ce.tc=2*he+ge,ce.ld=40<=he?2:15<=he?1:0}else ce.tc=0;ce.La=te}}}F=0}else Hi(w,6,"Frame setup failed"),F=w.a;if(F=F==0){if(F){w.$c=0,0<w.Aa||(w.Ic=Gr);e:{F=w.Ic,Z=4*(ge=w.za);var Ce=32*ge,rt=ge+1,_t=0<w.L?ge*(0<w.Aa?2:1):0,ct=(w.Aa==2?2:1)*ge;if((ce=Z+832+(te=3*(16*F+vo[w.L])/2*Ce)+(oe=w.Fa!=null&&0<w.Fa.length?w.Kc.c*w.Kc.i:0))!=ce)F=0;else{if(ce>w.Vb){if(w.Vb=0,w.Ec=y(ce),w.Fc=0,w.Ec==null){F=Hi(w,1,"no memory during frame initialization.");break e}w.Vb=ce}ce=w.Ec,he=w.Fc,w.Ac=ce,w.Bc=he,he+=Z,w.Gd=f(Ce,tc),w.Hd=0,w.rb=f(rt+1,kl),w.sb=1,w.wa=_t?f(_t,Po):null,w.Y=0,w.D.Nb=0,w.D.wa=w.wa,w.D.Y=w.Y,0<w.Aa&&(w.D.Y+=ge),a(!0),w.oc=ce,w.pc=he,he+=832,w.ya=f(ct,tl),w.aa=0,w.D.ya=w.ya,w.D.aa=w.aa,w.Aa==2&&(w.D.aa+=ge),w.R=16*ge,w.B=8*ge,ge=(Ce=vo[w.L])*w.R,Ce=Ce/2*w.B,w.sa=ce,w.ta=he+ge,w.qa=w.sa,w.ra=w.ta+16*F*w.R+Ce,w.Ha=w.qa,w.Ia=w.ra+8*F*w.B+Ce,w.$c=0,he+=te,w.mb=oe?ce:null,w.nb=oe?he:null,a(he+oe<=w.Fc+w.Vb),So(w),v(w.Ac,w.Bc,0,Z),F=1}}if(F){if(T.ka=0,T.y=w.sa,T.O=w.ta,T.f=w.qa,T.N=w.ra,T.ea=w.Ha,T.Vd=w.Ia,T.fa=w.R,T.Rc=w.B,T.F=null,T.J=0,!No){for(F=-255;255>=F;++F)_n[255+F]=0>F?-F:F;for(F=-1020;1020>=F;++F)wa[1020+F]=-128>F?-128:127<F?127:F;for(F=-112;112>=F;++F)gl[112+F]=-16>F?-16:15<F?15:F;for(F=-255;510>=F;++F)go[255+F]=0>F?0:255<F?255:F;No=1}Ns=ls,ds=os,ml=ei,Un=sl,ps=al,pi=qn,Rs=Co,Fo=ga,fo=hl,na=Mo,ba=Na,qa=ul,Bs=Dl,sa=Lo,mo=lo,xa=zi,Kr=ji,Jn=cl,Zn[0]=Es,Zn[1]=un,Zn[2]=To,Zn[3]=cs,Zn[4]=us,Zn[5]=Da,Zn[6]=wi,Zn[7]=Wr,Zn[8]=oo,Zn[9]=Nr,es[0]=Ao,es[1]=zl,es[2]=Ti,es[3]=hn,es[4]=Ii,es[5]=Ki,es[6]=Js,Pa[0]=ks,Pa[1]=ki,Pa[2]=ti,Pa[3]=Fa,Pa[4]=Qs,Pa[5]=ol,Pa[6]=ma,F=1}else F=0}F&&(F=function(ot,Vt){for(ot.M=0;ot.M<ot.Va;++ot.M){var kt,it=ot.Jc[ot.M&ot.Xb],st=ot.m,Ut=ot;for(kt=0;kt<Ut.za;++kt){var Ot=st,jt=Ut,Ft=jt.Ac,zt=jt.Bc+4*kt,kr=jt.zc,cr=jt.ya[jt.aa+kt];if(jt.Qa.Bb?cr.$b=gt(Ot,jt.Pa.jb[0])?2+gt(Ot,jt.Pa.jb[2]):gt(Ot,jt.Pa.jb[1]):cr.$b=0,jt.kc&&(cr.Ad=gt(Ot,jt.Bd)),cr.Za=!gt(Ot,145)+0,cr.Za){var ui=cr.Ob,$r=0;for(jt=0;4>jt;++jt){var li,qr=kr[0+jt];for(li=0;4>li;++li){qr=kc[Ft[zt+li]][qr];for(var Ai=Lc[gt(Ot,qr[0])];0<Ai;)Ai=Lc[2*Ai+gt(Ot,qr[Ai])];qr=-Ai,Ft[zt+li]=qr}p(ui,$r,Ft,zt,4),$r+=4,kr[0+jt]=qr}}else qr=gt(Ot,156)?gt(Ot,128)?1:3:gt(Ot,163)?2:0,cr.Ob[0]=qr,v(Ft,zt,qr,4),v(kr,0,qr,4);cr.Dd=gt(Ot,142)?gt(Ot,114)?gt(Ot,183)?1:3:2:0}if(Ut.m.Ka)return Hi(ot,7,"Premature end-of-partition0 encountered.");for(;ot.ja<ot.za;++ot.ja){if(Ut=it,Ot=(st=ot).rb[st.sb-1],Ft=st.rb[st.sb+st.ja],kt=st.ya[st.aa+st.ja],zt=st.kc?kt.Ad:0)Ot.la=Ft.la=0,kt.Za||(Ot.Na=Ft.Na=0),kt.Hc=0,kt.Gc=0,kt.ia=0;else{var ni,br;if(Ot=Ft,Ft=Ut,zt=st.Pa.Xc,kr=st.ya[st.aa+st.ja],cr=st.pb[kr.$b],jt=kr.ad,ui=0,$r=st.rb[st.sb-1],qr=li=0,v(jt,ui,0,384),kr.Za)var Hr=0,rs=zt[3];else{Ai=y(16);var Fi=Ot.Na+$r.Na;if(Fi=aa(Ft,zt[1],Fi,cr.Eb,0,Ai,0),Ot.Na=$r.Na=(0<Fi)+0,1<Fi)Ns(Ai,0,jt,ui);else{var kn=Ai[0]+3>>3;for(Ai=0;256>Ai;Ai+=16)jt[ui+Ai]=kn}Hr=1,rs=zt[0]}var gi=15&Ot.la,nn=15&$r.la;for(Ai=0;4>Ai;++Ai){var Gn=1&nn;for(kn=br=0;4>kn;++kn)gi=gi>>1|(Gn=(Fi=aa(Ft,rs,Fi=Gn+(1&gi),cr.Sc,Hr,jt,ui))>Hr)<<7,br=br<<2|(3<Fi?3:1<Fi?2:jt[ui+0]!=0),ui+=16;gi>>=4,nn=nn>>1|Gn<<7,li=(li<<8|br)>>>0}for(rs=gi,Hr=nn>>4,ni=0;4>ni;ni+=2){for(br=0,gi=Ot.la>>4+ni,nn=$r.la>>4+ni,Ai=0;2>Ai;++Ai){for(Gn=1&nn,kn=0;2>kn;++kn)Fi=Gn+(1&gi),gi=gi>>1|(Gn=0<(Fi=aa(Ft,zt[2],Fi,cr.Qc,0,jt,ui)))<<3,br=br<<2|(3<Fi?3:1<Fi?2:jt[ui+0]!=0),ui+=16;gi>>=2,nn=nn>>1|Gn<<5}qr|=br<<4*ni,rs|=gi<<4<<ni,Hr|=(240&nn)<<ni}Ot.la=rs,$r.la=Hr,kr.Hc=li,kr.Gc=qr,kr.ia=43690&qr?0:cr.ia,zt=!(li|qr)}if(0<st.L&&(st.wa[st.Y+st.ja]=st.gd[kt.$b][kt.Za],st.wa[st.Y+st.ja].La|=!zt),Ut.Ka)return Hi(ot,7,"Premature end-of-file encountered.")}if(So(ot),st=Vt,Ut=1,kt=(it=ot).D,Ot=0<it.L&&it.M>=it.zb&&it.M<=it.Va,it.Aa==0)e:{if(kt.M=it.M,kt.uc=Ot,Eo(it,kt),Ut=1,kt=(br=it.D).Nb,Ot=(qr=vo[it.L])*it.R,Ft=qr/2*it.B,Ai=16*kt*it.R,kn=8*kt*it.B,zt=it.sa,kr=it.ta-Ot+Ai,cr=it.qa,jt=it.ra-Ft+kn,ui=it.Ha,$r=it.Ia-Ft+kn,nn=(gi=br.M)==0,li=gi>=it.Va-1,it.Aa==2&&Eo(it,br),br.uc)for(Gn=(Fi=it).D.M,a(Fi.D.uc),br=Fi.yb;br<Fi.Hb;++br){Hr=br,rs=Gn;var Vi=(fn=(Zi=Fi).D).Nb;ni=Zi.R;var fn=fn.wa[fn.Y+Hr],yn=Zi.sa,fs=Zi.ta+16*Vi*ni+16*Hr,is=fn.dd,Ui=fn.tc;if(Ui!=0)if(a(3<=Ui),Zi.L==1)0<Hr&&xa(yn,fs,ni,Ui+4),fn.La&&Jn(yn,fs,ni,Ui),0<rs&&mo(yn,fs,ni,Ui+4),fn.La&&Kr(yn,fs,ni,Ui);else{var oa=Zi.B,Aa=Zi.qa,qs=Zi.ra+8*Vi*oa+8*Hr,la=Zi.Ha,Zi=Zi.Ia+8*Vi*oa+8*Hr;Vi=fn.ld,0<Hr&&(Fo(yn,fs,ni,Ui+4,is,Vi),na(Aa,qs,la,Zi,oa,Ui+4,is,Vi)),fn.La&&(qa(yn,fs,ni,Ui,is,Vi),sa(Aa,qs,la,Zi,oa,Ui,is,Vi)),0<rs&&(Rs(yn,fs,ni,Ui+4,is,Vi),fo(Aa,qs,la,Zi,oa,Ui+4,is,Vi)),fn.La&&(ba(yn,fs,ni,Ui,is,Vi),Bs(Aa,qs,la,Zi,oa,Ui,is,Vi))}}if(it.ia&&alert("todo:DitherRow"),st.put!=null){if(br=16*gi,gi=16*(gi+1),nn?(st.y=it.sa,st.O=it.ta+Ai,st.f=it.qa,st.N=it.ra+kn,st.ea=it.Ha,st.W=it.Ia+kn):(br-=qr,st.y=zt,st.O=kr,st.f=cr,st.N=jt,st.ea=ui,st.W=$r),li||(gi-=qr),gi>st.o&&(gi=st.o),st.F=null,st.J=null,it.Fa!=null&&0<it.Fa.length&&br<gi&&(st.J=Ba(it,st,br,gi-br),st.F=it.mb,st.F==null&&st.F.length==0)){Ut=Hi(it,3,"Could not decode alpha data.");break e}br<st.j&&(qr=st.j-br,br=st.j,a(!(1&qr)),st.O+=it.R*qr,st.N+=it.B*(qr>>1),st.W+=it.B*(qr>>1),st.F!=null&&(st.J+=st.width*qr)),br<gi&&(st.O+=st.v,st.N+=st.v>>1,st.W+=st.v>>1,st.F!=null&&(st.J+=st.v),st.ka=br-st.j,st.U=st.va-st.v,st.T=gi-br,Ut=st.put(st))}kt+1!=it.Ic||li||(p(it.sa,it.ta-Ot,zt,kr+16*it.R,Ot),p(it.qa,it.ra-Ft,cr,jt+8*it.B,Ft),p(it.Ha,it.Ia-Ft,ui,$r+8*it.B,Ft))}if(!Ut)return Hi(ot,6,"Output aborted.")}return 1}(w,T)),T.bc!=null&&T.bc(T),F&=1}return F?(w.cb=0,F):0}function ws(w,T,F,Z,te){te=w[T+F+32*Z]+(te>>3),w[T+F+32*Z]=-256&te?0>te?0:255:te}function Ls(w,T,F,Z,te,oe){ws(w,T,0,F,Z+te),ws(w,T,1,F,Z+oe),ws(w,T,2,F,Z-oe),ws(w,T,3,F,Z-te)}function Oi(w){return(20091*w>>16)+w}function Yr(w,T,F,Z){var te,oe=0,ce=y(16);for(te=0;4>te;++te){var he=w[T+0]+w[T+8],ge=w[T+0]-w[T+8],Ce=(35468*w[T+4]>>16)-Oi(w[T+12]),rt=Oi(w[T+4])+(35468*w[T+12]>>16);ce[oe+0]=he+rt,ce[oe+1]=ge+Ce,ce[oe+2]=ge-Ce,ce[oe+3]=he-rt,oe+=4,T++}for(te=oe=0;4>te;++te)he=(w=ce[oe+0]+4)+ce[oe+8],ge=w-ce[oe+8],Ce=(35468*ce[oe+4]>>16)-Oi(ce[oe+12]),ws(F,Z,0,0,he+(rt=Oi(ce[oe+4])+(35468*ce[oe+12]>>16))),ws(F,Z,1,0,ge+Ce),ws(F,Z,2,0,ge-Ce),ws(F,Z,3,0,he-rt),oe++,Z+=32}function qn(w,T,F,Z){var te=w[T+0]+4,oe=35468*w[T+4]>>16,ce=Oi(w[T+4]),he=35468*w[T+1]>>16;Ls(F,Z,0,te+ce,w=Oi(w[T+1]),he),Ls(F,Z,1,te+oe,w,he),Ls(F,Z,2,te-oe,w,he),Ls(F,Z,3,te-ce,w,he)}function os(w,T,F,Z,te){Yr(w,T,F,Z),te&&Yr(w,T+16,F,Z+4)}function ei(w,T,F,Z){ds(w,T+0,F,Z,1),ds(w,T+32,F,Z+128,1)}function sl(w,T,F,Z){var te;for(w=w[T+0]+4,te=0;4>te;++te)for(T=0;4>T;++T)ws(F,Z,T,te,w)}function al(w,T,F,Z){w[T+0]&&Un(w,T+0,F,Z),w[T+16]&&Un(w,T+16,F,Z+4),w[T+32]&&Un(w,T+32,F,Z+128),w[T+48]&&Un(w,T+48,F,Z+128+4)}function ls(w,T,F,Z){var te,oe=y(16);for(te=0;4>te;++te){var ce=w[T+0+te]+w[T+12+te],he=w[T+4+te]+w[T+8+te],ge=w[T+4+te]-w[T+8+te],Ce=w[T+0+te]-w[T+12+te];oe[0+te]=ce+he,oe[8+te]=ce-he,oe[4+te]=Ce+ge,oe[12+te]=Ce-ge}for(te=0;4>te;++te)ce=(w=oe[0+4*te]+3)+oe[3+4*te],he=oe[1+4*te]+oe[2+4*te],ge=oe[1+4*te]-oe[2+4*te],Ce=w-oe[3+4*te],F[Z+0]=ce+he>>3,F[Z+16]=Ce+ge>>3,F[Z+32]=ce-he>>3,F[Z+48]=Ce-ge>>3,Z+=64}function tn(w,T,F){var Z,te=T-32,oe=Qn,ce=255-w[te-1];for(Z=0;Z<F;++Z){var he,ge=oe,Ce=ce+w[T-1];for(he=0;he<F;++he)w[T+he]=ge[Ce+w[te+he]];T+=32}}function un(w,T){tn(w,T,4)}function ki(w,T){tn(w,T,8)}function zl(w,T){tn(w,T,16)}function Ti(w,T){var F;for(F=0;16>F;++F)p(w,T+32*F,w,T-32,16)}function hn(w,T){var F;for(F=16;0<F;--F)v(w,T,w[T-1],16),T+=32}function mn(w,T,F){var Z;for(Z=0;16>Z;++Z)v(T,F+32*Z,w,16)}function Ao(w,T){var F,Z=16;for(F=0;16>F;++F)Z+=w[T-1+32*F]+w[T+F-32];mn(Z>>5,w,T)}function Ii(w,T){var F,Z=8;for(F=0;16>F;++F)Z+=w[T-1+32*F];mn(Z>>4,w,T)}function Ki(w,T){var F,Z=8;for(F=0;16>F;++F)Z+=w[T+F-32];mn(Z>>4,w,T)}function Js(w,T){mn(128,w,T)}function Lr(w,T,F){return w+2*T+F+2>>2}function To(w,T){var F,Z=T-32;for(Z=new Uint8Array([Lr(w[Z-1],w[Z+0],w[Z+1]),Lr(w[Z+0],w[Z+1],w[Z+2]),Lr(w[Z+1],w[Z+2],w[Z+3]),Lr(w[Z+2],w[Z+3],w[Z+4])]),F=0;4>F;++F)p(w,T+32*F,Z,0,Z.length)}function cs(w,T){var F=w[T-1],Z=w[T-1+32],te=w[T-1+64],oe=w[T-1+96];Ht(w,T+0,16843009*Lr(w[T-1-32],F,Z)),Ht(w,T+32,16843009*Lr(F,Z,te)),Ht(w,T+64,16843009*Lr(Z,te,oe)),Ht(w,T+96,16843009*Lr(te,oe,oe))}function Es(w,T){var F,Z=4;for(F=0;4>F;++F)Z+=w[T+F-32]+w[T-1+32*F];for(Z>>=3,F=0;4>F;++F)v(w,T+32*F,Z,4)}function us(w,T){var F=w[T-1+0],Z=w[T-1+32],te=w[T-1+64],oe=w[T-1-32],ce=w[T+0-32],he=w[T+1-32],ge=w[T+2-32],Ce=w[T+3-32];w[T+0+96]=Lr(Z,te,w[T-1+96]),w[T+1+96]=w[T+0+64]=Lr(F,Z,te),w[T+2+96]=w[T+1+64]=w[T+0+32]=Lr(oe,F,Z),w[T+3+96]=w[T+2+64]=w[T+1+32]=w[T+0+0]=Lr(ce,oe,F),w[T+3+64]=w[T+2+32]=w[T+1+0]=Lr(he,ce,oe),w[T+3+32]=w[T+2+0]=Lr(ge,he,ce),w[T+3+0]=Lr(Ce,ge,he)}function wi(w,T){var F=w[T+1-32],Z=w[T+2-32],te=w[T+3-32],oe=w[T+4-32],ce=w[T+5-32],he=w[T+6-32],ge=w[T+7-32];w[T+0+0]=Lr(w[T+0-32],F,Z),w[T+1+0]=w[T+0+32]=Lr(F,Z,te),w[T+2+0]=w[T+1+32]=w[T+0+64]=Lr(Z,te,oe),w[T+3+0]=w[T+2+32]=w[T+1+64]=w[T+0+96]=Lr(te,oe,ce),w[T+3+32]=w[T+2+64]=w[T+1+96]=Lr(oe,ce,he),w[T+3+64]=w[T+2+96]=Lr(ce,he,ge),w[T+3+96]=Lr(he,ge,ge)}function Da(w,T){var F=w[T-1+0],Z=w[T-1+32],te=w[T-1+64],oe=w[T-1-32],ce=w[T+0-32],he=w[T+1-32],ge=w[T+2-32],Ce=w[T+3-32];w[T+0+0]=w[T+1+64]=oe+ce+1>>1,w[T+1+0]=w[T+2+64]=ce+he+1>>1,w[T+2+0]=w[T+3+64]=he+ge+1>>1,w[T+3+0]=ge+Ce+1>>1,w[T+0+96]=Lr(te,Z,F),w[T+0+64]=Lr(Z,F,oe),w[T+0+32]=w[T+1+96]=Lr(F,oe,ce),w[T+1+32]=w[T+2+96]=Lr(oe,ce,he),w[T+2+32]=w[T+3+96]=Lr(ce,he,ge),w[T+3+32]=Lr(he,ge,Ce)}function Wr(w,T){var F=w[T+0-32],Z=w[T+1-32],te=w[T+2-32],oe=w[T+3-32],ce=w[T+4-32],he=w[T+5-32],ge=w[T+6-32],Ce=w[T+7-32];w[T+0+0]=F+Z+1>>1,w[T+1+0]=w[T+0+64]=Z+te+1>>1,w[T+2+0]=w[T+1+64]=te+oe+1>>1,w[T+3+0]=w[T+2+64]=oe+ce+1>>1,w[T+0+32]=Lr(F,Z,te),w[T+1+32]=w[T+0+96]=Lr(Z,te,oe),w[T+2+32]=w[T+1+96]=Lr(te,oe,ce),w[T+3+32]=w[T+2+96]=Lr(oe,ce,he),w[T+3+64]=Lr(ce,he,ge),w[T+3+96]=Lr(he,ge,Ce)}function Nr(w,T){var F=w[T-1+0],Z=w[T-1+32],te=w[T-1+64],oe=w[T-1+96];w[T+0+0]=F+Z+1>>1,w[T+2+0]=w[T+0+32]=Z+te+1>>1,w[T+2+32]=w[T+0+64]=te+oe+1>>1,w[T+1+0]=Lr(F,Z,te),w[T+3+0]=w[T+1+32]=Lr(Z,te,oe),w[T+3+32]=w[T+1+64]=Lr(te,oe,oe),w[T+3+64]=w[T+2+64]=w[T+0+96]=w[T+1+96]=w[T+2+96]=w[T+3+96]=oe}function oo(w,T){var F=w[T-1+0],Z=w[T-1+32],te=w[T-1+64],oe=w[T-1+96],ce=w[T-1-32],he=w[T+0-32],ge=w[T+1-32],Ce=w[T+2-32];w[T+0+0]=w[T+2+32]=F+ce+1>>1,w[T+0+32]=w[T+2+64]=Z+F+1>>1,w[T+0+64]=w[T+2+96]=te+Z+1>>1,w[T+0+96]=oe+te+1>>1,w[T+3+0]=Lr(he,ge,Ce),w[T+2+0]=Lr(ce,he,ge),w[T+1+0]=w[T+3+32]=Lr(F,ce,he),w[T+1+32]=w[T+3+64]=Lr(Z,F,ce),w[T+1+64]=w[T+3+96]=Lr(te,Z,F),w[T+1+96]=Lr(oe,te,Z)}function ti(w,T){var F;for(F=0;8>F;++F)p(w,T+32*F,w,T-32,8)}function Fa(w,T){var F;for(F=0;8>F;++F)v(w,T,w[T-1],8),T+=32}function Pn(w,T,F){var Z;for(Z=0;8>Z;++Z)v(T,F+32*Z,w,8)}function ks(w,T){var F,Z=8;for(F=0;8>F;++F)Z+=w[T+F-32]+w[T-1+32*F];Pn(Z>>4,w,T)}function ol(w,T){var F,Z=4;for(F=0;8>F;++F)Z+=w[T+F-32];Pn(Z>>3,w,T)}function Qs(w,T){var F,Z=4;for(F=0;8>F;++F)Z+=w[T-1+32*F];Pn(Z>>3,w,T)}function ma(w,T){Pn(128,w,T)}function ea(w,T,F){var Z=w[T-F],te=w[T+0],oe=3*(te-Z)+Va[1020+w[T-2*F]-w[T+F]],ce=Ro[112+(oe+4>>3)];w[T-F]=Qn[255+Z+Ro[112+(oe+3>>3)]],w[T+0]=Qn[255+te-ce]}function rc(w,T,F,Z){var te=w[T+0],oe=w[T+F];return Ss[255+w[T-2*F]-w[T-F]]>Z||Ss[255+oe-te]>Z}function Io(w,T,F,Z){return 4*Ss[255+w[T-F]-w[T+0]]+Ss[255+w[T-2*F]-w[T+F]]<=Z}function ll(w,T,F,Z,te){var oe=w[T-3*F],ce=w[T-2*F],he=w[T-F],ge=w[T+0],Ce=w[T+F],rt=w[T+2*F],_t=w[T+3*F];return 4*Ss[255+he-ge]+Ss[255+ce-Ce]>Z?0:Ss[255+w[T-4*F]-oe]<=te&&Ss[255+oe-ce]<=te&&Ss[255+ce-he]<=te&&Ss[255+_t-rt]<=te&&Ss[255+rt-Ce]<=te&&Ss[255+Ce-ge]<=te}function lo(w,T,F,Z){var te=2*Z+1;for(Z=0;16>Z;++Z)Io(w,T+Z,F,te)&&ea(w,T+Z,F)}function zi(w,T,F,Z){var te=2*Z+1;for(Z=0;16>Z;++Z)Io(w,T+Z*F,1,te)&&ea(w,T+Z*F,1)}function ji(w,T,F,Z){var te;for(te=3;0<te;--te)lo(w,T+=4*F,F,Z)}function cl(w,T,F,Z){var te;for(te=3;0<te;--te)zi(w,T+=4,F,Z)}function dn(w,T,F,Z,te,oe,ce,he){for(oe=2*oe+1;0<te--;){if(ll(w,T,F,oe,ce))if(rc(w,T,F,he))ea(w,T,F);else{var ge=w,Ce=T,rt=F,_t=ge[Ce-2*rt],ct=ge[Ce-rt],ot=ge[Ce+0],Vt=ge[Ce+rt],kt=ge[Ce+2*rt],it=27*(Ut=Va[1020+3*(ot-ct)+Va[1020+_t-Vt]])+63>>7,st=18*Ut+63>>7,Ut=9*Ut+63>>7;ge[Ce-3*rt]=Qn[255+ge[Ce-3*rt]+Ut],ge[Ce-2*rt]=Qn[255+_t+st],ge[Ce-rt]=Qn[255+ct+it],ge[Ce+0]=Qn[255+ot-it],ge[Ce+rt]=Qn[255+Vt-st],ge[Ce+2*rt]=Qn[255+kt-Ut]}T+=Z}}function mi(w,T,F,Z,te,oe,ce,he){for(oe=2*oe+1;0<te--;){if(ll(w,T,F,oe,ce))if(rc(w,T,F,he))ea(w,T,F);else{var ge=w,Ce=T,rt=F,_t=ge[Ce-rt],ct=ge[Ce+0],ot=ge[Ce+rt],Vt=Ro[112+((kt=3*(ct-_t))+4>>3)],kt=Ro[112+(kt+3>>3)],it=Vt+1>>1;ge[Ce-2*rt]=Qn[255+ge[Ce-2*rt]+it],ge[Ce-rt]=Qn[255+_t+kt],ge[Ce+0]=Qn[255+ct-Vt],ge[Ce+rt]=Qn[255+ot-it]}T+=Z}}function Co(w,T,F,Z,te,oe){dn(w,T,F,1,16,Z,te,oe)}function ga(w,T,F,Z,te,oe){dn(w,T,1,F,16,Z,te,oe)}function Na(w,T,F,Z,te,oe){var ce;for(ce=3;0<ce;--ce)mi(w,T+=4*F,F,1,16,Z,te,oe)}function ul(w,T,F,Z,te,oe){var ce;for(ce=3;0<ce;--ce)mi(w,T+=4,1,F,16,Z,te,oe)}function hl(w,T,F,Z,te,oe,ce,he){dn(w,T,te,1,8,oe,ce,he),dn(F,Z,te,1,8,oe,ce,he)}function Mo(w,T,F,Z,te,oe,ce,he){dn(w,T,1,te,8,oe,ce,he),dn(F,Z,1,te,8,oe,ce,he)}function Dl(w,T,F,Z,te,oe,ce,he){mi(w,T+4*te,te,1,8,oe,ce,he),mi(F,Z+4*te,te,1,8,oe,ce,he)}function Lo(w,T,F,Z,te,oe,ce,he){mi(w,T+4,1,te,8,oe,ce,he),mi(F,Z+4,1,te,8,oe,ce,he)}function Ra(){this.ba=new le,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new ue,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Sn(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function co(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function _a(){this.ua=0,this.Wa=new qe,this.vb=new qe,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new Ne,this.yc=new ve}function Fl(){this.xb=this.a=0,this.l=new so,this.ca=new le,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new ne,this.Pb=0,this.wd=new ne,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new _a,this.ab=0,this.gc=f(4,co),this.Oc=0}function ya(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new so,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Vn(w,T,F,Z,te,oe,ce){for(w=w==null?0:w[T+0],T=0;T<ce;++T)te[oe+T]=w+F[Z+T]&255,w=te[oe+T]}function Nl(w,T,F,Z,te,oe,ce){var he;if(w==null)Vn(null,null,F,Z,te,oe,ce);else for(he=0;he<ce;++he)te[oe+he]=w[T+he]+F[Z+he]&255}function va(w,T,F,Z,te,oe,ce){if(w==null)Vn(null,null,F,Z,te,oe,ce);else{var he,ge=w[T+0],Ce=ge,rt=ge;for(he=0;he<ce;++he)Ce=rt+(ge=w[T+he])-Ce,rt=F[Z+he]+(-256&Ce?0>Ce?0:255:Ce)&255,Ce=ge,te[oe+he]=rt}}function Ba(w,T,F,Z){var te=T.width,oe=T.o;if(a(w!=null&&T!=null),0>F||0>=Z||F+Z>oe)return null;if(!w.Cc){if(w.ga==null){var ce;if(w.ga=new ya,(ce=w.ga==null)||(ce=T.width*T.o,a(w.Gb.length==0),w.Gb=y(ce),w.Uc=0,w.Gb==null?ce=0:(w.mb=w.Gb,w.nb=w.Uc,w.rc=null,ce=1),ce=!ce),!ce){ce=w.ga;var he=w.Fa,ge=w.P,Ce=w.qc,rt=w.mb,_t=w.nb,ct=ge+1,ot=Ce-1,Vt=ce.l;if(a(he!=null&&rt!=null&&T!=null),Ua[0]=null,Ua[1]=Vn,Ua[2]=Nl,Ua[3]=va,ce.ca=rt,ce.tb=_t,ce.c=T.width,ce.i=T.height,a(0<ce.c&&0<ce.i),1>=Ce)T=0;else if(ce.$a=he[ge+0]>>0&3,ce.Z=he[ge+0]>>2&3,ce.Lc=he[ge+0]>>4&3,ge=he[ge+0]>>6&3,0>ce.$a||1<ce.$a||4<=ce.Z||1<ce.Lc||ge)T=0;else if(Vt.put=je,Vt.ac=Qe,Vt.bc=ft,Vt.ma=ce,Vt.width=T.width,Vt.height=T.height,Vt.Da=T.Da,Vt.v=T.v,Vt.va=T.va,Vt.j=T.j,Vt.o=T.o,ce.$a)e:{a(ce.$a==1),T=ri();t:for(;;){if(T==null){T=0;break e}if(a(ce!=null),ce.mc=T,T.c=ce.c,T.i=ce.i,T.l=ce.l,T.l.ma=ce,T.l.width=ce.c,T.l.height=ce.i,T.a=0,ht(T.m,he,ct,ot),!xs(ce.c,ce.i,1,T,null)||(T.ab==1&&T.gc[0].hc==3&&Ir(T.s)?(ce.ic=1,he=T.c*T.i,T.Ta=null,T.Ua=0,T.V=y(he),T.Ba=0,T.V==null?(T.a=1,T=0):T=1):(ce.ic=0,T=cn(T,ce.c)),!T))break t;T=1;break e}ce.mc=null,T=0}else T=ot>=ce.c*ce.i;ce=!T}if(ce)return null;w.ga.Lc!=1?w.Ga=0:Z=oe-F}a(w.ga!=null),a(F+Z<=oe);e:{if(T=(he=w.ga).c,oe=he.l.o,he.$a==0){if(ct=w.rc,ot=w.Vc,Vt=w.Fa,ge=w.P+1+F*T,Ce=w.mb,rt=w.nb+F*T,a(ge<=w.P+w.qc),he.Z!=0)for(a(Ua[he.Z]!=null),ce=0;ce<Z;++ce)Ua[he.Z](ct,ot,Vt,ge,Ce,rt,T),ct=Ce,ot=rt,rt+=T,ge+=T;else for(ce=0;ce<Z;++ce)p(Ce,rt,Vt,ge,T),ct=Ce,ot=rt,rt+=T,ge+=T;w.rc=ct,w.Vc=ot}else{if(a(he.mc!=null),T=F+Z,a((ce=he.mc)!=null),a(T<=ce.i),ce.C>=T)T=1;else if(he.ic||dt(),he.ic){he=ce.V,ct=ce.Ba,ot=ce.c;var kt=ce.i,it=(Vt=1,ge=ce.$/ot,Ce=ce.$%ot,rt=ce.m,_t=ce.s,ce.$),st=ot*kt,Ut=ot*T,Ot=_t.wc,jt=it<Ut?Qt(_t,Ce,ge):null;a(it<=st),a(T<=kt),a(Ir(_t));t:for(;;){for(;!rt.h&&it<Ut;){if(Ce&Ot||(jt=Qt(_t,Ce,ge)),a(jt!=null),nt(rt),256>(kt=yt(jt.G[0],jt.H[0],rt)))he[ct+it]=kt,++it,++Ce>=ot&&(Ce=0,++ge<=T&&!(ge%16)&&en(ce,ge));else{if(!(280>kt)){Vt=0;break t}kt=rr(kt-256,rt);var Ft,zt=yt(jt.G[4],jt.H[4],rt);if(nt(rt),!(it>=(zt=lr(ot,zt=rr(zt,rt)))&&st-it>=kt)){Vt=0;break t}for(Ft=0;Ft<kt;++Ft)he[ct+it+Ft]=he[ct+it+Ft-zt];for(it+=kt,Ce+=kt;Ce>=ot;)Ce-=ot,++ge<=T&&!(ge%16)&&en(ce,ge);it<Ut&&Ce&Ot&&(jt=Qt(_t,Ce,ge))}a(rt.h==Re(rt))}en(ce,ge>T?T:ge);break t}!Vt||rt.h&&it<st?(Vt=0,ce.a=rt.h?5:3):ce.$=it,T=Vt}else T=di(ce,ce.V,ce.Ba,ce.c,ce.i,T,ci);if(!T){Z=0;break e}}F+Z>=oe&&(w.Cc=1),Z=1}if(!Z)return null;if(w.Cc&&((Z=w.ga)!=null&&(Z.mc=null),w.ga=null,0<w.Ga))return alert("todo:WebPDequantizeLevels"),null}return w.nb+F*te}function k(w,T,F,Z,te,oe){for(;0<te--;){var ce,he=w,ge=T+(F?1:0),Ce=w,rt=T+(F?0:3);for(ce=0;ce<Z;++ce){var _t=Ce[rt+4*ce];_t!=255&&(_t*=32897,he[ge+4*ce+0]=he[ge+4*ce+0]*_t>>23,he[ge+4*ce+1]=he[ge+4*ce+1]*_t>>23,he[ge+4*ce+2]=he[ge+4*ce+2]*_t>>23)}T+=oe}}function re(w,T,F,Z,te){for(;0<Z--;){var oe;for(oe=0;oe<F;++oe){var ce=w[T+2*oe+0],he=15&(Ce=w[T+2*oe+1]),ge=4369*he,Ce=(240&Ce|Ce>>4)*ge>>16;w[T+2*oe+0]=(240&ce|ce>>4)*ge>>16&240|(15&ce|ce<<4)*ge>>16>>4&15,w[T+2*oe+1]=240&Ce|he}T+=te}}function Fe(w,T,F,Z,te,oe,ce,he){var ge,Ce,rt=255;for(Ce=0;Ce<te;++Ce){for(ge=0;ge<Z;++ge){var _t=w[T+ge];oe[ce+4*ge]=_t,rt&=_t}T+=F,ce+=he}return rt!=255}function tt(w,T,F,Z,te){var oe;for(oe=0;oe<te;++oe)F[Z+oe]=w[T+oe]>>8}function dt(){Os=k,Si=re,fi=Fe,rn=tt}function Rt(w,T,F){Ae[w]=function(Z,te,oe,ce,he,ge,Ce,rt,_t,ct,ot,Vt,kt,it,st,Ut,Ot){var jt,Ft=Ot-1>>1,zt=he[ge+0]|Ce[rt+0]<<16,kr=_t[ct+0]|ot[Vt+0]<<16;a(Z!=null);var cr=3*zt+kr+131074>>2;for(T(Z[te+0],255&cr,cr>>16,kt,it),oe!=null&&(cr=3*kr+zt+131074>>2,T(oe[ce+0],255&cr,cr>>16,st,Ut)),jt=1;jt<=Ft;++jt){var ui=he[ge+jt]|Ce[rt+jt]<<16,$r=_t[ct+jt]|ot[Vt+jt]<<16,li=zt+ui+kr+$r+524296,qr=li+2*(ui+kr)>>3;cr=qr+zt>>1,zt=(li=li+2*(zt+$r)>>3)+ui>>1,T(Z[te+2*jt-1],255&cr,cr>>16,kt,it+(2*jt-1)*F),T(Z[te+2*jt-0],255&zt,zt>>16,kt,it+(2*jt-0)*F),oe!=null&&(cr=li+kr>>1,zt=qr+$r>>1,T(oe[ce+2*jt-1],255&cr,cr>>16,st,Ut+(2*jt-1)*F),T(oe[ce+2*jt+0],255&zt,zt>>16,st,Ut+(2*jt+0)*F)),zt=ui,kr=$r}1&Ot||(cr=3*zt+kr+131074>>2,T(Z[te+Ot-1],255&cr,cr>>16,kt,it+(Ot-1)*F),oe!=null&&(cr=3*kr+zt+131074>>2,T(oe[ce+Ot-1],255&cr,cr>>16,st,Ut+(Ot-1)*F)))}}function Yt(){As[Bo]=Kc,As[Oo]=Uo,As[ac]=_o,As[Bl]=qi,As[jo]=ts,As[Ic]=cc,As[Cc]=Sa,As[qo]=Uo,As[_l]=qi,As[yl]=ts,As[Ol]=cc}function mr(w){return w&-16384?0>w?0:255:w>>ku}function Er(w,T){return mr((19077*w>>8)+(26149*T>>8)-14234)}function Or(w,T,F){return mr((19077*w>>8)-(6419*T>>8)-(13320*F>>8)+8708)}function jr(w,T){return mr((19077*w>>8)+(33050*T>>8)-17685)}function ai(w,T,F,Z,te){Z[te+0]=Er(w,F),Z[te+1]=Or(w,T,F),Z[te+2]=jr(w,T)}function Di(w,T,F,Z,te){Z[te+0]=jr(w,T),Z[te+1]=Or(w,T,F),Z[te+2]=Er(w,F)}function Xi(w,T,F,Z,te){var oe=Or(w,T,F);T=oe<<3&224|jr(w,T)>>3,Z[te+0]=248&Er(w,F)|oe>>5,Z[te+1]=T}function Ci(w,T,F,Z,te){var oe=240&jr(w,T)|15;Z[te+0]=240&Er(w,F)|Or(w,T,F)>>4,Z[te+1]=oe}function Ln(w,T,F,Z,te){Z[te+0]=255,ai(w,T,F,Z,te+1)}function gn(w,T,F,Z,te){Di(w,T,F,Z,te),Z[te+3]=255}function En(w,T,F,Z,te){ai(w,T,F,Z,te),Z[te+3]=255}function zs(w,T){return 0>w?0:w>T?T:w}function Ps(w,T,F){Ae[w]=function(Z,te,oe,ce,he,ge,Ce,rt,_t){for(var ct=rt+(-2&_t)*F;rt!=ct;)T(Z[te+0],oe[ce+0],he[ge+0],Ce,rt),T(Z[te+1],oe[ce+0],he[ge+0],Ce,rt+F),te+=2,++ce,++ge,rt+=2*F;1&_t&&T(Z[te+0],oe[ce+0],he[ge+0],Ce,rt)}}function ic(w,T,F){return F==0?w==0?T==0?6:5:T==0?4:0:F}function dl(w,T,F,Z,te){switch(w>>>30){case 3:ds(T,F,Z,te,0);break;case 2:pi(T,F,Z,te);break;case 1:Un(T,F,Z,te)}}function Eo(w,T){var F,Z,te=T.M,oe=T.Nb,ce=w.oc,he=w.pc+40,ge=w.oc,Ce=w.pc+584,rt=w.oc,_t=w.pc+600;for(F=0;16>F;++F)ce[he+32*F-1]=129;for(F=0;8>F;++F)ge[Ce+32*F-1]=129,rt[_t+32*F-1]=129;for(0<te?ce[he-1-32]=ge[Ce-1-32]=rt[_t-1-32]=129:(v(ce,he-32-1,127,21),v(ge,Ce-32-1,127,9),v(rt,_t-32-1,127,9)),Z=0;Z<w.za;++Z){var ct=T.ya[T.aa+Z];if(0<Z){for(F=-1;16>F;++F)p(ce,he+32*F-4,ce,he+32*F+12,4);for(F=-1;8>F;++F)p(ge,Ce+32*F-4,ge,Ce+32*F+4,4),p(rt,_t+32*F-4,rt,_t+32*F+4,4)}var ot=w.Gd,Vt=w.Hd+Z,kt=ct.ad,it=ct.Hc;if(0<te&&(p(ce,he-32,ot[Vt].y,0,16),p(ge,Ce-32,ot[Vt].f,0,8),p(rt,_t-32,ot[Vt].ea,0,8)),ct.Za){var st=ce,Ut=he-32+16;for(0<te&&(Z>=w.za-1?v(st,Ut,ot[Vt].y[15],4):p(st,Ut,ot[Vt+1].y,0,4)),F=0;4>F;F++)st[Ut+128+F]=st[Ut+256+F]=st[Ut+384+F]=st[Ut+0+F];for(F=0;16>F;++F,it<<=2)st=ce,Ut=he+Ga[F],Zn[ct.Ob[F]](st,Ut),dl(it,kt,16*+F,st,Ut)}else if(st=ic(Z,te,ct.Ob[0]),es[st](ce,he),it!=0)for(F=0;16>F;++F,it<<=2)dl(it,kt,16*+F,ce,he+Ga[F]);for(F=ct.Gc,st=ic(Z,te,ct.Dd),Pa[st](ge,Ce),Pa[st](rt,_t),it=kt,st=ge,Ut=Ce,255&(ct=F>>0)&&(170&ct?ml(it,256,st,Ut):ps(it,256,st,Ut)),ct=rt,it=_t,255&(F>>=8)&&(170&F?ml(kt,320,ct,it):ps(kt,320,ct,it)),te<w.Ub-1&&(p(ot[Vt].y,0,ce,he+480,16),p(ot[Vt].f,0,ge,Ce+224,8),p(ot[Vt].ea,0,rt,_t+224,8)),F=8*oe*w.B,ot=w.sa,Vt=w.ta+16*Z+16*oe*w.R,kt=w.qa,ct=w.ra+8*Z+F,it=w.Ha,st=w.Ia+8*Z+F,F=0;16>F;++F)p(ot,Vt+F*w.R,ce,he+32*F,16);for(F=0;8>F;++F)p(kt,ct+F*w.B,ge,Ce+32*F,8),p(it,st+F*w.B,rt,_t+32*F,8)}}function ko(w,T,F,Z,te,oe,ce,he,ge){var Ce=[0],rt=[0],_t=0,ct=ge!=null?ge.kd:0,ot=ge??new Sn;if(w==null||12>F)return 7;ot.data=w,ot.w=T,ot.ha=F,T=[T],F=[F],ot.gb=[ot.gb];e:{var Vt=T,kt=F,it=ot.gb;if(a(w!=null),a(kt!=null),a(it!=null),it[0]=0,12<=kt[0]&&!c(w,Vt[0],"RIFF")){if(c(w,Vt[0]+8,"WEBP")){it=3;break e}var st=nr(w,Vt[0]+4);if(12>st||4294967286<st){it=3;break e}if(ct&&st>kt[0]-8){it=7;break e}it[0]=st,Vt[0]+=12,kt[0]-=12}it=0}if(it!=0)return it;for(st=0<ot.gb[0],F=F[0];;){e:{var Ut=w;kt=T,it=F;var Ot=Ce,jt=rt,Ft=Vt=[0];if((cr=_t=[_t])[0]=0,8>it[0])it=7;else{if(!c(Ut,kt[0],"VP8X")){if(nr(Ut,kt[0]+4)!=10){it=3;break e}if(18>it[0]){it=7;break e}var zt=nr(Ut,kt[0]+8),kr=1+er(Ut,kt[0]+12);if(2147483648<=kr*(Ut=1+er(Ut,kt[0]+15))){it=3;break e}Ft!=null&&(Ft[0]=zt),Ot!=null&&(Ot[0]=kr),jt!=null&&(jt[0]=Ut),kt[0]+=18,it[0]-=18,cr[0]=1}it=0}}if(_t=_t[0],Vt=Vt[0],it!=0)return it;if(kt=!!(2&Vt),!st&&_t)return 3;if(oe!=null&&(oe[0]=!!(16&Vt)),ce!=null&&(ce[0]=kt),he!=null&&(he[0]=0),ce=Ce[0],Vt=rt[0],_t&&kt&&ge==null){it=0;break}if(4>F){it=7;break}if(st&&_t||!st&&!_t&&!c(w,T[0],"ALPH")){F=[F],ot.na=[ot.na],ot.P=[ot.P],ot.Sa=[ot.Sa];e:{zt=w,it=T,st=F;var cr=ot.gb;Ot=ot.na,jt=ot.P,Ft=ot.Sa,kr=22,a(zt!=null),a(st!=null),Ut=it[0];var ui=st[0];for(a(Ot!=null),a(Ft!=null),Ot[0]=null,jt[0]=null,Ft[0]=0;;){if(it[0]=Ut,st[0]=ui,8>ui){it=7;break e}var $r=nr(zt,Ut+4);if(4294967286<$r){it=3;break e}var li=8+$r+1&-2;if(kr+=li,0<cr&&kr>cr){it=3;break e}if(!c(zt,Ut,"VP8 ")||!c(zt,Ut,"VP8L")){it=0;break e}if(ui[0]<li){it=7;break e}c(zt,Ut,"ALPH")||(Ot[0]=zt,jt[0]=Ut+8,Ft[0]=$r),Ut+=li,ui-=li}}if(F=F[0],ot.na=ot.na[0],ot.P=ot.P[0],ot.Sa=ot.Sa[0],it!=0)break}F=[F],ot.Ja=[ot.Ja],ot.xa=[ot.xa];e:if(cr=w,it=T,st=F,Ot=ot.gb[0],jt=ot.Ja,Ft=ot.xa,zt=it[0],Ut=!c(cr,zt,"VP8 "),kr=!c(cr,zt,"VP8L"),a(cr!=null),a(st!=null),a(jt!=null),a(Ft!=null),8>st[0])it=7;else{if(Ut||kr){if(cr=nr(cr,zt+4),12<=Ot&&cr>Ot-12){it=3;break e}if(ct&&cr>st[0]-8){it=7;break e}jt[0]=cr,it[0]+=8,st[0]-=8,Ft[0]=kr}else Ft[0]=5<=st[0]&&cr[zt+0]==47&&!(cr[zt+4]>>5),jt[0]=st[0];it=0}if(F=F[0],ot.Ja=ot.Ja[0],ot.xa=ot.xa[0],T=T[0],it!=0)break;if(4294967286<ot.Ja)return 3;if(he==null||kt||(he[0]=ot.xa?2:1),ce=[ce],Vt=[Vt],ot.xa){if(5>F){it=7;break}he=ce,ct=Vt,kt=oe,w==null||5>F?w=0:5<=F&&w[T+0]==47&&!(w[T+4]>>5)?(st=[0],cr=[0],Ot=[0],ht(jt=new ne,w,T,F),Pt(jt,st,cr,Ot)?(he!=null&&(he[0]=st[0]),ct!=null&&(ct[0]=cr[0]),kt!=null&&(kt[0]=Ot[0]),w=1):w=0):w=0}else{if(10>F){it=7;break}he=Vt,w==null||10>F||!rl(w,T+3,F-3)?w=0:(ct=w[T+0]|w[T+1]<<8|w[T+2]<<16,kt=16383&(w[T+7]<<8|w[T+6]),w=16383&(w[T+9]<<8|w[T+8]),1&ct||3<(ct>>1&7)||!(ct>>4&1)||ct>>5>=ot.Ja||!kt||!w?w=0:(ce&&(ce[0]=kt),he&&(he[0]=w),w=1))}if(!w||(ce=ce[0],Vt=Vt[0],_t&&(Ce[0]!=ce||rt[0]!=Vt)))return 3;ge!=null&&(ge[0]=ot,ge.offset=T-ge.w,a(4294967286>T-ge.w),a(ge.offset==ge.ha-F));break}return it==0||it==7&&_t&&ge==null?(oe!=null&&(oe[0]|=ot.na!=null&&0<ot.na.length),Z!=null&&(Z[0]=ce),te!=null&&(te[0]=Vt),0):it}function pl(w,T,F){var Z=T.width,te=T.height,oe=0,ce=0,he=Z,ge=te;if(T.Da=w!=null&&0<w.Da,T.Da&&(he=w.cd,ge=w.bd,oe=w.v,ce=w.j,11>F||(oe&=-2,ce&=-2),0>oe||0>ce||0>=he||0>=ge||oe+he>Z||ce+ge>te))return 0;if(T.v=oe,T.j=ce,T.va=oe+he,T.o=ce+ge,T.U=he,T.T=ge,T.da=w!=null&&0<w.da,T.da){if(!zr(he,ge,F=[w.ib],oe=[w.hb]))return 0;T.ib=F[0],T.hb=oe[0]}return T.ob=w!=null&&w.ob,T.Kb=w==null||!w.Sd,T.da&&(T.ob=T.ib<3*Z/4&&T.hb<3*te/4,T.Kb=0),1}function uo(w){if(w==null)return 2;if(11>w.S){var T=w.f.RGBA;T.fb+=(w.height-1)*T.A,T.A=-T.A}else T=w.f.kb,w=w.height,T.O+=(w-1)*T.fa,T.fa=-T.fa,T.N+=(w-1>>1)*T.Ab,T.Ab=-T.Ab,T.W+=(w-1>>1)*T.Db,T.Db=-T.Db,T.F!=null&&(T.J+=(w-1)*T.lb,T.lb=-T.lb);return 0}function ho(w,T,F,Z){if(Z==null||0>=w||0>=T)return 2;if(F!=null){if(F.Da){var te=F.cd,oe=F.bd,ce=-2&F.v,he=-2&F.j;if(0>ce||0>he||0>=te||0>=oe||ce+te>w||he+oe>T)return 2;w=te,T=oe}if(F.da){if(!zr(w,T,te=[F.ib],oe=[F.hb]))return 2;w=te[0],T=oe[0]}}Z.width=w,Z.height=T;e:{var ge=Z.width,Ce=Z.height;if(w=Z.S,0>=ge||0>=Ce||!(w>=Bo&&13>w))w=2;else{if(0>=Z.Rd&&Z.sd==null){ce=oe=te=T=0;var rt=(he=ge*$l[w])*Ce;if(11>w||(oe=(Ce+1)/2*(T=(ge+1)/2),w==12&&(ce=(te=ge)*Ce)),(Ce=y(rt+2*oe+ce))==null){w=1;break e}Z.sd=Ce,11>w?((ge=Z.f.RGBA).eb=Ce,ge.fb=0,ge.A=he,ge.size=rt):((ge=Z.f.kb).y=Ce,ge.O=0,ge.fa=he,ge.Fd=rt,ge.f=Ce,ge.N=0+rt,ge.Ab=T,ge.Cd=oe,ge.ea=Ce,ge.W=0+rt+oe,ge.Db=T,ge.Ed=oe,w==12&&(ge.F=Ce,ge.J=0+rt+2*oe),ge.Tc=ce,ge.lb=te)}if(T=1,te=Z.S,oe=Z.width,ce=Z.height,te>=Bo&&13>te)if(11>te)w=Z.f.RGBA,T&=(he=Math.abs(w.A))*(ce-1)+oe<=w.size,T&=he>=oe*$l[te],T&=w.eb!=null;else{w=Z.f.kb,he=(oe+1)/2,rt=(ce+1)/2,ge=Math.abs(w.fa),Ce=Math.abs(w.Ab);var _t=Math.abs(w.Db),ct=Math.abs(w.lb),ot=ct*(ce-1)+oe;T&=ge*(ce-1)+oe<=w.Fd,T&=Ce*(rt-1)+he<=w.Cd,T=(T&=_t*(rt-1)+he<=w.Ed)&ge>=oe&Ce>=he&_t>=he,T&=w.y!=null,T&=w.f!=null,T&=w.ea!=null,te==12&&(T&=ct>=oe,T&=ot<=w.Tc,T&=w.F!=null)}else T=0;w=T?0:2}}return w!=0||F!=null&&F.fd&&(w=uo(Z)),w}var pn=64,hs=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],po=24,Oa=32,zo=8,Yn=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];ir("Predictor0","PredictorAdd0"),Ae.Predictor0=function(){return 4278190080},Ae.Predictor1=function(w){return w},Ae.Predictor2=function(w,T,F){return T[F+0]},Ae.Predictor3=function(w,T,F){return T[F+1]},Ae.Predictor4=function(w,T,F){return T[F-1]},Ae.Predictor5=function(w,T,F){return or(or(w,T[F+1]),T[F+0])},Ae.Predictor6=function(w,T,F){return or(w,T[F-1])},Ae.Predictor7=function(w,T,F){return or(w,T[F+0])},Ae.Predictor8=function(w,T,F){return or(T[F-1],T[F+0])},Ae.Predictor9=function(w,T,F){return or(T[F+0],T[F+1])},Ae.Predictor10=function(w,T,F){return or(or(w,T[F-1]),or(T[F+0],T[F+1]))},Ae.Predictor11=function(w,T,F){var Z=T[F+0];return 0>=Dr(Z>>24&255,w>>24&255,(T=T[F-1])>>24&255)+Dr(Z>>16&255,w>>16&255,T>>16&255)+Dr(Z>>8&255,w>>8&255,T>>8&255)+Dr(255&Z,255&w,255&T)?Z:w},Ae.Predictor12=function(w,T,F){var Z=T[F+0];return(xr((w>>24&255)+(Z>>24&255)-((T=T[F-1])>>24&255))<<24|xr((w>>16&255)+(Z>>16&255)-(T>>16&255))<<16|xr((w>>8&255)+(Z>>8&255)-(T>>8&255))<<8|xr((255&w)+(255&Z)-(255&T)))>>>0},Ae.Predictor13=function(w,T,F){var Z=T[F-1];return(wr((w=or(w,T[F+0]))>>24&255,Z>>24&255)<<24|wr(w>>16&255,Z>>16&255)<<16|wr(w>>8&255,Z>>8&255)<<8|wr(w>>0&255,Z>>0&255))>>>0};var Rl=Ae.PredictorAdd0;Ae.PredictorAdd1=Fr,ir("Predictor2","PredictorAdd2"),ir("Predictor3","PredictorAdd3"),ir("Predictor4","PredictorAdd4"),ir("Predictor5","PredictorAdd5"),ir("Predictor6","PredictorAdd6"),ir("Predictor7","PredictorAdd7"),ir("Predictor8","PredictorAdd8"),ir("Predictor9","PredictorAdd9"),ir("Predictor10","PredictorAdd10"),ir("Predictor11","PredictorAdd11"),ir("Predictor12","PredictorAdd12"),ir("Predictor13","PredictorAdd13");var ta=Ae.PredictorAdd2;Rr("ColorIndexInverseTransform","MapARGB","32b",function(w){return w>>8&255},function(w){return w}),Rr("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(w){return w},function(w){return w>>8&255});var ii,Ds=Ae.ColorIndexInverseTransform,fl=Ae.MapARGB,nc=Ae.VP8LColorIndexInverseTransformAlpha,sc=Ae.MapAlpha,ja=Ae.VP8LPredictorsAdd=[];ja.length=16,(Ae.VP8LPredictors=[]).length=16,(Ae.VP8LPredictorsAdd_C=[]).length=16,(Ae.VP8LPredictors_C=[]).length=16;var Do,Kn,An,ra,Fs,ia,Ns,ds,pi,ml,Un,ps,Rs,Fo,fo,na,ba,qa,Bs,sa,mo,xa,Kr,Jn,Os,Si,fi,rn,_n=y(511),wa=y(2041),gl=y(225),go=y(767),No=0,Va=wa,Ro=gl,Qn=go,Ss=_n,Bo=0,Oo=1,ac=2,Bl=3,jo=4,Ic=5,Cc=6,qo=7,_l=8,yl=9,Ol=10,vl=[2,3,7],jl=[3,3,11],oc=[280,256,256,256,40],ql=[0,1,1,1,0],Ji=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Vo=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],js=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Mc=8,Vl=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],lc=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],aa=null,bl=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],xl=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Lc=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],Ec=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],kc=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Xc=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],zc=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],es=[],Zn=[],Pa=[],Yc=1,Dc=2,Ua=[],As=[];Rt("UpsampleRgbLinePair",ai,3),Rt("UpsampleBgrLinePair",Di,3),Rt("UpsampleRgbaLinePair",En,4),Rt("UpsampleBgraLinePair",gn,4),Rt("UpsampleArgbLinePair",Ln,4),Rt("UpsampleRgba4444LinePair",Ci,2),Rt("UpsampleRgb565LinePair",Xi,2);var Kc=Ae.UpsampleRgbLinePair,_o=Ae.UpsampleBgrLinePair,Uo=Ae.UpsampleRgbaLinePair,qi=Ae.UpsampleBgraLinePair,ts=Ae.UpsampleArgbLinePair,cc=Ae.UpsampleRgba4444LinePair,Sa=Ae.UpsampleRgb565LinePair,Za=16,yo=1<<Za-1,wl=-227,Ul=482,ku=6,Zl=0,Gl=y(256),Ts=y(256),hr=y(256),Pl=y(256),Fc=y(Ul-wl),Jc=y(Ul-wl);Ps("YuvToRgbRow",ai,3),Ps("YuvToBgrRow",Di,3),Ps("YuvToRgbaRow",En,4),Ps("YuvToBgraRow",gn,4),Ps("YuvToArgbRow",Ln,4),Ps("YuvToRgba4444Row",Ci,2),Ps("YuvToRgb565Row",Xi,2);var Ga=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],vo=[0,2,8],uc=[8,7,6,4,4,2,2,2,1,1,1,1],Gr=1;this.WebPDecodeRGBA=function(w,T,F,Z,te){var oe=Oo,ce=new Ra,he=new le;ce.ba=he,he.S=oe,he.width=[he.width],he.height=[he.height];var ge=he.width,Ce=he.height,rt=new Te;if(rt==null||w==null)var _t=2;else a(rt!=null),_t=ko(w,T,F,rt.width,rt.height,rt.Pd,rt.Qd,rt.format,null);if(_t!=0?ge=0:(ge!=null&&(ge[0]=rt.width[0]),Ce!=null&&(Ce[0]=rt.height[0]),ge=1),ge){he.width=he.width[0],he.height=he.height[0],Z!=null&&(Z[0]=he.width),te!=null&&(te[0]=he.height);e:{if(Z=new so,(te=new Sn).data=w,te.w=T,te.ha=F,te.kd=1,T=[0],a(te!=null),((w=ko(te.data,te.w,te.ha,null,null,null,T,null,te))==0||w==7)&&T[0]&&(w=4),(T=w)==0){if(a(ce!=null),Z.data=te.data,Z.w=te.w+te.offset,Z.ha=te.ha-te.offset,Z.put=je,Z.ac=Qe,Z.bc=ft,Z.ma=ce,te.xa){if((w=ri())==null){ce=1;break e}if(function(ct,ot){var Vt=[0],kt=[0],it=[0];t:for(;;){if(ct==null)return 0;if(ot==null)return ct.a=2,0;if(ct.l=ot,ct.a=0,ht(ct.m,ot.data,ot.w,ot.ha),!Pt(ct.m,Vt,kt,it)){ct.a=3;break t}if(ct.xb=Dc,ot.width=Vt[0],ot.height=kt[0],!xs(Vt[0],kt[0],1,ct,null))break t;return 1}return a(ct.a!=0),0}(w,Z)){if(Z=(T=ho(Z.width,Z.height,ce.Oa,ce.ba))==0){t:{Z=w;r:for(;;){if(Z==null){Z=0;break t}if(a(Z.s.yc!=null),a(Z.s.Ya!=null),a(0<Z.s.Wb),a((F=Z.l)!=null),a((te=F.ma)!=null),Z.xb!=0){if(Z.ca=te.ba,Z.tb=te.tb,a(Z.ca!=null),!pl(te.Oa,F,Bl)){Z.a=2;break r}if(!cn(Z,F.width)||F.da)break r;if((F.da||O(Z.ca.S))&&dt(),11>Z.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),Z.ca.f.kb.F!=null&&dt()),Z.Pb&&0<Z.s.ua&&Z.s.vb.X==null&&!dr(Z.s.vb,Z.s.Wa.Xa)){Z.a=1;break r}Z.xb=0}if(!di(Z,Z.V,Z.Ba,Z.c,Z.i,F.o,Sr))break r;te.Dc=Z.Ma,Z=1;break t}a(Z.a!=0),Z=0}Z=!Z}Z&&(T=w.a)}else T=w.a}else{if((w=new ao)==null){ce=1;break e}if(w.Fa=te.na,w.P=te.P,w.qc=te.Sa,za(w,Z)){if((T=ho(Z.width,Z.height,ce.Oa,ce.ba))==0){if(w.Aa=0,F=ce.Oa,a((te=w)!=null),F!=null){if(0<(ge=0>(ge=F.Md)?0:100<ge?255:255*ge/100)){for(Ce=rt=0;4>Ce;++Ce)12>(_t=te.pb[Ce]).lc&&(_t.ia=ge*uc[0>_t.lc?0:_t.lc]>>3),rt|=_t.ia;rt&&(alert("todo:VP8InitRandom"),te.ia=1)}te.Ga=F.Id,100<te.Ga?te.Ga=100:0>te.Ga&&(te.Ga=0)}nl(w,Z)||(T=w.a)}}else T=w.a}T==0&&ce.Oa!=null&&ce.Oa.fd&&(T=uo(ce.ba))}ce=T}oe=ce!=0?null:11>oe?he.f.RGBA.eb:he.f.kb.y}else oe=null;return oe};var $l=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function B(Ae,lt){for(var mt="",_e=0;_e<4;_e++)mt+=String.fromCharCode(Ae[lt++]);return mt}function V(Ae,lt){return(Ae[lt+0]<<0|Ae[lt+1]<<8|Ae[lt+2]<<16)>>>0}function U(Ae,lt){return(Ae[lt+0]<<0|Ae[lt+1]<<8|Ae[lt+2]<<16|Ae[lt+3]<<24)>>>0}new M;var J=[0],N=[0],de=[],pe=new M,De=h,fe=function(Ae,lt){var mt={},_e=0,ve=!1,$e=0,Ne=0;if(mt.frames=[],!function(Ie,Re,We,nt){for(var at=0;at<nt;at++)if(Ie[Re+at]!=We.charCodeAt(at))return!0;return!1}(Ae,lt,"RIFF",4)){var wt,ut;for(U(Ae,lt+=4),lt+=8;lt<Ae.length;){var At=B(Ae,lt),ht=U(Ae,lt+=4);lt+=4;var Tt=ht+(1&ht);switch(At){case"VP8 ":case"VP8L":mt.frames[_e]===void 0&&(mt.frames[_e]={}),(ne=mt.frames[_e]).src_off=ve?Ne:lt-8,ne.src_size=$e+ht+8,_e++,ve&&(ve=!1,$e=0,Ne=0);break;case"VP8X":(ne=mt.header={}).feature_flags=Ae[lt];var Dt=lt+4;ne.canvas_width=1+V(Ae,Dt),Dt+=3,ne.canvas_height=1+V(Ae,Dt),Dt+=3;break;case"ALPH":ve=!0,$e=Tt+8,Ne=lt-8;break;case"ANIM":(ne=mt.header).bgcolor=U(Ae,lt),Dt=lt+4,ne.loop_count=(wt=Ae)[(ut=Dt)+0]<<0|wt[ut+1]<<8,Dt+=2;break;case"ANMF":var sr,ne;(ne=mt.frames[_e]={}).offset_x=2*V(Ae,lt),lt+=3,ne.offset_y=2*V(Ae,lt),lt+=3,ne.width=1+V(Ae,lt),lt+=3,ne.height=1+V(Ae,lt),lt+=3,ne.duration=V(Ae,lt),lt+=3,sr=Ae[lt++],ne.dispose=1&sr,ne.blend=sr>>1&1}At!="ANMF"&&(lt+=Tt)}return mt}}(De,0);fe.response=De,fe.rgbaoutput=!0,fe.dataurl=!1;var ke=fe.header?fe.header:null,He=fe.frames?fe.frames:null;if(ke){ke.loop_counter=ke.loop_count,J=[ke.canvas_height],N=[ke.canvas_width];for(var Oe=0;Oe<He.length&&He[Oe].blend!=0;Oe++);}var Le=He[0],Ke=pe.WebPDecodeRGBA(De,Le.src_off,Le.src_size,N,J);Le.rgba=Ke,Le.imgwidth=N[0],Le.imgheight=J[0];for(var Ue=0;Ue<N[0]*J[0]*4;Ue++)de[Ue]=Ke[Ue];return this.width=N,this.height=J,this.data=de,this}(function(h){var a=function(){return typeof Cp=="function"},c=function(J,N,de,pe){var De=4,fe=f;switch(pe){case h.image_compression.FAST:De=1,fe=y;break;case h.image_compression.MEDIUM:De=6,fe=s;break;case h.image_compression.SLOW:De=9,fe=M}J=p(J,N,de,fe);var ke=Cp(J,{level:De});return h.__addimage__.arrayBufferToBinaryString(ke)},p=function(J,N,de,pe){for(var De,fe,ke,He=J.length/N,Oe=new Uint8Array(J.length+He),Le=V(),Ke=0;Ke<He;Ke+=1){if(ke=Ke*N,De=J.subarray(ke,ke+N),pe)Oe.set(pe(De,de,fe),ke+Ke);else{for(var Ue,Ae=Le.length,lt=[];Ue<Ae;Ue+=1)lt[Ue]=Le[Ue](De,de,fe);var mt=U(lt.concat());Oe.set(lt[mt],ke+Ke)}fe=De}return Oe},v=function(J){var N=Array.apply([],J);return N.unshift(0),N},y=function(J,N){var de,pe=[],De=J.length;pe[0]=1;for(var fe=0;fe<De;fe+=1)de=J[fe-N]||0,pe[fe+1]=J[fe]-de+256&255;return pe},f=function(J,N,de){var pe,De=[],fe=J.length;De[0]=2;for(var ke=0;ke<fe;ke+=1)pe=de&&de[ke]||0,De[ke+1]=J[ke]-pe+256&255;return De},s=function(J,N,de){var pe,De,fe=[],ke=J.length;fe[0]=3;for(var He=0;He<ke;He+=1)pe=J[He-N]||0,De=de&&de[He]||0,fe[He+1]=J[He]+256-(pe+De>>>1)&255;return fe},M=function(J,N,de){var pe,De,fe,ke,He=[],Oe=J.length;He[0]=4;for(var Le=0;Le<Oe;Le+=1)pe=J[Le-N]||0,De=de&&de[Le]||0,fe=de&&de[Le-N]||0,ke=B(pe,De,fe),He[Le+1]=J[Le]-ke+256&255;return He},B=function(J,N,de){if(J===N&&N===de)return J;var pe=Math.abs(N-de),De=Math.abs(J-de),fe=Math.abs(J+N-de-de);return pe<=De&&pe<=fe?J:De<=fe?N:de},V=function(){return[v,y,f,s,M]},U=function(J){var N=J.map(function(de){return de.reduce(function(pe,De){return pe+Math.abs(De)},0)});return N.indexOf(Math.min.apply(null,N))};h.processPNG=function(J,N,de,pe){var De,fe,ke,He,Oe,Le,Ke,Ue,Ae,lt,mt,_e,ve,$e,Ne,wt=this.decode.FLATE_DECODE,ut="";if(this.__addimage__.isArrayBuffer(J)&&(J=new Uint8Array(J)),this.__addimage__.isArrayBufferView(J)){if(J=(ke=new qv(J)).imgData,fe=ke.bits,De=ke.colorSpace,Oe=ke.colors,[4,6].indexOf(ke.colorType)!==-1){if(ke.bits===8){Ae=(Ue=ke.pixelBitlength==32?new Uint32Array(ke.decodePixels().buffer):ke.pixelBitlength==16?new Uint16Array(ke.decodePixels().buffer):new Uint8Array(ke.decodePixels().buffer)).length,mt=new Uint8Array(Ae*ke.colors),lt=new Uint8Array(Ae);var At,ht=ke.pixelBitlength-ke.bits;for($e=0,Ne=0;$e<Ae;$e++){for(ve=Ue[$e],At=0;At<ht;)mt[Ne++]=ve>>>At&255,At+=ke.bits;lt[$e]=ve>>>At&255}}if(ke.bits===16){Ae=(Ue=new Uint32Array(ke.decodePixels().buffer)).length,mt=new Uint8Array(Ae*(32/ke.pixelBitlength)*ke.colors),lt=new Uint8Array(Ae*(32/ke.pixelBitlength)),_e=ke.colors>1,$e=0,Ne=0;for(var Tt=0;$e<Ae;)ve=Ue[$e++],mt[Ne++]=ve>>>0&255,_e&&(mt[Ne++]=ve>>>16&255,ve=Ue[$e++],mt[Ne++]=ve>>>0&255),lt[Tt++]=ve>>>16&255;fe=8}pe!==h.image_compression.NONE&&a()?(J=c(mt,ke.width*ke.colors,ke.colors,pe),Ke=c(lt,ke.width,1,pe)):(J=mt,Ke=lt,wt=void 0)}if(ke.colorType===3&&(De=this.color_spaces.INDEXED,Le=ke.palette,ke.transparency.indexed)){var Dt=ke.transparency.indexed,sr=0;for($e=0,Ae=Dt.length;$e<Ae;++$e)sr+=Dt[$e];if((sr/=255)===Ae-1&&Dt.indexOf(0)!==-1)He=[Dt.indexOf(0)];else if(sr!==Ae){for(Ue=ke.decodePixels(),lt=new Uint8Array(Ue.length),$e=0,Ae=Ue.length;$e<Ae;$e++)lt[$e]=Dt[Ue[$e]];Ke=c(lt,ke.width,1)}}var ne=function(Ie){var Re;switch(Ie){case h.image_compression.FAST:Re=11;break;case h.image_compression.MEDIUM:Re=13;break;case h.image_compression.SLOW:Re=14;break;default:Re=12}return Re}(pe);return wt===this.decode.FLATE_DECODE&&(ut="/Predictor "+ne+" "),ut+="/Colors "+Oe+" /BitsPerComponent "+fe+" /Columns "+ke.width,(this.__addimage__.isArrayBuffer(J)||this.__addimage__.isArrayBufferView(J))&&(J=this.__addimage__.arrayBufferToBinaryString(J)),(Ke&&this.__addimage__.isArrayBuffer(Ke)||this.__addimage__.isArrayBufferView(Ke))&&(Ke=this.__addimage__.arrayBufferToBinaryString(Ke)),{alias:de,data:J,index:N,filter:wt,decodeParameters:ut,transparency:He,palette:Le,sMask:Ke,predictor:ne,width:ke.width,height:ke.height,bitsPerComponent:fe,colorSpace:De}}}})(Br.API),function(h){h.processGIF89A=function(a,c,p,v){var y=new Vv(a),f=y.width,s=y.height,M=[];y.decodeAndBlitFrameRGBA(0,M);var B={data:M,width:f,height:s},V=new gp(100).encode(B,100);return h.processJPEG.call(this,V,c,p,v)},h.processGIF87A=h.processGIF89A}(Br.API),Yo.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var h=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(h);for(var a=0;a<h;a++){var c=this.datav.getUint8(this.pos++,!0),p=this.datav.getUint8(this.pos++,!0),v=this.datav.getUint8(this.pos++,!0),y=this.datav.getUint8(this.pos++,!0);this.palette[a]={red:v,green:p,blue:c,quad:y}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Yo.prototype.parseBGR=function(){this.pos=this.offset;try{var h="bit"+this.bitPP,a=this.width*this.height*4;this.data=new Uint8Array(a),this[h]()}catch(c){Yi.log("bit decode error:"+c)}},Yo.prototype.bit1=function(){var h,a=Math.ceil(this.width/8),c=a%4;for(h=this.height-1;h>=0;h--){for(var p=this.bottom_up?h:this.height-1-h,v=0;v<a;v++)for(var y=this.datav.getUint8(this.pos++,!0),f=p*this.width*4+8*v*4,s=0;s<8&&8*v+s<this.width;s++){var M=this.palette[y>>7-s&1];this.data[f+4*s]=M.blue,this.data[f+4*s+1]=M.green,this.data[f+4*s+2]=M.red,this.data[f+4*s+3]=255}c!==0&&(this.pos+=4-c)}},Yo.prototype.bit4=function(){for(var h=Math.ceil(this.width/2),a=h%4,c=this.height-1;c>=0;c--){for(var p=this.bottom_up?c:this.height-1-c,v=0;v<h;v++){var y=this.datav.getUint8(this.pos++,!0),f=p*this.width*4+2*v*4,s=y>>4,M=15&y,B=this.palette[s];if(this.data[f]=B.blue,this.data[f+1]=B.green,this.data[f+2]=B.red,this.data[f+3]=255,2*v+1>=this.width)break;B=this.palette[M],this.data[f+4]=B.blue,this.data[f+4+1]=B.green,this.data[f+4+2]=B.red,this.data[f+4+3]=255}a!==0&&(this.pos+=4-a)}},Yo.prototype.bit8=function(){for(var h=this.width%4,a=this.height-1;a>=0;a--){for(var c=this.bottom_up?a:this.height-1-a,p=0;p<this.width;p++){var v=this.datav.getUint8(this.pos++,!0),y=c*this.width*4+4*p;if(v<this.palette.length){var f=this.palette[v];this.data[y]=f.red,this.data[y+1]=f.green,this.data[y+2]=f.blue,this.data[y+3]=255}else this.data[y]=255,this.data[y+1]=255,this.data[y+2]=255,this.data[y+3]=255}h!==0&&(this.pos+=4-h)}},Yo.prototype.bit15=function(){for(var h=this.width%3,a=parseInt("11111",2),c=this.height-1;c>=0;c--){for(var p=this.bottom_up?c:this.height-1-c,v=0;v<this.width;v++){var y=this.datav.getUint16(this.pos,!0);this.pos+=2;var f=(y&a)/a*255|0,s=(y>>5&a)/a*255|0,M=(y>>10&a)/a*255|0,B=y>>15?255:0,V=p*this.width*4+4*v;this.data[V]=M,this.data[V+1]=s,this.data[V+2]=f,this.data[V+3]=B}this.pos+=h}},Yo.prototype.bit16=function(){for(var h=this.width%3,a=parseInt("11111",2),c=parseInt("111111",2),p=this.height-1;p>=0;p--){for(var v=this.bottom_up?p:this.height-1-p,y=0;y<this.width;y++){var f=this.datav.getUint16(this.pos,!0);this.pos+=2;var s=(f&a)/a*255|0,M=(f>>5&c)/c*255|0,B=(f>>11)/a*255|0,V=v*this.width*4+4*y;this.data[V]=B,this.data[V+1]=M,this.data[V+2]=s,this.data[V+3]=255}this.pos+=h}},Yo.prototype.bit24=function(){for(var h=this.height-1;h>=0;h--){for(var a=this.bottom_up?h:this.height-1-h,c=0;c<this.width;c++){var p=this.datav.getUint8(this.pos++,!0),v=this.datav.getUint8(this.pos++,!0),y=this.datav.getUint8(this.pos++,!0),f=a*this.width*4+4*c;this.data[f]=y,this.data[f+1]=v,this.data[f+2]=p,this.data[f+3]=255}this.pos+=this.width%4}},Yo.prototype.bit32=function(){for(var h=this.height-1;h>=0;h--)for(var a=this.bottom_up?h:this.height-1-h,c=0;c<this.width;c++){var p=this.datav.getUint8(this.pos++,!0),v=this.datav.getUint8(this.pos++,!0),y=this.datav.getUint8(this.pos++,!0),f=this.datav.getUint8(this.pos++,!0),s=a*this.width*4+4*c;this.data[s]=y,this.data[s+1]=v,this.data[s+2]=p,this.data[s+3]=f}},Yo.prototype.getData=function(){return this.data},function(h){h.processBMP=function(a,c,p,v){var y=new Yo(a,!1),f=y.width,s=y.height,M={data:y.getData(),width:f,height:s},B=new gp(100).encode(M,100);return h.processJPEG.call(this,B,c,p,v)}}(Br.API),Mg.prototype.getData=function(){return this.data},function(h){h.processWEBP=function(a,c,p,v){var y=new Mg(a),f=y.width,s=y.height,M={data:y.getData(),width:f,height:s},B=new gp(100).encode(M,100);return h.processJPEG.call(this,B,c,p,v)}}(Br.API),Br.API.processRGBA=function(h,a,c){for(var p=h.data,v=p.length,y=new Uint8Array(v/4*3),f=new Uint8Array(v/4),s=0,M=0,B=0;B<v;B+=4){var V=p[B],U=p[B+1],J=p[B+2],N=p[B+3];y[s++]=V,y[s++]=U,y[s++]=J,f[M++]=N}var de=this.__addimage__.arrayBufferToBinaryString(y);return{alpha:this.__addimage__.arrayBufferToBinaryString(f),data:de,index:a,alias:c,colorSpace:"DeviceRGB",bitsPerComponent:8,width:h.width,height:h.height}},Br.API.setLanguage=function(h){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[h]!==void 0&&(this.internal.languageSettings.languageCode=h,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},gu=Br.API,Zh=gu.getCharWidthsArray=function(h,a){var c,p,v=(a=a||{}).font||this.internal.getFont(),y=a.fontSize||this.internal.getFontSize(),f=a.charSpace||this.internal.getCharSpace(),s=a.widths?a.widths:v.metadata.Unicode.widths,M=s.fof?s.fof:1,B=a.kerning?a.kerning:v.metadata.Unicode.kerning,V=B.fof?B.fof:1,U=a.doKerning!==!1,J=0,N=h.length,de=0,pe=s[0]||M,De=[];for(c=0;c<N;c++)p=h.charCodeAt(c),typeof v.metadata.widthOfString=="function"?De.push((v.metadata.widthOfGlyph(v.metadata.characterToGlyph(p))+f*(1e3/y)||0)/1e3):(J=U&&Ri(B[p])==="object"&&!isNaN(parseInt(B[p][de],10))?B[p][de]/V:0,De.push((s[p]||pe)/M+J)),de=p;return De},Ag=gu.getStringUnitWidth=function(h,a){var c=(a=a||{}).fontSize||this.internal.getFontSize(),p=a.font||this.internal.getFont(),v=a.charSpace||this.internal.getCharSpace();return gu.processArabic&&(h=gu.processArabic(h)),typeof p.metadata.widthOfString=="function"?p.metadata.widthOfString(h,c,v)/c:Zh.apply(this,arguments).reduce(function(y,f){return y+f},0)},Tg=function(h,a,c,p){for(var v=[],y=0,f=h.length,s=0;y!==f&&s+a[y]<c;)s+=a[y],y++;v.push(h.slice(0,y));var M=y;for(s=0;y!==f;)s+a[y]>p&&(v.push(h.slice(M,y)),s=0,M=y),s+=a[y],y++;return M!==y&&v.push(h.slice(M,y)),v},Ig=function(h,a,c){c||(c={});var p,v,y,f,s,M,B,V=[],U=[V],J=c.textIndent||0,N=0,de=0,pe=h.split(" "),De=Zh.apply(this,[" ",c])[0];if(M=c.lineIndent===-1?pe[0].length+2:c.lineIndent||0){var fe=Array(M).join(" "),ke=[];pe.map(function(Oe){(Oe=Oe.split(/\s*\n/)).length>1?ke=ke.concat(Oe.map(function(Le,Ke){return(Ke&&Le.length?`
`:"")+Le})):ke.push(Oe[0])}),pe=ke,M=Ag.apply(this,[fe,c])}for(y=0,f=pe.length;y<f;y++){var He=0;if(p=pe[y],M&&p[0]==`
`&&(p=p.substr(1),He=1),J+N+(de=(v=Zh.apply(this,[p,c])).reduce(function(Oe,Le){return Oe+Le},0))>a||He){if(de>a){for(s=Tg.apply(this,[p,v,a-(J+N),a]),V.push(s.shift()),V=[s.pop()];s.length;)U.push([s.shift()]);de=v.slice(p.length-(V[0]?V[0].length:0)).reduce(function(Oe,Le){return Oe+Le},0)}else V=[p];U.push(V),J=de+M,N=De}else V.push(p),J+=N+de,N=De}return B=M?function(Oe,Le){return(Le?fe:"")+Oe.join(" ")}:function(Oe){return Oe.join(" ")},U.map(B)},gu.splitTextToSize=function(h,a,c){var p,v=(c=c||{}).fontSize||this.internal.getFontSize(),y=(function(V){if(V.widths&&V.kerning)return{widths:V.widths,kerning:V.kerning};var U=this.internal.getFont(V.fontName,V.fontStyle);return U.metadata.Unicode?{widths:U.metadata.Unicode.widths||{0:1},kerning:U.metadata.Unicode.kerning||{}}:{font:U.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,c);p=Array.isArray(h)?h:String(h).split(/\r?\n/);var f=1*this.internal.scaleFactor*a/v;y.textIndent=c.textIndent?1*c.textIndent*this.internal.scaleFactor/v:0,y.lineIndent=c.lineIndent;var s,M,B=[];for(s=0,M=p.length;s<M;s++)B=B.concat(Ig.apply(this,[p[s],f,y]));return B},function(h){h.__fontmetrics__=h.__fontmetrics__||{};for(var a="klmnopqrstuvwxyz",c={},p={},v=0;v<a.length;v++)c[a[v]]="0123456789abcdef"[v],p["0123456789abcdef"[v]]=a[v];var y=function(U){return"0x"+parseInt(U,10).toString(16)},f=h.__fontmetrics__.compress=function(U){var J,N,de,pe,De=["{"];for(var fe in U){if(J=U[fe],isNaN(parseInt(fe,10))?N="'"+fe+"'":(fe=parseInt(fe,10),N=(N=y(fe).slice(2)).slice(0,-1)+p[N.slice(-1)]),typeof J=="number")J<0?(de=y(J).slice(3),pe="-"):(de=y(J).slice(2),pe=""),de=pe+de.slice(0,-1)+p[de.slice(-1)];else{if(Ri(J)!=="object")throw new Error("Don't know what to do with value type "+Ri(J)+".");de=f(J)}De.push(N+de)}return De.push("}"),De.join("")},s=h.__fontmetrics__.uncompress=function(U){if(typeof U!="string")throw new Error("Invalid argument passed to uncompress.");for(var J,N,de,pe,De={},fe=1,ke=De,He=[],Oe="",Le="",Ke=U.length-1,Ue=1;Ue<Ke;Ue+=1)(pe=U[Ue])=="'"?J?(de=J.join(""),J=void 0):J=[]:J?J.push(pe):pe=="{"?(He.push([ke,de]),ke={},de=void 0):pe=="}"?((N=He.pop())[0][N[1]]=ke,de=void 0,ke=N[0]):pe=="-"?fe=-1:de===void 0?c.hasOwnProperty(pe)?(Oe+=c[pe],de=parseInt(Oe,16)*fe,fe=1,Oe=""):Oe+=pe:c.hasOwnProperty(pe)?(Le+=c[pe],ke[de]=parseInt(Le,16)*fe,fe=1,de=void 0,Le=""):Le+=pe;return De},M={codePages:["WinAnsiEncoding"],WinAnsiEncoding:s("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},B={Unicode:{Courier:M,"Courier-Bold":M,"Courier-BoldOblique":M,"Courier-Oblique":M,Helvetica:M,"Helvetica-Bold":M,"Helvetica-BoldOblique":M,"Helvetica-Oblique":M,"Times-Roman":M,"Times-Bold":M,"Times-BoldItalic":M,"Times-Italic":M}},V={Unicode:{"Courier-Oblique":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":s("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":s("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":s("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:s("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:s("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":s("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:s("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":s("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":s("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":s("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};h.events.push(["addFont",function(U){var J=U.font,N=V.Unicode[J.postScriptName];N&&(J.metadata.Unicode={},J.metadata.Unicode.widths=N.widths,J.metadata.Unicode.kerning=N.kerning);var de=B.Unicode[J.postScriptName];de&&(J.metadata.Unicode.encoding=de,J.encoding=de.codePages[0])}])}(Br.API),function(h){var a=function(c){for(var p=c.length,v=new Uint8Array(p),y=0;y<p;y++)v[y]=c.charCodeAt(y);return v};h.API.events.push(["addFont",function(c){var p=void 0,v=c.font,y=c.instance;if(!v.isStandardFont){if(y===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+v.postScriptName+"').");if(typeof(p=y.existsFileInVFS(v.postScriptName)===!1?y.loadFile(v.postScriptName):y.getFileFromVFS(v.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+v.postScriptName+"').");(function(f,s){s=/^\x00\x01\x00\x00/.test(s)?a(s):a(ih(s)),f.metadata=h.API.TTFFont.open(s),f.metadata.Unicode=f.metadata.Unicode||{encoding:{},kerning:{},widths:[]},f.metadata.glyIdsUsed=[0]})(v,p)}}])}(Br),function(h){function a(){return(Ur.canvg?Promise.resolve(Ur.canvg):Pp(()=>import("./index.es-H945btOb-DBqiZZbm.js"),[])).catch(function(c){return Promise.reject(new Error("Could not load canvg: "+c))}).then(function(c){return c.default?c.default:c})}Br.API.addSvgAsImage=function(c,p,v,y,f,s,M,B){if(isNaN(p)||isNaN(v))throw Yi.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(y)||isNaN(f))throw Yi.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var V=document.createElement("canvas");V.width=y,V.height=f;var U=V.getContext("2d");U.fillStyle="#fff",U.fillRect(0,0,V.width,V.height);var J={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},N=this;return a().then(function(de){return de.fromString(U,c,J)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(de){return de.render(J)}).then(function(){N.addImage(V.toDataURL("image/jpeg",1),p,v,y,f,M,B)})}}(),Br.API.putTotalPages=function(h){var a,c=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(a=new RegExp(h,"g"),c=this.internal.getNumberOfPages()):(a=new RegExp(this.pdfEscape16(h,this.internal.getFont()),"g"),c=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var p=1;p<=this.internal.getNumberOfPages();p++)for(var v=0;v<this.internal.pages[p].length;v++)this.internal.pages[p][v]=this.internal.pages[p][v].replace(a,c);return this},Br.API.viewerPreferences=function(h,a){var c;h=h||{},a=a||!1;var p,v,y,f={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},s=Object.keys(f),M=[],B=0,V=0,U=0;function J(de,pe){var De,fe=!1;for(De=0;De<de.length;De+=1)de[De]===pe&&(fe=!0);return fe}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(f)),this.internal.viewerpreferences.isSubscribed=!1),c=this.internal.viewerpreferences.configuration,h==="reset"||a===!0){var N=s.length;for(U=0;U<N;U+=1)c[s[U]].value=c[s[U]].defaultValue,c[s[U]].explicitSet=!1}if(Ri(h)==="object"){for(v in h)if(y=h[v],J(s,v)&&y!==void 0){if(c[v].type==="boolean"&&typeof y=="boolean")c[v].value=y;else if(c[v].type==="name"&&J(c[v].valueSet,y))c[v].value=y;else if(c[v].type==="integer"&&Number.isInteger(y))c[v].value=y;else if(c[v].type==="array"){for(B=0;B<y.length;B+=1)if(p=!0,y[B].length===1&&typeof y[B][0]=="number")M.push(String(y[B]-1));else if(y[B].length>1){for(V=0;V<y[B].length;V+=1)typeof y[B][V]!="number"&&(p=!1);p===!0&&M.push([y[B][0]-1,y[B][1]-1].join(" "))}c[v].value="["+M.join(" ")+"]"}else c[v].value=c[v].defaultValue;c[v].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var de,pe=[];for(de in c)c[de].explicitSet===!0&&(c[de].type==="name"?pe.push("/"+de+" /"+c[de].value):pe.push("/"+de+" "+c[de].value));pe.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+pe.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=c,this},function(h){var a=function(){var p='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',v=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),y=unescape(encodeURIComponent(p)),f=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),s=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),M=unescape(encodeURIComponent("</x:xmpmeta>")),B=y.length+f.length+s.length+v.length+M.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+B+" >>"),this.internal.write("stream"),this.internal.write(v+y+f+s+M),this.internal.write("endstream"),this.internal.write("endobj")},c=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};h.addMetadata=function(p,v){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:p,namespaceuri:v||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",c),this.internal.events.subscribe("postPutResources",a)),this}}(Br.API),function(h){var a=h.API,c=a.pdfEscape16=function(y,f){for(var s,M=f.metadata.Unicode.widths,B=["","0","00","000","0000"],V=[""],U=0,J=y.length;U<J;++U){if(s=f.metadata.characterToGlyph(y.charCodeAt(U)),f.metadata.glyIdsUsed.push(s),f.metadata.toUnicode[s]=y.charCodeAt(U),M.indexOf(s)==-1&&(M.push(s),M.push([parseInt(f.metadata.widthOfGlyph(s),10)])),s=="0")return V.join("");s=s.toString(16),V.push(B[4-s.length],s)}return V.join("")},p=function(y){var f,s,M,B,V,U,J;for(V=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,M=[],U=0,J=(s=Object.keys(y).sort(function(N,de){return N-de})).length;U<J;U++)f=s[U],M.length>=100&&(V+=`
`+M.length+` beginbfchar
`+M.join(`
`)+`
endbfchar`,M=[]),y[f]!==void 0&&y[f]!==null&&typeof y[f].toString=="function"&&(B=("0000"+y[f].toString(16)).slice(-4),f=("0000"+(+f).toString(16)).slice(-4),M.push("<"+f+"><"+B+">"));return M.length&&(V+=`
`+M.length+` beginbfchar
`+M.join(`
`)+`
endbfchar
`),V+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};a.events.push(["putFont",function(y){(function(f){var s=f.font,M=f.out,B=f.newObject,V=f.putStream;if(s.metadata instanceof h.API.TTFFont&&s.encoding==="Identity-H"){for(var U=s.metadata.Unicode.widths,J=s.metadata.subset.encode(s.metadata.glyIdsUsed,1),N="",de=0;de<J.length;de++)N+=String.fromCharCode(J[de]);var pe=B();V({data:N,addLength1:!0,objectId:pe}),M("endobj");var De=B();V({data:p(s.metadata.toUnicode),addLength1:!0,objectId:De}),M("endobj");var fe=B();M("<<"),M("/Type /FontDescriptor"),M("/FontName /"+vu(s.fontName)),M("/FontFile2 "+pe+" 0 R"),M("/FontBBox "+h.API.PDFObject.convert(s.metadata.bbox)),M("/Flags "+s.metadata.flags),M("/StemV "+s.metadata.stemV),M("/ItalicAngle "+s.metadata.italicAngle),M("/Ascent "+s.metadata.ascender),M("/Descent "+s.metadata.decender),M("/CapHeight "+s.metadata.capHeight),M(">>"),M("endobj");var ke=B();M("<<"),M("/Type /Font"),M("/BaseFont /"+vu(s.fontName)),M("/FontDescriptor "+fe+" 0 R"),M("/W "+h.API.PDFObject.convert(U)),M("/CIDToGIDMap /Identity"),M("/DW 1000"),M("/Subtype /CIDFontType2"),M("/CIDSystemInfo"),M("<<"),M("/Supplement 0"),M("/Registry (Adobe)"),M("/Ordering ("+s.encoding+")"),M(">>"),M(">>"),M("endobj"),s.objectNumber=B(),M("<<"),M("/Type /Font"),M("/Subtype /Type0"),M("/ToUnicode "+De+" 0 R"),M("/BaseFont /"+vu(s.fontName)),M("/Encoding /"+s.encoding),M("/DescendantFonts ["+ke+" 0 R]"),M(">>"),M("endobj"),s.isAlreadyPutted=!0}})(y)}]),a.events.push(["putFont",function(y){(function(f){var s=f.font,M=f.out,B=f.newObject,V=f.putStream;if(s.metadata instanceof h.API.TTFFont&&s.encoding==="WinAnsiEncoding"){for(var U=s.metadata.rawData,J="",N=0;N<U.length;N++)J+=String.fromCharCode(U[N]);var de=B();V({data:J,addLength1:!0,objectId:de}),M("endobj");var pe=B();V({data:p(s.metadata.toUnicode),addLength1:!0,objectId:pe}),M("endobj");var De=B();M("<<"),M("/Descent "+s.metadata.decender),M("/CapHeight "+s.metadata.capHeight),M("/StemV "+s.metadata.stemV),M("/Type /FontDescriptor"),M("/FontFile2 "+de+" 0 R"),M("/Flags 96"),M("/FontBBox "+h.API.PDFObject.convert(s.metadata.bbox)),M("/FontName /"+vu(s.fontName)),M("/ItalicAngle "+s.metadata.italicAngle),M("/Ascent "+s.metadata.ascender),M(">>"),M("endobj"),s.objectNumber=B();for(var fe=0;fe<s.metadata.hmtx.widths.length;fe++)s.metadata.hmtx.widths[fe]=parseInt(s.metadata.hmtx.widths[fe]*(1e3/s.metadata.head.unitsPerEm));M("<</Subtype/TrueType/Type/Font/ToUnicode "+pe+" 0 R/BaseFont/"+vu(s.fontName)+"/FontDescriptor "+De+" 0 R/Encoding/"+s.encoding+" /FirstChar 29 /LastChar 255 /Widths "+h.API.PDFObject.convert(s.metadata.hmtx.widths)+">>"),M("endobj"),s.isAlreadyPutted=!0}})(y)}]);var v=function(y){var f,s=y.text||"",M=y.x,B=y.y,V=y.options||{},U=y.mutex||{},J=U.pdfEscape,N=U.activeFontKey,de=U.fonts,pe=N,De="",fe=0,ke="",He=de[pe].encoding;if(de[pe].encoding!=="Identity-H")return{text:s,x:M,y:B,options:V,mutex:U};for(ke=s,pe=N,Array.isArray(s)&&(ke=s[0]),fe=0;fe<ke.length;fe+=1)de[pe].metadata.hasOwnProperty("cmap")&&(f=de[pe].metadata.cmap.unicode.codeMap[ke[fe].charCodeAt(0)]),f||ke[fe].charCodeAt(0)<256&&de[pe].metadata.hasOwnProperty("Unicode")?De+=ke[fe]:De+="";var Oe="";return parseInt(pe.slice(1))<14||He==="WinAnsiEncoding"?Oe=J(De,pe).split("").map(function(Le){return Le.charCodeAt(0).toString(16)}).join(""):He==="Identity-H"&&(Oe=c(De,de[pe])),U.isHex=!0,{text:Oe,x:M,y:B,options:V,mutex:U}};a.events.push(["postProcessText",function(y){var f=y.text||"",s=[],M={text:f,x:y.x,y:y.y,options:y.options,mutex:y.mutex};if(Array.isArray(f)){var B=0;for(B=0;B<f.length;B+=1)Array.isArray(f[B])&&f[B].length===3?s.push([v(Object.assign({},M,{text:f[B][0]})).text,f[B][1],f[B][2]]):s.push(v(Object.assign({},M,{text:f[B]})).text);y.text=s}else y.text=v(Object.assign({},M,{text:f})).text}])}(Br),function(h){var a=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};h.existsFileInVFS=function(c){return a.call(this),this.internal.vFS[c]!==void 0},h.addFileToVFS=function(c,p){return a.call(this),this.internal.vFS[c]=p,this},h.getFileFromVFS=function(c){return a.call(this),this.internal.vFS[c]!==void 0?this.internal.vFS[c]:null}}(Br.API),function(h){h.__bidiEngine__=h.prototype.__bidiEngine__=function(p){var v,y,f,s,M,B,V,U=a,J=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],N=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],de={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},pe={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},De=["(",")","(","<",">","<","[","]","[","{","}","{","«","»","«","‹","›","‹","⁅","⁆","⁅","⁽","⁾","⁽","₍","₎","₍","≤","≥","≤","〈","〉","〈","﹙","﹚","﹙","﹛","﹜","﹛","﹝","﹞","﹝","﹤","﹥","﹤"],fe=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),ke=!1,He=0;this.__bidiEngine__={};var Oe=function(_e){var ve=_e.charCodeAt(),$e=ve>>8,Ne=pe[$e];return Ne!==void 0?U[256*Ne+(255&ve)]:$e===252||$e===253?"AL":fe.test($e)?"L":$e===8?"R":"N"},Le=function(_e){for(var ve,$e=0;$e<_e.length;$e++){if((ve=Oe(_e.charAt($e)))==="L")return!1;if(ve==="R")return!0}return!1},Ke=function(_e,ve,$e,Ne){var wt,ut,At,ht,Tt=ve[Ne];switch(Tt){case"L":case"R":ke=!1;break;case"N":case"AN":break;case"EN":ke&&(Tt="AN");break;case"AL":ke=!0,Tt="R";break;case"WS":Tt="N";break;case"CS":Ne<1||Ne+1>=ve.length||(wt=$e[Ne-1])!=="EN"&&wt!=="AN"||(ut=ve[Ne+1])!=="EN"&&ut!=="AN"?Tt="N":ke&&(ut="AN"),Tt=ut===wt?ut:"N";break;case"ES":Tt=(wt=Ne>0?$e[Ne-1]:"B")==="EN"&&Ne+1<ve.length&&ve[Ne+1]==="EN"?"EN":"N";break;case"ET":if(Ne>0&&$e[Ne-1]==="EN"){Tt="EN";break}if(ke){Tt="N";break}for(At=Ne+1,ht=ve.length;At<ht&&ve[At]==="ET";)At++;Tt=At<ht&&ve[At]==="EN"?"EN":"N";break;case"NSM":if(f&&!s){for(ht=ve.length,At=Ne+1;At<ht&&ve[At]==="NSM";)At++;if(At<ht){var Dt=_e[Ne],sr=Dt>=1425&&Dt<=2303||Dt===64286;if(wt=ve[At],sr&&(wt==="R"||wt==="AL")){Tt="R";break}}}Tt=Ne<1||(wt=ve[Ne-1])==="B"?"N":$e[Ne-1];break;case"B":ke=!1,v=!0,Tt=He;break;case"S":y=!0,Tt="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":ke=!1;break;case"BN":Tt="N"}return Tt},Ue=function(_e,ve,$e){var Ne=_e.split("");return $e&&Ae(Ne,$e,{hiLevel:He}),Ne.reverse(),ve&&ve.reverse(),Ne.join("")},Ae=function(_e,ve,$e){var Ne,wt,ut,At,ht,Tt=-1,Dt=_e.length,sr=0,ne=[],Ie=He?N:J,Re=[];for(ke=!1,v=!1,y=!1,wt=0;wt<Dt;wt++)Re[wt]=Oe(_e[wt]);for(ut=0;ut<Dt;ut++){if(ht=sr,ne[ut]=Ke(_e,Re,ne,ut),Ne=240&(sr=Ie[ht][de[ne[ut]]]),sr&=15,ve[ut]=At=Ie[sr][5],Ne>0)if(Ne===16){for(wt=Tt;wt<ut;wt++)ve[wt]=1;Tt=-1}else Tt=-1;if(Ie[sr][6])Tt===-1&&(Tt=ut);else if(Tt>-1){for(wt=Tt;wt<ut;wt++)ve[wt]=At;Tt=-1}Re[ut]==="B"&&(ve[ut]=0),$e.hiLevel|=At}y&&function(We,nt,at){for(var pt=0;pt<at;pt++)if(We[pt]==="S"){nt[pt]=He;for(var gt=pt-1;gt>=0&&We[gt]==="WS";gt--)nt[gt]=He}}(Re,ve,Dt)},lt=function(_e,ve,$e,Ne,wt){if(!(wt.hiLevel<_e)){if(_e===1&&He===1&&!v)return ve.reverse(),void($e&&$e.reverse());for(var ut,At,ht,Tt,Dt=ve.length,sr=0;sr<Dt;){if(Ne[sr]>=_e){for(ht=sr+1;ht<Dt&&Ne[ht]>=_e;)ht++;for(Tt=sr,At=ht-1;Tt<At;Tt++,At--)ut=ve[Tt],ve[Tt]=ve[At],ve[At]=ut,$e&&(ut=$e[Tt],$e[Tt]=$e[At],$e[At]=ut);sr=ht}sr++}}},mt=function(_e,ve,$e){var Ne=_e.split(""),wt={hiLevel:He};return $e||($e=[]),Ae(Ne,$e,wt),function(ut,At,ht){if(ht.hiLevel!==0&&V)for(var Tt,Dt=0;Dt<ut.length;Dt++)At[Dt]===1&&(Tt=De.indexOf(ut[Dt]))>=0&&(ut[Dt]=De[Tt+1])}(Ne,$e,wt),lt(2,Ne,ve,$e,wt),lt(1,Ne,ve,$e,wt),Ne.join("")};return this.__bidiEngine__.doBidiReorder=function(_e,ve,$e){if(function(wt,ut){if(ut)for(var At=0;At<wt.length;At++)ut[At]=At;s===void 0&&(s=Le(wt)),B===void 0&&(B=Le(wt))}(_e,ve),f||!M||B)if(f&&M&&s^B)He=s?1:0,_e=Ue(_e,ve,$e);else if(!f&&M&&B)He=s?1:0,_e=mt(_e,ve,$e),_e=Ue(_e,ve);else if(!f||s||M||B){if(f&&!M&&s^B)_e=Ue(_e,ve),s?(He=0,_e=mt(_e,ve,$e)):(He=1,_e=mt(_e,ve,$e),_e=Ue(_e,ve));else if(f&&s&&!M&&B)He=1,_e=mt(_e,ve,$e),_e=Ue(_e,ve);else if(!f&&!M&&s^B){var Ne=V;s?(He=1,_e=mt(_e,ve,$e),He=0,V=!1,_e=mt(_e,ve,$e),V=Ne):(He=0,_e=mt(_e,ve,$e),_e=Ue(_e,ve),He=1,V=!1,_e=mt(_e,ve,$e),V=Ne,_e=Ue(_e,ve))}}else He=0,_e=mt(_e,ve,$e);else He=s?1:0,_e=mt(_e,ve,$e);return _e},this.__bidiEngine__.setOptions=function(_e){_e&&(f=_e.isInputVisual,M=_e.isOutputVisual,s=_e.isInputRtl,B=_e.isOutputRtl,V=_e.isSymmetricSwapping)},this.__bidiEngine__.setOptions(p),this.__bidiEngine__};var a=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],c=new h.__bidiEngine__({isInputVisual:!0});h.API.events.push(["postProcessText",function(p){var v=p.text,y=(p.x,p.y,p.options||{}),f=(p.mutex,y.lang,[]);if(y.isInputVisual=typeof y.isInputVisual!="boolean"||y.isInputVisual,c.setOptions(y),Object.prototype.toString.call(v)==="[object Array]"){var s=0;for(f=[],s=0;s<v.length;s+=1)Object.prototype.toString.call(v[s])==="[object Array]"?f.push([c.doBidiReorder(v[s][0]),v[s][1],v[s][2]]):f.push([c.doBidiReorder(v[s])]);p.text=f}else p.text=c.doBidiReorder(v);c.setOptions({isInputVisual:!0})}])}(Br),Br.API.TTFFont=function(){function h(a){var c;if(this.rawData=a,c=this.contents=new Pc(a),this.contents.pos=4,c.readString(4)==="ttcf")throw new Error("TTCF not supported.");c.pos=0,this.parse(),this.subset=new ib(this),this.registerTTF()}return h.open=function(a){return new h(a)},h.prototype.parse=function(){return this.directory=new Uv(this.contents),this.head=new Gv(this),this.name=new Yv(this),this.cmap=new f_(this),this.toUnicode={},this.hhea=new $v(this),this.maxp=new Kv(this),this.hmtx=new Jv(this),this.post=new Hv(this),this.os2=new Wv(this),this.loca=new rb(this),this.glyf=new Qv(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},h.prototype.registerTTF=function(){var a,c,p,v,y;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var f,s,M,B;for(B=[],f=0,s=(M=this.bbox).length;f<s;f++)a=M[f],B.push(Math.round(a*this.scaleFactor));return B}).call(this),this.stemV=0,this.post.exists?(p=255&(v=this.post.italic_angle),(32768&(c=v>>16))!=0&&(c=-(1+(65535^c))),this.italicAngle=+(c+"."+p)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(y=this.familyClass)===1||y===2||y===3||y===4||y===5||y===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},h.prototype.characterToGlyph=function(a){var c;return((c=this.cmap.unicode)!=null?c.codeMap[a]:void 0)||0},h.prototype.widthOfGlyph=function(a){var c;return c=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(a).advance*c},h.prototype.widthOfString=function(a,c,p){var v,y,f,s;for(f=0,y=0,s=(a=""+a).length;0<=s?y<s:y>s;y=0<=s?++y:--y)v=a.charCodeAt(y),f+=this.widthOfGlyph(this.characterToGlyph(v))+p*(1e3/c)||0;return f*(c/1e3)},h.prototype.lineHeight=function(a,c){var p;return c==null&&(c=!1),p=c?this.lineGap:0,(this.ascender+p-this.decender)/1e3*a},h}();var el,Pc=function(){function h(a){this.data=a??[],this.pos=0,this.length=this.data.length}return h.prototype.readByte=function(){return this.data[this.pos++]},h.prototype.writeByte=function(a){return this.data[this.pos++]=a},h.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},h.prototype.writeUInt32=function(a){return this.writeByte(a>>>24&255),this.writeByte(a>>16&255),this.writeByte(a>>8&255),this.writeByte(255&a)},h.prototype.readInt32=function(){var a;return(a=this.readUInt32())>=2147483648?a-4294967296:a},h.prototype.writeInt32=function(a){return a<0&&(a+=4294967296),this.writeUInt32(a)},h.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},h.prototype.writeUInt16=function(a){return this.writeByte(a>>8&255),this.writeByte(255&a)},h.prototype.readInt16=function(){var a;return(a=this.readUInt16())>=32768?a-65536:a},h.prototype.writeInt16=function(a){return a<0&&(a+=65536),this.writeUInt16(a)},h.prototype.readString=function(a){var c,p;for(p=[],c=0;0<=a?c<a:c>a;c=0<=a?++c:--c)p[c]=String.fromCharCode(this.readByte());return p.join("")},h.prototype.writeString=function(a){var c,p,v;for(v=[],c=0,p=a.length;0<=p?c<p:c>p;c=0<=p?++c:--c)v.push(this.writeByte(a.charCodeAt(c)));return v},h.prototype.readShort=function(){return this.readInt16()},h.prototype.writeShort=function(a){return this.writeInt16(a)},h.prototype.readLongLong=function(){var a,c,p,v,y,f,s,M;return a=this.readByte(),c=this.readByte(),p=this.readByte(),v=this.readByte(),y=this.readByte(),f=this.readByte(),s=this.readByte(),M=this.readByte(),128&a?-1*(72057594037927940*(255^a)+281474976710656*(255^c)+1099511627776*(255^p)+4294967296*(255^v)+16777216*(255^y)+65536*(255^f)+256*(255^s)+(255^M)+1):72057594037927940*a+281474976710656*c+1099511627776*p+4294967296*v+16777216*y+65536*f+256*s+M},h.prototype.writeLongLong=function(a){var c,p;return c=Math.floor(a/4294967296),p=4294967295&a,this.writeByte(c>>24&255),this.writeByte(c>>16&255),this.writeByte(c>>8&255),this.writeByte(255&c),this.writeByte(p>>24&255),this.writeByte(p>>16&255),this.writeByte(p>>8&255),this.writeByte(255&p)},h.prototype.readInt=function(){return this.readInt32()},h.prototype.writeInt=function(a){return this.writeInt32(a)},h.prototype.read=function(a){var c,p;for(c=[],p=0;0<=a?p<a:p>a;p=0<=a?++p:--p)c.push(this.readByte());return c},h.prototype.write=function(a){var c,p,v,y;for(y=[],p=0,v=a.length;p<v;p++)c=a[p],y.push(this.writeByte(c));return y},h}(),Uv=function(){var h;function a(c){var p,v,y;for(this.scalarType=c.readInt(),this.tableCount=c.readShort(),this.searchRange=c.readShort(),this.entrySelector=c.readShort(),this.rangeShift=c.readShort(),this.tables={},v=0,y=this.tableCount;0<=y?v<y:v>y;v=0<=y?++v:--v)p={tag:c.readString(4),checksum:c.readInt(),offset:c.readInt(),length:c.readInt()},this.tables[p.tag]=p}return a.prototype.encode=function(c){var p,v,y,f,s,M,B,V,U,J,N,de,pe;for(pe in N=Object.keys(c).length,M=Math.log(2),U=16*Math.floor(Math.log(N)/M),f=Math.floor(U/M),V=16*N-U,(v=new Pc).writeInt(this.scalarType),v.writeShort(N),v.writeShort(U),v.writeShort(f),v.writeShort(V),y=16*N,B=v.pos+y,s=null,de=[],c)for(J=c[pe],v.writeString(pe),v.writeInt(h(J)),v.writeInt(B),v.writeInt(J.length),de=de.concat(J),pe==="head"&&(s=B),B+=J.length;B%4;)de.push(0),B++;return v.write(de),p=2981146554-h(v.data),v.pos=s+8,v.writeUInt32(p),v.data},h=function(c){var p,v,y,f;for(c=m_.call(c);c.length%4;)c.push(0);for(y=new Pc(c),v=0,p=0,f=c.length;p<f;p=p+=4)v+=y.readUInt32();return 4294967295&v},a}(),Zv={}.hasOwnProperty,Ll=function(h,a){for(var c in a)Zv.call(a,c)&&(h[c]=a[c]);function p(){this.constructor=h}return p.prototype=a.prototype,h.prototype=new p,h.__super__=a.prototype,h};el=function(){function h(a){var c;this.file=a,c=this.file.directory.tables[this.tag],this.exists=!!c,c&&(this.offset=c.offset,this.length=c.length,this.parse(this.file.contents))}return h.prototype.parse=function(){},h.prototype.encode=function(){},h.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},h}();var Gv=function(h){function a(){return a.__super__.constructor.apply(this,arguments)}return Ll(a,el),a.prototype.tag="head",a.prototype.parse=function(c){return c.pos=this.offset,this.version=c.readInt(),this.revision=c.readInt(),this.checkSumAdjustment=c.readInt(),this.magicNumber=c.readInt(),this.flags=c.readShort(),this.unitsPerEm=c.readShort(),this.created=c.readLongLong(),this.modified=c.readLongLong(),this.xMin=c.readShort(),this.yMin=c.readShort(),this.xMax=c.readShort(),this.yMax=c.readShort(),this.macStyle=c.readShort(),this.lowestRecPPEM=c.readShort(),this.fontDirectionHint=c.readShort(),this.indexToLocFormat=c.readShort(),this.glyphDataFormat=c.readShort()},a.prototype.encode=function(c){var p;return(p=new Pc).writeInt(this.version),p.writeInt(this.revision),p.writeInt(this.checkSumAdjustment),p.writeInt(this.magicNumber),p.writeShort(this.flags),p.writeShort(this.unitsPerEm),p.writeLongLong(this.created),p.writeLongLong(this.modified),p.writeShort(this.xMin),p.writeShort(this.yMin),p.writeShort(this.xMax),p.writeShort(this.yMax),p.writeShort(this.macStyle),p.writeShort(this.lowestRecPPEM),p.writeShort(this.fontDirectionHint),p.writeShort(c),p.writeShort(this.glyphDataFormat),p.data},a}(),Lg=function(){function h(a,c){var p,v,y,f,s,M,B,V,U,J,N,de,pe,De,fe,ke,He;switch(this.platformID=a.readUInt16(),this.encodingID=a.readShort(),this.offset=c+a.readInt(),U=a.pos,a.pos=this.offset,this.format=a.readUInt16(),this.length=a.readUInt16(),this.language=a.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(M=0;M<256;++M)this.codeMap[M]=a.readByte();break;case 4:for(N=a.readUInt16(),J=N/2,a.pos+=6,y=function(){var Oe,Le;for(Le=[],M=Oe=0;0<=J?Oe<J:Oe>J;M=0<=J?++Oe:--Oe)Le.push(a.readUInt16());return Le}(),a.pos+=2,pe=function(){var Oe,Le;for(Le=[],M=Oe=0;0<=J?Oe<J:Oe>J;M=0<=J?++Oe:--Oe)Le.push(a.readUInt16());return Le}(),B=function(){var Oe,Le;for(Le=[],M=Oe=0;0<=J?Oe<J:Oe>J;M=0<=J?++Oe:--Oe)Le.push(a.readUInt16());return Le}(),V=function(){var Oe,Le;for(Le=[],M=Oe=0;0<=J?Oe<J:Oe>J;M=0<=J?++Oe:--Oe)Le.push(a.readUInt16());return Le}(),v=(this.length-a.pos+this.offset)/2,s=function(){var Oe,Le;for(Le=[],M=Oe=0;0<=v?Oe<v:Oe>v;M=0<=v?++Oe:--Oe)Le.push(a.readUInt16());return Le}(),M=fe=0,He=y.length;fe<He;M=++fe)for(De=y[M],p=ke=de=pe[M];de<=De?ke<=De:ke>=De;p=de<=De?++ke:--ke)V[M]===0?f=p+B[M]:(f=s[V[M]/2+(p-de)-(J-M)]||0)!==0&&(f+=B[M]),this.codeMap[p]=65535&f}a.pos=U}return h.encode=function(a,c){var p,v,y,f,s,M,B,V,U,J,N,de,pe,De,fe,ke,He,Oe,Le,Ke,Ue,Ae,lt,mt,_e,ve,$e,Ne,wt,ut,At,ht,Tt,Dt,sr,ne,Ie,Re,We,nt,at,pt,gt,Ht,$t,er;switch(Ne=new Pc,f=Object.keys(a).sort(function(nr,dr){return nr-dr}),c){case"macroman":for(pe=0,De=function(){var nr=[];for(de=0;de<256;++de)nr.push(0);return nr}(),ke={0:0},y={},wt=0,Tt=f.length;wt<Tt;wt++)ke[gt=a[v=f[wt]]]==null&&(ke[gt]=++pe),y[v]={old:a[v],new:ke[a[v]]},De[v]=ke[a[v]];return Ne.writeUInt16(1),Ne.writeUInt16(0),Ne.writeUInt32(12),Ne.writeUInt16(0),Ne.writeUInt16(262),Ne.writeUInt16(0),Ne.write(De),{charMap:y,subtable:Ne.data,maxGlyphID:pe+1};case"unicode":for(ve=[],U=[],He=0,ke={},p={},fe=B=null,ut=0,Dt=f.length;ut<Dt;ut++)ke[Le=a[v=f[ut]]]==null&&(ke[Le]=++He),p[v]={old:Le,new:ke[Le]},s=ke[Le]-v,fe!=null&&s===B||(fe&&U.push(fe),ve.push(v),B=s),fe=v;for(fe&&U.push(fe),U.push(65535),ve.push(65535),mt=2*(lt=ve.length),Ae=2*Math.pow(Math.log(lt)/Math.LN2,2),J=Math.log(Ae/2)/Math.LN2,Ue=2*lt-Ae,M=[],Ke=[],N=[],de=At=0,sr=ve.length;At<sr;de=++At){if(_e=ve[de],V=U[de],_e===65535){M.push(0),Ke.push(0);break}if(_e-($e=p[_e].new)>=32768)for(M.push(0),Ke.push(2*(N.length+lt-de)),v=ht=_e;_e<=V?ht<=V:ht>=V;v=_e<=V?++ht:--ht)N.push(p[v].new);else M.push($e-_e),Ke.push(0)}for(Ne.writeUInt16(3),Ne.writeUInt16(1),Ne.writeUInt32(12),Ne.writeUInt16(4),Ne.writeUInt16(16+8*lt+2*N.length),Ne.writeUInt16(0),Ne.writeUInt16(mt),Ne.writeUInt16(Ae),Ne.writeUInt16(J),Ne.writeUInt16(Ue),at=0,ne=U.length;at<ne;at++)v=U[at],Ne.writeUInt16(v);for(Ne.writeUInt16(0),pt=0,Ie=ve.length;pt<Ie;pt++)v=ve[pt],Ne.writeUInt16(v);for(Ht=0,Re=M.length;Ht<Re;Ht++)s=M[Ht],Ne.writeUInt16(s);for($t=0,We=Ke.length;$t<We;$t++)Oe=Ke[$t],Ne.writeUInt16(Oe);for(er=0,nt=N.length;er<nt;er++)pe=N[er],Ne.writeUInt16(pe);return{charMap:p,subtable:Ne.data,maxGlyphID:He+1}}},h}(),f_=function(h){function a(){return a.__super__.constructor.apply(this,arguments)}return Ll(a,el),a.prototype.tag="cmap",a.prototype.parse=function(c){var p,v,y;for(c.pos=this.offset,this.version=c.readUInt16(),y=c.readUInt16(),this.tables=[],this.unicode=null,v=0;0<=y?v<y:v>y;v=0<=y?++v:--v)p=new Lg(c,this.offset),this.tables.push(p),p.isUnicode&&this.unicode==null&&(this.unicode=p);return!0},a.encode=function(c,p){var v,y;return p==null&&(p="macroman"),v=Lg.encode(c,p),(y=new Pc).writeUInt16(0),y.writeUInt16(1),v.table=y.data.concat(v.subtable),v},a}(),$v=function(h){function a(){return a.__super__.constructor.apply(this,arguments)}return Ll(a,el),a.prototype.tag="hhea",a.prototype.parse=function(c){return c.pos=this.offset,this.version=c.readInt(),this.ascender=c.readShort(),this.decender=c.readShort(),this.lineGap=c.readShort(),this.advanceWidthMax=c.readShort(),this.minLeftSideBearing=c.readShort(),this.minRightSideBearing=c.readShort(),this.xMaxExtent=c.readShort(),this.caretSlopeRise=c.readShort(),this.caretSlopeRun=c.readShort(),this.caretOffset=c.readShort(),c.pos+=8,this.metricDataFormat=c.readShort(),this.numberOfMetrics=c.readUInt16()},a}(),Wv=function(h){function a(){return a.__super__.constructor.apply(this,arguments)}return Ll(a,el),a.prototype.tag="OS/2",a.prototype.parse=function(c){if(c.pos=this.offset,this.version=c.readUInt16(),this.averageCharWidth=c.readShort(),this.weightClass=c.readUInt16(),this.widthClass=c.readUInt16(),this.type=c.readShort(),this.ySubscriptXSize=c.readShort(),this.ySubscriptYSize=c.readShort(),this.ySubscriptXOffset=c.readShort(),this.ySubscriptYOffset=c.readShort(),this.ySuperscriptXSize=c.readShort(),this.ySuperscriptYSize=c.readShort(),this.ySuperscriptXOffset=c.readShort(),this.ySuperscriptYOffset=c.readShort(),this.yStrikeoutSize=c.readShort(),this.yStrikeoutPosition=c.readShort(),this.familyClass=c.readShort(),this.panose=function(){var p,v;for(v=[],p=0;p<10;++p)v.push(c.readByte());return v}(),this.charRange=function(){var p,v;for(v=[],p=0;p<4;++p)v.push(c.readInt());return v}(),this.vendorID=c.readString(4),this.selection=c.readShort(),this.firstCharIndex=c.readShort(),this.lastCharIndex=c.readShort(),this.version>0&&(this.ascent=c.readShort(),this.descent=c.readShort(),this.lineGap=c.readShort(),this.winAscent=c.readShort(),this.winDescent=c.readShort(),this.codePageRange=function(){var p,v;for(v=[],p=0;p<2;p=++p)v.push(c.readInt());return v}(),this.version>1))return this.xHeight=c.readShort(),this.capHeight=c.readShort(),this.defaultChar=c.readShort(),this.breakChar=c.readShort(),this.maxContext=c.readShort()},a}(),Hv=function(h){function a(){return a.__super__.constructor.apply(this,arguments)}return Ll(a,el),a.prototype.tag="post",a.prototype.parse=function(c){var p,v,y;switch(c.pos=this.offset,this.format=c.readInt(),this.italicAngle=c.readInt(),this.underlinePosition=c.readShort(),this.underlineThickness=c.readShort(),this.isFixedPitch=c.readInt(),this.minMemType42=c.readInt(),this.maxMemType42=c.readInt(),this.minMemType1=c.readInt(),this.maxMemType1=c.readInt(),this.format){case 65536:break;case 131072:var f;for(v=c.readUInt16(),this.glyphNameIndex=[],f=0;0<=v?f<v:f>v;f=0<=v?++f:--f)this.glyphNameIndex.push(c.readUInt16());for(this.names=[],y=[];c.pos<this.offset+this.length;)p=c.readByte(),y.push(this.names.push(c.readString(p)));return y;case 151552:return v=c.readUInt16(),this.offsets=c.read(v);case 196608:break;case 262144:return this.map=(function(){var s,M,B;for(B=[],f=s=0,M=this.file.maxp.numGlyphs;0<=M?s<M:s>M;f=0<=M?++s:--s)B.push(c.readUInt32());return B}).call(this)}},a}(),Xv=function(h,a){this.raw=h,this.length=h.length,this.platformID=a.platformID,this.encodingID=a.encodingID,this.languageID=a.languageID},Yv=function(h){function a(){return a.__super__.constructor.apply(this,arguments)}return Ll(a,el),a.prototype.tag="name",a.prototype.parse=function(c){var p,v,y,f,s,M,B,V,U,J,N;for(c.pos=this.offset,c.readShort(),p=c.readShort(),M=c.readShort(),v=[],f=0;0<=p?f<p:f>p;f=0<=p?++f:--f)v.push({platformID:c.readShort(),encodingID:c.readShort(),languageID:c.readShort(),nameID:c.readShort(),length:c.readShort(),offset:this.offset+M+c.readShort()});for(B={},f=U=0,J=v.length;U<J;f=++U)y=v[f],c.pos=y.offset,V=c.readString(y.length),s=new Xv(V,y),B[N=y.nameID]==null&&(B[N]=[]),B[y.nameID].push(s);this.strings=B,this.copyright=B[0],this.fontFamily=B[1],this.fontSubfamily=B[2],this.uniqueSubfamily=B[3],this.fontName=B[4],this.version=B[5];try{this.postscriptName=B[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=B[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=B[7],this.manufacturer=B[8],this.designer=B[9],this.description=B[10],this.vendorUrl=B[11],this.designerUrl=B[12],this.license=B[13],this.licenseUrl=B[14],this.preferredFamily=B[15],this.preferredSubfamily=B[17],this.compatibleFull=B[18],this.sampleText=B[19]},a}(),Kv=function(h){function a(){return a.__super__.constructor.apply(this,arguments)}return Ll(a,el),a.prototype.tag="maxp",a.prototype.parse=function(c){return c.pos=this.offset,this.version=c.readInt(),this.numGlyphs=c.readUInt16(),this.maxPoints=c.readUInt16(),this.maxContours=c.readUInt16(),this.maxCompositePoints=c.readUInt16(),this.maxComponentContours=c.readUInt16(),this.maxZones=c.readUInt16(),this.maxTwilightPoints=c.readUInt16(),this.maxStorage=c.readUInt16(),this.maxFunctionDefs=c.readUInt16(),this.maxInstructionDefs=c.readUInt16(),this.maxStackElements=c.readUInt16(),this.maxSizeOfInstructions=c.readUInt16(),this.maxComponentElements=c.readUInt16(),this.maxComponentDepth=c.readUInt16()},a}(),Jv=function(h){function a(){return a.__super__.constructor.apply(this,arguments)}return Ll(a,el),a.prototype.tag="hmtx",a.prototype.parse=function(c){var p,v,y,f,s,M,B;for(c.pos=this.offset,this.metrics=[],p=0,M=this.file.hhea.numberOfMetrics;0<=M?p<M:p>M;p=0<=M?++p:--p)this.metrics.push({advance:c.readUInt16(),lsb:c.readInt16()});for(y=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var V,U;for(U=[],p=V=0;0<=y?V<y:V>y;p=0<=y?++V:--V)U.push(c.readInt16());return U}(),this.widths=(function(){var V,U,J,N;for(N=[],V=0,U=(J=this.metrics).length;V<U;V++)f=J[V],N.push(f.advance);return N}).call(this),v=this.widths[this.widths.length-1],B=[],p=s=0;0<=y?s<y:s>y;p=0<=y?++s:--s)B.push(this.widths.push(v));return B},a.prototype.forGlyph=function(c){return c in this.metrics?this.metrics[c]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[c-this.metrics.length]}},a}(),m_=[].slice,Qv=function(h){function a(){return a.__super__.constructor.apply(this,arguments)}return Ll(a,el),a.prototype.tag="glyf",a.prototype.parse=function(){return this.cache={}},a.prototype.glyphFor=function(c){var p,v,y,f,s,M,B,V,U,J;return c in this.cache?this.cache[c]:(f=this.file.loca,p=this.file.contents,v=f.indexOf(c),(y=f.lengthOf(c))===0?this.cache[c]=null:(p.pos=this.offset+v,s=(M=new Pc(p.read(y))).readShort(),V=M.readShort(),J=M.readShort(),B=M.readShort(),U=M.readShort(),this.cache[c]=s===-1?new tb(M,V,J,B,U):new eb(M,s,V,J,B,U),this.cache[c]))},a.prototype.encode=function(c,p,v){var y,f,s,M,B;for(s=[],f=[],M=0,B=p.length;M<B;M++)y=c[p[M]],f.push(s.length),y&&(s=s.concat(y.encode(v)));return f.push(s.length),{table:s,offsets:f}},a}(),eb=function(){function h(a,c,p,v,y,f){this.raw=a,this.numberOfContours=c,this.xMin=p,this.yMin=v,this.xMax=y,this.yMax=f,this.compound=!1}return h.prototype.encode=function(){return this.raw.data},h}(),tb=function(){function h(a,c,p,v,y){var f,s;for(this.raw=a,this.xMin=c,this.yMin=p,this.xMax=v,this.yMax=y,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],f=this.raw;s=f.readShort(),this.glyphOffsets.push(f.pos),this.glyphIDs.push(f.readUInt16()),32&s;)f.pos+=1&s?4:2,128&s?f.pos+=8:64&s?f.pos+=4:8&s&&(f.pos+=2)}return h.prototype.encode=function(){var a,c,p;for(c=new Pc(m_.call(this.raw.data)),a=0,p=this.glyphIDs.length;a<p;++a)c.pos=this.glyphOffsets[a];return c.data},h}(),rb=function(h){function a(){return a.__super__.constructor.apply(this,arguments)}return Ll(a,el),a.prototype.tag="loca",a.prototype.parse=function(c){var p,v;return c.pos=this.offset,p=this.file.head.indexToLocFormat,this.offsets=p===0?(function(){var y,f;for(f=[],v=0,y=this.length;v<y;v+=2)f.push(2*c.readUInt16());return f}).call(this):(function(){var y,f;for(f=[],v=0,y=this.length;v<y;v+=4)f.push(c.readUInt32());return f}).call(this)},a.prototype.indexOf=function(c){return this.offsets[c]},a.prototype.lengthOf=function(c){return this.offsets[c+1]-this.offsets[c]},a.prototype.encode=function(c,p){for(var v=new Uint32Array(this.offsets.length),y=0,f=0,s=0;s<v.length;++s)if(v[s]=y,f<p.length&&p[f]==s){++f,v[s]=y;var M=this.offsets[s],B=this.offsets[s+1]-M;B>0&&(y+=B)}for(var V=new Array(4*v.length),U=0;U<v.length;++U)V[4*U+3]=255&v[U],V[4*U+2]=(65280&v[U])>>8,V[4*U+1]=(16711680&v[U])>>16,V[4*U]=(4278190080&v[U])>>24;return V},a}(),ib=function(){function h(a){this.font=a,this.subset={},this.unicodes={},this.next=33}return h.prototype.generateCmap=function(){var a,c,p,v,y;for(c in v=this.font.cmap.tables[0].codeMap,a={},y=this.subset)p=y[c],a[c]=v[p];return a},h.prototype.glyphsFor=function(a){var c,p,v,y,f,s,M;for(v={},f=0,s=a.length;f<s;f++)v[y=a[f]]=this.font.glyf.glyphFor(y);for(y in c=[],v)(p=v[y])!=null&&p.compound&&c.push.apply(c,p.glyphIDs);if(c.length>0)for(y in M=this.glyphsFor(c))p=M[y],v[y]=p;return v},h.prototype.encode=function(a,c){var p,v,y,f,s,M,B,V,U,J,N,de,pe,De,fe;for(v in p=f_.encode(this.generateCmap(),"unicode"),f=this.glyphsFor(a),N={0:0},fe=p.charMap)N[(M=fe[v]).old]=M.new;for(de in J=p.maxGlyphID,f)de in N||(N[de]=J++);return V=function(ke){var He,Oe;for(He in Oe={},ke)Oe[ke[He]]=He;return Oe}(N),U=Object.keys(V).sort(function(ke,He){return ke-He}),pe=function(){var ke,He,Oe;for(Oe=[],ke=0,He=U.length;ke<He;ke++)s=U[ke],Oe.push(V[s]);return Oe}(),y=this.font.glyf.encode(f,pe,N),B=this.font.loca.encode(y.offsets,pe),De={cmap:this.font.cmap.raw(),glyf:y.table,loca:B,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(c)},this.font.os2.exists&&(De["OS/2"]=this.font.os2.raw()),this.font.directory.encode(De)},h}();Br.API.PDFObject=function(){var h;function a(){}return h=function(c,p){return(Array(p+1).join("0")+c).slice(-p)},a.convert=function(c){var p,v,y,f;if(Array.isArray(c))return"["+function(){var s,M,B;for(B=[],s=0,M=c.length;s<M;s++)p=c[s],B.push(a.convert(p));return B}().join(" ")+"]";if(typeof c=="string")return"/"+c;if(c!=null&&c.isString)return"("+c+")";if(c instanceof Date)return"(D:"+h(c.getUTCFullYear(),4)+h(c.getUTCMonth(),2)+h(c.getUTCDate(),2)+h(c.getUTCHours(),2)+h(c.getUTCMinutes(),2)+h(c.getUTCSeconds(),2)+"Z)";if({}.toString.call(c)==="[object Object]"){for(v in y=["<<"],c)f=c[v],y.push("/"+v+" "+a.convert(f));return y.push(">>"),y.join(`
`)}return""+c},a}();const Hp={"circle-radius":8,"circle-color":"red","circle-stroke-width":1,"circle-stroke-color":"black"},ed={style:{textSize:16,textHaloColor:"#FFFFFF",textHaloWidth:.8,textColor:"#000000",fallbackTextFont:["Open Sans Regular"]},visibility:"visible",position:"bottom-right"},td={image:'<svg width="800px" height="800px" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--gis" preserveAspectRatio="xMidYMid meet"><path d="M47.655 1.634l-35 95c-.828 2.24 1.659 4.255 3.68 2.98l33.667-21.228l33.666 21.228c2.02 1.271 4.503-.74 3.678-2.98l-35-95C51.907.514 51.163.006 50 .008c-1.163.001-1.99.65-2.345 1.626zm-.155 14.88v57.54L19.89 91.461z" fill="none" stroke="white" stroke-width="1.5"/><path d="M47.655 1.634l-35 95c-.828 2.24 1.659 4.255 3.68 2.98l33.667-21.228l33.666 21.228c2.02 1.271 4.503-.74 3.678-2.98l-35-95C51.907.514 51.163.006 50 .008c-1.163.001-1.99.65-2.345 1.626zm-.155 14.88v57.54L19.89 91.461z" fill="#000000" fill-rule="evenodd"></path></svg>',imageName:"gl-export-north-icon",imageSizeFraction:.05,visibility:"visible",position:"top-right"};class nb{constructor(a,c=xu.A4,p=300,v=Jl.PNG,y=Cu.mm,f="map",s="maplibregl-marker",M=Hp,B="maplibregl-ctrl-attrib-inner",V=ed,U=td){xi(this,"map"),xi(this,"width"),xi(this,"height"),xi(this,"dpi"),xi(this,"format"),xi(this,"unit"),xi(this,"fileName"),xi(this,"markerClassName"),xi(this,"markerCirclePaint"),xi(this,"attributionClassName"),xi(this,"attributionOptions"),xi(this,"northIconOptions"),this.map=a,this.width=c[0],this.height=c[1],this.dpi=p,this.format=v,this.unit=y,this.fileName=f,this.markerClassName=s,this.markerCirclePaint=M,this.attributionClassName=B,this.attributionOptions=V,this.northIconOptions=U}renderMapPost(a){return a}getMarkers(){return this.map.getCanvasContainer().getElementsByClassName(this.markerClassName)}renderMarkers(a){const c=this.getMarkers();for(let p=0;p<c.length;p++){const v=c.item(p);if(!v)continue;const y=v.getAttribute("style");if(!y)continue;const f=/translate\(([^,]+)px,\s*([^,]+)px\)/,s=y.match(f);if(!s)continue;const M=parseInt(s[1]),B=parseInt(s[2]),V=this.map.unproject([M,B]),U=`point${p}`;a.addSource(U,{type:"geojson",data:{type:"Point",coordinates:[V.lng,V.lat]}}),a.addLayer({id:U,source:U,type:"circle",paint:this.markerCirclePaint})}return a}generate(){const a=this;this.addLoader(),this.showLoader();const c=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return a.dpi/96}});const p=document.createElement("div");p.className="hidden-map",document.body.appendChild(p);const v=document.createElement("div");v.style.width=this.toPixels(this.width),v.style.height=this.toPixels(this.height),p.appendChild(v);const y=this.map.getStyle();if(y&&y.sources){const s=y.sources;Object.keys(s).forEach(M=>{const B=s[M];Object.keys(B).forEach(V=>{B[V]||delete B[V]})})}let f=this.getRenderedMap(v,y);f.on("load",()=>{this.addNorthIconToMap(f).then(()=>{f.once("idle",()=>{this.addAttributions(f)?f.once("idle",()=>{f=this.renderMapPost(f),this.getMarkers().length===0?this.exportImage(f,p,c):(f=this.renderMarkers(f),f.once("idle",()=>{this.exportImage(f,p,c)}))}):(f=this.renderMapPost(f),this.getMarkers().length===0?this.exportImage(f,p,c):(f=this.renderMarkers(f),f.once("idle",()=>{this.exportImage(f,p,c)})))})})})}stripHtml(a){const c=document.createElement("div");return c.innerHTML=a,c.textContent||c.innerText||""}getIconWidth(a,c){const p=a.getContainer(),v=parseInt(p.style.width.replace("px",""));return parseInt(`${v*c}`)}getElementPosition(a,c,p=0){const v=a.getContainer();let y=0,f=0;switch(c){case"top-left":y=0+p,f=0+p;break;case"top-right":y=parseInt(v.style.width.replace("px",""))-p,f=0+p;break;case"bottom-left":y=0+p,f=parseInt(v.style.height.replace("px",""))-p;break;case"bottom-right":y=parseInt(v.style.width.replace("px",""))-p,f=parseInt(v.style.height.replace("px",""))-p;break}return[y,f]}addNorthIconImage(a){const c=this.getIconWidth(a,this.northIconOptions.imageSizeFraction??.08);return new Promise(p=>{const v=new Image(c,c);v.onload=()=>{this.northIconOptions.imageName&&a.addImage(this.northIconOptions.imageName,v),p()};function y(f){return"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(f)}this.northIconOptions.image&&(v.src=y(this.northIconOptions.image))})}addNorthIconToMap(a){let c=this.northIconOptions.visibility??"visible";return a.getZoom()<2&&this.width>this.height&&(c="none"),new Promise(p=>{this.addNorthIconImage(a).then(()=>{const v=this.getIconWidth(a,this.northIconOptions.imageSizeFraction??.08)*.8,y=this.getElementPosition(a,this.northIconOptions.position??"top-right",v),f=a.unproject(y),s=this.northIconOptions.imageName??"gl-export-north-icon";a.addSource(s,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[f.lng,f.lat]},properties:{}}}),a.addLayer({id:s,source:s,type:"symbol",layout:{"icon-image":s,"icon-size":1,"icon-rotate":a.getBearing()*-1,"icon-allow-overlap":!0,"icon-ignore-placement":!0,visibility:c},paint:{}}),p()})})}addAttributions(a){var c;if(!this.map.getStyle().glyphs)return!1;const p=a.getContainer(),v=this.attributionOptions.position??"bottom-right",y=this.getElementPosition(a,v,5),f=y[0],s=a.unproject(y),M=p.getElementsByClassName(this.attributionClassName),B=[];if((M==null?void 0:M.length)>0){const De=M.item(0);if(De)for(let fe=0;fe<De.children.length;fe++){const ke=De.children.item(fe);ke&&B.push(this.stripHtml(ke.outerHTML))}}else{const De=this.map.getStyle().sources;Object.keys(De).forEach(fe=>{const ke=De[fe];if("attribution"in ke){const He=ke.attribution;B.push(this.stripHtml(He))}})}if(B.length===0)return!1;const V=B.join(" | "),U="attribution";a.addSource(U,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[s.lng,s.lat]},properties:{attribution:V}}});const J=this.map.getStyle().layers.filter(De=>De.type==="symbol"&&De.layout&&"text-font"in De.layout),N=J.length>0&&J[0].layout?J[0].layout["text-font"]:(c=this.attributionOptions.style)==null?void 0:c.fallbackTextFont;let de=this.attributionOptions.visibility??"visible";a.getZoom()<2&&this.width>this.height&&(de="none");const pe=this.attributionOptions.style;return a.addLayer({id:U,source:U,type:"symbol",layout:{"text-field":["get","attribution"],"text-font":N,"text-max-width":parseInt(`${f/pe.textSize}`),"text-anchor":v,"text-justify":["top-right","bottom-right"].includes(v)?"right":"left","text-size":pe.textSize,"text-allow-overlap":!0,visibility:de},paint:{"text-halo-color":pe.textHaloColor,"text-halo-width":pe.textHaloWidth,"text-color":pe.textColor}}),!0}exportImage(a,c,p){var v;const y=a.getCanvas(),f=`${this.fileName}.${this.format}`;switch(this.format){case Jl.PNG:this.toPNG(y,f);break;case Jl.JPEG:this.toJPEG(y,f);break;case Jl.PDF:this.toPDF(a,f);break;case Jl.SVG:this.toSVG(y,f);break;default:console.error(`Invalid file format: ${this.format}`);break}a.remove(),(v=c.parentNode)==null||v.removeChild(c),Object.defineProperty(window,"devicePixelRatio",{get(){return p}}),c.remove(),this.hideLoader()}toPNG(a,c){const p=document.createElement("a");p.href=a.toDataURL(),p.download=c,p.click(),p.remove()}toJPEG(a,c){const p=a.toDataURL("image/jpeg",.85),v=document.createElement("a");v.href=p,v.download=c,v.click(),v.remove()}toPDF(a,c){const p=a.getCanvas(),v=new Br({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});v.addImage(p.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:y,lat:f}=a.getCenter();v.setProperties({title:a.getStyle().name,subject:`center: [${y}, ${f}], zoom: ${a.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),v.save(c)}toSVG(a,c){const p=a.toDataURL("image/png"),v=Number(this.toPixels(this.width,this.dpi).replace("px","")),y=Number(this.toPixels(this.height,this.dpi).replace("px","")),f=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${v}" 
      height="${y}" 
      viewBox="0 0 ${v} ${y}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${p}" width="${v}" height="${y}"></image>
    </svg>`,s=document.createElement("a");s.href=`data:application/xml,${encodeURIComponent(f)}`,s.download=c,s.click(),s.remove()}toPixels(a,c=96){return this.unit===Cu.mm&&(c/=25.4),`${c*a}px`}addLoader(){var a;const c=(a=this.map.getCanvas().parentElement)==null?void 0:a.parentElement;if(!c||c.getElementsByClassName("map-export-loader").length>0)return;const p=document.createElement("span");p.classList.add("map-export-loader"),p.classList.add("loader-default"),c.appendChild(p)}showLoader(){var a,c;const p=(a=this.map.getCanvas().parentElement)==null?void 0:a.parentElement;if(!p)return;const v=p.getElementsByClassName("map-export-loader");v&&v.length>0&&((c=v.item(0))==null||c.classList.add("is-active"))}hideLoader(){var a,c;const p=(a=this.map.getCanvas().parentElement)==null?void 0:a.parentElement;if(!p)return;const v=p.getElementsByClassName("map-export-loader");v&&v.length>0&&((c=v.item(0))==null||c.classList.remove("is-active"))}}class sb extends nb{constructor(a,c=xu.A4,p=300,v=Jl.PNG,y=Cu.mm,f="map",s=Hp,M=ed,B=td){super(a,c,p,v,y,f,"maplibregl-marker",s,"maplibregl-ctrl-attrib-inner",M,B)}getRenderedMap(a,c){const p=new $g.Map({container:a,style:c,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,canvasContextAttributes:{preserveDrawingBuffer:!0},fadeDuration:0,transformRequest:this.map._requestManager._transformRequestFn});this.map.getTerrain()&&(p.setMaxPitch(85),p.setPitch(this.map.getPitch()));const v=(this.map.style.imageManager||{}).images||[];return Object.keys(v).forEach(y=>{v[y].data&&p.addImage(y,v[y].data)}),p}renderMapPost(a){const c=this.map.getTerrain();return c&&a.setTerrain({source:c.source,exaggeration:c.exaggeration}),a}}class ab{constructor(a){xi(this,"controlContainer"),xi(this,"exportContainer"),xi(this,"crosshair"),xi(this,"printableArea"),xi(this,"map"),xi(this,"exportButton"),xi(this,"options",{PageSize:xu.A4,PageOrientation:jh.Landscape,Format:Jl.PDF,DPI:cg[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys(xu),Filename:"map",markerCirclePaint:Hp,attributionOptions:ed,northIconOptions:td}),xi(this,"MAPLIB_CSS_PREFIX","maplibregl"),a&&(a.attributionOptions=Object.assign(ed,a.attributionOptions),a.northIconOptions=Object.assign(td,a.northIconOptions),this.options=Object.assign(this.options,a)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){const a=this.options.Local??"en";return av(a)}onAdd(a){var c;this.map=a,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl`),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-group`),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-list`),this.exportButton=document.createElement("button"),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-icon`),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-control`),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const p=document.createElement("TABLE");p.className="print-table";const v={};(c=this.options.AllowedSizes)==null||c.forEach(V=>{xu[V]&&(v[V]=xu[V])});const y=this.createSelection(v,this.getTranslation().PageSize,"page-size",this.options.PageSize,(V,U)=>JSON.stringify(V[U]));p.appendChild(y);const f=this.createSelection(jh,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(V,U)=>V[U]);p.appendChild(f);const s=this.createSelection(Jl,this.getTranslation().Format,"format-type",this.options.Format,(V,U)=>V[U]);p.appendChild(s);const M=this.createSelection(cg,this.getTranslation().DPI,"dpi-type",this.options.DPI,(V,U)=>V[U]);p.appendChild(M),this.exportContainer.appendChild(p);const B=document.createElement("button");return B.type="button",B.textContent=this.getTranslation().Generate,B.classList.add("generate-button"),B.addEventListener("click",()=>{const V=document.getElementById("mapbox-gl-export-page-size"),U=document.getElementById("mapbox-gl-export-page-orientation"),J=document.getElementById("mapbox-gl-export-format-type"),N=document.getElementById("mapbox-gl-export-dpi-type"),de=U.value;let pe=JSON.parse(V.value);de===jh.Portrait&&(pe=pe.reverse()),this.generateMap(a,pe,Number(N.value),J.value,Cu.mm,this.options.Filename)}),this.exportContainer.appendChild(B),this.controlContainer}generateMap(a,c,p,v,y,f){new sb(a,c,p,v,y,f,this.options.markerCirclePaint,this.options.attributionOptions,this.options.northIconOptions).generate()}createSelection(a,c,p,v,y){const f=document.createElement("label");f.textContent=c;const s=document.createElement("select");s.setAttribute("id",`mapbox-gl-export-${p}`),s.style.width="100%",Object.keys(a).forEach(U=>{const J=document.createElement("option");J.setAttribute("value",y(a,U)),J.appendChild(document.createTextNode(U)),J.setAttribute("name",p),v===a[U]&&(J.selected=!0),s.appendChild(J)}),s.addEventListener("change",()=>{this.updatePrintableArea()});const M=document.createElement("TR"),B=document.createElement("TD"),V=document.createElement("TD");return B.appendChild(f),V.appendChild(s),M.appendChild(B),M.appendChild(V),M}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0),this.map=void 0)}onDocumentClick(a){this.controlContainer&&!this.controlContainer.contains(a.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(a){this.options.Crosshair===!0&&(a===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new G1(this.map),this.crosshair.create()))}togglePrintableArea(a){this.options.PrintableArea===!0&&(a===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new $1(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const a=document.getElementById("mapbox-gl-export-page-size"),c=document.getElementById("mapbox-gl-export-page-orientation").value;let p=JSON.parse(a.value);c===jh.Portrait&&(p=p.reverse()),this.printableArea.updateArea(p[0],p[1])}}var ob=["fill-antialias","fill-opacity","fill-color","fill-outline-color","fill-translate","fill-translate-anchor","fill-pattern","fill-extrusion-opacity","fill-extrusion-color","fill-extrusion-translate","fill-extrusion-translate-anchor","fill-extrusion-pattern","fill-extrusion-height","fill-extrusion-base","fill-extrusion-vertical-gradient","line-opacity","line-color","line-translate","line-translate-anchor","line-width","line-gap-width","line-offset","line-blur","line-dasharray","line-pattern","line-gradient","circle-radius","circle-color","circle-blur","circle-opacity","circle-translate","circle-translate-anchor","circle-pitch-scale","circle-pitch-alignment","circle-stroke-width","circle-stroke-color","circle-stroke-opacity","heatmap-radius","heatmap-weight","heatmap-intensity","heatmap-color","heatmap-opacity","icon-opacity","icon-color","icon-halo-color","icon-halo-width","icon-halo-blur","icon-translate","icon-translate-anchor","text-opacity","text-color","text-halo-color","text-halo-width","text-halo-blur","text-translate","text-translate-anchor","raster-opacity","raster-hue-rotate","raster-brightness-min","raster-brightness-max","raster-saturation","raster-contrast","raster-resampling","raster-fade-duration","hillshade-illumination-direction","hillshade-illumination-anchor","hillshade-exaggeration","hillshade-shadow-color","hillshade-highlight-color","hillshade-accent-color","background-color","background-pattern","background-opacity"],lb=["visibility","fill-sort-key","circle-sort-key","line-cap","line-join","line-miter-limit","line-round-limit","line-sort-key","symbol-placement","symbol-spacing","symbol-avoid-edges","symbol-sort-key","symbol-z-order","icon-allow-overlap","icon-ignore-placement","icon-optional","icon-rotation-alignment","icon-size","icon-text-fit","icon-text-fit-padding","icon-image","icon-rotate","icon-padding","icon-keep-upright","icon-offset","icon-anchor","icon-pitch-alignment","text-pitch-alignment","text-rotation-alignment","text-field","text-font","text-size","text-max-width","text-line-height","text-letter-spacing","text-justify","text-radial-offset","text-variable-anchor","text-anchor","text-max-angle","text-writing-mode","text-rotate","text-padding","text-keep-upright","text-transform","text-offset","text-allow-overlap","text-ignore-placement","text-optional"],xc={paints:ob,layouts:lb};const _p=h=>h.replace(/[A-Z]/g,a=>`-${a.toLowerCase()}`),Fp=h=>h.replace(/(^|-)([a-z])/g,(a,c,p)=>`${p.toUpperCase()}`);function cb(h){return xc.paints.indexOf(h)>=0}function ub(h){return xc.layouts.indexOf(h)>=0}function hb(h){return xc.paints.indexOf(h)>=0?"paint":xc.layouts.indexOf(h)>=0?"layout":"other"}function db(h){return String(h).match(/\.(geo)?json/)||h.type==="Feature"||h.type==="FeatureCollection"?{type:"geojson",data:h}:String(h).match(/^mapbox:\/\//)?{type:"vector",url:h}:h}const nh=(h,a)=>Array.isArray(h)?h:h instanceof RegExp?a.getStyle().layers.map(c=>c.id).filter(c=>c.match(h)):h instanceof Function?a.getStyle().layers.filter(c=>h(c)).map(c=>c.id):[h],Ca=h=>function(a,...c){return nh(a,this.map).forEach(v=>h.call(this,v,...c))},rh=h=>function(a,...c){const v=nh(a,this.map).map(y=>h.call(this,y,...c));return()=>v.forEach(y=>y())},g_=["line","fill","circle","symbol","video","raster","fill-extrusion","heatmap","hillshade"],vc=class vc{constructor(){Vr(this,"_loaded",!1);Vr(this,"_mapgl",null);Vr(this,"map");Vr(this,"update");Vr(this,"hoverFeatureState",rh(function(a,c,p,v,y){if(Array.isArray(c)){let V=c.map(([U,J])=>this.hoverFeatureState(a,U,J));return()=>V.forEach(U=>U())}if(c===void 0){const V=this.getLayerStyle(a);c=V.source,p=V["source-layer"]}let f;const s=V=>{f&&this.map.setFeatureState({source:c,sourceLayer:p,id:f},{hover:V})},M=V=>{var J;const U=(J=V.features)==null?void 0:J[0];U&&U.id===f||(s(!1),U&&(f&&y&&y({...V,oldFeatureId:f}),f=U.id,s(!0),v&&v(V)))},B=V=>{s(!1),V&&V.oldFeatureId&&(V.oldFeatureId=f),f=void 0,y&&y(V)};return this.map.on("mousemove",a,M),this.map.on("mouseleave",a,B),()=>{this.map.off("mousemove",a,M),this.map.off("mouseleave",a,B),B()}}));Vr(this,"clickLayer",rh(function(a,c){const p=v=>{v.features=this.map.queryRenderedFeatures(v.point,{layers:[a]}),c(v)};return this.map.on("click",a,p),()=>this.map.off("click",a,p)}));Vr(this,"hoverLayer",rh(function(a,c){const p=v=>{v.features=this.map.queryRenderedFeatures(v.point,{layers:[a]}),c(v)};return this.map.on("click",a,p),()=>this.map.off("click",a,p)}));Vr(this,"removeLayer",Ca(function(a){const c=p=>{p.error.message.match(/does not exist/)||console.error(p.error)};this.map.once("error",c),this.map.removeLayer(a),this.map.off("error",c)}));Vr(this,"setProperty",Ca(function(a,c,p){if(typeof c=="object")Object.keys(c).forEach(v=>this.setProperty(a,v,c[v]));else{const v=_p(c??""),y=nh(a,this.map);for(const f of y)cb(v)?this.map.setPaintProperty(f,v,p):ub(v)&&this.map.setLayoutProperty(f,v,p)}}));Vr(this,"setLayerStyle",Ca(function(a,c){const p=(f={},s={})=>Object.keys(f).forEach(M=>{M in s||this.setProperty(a,M,void 0)});typeof a=="object"&&!Array.isArray(a)&&a.id&&!c&&(c=a,a=c.id);const v=this.getLayerStyle(a),y=this.properties(c);p(v==null?void 0:v.paint,y==null?void 0:y.paint),p(v==null?void 0:v.layout,y==null?void 0:y.layout),this.setProperty(a,{...y==null?void 0:y.paint,...y==null?void 0:y.layout},void 0)}));Vr(this,"show",Ca(function(a){this.setVisibility(a,"visible")}));Vr(this,"hide",Ca(function(a){this.setVisibility(a,"none")}));Vr(this,"toggle",Ca(function(a,c){this.setVisibility(a,c?"visible":"none")}));Vr(this,"showSource",Ca(function(a){this.setVisibility(this.layersBySource(a),"visible")}));Vr(this,"hideSource",Ca(function(a){this.setVisibility(this.layersBySource(a),"none")}));Vr(this,"toggleSource",Ca(function(a,c){this.setVisibility(this.layersBySource(a),c?"visible":"none")}));Vr(this,"setFilter",Ca(function(a,c){this.map.setFilter(a,c)}));Vr(this,"removeSource",Ca(function(a){const c=this.layersBySource(a);this.removeLayer(c),this.map.getSource(a)&&this.map.removeSource(a)}));Vr(this,"setLayerSource",Ca(function(a,c,p){const v=this.map.getStyle().layers,y=v.findIndex(M=>M.id===a),f=v[y],s=v[y+1]&&v[y+1].id;f.source=c,p?f["source-layer"]=p:p!==void 0&&delete f["source-layer"],this.map.removeLayer(a),this._mapAddLayerBefore(f,s)}))}static init(a,c){return a.U=new vc,a.U._mapgl=c,a.U.map=a,a.U}static async newMap(a,c={},p={}){function v(B,V=[]){B.layers=[...B.layers,...V.map(U=>this.layerStyle(U))]}function y(B,V={}){B.sources={...B.sources,...V}}function f(B,V){B=V(B)}function s(B,V={}){Object.keys(V).forEach(U=>{const J=V[U].layers;delete V[U].layers,B.sources[U]=V[U],B.layers=[...B.layers,...J.map(N=>this.layerStyle({source:U,...N}))]})}if(c.style||(c.style={version:8,layers:[],sources:{}}),p.addLayers||p.addSources||p.transformStyle||p.mixStyles){let B=c.style,V;if(typeof B=="string"){const J=B.replace(/^mapbox:\/\/styles\//,"https://api.mapbox.com/styles/v1/");V=await(await fetch(J)).json()}else V=B;const U=new vc;v.call(U,V,p.addLayers),y(V,p.addSources),f(V,p.transformStyle??(J=>J)),s.call(U,V,p.mixStyles),c.style=V}const M=new a.Map(c);return vc.init(M,a),M}static interpolateZoom(a,...c){return this.interpolate(["zoom"],a,...c)}static step(a,c,p,...v){return["step",typeof a=="string"?["get",a]:a,...Array.isArray(c)&&!p?c:[c],...Array.isArray(p)?p:typeof p=="object"?Object.entries(p).map(([y,f])=>[isNaN(+y)?y:+y,f]).flat():[p,...v]]}static stepZoom(a,c,...p){return this.step(["zoom"],a,c,...p)}static interpolate(a,c,...p){return["interpolate",["linear"],typeof a=="string"?["get",a]:a,...Array.isArray(c)?c:typeof c=="object"?Object.entries(c).map(([v,y])=>[+v,y]).flat():[c,...p]]}static match(a,c,p){return c.default&&(p=c.default,delete c.default),["match",typeof a=="string"?["get",a]:a,...Object.entries(c).map(([v,y])=>[isNaN(+v)?v:+v,y]).flat(),p]}hoverPointer(a){const c=nh(a,this.map),p=f=>this.map.getCanvas().style.cursor="pointer",v=f=>{this.map.queryRenderedFeatures(f.point,{layers:c}).length===0&&(this.map.getCanvas().style.cursor=y)},y=this.map.getCanvas().style.cursor;for(const f of c)this.map.on("mouseleave",f,v),this.map.on("mouseenter",f,p);return()=>{for(const f of c)this.map.off("mouseenter",f,p),this.map.off("mouseleave",f,v);this.map.getCanvas().style.cursor=y}}hoverPopup(a,c,p={}){if(!this._mapgl)throw"Mapbox GL JS or MapLibre GL JS object required when initialising";const v=new this._mapgl.Popup({closeButton:!1,...p});return rh(function(y,f){const s=B=>{var V;(V=B==null?void 0:B.features)!=null&&V[0]&&(v.setLngLat(B.lngLat),v.setHTML(f(B.features[0],v)),v.addTo(this.map))},M=B=>{v.remove()};return this.map.on("mouseenter",y,s),this.map.on("mouseout",y,M),()=>{this.map.off("mouseenter",y,s),this.map.off("mouseout",y,M),M()}}).call(this,a,c)}clickPopup(a,c,p={}){if(!this._mapgl)throw"Mapbox GL JS or Maplibre GL JS object required when initialising";const v=new this._mapgl.Popup({...p});return rh(function(y,f){const s=M=>{var B;(B=M.features)!=null&&B[0]&&(v.setLngLat(M.features[0].geometry.coordinates.slice()),v.setHTML(f(M.features[0],v)),v.addTo(this.map))};return this.map.on("click",y,s),()=>this.map.off("click",y,s)}).call(this,a,c)}clickOneLayer(a,c,p){const v=nh(a,this.map),y=f=>{let s=!1;for(const M of v){const B=this.map.queryRenderedFeatures(f.point,{layers:[M]});if(B[0])try{c({event:f,layer:M,feature:B[0],features:B})}finally{s=!0;break}}!s&&p&&p(f)};return this.map.on("click",y),()=>this.map.off("click",y)}_mapAddLayerBefore(a,c){c?(this.map.getLayer(c)||(c=void 0),this.map.addLayer(a,c)):this.map.addLayer(a)}addLayer(a,c,p,v,y){return this._mapAddLayerBefore(this.layerStyle(a,c,p,v),y),this._makeSource(c)}add(a,c,p,v,y){if(this._mapAddLayerBefore({...this.properties(v),id:a,type:p,source:db(c)},y),typeof c=="string")return this._makeSource(c)}setLayer(a,c,p,v,y){const f=this.layerStyle(a,c,p,v),s=this.map.getStyle();if(!s)throw"Map has no style";const M=s.layers.findIndex(V=>V.id===f.id);if(s.layers.findIndex(V=>V.id===y)<0&&(y=void 0),M>=0){this.map.removeLayer(f.id);let V=y;!y&&s.layers[M+1]&&(V=s.layers[M+1].id),this.map.addLayer(f,V)}else this.map.addLayer(f,y||void 0);return this._makeSource(c)}addLineLayer(a,c,p,v){}addFillLayer(a,c,p,v){}addCircleLayer(a,c,p,v){}addSymbolLayer(a,c,p,v){}addVideoLayer(a,c,p,v){}addRasterLayer(a,c,p,v){}addFillExtrusionLayer(a,c,p,v){}addHeatmapLayer(a,c,p,v){}addHillshadeLayer(a,c,p,v){}addGeoJSONSource(a,c,p){return c&&typeof c=="object"&&!(c.type==="FeatureCollection"||c.type==="GeometryCollection"||c.geometry||c.coordinates)&&(p=c,c=void 0),c||(c={type:"FeatureCollection",features:[]}),this.addSource(a,{type:"geojson",data:c??void 0,...p})}addGeoJSON(a,c,p){return this.addGeoJSONSource(a,c,p)}addSource(a,c){const p=this.map.getStyle();if(!p)throw"Map has no style";return p.sources[a]=c,this.map.setStyle(p),this._makeSource(a)}layersBySource(a){const c=this.map.getStyle();if(!c)throw"Map has no style";return c.layers.filter(p=>p.source===a).map(p=>p.id)}addVectorSource(a,c,p={}){return typeof c=="string"?c.match(/\{z\}/)?this.addSource(a,{...p,type:"vector",tiles:[c]}):this.addSource(a,{...p,type:"vector",url:c}):this.addSource(a,{...c,type:"vector"})}addVector(a,c,p={}){return this.addVectorSource(a,c,p)}addRasterSource(a,c){return this.addSource(a,{...c,type:"raster"})}addRasterDemSource(a,c){return this.addSource(a,{...c,type:"raster-dem"})}addImageSource(a,c){return this.addSource(a,{...c,type:"image"})}addVideoSource(a,c){return this.addSource(a,{...c,type:"video"})}properties(a){if(!a)return;const c={},p={paint:{},layout:{},other:{}};return Object.keys(a).forEach(v=>{const y=_p(v);p[hb(y)][y]=a[v]}),Object.keys(p.paint).length&&(c.paint=p.paint),Object.keys(p.layout).length&&(c.layout=p.layout),Object.assign(c,p.other),c}layerStyle(...a){const[c,p,v]=a,y=a.find(s=>typeof s=="object"&&!Array.isArray(s)),f=typeof y=="object"?this.properties(y)||{}:{};return typeof c=="string"&&(f.id=c),typeof p=="string"&&(f.source=p),typeof v=="string"&&(f.type=v),f}getLayerStyle(a){var c,p;return(p=(c=this.map.getStyle())==null?void 0:c.layers)==null?void 0:p.find(v=>v.id===a)}setData(a,c={type:"FeatureCollection",features:[]}){this.map.getSource(a).setData(c)}onLoad(a){if(a)this.map.loaded()||this._loaded?a():this.map.once("load",()=>{this._loaded=!0,a()});else return new Promise(c=>this.onLoad(c))}setRootProperty(a,c){const p=this.map.getStyle();p[_p(a)]=c,this.map.setStyle(p)}setTransition(a){this.setRootProperty("transition",a)}loadImage(a,c,p){return typeof c=="string"?new Promise((v,y)=>{this.map.loadImage(c,(f,s)=>{f||!s?(console.error(`Error loading image ${c}`,f),y(`Error loading image ${c}`)):(this.map.addImage(a,s,p),v(a))})}):this.map.addImage(a,c,p)}lockOrientation(){const a=this.map.getBearing(),c=this.map.getPitch();this.map.touchZoomRotate.disableRotation(),this.map.dragRotate.disable(),this.map.on("move",()=>{this.map.getBearing()!==a&&this.map.setBearing(a),this.map.getPitch()!==c&&this.map.setPitch(c)})}fontsInUse(){function a(y){Array.isArray(y)&&(y[0]==="literal"?c.push(...y[1]):y.forEach(a))}let c=[];const p=this.map.getStyle();if(!p)throw"Map has no style";const v=p.layers.map(y=>y.type==="symbol"&&y.layout&&y.layout["text-font"]).filter(Boolean);for(const y of v)if(y.stops)try{c.push(...y.stops.flat().filter(Array.isArray).flat())}catch{console.log("Couldn't process font expression:",y)}else y.every(f=>typeof f=="string")?c.push(...y):a(y);return[...new Set(c)]}_makeSource(a){const c=new vc;return c.map=this.map,c._mapgl=this._mapgl,g_.forEach(function(p){__(p,c,a)}),c}};Vr(vc,"zoom",vc.interpolateZoom);let rd=vc;const __=(h,a,c)=>{let p;c?p=function(y,f,s){return this.setLayer(y,c,h,f,s)}:p=function(y,f,s,M){return this.setLayer(y,f,h,s,M)};const v=Fp(h);a[`add${v}`]=p,a[`add${v}Layer`]=p};function pb(h){const a=(p,v)=>{const y="set"+Fp(p);h[y]=Ca(function(f,s){return this.map[v](f,p,s)})},c=(p,v)=>{const y="get"+Fp(p);h[y]=Ca(function(f){return this.map[v](f,p)})};xc.paints.forEach(p=>a(p,"setPaintProperty")),xc.layouts.forEach(p=>a(p,"setLayoutProperty")),xc.paints.forEach(p=>c(p,"getPaintProperty")),xc.layouts.forEach(p=>c(p,"getLayoutProperty")),g_.forEach(p=>__(p,h))}const fb=rd.prototype;pb(fb);var Qa=Uint8Array,Pu=Uint16Array,mb=Int32Array,y_=new Qa([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),v_=new Qa([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),gb=new Qa([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),b_=function(h,a){for(var c=new Pu(31),p=0;p<31;++p)c[p]=a+=1<<h[p-1];for(var v=new mb(c[30]),p=1;p<30;++p)for(var y=c[p];y<c[p+1];++y)v[y]=y-c[p]<<5|p;return{b:c,r:v}},x_=b_(y_,2),w_=x_.b,_b=x_.r;w_[28]=258,_b[258]=28;var yb=b_(v_,0),vb=yb.b,Np=new Pu(32768);for(var ln=0;ln<32768;++ln){var yc=(ln&43690)>>1|(ln&21845)<<1;yc=(yc&52428)>>2|(yc&13107)<<2,yc=(yc&61680)>>4|(yc&3855)<<4,Np[ln]=((yc&65280)>>8|(yc&255)<<8)>>1}var sh=function(h,a,c){for(var p=h.length,v=0,y=new Pu(a);v<p;++v)h[v]&&++y[h[v]-1];var f=new Pu(a);for(v=1;v<a;++v)f[v]=f[v-1]+y[v-1]<<1;var s;if(c){s=new Pu(1<<a);var M=15-a;for(v=0;v<p;++v)if(h[v])for(var B=v<<4|h[v],V=a-h[v],U=f[h[v]-1]++<<V,J=U|(1<<V)-1;U<=J;++U)s[Np[U]>>M]=B}else for(s=new Pu(p),v=0;v<p;++v)h[v]&&(s[v]=Np[f[h[v]-1]++]>>15-h[v]);return s},hh=new Qa(288);for(var ln=0;ln<144;++ln)hh[ln]=8;for(var ln=144;ln<256;++ln)hh[ln]=9;for(var ln=256;ln<280;++ln)hh[ln]=7;for(var ln=280;ln<288;++ln)hh[ln]=8;var P_=new Qa(32);for(var ln=0;ln<32;++ln)P_[ln]=5;var bb=sh(hh,9,1),xb=sh(P_,5,1),yp=function(h){for(var a=h[0],c=1;c<h.length;++c)h[c]>a&&(a=h[c]);return a},Ko=function(h,a,c){var p=a/8|0;return(h[p]|h[p+1]<<8)>>(a&7)&c},vp=function(h,a){var c=a/8|0;return(h[c]|h[c+1]<<8|h[c+2]<<16)>>(a&7)},wb=function(h){return(h+7)/8|0},Pb=function(h,a,c){return(c==null||c>h.length)&&(c=h.length),new Qa(h.subarray(a,c))},Sb=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ja=function(h,a,c){var p=new Error(a||Sb[h]);if(p.code=h,Error.captureStackTrace&&Error.captureStackTrace(p,Ja),!c)throw p;return p},Xp=function(h,a,c,p){var v=h.length,y=0;if(!v||a.f&&!a.l)return c||new Qa(0);var f=!c,s=f||a.i!=2,M=a.i;f&&(c=new Qa(v*3));var B=function($t){var er=c.length;if($t>er){var nr=new Qa(Math.max(er*2,$t));nr.set(c),c=nr}},V=a.f||0,U=a.p||0,J=a.b||0,N=a.l,de=a.d,pe=a.m,De=a.n,fe=v*8;do{if(!N){V=Ko(h,U,1);var ke=Ko(h,U+1,3);if(U+=3,ke)if(ke==1)N=bb,de=xb,pe=9,De=5;else if(ke==2){var Ke=Ko(h,U,31)+257,Ue=Ko(h,U+10,15)+4,Ae=Ke+Ko(h,U+5,31)+1;U+=14;for(var lt=new Qa(Ae),mt=new Qa(19),_e=0;_e<Ue;++_e)mt[gb[_e]]=Ko(h,U+_e*3,7);U+=Ue*3;for(var ve=yp(mt),$e=(1<<ve)-1,Ne=sh(mt,ve,1),_e=0;_e<Ae;){var wt=Ne[Ko(h,U,$e)];U+=wt&15;var He=wt>>4;if(He<16)lt[_e++]=He;else{var ut=0,At=0;for(He==16?(At=3+Ko(h,U,3),U+=2,ut=lt[_e-1]):He==17?(At=3+Ko(h,U,7),U+=3):He==18&&(At=11+Ko(h,U,127),U+=7);At--;)lt[_e++]=ut}}var ht=lt.subarray(0,Ke),Tt=lt.subarray(Ke);pe=yp(ht),De=yp(Tt),N=sh(ht,pe,1),de=sh(Tt,De,1)}else Ja(1);else{var He=wb(U)+4,Oe=h[He-4]|h[He-3]<<8,Le=He+Oe;if(Le>v){M&&Ja(0);break}s&&B(J+Oe),c.set(h.subarray(He,Le),J),a.b=J+=Oe,a.p=U=Le*8,a.f=V;continue}if(U>fe){M&&Ja(0);break}}s&&B(J+131072);for(var Dt=(1<<pe)-1,sr=(1<<De)-1,ne=U;;ne=U){var ut=N[vp(h,U)&Dt],Ie=ut>>4;if(U+=ut&15,U>fe){M&&Ja(0);break}if(ut||Ja(2),Ie<256)c[J++]=Ie;else if(Ie==256){ne=U,N=null;break}else{var Re=Ie-254;if(Ie>264){var _e=Ie-257,We=y_[_e];Re=Ko(h,U,(1<<We)-1)+w_[_e],U+=We}var nt=de[vp(h,U)&sr],at=nt>>4;nt||Ja(3),U+=nt&15;var Tt=vb[at];if(at>3){var We=v_[at];Tt+=vp(h,U)&(1<<We)-1,U+=We}if(U>fe){M&&Ja(0);break}s&&B(J+131072);var pt=J+Re;if(J<Tt){var gt=y-Tt,Ht=Math.min(Tt,pt);for(gt+J<0&&Ja(3);J<Ht;++J)c[J]=p[gt+J]}for(;J<pt;++J)c[J]=c[J-Tt]}}a.l=N,a.p=ne,a.b=J,a.f=V,N&&(V=1,a.m=pe,a.d=de,a.n=De)}while(!V);return J!=c.length&&f?Pb(c,0,J):c.subarray(0,J)},Ab=new Qa(0),Tb=function(h){(h[0]!=31||h[1]!=139||h[2]!=8)&&Ja(6,"invalid gzip data");var a=h[3],c=10;a&4&&(c+=(h[10]|h[11]<<8)+2);for(var p=(a>>3&1)+(a>>4&1);p>0;p-=!h[c++]);return c+(a&2)},Ib=function(h){var a=h.length;return(h[a-4]|h[a-3]<<8|h[a-2]<<16|h[a-1]<<24)>>>0},Cb=function(h,a){return((h[0]&15)!=8||h[0]>>4>7||(h[0]<<8|h[1])%31)&&Ja(6,"invalid zlib data"),(h[1]>>5&1)==1&&Ja(6,"invalid zlib data: "+(h[1]&32?"need":"unexpected")+" dictionary"),(h[1]>>3&4)+2};function Mb(h,a){return Xp(h,{i:2},a,a)}function Lb(h,a){var c=Tb(h);return c+8>h.length&&Ja(6,"invalid gzip data"),Xp(h.subarray(c,-8),{i:2},new Qa(Ib(h)),a)}function Eb(h,a){return Xp(h.subarray(Cb(h),-4),{i:2},a,a)}function kb(h,a){return h[0]==31&&h[1]==139&&h[2]==8?Lb(h,a):(h[0]&15)!=8||h[0]>>4>7||(h[0]<<8|h[1])%31?Mb(h,a):Eb(h,a)}var zb=typeof TextDecoder<"u"&&new TextDecoder,Db=0;try{zb.decode(Ab,{stream:!0}),Db=1}catch{}var Fb=Object.defineProperty,ah=Math.pow,$i=(h,a)=>Fb(h,"name",{value:a,configurable:!0}),vs=(h,a,c)=>new Promise((p,v)=>{var y=M=>{try{s(c.next(M))}catch(B){v(B)}},f=M=>{try{s(c.throw(M))}catch(B){v(B)}},s=M=>M.done?p(M.value):Promise.resolve(M.value).then(y,f);s((c=c.apply(h,a)).next())});$i((h,a)=>{let c=!1,p="",v=L.GridLayer.extend({createTile:$i((y,f)=>{let s=document.createElement("img"),M=new AbortController,B=M.signal;return s.cancel=()=>{M.abort()},c||(h.getHeader().then(V=>{V.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):V.tileType===2?p="image/png":V.tileType===3?p="image/jpeg":V.tileType===4?p="image/webp":V.tileType===5&&(p="image/avif")}),c=!0),h.getZxy(y.z,y.x,y.y,B).then(V=>{if(V){let U=new Blob([V.data],{type:p}),J=window.URL.createObjectURL(U);s.src=J,s.cancel=void 0,f(void 0,s)}}).catch(V=>{if(V.name!=="AbortError")throw V}),s},"createTile"),_removeTile:$i(function(y){let f=this._tiles[y];f&&(f.el.cancel&&f.el.cancel(),f.el.width=0,f.el.height=0,f.el.deleted=!0,L.DomUtil.remove(f.el),delete this._tiles[y],this.fire("tileunload",{tile:f.el,coords:this._keyToTileCoords(y)}))},"_removeTile")});return new v(a)},"leafletRasterLayer");var Nb=$i(h=>(a,c)=>{if(c instanceof AbortController)return h(a,c);let p=new AbortController;return h(a,p).then(v=>c(void 0,v.data,v.cacheControl||"",v.expires||""),v=>c(v)).catch(v=>c(v)),{cancel:$i(()=>p.abort(),"cancel")}},"v3compat"),S_=class{constructor(a){this.tilev4=$i((c,p)=>vs(this,null,function*(){if(c.type==="json"){let N=c.url.substr(10),de=this.tiles.get(N);if(de||(de=new Eg(N),this.tiles.set(N,de)),this.metadata)return{data:yield de.getTileJson(c.url)};let pe=yield de.getHeader();return(pe.minLon>=pe.maxLon||pe.minLat>=pe.maxLat)&&console.error(`Bounds of PMTiles archive ${pe.minLon},${pe.minLat},${pe.maxLon},${pe.maxLat} are not valid.`),{data:{tiles:[`${c.url}/{z}/{x}/{y}`],minzoom:pe.minZoom,maxzoom:pe.maxZoom,bounds:[pe.minLon,pe.minLat,pe.maxLon,pe.maxLat]}}}let v=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),y=c.url.match(v);if(!y)throw new Error("Invalid PMTiles protocol URL");let f=y[1],s=this.tiles.get(f);s||(s=new Eg(f),this.tiles.set(f,s));let M=y[2],B=y[3],V=y[4],U=yield s.getHeader(),J=yield s==null?void 0:s.getZxy(+M,+B,+V,p.signal);if(J)return{data:new Uint8Array(J.data),cacheControl:J.cacheControl,expires:J.expires};if(U.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=Nb(this.tilev4),this.tiles=new Map,this.metadata=(a==null?void 0:a.metadata)||!1,this.errorOnMissingTile=(a==null?void 0:a.errorOnMissingTile)||!1}add(a){this.tiles.set(a.source.getKey(),a)}get(a){return this.tiles.get(a)}};$i(S_,"Protocol");var Rb=S_;function A_(h,a){return(a>>>0)*4294967296+(h>>>0)}$i(A_,"toNum");function T_(h,a){let c=a.buf,p=c[a.pos++],v=(p&112)>>4;if(p<128||(p=c[a.pos++],v|=(p&127)<<3,p<128)||(p=c[a.pos++],v|=(p&127)<<10,p<128)||(p=c[a.pos++],v|=(p&127)<<17,p<128)||(p=c[a.pos++],v|=(p&127)<<24,p<128)||(p=c[a.pos++],v|=(p&1)<<31,p<128))return A_(h,v);throw new Error("Expected varint not more than 10 bytes")}$i(T_,"readVarintRemainder");function bu(h){let a=h.buf,c=a[h.pos++],p=c&127;return c<128||(c=a[h.pos++],p|=(c&127)<<7,c<128)||(c=a[h.pos++],p|=(c&127)<<14,c<128)||(c=a[h.pos++],p|=(c&127)<<21,c<128)?p:(c=a[h.pos],p|=(c&15)<<28,T_(p,h))}$i(bu,"readVarint");function Yp(h,a,c,p){if(p===0){c===1&&(a[0]=h-1-a[0],a[1]=h-1-a[1]);let v=a[0];a[0]=a[1],a[1]=v}}$i(Yp,"rotate");function I_(h,a){let c=ah(2,h),p=a,v=a,y=a,f=[0,0],s=1;for(;s<c;)p=1&y/2,v=1&(y^p),Yp(s,f,p,v),f[0]+=s*p,f[1]+=s*v,y=y/4,s*=2;return[h,f[0],f[1]]}$i(I_,"idOnLevel");var Bb=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function C_(h,a,c){if(h>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(a>ah(2,h)-1||c>ah(2,h)-1)throw new Error("tile x/y outside zoom level bounds");let p=Bb[h],v=ah(2,h),y=0,f=0,s=0,M=[a,c],B=v/2;for(;B>0;)y=(M[0]&B)>0?1:0,f=(M[1]&B)>0?1:0,s+=B*B*(3*y^f),Yp(B,M,y,f),B=B/2;return p+s}$i(C_,"zxyToTileId");function Ob(h){let a=0;for(let c=0;c<27;c++){let p=(1<<c)*(1<<c);if(a+p>h)return I_(c,h-a);a+=p}throw new Error("Tile zoom level exceeds max safe number limit (26)")}$i(Ob,"tileIdToZxy");var jb=(h=>(h[h.Unknown=0]="Unknown",h[h.None=1]="None",h[h.Gzip=2]="Gzip",h[h.Brotli=3]="Brotli",h[h.Zstd=4]="Zstd",h))(jb||{});function ud(h,a){return vs(this,null,function*(){if(a===1||a===0)return h;if(a===2){if(typeof globalThis.DecompressionStream>"u")return kb(new Uint8Array(h));let c=new Response(h).body;if(!c)throw new Error("Failed to read response stream");let p=c.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(p).arrayBuffer()}throw new Error("Compression method not supported")})}$i(ud,"defaultDecompress");var qb=(h=>(h[h.Unknown=0]="Unknown",h[h.Mvt=1]="Mvt",h[h.Png=2]="Png",h[h.Jpeg=3]="Jpeg",h[h.Webp=4]="Webp",h[h.Avif=5]="Avif",h))(qb||{});function M_(h){return h===1?".mvt":h===2?".png":h===3?".jpg":h===4?".webp":h===5?".avif":""}$i(M_,"tileTypeExt");var Vb=127;function L_(h,a){let c=0,p=h.length-1;for(;c<=p;){let v=p+c>>1,y=a-h[v].tileId;if(y>0)c=v+1;else if(y<0)p=v-1;else return h[v]}return p>=0&&(h[p].runLength===0||a-h[p].tileId<h[p].runLength)?h[p]:null}$i(L_,"findTile");var Ub=class{constructor(a){this.file=a}getKey(){return this.file.name}getBytes(a,c){return vs(this,null,function*(){return{data:yield this.file.slice(a,a+c).arrayBuffer()}})}};$i(Ub,"FileSource");var E_=class{constructor(a,c=new Headers){this.url=a,this.customHeaders=c,this.mustReload=!1;let p="";"navigator"in globalThis&&(p=globalThis.navigator.userAgent||"");let v=p.indexOf("Windows")>-1,y=/Chrome|Chromium|Edg|OPR|Brave/.test(p);this.chromeWindowsNoCache=!1,v&&y&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(a){this.customHeaders=a}getBytes(a,c,p,v){return vs(this,null,function*(){let y,f;p?f=p:(y=new AbortController,f=y.signal);let s=new Headers(this.customHeaders);s.set("range",`bytes=${a}-${a+c-1}`);let M;this.mustReload?M="reload":this.chromeWindowsNoCache&&(M="no-store");let B=yield fetch(this.url,{signal:f,cache:M,headers:s});if(a===0&&B.status===416){let J=B.headers.get("Content-Range");if(!J||!J.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let N=+J.substr(8);B=yield fetch(this.url,{signal:f,cache:"reload",headers:{range:`bytes=0-${N-1}`}})}let V=B.headers.get("Etag");if(V!=null&&V.startsWith("W/")&&(V=null),B.status===416||v&&V&&V!==v)throw this.mustReload=!0,new Rp(`Server returned non-matching ETag ${v} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(B.status>=300)throw new Error(`Bad response code: ${B.status}`);let U=B.headers.get("Content-Length");if(B.status===200&&(!U||+U>c))throw y&&y.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield B.arrayBuffer(),etag:V||void 0,cacheControl:B.headers.get("Cache-Control")||void 0,expires:B.headers.get("Expires")||void 0}})}};$i(E_,"FetchSource");var Zb=E_;function xo(h,a){let c=h.getUint32(a+4,!0),p=h.getUint32(a+0,!0);return c*ah(2,32)+p}$i(xo,"getUint64");function k_(h,a){let c=new DataView(h),p=c.getUint8(7);if(p>3)throw new Error(`Archive is spec version ${p} but this library supports up to spec version 3`);return{specVersion:p,rootDirectoryOffset:xo(c,8),rootDirectoryLength:xo(c,16),jsonMetadataOffset:xo(c,24),jsonMetadataLength:xo(c,32),leafDirectoryOffset:xo(c,40),leafDirectoryLength:xo(c,48),tileDataOffset:xo(c,56),tileDataLength:xo(c,64),numAddressedTiles:xo(c,72),numTileEntries:xo(c,80),numTileContents:xo(c,88),clustered:c.getUint8(96)===1,internalCompression:c.getUint8(97),tileCompression:c.getUint8(98),tileType:c.getUint8(99),minZoom:c.getUint8(100),maxZoom:c.getUint8(101),minLon:c.getInt32(102,!0)/1e7,minLat:c.getInt32(106,!0)/1e7,maxLon:c.getInt32(110,!0)/1e7,maxLat:c.getInt32(114,!0)/1e7,centerZoom:c.getUint8(118),centerLon:c.getInt32(119,!0)/1e7,centerLat:c.getInt32(123,!0)/1e7,etag:a}}$i(k_,"bytesToHeader");function Kp(h){let a={buf:new Uint8Array(h),pos:0},c=bu(a),p=[],v=0;for(let y=0;y<c;y++){let f=bu(a);p.push({tileId:v+f,offset:0,length:0,runLength:1}),v+=f}for(let y=0;y<c;y++)p[y].runLength=bu(a);for(let y=0;y<c;y++)p[y].length=bu(a);for(let y=0;y<c;y++){let f=bu(a);f===0&&y>0?p[y].offset=p[y-1].offset+p[y-1].length:p[y].offset=f-1}return p}$i(Kp,"deserializeIndex");var z_=class extends Error{};$i(z_,"EtagMismatch");var Rp=z_;function Jp(h,a){return vs(this,null,function*(){let c=yield h.getBytes(0,16384);if(new DataView(c.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let p=c.data.slice(0,Vb),v=k_(p,c.etag),y=c.data.slice(v.rootDirectoryOffset,v.rootDirectoryOffset+v.rootDirectoryLength),f=`${h.getKey()}|${v.etag||""}|${v.rootDirectoryOffset}|${v.rootDirectoryLength}`,s=Kp(yield a(y,v.internalCompression));return[v,[f,s.length,s]]})}$i(Jp,"getHeaderAndRoot");function Qp(h,a,c,p,v){return vs(this,null,function*(){let y=yield h.getBytes(c,p,void 0,v.etag),f=yield a(y.data,v.internalCompression),s=Kp(f);if(s.length===0)throw new Error("Empty directory is invalid");return s})}$i(Qp,"getDirectory");var Gb=class{constructor(a=100,c=!0,p=ud){this.cache=new Map,this.maxCacheEntries=a,this.counter=1,this.decompress=p}getHeader(a){return vs(this,null,function*(){let c=a.getKey(),p=this.cache.get(c);if(p)return p.lastUsed=this.counter++,p.data;let v=yield Jp(a,this.decompress);return v[1]&&this.cache.set(v[1][0],{lastUsed:this.counter++,data:v[1][2]}),this.cache.set(c,{lastUsed:this.counter++,data:v[0]}),this.prune(),v[0]})}getDirectory(a,c,p,v){return vs(this,null,function*(){let y=`${a.getKey()}|${v.etag||""}|${c}|${p}`,f=this.cache.get(y);if(f)return f.lastUsed=this.counter++,f.data;let s=yield Qp(a,this.decompress,c,p,v);return this.cache.set(y,{lastUsed:this.counter++,data:s}),this.prune(),s})}prune(){if(this.cache.size>this.maxCacheEntries){let a=1/0,c;this.cache.forEach((p,v)=>{p.lastUsed<a&&(a=p.lastUsed,c=v)}),c&&this.cache.delete(c)}}invalidate(a){return vs(this,null,function*(){this.cache.delete(a.getKey())})}};$i(Gb,"ResolvedValueCache");var D_=class{constructor(a=100,c=!0,p=ud){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=a,this.counter=1,this.decompress=p}getHeader(a){return vs(this,null,function*(){let c=a.getKey(),p=this.cache.get(c);if(p)return p.lastUsed=this.counter++,yield p.data;let v=new Promise((y,f)=>{Jp(a,this.decompress).then(s=>{s[1]&&this.cache.set(s[1][0],{lastUsed:this.counter++,data:Promise.resolve(s[1][2])}),y(s[0]),this.prune()}).catch(s=>{f(s)})});return this.cache.set(c,{lastUsed:this.counter++,data:v}),v})}getDirectory(a,c,p,v){return vs(this,null,function*(){let y=`${a.getKey()}|${v.etag||""}|${c}|${p}`,f=this.cache.get(y);if(f)return f.lastUsed=this.counter++,yield f.data;let s=new Promise((M,B)=>{Qp(a,this.decompress,c,p,v).then(V=>{M(V),this.prune()}).catch(V=>{B(V)})});return this.cache.set(y,{lastUsed:this.counter++,data:s}),s})}prune(){if(this.cache.size>=this.maxCacheEntries){let a=1/0,c;this.cache.forEach((p,v)=>{p.lastUsed<a&&(a=p.lastUsed,c=v)}),c&&this.cache.delete(c)}}invalidate(a){return vs(this,null,function*(){let c=a.getKey();if(this.invalidations.get(c))return yield this.invalidations.get(c);this.cache.delete(a.getKey());let p=new Promise((v,y)=>{this.getHeader(a).then(f=>{v(),this.invalidations.delete(c)}).catch(f=>{y(f)})});this.invalidations.set(c,p)})}};$i(D_,"SharedPromiseCache");var $b=D_,F_=class{constructor(a,c,p){typeof a=="string"?this.source=new Zb(a):this.source=a,p?this.decompress=p:this.decompress=ud,c?this.cache=c:this.cache=new $b}getHeader(){return vs(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(a,c,p,v){return vs(this,null,function*(){let y=C_(a,c,p),f=yield this.cache.getHeader(this.source);if(a<f.minZoom||a>f.maxZoom)return;let s=f.rootDirectoryOffset,M=f.rootDirectoryLength;for(let B=0;B<=3;B++){let V=yield this.cache.getDirectory(this.source,s,M,f),U=L_(V,y);if(U){if(U.runLength>0){let J=yield this.source.getBytes(f.tileDataOffset+U.offset,U.length,v,f.etag);return{data:yield this.decompress(J.data,f.tileCompression),cacheControl:J.cacheControl,expires:J.expires}}s=f.leafDirectoryOffset+U.offset,M=U.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(a,c,p,v){return vs(this,null,function*(){try{return yield this.getZxyAttempt(a,c,p,v)}catch(y){if(y instanceof Rp)return this.cache.invalidate(this.source),yield this.getZxyAttempt(a,c,p,v);throw y}})}getMetadataAttempt(){return vs(this,null,function*(){let a=yield this.cache.getHeader(this.source),c=yield this.source.getBytes(a.jsonMetadataOffset,a.jsonMetadataLength,void 0,a.etag),p=yield this.decompress(c.data,a.internalCompression),v=new TextDecoder("utf-8");return JSON.parse(v.decode(p))})}getMetadata(){return vs(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(a){if(a instanceof Rp)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw a}})}getTileJson(a){return vs(this,null,function*(){let c=yield this.getHeader(),p=yield this.getMetadata(),v=M_(c.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${a}/{z}/{x}/{y}${v}`],vector_layers:p.vector_layers,attribution:p.attribution,description:p.description,name:p.name,version:p.version,bounds:[c.minLon,c.minLat,c.maxLon,c.maxLat],center:[c.centerLon,c.centerLat,c.centerZoom],minzoom:c.minZoom,maxzoom:c.maxZoom}})}};$i(F_,"PMTiles");var Eg=F_,N_="1.13.7",kg=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global||Function("return this")()||{},hd=Array.prototype,ef=Object.prototype,zg=typeof Symbol<"u"?Symbol.prototype:null,Wb=hd.push,dh=hd.slice,lh=ef.toString,Hb=ef.hasOwnProperty,R_=typeof ArrayBuffer<"u",Xb=typeof DataView<"u",Yb=Array.isArray,Dg=Object.keys,Fg=Object.create,Ng=R_&&ArrayBuffer.isView,Kb=isNaN,Jb=isFinite,B_=!{toString:null}.propertyIsEnumerable("toString"),Rg=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],Qb=Math.pow(2,53)-1;function Ma(h,a){return a=a==null?h.length-1:+a,function(){for(var c=Math.max(arguments.length-a,0),p=Array(c),v=0;v<c;v++)p[v]=arguments[v+a];switch(a){case 0:return h.call(this,p);case 1:return h.call(this,arguments[0],p);case 2:return h.call(this,arguments[0],arguments[1],p)}var y=Array(a+1);for(v=0;v<a;v++)y[v]=arguments[v];return y[a]=p,h.apply(this,y)}}function $c(h){var a=typeof h;return a==="function"||a==="object"&&!!h}function e2(h){return h===null}function O_(h){return h===void 0}function j_(h){return h===!0||h===!1||lh.call(h)==="[object Boolean]"}function t2(h){return!!(h&&h.nodeType===1)}function Ys(h){var a="[object "+h+"]";return function(c){return lh.call(c)===a}}const tf=Ys("String"),q_=Ys("Number"),r2=Ys("Date"),i2=Ys("RegExp"),n2=Ys("Error"),V_=Ys("Symbol"),U_=Ys("ArrayBuffer");var Z_=Ys("Function"),s2=kg.document&&kg.document.childNodes;typeof/./!="function"&&typeof Int8Array!="object"&&typeof s2!="function"&&(Z_=function(h){return typeof h=="function"||!1});const pa=Z_,G_=Ys("Object");var $_=Xb&&(!/\[native code\]/.test(String(DataView))||G_(new DataView(new ArrayBuffer(8)))),rf=typeof Map<"u"&&G_(new Map),a2=Ys("DataView");function o2(h){return h!=null&&pa(h.getInt8)&&U_(h.buffer)}const id=$_?o2:a2,Wc=Yb||Ys("Array");function Sc(h,a){return h!=null&&Hb.call(h,a)}var Bp=Ys("Arguments");(function(){Bp(arguments)||(Bp=function(h){return Sc(h,"callee")})})();const nf=Bp;function l2(h){return!V_(h)&&Jb(h)&&!isNaN(parseFloat(h))}function W_(h){return q_(h)&&Kb(h)}function H_(h){return function(){return h}}function X_(h){return function(a){var c=h(a);return typeof c=="number"&&c>=0&&c<=Qb}}function Y_(h){return function(a){return a==null?void 0:a[h]}}const nd=Y_("byteLength"),c2=X_(nd);var u2=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function h2(h){return Ng?Ng(h)&&!id(h):c2(h)&&u2.test(lh.call(h))}const K_=R_?h2:H_(!1),La=Y_("length");function d2(h){for(var a={},c=h.length,p=0;p<c;++p)a[h[p]]=!0;return{contains:function(v){return a[v]===!0},push:function(v){return a[v]=!0,h.push(v)}}}function J_(h,a){a=d2(a);var c=Rg.length,p=h.constructor,v=pa(p)&&p.prototype||ef,y="constructor";for(Sc(h,y)&&!a.contains(y)&&a.push(y);c--;)y=Rg[c],y in h&&h[y]!==v[y]&&!a.contains(y)&&a.push(y)}function bs(h){if(!$c(h))return[];if(Dg)return Dg(h);var a=[];for(var c in h)Sc(h,c)&&a.push(c);return B_&&J_(h,a),a}function p2(h){if(h==null)return!0;var a=La(h);return typeof a=="number"&&(Wc(h)||tf(h)||nf(h))?a===0:La(bs(h))===0}function Q_(h,a){var c=bs(a),p=c.length;if(h==null)return!p;for(var v=Object(h),y=0;y<p;y++){var f=c[y];if(a[f]!==v[f]||!(f in v))return!1}return!0}function Ei(h){if(h instanceof Ei)return h;if(!(this instanceof Ei))return new Ei(h);this._wrapped=h}Ei.VERSION=N_;Ei.prototype.value=function(){return this._wrapped};Ei.prototype.valueOf=Ei.prototype.toJSON=Ei.prototype.value;Ei.prototype.toString=function(){return String(this._wrapped)};function Bg(h){return new Uint8Array(h.buffer||h,h.byteOffset||0,nd(h))}var Og="[object DataView]";function Op(h,a,c,p){if(h===a)return h!==0||1/h===1/a;if(h==null||a==null)return!1;if(h!==h)return a!==a;var v=typeof h;return v!=="function"&&v!=="object"&&typeof a!="object"?!1:ey(h,a,c,p)}function ey(h,a,c,p){h instanceof Ei&&(h=h._wrapped),a instanceof Ei&&(a=a._wrapped);var v=lh.call(h);if(v!==lh.call(a))return!1;if($_&&v=="[object Object]"&&id(h)){if(!id(a))return!1;v=Og}switch(v){case"[object RegExp]":case"[object String]":return""+h==""+a;case"[object Number]":return+h!=+h?+a!=+a:+h==0?1/+h===1/a:+h==+a;case"[object Date]":case"[object Boolean]":return+h==+a;case"[object Symbol]":return zg.valueOf.call(h)===zg.valueOf.call(a);case"[object ArrayBuffer]":case Og:return ey(Bg(h),Bg(a),c,p)}var y=v==="[object Array]";if(!y&&K_(h)){var f=nd(h);if(f!==nd(a))return!1;if(h.buffer===a.buffer&&h.byteOffset===a.byteOffset)return!0;y=!0}if(!y){if(typeof h!="object"||typeof a!="object")return!1;var s=h.constructor,M=a.constructor;if(s!==M&&!(pa(s)&&s instanceof s&&pa(M)&&M instanceof M)&&"constructor"in h&&"constructor"in a)return!1}c=c||[],p=p||[];for(var B=c.length;B--;)if(c[B]===h)return p[B]===a;if(c.push(h),p.push(a),y){if(B=h.length,B!==a.length)return!1;for(;B--;)if(!Op(h[B],a[B],c,p))return!1}else{var V=bs(h),U;if(B=V.length,bs(a).length!==B)return!1;for(;B--;)if(U=V[B],!(Sc(a,U)&&Op(h[U],a[U],c,p)))return!1}return c.pop(),p.pop(),!0}function f2(h,a){return Op(h,a)}function ph(h){if(!$c(h))return[];var a=[];for(var c in h)a.push(c);return B_&&J_(h,a),a}function sf(h){var a=La(h);return function(c){if(c==null)return!1;var p=ph(c);if(La(p))return!1;for(var v=0;v<a;v++)if(!pa(c[h[v]]))return!1;return h!==iy||!pa(c[af])}}var af="forEach",ty="has",of=["clear","delete"],ry=["get",ty,"set"],m2=of.concat(af,ry),iy=of.concat(ry),g2=["add"].concat(of,af,ty);const _2=rf?sf(m2):Ys("Map"),y2=rf?sf(iy):Ys("WeakMap"),v2=rf?sf(g2):Ys("Set"),b2=Ys("WeakSet");function Lu(h){for(var a=bs(h),c=a.length,p=Array(c),v=0;v<c;v++)p[v]=h[a[v]];return p}function x2(h){for(var a=bs(h),c=a.length,p=Array(c),v=0;v<c;v++)p[v]=[a[v],h[a[v]]];return p}function ny(h){for(var a={},c=bs(h),p=0,v=c.length;p<v;p++)a[h[c[p]]]=c[p];return a}function jp(h){var a=[];for(var c in h)pa(h[c])&&a.push(c);return a.sort()}function lf(h,a){return function(c){var p=arguments.length;if(a&&(c=Object(c)),p<2||c==null)return c;for(var v=1;v<p;v++)for(var y=arguments[v],f=h(y),s=f.length,M=0;M<s;M++){var B=f[M];(!a||c[B]===void 0)&&(c[B]=y[B])}return c}}const sy=lf(ph),sd=lf(bs),ay=lf(ph,!0);function w2(){return function(){}}function oy(h){if(!$c(h))return{};if(Fg)return Fg(h);var a=w2();a.prototype=h;var c=new a;return a.prototype=null,c}function P2(h,a){var c=oy(h);return a&&sd(c,a),c}function S2(h){return $c(h)?Wc(h)?h.slice():sy({},h):h}function A2(h,a){return a(h),h}function ly(h){return Wc(h)?h:[h]}Ei.toPath=ly;function fh(h){return Ei.toPath(h)}function cf(h,a){for(var c=a.length,p=0;p<c;p++){if(h==null)return;h=h[a[p]]}return c?h:void 0}function cy(h,a,c){var p=cf(h,fh(a));return O_(p)?c:p}function T2(h,a){a=fh(a);for(var c=a.length,p=0;p<c;p++){var v=a[p];if(!Sc(h,v))return!1;h=h[v]}return!!c}function uf(h){return h}function ch(h){return h=sd({},h),function(a){return Q_(a,h)}}function hf(h){return h=fh(h),function(a){return cf(a,h)}}function mh(h,a,c){if(a===void 0)return h;switch(c??3){case 1:return function(p){return h.call(a,p)};case 3:return function(p,v,y){return h.call(a,p,v,y)};case 4:return function(p,v,y,f){return h.call(a,p,v,y,f)}}return function(){return h.apply(a,arguments)}}function uy(h,a,c){return h==null?uf:pa(h)?mh(h,a,c):$c(h)&&!Wc(h)?ch(h):hf(h)}function df(h,a){return uy(h,a,1/0)}Ei.iteratee=df;function ka(h,a,c){return Ei.iteratee!==df?Ei.iteratee(h,a):uy(h,a,c)}function I2(h,a,c){a=ka(a,c);for(var p=bs(h),v=p.length,y={},f=0;f<v;f++){var s=p[f];y[s]=a(h[s],s,h)}return y}function hy(){}function C2(h){return h==null?hy:function(a){return cy(h,a)}}function M2(h,a,c){var p=Array(Math.max(0,h));a=mh(a,c,1);for(var v=0;v<h;v++)p[v]=a(v);return p}function qp(h,a){return a==null&&(a=h,h=0),h+Math.floor(Math.random()*(a-h+1))}const uh=Date.now||function(){return new Date().getTime()};function dy(h){var a=function(y){return h[y]},c="(?:"+bs(h).join("|")+")",p=RegExp(c),v=RegExp(c,"g");return function(y){return y=y==null?"":""+y,p.test(y)?y.replace(v,a):y}}const py={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},L2=dy(py),E2=ny(py),k2=dy(E2),z2=Ei.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var bp=/(.)^/,D2={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},F2=/\\|'|\r|\n|\u2028|\u2029/g;function N2(h){return"\\"+D2[h]}var R2=/^\s*(\w|\$)+\s*$/;function B2(h,a,c){!a&&c&&(a=c),a=ay({},a,Ei.templateSettings);var p=RegExp([(a.escape||bp).source,(a.interpolate||bp).source,(a.evaluate||bp).source].join("|")+"|$","g"),v=0,y="__p+='";h.replace(p,function(B,V,U,J,N){return y+=h.slice(v,N).replace(F2,N2),v=N+B.length,V?y+=`'+
((__t=(`+V+`))==null?'':_.escape(__t))+
'`:U?y+=`'+
((__t=(`+U+`))==null?'':__t)+
'`:J&&(y+=`';
`+J+`
__p+='`),B}),y+=`';
`;var f=a.variable;if(f){if(!R2.test(f))throw new Error("variable is not a bare identifier: "+f)}else y=`with(obj||{}){
`+y+`}
`,f="obj";y=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+y+`return __p;
`;var s;try{s=new Function(f,"_",y)}catch(B){throw B.source=y,B}var M=function(B){return s.call(this,B,Ei)};return M.source="function("+f+`){
`+y+"}",M}function O2(h,a,c){a=fh(a);var p=a.length;if(!p)return pa(c)?c.call(h):c;for(var v=0;v<p;v++){var y=h==null?void 0:h[a[v]];y===void 0&&(y=c,v=p),h=pa(y)?y.call(h):y}return h}var j2=0;function q2(h){var a=++j2+"";return h?h+a:a}function V2(h){var a=Ei(h);return a._chain=!0,a}function fy(h,a,c,p,v){if(!(p instanceof a))return h.apply(c,v);var y=oy(h.prototype),f=h.apply(y,v);return $c(f)?f:y}var Eu=Ma(function(h,a){var c=Eu.placeholder,p=function(){for(var v=0,y=a.length,f=Array(y),s=0;s<y;s++)f[s]=a[s]===c?arguments[v++]:a[s];for(;v<arguments.length;)f.push(arguments[v++]);return fy(h,p,this,this,f)};return p});Eu.placeholder=Ei;const my=Ma(function(h,a,c){if(!pa(h))throw new TypeError("Bind must be called on a function");var p=Ma(function(v){return fy(h,p,a,this,c.concat(v))});return p}),to=X_(La);function Hc(h,a,c,p){if(p=p||[],!a&&a!==0)a=1/0;else if(a<=0)return p.concat(h);for(var v=p.length,y=0,f=La(h);y<f;y++){var s=h[y];if(to(s)&&(Wc(s)||nf(s)))if(a>1)Hc(s,a-1,c,p),v=p.length;else for(var M=0,B=s.length;M<B;)p[v++]=s[M++];else c||(p[v++]=s)}return p}const U2=Ma(function(h,a){a=Hc(a,!1,!1);var c=a.length;if(c<1)throw new Error("bindAll must be passed function names");for(;c--;){var p=a[c];h[p]=my(h[p],h)}return h});function Z2(h,a){var c=function(p){var v=c.cache,y=""+(a?a.apply(this,arguments):p);return Sc(v,y)||(v[y]=h.apply(this,arguments)),v[y]};return c.cache={},c}const gy=Ma(function(h,a,c){return setTimeout(function(){return h.apply(null,c)},a)}),G2=Eu(gy,Ei,1);function _y(h,a,c){var p,v,y,f,s=0;c||(c={});var M=function(){s=c.leading===!1?0:uh(),p=null,f=h.apply(v,y),p||(v=y=null)},B=function(){var V=uh();!s&&c.leading===!1&&(s=V);var U=a-(V-s);return v=this,y=arguments,U<=0||U>a?(p&&(clearTimeout(p),p=null),s=V,f=h.apply(v,y),p||(v=y=null)):!p&&c.trailing!==!1&&(p=setTimeout(M,U)),f};return B.cancel=function(){clearTimeout(p),s=0,p=v=y=null},B}function $2(h,a,c){var p,v,y,f,s,M=function(){var V=uh()-v;a>V?p=setTimeout(M,a-V):(p=null,c||(f=h.apply(s,y)),p||(y=s=null))},B=Ma(function(V){return s=this,y=V,v=uh(),p||(p=setTimeout(M,a),c&&(f=h.apply(s,y))),f});return B.cancel=function(){clearTimeout(p),p=y=s=null},B}function W2(h,a){return Eu(a,h)}function pf(h){return function(){return!h.apply(this,arguments)}}function H2(){var h=arguments,a=h.length-1;return function(){for(var c=a,p=h[a].apply(this,arguments);c--;)p=h[c].call(this,p);return p}}function X2(h,a){return function(){if(--h<1)return a.apply(this,arguments)}}function yy(h,a){var c;return function(){return--h>0&&(c=a.apply(this,arguments)),h<=1&&(a=null),c}}const Y2=Eu(yy,2);function vy(h,a,c){a=ka(a,c);for(var p=bs(h),v,y=0,f=p.length;y<f;y++)if(v=p[y],a(h[v],v,h))return v}function by(h){return function(a,c,p){c=ka(c,p);for(var v=La(a),y=h>0?0:v-1;y>=0&&y<v;y+=h)if(c(a[y],y,a))return y;return-1}}const ff=by(1),xy=by(-1);function wy(h,a,c,p){c=ka(c,p,1);for(var v=c(a),y=0,f=La(h);y<f;){var s=Math.floor((y+f)/2);c(h[s])<v?y=s+1:f=s}return y}function Py(h,a,c){return function(p,v,y){var f=0,s=La(p);if(typeof y=="number")h>0?f=y>=0?y:Math.max(y+s,f):s=y>=0?Math.min(y+1,s):y+s+1;else if(c&&y&&s)return y=c(p,v),p[y]===v?y:-1;if(v!==v)return y=a(dh.call(p,f,s),W_),y>=0?y+f:-1;for(y=h>0?f:s-1;y>=0&&y<s;y+=h)if(p[y]===v)return y;return-1}}const Sy=Py(1,ff,wy),K2=Py(-1,xy);function Vp(h,a,c){var p=to(h)?ff:vy,v=p(h,a,c);if(v!==void 0&&v!==-1)return h[v]}function J2(h,a){return Vp(h,ch(a))}function ec(h,a,c){a=mh(a,c);var p,v;if(to(h))for(p=0,v=h.length;p<v;p++)a(h[p],p,h);else{var y=bs(h);for(p=0,v=y.length;p<v;p++)a(h[y[p]],y[p],h)}return h}function Zc(h,a,c){a=ka(a,c);for(var p=!to(h)&&bs(h),v=(p||h).length,y=Array(v),f=0;f<v;f++){var s=p?p[f]:f;y[f]=a(h[s],s,h)}return y}function Ay(h){var a=function(c,p,v,y){var f=!to(c)&&bs(c),s=(f||c).length,M=h>0?0:s-1;for(y||(v=c[f?f[M]:M],M+=h);M>=0&&M<s;M+=h){var B=f?f[M]:M;v=p(v,c[B],B,c)}return v};return function(c,p,v,y){var f=arguments.length>=3;return a(c,mh(p,y,4),v,f)}}const xp=Ay(1),jg=Ay(-1);function Mu(h,a,c){var p=[];return a=ka(a,c),ec(h,function(v,y,f){a(v,y,f)&&p.push(v)}),p}function Q2(h,a,c){return Mu(h,pf(ka(a)),c)}function qg(h,a,c){a=ka(a,c);for(var p=!to(h)&&bs(h),v=(p||h).length,y=0;y<v;y++){var f=p?p[y]:y;if(!a(h[f],f,h))return!1}return!0}function Vg(h,a,c){a=ka(a,c);for(var p=!to(h)&&bs(h),v=(p||h).length,y=0;y<v;y++){var f=p?p[y]:y;if(a(h[f],f,h))return!0}return!1}function Ql(h,a,c,p){return to(h)||(h=Lu(h)),(typeof c!="number"||p)&&(c=0),Sy(h,a,c)>=0}const ex=Ma(function(h,a,c){var p,v;return pa(a)?v=a:(a=fh(a),p=a.slice(0,-1),a=a[a.length-1]),Zc(h,function(y){var f=v;if(!f){if(p&&p.length&&(y=cf(y,p)),y==null)return;f=y[a]}return f==null?f:f.apply(y,c)})});function mf(h,a){return Zc(h,hf(a))}function tx(h,a){return Mu(h,ch(a))}function Ty(h,a,c){var p=-1/0,v=-1/0,y,f;if(a==null||typeof a=="number"&&typeof h[0]!="object"&&h!=null){h=to(h)?h:Lu(h);for(var s=0,M=h.length;s<M;s++)y=h[s],y!=null&&y>p&&(p=y)}else a=ka(a,c),ec(h,function(B,V,U){f=a(B,V,U),(f>v||f===-1/0&&p===-1/0)&&(p=B,v=f)});return p}function rx(h,a,c){var p=1/0,v=1/0,y,f;if(a==null||typeof a=="number"&&typeof h[0]!="object"&&h!=null){h=to(h)?h:Lu(h);for(var s=0,M=h.length;s<M;s++)y=h[s],y!=null&&y<p&&(p=y)}else a=ka(a,c),ec(h,function(B,V,U){f=a(B,V,U),(f<v||f===1/0&&p===1/0)&&(p=B,v=f)});return p}var ix=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Iy(h){return h?Wc(h)?dh.call(h):tf(h)?h.match(ix):to(h)?Zc(h,uf):Lu(h):[]}function Cy(h,a,c){if(a==null||c)return to(h)||(h=Lu(h)),h[qp(h.length-1)];var p=Iy(h),v=La(p);a=Math.max(Math.min(a,v),0);for(var y=v-1,f=0;f<a;f++){var s=qp(f,y),M=p[f];p[f]=p[s],p[s]=M}return p.slice(0,a)}function nx(h){return Cy(h,1/0)}function sx(h,a,c){var p=0;return a=ka(a,c),mf(Zc(h,function(v,y,f){return{value:v,index:p++,criteria:a(v,y,f)}}).sort(function(v,y){var f=v.criteria,s=y.criteria;if(f!==s){if(f>s||f===void 0)return 1;if(f<s||s===void 0)return-1}return v.index-y.index}),"value")}function dd(h,a){return function(c,p,v){var y=a?[[],[]]:{};return p=ka(p,v),ec(c,function(f,s){var M=p(f,s,c);h(y,f,M)}),y}}const ax=dd(function(h,a,c){Sc(h,c)?h[c].push(a):h[c]=[a]}),ox=dd(function(h,a,c){h[c]=a}),lx=dd(function(h,a,c){Sc(h,c)?h[c]++:h[c]=1}),cx=dd(function(h,a,c){h[c?0:1].push(a)},!0);function ux(h){return h==null?0:to(h)?h.length:bs(h).length}function hx(h,a,c){return a in c}const My=Ma(function(h,a){var c={},p=a[0];if(h==null)return c;pa(p)?(a.length>1&&(p=mh(p,a[1])),a=ph(h)):(p=hx,a=Hc(a,!1,!1),h=Object(h));for(var v=0,y=a.length;v<y;v++){var f=a[v],s=h[f];p(s,f,h)&&(c[f]=s)}return c}),dx=Ma(function(h,a){var c=a[0],p;return pa(c)?(c=pf(c),a.length>1&&(p=a[1])):(a=Zc(Hc(a,!1,!1),String),c=function(v,y){return!Ql(a,y)}),My(h,c,p)});function Ly(h,a,c){return dh.call(h,0,Math.max(0,h.length-(a==null||c?1:a)))}function wp(h,a,c){return h==null||h.length<1?a==null||c?void 0:[]:a==null||c?h[0]:Ly(h,h.length-a)}function Kh(h,a,c){return dh.call(h,a==null||c?1:a)}function px(h,a,c){return h==null||h.length<1?a==null||c?void 0:[]:a==null||c?h[h.length-1]:Kh(h,Math.max(0,h.length-a))}function fx(h){return Mu(h,Boolean)}function mx(h,a){return Hc(h,a,!1)}const Ey=Ma(function(h,a){return a=Hc(a,!0,!0),Mu(h,function(c){return!Ql(a,c)})}),gx=Ma(function(h,a){return Ey(h,a)});function Up(h,a,c,p){j_(a)||(p=c,c=a,a=!1),c!=null&&(c=ka(c,p));for(var v=[],y=[],f=0,s=La(h);f<s;f++){var M=h[f],B=c?c(M,f,h):M;a&&!c?((!f||y!==B)&&v.push(M),y=B):c?Ql(y,B)||(y.push(B),v.push(M)):Ql(v,M)||v.push(M)}return v}const _x=Ma(function(h){return Up(Hc(h,!0,!0))});function yx(h){for(var a=[],c=arguments.length,p=0,v=La(h);p<v;p++){var y=h[p];if(!Ql(a,y)){var f;for(f=1;f<c&&Ql(arguments[f],y);f++);f===c&&a.push(y)}}return a}function Zp(h){for(var a=h&&Ty(h,La).length||0,c=Array(a),p=0;p<a;p++)c[p]=mf(h,p);return c}const vx=Ma(Zp);function bx(h,a){for(var c={},p=0,v=La(h);p<v;p++)a?c[h[p]]=a[p]:c[h[p][0]]=h[p][1];return c}function xx(h,a,c){a==null&&(a=h||0,h=0),c||(c=a<h?-1:1);for(var p=Math.max(Math.ceil((a-h)/c),0),v=Array(p),y=0;y<p;y++,h+=c)v[y]=h;return v}function wx(h,a){if(a==null||a<1)return[];for(var c=[],p=0,v=h.length;p<v;)c.push(dh.call(h,p,p+=a));return c}function gf(h,a){return h._chain?Ei(a).chain():a}function ky(h){return ec(jp(h),function(a){var c=Ei[a]=h[a];Ei.prototype[a]=function(){var p=[this._wrapped];return Wb.apply(p,arguments),gf(this,c.apply(Ei,p))}}),Ei}ec(["pop","push","reverse","shift","sort","splice","unshift"],function(h){var a=hd[h];Ei.prototype[h]=function(){var c=this._wrapped;return c!=null&&(a.apply(c,arguments),(h==="shift"||h==="splice")&&c.length===0&&delete c[0]),gf(this,c)}});ec(["concat","join","slice"],function(h){var a=hd[h];Ei.prototype[h]=function(){var c=this._wrapped;return c!=null&&(c=a.apply(c,arguments)),gf(this,c)}});const Px=Object.freeze(Object.defineProperty({__proto__:null,VERSION:N_,after:X2,all:qg,allKeys:ph,any:Vg,assign:sd,before:yy,bind:my,bindAll:U2,chain:V2,chunk:wx,clone:S2,collect:Zc,compact:fx,compose:H2,constant:H_,contains:Ql,countBy:lx,create:P2,debounce:$2,default:Ei,defaults:ay,defer:G2,delay:gy,detect:Vp,difference:Ey,drop:Kh,each:ec,escape:L2,every:qg,extend:sy,extendOwn:sd,filter:Mu,find:Vp,findIndex:ff,findKey:vy,findLastIndex:xy,findWhere:J2,first:wp,flatten:mx,foldl:xp,foldr:jg,forEach:ec,functions:jp,get:cy,groupBy:ax,has:T2,head:wp,identity:uf,include:Ql,includes:Ql,indexBy:ox,indexOf:Sy,initial:Ly,inject:xp,intersection:yx,invert:ny,invoke:ex,isArguments:nf,isArray:Wc,isArrayBuffer:U_,isBoolean:j_,isDataView:id,isDate:r2,isElement:t2,isEmpty:p2,isEqual:f2,isError:n2,isFinite:l2,isFunction:pa,isMap:_2,isMatch:Q_,isNaN:W_,isNull:e2,isNumber:q_,isObject:$c,isRegExp:i2,isSet:v2,isString:tf,isSymbol:V_,isTypedArray:K_,isUndefined:O_,isWeakMap:y2,isWeakSet:b2,iteratee:df,keys:bs,last:px,lastIndexOf:K2,map:Zc,mapObject:I2,matcher:ch,matches:ch,max:Ty,memoize:Z2,methods:jp,min:rx,mixin:ky,negate:pf,noop:hy,now:uh,object:bx,omit:dx,once:Y2,pairs:x2,partial:Eu,partition:cx,pick:My,pluck:mf,property:hf,propertyOf:C2,random:qp,range:xx,reduce:xp,reduceRight:jg,reject:Q2,rest:Kh,restArguments:Ma,result:O2,sample:Cy,select:Mu,shuffle:nx,size:ux,some:Vg,sortBy:sx,sortedIndex:wy,tail:Kh,take:wp,tap:A2,template:B2,templateSettings:z2,throttle:_y,times:M2,toArray:Iy,toPath:ly,transpose:Zp,unescape:k2,union:_x,uniq:Up,unique:Up,uniqueId:q2,unzip:Zp,values:Lu,where:tx,without:gx,wrap:W2,zip:vx},Symbol.toStringTag,{value:"Module"}));var Ug=ky(Px);Ug._=Ug;let Sx=new Rb;_u.addProtocol("pmtiles",Sx.tile);const Zg=18;document.addEventListener("DOMContentLoaded",async()=>{const h=new _u.Map({container:"map",hash:!0,style:"./style.json",center:[135.57,34.777],zoom:13,maxZoom:19,minZoom:4,localIdeographFontFamily:["BIZ UDPGothic","sans-serif"]});rd.init(h);function a(){const{_sw:M,_ne:B}=h.getBounds();return{minX:M.lng,minY:M.lat,maxX:B.lng,maxY:B.lat}}async function c(){if(h.getZoom()<Zg)return;let M=0;const B={type:"FeatureCollection",features:[]};let V=flatgeobuf.deserialize("./data/r1chikeizu.fgb",a());for await(let U of V)B.features.push({...U,id:M}),M+=1;h.getSource("blocks").setData(B)}h.on("load",()=>{h.on("click",M=>{var N,de,pe,De;const V=["senbiki-fill","youto-fill","koudoti-fill","bouka-fill"].map(fe=>h.queryRenderedFeatures(M.point,{layers:[fe]})[0]);if(V[0]===void 0)return;const U=[V[0].properties.区域区分];U[0]=="市街化区域"&&(U[1]=`<br>${V[1].properties.用途地域}
      <li>容積率：${V[1].properties.容積率}</li>
      <li>建ぺい率：${V[1].properties.建ぺい率}</li>`,U[2]=((de=(N=V[2])==null?void 0:N.properties)==null?void 0:de.Type)??"高度地区指定なし"),U[3]="<br>",U[4]=((De=(pe=V[3])==null?void 0:pe.properties)==null?void 0:De.防火準防火)??"法22条地域";const J=U.join("");new _u.Popup().setLngLat(M.lngLat).setHTML(J).addTo(h)}),h.addSource("blocks",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),h.addLayer({id:"blocks-line",type:"line",source:"blocks",minzoom:Zg,paint:{"line-color":["match",["get","layer"],"建物","#232323","道路","#232323","名称","#a8a1ad","#7b7b7d"],"line-width":["match",["get","layer"],"鉄道",2.6,"行政界等",1.6,"河川",1.6,.6]}}),c=_y(c,500),c(),h.on("moveend",function(M){c()})});const p={forwardGeocode:async M=>{const B=[],V=`https://geocode.csis.u-tokyo.ac.jp/cgi-bin/simple_geocode.cgi?addr=${M.query}&charset=UTF8&constraint=大阪府摂津市`,J=await(await fetch(V)).text(),de=await new DOMParser().parseFromString(J,"text/xml"),pe=[de.getElementsByTagName("longitude")[0].firstChild.nodeValue,de.getElementsByTagName("latitude")[0].firstChild.nodeValue],De={type:"Feature",geometry:{type:"Point",coordinates:pe},place_name:de.getElementsByTagName("address")[0].textContent,place_type:["place"],center:pe};return B.push(De),{features:B}}};h.addControl(new j1(p,{maplibregl:_u})),h.addControl(new _u.NavigationControl),h.addControl(new ab({Format:Jl.PNG,Crosshair:!0,PrintableArea:!0,Local:"ja"})),h.addControl(new _u.ScaleControl({maxWidth:200}));let v=document.getElementById("style"),y=document.getElementById("kyk"),f=document.getElementById("tyk"),s=document.getElementById("bdr");document.getElementById("style").addEventListener("click",()=>{const M=v.checked;h.U.toggle("r-raster",M),h.U.toggle(["tran-fill","bldg-fill"],!M),h.U.toggleSource("v",!M)}),document.getElementById("kyk").addEventListener("click",()=>{h.U.toggle(["kyojuufill"],y.checked),h.U.toggle(["youto-fill"],!(y.checked||f.checked))}),document.getElementById("tyk").addEventListener("click",()=>{h.U.toggle(["toshikinoufill"],f.checked),h.U.toggle(["youto-fill"],!(y.checked||f.checked))}),document.getElementById("bdr").addEventListener("click",()=>{h.U.toggle(/-symbol$/,s.checked)})});export{Ri as d};
