(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))m(v);new MutationObserver(v=>{for(const x of v)if(x.type==="childList")for(const b of x.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&m(b)}).observe(document,{childList:!0,subtree:!0});function u(v){const x={};return v.integrity&&(x.integrity=v.integrity),v.referrerPolicy&&(x.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?x.credentials="include":v.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function m(v){if(v.ep)return;v.ep=!0;const x=u(v);fetch(v.href,x)}})();var Pd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Gy(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var Od={exports:{}};var Mb=Od.exports,f_;function Cb(){return f_||(f_=1,function(p,o){(function(u,m){p.exports=m()})(Mb,function(){var u={},m={};function v(b,a,C){if(m[b]=C,b==="index"){var F="var sharedModule = {}; ("+m.shared+")(sharedModule); ("+m.worker+")(sharedModule);",O={};return m.shared(O),m.index(u,O),typeof window<"u"&&u.setWorkerUrl(window.URL.createObjectURL(new Blob([F],{type:"text/javascript"}))),u}}v("shared",["exports"],function(b){function a(i,e,r,s){return new(r||(r=Promise))(function(c,d){function f(A){try{S(s.next(A))}catch(k){d(k)}}function y(A){try{S(s.throw(A))}catch(k){d(k)}}function S(A){var k;A.done?c(A.value):(k=A.value,k instanceof r?k:new r(function(N){N(k)})).then(f,y)}S((s=s.apply(i,e||[])).next())})}function C(i,e){this.x=i,this.y=e}function F(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var O,Y;typeof SuppressedError=="function"&&SuppressedError,C.prototype={clone(){return new C(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,e){return this.clone()._rotateAround(i,e)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult(i){const e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const e=Math.cos(i),r=Math.sin(i),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround(i,e){const r=Math.cos(i),s=Math.sin(i),c=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=c,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:C},C.convert=function(i){if(i instanceof C)return i;if(Array.isArray(i))return new C(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new C(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};var ee=function(){if(Y)return O;function i(e,r,s,c){this.cx=3*e,this.bx=3*(s-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=s,this.p2y=c}return Y=1,O=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var s=e,c=0;c<8;c++){var d=this.sampleCurveX(s)-e;if(Math.abs(d)<r)return s;var f=this.sampleCurveDerivativeX(s);if(Math.abs(f)<1e-6)break;s-=d/f}var y=0,S=1;for(s=e,c=0;c<20&&(d=this.sampleCurveX(s),!(Math.abs(d-e)<r));c++)e>d?y=s:S=s,s=.5*(S-y)+y;return s},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},O}(),j=F(ee);let Pe,ce;function Q(){return Pe==null&&(Pe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Pe}function ge(){if(ce==null&&(ce=!1,Q())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let s=0;s<5*5;s++){const c=4*s;e.fillStyle=`rgb(${c},${c+1},${c+2})`,e.fillRect(s%5,Math.floor(s/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let s=0;s<5*5*4;s++)if(s%4!=3&&r[s]!==s){ce=!0;break}}}return ce||!1}var Qe=1e-6,Oe=typeof Float32Array<"u"?Float32Array:Array;function Me(){var i=new Oe(9);return Oe!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Ge(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Ze(){var i=new Oe(3);return Oe!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function it(i){var e=i[0],r=i[1],s=i[2];return Math.sqrt(e*e+r*r+s*s)}function He(i,e,r){var s=new Oe(3);return s[0]=i,s[1]=e,s[2]=r,s}function Te(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i}function st(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i}function me(i,e,r){var s=e[0],c=e[1],d=e[2],f=r[0],y=r[1],S=r[2];return i[0]=c*S-d*y,i[1]=d*f-s*S,i[2]=s*y-c*f,i}var xe,Xe=it;function Ye(i,e,r){var s=e[0],c=e[1],d=e[2],f=e[3];return i[0]=r[0]*s+r[4]*c+r[8]*d+r[12]*f,i[1]=r[1]*s+r[5]*c+r[9]*d+r[13]*f,i[2]=r[2]*s+r[6]*c+r[10]*d+r[14]*f,i[3]=r[3]*s+r[7]*c+r[11]*d+r[15]*f,i}function At(){var i=new Oe(4);return Oe!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Dt(i,e,r,s){var c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",d=Math.PI/360;e*=d,s*=d,r*=d;var f=Math.sin(e),y=Math.cos(e),S=Math.sin(r),A=Math.cos(r),k=Math.sin(s),N=Math.cos(s);switch(c){case"xyz":i[0]=f*A*N+y*S*k,i[1]=y*S*N-f*A*k,i[2]=y*A*k+f*S*N,i[3]=y*A*N-f*S*k;break;case"xzy":i[0]=f*A*N-y*S*k,i[1]=y*S*N-f*A*k,i[2]=y*A*k+f*S*N,i[3]=y*A*N+f*S*k;break;case"yxz":i[0]=f*A*N+y*S*k,i[1]=y*S*N-f*A*k,i[2]=y*A*k-f*S*N,i[3]=y*A*N+f*S*k;break;case"yzx":i[0]=f*A*N+y*S*k,i[1]=y*S*N+f*A*k,i[2]=y*A*k-f*S*N,i[3]=y*A*N-f*S*k;break;case"zxy":i[0]=f*A*N-y*S*k,i[1]=y*S*N+f*A*k,i[2]=y*A*k+f*S*N,i[3]=y*A*N-f*S*k;break;case"zyx":i[0]=f*A*N-y*S*k,i[1]=y*S*N+f*A*k,i[2]=y*A*k-f*S*N,i[3]=y*A*N+f*S*k;break;default:throw new Error("Unknown angle order "+c)}return i}function kt(){var i=new Oe(2);return Oe!=Float32Array&&(i[0]=0,i[1]=0),i}function yt(i,e){var r=new Oe(2);return r[0]=i,r[1]=e,r}Ze(),xe=new Oe(4),Oe!=Float32Array&&(xe[0]=0,xe[1]=0,xe[2]=0,xe[3]=0),Ze(),He(1,0,0),He(0,1,0),At(),At(),Me(),kt();const vt=8192;function sr(i,e,r){return e*(vt/(i.tileSize*Math.pow(2,r-i.tileID.overscaledZ)))}function Zt(i,e){return(i%e+e)%e}function he(i,e,r){return i*(1-r)+e*r}function Fe(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,r=e*i;return 4*(i<.5?r:3*(i-e)+r-.75)}function $e(i,e,r,s){const c=new j(i,e,r,s);return d=>c.solve(d)}const tt=$e(.25,.1,.25,1);function ct(i,e,r){return Math.min(r,Math.max(e,i))}function ut(i,e,r){const s=r-e,c=((i-e)%s+s)%s+e;return c===e?r:c}function pt(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}let wt=1;function Bt(i,e,r){const s={};for(const c in i)s[c]=e.call(this,i[c],c,i);return s}function er(i,e,r){const s={};for(const c in i)e.call(this,i[c],c,i)&&(s[c]=i[c]);return s}function ur(i){return Array.isArray(i)?i.map(ur):typeof i=="object"&&i?Bt(i,ur):i}const fr={};function Ft(i){fr[i]||(typeof console<"u"&&console.warn(i),fr[i]=!0)}function Ue(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Yr(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let wr=null;function Tr(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const ir="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ar(i,e,r,s,c){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const d=new VideoFrame(i,{timestamp:0});try{const f=d?.format;if(!f||!f.startsWith("BGR")&&!f.startsWith("RGB"))throw new Error(`Unrecognized format ${f}`);const y=f.startsWith("BGR"),S=new Uint8ClampedArray(s*c*4);if(yield d.copyTo(S,function(A,k,N,V,q){const W=4*Math.max(-k,0),H=(Math.max(0,N)-N)*V*4+W,J=4*V,ue=Math.max(0,k),Ne=Math.max(0,N);return{rect:{x:ue,y:Ne,width:Math.min(A.width,k+V)-ue,height:Math.min(A.height,N+q)-Ne},layout:[{offset:H,stride:J}]}}(i,e,r,s,c)),y)for(let A=0;A<S.length;A+=4){const k=S[A];S[A]=S[A+2],S[A+2]=k}return S}finally{d.close()}})}let mr,Vr;function Lr(i,e,r,s){return i.addEventListener(e,r,s),{unsubscribe:()=>{i.removeEventListener(e,r,s)}}}function ai(i){return i*Math.PI/180}function Rr(i){return i/Math.PI*180}const nt={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},re={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},K="AbortError";class se extends Error{constructor(e=K){super(e instanceof Error?e.message:e),this.name=K,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function Ie(i){return i.name===K}const Ce={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ht(i){return Ce.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const at="global-dispatcher";class Be extends Error{constructor(e,r,s,c){super(`AJAXError: ${r} (${e}): ${s}`),this.status=e,this.statusText=r,this.url=s,this.body=c}}const ot=()=>Yr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Rt=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const s=ht(i.url);if(s)return s(i,e);if(Yr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:at},e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(ot())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(s,c){return a(this,void 0,void 0,function*(){const d=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,cache:s.cache,referrer:ot(),signal:c.signal});let f,y;s.type!=="json"||d.headers.has("Accept")||d.headers.set("Accept","application/json");try{f=yield fetch(d)}catch(A){throw Ie(A)?A:new Be(0,A.message,s.url,new Blob)}if(!f.ok){const A=yield f.blob();throw new Be(f.status,f.statusText,s.url,A)}y=s.type==="arrayBuffer"||s.type==="image"?f.arrayBuffer():s.type==="json"?f.json():f.text();const S=yield y;return c.signal.throwIfAborted(),{data:S,cacheControl:f.headers.get("Cache-Control"),expires:f.headers.get("Expires")}})}(i,e);if(Yr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:at},e)}var r;return function(s,c){return new Promise((d,f)=>{var y;const S=new XMLHttpRequest;S.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(S.responseType="arraybuffer");for(const A in s.headers)S.setRequestHeader(A,s.headers[A]);s.type==="json"&&(S.responseType="text",!((y=s.headers)===null||y===void 0)&&y.Accept||S.setRequestHeader("Accept","application/json")),S.withCredentials=s.credentials==="include",S.onerror=()=>{f(new Error(S.statusText))},S.onload=()=>{if(!c.signal.aborted)if((S.status>=200&&S.status<300||S.status===0)&&S.response!==null){let A=S.response;if(s.type==="json")try{A=JSON.parse(S.response)}catch(k){return void f(k)}d({data:A,cacheControl:S.getResponseHeader("Cache-Control"),expires:S.getResponseHeader("Expires")})}else{const A=new Blob([S.response],{type:S.getResponseHeader("Content-Type")});f(new Be(S.status,S.statusText,s.url,A))}},c.signal.addEventListener("abort",()=>{S.abort(),f(new se(c.signal.reason))}),S.send(s.body)})}(i,e)};function te(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function I(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function D(i,e,r){if(r&&r[i]){const s=r[i].indexOf(e);s!==-1&&r[i].splice(s,1)}}class fe{constructor(e,r={}){pt(this,r),this.type=e}}class Ee extends fe{constructor(e,r={}){super("error",pt({error:e},r))}}class qe{on(e,r){return this._listeners=this._listeners||{},I(e,r,this._listeners),{unsubscribe:()=>{this.off(e,r)}}}off(e,r){return D(e,r,this._listeners),D(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},I(e,r,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,r){typeof e=="string"&&(e=new fe(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const c=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const y of c)y.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const y of d)D(s,y,this._oneTimeListeners),y.call(this,e);const f=this._eventedParent;f&&(pt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(e))}else e instanceof Ee&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var ae={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ft=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Nt(i,e){const r={};for(const s in i)s!=="ref"&&(r[s]=i[s]);return ft.forEach(s=>{s in e&&(r[s]=e[s])}),r}function gt(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!gt(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!gt(i[r],e[r]))return!1;return!0}return i===e}function Lt(i,e){i.push(e)}function Ht(i,e,r){Lt(r,{command:"addSource",args:[i,e[i]]})}function Mt(i,e,r){Lt(e,{command:"removeSource",args:[i]}),r[i]=!0}function rr(i,e,r,s){Mt(i,r,s),Ht(i,e,r)}function Ut(i,e,r){let s;for(s in i[r])if(Object.prototype.hasOwnProperty.call(i[r],s)&&s!=="data"&&!gt(i[r][s],e[r][s]))return!1;for(s in e[r])if(Object.prototype.hasOwnProperty.call(e[r],s)&&s!=="data"&&!gt(i[r][s],e[r][s]))return!1;return!0}function gr(i,e,r,s,c,d){i=i||{},e=e||{};for(const f in i)Object.prototype.hasOwnProperty.call(i,f)&&(gt(i[f],e[f])||r.push({command:d,args:[s,f,e[f],c]}));for(const f in e)Object.prototype.hasOwnProperty.call(e,f)&&!Object.prototype.hasOwnProperty.call(i,f)&&(gt(i[f],e[f])||r.push({command:d,args:[s,f,e[f],c]}))}function Xr(i){return i.id}function ri(i,e){return i[e.id]=e,i}class Ot{constructor(e,r,s,c){this.message=(e?`${e}: `:"")+s,c&&(this.identifier=c),r!=null&&r.__line__&&(this.line=r.__line__)}}function kr(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}class Fi extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Ln{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,c]of r)this.bindings[s]=c}concat(e){return new Ln(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Zi={kind:"null"},nr={kind:"number"},Br={kind:"string"},Or={kind:"boolean"},Oi={kind:"color"},Bs={kind:"projectionDefinition"},Mn={kind:"object"},Gr={kind:"value"},ya={kind:"collator"},va={kind:"formatted"},Ra={kind:"padding"},to={kind:"colorArray"},za={kind:"numberArray"},Na={kind:"resolvedImage"},ro={kind:"variableAnchorOffsetCollection"};function Bi(i,e){return{kind:"array",itemType:i,N:e}}function mi(i){if(i.kind==="array"){const e=mi(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const ko=[Zi,nr,Br,Or,Oi,Bs,va,Mn,Bi(Gr),Ra,za,to,Na,ro];function ba(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ba(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of ko)if(!ba(r,e))return null}}return`Expected ${mi(i)} but found ${mi(e)} instead.`}function io(i,e){return e.some(r=>r.kind===i.kind)}function xa(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function _s(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const Do=.96422,Oa=.82521,Ji=4/29,ji=6/29,Ol=3*ji*ji,wa=ji*ji*ji,na=Math.PI/180,js=180/Math.PI;function no(i){return(i%=360)<0&&(i+=360),i}function sn([i,e,r,s]){let c,d;const f=Bl((.2225045*(i=so(i))+.7168786*(e=so(e))+.0606169*(r=so(r)))/1);i===e&&e===r?c=d=f:(c=Bl((.4360747*i+.3850649*e+.1430804*r)/Do),d=Bl((.0139322*i+.0971045*e+.7141733*r)/Oa));const y=116*f-16;return[y<0?0:y,500*(c-f),200*(f-d),s]}function so(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Bl(i){return i>wa?Math.pow(i,1/3):i/Ol+Ji}function jl([i,e,r,s]){let c=(i+16)/116,d=isNaN(e)?c:c+e/500,f=isNaN(r)?c:c-r/200;return c=1*Us(c),d=Do*Us(d),f=Oa*Us(f),[Ul(3.1338561*d-1.6168667*c-.4906146*f),Ul(-.9787684*d+1.9161415*c+.033454*f),Ul(.0719453*d-.2289914*c+1.4052427*f),s]}function Ul(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Us(i){return i>ji?i*i*i:Ol*(i-Ji)}const vc=Object.hasOwn||function(i,e){return Object.prototype.hasOwnProperty.call(i,e)};function ao(i,e){return vc(i,e)?i[e]:void 0}function sa(i){return parseInt(i.padEnd(2,i),16)/255}function pl(i,e){return oo(e?i/100:i,0,1)}function oo(i,e,r){return Math.min(Math.max(e,i),r)}function Vl(i){return!i.some(Number.isNaN)}const Fo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Vs(i,e,r){return i+r*(e-i)}function qs(i,e,r){return i.map((s,c)=>Vs(s,e[c],r))}class Wr{constructor(e,r,s,c=1,d=!0){this.r=e,this.g=r,this.b=s,this.a=c,d||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[e,r,s,c]))}static parse(e){if(e instanceof Wr)return e;if(typeof e!="string")return;const r=function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=ao(Fo,s);if(c){const[f,y,S]=c;return[f/255,y/255,S/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const f=s.length<6?1:2;let y=1;return[sa(s.slice(y,y+=f)),sa(s.slice(y,y+=f)),sa(s.slice(y,y+=f)),sa(s.slice(y,y+f)||"ff")]}if(s.startsWith("rgb")){const f=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[y,S,A,k,N,V,q,W,H,J,ue,Ne]=f,de=[k||" ",q||" ",J].join("");if(de==="  "||de==="  /"||de===",,"||de===",,,"){const ye=[A,V,H].join(""),je=ye==="%%%"?100:ye===""?255:0;if(je){const Ke=[oo(+S/je,0,1),oo(+N/je,0,1),oo(+W/je,0,1),ue?pl(+ue,Ne):1];if(Vl(Ke))return Ke}}return}}const d=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){const[f,y,S,A,k,N,V,q,W]=d,H=[S||" ",k||" ",V].join("");if(H==="  "||H==="  /"||H===",,"||H===",,,"){const J=[+y,oo(+A,0,100),oo(+N,0,100),q?pl(+q,W):1];if(Vl(J))return function([ue,Ne,de,ye]){function je(Ke){const xt=(Ke+ue/30)%12,Vt=Ne*Math.min(de,1-de);return de-Vt*Math.max(-1,Math.min(xt-3,9-xt,1))}return ue=no(ue),Ne/=100,de/=100,[je(0),je(8),je(4),ye]}(J)}}}(e);return r?new Wr(...r,!1):void 0}get rgb(){const{r:e,g:r,b:s,a:c}=this,d=c||1/0;return this.overwriteGetter("rgb",[e/d,r/d,s/d,c])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,s,c,d]=sn(e),f=Math.sqrt(s*s+c*c);return[Math.round(1e4*f)?no(Math.atan2(c,s)*js):NaN,f,r,d]}(this.rgb))}get lab(){return this.overwriteGetter("lab",sn(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,s,c]=this.rgb;return`rgba(${[e,r,s].map(d=>Math.round(255*d)).join(",")},${c})`}static interpolate(e,r,s,c="rgb"){switch(c){case"rgb":{const[d,f,y,S]=qs(e.rgb,r.rgb,s);return new Wr(d,f,y,S,!1)}case"hcl":{const[d,f,y,S]=e.hcl,[A,k,N,V]=r.hcl;let q,W;if(isNaN(d)||isNaN(A))isNaN(d)?isNaN(A)?q=NaN:(q=A,y!==1&&y!==0||(W=k)):(q=d,N!==1&&N!==0||(W=f));else{let de=A-d;A>d&&de>180?de-=360:A<d&&d-A>180&&(de+=360),q=d+s*de}const[H,J,ue,Ne]=function([de,ye,je,Ke]){return de=isNaN(de)?0:de*na,jl([je,Math.cos(de)*ye,Math.sin(de)*ye,Ke])}([q,W??Vs(f,k,s),Vs(y,N,s),Vs(S,V,s)]);return new Wr(H,J,ue,Ne,!1)}case"lab":{const[d,f,y,S]=jl(qs(e.lab,r.lab,s));return new Wr(d,f,y,S,!1)}}}}Wr.black=new Wr(0,0,0,1),Wr.white=new Wr(1,1,1,1),Wr.transparent=new Wr(0,0,0,0),Wr.red=new Wr(1,0,0,1);class ql{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Ro=["bottom","center","top"];class zo{constructor(e,r,s,c,d,f){this.text=e,this.image=r,this.scale=s,this.fontStack=c,this.textColor=d,this.verticalAlign=f}}class zr{constructor(e){this.sections=e}static fromString(e){return new zr([new zo(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof zr?e:zr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Cn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Cn)return e;if(typeof e=="number")return new Cn([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Cn(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,s){return new Cn(qs(e.values,r.values,s))}}class Ui{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ui)return e;if(typeof e=="number")return new Ui([e]);if(Array.isArray(e)){for(const r of e)if(typeof r!="number")return;return new Ui(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,s){return new Ui(qs(e.values,r.values,s))}}class jr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof jr)return e;if(typeof e=="string"){const s=Wr.parse(e);return s?new jr([s]):void 0}if(!Array.isArray(e))return;const r=[];for(const s of e){if(typeof s!="string")return;const c=Wr.parse(s);if(!c)return;r.push(c)}return new jr(r)}toString(){return JSON.stringify(this.values)}static interpolate(e,r,s,c="rgb"){const d=[];if(e.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let f=0;f<e.values.length;f++)d.push(Wr.interpolate(e.values[f],r.values[f],s,c));return new jr(d)}}class wi extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Yn=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ki{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ki)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const s=e[r],c=e[r+1];if(typeof s!="string"||!Yn.has(s)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new Ki(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,s){const c=e.values,d=r.values;if(c.length!==d.length)throw new wi(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${r.toString()}`);const f=[];for(let y=0;y<c.length;y+=2){if(c[y]!==d[y])throw new wi(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${c[y]}, to[${y}]: ${d[y]}`);f.push(c[y]);const[S,A]=c[y+1],[k,N]=d[y+1];f.push([Vs(S,k,s),Vs(A,N,s)])}return new Ki(f)}}class as{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new as({name:e,available:!1}):null}}class jn{constructor(e,r,s){this.from=e,this.to=r,this.transition=s}static interpolate(e,r,s){return new jn(e,r,s)}static parse(e){return e instanceof jn?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new jn(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new jn(e.from,e.to,e.transition):typeof e=="string"?new jn(e,e,1):void 0}}function aa(i,e,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,r,s]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Gs(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof jn||i instanceof Wr||i instanceof ql||i instanceof zr||i instanceof Cn||i instanceof Ui||i instanceof jr||i instanceof Ki||i instanceof as)return!0;if(Array.isArray(i)){for(const e of i)if(!Gs(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Gs(i[e]))return!1;return!0}return!1}function Mi(i){if(i===null)return Zi;if(typeof i=="string")return Br;if(typeof i=="boolean")return Or;if(typeof i=="number")return nr;if(i instanceof Wr)return Oi;if(i instanceof jn)return Bs;if(i instanceof ql)return ya;if(i instanceof zr)return va;if(i instanceof Cn)return Ra;if(i instanceof Ui)return za;if(i instanceof jr)return to;if(i instanceof Ki)return ro;if(i instanceof as)return Na;if(Array.isArray(i)){const e=i.length;let r;for(const s of i){const c=Mi(s);if(r){if(r===c)continue;r=Gr;break}r=c}return Bi(r||Gr,e)}return Mn}function $s(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Wr||i instanceof jn||i instanceof zr||i instanceof Cn||i instanceof Ui||i instanceof jr||i instanceof Ki||i instanceof as?i.toString():JSON.stringify(i)}class os{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Gs(e[1]))return r.error("invalid value");const s=e[1];let c=Mi(s);const d=r.expectedType;return c.kind!=="array"||c.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(c=d),new os(c,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const ml={string:Br,number:nr,boolean:Or,object:Mn};class kn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,c=1;const d=e[0];if(d==="array"){let y,S;if(e.length>2){const A=e[1];if(typeof A!="string"||!(A in ml)||A==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=ml[A],c++}else y=Gr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);S=e[2],c++}s=Bi(y,S)}else{if(!ml[d])throw new Error(`Types doesn't contain name = ${d}`);s=ml[d]}const f=[];for(;c<e.length;c++){const y=r.parse(e[c],c,Gr);if(!y)return null;f.push(y)}return new kn(s,f)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!ba(this.type,Mi(s)))return s;if(r===this.args.length-1)throw new wi(`Expected value to be of type ${mi(this.type)}, but found ${mi(Mi(s))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const oa={"to-boolean":Or,"to-color":Oi,"to-number":nr,"to-string":Br};class ls{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if(!oa[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&e.length!==2)return r.error("Expected one argument.");const c=oa[s],d=[];for(let f=1;f<e.length;f++){const y=r.parse(e[f],f,Gr);if(!y)return null;d.push(y)}return new ls(c,d)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,s;for(const c of this.args){if(r=c.evaluate(e),s=null,r instanceof Wr)return r;if(typeof r=="string"){const d=e.parseColor(r);if(d)return d}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:aa(r[0],r[1],r[2],r[3]),!s))return new Wr(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new wi(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const s of this.args){r=s.evaluate(e);const c=Cn.parse(r);if(c)return c}throw new wi(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(const s of this.args){r=s.evaluate(e);const c=Ui.parse(r);if(c)return c}throw new wi(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(const s of this.args){r=s.evaluate(e);const c=jr.parse(r);if(c)return c}throw new wi(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const s of this.args){r=s.evaluate(e);const c=Ki.parse(r);if(c)return c}throw new wi(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const s of this.args){if(r=s.evaluate(e),r===null)return 0;const c=Number(r);if(!isNaN(c))return c}throw new wi(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return zr.fromString($s(this.args[0].evaluate(e)));case"resolvedImage":return as.fromString($s(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return $s(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const lo=["Unknown","Point","LineString","Polygon"];class No{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?lo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache.get(e);return r||(r=Wr.parse(e),this._parseColorCache.set(e,r)),r}}class Zs{constructor(e,r,s=[],c,d=new Ln,f=[]){this.registry=e,this.path=s,this.key=s.map(y=>`[${y}]`).join(""),this.scope=d,this.errors=f,this.expectedType=c,this._isConstant=r}parse(e,r,s,c,d={}){return r?this.concat(r,s,c)._parse(e,d):this._parse(e,d)}_parse(e,r){function s(c,d,f){return f==="assert"?new kn(d,[c]):f==="coerce"?new ls(d,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[c];if(d){let f=d.parse(e,this);if(!f)return null;if(this.expectedType){const y=this.expectedType,S=f.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||S.kind!=="value"){if(y.kind==="projectionDefinition"&&["string","array"].includes(S.kind)||["color","formatted","resolvedImage"].includes(y.kind)&&["value","string"].includes(S.kind)||["padding","numberArray"].includes(y.kind)&&["value","number","array"].includes(S.kind)||y.kind==="colorArray"&&["value","string","array"].includes(S.kind)||y.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(S.kind))f=s(f,y,r.typeAnnotation||"coerce");else if(this.checkSubtype(y,S))return null}else f=s(f,y,r.typeAnnotation||"assert")}if(!(f instanceof os)&&f.type.kind!=="resolvedImage"&&this._isConstant(f)){const y=new No;try{f=new os(f.type,f.evaluate(y))}catch(S){return this.error(S.message),null}}return f}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const c=typeof e=="number"?this.path.concat(e):this.path,d=s?this.scope.concat(s):this.scope;return new Zs(this.registry,this._isConstant,c,r||null,d,this.errors)}error(e,...r){const s=`${this.key}${r.map(c=>`[${c}]`).join("")}`;this.errors.push(new Fi(s,e))}checkSubtype(e,r){const s=ba(e,r);return s&&this.error(s),s}}class vi{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let d=1;d<e.length-1;d+=2){const f=e[d];if(typeof f!="string")return r.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);const y=r.parse(e[d+1],d+1);if(!y)return null;s.push([f,y])}const c=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return c?new vi(s,c):null}outputDefined(){return this.result.outputDefined()}}class Ws{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new Ws(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class ni{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,nr),c=r.parse(e[2],2,Bi(r.expectedType||Gr));return s&&c?new ni(c.type.itemType,s,c):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new wi(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new wi(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new wi(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Hr{constructor(e,r){this.type=Or,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Gr),c=r.parse(e[2],2,Gr);return s&&c?io(s.type,[Or,Br,nr,Zi,Gr])?new Hr(s,c):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${mi(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!xa(r,["boolean","string","number","null"]))throw new wi(`Expected first argument to be of type boolean, string, number or null, but found ${mi(Mi(r))} instead.`);if(!xa(s,["string","array"]))throw new wi(`Expected second argument to be of type array or string, but found ${mi(Mi(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Dn{constructor(e,r,s){this.type=nr,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Gr),c=r.parse(e[2],2,Gr);if(!s||!c)return null;if(!io(s.type,[Or,Br,nr,Zi,Gr]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${mi(s.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,nr);return d?new Dn(s,c,d):null}return new Dn(s,c)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!xa(r,["boolean","string","number","null"]))throw new wi(`Expected first argument to be of type boolean, string, number or null, but found ${mi(Mi(r))} instead.`);let c;if(this.fromIndex&&(c=this.fromIndex.evaluate(e)),xa(s,["string"])){const d=s.indexOf(r,c);return d===-1?-1:[...s.slice(0,d)].length}if(xa(s,["array"]))return s.indexOf(r,c);throw new wi(`Expected second argument to be of type array or string, but found ${mi(Mi(s))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Kr{constructor(e,r,s,c,d,f){this.inputType=e,this.type=r,this.input=s,this.cases=c,this.outputs=d,this.otherwise=f}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);const d={},f=[];for(let A=2;A<e.length-1;A+=2){let k=e[A];const N=e[A+1];Array.isArray(k)||(k=[k]);const V=r.concat(A);if(k.length===0)return V.error("Expected at least one branch label.");for(const W of k){if(typeof W!="number"&&typeof W!="string")return V.error("Branch labels must be numbers or strings.");if(typeof W=="number"&&Math.abs(W)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof W=="number"&&Math.floor(W)!==W)return V.error("Numeric branch labels must be integer values.");if(s){if(V.checkSubtype(s,Mi(W)))return null}else s=Mi(W);if(d[String(W)]!==void 0)return V.error("Branch labels must be unique.");d[String(W)]=f.length}const q=r.parse(N,A,c);if(!q)return null;c=c||q.type,f.push(q)}const y=r.parse(e[1],1,Gr);if(!y)return null;const S=r.parse(e[e.length-1],e.length-1,c);return S?y.type.kind!=="value"&&r.concat(1).checkSubtype(s,y.type)?null:new Kr(s,c,y,d,f,S):null}evaluate(e){const r=this.input.evaluate(e);return(Mi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class z{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const c=[];for(let f=1;f<e.length-1;f+=2){const y=r.parse(e[f],f,Or);if(!y)return null;const S=r.parse(e[f+1],f+1,s);if(!S)return null;c.push([y,S]),s=s||S.type}const d=r.parse(e[e.length-1],e.length-1,s);if(!d)return null;if(!s)throw new Error("Can't infer output type");return new z(s,c,d)}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class ie{constructor(e,r,s,c){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=c}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Gr),c=r.parse(e[2],2,nr);if(!s||!c)return null;if(!io(s.type,[Bi(Gr),Br,Gr]))return r.error(`Expected first argument to be of type array or string, but found ${mi(s.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,nr);return d?new ie(s.type,s,c,d):null}return new ie(s.type,s,c)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);let c;if(this.endIndex&&(c=this.endIndex.evaluate(e)),xa(r,["string"]))return[...r].slice(s,c).join("");if(xa(r,["array"]))return r.slice(s,c);throw new wi(`Expected first argument to be of type array or string, but found ${mi(Mi(r))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function ze(i,e){const r=i.length-1;let s,c,d=0,f=r,y=0;for(;d<=f;)if(y=Math.floor((d+f)/2),s=i[y],c=i[y+1],s<=e){if(y===r||e<c)return y;d=y+1}else{if(!(s>e))throw new wi("Input is not a number.");f=y-1}return 0}class rt{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[c,d]of s)this.labels.push(c),this.outputs.push(d)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,nr);if(!s)return null;const c=[];let d=null;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(let f=1;f<e.length;f+=2){const y=f===1?-1/0:e[f],S=e[f+1],A=f,k=f+1;if(typeof y!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(c.length&&c[c.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const N=r.parse(S,k,d);if(!N)return null;d=d||N.type,c.push([y,N])}return new rt(d,s,c)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return s[0].evaluate(e);const d=r.length;return c>=r[d-1]?s[d-1].evaluate(e):s[ze(r,c)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function mt(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Gt,tr,Ir=function(){if(tr)return Gt;function i(e,r,s,c){this.cx=3*e,this.bx=3*(s-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=s,this.p2y=c}return tr=1,Gt=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var s=e,c=0;c<8;c++){var d=this.sampleCurveX(s)-e;if(Math.abs(d)<r)return s;var f=this.sampleCurveDerivativeX(s);if(Math.abs(f)<1e-6)break;s-=d/f}var y=0,S=1;for(s=e,c=0;c<20&&(d=this.sampleCurveX(s),!(Math.abs(d-e)<r));c++)e>d?y=s:S=s,s=.5*(S-y)+y;return s},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},Gt}(),Dr=mt(Ir);class Mr{constructor(e,r,s,c,d){this.type=e,this.operator=r,this.interpolation=s,this.input=c,this.labels=[],this.outputs=[];for(const[f,y]of d)this.labels.push(f),this.outputs.push(y)}static interpolationFactor(e,r,s,c){let d=0;if(e.name==="exponential")d=$r(r,e.base,s,c);else if(e.name==="linear")d=$r(r,1,s,c);else if(e.name==="cubic-bezier"){const f=e.controlPoints;d=new Dr(f[0],f[1],f[2],f[3]).solve($r(r,1,s,c))}return d}static parse(e,r){let[s,c,d,...f]=e;if(!Array.isArray(c)||c.length===0)return r.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const A=c[1];if(typeof A!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:A}}else{if(c[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const A=c.slice(1);if(A.length!==4||A.some(k=>typeof k!="number"||k<0||k>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:A}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(d=r.parse(d,2,nr),!d)return null;const y=[];let S=null;s!=="interpolate-hcl"&&s!=="interpolate-lab"||r.expectedType==to?r.expectedType&&r.expectedType.kind!=="value"&&(S=r.expectedType):S=Oi;for(let A=0;A<f.length;A+=2){const k=f[A],N=f[A+1],V=A+3,q=A+4;if(typeof k!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(y.length&&y[y.length-1][0]>=k)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const W=r.parse(N,q,S);if(!W)return null;S=S||W.type,y.push([k,W])}return _s(S,nr)||_s(S,Bs)||_s(S,Oi)||_s(S,Ra)||_s(S,za)||_s(S,to)||_s(S,ro)||_s(S,Bi(nr))?new Mr(S,s,c,d,y):r.error(`Type ${mi(S)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return s[0].evaluate(e);const d=r.length;if(c>=r[d-1])return s[d-1].evaluate(e);const f=ze(r,c),y=Mr.interpolationFactor(this.interpolation,c,r[f],r[f+1]),S=s[f].evaluate(e),A=s[f+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Vs(S,A,y);case"color":return Wr.interpolate(S,A,y);case"padding":return Cn.interpolate(S,A,y);case"colorArray":return jr.interpolate(S,A,y);case"numberArray":return Ui.interpolate(S,A,y);case"variableAnchorOffsetCollection":return Ki.interpolate(S,A,y);case"array":return qs(S,A,y);case"projectionDefinition":return jn.interpolate(S,A,y)}case"interpolate-hcl":switch(this.type.kind){case"color":return Wr.interpolate(S,A,y,"hcl");case"colorArray":return jr.interpolate(S,A,y,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Wr.interpolate(S,A,y,"lab");case"colorArray":return jr.interpolate(S,A,y,"lab")}}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function $r(i,e,r,s){const c=s-r,d=i-r;return c===0?0:e===1?d/c:(Math.pow(e,d)-1)/(Math.pow(e,c)-1)}const Ur={color:Wr.interpolate,number:Vs,padding:Cn.interpolate,numberArray:Ui.interpolate,colorArray:jr.interpolate,variableAnchorOffsetCollection:Ki.interpolate,array:qs};class Ai{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s=null;const c=r.expectedType;c&&c.kind!=="value"&&(s=c);const d=[];for(const y of e.slice(1)){const S=r.parse(y,1+d.length,s,void 0,{typeAnnotation:"omit"});if(!S)return null;s=s||S.type,d.push(S)}if(!s)throw new Error("No output type");const f=c&&d.some(y=>ba(c,y.type));return new Ai(f?Gr:s,d)}evaluate(e){let r,s=null,c=0;for(const d of this.args)if(c++,s=d.evaluate(e),s&&s instanceof as&&!s.available&&(r||(r=s.name),s=null,c===this.args.length&&(s=r)),s!==null)break;return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function hn(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function bi(i,e,r,s){return s.compare(e,r)===0}function si(i,e,r){const s=i!=="=="&&i!=="!=";return class $y{constructor(d,f,y){this.type=Or,this.lhs=d,this.rhs=f,this.collator=y,this.hasUntypedArgument=d.type.kind==="value"||f.type.kind==="value"}static parse(d,f){if(d.length!==3&&d.length!==4)return f.error("Expected two or three arguments.");const y=d[0];let S=f.parse(d[1],1,Gr);if(!S)return null;if(!hn(y,S.type))return f.concat(1).error(`"${y}" comparisons are not supported for type '${mi(S.type)}'.`);let A=f.parse(d[2],2,Gr);if(!A)return null;if(!hn(y,A.type))return f.concat(2).error(`"${y}" comparisons are not supported for type '${mi(A.type)}'.`);if(S.type.kind!==A.type.kind&&S.type.kind!=="value"&&A.type.kind!=="value")return f.error(`Cannot compare types '${mi(S.type)}' and '${mi(A.type)}'.`);s&&(S.type.kind==="value"&&A.type.kind!=="value"?S=new kn(A.type,[S]):S.type.kind!=="value"&&A.type.kind==="value"&&(A=new kn(S.type,[A])));let k=null;if(d.length===4){if(S.type.kind!=="string"&&A.type.kind!=="string"&&S.type.kind!=="value"&&A.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(k=f.parse(d[3],3,ya),!k)return null}return new $y(S,A,k)}evaluate(d){const f=this.lhs.evaluate(d),y=this.rhs.evaluate(d);if(s&&this.hasUntypedArgument){const S=Mi(f),A=Mi(y);if(S.kind!==A.kind||S.kind!=="string"&&S.kind!=="number")throw new wi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${S.kind}, ${A.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const S=Mi(f),A=Mi(y);if(S.kind!=="string"||A.kind!=="string")return e(d,f,y)}return this.collator?r(d,f,y,this.collator.evaluate(d)):e(d,f,y)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}}}const dn=si("==",function(i,e,r){return e===r},bi),Pn=si("!=",function(i,e,r){return e!==r},function(i,e,r,s){return!bi(0,e,r,s)}),Sa=si("<",function(i,e,r){return e<r},function(i,e,r,s){return s.compare(e,r)<0}),co=si(">",function(i,e,r){return e>r},function(i,e,r,s){return s.compare(e,r)>0}),uo=si("<=",function(i,e,r){return e<=r},function(i,e,r,s){return s.compare(e,r)<=0}),Oo=si(">=",function(i,e,r){return e>=r},function(i,e,r,s){return s.compare(e,r)>=0});class Hs{constructor(e,r,s){this.type=ya,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const c=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Or);if(!c)return null;const d=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Or);if(!d)return null;let f=null;return s.locale&&(f=r.parse(s.locale,1,Br),!f)?null:new Hs(c,d,f)}evaluate(e){return new ql(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Ls{constructor(e,r,s,c,d){this.type=Br,this.number=e,this.locale=r,this.currency=s,this.minFractionDigits=c,this.maxFractionDigits=d}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const s=r.parse(e[1],1,nr);if(!s)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return r.error("NumberFormat options argument must be an object.");let d=null;if(c.locale&&(d=r.parse(c.locale,1,Br),!d))return null;let f=null;if(c.currency&&(f=r.parse(c.currency,1,Br),!f))return null;let y=null;if(c["min-fraction-digits"]&&(y=r.parse(c["min-fraction-digits"],1,nr),!y))return null;let S=null;return c["max-fraction-digits"]&&(S=r.parse(c["max-fraction-digits"],1,nr),!S)?null:new Ls(s,d,f,y,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Ba{constructor(e){this.type=va,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const c=[];let d=!1;for(let f=1;f<=e.length-1;++f){const y=e[f];if(d&&typeof y=="object"&&!Array.isArray(y)){d=!1;let S=null;if(y["font-scale"]&&(S=r.parse(y["font-scale"],1,nr),!S))return null;let A=null;if(y["text-font"]&&(A=r.parse(y["text-font"],1,Bi(Br)),!A))return null;let k=null;if(y["text-color"]&&(k=r.parse(y["text-color"],1,Oi),!k))return null;let N=null;if(y["vertical-align"]){if(typeof y["vertical-align"]=="string"&&!Ro.includes(y["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${y["vertical-align"]}' instead.`);if(N=r.parse(y["vertical-align"],1,Br),!N)return null}const V=c[c.length-1];V.scale=S,V.font=A,V.textColor=k,V.verticalAlign=N}else{const S=r.parse(e[f],1,Gr);if(!S)return null;const A=S.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,c.push({content:S,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ba(c)}evaluate(e){return new zr(this.sections.map(r=>{const s=r.content.evaluate(e);return Mi(s)===Na?new zo("",s,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(e):null):new zo($s(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null,r.verticalAlign?r.verticalAlign.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor),r.verticalAlign&&e(r.verticalAlign)}outputDefined(){return!1}}class la{constructor(e){this.type=Na,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Br);return s?new la(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=as.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}}class Ms{constructor(e){this.type=nr,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${mi(s.type)} instead.`):new Ms(s):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new wi(`Expected value to be of type string or array, but found ${mi(Mi(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const di=8192;function Ta(i,e){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(r*c*di),Math.round(s*c*di)]}function ys(i,e){const r=Math.pow(2,e.z);return[(c=(i[0]/di+e.x)/r,360*c-180),(s=(i[1]/di+e.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90)];var s,c}function Pa(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function ca(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function cs(i,e,r){const s=i[0]-e[0],c=i[1]-e[1],d=i[0]-r[0],f=i[1]-r[1];return s*f-d*c==0&&s*d<=0&&c*f<=0}function Bo(i,e,r,s){return(c=[s[0]-r[0],s[1]-r[1]])[0]*(d=[e[0]-i[0],e[1]-i[1]])[1]-c[1]*d[0]!=0&&!(!jo(i,e,r,s)||!jo(r,s,i,e));var c,d}function gl(i,e,r){for(const s of r)for(let c=0;c<s.length-1;++c)if(Bo(i,e,s[c],s[c+1]))return!0;return!1}function ja(i,e,r=!1){let s=!1;for(const y of e)for(let S=0;S<y.length-1;S++){if(cs(i,y[S],y[S+1]))return r;(d=y[S])[1]>(c=i)[1]!=(f=y[S+1])[1]>c[1]&&c[0]<(f[0]-d[0])*(c[1]-d[1])/(f[1]-d[1])+d[0]&&(s=!s)}var c,d,f;return s}function fn(i,e){for(const r of e)if(ja(i,r))return!0;return!1}function Cs(i,e){for(const r of i)if(!ja(r,e))return!1;for(let r=0;r<i.length-1;++r)if(gl(i[r],i[r+1],e))return!1;return!0}function _l(i,e){for(const r of e)if(Cs(i,r))return!0;return!1}function jo(i,e,r,s){const c=s[0]-r[0],d=s[1]-r[1],f=(i[0]-r[0])*d-c*(i[1]-r[1]),y=(e[0]-r[0])*d-c*(e[1]-r[1]);return f>0&&y<0||f<0&&y>0}function Aa(i,e,r){const s=[];for(let c=0;c<i.length;c++){const d=[];for(let f=0;f<i[c].length;f++){const y=Ta(i[c][f],r);Pa(e,y),d.push(y)}s.push(d)}return s}function ho(i,e,r){const s=[];for(let c=0;c<i.length;c++){const d=Aa(i[c],e,r);s.push(d)}return s}function us(i,e,r,s){if(i[0]<r[0]||i[0]>r[2]){const c=.5*s;let d=i[0]-r[0]>c?-s:r[0]-i[0]>c?s:0;d===0&&(d=i[0]-r[2]>c?-s:r[2]-i[0]>c?s:0),i[0]+=d}Pa(e,i)}function hs(i,e,r,s){const c=Math.pow(2,s.z)*di,d=[s.x*di,s.y*di],f=[];for(const y of i)for(const S of y){const A=[S.x+d[0],S.y+d[1]];us(A,e,r,c),f.push(A)}return f}function fo(i,e,r,s){const c=Math.pow(2,s.z)*di,d=[s.x*di,s.y*di],f=[];for(const S of i){const A=[];for(const k of S){const N=[k.x+d[0],k.y+d[1]];Pa(e,N),A.push(N)}f.push(A)}if(e[2]-e[0]<=c/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const S of f)for(const A of S)us(A,e,r,c)}var y;return f}class Jn{constructor(e,r){this.type=Or,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Gs(e[1])){const s=e[1];if(s.type==="FeatureCollection"){const c=[];for(const d of s.features){const{type:f,coordinates:y}=d.geometry;f==="Polygon"&&c.push(y),f==="MultiPolygon"&&c.push(...y)}if(c.length)return new Jn(s,{type:"MultiPolygon",coordinates:c})}else if(s.type==="Feature"){const c=s.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Jn(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Jn(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,s){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(s.type==="Polygon"){const y=Aa(s.coordinates,d,f),S=hs(r.geometry(),c,d,f);if(!ca(c,d))return!1;for(const A of S)if(!ja(A,y))return!1}if(s.type==="MultiPolygon"){const y=ho(s.coordinates,d,f),S=hs(r.geometry(),c,d,f);if(!ca(c,d))return!1;for(const A of S)if(!fn(A,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,s){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(s.type==="Polygon"){const y=Aa(s.coordinates,d,f),S=fo(r.geometry(),c,d,f);if(!ca(c,d))return!1;for(const A of S)if(!Cs(A,y))return!1}if(s.type==="MultiPolygon"){const y=ho(s.coordinates,d,f),S=fo(r.geometry(),c,d,f);if(!ca(c,d))return!1;for(const A of S)if(!_l(A,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Ua=class{constructor(i=[],e=(r,s)=>r<s?-1:r>s?1:0){if(this.data=i,this.length=this.data.length,this.compare=e,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:e,compare:r}=this,s=e[i];for(;i>0;){const c=i-1>>1,d=e[c];if(r(s,d)>=0)break;e[i]=d,i=c}e[i]=s}_down(i){const{data:e,compare:r}=this,s=this.length>>1,c=e[i];for(;i<s;){let d=1+(i<<1);const f=d+1;if(f<this.length&&r(e[f],e[d])<0&&(d=f),r(e[d],c)>=0)break;e[i]=e[d],i=d}e[i]=c}};function Uo(i,e,r=0,s=i.length-1,c=an){for(;s>r;){if(s-r>600){const S=s-r+1,A=e-r+1,k=Math.log(S),N=.5*Math.exp(2*k/3),V=.5*Math.sqrt(k*N*(S-N)/S)*(A-S/2<0?-1:1);Uo(i,e,Math.max(r,Math.floor(e-A*N/S+V)),Math.min(s,Math.floor(e+(S-A)*N/S+V)),c)}const d=i[e];let f=r,y=s;for(ks(i,r,e),c(i[s],d)>0&&ks(i,r,s);f<y;){for(ks(i,f,y),f++,y--;c(i[f],d)<0;)f++;for(;c(i[y],d)>0;)y--}c(i[r],d)===0?ks(i,r,y):(y++,ks(i,y,s)),y<=e&&(r=y+1),e<=y&&(s=y-1)}}function ks(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}function an(i,e){return i<e?-1:i>e?1:0}function yl(i,e){if(i.length<=1)return[i];const r=[];let s,c;for(const d of i){const f=Ea(d);f!==0&&(d.area=Math.abs(f),c===void 0&&(c=f<0),c===f<0?(s&&r.push(s),s=[d]):s.push(d))}if(s&&r.push(s),e>1)for(let d=0;d<r.length;d++)r[d].length<=e||(Uo(r[d],e,1,r[d].length-1,Ia),r[d]=r[d].slice(0,e));return r}function Ia(i,e){return e.area-i.area}function Ea(i){let e=0;for(let r,s,c=0,d=i.length,f=d-1;c<d;f=c++)r=i[c],s=i[f],e+=(s.x-r.x)*(r.y+s.y);return e}const Vo=1/298.257223563,Va=Vo*(2-Vo),qo=Math.PI/180;class po{constructor(e){const r=6378.137*qo*1e3,s=Math.cos(e*qo),c=1/(1-Va*(1-s*s)),d=Math.sqrt(c);this.kx=r*d*s,this.ky=r*d*c*(1-Va)}distance(e,r){const s=this.wrap(e[0]-r[0])*this.kx,c=(e[1]-r[1])*this.ky;return Math.sqrt(s*s+c*c)}pointOnLine(e,r){let s,c,d,f,y=1/0;for(let S=0;S<e.length-1;S++){let A=e[S][0],k=e[S][1],N=this.wrap(e[S+1][0]-A)*this.kx,V=(e[S+1][1]-k)*this.ky,q=0;N===0&&V===0||(q=(this.wrap(r[0]-A)*this.kx*N+(r[1]-k)*this.ky*V)/(N*N+V*V),q>1?(A=e[S+1][0],k=e[S+1][1]):q>0&&(A+=N/this.kx*q,k+=V/this.ky*q)),N=this.wrap(r[0]-A)*this.kx,V=(r[1]-k)*this.ky;const W=N*N+V*V;W<y&&(y=W,s=A,c=k,d=S,f=q)}return{point:[s,c],index:d,t:Math.max(0,Math.min(1,f))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function mo(i,e){return e[0]-i[0]}function La(i){return i[1]-i[0]+1}function An(i,e){return i[1]>=i[0]&&i[1]<e}function go(i,e){if(i[0]>i[1])return[null,null];const r=La(i);if(e){if(r===2)return[i,null];const c=Math.floor(r/2);return[[i[0],i[0]+c],[i[0]+c,i[1]]]}if(r===1)return[i,null];const s=Math.floor(r/2)-1;return[[i[0],i[0]+s],[i[0]+s+1,i[1]]]}function ds(i,e){if(!An(e,i.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let s=e[0];s<=e[1];++s)Pa(r,i[s]);return r}function Xs(i){const e=[1/0,1/0,-1/0,-1/0];for(const r of i)for(const s of r)Pa(e,s);return e}function Ci(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Ii(i,e,r){if(!Ci(i)||!Ci(e))return NaN;let s=0,c=0;return i[2]<e[0]&&(s=e[0]-i[2]),i[0]>e[2]&&(s=i[0]-e[2]),i[1]>e[3]&&(c=i[1]-e[3]),i[3]<e[1]&&(c=e[1]-i[3]),r.distance([0,0],[s,c])}function Ri(i,e,r){const s=r.pointOnLine(e,i);return r.distance(i,s.point)}function Qi(i,e,r,s,c){const d=Math.min(Ri(i,[r,s],c),Ri(e,[r,s],c)),f=Math.min(Ri(r,[i,e],c),Ri(s,[i,e],c));return Math.min(d,f)}function qa(i,e,r,s,c){if(!An(e,i.length)||!An(s,r.length))return 1/0;let d=1/0;for(let f=e[0];f<e[1];++f){const y=i[f],S=i[f+1];for(let A=s[0];A<s[1];++A){const k=r[A],N=r[A+1];if(Bo(y,S,k,N))return 0;d=Math.min(d,Qi(y,S,k,N,c))}}return d}function Go(i,e,r,s,c){if(!An(e,i.length)||!An(s,r.length))return NaN;let d=1/0;for(let f=e[0];f<=e[1];++f)for(let y=s[0];y<=s[1];++y)if(d=Math.min(d,c.distance(i[f],r[y])),d===0)return d;return d}function Ma(i,e,r){if(ja(i,e,!0))return 0;let s=1/0;for(const c of e){const d=c[0],f=c[c.length-1];if(d!==f&&(s=Math.min(s,Ri(i,[f,d],r)),s===0))return s;const y=r.pointOnLine(c,i);if(s=Math.min(s,r.distance(i,y.point)),s===0)return s}return s}function Gl(i,e,r,s){if(!An(e,i.length))return NaN;for(let d=e[0];d<=e[1];++d)if(ja(i[d],r,!0))return 0;let c=1/0;for(let d=e[0];d<e[1];++d){const f=i[d],y=i[d+1];for(const S of r)for(let A=0,k=S.length,N=k-1;A<k;N=A++){const V=S[N],q=S[A];if(Bo(f,y,V,q))return 0;c=Math.min(c,Qi(f,y,V,q,s))}}return c}function Hc(i,e){for(const r of i)for(const s of r)if(ja(s,e,!0))return!0;return!1}function Au(i,e,r,s=1/0){const c=Xs(i),d=Xs(e);if(s!==1/0&&Ii(c,d,r)>=s)return s;if(ca(c,d)){if(Hc(i,e))return 0}else if(Hc(e,i))return 0;let f=1/0;for(const y of i)for(let S=0,A=y.length,k=A-1;S<A;k=S++){const N=y[k],V=y[S];for(const q of e)for(let W=0,H=q.length,J=H-1;W<H;J=W++){const ue=q[J],Ne=q[W];if(Bo(N,V,ue,Ne))return 0;f=Math.min(f,Qi(N,V,ue,Ne,r))}}return f}function gi(i,e,r,s,c,d){if(!d)return;const f=Ii(ds(s,d),c,r);f<e&&i.push([f,d,[0,0]])}function $l(i,e,r,s,c,d,f){if(!d||!f)return;const y=Ii(ds(s,d),ds(c,f),r);y<e&&i.push([y,d,f])}function Zl(i,e,r,s,c=1/0){let d=Math.min(s.distance(i[0],r[0][0]),c);if(d===0)return d;const f=new Ua([[0,[0,i.length-1],[0,0]]],mo),y=Xs(r);for(;f.length>0;){const S=f.pop();if(S[0]>=d)continue;const A=S[1],k=e?50:100;if(La(A)<=k){if(!An(A,i.length))return NaN;if(e){const N=Gl(i,A,r,s);if(isNaN(N)||N===0)return N;d=Math.min(d,N)}else for(let N=A[0];N<=A[1];++N){const V=Ma(i[N],r,s);if(d=Math.min(d,V),d===0)return 0}}else{const N=go(A,e);gi(f,d,s,i,y,N[0]),gi(f,d,s,i,y,N[1])}}return d}function Wl(i,e,r,s,c,d=1/0){let f=Math.min(d,c.distance(i[0],r[0]));if(f===0)return f;const y=new Ua([[0,[0,i.length-1],[0,r.length-1]]],mo);for(;y.length>0;){const S=y.pop();if(S[0]>=f)continue;const A=S[1],k=S[2],N=e?50:100,V=s?50:100;if(La(A)<=N&&La(k)<=V){if(!An(A,i.length)&&An(k,r.length))return NaN;let q;if(e&&s)q=qa(i,A,r,k,c),f=Math.min(f,q);else if(e&&!s){const W=i.slice(A[0],A[1]+1);for(let H=k[0];H<=k[1];++H)if(q=Ri(r[H],W,c),f=Math.min(f,q),f===0)return f}else if(!e&&s){const W=r.slice(k[0],k[1]+1);for(let H=A[0];H<=A[1];++H)if(q=Ri(i[H],W,c),f=Math.min(f,q),f===0)return f}else q=Go(i,A,r,k,c),f=Math.min(f,q)}else{const q=go(A,e),W=go(k,s);$l(y,f,c,i,r,q[0],W[0]),$l(y,f,c,i,r,q[0],W[1]),$l(y,f,c,i,r,q[1],W[0]),$l(y,f,c,i,r,q[1],W[1])}}return f}function bc(i){return i.type==="MultiPolygon"?i.coordinates.map(e=>({type:"Polygon",coordinates:e})):i.type==="MultiLineString"?i.coordinates.map(e=>({type:"LineString",coordinates:e})):i.type==="MultiPoint"?i.coordinates.map(e=>({type:"Point",coordinates:e})):[i]}class _o{constructor(e,r){this.type=nr,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Gs(e[1])){const s=e[1];if(s.type==="FeatureCollection")return new _o(s,s.features.map(c=>bc(c.geometry)).flat());if(s.type==="Feature")return new _o(s,bc(s.geometry));if("type"in s&&"coordinates"in s)return new _o(s,bc(s))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,s){const c=r.geometry(),d=c.flat().map(S=>ys([S.x,S.y],r.canonical));if(c.length===0)return NaN;const f=new po(d[0][1]);let y=1/0;for(const S of s){switch(S.type){case"Point":y=Math.min(y,Wl(d,!1,[S.coordinates],!1,f,y));break;case"LineString":y=Math.min(y,Wl(d,!1,S.coordinates,!0,f,y));break;case"Polygon":y=Math.min(y,Zl(d,!1,S.coordinates,f,y))}if(y===0)return y}return y}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,s){const c=r.geometry(),d=c.flat().map(S=>ys([S.x,S.y],r.canonical));if(c.length===0)return NaN;const f=new po(d[0][1]);let y=1/0;for(const S of s){switch(S.type){case"Point":y=Math.min(y,Wl(d,!0,[S.coordinates],!1,f,y));break;case"LineString":y=Math.min(y,Wl(d,!0,S.coordinates,!0,f,y));break;case"Polygon":y=Math.min(y,Zl(d,!0,S.coordinates,f,y))}if(y===0)return y}return y}(e,this.geometries);if(e.geometryType()==="Polygon")return function(r,s){const c=r.geometry();if(c.length===0||c[0].length===0)return NaN;const d=yl(c,0).map(S=>S.map(A=>A.map(k=>ys([k.x,k.y],r.canonical)))),f=new po(d[0][0][0][1]);let y=1/0;for(const S of s)for(const A of d){switch(S.type){case"Point":y=Math.min(y,Zl([S.coordinates],!1,A,f,y));break;case"LineString":y=Math.min(y,Zl(S.coordinates,!0,A,f,y));break;case"Polygon":y=Math.min(y,Au(A,S.coordinates,f,y))}if(y===0)return y}return y}(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class vl{constructor(e){this.type=Gr,this.key=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=e[1];return s==null?r.error("Global state property must be defined."):typeof s!="string"?r.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new vl(s)}evaluate(e){var r;const s=(r=e.globals)===null||r===void 0?void 0:r.globalState;return s&&Object.keys(s).length!==0?ao(s,this.key):null}eachChild(){}outputDefined(){return!1}}const $o={"==":dn,"!=":Pn,">":co,"<":Sa,">=":Oo,"<=":uo,array:kn,at:ni,boolean:kn,case:z,coalesce:Ai,collator:Hs,format:Ba,image:la,in:Hr,"index-of":Dn,interpolate:Mr,"interpolate-hcl":Mr,"interpolate-lab":Mr,length:Ms,let:vi,literal:os,match:Kr,number:kn,"number-format":Ls,object:kn,slice:ie,step:rt,string:kn,"to-boolean":ls,"to-color":ls,"to-number":ls,"to-string":ls,var:Ws,within:Jn,distance:_o,"global-state":vl};class Ds{constructor(e,r,s,c){this.name=e,this.type=r,this._evaluate=s,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const s=e[0],c=Ds.definitions[s];if(!c)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(c)?c[0]:c.type,f=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,y=f.filter(([A])=>!Array.isArray(A)||A.length===e.length-1);let S=null;for(const[A,k]of y){S=new Zs(r.registry,Hl,r.path,null,r.scope);const N=[];let V=!1;for(let q=1;q<e.length;q++){const W=e[q],H=Array.isArray(A)?A[q-1]:A.type,J=S.parse(W,1+N.length,H);if(!J){V=!0;break}N.push(J)}if(!V)if(Array.isArray(A)&&A.length!==N.length)S.error(`Expected ${A.length} arguments, but found ${N.length} instead.`);else{for(let q=0;q<N.length;q++){const W=Array.isArray(A)?A[q]:A.type,H=N[q];S.concat(q+1).checkSubtype(W,H.type)}if(S.errors.length===0)return new Ds(s,d,k,N)}}if(y.length===1)r.errors.push(...S.errors);else{const A=(y.length?y:f).map(([N])=>{return V=N,Array.isArray(V)?`(${V.map(mi).join(", ")})`:`(${mi(V.type)}...)`;var V}).join(" | "),k=[];for(let N=1;N<e.length;N++){const V=r.parse(e[N],1+k.length);if(!V)return null;k.push(mi(V.type))}r.error(`Expected arguments of type ${A}, but found (${k.join(", ")}) instead.`)}return null}static register(e,r){Ds.definitions=r;for(const s in r)e[s]=Ds}}function Xc(i,[e,r,s,c]){e=e.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const d=c?c.evaluate(i):1,f=aa(e,r,s,d);if(f)throw new wi(f);return new Wr(e/255,r/255,s/255,d,!1)}function bl(i,e){return i in e}function xc(i,e){const r=e[i];return r===void 0?null:r}function yo(i){return{type:i}}function Hl(i){if(i instanceof Ws)return Hl(i.boundExpression);if(i instanceof Ds&&i.name==="error"||i instanceof Hs||i instanceof Jn||i instanceof _o||i instanceof vl)return!1;const e=i instanceof ls||i instanceof kn;let r=!0;return i.eachChild(s=>{r=e?r&&Hl(s):r&&s instanceof os}),!!r&&Xl(i)&&Yl(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Xl(i){if(i instanceof Ds&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Jn||i instanceof _o)return!1;let e=!0;return i.eachChild(r=>{e&&!Xl(r)&&(e=!1)}),e}function xl(i){if(i instanceof Ds&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!xl(r)&&(e=!1)}),e}function Yl(i,e){if(i instanceof Ds&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(s=>{r&&!Yl(s,e)&&(r=!1)}),r}function Yc(i){return{result:"success",value:i}}function Zo(i){return{result:"error",value:i}}function vo(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Jl(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function fs(i){return!!i.expression&&i.expression.interpolated}function Zr(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Wo(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&Mi(i)===Mn}function wc(i){return i}function Jc(i,e){const r=i.stops&&typeof i.stops[0][0]=="object",s=r||!(r||i.property!==void 0),c=i.type||(fs(e)?"exponential":"interval"),d=function(k){switch(k.type){case"color":return Wr.parse;case"padding":return Cn.parse;case"numberArray":return Ui.parse;case"colorArray":return jr.parse;default:return null}}(e);if(d&&((i=kr({},i)).stops&&(i.stops=i.stops.map(k=>[k[0],d(k[1])])),i.default=d(i.default?i.default:e.default)),i.colorSpace&&(f=i.colorSpace)!=="rgb"&&f!=="hcl"&&f!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var f;const y=function(k){switch(k){case"exponential":return Qc;case"interval":return Kc;case"categorical":return Sc;case"identity":return eu;default:throw new Error(`Unknown function type "${k}"`)}}(c);let S,A;if(c==="categorical"){S=Object.create(null);for(const k of i.stops)S[k[0]]=k[1];A=typeof i.stops[0][0]}if(r){const k={},N=[];for(let W=0;W<i.stops.length;W++){const H=i.stops[W],J=H[0].zoom;k[J]===void 0&&(k[J]={zoom:J,type:i.type,property:i.property,default:i.default,stops:[]},N.push(J)),k[J].stops.push([H[0].value,H[1]])}const V=[];for(const W of N)V.push([k[W].zoom,Jc(k[W],e)]);const q={name:"linear"};return{kind:"composite",interpolationType:q,interpolationFactor:Mr.interpolationFactor.bind(void 0,q),zoomStops:V.map(W=>W[0]),evaluate:({zoom:W},H)=>Qc({stops:V,base:i.base},e,W).evaluate(W,H)}}if(s){const k=c==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:Mr.interpolationFactor.bind(void 0,k),zoomStops:i.stops.map(N=>N[0]),evaluate:({zoom:N})=>y(i,e,N,S,A)}}return{kind:"source",evaluate(k,N){const V=N&&N.properties?N.properties[i.property]:void 0;return V===void 0?bo(i.default,e.default):y(i,e,V,S,A)}}}function bo(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function Sc(i,e,r,s,c){return bo(typeof r===c?s[r]:void 0,i.default,e.default)}function Kc(i,e,r){if(Zr(r)!=="number")return bo(i.default,e.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const c=ze(i.stops.map(d=>d[0]),r);return i.stops[c][1]}function Qc(i,e,r){const s=i.base!==void 0?i.base:1;if(Zr(r)!=="number")return bo(i.default,e.default);const c=i.stops.length;if(c===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[c-1][0])return i.stops[c-1][1];const d=ze(i.stops.map(k=>k[0]),r),f=function(k,N,V,q){const W=q-V,H=k-V;return W===0?0:N===1?H/W:(Math.pow(N,H)-1)/(Math.pow(N,W)-1)}(r,s,i.stops[d][0],i.stops[d+1][0]),y=i.stops[d][1],S=i.stops[d+1][1],A=Ur[e.type]||wc;return typeof y.evaluate=="function"?{evaluate(...k){const N=y.evaluate.apply(void 0,k),V=S.evaluate.apply(void 0,k);if(N!==void 0&&V!==void 0)return A(N,V,f,i.colorSpace)}}:A(y,S,f,i.colorSpace)}function eu(i,e,r){switch(e.type){case"color":r=Wr.parse(r);break;case"formatted":r=zr.fromString(r.toString());break;case"resolvedImage":r=as.fromString(r.toString());break;case"padding":r=Cn.parse(r);break;case"colorArray":r=jr.parse(r);break;case"numberArray":r=Ui.parse(r);break;default:Zr(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return bo(r,i.default,e.default)}Ds.register($o,{error:[{kind:"error"},[Br],(i,[e])=>{throw new wi(e.evaluate(i))}],typeof:[Br,[Gr],(i,[e])=>mi(Mi(e.evaluate(i)))],"to-rgba":[Bi(nr,4),[Oi],(i,[e])=>{const[r,s,c,d]=e.evaluate(i).rgb;return[255*r,255*s,255*c,d]}],rgb:[Oi,[nr,nr,nr],Xc],rgba:[Oi,[nr,nr,nr,nr],Xc],has:{type:Or,overloads:[[[Br],(i,[e])=>bl(e.evaluate(i),i.properties())],[[Br,Mn],(i,[e,r])=>bl(e.evaluate(i),r.evaluate(i))]]},get:{type:Gr,overloads:[[[Br],(i,[e])=>xc(e.evaluate(i),i.properties())],[[Br,Mn],(i,[e,r])=>xc(e.evaluate(i),r.evaluate(i))]]},"feature-state":[Gr,[Br],(i,[e])=>xc(e.evaluate(i),i.featureState||{})],properties:[Mn,[],i=>i.properties()],"geometry-type":[Br,[],i=>i.geometryType()],id:[Gr,[],i=>i.id()],zoom:[nr,[],i=>i.globals.zoom],"heatmap-density":[nr,[],i=>i.globals.heatmapDensity||0],elevation:[nr,[],i=>i.globals.elevation||0],"line-progress":[nr,[],i=>i.globals.lineProgress||0],accumulated:[Gr,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[nr,yo(nr),(i,e)=>{let r=0;for(const s of e)r+=s.evaluate(i);return r}],"*":[nr,yo(nr),(i,e)=>{let r=1;for(const s of e)r*=s.evaluate(i);return r}],"-":{type:nr,overloads:[[[nr,nr],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[nr],(i,[e])=>-e.evaluate(i)]]},"/":[nr,[nr,nr],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[nr,[nr,nr],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[nr,[],()=>Math.LN2],pi:[nr,[],()=>Math.PI],e:[nr,[],()=>Math.E],"^":[nr,[nr,nr],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[nr,[nr],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[nr,[nr],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[nr,[nr],(i,[e])=>Math.log(e.evaluate(i))],log2:[nr,[nr],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[nr,[nr],(i,[e])=>Math.sin(e.evaluate(i))],cos:[nr,[nr],(i,[e])=>Math.cos(e.evaluate(i))],tan:[nr,[nr],(i,[e])=>Math.tan(e.evaluate(i))],asin:[nr,[nr],(i,[e])=>Math.asin(e.evaluate(i))],acos:[nr,[nr],(i,[e])=>Math.acos(e.evaluate(i))],atan:[nr,[nr],(i,[e])=>Math.atan(e.evaluate(i))],min:[nr,yo(nr),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[nr,yo(nr),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[nr,[nr],(i,[e])=>Math.abs(e.evaluate(i))],round:[nr,[nr],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[nr,[nr],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[nr,[nr],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Or,[Br,Gr],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[Or,[Gr],(i,[e])=>i.id()===e.value],"filter-type-==":[Or,[Br],(i,[e])=>i.geometryType()===e.value],"filter-<":[Or,[Br,Gr],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s<c}],"filter-id-<":[Or,[Gr],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[Or,[Br,Gr],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s>c}],"filter-id->":[Or,[Gr],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[Or,[Br,Gr],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s<=c}],"filter-id-<=":[Or,[Gr],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[Or,[Br,Gr],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s>=c}],"filter-id->=":[Or,[Gr],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[Or,[Gr],(i,[e])=>e.value in i.properties()],"filter-has-id":[Or,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Or,[Bi(Br)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Or,[Bi(Gr)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Or,[Br,Bi(Gr)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Or,[Br,Bi(Gr)],(i,[e,r])=>function(s,c,d,f){for(;d<=f;){const y=d+f>>1;if(c[y]===s)return!0;c[y]>s?f=y-1:d=y+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Or,overloads:[[[Or,Or],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[yo(Or),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Or,overloads:[[[Or,Or],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[yo(Or),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[Or,[Or],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Or,[Br],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[Br,[Br],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Br,[Br],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Br,yo(Gr),(i,e)=>e.map(r=>$s(r.evaluate(i))).join("")],"resolved-locale":[Br,[ya],(i,[e])=>e.evaluate(i).resolvedLocale()]});class Kl{constructor(e,r,s){this.expression=e,this._warningHistory={},this._evaluator=new No,this._defaultValue=r?function(c){if(c.type==="color"&&Wo(c.default))return new Wr(0,0,0,0);switch(c.type){case"color":return Wr.parse(c.default)||null;case"padding":return Cn.parse(c.default)||null;case"numberArray":return Ui.parse(c.default)||null;case"colorArray":return jr.parse(c.default)||null;case"variableAnchorOffsetCollection":return Ki.parse(c.default)||null;case"projectionDefinition":return jn.parse(c.default)||null;default:return c.default===void 0?null:c.default}}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this._globalState=s}evaluateWithoutErrorHandling(e,r,s,c,d,f){return this._globalState&&(e=Xo(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=c,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,c,d,f){this._globalState&&(e=Xo(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=c,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new wi(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function Ga(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in $o}function wl(i,e,r){const s=new Zs($o,Hl,[],e?function(d){const f={color:Oi,string:Br,number:nr,enum:Br,boolean:Or,formatted:va,padding:Ra,numberArray:za,colorArray:to,projectionDefinition:Bs,resolvedImage:Na,variableAnchorOffsetCollection:ro};return d.type==="array"?Bi(f[d.value]||Gr,d.length):f[d.type]}(e):void 0),c=s.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Yc(new Kl(c,e,r)):Zo(s.errors)}class Tc{constructor(e,r,s){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!xl(r.expression),this.globalStateRefs=Ho(r.expression),this._globalState=s}evaluateWithoutErrorHandling(e,r,s,c,d,f){return this._globalState&&(e=Xo(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,r,s,c,d,f)}evaluate(e,r,s,c,d,f){return this._globalState&&(e=Xo(e,this._globalState)),this._styleExpression.evaluate(e,r,s,c,d,f)}}class tu{constructor(e,r,s,c,d){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!xl(r.expression),this.globalStateRefs=Ho(r.expression),this.interpolationType=c,this._globalState=d}evaluateWithoutErrorHandling(e,r,s,c,d,f){return this._globalState&&(e=Xo(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,r,s,c,d,f)}evaluate(e,r,s,c,d,f){return this._globalState&&(e=Xo(e,this._globalState)),this._styleExpression.evaluate(e,r,s,c,d,f)}interpolationFactor(e,r,s){return this.interpolationType?Mr.interpolationFactor(this.interpolationType,e,r,s):0}}function Pc(i,e,r){const s=wl(i,e,r);if(s.result==="error")return s;const c=s.value.expression,d=Xl(c);if(!d&&!vo(e))return Zo([new Fi("","data expressions not supported")]);const f=Yl(c,["zoom"]);if(!f&&!Jl(e))return Zo([new Fi("","zoom expressions not supported")]);const y=Ic(c);return y||f?y instanceof Fi?Zo([y]):y instanceof Mr&&!fs(e)?Zo([new Fi("",'"interpolate" expressions cannot be used with this property')]):Yc(y?new tu(d?"camera":"composite",s.value,y.labels,y instanceof Mr?y.interpolation:void 0,r):new Tc(d?"constant":"source",s.value,r)):Zo([new Fi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ac{constructor(e,r){this._parameters=e,this._specification=r,kr(this,Jc(this._parameters,this._specification))}static deserialize(e){return new Ac(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ic(i){let e=null;if(i instanceof vi)e=Ic(i.result);else if(i instanceof Ai){for(const r of i.args)if(e=Ic(r),e)break}else(i instanceof rt||i instanceof Mr)&&i.input instanceof Ds&&i.input.name==="zoom"&&(e=i);return e instanceof Fi||i.eachChild(r=>{const s=Ic(r);s instanceof Fi?e=s:!e&&s?e=new Fi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new Fi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Ho(i,e=new Set){return i instanceof vl&&e.add(i.key),i.eachChild(r=>{Ho(r,e)}),e}function Xo(i,e){const{zoom:r,heatmapDensity:s,elevation:c,lineProgress:d,isSupportedScript:f,accumulated:y}=i??{};return{zoom:r,heatmapDensity:s,elevation:c,lineProgress:d,isSupportedScript:f,accumulated:y,globalState:e}}function ru(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!ru(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const iu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Yo(i,e){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};ru(i)||(i=ec(i));const r=wl(i,iu,e);if(r.result==="error")throw new Error(r.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,c,d)=>r.value.evaluate(s,c,{},d),needGeometry:Iu(i),getGlobalStateRefs:()=>Ho(r.value.expression)}}function Ql(i,e){return i<e?-1:i>e?1:0}function Iu(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(Iu(i[e]))return!0;return!1}function ec(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?tc(i[1],i[2],"=="):e==="!="?rc(tc(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?tc(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(ec))):e==="all"?["all"].concat(i.slice(1).map(ec)):e==="none"?["all"].concat(i.slice(1).map(ec).map(rc)):e==="in"?Eu(i[1],i.slice(2)):e==="!in"?rc(Eu(i[1],i.slice(2))):e==="has"?Lu(i[1]):e!=="!has"||rc(Lu(i[1]));var r}function tc(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function Eu(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Ql)]]:["filter-in-small",i,["literal",e]]}}function Lu(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function rc(i){return["!",i]}function Ec(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let c="[";for(const d of i)c+=`${Ec(d)},`;return`${c}]`}const r=Object.keys(i).sort();let s="{";for(let c=0;c<r.length;c++)s+=`${JSON.stringify(r[c])}:${Ec(i[r[c]])},`;return`${s}}`}function $a(i){let e="";for(const r of ft)e+=`/${Ec(i[r])}`;return e}function Ys(i){const e=i.value;return e?[new Ot(i.key,e,"constants have been deprecated as of v8")]:[]}function Si(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Jo(i){if(Array.isArray(i))return i.map(Jo);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Jo(i[r]);return e}return Si(i)}function Fs(i){const e=i.key,r=i.value,s=i.valueSpec||{},c=i.objectElementValidators||{},d=i.style,f=i.styleSpec,y=i.validateSpec;let S=[];const A=Zr(r);if(A!=="object")return[new Ot(e,r,`object expected, ${A} found`)];for(const k in r){const N=k.split(".")[0],V=ao(s,N)||s["*"];let q;if(ao(c,N))q=c[N];else if(ao(s,N))q=y;else if(c["*"])q=c["*"];else{if(!s["*"]){S.push(new Ot(e,r[k],`unknown property "${k}"`));continue}q=y}S=S.concat(q({key:(e&&`${e}.`)+k,value:r[k],valueSpec:V,style:d,styleSpec:f,object:r,objectKey:k,validateSpec:y},r))}for(const k in s)c[k]||s[k].required&&s[k].default===void 0&&r[k]===void 0&&S.push(new Ot(e,r,`missing required property "${k}"`));return S}function ua(i){const e=i.value,r=i.valueSpec,s=i.style,c=i.styleSpec,d=i.key,f=i.arrayElementValidator||i.validateSpec;if(Zr(e)!=="array")return[new Ot(d,e,`array expected, ${Zr(e)} found`)];if(r.length&&e.length!==r.length)return[new Ot(d,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Ot(d,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let y={type:r.value,values:r.values};c.$version<7&&(y.function=r.function),Zr(r.value)==="object"&&(y=r.value);let S=[];for(let A=0;A<e.length;A++)S=S.concat(f({array:e,arrayIndex:A,value:e[A],valueSpec:y,validateSpec:i.validateSpec,style:s,styleSpec:c,key:`${d}[${A}]`}));return S}function Kn(i){const e=i.key,r=i.value,s=i.valueSpec;let c=Zr(r);return c==="number"&&r!=r&&(c="NaN"),c!=="number"?[new Ot(e,r,`number expected, ${c} found`)]:"minimum"in s&&r<s.minimum?[new Ot(e,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new Ot(e,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function Lc(i){const e=i.valueSpec,r=Si(i.value.type);let s,c,d,f={};const y=r!=="categorical"&&i.value.property===void 0,S=!y,A=Zr(i.value.stops)==="array"&&Zr(i.value.stops[0])==="array"&&Zr(i.value.stops[0][0])==="object",k=Fs({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(q){if(r==="identity")return[new Ot(q.key,q.value,'identity function may not have a "stops" property')];let W=[];const H=q.value;return W=W.concat(ua({key:q.key,value:H,valueSpec:q.valueSpec,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:N})),Zr(H)==="array"&&H.length===0&&W.push(new Ot(q.key,H,"array must have at least one stop")),W},default:function(q){return q.validateSpec({key:q.key,value:q.value,valueSpec:e,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec})}}});return r==="identity"&&y&&k.push(new Ot(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||k.push(new Ot(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!fs(i.valueSpec)&&k.push(new Ot(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(S&&!vo(i.valueSpec)?k.push(new Ot(i.key,i.value,"property functions not supported")):y&&!Jl(i.valueSpec)&&k.push(new Ot(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!A||i.value.property!==void 0||k.push(new Ot(i.key,i.value,'"property" property is required')),k;function N(q){let W=[];const H=q.value,J=q.key;if(Zr(H)!=="array")return[new Ot(J,H,`array expected, ${Zr(H)} found`)];if(H.length!==2)return[new Ot(J,H,`array length 2 expected, length ${H.length} found`)];if(A){if(Zr(H[0])!=="object")return[new Ot(J,H,`object expected, ${Zr(H[0])} found`)];if(H[0].zoom===void 0)return[new Ot(J,H,"object stop key must have zoom")];if(H[0].value===void 0)return[new Ot(J,H,"object stop key must have value")];if(d&&d>Si(H[0].zoom))return[new Ot(J,H[0].zoom,"stop zoom values must appear in ascending order")];Si(H[0].zoom)!==d&&(d=Si(H[0].zoom),c=void 0,f={}),W=W.concat(Fs({key:`${J}[0]`,value:H[0],valueSpec:{zoom:{}},validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:Kn,value:V}}))}else W=W.concat(V({key:`${J}[0]`,value:H[0],validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec},H));return Ga(Jo(H[1]))?W.concat([new Ot(`${J}[1]`,H[1],"expressions are not allowed in function stops.")]):W.concat(q.validateSpec({key:`${J}[1]`,value:H[1],valueSpec:e,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec}))}function V(q,W){const H=Zr(q.value),J=Si(q.value),ue=q.value!==null?q.value:W;if(s){if(H!==s)return[new Ot(q.key,ue,`${H} stop domain type must match previous stop domain type ${s}`)]}else s=H;if(H!=="number"&&H!=="string"&&H!=="boolean")return[new Ot(q.key,ue,"stop domain value must be a number, string, or boolean")];if(H!=="number"&&r!=="categorical"){let Ne=`number expected, ${H} found`;return vo(e)&&r===void 0&&(Ne+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ot(q.key,ue,Ne)]}return r!=="categorical"||H!=="number"||isFinite(J)&&Math.floor(J)===J?r!=="categorical"&&H==="number"&&c!==void 0&&J<c?[new Ot(q.key,ue,"stop domain values must appear in ascending order")]:(c=J,r==="categorical"&&J in f?[new Ot(q.key,ue,"stop domain values must be unique")]:(f[J]=!0,[])):[new Ot(q.key,ue,`integer expected, found ${J}`)]}}function xo(i){const e=(i.expressionContext==="property"?Pc:wl)(Jo(i.value),i.valueSpec);if(e.result==="error")return e.value.map(s=>new Ot(`${i.key}${s.key}`,i.value,s.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Ot(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!xl(r))return[new Ot(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!xl(r))return[new Ot(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Yl(r,["zoom","feature-state"]))return[new Ot(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Xl(r))return[new Ot(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Sl(i){const e=i.key,r=i.value,s=Zr(r);return s!=="string"?[new Ot(e,r,`color expected, ${s} found`)]:Wr.parse(String(r))?[]:[new Ot(e,r,`color expected, "${r}" found`)]}function wo(i){const e=i.key,r=i.value,s=i.valueSpec,c=[];return Array.isArray(s.values)?s.values.indexOf(Si(r))===-1&&c.push(new Ot(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(Si(r))===-1&&c.push(new Ot(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),c}function Ko(i){return ru(Jo(i.value))?xo(kr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):nu(i)}function nu(i){const e=i.value,r=i.key;if(Zr(e)!=="array")return[new Ot(r,e,`array expected, ${Zr(e)} found`)];const s=i.styleSpec;let c,d=[];if(e.length<1)return[new Ot(r,e,"filter array must have at least 1 element")];switch(d=d.concat(wo({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),Si(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Si(e[1])==="$type"&&d.push(new Ot(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new Ot(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=Zr(e[1]),c!=="string"&&d.push(new Ot(`${r}[1]`,e[1],`string expected, ${c} found`)));for(let f=2;f<e.length;f++)c=Zr(e[f]),Si(e[1])==="$type"?d=d.concat(wo({key:`${r}[${f}]`,value:e[f],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&d.push(new Ot(`${r}[${f}]`,e[f],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let f=1;f<e.length;f++)d=d.concat(nu({key:`${r}[${f}]`,value:e[f],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":c=Zr(e[1]),e.length!==2?d.push(new Ot(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&d.push(new Ot(`${r}[1]`,e[1],`string expected, ${c} found`))}return d}function Mu(i,e){const r=i.key,s=i.validateSpec,c=i.style,d=i.styleSpec,f=i.value,y=i.objectKey,S=d[`${e}_${i.layerType}`];if(!S)return[];const A=y.match(/^(.*)-transition$/);if(e==="paint"&&A&&S[A[1]]&&S[A[1]].transition)return s({key:r,value:f,valueSpec:d.transition,style:c,styleSpec:d});const k=i.valueSpec||S[y];if(!k)return[new Ot(r,f,`unknown property "${y}"`)];let N;if(Zr(f)==="string"&&vo(k)&&!k.tokens&&(N=/^{([^}]+)}$/.exec(f)))return[new Ot(r,f,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(N[1])} }\`.`)];const V=[];return i.layerType==="symbol"&&y==="text-font"&&Wo(Jo(f))&&Si(f.type)==="identity"&&V.push(new Ot(r,f,'"text-font" does not support identity functions')),V.concat(s({key:i.key,value:f,valueSpec:k,style:c,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:y}))}function ic(i){return Mu(i,"paint")}function nc(i){return Mu(i,"layout")}function Tl(i){let e=[];const r=i.value,s=i.key,c=i.style,d=i.styleSpec;if(Zr(r)!=="object")return[new Ot(s,r,`object expected, ${Zr(r)} found`)];r.type||r.ref||e.push(new Ot(s,r,'either "type" or "ref" is required'));let f=Si(r.type);const y=Si(r.ref);if(r.id){const S=Si(r.id);for(let A=0;A<i.arrayIndex;A++){const k=c.layers[A];Si(k.id)===S&&e.push(new Ot(s,r.id,`duplicate layer id "${r.id}", previously used at line ${k.id.__line__}`))}}if("ref"in r){let S;["type","source","source-layer","filter","layout"].forEach(A=>{A in r&&e.push(new Ot(s,r[A],`"${A}" is prohibited for ref layers`))}),c.layers.forEach(A=>{Si(A.id)===y&&(S=A)}),S?S.ref?e.push(new Ot(s,r.ref,"ref cannot reference another ref layer")):f=Si(S.type):e.push(new Ot(s,r.ref,`ref layer "${y}" not found`))}else if(f!=="background")if(r.source){const S=c.sources&&c.sources[r.source],A=S&&Si(S.type);S?A==="vector"&&f==="raster"?e.push(new Ot(s,r.source,`layer "${r.id}" requires a raster source`)):A!=="raster-dem"&&f==="hillshade"||A!=="raster-dem"&&f==="color-relief"?e.push(new Ot(s,r.source,`layer "${r.id}" requires a raster-dem source`)):A==="raster"&&f!=="raster"?e.push(new Ot(s,r.source,`layer "${r.id}" requires a vector source`)):A!=="vector"||r["source-layer"]?A==="raster-dem"&&f!=="hillshade"&&f!=="color-relief"?e.push(new Ot(s,r.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):f!=="line"||!r.paint||!r.paint["line-gradient"]||A==="geojson"&&S.lineMetrics||e.push(new Ot(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ot(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Ot(s,r.source,`source "${r.source}" not found`))}else e.push(new Ot(s,r,'missing required property "source"'));return e=e.concat(Fs({key:s,value:r,valueSpec:d.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${s}.type`,value:r.type,valueSpec:d.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:Ko,layout:S=>Fs({layer:r,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":A=>nc(kr({layerType:f},A))}}),paint:S=>Fs({layer:r,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":A=>ic(kr({layerType:f},A))}})}})),e}function Za(i){const e=i.value,r=i.key,s=Zr(e);return s!=="string"?[new Ot(r,e,`string expected, ${s} found`)]:[]}const su={promoteId:function({key:i,value:e}){if(Zr(e)==="string")return Za({key:i,value:e});{const r=[];for(const s in e)r.push(...Za({key:`${i}.${s}`,value:e[s]}));return r}}};function Mc(i){const e=i.value,r=i.key,s=i.styleSpec,c=i.style,d=i.validateSpec;if(!e.type)return[new Ot(r,e,'"type" is required')];const f=Si(e.type);let y;switch(f){case"vector":case"raster":return y=Fs({key:r,value:e,valueSpec:s[`source_${f.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:su,validateSpec:d}),y;case"raster-dem":return y=function(S){var A;const k=(A=S.sourceName)!==null&&A!==void 0?A:"",N=S.value,V=S.styleSpec,q=V.source_raster_dem,W=S.style;let H=[];const J=Zr(N);if(N===void 0)return H;if(J!=="object")return H.push(new Ot("source_raster_dem",N,`object expected, ${J} found`)),H;const ue=Si(N.encoding)==="custom",Ne=["redFactor","greenFactor","blueFactor","baseShift"],de=S.value.encoding?`"${S.value.encoding}"`:"Default";for(const ye in N)!ue&&Ne.includes(ye)?H.push(new Ot(ye,N[ye],`In "${k}": "${ye}" is only valid when "encoding" is set to "custom". ${de} encoding found`)):q[ye]?H=H.concat(S.validateSpec({key:ye,value:N[ye],valueSpec:q[ye],validateSpec:S.validateSpec,style:W,styleSpec:V})):H.push(new Ot(ye,N[ye],`unknown property "${ye}"`));return H}({sourceName:r,value:e,style:i.style,styleSpec:s,validateSpec:d}),y;case"geojson":if(y=Fs({key:r,value:e,valueSpec:s.source_geojson,style:c,styleSpec:s,validateSpec:d,objectElementValidators:su}),e.cluster)for(const S in e.clusterProperties){const[A,k]=e.clusterProperties[S],N=typeof A=="string"?[A,["accumulated"],["get",S]]:A;y.push(...xo({key:`${r}.${S}.map`,value:k,expressionContext:"cluster-map"})),y.push(...xo({key:`${r}.${S}.reduce`,value:N,expressionContext:"cluster-reduce"}))}return y;case"video":return Fs({key:r,value:e,valueSpec:s.source_video,style:c,validateSpec:d,styleSpec:s});case"image":return Fs({key:r,value:e,valueSpec:s.source_image,style:c,validateSpec:d,styleSpec:s});case"canvas":return[new Ot(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return wo({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function sc(i){const e=i.value,r=i.styleSpec,s=r.light,c=i.style;let d=[];const f=Zr(e);if(e===void 0)return d;if(f!=="object")return d=d.concat([new Ot("light",e,`object expected, ${f} found`)]),d;for(const y in e){const S=y.match(/^(.*)-transition$/);d=d.concat(S&&s[S[1]]&&s[S[1]].transition?i.validateSpec({key:y,value:e[y],valueSpec:r.transition,validateSpec:i.validateSpec,style:c,styleSpec:r}):s[y]?i.validateSpec({key:y,value:e[y],valueSpec:s[y],validateSpec:i.validateSpec,style:c,styleSpec:r}):[new Ot(y,e[y],`unknown property "${y}"`)])}return d}function Cu(i){const e=i.value,r=i.styleSpec,s=r.sky,c=i.style,d=Zr(e);if(e===void 0)return[];if(d!=="object")return[new Ot("sky",e,`object expected, ${d} found`)];let f=[];for(const y in e)f=f.concat(s[y]?i.validateSpec({key:y,value:e[y],valueSpec:s[y],style:c,styleSpec:r}):[new Ot(y,e[y],`unknown property "${y}"`)]);return f}function au(i){const e=i.value,r=i.styleSpec,s=r.terrain,c=i.style;let d=[];const f=Zr(e);if(e===void 0)return d;if(f!=="object")return d=d.concat([new Ot("terrain",e,`object expected, ${f} found`)]),d;for(const y in e)d=d.concat(s[y]?i.validateSpec({key:y,value:e[y],valueSpec:s[y],validateSpec:i.validateSpec,style:c,styleSpec:r}):[new Ot(y,e[y],`unknown property "${y}"`)]);return d}function ou(i){let e=[];const r=i.value,s=i.key;if(Array.isArray(r)){const c=[],d=[];for(const f in r)r[f].id&&c.includes(r[f].id)&&e.push(new Ot(s,r,`all the sprites' ids must be unique, but ${r[f].id} is duplicated`)),c.push(r[f].id),r[f].url&&d.includes(r[f].url)&&e.push(new Ot(s,r,`all the sprites' URLs must be unique, but ${r[f].url} is duplicated`)),d.push(r[f].url),e=e.concat(Fs({key:`${s}[${f}]`,value:r[f],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return Za({key:s,value:r})}function ku(i){return e=i.value,e&&e.constructor===Object?[]:[new Ot(i.key,i.value,`object expected, ${Zr(i.value)} found`)];var e}const lu={"*":()=>[],array:ua,boolean:function(i){const e=i.value,r=i.key,s=Zr(e);return s!=="boolean"?[new Ot(r,e,`boolean expected, ${s} found`)]:[]},number:Kn,color:Sl,constants:Ys,enum:wo,filter:Ko,function:Lc,layer:Tl,object:Fs,source:Mc,light:sc,sky:Cu,terrain:au,projection:function(i){const e=i.value,r=i.styleSpec,s=r.projection,c=i.style,d=Zr(e);if(e===void 0)return[];if(d!=="object")return[new Ot("projection",e,`object expected, ${d} found`)];let f=[];for(const y in e)f=f.concat(s[y]?i.validateSpec({key:y,value:e[y],valueSpec:s[y],style:c,styleSpec:r}):[new Ot(y,e[y],`unknown property "${y}"`)]);return f},projectionDefinition:function(i){const e=i.key;let r=i.value;r=r instanceof String?r.valueOf():r;const s=Zr(r);return s!=="array"||function(c){return Array.isArray(c)&&c.length===3&&typeof c[0]=="string"&&typeof c[1]=="string"&&typeof c[2]=="number"}(r)||function(c){return!!["interpolate","step","literal"].includes(c[0])}(r)?["array","string"].includes(s)?[]:[new Ot(e,r,`projection expected, invalid type "${s}" found`)]:[new Ot(e,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:Za,formatted:function(i){return Za(i).length===0?[]:xo(i)},resolvedImage:function(i){return Za(i).length===0?[]:xo(i)},padding:function(i){const e=i.key,r=i.value;if(Zr(r)==="array"){if(r.length<1||r.length>4)return[new Ot(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let c=[];for(let d=0;d<r.length;d++)c=c.concat(i.validateSpec({key:`${e}[${d}]`,value:r[d],validateSpec:i.validateSpec,valueSpec:s}));return c}return Kn({key:e,value:r,valueSpec:{}})},numberArray:function(i){const e=i.key,r=i.value;if(Zr(r)==="array"){const s={type:"number"};if(r.length<1)return[new Ot(e,r,"array length at least 1 expected, length 0 found")];let c=[];for(let d=0;d<r.length;d++)c=c.concat(i.validateSpec({key:`${e}[${d}]`,value:r[d],validateSpec:i.validateSpec,valueSpec:s}));return c}return Kn({key:e,value:r,valueSpec:{}})},colorArray:function(i){const e=i.key,r=i.value;if(Zr(r)==="array"){if(r.length<1)return[new Ot(e,r,"array length at least 1 expected, length 0 found")];let s=[];for(let c=0;c<r.length;c++)s=s.concat(Sl({key:`${e}[${c}]`,value:r[c]}));return s}return Sl({key:e,value:r})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,s=Zr(r),c=i.styleSpec;if(s!=="array"||r.length<1||r.length%2!=0)return[new Ot(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let d=[];for(let f=0;f<r.length;f+=2)d=d.concat(wo({key:`${e}[${f}]`,value:r[f],valueSpec:c.layout_symbol["text-anchor"]})),d=d.concat(ua({key:`${e}[${f+1}]`,value:r[f+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:c}));return d},sprite:ou,state:ku};function Pl(i){const e=i.value,r=i.valueSpec,s=i.styleSpec;return i.validateSpec=Pl,r.expression&&Wo(Si(e))?Lc(i):r.expression&&Ga(Jo(e))?xo(i):r.type&&lu[r.type]?lu[r.type](i):Fs(kr({},i,{valueSpec:r.type?s[r.type]:r}))}function Wa(i){const e=i.value,r=i.key,s=Za(i);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new Ot(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new Ot(r,e,'"glyphs" url must include a "{range}" token'))),s}function Js(i,e=ae){let r=[];return r=r.concat(Pl({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:Pl,objectElementValidators:{glyphs:Wa,"*":()=>[]}})),i.constants&&(r=r.concat(Ys({key:"constants",value:i.constants}))),cu(r)}function ha(i){return function(e){return i(Object.assign({},e,{validateSpec:Pl}))}}function cu(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function T(i){return function(...e){return cu(i.apply(this,e))}}Js.source=T(ha(Mc)),Js.sprite=T(ha(ou)),Js.glyphs=T(ha(Wa)),Js.light=T(ha(sc)),Js.sky=T(ha(Cu)),Js.terrain=T(ha(au)),Js.state=T(ha(ku)),Js.layer=T(ha(Tl)),Js.filter=T(ha(Ko)),Js.paintProperty=T(ha(ic)),Js.layoutProperty=T(ha(nc));const E=ae,U=Js,Z=U.light,ne=U.sky,le=U.paintProperty,pe=U.layoutProperty;function _e(i,e){let r=!1;if(e&&e.length)for(const s of e)i.fire(new Ee(new Error(s.message))),r=!0;return r}class we{constructor(e,r,s){const c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const f=new Int32Array(this.arrayBuffer);e=f[0],this.d=(r=f[1])+2*(s=f[2]);for(let S=0;S<this.d*this.d;S++){const A=f[3+S],k=f[3+S+1];c.push(A===k?null:f.subarray(A,k))}const y=f[3+c.length+1];this.keys=f.subarray(f[3+c.length],y),this.bboxes=f.subarray(y),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let f=0;f<this.d*this.d;f++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=s,this.scale=r/e,this.uid=0;const d=s/r*e;this.min=-d,this.max=e+d}insert(e,r,s,c,d){this._forEachCell(r,s,c,d,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(d)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,s,c,d,f){this.cells[d].push(f)}query(e,r,s,c,d){const f=this.min,y=this.max;if(e<=f&&r<=f&&y<=s&&y<=c&&!d)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(e,r,s,c,this._queryCell,S,{},d),S}}_queryCell(e,r,s,c,d,f,y,S){const A=this.cells[d];if(A!==null){const k=this.keys,N=this.bboxes;for(let V=0;V<A.length;V++){const q=A[V];if(y[q]===void 0){const W=4*q;(S?S(N[W+0],N[W+1],N[W+2],N[W+3]):e<=N[W+2]&&r<=N[W+3]&&s>=N[W+0]&&c>=N[W+1])?(y[q]=!0,f.push(k[q])):y[q]=!1}}}}_forEachCell(e,r,s,c,d,f,y,S){const A=this._convertToCellCoord(e),k=this._convertToCellCoord(r),N=this._convertToCellCoord(s),V=this._convertToCellCoord(c);for(let q=A;q<=N;q++)for(let W=k;W<=V;W++){const H=this.d*W+q;if((!S||S(this._convertFromCellCoord(q),this._convertFromCellCoord(W),this._convertFromCellCoord(q+1),this._convertFromCellCoord(W+1)))&&d.call(this,e,r,s,c,H,f,y,S))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let s=0;for(let f=0;f<this.cells.length;f++)s+=this.cells[f].length;const c=new Int32Array(r+s+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let d=r;for(let f=0;f<e.length;f++){const y=e[f];c[3+f]=d,c.set(y,d),d+=y.length}return c[3+e.length]=d,c.set(this.keys,d),d+=this.keys.length,c[3+e.length+1]=d,c.set(this.bboxes,d),d+=this.bboxes.length,c.buffer}static serialize(e,r){const s=e.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(e){return new we(e.buffer)}}const De={};function ke(i,e,r={}){if(De[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),De[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}ke("Object",Object),ke("Set",Set),ke("TransferableGridIndex",we),ke("Color",Wr),ke("Error",Error),ke("AJAXError",Be),ke("ResolvedImage",as),ke("StylePropertyFunction",Ac),ke("StyleExpression",Kl,{omit:["_evaluator"]}),ke("ZoomDependentExpression",tu),ke("ZoomConstantExpression",Tc),ke("CompoundExpression",Ds,{omit:["_evaluate"]});for(const i in $o)$o[i]._classRegistryKey||ke(`Expression_${i}`,$o[i]);function It(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Re(i){return i.$name||i.constructor._classRegistryKey}function dt(i){return!function(e){if(e===null||typeof e!="object")return!1;const r=Re(e);return!(!r||r==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||It(i)||Tr(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function _t(i,e){if(dt(i))return(It(i)||Tr(i))&&e&&e.push(i),ArrayBuffer.isView(i)&&e&&e.push(i.buffer),i instanceof ImageData&&e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const d=[];for(const f of i)d.push(_t(f,e));return d}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const r=Re(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!De[r])throw new Error(`${r} is not registered.`);const{klass:s}=De[r],c=s.serialize?s.serialize(i,e):{};if(s.serialize){if(e&&c===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const d in i){if(!i.hasOwnProperty(d)||De[r].omit.indexOf(d)>=0)continue;const f=i[d];c[d]=De[r].shallow.indexOf(d)>=0?f:_t(f,e)}i instanceof Error&&(c.message=i.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(c.$name=r),c}function qt(i){if(dt(i))return i;if(Array.isArray(i))return i.map(qt);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const e=Re(i)||"Object";if(!De[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=De[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const c of Object.keys(i)){if(c==="$name")continue;const d=i[c];s[c]=De[e].shallow.indexOf(c)>=0?d:qt(d)}return s}class St{constructor(){this.first=!0}update(e,r){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}function $t(i){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function Wt(i){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function or(i){return/\s/u.test(String.fromCodePoint(i))}function Qt(i){for(const e of i)if(Wt(e.codePointAt(0)))return!0;return!1}function Nr(i){for(const e of i)if(!Cr(e.codePointAt(0)))return!1;return!0}function Sr(i){const e=i.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(e.join("|"),"u")}const Qr=Sr(["Arab","Dupl","Mong","Ougr","Syrc"]);function Cr(i){return!Qr.test(String.fromCodePoint(i))}function ui(i){return!(Wt(i)||(e=i,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const on=Sr(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function ei(i){return on.test(String.fromCodePoint(i))}function Er(i,e){return!(!e&&ei(i)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(i)))}function _r(i){for(const e of i)if(ei(e.codePointAt(0)))return!0;return!1}const Ei=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(Ei.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,e){return a(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;const r=i.pluginURL,s=new Promise(d=>{this.loadScriptResolve=d});e(r);const c=new Promise(d=>setTimeout(()=>d(),this.TIMEOUT));if(yield Promise.race([s,c]),this.isParsed()){const d={pluginStatus:"loaded",pluginURL:r};return this.setState(d),d}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)})}};class br{constructor(e,r){this.isSupportedScript=pi,this.zoom=e,r?(this.now=r.now||0,this.fadeDuration=r.fadeDuration||0,this.zoomHistory=r.zoomHistory||new St,this.transition=r.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new St,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}function pi(i){return function(e,r){for(const s of e)if(!Er(s.codePointAt(0),r))return!1;return!0}(i,Ei.getRTLTextPluginStatus()==="loaded")}const ki="-transition";class pn{constructor(e,r,s){this.property=e,this.value=r,this.expression=function(c,d,f){if(Wo(c))return new Ac(c,d);if(Ga(c)){const y=Pc(c,d,f);if(y.result==="error")throw new Error(y.value.map(S=>`${S.key}: ${S.message}`).join(", "));return y.value}{let y=c;return d.type==="color"&&typeof c=="string"?y=Wr.parse(c):d.type!=="padding"||typeof c!="number"&&!Array.isArray(c)?d.type!=="numberArray"||typeof c!="number"&&!Array.isArray(c)?d.type!=="colorArray"||typeof c!="string"&&!Array.isArray(c)?d.type==="variableAnchorOffsetCollection"&&Array.isArray(c)?y=Ki.parse(c):d.type==="projectionDefinition"&&typeof c=="string"&&(y=jn.parse(c)):y=jr.parse(c):y=Ui.parse(c):y=Cn.parse(c),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>y}}}(r===void 0?e.specification.default:r,e.specification,s)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class Un{constructor(e,r){this.property=e,this.value=new pn(e,void 0,r)}transitioned(e,r){return new Vn(this.property,this.value,r,pt({},e.transition,this.transition),e.now)}untransitioned(){return new Vn(this.property,this.value,null,{},0)}}class Wi{constructor(e,r){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=r}getValue(e){return ur(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Un(this._values[e].property,this._globalState)),this._values[e].value=new pn(this._values[e].property,r===null?void 0:ur(r),this._globalState)}getTransition(e){return ur(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Un(this._values[e].property,this._globalState)),this._values[e].transition=ur(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s);const c=this.getTransition(r);c!==void 0&&(e[`${r}${ki}`]=c)}return e}transitioned(e,r){const s=new qn(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].transitioned(e,r._values[c]);return s}untransitioned(){const e=new qn(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Vn{constructor(e,r,s,c,d){this.property=e,this.value=r,this.begin=d+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const c=e.now||0,d=this.value.possiblyEvaluate(e,r,s),f=this.prior;if(f){if(c>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(c<this.begin)return f.possiblyEvaluate(e,r,s);{const y=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,r,s),d,Fe(y))}}return d}}class qn{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const c=new xi(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,r,s);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class vn{constructor(e,r){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=r}hasValue(e){return this._values[e].value!==void 0}getValue(e){return ur(this._values[e].value)}setValue(e,r){this._values[e]=new pn(this._values[e].property,r===null?void 0:ur(r),this._globalState)}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const c=new xi(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,r,s);return c}}class ii{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,s,c){return this.property.evaluate(this.value,this.parameters,e,r,s,c)}}class xi{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class cr{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,s){const c=Ur[this.specification.type];return c?c(e,r,s):e}}class hr{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,c){return new ii(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},s,c)}:e.expression,r)}interpolate(e,r,s){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new ii(this,{kind:"constant",value:void 0},e.parameters);const c=Ur[this.specification.type];if(c){const d=c(e.value.value,r.value.value,s);return new ii(this,{kind:"constant",value:d},e.parameters)}return e}evaluate(e,r,s,c,d,f){return e.kind==="constant"?e.value:e.evaluate(r,s,c,d,f)}}class ln extends hr{possiblyEvaluate(e,r,s,c){if(e.value===void 0)return new ii(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const d=e.expression.evaluate(r,null,{},s,c),f=e.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,y=this._calculate(f,f,f,r);return new ii(this,{kind:"constant",value:y},r)}if(e.expression.kind==="camera"){const d=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new ii(this,{kind:"constant",value:d},r)}return new ii(this,e.expression,r)}evaluate(e,r,s,c,d,f){if(e.kind==="source"){const y=e.evaluate(r,s,c,d,f);return this._calculate(y,y,y,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},s,c),e.evaluate({zoom:Math.floor(r.zoom)},s,c),e.evaluate({zoom:Math.floor(r.zoom)+1},s,c),r):e.value}_calculate(e,r,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class Rs{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const d=e.expression.evaluate(r,null,{},s,c);return this._calculate(d,d,d,r)}return this._calculate(e.expression.evaluate(new br(Math.floor(r.zoom-1),r)),e.expression.evaluate(new br(Math.floor(r.zoom),r)),e.expression.evaluate(new br(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class zi{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,c){return!!e.expression.evaluate(r,null,{},s,c)}interpolate(){return!1}}class Di{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const s=e[r];s.specification.overridable&&this.overridableProperties.push(r);const c=this.defaultPropertyValues[r]=new pn(s,void 0,void 0),d=this.defaultTransitionablePropertyValues[r]=new Un(s,void 0);this.defaultTransitioningPropertyValues[r]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=c.possiblyEvaluate({})}}}ke("DataDrivenProperty",hr),ke("DataConstantProperty",cr),ke("CrossFadedDataDrivenProperty",ln),ke("CrossFadedProperty",Rs),ke("ColorRampProperty",zi);class li extends qe{constructor(e,r,s){if(super(),this.id=e.id,this.type=e.type,this._globalState=s,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=Yo(e.filter,s)),r.layout&&(this._unevaluatedLayout=new vn(r.layout,s)),r.paint)){this._transitionablePaint=new Wi(r.paint,s);for(const c in e.paint)this.setPaintProperty(c,e.paint[c],{validate:!1});for(const c in e.layout)this.setLayoutProperty(c,e.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xi(r.paint)}}setFilter(e){this.filter=e,this._featureFilter=Yo(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;if(this._unevaluatedLayout)for(const r in this._unevaluatedLayout._values){const s=this._unevaluatedLayout._values[r];for(const c of s.getGlobalStateRefs())e.add(c)}for(const r of this._featureFilter.getGlobalStateRefs())e.add(r);return e}getPaintAffectingGlobalStateRefs(){var e;const r=new globalThis.Map;if(this._transitionablePaint)for(const s in this._transitionablePaint._values){const c=this._transitionablePaint._values[s].value;for(const d of c.getGlobalStateRefs()){const f=(e=r.get(d))!==null&&e!==void 0?e:[];f.push({name:s,value:c.value}),r.set(d,f)}}return r}setLayoutProperty(e,r,s={}){r!=null&&this._validate(pe,`layers.${this.id}.layout.${e}`,e,r,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(ki)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(r!=null&&this._validate(le,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if(e.endsWith(ki))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const c=this._transitionablePaint._values[e],d=c.property.specification["property-type"]==="cross-faded-data-driven",f=c.value.isDataDriven(),y=c.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const S=this._transitionablePaint._values[e].value;return S.isDataDriven()||f||d||this._handleOverridablePaintPropertyUpdate(e,y,S)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e,r=!1){return!!(this.minzoom&&e<(r?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),er(e,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(e,r,s,c,d={}){return(!d||d.validate!==!1)&&_e(this,e.call(U,{key:r,layerType:this.type,objectKey:s,value:c,styleSpec:ae,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof ii&&vo(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}let bn;var zs={get paint(){return bn=bn||new Di({"raster-opacity":new cr(ae.paint_raster["raster-opacity"]),"raster-hue-rotate":new cr(ae.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new cr(ae.paint_raster["raster-brightness-min"]),"raster-brightness-max":new cr(ae.paint_raster["raster-brightness-max"]),"raster-saturation":new cr(ae.paint_raster["raster-saturation"]),"raster-contrast":new cr(ae.paint_raster["raster-contrast"]),"raster-resampling":new cr(ae.paint_raster["raster-resampling"]),"raster-fade-duration":new cr(ae.paint_raster["raster-fade-duration"])})}};class Qn extends li{constructor(e,r){super(e,zs,r)}}const vs={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Fn{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class fi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function _i(i,e=1){let r=0,s=0;return{members:i.map(c=>{const d=vs[c.type].BYTES_PER_ELEMENT,f=r=Ni(r,Math.max(e,d)),y=c.components||1;return s=Math.max(s,d),r+=d*y,{name:c.name,type:c.type,components:y,offset:f}}),size:Ni(r,Math.max(s,e)),alignment:e}}function Ni(i,e){return Math.ceil(i/e)*e}class Gn extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.int16[c+0]=r,this.int16[c+1]=s,e}}Gn.prototype.bytesPerElement=4,ke("StructArrayLayout2i4",Gn);class bs extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const d=3*e;return this.int16[d+0]=r,this.int16[d+1]=s,this.int16[d+2]=c,e}}bs.prototype.bytesPerElement=6,ke("StructArrayLayout3i6",bs);class xs extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,c)}emplace(e,r,s,c,d){const f=4*e;return this.int16[f+0]=r,this.int16[f+1]=s,this.int16[f+2]=c,this.int16[f+3]=d,e}}xs.prototype.bytesPerElement=8,ke("StructArrayLayout4i8",xs);class da extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,s,c,d,f)}emplace(e,r,s,c,d,f,y){const S=6*e;return this.int16[S+0]=r,this.int16[S+1]=s,this.int16[S+2]=c,this.int16[S+3]=d,this.int16[S+4]=f,this.int16[S+5]=y,e}}da.prototype.bytesPerElement=12,ke("StructArrayLayout2i4i12",da);class In extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,s,c,d,f)}emplace(e,r,s,c,d,f,y){const S=4*e,A=8*e;return this.int16[S+0]=r,this.int16[S+1]=s,this.uint8[A+4]=c,this.uint8[A+5]=d,this.uint8[A+6]=f,this.uint8[A+7]=y,e}}In.prototype.bytesPerElement=8,ke("StructArrayLayout2i4ub8",In);class So extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.float32[c+0]=r,this.float32[c+1]=s,e}}So.prototype.bytesPerElement=8,ke("StructArrayLayout2f8",So);class Al extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,f,y,S,A,k){const N=this.length;return this.resize(N+1),this.emplace(N,e,r,s,c,d,f,y,S,A,k)}emplace(e,r,s,c,d,f,y,S,A,k,N){const V=10*e;return this.uint16[V+0]=r,this.uint16[V+1]=s,this.uint16[V+2]=c,this.uint16[V+3]=d,this.uint16[V+4]=f,this.uint16[V+5]=y,this.uint16[V+6]=S,this.uint16[V+7]=A,this.uint16[V+8]=k,this.uint16[V+9]=N,e}}Al.prototype.bytesPerElement=20,ke("StructArrayLayout10ui20",Al);class Il extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,f,y,S){const A=this.length;return this.resize(A+1),this.emplace(A,e,r,s,c,d,f,y,S)}emplace(e,r,s,c,d,f,y,S,A){const k=8*e;return this.uint16[k+0]=r,this.uint16[k+1]=s,this.uint16[k+2]=c,this.uint16[k+3]=d,this.uint16[k+4]=f,this.uint16[k+5]=y,this.uint16[k+6]=S,this.uint16[k+7]=A,e}}Il.prototype.bytesPerElement=16,ke("StructArrayLayout8ui16",Il);class Qo extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,f,y,S,A,k,N,V){const q=this.length;return this.resize(q+1),this.emplace(q,e,r,s,c,d,f,y,S,A,k,N,V)}emplace(e,r,s,c,d,f,y,S,A,k,N,V,q){const W=12*e;return this.int16[W+0]=r,this.int16[W+1]=s,this.int16[W+2]=c,this.int16[W+3]=d,this.uint16[W+4]=f,this.uint16[W+5]=y,this.uint16[W+6]=S,this.uint16[W+7]=A,this.int16[W+8]=k,this.int16[W+9]=N,this.int16[W+10]=V,this.int16[W+11]=q,e}}Qo.prototype.bytesPerElement=24,ke("StructArrayLayout4i4ui4i24",Qo);class Ha extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const d=3*e;return this.float32[d+0]=r,this.float32[d+1]=s,this.float32[d+2]=c,e}}Ha.prototype.bytesPerElement=12,ke("StructArrayLayout3f12",Ha);class Cc extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Cc.prototype.bytesPerElement=4,ke("StructArrayLayout1ul4",Cc);class el extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,f,y,S,A){const k=this.length;return this.resize(k+1),this.emplace(k,e,r,s,c,d,f,y,S,A)}emplace(e,r,s,c,d,f,y,S,A,k){const N=10*e,V=5*e;return this.int16[N+0]=r,this.int16[N+1]=s,this.int16[N+2]=c,this.int16[N+3]=d,this.int16[N+4]=f,this.int16[N+5]=y,this.uint32[V+3]=S,this.uint16[N+8]=A,this.uint16[N+9]=k,e}}el.prototype.bytesPerElement=20,ke("StructArrayLayout6i1ul2ui20",el);class fa extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,s,c,d,f)}emplace(e,r,s,c,d,f,y){const S=6*e;return this.int16[S+0]=r,this.int16[S+1]=s,this.int16[S+2]=c,this.int16[S+3]=d,this.int16[S+4]=f,this.int16[S+5]=y,e}}fa.prototype.bytesPerElement=12,ke("StructArrayLayout2i2i2i12",fa);class ac extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,c,d)}emplace(e,r,s,c,d,f){const y=4*e,S=8*e;return this.float32[y+0]=r,this.float32[y+1]=s,this.float32[y+2]=c,this.int16[S+6]=d,this.int16[S+7]=f,e}}ac.prototype.bytesPerElement=16,ke("StructArrayLayout2f1f2i16",ac);class uu extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,s,c,d,f)}emplace(e,r,s,c,d,f,y){const S=16*e,A=4*e,k=8*e;return this.uint8[S+0]=r,this.uint8[S+1]=s,this.float32[A+1]=c,this.float32[A+2]=d,this.int16[k+6]=f,this.int16[k+7]=y,e}}uu.prototype.bytesPerElement=16,ke("StructArrayLayout2ub2f2i16",uu);class tl extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const d=3*e;return this.uint16[d+0]=r,this.uint16[d+1]=s,this.uint16[d+2]=c,e}}tl.prototype.bytesPerElement=6,ke("StructArrayLayout3ui6",tl);class To extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,f,y,S,A,k,N,V,q,W,H,J,ue){const Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,e,r,s,c,d,f,y,S,A,k,N,V,q,W,H,J,ue)}emplace(e,r,s,c,d,f,y,S,A,k,N,V,q,W,H,J,ue,Ne){const de=24*e,ye=12*e,je=48*e;return this.int16[de+0]=r,this.int16[de+1]=s,this.uint16[de+2]=c,this.uint16[de+3]=d,this.uint32[ye+2]=f,this.uint32[ye+3]=y,this.uint32[ye+4]=S,this.uint16[de+10]=A,this.uint16[de+11]=k,this.uint16[de+12]=N,this.float32[ye+7]=V,this.float32[ye+8]=q,this.uint8[je+36]=W,this.uint8[je+37]=H,this.uint8[je+38]=J,this.uint32[ye+10]=ue,this.int16[de+22]=Ne,e}}To.prototype.bytesPerElement=48,ke("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",To);class El extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,f,y,S,A,k,N,V,q,W,H,J,ue,Ne,de,ye,je,Ke,xt,Vt,zt,Xt,lr,Kt){const jt=this.length;return this.resize(jt+1),this.emplace(jt,e,r,s,c,d,f,y,S,A,k,N,V,q,W,H,J,ue,Ne,de,ye,je,Ke,xt,Vt,zt,Xt,lr,Kt)}emplace(e,r,s,c,d,f,y,S,A,k,N,V,q,W,H,J,ue,Ne,de,ye,je,Ke,xt,Vt,zt,Xt,lr,Kt,jt){const Et=32*e,yr=16*e;return this.int16[Et+0]=r,this.int16[Et+1]=s,this.int16[Et+2]=c,this.int16[Et+3]=d,this.int16[Et+4]=f,this.int16[Et+5]=y,this.int16[Et+6]=S,this.int16[Et+7]=A,this.uint16[Et+8]=k,this.uint16[Et+9]=N,this.uint16[Et+10]=V,this.uint16[Et+11]=q,this.uint16[Et+12]=W,this.uint16[Et+13]=H,this.uint16[Et+14]=J,this.uint16[Et+15]=ue,this.uint16[Et+16]=Ne,this.uint16[Et+17]=de,this.uint16[Et+18]=ye,this.uint16[Et+19]=je,this.uint16[Et+20]=Ke,this.uint16[Et+21]=xt,this.uint16[Et+22]=Vt,this.uint32[yr+12]=zt,this.float32[yr+13]=Xt,this.float32[yr+14]=lr,this.uint16[Et+30]=Kt,this.uint16[Et+31]=jt,e}}El.prototype.bytesPerElement=64,ke("StructArrayLayout8i15ui1ul2f2ui64",El);class Ll extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Ll.prototype.bytesPerElement=4,ke("StructArrayLayout1f4",Ll);class Po extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const d=3*e;return this.uint16[6*e+0]=r,this.float32[d+1]=s,this.float32[d+2]=c,e}}Po.prototype.bytesPerElement=12,ke("StructArrayLayout1ui2f12",Po);class Ml extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const d=4*e;return this.uint32[2*e+0]=r,this.uint16[d+2]=s,this.uint16[d+3]=c,e}}Ml.prototype.bytesPerElement=8,ke("StructArrayLayout1ul2ui8",Ml);class oc extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.uint16[c+0]=r,this.uint16[c+1]=s,e}}oc.prototype.bytesPerElement=4,ke("StructArrayLayout2ui4",oc);class Ao extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Ao.prototype.bytesPerElement=2,ke("StructArrayLayout1ui2",Ao);class kc extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,c)}emplace(e,r,s,c,d){const f=4*e;return this.float32[f+0]=r,this.float32[f+1]=s,this.float32[f+2]=c,this.float32[f+3]=d,e}}kc.prototype.bytesPerElement=16,ke("StructArrayLayout4f16",kc);class g extends Fn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new C(this.anchorPointX,this.anchorPointY)}}g.prototype.size=20;class t extends el{get(e){return new g(this,e)}}ke("CollisionBoxArray",t);class n extends Fn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}n.prototype.size=48;class l extends To{get(e){return new n(this,e)}}ke("PlacedSymbolArray",l);class h extends Fn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}h.prototype.size=64;class _ extends El{get(e){return new h(this,e)}}ke("SymbolInstanceArray",_);class w extends Ll{getoffsetX(e){return this.float32[1*e+0]}}ke("GlyphOffsetArray",w);class P extends bs{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}ke("SymbolLineVertexArray",P);class M extends Fn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}M.prototype.size=12;class R extends Po{get(e){return new M(this,e)}}ke("TextAnchorOffsetArray",R);class B extends Fn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}B.prototype.size=8;class $ extends Ml{get(e){return new B(this,e)}}ke("FeatureIndexArray",$);class G extends Gn{}class X extends Gn{}class oe extends Gn{}class ve extends da{}class Se extends In{}class be extends So{}class Ae extends Al{}class We extends Il{}class Le extends Qo{}class Je extends Ha{}class et extends Cc{}class Ve extends fa{}class lt extends uu{}class Tt extends tl{}class bt extends oc{}const Pt=_i([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ct}=Pt;class Jt{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,r,s,c){const d=this.segments[this.segments.length-1];return e>Jt.MAX_VERTEX_ARRAY_LENGTH&&Ft(`Max vertices per segment is ${Jt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Jt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!d||d.vertexLength+e>Jt.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==c?this.createNewSegment(r,s,c):d}createNewSegment(e,r,s){const c={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return s!==void 0&&(c.sortKey=s),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(c),c}getOrCreateLatestSegment(e,r,s){return this.prepareSegment(0,e,r,s)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,c){return new Jt([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:c,vaos:{},sortKey:0}])}}function ar(i,e){return 256*(i=ct(Math.floor(i),0,255))+ct(Math.floor(e),0,255)}Jt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ke("SegmentVector",Jt);const Yt=_i([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),xr=_i([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Jr,Ti,qi,Li={exports:{}},en={exports:{}},Vi={exports:{}},$n=function(){if(qi)return Li.exports;qi=1;var i=(Jr||(Jr=1,en.exports=function(r,s){var c,d,f,y,S,A,k,N;for(d=r.length-(c=3&r.length),f=s,S=3432918353,A=461845907,N=0;N<d;)k=255&r.charCodeAt(N)|(255&r.charCodeAt(++N))<<8|(255&r.charCodeAt(++N))<<16|(255&r.charCodeAt(++N))<<24,++N,f=27492+(65535&(y=5*(65535&(f=(f^=k=(65535&(k=(k=(65535&k)*S+(((k>>>16)*S&65535)<<16)&4294967295)<<15|k>>>17))*A+(((k>>>16)*A&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(k=0,c){case 3:k^=(255&r.charCodeAt(N+2))<<16;case 2:k^=(255&r.charCodeAt(N+1))<<8;case 1:f^=k=(65535&(k=(k=(65535&(k^=255&r.charCodeAt(N)))*S+(((k>>>16)*S&65535)<<16)&4294967295)<<15|k>>>17))*A+(((k>>>16)*A&65535)<<16)&4294967295}return f^=r.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),en.exports),e=(Ti||(Ti=1,Vi.exports=function(r,s){for(var c,d=r.length,f=s^d,y=0;d>=4;)c=1540483477*(65535&(c=255&r.charCodeAt(y)|(255&r.charCodeAt(++y))<<8|(255&r.charCodeAt(++y))<<16|(255&r.charCodeAt(++y))<<24))+((1540483477*(c>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),d-=4,++y;switch(d){case 3:f^=(255&r.charCodeAt(y+2))<<16;case 2:f^=(255&r.charCodeAt(y+1))<<8;case 1:f=1540483477*(65535&(f^=255&r.charCodeAt(y)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),Vi.exports);return Li.exports=i,Li.exports.murmur3=i,Li.exports.murmur2=e,Li.exports}(),Hi=F($n);class Rn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,c){this.ids.push(xn(e)),this.positions.push(r,s,c)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=xn(e);let s=0,c=this.ids.length-1;for(;s<c;){const f=s+c>>1;this.ids[f]>=r?c=f:s=f+1}const d=[];for(;this.ids[s]===r;)d.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return d}static serialize(e,r){const s=new Float64Array(e.ids),c=new Uint32Array(e.positions);return wn(s,c,0,s.length-1),r&&r.push(s.buffer,c.buffer),{ids:s,positions:c}}static deserialize(e){const r=new Rn;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function xn(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Hi(String(i))}function wn(i,e,r,s){for(;r<s;){const c=i[r+s>>1];let d=r-1,f=s+1;for(;;){do d++;while(i[d]<c);do f--;while(i[f]>c);if(d>=f)break;ps(i,d,f),ps(e,3*d,3*f),ps(e,3*d+1,3*f+1),ps(e,3*d+2,3*f+2)}f-r<s-f?(wn(i,e,r,f),r=f+1):(wn(i,e,f+1,s),s=f)}}function ps(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}ke("FeaturePositionMap",Rn);class Ns{constructor(e,r){this.gl=e.gl,this.location=r}}class Io extends Ns{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Cl extends Ns{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class lc extends Ns{constructor(e,r){super(e,r),this.current=Wr.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Du=new Float32Array(16);function Dc(i){return[ar(255*i.r,255*i.g),ar(255*i.b,255*i.a)]}class Eo{constructor(e,r,s){this.value=e,this.uniformNames=r.map(c=>`u_${c}`),this.type=s}setUniform(e,r,s){e.set(s.constantOr(this.value))}getBinding(e,r,s){return this.type==="color"?new lc(e,r):new Io(e,r)}}class es{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,r){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,r.y,r.height,r.width]}setUniform(e,r,s,c){let d=null;c==="u_pattern_to"?d=this.patternTo:c==="u_pattern_from"?d=this.patternFrom:c==="u_dasharray_to"?d=this.dashTo:c==="u_dasharray_from"?d=this.dashFrom:c==="u_pixel_ratio_to"?d=this.pixelRatioTo:c==="u_pixel_ratio_from"&&(d=this.pixelRatioFrom),d!==null&&e.set(d)}getBinding(e,r,s){return s.substr(0,9)==="u_pattern"||s.substr(0,12)==="u_dasharray_"?new Cl(e,r):new Io(e,r)}}class ws{constructor(e,r,s,c){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(d=>({name:`a_${d}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,r,s){const c=this.paintVertexArray.length,d=this.expression.evaluate(new br(0,s),r,{},s.canonical,[],s.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(c,e,d)}updatePaintArray(e,r,s,c,d){const f=this.expression.evaluate(new br(0,d),s,c);this._setPaintValue(e,r,f)}_setPaintValue(e,r,s){if(this.type==="color"){const c=Dc(s);for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,c[0],c[1])}else{for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ms{constructor(e,r,s,c,d,f){this.expression=e,this.uniformNames=r.map(y=>`u_${y}_t`),this.type=s,this.useIntegerZoom=c,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,r,s){const c=this.expression.evaluate(new br(this.zoom,s),r,{},s.canonical,[],s.formattedSection),d=this.expression.evaluate(new br(this.zoom+1,s),r,{},s.canonical,[],s.formattedSection),f=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(f,e,c,d)}updatePaintArray(e,r,s,c,d){const f=this.expression.evaluate(new br(this.zoom,d),s,c),y=this.expression.evaluate(new br(this.zoom+1,d),s,c);this._setPaintValue(e,r,f,y)}_setPaintValue(e,r,s,c){if(this.type==="color"){const d=Dc(s),f=Dc(c);for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,d[0],d[1],f[0],f[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,s,c);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,c=ct(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,r,s){return new Io(e,r)}}class Ca{constructor(e,r,s,c,d,f){this.expression=e,this.type=r,this.useIntegerZoom=s,this.zoom=c,this.layerId=f,this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(e,r,s){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,this.getPositionIds(r),s)}updatePaintArray(e,r,s,c,d){this._setPaintValues(e,r,this.getPositionIds(s),d)}_setPaintValues(e,r,s,c){const d=this.getPositions(c);if(!d||!s)return;const f=d[s.min],y=d[s.mid],S=d[s.max];if(f&&y&&S)for(let A=e;A<r;A++)this.emplace(this.zoomInPaintVertexArray,A,y,f),this.emplace(this.zoomOutPaintVertexArray,A,y,S)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const r=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,r,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,r,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class zn extends Ca{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return Yt.members}emplace(e,r,s,c){e.emplace(r,s.tlbr[0],s.tlbr[1],s.tlbr[2],s.tlbr[3],c.tlbr[0],c.tlbr[1],c.tlbr[2],c.tlbr[3],s.pixelRatio,c.pixelRatio)}}class Zn extends Ca{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return xr.members}emplace(e,r,s,c){e.emplace(r,0,s.y,s.height,s.width,0,c.y,c.height,c.width)}}class pa{constructor(e,r,s){this.binders={},this._buffers=[];const c=[];for(const d in e.paint._values){if(!s(d))continue;const f=e.paint.get(d);if(!(f instanceof ii&&vo(f.property.specification)))continue;const y=rf(d,e.type),S=f.value,A=f.property.specification.type,k=f.property.useIntegerZoom,N=f.property.specification["property-type"],V=N==="cross-faded"||N==="cross-faded-data-driven";if(S.kind==="constant")this.binders[d]=V?new es(S.value,y):new Eo(S.value,y,A),c.push(`/u_${d}`);else if(S.kind==="source"||V){const q=Jh(d,A,"source");this.binders[d]=V?d==="line-dasharray"?new Zn(S,A,k,r,q,e.id):new zn(S,A,k,r,q,e.id):new ws(S,y,A,q),c.push(`/a_${d}`)}else{const q=Jh(d,A,"composite");this.binders[d]=new ms(S,y,A,k,r,q),c.push(`/z_${d}`)}}this.cacheKey=c.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof ws||r instanceof ms?r.maxValue:0}populatePaintArrays(e,r,s){for(const c in this.binders){const d=this.binders[c];(d instanceof ws||d instanceof ms||d instanceof Ca)&&d.populatePaintArray(e,r,s)}}setConstantPatternPositions(e,r){for(const s in this.binders){const c=this.binders[s];c instanceof es&&c.setConstantPatternPositions(e,r)}}setConstantDashPositions(e,r){for(const s in this.binders){const c=this.binders[s];c instanceof es&&c.setConstantDashPositions(e,r)}}updatePaintArrays(e,r,s,c,d){let f=!1;for(const y in e){const S=r.getPositions(y);for(const A of S){const k=s.feature(A.index);for(const N in this.binders){const V=this.binders[N];if((V instanceof ws||V instanceof ms||V instanceof Ca)&&V.expression.isStateDependent===!0){const q=c.paint.get(N);V.expression=q.value,V.updatePaintArray(A.start,A.end,k,e[y],d),f=!0}}}}return f}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Eo||s instanceof es)&&e.push(...s.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof ws||s instanceof ms)for(let c=0;c<s.paintVertexAttributes.length;c++)e.push(s.paintVertexAttributes[c].name);else if(s instanceof Ca){const c=s.getVertexAttributes();for(const d of c)e.push(d.name)}}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Eo||s instanceof es||s instanceof ms)for(const c of s.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const s=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof Eo||d instanceof es||d instanceof ms){for(const f of d.uniformNames)if(r[f]){const y=d.getBinding(e,r[f],f);s.push({name:f,property:c,binding:y})}}}return s}setUniforms(e,r,s,c){for(const{name:d,property:f,binding:y}of r)this.binders[f].setUniform(y,c,s.get(f),d)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(e&&s instanceof Ca){const c=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(s instanceof ws||s instanceof ms)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof ws||s instanceof ms||s instanceof Ca)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof ws||r instanceof ms||r instanceof Ca)&&r.destroy()}}}class cn{constructor(e,r,s=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new pa(c,r,s);this.needsUpload=!1,this._featureMap=new Rn,this._bufferOffset=0}populatePaintArrays(e,r,s,c){for(const d in this.programConfigurations)this.programConfigurations[d].populatePaintArrays(e,r,c);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,c){for(const d of s)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(e,this._featureMap,r,d,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function rf(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Jh(i,e,r){const s={color:{source:So,composite:kc},number:{source:Ll,composite:So}},c=function(d){return{"line-pattern":{source:Ae,composite:Ae},"fill-pattern":{source:Ae,composite:Ae},"fill-extrusion-pattern":{source:Ae,composite:Ae},"line-dasharray":{source:We,composite:We}}[d]}(i);return c&&c[r]||s[e][r]}ke("ConstantBinder",Eo),ke("CrossFadedConstantBinder",es),ke("SourceExpressionBinder",ws),ke("CrossFadedPatternBinder",zn),ke("CrossFadedDasharrayBinder",Zn),ke("CompositeExpressionBinder",ms),ke("ProgramConfiguration",pa,{omit:["_buffers"]}),ke("ProgramConfigurationSet",cn);const ph=Math.pow(2,14)-1,Kh=-ph-1;function cc(i){const e=vt/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const c=r[s];for(let d=0;d<c.length;d++){const f=c[d],y=Math.round(f.x*e),S=Math.round(f.y*e);f.x=ct(y,Kh,ph),f.y=ct(S,Kh,ph),(y<f.x||y>f.x+1||S<f.y||S>f.y+1)&&Ft("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function uc(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?cc(i):[]}}const kl=-32768;function Qh(i,e,r,s,c){i.emplaceBack(kl+8*e+s,kl+8*r+c)}class Fu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new X,this.indexArray=new Tt,this.segments=new Jt,this.programConfigurations=new cn(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){const c=this.layers[0],d=[];let f=null,y=!1,S=c.type==="heatmap";if(c.type==="circle"){const k=c;f=k.layout.get("circle-sort-key"),y=!f.isConstant(),S=S||k.paint.get("circle-pitch-alignment")==="map"}const A=S?r.subdivisionGranularity.circle:1;for(const{feature:k,id:N,index:V,sourceLayerIndex:q}of e){const W=this.layers[0]._featureFilter.needGeometry,H=uc(k,W);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),H,s))continue;const J=y?f.evaluate(H,{},s):void 0,ue={id:N,properties:k.properties,type:k.type,sourceLayerIndex:q,index:V,geometry:W?H.geometry:cc(k),patterns:{},sortKey:J};d.push(ue)}y&&d.sort((k,N)=>k.sortKey-N.sortKey);for(const k of d){const{geometry:N,index:V,sourceLayerIndex:q}=k,W=e[V].feature;this.addFeature(k,N,V,s,A),r.featureIndex.insert(W,N,V,q,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:s})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ct),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,c,d=1){let f;switch(d){case 1:f=[0,7];break;case 3:f=[0,2,5,7];break;case 5:f=[0,1,3,4,6,7];break;case 7:f=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${d}; valid values are 1, 3, 5, 7.`)}const y=f.length;for(const S of r)for(const A of S){const k=A.x,N=A.y;if(k<0||k>=vt||N<0||N>=vt)continue;const V=this.segments.prepareSegment(y*y,this.layoutVertexArray,this.indexArray,e.sortKey),q=V.vertexLength;for(let W=0;W<y;W++)for(let H=0;H<y;H++)Qh(this.layoutVertexArray,k,N,f[H],f[W]);for(let W=0;W<y-1;W++)for(let H=0;H<y-1;H++){const J=q+W*y+H,ue=q+(W+1)*y+H;this.indexArray.emplaceBack(J,ue+1,J+1),this.indexArray.emplaceBack(J,ue,ue+1)}V.vertexLength+=y*y,V.primitiveLength+=(y-1)*(y-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{imagePositions:{},canonical:c})}}function mh(i,e){for(let r=0;r<i.length;r++)if(Ru(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Ru(i,e[r]))return!0;return!!nf(i,e)}function Fc(i,e,r){return!!Ru(i,e)||!!sf(e,i,r)}function gh(i,e){if(i.length===1)return nm(e,i[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let c=0;c<s.length;c++)if(Ru(i,s[c]))return!0}for(let r=0;r<i.length;r++)if(nm(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(nf(i,e[r]))return!0;return!1}function _h(i,e,r){if(i.length>1){if(nf(i,e))return!0;for(let s=0;s<e.length;s++)if(sf(e[s],i,r))return!0}for(let s=0;s<i.length;s++)if(sf(i[s],e,r))return!0;return!1}function nf(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],c=i[r+1];for(let d=0;d<e.length-1;d++)if(o1(s,c,e[d],e[d+1]))return!0}return!1}function o1(i,e,r,s){return Ue(i,r,s)!==Ue(e,r,s)&&Ue(i,e,r)!==Ue(i,e,s)}function sf(i,e,r){const s=r*r;if(e.length===1)return i.distSqr(e[0])<s;for(let c=1;c<e.length;c++)if(im(i,e[c-1],e[c])<s)return!0;return!1}function im(i,e,r){const s=e.distSqr(r);if(s===0)return i.distSqr(e);const c=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/s;return i.distSqr(c<0?e:c>1?r:r.sub(e)._mult(c)._add(e))}function nm(i,e){let r,s,c,d=!1;for(let f=0;f<i.length;f++){r=i[f];for(let y=0,S=r.length-1;y<r.length;S=y++)s=r[y],c=r[S],s.y>e.y!=c.y>e.y&&e.x<(c.x-s.x)*(e.y-s.y)/(c.y-s.y)+s.x&&(d=!d)}return d}function Ru(i,e){let r=!1;for(let s=0,c=i.length-1;s<i.length;c=s++){const d=i[s],f=i[c];d.y>e.y!=f.y>e.y&&e.x<(f.x-d.x)*(e.y-d.y)/(f.y-d.y)+d.x&&(r=!r)}return r}function l1(i,e,r){const s=r[0],c=r[2];if(i.x<s.x&&e.x<s.x||i.x>c.x&&e.x>c.x||i.y<s.y&&e.y<s.y||i.y>c.y&&e.y>c.y)return!1;const d=Ue(i,e,r[0]);return d!==Ue(i,e,r[1])||d!==Ue(i,e,r[2])||d!==Ue(i,e,r[3])}function zu(i,e,r){const s=e.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(e.id).getMaxValue(i)}function ed(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function td(i,e,r,s,c){if(!e[0]&&!e[1])return i;const d=C.convert(e)._mult(c);r==="viewport"&&d._rotate(-s);const f=[];for(let y=0;y<i.length;y++)f.push(i[y].sub(d));return f}function c1(i){const e=[];for(let r=0;r<i.length;r++){const s=i[r],c=e.at(-1);(r===0||c&&!s.equals(c))&&e.push(s)}return e}function u1({queryGeometry:i,size:e},r){return Fc(i,r,e)}function h1({queryGeometry:i,size:e,transform:r,unwrappedTileID:s,getElevation:c},d){return Fc(i,d,e*(r.projectTileCoordinates(d.x,d.y,s,c).signedDistanceFromCamera/r.cameraToCenterDistance))}function d1({queryGeometry:i,size:e,transform:r,unwrappedTileID:s,getElevation:c},d){const f=r.projectTileCoordinates(d.x,d.y,s,c).signedDistanceFromCamera,y=e*(r.cameraToCenterDistance/f);return Fc(i,af(d,r,s,c),y)}function f1({queryGeometry:i,size:e,transform:r,unwrappedTileID:s,getElevation:c},d){return Fc(i,af(d,r,s,c),e)}function sm({queryGeometry:i,size:e,transform:r,unwrappedTileID:s,getElevation:c,pitchAlignment:d="map",pitchScale:f="map"},y){const S=d==="map"?f==="map"?u1:h1:f==="map"?d1:f1,A={queryGeometry:i,size:e,transform:r,unwrappedTileID:s,getElevation:c};for(const k of y)for(const N of k)if(S(A,N))return!0;return!1}function af(i,e,r,s){const c=e.projectTileCoordinates(i.x,i.y,r,s).point;return new C((.5*c.x+.5)*e.width,(.5*-c.y+.5)*e.height)}let am,om;ke("CircleBucket",Fu,{omit:["layers"]});var p1={get paint(){return om=om||new Di({"circle-radius":new hr(ae.paint_circle["circle-radius"]),"circle-color":new hr(ae.paint_circle["circle-color"]),"circle-blur":new hr(ae.paint_circle["circle-blur"]),"circle-opacity":new hr(ae.paint_circle["circle-opacity"]),"circle-translate":new cr(ae.paint_circle["circle-translate"]),"circle-translate-anchor":new cr(ae.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new cr(ae.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new cr(ae.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new hr(ae.paint_circle["circle-stroke-width"]),"circle-stroke-color":new hr(ae.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new hr(ae.paint_circle["circle-stroke-opacity"])})},get layout(){return am=am||new Di({"circle-sort-key":new hr(ae.layout_circle["circle-sort-key"])})}};class m1 extends li{constructor(e,r){super(e,p1,r)}createBucket(e){return new Fu(e)}queryRadius(e){const r=e;return zu("circle-radius",this,r)+zu("circle-stroke-width",this,r)+ed(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:s,geometry:c,transform:d,pixelsToTileUnits:f,unwrappedTileID:y,getElevation:S}){const A=td(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-d.bearingInRadians,f),k=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s),N=this.paint.get("circle-pitch-scale"),V=this.paint.get("circle-pitch-alignment");let q,W;return V==="map"?(q=A,W=k*f):(q=function(H,J,ue,Ne){return H.map(de=>af(de,J,ue,Ne))}(A,d,y,S),W=k),sm({queryGeometry:q,size:W,transform:d,unwrappedTileID:y,getElevation:S,pitchAlignment:V,pitchScale:N},c)}}class lm extends Fu{}let cm;ke("HeatmapBucket",lm,{omit:["layers"]});var g1={get paint(){return cm=cm||new Di({"heatmap-radius":new hr(ae.paint_heatmap["heatmap-radius"]),"heatmap-weight":new hr(ae.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new cr(ae.paint_heatmap["heatmap-intensity"]),"heatmap-color":new zi(ae.paint_heatmap["heatmap-color"]),"heatmap-opacity":new cr(ae.paint_heatmap["heatmap-opacity"])})}};function of(i,{width:e,height:r},s,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*r*s)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${e*r*s}`)}else c=new Uint8Array(e*r*s);return i.width=e,i.height=r,i.data=c,i}function um(i,{width:e,height:r},s){if(e===i.width&&r===i.height)return;const c=of({},{width:e,height:r},s);lf(i,c,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},s),i.width=e,i.height=r,i.data=c.data}function lf(i,e,r,s,c,d){if(c.width===0||c.height===0)return e;if(c.width>i.width||c.height>i.height||r.x>i.width-c.width||r.y>i.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||s.x>e.width-c.width||s.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const f=i.data,y=e.data;if(f===y)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<c.height;S++){const A=((r.y+S)*i.width+r.x)*d,k=((s.y+S)*e.width+s.x)*d;for(let N=0;N<c.width*d;N++)y[k+N]=f[A+N]}return e}class yh{constructor(e,r){of(this,e,1,r)}resize(e){um(this,e,1)}clone(){return new yh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,c,d){lf(e,r,s,c,d,1)}}class ma{constructor(e,r){of(this,e,4,r)}resize(e){um(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ma({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,c,d){lf(e,r,s,c,d,4)}setPixel(e,r,s){const c=4*(e*this.width+r);this.data[c+0]=Math.round(255*s.r/s.a),this.data[c+1]=Math.round(255*s.g/s.a),this.data[c+2]=Math.round(255*s.b/s.a),this.data[c+3]=Math.round(255*s.a)}}function hm(i){const e={},r=i.resolution||256,s=i.clips?i.clips.length:1,c=i.image||new ma({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const d=(f,y,S)=>{e[i.evaluationKey]=S;const A=i.expression.evaluate(e);c.setPixel(f/4/r,y/4,A)};if(i.clips)for(let f=0,y=0;f<s;++f,y+=4*r)for(let S=0,A=0;S<r;S++,A+=4){const k=S/(r-1),{start:N,end:V}=i.clips[f];d(y,A,N*(1-k)+V*k)}else for(let f=0,y=0;f<r;f++,y+=4)d(0,y,f/(r-1));return c}ke("AlphaImage",yh),ke("RGBAImage",ma);const cf="big-fb";class _1 extends li{createBucket(e){return new lm(e)}constructor(e,r){super(e,g1,r),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=hm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(cf)&&this.heatmapFbos.delete(cf)}queryRadius(e){return zu("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:s,geometry:c,transform:d,pixelsToTileUnits:f,unwrappedTileID:y,getElevation:S}){return sm({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(r,s)*f,transform:d,unwrappedTileID:y,getElevation:S},c)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let dm;var y1={get paint(){return dm=dm||new Di({"hillshade-illumination-direction":new cr(ae.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new cr(ae.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new cr(ae.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new cr(ae.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new cr(ae.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new cr(ae.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new cr(ae.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new cr(ae.paint_hillshade["hillshade-method"])})}};class v1 extends li{constructor(e,r){super(e,y1,r),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,s=this.paint.get("hillshade-highlight-color").values,c=this.paint.get("hillshade-shadow-color").values;const d=Math.max(e.length,r.length,s.length,c.length);e=e.concat(Array(d-e.length).fill(e.at(-1))),r=r.concat(Array(d-r.length).fill(r.at(-1))),s=s.concat(Array(d-s.length).fill(s.at(-1))),c=c.concat(Array(d-c.length).fill(c.at(-1)));const f=r.map(ai);return{directionRadians:e.map(ai),altitudeRadians:f,shadowColor:c,highlightColor:s}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let fm;var b1={get paint(){return fm=fm||new Di({"color-relief-opacity":new cr(ae["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new zi(ae["paint_color-relief"]["color-relief-color"])})}};class uf{constructor(e,r,s,c){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(r,c)}update(e,r,s){const{width:c,height:d}=e,f=!(this.size&&this.size[0]===c&&this.size[1]===d||s),{context:y}=this,{gl:S}=y;if(this.useMipmap=!!(r&&r.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!r||r.premultiply!==!1)),f)this.size=[c,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Tr(e)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,e):S.texImage2D(S.TEXTURE_2D,0,this.format,c,d,0,this.format,S.UNSIGNED_BYTE,e.data);else{const{x:A,y:k}=s||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Tr(e)?S.texSubImage2D(S.TEXTURE_2D,0,A,k,S.RGBA,S.UNSIGNED_BYTE,e):S.texSubImage2D(S.TEXTURE_2D,0,A,k,c,d,S.RGBA,S.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D),y.pixelStoreUnpackFlipY.setDefault(),y.pixelStoreUnpack.setDefault(),y.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,r,s){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),s!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(s=d.LINEAR),e!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,s||e),this.filter=e),r!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,r),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class pm{constructor(e,r,s,c=1,d=1,f=1,y=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&!["mapbox","terrarium","custom"].includes(s))return void Ft(`"${s}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const S=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),s){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=d,this.blueFactor=f,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let A=0;A<S;A++)this.data[this._idx(-1,A)]=this.data[this._idx(0,A)],this.data[this._idx(S,A)]=this.data[this._idx(S-1,A)],this.data[this._idx(A,-1)]=this.data[this._idx(A,0)],this.data[this._idx(A,S)]=this.data[this._idx(A,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let A=0;A<S;A++)for(let k=0;k<S;k++){const N=this.get(A,k);N>this.max&&(this.max=N),N<this.min&&(this.min=N)}}get(e,r){const s=new Uint8Array(this.data.buffer),c=4*this._idx(e,r);return this.unpack(s[c],s[c+1],s[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}unpack(e,r,s){return e*this.redFactor+r*this.greenFactor+s*this.blueFactor-this.baseShift}pack(e){return mm(e,this.getUnpackVector())}getPixels(){return new ma({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=r*this.dim,d=r*this.dim+this.dim,f=s*this.dim,y=s*this.dim+this.dim;switch(r){case-1:c=d-1;break;case 1:d=c+1}switch(s){case-1:f=y-1;break;case 1:y=f+1}const S=-r*this.dim,A=-s*this.dim;for(let k=f;k<y;k++)for(let N=c;N<d;N++)this.data[this._idx(N,k)]=e.data[this._idx(N+S,k+A)]}}function mm(i,e){const r=e[0],s=e[1],c=e[2],d=e[3],f=Math.min(r,s,c),y=Math.round((i+d)/f);return{r:Math.floor(y*f/r)%256,g:Math.floor(y*f/s)%256,b:Math.floor(y*f/c)%256}}ke("DEMData",pm);class x1 extends li{constructor(e,r){super(e,b1,r)}_createColorRamp(e){const r={elevationStops:[],colorStops:[]},s=this._transitionablePaint._values["color-relief-color"].value.expression;if(s instanceof Tc&&s._styleExpression.expression instanceof Mr){this.colorRampExpression=s;const f=s._styleExpression.expression;r.elevationStops=f.labels,r.colorStops=[];for(const y of r.elevationStops)r.colorStops.push(f.evaluate({globals:{elevation:y}}))}if(r.elevationStops.length<1&&(r.elevationStops=[0],r.colorStops=[Wr.transparent]),r.elevationStops.length<2&&(r.elevationStops.push(r.elevationStops[0]+1),r.colorStops.push(r.colorStops[0])),r.elevationStops.length<=e)return r;const c={elevationStops:[],colorStops:[]},d=(r.elevationStops.length-1)/(e-1);for(let f=0;f<r.elevationStops.length-.5;f+=d)c.elevationStops.push(r.elevationStops[Math.round(f)]),c.colorStops.push(r.colorStops[Math.round(f)]);return Ft(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${r.elevationStops.length}`),c}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,r,s){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const c=this._createColorRamp(r),d=new ma({width:c.colorStops.length,height:1}),f=new ma({width:c.colorStops.length,height:1});for(let y=0;y<c.elevationStops.length;y++){const S=mm(c.elevationStops[y],s);f.setPixel(0,y,new Wr(S.r/255,S.g/255,S.b/255,1)),d.setPixel(0,y,c.colorStops[y])}return this.colorRampTextures={elevationTexture:new uf(e,f,e.gl.RGBA),colorTexture:new uf(e,d,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const w1=_i([{name:"a_pos",components:2,type:"Int16"}],4),{members:S1}=w1;function rd(i,e,r){const s=r.patternDependencies;let c=!1;for(const d of e){const f=d.paint.get(`${i}-pattern`);f.isConstant()||(c=!0);const y=f.constantOr(null);y&&(c=!0,s[y.to]=!0,s[y.from]=!0)}return c}function hf(i,e,r,s,c){const{zoom:d}=s,f=c.patternDependencies;for(const y of e){const S=y.paint.get(`${i}-pattern`).value;if(S.kind!=="constant"){let A=S.evaluate({zoom:d-1},r,{},c.availableImages),k=S.evaluate({zoom:d},r,{},c.availableImages),N=S.evaluate({zoom:d+1},r,{},c.availableImages);A=A&&A.name?A.name:A,k=k&&k.name?k.name:k,N=N&&N.name?N.name:N,f[A]=!0,f[k]=!0,f[N]=!0,r.patterns[y.id]={min:A,mid:k,max:N}}}return r}function gm(i,e,r,s,c){let d;if(c===function(f,y,S,A){let k=0;for(let N=y,V=S-A;N<S;N+=A)k+=(f[V]-f[N])*(f[N+1]+f[V+1]),V=N;return k}(i,e,r,s)>0)for(let f=e;f<r;f+=s)d=bm(f/s|0,i[f],i[f+1],d);else for(let f=r-s;f>=e;f-=s)d=bm(f/s|0,i[f],i[f+1],d);return d&&Nu(d,d.next)&&(wh(d),d=d.next),d}function hu(i,e){if(!i)return i;e||(e=i);let r,s=i;do if(r=!1,s.steiner||!Nu(s,s.next)&&En(s.prev,s,s.next)!==0)s=s.next;else{if(wh(s),s=e=s.prev,s===s.next)break;r=!0}while(r||s!==e);return e}function vh(i,e,r,s,c,d,f){if(!i)return;!f&&d&&function(S,A,k,N){let V=S;do V.z===0&&(V.z=df(V.x,V.y,A,k,N)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==S);V.prevZ.nextZ=null,V.prevZ=null,function(q){let W,H=1;do{let J,ue=q;q=null;let Ne=null;for(W=0;ue;){W++;let de=ue,ye=0;for(let Ke=0;Ke<H&&(ye++,de=de.nextZ,de);Ke++);let je=H;for(;ye>0||je>0&&de;)ye!==0&&(je===0||!de||ue.z<=de.z)?(J=ue,ue=ue.nextZ,ye--):(J=de,de=de.nextZ,je--),Ne?Ne.nextZ=J:q=J,J.prevZ=Ne,Ne=J;ue=de}Ne.nextZ=null,H*=2}while(W>1)}(V)}(i,s,c,d);let y=i;for(;i.prev!==i.next;){const S=i.prev,A=i.next;if(d?P1(i,s,c,d):T1(i))e.push(S.i,i.i,A.i),wh(i),i=A.next,y=A.next;else if((i=A)===y){f?f===1?vh(i=A1(hu(i),e),e,r,s,c,d,2):f===2&&I1(i,e,r,s,c,d):vh(hu(i),e,r,s,c,d,1);break}}}function T1(i){const e=i.prev,r=i,s=i.next;if(En(e,r,s)>=0)return!1;const c=e.x,d=r.x,f=s.x,y=e.y,S=r.y,A=s.y,k=Math.min(c,d,f),N=Math.min(y,S,A),V=Math.max(c,d,f),q=Math.max(y,S,A);let W=s.next;for(;W!==e;){if(W.x>=k&&W.x<=V&&W.y>=N&&W.y<=q&&bh(c,y,d,S,f,A,W.x,W.y)&&En(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function P1(i,e,r,s){const c=i.prev,d=i,f=i.next;if(En(c,d,f)>=0)return!1;const y=c.x,S=d.x,A=f.x,k=c.y,N=d.y,V=f.y,q=Math.min(y,S,A),W=Math.min(k,N,V),H=Math.max(y,S,A),J=Math.max(k,N,V),ue=df(q,W,e,r,s),Ne=df(H,J,e,r,s);let de=i.prevZ,ye=i.nextZ;for(;de&&de.z>=ue&&ye&&ye.z<=Ne;){if(de.x>=q&&de.x<=H&&de.y>=W&&de.y<=J&&de!==c&&de!==f&&bh(y,k,S,N,A,V,de.x,de.y)&&En(de.prev,de,de.next)>=0||(de=de.prevZ,ye.x>=q&&ye.x<=H&&ye.y>=W&&ye.y<=J&&ye!==c&&ye!==f&&bh(y,k,S,N,A,V,ye.x,ye.y)&&En(ye.prev,ye,ye.next)>=0))return!1;ye=ye.nextZ}for(;de&&de.z>=ue;){if(de.x>=q&&de.x<=H&&de.y>=W&&de.y<=J&&de!==c&&de!==f&&bh(y,k,S,N,A,V,de.x,de.y)&&En(de.prev,de,de.next)>=0)return!1;de=de.prevZ}for(;ye&&ye.z<=Ne;){if(ye.x>=q&&ye.x<=H&&ye.y>=W&&ye.y<=J&&ye!==c&&ye!==f&&bh(y,k,S,N,A,V,ye.x,ye.y)&&En(ye.prev,ye,ye.next)>=0)return!1;ye=ye.nextZ}return!0}function A1(i,e){let r=i;do{const s=r.prev,c=r.next.next;!Nu(s,c)&&ym(s,r,r.next,c)&&xh(s,c)&&xh(c,s)&&(e.push(s.i,r.i,c.i),wh(r),wh(r.next),r=i=c),r=r.next}while(r!==i);return hu(r)}function I1(i,e,r,s,c,d){let f=i;do{let y=f.next.next;for(;y!==f.prev;){if(f.i!==y.i&&k1(f,y)){let S=vm(f,y);return f=hu(f,f.next),S=hu(S,S.next),vh(f,e,r,s,c,d,0),void vh(S,e,r,s,c,d,0)}y=y.next}f=f.next}while(f!==i)}function E1(i,e){let r=i.x-e.x;return r===0&&(r=i.y-e.y,r===0)&&(r=(i.next.y-i.y)/(i.next.x-i.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function L1(i,e){const r=function(c,d){let f=d;const y=c.x,S=c.y;let A,k=-1/0;if(Nu(c,f))return f;do{if(Nu(c,f.next))return f.next;if(S<=f.y&&S>=f.next.y&&f.next.y!==f.y){const H=f.x+(S-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(H<=y&&H>k&&(k=H,A=f.x<f.next.x?f:f.next,H===y))return A}f=f.next}while(f!==d);if(!A)return null;const N=A,V=A.x,q=A.y;let W=1/0;f=A;do{if(y>=f.x&&f.x>=V&&y!==f.x&&_m(S<q?y:k,S,V,q,S<q?k:y,S,f.x,f.y)){const H=Math.abs(S-f.y)/(y-f.x);xh(f,c)&&(H<W||H===W&&(f.x>A.x||f.x===A.x&&M1(A,f)))&&(A=f,W=H)}f=f.next}while(f!==N);return A}(i,e);if(!r)return e;const s=vm(r,i);return hu(s,s.next),hu(r,r.next)}function M1(i,e){return En(i.prev,i,e.prev)<0&&En(e.next,i,i.next)<0}function df(i,e,r,s,c){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*c|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function C1(i){let e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function _m(i,e,r,s,c,d,f,y){return(c-f)*(e-y)>=(i-f)*(d-y)&&(i-f)*(s-y)>=(r-f)*(e-y)&&(r-f)*(d-y)>=(c-f)*(s-y)}function bh(i,e,r,s,c,d,f,y){return!(i===f&&e===y)&&_m(i,e,r,s,c,d,f,y)}function k1(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,s){let c=r;do{if(c.i!==r.i&&c.next.i!==r.i&&c.i!==s.i&&c.next.i!==s.i&&ym(c,c.next,r,s))return!0;c=c.next}while(c!==r);return!1}(i,e)&&(xh(i,e)&&xh(e,i)&&function(r,s){let c=r,d=!1;const f=(r.x+s.x)/2,y=(r.y+s.y)/2;do c.y>y!=c.next.y>y&&c.next.y!==c.y&&f<(c.next.x-c.x)*(y-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==r);return d}(i,e)&&(En(i.prev,i,e.prev)||En(i,e.prev,e))||Nu(i,e)&&En(i.prev,i,i.next)>0&&En(e.prev,e,e.next)>0)}function En(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Nu(i,e){return i.x===e.x&&i.y===e.y}function ym(i,e,r,s){const c=nd(En(i,e,r)),d=nd(En(i,e,s)),f=nd(En(r,s,i)),y=nd(En(r,s,e));return c!==d&&f!==y||!(c!==0||!id(i,r,e))||!(d!==0||!id(i,s,e))||!(f!==0||!id(r,i,s))||!(y!==0||!id(r,e,s))}function id(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function nd(i){return i>0?1:i<0?-1:0}function xh(i,e){return En(i.prev,i,i.next)<0?En(i,e,i.next)>=0&&En(i,i.prev,e)>=0:En(i,e,i.prev)<0||En(i,i.next,e)<0}function vm(i,e){const r=ff(i.i,i.x,i.y),s=ff(e.i,e.x,e.y),c=i.next,d=e.prev;return i.next=e,e.prev=i,r.next=c,c.prev=r,s.next=r,r.prev=s,d.next=s,s.prev=d,s}function bm(i,e,r,s){const c=ff(i,e,r);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function wh(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function ff(i,e,r){return{i,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Ou{constructor(e,r){if(r>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=r}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class sd{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}sd.noSubdivision=new sd({fill:new Ou(0,0),line:new Ou(0,0),tile:new Ou(0,0),stencil:new Ou(0,0),circle:1}),ke("SubdivisionGranularityExpression",Ou),ke("SubdivisionGranularitySetting",sd);const Bu=-32768,Sh=32767;class D1{constructor(e,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=vt/e,this._canonical=r}_getKey(e,r){return(e+=32768)<<16|r+32768}_vertexToIndex(e,r){if(e<-32768||r<-32768||e>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const s=0|Math.round(e),c=0|Math.round(r),d=this._getKey(s,c);if(this._vertexDictionary.has(d))return this._vertexDictionary.get(d);const f=this._vertexBuffer.length/2;return this._vertexDictionary.set(d,f),this._vertexBuffer.push(s,c),f}_subdivideTrianglesScanline(e){if(this._granularity<2)return function(c,d){const f=[];for(let y=0;y<d.length;y+=3){const S=d[y],A=d[y+1],k=d[y+2],N=c[2*S],V=c[2*S+1];(c[2*A]-N)*(c[2*k+1]-V)-(c[2*A+1]-V)*(c[2*k]-N)>0?(f.push(S),f.push(k),f.push(A)):(f.push(S),f.push(A),f.push(k))}return f}(this._vertexBuffer,e);const r=[],s=e.length;for(let c=0;c<s;c+=3){const d=[e[c+0],e[c+1],e[c+2]],f=[this._vertexBuffer[2*e[c+0]+0],this._vertexBuffer[2*e[c+0]+1],this._vertexBuffer[2*e[c+1]+0],this._vertexBuffer[2*e[c+1]+1],this._vertexBuffer[2*e[c+2]+0],this._vertexBuffer[2*e[c+2]+1]];let y=1/0,S=1/0,A=-1/0,k=-1/0;for(let H=0;H<3;H++){const J=f[2*H],ue=f[2*H+1];y=Math.min(y,J),A=Math.max(A,J),S=Math.min(S,ue),k=Math.max(k,ue)}if(y===A||S===k)continue;const N=Math.floor(y/this._granularityCellSize),V=Math.ceil(A/this._granularityCellSize),q=Math.floor(S/this._granularityCellSize),W=Math.ceil(k/this._granularityCellSize);if(N!==V||q!==W)for(let H=q;H<W;H++){const J=this._scanlineGenerateVertexRingForCellRow(H,f,d);F1(this._vertexBuffer,J,r)}else r.push(...d)}return r}_scanlineGenerateVertexRingForCellRow(e,r,s){const c=e*this._granularityCellSize,d=c+this._granularityCellSize,f=[];for(let y=0;y<3;y++){const S=r[2*y],A=r[2*y+1],k=r[2*(y+1)%6],N=r[(2*(y+1)+1)%6],V=r[2*(y+2)%6],q=r[(2*(y+2)+1)%6],W=k-S,H=N-A,J=W===0,ue=H===0,Ne=(c-A)/H,de=(d-A)/H,ye=Math.min(Ne,de),je=Math.max(Ne,de);if(!ue&&(ye>=1||je<=0)||ue&&(A<c||A>d)){N>=c&&N<=d&&f.push(s[(y+1)%3]);continue}!ue&&ye>0&&f.push(this._vertexToIndex(S+W*ye,A+H*ye));const Ke=S+W*Math.max(ye,0),xt=S+W*Math.min(je,1);J||this._generateIntraEdgeVertices(f,S,A,k,N,Ke,xt),!ue&&je<1&&f.push(this._vertexToIndex(S+W*je,A+H*je)),(ue||N>=c&&N<=d)&&f.push(s[(y+1)%3]),!ue&&(N<=c||N>=d)&&this._generateInterEdgeVertices(f,S,A,k,N,V,q,xt,c,d)}return f}_generateIntraEdgeVertices(e,r,s,c,d,f,y){const S=c-r,A=d-s,k=A===0,N=k?Math.min(r,c):Math.min(f,y),V=k?Math.max(r,c):Math.max(f,y),q=Math.floor(N/this._granularityCellSize)+1,W=Math.ceil(V/this._granularityCellSize)-1;if(k?r<c:f<y)for(let H=q;H<=W;H++){const J=H*this._granularityCellSize;e.push(this._vertexToIndex(J,s+A*(J-r)/S))}else for(let H=W;H>=q;H--){const J=H*this._granularityCellSize;e.push(this._vertexToIndex(J,s+A*(J-r)/S))}}_generateInterEdgeVertices(e,r,s,c,d,f,y,S,A,k){const N=d-s,V=f-c,q=y-d,W=(A-d)/q,H=(k-d)/q,J=Math.min(W,H),ue=Math.max(W,H),Ne=c+V*J;let de=Math.floor(Math.min(Ne,S)/this._granularityCellSize)+1,ye=Math.ceil(Math.max(Ne,S)/this._granularityCellSize)-1,je=S<Ne;const Ke=q===0;if(Ke&&(y===A||y===k))return;if(Ke||J>=1||ue<=0){const Vt=s-y,zt=f+(r-f)*Math.min((A-y)/Vt,(k-y)/Vt);de=Math.floor(Math.min(zt,S)/this._granularityCellSize)+1,ye=Math.ceil(Math.max(zt,S)/this._granularityCellSize)-1,je=S<zt}const xt=N>0?k:A;if(je)for(let Vt=de;Vt<=ye;Vt++)e.push(this._vertexToIndex(Vt*this._granularityCellSize,xt));else for(let Vt=ye;Vt>=de;Vt--)e.push(this._vertexToIndex(Vt*this._granularityCellSize,xt))}_generateOutline(e){const r=[];for(const s of e){const c=du(s,this._granularity,!0),d=this._pointArrayToIndices(c),f=[];for(let y=1;y<d.length;y++)f.push(d[y-1]),f.push(d[y]);r.push(f)}return r}_handlePoles(e){let r=!1,s=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(s=!0)),(r||s)&&this._fillPoles(e,r,s)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let r=0;r<e.length;r+=2){const s=e[r+1];s===Bu&&(e[r+1]=-32767),s===Sh&&(e[r+1]=32766)}}_generatePoleQuad(e,r,s,c,d,f){c>d!=(f===Bu)?(e.push(r),e.push(s),e.push(this._vertexToIndex(c,f)),e.push(s),e.push(this._vertexToIndex(d,f)),e.push(this._vertexToIndex(c,f))):(e.push(s),e.push(r),e.push(this._vertexToIndex(c,f)),e.push(this._vertexToIndex(d,f)),e.push(s),e.push(this._vertexToIndex(c,f)))}_fillPoles(e,r,s){const c=this._vertexBuffer,d=vt,f=e.length;for(let y=2;y<f;y+=3){const S=e[y-2],A=e[y-1],k=e[y],N=c[2*S],V=c[2*S+1],q=c[2*A],W=c[2*A+1],H=c[2*k],J=c[2*k+1];r&&(V===0&&W===0&&this._generatePoleQuad(e,S,A,N,q,Bu),W===0&&J===0&&this._generatePoleQuad(e,A,k,q,H,Bu),J===0&&V===0&&this._generatePoleQuad(e,k,S,H,N,Bu)),s&&(V===d&&W===d&&this._generatePoleQuad(e,S,A,N,q,Sh),W===d&&J===d&&this._generatePoleQuad(e,A,k,q,H,Sh),J===d&&V===d&&this._generatePoleQuad(e,k,S,H,N,Sh))}}_initializeVertices(e){for(let r=0;r<e.length;r+=2)this._vertexToIndex(e[r],e[r+1])}subdividePolygonInternal(e,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:s,holeIndices:c}=function(y){const S=[],A=[];for(const k of y)if(k.length!==0){k!==y[0]&&S.push(A.length/2);for(let N=0;N<k.length;N++)A.push(k[N].x),A.push(k[N].y)}return{flattened:A,holeIndices:S}}(e);let d;this._initializeVertices(s);try{const y=function(A,k,N=2){const V=k&&k.length,q=V?k[0]*N:A.length;let W=gm(A,0,q,N,!0);const H=[];if(!W||W.next===W.prev)return H;let J,ue,Ne;if(V&&(W=function(de,ye,je,Ke){const xt=[];for(let Vt=0,zt=ye.length;Vt<zt;Vt++){const Xt=gm(de,ye[Vt]*Ke,Vt<zt-1?ye[Vt+1]*Ke:de.length,Ke,!1);Xt===Xt.next&&(Xt.steiner=!0),xt.push(C1(Xt))}xt.sort(E1);for(let Vt=0;Vt<xt.length;Vt++)je=L1(xt[Vt],je);return je}(A,k,W,N)),A.length>80*N){J=A[0],ue=A[1];let de=J,ye=ue;for(let je=N;je<q;je+=N){const Ke=A[je],xt=A[je+1];Ke<J&&(J=Ke),xt<ue&&(ue=xt),Ke>de&&(de=Ke),xt>ye&&(ye=xt)}Ne=Math.max(de-J,ye-ue),Ne=Ne!==0?32767/Ne:0}return vh(W,H,N,J,ue,Ne,0),H}(s,c),S=this._convertIndices(s,y);d=this._subdivideTrianglesScanline(S)}catch(y){console.error(y)}let f=[];return r&&(f=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(d),{verticesFlattened:this._vertexBuffer,indicesTriangles:d,indicesLineList:f}}_convertIndices(e,r){const s=[];for(let c=0;c<r.length;c++)s.push(this._vertexToIndex(e[2*r[c]],e[2*r[c]+1]));return s}_pointArrayToIndices(e){const r=[];for(let s=0;s<e.length;s++){const c=e[s];r.push(this._vertexToIndex(c.x,c.y))}return r}}function xm(i,e,r,s=!0){return new D1(r,e).subdividePolygonInternal(i,s)}function du(i,e,r=!1){if(!i||i.length<1)return[];if(i.length<2)return[];const s=i[0],c=i[i.length-1],d=r&&(s.x!==c.x||s.y!==c.y);if(e<2)return d?[...i,i[0]]:[...i];const f=Math.floor(vt/e),y=[];y.push(new C(i[0].x,i[0].y));const S=i.length,A=d?S:S-1;for(let k=0;k<A;k++){const N=i[k],V=k<S-1?i[k+1]:i[0],q=N.x,W=N.y,H=V.x,J=V.y,ue=q!==H,Ne=W!==J;if(!ue&&!Ne)continue;const de=H-q,ye=J-W,je=Math.abs(de),Ke=Math.abs(ye);let xt=q,Vt=W;for(;;){const Xt=de>0?(Math.floor(xt/f)+1)*f:(Math.ceil(xt/f)-1)*f,lr=ye>0?(Math.floor(Vt/f)+1)*f:(Math.ceil(Vt/f)-1)*f,Kt=Math.abs(xt-Xt),jt=Math.abs(Vt-lr),Et=Math.abs(xt-H),yr=Math.abs(Vt-J),pr=ue?Kt/je:Number.POSITIVE_INFINITY,vr=Ne?jt/Ke:Number.POSITIVE_INFINITY;if((Et<=Kt||!ue)&&(yr<=jt||!Ne))break;if(pr<vr&&ue||!Ne){xt=Xt,Vt+=ye*pr;const dr=new C(xt,Math.round(Vt));y[y.length-1].x===dr.x&&y[y.length-1].y===dr.y||y.push(dr)}else{xt+=de*vr,Vt=lr;const dr=new C(Math.round(xt),Vt);y[y.length-1].x===dr.x&&y[y.length-1].y===dr.y||y.push(dr)}}const zt=new C(H,J);y[y.length-1].x===zt.x&&y[y.length-1].y===zt.y||y.push(zt)}return y}function F1(i,e,r){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let s=0,c=i[2*e[0]];for(let S=1;S<e.length;S++){const A=i[2*e[S]];A<c&&(c=A,s=S)}const d=e.length;let f=s,y=(f+1)%d;for(;;){const S=f-1>=0?f-1:d-1,A=(y+1)%d,k=i[2*e[S]],N=i[2*e[A]],V=i[2*e[f]],q=i[2*e[f]+1],W=i[2*e[y]+1];let H=!1;if(k<N)H=!0;else if(k>N)H=!1;else{const J=W-q,ue=-(i[2*e[y]]-V),Ne=q<W?1:-1;((k-V)*J+(i[2*e[S]+1]-q)*ue)*Ne>((N-V)*J+(i[2*e[A]+1]-q)*ue)*Ne&&(H=!0)}if(H){const J=e[S],ue=e[f],Ne=e[y];J!==ue&&J!==Ne&&ue!==Ne&&r.push(Ne,ue,J),f--,f<0&&(f=d-1)}else{const J=e[A],ue=e[f],Ne=e[y];J!==ue&&J!==Ne&&ue!==Ne&&r.push(Ne,ue,J),y++,y>=d&&(y=0)}if(S===A)break}}function wm(i,e,r,s,c,d,f,y,S){const A=c.length/2,k=f&&y&&S;if(A<Jt.MAX_VERTEX_ARRAY_LENGTH){const N=e.prepareSegment(A,r,s),V=N.vertexLength;for(let H=0;H<d.length;H+=3)s.emplaceBack(V+d[H],V+d[H+1],V+d[H+2]);let q,W;N.vertexLength+=A,N.primitiveLength+=d.length/3,k&&(W=f.prepareSegment(A,r,y),q=W.vertexLength,W.vertexLength+=A);for(let H=0;H<c.length;H+=2)i(c[H],c[H+1]);if(k)for(let H=0;H<S.length;H++){const J=S[H];for(let ue=1;ue<J.length;ue+=2)y.emplaceBack(q+J[ue-1],q+J[ue]);W.primitiveLength+=J.length/2}}else(function(N,V,q,W,H,J){const ue=[];for(let Ke=0;Ke<W.length/2;Ke++)ue.push(-1);const Ne={count:0};let de=0,ye=N.getOrCreateLatestSegment(V,q),je=ye.vertexLength;for(let Ke=2;Ke<H.length;Ke+=3){const xt=H[Ke-2],Vt=H[Ke-1],zt=H[Ke];let Xt=ue[xt]<de,lr=ue[Vt]<de,Kt=ue[zt]<de;ye.vertexLength+((Xt?1:0)+(lr?1:0)+(Kt?1:0))>Jt.MAX_VERTEX_ARRAY_LENGTH&&(ye=N.createNewSegment(V,q),de=Ne.count,Xt=!0,lr=!0,Kt=!0,je=0);const jt=Th(ue,W,J,Ne,xt,Xt,ye),Et=Th(ue,W,J,Ne,Vt,lr,ye),yr=Th(ue,W,J,Ne,zt,Kt,ye);q.emplaceBack(je+jt-de,je+Et-de,je+yr-de),ye.primitiveLength++}})(e,r,s,c,d,i),k&&function(N,V,q,W,H,J){const ue=[];for(let Ke=0;Ke<W.length/2;Ke++)ue.push(-1);const Ne={count:0};let de=0,ye=N.getOrCreateLatestSegment(V,q),je=ye.vertexLength;for(let Ke=0;Ke<H.length;Ke++){const xt=H[Ke];for(let Vt=1;Vt<H[Ke].length;Vt+=2){const zt=xt[Vt-1],Xt=xt[Vt];let lr=ue[zt]<de,Kt=ue[Xt]<de;ye.vertexLength+((lr?1:0)+(Kt?1:0))>Jt.MAX_VERTEX_ARRAY_LENGTH&&(ye=N.createNewSegment(V,q),de=Ne.count,lr=!0,Kt=!0,je=0);const jt=Th(ue,W,J,Ne,zt,lr,ye),Et=Th(ue,W,J,Ne,Xt,Kt,ye);q.emplaceBack(je+jt-de,je+Et-de),ye.primitiveLength++}}}(f,r,y,c,S,i),e.forceNewSegmentOnNextPrepare(),f?.forceNewSegmentOnNextPrepare()}function Th(i,e,r,s,c,d,f){if(d){const y=s.count;return r(e[2*c],e[2*c+1]),i[c]=s.count,s.count++,f.vertexLength++,y}return i[c]}class pf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new oe,this.indexArray=new Tt,this.indexArray2=new bt,this.programConfigurations=new cn(e.layers,e.zoom),this.segments=new Jt,this.segments2=new Jt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasDependencies=rd("fill",this.layers,r);const c=this.layers[0].layout.get("fill-sort-key"),d=!c.isConstant(),f=[];for(const{feature:y,id:S,index:A,sourceLayerIndex:k}of e){const N=this.layers[0]._featureFilter.needGeometry,V=uc(y,N);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),V,s))continue;const q=d?c.evaluate(V,{},s,r.availableImages):void 0,W={id:S,properties:y.properties,type:y.type,sourceLayerIndex:k,index:A,geometry:N?V.geometry:cc(y),patterns:{},sortKey:q};f.push(W)}d&&f.sort((y,S)=>y.sortKey-S.sortKey);for(const y of f){const{geometry:S,index:A,sourceLayerIndex:k}=y;if(this.hasDependencies){const N=hf("fill",this.layers,y,{zoom:this.zoom},r);this.patternFeatures.push(N)}else this.addFeature(y,S,A,s,{},r.subdivisionGranularity);r.featureIndex.insert(e[A].feature,S,A,k,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:s})}addFeatures(e,r,s){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,s,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,S1),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,c,d,f){for(const y of yl(r,500)){const S=xm(y,c,f.fill.getGranularityForZoomLevel(c.z)),A=this.layoutVertexArray;wm((k,N)=>{A.emplaceBack(k,N)},this.segments,this.layoutVertexArray,this.indexArray,S.verticesFlattened,S.indicesTriangles,this.segments2,this.indexArray2,S.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{imagePositions:d,canonical:c})}}let Sm,Tm;ke("FillBucket",pf,{omit:["layers","patternFeatures"]});var R1={get paint(){return Tm=Tm||new Di({"fill-antialias":new cr(ae.paint_fill["fill-antialias"]),"fill-opacity":new hr(ae.paint_fill["fill-opacity"]),"fill-color":new hr(ae.paint_fill["fill-color"]),"fill-outline-color":new hr(ae.paint_fill["fill-outline-color"]),"fill-translate":new cr(ae.paint_fill["fill-translate"]),"fill-translate-anchor":new cr(ae.paint_fill["fill-translate-anchor"]),"fill-pattern":new ln(ae.paint_fill["fill-pattern"])})},get layout(){return Sm=Sm||new Di({"fill-sort-key":new hr(ae.layout_fill["fill-sort-key"])})}};class z1 extends li{constructor(e,r){super(e,R1,r)}recalculate(e,r){super.recalculate(e,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new pf(e)}queryRadius(){return ed(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:r,transform:s,pixelsToTileUnits:c}){return gh(td(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-s.bearingInRadians,c),r)}isTileClipped(){return!0}}const N1=_i([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),O1=_i([{name:"a_centroid",components:2,type:"Int16"}],4),{members:B1}=N1;class Ph{constructor(e,r,s,c,d){this.properties={},this.extent=s,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=c,this._values=d,e.readFields(j1,this,r)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos,s=[];let c,d=1,f=0,y=0,S=0;for(;e.pos<r;){if(f<=0){const A=e.readVarint();d=7&A,f=A>>3}if(f--,d===1||d===2)y+=e.readSVarint(),S+=e.readSVarint(),d===1&&(c&&s.push(c),c=[]),c&&c.push(new C(y,S));else{if(d!==7)throw new Error(`unknown command ${d}`);c&&c.push(c[0].clone())}}return c&&s.push(c),s}bbox(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos;let s=1,c=0,d=0,f=0,y=1/0,S=-1/0,A=1/0,k=-1/0;for(;e.pos<r;){if(c<=0){const N=e.readVarint();s=7&N,c=N>>3}if(c--,s===1||s===2)d+=e.readSVarint(),f+=e.readSVarint(),d<y&&(y=d),d>S&&(S=d),f<A&&(A=f),f>k&&(k=f);else if(s!==7)throw new Error(`unknown command ${s}`)}return[y,A,S,k]}toGeoJSON(e,r,s){const c=this.extent*Math.pow(2,s),d=this.extent*e,f=this.extent*r,y=this.loadGeometry();function S(V){return[360*(V.x+d)/c-180,360/Math.PI*Math.atan(Math.exp((1-2*(V.y+f)/c)*Math.PI))-90]}function A(V){return V.map(S)}let k;if(this.type===1){const V=[];for(const W of y)V.push(W[0]);const q=A(V);k=V.length===1?{type:"Point",coordinates:q[0]}:{type:"MultiPoint",coordinates:q}}else if(this.type===2){const V=y.map(A);k=V.length===1?{type:"LineString",coordinates:V[0]}:{type:"MultiLineString",coordinates:V}}else{if(this.type!==3)throw new Error("unknown feature type");{const V=Pm(y),q=[];for(const W of V)q.push(W.map(A));k=q.length===1?{type:"Polygon",coordinates:q[0]}:{type:"MultiPolygon",coordinates:q}}}const N={type:"Feature",geometry:k,properties:this.properties};return this.id!=null&&(N.id=this.id),N}}function j1(i,e,r){i===1?e.id=r.readVarint():i===2?function(s,c){const d=s.readVarint()+s.pos;for(;s.pos<d;){const f=c._keys[s.readVarint()],y=c._values[s.readVarint()];c.properties[f]=y}}(r,e):i===3?e.type=r.readVarint():i===4&&(e._geometry=r.pos)}function Pm(i){const e=i.length;if(e<=1)return[i];const r=[];let s,c;for(let d=0;d<e;d++){const f=U1(i[d]);f!==0&&(c===void 0&&(c=f<0),c===f<0?(s&&r.push(s),s=[i[d]]):s&&s.push(i[d]))}return s&&r.push(s),r}function U1(i){let e=0;for(let r,s,c=0,d=i.length,f=d-1;c<d;f=c++)r=i[c],s=i[f],e+=(s.x-r.x)*(r.y+s.y);return e}Ph.types=["Unknown","Point","LineString","Polygon"];class V1{constructor(e,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(q1,this,r),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const r=this._pbf.readVarint()+this._pbf.pos;return new Ph(this._pbf,r,this.extent,this._keys,this._values)}}function q1(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(s){let c=null;const d=s.readVarint()+s.pos;for(;s.pos<d;){const f=s.readVarint()>>3;c=f===1?s.readString():f===2?s.readFloat():f===3?s.readDouble():f===4?s.readVarint64():f===5?s.readVarint():f===6?s.readSVarint():f===7?s.readBoolean():null}if(c==null)throw new Error("unknown feature value");return c}(r))}class Am{constructor(e,r){this.layers=e.readFields(G1,{},r)}}function G1(i,e,r){if(i===3){const s=new V1(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}const mf=Math.pow(2,13);function Ah(i,e,r,s,c,d,f,y){i.emplaceBack(e,r,2*Math.floor(s*mf)+f,c*mf*2,d*mf*2,Math.round(y))}class gf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new ve,this.centroidVertexArray=new G,this.indexArray=new Tt,this.programConfigurations=new cn(e.layers,e.zoom),this.segments=new Jt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.features=[],this.hasDependencies=rd("fill-extrusion",this.layers,r);for(const{feature:c,id:d,index:f,sourceLayerIndex:y}of e){const S=this.layers[0]._featureFilter.needGeometry,A=uc(c,S);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),A,s))continue;const k={id:d,sourceLayerIndex:y,index:f,geometry:S?A.geometry:cc(c),properties:c.properties,type:c.type,patterns:{}};this.hasDependencies?this.features.push(hf("fill-extrusion",this.layers,k,{zoom:this.zoom},r)):this.addFeature(k,k.geometry,f,s,{},r.subdivisionGranularity),r.featureIndex.insert(c,k.geometry,f,y,this.index,!0)}}addFeatures(e,r,s){for(const c of this.features){const{geometry:d}=c;this.addFeature(c,d,c.index,r,s,e.subdivisionGranularity)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:s})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,B1),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,O1.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,s,c,d,f){for(const y of yl(r,500)){const S={x:0,y:0,sampleCount:0},A=this.layoutVertexArray.length;this.processPolygon(S,c,e,y,f);const k=this.layoutVertexArray.length-A,N=Math.floor(S.x/S.sampleCount),V=Math.floor(S.y/S.sampleCount);for(let q=0;q<k;q++)this.centroidVertexArray.emplaceBack(N,V)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{imagePositions:d,canonical:c})}processPolygon(e,r,s,c,d){if(c.length<1||Im(c[0]))return;for(const N of c)N.length!==0&&$1(e,N);const f={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},y=d.fill.getGranularityForZoomLevel(r.z),S=Ph.types[s.type]==="Polygon";for(const N of c){if(N.length===0||Im(N))continue;const V=du(N,y,S);this._generateSideFaces(V,f)}if(!S)return;const A=xm(c,r,y,!1),k=this.layoutVertexArray;wm((N,V)=>{Ah(k,N,V,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,A.verticesFlattened,A.indicesTriangles)}_generateSideFaces(e,r){let s=0;for(let c=1;c<e.length;c++){const d=e[c],f=e[c-1];if(Z1(d,f))continue;r.segment.vertexLength+4>Jt.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const y=d.sub(f)._perp()._unit(),S=f.dist(d);s+S>32768&&(s=0),Ah(this.layoutVertexArray,d.x,d.y,y.x,y.y,0,0,s),Ah(this.layoutVertexArray,d.x,d.y,y.x,y.y,0,1,s),s+=S,Ah(this.layoutVertexArray,f.x,f.y,y.x,y.y,0,0,s),Ah(this.layoutVertexArray,f.x,f.y,y.x,y.y,0,1,s);const A=r.segment.vertexLength;this.indexArray.emplaceBack(A,A+2,A+1),this.indexArray.emplaceBack(A+1,A+2,A+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function $1(i,e){for(let r=0;r<e.length;r++){const s=e[r];r===e.length-1&&e[0].x===s.x&&e[0].y===s.y||(i.x+=s.x,i.y+=s.y,i.sampleCount++)}}function Z1(i,e){return i.x===e.x&&(i.x<0||i.x>vt)||i.y===e.y&&(i.y<0||i.y>vt)}function Im(i){return i.every(e=>e.x<0)||i.every(e=>e.x>vt)||i.every(e=>e.y<0)||i.every(e=>e.y>vt)}let Em;ke("FillExtrusionBucket",gf,{omit:["layers","features"]});var W1={get paint(){return Em=Em||new Di({"fill-extrusion-opacity":new cr(ae["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new hr(ae["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new cr(ae["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new cr(ae["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ln(ae["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new hr(ae["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new hr(ae["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new cr(ae["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class H1 extends li{constructor(e,r){super(e,W1,r)}createBucket(e){return new gf(e)}queryRadius(){return ed(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:s,geometry:c,transform:d,pixelsToTileUnits:f,pixelPosMatrix:y}){const S=td(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-d.bearingInRadians,f),A=this.paint.get("fill-extrusion-height").evaluate(r,s),k=this.paint.get("fill-extrusion-base").evaluate(r,s),N=function(q,W){const H=[];for(const J of q){const ue=[J.x,J.y,0,1];Ye(ue,ue,W),H.push(new C(ue[0]/ue[3],ue[1]/ue[3]))}return H}(S,y),V=function(q,W,H,J){const ue=[],Ne=[],de=J[8]*W,ye=J[9]*W,je=J[10]*W,Ke=J[11]*W,xt=J[8]*H,Vt=J[9]*H,zt=J[10]*H,Xt=J[11]*H;for(const lr of q){const Kt=[],jt=[];for(const Et of lr){const yr=Et.x,pr=Et.y,vr=J[0]*yr+J[4]*pr+J[12],dr=J[1]*yr+J[5]*pr+J[13],Pr=J[2]*yr+J[6]*pr+J[14],yi=J[3]*yr+J[7]*pr+J[15],ci=Pr+je,tn=yi+Ke,Ps=vr+xt,Nn=dr+Vt,rn=Pr+zt,Xi=yi+Xt,Pi=new C((vr+de)/tn,(dr+ye)/tn);Pi.z=ci/tn,Kt.push(Pi);const mn=new C(Ps/Xi,Nn/Xi);mn.z=rn/Xi,jt.push(mn)}ue.push(Kt),Ne.push(jt)}return[ue,Ne]}(c,k,A,y);return function(q,W,H){let J=1/0;gh(H,W)&&(J=Lm(H,W[0]));for(let ue=0;ue<W.length;ue++){const Ne=W[ue],de=q[ue];for(let ye=0;ye<Ne.length-1;ye++){const je=Ne[ye],Ke=[je,Ne[ye+1],de[ye+1],de[ye],je];mh(H,Ke)&&(J=Math.min(J,Lm(H,Ke)))}}return J!==1/0&&J}(V[0],V[1],N)}}function Ih(i,e){return i.x*e.x+i.y*e.y}function Lm(i,e){if(i.length===1){let r=0;const s=e[r++];let c;for(;!c||s.equals(c);)if(c=e[r++],!c)return 1/0;for(;r<e.length;r++){const d=e[r],f=i[0],y=c.sub(s),S=d.sub(s),A=f.sub(s),k=Ih(y,y),N=Ih(y,S),V=Ih(S,S),q=Ih(A,y),W=Ih(A,S),H=k*V-N*N,J=(V*q-N*W)/H,ue=(k*W-N*q)/H,Ne=s.z*(1-J-ue)+c.z*J+d.z*ue;if(isFinite(Ne))return Ne}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}const X1=_i([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Y1}=X1,J1=_i([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:K1}=J1,Q1=Math.cos(Math.PI/180*37.5),Mm=Math.pow(2,14)/.5;class _f{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Se,this.layoutVertexArray2=new be,this.indexArray=new Tt,this.programConfigurations=new cn(e.layers,e.zoom),this.segments=new Jt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasDependencies=rd("line",this.layers,r)||this.hasLineDasharray(this.layers);const c=this.layers[0].layout.get("line-sort-key"),d=!c.isConstant(),f=[];for(const{feature:y,id:S,index:A,sourceLayerIndex:k}of e){const N=this.layers[0]._featureFilter.needGeometry,V=uc(y,N);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),V,s))continue;const q=d?c.evaluate(V,{},s):void 0,W={id:S,properties:y.properties,type:y.type,sourceLayerIndex:k,index:A,geometry:N?V.geometry:cc(y),patterns:{},dashes:{},sortKey:q};f.push(W)}d&&f.sort((y,S)=>y.sortKey-S.sortKey);for(const y of f){const{geometry:S,index:A,sourceLayerIndex:k}=y;this.hasDependencies?(rd("line",this.layers,r)?hf("line",this.layers,y,{zoom:this.zoom},r):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,y,this.zoom,r),this.patternFeatures.push(y)):this.addFeature(y,S,A,s,{},{},r.subdivisionGranularity),r.featureIndex.insert(e[A].feature,S,A,k,this.index)}}update(e,r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:s,dashPositions:c})}addFeatures(e,r,s,c){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,s,c,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,K1)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Y1),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,c,d,f,y){const S=this.layers[0].layout,A=S.get("line-join").evaluate(e,{}),k=S.get("line-cap"),N=S.get("line-miter-limit"),V=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const q of r)this.addLine(q,e,A,k,N,V,c,y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{imagePositions:d,dashPositions:f,canonical:c})}addLine(e,r,s,c,d,f,y,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=du(e,y?S.line.getGranularityForZoomLevel(y.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let de=0;de<e.length-1;de++)this.totalDistance+=e[de].dist(e[de+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=Ph.types[r.type]==="Polygon";let k=e.length;for(;k>=2&&e[k-1].equals(e[k-2]);)k--;let N=0;for(;N<k-1&&e[N].equals(e[N+1]);)N++;if(k<(A?3:2))return;s==="bevel"&&(d=1.05);const V=this.overscaling<=16?122880/(512*this.overscaling):0,q=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let W,H,J,ue,Ne;this.e1=this.e2=-1,A&&(W=e[k-2],Ne=e[N].sub(W)._unit()._perp());for(let de=N;de<k;de++){if(J=de===k-1?A?e[N+1]:void 0:e[de+1],J&&e[de].equals(J))continue;Ne&&(ue=Ne),W&&(H=W),W=e[de],Ne=J?J.sub(W)._unit()._perp():ue,ue=ue||Ne;let ye=ue.add(Ne);ye.x===0&&ye.y===0||ye._unit();const je=ue.x*Ne.x+ue.y*Ne.y,Ke=ye.x*Ne.x+ye.y*Ne.y,xt=Ke!==0?1/Ke:1/0,Vt=2*Math.sqrt(2-2*Ke),zt=Ke<Q1&&H&&J,Xt=ue.x*Ne.y-ue.y*Ne.x>0;if(zt&&de>N){const jt=W.dist(H);if(jt>2*V){const Et=W.sub(W.sub(H)._mult(V/jt)._round());this.updateDistance(H,Et),this.addCurrentVertex(Et,ue,0,0,q),H=Et}}const lr=H&&J;let Kt=lr?s:A?"butt":c;if(lr&&Kt==="round"&&(xt<f?Kt="miter":xt<=2&&(Kt="fakeround")),Kt==="miter"&&xt>d&&(Kt="bevel"),Kt==="bevel"&&(xt>2&&(Kt="flipbevel"),xt<d&&(Kt="miter")),H&&this.updateDistance(H,W),Kt==="miter")ye._mult(xt),this.addCurrentVertex(W,ye,0,0,q);else if(Kt==="flipbevel"){if(xt>100)ye=Ne.mult(-1);else{const jt=xt*ue.add(Ne).mag()/ue.sub(Ne).mag();ye._perp()._mult(jt*(Xt?-1:1))}this.addCurrentVertex(W,ye,0,0,q),this.addCurrentVertex(W,ye.mult(-1),0,0,q)}else if(Kt==="bevel"||Kt==="fakeround"){const jt=-Math.sqrt(xt*xt-1),Et=Xt?jt:0,yr=Xt?0:jt;if(H&&this.addCurrentVertex(W,ue,Et,yr,q),Kt==="fakeround"){const pr=Math.round(180*Vt/Math.PI/20);for(let vr=1;vr<pr;vr++){let dr=vr/pr;if(dr!==.5){const yi=dr-.5;dr+=dr*yi*(dr-1)*((1.0904+je*(je*(3.55645-1.43519*je)-3.2452))*yi*yi+(.848013+je*(.215638*je-1.06021)))}const Pr=Ne.sub(ue)._mult(dr)._add(ue)._unit()._mult(Xt?-1:1);this.addHalfVertex(W,Pr.x,Pr.y,!1,Xt,0,q)}}J&&this.addCurrentVertex(W,Ne,-Et,-yr,q)}else if(Kt==="butt")this.addCurrentVertex(W,ye,0,0,q);else if(Kt==="square"){const jt=H?1:-1;this.addCurrentVertex(W,ye,jt,jt,q)}else Kt==="round"&&(H&&(this.addCurrentVertex(W,ue,0,0,q),this.addCurrentVertex(W,ue,1,1,q,!0)),J&&(this.addCurrentVertex(W,Ne,-1,-1,q,!0),this.addCurrentVertex(W,Ne,0,0,q)));if(zt&&de<k-1){const jt=W.dist(J);if(jt>2*V){const Et=W.add(J.sub(W)._mult(V/jt)._round());this.updateDistance(W,Et),this.addCurrentVertex(Et,Ne,0,0,q),W=Et}}}}addCurrentVertex(e,r,s,c,d,f=!1){const y=r.y*c-r.x,S=-r.y-r.x*c;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,f,!1,s,d),this.addHalfVertex(e,y,S,f,!0,-c,d),this.distance>Mm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,s,c,d,f))}addHalfVertex({x:e,y:r},s,c,d,f,y,S){const A=.5*(this.lineClips?this.scaledDistance*(Mm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(r<<1)+(f?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(y===0?0:y<0?-1:1)|(63&A)<<2,A>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const k=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,k,this.e2),S.primitiveLength++),f?this.e2=k:this.e1=k}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}hasLineDasharray(e){for(const r of e){const s=r.paint.get("line-dasharray");if(s&&!s.isConstant())return!0}return!1}addLineDashDependencies(e,r,s,c){for(const d of e){const f=d.paint.get("line-dasharray");if(!f||f.value.kind==="constant")continue;const y=d.layout.get("line-cap")==="round",S={dasharray:f.value.evaluate({zoom:s-1},r,{}),round:y},A={dasharray:f.value.evaluate({zoom:s},r,{}),round:y},k={dasharray:f.value.evaluate({zoom:s+1},r,{}),round:y},N=`${S.dasharray.join(",")},${S.round}`,V=`${A.dasharray.join(",")},${A.round}`,q=`${k.dasharray.join(",")},${k.round}`;c.dashDependencies[N]=S,c.dashDependencies[V]=A,c.dashDependencies[q]=k,r.dashes[d.id]={min:N,mid:V,max:q}}}}let Cm,km;ke("LineBucket",_f,{omit:["layers","patternFeatures"]});var Dm={get paint(){return km=km||new Di({"line-opacity":new hr(ae.paint_line["line-opacity"]),"line-color":new hr(ae.paint_line["line-color"]),"line-translate":new cr(ae.paint_line["line-translate"]),"line-translate-anchor":new cr(ae.paint_line["line-translate-anchor"]),"line-width":new hr(ae.paint_line["line-width"]),"line-gap-width":new hr(ae.paint_line["line-gap-width"]),"line-offset":new hr(ae.paint_line["line-offset"]),"line-blur":new hr(ae.paint_line["line-blur"]),"line-dasharray":new ln(ae.paint_line["line-dasharray"]),"line-pattern":new ln(ae.paint_line["line-pattern"]),"line-gradient":new zi(ae.paint_line["line-gradient"])})},get layout(){return Cm=Cm||new Di({"line-cap":new cr(ae.layout_line["line-cap"]),"line-join":new hr(ae.layout_line["line-join"]),"line-miter-limit":new cr(ae.layout_line["line-miter-limit"]),"line-round-limit":new cr(ae.layout_line["line-round-limit"]),"line-sort-key":new hr(ae.layout_line["line-sort-key"])})}};class ev extends hr{possiblyEvaluate(e,r){return r=new br(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,s,c){return r=pt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,s,c)}}let ad;class tv extends li{constructor(e,r){super(e,Dm,r),this.gradientVersion=0,ad||(ad=new ev(Dm.paint.properties["line-width"].specification),ad.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(s){return s._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof rt,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=ad.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new _f(e)}queryRadius(e){const r=e,s=Fm(zu("line-width",this,r),zu("line-gap-width",this,r)),c=zu("line-offset",this,r);return s/2+Math.abs(c)+ed(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:s,geometry:c,transform:d,pixelsToTileUnits:f}){const y=td(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-d.bearingInRadians,f),S=f/2*Fm(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),A=this.paint.get("line-offset").evaluate(r,s);return A&&(c=function(k,N){const V=[];for(let q=0;q<k.length;q++){const W=c1(k[q]),H=[];for(let J=0;J<W.length;J++){const ue=W[J],Ne=W[J-1],de=W[J+1],ye=J===0?new C(0,0):ue.sub(Ne)._unit()._perp(),je=J===W.length-1?new C(0,0):de.sub(ue)._unit()._perp(),Ke=ye._add(je)._unit(),xt=Ke.x*je.x+Ke.y*je.y;xt!==0&&Ke._mult(1/xt),H.push(Ke._mult(N)._add(ue))}V.push(H)}return V}(c,A*f)),function(k,N,V){for(let q=0;q<N.length;q++){const W=N[q];if(k.length>=3){for(let H=0;H<W.length;H++)if(Ru(k,W[H]))return!0}if(_h(k,W,V))return!0}return!1}(y,c,S)}isTileClipped(){return!0}}function Fm(i,e){return e>0?e+2*i:i}const rv=_i([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),iv=_i([{name:"a_projected_pos",components:3,type:"Float32"}],4);_i([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const nv=_i([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);_i([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Rm=_i([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),sv=_i([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function av(i,e,r){return i.sections.forEach(s=>{s.text=function(c,d,f){const y=d.layout.get("text-transform").evaluate(f,{});return y==="uppercase"?c=c.toLocaleUpperCase():y==="lowercase"&&(c=c.toLocaleLowerCase()),Ei.applyArabicShaping&&(c=Ei.applyArabicShaping(c)),c}(s.text,e,r)}),i}_i([{name:"triangle",components:3,type:"Uint16"}]),_i([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),_i([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),_i([{type:"Float32",name:"offsetX"}]),_i([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),_i([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var ts=24;const Eh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},ov={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},lv={40:!0};function zm(i,e,r,s,c,d){if("fontStack"in e){const f=r[e.fontStack],y=f&&f[i];return y?y.metrics.advance*e.scale+c:0}{const f=s[e.imageName];return f?f.displaySize[0]*e.scale*ts/d+c:0}}function Nm(i,e,r,s){const c=Math.pow(i-e,2);return s?i<e?c/2:2*c:c+Math.abs(r)*r}function cv(i,e,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Om(i,e,r,s,c,d){let f=null,y=Nm(e,r,c,d);for(const S of s){const A=Nm(e-S.x,r,c,d)+S.badness;A<=y&&(f=S,y=A)}return{index:i,x:e,priorBreak:f,badness:y}}function Bm(i){return i?Bm(i.priorBreak).concat(i.index):[]}class ju{constructor(e="",r=[],s=[]){this.text=e,this.sections=r,this.sectionIndex=s,this.imageSectionID=null}static fromFeature(e,r){const s=new ju;for(let c=0;c<e.sections.length;c++){const d=e.sections[c];d.image?s.addImageSection(d):s.addTextSection(d,r)}return s}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=function(e){let r="",s={premature:!0,value:void 0};const c=e[Symbol.iterator]();let d=c.next();const f=e[Symbol.iterator]();f.next();let y=f.next();for(;!d.done;)r+=!y.done&&ui(y.value.codePointAt(0))&&!Eh[y.value]||!s.premature&&ui(s.value.codePointAt(0))&&!Eh[s.value]||!Eh[d.value]?d.value:Eh[d.value],s={value:d.value,premature:!1},d=c.next(),y=f.next();return r}(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),r=e?e[0].length:0,s=this.text.match(/\S\s*$/),c=s?s[0].length-1:0;this.text=this.text.substring(r,this.text.length-c),this.sectionIndex=this.sectionIndex.slice(r,this.sectionIndex.length-c)}substring(e,r){const s=[...this.text].slice(e,r).join(""),c=this.sectionIndex.slice(e,r);return new ju(s,this.sections,c)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}getMaxImageSize(e){let r=0,s=0;for(let c=0;c<this.length();c++){const d=this.getSection(c);if("imageName"in d){const f=e[d.imageName];if(!f)continue;const y=f.displaySize;r=Math.max(r,y[0]),s=Math.max(s,y[1])}}return{maxImageWidth:r,maxImageHeight:s}}addTextSection(e,r){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||r});const s=this.sections.length-1;this.sectionIndex.push(...[...e.text].map(()=>s))}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Ft("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:r}),this.sectionIndex.push(this.sections.length-1)):Ft("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,r,s,c,d){const f=[],y=this.determineAverageLineWidth(e,r,s,c,d),S=this.hasZeroWidthSpaces();let A=0,k=0;const N=this.text[Symbol.iterator]();let V=N.next();const q=this.text[Symbol.iterator]();q.next();let W=q.next();const H=this.text[Symbol.iterator]();H.next(),H.next();let J=H.next();for(;!V.done;){const ue=this.getSection(k),Ne=V.value.codePointAt(0);if(or(Ne)||(A+=zm(Ne,ue,s,c,e,d)),!W.done){const de=$t(Ne),ye=W.value.codePointAt(0);(ov[Ne]||de||"imageName"in ue||!J.done&&lv[ye])&&f.push(Om(k+1,A,y,f,cv(Ne,ye,de&&S),!1))}k++,V=N.next(),W=q.next(),J=H.next()}return Bm(Om(this.length(),A,y,f,0,!0))}determineAverageLineWidth(e,r,s,c,d){let f=0,y=0;for(const S of this.text){const A=this.getSection(y);f+=zm(S.codePointAt(0),A,s,c,e,d),y++}return f/Math.max(1,Math.ceil(f/r))}}const yf=4294967296,jm=1/yf,Um=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class od{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,r,s=this.length){for(;this.pos<s;){const c=this.readVarint(),d=c>>3,f=this.pos;this.type=7&c,e(d,r,this),this.pos===f&&this.skip(c)}return r}readMessage(e,r){return this.readFields(e,r,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*yf;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*yf;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const r=this.buf;let s,c;return c=r[this.pos++],s=127&c,c<128?s:(c=r[this.pos++],s|=(127&c)<<7,c<128?s:(c=r[this.pos++],s|=(127&c)<<14,c<128?s:(c=r[this.pos++],s|=(127&c)<<21,c<128?s:(c=r[this.pos],s|=(15&c)<<28,function(d,f,y){const S=y.buf;let A,k;if(k=S[y.pos++],A=(112&k)>>4,k<128||(k=S[y.pos++],A|=(127&k)<<3,k<128)||(k=S[y.pos++],A|=(127&k)<<10,k<128)||(k=S[y.pos++],A|=(127&k)<<17,k<128)||(k=S[y.pos++],A|=(127&k)<<24,k<128)||(k=S[y.pos++],A|=(1&k)<<31,k<128))return Uu(d,A,f);throw new Error("Expected varint not more than 10 bytes")}(s,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,r=this.pos;return this.pos=e,e-r>=12&&Um?Um.decode(this.buf.subarray(r,e)):function(s,c,d){let f="",y=c;for(;y<d;){const S=s[y];let A,k,N,V=null,q=S>239?4:S>223?3:S>191?2:1;if(y+q>d)break;q===1?S<128&&(V=S):q===2?(A=s[y+1],(192&A)==128&&(V=(31&S)<<6|63&A,V<=127&&(V=null))):q===3?(A=s[y+1],k=s[y+2],(192&A)==128&&(192&k)==128&&(V=(15&S)<<12|(63&A)<<6|63&k,(V<=2047||V>=55296&&V<=57343)&&(V=null))):q===4&&(A=s[y+1],k=s[y+2],N=s[y+3],(192&A)==128&&(192&k)==128&&(192&N)==128&&(V=(15&S)<<18|(63&A)<<12|(63&k)<<6|63&N,(V<=65535||V>=1114112)&&(V=null))),V===null?(V=65533,q=1):V>65535&&(V-=65536,f+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),f+=String.fromCharCode(V),y+=q}return f}(this.buf,r,e)}readBytes(){const e=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,e);return this.pos=e,r}readPackedVarint(e=[],r){const s=this.readPackedEnd();for(;this.pos<s;)e.push(this.readVarint(r));return e}readPackedSVarint(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const r=7&e;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(e,r){this.writeVarint(e<<3|r)}realloc(e){let r=this.length||16;for(;r<this.pos+e;)r*=2;if(r!==this.length){const s=new Uint8Array(r);s.set(this.buf),this.buf=s,this.dataView=new DataView(s.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*jm),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*jm),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?function(r,s){let c,d;if(r>=0?(c=r%4294967296|0,d=r/4294967296|0):(c=~(-r%4294967296),d=~(-r/4294967296),4294967295^c?c=c+1|0:(c=0,d=d+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(f,y,S){S.buf[S.pos++]=127&f|128,f>>>=7,S.buf[S.pos++]=127&f|128,f>>>=7,S.buf[S.pos++]=127&f|128,f>>>=7,S.buf[S.pos++]=127&f|128,S.buf[S.pos]=127&(f>>>=7)}(c,0,s),function(f,y){const S=(7&f)<<4;y.buf[y.pos++]|=S|((f>>>=3)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f)))))}(d,s)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const r=this.pos;this.pos=function(c,d,f){for(let y,S,A=0;A<d.length;A++){if(y=d.charCodeAt(A),y>55295&&y<57344){if(!S){y>56319||A+1===d.length?(c[f++]=239,c[f++]=191,c[f++]=189):S=y;continue}if(y<56320){c[f++]=239,c[f++]=191,c[f++]=189,S=y;continue}y=S-55296<<10|y-56320|65536,S=null}else S&&(c[f++]=239,c[f++]=191,c[f++]=189,S=null);y<128?c[f++]=y:(y<2048?c[f++]=y>>6|192:(y<65536?c[f++]=y>>12|224:(c[f++]=y>>18|240,c[f++]=y>>12&63|128),c[f++]=y>>6&63|128),c[f++]=63&y|128)}return f}(this.buf,e,this.pos);const s=this.pos-r;s>=128&&Vm(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const r=e.length;this.writeVarint(r),this.realloc(r);for(let s=0;s<r;s++)this.buf[this.pos++]=e[s]}writeRawMessage(e,r){this.pos++;const s=this.pos;e(r,this);const c=this.pos-s;c>=128&&Vm(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c}writeMessage(e,r,s){this.writeTag(e,2),this.writeRawMessage(r,s)}writePackedVarint(e,r){r.length&&this.writeMessage(e,uv,r)}writePackedSVarint(e,r){r.length&&this.writeMessage(e,hv,r)}writePackedBoolean(e,r){r.length&&this.writeMessage(e,pv,r)}writePackedFloat(e,r){r.length&&this.writeMessage(e,dv,r)}writePackedDouble(e,r){r.length&&this.writeMessage(e,fv,r)}writePackedFixed32(e,r){r.length&&this.writeMessage(e,mv,r)}writePackedSFixed32(e,r){r.length&&this.writeMessage(e,gv,r)}writePackedFixed64(e,r){r.length&&this.writeMessage(e,_v,r)}writePackedSFixed64(e,r){r.length&&this.writeMessage(e,yv,r)}writeBytesField(e,r){this.writeTag(e,2),this.writeBytes(r)}writeFixed32Field(e,r){this.writeTag(e,5),this.writeFixed32(r)}writeSFixed32Field(e,r){this.writeTag(e,5),this.writeSFixed32(r)}writeFixed64Field(e,r){this.writeTag(e,1),this.writeFixed64(r)}writeSFixed64Field(e,r){this.writeTag(e,1),this.writeSFixed64(r)}writeVarintField(e,r){this.writeTag(e,0),this.writeVarint(r)}writeSVarintField(e,r){this.writeTag(e,0),this.writeSVarint(r)}writeStringField(e,r){this.writeTag(e,2),this.writeString(r)}writeFloatField(e,r){this.writeTag(e,5),this.writeFloat(r)}writeDoubleField(e,r){this.writeTag(e,1),this.writeDouble(r)}writeBooleanField(e,r){this.writeVarintField(e,+r)}}function Uu(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Vm(i,e,r){const s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(let c=r.pos-1;c>=i;c--)r.buf[c+s]=r.buf[c]}function uv(i,e){for(let r=0;r<i.length;r++)e.writeVarint(i[r])}function hv(i,e){for(let r=0;r<i.length;r++)e.writeSVarint(i[r])}function dv(i,e){for(let r=0;r<i.length;r++)e.writeFloat(i[r])}function fv(i,e){for(let r=0;r<i.length;r++)e.writeDouble(i[r])}function pv(i,e){for(let r=0;r<i.length;r++)e.writeBoolean(i[r])}function mv(i,e){for(let r=0;r<i.length;r++)e.writeFixed32(i[r])}function gv(i,e){for(let r=0;r<i.length;r++)e.writeSFixed32(i[r])}function _v(i,e){for(let r=0;r<i.length;r++)e.writeFixed64(i[r])}function yv(i,e){for(let r=0;r<i.length;r++)e.writeSFixed64(i[r])}function vv(i,e,r){i===1&&r.readMessage(bv,e)}function bv(i,e,r){if(i===3){const{id:s,bitmap:c,width:d,height:f,left:y,top:S,advance:A}=r.readMessage(xv,{});e.push({id:s,bitmap:new yh({width:d+6,height:f+6},c),metrics:{width:d,height:f,left:y,top:S,advance:A}})}}function xv(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function qm(i){let e=0,r=0;for(const f of i)e+=f.w*f.h,r=Math.max(r,f.w);i.sort((f,y)=>y.h-f.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let c=0,d=0;for(const f of i)for(let y=s.length-1;y>=0;y--){const S=s[y];if(!(f.w>S.w||f.h>S.h)){if(f.x=S.x,f.y=S.y,d=Math.max(d,f.y+f.h),c=Math.max(c,f.x+f.w),f.w===S.w&&f.h===S.h){const A=s.pop();A&&y<s.length&&(s[y]=A)}else f.h===S.h?(S.x+=f.w,S.w-=f.w):f.w===S.w?(S.y+=f.h,S.h-=f.h):(s.push({x:S.x+f.w,y:S.y,w:S.w-f.w,h:f.h}),S.y+=f.h,S.h-=f.h);break}}return{w:c,h:d,fill:e/(c*d)||0}}class vf{constructor(e,{pixelRatio:r,version:s,stretchX:c,stretchY:d,content:f,textFitWidth:y,textFitHeight:S}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=c,this.stretchY=d,this.content=f,this.version=s,this.textFitWidth=y,this.textFitHeight=S}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Gm{constructor(e,r){const s={},c={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,s,d),this.addImages(r,c,d);const{w:f,h:y}=qm(d),S=new ma({width:f||1,height:y||1});for(const A in e){const k=e[A],N=s[A].paddedRect;ma.copy(k.data,S,{x:0,y:0},{x:N.x+1,y:N.y+1},k.data)}for(const A in r){const k=r[A],N=c[A].paddedRect,V=N.x+1,q=N.y+1,W=k.data.width,H=k.data.height;ma.copy(k.data,S,{x:0,y:0},{x:V,y:q},k.data),ma.copy(k.data,S,{x:0,y:H-1},{x:V,y:q-1},{width:W,height:1}),ma.copy(k.data,S,{x:0,y:0},{x:V,y:q+H},{width:W,height:1}),ma.copy(k.data,S,{x:W-1,y:0},{x:V-1,y:q},{width:1,height:H}),ma.copy(k.data,S,{x:0,y:0},{x:V+W,y:q},{width:1,height:H})}this.image=S,this.iconPositions=s,this.patternPositions=c}addImages(e,r,s){for(const c in e){const d=e[c],f={x:0,y:0,w:d.data.width+2,h:d.data.height+2};s.push(f),r[c]=new vf(f,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[c,d]=e.tl;s.update(r.data,void 0,{x:c,y:d})}}var Rc;function ld(i,e,r,s,c,d,f,y,S,A,k,N,V,q,W){const H=ju.fromFeature(i,c);let J;N===b.aA.vertical&&H.verticalizePunctuation();let ue=H.determineLineBreaks(A,d,e,s,q);const{processBidirectionalText:Ne,processStyledBidirectionalText:de}=Ei;if(Ne&&H.sections.length===1){J=[],ue=ue.map(xt=>H.toCodeUnitIndex(xt));const Ke=Ne(H.toString(),ue);for(const xt of Ke){const Vt=[...xt].map(()=>0);J.push(new ju(xt,H.sections,Vt))}}else if(de){J=[],ue=ue.map(zt=>H.toCodeUnitIndex(zt));let Ke=0;const xt=[];for(const zt of H.text)xt.push(...Array(zt.length).fill(H.sectionIndex[Ke])),Ke++;const Vt=de(H.text,xt,ue);for(const zt of Vt){const Xt=[];let lr="";for(const Kt of zt[0])Xt.push(zt[1][lr.length]),lr+=Kt;J.push(new ju(zt[0],H.sections,Xt))}}else J=function(Ke,xt){const Vt=[];let zt=0;for(const Xt of xt)Vt.push(Ke.substring(zt,Xt)),zt=Xt;return zt<Ke.length()&&Vt.push(Ke.substring(zt,Ke.length())),Vt}(H,ue);const ye=[],je={positionedLines:ye,text:H.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:N,iconsInText:!1,verticalizable:!1};return function(Ke,xt,Vt,zt,Xt,lr,Kt,jt,Et,yr,pr,vr){let dr=0,Pr=0,yi=0,ci=0;const tn=jt==="right"?1:jt==="left"?0:.5,Ps=ts/vr;let Nn=0;for(const Pi of Xt){Pi.trim();const mn=Pi.getMaxScale(),Sn={positionedGlyphs:[],lineOffset:0};Ke.positionedLines[Nn]=Sn;const Gi=Sn.positionedGlyphs;let ga=0;if(!Pi.length()){Pr+=lr,++Nn;continue}const As=wv(zt,Pi,Ps);let _a=0;for(const ns of Pi.text){const un=Pi.getSection(_a),On=ns.codePointAt(0),gn=Sv(Et,pr,On),ss={glyph:On,imageName:null,x:dr,y:Pr+-17,vertical:gn,scale:1,fontStack:"",sectionIndex:Pi.getSectionIndex(_a),metrics:null,rect:null};let fc;if("fontStack"in un){if(fc=Tv(un,On,gn,As,xt,Vt),!fc)continue;ss.fontStack=un.fontStack}else{if(Ke.iconsInText=!0,un.scale*=Ps,fc=Pv(un,gn,mn,As,zt),!fc)continue;ga=Math.max(ga,fc.imageOffset),ss.imageName=un.imageName}const{rect:nl,metrics:zh,baselineOffset:jc}=fc;ss.y+=jc,ss.scale=un.scale,ss.metrics=zh,ss.rect=nl,Gi.push(ss),gn?(Ke.verticalizable=!0,dr+=("imageName"in un?zh.advance:ts)*un.scale+yr):dr+=zh.advance*un.scale+yr,_a++}Gi.length!==0&&(yi=Math.max(dr-yr,yi),Av(Gi,0,Gi.length-1,tn)),dr=0,Sn.lineOffset=Math.max(ga,(mn-1)*ts);const Lo=lr*mn+ga;Pr+=Lo,ci=Math.max(Lo,ci),++Nn}const{horizontalAlign:rn,verticalAlign:Xi}=bf(Kt);(function(Pi,mn,Sn,Gi,ga,As,_a,Lo,ns){const un=(mn-Sn)*ga;let On=0;On=As!==_a?-Lo*Gi- -17:-Gi*ns*_a+.5*_a;for(const gn of Pi)for(const ss of gn.positionedGlyphs)ss.x+=un,ss.y+=On})(Ke.positionedLines,tn,rn,Xi,yi,ci,lr,Pr,Xt.length),Ke.top+=-Xi*Pr,Ke.bottom=Ke.top+Pr,Ke.left+=-rn*yi,Ke.right=Ke.left+yi}(je,e,r,s,J,f,y,S,N,A,V,W),!function(Ke){for(const xt of Ke)if(xt.positionedGlyphs.length!==0)return!1;return!0}(ye)&&je}function bf(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function wv(i,e,r){const s=e.getMaxScale()*ts,{maxImageWidth:c,maxImageHeight:d}=e.getMaxImageSize(i),f=Math.max(s,d*r);return{verticalLineContentWidth:Math.max(s,c*r),horizontalLineContentHeight:f}}function $m(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function Sv(i,e,r){return!(i===b.aA.horizontal||!e&&!Wt(r)||e&&(or(r)||(s=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(s)))));var s}function Tv(i,e,r,s,c,d){const f=d[i.fontStack],y=function(A,k,N,V){if(A&&A.rect)return A;const q=k[N.fontStack],W=q&&q[V];return W?{rect:null,metrics:W.metrics}:null}(f&&f[e],c,i,e);if(y===null)return null;let S;if(r)S=s.verticalLineContentWidth-i.scale*ts;else{const A=$m(i.verticalAlign);S=(s.horizontalLineContentHeight-i.scale*ts)*A}return{rect:y.rect,metrics:y.metrics,baselineOffset:S}}function Pv(i,e,r,s,c){const d=c[i.imageName];if(!d)return null;const f=d.paddedRect,y=d.displaySize,S={width:y[0],height:y[1],left:1,top:-3,advance:e?y[1]:y[0]};let A;if(e)A=s.verticalLineContentWidth-y[1]*i.scale;else{const k=$m(i.verticalAlign);A=(s.horizontalLineContentHeight-y[1]*i.scale)*k}return{rect:f,metrics:S,baselineOffset:A,imageOffset:(e?y[0]:y[1])*i.scale-ts*r}}function Av(i,e,r,s){if(s===0)return;const c=i[r],d=(i[r].x+c.metrics.advance*c.scale)*s;for(let f=e;f<=r;f++)i[f].x-=d}function Iv(i,e,r){const{horizontalAlign:s,verticalAlign:c}=bf(r),d=e[0]-i.displaySize[0]*s,f=e[1]-i.displaySize[1]*c;return{image:i,top:f,bottom:f+i.displaySize[1],left:d,right:d+i.displaySize[0]}}function Zm(i){var e,r;let s=i.left,c=i.top,d=i.right-s,f=i.bottom-c;const y=(e=i.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",S=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",A=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(S==="proportional"){if(y==="stretchOnly"&&d/f<A||y==="proportional"){const k=Math.ceil(f*A);s*=k/d,d=k}}else if(y==="proportional"&&S==="stretchOnly"&&A!==0&&d/f>A){const k=Math.ceil(d/A);c*=k/f,f=k}return{x1:s,y1:c,x2:s+d,y2:c+f}}function Wm(i,e,r,s,c,d){const f=i.image;let y;if(f.content){const J=f.content,ue=f.pixelRatio||1;y=[J[0]/ue,J[1]/ue,f.displaySize[0]-J[2]/ue,f.displaySize[1]-J[3]/ue]}const S=e.left*d,A=e.right*d;let k,N,V,q;r==="width"||r==="both"?(q=c[0]+S-s[3],N=c[0]+A+s[1]):(q=c[0]+(S+A-f.displaySize[0])/2,N=q+f.displaySize[0]);const W=e.top*d,H=e.bottom*d;return r==="height"||r==="both"?(k=c[1]+W-s[0],V=c[1]+H+s[2]):(k=c[1]+(W+H-f.displaySize[1])/2,V=k+f.displaySize[1]),{image:f,top:k,right:N,bottom:V,left:q,collisionPadding:y}}ke("ImagePosition",vf),ke("ImageAtlas",Gm),b.aA=void 0,(Rc=b.aA||(b.aA={}))[Rc.none=0]="none",Rc[Rc.horizontal=1]="horizontal",Rc[Rc.vertical=2]="vertical",Rc[Rc.horizontalOnly=3]="horizontalOnly";const hc=128,zc=32640;function Hm(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new br(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:c}=r;let d=0;for(;d<s.length&&s[d]<=i;)d++;d=Math.max(0,d-1);let f=d;for(;f<s.length&&s[f]<i+1;)f++;f=Math.min(s.length-1,f);const y=s[d],S=s[f];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:S,interpolationType:c}:{kind:"camera",minZoom:y,maxZoom:S,minSize:r.evaluate(new br(y)),maxSize:r.evaluate(new br(S)),interpolationType:c}}}function xf(i,e,r){let s="never";const c=i.get(e);return c?s=c:i.get(r)&&(s="always"),s}const Ev=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function cd(i,e,r,s,c,d,f,y,S,A,k,N,V){const q=y?Math.min(zc,Math.round(y[0])):0,W=y?Math.min(zc,Math.round(y[1])):0;i.emplaceBack(e,r,Math.round(32*s),Math.round(32*c),d,f,(q<<1)+(S?1:0),W,16*A,16*k,256*N,256*V)}function wf(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function Lv(i){for(const e of i.sections)if(_r(e.text))return!0;return!1}class Sf{constructor(e){this.layoutVertexArray=new Le,this.indexArray=new Tt,this.programConfigurations=e,this.segments=new Jt,this.dynamicLayoutVertexArray=new Je,this.opacityVertexArray=new et,this.hasVisibleVertices=!1,this.placedSymbolArray=new l}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,s,c){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rv.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,iv.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Ev,!0),this.opacityVertexBuffer.itemSize=1),(s||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ke("SymbolBuffers",Sf);class Tf{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new Jt,this.collisionVertexArray=new lt}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,nv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ke("CollisionBuffers",Tf);class Vu{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Hm(this.zoom,r["text-size"]),this.iconSizeData=Hm(this.zoom,r["icon-size"]);const s=this.layers[0].layout,c=s.get("symbol-sort-key"),d=s.get("symbol-z-order");this.canOverlap=xf(s,"text-overlap","text-allow-overlap")!=="never"||xf(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(f=>b.aA[f])),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID}createArrays(){this.text=new Sf(new cn(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Sf(new cn(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new w,this.lineVertexArray=new P,this.symbolInstances=new _,this.textAnchorOffsets=new R}calculateGlyphDependencies(e,r,s,c,d){for(const f of e)if(r[f.codePointAt(0)]=!0,(s||c)&&d){const y=Eh[f];y&&(r[y.codePointAt(0)]=!0)}}populate(e,r,s){const c=this.layers[0],d=c.layout,f=d.get("text-font"),y=d.get("text-field"),S=d.get("icon-image"),A=(y.value.kind!=="constant"||y.value.value instanceof zr&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(f.value.kind!=="constant"||f.value.value.length>0),k=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,N=d.get("symbol-sort-key");if(this.features=[],!A&&!k)return;const V=r.iconDependencies,q=r.glyphDependencies,W=r.availableImages,H=new br(this.zoom);for(const{feature:J,id:ue,index:Ne,sourceLayerIndex:de}of e){const ye=c._featureFilter.needGeometry,je=uc(J,ye);if(!c._featureFilter.filter(H,je,s))continue;let Ke,xt;if(ye||(je.geometry=cc(J)),A){const zt=c.getValueAndResolveTokens("text-field",je,s,W),Xt=zr.factory(zt),lr=this.hasRTLText=this.hasRTLText||Lv(Xt);(!lr||Ei.getRTLTextPluginStatus()==="unavailable"||lr&&Ei.isParsed())&&(Ke=av(Xt,c,je))}if(k){const zt=c.getValueAndResolveTokens("icon-image",je,s,W);xt=zt instanceof as?zt:as.fromString(zt)}if(!Ke&&!xt)continue;const Vt=this.sortFeaturesByKey?N.evaluate(je,{},s):void 0;if(this.features.push({id:ue,text:Ke,icon:xt,index:Ne,sourceLayerIndex:de,geometry:je.geometry,properties:J.properties,type:Ph.types[J.type],sortKey:Vt}),xt&&(V[xt.name]=!0),Ke){const zt=f.evaluate(je,{},s).join(","),Xt=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(b.aA.vertical)>=0;for(const lr of Ke.sections)if(lr.image)V[lr.image.name]=!0;else{const Kt=Qt(Ke.toString()),jt=lr.fontStack||zt,Et=q[jt]=q[jt]||{};this.calculateGlyphDependencies(lr.text,Et,Xt,this.allowVerticalPlacement,Kt)}}}d.get("symbol-placement")==="line"&&(this.features=function(J){const ue={},Ne={},de=[];let ye=0;function je(zt){de.push(J[zt]),ye++}function Ke(zt,Xt,lr){const Kt=Ne[zt];return delete Ne[zt],Ne[Xt]=Kt,de[Kt].geometry[0].pop(),de[Kt].geometry[0]=de[Kt].geometry[0].concat(lr[0]),Kt}function xt(zt,Xt,lr){const Kt=ue[Xt];return delete ue[Xt],ue[zt]=Kt,de[Kt].geometry[0].shift(),de[Kt].geometry[0]=lr[0].concat(de[Kt].geometry[0]),Kt}function Vt(zt,Xt,lr){const Kt=lr?Xt[0][Xt[0].length-1]:Xt[0][0];return`${zt}:${Kt.x}:${Kt.y}`}for(let zt=0;zt<J.length;zt++){const Xt=J[zt],lr=Xt.geometry,Kt=Xt.text?Xt.text.toString():null;if(!Kt){je(zt);continue}const jt=Vt(Kt,lr),Et=Vt(Kt,lr,!0);if(jt in Ne&&Et in ue&&Ne[jt]!==ue[Et]){const yr=xt(jt,Et,lr),pr=Ke(jt,Et,de[yr].geometry);delete ue[jt],delete Ne[Et],Ne[Vt(Kt,de[pr].geometry,!0)]=pr,de[yr].geometry=null}else jt in Ne?Ke(jt,Et,lr):Et in ue?xt(jt,Et,lr):(je(zt),ue[jt]=ye-1,Ne[Et]=ye-1)}return de.filter(zt=>zt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,ue)=>J.sortKey-ue.sortKey)}update(e,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,{imagePositions:s}),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,{imagePositions:s}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(r[e.segment+1]),d=e.dist(r[e.segment]);const f={};for(let y=e.segment+1;y<r.length;y++)f[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:c},y<r.length-1&&(c+=r[y+1].dist(r[y]));for(let y=e.segment||0;y>=0;y--)f[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:d},y>0&&(d+=r[y-1].dist(r[y]));for(let y=0;y<r.length;y++){const S=f[y];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,c,d,f,y,S,A,k,N,V){const q=e.indexArray,W=e.layoutVertexArray,H=e.segments.prepareSegment(4*r.length,W,q,this.canOverlap?f.sortKey:void 0),J=this.glyphOffsetArray.length,ue=H.vertexLength,Ne=this.allowVerticalPlacement&&y===b.aA.vertical?Math.PI/2:0,de=f.text&&f.text.sections;for(let ye=0;ye<r.length;ye++){const{tl:je,tr:Ke,bl:xt,br:Vt,tex:zt,pixelOffsetTL:Xt,pixelOffsetBR:lr,minFontScaleX:Kt,minFontScaleY:jt,glyphOffset:Et,isSDF:yr,sectionIndex:pr}=r[ye],vr=H.vertexLength,dr=Et[1];cd(W,S.x,S.y,je.x,dr+je.y,zt.x,zt.y,s,yr,Xt.x,Xt.y,Kt,jt),cd(W,S.x,S.y,Ke.x,dr+Ke.y,zt.x+zt.w,zt.y,s,yr,lr.x,Xt.y,Kt,jt),cd(W,S.x,S.y,xt.x,dr+xt.y,zt.x,zt.y+zt.h,s,yr,Xt.x,lr.y,Kt,jt),cd(W,S.x,S.y,Vt.x,dr+Vt.y,zt.x+zt.w,zt.y+zt.h,s,yr,lr.x,lr.y,Kt,jt),wf(e.dynamicLayoutVertexArray,S,Ne),q.emplaceBack(vr,vr+2,vr+1),q.emplaceBack(vr+1,vr+2,vr+3),H.vertexLength+=4,H.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Et[0]),ye!==r.length-1&&pr===r[ye+1].sectionIndex||e.programConfigurations.populatePaintArrays(W.length,f,f.index,{imagePositions:{},canonical:V,formattedSection:de&&de[pr]})}e.placedSymbolArray.emplaceBack(S.x,S.y,J,this.glyphOffsetArray.length-J,ue,A,k,S.segment,s?s[0]:0,s?s[1]:0,c[0],c[1],y,0,!1,0,N)}_addCollisionDebugVertex(e,r,s,c,d,f){return r.emplaceBack(0,0),e.emplaceBack(s.x,s.y,c,d,Math.round(f.x),Math.round(f.y))}addCollisionDebugVertices(e,r,s,c,d,f,y){const S=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),A=S.vertexLength,k=d.layoutVertexArray,N=d.collisionVertexArray,V=y.anchorX,q=y.anchorY;this._addCollisionDebugVertex(k,N,f,V,q,new C(e,r)),this._addCollisionDebugVertex(k,N,f,V,q,new C(s,r)),this._addCollisionDebugVertex(k,N,f,V,q,new C(s,c)),this._addCollisionDebugVertex(k,N,f,V,q,new C(e,c)),S.vertexLength+=4;const W=d.indexArray;W.emplaceBack(A,A+1),W.emplaceBack(A+1,A+2),W.emplaceBack(A+2,A+3),W.emplaceBack(A+3,A),S.primitiveLength+=4}addDebugCollisionBoxes(e,r,s,c){for(let d=e;d<r;d++){const f=this.collisionBoxArray.get(d);this.addCollisionDebugVertices(f.x1,f.y1,f.x2,f.y2,c?this.textCollisionBox:this.iconCollisionBox,f.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Tf(Ve,Rm.members,bt),this.iconCollisionBox=new Tf(Ve,Rm.members,bt);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,s,c,d,f,y,S,A){const k={};for(let N=r;N<s;N++){const V=e.get(N);k.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},k.textFeatureIndex=V.featureIndex;break}for(let N=c;N<d;N++){const V=e.get(N);k.verticalTextBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},k.verticalTextFeatureIndex=V.featureIndex;break}for(let N=f;N<y;N++){const V=e.get(N);k.iconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},k.iconFeatureIndex=V.featureIndex;break}for(let N=S;N<A;N++){const V=e.get(N);k.verticalIconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},k.verticalIconFeatureIndex=V.featureIndex;break}return k}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),c=s.vertexStartIndex+4*s.numGlyphs;for(let d=s.vertexStartIndex;d<c;d+=4)e.indexArray.emplaceBack(d,d+2,d+1),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),c=[],d=[],f=[];for(let y=0;y<this.symbolInstances.length;++y){f.push(y);const S=this.symbolInstances.get(y);c.push(0|Math.round(r*S.anchorX+s*S.anchorY)),d.push(S.featureIndex)}return f.sort((y,S)=>c[y]-c[S]||d[S]-d[y]),f}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((c,d,f)=>{c>=0&&f.indexOf(c)===d&&this.addIndicesForPlacedSymbol(this.text,c)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Xm,Ym;ke("SymbolBucket",Vu,{omit:["layers","collisionBoxArray","features","compareText"]}),Vu.MAX_GLYPHS=65535,Vu.addDynamicAttributes=wf;var Pf={get paint(){return Ym=Ym||new Di({"icon-opacity":new hr(ae.paint_symbol["icon-opacity"]),"icon-color":new hr(ae.paint_symbol["icon-color"]),"icon-halo-color":new hr(ae.paint_symbol["icon-halo-color"]),"icon-halo-width":new hr(ae.paint_symbol["icon-halo-width"]),"icon-halo-blur":new hr(ae.paint_symbol["icon-halo-blur"]),"icon-translate":new cr(ae.paint_symbol["icon-translate"]),"icon-translate-anchor":new cr(ae.paint_symbol["icon-translate-anchor"]),"text-opacity":new hr(ae.paint_symbol["text-opacity"]),"text-color":new hr(ae.paint_symbol["text-color"],{runtimeType:Oi,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new hr(ae.paint_symbol["text-halo-color"]),"text-halo-width":new hr(ae.paint_symbol["text-halo-width"]),"text-halo-blur":new hr(ae.paint_symbol["text-halo-blur"]),"text-translate":new cr(ae.paint_symbol["text-translate"]),"text-translate-anchor":new cr(ae.paint_symbol["text-translate-anchor"])})},get layout(){return Xm=Xm||new Di({"symbol-placement":new cr(ae.layout_symbol["symbol-placement"]),"symbol-spacing":new cr(ae.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new cr(ae.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new hr(ae.layout_symbol["symbol-sort-key"]),"symbol-z-order":new cr(ae.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new cr(ae.layout_symbol["icon-allow-overlap"]),"icon-overlap":new cr(ae.layout_symbol["icon-overlap"]),"icon-ignore-placement":new cr(ae.layout_symbol["icon-ignore-placement"]),"icon-optional":new cr(ae.layout_symbol["icon-optional"]),"icon-rotation-alignment":new cr(ae.layout_symbol["icon-rotation-alignment"]),"icon-size":new hr(ae.layout_symbol["icon-size"]),"icon-text-fit":new cr(ae.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new cr(ae.layout_symbol["icon-text-fit-padding"]),"icon-image":new hr(ae.layout_symbol["icon-image"]),"icon-rotate":new hr(ae.layout_symbol["icon-rotate"]),"icon-padding":new hr(ae.layout_symbol["icon-padding"]),"icon-keep-upright":new cr(ae.layout_symbol["icon-keep-upright"]),"icon-offset":new hr(ae.layout_symbol["icon-offset"]),"icon-anchor":new hr(ae.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new cr(ae.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new cr(ae.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new cr(ae.layout_symbol["text-rotation-alignment"]),"text-field":new hr(ae.layout_symbol["text-field"]),"text-font":new hr(ae.layout_symbol["text-font"]),"text-size":new hr(ae.layout_symbol["text-size"]),"text-max-width":new hr(ae.layout_symbol["text-max-width"]),"text-line-height":new cr(ae.layout_symbol["text-line-height"]),"text-letter-spacing":new hr(ae.layout_symbol["text-letter-spacing"]),"text-justify":new hr(ae.layout_symbol["text-justify"]),"text-radial-offset":new hr(ae.layout_symbol["text-radial-offset"]),"text-variable-anchor":new cr(ae.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new hr(ae.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new hr(ae.layout_symbol["text-anchor"]),"text-max-angle":new cr(ae.layout_symbol["text-max-angle"]),"text-writing-mode":new cr(ae.layout_symbol["text-writing-mode"]),"text-rotate":new hr(ae.layout_symbol["text-rotate"]),"text-padding":new cr(ae.layout_symbol["text-padding"]),"text-keep-upright":new cr(ae.layout_symbol["text-keep-upright"]),"text-transform":new hr(ae.layout_symbol["text-transform"]),"text-offset":new hr(ae.layout_symbol["text-offset"]),"text-allow-overlap":new cr(ae.layout_symbol["text-allow-overlap"]),"text-overlap":new cr(ae.layout_symbol["text-overlap"]),"text-ignore-placement":new cr(ae.layout_symbol["text-ignore-placement"]),"text-optional":new cr(ae.layout_symbol["text-optional"])})}};class Jm{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Zi,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ke("FormatSectionOverride",Jm,{omit:["defaultValue"]});class ud extends li{constructor(e,r){super(e,Pf,r)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const c=[];for(const d of s)c.indexOf(d)<0&&c.push(d);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,c){const d=this.layout.get(e).evaluate(r,{},s,c),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||Ga(f.value)||!d?d:function(y,S){return S.replace(/{([^{}]+)}/g,(A,k)=>y&&k in y?String(y[k]):"")}(r.properties,d)}createBucket(e){return new Vu(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Pf.paint.overridableProperties){if(!ud.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new Jm(r),c=new Kl(s,r.property.specification);let d=null;d=r.value.kind==="constant"||r.value.kind==="source"?new Tc("source",c):new tu("composite",c,r.value.zoomStops),this.paint._values[e]=new ii(r.property,d,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&ud.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),c=Pf.paint.properties[r];let d=!1;const f=y=>{for(const S of y)if(c.overrides&&c.overrides.hasOverride(S))return void(d=!0)};if(s.value.kind==="constant"&&s.value.value instanceof zr)f(s.value.value.sections);else if(s.value.kind==="source"||s.value.kind==="composite"){const y=A=>{d||(A instanceof os&&Mi(A.value)===va?f(A.value.sections):A instanceof Ba?f(A.sections):A.eachChild(y))},S=s.value;S._styleExpression&&y(S._styleExpression.expression)}return d}}let Km;var Mv={get paint(){return Km=Km||new Di({"background-color":new cr(ae.paint_background["background-color"]),"background-pattern":new Rs(ae.paint_background["background-pattern"]),"background-opacity":new cr(ae.paint_background["background-opacity"])})}};class Cv extends li{constructor(e,r){super(e,Mv,r)}}class kv extends li{constructor(e,r){super(e,{},r),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Dv{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Fv={once:!0},Af=63710088e-1;class Nc{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Nc(ut(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,c=e.lat*r,d=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos((e.lng-this.lng)*r);return Af*Math.acos(Math.min(d,1))}static convert(e){if(e instanceof Nc)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Nc(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Nc(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Qm=2*Math.PI*Af;function eg(i){return Qm*Math.cos(i*Math.PI/180)}function tg(i){return(180+i)/360}function rg(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function ig(i,e){return i/eg(e)}function ng(i){return 360*i-180}function hd(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function sg(i,e){return i*eg(hd(e))}class Lh{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=Nc.convert(e);return new Lh(tg(s.lng),rg(s.lat),ig(r,s.lat))}toLngLat(){return new Nc(ng(this.x),hd(this.y))}toAltitude(){return sg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Qm*(e=hd(this.y),1/Math.cos(e*Math.PI/180));var e}}function ag(i,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class If{constructor(e,r,s){if(!function(c,d,f){return!(c<0||c>25||f<0||f>=Math.pow(2,c)||d<0||d>=Math.pow(2,c))}(e,r,s))throw new Error(`x=${r}, y=${s}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=s,this.key=qu(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,s){const c=function(f,y,S){var A=ag(256*f,256*(y=Math.pow(2,S)-y-1),S),k=ag(256*(f+1),256*(y+1),S);return A[0]+","+A[1]+","+k[0]+","+k[1]}(this.x,this.y,this.z),d=function(f,y,S){let A,k="";for(let N=f;N>0;N--)A=1<<N-1,k+=(y&A?1:0)+(S&A?2:0);return k}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,d).replace(/{bbox-epsg-3857}/g,c)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new C((e.x*r-this.x)*vt,(e.y*r-this.y)*vt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class og{constructor(e,r){this.wrap=e,this.canonical=r,this.key=qu(e,r.z,r.z,r.x,r.y)}}class Xa{constructor(e,r,s,c,d){if(this.terrainRttPosMatrix32f=null,e<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${s}`);this.overscaledZ=e,this.wrap=r,this.canonical=new If(s,+c,+d),this.key=qu(r,e,s,c,d)}clone(){return new Xa(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new Xa(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xa(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?qu(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):qu(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const r=this.canonical.z-e.canonical.z;return!(r<0)&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Xa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,c=2*this.canonical.y;return[new Xa(r,this.wrap,r,s,c),new Xa(r,this.wrap,r,s+1,c),new Xa(r,this.wrap,r,s,c+1),new Xa(r,this.wrap,r,s+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Xa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Xa(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new og(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Lh(e.x-this.wrap,e.y))}}function qu(i,e,r,s,c){(i*=2)<0&&(i=-1*i-1);const d=1<<r;return(d*d*i+d*c+s).toString(36)+r.toString(36)+e.toString(36)}function Mh(i,e){return e?i.properties[e]:i.id}function Rv(i,e){const r={id:i.id};if(e.removeAllProperties&&(delete i.removeProperties,delete i.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const s of e.removeProperties){const c=i.addOrUpdateProperties.findIndex(d=>d.key===s);c>-1&&i.addOrUpdateProperties.splice(c,1)}return(i.removeAllProperties||e.removeAllProperties)&&(r.removeAllProperties=!0),(i.removeProperties||e.removeProperties)&&(r.removeProperties=[...i.removeProperties||[],...e.removeProperties||[]]),(i.addOrUpdateProperties||e.addOrUpdateProperties)&&(r.addOrUpdateProperties=[...i.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(i.newGeometry||e.newGeometry)&&(r.newGeometry=e.newGeometry||i.newGeometry),r}function lg(i){var e,r;if(!i)return{};const s={};return s.removeAll=i.removeAll,s.remove=new Set(i.remove||[]),s.add=new Map((e=i.add)===null||e===void 0?void 0:e.map(c=>[c.id,c])),s.update=new Map((r=i.update)===null||r===void 0?void 0:r.map(c=>[c.id,c])),s}ke("CanonicalTileID",If),ke("OverscaledTileID",Xa,{omit:["terrainRttPosMatrix32f"]});class cg{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class ug{constructor(e,r,s,c,d){this.type="Feature",this._vectorTileFeature=e,this._x=s,this._y=c,this._z=r,this.properties=e.properties,this.id=d}projectPoint(e,r,s,c){return[360*(e.x+r)/c-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+s)/c)*Math.PI))-90]}projectLine(e,r,s,c){return e.map(d=>this.projectPoint(d,r,s,c))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,r=e.extent*Math.pow(2,this._z),s=e.extent*this._x,c=e.extent*this._y,d=e.loadGeometry();switch(e.type){case 1:{const f=[];for(const S of d)f.push(S[0]);const y=this.projectLine(f,s,c,r);this._geometry=f.length===1?{type:"Point",coordinates:y[0]}:{type:"MultiPoint",coordinates:y};break}case 2:{const f=d.map(y=>this.projectLine(y,s,c,r));this._geometry=f.length===1?{type:"LineString",coordinates:f[0]}:{type:"MultiLineString",coordinates:f};break}case 3:{const f=Pm(d),y=[];for(const S of f)y.push(S.map(A=>this.projectLine(A,s,c,r)));this._geometry=y.length===1?{type:"Polygon",coordinates:y[0]}:{type:"MultiPolygon",coordinates:y};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&r!=="_x"&&r!=="_y"&&r!=="_z"&&(e[r]=this[r]);return e}}class Gu{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,r,s){this._name=e,this.dataBuffer=r,typeof s=="number"?this._size=s:(this.nullabilityBuffer=s,this._size=s.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class dd extends Gu{}class Ef extends dd{getValueFromBuffer(e){return this.dataBuffer[e]}}class Lf extends dd{getValueFromBuffer(e){return this.dataBuffer[e]}}class hg extends Gu{delta;constructor(e,r,s,c){super(e,r,c),this.delta=s}}class Mf extends hg{constructor(e,r,s,c){super(e,Int32Array.of(r),s,c)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class Cf extends Gu{constructor(e,r,s){super(e,Int32Array.of(r),s)}getValueFromBuffer(e){return this.dataBuffer[0]}}class zv{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,r,s,c,d=4096){this._name=e,this._geometryVector=r,this._idVector=s,this._propertyVectors=c,this._extent=d}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map(r=>[r.name,r]))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let r=0;for(;r<this.numFeatures;){let s;this.idVector&&(s=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(r)):this.idVector.getValue(r));const c=e?.next().value,d={};for(const f of this.propertyVectors){if(!f)continue;const y=f.name,S=f.getValue(r);S!==null&&(d[y]=S)}r++,yield{id:s,geometry:c,properties:d}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],r=this.geometryVector.getGeometries();for(let s=0;s<this.numFeatures;s++){let c;this.idVector&&(c=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(s)):this.idVector.getValue(s));const d={coordinates:r[s],type:this.geometryVector.geometryType(s)},f={};for(const y of this.propertyVectors){if(!y)continue;const S=y.name,A=y.getValue(s);A!==null&&(f[S]=A)}e.push({id:c,geometry:d,properties:f})}return e}containsMaxSaveIntegerValues(e){return e instanceof Ef||e instanceof Cf&&e instanceof Mf||e instanceof Lf}}class Nv{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var hi,dc,Ss,rl,fu,ka,rs,is,dg,Ya;function gs(i,e,r){const s=new Int32Array(r);let c=0,d=e.get();for(let f=0;f<s.length;f++){let y=i[d++],S=127&y;y<128||(y=i[d++],S|=(127&y)<<7,y<128||(y=i[d++],S|=(127&y)<<14,y<128||(y=i[d++],S|=(127&y)<<21,y<128||(y=i[d++],S|=(15&y)<<28)))),s[c++]=S}return e.set(d),s}function fd(i,e,r){const s=new BigInt64Array(r);for(let c=0;c<s.length;c++)s[c]=Bv(i,e);return s}function Ov(i,e){let r,s;return s=i[e.get()],e.increment(),r=127&s,s<128?r:(s=i[e.get()],e.increment(),r|=(127&s)<<7,s<128?r:(s=i[e.get()],e.increment(),r|=(127&s)<<14,s<128?r:(s=i[e.get()],e.increment(),r|=(127&s)<<21,s<128?r:(s=i[e.get()],r|=(15&s)<<28,function(c,d,f){let y,S;if(S=d[f.get()],f.increment(),y=(112&S)>>4,S<128||(S=d[f.get()],f.increment(),y|=(127&S)<<3,S<128)||(S=d[f.get()],f.increment(),y|=(127&S)<<10,S<128)||(S=d[f.get()],f.increment(),y|=(127&S)<<17,S<128)||(S=d[f.get()],f.increment(),y|=(127&S)<<24,S<128)||(S=d[f.get()],f.increment(),y|=(1&S)<<31,S<128))return 4294967296*y+(c>>>0);throw new Error("Expected varint not more than 10 bytes")}(r,i,e)))))}function fg(i,e,r,s){throw new Error("FastPFor is not implemented yet.")}function pu(i){return i>>>1^-(1&i)}function $u(i){return i>>1n^-(1n&i)}function Bv(i,e){let r=0n,s=0,c=e.get();for(;c<i.length;){const d=i[c++];if(r|=BigInt(127&d)<<BigInt(s),!(128&d))break;if(s+=7,s>=64)throw new Error("Varint too long")}return e.set(c),r}function pg(i,e,r){const s=new Int32Array(r);let c=0;for(let d=0;d<e;d++){const f=i[d];s.fill(i[d+e],c,c+f),c+=f}return s}function mg(i,e,r){const s=new BigInt64Array(r);let c=0;for(let d=0;d<e;d++){const f=Number(i[d]);s.fill(i[d+e],c,c+f),c+=f}return s}function gg(i,e,r){const s=new Float64Array(r);let c=0;for(let d=0;d<e;d++){const f=i[d];s.fill(i[d+e],c,c+f),c+=f}return s}function kf(i){const e=i.length/4*4;let r=1;if(e>=4)for(let s=i[0];r<e-4;r+=4)s=i[r]+=s,s=i[r+1]+=s,s=i[r+2]+=s,s=i[r+3]+=s;for(;r!=i.length;)i[r]+=i[r-1],++r}function _g(i){i[0]=i[0]>>>1^-(1&i[0]),i[1]=i[1]>>>1^-(1&i[1]);const e=i.length/4*4;let r=2;if(e>=4)for(;r<e-4;r+=4){const s=i[r],c=i[r+1],d=i[r+2],f=i[r+3];i[r]=(s>>>1^-(1&s))+i[r-2],i[r+1]=(c>>>1^-(1&c))+i[r-1],i[r+2]=(d>>>1^-(1&d))+i[r],i[r+3]=(f>>>1^-(1&f))+i[r+1]}for(;r!=i.length;r+=2)i[r]=(i[r]>>>1^-(1&i[r]))+i[r-2],i[r+1]=(i[r+1]>>>1^-(1&i[r+1]))+i[r-1]}(function(i){i.NONE="NONE",i.DELTA="DELTA",i.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",i.RLE="RLE",i.MORTON="MORTON",i.PDE="PDE"})(hi||(hi={})),function(i){i.NONE="NONE",i.FAST_PFOR="FAST_PFOR",i.VARINT="VARINT",i.ALP="ALP"}(dc||(dc={})),function(i){i.PRESENT="PRESENT",i.DATA="DATA",i.OFFSET="OFFSET",i.LENGTH="LENGTH"}(Ss||(Ss={}));class Df{_dictionaryType;_offsetType;_lengthType;constructor(e,r,s){this._dictionaryType=e,this._offsetType=r,this._lengthType=s}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Ks(i,e){const r=function(s,c){const d=s[c.get()],f=Object.values(Ss)[d>>4];let y=null;switch(f){case Ss.DATA:y=new Df(Object.values(rl)[15&d]);break;case Ss.OFFSET:y=new Df(null,Object.values(fu)[15&d]);break;case Ss.LENGTH:y=new Df(null,null,Object.values(ka)[15&d])}c.increment();const S=s[c.get()],A=Object.values(hi)[S>>5],k=Object.values(hi)[S>>2&7],N=Object.values(dc)[3&S];c.increment();const V=gs(s,c,2),q=V[0];return{physicalStreamType:f,logicalStreamType:y,logicalLevelTechnique1:A,logicalLevelTechnique2:k,physicalLevelTechnique:N,numValues:q,byteLength:V[1],decompressedCount:q}}(i,e);return r.logicalLevelTechnique1===hi.MORTON?function(s,c,d){const f=gs(c,d,2);return{physicalStreamType:s.physicalStreamType,logicalStreamType:s.logicalStreamType,logicalLevelTechnique1:s.logicalLevelTechnique1,logicalLevelTechnique2:s.logicalLevelTechnique2,physicalLevelTechnique:s.physicalLevelTechnique,numValues:s.numValues,byteLength:s.byteLength,decompressedCount:s.decompressedCount,numBits:f[0],coordinateShift:f[1]}}(r,i,e):hi.RLE!==r.logicalLevelTechnique1&&hi.RLE!==r.logicalLevelTechnique2||dc.NONE===r.physicalLevelTechnique?r:function(s,c,d){const f=gs(c,d,2);return{physicalStreamType:s.physicalStreamType,logicalStreamType:s.logicalStreamType,logicalLevelTechnique1:s.logicalLevelTechnique1,logicalLevelTechnique2:s.logicalLevelTechnique2,physicalLevelTechnique:s.physicalLevelTechnique,numValues:s.numValues,byteLength:s.byteLength,decompressedCount:f[1],runs:f[0],numRleValues:f[1]}}(r,i,e)}(function(i){i.NONE="NONE",i.SINGLE="SINGLE",i.SHARED="SHARED",i.VERTEX="VERTEX",i.MORTON="MORTON",i.FSST="FSST"})(rl||(rl={})),function(i){i.VERTEX="VERTEX",i.INDEX="INDEX",i.STRING="STRING",i.KEY="KEY"}(fu||(fu={})),function(i){i.VAR_BINARY="VAR_BINARY",i.GEOMETRIES="GEOMETRIES",i.PARTS="PARTS",i.RINGS="RINGS",i.TRIANGLES="TRIANGLES",i.SYMBOL="SYMBOL",i.DICTIONARY="DICTIONARY"}(ka||(ka={})),function(i){i[i.FLAT=0]="FLAT",i[i.CONST=1]="CONST",i[i.SEQUENCE=2]="SEQUENCE",i[i.DICTIONARY=3]="DICTIONARY",i[i.FSST_DICTIONARY=4]="FSST_DICTIONARY"}(rs||(rs={}));class il{values;_size;constructor(e,r){this.values=e,this._size=r}get(e){const r=Math.floor(e/8);return(this.values[r]>>e%8&1)==1}set(e,r){const s=Math.floor(e/8);this.values[s]=this.values[s]|(r?1:0)<<e%8}getInt(e){const r=Math.floor(e/8);return this.values[r]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function Qs(i,e,r,s,c){return function(d,f,y){switch(f.logicalLevelTechnique1){case hi.DELTA:return f.logicalLevelTechnique2===hi.RLE?function(S,A,k){const N=new Int32Array(k);let V=0,q=0;for(let W=0;W<A;W++){const H=S[W],J=pu(S[W+A]);for(let ue=0;ue<H;ue++)q+=J,N[V++]=q}return N}(d,f.runs,f.numRleValues):(function(S){S[0]=S[0]>>>1^-(1&S[0]);const A=S.length/4*4;let k=1;if(A>=4)for(;k<A-4;k+=4){const N=S[k],V=S[k+1],q=S[k+2],W=S[k+3];S[k]=(N>>>1^-(1&N))+S[k-1],S[k+1]=(V>>>1^-(1&V))+S[k],S[k+2]=(q>>>1^-(1&q))+S[k+1],S[k+3]=(W>>>1^-(1&W))+S[k+2]}for(;k!=S.length;++k)S[k]=(S[k]>>>1^-(1&S[k]))+S[k-1]}(d),d);case hi.RLE:return function(S,A,k){return k?function(N,V,q){const W=new Int32Array(q);let H=0;for(let J=0;J<V;J++){const ue=N[J];let Ne=N[J+V];Ne=Ne>>>1^-(1&Ne),W.fill(Ne,H,H+ue),H+=ue}return W}(S,A.runs,A.numRleValues):pg(S,A.runs,A.numRleValues)}(d,f,y);case hi.MORTON:return kf(d),d;case hi.COMPONENTWISE_DELTA:return _g(d),d;case hi.NONE:return y&&function(S){for(let A=0;A<S.length;A++){const k=S[A];S[A]=k>>>1^-(1&k)}}(d),d;default:throw new Error(`The specified Logical level technique is not supported: ${f.logicalLevelTechnique1}`)}}(pd(i,e,r),r,s)}function Oc(i,e,r){return function(s,c){if(c.logicalLevelTechnique1===hi.DELTA&&c.logicalLevelTechnique2===hi.NONE)return function(f){const y=new Int32Array(f.length+1);y[0]=0,y[1]=pu(f[0]);let S=y[1],A=2;for(;A!=y.length;++A){const k=f[A-1];S+=k>>>1^-(1&k),y[A]=y[A-1]+S}return y}(s);if(c.logicalLevelTechnique1===hi.RLE&&c.logicalLevelTechnique2===hi.NONE)return function(f,y,S){const A=new Int32Array(S+1);A[0]=0;let k=1,N=A[0];for(let V=0;V<y;V++){const q=f[V],W=f[V+y];for(let H=k;H<k+q;H++)A[H]=W+N,N=A[H];k+=q}return A}(s,c.runs,c.numRleValues);if(c.logicalLevelTechnique1===hi.NONE&&c.logicalLevelTechnique2===hi.NONE){(function(f){let y=0;for(let S=0;S<f.length;S++)f[S]+=y,y=f[S]})(s);const d=new Int32Array(c.numValues+1);return d[0]=0,d.set(s,1),d}if(c.logicalLevelTechnique1===hi.DELTA&&c.logicalLevelTechnique2===hi.RLE){const d=function(f,y,S){const A=new Int32Array(S+1);A[0]=0;let k=1,N=A[0];for(let V=0;V<y;V++){const q=f[V];let W=f[V+y];W=W>>>1^-(1&W);for(let H=k;H<k+q;H++)A[H]=W+N,N=A[H];k+=q}return A}(s,c.runs,c.numRleValues);return kf(d),d}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")}(pd(i,e,r),r)}function pd(i,e,r){const s=r.physicalLevelTechnique;if(s===dc.FAST_PFOR)return fg();if(s===dc.VARINT)return gs(i,e,r.numValues);if(s===dc.NONE){const c=e.get();e.add(r.byteLength);const d=i.subarray(c,e.get());return new Int32Array(d)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function Ff(i,e,r,s){const c=pd(i,e,r);if(c.length===1){const d=c[0];return s?pu(d):d}return s?function(d){return pu(d[1])}(c):function(d){return d[1]}(c)}function yg(i,e,r){return function(s){if(s.length==2){const c=pu(s[1]);return[c,c]}return[pu(s[2]),pu(s[3])]}(pd(i,e,r))}function vg(i,e,r){return function(s){if(s.length==2){const c=$u(s[1]);return[c,c]}return[$u(s[2]),$u(s[3])]}(fd(i,e,r.numValues))}function bg(i,e,r,s){return function(c,d,f){switch(d.logicalLevelTechnique1){case hi.DELTA:return d.logicalLevelTechnique2===hi.RLE?function(y,S,A){const k=new BigInt64Array(A);let N=0,V=0n;for(let q=0;q<S;q++){const W=Number(y[q]),H=$u(y[q+S]);for(let J=0;J<W;J++)V+=H,k[N++]=V}return k}(c,d.runs,d.numRleValues):(function(y){y[0]=y[0]>>1n^-(1n&y[0]);const S=y.length/4*4;let A=1;if(S>=4)for(;A<S-4;A+=4){const k=y[A],N=y[A+1],V=y[A+2],q=y[A+3];y[A]=(k>>1n^-(1n&k))+y[A-1],y[A+1]=(N>>1n^-(1n&N))+y[A],y[A+2]=(V>>1n^-(1n&V))+y[A+1],y[A+3]=(q>>1n^-(1n&q))+y[A+2]}for(;A!=y.length;++A)y[A]=(y[A]>>1n^-(1n&y[A]))+y[A-1]}(c),c);case hi.RLE:return function(y,S,A){return A?function(k,N,V){const q=new BigInt64Array(V);let W=0;for(let H=0;H<N;H++){const J=Number(k[H]);let ue=k[H+N];ue=ue>>1n^-(1n&ue),q.fill(ue,W,W+J),W+=J}return q}(y,S.runs,S.numRleValues):mg(y,S.runs,S.numRleValues)}(c,d,f);case hi.NONE:return f&&function(y){for(let S=0;S<y.length;S++){const A=y[S];y[S]=A>>1n^-(1n&A)}}(c),c;default:throw new Error(`The specified Logical level technique is not supported: ${d.logicalLevelTechnique1}`)}}(fd(i,e,r.numValues),r,s)}function xg(i,e,r,s){const c=fd(i,e,r.numValues);if(c.length===1){const d=c[0];return s?$u(d):d}return s?function(d){return $u(d[1])}(c):function(d){return d[1]}(c)}function Rf(i,e,r,s,c){return function(d,f,y,S){switch(f.logicalLevelTechnique1){case hi.DELTA:return f.logicalLevelTechnique2===hi.RLE&&(d=pg(d,f.runs,f.numRleValues)),function(A,k){const N=new Int32Array(A.size());let V=0;A.get(0)?(N[0]=A.get(0)?k[0]>>>1^-(1&k[0]):0,V=1):N[0]=0;let q=1;for(;q!=N.length;++q)N[q]=A.get(q)?N[q-1]+(k[V]>>>1^-(1&k[V++])):N[q-1];return N}(S,d);case hi.RLE:return function(A,k,N,V){const q=k;return N?function(W,H,J){const ue=new Int32Array(W.size());let Ne=0;for(let de=0;de<J;de++){const ye=H[de];let je=H[de+J];je=je>>>1^-(1&je);for(let Ke=Ne;Ke<Ne+ye;Ke++)W.get(Ke)?ue[Ke]=je:(ue[Ke]=0,Ne++);Ne+=ye}return ue}(V,A,q.runs):function(W,H,J){const ue=new Int32Array(W.size());let Ne=0;for(let de=0;de<J;de++){const ye=H[de],je=H[de+J];for(let Ke=Ne;Ke<Ne+ye;Ke++)W.get(Ke)?ue[Ke]=je:(ue[Ke]=0,Ne++);Ne+=ye}return ue}(V,A,q.runs)}(d,f,y,S);case hi.MORTON:return kf(d),d;case hi.COMPONENTWISE_DELTA:return _g(d),d;case hi.NONE:return d=y?function(A,k){const N=new Int32Array(A.size());let V=0,q=0;for(;q!=N.length;++q)if(A.get(q)){const W=k[V++];N[q]=W>>>1^-(1&W)}else N[q]=0;return N}(S,d):function(A,k){const N=new Int32Array(A.size());let V=0,q=0;for(;q!=N.length;++q)N[q]=A.get(q)?k[V++]:0;return N}(S,d),d;default:throw new Error("The specified Logical level technique is not supported")}}(r.physicalLevelTechnique===dc.FAST_PFOR?fg():gs(i,e,r.numValues),r,s,c)}function md(i,e,r,s){const c=i.logicalLevelTechnique1;if(c===hi.RLE)return i.runs===1?rs.CONST:rs.FLAT;const d=e instanceof il?e.size():e;if(c===hi.DELTA&&i.logicalLevelTechnique2===hi.RLE){const f=i.runs,y=2;if(i.numRleValues!==d)return rs.FLAT;if(f===1)return rs.SEQUENCE;if(f===2){const S=s.get();let A;if(i.physicalLevelTechnique===dc.VARINT)A=gs(r,s,4);else{const k=s.get();A=new Int32Array(r.buffer,r.byteOffset+k,4)}if(s.set(S),A[2]===y&&A[3]===y)return rs.SEQUENCE}}return i.numValues===1?rs.CONST:rs.FLAT}class wg extends dd{getValueFromBuffer(e){return this.dataBuffer[e]}}class Sg extends hg{constructor(e,r,s,c){super(e,BigInt64Array.of(r),s,c)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class Zu{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,r,s){this._geometryOffsets=e,this._partOffsets=r,this._ringOffsets=s}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function zf(i,e,r){return{x:Tg(i,e)-r,y:Tg(i>>1,e)-r}}function Tg(i,e){let r=0;for(let s=0;s<e;s++)r|=(i&1<<2*s)>>s;return r}(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON",i[i.MULTIPOINT=3]="MULTIPOINT",i[i.MULTILINESTRING=4]="MULTILINESTRING",i[i.MULTIPOLYGON=5]="MULTIPOLYGON"})(is||(is={})),function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON"}(dg||(dg={})),function(i){i[i.MORTON=0]="MORTON",i[i.VEC_2=1]="VEC_2",i[i.VEC_3=2]="VEC_3"}(Ya||(Ya={}));class jv{createPoint(e){return[[e]]}createMultiPoint(e){return e.map(r=>[r])}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,r){return[e].concat(r)}createMultiPolygon(e){return e.flat()}}function Pg(i){const e=new Array(i.numGeometries);let r=1,s=1,c=1,d=0;const f=new jv;let y=0,S=0;const A=i.mortonSettings,k=i.topologyVector,N=k.geometryOffsets,V=k.partOffsets,q=k.ringOffsets,W=i.vertexOffsets,H=i.containsPolygonGeometry(),J=i.vertexBuffer;for(let ue=0;ue<i.numGeometries;ue++){const Ne=i.geometryType(ue);if(Ne===is.POINT){if(W&&W.length!==0)if(i.vertexBufferType===Ya.VEC_2){const de=2*W[S++],ye=new C(J[de],J[de+1]);e[d++]=f.createPoint(ye)}else{const de=zf(J[W[S++]],A.numBits,A.coordinateShift),ye=new C(de.x,de.y);e[d++]=f.createPoint(ye)}else{const de=new C(J[y++],J[y++]);e[d++]=f.createPoint(de)}N&&c++,V&&r++,q&&s++}else if(Ne===is.MULTIPOINT){const de=N[c]-N[c-1];c++;const ye=new Array(de);if(W&&W.length!==0){for(let je=0;je<de;je++){const Ke=2*W[S++];ye[je]=new C(J[Ke],J[Ke+1])}e[d++]=f.createMultiPoint(ye)}else{for(let je=0;je<de;je++){const Ke=J[y++],xt=J[y++];ye[je]=new C(Ke,xt)}e[d++]=f.createMultiPoint(ye)}}else if(Ne===is.LINESTRING){let de,ye=0;H?(ye=q[s]-q[s-1],s++):ye=V[r]-V[r-1],r++,W&&W.length!==0?(de=i.vertexBufferType===Ya.VEC_2?Of(J,W,S,ye,!1):Bf(J,W,S,ye,!1,A),S+=ye):(de=Nf(J,y,ye,!1),y+=2*ye),e[d++]=f.createLineString(de),N&&c++}else if(Ne===is.POLYGON){const de=V[r]-V[r-1];r++;const ye=new Array(de-1);let je=q[s]-q[s-1];if(s++,W&&W.length!==0){const Ke=i.vertexBufferType===Ya.VEC_2?_d(J,W,S,je):yd(J,W,S,je,0,A);S+=je;for(let xt=0;xt<ye.length;xt++)je=q[s]-q[s-1],s++,ye[xt]=i.vertexBufferType===Ya.VEC_2?_d(J,W,S,je):yd(J,W,S,je,0,A),S+=je;e[d++]=f.createPolygon(Ke,ye)}else{const Ke=gd(J,y,je);y+=2*je;for(let xt=0;xt<ye.length;xt++)je=q[s]-q[s-1],s++,ye[xt]=gd(J,y,je),y+=2*je;e[d++]=f.createPolygon(Ke,ye)}N&&c++}else if(Ne===is.MULTILINESTRING){const de=N[c]-N[c-1];c++;const ye=new Array(de);if(W&&W.length!==0){for(let je=0;je<de;je++){let Ke=0;H?(Ke=q[s]-q[s-1],s++):Ke=V[r]-V[r-1],r++;const xt=i.vertexBufferType===Ya.VEC_2?Of(J,W,S,Ke,!1):Bf(J,W,S,Ke,!1,A);ye[je]=xt,S+=Ke}e[d++]=f.createMultiLineString(ye)}else{for(let je=0;je<de;je++){let Ke=0;H?(Ke=q[s]-q[s-1],s++):Ke=V[r]-V[r-1],r++,ye[je]=Nf(J,y,Ke,!1),y+=2*Ke}e[d++]=f.createMultiLineString(ye)}}else{if(Ne!==is.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const de=N[c]-N[c-1];c++;const ye=new Array(de);let je=0;if(W&&W.length!==0){for(let Ke=0;Ke<de;Ke++){const xt=V[r]-V[r-1];r++;const Vt=new Array(xt-1);je=q[s]-q[s-1],s++;const zt=i.vertexBufferType===Ya.VEC_2?_d(J,W,S,je):yd(J,W,S,je,0,A);S+=je;for(let Xt=0;Xt<Vt.length;Xt++)je=q[s]-q[s-1],s++,Vt[Xt]=i.vertexBufferType===Ya.VEC_2?_d(J,W,S,je):yd(J,W,S,je,0,A),S+=je;ye[Ke]=f.createPolygon(zt,Vt)}e[d++]=f.createMultiPolygon(ye)}else{for(let Ke=0;Ke<de;Ke++){const xt=V[r]-V[r-1];r++;const Vt=new Array(xt-1);je=q[s]-q[s-1],s++;const zt=gd(J,y,je);y+=2*je;for(let Xt=0;Xt<Vt.length;Xt++){const lr=q[s]-q[s-1];s++,Vt[Xt]=gd(J,y,lr),y+=2*lr}ye[Ke]=f.createPolygon(zt,Vt)}e[d++]=f.createMultiPolygon(ye)}}}}return e}function gd(i,e,r){return Nf(i,e,r,!0)}function _d(i,e,r,s){return Of(i,e,r,s,!0)}function yd(i,e,r,s,c,d){return Bf(i,e,r,s,!0,d)}function Nf(i,e,r,s){const c=new Array(s?r+1:r);for(let d=0;d<2*r;d+=2)c[d/2]=new C(i[e+d],i[e+d+1]);return s&&(c[c.length-1]=c[0]),c}function Of(i,e,r,s,c){const d=new Array(c?s+1:s);for(let f=0;f<2*s;f+=2){const y=2*e[r+f/2];d[f/2]=new C(i[y],i[y+1])}return c&&(d[d.length-1]=d[0]),d}function Bf(i,e,r,s,c,d){const f=new Array(c?s+1:s);for(let y=0;y<s;y++){const S=zf(i[e[r+y]],d.numBits,d.coordinateShift);f[y]=new C(S.x,S.y)}return c&&(f[f.length-1]=f[0]),f}class Ag{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,r,s,c,d){this._vertexBufferType=e,this._topologyVector=r,this._vertexOffsets=s,this._vertexBuffer=c,this._mortonSettings=d}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=Pg(this);let r=0;for(;r<this.numGeometries;)yield{coordinates:e[r],type:this.geometryType(r)},r++}getSimpleEncodedVertex(e){const r=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[r],this.vertexBuffer[r+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const s=zf(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[s.x,s.y]}const r=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[r],this.vertexBuffer[r+1]]}getGeometries(){return Pg(this)}get mortonSettings(){return this._mortonSettings}}class Ig extends Ag{_numGeometries;_geometryType;constructor(e,r,s,c,d,f,y){super(s,c,d,f,y),this._numGeometries=e,this._geometryType=r}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===is.POLYGON||this._geometryType===is.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Eg extends Ag{_geometryTypes;constructor(e,r,s,c,d,f){super(e,s,c,d,f),this._geometryTypes=r}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===is.POLYGON||this.geometryType(e)===is.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Lg{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,r,s,c){this._triangleOffsets=e,this._indexBuffer=r,this._vertexBuffer=s,this._topologyVector=c}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),r=this._topologyVector,s=r.partOffsets,c=r.ringOffsets,d=r.geometryOffsets;let f=0,y=1,S=1,A=1;for(let k=0;k<this.numGeometries;k++)switch(this.geometryType(k)){case is.POLYGON:{const N=s[y]-s[y-1];y++;const V=[];for(let q=0;q<N;q++){const W=c[S]-c[S-1];S++;const H=[];for(let J=0;J<W;J++){const ue=this._vertexBuffer[f++],Ne=this._vertexBuffer[f++];H.push(new C(ue,Ne))}H.length>0&&H.push(H[0]),V.push(H)}e[k]=V,d&&A++}break;case is.MULTIPOLYGON:{const N=d[A]-d[A-1];A++;const V=[];for(let q=0;q<N;q++){const W=s[y]-s[y-1];y++;for(let H=0;H<W;H++){const J=c[S]-c[S-1];S++;const ue=[];for(let Ne=0;Ne<J;Ne++){const de=this._vertexBuffer[f++],ye=this._vertexBuffer[f++];ue.push(new C(de,ye))}ue.length>0&&ue.push(ue[0]),V.push(ue)}}e[k]=V}}return e}[Symbol.iterator](){return null}}function Mg(i,e,r,s,c,d){return new Uv(i,e,r,s,c,d)}class Uv extends Lg{_numGeometries;_geometryType;constructor(e,r,s,c,d,f){super(s,c,d,f),this._numGeometries=e,this._geometryType=r}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function Cg(i,e,r,s,c){return new Vv(i,e,r,s,c)}class Vv extends Lg{_geometryTypes;constructor(e,r,s,c,d){super(r,s,c,d),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function qv(i,e,r,s,c){const d=Ks(i,r);let f=null,y=null,S=null,A=null,k=null,N=null,V=null,q=null;if(md(d,s,i,r)===rs.CONST){const H=Ff(i,r,d,!1);for(let J=0;J<e-1;J++){const ue=Ks(i,r);switch(ue.physicalStreamType){case Ss.LENGTH:switch(ue.logicalStreamType.lengthType){case ka.GEOMETRIES:f=Oc(i,r,ue);break;case ka.PARTS:y=Oc(i,r,ue);break;case ka.RINGS:S=Oc(i,r,ue);break;case ka.TRIANGLES:V=Oc(i,r,ue)}break;case Ss.OFFSET:switch(ue.logicalStreamType.offsetType){case fu.VERTEX:A=Qs(i,r,ue,!1);break;case fu.INDEX:q=Qs(i,r,ue,!1)}break;case Ss.DATA:rl.VERTEX===ue.logicalStreamType.dictionaryType?k=Qs(i,r,ue,!0):(N={numBits:ue.numBits,coordinateShift:ue.coordinateShift},k=Qs(i,r,ue,!1))}}return q!==null?f!=null||y!=null?Mg(s,H,V,q,k,new Zu(f,y,S)):Mg(s,H,V,q,k):N===null?function(J,ue,Ne,de,ye){return new Ig(J,ue,Ya.VEC_2,Ne,de,ye)}(s,H,new Zu(f,y,S),A,k):function(J,ue,Ne,de,ye,je){return new Ig(J,ue,Ya.MORTON,Ne,de,ye,je)}(s,H,new Zu(f,y,S),A,k,N)}const W=Qs(i,r,d,!1);for(let H=0;H<e-1;H++){const J=Ks(i,r);switch(J.physicalStreamType){case Ss.LENGTH:switch(J.logicalStreamType.lengthType){case ka.GEOMETRIES:f=Qs(i,r,J,!1);break;case ka.PARTS:y=Qs(i,r,J,!1);break;case ka.RINGS:S=Qs(i,r,J,!1);break;case ka.TRIANGLES:V=Oc(i,r,J)}break;case Ss.OFFSET:switch(J.logicalStreamType.offsetType){case fu.VERTEX:A=Qs(i,r,J,!1);break;case fu.INDEX:q=Qs(i,r,J,!1)}break;case Ss.DATA:rl.VERTEX===J.logicalStreamType.dictionaryType?k=Qs(i,r,J,!0):(N={numBits:J.numBits,coordinateShift:J.coordinateShift},k=Qs(i,r,J,!1))}}return q!==null&&y===null?Cg(W,V,q,k):(f!==null?(f=jf(W,f,2),y!==null&&S!==null?(y=kg(W,f,y,!1),S=function(H,J,ue,Ne){const de=new Int32Array(ue[ue.length-1]+1);let ye=0;de[0]=ye;let je=1,Ke=1,xt=0;for(let Vt=0;Vt<H.length;Vt++){const zt=H[Vt],Xt=J[Vt+1]-J[Vt];if(zt!==0&&zt!==3)for(let lr=0;lr<Xt;lr++){const Kt=ue[je]-ue[je-1];je++;for(let jt=0;jt<Kt;jt++)ye=de[Ke++]=ye+Ne[xt++]}else for(let lr=0;lr<Xt;lr++)de[Ke++]=++ye,je++}return de}(W,f,y,S)):y!==null&&(y=function(H,J,ue){const Ne=new Int32Array(J[J.length-1]+1);let de=0;Ne[0]=de;let ye=1,je=0;for(let Ke=0;Ke<H.length;Ke++){const xt=H[Ke],Vt=J[Ke+1]-J[Ke];if(xt===4||xt===1)for(let zt=0;zt<Vt;zt++)de=Ne[ye++]=de+ue[je++];else for(let zt=0;zt<Vt;zt++)Ne[ye++]=++de}return Ne}(W,f,y))):y!==null&&S!==null?(y=jf(W,y,1),S=kg(W,y,S,!0)):y!==null&&(y=jf(W,y,0)),q!==null?Cg(W,V,q,k,new Zu(f,y,S)):N===null?function(H,J,ue,Ne){return new Eg(Ya.VEC_2,H,J,ue,Ne)}(W,new Zu(f,y,S),A,k):function(H,J,ue,Ne,de){return new Eg(Ya.MORTON,H,J,ue,Ne,de)}(W,new Zu(f,y,S),A,k,N))}function jf(i,e,r){const s=new Int32Array(i.length+1);let c=0;s[0]=c;let d=0;for(let f=0;f<i.length;f++)c=s[f+1]=c+(i[f]>r?e[d++]:1);return s}function kg(i,e,r,s){const c=new Int32Array(e[e.length-1]+1);let d=0;c[0]=d;let f=1,y=0;for(let S=0;S<i.length;S++){const A=i[S],k=e[S+1]-e[S];if(A===5||A===2||s&&(A===4||A===1))for(let N=0;N<k;N++)d=c[f++]=d+r[y++];else for(let N=0;N<k;N++)c[f++]=++d}return c}class Gv extends Gu{dataVector;constructor(e,r,s){super(e,r.getBuffer(),s),this.dataVector=r}getValueFromBuffer(e){return this.dataVector.get(e)}}class $v extends dd{getValueFromBuffer(e){return this.dataBuffer[e]}}class Dg extends Gu{constructor(e,r,s){super(e,BigInt64Array.of(r),s)}getValueFromBuffer(e){return this.dataBuffer[0]}}function Ch(i,e,r){return Fg(i,Math.ceil(e/8),r)}function Fg(i,e,r){const s=new Uint8Array(e);let c=0;for(;c<e;){const d=i[r.increment()];if(d<=127){const f=d+3,y=i[r.increment()],S=c+f;s.fill(y,c,S),c=S}else{const f=256-d;for(let y=0;y<f;y++)s[c++]=i[r.increment()]}}return s}const Zv=new TextDecoder;function Uf(i,e,r){return r-e>=12?Zv.decode(i.subarray(e,r)):function(s,c,d){let f="",y=c;for(;y<d;){const S=s[y];let A,k,N,V=null,q=S>239?4:S>223?3:S>191?2:1;if(y+q>d)break;q===1?S<128&&(V=S):q===2?(A=s[y+1],(192&A)==128&&(V=(31&S)<<6|63&A,V<=127&&(V=null))):q===3?(A=s[y+1],k=s[y+2],(192&A)==128&&(192&k)==128&&(V=(15&S)<<12|(63&A)<<6|63&k,(V<=2047||V>=55296&&V<=57343)&&(V=null))):q===4&&(A=s[y+1],k=s[y+2],N=s[y+3],(192&A)==128&&(192&k)==128&&(192&N)==128&&(V=(15&S)<<18|(63&A)<<12|(63&k)<<6|63&N,(V<=65535||V>=1114112)&&(V=null))),V===null?(V=65533,q=1):V>65535&&(V-=65536,f+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),f+=String.fromCharCode(V),y+=q}return f}(i,e,r)}class Vf extends Gu{offsetBuffer;constructor(e,r,s,c){super(e,s,c),this.offsetBuffer=r}}class Rg extends Vf{textEncoder;constructor(e,r,s,c){super(e,r,s,c??r.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return Uf(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class Wu extends Vf{indexBuffer;textEncoder;constructor(e,r,s,c,d){super(e,s,c,d??r.length),this.indexBuffer=r,this.indexBuffer=r,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const r=this.indexBuffer[e];return Uf(this.dataBuffer,this.offsetBuffer[r],this.offsetBuffer[r+1])}}class zg extends Vf{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,r,s,c,d,f,y){super(e,s,c,y),this.indexBuffer=r,this.symbolOffsetBuffer=d,this.symbolTableBuffer=f,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=function(s,c,d){const f=[],y=new Array(c.length).fill(0);for(let S=1;S<c.length;S++)y[S]=y[S-1]+c[S-1];for(let S=0;S<d.length;S++)if(d[S]===255)f.push(d[++S]);else{const A=c[d[S]],k=y[d[S]];for(let N=0;N<A;N++)f.push(s[k+N])}return new Uint8Array(f)}(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const r=this.indexBuffer[e];return Uf(this.decodedDictionary,this.offsetBuffer[r],this.offsetBuffer[r+1])}offsetToLengthBuffer(e){const r=new Uint32Array(e.length-1);let s=e[0];for(let c=1;c<e.length;c++){const d=e[c];r[c-1]=d-s,s=d}return r}}function Wv(i,e,r,s,c,d){return r.type==="scalarType"?function(f,y,S,A,k,N){let V=null,q=0;if(f===0)return null;if(N.nullable){const H=Ks(y,S);q=H.numValues;const J=S.get(),ue=Ch(y,q,S);S.set(J+H.byteLength),V=new il(ue,H.numValues)}const W=V??A;switch(k.physicalType){case 4:case 3:return function(H,J,ue,Ne,de){const ye=Ks(H,J),je=md(ye,de,H,J),Ke=Ne.physicalType===3;if(je===rs.FLAT){const xt=kh(de)?Rf(H,J,ye,Ke,de):Qs(H,J,ye,Ke);return new Ef(ue.name,xt,de)}if(je===rs.SEQUENCE){const xt=yg(H,J,ye);return new Mf(ue.name,xt[0],xt[1],ye.numRleValues)}{const xt=Ff(H,J,ye,Ke);return new Cf(ue.name,xt,de)}}(y,S,N,k,W);case 9:return function(H,J,ue,Ne,de){let ye=null,je=null,Ke=null,xt=null,Vt=null,zt=null,Xt=null,lr=null;for(let Kt=0;Kt<Ne;Kt++){const jt=Ks(J,ue);if(jt.byteLength!==0)switch(jt.physicalStreamType){case Ss.PRESENT:{const Et=Ch(J,jt.numValues,ue);zt=new il(Et,jt.numValues);break}case Ss.OFFSET:je=de!=null||zt!=null?Rf(J,ue,jt,!1,de??zt):Qs(J,ue,jt,!1);break;case Ss.LENGTH:{const Et=Oc(J,ue,jt);ka.DICTIONARY===jt.logicalStreamType.lengthType?ye=Et:ka.SYMBOL===jt.logicalStreamType.lengthType?xt=Et:Xt=Et;break}case Ss.DATA:{const Et=J.subarray(ue.get(),ue.get()+jt.byteLength);ue.add(jt.byteLength);const yr=jt.logicalStreamType.dictionaryType;rl.FSST===yr?Vt=Et:rl.SINGLE===yr||rl.SHARED===yr?Ke=Et:rl.NONE===yr&&(lr=Et);break}}}return function(Kt,jt,Et,yr,pr,vr,dr){return jt?new zg(Kt,Et,yr,pr,vr,jt,dr):null}(H,Vt,je,ye,Ke,xt,de??zt)??function(Kt,jt,Et,yr,pr){return jt?pr?new Wu(Kt,Et,yr,jt,pr):new Wu(Kt,Et,yr,jt):null}(H,Ke,je,ye,de??zt)??function(Kt,jt,Et,yr,pr){if(!jt||!Et)return null;if(yr)return pr?new Wu(Kt,yr,jt,Et,pr):new Wu(Kt,yr,jt,Et);if(pr&&pr.size()!==jt.length-1){const vr=new Int32Array(pr.size());let dr=0;for(let Pr=0;Pr<pr.size();Pr++)vr[Pr]=pr.get(Pr)?dr++:0;return new Wu(Kt,vr,jt,Et,pr)}return pr?new Rg(Kt,jt,Et,pr):new Rg(Kt,jt,Et)}(H,Xt,lr,je,de??zt)}(N.name,y,S,N.nullable?f-1:f,V);case 0:return function(H,J,ue,Ne,de){const ye=Ks(H,J),je=ye.numValues,Ke=J.get(),xt=kh(de)?function(zt,Xt,lr,Kt){const jt=Fg(zt,Math.ceil(Xt/8),lr),Et=new il(jt,Xt),yr=Kt.size(),pr=new il(new Uint8Array(yr),yr);let vr=0;for(let dr=0;dr<Kt.size();dr++){const Pr=!!Kt.get(dr)&&Et.get(vr++);pr.set(dr,Pr)}return pr.getBuffer()}(H,je,J,de):Ch(H,je,J);J.set(Ke+ye.byteLength);const Vt=new il(xt,je);return new Gv(ue.name,Vt,de)}(y,S,N,0,W);case 6:case 5:return function(H,J,ue,Ne,de){const ye=Ks(H,J),je=md(ye,Ne,H,J),Ke=de.physicalType===5;if(je===rs.FLAT){const xt=kh(Ne)?function(Vt,zt,Xt,lr,Kt){return function(jt,Et,yr,pr){switch(Et.logicalLevelTechnique1){case hi.DELTA:return Et.logicalLevelTechnique2===hi.RLE&&(jt=mg(jt,Et.runs,Et.numRleValues)),function(vr,dr){const Pr=new BigInt64Array(vr.size());let yi=0;vr.get(0)?(Pr[0]=vr.get(0)?dr[0]>>1n^-(1n&dr[0]):0n,yi=1):Pr[0]=0n;let ci=1;for(;ci!=Pr.length;++ci)Pr[ci]=vr.get(ci)?Pr[ci-1]+(dr[yi]>>1n^-(1n&dr[yi++])):Pr[ci-1];return Pr}(pr,jt);case hi.RLE:return function(vr,dr,Pr,yi){const ci=dr;return Pr?function(tn,Ps,Nn){const rn=new BigInt64Array(tn.size());let Xi=0;for(let Pi=0;Pi<Nn;Pi++){const mn=Number(Ps[Pi]);let Sn=Ps[Pi+Nn];Sn=Sn>>1n^-(1n&Sn);for(let Gi=Xi;Gi<Xi+mn;Gi++)tn.get(Gi)?rn[Gi]=Sn:(rn[Gi]=0n,Xi++);Xi+=mn}return rn}(yi,vr,ci.runs):function(tn,Ps,Nn){const rn=new BigInt64Array(tn.size());let Xi=0;for(let Pi=0;Pi<Nn;Pi++){const mn=Number(Ps[Pi]),Sn=Ps[Pi+Nn];for(let Gi=Xi;Gi<Xi+mn;Gi++)tn.get(Gi)?rn[Gi]=Sn:(rn[Gi]=0n,Xi++);Xi+=mn}return rn}(yi,vr,ci.runs)}(jt,Et,yr,pr);case hi.NONE:return jt=yr?function(vr,dr){const Pr=new BigInt64Array(vr.size());let yi=0,ci=0;for(;ci!=Pr.length;++ci)if(vr.get(ci)){const tn=dr[yi++];Pr[ci]=tn>>1n^-(1n&tn)}else Pr[ci]=0n;return Pr}(pr,jt):function(vr,dr){const Pr=new BigInt64Array(vr.size());let yi=0,ci=0;for(;ci!=Pr.length;++ci)Pr[ci]=vr.get(ci)?dr[yi++]:0n;return Pr}(pr,jt),jt;default:throw new Error("The specified Logical level technique is not supported")}}(fd(Vt,zt,Xt.numValues),Xt,lr,Kt)}(H,J,ye,Ke,Ne):bg(H,J,ye,Ke);return new wg(ue.name,xt,Ne)}if(je===rs.SEQUENCE){const xt=vg(H,J,ye);return new Sg(ue.name,xt[0],xt[1],ye.numRleValues)}{const xt=xg(H,J,ye,Ke);return new Dg(ue.name,xt,Ne)}}(y,S,N,W,k);case 7:return function(H,J,ue,Ne){const de=Ks(H,J),ye=kh(Ne)?function(je,Ke,xt,Vt){const zt=Ke.get(),Xt=zt+Vt*Float32Array.BYTES_PER_ELEMENT,lr=new Uint8Array(je.subarray(zt,Xt)).buffer,Kt=new Float32Array(lr);Ke.set(Xt);const jt=xt.size(),Et=new Float32Array(jt);let yr=0;for(let pr=0;pr<jt;pr++)Et[pr]=xt.get(pr)?Kt[yr++]:0;return Et}(H,J,Ne,de.numValues):function(je,Ke,xt){const Vt=Ke.get(),zt=Vt+xt*Float32Array.BYTES_PER_ELEMENT,Xt=new Uint8Array(je.subarray(Vt,zt)).buffer,lr=new Float32Array(Xt);return Ke.set(zt),lr}(H,J,de.numValues);return new $v(ue.name,ye,Ne)}(y,S,N,W);case 8:return function(H,J,ue,Ne){const de=Ks(H,J),ye=kh(Ne)?function(je,Ke,xt,Vt){const zt=Ke.get(),Xt=zt+Vt*Float64Array.BYTES_PER_ELEMENT,lr=new Uint8Array(je.subarray(zt,Xt)).buffer,Kt=new Float64Array(lr);Ke.set(Xt);const jt=xt.size(),Et=new Float64Array(jt);let yr=0;for(let pr=0;pr<jt;pr++)Et[pr]=xt.get(pr)?Kt[yr++]:0;return Et}(H,J,Ne,de.numValues):function(je,Ke,xt){const Vt=Ke.get(),zt=Vt+xt*Float64Array.BYTES_PER_ELEMENT,Xt=new Uint8Array(je.subarray(Vt,zt)).buffer,lr=new Float64Array(Xt);return Ke.set(zt),lr}(H,J,de.numValues);return new Lf(ue.name,ye,Ne)}(y,S,N,W);default:throw new Error(`The specified data type for the field is currently not supported: ${k}`)}}(s,i,e,c,r.scalarType,r):s!=1?null:function(f,y,S,A){let k=null,N=null,V=null,q=null,W=!1;for(;!W;){const Ne=Ks(f,y);switch(Ne.physicalStreamType){case Ss.LENGTH:ka.DICTIONARY===Ne.logicalStreamType.lengthType?k=Oc(f,y,Ne):V=Oc(f,y,Ne);break;case Ss.DATA:rl.SINGLE===Ne.logicalStreamType.dictionaryType||rl.SHARED===Ne.logicalStreamType.dictionaryType?(N=f.subarray(y.get(),y.get()+Ne.byteLength),W=!0):q=f.subarray(y.get(),y.get()+Ne.byteLength),y.add(Ne.byteLength)}}const H=S.complexType.children,J=[];let ue=0;for(const Ne of H){const de=gs(f,y,1)[0];if(de==0)continue;const ye=`${S.name}${Ne.name==="default"?"":":"+Ne.name}`;if(de!==2||Ne.type!=="scalarField"||Ne.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const je=Ks(f,y),Ke=Ch(f,je.numValues,y),xt=Ks(f,y),Vt=xt.decompressedCount!==A?Rf(f,y,xt,!1,new il(Ke,je.numValues)):Qs(f,y,xt,!1);J[ue++]=q?new zg(ye,Vt,k,N,V,q,new il(Ke,je.numValues)):new Wu(ye,Vt,k,N,new il(Ke,je.numValues))}return J}(i,e,r,c)}function kh(i){return i instanceof il}function Hv(i){if(i.name==="id")return!1;if(i.type==="scalarType"){const e=i.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(i.type==="complexType"){const e=i.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",i),!1}const Xv=new TextDecoder;function Ng(i,e){const r=gs(i,e,1)[0];if(r===0)return"";const s=e.get(),c=i.subarray(s,s+r);return e.add(r),Xv.decode(c)}function Og(i,e){const r=gs(i,e,1)[0]>>>0,s=!!(4&r),c=!!(2&r),d=gs(i,e,1)[0]>>>0,f={};if(1&r&&(f.nullable=!0),c){const y={};if(s?(y.type="logicalType",y.logicalType=d):(y.type="physicalType",y.physicalType=d),8&r){const S=gs(i,e,1)[0]>>>0;y.children=new Array(S);for(let A=0;A<S;A++)y.children[A]=Og(i,e)}f.type="complexField",f.complexField=y}else{const y={};s?(y.type="logicalType",y.logicalType=d):(y.type="physicalType",y.physicalType=d),f.type="scalarField",f.scalarField=y}return f}function Yv(i,e){const r=gs(i,e,1)[0]>>>0,s=function(c){switch(c){case 0:case 1:case 2:case 3:{const d={};d.nullable=!!(1&c),d.columnScope=0;const f={};return f.physicalType=c>1?6:4,f.type="physicalType",d.scalarType=f,d.type="scalarType",d}case 4:{const d={nullable:!1,columnScope:0},f={type:"physicalType",physicalType:0};return d.type="complexType",d.complexType=f,d}case 30:{const d={nullable:!1,columnScope:0},f={type:"physicalType",physicalType:1};return d.type="complexType",d.complexType=f,d}default:return function(d){let f=null;switch(d){case 10:case 11:f=0;break;case 12:case 13:f=1;break;case 14:case 15:f=2;break;case 16:case 17:f=3;break;case 18:case 19:f=4;break;case 20:case 21:f=5;break;case 22:case 23:f=6;break;case 24:case 25:f=7;break;case 26:case 27:f=8;break;case 28:case 29:f=9;break;default:return null}const y={};y.nullable=!!(1&d),y.columnScope=0;const S={type:"physicalType"};return S.physicalType=f,y.type="scalarType",y.scalarType=S,y}(c)}}(r);if(!s)throw new Error(`Unsupported column type code: ${r}`);if(function(c){return c>=10}(r)?s.name=Ng(i,e):r>=0&&r<=3?s.name="id":r===4&&(s.name="geometry"),function(c){return c===30}(r)){const c=gs(i,e,1)[0]>>>0,d=s.complexType;d.children=new Array(c);for(let f=0;f<c;f++)d.children[f]=Og(i,e)}return s}function Jv(i,e){const r={featureTables:[]},s={};s.name=Ng(i,e);const c=gs(i,e,1)[0]>>>0,d=gs(i,e,1)[0]>>>0;s.columns=new Array(d);for(let f=0;f<d;f++)s.columns[f]=Yv(i,e);return r.featureTables.push(s),[r,c]}function Kv(i,e,r,s,c,d,f=!1){const y=e.scalarType.physicalType,S=md(c,d,i,r);if(y===4)switch(S){case rs.FLAT:{const A=Qs(i,r,c,!1);return new Ef(s,A,d)}case rs.SEQUENCE:{const A=yg(i,r,c);return new Mf(s,A[0],A[1],c.numRleValues)}case rs.CONST:{const A=Ff(i,r,c,!1);return new Cf(s,A,d)}}else switch(S){case rs.FLAT:{if(f){const k=function(N,V,q,W){const H=function(J,ue,Ne){const de=new Float64Array(ue);for(let ye=0;ye<ue;ye++)de[ye]=Ov(J,Ne);return de}(N,q.numValues,V);return function(J,ue,Ne){switch(ue.logicalLevelTechnique1){case hi.DELTA:return ue.logicalLevelTechnique2===hi.RLE&&(J=gg(J,ue.runs,ue.numRleValues)),function(de){de[0]=de[0]%2==1?(de[0]+1)/-2:de[0]/2;const ye=de.length/4*4;let je=1;if(ye>=4)for(;je<ye-4;je+=4){const Ke=de[je],xt=de[je+1],Vt=de[je+2],zt=de[je+3];de[je]=(Ke%2==1?(Ke+1)/-2:Ke/2)+de[je-1],de[je+1]=(xt%2==1?(xt+1)/-2:xt/2)+de[je],de[je+2]=(Vt%2==1?(Vt+1)/-2:Vt/2)+de[je+1],de[je+3]=(zt%2==1?(zt+1)/-2:zt/2)+de[je+2]}for(;je!=de.length;++je)de[je]=(de[je]%2==1?(de[je]+1)/-2:de[je]/2)+de[je-1]}(J),J;case hi.RLE:return function(de,ye,je){return gg(de,ye.runs,ye.numRleValues)}(J,ue);case hi.NONE:return J;default:throw new Error(`The specified Logical level technique is not supported: ${ue.logicalLevelTechnique1}`)}}(H,q)}(i,r,c);return new Lf(s,k,d)}const A=bg(i,r,c,!1);return new wg(s,A,d)}case rs.SEQUENCE:{const A=vg(i,r,c);return new Sg(s,A[0],A[1],c.numRleValues)}case rs.CONST:{const A=xg(i,r,c,!1);return new Dg(s,A,d)}}throw new Error("Vector type not supported for id column.")}class Qv{constructor(e,r){var s;switch(this._featureData=e,this.properties=this._featureData.properties||{},(s=this._featureData.geometry)===null||s===void 0?void 0:s.type){case is.POINT:case is.MULTIPOINT:this.type=1;break;case is.LINESTRING:case is.MULTILINESTRING:this.type=2;break;case is.POLYGON:case is.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=r,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const r of this._featureData.geometry.coordinates){const s=[];for(const c of r)s.push(new C(c.x,c.y));e.push(s)}return e}}class eb{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new Qv(this.features[e],this.extent)}}class Bg{constructor(e){this.layers={};const r=function(s,c,d=!0){const f=new Nv(0),y=[];for(;f.get()<s.length;){const S=gs(s,f,1)[0]>>>0,A=f.get()+S;if(A>s.length)throw new Error(`Block overruns tile: ${A} > ${s.length}`);if(gs(s,f,1)[0]>>>0!=1){f.set(A);continue}const k=Jv(s,f),N=k[1],V=k[0].featureTables[0];let q=null,W=null;const H=[];let J=0;for(const Ne of V.columns){const de=Ne.name;if(de==="id"){let ye=null;if(Ne.nullable){const Ke=Ks(s,f),xt=f.get(),Vt=Ch(s,Ke.numValues,f);f.set(xt+Ke.byteLength),ye=new il(Vt,Ke.numValues)}const je=Ks(s,f);J=je.decompressedCount,q=Kv(s,Ne,f,de,je,ye??J,d)}else if(de==="geometry"){const ye=gs(s,f,1)[0];if(J===0){const je=f.get();J=Ks(s,f).decompressedCount,f.set(je)}W=qv(s,ye,f,J)}else{const ye=Hv(Ne)?gs(s,f,1)[0]:1;if(ye===0&&Ne.type==="scalarType")continue;const je=Wv(s,f,Ne,ye,J);if(je)if(Array.isArray(je))for(const Ke of je)H.push(Ke);else H.push(je)}}const ue=new zv(V.name,W,q,H,N);y.push(ue),f.set(A)}return y}(new Uint8Array(e));this.layers=r.reduce((s,c)=>Object.assign(Object.assign({},s),{[c.name]:new eb(c)}),{})}}class mu{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const r=new mu;return r.extend(e(new C(this.minX,this.minY))),r.extend(e(new C(this.maxX,this.minY))),r.extend(e(new C(this.minX,this.maxY))),r.extend(e(new C(this.maxX,this.maxY))),r}static fromPoints(e){const r=new mu;for(const s of e)r.extend(s);return r}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class tb{constructor(e,r){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=r,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],r=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const s of r){const c=[];for(const d of s)c.push(new C(d[0],d[1]));e.push(c)}return e}}const Dh="_geojsonTileLayer";function rb(i,e){e.writeVarintField(15,i.version||1),e.writeStringField(1,i.name||""),e.writeVarintField(5,i.extent||4096);const r={keys:[],values:[],keycache:{},valuecache:{}};for(let d=0;d<i.length;d++)r.feature=i.feature(d),e.writeMessage(2,ib,r);const s=r.keys;for(const d of s)e.writeStringField(3,d);const c=r.values;for(const d of c)e.writeMessage(4,ab,d)}function ib(i,e){if(!i.feature)return;const r=i.feature;r.id!==void 0&&e.writeVarintField(1,r.id),e.writeMessage(2,nb,i),e.writeVarintField(3,r.type),e.writeMessage(4,sb,r)}function nb(i,e){for(const r in i.feature?.properties){let s=i.feature.properties[r],c=i.keycache[r];if(s===null)continue;c===void 0&&(i.keys.push(r),c=i.keys.length-1,i.keycache[r]=c),e.writeVarint(c),typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"&&(s=JSON.stringify(s));const d=typeof s+":"+s;let f=i.valuecache[d];f===void 0&&(i.values.push(s),f=i.values.length-1,i.valuecache[d]=f),e.writeVarint(f)}}function qf(i,e){return(e<<3)+(7&i)}function jg(i){return i<<1^i>>31}function sb(i,e){const r=i.loadGeometry(),s=i.type;let c=0,d=0;for(const f of r){let y=1;s===1&&(y=f.length),e.writeVarint(qf(1,y));const S=s===3?f.length-1:f.length;for(let A=0;A<S;A++){A===1&&s!==1&&e.writeVarint(qf(2,S-1));const k=f[A].x-c,N=f[A].y-d;e.writeVarint(jg(k)),e.writeVarint(jg(N)),c+=k,d+=N}i.type===3&&e.writeVarint(qf(7,1))}}function ab(i,e){const r=typeof i;r==="string"?e.writeStringField(1,i):r==="boolean"?e.writeBooleanField(7,i):r==="number"&&(i%1!=0?e.writeDoubleField(3,i):i<0?e.writeSVarintField(6,i):e.writeVarintField(5,i))}class Ug{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new we(vt,16,0),this.grid3D=new we(vt,16,0),this.featureIndexArray=new $,this.promoteId=r}insert(e,r,s,c,d,f){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,c,d);const S=f?this.grid3D:this.grid;for(let A=0;A<r.length;A++){const k=r[A],N=[1/0,1/0,-1/0,-1/0];for(let V=0;V<k.length;V++){const q=k[V];N[0]=Math.min(N[0],q.x),N[1]=Math.min(N[1],q.y),N[2]=Math.max(N[2],q.x),N[3]=Math.max(N[3],q.y)}N[0]<vt&&N[1]<vt&&N[2]>=0&&N[3]>=0&&S.insert(y,N[0],N[1],N[2],N[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new Am(new od(this.rawTileData)).layers:new Bg(this.rawTileData).layers,this.sourceLayerCoder=new cg(this.vtLayers?Object.keys(this.vtLayers).sort():[Dh])),this.vtLayers}query(e,r,s,c){this.loadVTLayers();const d=e.params,f=vt/e.tileSize/e.scale,y=Yo(d.filter,d.globalState),S=e.queryGeometry,A=e.queryPadding*f,k=mu.fromPoints(S),N=this.grid.query(k.minX-A,k.minY-A,k.maxX+A,k.maxY+A),V=mu.fromPoints(e.cameraQueryGeometry).expandBy(A),q=this.grid3D.query(V.minX,V.minY,V.maxX,V.maxY,(J,ue,Ne,de)=>function(ye,je,Ke,xt,Vt){for(const Xt of ye)if(je<=Xt.x&&Ke<=Xt.y&&xt>=Xt.x&&Vt>=Xt.y)return!0;const zt=[new C(je,Ke),new C(je,Vt),new C(xt,Vt),new C(xt,Ke)];if(ye.length>2){for(const Xt of zt)if(Ru(ye,Xt))return!0}for(let Xt=0;Xt<ye.length-1;Xt++)if(l1(ye[Xt],ye[Xt+1],zt))return!0;return!1}(e.cameraQueryGeometry,J-A,ue-A,Ne+A,de+A));for(const J of q)N.push(J);N.sort(ob);const W={};let H;for(let J=0;J<N.length;J++){const ue=N[J];if(ue===H)continue;H=ue;const Ne=this.featureIndexArray.get(ue);let de=null;this.loadMatchingFeature(W,Ne.bucketIndex,Ne.sourceLayerIndex,Ne.featureIndex,y,d.layers,d.availableImages,r,s,c,(ye,je,Ke)=>(de||(de=cc(ye)),je.queryIntersectsFeature({queryGeometry:S,feature:ye,featureState:Ke,geometry:de,zoom:this.z,transform:e.transform,pixelsToTileUnits:f,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation})))}return W}loadMatchingFeature(e,r,s,c,d,f,y,S,A,k,N){const V=this.bucketLayerIDs[r];if(f&&!V.some(J=>f.has(J)))return;const q=this.sourceLayerCoder.decode(s),W=this.vtLayers[q].feature(c);if(d.needGeometry){const J=uc(W,!0);if(!d.filter(new br(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!d.filter(new br(this.tileID.overscaledZ),W))return;const H=this.getId(W,q);for(let J=0;J<V.length;J++){const ue=V[J];if(f&&!f.has(ue))continue;const Ne=S[ue];if(!Ne)continue;let de={};H&&k&&(de=k.getState(Ne.sourceLayer||Dh,H));const ye=pt({},A[ue]);ye.paint=Vg(ye.paint,Ne.paint,W,de,y),ye.layout=Vg(ye.layout,Ne.layout,W,de,y);const je=!N||N(W,Ne,de);if(!je)continue;const Ke=new ug(W,this.z,this.x,this.y,H);Ke.layer=ye;let xt=e[ue];xt===void 0&&(xt=e[ue]=[]),xt.push({featureIndex:c,feature:Ke,intersectionZ:je})}}lookupSymbolFeatures(e,r,s,c,d,f,y,S){const A={};this.loadVTLayers();const k=Yo(d.filterSpec,d.globalState);for(const N of e)this.loadMatchingFeature(A,s,c,N,k,f,y,S,r);return A}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){var s;let c=e.id;return this.promoteId&&(c=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof c=="boolean"&&(c=Number(c)),c===void 0&&(!((s=e.properties)===null||s===void 0)&&s.cluster)&&this.promoteId&&(c=Number(e.properties.cluster_id))),c}}function Vg(i,e,r,s,c){return Bt(i,(d,f)=>{const y=e instanceof xi?e.get(f):null;return y&&y.evaluate?y.evaluate(r,s,c):y})}function ob(i,e){return e-i}function qg(i,e,r,s,c){const d=[];for(let f=0;f<i.length;f++){const y=i[f];let S;for(let A=0;A<y.length-1;A++){let k=y[A],N=y[A+1];k.x<e&&N.x<e||(k.x<e?k=new C(e,k.y+(e-k.x)/(N.x-k.x)*(N.y-k.y))._round():N.x<e&&(N=new C(e,k.y+(e-k.x)/(N.x-k.x)*(N.y-k.y))._round()),k.y<r&&N.y<r||(k.y<r?k=new C(k.x+(r-k.y)/(N.y-k.y)*(N.x-k.x),r)._round():N.y<r&&(N=new C(k.x+(r-k.y)/(N.y-k.y)*(N.x-k.x),r)._round()),k.x>=s&&N.x>=s||(k.x>=s?k=new C(s,k.y+(s-k.x)/(N.x-k.x)*(N.y-k.y))._round():N.x>=s&&(N=new C(s,k.y+(s-k.x)/(N.x-k.x)*(N.y-k.y))._round()),k.y>=c&&N.y>=c||(k.y>=c?k=new C(k.x+(c-k.y)/(N.y-k.y)*(N.x-k.x),c)._round():N.y>=c&&(N=new C(k.x+(c-k.y)/(N.y-k.y)*(N.x-k.x),c)._round()),S&&k.equals(S[S.length-1])||(S=[k],d.push(S)),S.push(N)))))}}return d}function Gg(i,e,r,s,c){switch(e){case 1:return function(d,f,y,S){const A=[];for(const k of d)for(const N of k){const V=S===0?N.x:N.y;V>=f&&V<=y&&A.push([N])}return A}(i,r,s,c);case 2:return $g(i,r,s,c,!1);case 3:return $g(i,r,s,c,!0)}return[]}function lb(i,e,r,s,c){const d=s===0?cb:ub;let f=[];const y=[];for(let k=0;k<i.length-1;k++){const N=i[k],V=i[k+1],q=s===0?N.x:N.y,W=s===0?V.x:V.y;let H=!1;q<e?W>e&&f.push(d(N,V,e)):q>r?W<r&&f.push(d(N,V,r)):f.push(N),W<e&&q>=e&&(f.push(d(N,V,e)),H=!0),W>r&&q<=r&&(f.push(d(N,V,r)),H=!0),!c&&H&&(y.push(f),f=[])}const S=i.length-1,A=s===0?i[S].x:i[S].y;return A>=e&&A<=r&&f.push(i[S]),c&&f.length>0&&!f[0].equals(f[f.length-1])&&f.push(new C(f[0].x,f[0].y)),f.length>0&&y.push(f),y}function $g(i,e,r,s,c){const d=[];for(const f of i){const y=lb(f,e,r,s,c);y.length>0&&d.push(...y)}return d}function cb(i,e,r){return new C(r,i.y+(r-i.x)/(e.x-i.x)*(e.y-i.y))}function ub(i,e,r){return new C(i.x+(r-i.y)/(e.y-i.y)*(e.x-i.x),r)}ke("FeatureIndex",Ug,{omit:["rawTileData","sourceLayerCoder"]});class Bc extends C{constructor(e,r,s,c){super(e,r),this.angle=s,c!==void 0&&(this.segment=c)}clone(){return new Bc(this.x,this.y,this.angle,this.segment)}}function Zg(i,e,r,s,c){if(e.segment===void 0||r===0)return!0;let d=e,f=e.segment+1,y=0;for(;y>-r/2;){if(f--,f<0)return!1;y-=i[f].dist(d),d=i[f]}y+=i[f].dist(i[f+1]),f++;const S=[];let A=0;for(;y<r/2;){const k=i[f],N=i[f+1];if(!N)return!1;let V=i[f-1].angleTo(k)-k.angleTo(N);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:y,angleDelta:V}),A+=V;y-S[0].distance>s;)A-=S.shift().angleDelta;if(A>c)return!1;f++,y+=k.dist(N)}return!0}function Wg(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Hg(i,e,r){return i?.6*e*r:0}function Xg(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function hb(i,e,r,s,c,d){const f=Hg(r,c,d),y=Xg(r,s)*d;let S=0;const A=Wg(i)/2;for(let k=0;k<i.length-1;k++){const N=i[k],V=i[k+1],q=N.dist(V);if(S+q>A){const W=(A-S)/q,H=Ur.number(N.x,V.x,W),J=Ur.number(N.y,V.y,W),ue=new Bc(H,J,V.angleTo(N),k);return ue._round(),!f||Zg(i,ue,y,f,e)?ue:void 0}S+=q}}function db(i,e,r,s,c,d,f,y,S){const A=Hg(s,d,f),k=Xg(s,c),N=k*f,V=i[0].x===0||i[0].x===S||i[0].y===0||i[0].y===S;return e-N<e/4&&(e=N+e/4),Yg(i,V?e/2*y%e:(k/2+2*d)*f*y%e,e,A,r,N,V,!1,S)}function Yg(i,e,r,s,c,d,f,y,S){const A=d/2,k=Wg(i);let N=0,V=e-r,q=[];for(let W=0;W<i.length-1;W++){const H=i[W],J=i[W+1],ue=H.dist(J),Ne=J.angleTo(H);for(;V+r<N+ue;){V+=r;const de=(V-N)/ue,ye=Ur.number(H.x,J.x,de),je=Ur.number(H.y,J.y,de);if(ye>=0&&ye<S&&je>=0&&je<S&&V-A>=0&&V+A<=k){const Ke=new Bc(ye,je,Ne,W);Ke._round(),s&&!Zg(i,Ke,d,s,c)||q.push(Ke)}}N+=ue}return y||q.length||f||(q=Yg(i,N/2,r,s,c,d,f,!0,S)),q}function Jg(i,e,r,s){const c=[],d=i.image,f=d.pixelRatio,y=d.paddedRect.w-2,S=d.paddedRect.h-2;let A={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const k=d.stretchX||[[0,y]],N=d.stretchY||[[0,S]],V=(Et,yr)=>Et+yr[1]-yr[0],q=k.reduce(V,0),W=N.reduce(V,0),H=y-q,J=S-W;let ue=0,Ne=q,de=0,ye=W,je=0,Ke=H,xt=0,Vt=J;if(d.content&&s){const Et=d.content,yr=Et[2]-Et[0],pr=Et[3]-Et[1];(d.textFitWidth||d.textFitHeight)&&(A=Zm(i)),ue=vd(k,0,Et[0]),de=vd(N,0,Et[1]),Ne=vd(k,Et[0],Et[2]),ye=vd(N,Et[1],Et[3]),je=Et[0]-ue,xt=Et[1]-de,Ke=yr-Ne,Vt=pr-ye}const zt=A.x1,Xt=A.y1,lr=A.x2-zt,Kt=A.y2-Xt,jt=(Et,yr,pr,vr)=>{const dr=bd(Et.stretch-ue,Ne,lr,zt),Pr=xd(Et.fixed-je,Ke,Et.stretch,q),yi=bd(yr.stretch-de,ye,Kt,Xt),ci=xd(yr.fixed-xt,Vt,yr.stretch,W),tn=bd(pr.stretch-ue,Ne,lr,zt),Ps=xd(pr.fixed-je,Ke,pr.stretch,q),Nn=bd(vr.stretch-de,ye,Kt,Xt),rn=xd(vr.fixed-xt,Vt,vr.stretch,W),Xi=new C(dr,yi),Pi=new C(tn,yi),mn=new C(tn,Nn),Sn=new C(dr,Nn),Gi=new C(Pr/f,ci/f),ga=new C(Ps/f,rn/f),As=e*Math.PI/180;if(As){const ns=Math.sin(As),un=Math.cos(As),On=[un,-ns,ns,un];Xi._matMult(On),Pi._matMult(On),Sn._matMult(On),mn._matMult(On)}const _a=Et.stretch+Et.fixed,Lo=yr.stretch+yr.fixed;return{tl:Xi,tr:Pi,bl:Sn,br:mn,tex:{x:d.paddedRect.x+1+_a,y:d.paddedRect.y+1+Lo,w:pr.stretch+pr.fixed-_a,h:vr.stretch+vr.fixed-Lo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Gi,pixelOffsetBR:ga,minFontScaleX:Ke/f/lr,minFontScaleY:Vt/f/Kt,isSDF:r}};if(s&&(d.stretchX||d.stretchY)){const Et=Kg(k,H,q),yr=Kg(N,J,W);for(let pr=0;pr<Et.length-1;pr++){const vr=Et[pr],dr=Et[pr+1];for(let Pr=0;Pr<yr.length-1;Pr++)c.push(jt(vr,yr[Pr],dr,yr[Pr+1]))}}else c.push(jt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:S+1}));return c}function vd(i,e,r){let s=0;for(const c of i)s+=Math.max(e,Math.min(r,c[1]))-Math.max(e,Math.min(r,c[0]));return s}function Kg(i,e,r){const s=[{fixed:-1,stretch:0}];for(const[c,d]of i){const f=s[s.length-1];s.push({fixed:c-f.stretch,stretch:f.stretch}),s.push({fixed:c-f.stretch,stretch:f.stretch+(d-c)})}return s.push({fixed:e+1,stretch:r}),s}function bd(i,e,r,s){return i/e*r+s}function xd(i,e,r,s){return i-e*r/s}ke("Anchor",Bc);class wd{constructor(e,r,s,c,d,f,y,S,A,k){var N;if(this.boxStartIndex=e.length,A){let V=f.top,q=f.bottom;const W=f.collisionPadding;W&&(V-=W[1],q+=W[3]);let H=q-V;H>0&&(H=Math.max(10,H),this.circleDiameter=H)}else{const V=!((N=f.image)===null||N===void 0)&&N.content&&(f.image.textFitWidth||f.image.textFitHeight)?Zm(f):{x1:f.left,y1:f.top,x2:f.right,y2:f.bottom};V.y1=V.y1*y-S[0],V.y2=V.y2*y+S[2],V.x1=V.x1*y-S[3],V.x2=V.x2*y+S[1];const q=f.collisionPadding;if(q&&(V.x1-=q[0]*y,V.y1-=q[1]*y,V.x2+=q[2]*y,V.y2+=q[3]*y),k){const W=new C(V.x1,V.y1),H=new C(V.x2,V.y1),J=new C(V.x1,V.y2),ue=new C(V.x2,V.y2),Ne=k*Math.PI/180;W._rotate(Ne),H._rotate(Ne),J._rotate(Ne),ue._rotate(Ne),V.x1=Math.min(W.x,H.x,J.x,ue.x),V.x2=Math.max(W.x,H.x,J.x,ue.x),V.y1=Math.min(W.y,H.y,J.y,ue.y),V.y2=Math.max(W.y,H.y,J.y,ue.y)}e.emplaceBack(r.x,r.y,V.x1,V.y1,V.x2,V.y2,s,c,d)}this.boxEndIndex=e.length}}class fb{constructor(e=[],r=(s,c)=>s<c?-1:s>c?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,c=r[e];for(;e>0;){const d=e-1>>1,f=r[d];if(s(c,f)>=0)break;r[e]=f,e=d}r[e]=c}_down(e){const{data:r,compare:s}=this,c=this.length>>1,d=r[e];for(;e<c;){let f=1+(e<<1);const y=f+1;if(y<this.length&&s(r[y],r[f])<0&&(f=y),s(r[f],d)>=0)break;r[e]=r[f],e=f}r[e]=d}}function pb(i,e=1,r=!1){const s=mu.fromPoints(i[0]),c=Math.min(s.width(),s.height());let d=c/2;const f=new fb([],mb),{minX:y,minY:S,maxX:A,maxY:k}=s;if(c===0)return new C(y,S);for(let q=y;q<A;q+=c)for(let W=S;W<k;W+=c)f.push(new Hu(q+d,W+d,d,i));let N=function(q){let W=0,H=0,J=0;const ue=q[0];for(let Ne=0,de=ue.length,ye=de-1;Ne<de;ye=Ne++){const je=ue[Ne],Ke=ue[ye],xt=je.x*Ke.y-Ke.x*je.y;H+=(je.x+Ke.x)*xt,J+=(je.y+Ke.y)*xt,W+=3*xt}return new Hu(H/W,J/W,0,q)}(i),V=f.length;for(;f.length;){const q=f.pop();(q.d>N.d||!N.d)&&(N=q,r&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,V)),q.max-N.d<=e||(d=q.h/2,f.push(new Hu(q.p.x-d,q.p.y-d,d,i)),f.push(new Hu(q.p.x+d,q.p.y-d,d,i)),f.push(new Hu(q.p.x-d,q.p.y+d,d,i)),f.push(new Hu(q.p.x+d,q.p.y+d,d,i)),V+=4)}return r&&(console.log(`num probes: ${V}`),console.log(`best distance: ${N.d}`)),N.p}function mb(i,e){return e.max-i.max}function Hu(i,e,r,s){this.p=new C(i,e),this.h=r,this.d=function(c,d){let f=!1,y=1/0;for(let S=0;S<d.length;S++){const A=d[S];for(let k=0,N=A.length,V=N-1;k<N;V=k++){const q=A[k],W=A[V];q.y>c.y!=W.y>c.y&&c.x<(W.x-q.x)*(c.y-q.y)/(W.y-q.y)+q.x&&(f=!f),y=Math.min(y,im(c,q,W))}}return(f?1:-1)*Math.sqrt(y)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}var Ts;b.aQ=void 0,(Ts=b.aQ||(b.aQ={}))[Ts.center=1]="center",Ts[Ts.left=2]="left",Ts[Ts.right=3]="right",Ts[Ts.top=4]="top",Ts[Ts.bottom=5]="bottom",Ts[Ts["top-left"]=6]="top-left",Ts[Ts["top-right"]=7]="top-right",Ts[Ts["bottom-left"]=8]="bottom-left",Ts[Ts["bottom-right"]=9]="bottom-right";const Gf=Number.POSITIVE_INFINITY;function Qg(i,e){return e[1]!==Gf?function(r,s,c){let d=0,f=0;switch(s=Math.abs(s),c=Math.abs(c),r){case"top-right":case"top-left":case"top":f=c-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-c}switch(r){case"top-right":case"bottom-right":case"right":d=-s;break;case"top-left":case"bottom-left":case"left":d=s}return[d,f]}(i,e[0],e[1]):function(r,s){let c=0,d=0;s<0&&(s=0);const f=s/Math.SQRT2;switch(r){case"top-right":case"top-left":d=f-7;break;case"bottom-right":case"bottom-left":d=7-f;break;case"bottom":d=7-s;break;case"top":d=s-7}switch(r){case"top-right":case"bottom-right":c=-f;break;case"top-left":case"bottom-left":c=f;break;case"left":c=s;break;case"right":c=-s}return[c,d]}(i,e[0])}function e_(i,e,r){var s;const c=i.layout,d=(s=c.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(e,{},r);if(d){const y=d.values,S=[];for(let A=0;A<y.length;A+=2){const k=S[A]=y[A],N=y[A+1].map(V=>V*ts);k.startsWith("top")?N[1]-=7:k.startsWith("bottom")&&(N[1]+=7),S[A+1]=N}return new Ki(S)}const f=c.get("text-variable-anchor");if(f){let y;y=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(e,{},r)*ts,Gf]:c.get("text-offset").evaluate(e,{},r).map(A=>A*ts);const S=[];for(const A of f)S.push(A,Qg(A,y));return new Ki(S)}return null}function $f(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function gb(i,e,r,s,c,d,f,y,S,A,k,N){let V=d.textMaxSize.evaluate(e,{});V===void 0&&(V=f);const q=i.layers[0].layout,W=q.get("icon-offset").evaluate(e,{},k),H=r_(r.horizontal),J=f/24,ue=i.tilePixelRatio*J,Ne=i.tilePixelRatio*V/24,de=i.tilePixelRatio*y,ye=i.tilePixelRatio*q.get("symbol-spacing"),je=q.get("text-padding")*i.tilePixelRatio,Ke=function(pr,vr,dr,Pr=1){const yi=pr.get("icon-padding").evaluate(vr,{},dr),ci=yi&&yi.values;return[ci[0]*Pr,ci[1]*Pr,ci[2]*Pr,ci[3]*Pr]}(q,e,k,i.tilePixelRatio),xt=q.get("text-max-angle")/180*Math.PI,Vt=q.get("text-rotation-alignment")!=="viewport"&&q.get("symbol-placement")!=="point",zt=q.get("icon-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",Xt=q.get("symbol-placement"),lr=ye/2,Kt=q.get("icon-text-fit");let jt;s&&Kt!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(jt=Wm(s,r.vertical,Kt,q.get("icon-text-fit-padding"),W,J)),H&&(s=Wm(s,H,Kt,q.get("icon-text-fit-padding"),W,J)));const Et=k?N.line.getGranularityForZoomLevel(k.z):1,yr=(pr,vr)=>{vr.x<0||vr.x>=vt||vr.y<0||vr.y>=vt||function(dr,Pr,yi,ci,tn,Ps,Nn,rn,Xi,Pi,mn,Sn,Gi,ga,As,_a,Lo,ns,un,On,gn,ss,fc,nl,zh){const jc=dr.addToLineVertexArray(Pr,yi);let gu,Xu,Yu,Ju,a_=0,o_=0,l_=0,c_=0,Qf=-1,ep=-1;const pc={};let u_=Hi("");if(dr.allowVerticalPlacement&&ci.vertical){const Os=rn.layout.get("text-rotate").evaluate(gn,{},nl)+90;Yu=new wd(Xi,Pr,Pi,mn,Sn,ci.vertical,Gi,ga,As,Os),Nn&&(Ju=new wd(Xi,Pr,Pi,mn,Sn,Nn,Lo,ns,As,Os))}if(tn){const Os=rn.layout.get("icon-rotate").evaluate(gn,{}),Ja=rn.layout.get("icon-text-fit")!=="none",_u=Jg(tn,Os,fc,Ja),al=Nn?Jg(Nn,Os,fc,Ja):void 0;Xu=new wd(Xi,Pr,Pi,mn,Sn,tn,Lo,ns,!1,Os),a_=4*_u.length;const yu=dr.iconSizeData;let Dl=null;yu.kind==="source"?(Dl=[hc*rn.layout.get("icon-size").evaluate(gn,{})],Dl[0]>zc&&Ft(`${dr.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):yu.kind==="composite"&&(Dl=[hc*ss.compositeIconSizes[0].evaluate(gn,{},nl),hc*ss.compositeIconSizes[1].evaluate(gn,{},nl)],(Dl[0]>zc||Dl[1]>zc)&&Ft(`${dr.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),dr.addSymbols(dr.icon,_u,Dl,On,un,gn,b.aA.none,Pr,jc.lineStartIndex,jc.lineLength,-1,nl),Qf=dr.icon.placedSymbolArray.length-1,al&&(o_=4*al.length,dr.addSymbols(dr.icon,al,Dl,On,un,gn,b.aA.vertical,Pr,jc.lineStartIndex,jc.lineLength,-1,nl),ep=dr.icon.placedSymbolArray.length-1)}const h_=Object.keys(ci.horizontal);for(const Os of h_){const Ja=ci.horizontal[Os];if(!gu){u_=Hi(Ja.text);const al=rn.layout.get("text-rotate").evaluate(gn,{},nl);gu=new wd(Xi,Pr,Pi,mn,Sn,Ja,Gi,ga,As,al)}const _u=Ja.positionedLines.length===1;if(l_+=t_(dr,Pr,Ja,Ps,rn,As,gn,_a,jc,ci.vertical?b.aA.horizontal:b.aA.horizontalOnly,_u?h_:[Os],pc,Qf,ss,nl),_u)break}ci.vertical&&(c_+=t_(dr,Pr,ci.vertical,Ps,rn,As,gn,_a,jc,b.aA.vertical,["vertical"],pc,ep,ss,nl));const vb=gu?gu.boxStartIndex:dr.collisionBoxArray.length,bb=gu?gu.boxEndIndex:dr.collisionBoxArray.length,xb=Yu?Yu.boxStartIndex:dr.collisionBoxArray.length,wb=Yu?Yu.boxEndIndex:dr.collisionBoxArray.length,Sb=Xu?Xu.boxStartIndex:dr.collisionBoxArray.length,Tb=Xu?Xu.boxEndIndex:dr.collisionBoxArray.length,Pb=Ju?Ju.boxStartIndex:dr.collisionBoxArray.length,Ab=Ju?Ju.boxEndIndex:dr.collisionBoxArray.length;let sl=-1;const Td=(Os,Ja)=>Os&&Os.circleDiameter?Math.max(Os.circleDiameter,Ja):Ja;sl=Td(gu,sl),sl=Td(Yu,sl),sl=Td(Xu,sl),sl=Td(Ju,sl);const d_=sl>-1?1:0;d_&&(sl*=zh/ts),dr.glyphOffsetArray.length>=Vu.MAX_GLYPHS&&Ft("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),gn.sortKey!==void 0&&dr.addToSortKeyRanges(dr.symbolInstances.length,gn.sortKey);const Ib=e_(rn,gn,nl),[Eb,Lb]=function(Os,Ja){const _u=Os.length,al=Ja?.values;if(al?.length>0)for(let yu=0;yu<al.length;yu+=2){const Dl=al[yu+1];Os.emplaceBack(b.aQ[al[yu]],Dl[0],Dl[1])}return[_u,Os.length]}(dr.textAnchorOffsets,Ib);dr.symbolInstances.emplaceBack(Pr.x,Pr.y,pc.right>=0?pc.right:-1,pc.center>=0?pc.center:-1,pc.left>=0?pc.left:-1,pc.vertical||-1,Qf,ep,u_,vb,bb,xb,wb,Sb,Tb,Pb,Ab,Pi,l_,c_,a_,o_,d_,0,Gi,sl,Eb,Lb)}(i,vr,pr,r,s,c,jt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,ue,[je,je,je,je],Vt,S,de,Ke,zt,W,e,d,A,k,f)};if(Xt==="line")for(const pr of qg(e.geometry,0,0,vt,vt)){const vr=du(pr,Et),dr=db(vr,ye,xt,r.vertical||H,s,24,Ne,i.overscaling,vt);for(const Pr of dr)H&&_b(i,H.text,lr,Pr)||yr(vr,Pr)}else if(Xt==="line-center"){for(const pr of e.geometry)if(pr.length>1){const vr=du(pr,Et),dr=hb(vr,xt,r.vertical||H,s,24,Ne);dr&&yr(vr,dr)}}else if(e.type==="Polygon")for(const pr of yl(e.geometry,0)){const vr=pb(pr,16);yr(du(pr[0],Et,!0),new Bc(vr.x,vr.y,0))}else if(e.type==="LineString")for(const pr of e.geometry){const vr=du(pr,Et);yr(vr,new Bc(vr[0].x,vr[0].y,0))}else if(e.type==="Point")for(const pr of e.geometry)for(const vr of pr)yr([vr],new Bc(vr.x,vr.y,0))}function t_(i,e,r,s,c,d,f,y,S,A,k,N,V,q,W){const H=function(Ne,de,ye,je,Ke,xt,Vt,zt){const Xt=je.layout.get("text-rotate").evaluate(xt,{})*Math.PI/180,lr=[];for(const Kt of de.positionedLines)for(const jt of Kt.positionedGlyphs){if(!jt.rect)continue;const Et=jt.rect||{};let yr=4,pr=!0,vr=1,dr=0;const Pr=(Ke||zt)&&jt.vertical,yi=jt.metrics.advance*jt.scale/2;if(zt&&de.verticalizable&&(dr=Kt.lineOffset/2-(jt.imageName?-(ts-jt.metrics.width*jt.scale)/2:(jt.scale-1)*ts)),jt.imageName){const ns=Vt[jt.imageName];pr=ns.sdf,vr=ns.pixelRatio,yr=1/vr}const ci=Ke?[jt.x+yi,jt.y]:[0,0];let tn=Ke?[0,0]:[jt.x+yi+ye[0],jt.y+ye[1]-dr],Ps=[0,0];Pr&&(Ps=tn,tn=[0,0]);const Nn=jt.metrics.isDoubleResolution?2:1,rn=(jt.metrics.left-yr)*jt.scale-yi+tn[0],Xi=(-jt.metrics.top-yr)*jt.scale+tn[1],Pi=rn+Et.w/Nn*jt.scale/vr,mn=Xi+Et.h/Nn*jt.scale/vr,Sn=new C(rn,Xi),Gi=new C(Pi,Xi),ga=new C(rn,mn),As=new C(Pi,mn);if(Pr){const ns=new C(-yi,yi- -17),un=-Math.PI/2,On=12-yi,gn=new C(22-On,-(jt.imageName?On:0)),ss=new C(...Ps);Sn._rotateAround(un,ns)._add(gn)._add(ss),Gi._rotateAround(un,ns)._add(gn)._add(ss),ga._rotateAround(un,ns)._add(gn)._add(ss),As._rotateAround(un,ns)._add(gn)._add(ss)}if(Xt){const ns=Math.sin(Xt),un=Math.cos(Xt),On=[un,-ns,ns,un];Sn._matMult(On),Gi._matMult(On),ga._matMult(On),As._matMult(On)}const _a=new C(0,0),Lo=new C(0,0);lr.push({tl:Sn,tr:Gi,bl:ga,br:As,tex:Et,writingMode:de.writingMode,glyphOffset:ci,sectionIndex:jt.sectionIndex,isSDF:pr,pixelOffsetTL:_a,pixelOffsetBR:Lo,minFontScaleX:0,minFontScaleY:0})}return lr}(0,r,y,c,d,f,s,i.allowVerticalPlacement),J=i.textSizeData;let ue=null;J.kind==="source"?(ue=[hc*c.layout.get("text-size").evaluate(f,{})],ue[0]>zc&&Ft(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):J.kind==="composite"&&(ue=[hc*q.compositeTextSizes[0].evaluate(f,{},W),hc*q.compositeTextSizes[1].evaluate(f,{},W)],(ue[0]>zc||ue[1]>zc)&&Ft(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,H,ue,y,d,f,A,e,S.lineStartIndex,S.lineLength,V,W);for(const Ne of k)N[Ne]=i.text.placedSymbolArray.length-1;return 4*H.length}function r_(i){for(const e in i)return i[e];return null}function _b(i,e,r,s){const c=i.compareText;if(e in c){const d=c[e];for(let f=d.length-1;f>=0;f--)if(s.dist(d[f])<r)return!0}else c[e]=[];return c[e].push(s),!1}const i_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Zf{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=s>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const d=i_[15&s];if(!d)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new Zf(y,f,d,e)}constructor(e,r=64,s=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=i_.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-y%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${s}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+y+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=r,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Wf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:f,nodeSize:y}=this,S=[0,d.length-1,0],A=[];for(;S.length;){const k=S.pop()||0,N=S.pop()||0,V=S.pop()||0;if(N-V<=y){for(let J=V;J<=N;J++){const ue=f[2*J],Ne=f[2*J+1];ue>=e&&ue<=s&&Ne>=r&&Ne<=c&&A.push(d[J])}continue}const q=V+N>>1,W=f[2*q],H=f[2*q+1];W>=e&&W<=s&&H>=r&&H<=c&&A.push(d[q]),(k===0?e<=W:r<=H)&&(S.push(V),S.push(q-1),S.push(1-k)),(k===0?s>=W:c>=H)&&(S.push(q+1),S.push(N),S.push(1-k))}return A}within(e,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:d,nodeSize:f}=this,y=[0,c.length-1,0],S=[],A=s*s;for(;y.length;){const k=y.pop()||0,N=y.pop()||0,V=y.pop()||0;if(N-V<=f){for(let J=V;J<=N;J++)s_(d[2*J],d[2*J+1],e,r)<=A&&S.push(c[J]);continue}const q=V+N>>1,W=d[2*q],H=d[2*q+1];s_(W,H,e,r)<=A&&S.push(c[q]),(k===0?e-s<=W:r-s<=H)&&(y.push(V),y.push(q-1),y.push(1-k)),(k===0?e+s>=W:r+s>=H)&&(y.push(q+1),y.push(N),y.push(1-k))}return S}}function Wf(i,e,r,s,c,d){if(c-s<=r)return;const f=s+c>>1;n_(i,e,f,s,c,d),Wf(i,e,r,s,f-1,1-d),Wf(i,e,r,f+1,c,1-d)}function n_(i,e,r,s,c,d){for(;c>s;){if(c-s>600){const A=c-s+1,k=r-s+1,N=Math.log(A),V=.5*Math.exp(2*N/3),q=.5*Math.sqrt(N*V*(A-V)/A)*(k-A/2<0?-1:1);n_(i,e,r,Math.max(s,Math.floor(r-k*V/A+q)),Math.min(c,Math.floor(r+(A-k)*V/A+q)),d)}const f=e[2*r+d];let y=s,S=c;for(Fh(i,e,s,r),e[2*c+d]>f&&Fh(i,e,s,c);y<S;){for(Fh(i,e,y,S),y++,S--;e[2*y+d]<f;)y++;for(;e[2*S+d]>f;)S--}e[2*s+d]===f?Fh(i,e,s,S):(S++,Fh(i,e,S,c)),S<=r&&(s=S+1),r<=S&&(c=S-1)}}function Fh(i,e,r,s){Hf(i,r,s),Hf(e,2*r,2*s),Hf(e,2*r+1,2*s+1)}function Hf(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}function s_(i,e,r,s){const c=i-r,d=e-s;return c*c+d*d}var Xf;b.cI=void 0,(Xf=b.cI||(b.cI={})).create="create",Xf.load="load",Xf.fullLoad="fullLoad";let Sd=null,Rh=[];const Yf=1e3/60,Jf="loadTime",Kf="fullLoadTime",yb={mark(i){performance.mark(i)},frame(i){const e=i;Sd!=null&&Rh.push(e-Sd),Sd=e},clearMetrics(){Sd=null,Rh=[],performance.clearMeasures(Jf),performance.clearMeasures(Kf);for(const i in b.cI)performance.clearMarks(b.cI[i])},getPerformanceMetrics(){performance.measure(Jf,b.cI.create,b.cI.load),performance.measure(Kf,b.cI.create,b.cI.fullLoad);const i=performance.getEntriesByName(Jf)[0].duration,e=performance.getEntriesByName(Kf)[0].duration,r=Rh.length,s=1/(Rh.reduce((d,f)=>d+f,0)/r/1e3),c=Rh.filter(d=>d>Yf).reduce((d,f)=>d+(f-Yf)/Yf,0);return{loadTime:i,fullLoadTime:e,fps:s,percentDroppedFrames:c/(r+c)*100,totalFrames:r}}};b.$=Q,b.A=Oe,b.B=_e,b.C=U,b.D=cr,b.E=qe,b.F=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},b.G=Ur,b.H=br,b.I=vf,b.J=ne,b.K=function(i){if(wr==null){const e=i.navigator?i.navigator.userAgent:null;wr=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return wr},b.L=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Dv(()=>this.process()),this.subscription=Lr(this.target,"message",r=>this.receive(r),!1),this.globalScope=Yr(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}unregisterMessageHandler(i){delete this.messageHandlers[i]}sendAsync(i,e){return new Promise((r,s)=>{const c=Math.round(1e18*Math.random()).toString(36).substring(0,10),d=e?Lr(e.signal,"abort",()=>{d?.unsubscribe(),delete this.resolveRejects[c];const S={id:c,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(S)},Fv):null;this.resolveRejects[c]={resolve:S=>{d?.unsubscribe(),r(S)},reject:S=>{d?.unsubscribe(),s(S)}};const f=[],y=Object.assign(Object.assign({},i),{id:c,sourceMapId:this.mapId,origin:location.origin,data:_t(i.data,f)});this.target.postMessage(y,{transfer:f})})}receive(i){const e=i.data,r=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[r];const s=this.abortControllers[r];return delete this.abortControllers[r],void(s&&s.abort())}if(Yr(self)||e.mustQueue)return this.tasks[r]=e,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return a(this,void 0,void 0,function*(){if(e.type==="<response>"){const c=this.resolveRejects[i];return delete this.resolveRejects[i],c?void(e.error?c.reject(qt(e.error)):c.resolve(qt(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=qt(e.data),s=new AbortController;this.abortControllers[i]=s;try{const c=yield this.messageHandlers[e.type](e.sourceMapId,r,s);this.completeTask(i,null,c)}catch(c){this.completeTask(i,c)}})}completeTask(i,e,r){const s=[];delete this.abortControllers[i];const c={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?_t(e):null,data:_t(r,s)};this.target.postMessage(c,{transfer:s})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},b.M=at,b.N=function(){var i=new Oe(16);return Oe!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},b.O=function(i,e,r){var s,c,d,f,y,S,A,k,N,V,q,W,H=r[0],J=r[1],ue=r[2];return e===i?(i[12]=e[0]*H+e[4]*J+e[8]*ue+e[12],i[13]=e[1]*H+e[5]*J+e[9]*ue+e[13],i[14]=e[2]*H+e[6]*J+e[10]*ue+e[14],i[15]=e[3]*H+e[7]*J+e[11]*ue+e[15]):(c=e[1],d=e[2],f=e[3],y=e[4],S=e[5],A=e[6],k=e[7],N=e[8],V=e[9],q=e[10],W=e[11],i[0]=s=e[0],i[1]=c,i[2]=d,i[3]=f,i[4]=y,i[5]=S,i[6]=A,i[7]=k,i[8]=N,i[9]=V,i[10]=q,i[11]=W,i[12]=s*H+y*J+N*ue+e[12],i[13]=c*H+S*J+V*ue+e[13],i[14]=d*H+A*J+q*ue+e[14],i[15]=f*H+k*J+W*ue+e[15]),i},b.P=C,b.Q=function(i,e,r){var s=r[0],c=r[1],d=r[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*c,i[5]=e[5]*c,i[6]=e[6]*c,i[7]=e[7]*c,i[8]=e[8]*d,i[9]=e[9]*d,i[10]=e[10]*d,i[11]=e[11]*d,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},b.R=ma,b.S=function(i,e,r){var s=e[0],c=e[1],d=e[2],f=e[3],y=e[4],S=e[5],A=e[6],k=e[7],N=e[8],V=e[9],q=e[10],W=e[11],H=e[12],J=e[13],ue=e[14],Ne=e[15],de=r[0],ye=r[1],je=r[2],Ke=r[3];return i[0]=de*s+ye*y+je*N+Ke*H,i[1]=de*c+ye*S+je*V+Ke*J,i[2]=de*d+ye*A+je*q+Ke*ue,i[3]=de*f+ye*k+je*W+Ke*Ne,i[4]=(de=r[4])*s+(ye=r[5])*y+(je=r[6])*N+(Ke=r[7])*H,i[5]=de*c+ye*S+je*V+Ke*J,i[6]=de*d+ye*A+je*q+Ke*ue,i[7]=de*f+ye*k+je*W+Ke*Ne,i[8]=(de=r[8])*s+(ye=r[9])*y+(je=r[10])*N+(Ke=r[11])*H,i[9]=de*c+ye*S+je*V+Ke*J,i[10]=de*d+ye*A+je*q+Ke*ue,i[11]=de*f+ye*k+je*W+Ke*Ne,i[12]=(de=r[12])*s+(ye=r[13])*y+(je=r[14])*N+(Ke=r[15])*H,i[13]=de*c+ye*S+je*V+Ke*J,i[14]=de*d+ye*A+je*q+Ke*ue,i[15]=de*f+ye*k+je*W+Ke*Ne,i},b.T=uf,b.U=function(i,e){const r={};for(let s=0;s<e.length;s++){const c=e[s];c in i&&(r[c]=i[c])}return r},b.V=Nc,b.W=ut,b.X=rg,b.Y=tg,b.Z=Ie,b._=a,b.a=se,b.a$=sg,b.a0=ge,b.a1=Ar,b.a2=Xa,b.a3=ng,b.a4=hd,b.a5=vt,b.a6=function(i,e,r){if(!i)return e||{};if(!e)return i||{};const s=lg(i),c=lg(e);(function(f,y){y.removeAll&&(f.add.clear(),f.update.clear(),f.remove.clear(),y.remove.clear());for(const S of y.remove)f.add.delete(S),f.update.delete(S);for(const[S,A]of y.update){const k=f.update.get(S);k&&(y.update.set(S,Rv(k,A)),f.update.delete(S))}})(s,c);const d={};if((s.removeAll||c.removeAll)&&(d.removeAll=!0),d.remove=new Set([...s.remove,...c.remove]),d.add=new Map([...s.add,...c.add]),d.update=new Map([...s.update,...c.update]),d.remove.size&&d.add.size)for(const f of d.add.keys())d.remove.delete(f);return function(f){const y={};return f.removeAll&&(y.removeAll=f.removeAll),f.remove&&(y.remove=Array.from(f.remove)),f.add&&(y.add=Array.from(f.add.values())),f.update&&(y.update=Array.from(f.update.values())),y}(d)},b.a7=function(i,e){if(i==null||i.type==null)return!0;if(i.type==="Feature")return Mh(i,e)!=null;if(i.type==="FeatureCollection"){const r=new Set;for(const s of i.features){const c=Mh(s,e);if(c==null||r.has(c))return!1;r.add(c)}return!0}return!1},b.a8=function(i,e){const r=new Map;if(!(i==null||i.type==null))if(i.type==="Feature")r.set(Mh(i,e),i);else for(const s of i.features)r.set(Mh(s,e),s);return r},b.a9=function(i,e,r){var s,c;if(e.removeAll)i.clear();else if(e.remove)for(const d of e.remove)i.delete(d);if(e.add)for(const d of e.add){const f=Mh(d,r);f!=null&&i.set(f,d)}if(e.update)for(const d of e.update){let f=i.get(d.id);if(!f)continue;const y=!!d.newGeometry,S=d.removeAllProperties||((s=d.removeProperties)===null||s===void 0?void 0:s.length)>0||((c=d.addOrUpdateProperties)===null||c===void 0?void 0:c.length)>0;if((y||S)&&(f=Object.assign({},f),i.set(d.id,f),y&&(f.geometry=d.newGeometry),S)){if(f.properties=d.removeAllProperties?{}:Object.assign({},f.properties||{}),d.removeProperties)for(const A of d.removeProperties)delete f.properties[A];if(d.addOrUpdateProperties)for(const{key:A,value:k}of d.addOrUpdateProperties)f.properties[A]=k}}},b.aB=function(i,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:c}){return i.kind==="source"?s/hc:i.kind==="composite"?Ur.number(s/hc,c/hc,r):e},b.aC=function(i,e){var r=e[0],s=e[1],c=e[2],d=e[3],f=e[4],y=e[5],S=e[6],A=e[7],k=e[8],N=e[9],V=e[10],q=e[11],W=e[12],H=e[13],J=e[14],ue=e[15],Ne=r*y-s*f,de=r*S-c*f,ye=r*A-d*f,je=s*S-c*y,Ke=s*A-d*y,xt=c*A-d*S,Vt=k*H-N*W,zt=k*J-V*W,Xt=k*ue-q*W,lr=N*J-V*H,Kt=N*ue-q*H,jt=V*ue-q*J,Et=Ne*jt-de*Kt+ye*lr+je*Xt-Ke*zt+xt*Vt;return Et?(i[0]=(y*jt-S*Kt+A*lr)*(Et=1/Et),i[1]=(c*Kt-s*jt-d*lr)*Et,i[2]=(H*xt-J*Ke+ue*je)*Et,i[3]=(V*Ke-N*xt-q*je)*Et,i[4]=(S*Xt-f*jt-A*zt)*Et,i[5]=(r*jt-c*Xt+d*zt)*Et,i[6]=(J*ye-W*xt-ue*de)*Et,i[7]=(k*xt-V*ye+q*de)*Et,i[8]=(f*Kt-y*Xt+A*Vt)*Et,i[9]=(s*Xt-r*Kt-d*Vt)*Et,i[10]=(W*Ke-H*ye+ue*Ne)*Et,i[11]=(N*ye-k*Ke-q*Ne)*Et,i[12]=(y*zt-f*lr-S*Vt)*Et,i[13]=(r*lr-s*zt+c*Vt)*Et,i[14]=(H*de-W*je-J*Ne)*Et,i[15]=(k*je-N*de+V*Ne)*Et,i):null},b.aD=kt,b.aE=function(i){var e=i[0],r=i[1];return Math.sqrt(e*e+r*r)},b.aF=function(i){return i[0]=0,i[1]=0,i},b.aG=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i},b.aH=wf,b.aI=Ye,b.aJ=function(i,e,r,s){const c=e.y-i.y,d=e.x-i.x,f=s.y-r.y,y=s.x-r.x,S=f*d-y*c;if(S===0)return null;const A=(y*(i.y-r.y)-f*(i.x-r.x))/S;return new C(i.x+A*d,i.y+A*c)},b.aK=qg,b.aL=mh,b.aM=function(i){let e=1/0,r=1/0,s=-1/0,c=-1/0;for(const d of i)e=Math.min(e,d.x),r=Math.min(r,d.y),s=Math.max(s,d.x),c=Math.max(c,d.y);return[e,r,s,c]},b.aN=ts,b.aO=sr,b.aP=function(i,e,r,s,c=!1){if(!r[0]&&!r[1])return[0,0];const d=c?s==="map"?-i.bearingInRadians:0:s==="viewport"?i.bearingInRadians:0;if(d){const f=Math.sin(d),y=Math.cos(d);r=[r[0]*y-r[1]*f,r[0]*f+r[1]*y]}return[c?r[0]:sr(e,r[0],i.zoom),c?r[1]:sr(e,r[1],i.zoom)]},b.aR=xf,b.aS=$f,b.aT=bf,b.aU=Zf,b.aV=_i,b.aW=sd,b.aX=G,b.aY=Jt,b.aZ=Tt,b.a_=Rr,b.aa=Dh,b.ab=Lh,b.ac=mu,b.ad=25,b.ae=If,b.af=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(r=>{e.onloadstart=()=>{r(e)};for(const s of i){const c=window.document.createElement("source");te(s)||(e.crossOrigin="Anonymous"),c.src=s,e.appendChild(c)}})},b.ag=Ot,b.ah=function(){return wt++},b.ai=t,b.aj=Vu,b.ak=Yo,b.al=uc,b.am=ug,b.an=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,c,d)=>{const f=c||d;return e[s]=!f||f.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},b.ao=ct,b.ap=85.051129,b.aq=ai,b.ar=function(i){return Math.pow(2,i)},b.as=Ge,b.at=ig,b.au=function(i){return Math.log(i)/Math.LN2},b.av=function(i){var e=i[0],r=i[1];return e*e+r*r},b.aw=function(i){if(!i.length)return new Set;const e=Math.max(...i.map(S=>S.canonical.z));let r=1/0,s=-1/0,c=1/0,d=-1/0;const f=[];for(const S of i){const{x:A,y:k,z:N}=S.canonical,V=Math.pow(2,e-N),q=A*V,W=k*V;f.push({id:S,x:q,y:W}),q<r&&(r=q),q>s&&(s=q),W<c&&(c=W),W>d&&(d=W)}const y=new Set;for(const S of f)S.x!==r&&S.x!==s&&S.y!==c&&S.y!==d||y.add(S.id);return y},b.ax=function(i,e){const r=Math.abs(2*i.wrap)-+(i.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||s-r||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x},b.ay=class{constructor(i,e){this.max=i,this.onRemove=e,this.reset()}reset(){for(const i in this.data)for(const e of this.data[i])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(i,e,r){const s=i.wrapped().key;this.data[s]===void 0&&(this.data[s]=[]);const c={value:e,timeout:void 0};if(r!==void 0&&(c.timeout=setTimeout(()=>{this.remove(i,c)},r)),this.data[s].push(c),this.order.push(s),this.order.length>this.max){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const e=this.data[i].shift();return e.timeout&&clearTimeout(e.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),e.value}getByKey(i){const e=this.data[i];return e?e[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,e){if(!this.has(i))return this;const r=i.wrapped().key,s=e===void 0?0:this.data[r].indexOf(e),c=this.data[r][s];return this.data[r].splice(s,1),c.timeout&&clearTimeout(c.timeout),this.data[r].length===0&&delete this.data[r],this.onRemove(c.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(i){const e=[];for(const r in this.data)for(const s of this.data[r])i(s.value)||e.push(s);for(const r of e)this.remove(r.value.tileID,r)}},b.az=function(i,e){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:c,minZoom:d,maxZoom:f}=i,y=c?ct(Mr.interpolationFactor(c,e,d,f),0,1):0;i.kind==="camera"?s=Ur.number(i.minSize,i.maxSize,y):r=y}return{uSizeT:r,uSize:s}},b.b=Tr,b.b$=class extends Ns{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},b.b0=st,b.b1=Te,b.b2=function(i){var e=new Oe(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},b.b3=function(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i},b.b4=function(i,e){var r=e[0],s=e[1],c=e[2],d=r*r+s*s+c*c;return d>0&&(d=1/Math.sqrt(d)),i[0]=e[0]*d,i[1]=e[1]*d,i[2]=e[2]*d,i},b.b5=me,b.b6=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},b.b7=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},b.b8=it,b.b9=function(i,e,r){const s=e[0]*r[0]+e[1]*r[1]+e[2]*r[2];return s===0?null:(-(i[0]*r[0]+i[1]*r[1]+i[2]*r[2])-r[3])/s},b.bA=function(){return new Float64Array(3)},b.bB=function(i,e,r,s){return i[0]=e[0]+r[0]*s,i[1]=e[1]+r[1]*s,i[2]=e[2]+r[2]*s,i},b.bC=Dt,b.bD=function(i,e,r){var s=r[0],c=r[1],d=r[2],f=r[3],y=e[0],S=e[1],A=e[2],k=c*A-d*S,N=d*y-s*A,V=s*S-c*y;return i[0]=y+f*(k+=k)+c*(V+=V)-d*(N+=N),i[1]=S+f*N+d*k-s*V,i[2]=A+f*V+s*N-c*k,i},b.bE=function(i,e,r){const s=function(S){var A=S[3],k=S[4],N=S[5],V=S[6],q=S[7],W=S[8];return S[0]*(W*k-N*q)+S[1]*(-W*A+N*V)+S[2]*(q*A-k*V)}([i[0],i[1],i[2],e[0],e[1],e[2],r[0],r[1],r[2]]);if(s===0)return null;const c=me([],[e[0],e[1],e[2]],[r[0],r[1],r[2]]),d=me([],[r[0],r[1],r[2]],[i[0],i[1],i[2]]),f=me([],[i[0],i[1],i[2]],[e[0],e[1],e[2]]),y=st([],c,-i[3]);return Te(y,y,st([],d,-e[3])),Te(y,y,st([],f,-r[3])),st(y,y,1/s),y},b.bF=Af,b.bG=function(){return new Float64Array(4)},b.bH=function(i,e,r,s){var c=[],d=[];return c[0]=e[0]-r[0],c[1]=e[1]-r[1],c[2]=e[2]-r[2],d[0]=c[0]*Math.cos(s)-c[1]*Math.sin(s),d[1]=c[0]*Math.sin(s)+c[1]*Math.cos(s),d[2]=c[2],i[0]=d[0]+r[0],i[1]=d[1]+r[1],i[2]=d[2]+r[2],i},b.bI=function(i,e,r,s){var c=[],d=[];return c[0]=e[0]-r[0],c[1]=e[1]-r[1],c[2]=e[2]-r[2],d[0]=c[0],d[1]=c[1]*Math.cos(s)-c[2]*Math.sin(s),d[2]=c[1]*Math.sin(s)+c[2]*Math.cos(s),i[0]=d[0]+r[0],i[1]=d[1]+r[1],i[2]=d[2]+r[2],i},b.bJ=function(i,e,r,s){var c=[],d=[];return c[0]=e[0]-r[0],c[1]=e[1]-r[1],c[2]=e[2]-r[2],d[0]=c[2]*Math.sin(s)+c[0]*Math.cos(s),d[1]=c[1],d[2]=c[2]*Math.cos(s)-c[0]*Math.sin(s),i[0]=d[0]+r[0],i[1]=d[1]+r[1],i[2]=d[2]+r[2],i},b.bK=function(i,e,r){var s=Math.sin(r),c=Math.cos(r),d=e[0],f=e[1],y=e[2],S=e[3],A=e[8],k=e[9],N=e[10],V=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=d*c-A*s,i[1]=f*c-k*s,i[2]=y*c-N*s,i[3]=S*c-V*s,i[8]=d*s+A*c,i[9]=f*s+k*c,i[10]=y*s+N*c,i[11]=S*s+V*c,i},b.bL=function(i,e){const r=Zt(i,360),s=Zt(e,360),c=s-r,d=s>r?c-360:c+360;return Math.abs(c)<Math.abs(d)?c:d},b.bM=function(i){return i[0]=0,i[1]=0,i[2]=0,i},b.bN=function(i,e,r,s){const c=Math.sqrt(i*i+e*e),d=Math.sqrt(r*r+s*s);i/=c,e/=c,r/=d,s/=d;const f=Math.acos(i*r+e*s);return-e*r+i*s>0?f:-f},b.bO=function(i,e){const r=Zt(i,2*Math.PI),s=Zt(e,2*Math.PI);return Math.min(Math.abs(r-s),Math.abs(r-s+2*Math.PI),Math.abs(r-s-2*Math.PI))},b.bP=function(){const i={},e=ae.$version;for(const r in ae.$root){const s=ae.$root[r];if(s.required){let c=null;c=r==="version"?e:s.type==="array"?[]:{},c!=null&&(i[r]=c)}}return i},b.bQ=ot,b.bR=St,b.bS=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(!i(e[s],r[s]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const s in e)if(!i(e[s],r[s]))return!1;return!0}return e===r},b.bT=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=Nt(i[r],e[i[r].ref]));return i},b.bU=function(i,e){if(i.type==="custom")return new kv(i,e);switch(i.type){case"background":return new Cv(i,e);case"circle":return new m1(i,e);case"color-relief":return new x1(i,e);case"fill":return new z1(i,e);case"fill-extrusion":return new H1(i,e);case"heatmap":return new _1(i,e);case"hillshade":return new v1(i,e);case"line":return new tv(i,e);case"raster":return new Qn(i,e);case"symbol":return new ud(i,e)}},b.bV=i=>i.type==="raster",b.bW=ur,b.bX=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let r=[];try{if(!gt(i.version,e.version))return[{command:"setStyle",args:[e]}];gt(i.center,e.center)||r.push({command:"setCenter",args:[e.center]}),gt(i.state,e.state)||r.push({command:"setGlobalState",args:[e.state]}),gt(i.centerAltitude,e.centerAltitude)||r.push({command:"setCenterAltitude",args:[e.centerAltitude]}),gt(i.zoom,e.zoom)||r.push({command:"setZoom",args:[e.zoom]}),gt(i.bearing,e.bearing)||r.push({command:"setBearing",args:[e.bearing]}),gt(i.pitch,e.pitch)||r.push({command:"setPitch",args:[e.pitch]}),gt(i.roll,e.roll)||r.push({command:"setRoll",args:[e.roll]}),gt(i.sprite,e.sprite)||r.push({command:"setSprite",args:[e.sprite]}),gt(i.glyphs,e.glyphs)||r.push({command:"setGlyphs",args:[e.glyphs]}),gt(i.transition,e.transition)||r.push({command:"setTransition",args:[e.transition]}),gt(i.light,e.light)||r.push({command:"setLight",args:[e.light]}),gt(i.terrain,e.terrain)||r.push({command:"setTerrain",args:[e.terrain]}),gt(i.sky,e.sky)||r.push({command:"setSky",args:[e.sky]}),gt(i.projection,e.projection)||r.push({command:"setProjection",args:[e.projection]});const s={},c=[];(function(f,y,S,A){let k;for(k in y=y||{},f=f||{})Object.prototype.hasOwnProperty.call(f,k)&&(Object.prototype.hasOwnProperty.call(y,k)||Mt(k,S,A));for(k in y)Object.prototype.hasOwnProperty.call(y,k)&&(Object.prototype.hasOwnProperty.call(f,k)?gt(f[k],y[k])||(f[k].type==="geojson"&&y[k].type==="geojson"&&Ut(f,y,k)?Lt(S,{command:"setGeoJSONSourceData",args:[k,y[k].data]}):rr(k,y,S,A)):Ht(k,y,S))})(i.sources,e.sources,c,s);const d=[];i.layers&&i.layers.forEach(f=>{"source"in f&&s[f.source]?r.push({command:"removeLayer",args:[f.id]}):d.push(f)}),r=r.concat(c),function(f,y,S){y=y||[];const A=(f=f||[]).map(Xr),k=y.map(Xr),N=f.reduce(ri,{}),V=y.reduce(ri,{}),q=A.slice(),W=Object.create(null);let H,J,ue,Ne,de;for(let ye=0,je=0;ye<A.length;ye++)H=A[ye],Object.prototype.hasOwnProperty.call(V,H)?je++:(Lt(S,{command:"removeLayer",args:[H]}),q.splice(q.indexOf(H,je),1));for(let ye=0,je=0;ye<k.length;ye++)H=k[k.length-1-ye],q[q.length-1-ye]!==H&&(Object.prototype.hasOwnProperty.call(N,H)?(Lt(S,{command:"removeLayer",args:[H]}),q.splice(q.lastIndexOf(H,q.length-je),1)):je++,Ne=q[q.length-ye],Lt(S,{command:"addLayer",args:[V[H],Ne]}),q.splice(q.length-ye,0,H),W[H]=!0);for(let ye=0;ye<k.length;ye++)if(H=k[ye],J=N[H],ue=V[H],!W[H]&&!gt(J,ue))if(gt(J.source,ue.source)&&gt(J["source-layer"],ue["source-layer"])&&gt(J.type,ue.type)){for(de in gr(J.layout,ue.layout,S,H,null,"setLayoutProperty"),gr(J.paint,ue.paint,S,H,null,"setPaintProperty"),gt(J.filter,ue.filter)||Lt(S,{command:"setFilter",args:[H,ue.filter]}),gt(J.minzoom,ue.minzoom)&&gt(J.maxzoom,ue.maxzoom)||Lt(S,{command:"setLayerZoomRange",args:[H,ue.minzoom,ue.maxzoom]}),J)Object.prototype.hasOwnProperty.call(J,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?gr(J[de],ue[de],S,H,de.slice(6),"setPaintProperty"):gt(J[de],ue[de])||Lt(S,{command:"setLayerProperty",args:[H,de,ue[de]]}));for(de in ue)Object.prototype.hasOwnProperty.call(ue,de)&&!Object.prototype.hasOwnProperty.call(J,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?gr(J[de],ue[de],S,H,de.slice(6),"setPaintProperty"):gt(J[de],ue[de])||Lt(S,{command:"setLayerProperty",args:[H,de,ue[de]]}))}else Lt(S,{command:"removeLayer",args:[H]}),Ne=q[q.lastIndexOf(H)+1],Lt(S,{command:"addLayer",args:[ue,Ne]})}(d,e.layers,r)}catch(s){console.warn("Unable to compute style diff:",s),r=[{command:"setStyle",args:[e]}]}return r},b.bY=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},b.bZ=Bt,b.b_=er,b.ba=Xe,b.bb=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i},b.bc=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]},b.bd=og,b.be=qu,b.bf=function(i,e,r,s,c){var d=1/Math.tan(e/2);if(i[0]=d/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=d,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,c!=null&&c!==1/0){var f=1/(s-c);i[10]=(c+s)*f,i[14]=2*c*s*f}else i[10]=-1,i[14]=-2*s;return i},b.bg=function(i){var e=new Oe(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},b.bh=function(i,e,r){var s=Math.sin(r),c=Math.cos(r),d=e[0],f=e[1],y=e[2],S=e[3],A=e[4],k=e[5],N=e[6],V=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=d*c+A*s,i[1]=f*c+k*s,i[2]=y*c+N*s,i[3]=S*c+V*s,i[4]=A*c-d*s,i[5]=k*c-f*s,i[6]=N*c-y*s,i[7]=V*c-S*s,i},b.bi=function(i,e,r){var s=Math.sin(r),c=Math.cos(r),d=e[4],f=e[5],y=e[6],S=e[7],A=e[8],k=e[9],N=e[10],V=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=d*c+A*s,i[5]=f*c+k*s,i[6]=y*c+N*s,i[7]=S*c+V*s,i[8]=A*c-d*s,i[9]=k*c-f*s,i[10]=N*c-y*s,i[11]=V*c-S*s,i},b.bj=function(){const i=new Float32Array(16);return Ge(i),i},b.bk=function(){const i=new Float64Array(16);return Ge(i),i},b.bl=function(){return new Float64Array(16)},b.bm=function(i,e,r){const s=new Float64Array(4);return Dt(s,i,e-90,r),s},b.bn=function(i,e,r,s){var c,d,f,y,S,A=e[0],k=e[1],N=e[2],V=e[3],q=r[0],W=r[1],H=r[2],J=r[3];return(d=A*q+k*W+N*H+V*J)<0&&(d=-d,q=-q,W=-W,H=-H,J=-J),1-d>Qe?(c=Math.acos(d),f=Math.sin(c),y=Math.sin((1-s)*c)/f,S=Math.sin(s*c)/f):(y=1-s,S=s),i[0]=y*A+S*q,i[1]=y*k+S*W,i[2]=y*N+S*H,i[3]=y*V+S*J,i},b.bo=function(i){const e=new Float64Array(9);(function(d,f){var y=f[0],S=f[1],A=f[2],k=f[3],N=y+y,V=S+S,q=A+A,W=y*N,H=S*N,J=S*V,ue=A*N,Ne=A*V,de=A*q,ye=k*N,je=k*V,Ke=k*q;d[0]=1-J-de,d[3]=H-Ke,d[6]=ue+je,d[1]=H+Ke,d[4]=1-W-de,d[7]=Ne-ye,d[2]=ue-je,d[5]=Ne+ye,d[8]=1-W-J})(e,i);const r=Rr(-Math.asin(ct(e[2],-1,1)));let s,c;return Math.hypot(e[5],e[8])<.001?(s=0,c=-Rr(Math.atan2(e[3],e[4]))):(s=Rr(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),c=Rr(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:s,pitch:r+90,bearing:c}},b.bp=function(i,e){return i.roll==e.roll&&i.pitch==e.pitch&&i.bearing==e.bearing},b.bq=Wr,b.br=Io,b.bs=Bu,b.bt=Sh,b.bu=Ou,b.bv=he,b.bw=Fe,b.bx=jn,b.by=function(i,e,r,s,c){return he(s,c,ct((i-e)/(r-e),0,1))},b.bz=Zt,b.c=Ce,b.c$=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},b.c0=lc,b.c1=class extends Ns{constructor(i,e){super(i,e),this.current=Du}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},b.c2=Cl,b.c3=class extends Ns{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},b.c4=class extends Ns{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},b.c5=Me,b.c6=function(i,e){var r=Math.sin(e),s=Math.cos(e);return i[0]=s,i[1]=r,i[2]=0,i[3]=-r,i[4]=s,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},b.c7=function(i,e,r){var s=e[0],c=e[1],d=e[2];return i[0]=s*r[0]+c*r[3]+d*r[6],i[1]=s*r[1]+c*r[4]+d*r[7],i[2]=s*r[2]+c*r[5]+d*r[8],i},b.c8=function(i,e,r,s,c,d,f){var y=1/(e-r),S=1/(s-c),A=1/(d-f);return i[0]=-2*y,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*S,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*A,i[11]=0,i[12]=(e+r)*y,i[13]=(c+s)*S,i[14]=(f+d)*A,i[15]=1,i},b.c9=class extends Ns{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(4*i.length);for(let r=0;r<i.length;r++)e[4*r]=i[r].r,e[4*r+1]=i[r].g,e[4*r+2]=i[r].b,e[4*r+3]=i[r].a;this.gl.uniform4fv(this.location,e)}}},b.cA=function(i,e){return re[e]&&(i instanceof MouseEvent||i instanceof WheelEvent)},b.cB=function(i,e){return nt[e]&&"touches"in i},b.cC=function(i){return nt[i]||re[i]},b.cD=function(i,e,r){var s=e[0],c=e[1];return i[0]=r[0]*s+r[4]*c+r[12],i[1]=r[1]*s+r[5]*c+r[13],i},b.cE=function(i,e){const{x:r,y:s}=Lh.fromLngLat(e);return!(i<0||i>25||s<0||s>=1||r<0||r>=1)},b.cF=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},b.cG=class extends bs{},b.cH=yb,b.cJ=Be,b.cK=function(i,e){Ce.REGISTERED_PROTOCOLS[i]=e},b.cL=function(i){delete Ce.REGISTERED_PROTOCOLS[i]},b.cM=function(i,e){const r={};for(let c=0;c<i.length;c++){const d=e&&e[i[c].id]||$a(i[c]);e&&(e[i[c].id]=d);let f=r[d];f||(f=r[d]=[]),f.push(i[c])}const s=[];for(const c in r)s.push(r[c]);return s},b.cN=ke,b.cO=cg,b.cP=Ug,b.cQ=Gm,b.cR=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=vt/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,s=e._unevaluatedLayout._values,c={layoutIconSize:s["icon-size"].possiblyEvaluate(new br(i.bucket.zoom+1),i.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new br(i.bucket.zoom+1),i.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new br(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:A,maxZoom:k}=i.bucket.textSizeData;c.compositeTextSizes=[s["text-size"].possiblyEvaluate(new br(A),i.canonical),s["text-size"].possiblyEvaluate(new br(k),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:A,maxZoom:k}=i.bucket.iconSizeData;c.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new br(A),i.canonical),s["icon-size"].possiblyEvaluate(new br(k),i.canonical)]}const d=r.get("text-line-height")*ts,f=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",y=r.get("text-keep-upright"),S=r.get("text-size");for(const A of i.bucket.features){const k=r.get("text-font").evaluate(A,{},i.canonical).join(","),N=S.evaluate(A,{},i.canonical),V=c.layoutTextSize.evaluate(A,{},i.canonical),q=c.layoutIconSize.evaluate(A,{},i.canonical),W={horizontal:{},vertical:void 0},H=A.text;let J,ue=[0,0];if(H){const ye=H.toString(),je=r.get("text-letter-spacing").evaluate(A,{},i.canonical)*ts,Ke=Nr(ye)?je:0,xt=r.get("text-anchor").evaluate(A,{},i.canonical),Vt=e_(e,A,i.canonical);if(!Vt){const Kt=r.get("text-radial-offset").evaluate(A,{},i.canonical);ue=Kt?Qg(xt,[Kt*ts,Gf]):r.get("text-offset").evaluate(A,{},i.canonical).map(jt=>jt*ts)}let zt=f?"center":r.get("text-justify").evaluate(A,{},i.canonical);const Xt=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(A,{},i.canonical)*ts:1/0,lr=()=>{i.bucket.allowVerticalPlacement&&Qt(ye)&&(W.vertical=ld(H,i.glyphMap,i.glyphPositions,i.imagePositions,k,Xt,d,xt,"left",Ke,ue,b.aA.vertical,!0,V,N))};if(!f&&Vt){const Kt=new Set;if(zt==="auto")for(let Et=0;Et<Vt.values.length;Et+=2)Kt.add($f(Vt.values[Et]));else Kt.add(zt);let jt=!1;for(const Et of Kt)if(!W.horizontal[Et])if(jt)W.horizontal[Et]=W.horizontal[0];else{const yr=ld(H,i.glyphMap,i.glyphPositions,i.imagePositions,k,Xt,d,"center",Et,Ke,ue,b.aA.horizontal,!1,V,N);yr&&(W.horizontal[Et]=yr,jt=yr.positionedLines.length===1)}lr()}else{zt==="auto"&&(zt=$f(xt));const Kt=ld(H,i.glyphMap,i.glyphPositions,i.imagePositions,k,Xt,d,xt,zt,Ke,ue,b.aA.horizontal,!1,V,N);Kt&&(W.horizontal[zt]=Kt),lr(),Qt(ye)&&f&&y&&(W.vertical=ld(H,i.glyphMap,i.glyphPositions,i.imagePositions,k,Xt,d,xt,zt,Ke,ue,b.aA.vertical,!1,V,N))}}let Ne=!1;if(A.icon&&A.icon.name){const ye=i.imageMap[A.icon.name];ye&&(J=Iv(i.imagePositions[A.icon.name],r.get("icon-offset").evaluate(A,{},i.canonical),r.get("icon-anchor").evaluate(A,{},i.canonical)),Ne=!!ye.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=Ne:i.bucket.sdfIcons!==Ne&&Ft("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ye.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const de=r_(W.horizontal)||W.vertical;i.bucket.iconsInText=!!de&&de.iconsInText,(de||J)&&gb(i.bucket,A,W,J,i.imageMap,c,V,q,ue,Ne,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},b.cS=pf,b.cT=gf,b.cU=_f,b.cV=function(i){const e=new od;return function(r,s){for(const c in r.layers)s.writeMessage(3,rb,r.layers[c])}(i,e),e.finish()},b.cW=function(i,e,r,s,c,d){let f=Gg(i,e,r,c,0);return f=Gg(f,e,s,d,1),f},b.cX=class{constructor(i){this.maxEntries=i,this.map=new Map}get(i){const e=this.map.get(i);return e!==void 0&&(this.map.delete(i),this.map.set(i,e)),e}set(i,e){if(this.map.has(i))this.map.delete(i);else if(this.map.size>=this.maxEntries){const r=this.map.keys().next().value;this.map.delete(r)}this.map.set(i,e)}clear(){this.map.clear()}},b.cY=Am,b.cZ=od,b.c_=Bg,b.ca=class extends Ns{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(i);this.gl.uniform1fv(this.location,e)}}},b.cb=class extends ac{},b.cc=sv,b.cd=class extends tl{},b.ce=cf,b.cf=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},b.cg=hm,b.ch=function(i,e,r){var s=e[0],c=e[1],d=e[2],f=r[3]*s+r[7]*c+r[11]*d+r[15];return i[0]=(r[0]*s+r[4]*c+r[8]*d+r[12])/(f=f||1),i[1]=(r[1]*s+r[5]*c+r[9]*d+r[13])/f,i[2]=(r[2]*s+r[6]*c+r[10]*d+r[14])/f,i},b.ci=class extends xs{},b.cj=class extends Ao{},b.ck=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},b.cl=function(i,e){var r=i[0],s=i[1],c=i[2],d=i[3],f=i[4],y=i[5],S=i[6],A=i[7],k=i[8],N=i[9],V=i[10],q=i[11],W=i[12],H=i[13],J=i[14],ue=i[15],Ne=e[0],de=e[1],ye=e[2],je=e[3],Ke=e[4],xt=e[5],Vt=e[6],zt=e[7],Xt=e[8],lr=e[9],Kt=e[10],jt=e[11],Et=e[12],yr=e[13],pr=e[14],vr=e[15];return Math.abs(r-Ne)<=Qe*Math.max(1,Math.abs(r),Math.abs(Ne))&&Math.abs(s-de)<=Qe*Math.max(1,Math.abs(s),Math.abs(de))&&Math.abs(c-ye)<=Qe*Math.max(1,Math.abs(c),Math.abs(ye))&&Math.abs(d-je)<=Qe*Math.max(1,Math.abs(d),Math.abs(je))&&Math.abs(f-Ke)<=Qe*Math.max(1,Math.abs(f),Math.abs(Ke))&&Math.abs(y-xt)<=Qe*Math.max(1,Math.abs(y),Math.abs(xt))&&Math.abs(S-Vt)<=Qe*Math.max(1,Math.abs(S),Math.abs(Vt))&&Math.abs(A-zt)<=Qe*Math.max(1,Math.abs(A),Math.abs(zt))&&Math.abs(k-Xt)<=Qe*Math.max(1,Math.abs(k),Math.abs(Xt))&&Math.abs(N-lr)<=Qe*Math.max(1,Math.abs(N),Math.abs(lr))&&Math.abs(V-Kt)<=Qe*Math.max(1,Math.abs(V),Math.abs(Kt))&&Math.abs(q-jt)<=Qe*Math.max(1,Math.abs(q),Math.abs(jt))&&Math.abs(W-Et)<=Qe*Math.max(1,Math.abs(W),Math.abs(Et))&&Math.abs(H-yr)<=Qe*Math.max(1,Math.abs(H),Math.abs(yr))&&Math.abs(J-pr)<=Qe*Math.max(1,Math.abs(J),Math.abs(pr))&&Math.abs(ue-vr)<=Qe*Math.max(1,Math.abs(ue),Math.abs(vr))},b.cm=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},b.cn=i=>i.type==="symbol",b.co=i=>i.type==="circle",b.cp=i=>i.type==="heatmap",b.cq=i=>i.type==="line",b.cr=i=>i.type==="fill",b.cs=i=>i.type==="fill-extrusion",b.ct=i=>i.type==="hillshade",b.cu=i=>i.type==="color-relief",b.cv=i=>i.type==="background",b.cw=i=>i.type==="custom",b.cx=$e,b.cy=function(i,e,r){const s=yt(e.x-r.x,e.y-r.y),c=yt(i.x-r.x,i.y-r.y),d=Math.atan2(s[0]*c[1]-s[1]*c[0],function(f,y){return f[0]*y[0]+f[1]*y[1]}(s,c));return Rr(d)},b.cz=tt,b.d=te,b.d0=function(i,e,r,s,c){return a(this,void 0,void 0,function*(){if(ge())try{return yield Ar(i,e,r,s,c)}catch{}return function(d,f,y,S,A){const k=d.width,N=d.height;mr&&Vr||(mr=new OffscreenCanvas(k,N),Vr=mr.getContext("2d",{willReadFrequently:!0})),mr.width=k,mr.height=N,Vr.drawImage(d,0,0,k,N);const V=Vr.getImageData(f,y,S,A);return Vr.clearRect(0,0,k,N),V.data}(i,e,r,s,c)})},b.d1=pm,b.d2=F,b.d3=class{constructor(i,e){this.layers={[Dh]:this},this.name=Dh,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=i.length,this.features=i}feature(i){return new tb(this.features[i],this.extent)}},b.d4=wl,b.d5=Ei,b.e=pt,b.f=i=>a(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),b.g=ht,b.h=i=>new Promise((e,r)=>{const s=new Image;s.onload=()=>{e(s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame(()=>{s.src=ir})},s.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(i)],{type:"image/png"});s.src=i.byteLength?URL.createObjectURL(c):ir}),b.i=Yr,b.j=(i,e)=>Rt(pt(i,{type:"json"}),e),b.k=Ee,b.l=fe,b.m=Rt,b.n=(i,e)=>Rt(pt(i,{type:"arrayBuffer"}),e),b.o=function(i){return new od(i).readFields(vv,[])},b.p=qm,b.q=function(i){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))},b.r=yh,b.s=Lr,b.t=Di,b.u=ae,b.v=E,b.w=Ft,b.x=Wi,b.y=Z,b.z=ki}),v("worker",["./shared"],function(b){class a{constructor(re,K){this.keyCache={},re&&this.replace(re,K)}replace(re,K){this._layerConfigs={},this._layers={},this.update(re,[],K)}update(re,K,se){for(const Ce of re){this._layerConfigs[Ce.id]=Ce;const ht=this._layers[Ce.id]=b.bU(Ce,se);ht._featureFilter=b.ak(ht.filter,se),this.keyCache[Ce.id]&&delete this.keyCache[Ce.id]}for(const Ce of K)delete this.keyCache[Ce],delete this._layerConfigs[Ce],delete this._layers[Ce];this.familiesBySource={};const Ie=b.cM(Object.values(this._layerConfigs),this.keyCache);for(const Ce of Ie){const ht=Ce.map(I=>this._layers[I.id]),at=ht[0];if(at.visibility==="none")continue;const Be=at.source||"";let ot=this.familiesBySource[Be];ot||(ot=this.familiesBySource[Be]={});const Rt=at.sourceLayer||b.aa;let te=ot[Rt];te||(te=ot[Rt]=[]),te.push(ht)}}}class C{constructor(re){const K={},se=[];for(const at in re){const Be=re[at],ot=K[at]={};for(const Rt in Be){const te=Be[+Rt];if(!te||te.bitmap.width===0||te.bitmap.height===0)continue;const I={x:0,y:0,w:te.bitmap.width+2,h:te.bitmap.height+2};se.push(I),ot[Rt]={rect:I,metrics:te.metrics}}}const{w:Ie,h:Ce}=b.p(se),ht=new b.r({width:Ie||1,height:Ce||1});for(const at in re){const Be=re[at];for(const ot in Be){const Rt=Be[+ot];if(!Rt||Rt.bitmap.width===0||Rt.bitmap.height===0)continue;const te=K[at][ot].rect;b.r.copy(Rt.bitmap,ht,{x:0,y:0},{x:te.x+1,y:te.y+1},Rt.bitmap)}}this.image=ht,this.positions=K}}b.cN("GlyphAtlas",C);class F{constructor(re){this.tileID=new b.a2(re.tileID.overscaledZ,re.tileID.wrap,re.tileID.canonical.z,re.tileID.canonical.x,re.tileID.canonical.y),this.uid=re.uid,this.zoom=re.zoom,this.pixelRatio=re.pixelRatio,this.tileSize=re.tileSize,this.source=re.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=re.showCollisionBoxes,this.collectResourceTiming=!!re.collectResourceTiming,this.returnDependencies=!!re.returnDependencies,this.promoteId=re.promoteId,this.inFlightDependencies=[]}parse(re,K,se,Ie,Ce){return b._(this,void 0,void 0,function*(){this.status="parsing",this.data=re,this.collisionBoxArray=new b.ai;const ht=new b.cO(Object.keys(re.layers).sort()),at=new b.cP(this.tileID,this.promoteId);at.bucketLayerIDs=[];const Be={},ot={featureIndex:at,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:se,subdivisionGranularity:Ce},Rt=K.familiesBySource[this.source];for(const Ut in Rt){const gr=re.layers[Ut];if(!gr)continue;gr.version===1&&b.w(`Vector tile source "${this.source}" layer "${Ut}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Xr=ht.encode(Ut),ri=[];for(let Ot=0;Ot<gr.length;Ot++){const kr=gr.feature(Ot),Fi=at.getId(kr,Ut);ri.push({feature:kr,id:Fi,index:Ot,sourceLayerIndex:Xr})}for(const Ot of Rt[Ut]){const kr=Ot[0];kr.source!==this.source&&b.w(`layer.source = ${kr.source} does not equal this.source = ${this.source}`),kr.isHidden(this.zoom,!0)||(O(Ot,this.zoom,se),(Be[kr.id]=kr.createBucket({index:at.bucketLayerIDs.length,layers:Ot,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Xr,sourceID:this.source})).populate(ri,ot,this.tileID.canonical),at.bucketLayerIDs.push(Ot.map(Fi=>Fi.id)))}}const te=b.bZ(ot.glyphDependencies,Ut=>Object.keys(Ut).map(Number));this.inFlightDependencies.forEach(Ut=>Ut?.abort()),this.inFlightDependencies=[];let I=Promise.resolve({});if(Object.keys(te).length){const Ut=new AbortController;this.inFlightDependencies.push(Ut),I=Ie.sendAsync({type:"GG",data:{stacks:te,source:this.source,tileID:this.tileID,type:"glyphs"}},Ut)}const D=Object.keys(ot.iconDependencies);let fe=Promise.resolve({});if(D.length){const Ut=new AbortController;this.inFlightDependencies.push(Ut),fe=Ie.sendAsync({type:"GI",data:{icons:D,source:this.source,tileID:this.tileID,type:"icons"}},Ut)}const Ee=Object.keys(ot.patternDependencies);let qe=Promise.resolve({});if(Ee.length){const Ut=new AbortController;this.inFlightDependencies.push(Ut),qe=Ie.sendAsync({type:"GI",data:{icons:Ee,source:this.source,tileID:this.tileID,type:"patterns"}},Ut)}const ae=ot.dashDependencies;let ft=Promise.resolve({});if(Object.keys(ae).length){const Ut=new AbortController;this.inFlightDependencies.push(Ut),ft=Ie.sendAsync({type:"GDA",data:{dashes:ae}},Ut)}const[Nt,gt,Lt,Ht]=yield Promise.all([I,fe,qe,ft]),Mt=new C(Nt),rr=new b.cQ(gt,Lt);for(const Ut in Be){const gr=Be[Ut];gr instanceof b.aj?(O(gr.layers,this.zoom,se),b.cR({bucket:gr,glyphMap:Nt,glyphPositions:Mt.positions,imageMap:gt,imagePositions:rr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:ot.subdivisionGranularity})):gr.hasDependencies&&(gr instanceof b.cS||gr instanceof b.cT||gr instanceof b.cU)&&(O(gr.layers,this.zoom,se),gr.addFeatures(ot,this.tileID.canonical,rr.patternPositions,Ht))}return this.status="done",{buckets:Object.values(Be).filter(Ut=>!Ut.isEmpty()),featureIndex:at,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Mt.image,imageAtlas:rr,dashPositions:Ht,glyphMap:this.returnDependencies?Nt:null,iconMap:this.returnDependencies?gt:null,glyphPositions:this.returnDependencies?Mt.positions:null}})}}function O(nt,re,K){const se=new b.H(re);for(const Ie of nt)Ie.recalculate(se,K)}class Y{constructor(re,K,se,Ie,Ce){this.type=re,this.properties=se||{},this.extent=Ce,this.pointsArray=K,this.id=Ie}loadGeometry(){return this.pointsArray.map(re=>re.map(K=>new b.P(K.x,K.y)))}}class ee{constructor(re,K,se){this.version=2,this._myFeatures=re,this.name=K,this.length=re.length,this.extent=se}feature(re){return this._myFeatures[re]}}class j{constructor(){this.layers={}}addLayer(re){this.layers[re.name]=re}}function Pe(nt){let re=b.cV(nt);return re.byteOffset===0&&re.byteLength===re.buffer.byteLength||(re=new Uint8Array(re)),{vectorTile:nt,rawData:re.buffer}}function ce(nt,re,K){const{extent:se}=nt,Ie=Math.pow(2,K.z-re.z),Ce=(K.x-re.x*Ie)*se,ht=(K.y-re.y*Ie)*se,at=[];for(let Be=0;Be<nt.length;Be++){const ot=nt.feature(Be);let Rt=ot.loadGeometry();for(const I of Rt)for(const D of I)D.x=D.x*Ie-Ce,D.y=D.y*Ie-ht;const te=128;Rt=b.cW(Rt,ot.type,-te,-te,se+te,se+te),Rt.length!==0&&at.push(new Y(ot.type,Rt,ot.properties,ot.id,se))}return new ee(at,nt.name,se)}class Q{constructor(re,K,se){this.actor=re,this.layerIndex=K,this.availableImages=se,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new b.cX(1e3)}loadVectorTile(re,K){return b._(this,void 0,void 0,function*(){const se=yield b.n(re.request,K);try{return{vectorTile:re.encoding!=="mlt"?new b.cY(new b.cZ(se.data)):new b.c_(se.data),rawData:se.data,cacheControl:se.cacheControl,expires:se.expires}}catch(Ie){const Ce=new Uint8Array(se.data);let ht=`Unable to parse the tile at ${re.request.url}, `;throw ht+=Ce[0]===31&&Ce[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Ie.message}`,new Error(ht)}})}loadTile(re){return b._(this,void 0,void 0,function*(){const{uid:K,overzoomParameters:se}=re;se&&(re.request=se.overzoomRequest);const Ie=!!(re&&re.request&&re.request.collectResourceTiming)&&new b.c$(re.request),Ce=new F(re);this.loading[K]=Ce;const ht=new AbortController;Ce.abort=ht;try{const at=yield this.loadVectorTile(re,ht);if(delete this.loading[K],!at)return null;if(se){const I=this._getOverzoomTile(re,at.vectorTile);at.rawData=I.rawData,at.vectorTile=I.vectorTile}const Be=at.rawData,ot={};at.expires&&(ot.expires=at.expires),at.cacheControl&&(ot.cacheControl=at.cacheControl);const Rt={};if(Ie){const I=Ie.finish();I&&(Rt.resourceTiming=JSON.parse(JSON.stringify(I)))}Ce.vectorTile=at.vectorTile;const te=Ce.parse(at.vectorTile,this.layerIndex,this.availableImages,this.actor,re.subdivisionGranularity);this.loaded[K]=Ce,this.fetching[K]={rawTileData:Be,cacheControl:ot,resourceTiming:Rt};try{const I=yield te;return b.e({rawTileData:Be.slice(0),encoding:re.encoding},I,ot,Rt)}finally{delete this.fetching[K]}}catch(at){throw delete this.loading[K],Ce.status="done",this.loaded[K]=Ce,at}})}_getOverzoomTile(re,K){const{tileID:se,source:Ie,overzoomParameters:Ce}=re,{maxZoomTileID:ht}=Ce,at=`${ht.key}_${se.key}`,Be=this.overzoomedTileResultCache.get(at);if(Be)return Be;const ot=new j,Rt=this.layerIndex.familiesBySource[Ie];for(const I in Rt){const D=K.layers[I];if(!D)continue;const fe=ce(D,ht,se.canonical);fe.length>0&&ot.addLayer(fe)}const te=Pe(ot);return this.overzoomedTileResultCache.set(at,te),te}reloadTile(re){return b._(this,void 0,void 0,function*(){const K=re.uid;if(!this.loaded||!this.loaded[K])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const se=this.loaded[K];if(se.showCollisionBoxes=re.showCollisionBoxes,se.status==="parsing"){const Ie=yield se.parse(se.vectorTile,this.layerIndex,this.availableImages,this.actor,re.subdivisionGranularity);let Ce;if(this.fetching[K]){const{rawTileData:ht,cacheControl:at,resourceTiming:Be}=this.fetching[K];delete this.fetching[K],Ce=b.e({rawTileData:ht.slice(0),encoding:re.encoding},Ie,at,Be)}else Ce=Ie;return Ce}if(se.status==="done"&&se.vectorTile)return se.parse(se.vectorTile,this.layerIndex,this.availableImages,this.actor,re.subdivisionGranularity)})}abortTile(re){return b._(this,void 0,void 0,function*(){const K=this.loading,se=re.uid;K&&K[se]&&K[se].abort&&(K[se].abort.abort(),delete K[se])})}removeTile(re){return b._(this,void 0,void 0,function*(){this.loaded&&this.loaded[re.uid]&&delete this.loaded[re.uid]})}}class ge{constructor(){this.loaded={}}loadTile(re){return b._(this,void 0,void 0,function*(){const{uid:K,encoding:se,rawImageData:Ie,redFactor:Ce,greenFactor:ht,blueFactor:at,baseShift:Be}=re,ot=Ie.width+2,Rt=Ie.height+2,te=b.b(Ie)?new b.R({width:ot,height:Rt},yield b.d0(Ie,-1,-1,ot,Rt)):Ie,I=new b.d1(K,te,se,Ce,ht,at,Be);return this.loaded=this.loaded||{},this.loaded[K]=I,I})}removeTile(re){const K=this.loaded,se=re.uid;K&&K[se]&&delete K[se]}}var Qe,Oe,Me=function(){if(Oe)return Qe;function nt(K,se){if(K.length!==0){re(K[0],se);for(var Ie=1;Ie<K.length;Ie++)re(K[Ie],!se)}}function re(K,se){for(var Ie=0,Ce=0,ht=0,at=K.length,Be=at-1;ht<at;Be=ht++){var ot=(K[ht][0]-K[Be][0])*(K[Be][1]+K[ht][1]),Rt=Ie+ot;Ce+=Math.abs(Ie)>=Math.abs(ot)?Ie-Rt+ot:ot-Rt+Ie,Ie=Rt}Ie+Ce>=0!=!!se&&K.reverse()}return Oe=1,Qe=function K(se,Ie){var Ce,ht=se&&se.type;if(ht==="FeatureCollection")for(Ce=0;Ce<se.features.length;Ce++)K(se.features[Ce],Ie);else if(ht==="GeometryCollection")for(Ce=0;Ce<se.geometries.length;Ce++)K(se.geometries[Ce],Ie);else if(ht==="Feature")K(se.geometry,Ie);else if(ht==="Polygon")nt(se.coordinates,Ie);else if(ht==="MultiPolygon")for(Ce=0;Ce<se.coordinates.length;Ce++)nt(se.coordinates[Ce],Ie);return se}}(),Ge=b.d2(Me);const Ze={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:nt=>nt},it=Math.fround||(He=new Float32Array(1),nt=>(He[0]=+nt,He[0]));var He;class Te{constructor(re){this.options=Object.assign(Object.create(Ze),re),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(re){const{log:K,minZoom:se,maxZoom:Ie}=this.options;K&&console.time("total time");const Ce=`prepare ${re.length} points`;K&&console.time(Ce),this.points=re;const ht=[];for(let Be=0;Be<re.length;Be++){const ot=re[Be];if(!ot.geometry)continue;const[Rt,te]=ot.geometry.coordinates,I=it(xe(Rt)),D=it(Xe(te));ht.push(I,D,1/0,Be,-1,1),this.options.reduce&&ht.push(0)}let at=this.trees[Ie+1]=this._createTree(ht);K&&console.timeEnd(Ce);for(let Be=Ie;Be>=se;Be--){const ot=+Date.now();at=this.trees[Be]=this._createTree(this._cluster(at,Be)),K&&console.log("z%d: %d clusters in %dms",Be,at.numItems,+Date.now()-ot)}return K&&console.timeEnd("total time"),this}getClusters(re,K){let se=((re[0]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,re[1]));let Ce=re[2]===180?180:((re[2]+180)%360+360)%360-180;const ht=Math.max(-90,Math.min(90,re[3]));if(re[2]-re[0]>=360)se=-180,Ce=180;else if(se>Ce){const te=this.getClusters([se,Ie,180,ht],K),I=this.getClusters([-180,Ie,Ce,ht],K);return te.concat(I)}const at=this.trees[this._limitZoom(K)],Be=at.range(xe(se),Xe(ht),xe(Ce),Xe(Ie)),ot=at.data,Rt=[];for(const te of Be){const I=this.stride*te;Rt.push(ot[I+5]>1?st(ot,I,this.clusterProps):this.points[ot[I+3]])}return Rt}getChildren(re){const K=this._getOriginId(re),se=this._getOriginZoom(re),Ie="No cluster with the specified id.",Ce=this.trees[se];if(!Ce)throw new Error(Ie);const ht=Ce.data;if(K*this.stride>=ht.length)throw new Error(Ie);const at=this.options.radius/(this.options.extent*Math.pow(2,se-1)),Be=Ce.within(ht[K*this.stride],ht[K*this.stride+1],at),ot=[];for(const Rt of Be){const te=Rt*this.stride;ht[te+4]===re&&ot.push(ht[te+5]>1?st(ht,te,this.clusterProps):this.points[ht[te+3]])}if(ot.length===0)throw new Error(Ie);return ot}getLeaves(re,K,se){const Ie=[];return this._appendLeaves(Ie,re,K=K||10,se=se||0,0),Ie}getTile(re,K,se){const Ie=this.trees[this._limitZoom(re)],Ce=Math.pow(2,re),{extent:ht,radius:at}=this.options,Be=at/ht,ot=(se-Be)/Ce,Rt=(se+1+Be)/Ce,te={features:[]};return this._addTileFeatures(Ie.range((K-Be)/Ce,ot,(K+1+Be)/Ce,Rt),Ie.data,K,se,Ce,te),K===0&&this._addTileFeatures(Ie.range(1-Be/Ce,ot,1,Rt),Ie.data,Ce,se,Ce,te),K===Ce-1&&this._addTileFeatures(Ie.range(0,ot,Be/Ce,Rt),Ie.data,-1,se,Ce,te),te.features.length?te:null}getClusterExpansionZoom(re){let K=this._getOriginZoom(re)-1;for(;K<=this.options.maxZoom;){const se=this.getChildren(re);if(K++,se.length!==1)break;re=se[0].properties.cluster_id}return K}_appendLeaves(re,K,se,Ie,Ce){const ht=this.getChildren(K);for(const at of ht){const Be=at.properties;if(Be&&Be.cluster?Ce+Be.point_count<=Ie?Ce+=Be.point_count:Ce=this._appendLeaves(re,Be.cluster_id,se,Ie,Ce):Ce<Ie?Ce++:re.push(at),re.length===se)break}return Ce}_createTree(re){const K=new b.aU(re.length/this.stride|0,this.options.nodeSize,Float32Array);for(let se=0;se<re.length;se+=this.stride)K.add(re[se],re[se+1]);return K.finish(),K.data=re,K}_addTileFeatures(re,K,se,Ie,Ce,ht){for(const at of re){const Be=at*this.stride,ot=K[Be+5]>1;let Rt,te,I;if(ot)Rt=me(K,Be,this.clusterProps),te=K[Be],I=K[Be+1];else{const Ee=this.points[K[Be+3]];Rt=Ee.properties;const[qe,ae]=Ee.geometry.coordinates;te=xe(qe),I=Xe(ae)}const D={type:1,geometry:[[Math.round(this.options.extent*(te*Ce-se)),Math.round(this.options.extent*(I*Ce-Ie))]],tags:Rt};let fe;fe=ot||this.options.generateId?K[Be+3]:this.points[K[Be+3]].id,fe!==void 0&&(D.id=fe),ht.features.push(D)}}_limitZoom(re){return Math.max(this.options.minZoom,Math.min(Math.floor(+re),this.options.maxZoom+1))}_cluster(re,K){const{radius:se,extent:Ie,reduce:Ce,minPoints:ht}=this.options,at=se/(Ie*Math.pow(2,K)),Be=re.data,ot=[],Rt=this.stride;for(let te=0;te<Be.length;te+=Rt){if(Be[te+2]<=K)continue;Be[te+2]=K;const I=Be[te],D=Be[te+1],fe=re.within(Be[te],Be[te+1],at),Ee=Be[te+5];let qe=Ee;for(const ae of fe){const ft=ae*Rt;Be[ft+2]>K&&(qe+=Be[ft+5])}if(qe>Ee&&qe>=ht){let ae,ft=I*Ee,Nt=D*Ee,gt=-1;const Lt=(te/Rt<<5)+(K+1)+this.points.length;for(const Ht of fe){const Mt=Ht*Rt;if(Be[Mt+2]<=K)continue;Be[Mt+2]=K;const rr=Be[Mt+5];ft+=Be[Mt]*rr,Nt+=Be[Mt+1]*rr,Be[Mt+4]=Lt,Ce&&(ae||(ae=this._map(Be,te,!0),gt=this.clusterProps.length,this.clusterProps.push(ae)),Ce(ae,this._map(Be,Mt)))}Be[te+4]=Lt,ot.push(ft/qe,Nt/qe,1/0,Lt,-1,qe),Ce&&ot.push(gt)}else{for(let ae=0;ae<Rt;ae++)ot.push(Be[te+ae]);if(qe>1)for(const ae of fe){const ft=ae*Rt;if(!(Be[ft+2]<=K)){Be[ft+2]=K;for(let Nt=0;Nt<Rt;Nt++)ot.push(Be[ft+Nt])}}}}return ot}_getOriginId(re){return re-this.points.length>>5}_getOriginZoom(re){return(re-this.points.length)%32}_map(re,K,se){if(re[K+5]>1){const ht=this.clusterProps[re[K+6]];return se?Object.assign({},ht):ht}const Ie=this.points[re[K+3]].properties,Ce=this.options.map(Ie);return se&&Ce===Ie?Object.assign({},Ce):Ce}}function st(nt,re,K){return{type:"Feature",id:nt[re+3],properties:me(nt,re,K),geometry:{type:"Point",coordinates:[(se=nt[re],360*(se-.5)),Ye(nt[re+1])]}};var se}function me(nt,re,K){const se=nt[re+5],Ie=se>=1e4?`${Math.round(se/1e3)}k`:se>=1e3?Math.round(se/100)/10+"k":se,Ce=nt[re+6],ht=Ce===-1?{}:Object.assign({},K[Ce]);return Object.assign(ht,{cluster:!0,cluster_id:nt[re+3],point_count:se,point_count_abbreviated:Ie})}function xe(nt){return nt/360+.5}function Xe(nt){const re=Math.sin(nt*Math.PI/180),K=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return K<0?0:K>1?1:K}function Ye(nt){const re=(180-360*nt)*Math.PI/180;return 360*Math.atan(Math.exp(re))/Math.PI-90}function At(nt,re,K,se){let Ie=se;const Ce=re+(K-re>>1);let ht,at=K-re;const Be=nt[re],ot=nt[re+1],Rt=nt[K],te=nt[K+1];for(let I=re+3;I<K;I+=3){const D=Dt(nt[I],nt[I+1],Be,ot,Rt,te);if(D>Ie)ht=I,Ie=D;else if(D===Ie){const fe=Math.abs(I-Ce);fe<at&&(ht=I,at=fe)}}Ie>se&&(ht-re>3&&At(nt,re,ht,se),nt[ht+2]=Ie,K-ht>3&&At(nt,ht,K,se))}function Dt(nt,re,K,se,Ie,Ce){let ht=Ie-K,at=Ce-se;if(ht!==0||at!==0){const Be=((nt-K)*ht+(re-se)*at)/(ht*ht+at*at);Be>1?(K=Ie,se=Ce):Be>0&&(K+=ht*Be,se+=at*Be)}return ht=nt-K,at=re-se,ht*ht+at*at}function kt(nt,re,K,se){const Ie={id:nt??null,type:re,geometry:K,tags:se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(re==="Point"||re==="MultiPoint"||re==="LineString")yt(Ie,K);else if(re==="Polygon")yt(Ie,K[0]);else if(re==="MultiLineString")for(const Ce of K)yt(Ie,Ce);else if(re==="MultiPolygon")for(const Ce of K)yt(Ie,Ce[0]);return Ie}function yt(nt,re){for(let K=0;K<re.length;K+=3)nt.minX=Math.min(nt.minX,re[K]),nt.minY=Math.min(nt.minY,re[K+1]),nt.maxX=Math.max(nt.maxX,re[K]),nt.maxY=Math.max(nt.maxY,re[K+1])}function vt(nt,re,K,se){if(!re.geometry)return;const Ie=re.geometry.coordinates;if(Ie&&Ie.length===0)return;const Ce=re.geometry.type,ht=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2);let at=[],Be=re.id;if(K.promoteId?Be=re.properties[K.promoteId]:K.generateId&&(Be=se||0),Ce==="Point")sr(Ie,at);else if(Ce==="MultiPoint")for(const ot of Ie)sr(ot,at);else if(Ce==="LineString")Zt(Ie,at,ht,!1);else if(Ce==="MultiLineString"){if(K.lineMetrics){for(const ot of Ie)at=[],Zt(ot,at,ht,!1),nt.push(kt(Be,"LineString",at,re.properties));return}he(Ie,at,ht,!1)}else if(Ce==="Polygon")he(Ie,at,ht,!0);else{if(Ce!=="MultiPolygon"){if(Ce==="GeometryCollection"){for(const ot of re.geometry.geometries)vt(nt,{id:Be,geometry:ot,properties:re.properties},K,se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ot of Ie){const Rt=[];he(ot,Rt,ht,!0),at.push(Rt)}}nt.push(kt(Be,Ce,at,re.properties))}function sr(nt,re){re.push(Fe(nt[0]),$e(nt[1]),0)}function Zt(nt,re,K,se){let Ie,Ce,ht=0;for(let Be=0;Be<nt.length;Be++){const ot=Fe(nt[Be][0]),Rt=$e(nt[Be][1]);re.push(ot,Rt,0),Be>0&&(ht+=se?(Ie*Rt-ot*Ce)/2:Math.sqrt(Math.pow(ot-Ie,2)+Math.pow(Rt-Ce,2))),Ie=ot,Ce=Rt}const at=re.length-3;re[2]=1,At(re,0,at,K),re[at+2]=1,re.size=Math.abs(ht),re.start=0,re.end=re.size}function he(nt,re,K,se){for(let Ie=0;Ie<nt.length;Ie++){const Ce=[];Zt(nt[Ie],Ce,K,se),re.push(Ce)}}function Fe(nt){return nt/360+.5}function $e(nt){const re=Math.sin(nt*Math.PI/180),K=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return K<0?0:K>1?1:K}function tt(nt,re,K,se,Ie,Ce,ht,at){if(se/=re,Ce>=(K/=re)&&ht<se)return nt;if(ht<K||Ce>=se)return null;const Be=[];for(const ot of nt){const Rt=ot.geometry;let te=ot.type;const I=Ie===0?ot.minX:ot.minY,D=Ie===0?ot.maxX:ot.maxY;if(I>=K&&D<se){Be.push(ot);continue}if(D<K||I>=se)continue;let fe=[];if(te==="Point"||te==="MultiPoint")ct(Rt,fe,K,se,Ie);else if(te==="LineString")ut(Rt,fe,K,se,Ie,!1,at.lineMetrics);else if(te==="MultiLineString")wt(Rt,fe,K,se,Ie,!1);else if(te==="Polygon")wt(Rt,fe,K,se,Ie,!0);else if(te==="MultiPolygon")for(const Ee of Rt){const qe=[];wt(Ee,qe,K,se,Ie,!0),qe.length&&fe.push(qe)}if(fe.length){if(at.lineMetrics&&te==="LineString"){for(const Ee of fe)Be.push(kt(ot.id,te,Ee,ot.tags));continue}te!=="LineString"&&te!=="MultiLineString"||(fe.length===1?(te="LineString",fe=fe[0]):te="MultiLineString"),te!=="Point"&&te!=="MultiPoint"||(te=fe.length===3?"Point":"MultiPoint"),Be.push(kt(ot.id,te,fe,ot.tags))}}return Be.length?Be:null}function ct(nt,re,K,se,Ie){for(let Ce=0;Ce<nt.length;Ce+=3){const ht=nt[Ce+Ie];ht>=K&&ht<=se&&Bt(re,nt[Ce],nt[Ce+1],nt[Ce+2])}}function ut(nt,re,K,se,Ie,Ce,ht){let at=pt(nt);const Be=Ie===0?er:ur;let ot,Rt,te=nt.start;for(let qe=0;qe<nt.length-3;qe+=3){const ae=nt[qe],ft=nt[qe+1],Nt=nt[qe+2],gt=nt[qe+3],Lt=nt[qe+4],Ht=Ie===0?ae:ft,Mt=Ie===0?gt:Lt;let rr=!1;ht&&(ot=Math.sqrt(Math.pow(ae-gt,2)+Math.pow(ft-Lt,2))),Ht<K?Mt>K&&(Rt=Be(at,ae,ft,gt,Lt,K),ht&&(at.start=te+ot*Rt)):Ht>se?Mt<se&&(Rt=Be(at,ae,ft,gt,Lt,se),ht&&(at.start=te+ot*Rt)):Bt(at,ae,ft,Nt),Mt<K&&Ht>=K&&(Rt=Be(at,ae,ft,gt,Lt,K),rr=!0),Mt>se&&Ht<=se&&(Rt=Be(at,ae,ft,gt,Lt,se),rr=!0),!Ce&&rr&&(ht&&(at.end=te+ot*Rt),re.push(at),at=pt(nt)),ht&&(te+=ot)}let I=nt.length-3;const D=nt[I],fe=nt[I+1],Ee=Ie===0?D:fe;Ee>=K&&Ee<=se&&Bt(at,D,fe,nt[I+2]),I=at.length-3,Ce&&I>=3&&(at[I]!==at[0]||at[I+1]!==at[1])&&Bt(at,at[0],at[1],at[2]),at.length&&re.push(at)}function pt(nt){const re=[];return re.size=nt.size,re.start=nt.start,re.end=nt.end,re}function wt(nt,re,K,se,Ie,Ce){for(const ht of nt)ut(ht,re,K,se,Ie,Ce,!1)}function Bt(nt,re,K,se){nt.push(re,K,se)}function er(nt,re,K,se,Ie,Ce){const ht=(Ce-re)/(se-re);return Bt(nt,Ce,K+(Ie-K)*ht,1),ht}function ur(nt,re,K,se,Ie,Ce){const ht=(Ce-K)/(Ie-K);return Bt(nt,re+(se-re)*ht,Ce,1),ht}function fr(nt,re){const K=[];for(let se=0;se<nt.length;se++){const Ie=nt[se],Ce=Ie.type;let ht;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")ht=Ft(Ie.geometry,re);else if(Ce==="MultiLineString"||Ce==="Polygon"){ht=[];for(const at of Ie.geometry)ht.push(Ft(at,re))}else if(Ce==="MultiPolygon"){ht=[];for(const at of Ie.geometry){const Be=[];for(const ot of at)Be.push(Ft(ot,re));ht.push(Be)}}K.push(kt(Ie.id,Ce,ht,Ie.tags))}return K}function Ft(nt,re){const K=[];K.size=nt.size,nt.start!==void 0&&(K.start=nt.start,K.end=nt.end);for(let se=0;se<nt.length;se+=3)K.push(nt[se]+re,nt[se+1],nt[se+2]);return K}function Ue(nt,re){if(nt.transformed)return nt;const K=1<<nt.z,se=nt.x,Ie=nt.y;for(const Ce of nt.features){const ht=Ce.geometry,at=Ce.type;if(Ce.geometry=[],at===1)for(let Be=0;Be<ht.length;Be+=2)Ce.geometry.push(Yr(ht[Be],ht[Be+1],re,K,se,Ie));else for(let Be=0;Be<ht.length;Be++){const ot=[];for(let Rt=0;Rt<ht[Be].length;Rt+=2)ot.push(Yr(ht[Be][Rt],ht[Be][Rt+1],re,K,se,Ie));Ce.geometry.push(ot)}}return nt.transformed=!0,nt}function Yr(nt,re,K,se,Ie,Ce){return[Math.round(K*(nt*se-Ie)),Math.round(K*(re*se-Ce))]}function wr(nt,re,K,se,Ie){const Ce=re===Ie.maxZoom?0:Ie.tolerance/((1<<re)*Ie.extent),ht={features:[],numPoints:0,numSimplified:0,numFeatures:nt.length,source:null,x:K,y:se,z:re,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const at of nt)Tr(ht,at,Ce,Ie);return ht}function Tr(nt,re,K,se){const Ie=re.geometry,Ce=re.type,ht=[];if(nt.minX=Math.min(nt.minX,re.minX),nt.minY=Math.min(nt.minY,re.minY),nt.maxX=Math.max(nt.maxX,re.maxX),nt.maxY=Math.max(nt.maxY,re.maxY),Ce==="Point"||Ce==="MultiPoint")for(let at=0;at<Ie.length;at+=3)ht.push(Ie[at],Ie[at+1]),nt.numPoints++,nt.numSimplified++;else if(Ce==="LineString")ir(ht,Ie,nt,K,!1,!1);else if(Ce==="MultiLineString"||Ce==="Polygon")for(let at=0;at<Ie.length;at++)ir(ht,Ie[at],nt,K,Ce==="Polygon",at===0);else if(Ce==="MultiPolygon")for(let at=0;at<Ie.length;at++){const Be=Ie[at];for(let ot=0;ot<Be.length;ot++)ir(ht,Be[ot],nt,K,!0,ot===0)}if(ht.length){let at=re.tags||null;if(Ce==="LineString"&&se.lineMetrics){at={};for(const ot in re.tags)at[ot]=re.tags[ot];at.mapbox_clip_start=Ie.start/Ie.size,at.mapbox_clip_end=Ie.end/Ie.size}const Be={geometry:ht,type:Ce==="Polygon"||Ce==="MultiPolygon"?3:Ce==="LineString"||Ce==="MultiLineString"?2:1,tags:at};re.id!==null&&(Be.id=re.id),nt.features.push(Be)}}function ir(nt,re,K,se,Ie,Ce){const ht=se*se;if(se>0&&re.size<(Ie?ht:se))return void(K.numPoints+=re.length/3);const at=[];for(let Be=0;Be<re.length;Be+=3)(se===0||re[Be+2]>ht)&&(K.numSimplified++,at.push(re[Be],re[Be+1])),K.numPoints++;Ie&&function(Be,ot){let Rt=0;for(let te=0,I=Be.length,D=I-2;te<I;D=te,te+=2)Rt+=(Be[te]-Be[D])*(Be[te+1]+Be[D+1]);if(Rt>0===ot)for(let te=0,I=Be.length;te<I/2;te+=2){const D=Be[te],fe=Be[te+1];Be[te]=Be[I-2-te],Be[te+1]=Be[I-1-te],Be[I-2-te]=D,Be[I-1-te]=fe}}(at,Ce),nt.push(at)}const Ar={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class mr{constructor(re,K){const se=(K=this.options=function(Ce,ht){for(const at in ht)Ce[at]=ht[at];return Ce}(Object.create(Ar),K)).debug;if(se&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ie=function(Ce,ht){const at=[];if(Ce.type==="FeatureCollection")for(let Be=0;Be<Ce.features.length;Be++)vt(at,Ce.features[Be],ht,Be);else vt(at,Ce.type==="Feature"?Ce:{geometry:Ce},ht);return at}(re,K);this.tiles={},this.tileCoords=[],se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ie=function(Ce,ht){const at=ht.buffer/ht.extent;let Be=Ce;const ot=tt(Ce,1,-1-at,at,0,-1,2,ht),Rt=tt(Ce,1,1-at,2+at,0,-1,2,ht);return(ot||Rt)&&(Be=tt(Ce,1,-at,1+at,0,-1,2,ht)||[],ot&&(Be=fr(ot,1).concat(Be)),Rt&&(Be=Be.concat(fr(Rt,-1)))),Be}(Ie,K),Ie.length&&this.splitTile(Ie,0,0,0),se&&(Ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(re,K,se,Ie,Ce,ht,at){const Be=[re,K,se,Ie],ot=this.options,Rt=ot.debug;for(;Be.length;){Ie=Be.pop(),se=Be.pop(),K=Be.pop(),re=Be.pop();const te=1<<K,I=Vr(K,se,Ie);let D=this.tiles[I];if(!D&&(Rt>1&&console.time("creation"),D=this.tiles[I]=wr(re,K,se,Ie,ot),this.tileCoords.push({z:K,x:se,y:Ie}),Rt)){Rt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,se,Ie,D.numFeatures,D.numPoints,D.numSimplified),console.timeEnd("creation"));const rr=`z${K}`;this.stats[rr]=(this.stats[rr]||0)+1,this.total++}if(D.source=re,Ce==null){if(K===ot.indexMaxZoom||D.numPoints<=ot.indexMaxPoints)continue}else{if(K===ot.maxZoom||K===Ce)continue;if(Ce!=null){const rr=Ce-K;if(se!==ht>>rr||Ie!==at>>rr)continue}}if(D.source=null,re.length===0)continue;Rt>1&&console.time("clipping");const fe=.5*ot.buffer/ot.extent,Ee=.5-fe,qe=.5+fe,ae=1+fe;let ft=null,Nt=null,gt=null,Lt=null,Ht=tt(re,te,se-fe,se+qe,0,D.minX,D.maxX,ot),Mt=tt(re,te,se+Ee,se+ae,0,D.minX,D.maxX,ot);re=null,Ht&&(ft=tt(Ht,te,Ie-fe,Ie+qe,1,D.minY,D.maxY,ot),Nt=tt(Ht,te,Ie+Ee,Ie+ae,1,D.minY,D.maxY,ot),Ht=null),Mt&&(gt=tt(Mt,te,Ie-fe,Ie+qe,1,D.minY,D.maxY,ot),Lt=tt(Mt,te,Ie+Ee,Ie+ae,1,D.minY,D.maxY,ot),Mt=null),Rt>1&&console.timeEnd("clipping"),Be.push(ft||[],K+1,2*se,2*Ie),Be.push(Nt||[],K+1,2*se,2*Ie+1),Be.push(gt||[],K+1,2*se+1,2*Ie),Be.push(Lt||[],K+1,2*se+1,2*Ie+1)}}getTile(re,K,se){re=+re,K=+K,se=+se;const Ie=this.options,{extent:Ce,debug:ht}=Ie;if(re<0||re>24)return null;const at=1<<re,Be=Vr(re,K=K+at&at-1,se);if(this.tiles[Be])return Ue(this.tiles[Be],Ce);ht>1&&console.log("drilling down to z%d-%d-%d",re,K,se);let ot,Rt=re,te=K,I=se;for(;!ot&&Rt>0;)Rt--,te>>=1,I>>=1,ot=this.tiles[Vr(Rt,te,I)];return ot&&ot.source?(ht>1&&(console.log("found parent tile z%d-%d-%d",Rt,te,I),console.time("drilling down")),this.splitTile(ot.source,Rt,te,I,re,K,se),ht>1&&console.timeEnd("drilling down"),this.tiles[Be]?Ue(this.tiles[Be],Ce):null):null}}function Vr(nt,re,K){return 32*((1<<nt)*K+re)+nt}class Lr extends Q{constructor(re,K,se,Ie=ai){super(re,K,se),this._dataUpdateable=new Map,this._createGeoJSONIndex=Ie}loadVectorTile(re,K){return b._(this,void 0,void 0,function*(){const se=re.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Ie=this._geoJSONIndex.getTile(se.z,se.x,se.y);return Ie?Pe(new b.d3(Ie.features,{version:2,extent:b.a5})):null})}loadData(re){return b._(this,void 0,void 0,function*(){var K;(K=this._pendingRequest)===null||K===void 0||K.abort();const se=this._startPerformance(re);this._pendingRequest=new AbortController;try{(!this._pendingData||re.request||re.data||re.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(re,this._pendingRequest));const Ie=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(Ie,re),this.loaded={};const Ce={};return this._finishPerformance(se,re,Ce),Ce}catch(Ie){if(delete this._pendingRequest,b.Z(Ie))return{abandoned:!0};throw Ie}})}_startPerformance(re){var K;if(!((K=re?.request)===null||K===void 0)&&K.collectResourceTiming)return new b.c$(re.request)}_finishPerformance(re,K,se){if(!re)return;const Ie=re.finish();Ie&&(se.resourceTiming={},se.resourceTiming[K.source]=JSON.parse(JSON.stringify(Ie)))}getData(){return b._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(re){const K=this.loaded;return K&&K[re.uid]?super.reloadTile(re):this.loadTile(re)}loadAndProcessGeoJSON(re,K){return b._(this,void 0,void 0,function*(){let se;if(re.request?se=yield this.loadGeoJSONFromUrl(re.request,re.promoteId,K):re.data?se=this._loadGeoJSONFromObject(re.data,re.promoteId):re.dataDiff&&(se=this._loadGeoJSONFromDiff(re.dataDiff,re.promoteId,re.source)),delete this._pendingRequest,typeof se!="object")throw new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`);return Ge(se,!0),re.filter&&(se=this._filterGeoJSON(se,re.filter)),se})}loadGeoJSONFromUrl(re,K,se){return b._(this,void 0,void 0,function*(){const Ie=yield b.j(re,se);return this._dataUpdateable=b.a7(Ie.data,K)?b.a8(Ie.data,K):void 0,Ie.data})}_loadGeoJSONFromObject(re,K){return this._dataUpdateable=b.a7(re,K)?b.a8(re,K):void 0,re}_loadGeoJSONFromDiff(re,K,se){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${se}`);b.a9(this._dataUpdateable,re,K);const Ie=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(Ie)}_filterGeoJSON(re,K){const se=b.d4(K,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(se.result==="error")throw new Error(se.value.map(Ce=>`${Ce.key}: ${Ce.message}`).join(", "));const Ie=re.features.filter(Ce=>se.value.evaluate({zoom:0},Ce));return this._toFeatureCollection(Ie)}_toFeatureCollection(re){return{type:"FeatureCollection",features:re}}removeSource(re){return b._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(re){return this._geoJSONIndex.getClusterExpansionZoom(re.clusterId)}getClusterChildren(re){return this._geoJSONIndex.getChildren(re.clusterId)}getClusterLeaves(re){return this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset)}}function ai(nt,re){return re.cluster?new Te(function({superclusterOptions:K,clusterProperties:se}){if(!se||!K)return K;const Ie={},Ce={},ht={accumulated:null,zoom:0},at={properties:null},Be=Object.keys(se);for(const ot of Be){const[Rt,te]=se[ot],I=b.d4(te),D=b.d4(typeof Rt=="string"?[Rt,["accumulated"],["get",ot]]:Rt);Ie[ot]=I.value,Ce[ot]=D.value}return K.map=ot=>{at.properties=ot;const Rt={};for(const te of Be)Rt[te]=Ie[te].evaluate(ht,at);return Rt},K.reduce=(ot,Rt)=>{at.properties=Rt;for(const te of Be)ht.accumulated=ot[te],ot[te]=Ce[te].evaluate(ht,at)},K}(re)).load(nt.features):function(K,se){return new mr(K,se)}(nt,re.geojsonVtOptions)}class Rr{constructor(re){this.self=re,this.actor=new b.L(re),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(K,se)=>{if(this.externalWorkerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.externalWorkerSourceTypes[K]=se},this.self.addProtocol=b.cK,this.self.removeProtocol=b.cL,this.self.registerRTLTextPlugin=K=>{b.d5.setMethods(K)},this.actor.registerMessageHandler("LDT",(K,se)=>this._getDEMWorkerSource(K,se.source).loadTile(se)),this.actor.registerMessageHandler("RDT",(K,se)=>b._(this,void 0,void 0,function*(){this._getDEMWorkerSource(K,se.source).removeTile(se)})),this.actor.registerMessageHandler("GCEZ",(K,se)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource(K,se.type,se.source).getClusterExpansionZoom(se)})),this.actor.registerMessageHandler("GCC",(K,se)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource(K,se.type,se.source).getClusterChildren(se)})),this.actor.registerMessageHandler("GCL",(K,se)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource(K,se.type,se.source).getClusterLeaves(se)})),this.actor.registerMessageHandler("LD",(K,se)=>this._getWorkerSource(K,se.type,se.source).loadData(se)),this.actor.registerMessageHandler("GD",(K,se)=>this._getWorkerSource(K,se.type,se.source).getData()),this.actor.registerMessageHandler("LT",(K,se)=>this._getWorkerSource(K,se.type,se.source).loadTile(se)),this.actor.registerMessageHandler("RT",(K,se)=>this._getWorkerSource(K,se.type,se.source).reloadTile(se)),this.actor.registerMessageHandler("AT",(K,se)=>this._getWorkerSource(K,se.type,se.source).abortTile(se)),this.actor.registerMessageHandler("RMT",(K,se)=>this._getWorkerSource(K,se.type,se.source).removeTile(se)),this.actor.registerMessageHandler("RS",(K,se)=>b._(this,void 0,void 0,function*(){if(!this.workerSources[K]||!this.workerSources[K][se.type]||!this.workerSources[K][se.type][se.source])return;const Ie=this.workerSources[K][se.type][se.source];delete this.workerSources[K][se.type][se.source],Ie.removeSource!==void 0&&Ie.removeSource(se)})),this.actor.registerMessageHandler("RM",K=>b._(this,void 0,void 0,function*(){delete this.layerIndexes[K],delete this.availableImages[K],delete this.workerSources[K],delete this.demWorkerSources[K],this.globalStates.delete(K)})),this.actor.registerMessageHandler("SR",(K,se)=>b._(this,void 0,void 0,function*(){this.referrer=se})),this.actor.registerMessageHandler("SRPS",(K,se)=>this._syncRTLPluginState(K,se)),this.actor.registerMessageHandler("IS",(K,se)=>b._(this,void 0,void 0,function*(){this.self.importScripts(se)})),this.actor.registerMessageHandler("SI",(K,se)=>this._setImages(K,se)),this.actor.registerMessageHandler("UL",(K,se)=>b._(this,void 0,void 0,function*(){this._getLayerIndex(K).update(se.layers,se.removedIds,this._getGlobalState(K))})),this.actor.registerMessageHandler("UGS",(K,se)=>b._(this,void 0,void 0,function*(){const Ie=this._getGlobalState(K);for(const Ce in se)Ie[Ce]=se[Ce]})),this.actor.registerMessageHandler("SL",(K,se)=>b._(this,void 0,void 0,function*(){this._getLayerIndex(K).replace(se,this._getGlobalState(K))}))}_getGlobalState(re){let K=this.globalStates.get(re);return K||(K={},this.globalStates.set(re,K)),K}_setImages(re,K){return b._(this,void 0,void 0,function*(){this.availableImages[re]=K;for(const se in this.workerSources[re]){const Ie=this.workerSources[re][se];for(const Ce in Ie)Ie[Ce].availableImages=K}})}_syncRTLPluginState(re,K){return b._(this,void 0,void 0,function*(){return yield b.d5.syncState(K,this.self.importScripts)})}_getAvailableImages(re){let K=this.availableImages[re];return K||(K=[]),K}_getLayerIndex(re){let K=this.layerIndexes[re];return K||(K=this.layerIndexes[re]=new a),K}_getWorkerSource(re,K,se){if(this.workerSources[re]||(this.workerSources[re]={}),this.workerSources[re][K]||(this.workerSources[re][K]={}),!this.workerSources[re][K][se]){const Ie={sendAsync:(Ce,ht)=>(Ce.targetMapId=re,this.actor.sendAsync(Ce,ht))};switch(K){case"vector":this.workerSources[re][K][se]=new Q(Ie,this._getLayerIndex(re),this._getAvailableImages(re));break;case"geojson":this.workerSources[re][K][se]=new Lr(Ie,this._getLayerIndex(re),this._getAvailableImages(re));break;default:this.workerSources[re][K][se]=new this.externalWorkerSourceTypes[K](Ie,this._getLayerIndex(re),this._getAvailableImages(re))}}return this.workerSources[re][K][se]}_getDEMWorkerSource(re,K){return this.demWorkerSources[re]||(this.demWorkerSources[re]={}),this.demWorkerSources[re][K]||(this.demWorkerSources[re][K]=new ge),this.demWorkerSources[re][K]}}return b.i(self)&&(self.worker=new Rr(self)),Rr}),v("index",["exports","./shared"],function(b,a){var C="5.14.0";function F(){var g=new a.A(4);return a.A!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g}let O,Y,ee;const j={frame(g,t,n){const l=requestAnimationFrame(_=>{h(),t(_)}),{unsubscribe:h}=a.s(g.signal,"abort",()=>{h(),cancelAnimationFrame(l),n(new a.a(g.signal.reason))},!1)},frameAsync(g){return new Promise((t,n)=>{this.frame(g,t,n)})},getImageData(g,t=0){return this.getImageCanvasContext(g).getImageData(-t,-t,g.width+2*t,g.height+2*t)},getImageCanvasContext(g){const t=window.document.createElement("canvas"),n=t.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return t.width=g.width,t.height=g.height,n.drawImage(g,0,0,g.width,g.height),n},resolveURL:g=>(O||(O=document.createElement("a")),O.href=g,O.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return ee!==void 0?ee:!!matchMedia&&(Y==null&&(Y=matchMedia("(prefers-reduced-motion: reduce)")),Y.matches)},set prefersReducedMotion(g){ee=g}},Pe=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(g){this._frozenAt=g}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function ce(){return Pe.getCurrentTime()}class Q{static testProp(t){if(!Q.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in Q.docStyle)return t[n];return t[0]}static create(t,n,l){const h=window.document.createElement(t);return n!==void 0&&(h.className=n),l&&l.appendChild(h),h}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){Q.docStyle&&Q.selectProp&&(Q.userSelect=Q.docStyle[Q.selectProp],Q.docStyle[Q.selectProp]="none")}static enableDrag(){Q.docStyle&&Q.selectProp&&(Q.docStyle[Q.selectProp]=Q.userSelect)}static setTransform(t,n){t.style[Q.transformProp]=n}static addEventListener(t,n,l,h={}){t.addEventListener(n,l,"passive"in h?h:h.capture)}static removeEventListener(t,n,l,h={}){t.removeEventListener(n,l,"passive"in h?h:h.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",Q.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Q.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Q.suppressClickInternal,!0)},0)}static getScale(t){const n=t.getBoundingClientRect();return{x:n.width/t.offsetWidth||1,y:n.height/t.offsetHeight||1,boundingClientRect:n}}static getPoint(t,n,l){const h=n.boundingClientRect;return new a.P((l.clientX-h.left)/n.x-t.clientLeft,(l.clientY-h.top)/n.y-t.clientTop)}static mousePos(t,n){const l=Q.getScale(t);return Q.getPoint(t,l,n)}static touchPos(t,n){const l=[],h=Q.getScale(t);for(let _=0;_<n.length;_++)l.push(Q.getPoint(t,h,n[_]));return l}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const n=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),l=n.querySelectorAll("script");for(const h of l)h.remove();return Q.clean(n),n.innerHTML}static isPossiblyDangerous(t,n){const l=n.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!l.includes("javascript:")&&!l.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const n=t.children;for(const l of n)Q.removeAttributes(l),Q.clean(l)}static removeAttributes(t){for(const{name:n,value:l}of t.attributes)Q.isPossiblyDangerous(n,l)&&t.removeAttribute(n)}}Q.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Q.selectProp=Q.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Q.transformProp=Q.testProp(["transform","WebkitTransform"]);const ge={supported:!1,testSupport:function(g){!Me&&Oe&&(Ge?Ze(g):Qe=g)}};let Qe,Oe,Me=!1,Ge=!1;function Ze(g){const t=g.createTexture();g.bindTexture(g.TEXTURE_2D,t);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,Oe),g.isContextLost())return;ge.supported=!0}catch{}g.deleteTexture(t),Me=!0}var it;typeof document<"u"&&(Oe=document.createElement("img"),Oe.onload=()=>{Qe&&Ze(Qe),Qe=null,Ge=!0},Oe.onerror=()=>{Me=!0,Qe=null},Oe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(g){let t,n,l,h;g.resetRequestQueue=()=>{t=[],n=0,l=0,h={}},g.addThrottleControl=M=>{const R=l++;return h[R]=M,R},g.removeThrottleControl=M=>{delete h[M],w()},g.getImage=(M,R,B=!0)=>new Promise(($,G)=>{ge.supported&&(M.headers||(M.headers={}),M.headers.accept="image/webp,*/*"),a.e(M,{type:"image"}),t.push({abortController:R,requestParameters:M,supportImageRefresh:B,state:"queued",onError:X=>{G(X)},onSuccess:X=>{$(X)}}),w()});const _=M=>a._(this,void 0,void 0,function*(){M.state="running";const{requestParameters:R,supportImageRefresh:B,onError:$,onSuccess:G,abortController:X}=M,oe=B===!1&&!a.i(self)&&!a.g(R.url)&&(!R.headers||Object.keys(R.headers).reduce((be,Ae)=>be&&Ae==="accept",!0));n++;const ve=oe?P(R,X):a.m(R,X);try{const be=yield ve;delete M.abortController,M.state="completed",be.data instanceof HTMLImageElement||a.b(be.data)?G(be):be.data&&G({data:yield(Se=be.data,typeof createImageBitmap=="function"?a.f(Se):a.h(Se)),cacheControl:be.cacheControl,expires:be.expires})}catch(be){delete M.abortController,$(be)}finally{n--,w()}var Se}),w=()=>{const M=(()=>{for(const R of Object.keys(h))if(h[R]())return!0;return!1})()?a.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let R=n;R<M&&t.length>0;R++){const B=t.shift();B.abortController.signal.aborted?R--:_(B)}},P=(M,R)=>new Promise((B,$)=>{const G=new Image,X=M.url,oe=M.credentials;oe&&oe==="include"?G.crossOrigin="use-credentials":(oe&&oe==="same-origin"||!a.d(X))&&(G.crossOrigin="anonymous"),R.signal.addEventListener("abort",()=>{G.src="",$(new a.a(R.signal.reason))}),G.fetchPriority="high",G.onload=()=>{G.onerror=G.onload=null,B({data:G})},G.onerror=()=>{G.onerror=G.onload=null,R.signal.aborted||$(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},G.src=X})}(it||(it={})),it.resetRequestQueue();class He{constructor(t){this._transformRequestFn=t??null}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Te(g){const t=[];if(typeof g=="string")t.push({id:"default",url:g});else if(g&&g.length>0){const n=[];for(const{id:l,url:h}of g){const _=`${l}${h}`;n.indexOf(_)===-1&&(n.push(_),t.push({id:l,url:h}))}}return t}function st(g,t,n){try{const l=new URL(g);return l.pathname+=`${t}${n}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${g}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function me(g){const{userImage:t}=g;return!!(t&&t.render&&t.render())&&(g.data.replace(new Uint8Array(t.data.buffer)),!0)}class xe extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,promiseResolve:l}of this.requestors)l(this._getImagesForIds(n));this.requestors=[]}}getImage(t){const n=this.images[t];if(n&&!n.data&&n.spriteData){const l=n.spriteData;n.data=new a.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),n.spriteData=null}return n}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let l=!0;const h=n.data||n.spriteData;return this._validateStretch(n.stretchX,h&&h.width)||(this.fire(new a.k(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(n.stretchY,h&&h.height)||(this.fire(new a.k(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(n.content,n)||(this.fire(new a.k(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,n){if(!t)return!0;let l=0;for(const h of t){if(h[0]<l||h[1]<h[0]||n<h[1])return!1;l=h[1]}return!0}_validateContent(t,n){if(!t)return!0;if(t.length!==4)return!1;const l=n.spriteData,h=l&&l.width||n.data.width,_=l&&l.height||n.data.height;return!(t[0]<0||h<t[0]||t[1]<0||_<t[1]||t[2]<0||h<t[2]||t[3]<0||_<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,n,l=!0){const h=this.getImage(t);if(l&&(h.data.width!==n.data.width||h.data.height!==n.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=h.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((n,l)=>{let h=!0;if(!this.isLoaded())for(const _ of t)this.images[_]||(h=!1);this.isLoaded()||h?n(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:n})})}_getImagesForIds(t){const n={};for(const l of t){let h=this.getImage(l);h||(this.fire(new a.l("styleimagemissing",{id:l})),h=this.getImage(l)),h?n[l]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,textFitWidth:h.textFitWidth,textFitHeight:h.textFitHeight,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:a.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],l=this.getImage(t);if(!l)return null;if(n&&n.position.version===l.version)return n.position;if(n)n.position.version=l.version;else{const h={w:l.data.width+2,h:l.data.height+2,x:0,y:0},_=new a.I(h,l);this.patterns[t]={bin:h,position:_}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.T(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const _ in this.patterns)t.push(this.patterns[_].bin);const{w:n,h:l}=a.p(t),h=this.atlasImage;h.resize({width:n||1,height:l||1});for(const _ in this.patterns){const{bin:w}=this.patterns[_],P=w.x+1,M=w.y+1,R=this.getImage(_).data,B=R.width,$=R.height;a.R.copy(R,h,{x:0,y:0},{x:P,y:M},{width:B,height:$}),a.R.copy(R,h,{x:0,y:$-1},{x:P,y:M-1},{width:B,height:1}),a.R.copy(R,h,{x:0,y:0},{x:P,y:M+$},{width:B,height:1}),a.R.copy(R,h,{x:B-1,y:0},{x:P-1,y:M},{width:1,height:$}),a.R.copy(R,h,{x:0,y:0},{x:P+B,y:M},{width:1,height:$})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const l=this.getImage(n);l||a.w(`Image with ID: "${n}" was not found`),me(l)&&this.updateImage(n,l)}}cloneImages(){const t={};for(const n in this.images){const l=this.images[n];t[n]=Object.assign(Object.assign({},l),{data:l.data?l.data.clone():null})}return t}}const Xe=1e20;function Ye(g,t,n,l,h,_,w,P,M){for(let R=t;R<t+l;R++)At(g,n*_+R,_,h,w,P,M);for(let R=n;R<n+h;R++)At(g,R*_+t,1,l,w,P,M)}function At(g,t,n,l,h,_,w){_[0]=0,w[0]=-Xe,w[1]=Xe,h[0]=g[t];for(let P=1,M=0,R=0;P<l;P++){h[P]=g[t+P*n];const B=P*P;do{const $=_[M];R=(h[P]-h[$]+B-$*$)/(P-$)/2}while(R<=w[M]&&--M>-1);M++,_[M]=P,w[M]=R,w[M+1]=Xe}for(let P=0,M=0;P<l;P++){for(;w[M+1]<P;)M++;const R=_[M],B=P-R;g[t+P*n]=h[R]+B*B}}const Dt=a.v.layout_symbol["text-font"].default.join(",");class kt{constructor(t,n,l){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={},this.lang=l}setURL(t){this.url=t}getGlyphs(t){return a._(this,void 0,void 0,function*(){const n=[];for(const _ in t)for(const w of t[_])n.push(this._getAndCacheGlyphsPromise(_,w));const l=yield Promise.all(n),h={};for(const{stack:_,id:w,glyph:P}of l)h[_]||(h[_]={}),h[_][w]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics};return h})}_getAndCacheGlyphsPromise(t,n){return a._(this,void 0,void 0,function*(){let l=this.entries[t];l||(l=this.entries[t]={glyphs:{},requests:{},ranges:{}});let h=l.glyphs[n];return h!==void 0?{stack:t,id:n,glyph:h}:!this.url||this._charUsesLocalIdeographFontFamily(n)?(h=l.glyphs[n]=this._drawGlyph(l,t,n),{stack:t,id:n,glyph:h}):yield this._downloadAndCacheRangePromise(t,n)})}_downloadAndCacheRangePromise(t,n){return a._(this,void 0,void 0,function*(){const l=this.entries[t],h=Math.floor(n/256);if(l.ranges[h])return{stack:t,id:n,glyph:null};if(!l.requests[h]){const _=kt.loadGlyphRange(t,h,this.url,this.requestManager);l.requests[h]=_}try{const _=yield l.requests[h];for(const w in _)l.glyphs[+w]=_[+w];return l.ranges[h]=!0,{stack:t,id:n,glyph:_[n]||null}}catch(_){const w=l.glyphs[n]=this._drawGlyph(l,t,n);return this._warnOnMissingGlyphRange(w,h,n,_),{stack:t,id:n,glyph:w}}})}_warnOnMissingGlyphRange(t,n,l,h){const _=256*n,w=_+255,P=l.toString(16).padStart(4,"0").toUpperCase();a.w(`Unable to load glyph range ${n}, ${_}-${w}. Rendering codepoint U+${P} locally instead. ${h}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&a.q(t)}_drawGlyph(t,n,l){const h=n===Dt&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(l),_=h?"ideographTinySDF":"tinySDF";t[_]||(t[_]=this._createTinySDF(h?this.localIdeographFontFamily:n));const w=t[_].draw(String.fromCodePoint(l));return{id:l,bitmap:new a.r({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const n=t?t.split(","):[];n.push("sans-serif");const l=n.map(h=>/[-\w]+/.test(h)?h:`'${CSS.escape(h)}'`).join(",");return new kt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:l,fontWeight:this._fontWeight(n[0]),fontStyle:this._fontStyle(n[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const n={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let l;for(const[h,_]of Object.entries(n))new RegExp(`\\b${h}\\b`,"i").test(t)&&(l=`${_}`);return l}destroy(){for(const t in this.entries){const n=this.entries[t];n.tinySDF&&(n.tinySDF=null),n.ideographTinySDF&&(n.ideographTinySDF=null),n.glyphs={},n.requests={},n.ranges={}}this.entries={}}}kt.loadGlyphRange=function(g,t,n,l){return a._(this,void 0,void 0,function*(){const h=256*t,_=h+255,w=l.transformRequest(n.replace("{fontstack}",g).replace("{range}",`${h}-${_}`),"Glyphs"),P=yield a.n(w,new AbortController);if(!P||!P.data)throw new Error(`Could not load glyph range. range: ${t}, ${h}-${_}`);const M={};for(const R of a.o(P.data))M[R.id]=R;return M})},kt.TinySDF=class{constructor({fontSize:g=24,buffer:t=3,radius:n=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:_="normal",fontStyle:w="normal",lang:P=null}={}){this.buffer=t,this.cutoff=l,this.radius=n,this.lang=P;const M=this.size=g+4*t,R=this._createCanvas(M),B=this.ctx=R.getContext("2d",{willReadFrequently:!0});B.font=`${w} ${_} ${g}px ${h}`,B.textBaseline="alphabetic",B.textAlign="left",B.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(g){const t=document.createElement("canvas");return t.width=t.height=g,t}draw(g){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:_}=this.ctx.measureText(g),w=Math.ceil(n),P=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-h))),M=Math.min(this.size-this.buffer,w+Math.ceil(l)),R=P+2*this.buffer,B=M+2*this.buffer,$=Math.max(R*B,0),G=new Uint8ClampedArray($),X={data:G,width:R,height:B,glyphWidth:P,glyphHeight:M,glyphTop:w,glyphLeft:0,glyphAdvance:t};if(P===0||M===0)return X;const{ctx:oe,buffer:ve,gridInner:Se,gridOuter:be}=this;this.lang&&(oe.lang=this.lang),oe.clearRect(ve,ve,P,M),oe.fillText(g,ve,ve+w);const Ae=oe.getImageData(ve,ve,P,M);be.fill(Xe,0,$),Se.fill(0,0,$);for(let We=0;We<M;We++)for(let Le=0;Le<P;Le++){const Je=Ae.data[4*(We*P+Le)+3]/255;if(Je===0)continue;const et=(We+ve)*R+Le+ve;if(Je===1)be[et]=0,Se[et]=Xe;else{const Ve=.5-Je;be[et]=Ve>0?Ve*Ve:0,Se[et]=Ve<0?Ve*Ve:0}}Ye(be,0,0,R,B,R,this.f,this.v,this.z),Ye(Se,ve,ve,P,M,R,this.f,this.v,this.z);for(let We=0;We<$;We++){const Le=Math.sqrt(be[We])-Math.sqrt(Se[We]);G[We]=Math.round(255-255*(Le/this.radius+this.cutoff))}return X}};class yt{constructor(){this.specification=a.u.light.position}possiblyEvaluate(t,n){return a.F(t.expression.evaluate(n))}interpolate(t,n,l){return{x:a.G.number(t.x,n.x,l),y:a.G.number(t.y,n.y,l),z:a.G.number(t.z,n.z,l)}}}let vt;class sr extends a.E{constructor(t){super(),vt=vt||new a.t({anchor:new a.D(a.u.light.anchor),position:new yt,color:new a.D(a.u.light.color),intensity:new a.D(a.u.light.intensity)}),this._transitionable=new a.x(vt,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(a.y,t,n))for(const l in t){const h=t[l];l.endsWith(a.z)?this._transitionable.setTransition(l.slice(0,-a.z.length),h):this._transitionable.setValue(l,h)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,l){return(!l||l.validate!==!1)&&a.B(this,t.call(a.C,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:a.u}))}}const Zt=new a.t({"sky-color":new a.D(a.u.sky["sky-color"]),"horizon-color":new a.D(a.u.sky["horizon-color"]),"fog-color":new a.D(a.u.sky["fog-color"]),"fog-ground-blend":new a.D(a.u.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.u.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.u.sky["atmosphere-blend"])});class he extends a.E{constructor(t){super(),this._transitionable=new a.x(Zt,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.H(0))}setSky(t,n={}){if(!this._validate(a.J,t,n)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in t){const h=t[l];l.endsWith(a.z)?this._transitionable.setTransition(l.slice(0,-a.z.length),h):this._transitionable.setValue(l,h)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,l={}){return l?.validate!==!1&&a.B(this,t.call(a.C,a.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:a.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class Fe{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const l=t.join(",")+String(n);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,n)),this.dashEntry[l]}getDashRanges(t,n,l){const h=[];let _=t.length%2==1?-t[t.length-1]*l:0,w=t[0]*l,P=!0;h.push({left:_,right:w,isDash:P,zeroLength:t[0]===0});let M=t[0];for(let R=1;R<t.length;R++){P=!P;const B=t[R];_=M*l,M+=B,w=M*l,h.push({left:_,right:w,isDash:P,zeroLength:B===0})}return h}addRoundDash(t,n,l){const h=n/2;for(let _=-l;_<=l;_++){const w=this.width*(this.nextRow+l+_);let P=0,M=t[P];for(let R=0;R<this.width;R++){R/M.right>1&&(M=t[++P]);const B=Math.abs(R-M.left),$=Math.abs(R-M.right),G=Math.min(B,$);let X;const oe=_/l*(h+1);if(M.isDash){const ve=h-Math.abs(oe);X=Math.sqrt(G*G+ve*ve)}else X=h-Math.sqrt(G*G+oe*oe);this.data[w+R]=Math.max(0,Math.min(255,X+128))}}}addRegularDash(t){for(let P=t.length-1;P>=0;--P){const M=t[P],R=t[P+1];M.zeroLength?t.splice(P,1):R&&R.isDash===M.isDash&&(R.left=M.left,t.splice(P,1))}const n=t[0],l=t[t.length-1];n.isDash===l.isDash&&(n.left=l.left-this.width,l.right=n.right+this.width);const h=this.width*this.nextRow;let _=0,w=t[_];for(let P=0;P<this.width;P++){P/w.right>1&&(w=t[++_]);const M=Math.abs(P-w.left),R=Math.abs(P-w.right),B=Math.min(M,R);this.data[h+P]=Math.max(0,Math.min(255,(w.isDash?B:-B)+128))}}addDash(t,n){const l=n?7:0,h=2*l+1;if(this.nextRow+h>this.height)return a.w("LineAtlas out of space"),null;let _=0;for(let P=0;P<t.length;P++)_+=t[P];if(_!==0){const P=this.width/_,M=this.getDashRanges(t,this.width,P);n?this.addRoundDash(M,P,l):this.addRegularDash(M)}const w={y:this.nextRow+l,height:2*l,width:_};return this.nextRow+=h,this.dirty=!0,w}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const $e="maplibre_preloaded_worker_pool";class tt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<tt.workerCount;)this.workers.push(new Worker(a.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[$e]}numActive(){return Object.keys(this.active).length}}const ct=Math.floor(j.hardwareConcurrency/2);let ut,pt;function wt(){return ut||(ut=new tt),ut}tt.workerCount=a.K(globalThis)?Math.max(Math.min(ct,3),1):1;class Bt{constructor(t,n){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=n;const l=this.workerPool.acquire(n);for(let h=0;h<l.length;h++){const _=new a.L(l[h],n);_.name=`Worker ${h}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n){const l=[];for(const h of this.actors)l.push(h.sendAsync({type:t,data:n}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,n){for(const l of this.actors)l.registerMessageHandler(t,n)}unregisterMessageHandler(t){for(const n of this.actors)n.unregisterMessageHandler(t)}}function er(){return pt||(pt=new Bt(wt(),a.M),pt.registerMessageHandler("GR",(g,t,n)=>a.m(t,n))),pt}function ur(g,t){const n=a.N();return a.O(n,n,[1,1,0]),a.Q(n,n,[.5*g.width,.5*g.height,1]),g.calculatePosMatrix?a.S(n,n,g.calculatePosMatrix(t.toUnwrapped())):n}function fr(g,t,n,l,h,_,w){var P;const M=function(G,X,oe){if(G)for(const ve of G){const Se=X[ve];if(Se&&Se.source===oe&&Se.type==="fill-extrusion")return!0}else for(const ve in X){const Se=X[ve];if(Se.source===oe&&Se.type==="fill-extrusion")return!0}return!1}((P=h?.layers)!==null&&P!==void 0?P:null,t,g.id),R=_.maxPitchScaleFactor(),B=g.tilesIn(l,R,M);B.sort(Ft);const $=[];for(const G of B)$.push({wrappedTileID:G.tileID.wrapped().key,queryResults:G.tile.queryRenderedFeatures(t,n,g.getState(),G.queryGeometry,G.cameraQueryGeometry,G.scale,h,_,R,ur(_,G.tileID),w?(X,oe)=>w(G.tileID,X,oe):void 0)});return function(G,X){for(const oe in G)for(const ve of G[oe])Ue(ve,X);return G}(function(G){const X={},oe={};for(const ve of G){const Se=ve.queryResults,be=ve.wrappedTileID,Ae=oe[be]=oe[be]||{};for(const We in Se){const Le=Se[We],Je=Ae[We]=Ae[We]||{},et=X[We]=X[We]||[];for(const Ve of Le)Je[Ve.featureIndex]||(Je[Ve.featureIndex]=!0,et.push(Ve))}}return X}($),g)}function Ft(g,t){const n=g.tileID,l=t.tileID;return n.overscaledZ-l.overscaledZ||n.canonical.y-l.canonical.y||n.wrap-l.wrap||n.canonical.x-l.canonical.x}function Ue(g,t){const n=g.feature,l=t.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=l}function Yr(g,t,n){return a._(this,void 0,void 0,function*(){let l=g;if(g.url?l=(yield a.j(t.transformRequest(g.url,"Source"),n)).data:yield j.frameAsync(n),!l)return null;const h=a.U(a.e(l,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(h.vectorLayerIds=l.vector_layers.map(_=>_.id)),h})}class wr{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof a.V?new a.V(t.lng,t.lat):a.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof a.V?new a.V(t.lng,t.lat):a.V.convert(t),this}extend(t){const n=this._sw,l=this._ne;let h,_;if(t instanceof a.V)h=t,_=t;else{if(!(t instanceof wr))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(wr.convert(t)):this.extend(a.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(a.V.convert(t)):this;if(h=t._sw,_=t._ne,!h||!_)return this}return n||l?(n.lng=Math.min(h.lng,n.lng),n.lat=Math.min(h.lat,n.lat),l.lng=Math.max(_.lng,l.lng),l.lat=Math.max(_.lat,l.lat)):(this._sw=new a.V(h.lng,h.lat),this._ne=new a.V(_.lng,_.lat)),this}getCenter(){return new a.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.V(this.getWest(),this.getNorth())}getSouthEast(){return new a.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:l}=a.V.convert(t);let h=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}intersects(t){if(!((t=wr.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const n=a.W(this.getWest(),-180,180),l=a.W(this.getEast(),-180,180),h=a.W(t.getWest(),-180,180),_=a.W(t.getEast(),-180,180),w=n>=l,P=h>=_;return!(!w||!P)||(w?_>=n||h<=l:P?l>=h||n<=_:h<=l&&_>=n)}static convert(t){return t instanceof wr?t:t&&new wr(t)}static fromLngLat(t,n=0){const l=360*n/40075017,h=l/Math.cos(Math.PI/180*t.lat);return new wr(new a.V(t.lng-h,t.lat-l),new a.V(t.lng+h,t.lat+l))}adjustAntiMeridian(){const t=new a.V(this._sw.lng,this._sw.lat),n=new a.V(this._ne.lng,this._ne.lat);return new wr(t,t.lng>n.lng?new a.V(n.lng+360,n.lat):n)}}class Tr{constructor(t,n,l){this.bounds=wr.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),l=Math.floor(a.Y(this.bounds.getWest())*n),h=Math.floor(a.X(this.bounds.getNorth())*n),_=Math.ceil(a.Y(this.bounds.getEast())*n),w=Math.ceil(a.X(this.bounds.getSouth())*n);return t.x>=l&&t.x<_&&t.y>=h&&t.y<w}}class ir extends a.E{constructor(t,n,l,h){if(super(),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.U(n,["url","scheme","tileSize","promoteId","encoding"])),this._options=a.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Yr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(a.e(this,t),t.bounds&&(this.tileBounds=new Tr(t.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,a.Z(t)||this.fire(new a.k(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(t){return a._(this,void 0,void 0,function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(n,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};l.request.collectResourceTiming=this._collectResourceTiming;let h="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((_,w)=>{t.reloadPromise={resolve:_,reject:w}})}else t.actor=this.dispatcher.getActor(),h="LT";t.abortController=new AbortController;try{const _=yield t.actor.sendAsync({type:h,data:l},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,_)}catch(_){if(delete t.abortController,t.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(t,null)}})}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const n=t.tileID.scaledTo(this.maxzoom).canonical,l=n.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:n,overzoomRequest:this.map._requestManager.transformRequest(l,"Tile")}}_afterTileLoadWorkerResponse(t,n){if(n&&n.resourceTiming&&(t.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&t.setExpiryData(n),t.loadVectorData(n,this.map.painter),t.reloadPromise){const l=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(l.resolve).catch(l.reject)}}abortTile(t){return a._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return a._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ar extends a.E{constructor(t,n,l,h){super(),this.id=t,this.dispatcher=l,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},n),a.e(this,a.U(n,["url","scheme","tileSize"]))}load(){return a._(this,arguments,void 0,function*(t=!1){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield Yr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,n&&(a.e(this,n),n.bounds&&(this.tileBounds=new Tr(n.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(n){this._tileJSONRequest=null,this._loaded=!0,a.Z(n)||this.fire(new a.k(n))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return a.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return a._(this,void 0,void 0,function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const l=yield it.getImage(this.map._requestManager.transformRequest(n,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&t.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const h=this.map.painter.context,_=h.gl,w=l.data;t.texture=this.map.painter.getTileTexture(w.width),t.texture?t.texture.update(w,{useMipmap:!0}):(t.texture=new a.T(h,w,_.RGBA,{useMipmap:!0}),t.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(l){if(delete t.abortController,t.aborted)t.state="unloaded";else if(l)throw t.state="errored",l}})}abortTile(t){return a._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return a._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class mr extends Ar{constructor(t,n,l,h){super(t,n,l,h),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(t){return a._(this,void 0,void 0,function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(n,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const h=yield it.getImage(l,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(h&&h.data){const _=h.data;this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&t.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const w=a.b(_)&&a.$()?_:yield this.readImageNow(_),P={type:this.type,uid:t.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const M=yield t.actor.sendAsync({type:"LDT",data:P});t.dem=M,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(h){if(delete t.abortController,t.aborted)t.state="unloaded";else if(h)throw t.state="errored",h}})}readImageNow(t){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.a0()){const n=t.width+2,l=t.height+2;try{return new a.R({width:n,height:l},yield a.a1(t,-1,-1,n,l))}catch{}}return j.getImageData(t,1)})}_getNeighboringTiles(t){const n=t.canonical,l=Math.pow(2,n.z),h=(n.x-1+l)%l,_=n.x===0?t.wrap-1:t.wrap,w=(n.x+1+l)%l,P=n.x+1===l?t.wrap+1:t.wrap,M={};return M[new a.a2(t.overscaledZ,_,n.z,h,n.y).key]={backfilled:!1},M[new a.a2(t.overscaledZ,P,n.z,w,n.y).key]={backfilled:!1},n.y>0&&(M[new a.a2(t.overscaledZ,_,n.z,h,n.y-1).key]={backfilled:!1},M[new a.a2(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},M[new a.a2(t.overscaledZ,P,n.z,w,n.y-1).key]={backfilled:!1}),n.y+1<l&&(M[new a.a2(t.overscaledZ,_,n.z,h,n.y+1).key]={backfilled:!1},M[new a.a2(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},M[new a.a2(t.overscaledZ,P,n.z,w,n.y+1).key]={backfilled:!1}),M}unloadTile(t){return a._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}function Vr(g){return g.type==="GeometryCollection"?g.geometries.map(t=>t.coordinates).flat(1/0):g.coordinates.flat(1/0)}function Lr(g){const t=new wr;let n;switch(g.type){case"FeatureCollection":n=g.features.map(l=>Vr(l.geometry)).flat(1/0);break;case"Feature":n=Vr(g.geometry);break;default:n=Vr(g)}if(n.length==0)return t;for(let l=0;l<n.length-1;l+=2)t.extend([n[l],n[l+1]]);return t}class ai extends a.E{constructor(t,n,l,h){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:n.data},this.actor=l.getActor(),this.setEventedParent(h),this._data=typeof n.data=="string"?{url:n.data}:{geojson:n.data},this._options=a.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId,n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(n.buffer!==void 0?n.buffer:128),tolerance:this._pixelsToTileUnits(n.tolerance!==void 0?n.tolerance:.375),extent:a.a5,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(n.clusterMaxZoom),minPoints:Math.max(2,n.clusterMinPoints||2),extent:a.a5,radius:this._pixelsToTileUnits(n.clusterRadius||50),log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(a.a5/this.tileSize)}_getClusterMaxZoom(t){const n=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||a.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${n}"`),n}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t,n){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const l=this._updateWorkerData();return n?l:this}updateData(t,n){this._pendingWorkerUpdate.diff=a.a6(this._pendingWorkerUpdate.diff,t);const l=this._updateWorkerData();return n?l:this}getData(){return a._(this,void 0,void 0,function*(){const t=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}getBounds(){return a._(this,void 0,void 0,function*(){return Lr(yield this.getData())})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,n,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:n,offset:l}})}_updateWorkerData(){return a._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void a.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:n}=this._pendingWorkerUpdate,l=a.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(l.request=this.map._requestManager.transformRequest(j.resolveURL(t),"Source"),l.request.collectResourceTiming=this._collectResourceTiming):l.data=t,this._pendingWorkerUpdate.data=void 0):n&&(l.dataDiff=n,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new a.l("dataloading",{dataType:"source"}));try{const h=yield this.actor.sendAsync({type:"LD",data:l});if(this._isUpdatingWorker=!1,this._removed||h.abandoned)return void this.fire(new a.l("dataabort",{dataType:"source"}));n&&this._applyDiff(n);let _=null;h.resourceTiming&&h.resourceTiming[this.id]&&(_=h.resourceTiming[this.id].slice(0));const w={dataType:"source"};this._collectResourceTiming&&_&&_.length>0&&a.e(w,{resourceTiming:_}),this.fire(new a.l("data",Object.assign(Object.assign({},w),{sourceDataType:"metadata"}))),this.fire(new a.l("data",Object.assign(Object.assign({},w),{sourceDataType:"content",shouldReloadTileOptions:this._getShouldReloadTileOptions(n)})))}catch(h){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new a.l("dataabort",{dataType:"source"}));this.fire(new a.k(h))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}})}_applyDiff(t){const n=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){if(!a.a7(this._data.geojson,n))throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:a.a8(this._data.geojson,n)}}this._data.updateable&&a.a9(this._data.updateable,t,n)}_getShouldReloadTileOptions(t){if(this._options.cluster||!t||t.removeAll)return;const{add:n=[],update:l=[],remove:h=[]}=t||{},_=new Set([...l.map(w=>w.id),...h]);for(const w of _.values())if(typeof w!="number"&&this.promoteId==null)return void a.w(`GeoJSONSource "${this.id}": updateData is slower when using string GeoJSON feature IDs. Consider using promoteId or numeric IDs for better performance.`);return{nextBounds:[...l.map(w=>w.newGeometry),...n.map(w=>w.geometry)].filter(Boolean).map(w=>Lr(w)),prevIds:_}}shouldReloadTile(t,{nextBounds:n,prevIds:l}){if(!t.latestFeatureIndex)return t.state!=="unloaded";const h=t.latestFeatureIndex.loadVTLayers();for(let M=0;M<t.latestFeatureIndex.featureIndexArray.length;M++){const R=t.latestFeatureIndex.featureIndexArray.get(M),B=h[a.aa].feature(R.featureIndex),$=t.latestFeatureIndex.getId(B,a.aa);if(l.has($))return!0}const{buffer:_,extent:w}=this.workerOptions.geojsonVtOptions,P=function({x:M,y:R,z:B},$=0){const G=a.a3((M-$)/Math.pow(2,B)),X=a.a4((R+1+$)/Math.pow(2,B)),oe=a.a3((M+1+$)/Math.pow(2,B)),ve=a.a4((R-$)/Math.pow(2,B));return new wr([G,X],[oe,ve])}(t.tileID.canonical,_/w);for(const M of n)if(P.intersects(M))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return a._(this,void 0,void 0,function*(){const n=t.actor?"RT":"LT";t.actor=this.actor;const l={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const h=yield this.actor.sendAsync({type:n,data:l},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(h,this.map.painter,n==="RT")})}abortTile(t){return a._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return a._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class Rr extends a.E{constructor(t,n,l,h){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=l,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=n}load(t){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield it.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,t&&(this.coordinates=t),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,a.Z(n)||this.fire(new a.k(n))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const n=t.map(a.ab.fromLngLat);var l;return this.tileID=function(h){const _=a.ac.fromPoints(h),w=_.width(),P=_.height(),M=Math.max(w,P),R=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),B=Math.pow(2,R);return new a.ae(R,Math.floor((_.minX+_.maxX)/2*B),Math.floor((_.minY+_.maxY)/2*B))}(n),this.terrainTileRanges=this._getOverlappingTileRanges(n),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=n.map(h=>this.tileID.getTilePoint(h)._round()),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,n=t.gl;this.texture||(this.texture=new a.T(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const _=this.tiles[h];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,l=!0)}l&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:n,minY:l,maxX:h,maxY:_}=a.ac.fromPoints(t),w={};for(let P=0;P<=a.ad;P++){const M=Math.pow(2,P),R=Math.floor(n*M),B=Math.floor(l*M),$=Math.floor(h*M),G=Math.floor(_*M);w[P]={minTileX:R,minTileY:B,maxTileX:$,maxTileY:G}}return w}}class nt extends Rr{constructor(t,n,l,h){super(t,n,l,h),this.roundZoom=!0,this.type="video",this.options=n}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const n of t.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{const n=yield a.af(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new a.k(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new a.k(new a.ag(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const _=this.tiles[h];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,l=!0)}l&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class re extends Rr{constructor(t,n,l,h){super(t,n,l,h),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(w=>typeof w!="number"))||this.fire(new a.k(new a.ag(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.k(new a.ag(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new a.k(new a.ag(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new a.k(new a.ag(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.k(new a.ag(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,l=n.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new a.T(n,this.canvas,l.RGBA,{premultiply:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let h=!1;for(const _ in this.tiles){const w=this.tiles[_];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,h=!0)}h&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const K={},se=g=>{switch(g){case"geojson":return ai;case"image":return Rr;case"raster":return Ar;case"raster-dem":return mr;case"vector":return ir;case"video":return nt;case"canvas":return re}return K[g]},Ie="RTLPluginLoaded";class Ce extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=er()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(n=>{throw this.status="error",n})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return a._(this,arguments,void 0,function*(n,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=j.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.l(Ie))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ht=null;function at(){return ht||(ht=new Ce),ht}var Be,ot;(function(g){g[g.Base=0]="Base",g[g.Parent=1]="Parent"})(Be||(Be={})),function(g){g[g.Departing=0]="Departing",g[g.Incoming=1]="Incoming"}(ot||(ot={}));class Rt{constructor(t,n){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=a.ah(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:n,fadingParentID:l,fadeEndTime:h}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=n,this.fadingParentID=l,this.fadeEndTime=h}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=ce(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,n,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(h,_){const w={};if(!_)return w;for(const P of h){const M=P.layerIds.map(R=>_.getLayer(R)).filter(Boolean);if(M.length!==0){P.layers=M,P.stateDependentLayerIds&&(P.stateDependentLayers=P.stateDependentLayerIds.map(R=>M.filter(B=>B.id===R)[0]));for(const R of M)w[R.id]=P}}return w}(t.buckets,n?.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const _=this.buckets[h];if(_ instanceof a.aj){if(this.hasSymbolBuckets=!0,!l)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const _=this.buckets[h];if(_ instanceof a.aj&&_.hasRTLText){this.hasRTLText=!0,at().lazyLoad();break}}this.queryPadding=0;for(const h in this.buckets){const _=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(h).queryRadius(_))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new a.ai}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new a.T(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new a.T(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,l,h,_,w,P,M,R,B,$){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:_,scale:w,tileSize:this.tileSize,pixelPosMatrix:B,transform:M,params:P,queryPadding:this.queryPadding*R,getElevation:$},t,n,l):{}}querySourceFeatures(t,n){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),_=n&&n.sourceLayer?n.sourceLayer:"",w=h[a.aa]||h[_];if(!w)return;const P=a.ak(n?.filter,n?.globalState),{z:M,x:R,y:B}=this.tileID.canonical,$={z:M,x:R,y:B};for(let G=0;G<w.length;G++){const X=w.feature(G);if(P.needGeometry){const Se=a.al(X,!0);if(!P.filter(new a.H(this.tileID.overscaledZ),Se,this.tileID.canonical))continue}else if(!P.filter(new a.H(this.tileID.overscaledZ),X))continue;const oe=l.getId(X,_),ve=new a.am(X,M,R,B,oe);ve.tile=$,t.push(ve)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const l=a.an(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(n)if(this.expirationTime<n)h=!0;else{const _=this.expirationTime-n;_?this.expirationTime=l+Math.max(_,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!n.style.hasLayer(h))continue;const _=this.buckets[h],w=_.layers[0].sourceLayer||a.aa,P=l[w],M=t[w];if(!P||!M||Object.keys(M).length===0)continue;_.update(M,P,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const R=n&&n.style&&n.style.getLayer(h);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(_)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ce()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=ce()+t}setDependencies(t,n){const l={};for(const h of n)l[h]=!0;this.dependencies[t]=l}hasDependency(t,n){for(const l of t){const h=this.dependencies[l];if(h){for(const _ of n)if(h[_])return!0}}return!1}}class te{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,l){const h=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},a.e(this.stateChanges[t][h],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==h&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][h]===null){this.deletedStates[t][h]={};for(const _ in this.state[t][h])l[_]||(this.deletedStates[t][h][_]=null)}else for(const _ in l)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][_]===null&&delete this.deletedStates[t][h][_]}removeFeatureState(t,n,l){if(this.deletedStates[t]===null)return;const h=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&n!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][l]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(l in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][l]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,n){const l=String(n),h=a.e({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const _=this.deletedStates[t][n];if(_===null)return{};for(const w in _)delete h[w]}return h}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const _={};for(const w in this.stateChanges[h])this.state[h][w]||(this.state[h][w]={}),a.e(this.state[h][w],this.stateChanges[h][w]),_[w]=this.state[h][w];l[h]=_}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const _={};if(this.deletedStates[h]===null)for(const w in this.state[h])_[w]={},this.state[h][w]={};else for(const w in this.deletedStates[h]){if(this.deletedStates[h][w]===null)this.state[h][w]={};else for(const P of Object.keys(this.deletedStates[h][w]))delete this.state[h][w][P];_[w]=this.state[h][w]}l[h]=l[h]||{},a.e(l[h],_)}this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0&&t.setFeatureState(l,n)}}const I=89.25;function D(g,t){const n=a.ao(t.lat,-a.ap,a.ap);return new a.P(a.Y(t.lng)*g,a.X(n)*g)}function fe(g,t){return new a.ab(t.x/g,t.y/g).toLngLat()}function Ee(g){return g.cameraToCenterDistance*Math.min(.85*Math.tan(a.aq(90-g.pitch)),Math.tan(a.aq(I-g.pitch)))}function qe(g,t){const n=g.canonical,l=t/a.ar(n.z),h=n.x+Math.pow(2,n.z)*g.wrap,_=a.as(new Float64Array(16));return a.O(_,_,[h*l,n.y*l,0]),a.Q(_,_,[l/a.a5,l/a.a5,1]),_}function ae(g,t,n,l,h){const _=a.ab.fromLngLat(g,t),w=h*a.at(1,g.lat),{x:P,y:M,z:R}=ft(n,l);return new a.ab(_.x+w*-P,_.y+w*-M,_.z+w*-R)}function ft(g,t){const n=a.aq(g),l=a.aq(t),h=Math.cos(-n),_=Math.sin(n);return{x:_*Math.sin(l),y:-_*Math.cos(l),z:h}}function Nt(g,t,n){const l=t.intersectsFrustum(g);if(!n||l===0)return l;const h=t.intersectsPlane(n);return h===0?0:l===2&&h===2?2:1}function gt(g,t,n){let l=0;const h=(n-t)/10;for(let _=0;_<10;_++)l+=h*Math.pow(Math.cos(t+(_+.5)/10*(n-t)),g);return l}function Lt(g,t){return function(n,l,h,_,w){const P=2*((g-1)/a.au(Math.cos(a.aq(I-w))/Math.cos(a.aq(I)))-1),M=Math.acos(h/_),R=2*gt(P-1,0,a.aq(w/2)),B=Math.min(a.aq(I),M+a.aq(w/2)),$=gt(P-1,Math.min(B,M-a.aq(w/2)),B),G=Math.atan(l/h),X=Math.hypot(l,h);let oe=n;return oe+=a.au(_/X/Math.max(.5,Math.cos(a.aq(w/2)))),oe+=P*a.au(Math.cos(G))/2,oe-=a.au(Math.max(1,$/R/t))/2,oe}}const Ht=Lt(9.314,3);function Mt(g,t){const n=(t.roundZoom?Math.round:Math.floor)(g.zoom+a.au(g.tileSize/t.tileSize));return Math.max(0,n)}function rr(g,t){const n=g.getCameraFrustum(),l=g.getClippingPlane(),h=g.screenPointToMercatorCoordinate(g.getCameraPoint()),_=a.ab.fromLngLat(g.center,g.elevation);h.z=_.z+Math.cos(g.pitchInRadians)*g.cameraToCenterDistance/g.worldSize;const w=g.getCoveringTilesDetailsProvider(),P=w.allowVariableZoom(g,t),M=Mt(g,t),R=t.minzoom||0,B=t.maxzoom!==void 0?t.maxzoom:g.maxZoom,$=Math.min(Math.max(0,M),B),G=Math.pow(2,$),X=[G*h.x,G*h.y,0],oe=[G*_.x,G*_.y,0],ve=Math.hypot(_.x-h.x,_.y-h.y),Se=Math.abs(_.z-h.z),be=Math.hypot(ve,Se),Ae=Je=>({zoom:0,x:0,y:0,wrap:Je,fullyVisible:!1}),We=[],Le=[];if(g.renderWorldCopies&&w.allowWorldCopies())for(let Je=1;Je<=3;Je++)We.push(Ae(-Je)),We.push(Ae(Je));for(We.push(Ae(0));We.length>0;){const Je=We.pop(),et=Je.x,Ve=Je.y;let lt=Je.fullyVisible;const Tt={x:et,y:Ve,z:Je.zoom},bt=w.getTileBoundingVolume(Tt,Je.wrap,g.elevation,t);if(!lt){const ar=Nt(n,bt,l);if(ar===0)continue;lt=ar===2}const Pt=w.distanceToTile2d(h.x,h.y,Tt,bt);let Ct=M;P&&(Ct=(t.calculateTileZoom||Ht)(g.zoom+a.au(g.tileSize/t.tileSize),Pt,Se,be,g.fov)),Ct=(t.roundZoom?Math.round:Math.floor)(Ct),Ct=Math.max(0,Ct);const Jt=Math.min(Ct,B);if(Je.wrap=w.getWrap(_,Tt,Je.wrap),Je.zoom>=Jt){if(Je.zoom<R)continue;const ar=$-Je.zoom,Yt=X[0]-.5-(et<<ar),xr=X[1]-.5-(Ve<<ar),Jr=t.reparseOverscaled?Math.max(Je.zoom,Ct):Je.zoom;Le.push({tileID:new a.a2(Je.zoom===B?Jr:Je.zoom,Je.wrap,Je.zoom,et,Ve),distanceSq:a.av([oe[0]-.5-et,oe[1]-.5-Ve]),tileDistanceToCamera:Math.sqrt(Yt*Yt+xr*xr)})}else for(let ar=0;ar<4;ar++)We.push({zoom:Je.zoom+1,x:(et<<1)+ar%2,y:(Ve<<1)+(ar>>1),wrap:Je.wrap,fullyVisible:lt})}return Le.sort((Je,et)=>Je.distanceSq-et.distanceSq).map(Je=>Je.tileID)}const Ut=a.ac.fromPoints([new a.P(0,0),new a.P(a.a5,a.a5)]);function gr(g){return g==="raster"||g==="image"||g==="video"}function Xr(g,t,n,l,h,_,w){if(!t.hasData())return!1;const{tileID:P,fadingRole:M,fadingDirection:R,fadingParentID:B}=t;if(M===Be.Base&&R===ot.Incoming&&B)return n[B.key]=B,!0;const $=Math.max(P.overscaledZ-h,_);for(let G=P.overscaledZ-1;G>=$;G--){const X=P.scaledTo(G),oe=g.getLoadedTile(X);if(oe)return t.setCrossFadeLogic({fadingRole:Be.Base,fadingDirection:ot.Incoming,fadingParentID:oe.tileID,fadeEndTime:l+w}),oe.setCrossFadeLogic({fadingRole:Be.Parent,fadingDirection:ot.Departing,fadeEndTime:l+w}),n[X.key]=X,!0}return!1}function ri(g,t,n,l,h,_){if(!t.hasData())return!1;const w=t.tileID.children(h);let P=Ot(g,t,w,n,l,h,_);if(P)return!0;for(const M of w)Ot(g,t,M.children(h),n,l,h,_)&&(P=!0);return P}function Ot(g,t,n,l,h,_,w){if(n[0].overscaledZ>=_)return!1;let P=!1;for(const M of n){const R=g.getLoadedTile(M);if(!R)continue;const{fadingRole:B,fadingDirection:$,fadingParentID:G}=R;B===Be.Base&&$===ot.Departing&&G||(R.setCrossFadeLogic({fadingRole:Be.Base,fadingDirection:ot.Departing,fadingParentID:t.tileID,fadeEndTime:h+w}),t.setCrossFadeLogic({fadingRole:Be.Parent,fadingDirection:ot.Incoming,fadeEndTime:h+w})),l[M.key]=M,P=!0}return P}function kr(g,t,n,l){const h=g.tileID;return!!g.selfFading||!g.hasData()&&!!t.has(h)&&(g.setSelfFadeLogic(n+l),!0)}function Fi(g,t){var n;g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let l=t.tileID.canonical.x-g.tileID.canonical.x;const h=t.tileID.canonical.y-g.tileID.canonical.y,_=Math.pow(2,g.tileID.canonical.z),w=t.tileID.key;l===0&&h===0||Math.abs(h)>1||(Math.abs(l)>1&&(Math.abs(l+_)===1?l+=_:Math.abs(l-_)===1&&(l-=_)),t.dem&&g.dem&&(g.dem.backfillBorder(t.dem,l,h),!((n=g.neighboringTiles)===null||n===void 0)&&n[w]&&(g.neighboringTiles[w].backfilled=!0)))}class Ln{constructor(){this._tiles={}}handleWrapJump(t){const n={};for(const l in this._tiles){const h=this._tiles[l];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+t),n[h.tileID.key]=h}this._tiles=n}setFeatureState(t,n){for(const l in this._tiles)this._tiles[l].setFeatureState(t,n)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map(n=>n.tileID).sort(a.ax).map(n=>n.key):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,n){this._tiles[t]=n}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const n=this.getTileById(t.key);return n?.hasData()?n:null}isIdRenderable(t,n=!1){var l;return(l=this.getTileById(t))===null||l===void 0?void 0:l.isRenderable(n)}getRenderableIds(t=0,n){const l=[];for(const h of this.getAllIds())this.isIdRenderable(h,n)&&l.push(this.getTileById(h));return n?l.sort((h,_)=>{const w=h.tileID,P=_.tileID,M=new a.P(w.canonical.x,w.canonical.y)._rotate(-t),R=new a.P(P.canonical.x,P.canonical.y)._rotate(-t);return w.overscaledZ-P.overscaledZ||R.y-M.y||R.x-M.x}).map(h=>h.tileID.key):l.map(h=>h.tileID).sort(a.ax).map(h=>h.key)}}class Zi extends a.E{constructor(t,n,l){super(),this.id=t,this.dispatcher=l,this.on("data",h=>this._dataHandler(h)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((h,_,w,P)=>{const M=new(se(_.type))(h,_,w,P);if(M.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${M.id}`);return M})(t,n,l,this),this._inViewTiles=new Ln,this._outOfViewCache=new a.ay(0,h=>this._unloadTile(h)),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new te,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const n of this._inViewTiles.getAllTiles())n.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new Ln}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n,l){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,n,l)}catch(h){t.state="errored",h.status!==404?this._source.fire(new a.k(h,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new a.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const n of this._inViewTiles.getAllTiles())n.upload(t),n.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var n;return this._inViewTiles.getRenderableIds((n=this.transform)===null||n===void 0?void 0:n.bearingInRadians,t)}hasRenderableParent(t){const n=t.overscaledZ-1;if(n>=this._source.minzoom){const l=this.getLoadedTile(t.scaledTo(n));if(l)return this._inViewTiles.isIdRenderable(l.tileID.key)}return!1}reload(t,n=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const l of this._inViewTiles.getAllIds()){const h=this._inViewTiles.getTileById(l);n&&!this._source.shouldReloadTile(h,n)||(t?this._reloadTile(l,"expired"):h.state!=="errored"&&this._reloadTile(l,"reloading"))}}}_reloadTile(t,n){return a._(this,void 0,void 0,function*(){const l=this._inViewTiles.getTileById(t);l&&(l.state!=="loading"&&(l.state=n),yield this._loadTile(l,t,n))})}_tileLoaded(t,n,l){t.timeAdded=ce(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&function(h,_){var w,P;const M=_.getRenderableIds();for(const R of M){if(!h.neighboringTiles||!h.neighboringTiles[R])continue;const B=_.getTileById(R);h.neighboringTiles[R].backfilled||Fi(h,B),!((P=(w=B.neighboringTiles)===null||w===void 0?void 0:w[h.tileID.key])===null||P===void 0)&&P.backfilled||Fi(B,h)}}(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new a.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,n){const l=this._getLoadedDescendents(n),h=new Set;for(const _ of n){const w=l[_.key];if(!w?.length){h.add(_);continue}const P=_.overscaledZ+Zi.maxOverzooming,M=w.filter($=>$.tileID.overscaledZ<=P);if(!M.length){h.add(_);continue}const R=Math.min(...M.map($=>$.tileID.overscaledZ)),B=M.filter($=>$.tileID.overscaledZ===R).map($=>$.tileID);for(const $ of B)t[$.key]=$;this._areDescendentsComplete(B,R,_.overscaledZ)||h.add(_)}return h}_getLoadedDescendents(t){var n;const l={};for(const h of this._inViewTiles.getAllTiles().filter(_=>_.hasData()))for(const _ of t)h.tileID.isChildOf(_)&&(l[n=_.key]||(l[n]=[])).push(h);return l}_areDescendentsComplete(t,n,l){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===n:Math.pow(4,n-l)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,h=Math.floor(n*l*(this._maxTileCacheZoomLevels===null?a.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._outOfViewCache.setMaxSize(_)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,n&&(this._inViewTiles.handleWrapJump(n),this._resetTileReloadTimers())}update(t,n){if(!this._sourceLoaded||this._paused)return;let l;this.transform=t,this.terrain=n,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new a.a2(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(l=rr(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter(M=>this._source.hasTile(M)))):l=[],this.usedForTerrain&&(l=this._addTerrainIdealTiles(l));const h=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,h&&this.fire(new a.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const _=Mt(t,this._source),w=this._updateRetainedTiles(l,_),P=gr(this._source.type);P&&this._rasterFadeDuration>0&&!n&&function(M,R,B,$,G,X,oe){const ve=ce(),Se=a.aw(R);for(const be of R){const Ae=M.getTileById(be.key);Ae.fadingDirection!==ot.Departing&&Ae.fadeOpacity!==0||Ae.resetFadeLogic(),Xr(M,Ae,B,ve,$,G,oe)||ri(M,Ae,B,ve,X,oe)||kr(Ae,Se,ve,oe)||Ae.resetFadeLogic()}}(this._inViewTiles,l,w,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),P?this._cleanUpRasterTiles(w):this._cleanUpVectorTiles(w)}_cleanUpRasterTiles(t){for(const n of this._inViewTiles.getAllIds())t[n]||this._removeTile(n)}_cleanUpVectorTiles(t){for(const n of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(n);t[n]?l.clearSymbolFadeHold():l.hasSymbolBuckets?l.holdingForSymbolFade()?l.symbolFadeFinished()&&this._removeTile(n):l.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(n)}}_addTerrainIdealTiles(t){const n=[];for(const l of t)if(l.canonical.z>this._source.minzoom){const h=l.scaledTo(l.canonical.z-1);n.push(h);const _=l.scaledTo(Math.max(this._source.minzoom,Math.min(l.canonical.z,5)));n.push(_)}return t.concat(n)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){var l;const h=new Set;for(const R of t)this._addTile(R).hasData()||h.add(R);const _=t.reduce((R,B)=>(R[B.key]=B,R),{}),w=this._retainLoadedChildren(_,h),P={},M=Math.max(n-Zi.maxUnderzooming,this._source.minzoom);for(const R of w){let B=this._inViewTiles.getTileById(R.key),$=B?.wasRequested();for(let G=R.overscaledZ-1;G>=M;--G){const X=R.scaledTo(G);if(P[X.key])break;if(P[X.key]=!0,B=this.getTile(X),!B&&$&&(B=this._addTile(X)),B){const oe=B.hasData();if((oe||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||$)&&(_[X.key]=X),$=B.wasRequested(),oe)break}}}return _}_addTile(t){let n=this._inViewTiles.getTileById(t.key);if(n)return n;n=this._outOfViewCache.getAndRemove(t),n&&(n.resetFadeLogic(),this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null));const l=n;return n||(n=new Rt(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,t.key,n.state)),n.uses++,this._inViewTiles.setTile(t.key,n),l||this._source.fire(new a.l("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){this._clearTileReloadTimer(t);const l=n.getExpiryTimeout();l&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},l))}_clearTileReloadTimer(t){const n=this._timers[t];n&&(clearTimeout(n),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const n=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,n)}}refreshTiles(t){for(const n of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(n);(this._inViewTiles.isIdRenderable(n)||l.state=="errored")&&t.some(h=>h.equals(l.tileID.canonical))&&this._reloadTile(n,"expired")}}_removeTile(t){const n=this._inViewTiles.getTileById(t);n&&(n.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._outOfViewCache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,n,l){const h=[],_=this.transform;if(!_)return h;const w=_.getCoveringTilesDetailsProvider().allowWorldCopies(),P=l?_.getCameraQueryGeometry(t):t,M=X=>_.screenPointToMercatorCoordinate(X,this.terrain),R=this.transformBbox(t,M,!w),B=this.transformBbox(P,M,!w),$=this.getIds(),G=a.ac.fromPoints(B);for(let X=0;X<$.length;X++){const oe=this._inViewTiles.getTileById($[X]);if(oe.holdingForSymbolFade())continue;const ve=w?[oe.tileID]:[oe.tileID.unwrapTo(-1),oe.tileID.unwrapTo(0)],Se=Math.pow(2,_.zoom-oe.tileID.overscaledZ),be=n*oe.queryPadding*a.a5/oe.tileSize/Se;for(const Ae of ve){const We=G.map(Le=>Ae.getTilePoint(new a.ab(Le.x,Le.y)));if(We.expandBy(be),We.intersects(Ut)){const Le=R.map(et=>Ae.getTilePoint(et)),Je=B.map(et=>Ae.getTilePoint(et));h.push({tile:oe,tileID:w?Ae:Ae.unwrapTo(0),queryGeometry:Le,cameraQueryGeometry:Je,scale:Se})}}}return h}transformBbox(t,n,l){let h=t.map(n);if(l){const _=a.ac.fromPoints(t);_.shrinkBy(.001*Math.min(_.width(),_.height()));const w=_.map(n);a.ac.fromPoints(h).covers(w)||(h=h.map(P=>P.x>.5?new a.ab(P.x-1,P.y,P.z):P))}return h}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(l=>this._inViewTiles.getTileById(l).tileID);return this.transform&&this.transform.populateCache(n),n}hasTransition(){return!!this._source.hasTransition()||!(!gr(this._source.type)||!function(t,n){if(n<=0)return!1;const l=ce();for(const h of t.getAllTiles())if(h.fadeEndTime>=l)return!0;return!1}(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,n,l){this._state.updateState(t=t||a.aa,n,l)}removeFeatureState(t,n,l){this._state.removeFeatureState(t=t||a.aa,n,l)}getFeatureState(t,n){return this._state.getState(t=t||a.aa,n)}setDependencies(t,n,l){const h=this._inViewTiles.getTileById(t);h&&h.setDependencies(n,l)}reloadTilesForDependencies(t,n){for(const l of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(l).hasDependency(t,n)&&this._reloadTile(l,"reloading");this._outOfViewCache.filter(l=>!l.hasDependency(t,n))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}Zi.maxUnderzooming=10,Zi.maxOverzooming=3;class nr{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=a.ao(t,0,1);let n=1,l=this._distances[n];const h=t*this.paddedLength+this.padding;for(;l<h&&n<this._distances.length;)l=this._distances[++n];const _=n-1,w=this._distances[_],P=l-w,M=P>0?(h-w)/P:0;return this.points[_].mult(1-M).add(this.points[n].mult(M))}}function Br(g,t){let n=!0;return g==="always"||g!=="never"&&t!=="never"||(n=!1),n}class Or{constructor(t,n,l){const h=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(n/l);for(let w=0;w<this.xCellCount*this.yCellCount;w++)h.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,l,h,_){this._forEachCell(n,l,h,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(_)}insertCircle(t,n,l,h){this._forEachCell(n-h,l-h,n+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(l),this.circles.push(h)}_insertBoxCell(t,n,l,h,_,w){this.boxCells[_].push(w)}_insertCircleCell(t,n,l,h,_,w){this.circleCells[_].push(w)}_query(t,n,l,h,_,w,P){if(l<0||t>this.width||h<0||n>this.height)return[];const M=[];if(t<=0&&n<=0&&this.width<=l&&this.height<=h){if(_)return[{key:null,x1:t,y1:n,x2:l,y2:h}];for(let R=0;R<this.boxKeys.length;R++)M.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const B=this.circles[3*R],$=this.circles[3*R+1],G=this.circles[3*R+2];M.push({key:this.circleKeys[R],x1:B-G,y1:$-G,x2:B+G,y2:$+G})}}else this._forEachCell(t,n,l,h,this._queryCell,M,{hitTest:_,overlapMode:w,seenUids:{box:{},circle:{}}},P);return M}query(t,n,l,h){return this._query(t,n,l,h,!1,null)}hitTest(t,n,l,h,_,w){return this._query(t,n,l,h,!0,_,w).length>0}hitTestCircle(t,n,l,h,_){const w=t-l,P=t+l,M=n-l,R=n+l;if(P<0||w>this.width||R<0||M>this.height)return!1;const B=[];return this._forEachCell(w,M,P,R,this._queryCellCircle,B,{hitTest:!0,overlapMode:h,circle:{x:t,y:n,radius:l},seenUids:{box:{},circle:{}}},_),B.length>0}_queryCell(t,n,l,h,_,w,P,M){const{seenUids:R,hitTest:B,overlapMode:$}=P,G=this.boxCells[_];if(G!==null){const oe=this.bboxes;for(const ve of G)if(!R.box[ve]){R.box[ve]=!0;const Se=4*ve,be=this.boxKeys[ve];if(t<=oe[Se+2]&&n<=oe[Se+3]&&l>=oe[Se+0]&&h>=oe[Se+1]&&(!M||M(be))&&(!B||!Br($,be.overlapMode))&&(w.push({key:be,x1:oe[Se],y1:oe[Se+1],x2:oe[Se+2],y2:oe[Se+3]}),B))return!0}}const X=this.circleCells[_];if(X!==null){const oe=this.circles;for(const ve of X)if(!R.circle[ve]){R.circle[ve]=!0;const Se=3*ve,be=this.circleKeys[ve];if(this._circleAndRectCollide(oe[Se],oe[Se+1],oe[Se+2],t,n,l,h)&&(!M||M(be))&&(!B||!Br($,be.overlapMode))){const Ae=oe[Se],We=oe[Se+1],Le=oe[Se+2];if(w.push({key:be,x1:Ae-Le,y1:We-Le,x2:Ae+Le,y2:We+Le}),B)return!0}}}return!1}_queryCellCircle(t,n,l,h,_,w,P,M){const{circle:R,seenUids:B,overlapMode:$}=P,G=this.boxCells[_];if(G!==null){const oe=this.bboxes;for(const ve of G)if(!B.box[ve]){B.box[ve]=!0;const Se=4*ve,be=this.boxKeys[ve];if(this._circleAndRectCollide(R.x,R.y,R.radius,oe[Se+0],oe[Se+1],oe[Se+2],oe[Se+3])&&(!M||M(be))&&!Br($,be.overlapMode))return w.push(!0),!0}}const X=this.circleCells[_];if(X!==null){const oe=this.circles;for(const ve of X)if(!B.circle[ve]){B.circle[ve]=!0;const Se=3*ve,be=this.circleKeys[ve];if(this._circlesCollide(oe[Se],oe[Se+1],oe[Se+2],R.x,R.y,R.radius)&&(!M||M(be))&&!Br($,be.overlapMode))return w.push(!0),!0}}}_forEachCell(t,n,l,h,_,w,P,M){const R=this._convertToXCellCoord(t),B=this._convertToYCellCoord(n),$=this._convertToXCellCoord(l),G=this._convertToYCellCoord(h);for(let X=R;X<=$;X++)for(let oe=B;oe<=G;oe++)if(_.call(this,t,n,l,h,this.xCellCount*oe+X,w,P,M))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,l,h,_,w){const P=h-t,M=_-n,R=l+w;return R*R>P*P+M*M}_circleAndRectCollide(t,n,l,h,_,w,P){const M=(w-h)/2,R=Math.abs(t-(h+M));if(R>M+l)return!1;const B=(P-_)/2,$=Math.abs(n-(_+B));if($>B+l)return!1;if(R<=M||$<=B)return!0;const G=R-M,X=$-B;return G*G+X*X<=l*l}}function Oi(g,t,n){const l=a.N();if(!g){const{vecSouth:$,vecEast:G}=Mn(t),X=F();X[0]=G[0],X[1]=G[1],X[2]=$[0],X[3]=$[1],h=X,(B=(w=(_=X)[0])*(R=_[3])-(M=_[2])*(P=_[1]))&&(h[0]=R*(B=1/B),h[1]=-P*B,h[2]=-M*B,h[3]=w*B),l[0]=X[0],l[1]=X[1],l[4]=X[2],l[5]=X[3]}var h,_,w,P,M,R,B;return a.Q(l,l,[1/n,1/n,1]),l}function Bs(g,t,n,l){if(g){const h=a.N();if(!t){const{vecSouth:_,vecEast:w}=Mn(n);h[0]=w[0],h[1]=w[1],h[4]=_[0],h[5]=_[1]}return a.Q(h,h,[l,l,1]),h}return n.pixelsToClipSpaceMatrix}function Mn(g){const t=Math.cos(g.rollInRadians),n=Math.sin(g.rollInRadians),l=Math.cos(g.pitchInRadians),h=Math.cos(g.bearingInRadians),_=Math.sin(g.bearingInRadians),w=a.aD();w[0]=-h*l*n-_*t,w[1]=-_*l*n+h*t;const P=a.aE(w);P<1e-9?a.aF(w):a.aG(w,w,1/P);const M=a.aD();M[0]=h*l*t-_*n,M[1]=_*l*t+h*n;const R=a.aE(M);return R<1e-9?a.aF(M):a.aG(M,M,1/R),{vecEast:M,vecSouth:w}}function Gr(g,t,n,l){let h;l?(h=[g,t,l(g,t),1],a.aI(h,h,n)):(h=[g,t,0,1],Ji(h,h,n));const _=h[3];return{point:new a.P(h[0]/_,h[1]/_),signedDistanceFromCamera:_,isOccluded:!1}}function ya(g,t){return .5+g/t*.5}function va(g,t){return g.x>=-t[0]&&g.x<=t[0]&&g.y>=-t[1]&&g.y<=t[1]}function Ra(g,t,n,l,h,_,w,P,M,R,B,$,G){const X=n?g.textSizeData:g.iconSizeData,oe=a.az(X,t.transform.zoom),ve=[256/t.width*2+1,256/t.height*2+1],Se=n?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;Se.clear();const be=g.lineVertexArray,Ae=n?g.text.placedSymbolArray:g.icon.placedSymbolArray,We=t.transform.width/t.transform.height;let Le=!1;for(let Je=0;Je<Ae.length;Je++){const et=Ae.get(Je);if(et.hidden||et.writingMode===a.aA.vertical&&!Le){Oa(et.numGlyphs,Se);continue}Le=!1;const Ve=new a.P(et.anchorX,et.anchorY),lt={getElevation:G,pitchedLabelPlaneMatrix:l,lineVertexArray:be,pitchWithMap:_,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:Ve,unwrappedTileID:M,width:R,height:B,translation:$},Tt=ba(et.anchorX,et.anchorY,lt);if(!va(Tt.point,ve)){Oa(et.numGlyphs,Se);continue}const bt=ya(t.transform.cameraToCenterDistance,Tt.signedDistanceFromCamera),Pt=a.aB(X,oe,et),Ct=_?Pt*t.transform.getPitchedTextCorrection(et.anchorX,et.anchorY,M)/bt:Pt*bt,Jt=Na({projectionContext:lt,pitchedLabelPlaneMatrixInverse:h,symbol:et,fontSize:Ct,flip:!1,keepUpright:w,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:Se,aspectRatio:We,rotateToLine:P});Le=Jt.useVertical,(Jt.notEnoughRoom||Le||Jt.needsFlipping&&Na({projectionContext:lt,pitchedLabelPlaneMatrixInverse:h,symbol:et,fontSize:Ct,flip:!0,keepUpright:w,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:Se,aspectRatio:We,rotateToLine:P}).notEnoughRoom)&&Oa(et.numGlyphs,Se)}n?g.text.dynamicLayoutVertexBuffer.updateData(Se):g.icon.dynamicLayoutVertexBuffer.updateData(Se)}function to(g,t,n,l,h,_,w,P){const M=_.glyphStartIndex+_.numGlyphs,R=_.lineStartIndex,B=_.lineStartIndex+_.lineLength,$=t.getoffsetX(_.glyphStartIndex),G=t.getoffsetX(M-1),X=_s(g*$,n,l,h,_.segment,R,B,P,w);if(!X)return null;const oe=_s(g*G,n,l,h,_.segment,R,B,P,w);return oe?P.projectionCache.anyProjectionOccluded?null:{first:X,last:oe}:null}function za(g,t,n,l){return g===a.aA.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*l?{useVertical:!0}:(g===a.aA.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function Na(g){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:n,symbol:l,fontSize:h,flip:_,keepUpright:w,glyphOffsetArray:P,dynamicLayoutVertexArray:M,aspectRatio:R,rotateToLine:B}=g,$=h/24,G=l.lineOffsetX*$,X=l.lineOffsetY*$;let oe;if(l.numGlyphs>1){const ve=l.glyphStartIndex+l.numGlyphs,Se=l.lineStartIndex,be=l.lineStartIndex+l.lineLength,Ae=to($,P,G,X,_,l,B,t);if(!Ae)return{notEnoughRoom:!0};const We=ko(Ae.first.point.x,Ae.first.point.y,t,n),Le=ko(Ae.last.point.x,Ae.last.point.y,t,n);if(w&&!_){const Je=za(l.writingMode,We,Le,R);if(Je)return Je}oe=[Ae.first];for(let Je=l.glyphStartIndex+1;Je<ve-1;Je++){const et=_s($*P.getoffsetX(Je),G,X,_,l.segment,Se,be,t,B);if(!et)return{notEnoughRoom:!0};oe.push(et)}oe.push(Ae.last)}else{if(w&&!_){const Se=mi(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,be=l.lineStartIndex+l.segment+1,Ae=new a.P(t.lineVertexArray.getx(be),t.lineVertexArray.gety(be)),We=mi(Ae.x,Ae.y,t),Le=We.signedDistanceFromCamera>0?We.point:ro(t.tileAnchorPoint,Ae,Se,1,t),Je=ko(Se.x,Se.y,t,n),et=ko(Le.x,Le.y,t,n),Ve=za(l.writingMode,Je,et,R);if(Ve)return Ve}const ve=_s($*P.getoffsetX(l.glyphStartIndex),G,X,_,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,t,B);if(!ve||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};oe=[ve]}for(const ve of oe)a.aH(M,ve.point,ve.angle);return{}}function ro(g,t,n,l,h){const _=g.add(g.sub(t)._unit()),w=mi(_.x,_.y,h).point,P=n.sub(w);return n.add(P._mult(l/P.mag()))}function Bi(g,t,n){const l=t.projectionCache;if(l.projections[g])return l.projections[g];const h=new a.P(t.lineVertexArray.getx(g),t.lineVertexArray.gety(g)),_=mi(h.x,h.y,t);if(_.signedDistanceFromCamera>0)return l.projections[g]=_.point,l.anyProjectionOccluded=l.anyProjectionOccluded||_.isOccluded,_.point;const w=g-n.direction;return ro(n.distanceFromAnchor===0?t.tileAnchorPoint:new a.P(t.lineVertexArray.getx(w),t.lineVertexArray.gety(w)),h,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,t)}function mi(g,t,n){const l=g+n.translation[0],h=t+n.translation[1];let _;return n.pitchWithMap?(_=Gr(l,h,n.pitchedLabelPlaneMatrix,n.getElevation),_.isOccluded=!1):(_=n.transform.projectTileCoordinates(l,h,n.unwrappedTileID,n.getElevation),_.point.x=(.5*_.point.x+.5)*n.width,_.point.y=(.5*-_.point.y+.5)*n.height),_}function ko(g,t,n,l){if(n.pitchWithMap){const h=[g,t,0,1];return a.aI(h,h,l),n.transform.projectTileCoordinates(h[0]/h[3],h[1]/h[3],n.unwrappedTileID,n.getElevation).point}return{x:g/n.width*2-1,y:1-t/n.height*2}}function ba(g,t,n){return n.transform.projectTileCoordinates(g,t,n.unwrappedTileID,n.getElevation)}function io(g,t,n){return g._unit()._perp()._mult(t*n)}function xa(g,t,n,l,h,_,w,P,M){if(P.projectionCache.offsets[g])return P.projectionCache.offsets[g];const R=n.add(t);if(g+M.direction<l||g+M.direction>=h)return P.projectionCache.offsets[g]=R,R;const B=Bi(g+M.direction,P,M),$=io(B.sub(n),w,M.direction),G=n.add($),X=B.add($);return P.projectionCache.offsets[g]=a.aJ(_,R,G,X)||R,P.projectionCache.offsets[g]}function _s(g,t,n,l,h,_,w,P,M){const R=l?g-t:g+t;let B=R>0?1:-1,$=0;l&&(B*=-1,$=Math.PI),B<0&&($+=Math.PI);let G,X=B>0?_+h:_+h+1;P.projectionCache.cachedAnchorPoint?G=P.projectionCache.cachedAnchorPoint:(G=mi(P.tileAnchorPoint.x,P.tileAnchorPoint.y,P).point,P.projectionCache.cachedAnchorPoint=G);let oe,ve,Se=G,be=G,Ae=0,We=0;const Le=Math.abs(R),Je=[];let et;for(;Ae+We<=Le;){if(X+=B,X<_||X>=w)return null;Ae+=We,be=Se,ve=oe;const Tt={absOffsetX:Le,direction:B,distanceFromAnchor:Ae,previousVertex:be};if(Se=Bi(X,P,Tt),n===0)Je.push(be),et=Se.sub(be);else{let bt;const Pt=Se.sub(be);bt=Pt.mag()===0?io(Bi(X+B,P,Tt).sub(Se),n,B):io(Pt,n,B),ve||(ve=be.add(bt)),oe=xa(X,bt,Se,_,w,ve,n,P,Tt),Je.push(ve),et=oe.sub(ve)}We=et.mag()}const Ve=et._mult((Le-Ae)/We)._add(ve||be),lt=$+Math.atan2(Se.y-be.y,Se.x-be.x);return Je.push(Ve),{point:Ve,angle:M?lt:0,path:Je}}const Do=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Oa(g,t){for(let n=0;n<g;n++){const l=t.length;t.resize(l+4),t.float32.set(Do,3*l)}}function Ji(g,t,n){const l=t[0],h=t[1];return g[0]=n[0]*l+n[4]*h+n[12],g[1]=n[1]*l+n[5]*h+n[13],g[3]=n[3]*l+n[7]*h+n[15],g}const ji=100;class Ol{constructor(t,n=new Or(t.width+200,t.height+200,25),l=new Or(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=l,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ji,this.screenBottomBoundary=t.height+ji,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,l,h,_,w,P,M,R,B,$,G){const X=this.projectAndGetPerspectiveRatio(t.anchorPointX+M[0],t.anchorPointY+M[1],_,B,G),oe=l*X.perspectiveRatio;let ve;if(w||P)ve=this._projectCollisionBox(t,oe,h,_,w,P,M,X,B,$,G);else{const et=X.x+($?$.x*oe:0),Ve=X.y+($?$.y*oe:0);ve={allPointsOccluded:!1,box:[et+t.x1*oe,Ve+t.y1*oe,et+t.x2*oe,Ve+t.y2*oe]}}const[Se,be,Ae,We]=ve.box,Le=w?ve.allPointsOccluded:X.isOccluded;let Je=Le;return Je||(Je=X.perspectiveRatio<this.perspectiveRatioCutoff),Je||(Je=!this.isInsideGrid(Se,be,Ae,We)),Je||n!=="always"&&this.grid.hitTest(Se,be,Ae,We,n,R)?{box:[Se,be,Ae,We],placeable:!1,offscreen:!1,occluded:Le}:{box:[Se,be,Ae,We],placeable:!0,offscreen:this.isOffscreen(Se,be,Ae,We),occluded:Le}}placeCollisionCircles(t,n,l,h,_,w,P,M,R,B,$,G,X,oe){const ve=[],Se=new a.P(n.anchorX,n.anchorY),be=this.getPerspectiveRatio(Se.x,Se.y,w,oe),Ae=(R?_*this.transform.getPitchedTextCorrection(n.anchorX,n.anchorY,w)/be:_*be)/a.aN,We={getElevation:oe,pitchedLabelPlaneMatrix:P,lineVertexArray:l,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Se,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:X},Le=to(Ae,h,n.lineOffsetX*Ae,n.lineOffsetY*Ae,!1,n,!1,We);let Je=!1,et=!1,Ve=!0;if(Le){const lt=.5*$*be+G,Tt=new a.P(-100,-100),bt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Pt=new nr,Ct=Le.first,Jt=Le.last;let ar=[];for(let Jr=Ct.path.length-1;Jr>=1;Jr--)ar.push(Ct.path[Jr]);for(let Jr=1;Jr<Jt.path.length;Jr++)ar.push(Jt.path[Jr]);const Yt=2.5*lt;if(R){const Jr=this.projectPathToScreenSpace(ar,We);ar=Jr.some(Ti=>Ti.signedDistanceFromCamera<=0)?[]:Jr.map(Ti=>Ti.point)}let xr=[];if(ar.length>0){const Jr=ar[0].clone(),Ti=ar[0].clone();for(let qi=1;qi<ar.length;qi++)Jr.x=Math.min(Jr.x,ar[qi].x),Jr.y=Math.min(Jr.y,ar[qi].y),Ti.x=Math.max(Ti.x,ar[qi].x),Ti.y=Math.max(Ti.y,ar[qi].y);xr=Jr.x>=Tt.x&&Ti.x<=bt.x&&Jr.y>=Tt.y&&Ti.y<=bt.y?[ar]:Ti.x<Tt.x||Jr.x>bt.x||Ti.y<Tt.y||Jr.y>bt.y?[]:a.aK([ar],Tt.x,Tt.y,bt.x,bt.y)}for(const Jr of xr){Pt.reset(Jr,.25*lt);let Ti=0;Ti=Pt.length<=.5*lt?1:Math.ceil(Pt.paddedLength/Yt)+1;for(let qi=0;qi<Ti;qi++){const Li=qi/Math.max(Ti-1,1),en=Pt.lerp(Li),Vi=en.x+ji,$n=en.y+ji;ve.push(Vi,$n,lt,0);const Hi=Vi-lt,Rn=$n-lt,xn=Vi+lt,wn=$n+lt;if(Ve=Ve&&this.isOffscreen(Hi,Rn,xn,wn),et=et||this.isInsideGrid(Hi,Rn,xn,wn),t!=="always"&&this.grid.hitTestCircle(Vi,$n,lt,t,B)&&(Je=!0,!M))return{circles:[],offscreen:!1,collisionDetected:Je}}}}return{circles:!M&&Je||!et||be<this.perspectiveRatioCutoff?[]:ve,offscreen:Ve,collisionDetected:Je}}projectPathToScreenSpace(t,n){const l=function(h,_){const w=a.N();return a.aC(w,_.pitchedLabelPlaneMatrix),h.map(P=>{const M=Gr(P.x,P.y,w,_.getElevation),R=_.transform.projectTileCoordinates(M.point.x,M.point.y,_.unwrappedTileID,_.getElevation);return R.point.x=(.5*R.point.x+.5)*_.width,R.point.y=(.5*-R.point.y+.5)*_.height,R})}(t,n);return function(h){let _=0,w=0,P=0,M=0;for(let R=0;R<h.length;R++)h[R].isOccluded?(P=R+1,M=0):(M++,M>w&&(w=M,_=P));return h.slice(_,_+w)}(l)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[],l=new a.ac;for(const $ of t){const G=new a.P($.x+ji,$.y+ji);l.extend(G),n.push(G)}const{minX:h,minY:_,maxX:w,maxY:P}=l,M=this.grid.query(h,_,w,P).concat(this.ignoredGrid.query(h,_,w,P)),R={},B={};for(const $ of M){const G=$.key;if(R[G.bucketInstanceId]===void 0&&(R[G.bucketInstanceId]={}),R[G.bucketInstanceId][G.featureIndex])continue;const X=[new a.P($.x1,$.y1),new a.P($.x2,$.y1),new a.P($.x2,$.y2),new a.P($.x1,$.y2)];a.aL(n,X)&&(R[G.bucketInstanceId][G.featureIndex]=!0,B[G.bucketInstanceId]===void 0&&(B[G.bucketInstanceId]=[]),B[G.bucketInstanceId].push(G.featureIndex))}return B}insertCollisionBox(t,n,l,h,_,w){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:_,collisionGroupID:w,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,l,h,_,w){const P=l?this.ignoredGrid:this.grid,M={bucketInstanceId:h,featureIndex:_,collisionGroupID:w,overlapMode:n};for(let R=0;R<t.length;R+=4)P.insertCircle(M,t[R],t[R+1],t[R+2])}projectAndGetPerspectiveRatio(t,n,l,h,_){if(_){let w;h?(w=[t,n,h(t,n),1],a.aI(w,w,_)):(w=[t,n,0,1],Ji(w,w,_));const P=w[3];return{x:(w[0]/P+1)/2*this.transform.width+ji,y:(-w[1]/P+1)/2*this.transform.height+ji,perspectiveRatio:.5+this.transform.cameraToCenterDistance/P*.5,isOccluded:!1,signedDistanceFromCamera:P}}{const w=this.transform.projectTileCoordinates(t,n,l,h);return{x:(w.point.x+1)/2*this.transform.width+ji,y:(1-w.point.y)/2*this.transform.height+ji,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5,isOccluded:w.isOccluded,signedDistanceFromCamera:w.signedDistanceFromCamera}}}getPerspectiveRatio(t,n,l,h){const _=this.transform.projectTileCoordinates(t,n,l,h);return .5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5}isOffscreen(t,n,l,h){return l<ji||t>=this.screenRightBoundary||h<ji||n>this.screenBottomBoundary}isInsideGrid(t,n,l,h){return l>=0&&t<this.gridRightBoundary&&h>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=a.as([]);return a.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,n,l,h,_,w,P,M,R,B,$){let G=1,X=0,oe=0,ve=1;const Se=t.anchorPointX+P[0],be=t.anchorPointY+P[1];if(w&&!_){const ar=this.projectAndGetPerspectiveRatio(Se+1,be,h,R,$),Yt=ar.x-M.x,xr=Math.atan((ar.y-M.y)/Yt)+(Yt<0?Math.PI:0),Jr=Math.sin(xr),Ti=Math.cos(xr);G=Ti,X=Jr,oe=-Jr,ve=Ti}else if(!w&&_){const ar=Mn(this.transform);G=ar.vecEast[0],X=ar.vecEast[1],oe=ar.vecSouth[0],ve=ar.vecSouth[1]}let Ae=M.x,We=M.y,Le=n;_&&(Ae=Se,We=be,Le=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),Le*=this.transform.getPitchedTextCorrection(Se,be,h),B||(Le*=a.ao(.5+M.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),B&&(Ae+=G*B.x*Le+oe*B.y*Le,We+=X*B.x*Le+ve*B.y*Le);const Je=t.x1*Le,et=t.x2*Le,Ve=(Je+et)/2,lt=t.y1*Le,Tt=t.y2*Le,bt=(lt+Tt)/2,Pt=[{offsetX:Je,offsetY:lt},{offsetX:Ve,offsetY:lt},{offsetX:et,offsetY:lt},{offsetX:et,offsetY:bt},{offsetX:et,offsetY:Tt},{offsetX:Ve,offsetY:Tt},{offsetX:Je,offsetY:Tt},{offsetX:Je,offsetY:bt}];let Ct=[];for(const{offsetX:ar,offsetY:Yt}of Pt)Ct.push(new a.P(Ae+G*ar+oe*Yt,We+X*ar+ve*Yt));let Jt=!1;if(_){const ar=Ct.map(Yt=>this.projectAndGetPerspectiveRatio(Yt.x,Yt.y,h,R,$));Jt=ar.some(Yt=>!Yt.isOccluded),Ct=ar.map(Yt=>new a.P(Yt.x,Yt.y))}else Jt=!0;return{box:a.aM(Ct),allPointsOccluded:!Jt}}}class wa{constructor(t,n,l,h){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):h&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class na{constructor(t,n,l,h,_){this.text=new wa(t?t.text:null,n,l,_),this.icon=new wa(t?t.icon:null,n,h,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class js{constructor(t,n,l){this.text=t,this.icon=n,this.skipFade=l}}class no{constructor(t,n,l,h,_){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=_}}class sn{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:l=>l.collisionGroupID===n}}return this.collisionGroups[t]}}function so(g,t,n,l,h){const{horizontalAlign:_,verticalAlign:w}=a.aT(g);return new a.P(-(_-.5)*t+l[0]*h,-(w-.5)*n+l[1]*h)}class Bl{constructor(t,n,l,h,_){this.transform=t.clone(),this.terrain=n,this.collisionIndex=new Ol(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new sn(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const n=this.terrain;return n?(l,h)=>n.getElevation(t,l,h):null}getBucketParts(t,n,l,h){const _=l.getBucket(n),w=l.latestFeatureIndex;if(!_||!w||n.id!==_.layerIds[0])return;const P=l.collisionBoxArray,M=_.layers[0].layout,R=_.layers[0].paint,B=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),$=l.tileSize/a.a5,G=l.tileID.toUnwrapped(),X=M.get("text-rotation-alignment")==="map",oe=a.aO(l,1,this.transform.zoom),ve=a.aP(this.collisionIndex.transform,l,R.get("text-translate"),R.get("text-translate-anchor")),Se=a.aP(this.collisionIndex.transform,l,R.get("icon-translate"),R.get("icon-translate-anchor")),be=Oi(X,this.transform,oe);this.retainedQueryData[_.bucketInstanceId]=new no(_.bucketInstanceId,w,_.sourceLayerIndex,_.index,l.tileID);const Ae={bucket:_,layout:M,translationText:ve,translationIcon:Se,unwrappedTileID:G,pitchedLabelPlaneMatrix:be,scale:B,textPixelRatio:$,holdingForFade:l.holdingForSymbolFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:a.az(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(h)for(const We of _.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:Je,symbolInstanceEnd:et}=We;t.push({sortKey:Le,symbolInstanceStart:Je,symbolInstanceEnd:et,parameters:Ae})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:Ae})}attemptAnchorPlacement(t,n,l,h,_,w,P,M,R,B,$,G,X,oe,ve,Se,be,Ae,We,Le){const Je=a.aQ[t.textAnchor],et=[t.textOffset0,t.textOffset1],Ve=so(Je,l,h,et,_),lt=this.collisionIndex.placeCollisionBox(n,G,M,R,B,P,w,Se,$.predicate,We,Ve,Le);if((!Ae||this.collisionIndex.placeCollisionBox(Ae,G,M,R,B,P,w,be,$.predicate,We,Ve,Le).placeable)&&lt.placeable){let Tt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID].text&&(Tt=this.prevPlacement.variableOffsets[X.crossTileID].anchor),X.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[X.crossTileID]={textOffset:et,width:l,height:h,anchor:Je,textBoxScale:_,prevAnchor:Tt},this.markUsedJustification(oe,Je,X,ve),oe.allowVerticalPlacement&&(this.markUsedOrientation(oe,ve,X),this.placedOrientations[X.crossTileID]=ve),{shift:Ve,placedGlyphBoxes:lt}}}placeLayerBucketPart(t,n,l){const{bucket:h,layout:_,translationText:w,translationIcon:P,unwrappedTileID:M,pitchedLabelPlaneMatrix:R,textPixelRatio:B,holdingForFade:$,collisionBoxArray:G,partiallyEvaluatedTextSize:X,collisionGroup:oe}=t.parameters,ve=_.get("text-optional"),Se=_.get("icon-optional"),be=a.aR(_,"text-overlap","text-allow-overlap"),Ae=be==="always",We=a.aR(_,"icon-overlap","icon-allow-overlap"),Le=We==="always",Je=_.get("text-rotation-alignment")==="map",et=_.get("text-pitch-alignment")==="map",Ve=_.get("icon-text-fit")!=="none",lt=_.get("symbol-z-order")==="viewport-y",Tt=Ae&&(Le||!h.hasIconData()||Se),bt=Le&&(Ae||!h.hasTextData()||ve);!h.collisionArrays&&G&&h.deserializeCollisionBoxes(G);const Pt=this.retainedQueryData[h.bucketInstanceId].tileID,Ct=this._getTerrainElevationFunc(Pt),Jt=this.transform.getFastPathSimpleProjectionMatrix(Pt),ar=(Yt,xr,Jr)=>{var Ti,qi;if(n[Yt.crossTileID])return;if($)return void(this.placements[Yt.crossTileID]=new js(!1,!1,!1));let Li=!1,en=!1,Vi=!0,$n=null,Hi={box:null,placeable:!1,offscreen:null,occluded:!1},Rn={placeable:!1},xn=null,wn=null,ps=null,Ns=0,Io=0,Cl=0;xr.textFeatureIndex?Ns=xr.textFeatureIndex:Yt.useRuntimeCollisionCircles&&(Ns=Yt.featureIndex),xr.verticalTextFeatureIndex&&(Io=xr.verticalTextFeatureIndex);const lc=xr.textBox;if(lc){const es=zn=>{let Zn=a.aA.horizontal;if(h.allowVerticalPlacement&&!zn&&this.prevPlacement){const pa=this.prevPlacement.placedOrientations[Yt.crossTileID];pa&&(this.placedOrientations[Yt.crossTileID]=pa,Zn=pa,this.markUsedOrientation(h,Zn,Yt))}return Zn},ws=(zn,Zn)=>{if(h.allowVerticalPlacement&&Yt.numVerticalGlyphVertices>0&&xr.verticalTextBox){for(const pa of h.writingModes)if(pa===a.aA.vertical?(Hi=Zn(),Rn=Hi):Hi=zn(),Hi&&Hi.placeable)break}else Hi=zn()},ms=Yt.textAnchorOffsetStartIndex,Ca=Yt.textAnchorOffsetEndIndex;if(Ca===ms){const zn=(Zn,pa)=>{const cn=this.collisionIndex.placeCollisionBox(Zn,be,B,Pt,M,et,Je,w,oe.predicate,Ct,void 0,Jt);return cn&&cn.placeable&&(this.markUsedOrientation(h,pa,Yt),this.placedOrientations[Yt.crossTileID]=pa),cn};ws(()=>zn(lc,a.aA.horizontal),()=>{const Zn=xr.verticalTextBox;return h.allowVerticalPlacement&&Yt.numVerticalGlyphVertices>0&&Zn?zn(Zn,a.aA.vertical):{box:null,offscreen:null}}),es(Hi&&Hi.placeable)}else{let zn=a.aQ[(qi=(Ti=this.prevPlacement)===null||Ti===void 0?void 0:Ti.variableOffsets[Yt.crossTileID])===null||qi===void 0?void 0:qi.anchor];const Zn=(cn,rf,Jh)=>{const ph=cn.x2-cn.x1,Kh=cn.y2-cn.y1,cc=Yt.textBoxScale,uc=Ve&&We==="never"?rf:null;let kl=null,Qh=be==="never"?1:2,Fu="never";zn&&Qh++;for(let mh=0;mh<Qh;mh++){for(let Fc=ms;Fc<Ca;Fc++){const gh=h.textAnchorOffsets.get(Fc);if(zn&&gh.textAnchor!==zn)continue;const _h=this.attemptAnchorPlacement(gh,cn,ph,Kh,cc,Je,et,B,Pt,M,oe,Fu,Yt,h,Jh,w,P,uc,Ct);if(_h&&(kl=_h.placedGlyphBoxes,kl&&kl.placeable))return Li=!0,$n=_h.shift,kl}zn?zn=null:Fu=be}return l&&!kl&&(kl={box:this.collisionIndex.placeCollisionBox(lc,"always",B,Pt,M,et,Je,w,oe.predicate,Ct,void 0,Jt).box,offscreen:!1,placeable:!1,occluded:!1}),kl};ws(()=>Zn(lc,xr.iconBox,a.aA.horizontal),()=>{const cn=xr.verticalTextBox;return h.allowVerticalPlacement&&(!Hi||!Hi.placeable)&&Yt.numVerticalGlyphVertices>0&&cn?Zn(cn,xr.verticalIconBox,a.aA.vertical):{box:null,occluded:!0,offscreen:null}}),Hi&&(Li=Hi.placeable,Vi=Hi.offscreen);const pa=es(Hi&&Hi.placeable);if(!Li&&this.prevPlacement){const cn=this.prevPlacement.variableOffsets[Yt.crossTileID];cn&&(this.variableOffsets[Yt.crossTileID]=cn,this.markUsedJustification(h,cn.anchor,Yt,pa))}}}if(xn=Hi,Li=xn&&xn.placeable,Vi=xn&&xn.offscreen,Yt.useRuntimeCollisionCircles&&Yt.centerJustifiedTextSymbolIndex>=0){const es=h.text.placedSymbolArray.get(Yt.centerJustifiedTextSymbolIndex),ws=a.aB(h.textSizeData,X,es),ms=_.get("text-padding");wn=this.collisionIndex.placeCollisionCircles(be,es,h.lineVertexArray,h.glyphOffsetArray,ws,M,R,l,et,oe.predicate,Yt.collisionCircleDiameter,ms,w,Ct),wn.circles.length&&wn.collisionDetected&&!l&&a.w("Collisions detected, but collision boxes are not shown"),Li=Ae||wn.circles.length>0&&!wn.collisionDetected,Vi=Vi&&wn.offscreen}if(xr.iconFeatureIndex&&(Cl=xr.iconFeatureIndex),xr.iconBox){const es=ws=>this.collisionIndex.placeCollisionBox(ws,We,B,Pt,M,et,Je,P,oe.predicate,Ct,Ve&&$n?$n:void 0,Jt);Rn&&Rn.placeable&&xr.verticalIconBox?(ps=es(xr.verticalIconBox),en=ps.placeable):(ps=es(xr.iconBox),en=ps.placeable),Vi=Vi&&ps.offscreen}const Du=ve||Yt.numHorizontalGlyphVertices===0&&Yt.numVerticalGlyphVertices===0,Dc=Se||Yt.numIconVertices===0;Du||Dc?Dc?Du||(en=en&&Li):Li=en&&Li:en=Li=en&&Li;const Eo=en&&ps.placeable;if(Li&&xn.placeable&&this.collisionIndex.insertCollisionBox(xn.box,be,_.get("text-ignore-placement"),h.bucketInstanceId,Rn&&Rn.placeable&&Io?Io:Ns,oe.ID),Eo&&this.collisionIndex.insertCollisionBox(ps.box,We,_.get("icon-ignore-placement"),h.bucketInstanceId,Cl,oe.ID),wn&&Li&&this.collisionIndex.insertCollisionCircles(wn.circles,be,_.get("text-ignore-placement"),h.bucketInstanceId,Ns,oe.ID),l&&this.storeCollisionData(h.bucketInstanceId,Jr,xr,xn,ps,wn),Yt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Yt.crossTileID]=new js((Li||Tt)&&!xn?.occluded,(en||bt)&&!ps?.occluded,Vi||h.justReloaded),n[Yt.crossTileID]=!0};if(lt){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Yt=h.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let xr=Yt.length-1;xr>=0;--xr){const Jr=Yt[xr];ar(h.symbolInstances.get(Jr),h.collisionArrays[Jr],Jr)}}else for(let Yt=t.symbolInstanceStart;Yt<t.symbolInstanceEnd;Yt++)ar(h.symbolInstances.get(Yt),h.collisionArrays[Yt],Yt);h.justReloaded=!1}storeCollisionData(t,n,l,h,_,w){if(l.textBox||l.iconBox){let P,M;this.collisionBoxArrays.has(t)?P=this.collisionBoxArrays.get(t):(P=new Map,this.collisionBoxArrays.set(t,P)),P.has(n)?M=P.get(n):(M={text:null,icon:null},P.set(n,M)),l.textBox&&(M.text=h.box),l.iconBox&&(M.icon=_.box)}if(w){let P=this.collisionCircleArrays[t];P===void 0&&(P=this.collisionCircleArrays[t]=[]);for(let M=0;M<w.circles.length;M+=4)P.push(w.circles[M+0]-ji),P.push(w.circles[M+1]-ji),P.push(w.circles[M+2]),P.push(w.collisionDetected?1:0)}}markUsedJustification(t,n,l,h){let _;_=h===a.aA.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[a.aS(n)];const w=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const P of w)P>=0&&(t.text.placedSymbolArray.get(P).crossTileID=_>=0&&P!==_?0:l.crossTileID)}markUsedOrientation(t,n,l){const h=n===a.aA.horizontal||n===a.aA.horizontalOnly?n:0,_=n===a.aA.vertical?n:0,w=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const P of w)t.text.placedSymbolArray.get(P).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let l=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const h=n?n.symbolFadeChange(t):1,_=n?n.opacities:{},w=n?n.variableOffsets:{},P=n?n.placedOrientations:{};for(const M in this.placements){const R=this.placements[M],B=_[M];B?(this.opacities[M]=new na(B,h,R.text,R.icon),l=l||R.text!==B.text.placed||R.icon!==B.icon.placed):(this.opacities[M]=new na(null,h,R.text,R.icon,R.skipFade),l=l||R.text||R.icon)}for(const M in _){const R=_[M];if(!this.opacities[M]){const B=new na(R,h,!1,!1);B.isHidden()||(this.opacities[M]=B,l=l||R.text.placed||R.icon.placed)}}for(const M in w)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=w[M]);for(const M in P)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=P[M]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const l={};for(const h of n){const _=h.getBucket(t);_&&h.latestFeatureIndex&&t.id===_.layerIds[0]&&this.updateBucketOpacities(_,h.tileID,l,h.collisionBoxArray)}}updateBucketOpacities(t,n,l,h){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const _=t.layers[0],w=_.layout,P=new na(null,0,!1,!1,!0),M=w.get("text-allow-overlap"),R=w.get("icon-allow-overlap"),B=_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$=w.get("text-rotation-alignment")==="map",G=w.get("text-pitch-alignment")==="map",X=w.get("icon-text-fit")!=="none",oe=new na(null,0,M&&(R||!t.hasIconData()||w.get("icon-optional")),R&&(M||!t.hasTextData()||w.get("text-optional")),!0);!t.collisionArrays&&h&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(h);const ve=(be,Ae,We)=>{for(let Le=0;Le<Ae/4;Le++)be.opacityVertexArray.emplaceBack(We);be.hasVisibleVertices=be.hasVisibleVertices||We!==Fo},Se=this.collisionBoxArrays.get(t.bucketInstanceId);for(let be=0;be<t.symbolInstances.length;be++){const Ae=t.symbolInstances.get(be),{numHorizontalGlyphVertices:We,numVerticalGlyphVertices:Le,crossTileID:Je}=Ae;let et=this.opacities[Je];l[Je]?et=P:et||(et=oe,this.opacities[Je]=et),l[Je]=!0;const Ve=Ae.numIconVertices>0,lt=this.placedOrientations[Ae.crossTileID],Tt=lt===a.aA.vertical,bt=lt===a.aA.horizontal||lt===a.aA.horizontalOnly;if(We>0||Le>0){const Ct=Vl(et.text);ve(t.text,We,Tt?Fo:Ct),ve(t.text,Le,bt?Fo:Ct);const Jt=et.text.isHidden();[Ae.rightJustifiedTextSymbolIndex,Ae.centerJustifiedTextSymbolIndex,Ae.leftJustifiedTextSymbolIndex].forEach(xr=>{xr>=0&&(t.text.placedSymbolArray.get(xr).hidden=Jt||Tt?1:0)}),Ae.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(Ae.verticalPlacedTextSymbolIndex).hidden=Jt||bt?1:0);const ar=this.variableOffsets[Ae.crossTileID];ar&&this.markUsedJustification(t,ar.anchor,Ae,lt);const Yt=this.placedOrientations[Ae.crossTileID];Yt&&(this.markUsedJustification(t,"left",Ae,Yt),this.markUsedOrientation(t,Yt,Ae))}if(Ve){const Ct=Vl(et.icon),Jt=!(X&&Ae.verticalPlacedIconSymbolIndex&&Tt);Ae.placedIconSymbolIndex>=0&&(ve(t.icon,Ae.numIconVertices,Jt?Ct:Fo),t.icon.placedSymbolArray.get(Ae.placedIconSymbolIndex).hidden=et.icon.isHidden()),Ae.verticalPlacedIconSymbolIndex>=0&&(ve(t.icon,Ae.numVerticalIconVertices,Jt?Fo:Ct),t.icon.placedSymbolArray.get(Ae.verticalPlacedIconSymbolIndex).hidden=et.icon.isHidden())}const Pt=Se&&Se.has(be)?Se.get(be):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ct=t.collisionArrays[be];if(Ct){let Jt=new a.P(0,0);if(Ct.textBox||Ct.verticalTextBox){let ar=!0;if(B){const Yt=this.variableOffsets[Je];Yt?(Jt=so(Yt.anchor,Yt.width,Yt.height,Yt.textOffset,Yt.textBoxScale),$&&Jt._rotate(G?-this.transform.bearingInRadians:this.transform.bearingInRadians)):ar=!1}if(Ct.textBox||Ct.verticalTextBox){let Yt;Ct.textBox&&(Yt=Tt),Ct.verticalTextBox&&(Yt=bt),jl(t.textCollisionBox.collisionVertexArray,et.text.placed,!ar||Yt,Pt.text,Jt.x,Jt.y)}}if(Ct.iconBox||Ct.verticalIconBox){const ar=!!(!bt&&Ct.verticalIconBox);let Yt;Ct.iconBox&&(Yt=ar),Ct.verticalIconBox&&(Yt=!ar),jl(t.iconCollisionBox.collisionVertexArray,et.icon.placed,Yt,Pt.icon,X?Jt.x:0,X?Jt.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const l=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function jl(g,t,n,l,h,_){l&&l.length!==0||(l=[0,0,0,0]);const w=l[0]-ji,P=l[1]-ji,M=l[2]-ji,R=l[3]-ji;g.emplaceBack(t?1:0,n?1:0,h||0,_||0,w,P),g.emplaceBack(t?1:0,n?1:0,h||0,_||0,M,P),g.emplaceBack(t?1:0,n?1:0,h||0,_||0,M,R),g.emplaceBack(t?1:0,n?1:0,h||0,_||0,w,R)}const Ul=Math.pow(2,25),Us=Math.pow(2,24),vc=Math.pow(2,17),ao=Math.pow(2,16),sa=Math.pow(2,9),pl=Math.pow(2,8),oo=Math.pow(2,1);function Vl(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const t=g.placed?1:0,n=Math.floor(127*g.opacity);return n*Ul+t*Us+n*vc+t*ao+n*sa+t*pl+n*oo+t}const Fo=0;class Vs{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,l,h,_){const w=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(w,h,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((P,M)=>P.sortKey-M.sortKey));this._currentPartIndex<w.length;)if(n.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,_())return!0;return!1}}class qs{constructor(t,n,l,h,_,w,P,M){this.placement=new Bl(t,n,w,P,M),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,n,l){const h=ce(),_=()=>!this._forceFullPlacement&&ce()-h>2;for(;this._currentPlacementIndex>=0;){const w=n[t[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=P)&&(!w.maxzoom||w.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new Vs(w)),this._inProgressLayer.continuePlacement(l[w.source],this.placement,this._showCollisionBoxes,w,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Wr=512/a.a5/2;class ql{constructor(t,n,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const h=new Map;for(let _=0;_<n.length;_++){const w=n.get(_),P=w.key,M=h.get(P);M?M.push(w):h.set(P,[w])}for(const[_,w]of h){const P={positions:w.map(M=>({x:Math.floor(M.anchorX*Wr),y:Math.floor(M.anchorY*Wr)})),crossTileIDs:w.map(M=>M.crossTileID)};if(P.positions.length>128){const M=new a.aU(P.positions.length,16,Uint16Array);for(const{x:R,y:B}of P.positions)M.add(R,B);M.finish(),delete P.positions,P.index=M}this._symbolsByKey[_]=P}}getScaledCoordinates(t,n){const{x:l,y:h,z:_}=this.tileID.canonical,{x:w,y:P,z:M}=n.canonical,R=Wr/Math.pow(2,M-_),B=(P*a.a5+t.anchorY)*R,$=h*a.a5*Wr;return{x:Math.floor((w*a.a5+t.anchorX)*R-l*a.a5*Wr),y:Math.floor(B-$)}}findMatches(t,n,l){const h=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let _=0;_<t.length;_++){const w=t.get(_);if(w.crossTileID)continue;const P=this._symbolsByKey[w.key];if(!P)continue;const M=this.getScaledCoordinates(w,n);if(P.index){const R=P.index.range(M.x-h,M.y-h,M.x+h,M.y+h).sort();for(const B of R){const $=P.crossTileIDs[B];if(!l[$]){l[$]=!0,w.crossTileID=$;break}}}else if(P.positions)for(let R=0;R<P.positions.length;R++){const B=P.positions[R],$=P.crossTileIDs[R];if(Math.abs(B.x-M.x)<=h&&Math.abs(B.y-M.y)<=h&&!l[$]){l[$]=!0,w.crossTileID=$;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Ro{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class zo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const l in this.indexes){const h=this.indexes[l],_={};for(const w in h){const P=h[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+n),_[P.tileID.key]=P}this.indexes[l]=_}this.lng=t}addBucket(t,n,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<n.symbolInstances.length;_++)n.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const h=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const w=this.indexes[_];if(Number(_)>t.overscaledZ)for(const P in w){const M=w[P];M.tileID.isChildOf(t)&&M.findMatches(n.symbolInstances,t,h)}else{const P=w[t.scaledTo(Number(_)).key];P&&P.findMatches(n.symbolInstances,t,h)}}for(let _=0;_<n.symbolInstances.length;_++){const w=n.symbolInstances.get(_);w.crossTileID||(w.crossTileID=l.generate(),h[w.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ql(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const l of n.getCrossTileIDsLists())for(const h of l)delete this.usedCrossTileIDs[t][h]}removeStaleBuckets(t){let n=!1;for(const l in this.indexes){const h=this.indexes[l];for(const _ in h)t[h[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[_]),delete h[_],n=!0)}return n}}class zr{constructor(){this.layerIndexes={},this.crossTileIDs=new Ro,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,l){let h=this.layerIndexes[t.id];h===void 0&&(h=this.layerIndexes[t.id]=new zo);let _=!1;const w={};h.handleWrapJump(l);for(const P of n){const M=P.getBucket(t);M&&t.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(P.tileID,M,this.crossTileIDs)&&(_=!0),w[M.bucketInstanceId]=!0)}return h.removeStaleBuckets(w)&&(_=!0),_}pruneUnusedLayers(t){const n={};t.forEach(l=>{n[l]=!0});for(const l in this.layerIndexes)n[l]||delete this.layerIndexes[l]}}var Cn="void main() {fragColor=vec4(1.0);}";const Ui={prelude:jr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:jr("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:jr("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:jr(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:jr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:jr(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:jr(Cn,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:jr(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:jr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:jr("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:jr("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:jr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:jr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:jr(Cn,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:jr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:jr(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:jr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:jr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:jr(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:jr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:jr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:jr(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:jr(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:jr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:jr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:jr(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:jr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:jr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:jr(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:jr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:jr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:jr("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:jr("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:jr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:jr("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:jr(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:jr("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function jr(g,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/in ([\w]+) ([\w]+)/g),h=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=_?_.concat(h):h,P={};return{fragmentSource:g=g.replace(n,(M,R,B,$,G)=>(P[G]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${G}
in ${B} ${$} ${G};
#else
uniform ${B} ${$} u_${G};
#endif
`:`
#ifdef HAS_UNIFORM_u_${G}
    ${B} ${$} ${G} = u_${G};
#endif
`)),vertexSource:t=t.replace(n,(M,R,B,$,G)=>{const X=$==="float"?"vec2":"vec4",oe=G.match(/color/)?"color":X;return P[G]?R==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${B} ${X} a_${G};
out ${B} ${$} ${G};
#else
uniform ${B} ${$} u_${G};
#endif
`:oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = a_${G};
#else
    ${B} ${$} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = unpack_mix_${oe}(a_${G}, u_${G}_t);
#else
    ${B} ${$} ${G} = u_${G};
#endif
`:R==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${B} ${X} a_${G};
#else
uniform ${B} ${$} u_${G};
#endif
`:oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${B} ${$} ${G} = a_${G};
#else
    ${B} ${$} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${B} ${$} ${G} = unpack_mix_${oe}(a_${G}, u_${G}_t);
#else
    ${B} ${$} ${G} = u_${G};
#endif
`}),staticAttributes:l,staticUniforms:w}}class wi{constructor(t,n,l){this.vertexBuffer=t,this.indexBuffer=n,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Yn=a.aV([{name:"a_pos",type:"Int16",components:2}]);const Ki="#define PROJECTION_MERCATOR",as="mercator";class jn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return as}get shaderDefine(){return Ki}get shaderPreludeCode(){return Ui.projectionMercator}get vertexShaderPreludeCode(){return Ui.projectionMercator.vertexSource}get subdivisionGranularity(){return a.aW.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,n,l,h,_){if(this._cachedMesh)return this._cachedMesh;const w=new a.aX;w.emplaceBack(0,0),w.emplaceBack(a.a5,0),w.emplaceBack(0,a.a5),w.emplaceBack(a.a5,a.a5);const P=t.createVertexBuffer(w,Yn.members),M=a.aY.simpleSegment(0,0,4,2),R=new a.aZ;R.emplaceBack(1,0,2),R.emplaceBack(1,2,3);const B=t.createIndexBuffer(R);return this._cachedMesh=new wi(P,B,M),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class aa{constructor(t=0,n=0,l=0,h=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=l,this.right=h}interpolate(t,n,l){return n.top!=null&&t.top!=null&&(this.top=a.G.number(t.top,n.top,l)),n.bottom!=null&&t.bottom!=null&&(this.bottom=a.G.number(t.bottom,n.bottom,l)),n.left!=null&&t.left!=null&&(this.left=a.G.number(t.left,n.left,l)),n.right!=null&&t.right!=null&&(this.right=a.G.number(t.right,n.right,l)),this}getCenter(t,n){const l=a.ao((this.left+t-this.right)/2,0,t),h=a.ao((this.top+n-this.bottom)/2,0,n);return new a.P(l,h)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new aa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Gs(g,t){if(!g.renderWorldCopies||g.lngRange)return;const n=t.lng-g.center.lng;t.lng+=n>180?-360:n<-180?360:0}function Mi(g){return Math.max(0,Math.floor(g))}class $s{constructor(t,n){var l;this.applyConstrain=(h,_)=>this._constrainOverride!==null?this._constrainOverride(h,_):this._callbacks.defaultConstrain(h,_),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=n?.renderWorldCopies===void 0||!!n?.renderWorldCopies,this._minZoom=n?.minZoom||0,this._maxZoom=n?.maxZoom||22,this._minPitch=n?.minPitch==null?0:n?.minPitch,this._maxPitch=n?.maxPitch==null?60:n?.maxPitch,this._constrainOverride=(l=n?.constrainOverride)!==null&&l!==void 0?l:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new a.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Mi(this._zoom),this._scale=a.ar(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new aa,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,n,l){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Mi(this._zoom),this._scale=a.ar(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new aa(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!l&&t.autoCalculateNearFarZ,n&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const n=a.W(t,-180,180)*Math.PI/180;var l,h,_,w,P,M,R,B,$;this._bearingInRadians!==n&&(this._unmodified=!1,this._bearingInRadians=n,this._calcMatrices(),this._rotationMatrix=F(),l=this._rotationMatrix,_=-this._bearingInRadians,w=(h=this._rotationMatrix)[0],P=h[1],M=h[2],R=h[3],B=Math.sin(_),$=Math.cos(_),l[0]=w*$+M*B,l[1]=P*$+R*B,l[2]=w*-B+M*$,l[3]=P*-B+R*$)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const n=a.ao(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==n&&(this._unmodified=!1,this._pitchInRadians=n,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const n=t/180*Math.PI;this._rollInRadians!==n&&(this._unmodified=!1,this._rollInRadians=n,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return a.a_(this._fovInRadians)}setFov(t){t=a.ao(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=a.aq(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const n=this.applyConstrain(this._center,t).zoom;this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this._tileZoom=Math.max(0,Math.floor(n)),this._scale=a.ar(n),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,n){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=n,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,l){this._unmodified=!1,this._edgeInsets.interpolate(t,n,l),this.constrainInternal(),this._calcMatrices()}resize(t,n,l=!0){this._width=t,this._height=n,l&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new wr([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-a.ap,a.ap])}getCameraQueryGeometry(t,n){if(n.length===1)return[n[0],t];{const{minX:l,minY:h,maxX:_,maxY:w}=a.ac.fromPoints(n).extend(t);return[new a.P(l,h),new a.P(_,h),new a.P(_,w),new a.P(l,w),new a.P(l,h)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:n,zoom:l}=this.applyConstrain(this.center,this.zoom);this.setCenter(n),this.setZoom(l),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=a.as(new Float64Array(16));a.Q(t,t,[this._width/2,-this._height/2,1]),a.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=a.as(new Float64Array(16)),a.Q(t,t,[1,-1,1]),a.O(t,t,[-1,-1,0]),a.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,n,l,h){const _=l!==void 0?l:this.bearing,w=h=h!==void 0?h:this.pitch,{distanceToCenter:P,clampedElevation:M}=this._distanceToCenterFromAltElevationPitch(n,this.elevation,w),{x:R,y:B}=ft(w,_),$=a.ab.fromLngLat(t,n);let G,X,oe=a.a$(1,$.y),ve=0;do{if(ve+=1,ve>10)break;X=P/oe,G=new a.ab($.x+R*X,$.y+B*X),oe=1/G.meterInMercatorCoordinateUnits()}while(Math.abs(P-X*oe)>1e-12);return{center:G.toLngLat(),elevation:M,zoom:a.au(this.height/2/Math.tan(this.fovInRadians/2)/X/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const n=1/this.worldSize,l=a.at(1,this.center.lat)*this.worldSize,h=a.ab.fromLngLat(this.center,this.elevation),_=h.x/n,w=h.y/n,P=h.z/n,M=this.pitch,R=this.bearing,{x:B,y:$,z:G}=ft(M,R),X=this.cameraToCenterDistance,oe=_+X*-B,ve=w+X*-$,Se=P+X*G,{distanceToCenter:be,clampedElevation:Ae}=this._distanceToCenterFromAltElevationPitch(Se/l,t,M),We=be*l,Le=new a.ab((oe+B*We)*n,(ve+$*We)*n,0).toLngLat(),Je=a.at(1,Le.lat),et=a.au(this.height/2/Math.tan(this.fovInRadians/2)/be/Je/this.tileSize);this._elevation=Ae,this._center=Le,this.setZoom(et)}_distanceToCenterFromAltElevationPitch(t,n,l){const h=-Math.cos(a.aq(l)),_=t-n;let w,P=n;return h*_>=0||Math.abs(h)<.1?(w=1e4,P=t+w*h):w=-_/h,{distanceToCenter:w,clampedElevation:P}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=a.at(1,this.center.lat)*this.worldSize;return ae(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const n=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/n,t.canonical.y/n,1/n/a.a5,1/n/a.a5]}}class os{constructor(t,n){this.min=t,this.max=n,this.center=a.b0([],a.b1([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],l=a.b2(this.min),h=a.b2(this.max);for(let _=0;_<n.length;_++)l[_]=n[_]?this.min[_]:this.center[_],h[_]=n[_]?this.center[_]:this.max[_];return h[2]=this.max[2],new os(l,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let n=!0;for(let l=0;l<t.planes.length;l++){const h=this.intersectsPlane(t.planes[l]);if(h===0)return 0;h===1&&(n=!1)}return n?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let n=t[3],l=t[3];for(let h=0;h<3;h++)t[h]>0?(n+=t[h]*this.min[h],l+=t[h]*this.max[h]):(l+=t[h]*this.min[h],n+=t[h]*this.max[h]);return n>=0?2:l<0?0:1}}class ml{distanceToTile2d(t,n,l,h){const _=h.distanceX([t,n]),w=h.distanceY([t,n]);return Math.hypot(_,w)}getWrap(t,n,l){return l}getTileBoundingVolume(t,n,l,h){var _,w;let P=0,M=0;if(h?.terrain){const B=new a.a2(t.z,n,t.z,t.x,t.y),$=h.terrain.getMinMaxElevation(B);P=(_=$.minElevation)!==null&&_!==void 0?_:Math.min(0,l),M=(w=$.maxElevation)!==null&&w!==void 0?w:Math.max(0,l)}const R=1<<t.z;return new os([n+t.x/R,t.y/R,P],[n+(t.x+1)/R,(t.y+1)/R,M])}allowVariableZoom(t,n){const l=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,h=a.ao(78.5-l/2,0,60);return!!n.terrain||t.pitch>h}allowWorldCopies(){return!0}prepareNextFrame(){}}class kn{constructor(t,n,l){this.points=t,this.planes=n,this.aabb=l}static fromInvProjectionMatrix(t,n=1,l=0,h,_){const w=_?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],P=Math.pow(2,l),M=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(G=>function(X,oe,ve,Se){const be=a.aI([],X,oe),Ae=1/be[3]/ve*Se;return a.b7(be,be,[Ae,Ae,1/be[3],Ae])}(G,t,n,P));h&&function(G,X,oe,ve){const Se=ve?4:0,be=ve?0:4;let Ae=0;const We=[],Le=[];for(let Ve=0;Ve<4;Ve++){const lt=a.b3([],G[Ve+be],G[Ve+Se]),Tt=a.b8(lt);a.b0(lt,lt,1/Tt),We.push(Tt),Le.push(lt)}for(let Ve=0;Ve<4;Ve++){const lt=a.b9(G[Ve+Se],Le[Ve],oe);Ae=lt!==null&&lt>=0?Math.max(Ae,lt):Math.max(Ae,We[Ve])}const Je=function(Ve,lt){const Tt=a.b3([],Ve[lt[0]],Ve[lt[1]]),bt=a.b3([],Ve[lt[2]],Ve[lt[1]]),Pt=[0,0,0,0];return a.b4(Pt,a.b5([],Tt,bt)),Pt[3]=-a.b6(Pt,Ve[lt[0]]),Pt}(G,X),et=function(Ve,lt){const Tt=a.ba(Ve),bt=a.bb([],Ve,1/Tt),Pt=a.b3([],lt,a.b0([],bt,a.b6(lt,bt))),Ct=a.ba(Pt);if(Ct>0){const Jt=Math.sqrt(1-bt[3]*bt[3]),ar=a.b0([],bt,-bt[3]),Yt=a.b1([],ar,a.b0([],Pt,Jt/Ct));return a.bc(lt,Yt)}return null}(oe,Je);if(et!==null){const Ve=et/a.b6(Le[0],Je);Ae=Math.min(Ae,Ve)}for(let Ve=0;Ve<4;Ve++){const lt=Math.min(Ae,We[Ve]);G[Ve+be]=[G[Ve+Se][0]+Le[Ve][0]*lt,G[Ve+Se][1]+Le[Ve][1]*lt,G[Ve+Se][2]+Le[Ve][2]*lt,1]}}(M,w[0],h,_);const R=w.map(G=>{const X=a.b3([],M[G[0]],M[G[1]]),oe=a.b3([],M[G[2]],M[G[1]]),ve=a.b4([],a.b5([],X,oe)),Se=-a.b6(ve,M[G[1]]);return ve.concat(Se)}),B=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],$=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const G of M)for(let X=0;X<3;X++)B[X]=Math.min(B[X],G[X]),$[X]=Math.max($[X],G[X]);return new kn(M,R,new os(B,$))}}class oa{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,n,l){return this._helper.interpolatePadding(t,n,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,n,l=!0){this._helper.resize(t,n,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,n){this._helper.overrideNearFarZ(t,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,n){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(n,l)=>{l=a.ao(+l,this.minZoom,this.maxZoom);const h={center:new a.V(n.lng,n.lat),zoom:l};let _=this._helper._lngRange;if(!this._helper._renderWorldCopies&&_===null){const Le=179.9999999999;_=[-Le,Le]}const w=this.tileSize*a.ar(h.zoom);let P=0,M=w,R=0,B=w,$=0,G=0;const{x:X,y:oe}=this.size;if(this._helper._latRange){const Le=this._helper._latRange;P=a.X(Le[1])*w,M=a.X(Le[0])*w,M-P<oe&&($=oe/(M-P))}_&&(R=a.W(a.Y(_[0])*w,0,w),B=a.W(a.Y(_[1])*w,0,w),B<R&&(B+=w),B-R<X&&(G=X/(B-R)));const{x:ve,y:Se}=D(w,n);let be,Ae;const We=Math.max(G||0,$||0);if(We){const Le=new a.P(G?(B+R)/2:ve,$?(M+P)/2:Se);return h.center=fe(w,Le).wrap(),h.zoom+=a.au(We),h}if(this._helper._latRange){const Le=oe/2;Se-Le<P&&(Ae=P+Le),Se+Le>M&&(Ae=M-Le)}if(_){const Le=(R+B)/2;let Je=ve;this._helper._renderWorldCopies&&(Je=a.W(ve,Le-w/2,Le+w/2));const et=X/2;Je-et<R&&(be=R+et),Je+et>B&&(be=B-et)}if(be!==void 0||Ae!==void 0){const Le=new a.P(be??ve,Ae??Se);h.center=fe(w,Le).wrap()}return h},this.applyConstrain=(n,l)=>this._helper.applyConstrain(n,l),this._helper=new $s({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(n,l)=>this.defaultConstrain(n,l)},t),this._coveringTilesDetailsProvider=new ml}clone(){const t=new oa;return t.apply(this),t}apply(t,n,l){this._helper.apply(t,n,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const n=[new a.bd(0,t)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new a.P(0,0)),h=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,0)),_=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,this._helper._height)),w=this.screenPointToMercatorCoordinate(new a.P(0,this._helper._height)),P=Math.floor(Math.min(l.x,h.x,_.x,w.x)),M=Math.floor(Math.max(l.x,h.x,_.x,w.x)),R=1;for(let B=P-R;B<=M+R;B++)B!==0&&n.push(new a.bd(B,t))}return n}getCameraFrustum(){return kn.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const n=this.screenPointToLocation(this.centerPoint,t),l=t?t.getElevationForLngLatZoom(n,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(t,n){const l=a.at(this.elevation,this.center.lat),h=this.screenPointToMercatorCoordinateAtZ(n,l),_=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),w=a.ab.fromLngLat(t),P=new a.ab(w.x-(h.x-_.x),w.y-(h.y-_.y));this.setCenter(P?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,n){return n?this.coordinatePoint(a.ab.fromLngLat(t),n.getElevationForLngLat(t),this._pixelMatrix3D):this.coordinatePoint(a.ab.fromLngLat(t))}screenPointToLocation(t,n){var l;return(l=this.screenPointToMercatorCoordinate(t,n))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(t,n){if(n){const l=n.pointCoordinate(t);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,n){const l=n||0,h=[t.x,t.y,0,1],_=[t.x,t.y,1,1];a.aI(h,h,this._pixelMatrixInverse),a.aI(_,_,this._pixelMatrixInverse);const w=h[3],P=_[3],M=h[1]/w,R=_[1]/P,B=h[2]/w,$=_[2]/P,G=B===$?0:(l-B)/($-B);return new a.ab(a.G.number(h[0]/w,_[0]/P,G)/this.worldSize,a.G.number(M,R,G)/this.worldSize,l)}coordinatePoint(t,n=0,l=this._pixelMatrix){const h=[t.x*this.worldSize,t.y*this.worldSize,n,1];return a.aI(h,h,l),new a.P(h[0]/h[3],h[1]/h[3])}getBounds(){const t=Math.max(0,this._helper._height/2-Ee(this));return new wr().extend(this.screenPointToLocation(new a.P(0,t))).extend(this.screenPointToLocation(new a.P(this._helper._width,t))).extend(this.screenPointToLocation(new a.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new a.P(0,this._helper._height)))}isPointOnMapSurface(t,n){return n?n.pointCoordinate(t)!=null:t.y>this.height/2-Ee(this)}calculatePosMatrix(t,n=!1,l){var h;const _=(h=t.key)!==null&&h!==void 0?h:a.be(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),w=n?this._alignedPosMatrixCache:this._posMatrixCache;if(w.has(_)){const R=w.get(_);return l?R.f32:R.f64}const P=qe(t,this.worldSize);a.S(P,n?this._alignedProjMatrix:this._viewProjMatrix,P);const M={f64:P,f32:new Float32Array(P)};return w.set(_,M),l?M.f32:M.f64}calculateFogMatrix(t){const n=t.key,l=this._fogMatrixCacheF32;if(l.has(n))return l.get(n);const h=qe(t,this.worldSize);return a.S(h,this._fogMatrix,h),l.set(n,new Float32Array(h)),l.get(n)}calculateCenterFromCameraLngLatAlt(t,n,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,n,l,h)}_calculateNearFarZIfNeeded(t,n,l){if(!this._helper.autoCalculateNearFarZ)return;const h=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),_=t-h*this._helper._pixelPerMeter/Math.cos(n),w=h<0?_:t,P=Math.PI/2+this.pitchInRadians,M=a.aq(this.fov)*(Math.abs(Math.cos(a.aq(this.roll)))*this.height+Math.abs(Math.sin(a.aq(this.roll)))*this.width)/this.height*(.5+l.y/this.height),R=Math.sin(M)*w/Math.sin(a.ao(Math.PI-P-M,.01,Math.PI-.01)),B=Ee(this),$=Math.atan(B/this._helper.cameraToCenterDistance),G=a.aq(.75),X=$>G?2*$*(.5+l.y/(2*B)):G,oe=Math.sin(X)*w/Math.sin(a.ao(Math.PI-P-X,.01,Math.PI-.01)),ve=Math.min(R,oe);this._helper._farZ=1.01*(Math.cos(Math.PI/2-n)*ve+w),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,n=D(this.worldSize,this.center),l=n.x,h=n.y;this._helper._pixelPerMeter=a.at(1,this.center.lat)*this.worldSize;const _=a.aq(Math.min(this.pitch,I)),w=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(_));let P;this._calculateNearFarZIfNeeded(w,_,t),P=new Float64Array(16),a.bf(P,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),a.aC(this._invProjMatrix,P),P[8]=2*-t.x/this._helper._width,P[9]=2*t.y/this._helper._height,this._projectionMatrix=a.bg(P),a.Q(P,P,[1,-1,1]),a.O(P,P,[0,0,-this._helper.cameraToCenterDistance]),a.bh(P,P,-this.rollInRadians),a.bi(P,P,this.pitchInRadians),a.bh(P,P,-this.bearingInRadians),a.O(P,P,[-l,-h,0]),this._mercatorMatrix=a.Q([],P,[this.worldSize,this.worldSize,this.worldSize]),a.Q(P,P,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=a.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,P),a.O(P,P,[0,0,-this.elevation]),this._viewProjMatrix=P,this._invViewProjMatrix=a.aC([],P);const M=[0,0,-1,1];a.aI(M,M,this._invViewProjMatrix),this._cameraPosition=[M[0]/M[3],M[1]/M[3],M[2]/M[3]],this._fogMatrix=new Float64Array(16),a.bf(this._fogMatrix,this.fovInRadians,this.width/this.height,w,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,a.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),a.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),a.bh(this._fogMatrix,this._fogMatrix,-this.rollInRadians),a.bi(this._fogMatrix,this._fogMatrix,this.pitchInRadians),a.bh(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),a.O(this._fogMatrix,this._fogMatrix,[-l,-h,0]),a.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),a.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=a.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,P);const R=this._helper._width%2/2,B=this._helper._height%2/2,$=Math.cos(this.bearingInRadians),G=Math.sin(-this.bearingInRadians),X=l-Math.round(l)+$*R+G*B,oe=h-Math.round(h)+$*B+G*R,ve=new Float64Array(P);if(a.O(ve,ve,[X>.5?X-1:X,oe>.5?oe-1:oe,0]),this._alignedProjMatrix=ve,P=a.aC(new Float64Array(16),this._pixelMatrix),!P)throw new Error("failed to invert matrix");this._pixelMatrixInverse=P,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new a.P(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return a.aI(n,n,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=a.at(1,this.center.lat)*this.worldSize;return ae(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,n){const l=a.ab.fromLngLat(t),h=[l.x*this.worldSize,l.y*this.worldSize,n,1];return a.aI(h,h,this._viewProjMatrix),h[2]/h[3]}getProjectionData(t){const{overscaledTileID:n,aligned:l,applyTerrainMatrix:h}=t,_=this._helper.getMercatorTileCoordinates(n),w=n?this.calculatePosMatrix(n,l,!0):null;let P;return P=n&&n.terrainRttPosMatrix32f&&h?n.terrainRttPosMatrix32f:w||a.bj(),{mainMatrix:P,tileMercatorCoords:_,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:P}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,n,l){return 1}transformLightDirection(t){return a.b2(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,n,l,h){const _=this.calculatePosMatrix(l);let w;h?(w=[t,n,h(t,n),1],a.aI(w,w,_)):(w=[t,n,0,1],Ji(w,w,_));const P=w[3];return{point:new a.P(w[0]/P,w[1]/P),signedDistanceFromCamera:P,isOccluded:!1}}populateCache(t){for(const n of t)this.calculatePosMatrix(n)}getMatrixForModel(t,n){const l=a.ab.fromLngLat(t,n),h=l.meterInMercatorCoordinateUnits(),_=a.bk();return a.O(_,_,[l.x,l.y,l.z]),a.bh(_,_,Math.PI),a.bi(_,_,Math.PI/2),a.Q(_,_,[-h,h,h]),_}getProjectionDataForCustomLayer(t=!0){const n=new a.a2(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:n,applyGlobeMatrix:t}),h=qe(n,this.worldSize);a.S(h,this._viewProjMatrix,h),l.tileMercatorCoords=[0,0,1,1];const _=[a.a5,a.a5,this.worldSize/this._helper.pixelsPerMeter],w=a.bl();return a.Q(w,h,_),l.fallbackMatrix=w,l.mainMatrix=w,l}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function ls(){a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function lo(g){if(g.useSlerp)if(g.k<1){const t=a.bm(g.startEulerAngles.roll,g.startEulerAngles.pitch,g.startEulerAngles.bearing),n=a.bm(g.endEulerAngles.roll,g.endEulerAngles.pitch,g.endEulerAngles.bearing),l=new Float64Array(4);a.bn(l,t,n,g.k);const h=a.bo(l);g.tr.setRoll(h.roll),g.tr.setPitch(h.pitch),g.tr.setBearing(h.bearing)}else g.tr.setRoll(g.endEulerAngles.roll),g.tr.setPitch(g.endEulerAngles.pitch),g.tr.setBearing(g.endEulerAngles.bearing);else g.tr.setRoll(a.G.number(g.startEulerAngles.roll,g.endEulerAngles.roll,g.k)),g.tr.setPitch(a.G.number(g.startEulerAngles.pitch,g.endEulerAngles.pitch,g.k)),g.tr.setBearing(a.G.number(g.startEulerAngles.bearing,g.endEulerAngles.bearing,g.k))}function No(g,t,n,l,h){const _=h.padding,w=D(h.worldSize,n.getNorthWest()),P=D(h.worldSize,n.getNorthEast()),M=D(h.worldSize,n.getSouthEast()),R=D(h.worldSize,n.getSouthWest()),B=a.aq(-l),$=w.rotate(B),G=P.rotate(B),X=M.rotate(B),oe=R.rotate(B),ve=new a.P(Math.max($.x,G.x,oe.x,X.x),Math.max($.y,G.y,oe.y,X.y)),Se=new a.P(Math.min($.x,G.x,oe.x,X.x),Math.min($.y,G.y,oe.y,X.y)),be=ve.sub(Se),Ae=(h.width-(_.left+_.right+t.left+t.right))/be.x,We=(h.height-(_.top+_.bottom+t.top+t.bottom))/be.y;if(We<0||Ae<0)return void ls();const Le=Math.min(a.au(h.scale*Math.min(Ae,We)),g.maxZoom),Je=a.P.convert(g.offset),et=new a.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(a.aq(l)),Ve=Je.add(et).mult(h.scale/a.ar(Le));return{center:fe(h.worldSize,w.add(M).div(2).sub(Ve)),zoom:Le,bearing:l}}class Zs{get useGlobeControls(){return!1}handlePanInertia(t,n){const l=t.mag(),h=Math.abs(Ee(n));return{easingOffset:t.mult(Math.min(.75*h/l,1)),easingCenter:n.center}}handleMapControlsRollPitchBearingZoom(t,n){t.bearingDelta&&n.setBearing(n.bearing+t.bearingDelta),t.pitchDelta&&n.setPitch(n.pitch+t.pitchDelta),t.rollDelta&&n.setRoll(n.roll+t.rollDelta),t.zoomDelta&&n.setZoom(n.zoom+t.zoomDelta)}handleMapControlsPan(t,n,l){t.around.distSqr(n.centerPoint)<.01||n.setLocationAtPoint(l,t.around)}cameraForBoxAndBearing(t,n,l,h,_){return No(t,n,l,h,_)}handleJumpToCenterZoom(t,n){t.zoom!==(n.zoom!==void 0?+n.zoom:t.zoom)&&t.setZoom(+n.zoom),n.center!==void 0&&t.setCenter(a.V.convert(n.center))}handleEaseTo(t,n){const l=t.zoom,h=t.padding,_={roll:t.roll,pitch:t.pitch,bearing:t.bearing},w={roll:n.roll===void 0?t.roll:n.roll,pitch:n.pitch===void 0?t.pitch:n.pitch,bearing:n.bearing===void 0?t.bearing:n.bearing},P=n.zoom!==void 0,M=!t.isPaddingEqual(n.padding);let R=!1;const B=P?+n.zoom:t.zoom;let $=t.centerPoint.add(n.offsetAsPoint);const G=t.screenPointToLocation($),{center:X,zoom:oe}=t.applyConstrain(a.V.convert(n.center||G),B??l);Gs(t,X);const ve=D(t.worldSize,G),Se=D(t.worldSize,X).sub(ve),be=a.ar(oe-l);return R=oe!==l,{easeFunc:Ae=>{if(R&&t.setZoom(a.G.number(l,oe,Ae)),a.bp(_,w)||lo({startEulerAngles:_,endEulerAngles:w,tr:t,k:Ae,useSlerp:_.roll!=w.roll}),M&&(t.interpolatePadding(h,n.padding,Ae),$=t.centerPoint.add(n.offsetAsPoint)),n.around)t.setLocationAtPoint(n.around,n.aroundPoint);else{const We=a.ar(t.zoom-l),Le=oe>l?Math.min(2,be):Math.max(.5,be),Je=Math.pow(Le,1-Ae),et=fe(t.worldSize,ve.add(Se.mult(Ae*Je)).mult(We));t.setLocationAtPoint(t.renderWorldCopies?et.wrap():et,$)}},isZooming:R,elevationCenter:X}}handleFlyTo(t,n){const l=n.zoom!==void 0,h=t.zoom,_=t.applyConstrain(a.V.convert(n.center||n.locationAtOffset),l?+n.zoom:h),w=_.center,P=_.zoom;Gs(t,w);const M=D(t.worldSize,n.locationAtOffset),R=D(t.worldSize,w).sub(M),B=R.mag(),$=a.ar(P-h);let G;if(n.minZoom!==void 0){const X=Math.min(+n.minZoom,h,P),oe=t.applyConstrain(w,X).zoom;G=a.ar(oe-h)}return{easeFunc:(X,oe,ve,Se)=>{t.setZoom(X===1?P:h+a.au(oe));const be=X===1?w:fe(t.worldSize,M.add(R.mult(ve)).mult(oe));t.setLocationAtPoint(t.renderWorldCopies?be.wrap():be,Se)},scaleOfZoom:$,targetCenter:w,scaleOfMinZoom:G,pixelPathLength:B}}}class vi{constructor(t,n,l){this.blendFunction=t,this.blendColor=n,this.mask=l}}vi.Replace=[1,0],vi.disabled=new vi(vi.Replace,a.bq.transparent,[!1,!1,!1,!1]),vi.unblended=new vi(vi.Replace,a.bq.transparent,[!0,!0,!0,!0]),vi.alphaBlended=new vi([1,771],a.bq.transparent,[!0,!0,!0,!0]);const Ws=2305;class ni{constructor(t,n,l){this.enable=t,this.mode=n,this.frontFace=l}}ni.disabled=new ni(!1,1029,Ws),ni.backCCW=new ni(!0,1029,Ws),ni.frontCCW=new ni(!0,1028,Ws);class Hr{constructor(t,n,l){this.func=t,this.mask=n,this.range=l}}Hr.ReadOnly=!1,Hr.ReadWrite=!0,Hr.disabled=new Hr(519,Hr.ReadOnly,[0,1]);const Dn=7680;class Kr{constructor(t,n,l,h,_,w){this.test=t,this.ref=n,this.mask=l,this.fail=h,this.depthFail=_,this.pass=w}}Kr.disabled=new Kr({func:519,mask:0},0,0,Dn,Dn,Dn);const z=new WeakMap;function ie(g){var t;if(z.has(g))return z.get(g);{const n=(t=g.getParameter(g.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return z.set(g,n),n}}class ze{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const n=t.context,l=n.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const h=new a.aX;h.emplaceBack(-1,-1),h.emplaceBack(2,-1),h.emplaceBack(-1,2);const _=new a.aZ;_.emplaceBack(0,1,2),this._fullscreenTriangle=new wi(n.createVertexBuffer(h,Yn.members),n.createIndexBuffer(_),a.aY.simpleSegment(0,0,h.length,_.length)),this._resultBuffer=new Uint8Array(4),n.activeTexture.set(l.TEXTURE1);const w=l.createTexture();l.bindTexture(l.TEXTURE_2D,w),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=n.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(w),ie(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,n){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,n),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,n=t.gl;t.activeTexture.set(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,n){const l=this._cachedRenderContext.context,h=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:a.bq.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,h.TRIANGLES,Hr.disabled,Kr.disabled,vi.unblended,ni.disabled,((_,w)=>({u_input:_,u_output_expected:w}))(t,n),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&ie(h)){h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.readBuffer(h.COLOR_ATTACHMENT0),h.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null);const _=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:_}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&ie(t)){const n=t.clientWaitSync(this._readbackQueue.sync,0,0);if(n===t.WAIT_FAILED)return a.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(n===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=ze._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let n=0;return n+=t[0]/256,n+=t[1]/65536,n+=t[2]/16777216,t[3]<127&&(n=-n),n/128}}const rt=a.a5/128;function mt(g,t){const n=g.granularity!==void 0?Math.max(g.granularity,1):1,l=n+(g.generateBorders?2:0),h=n+(g.extendToNorthPole||g.generateBorders?1:0)+(g.extendToSouthPole||g.generateBorders?1:0),_=l+1,w=h+1,P=g.generateBorders?-1:0,M=g.generateBorders||g.extendToNorthPole?-1:0,R=n+(g.generateBorders?1:0),B=n+(g.generateBorders||g.extendToSouthPole?1:0),$=_*w,G=l*h*6,X=_*w>65536;if(X&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const oe=X||t==="32bit",ve=new Int16Array(2*$);let Se=0;for(let We=M;We<=B;We++)for(let Le=P;Le<=R;Le++){let Je=Le/n*a.a5;Le===-1&&(Je=-rt),Le===n+1&&(Je=a.a5+rt);let et=We/n*a.a5;We===-1&&(et=g.extendToNorthPole?a.bs:-rt),We===n+1&&(et=g.extendToSouthPole?a.bt:a.a5+rt),ve[Se++]=Je,ve[Se++]=et}const be=oe?new Uint32Array(G):new Uint16Array(G);let Ae=0;for(let We=0;We<h;We++)for(let Le=0;Le<l;Le++){const Je=Le+1+We*_,et=Le+(We+1)*_,Ve=Le+1+(We+1)*_;be[Ae++]=Le+We*_,be[Ae++]=et,be[Ae++]=Je,be[Ae++]=Je,be[Ae++]=et,be[Ae++]=Ve}return{vertices:ve.buffer.slice(0),indices:be.buffer.slice(0),uses32bitIndices:oe}}const Gt=new a.aW({fill:new a.bu(128,2),line:new a.bu(512,0),tile:new a.bu(128,32),stencil:new a.bu(128,1),circle:3});class tr{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Ui.projectionGlobe}get vertexShaderPreludeCode(){return Ui.projectionMercator.vertexSource}get subdivisionGranularity(){return Gt}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new ze(t));const n=a.X(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-n*Math.PI*2))-.5*Math.PI,h=this._errorMeasurement.updateErrorLoop(n,l),_=ce();h!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=h,this._errorMeasurementLastChangeTime=_);const w=Math.min(Math.max((_-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=a.bv(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,a.bw(w))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,n,l,h,_){const w=(_==="stencil"?Gt.stencil:Gt.tile).getGranularityForZoomLevel(n.z);return this._getMesh(t,{granularity:w,generateBorders:l,extendToNorthPole:n.y===0&&h,extendToSouthPole:n.y===(1<<n.z)-1&&h})}_getMesh(t,n){const l=this._getMeshKey(n);if(l in this._tileMeshCache)return this._tileMeshCache[l];const h=function(_,w){const P=mt(w,"16bit"),M=a.aX.deserialize({arrayBuffer:P.vertices,length:P.vertices.byteLength/2/2}),R=a.aZ.deserialize({arrayBuffer:P.indices,length:P.indices.byteLength/2/3});return new wi(_.createVertexBuffer(M,Yn.members),_.createIndexBuffer(R),a.aY.simpleSegment(0,0,M.length,R.length))}(t,n);return this._tileMeshCache[l]=h,h}recalculate(t){}hasTransition(){const t=ce();let n=!1;return n=n||(t-this._errorMeasurementLastChangeTime)/1e3<.7,n=n||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,n}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Ir=new a.t({type:new a.D(a.u.projection.type)});class Dr extends a.E{constructor(t){super(),this._transitionable=new a.x(Ir,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.H(0)),this._mercatorProjection=new jn,this._verticalPerspectiveProjection=new tr}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof a.bx){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,n,l,h,_){return this.currentProjection.getMeshFromTileID(t,n,l,h,_)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function Mr(g){const t=Ai(g.worldSize,g.center.lat);return 2*Math.PI*t}function $r(g,t,n,l,h){const _=1/(1<<h),w=t/a.a5*_+l*_,P=a.bz((g/a.a5*_+n*_)*Math.PI*2+Math.PI,2*Math.PI),M=2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI,R=Math.cos(M),B=new Float64Array(3);return B[0]=Math.sin(P)*R,B[1]=Math.sin(M),B[2]=Math.cos(P)*R,B}function Ur(g){return function(t,n){const l=Math.cos(n),h=new Float64Array(3);return h[0]=Math.sin(t)*l,h[1]=Math.sin(n),h[2]=Math.cos(t)*l,h}(g.lng*Math.PI/180,g.lat*Math.PI/180)}function Ai(g,t){return g/(2*Math.PI)/Math.cos(t*Math.PI/180)}function hn(g){const t=Math.asin(g[1])/Math.PI*180,n=Math.sqrt(g[0]*g[0]+g[2]*g[2]);if(n>1e-6){const l=g[0]/n,h=Math.acos(g[2]/n),_=(l>0?h:-h)/Math.PI*180;return new a.V(a.W(_,-180,180),t)}return new a.V(0,t)}function bi(g){return Math.cos(g*Math.PI/180)}function si(g,t){const n=bi(g),l=bi(t);return a.au(l/n)}function dn(g,t){const n=g.rotate(t.bearingInRadians),l=t.zoom+si(t.center.lat,0),h=a.bv(1/bi(t.center.lat),1/bi(Math.min(Math.abs(t.center.lat),60)),a.by(l,7,3,0,1)),_=360/Mr({worldSize:t.worldSize,center:{lat:t.center.lat}});return new a.V(t.center.lng-n.x*_*h,a.ao(t.center.lat+n.y*_,-a.ap,a.ap))}function Pn(g){const t=.5*g,n=Math.sin(t),l=Math.cos(t);return Math.log(n+l)-Math.log(l-n)}function Sa(g,t,n,l){const h=g.lat+n*l;if(Math.abs(n)>1){const _=(Math.sign(g.lat+n)!==Math.sign(g.lat)?-Math.abs(g.lat):Math.abs(g.lat))*Math.PI/180,w=Math.abs(g.lat+n)*Math.PI/180,P=Pn(_+l*(w-_)),M=Pn(_),R=Pn(w);return new a.V(g.lng+t*((P-M)/(R-M)),h)}return new a.V(g.lng+t*l,h)}class co{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,n,l,h){const _=`${t.z}_${t.x}_${t.y}_${h?.terrain?"t":""}`,w=this._cache.get(_);if(w)return w;const P=this._cachePrevious.get(_);if(P)return this._cache.set(_,P),P;const M=this._boundingVolumeFactory(t,n,l,h);return this._cache.set(_,M),this._hadAnyChanges=!0,M}}class uo{constructor(t,n,l,h){this.min=l,this.max=h,this.points=t,this.planes=n}static fromAabb(t,n){const l=[];for(let h=0;h<8;h++)l.push([1&~h?t[0]:n[0],(h>>1&1)==1?n[1]:t[1],(h>>2&1)==1?n[2]:t[2]]);return new uo(l,[[-1,0,0,n[0]],[1,0,0,-t[0]],[0,-1,0,n[1]],[0,1,0,-t[1]],[0,0,-1,n[2]],[0,0,1,-t[2]]],t,n)}static fromCenterSizeAngles(t,n,l){const h=a.bC([],l[0],l[1],l[2]),_=a.bD([],[n[0],0,0],h),w=a.bD([],[0,n[1],0],h),P=a.bD([],[0,0,n[2]],h),M=[...t],R=[...t];for(let $=0;$<8;$++)for(let G=0;G<3;G++){const X=t[G]+_[G]*(1&~$?-1:1)+w[G]*(($>>1&1)==1?1:-1)+P[G]*(($>>2&1)==1?1:-1);M[G]=Math.min(M[G],X),R[G]=Math.max(R[G],X)}const B=[];for(let $=0;$<8;$++){const G=[...t];a.b1(G,G,a.b0([],_,1&~$?-1:1)),a.b1(G,G,a.b0([],w,($>>1&1)==1?1:-1)),a.b1(G,G,a.b0([],P,($>>2&1)==1?1:-1)),B.push(G)}return new uo(B,[[..._,-a.b6(_,B[0])],[...w,-a.b6(w,B[0])],[...P,-a.b6(P,B[0])],[-_[0],-_[1],-_[2],-a.b6(_,B[7])],[-w[0],-w[1],-w[2],-a.b6(w,B[7])],[-P[0],-P[1],-P[2],-a.b6(P,B[7])]],M,R)}intersectsFrustum(t){let n=!0;const l=this.points.length,h=this.planes.length,_=t.planes.length,w=t.points.length;for(let P=0;P<_;P++){const M=t.planes[P];let R=0;for(let B=0;B<l;B++){const $=this.points[B];M[0]*$[0]+M[1]*$[1]+M[2]*$[2]+M[3]>=0&&R++}if(R===0)return 0;R<l&&(n=!1)}if(n)return 2;for(let P=0;P<h;P++){const M=this.planes[P];let R=0;for(let B=0;B<w;B++){const $=t.points[B];M[0]*$[0]+M[1]*$[1]+M[2]*$[2]+M[3]>=0&&R++}if(R===0)return 0}return 1}intersectsPlane(t){const n=this.points.length;let l=0;for(let h=0;h<n;h++){const _=this.points[h];t[0]*_[0]+t[1]*_[1]+t[2]*_[2]+t[3]>=0&&l++}return l===n?2:l===0?0:1}}function Oo(g,t,n){const l=g-t;return l<0?-l:Math.max(0,l-n)}function Hs(g,t,n,l,h){const _=g-n;let w;return w=_<0?Math.min(-_,1+_-h):_>1?Math.min(Math.max(_-h,0),1-_):0,Math.max(w,Oo(t,l,h))}class Ls{constructor(){this._boundingVolumeCache=new co(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,n,l,h){const _=1<<l.z,w=1/_,P=l.x/_,M=l.y/_;let R=2;return R=Math.min(R,Hs(t,n,P,M,w)),R=Math.min(R,Hs(t,n,P+.5,-M-w,w)),R=Math.min(R,Hs(t,n,P+.5,2-M-w,w)),R}getWrap(t,n,l){const h=1<<n.z,_=1/h,w=n.x/h,P=Oo(t.x,w,_),M=Oo(t.x,w-1,_),R=Oo(t.x,w+1,_),B=Math.min(P,M,R);return B===R?1:B===M?-1:0}allowVariableZoom(t,n){return Mt(t,n)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,n,l,h){return this._boundingVolumeCache.getTileBoundingVolume(t,n,l,h)}_computeTileBoundingVolume(t,n,l,h){var _,w;let P=0,M=0;if(h?.terrain){const R=new a.a2(t.z,n,t.z,t.x,t.y),B=h.terrain.getMinMaxElevation(R);P=(_=B.minElevation)!==null&&_!==void 0?_:Math.min(0,l),M=(w=B.maxElevation)!==null&&w!==void 0?w:Math.max(0,l)}if(P/=a.bF,M/=a.bF,P+=1,M+=1,t.z<=0)return uo.fromAabb([-M,-M,-M],[M,M,M]);if(t.z===1)return uo.fromAabb([t.x===0?-M:0,t.y===0?0:-M,-M],[t.x===0?0:M,t.y===0?M:0,M]);{const R=[$r(0,0,t.x,t.y,t.z),$r(a.a5,0,t.x,t.y,t.z),$r(a.a5,a.a5,t.x,t.y,t.z),$r(0,a.a5,t.x,t.y,t.z)],B=[];for(const Pt of R)B.push(a.b0([],Pt,M));if(M!==P)for(const Pt of R)B.push(a.b0([],Pt,P));t.y===0&&B.push([0,1,0]),t.y===(1<<t.z)-1&&B.push([0,-1,0]);const $=[1,1,1],G=[-1,-1,-1];for(const Pt of B)for(let Ct=0;Ct<3;Ct++)$[Ct]=Math.min($[Ct],Pt[Ct]),G[Ct]=Math.max(G[Ct],Pt[Ct]);const X=$r(a.a5/2,a.a5/2,t.x,t.y,t.z),oe=a.b5([],[0,1,0],X);a.b4(oe,oe);const ve=a.b5([],X,oe);a.b4(ve,ve);const Se=a.b5([],R[2],R[1]);a.b4(Se,Se);const be=a.b5([],R[0],R[3]);a.b4(be,be),B.push(a.b0([],X,M)),t.y>=(1<<t.z)/2&&B.push(a.b0([],$r(a.a5/2,0,t.x,t.y,t.z),M)),t.y<(1<<t.z)/2&&B.push(a.b0([],$r(a.a5/2,a.a5,t.x,t.y,t.z),M));const Ae=Ba(X,B),We=Ba(ve,B),Le=[-X[0],-X[1],-X[2],Ae.max],Je=[X[0],X[1],X[2],-Ae.min],et=[-ve[0],-ve[1],-ve[2],We.max],Ve=[ve[0],ve[1],ve[2],-We.min],lt=[...Se,0],Tt=[...be,0],bt=[];return t.y===0?bt.push(a.bE(Tt,lt,Le),a.bE(Tt,lt,Je)):bt.push(a.bE(et,lt,Le),a.bE(et,lt,Je),a.bE(et,Tt,Le),a.bE(et,Tt,Je)),t.y===(1<<t.z)-1?bt.push(a.bE(Tt,lt,Le),a.bE(Tt,lt,Je)):bt.push(a.bE(Ve,lt,Le),a.bE(Ve,lt,Je),a.bE(Ve,Tt,Le),a.bE(Ve,Tt,Je)),new uo(bt,[Le,Je,et,Ve,lt,Tt],$,G)}}}function Ba(g,t){let n=1/0,l=-1/0;for(const h of t){const _=a.b6(g,h);n=Math.min(n,_),l=Math.max(l,_)}return{min:n,max:l}}class la{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,n,l){return this._helper.interpolatePadding(t,n,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,n){this._helper.resize(t,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,n){this._helper.overrideNearFarZ(t,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=a.bG(),this._projectionMatrix=a.bk(),this._globeViewProjMatrix32f=a.bj(),this._globeViewProjMatrixNoCorrection=a.bk(),this._globeViewProjMatrixNoCorrectionInverted=a.bk(),this._globeProjMatrixInverted=a.bk(),this._cameraPosition=a.bA(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(n,l)=>{const h=a.ao(n.lat,-a.ap,a.ap),_=a.ao(+l,this.minZoom+si(0,h),this.maxZoom);return{center:new a.V(n.lng,h),zoom:_}},this.applyConstrain=(n,l)=>this._helper.applyConstrain(n,l),this._helper=new $s({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(n,l)=>this.defaultConstrain(n,l)},t),this._coveringTilesDetailsProvider=new Ls}clone(){const t=new la;return t.apply(this),t}apply(t,n){this._globeLatitudeErrorCorrectionRadians=n||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=a.bA();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:n,applyGlobeMatrix:l}=t,h=this._helper.getMercatorTileCoordinates(n);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:h,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const n=this.pitchInRadians,l=this.cameraToCenterDistance/t,h=Math.sin(n)*l,_=Math.cos(n)*l+1,w=1/Math.sqrt(h*h+_*_)*1;let P=-h,M=_;const R=Math.sqrt(P*P+M*M);P/=R,M/=R;const B=[0,P,M];a.bH(B,B,[0,0,0],-this.bearingInRadians),a.bI(B,B,[0,0,0],-1*this.center.lat*Math.PI/180),a.bJ(B,B,[0,0,0],this.center.lng*Math.PI/180);const $=1/a.b8(B);return a.b0(B,B,$),[...B,-w*$]}isLocationOccluded(t){return!this.isSurfacePointVisible(Ur(t))}transformLightDirection(t){const n=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,h=Math.cos(l),_=[Math.sin(n)*h,Math.sin(l),Math.cos(n)*h],w=[_[2],0,-_[0]],P=[0,0,0];a.b5(P,w,_),a.b4(w,w),a.b4(P,P);const M=[0,0,0];return a.b4(M,[w[0]*t[0]+P[0]*t[1]+_[0]*t[2],w[1]*t[0]+P[1]*t[1]+_[1]*t[2],w[2]*t[0]+P[2]*t[1]+_[2]*t[2]]),M}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,n,l){const h=function(P,M,R){const B=1/(1<<R.z);return new a.ab(P/a.a5*B+R.x*B,M/a.a5*B+R.y*B)}(t,n,l.canonical),_=(w=h.y,[a.bz(h.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI]);var w;return this.getCircleRadiusCorrection()/Math.cos(_[1])}projectTileCoordinates(t,n,l,h){const _=l.canonical,w=$r(t,n,_.x,_.y,_.z),P=1+(h?h(t,n):0)/a.bF,M=[w[0]*P,w[1]*P,w[2]*P,1];a.aI(M,M,this._globeViewProjMatrixNoCorrection);const R=this._cachedClippingPlane,B=R[0]*w[0]+R[1]*w[1]+R[2]*w[2]+R[3]<0;return{point:new a.P(M[0]/M[3],M[1]/M[3]),signedDistanceFromCamera:M[3],isOccluded:B}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=Ai(this.worldSize,this.center.lat),n=a.bl(),l=a.bl();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),a.bf(n,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const h=this.centerOffset;n[8]=2*-h.x/this._helper._width,n[9]=2*h.y/this._helper._height,this._projectionMatrix=a.bg(n),this._globeProjMatrixInverted=a.bl(),a.aC(this._globeProjMatrixInverted,n),a.O(n,n,[0,0,-this.cameraToCenterDistance]),a.bh(n,n,this.rollInRadians),a.bi(n,n,-this.pitchInRadians),a.bh(n,n,this.bearingInRadians),a.O(n,n,[0,0,-t]);const _=a.bA();_[0]=t,_[1]=t,_[2]=t,a.bi(l,n,this.center.lat*Math.PI/180),a.bK(l,l,-this.center.lng*Math.PI/180),a.Q(l,l,_),this._globeViewProjMatrixNoCorrection=l,a.bi(n,n,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),a.bK(n,n,-this.center.lng*Math.PI/180),a.Q(n,n,_),this._globeViewProjMatrix32f=new Float32Array(n),this._globeViewProjMatrixNoCorrectionInverted=a.bl(),a.aC(this._globeViewProjMatrixNoCorrectionInverted,l);const w=a.bA();this._cameraPosition=a.bA(),this._cameraPosition[2]=this.cameraToCenterDistance/t,a.bH(this._cameraPosition,this._cameraPosition,w,-this.rollInRadians),a.bI(this._cameraPosition,this._cameraPosition,w,this.pitchInRadians),a.bH(this._cameraPosition,this._cameraPosition,w,-this.bearingInRadians),a.b1(this._cameraPosition,this._cameraPosition,[0,0,1]),a.bI(this._cameraPosition,this._cameraPosition,w,-this.center.lat*Math.PI/180),a.bJ(this._cameraPosition,this._cameraPosition,w,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const P=a.bg(this._globeViewProjMatrixNoCorrectionInverted);a.Q(P,P,[1,1,-1]),this._cachedFrustum=kn.fromInvProjectionMatrix(P,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){a.w("calculateFogMatrix is not supported on globe projection.");const n=a.bl();return a.as(n),n}getVisibleUnwrappedCoordinates(t){return[new a.bd(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&a.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,n){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=Ur(t);a.b0(l,l,1+n/a.bF);const h=a.bG();return a.aI(h,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),h[2]/h[3]}populateCache(t){}getBounds(){const t=.5*this.width,n=.5*this.height,l=[new a.P(0,0),new a.P(t,0),new a.P(this.width,0),new a.P(this.width,n),new a.P(this.width,this.height),new a.P(t,this.height),new a.P(0,this.height),new a.P(0,n)],h=[];for(const $ of l)h.push(this.unprojectScreenPoint($));let _=0,w=0,P=0,M=0;const R=this.center;for(const $ of h){const G=a.bL(R.lng,$.lng),X=a.bL(R.lat,$.lat);G<w&&(w=G),G>_&&(_=G),X<M&&(M=X),X>P&&(P=X)}const B=[R.lng+w,R.lat+M,R.lng+_,R.lat+P];return this.isSurfacePointOnScreen([0,1,0])&&(B[3]=90,B[0]=-180,B[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(B[1]=-90,B[0]=-180,B[2]=180),new wr(B)}calculateCenterFromCameraLngLatAlt(t,n,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,n,l,h)}setLocationAtPoint(t,n){const l=Ur(this.unprojectScreenPoint(n)),h=Ur(t),_=a.bA();a.bM(_);const w=a.bA();a.bJ(w,l,_,-this.center.lng*Math.PI/180),a.bI(w,w,_,this.center.lat*Math.PI/180);const P=h[0]*h[0]+h[2]*h[2],M=w[0]*w[0];if(P<M)return;const R=Math.sqrt(P-M),B=-R,$=a.bN(h[0],h[2],w[0],R),G=a.bN(h[0],h[2],w[0],B),X=a.bA();a.bJ(X,h,_,-$);const oe=a.bN(X[1],X[2],w[1],w[2]),ve=a.bA();a.bJ(ve,h,_,-G);const Se=a.bN(ve[1],ve[2],w[1],w[2]),be=.5*Math.PI,Ae=oe>=-be&&oe<=be,We=Se>=-be&&Se<=be;let Le,Je;if(Ae&&We){const Tt=this.center.lng*Math.PI/180,bt=this.center.lat*Math.PI/180;a.bO($,Tt)+a.bO(oe,bt)<a.bO(G,Tt)+a.bO(Se,bt)?(Le=$,Je=oe):(Le=G,Je=Se)}else if(Ae)Le=$,Je=oe;else{if(!We)return;Le=G,Je=Se}const et=Le/Math.PI*180,Ve=Je/Math.PI*180,lt=this.center.lat;this.setCenter(new a.V(et,a.ao(Ve,-90,90))),this.setZoom(this.zoom+si(lt,this.center.lat))}locationToScreenPoint(t,n){const l=Ur(t);if(n){const h=n.getElevationForLngLatZoom(t,this._helper._tileZoom);a.b0(l,l,1+h/a.bF)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(t){const n=a.bG();return a.aI(n,[...t,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],new a.P((.5*n[0]+.5)*this.width,(.5*-n[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,n){if(n){const l=n.pointCoordinate(t);if(l)return l}return a.ab.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,n){var l;return(l=this.screenPointToMercatorCoordinate(t,n))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(t,n){const l=this._cameraPosition,h=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(l,h)}getRayDirectionFromPixel(t){const n=a.bG();n[0]=t.x/this.width*2-1,n[1]=-1*(t.y/this.height*2-1),n[2]=1,n[3]=1,a.aI(n,n,this._globeViewProjMatrixNoCorrectionInverted),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3];const l=a.bA();l[0]=n[0]-this._cameraPosition[0],l[1]=n[1]-this._cameraPosition[1],l[2]=n[2]-this._cameraPosition[2];const h=a.bA();return a.b4(h,l),h}isSurfacePointVisible(t){const n=this._cachedClippingPlane;return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const n=a.bG();return a.aI(n,[...t,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3],n[0]>-1&&n[0]<1&&n[1]>-1&&n[1]<1&&n[2]>-1&&n[2]<1}rayPlanetIntersection(t,n){const l=a.b6(t,n),h=a.bA(),_=a.bA();a.b0(_,n,l),a.b3(h,t,_);const w=1-a.b6(h,h);if(w<0)return null;const P=a.b6(t,t)-1,M=-l+(l<0?1:-1)*Math.sqrt(w),R=P/M,B=M;return{tMin:Math.min(R,B),tMax:Math.max(R,B)}}unprojectScreenPoint(t){const n=this._cameraPosition,l=this.getRayDirectionFromPixel(t),h=this.rayPlanetIntersection(n,l);if(h){const B=a.bA();a.b1(B,n,[l[0]*h.tMin,l[1]*h.tMin,l[2]*h.tMin]);const $=a.bA();return a.b4($,B),hn($)}const _=this._cachedClippingPlane,w=_[0]*l[0]+_[1]*l[1]+_[2]*l[2],P=-a.bc(_,n)/w,M=a.bA();if(P>0)a.b1(M,n,[l[0]*P,l[1]*P,l[2]*P]);else{const B=a.bA();a.b1(B,n,[2*l[0],2*l[1],2*l[2]]);const $=a.bc(this._cachedClippingPlane,B);a.b3(M,B,[this._cachedClippingPlane[0]*$,this._cachedClippingPlane[1]*$,this._cachedClippingPlane[2]*$])}const R=function(B){const $=a.bA();return $[0]=B[0]*-B[3],$[1]=B[1]*-B[3],$[2]=B[2]*-B[3],{center:$,radius:Math.sqrt(1-B[3]*B[3])}}(_);return hn(function(B,$,G){const X=a.bA();a.b3(X,G,B);const oe=a.bA();return a.bB(oe,B,X,$/a.ba(X)),oe}(R.center,R.radius,M))}getMatrixForModel(t,n){const l=a.V.convert(t),h=1/a.bF,_=a.bk();return a.bK(_,_,l.lng/180*Math.PI),a.bi(_,_,-l.lat/180*Math.PI),a.O(_,_,[0,0,1+n/a.bF]),a.bi(_,_,.5*Math.PI),a.Q(_,_,[h,h,h]),_}getProjectionDataForCustomLayer(t=!0){const n=this.getProjectionData({overscaledTileID:new a.a2(0,0,0,0,0),applyGlobeMatrix:t});return n.tileMercatorCoords=[0,0,1,1],n}getFastPathSimpleProjectionMatrix(t){}}class Ms{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,n,l){return this._helper.interpolatePadding(t,n,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,n,l=!0){this._helper.resize(t,n,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,n){this._helper.overrideNearFarZ(t,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,n){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=n,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(n,l)=>this.currentTransform.defaultConstrain(n,l),this.applyConstrain=(n,l)=>this._helper.applyConstrain(n,l),this._helper=new $s({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(n,l)=>this.defaultConstrain(n,l)},t),this._globeness=1,this._mercatorTransform=new oa,this._verticalPerspectiveTransform=new la}clone(){const t=new Ms;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const n=this._mercatorTransform.getProjectionData(t),l=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:n.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:n.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return a.bv(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return a.bv(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,n,l){const h=this._mercatorTransform.getPitchedTextCorrection(t,n,l),_=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,n,l);return a.bv(h,_,this._globeness)}projectTileCoordinates(t,n,l,h){return this.currentTransform.projectTileCoordinates(t,n,l,h)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,n){return this.currentTransform.lngLatToCameraDepth(t,n)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,n,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,n,l,h)}setLocationAtPoint(t,n){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,n),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,n),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,n){return this.currentTransform.locationToScreenPoint(t,n)}screenPointToMercatorCoordinate(t,n){return this.currentTransform.screenPointToMercatorCoordinate(t,n)}screenPointToLocation(t,n){return this.currentTransform.screenPointToLocation(t,n)}isPointOnMapSurface(t,n){return this.currentTransform.isPointOnMapSurface(t,n)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,n){return this.currentTransform.getMatrixForModel(t,n)}getProjectionDataForCustomLayer(t=!0){const n=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return n;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return l.fallbackMatrix=n.mainMatrix,l}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class di{get useGlobeControls(){return!0}handlePanInertia(t,n){const l=dn(t,n);return Math.abs(l.lng-n.center.lng)>180&&(l.lng=n.center.lng+179.5*Math.sign(l.lng-n.center.lng)),{easingCenter:l,easingOffset:new a.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,n){const l=t.around,h=n.screenPointToLocation(l);t.bearingDelta&&n.setBearing(n.bearing+t.bearingDelta),t.pitchDelta&&n.setPitch(n.pitch+t.pitchDelta),t.rollDelta&&n.setRoll(n.roll+t.rollDelta);const _=n.zoom;t.zoomDelta&&n.setZoom(n.zoom+t.zoomDelta);const w=n.zoom-_;if(w===0)return;const P=a.bL(n.center.lng,h.lng),M=P/(Math.abs(P/180)+1),R=a.bL(n.center.lat,h.lat),B=n.getRayDirectionFromPixel(l),$=n.cameraPosition,G=-1*a.b6($,B),X=a.bA();a.b1(X,$,[B[0]*G,B[1]*G,B[2]*G]);const oe=a.b8(X)-1,ve=Math.exp(.5*-Math.max(oe-.3,0)),Se=Ai(n.worldSize,n.center.lat)/Math.min(n.width,n.height),be=a.by(Se,.9,.5,1,.25),Ae=(1-a.ar(-w))*Math.min(ve,be),We=n.center.lat,Le=n.zoom,Je=new a.V(n.center.lng+M*Ae,a.ao(n.center.lat+R*Ae,-a.ap,a.ap));n.setLocationAtPoint(h,l);const et=n.center,Ve=a.by(Math.abs(P),45,85,0,1),lt=a.by(Se,.75,.35,0,1),Tt=Math.pow(Math.max(Ve,lt),.25),bt=a.bL(et.lng,Je.lng),Pt=a.bL(et.lat,Je.lat);n.setCenter(new a.V(et.lng+bt*Tt,et.lat+Pt*Tt).wrap()),n.setZoom(Le+si(We,n.center.lat))}handleMapControlsPan(t,n,l){if(!t.panDelta)return;const h=n.center.lat,_=n.zoom;n.setCenter(dn(t.panDelta,n).wrap()),n.setZoom(_+si(h,n.center.lat))}cameraForBoxAndBearing(t,n,l,h,_){const w=No(t,n,l,h,_),P=n.left/_.width*2-1,M=(_.width-n.right)/_.width*2-1,R=n.top/_.height*-2+1,B=(_.height-n.bottom)/_.height*-2+1,$=a.bL(l.getWest(),l.getEast())<0,G=$?l.getEast():l.getWest(),X=$?l.getWest():l.getEast(),oe=Math.max(l.getNorth(),l.getSouth()),ve=Math.min(l.getNorth(),l.getSouth()),Se=G+.5*a.bL(G,X),be=oe+.5*a.bL(oe,ve),Ae=_.clone();Ae.setCenter(w.center),Ae.setBearing(w.bearing),Ae.setPitch(0),Ae.setRoll(0),Ae.setZoom(w.zoom);const We=Ae.modelViewProjectionMatrix,Le=[Ur(l.getNorthWest()),Ur(l.getNorthEast()),Ur(l.getSouthWest()),Ur(l.getSouthEast()),Ur(new a.V(X,be)),Ur(new a.V(G,be)),Ur(new a.V(Se,oe)),Ur(new a.V(Se,ve))],Je=Ur(w.center);let et=Number.POSITIVE_INFINITY;for(const Ve of Le)P<0&&(et=di.getLesserNonNegativeNonNull(et,di.solveVectorScale(Ve,Je,We,"x",P))),M>0&&(et=di.getLesserNonNegativeNonNull(et,di.solveVectorScale(Ve,Je,We,"x",M))),R>0&&(et=di.getLesserNonNegativeNonNull(et,di.solveVectorScale(Ve,Je,We,"y",R))),B<0&&(et=di.getLesserNonNegativeNonNull(et,di.solveVectorScale(Ve,Je,We,"y",B)));if(Number.isFinite(et)&&et!==0)return w.zoom=Ae.zoom+a.au(et),w;ls()}handleJumpToCenterZoom(t,n){const l=t.center.lat,h=t.applyConstrain(n.center?a.V.convert(n.center):t.center,t.zoom).center;t.setCenter(h.wrap());const _=n.zoom!==void 0?+n.zoom:t.zoom+si(l,h.lat);t.zoom!==_&&t.setZoom(_)}handleEaseTo(t,n){const l=t.zoom,h=t.center,_=t.padding,w={roll:t.roll,pitch:t.pitch,bearing:t.bearing},P={roll:n.roll===void 0?t.roll:n.roll,pitch:n.pitch===void 0?t.pitch:n.pitch,bearing:n.bearing===void 0?t.bearing:n.bearing},M=n.zoom!==void 0,R=!t.isPaddingEqual(n.padding);let B=!1;const $=n.center?a.V.convert(n.center):h,G=t.applyConstrain($,l).center;Gs(t,G);const X=t.clone();X.setCenter(G),X.setZoom(M?+n.zoom:l+si(h.lat,$.lat)),X.setBearing(n.bearing);const oe=new a.P(a.ao(t.centerPoint.x+n.offsetAsPoint.x,0,t.width),a.ao(t.centerPoint.y+n.offsetAsPoint.y,0,t.height));X.setLocationAtPoint(G,oe);const ve=(n.offset&&n.offsetAsPoint.mag())>0?X.center:G,Se=M?+n.zoom:l+si(h.lat,ve.lat),be=l+si(h.lat,0),Ae=Se+si(ve.lat,0),We=a.bL(h.lng,ve.lng),Le=a.bL(h.lat,ve.lat),Je=a.ar(Ae-be);return B=Se!==l,{easeFunc:et=>{if(a.bp(w,P)||lo({startEulerAngles:w,endEulerAngles:P,tr:t,k:et,useSlerp:w.roll!=P.roll}),R&&t.interpolatePadding(_,n.padding,et),n.around)a.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(n.around,n.aroundPoint);else{const Ve=Ae>be?Math.min(2,Je):Math.max(.5,Je),lt=Math.pow(Ve,1-et),Tt=Sa(h,We,Le,et*lt);t.setCenter(Tt.wrap())}if(B){const Ve=a.G.number(be,Ae,et)+si(0,t.center.lat);t.setZoom(Ve)}},isZooming:B,elevationCenter:ve}}handleFlyTo(t,n){const l=n.zoom!==void 0,h=t.center,_=t.zoom,w=t.padding,P=!t.isPaddingEqual(n.padding),M=t.applyConstrain(a.V.convert(n.center||n.locationAtOffset),_).center,R=l?+n.zoom:t.zoom+si(t.center.lat,M.lat),B=t.clone();B.setCenter(M),B.setZoom(R),B.setBearing(n.bearing);const $=new a.P(a.ao(t.centerPoint.x+n.offsetAsPoint.x,0,t.width),a.ao(t.centerPoint.y+n.offsetAsPoint.y,0,t.height));B.setLocationAtPoint(M,$);const G=B.center;Gs(t,G);const X=function(Le,Je,et){const Ve=Ur(Je),lt=Ur(et),Tt=a.b6(Ve,lt),bt=Math.acos(Tt),Pt=Mr(Le);return bt/(2*Math.PI)*Pt}(t,h,G),oe=_+si(h.lat,0),ve=R+si(G.lat,0),Se=a.ar(ve-oe);let be;if(typeof n.minZoom=="number"){const Le=+n.minZoom+si(G.lat,0),Je=Math.min(Le,oe,ve)+si(0,G.lat),et=t.applyConstrain(G,Je).zoom+si(G.lat,0);be=a.ar(et-oe)}const Ae=a.bL(h.lng,G.lng),We=a.bL(h.lat,G.lat);return{easeFunc:(Le,Je,et,Ve)=>{const lt=Sa(h,Ae,We,et);P&&t.interpolatePadding(w,n.padding,Le);const Tt=Le===1?G:lt;t.setCenter(Tt.wrap());const bt=oe+a.au(Je);t.setZoom(Le===1?R:bt+si(0,Tt.lat))},scaleOfZoom:Se,targetCenter:G,scaleOfMinZoom:be,pixelPathLength:X}}static solveVectorScale(t,n,l,h,_){const w=h==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],P=[l[3],l[7],l[11],l[15]],M=t[0]*w[0]+t[1]*w[1]+t[2]*w[2],R=t[0]*P[0]+t[1]*P[1]+t[2]*P[2],B=n[0]*w[0]+n[1]*w[1]+n[2]*w[2],$=n[0]*P[0]+n[1]*P[1]+n[2]*P[2];return B+_*R===M+_*$||P[3]*(M-B)+w[3]*($-R)+M*$==B*R?null:(B+w[3]-_*$-_*P[3])/(B-M-_*$+_*R)}static getLesserNonNegativeNonNull(t,n){return n!==null&&n>=0&&n<t?n:t}}class Ta{constructor(t){this._globe=t,this._mercatorCameraHelper=new Zs,this._verticalPerspectiveCameraHelper=new di}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,n){return this.currentHelper.handlePanInertia(t,n)}handleMapControlsRollPitchBearingZoom(t,n){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,n)}handleMapControlsPan(t,n,l){this.currentHelper.handleMapControlsPan(t,n,l)}cameraForBoxAndBearing(t,n,l,h,_){return this.currentHelper.cameraForBoxAndBearing(t,n,l,h,_)}handleJumpToCenterZoom(t,n){this.currentHelper.handleJumpToCenterZoom(t,n)}handleEaseTo(t,n){return this.currentHelper.handleEaseTo(t,n)}handleFlyTo(t,n){return this.currentHelper.handleFlyTo(t,n)}}const ys=(g,t)=>a.B(g,t&&t.filter(n=>n.identifier!=="source.canvas")),Pa=a.bP();class ca extends a.E{constructor(t,n={}){var l,h;super(),this._rtlPluginLoaded=()=>{for(const w in this.tileManagers){const P=this.tileManagers[w].getSource().type;P!=="vector"&&P!=="geojson"||this.tileManagers[w].reload()}},this.map=t,this.dispatcher=new Bt(wt(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(w,P)=>this.getGlyphs(w,P)),this.dispatcher.registerMessageHandler("GI",(w,P)=>this.getImages(w,P)),this.dispatcher.registerMessageHandler("GDA",(w,P)=>this.getDashes(w,P)),this.imageManager=new xe,this.imageManager.setEventedParent(this);const _=((l=t._container)===null||l===void 0?void 0:l.lang)||typeof document<"u"&&((h=document.documentElement)===null||h===void 0?void 0:h.lang)||void 0;this.glyphManager=new kt(t._requestManager,n.localIdeographFontFamily,_),this.lineAtlas=new Fe(256,512),this.crossTileSymbolIndex=new zr,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",a.bQ()),at().on(Ie,this._rtlPluginLoaded),this.on("data",w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const P=this.tileManagers[w.sourceId];if(!P)return;const M=P.getSource();if(M&&M.vectorLayerIds)for(const R in this._layers){const B=this._layers[R];B.source===M.id&&this._validateLayer(B)}})}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new a.bR,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,n){var l,h,_;this._checkLoaded();const w=n===null?(_=(h=(l=this.stylesheet.state)===null||l===void 0?void 0:l[t])===null||h===void 0?void 0:h.default)!==null&&_!==void 0?_:null:n;if(a.bS(w,this._globalState[t]))return this;this._globalState[t]=w,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const n=[];for(const l in t)!a.bS(this._globalState[l],t[l].default)&&(n.push(l),this._globalState[l]=t[l].default);this._applyGlobalStateChanges(n)}_applyGlobalStateChanges(t){if(t.length===0)return;const n=new Set,l={};for(const h of t){l[h]=this._globalState[h];for(const _ in this._layers){const w=this._layers[_],P=w.getLayoutAffectingGlobalStateRefs(),M=w.getPaintAffectingGlobalStateRefs();if(P.has(h)&&n.add(w.source),M.has(h))for(const{name:R,value:B}of M.get(h))this._updatePaintProperty(w,R,B)}}this.dispatcher.broadcast("UGS",l);for(const h in this.tileManagers)n.has(h)&&(this._reloadSource(h),this._changed=!0)}loadURL(t,n={},l){this.fire(new a.l("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const h=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const _=this._loadStyleRequest;a.j(h,this._loadStyleRequest).then(w=>{this._loadStyleRequest=null,this._load(w.data,n,l)}).catch(w=>{this._loadStyleRequest=null,w&&!_.signal.aborted&&this.fire(new a.k(w))})}loadJSON(t,n={},l){this.fire(new a.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,j.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(t,n,l)}).catch(()=>{})}loadEmpty(){this.fire(new a.l("dataloading",{dataType:"style"})),this._load(Pa,{validate:!1})}_load(t,n,l){var h,_;let w=n.transformStyle?n.transformStyle(l,t):t;if(!n.validate||!ys(this,a.C(w))){w=Object.assign({},w),this._loaded=!0,this.stylesheet=w;for(const P in w.sources)this.addSource(P,w.sources[P],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new sr(this.stylesheet.light),this._setProjectionInternal(((h=this.stylesheet.projection)===null||h===void 0?void 0:h.type)||"mercator"),this.sky=new he(this.stylesheet.sky),this.map.setTerrain((_=this.stylesheet.terrain)!==null&&_!==void 0?_:null),this.fire(new a.l("data",{dataType:"style"})),this.fire(new a.l("style.load"))}}_createLayers(){var t,n,l;const h=a.bT(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",h),this._order=h.map(_=>_.id),this._layers={},this._serializedLayers=null;for(const _ of h){const w=a.bU(_,this._globalState);if(w.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=w,a.bV(w)&&this.tileManagers[w.source]){const P=(l=(n=_.paint)===null||n===void 0?void 0:n["raster-fade-duration"])!==null&&l!==void 0?l:w.paint.get("raster-fade-duration");this.tileManagers[w.source].setRasterFadeDuration(P)}}}_loadSprite(t,n=!1,l=void 0){this.imageManager.setLoaded(!1);const h=new AbortController;let _;this._spriteRequest=h,function(w,P,M,R){return a._(this,void 0,void 0,function*(){const B=Te(w),$=M>1?"@2x":"",G={},X={};for(const{id:oe,url:ve}of B){const Se=P.transformRequest(st(ve,$,".json"),"SpriteJSON");G[oe]=a.j(Se,R);const be=P.transformRequest(st(ve,$,".png"),"SpriteImage");X[oe]=it.getImage(be,R)}return yield Promise.all([...Object.values(G),...Object.values(X)]),function(oe,ve){return a._(this,void 0,void 0,function*(){const Se={};for(const be in oe){Se[be]={};const Ae=j.getImageCanvasContext((yield ve[be]).data),We=(yield oe[be]).data;for(const Le in We){const{width:Je,height:et,x:Ve,y:lt,sdf:Tt,pixelRatio:bt,stretchX:Pt,stretchY:Ct,content:Jt,textFitWidth:ar,textFitHeight:Yt}=We[Le];Se[be][Le]={data:null,pixelRatio:bt,sdf:Tt,stretchX:Pt,stretchY:Ct,content:Jt,textFitWidth:ar,textFitHeight:Yt,spriteData:{width:Je,height:et,x:Ve,y:lt,context:Ae}}}}return Se})}(G,X)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(w=>{if(this._spriteRequest=null,w)for(const P in w){this._spritesImagesIds[P]=[];const M=this._spritesImagesIds[P]?this._spritesImagesIds[P].filter(R=>!(R in w)):[];for(const R of M)this.imageManager.removeImage(R),this._changedImages[R]=!0;for(const R in w[P]){const B=P==="default"?R:`${P}:${R}`;this._spritesImagesIds[P].push(B),B in this.imageManager.images?this.imageManager.updateImage(B,w[P][R],!1):this.imageManager.addImage(B,w[P][R]),n&&(this._changedImages[B]=!0)}}}).catch(w=>{this._spriteRequest=null,_=w,h.signal.aborted||this.fire(new a.k(_))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"})),l&&l(_)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}_validateLayer(t){const n=this.tileManagers[t.source];if(!n)return;const l=t.sourceLayer;if(!l)return;const h=n.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(l)===-1)&&this.fire(new a.k(new Error(`Source layer "${l}" does not exist on source "${h.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,n=!1){const l=this._serializedAllLayers();if(!t||t.length===0)return Object.values(n?a.bW(l):l);const h=[];for(const _ of t)if(l[_]){const w=n?a.bW(l[_]):l[_];h.push(w)}return h}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const n=Object.keys(this._layers);for(const l of n){const h=this._layers[l];h.type!=="custom"&&(t[l]=h.serialize())}return t}hasTransitions(){var t,n,l;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((n=this.sky)===null||n===void 0)&&n.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const h in this.tileManagers)if(this.tileManagers[h].hasTransition())return!0;for(const h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(n){const h=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(h.length||_.length)&&this._updateWorkerLayers(h,_);for(const w in this._updatedSources){const P=this._updatedSources[w];if(P==="reload")this._reloadSource(w);else{if(P!=="clear")throw new Error(`Invalid action ${P}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const l={};for(const h in this.tileManagers){const _=this.tileManagers[h];l[h]=_.used,_.used=!1}for(const h of this._order){const _=this._layers[h];_.recalculate(t,this._availableImages),!_.isHidden(t.zoom)&&_.source&&(this.tileManagers[_.source].used=!0)}for(const h in l){const _=this.tileManagers[h];!!l[h]!=!!_.used&&_.fire(new a.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,n&&this.fire(new a.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.tileManagers)this.tileManagers[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,n={}){var l;this._checkLoaded();const h=this.serialize();if(t=n.transformStyle?n.transformStyle(h,t):t,((l=n.validate)===null||l===void 0||l)&&ys(this,a.C(t)))return!1;(t=a.bW(t)).layers=a.bT(t.layers);const _=a.bX(h,t),w=this._getOperationsToPerform(_);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const P of w.operations)P();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const n=[],l=[];for(const h of t)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":n.push(()=>this.addLayer.apply(this,h.args));break;case"removeLayer":n.push(()=>this.removeLayer.apply(this,h.args));break;case"setPaintProperty":n.push(()=>this.setPaintProperty.apply(this,h.args));break;case"setLayoutProperty":n.push(()=>this.setLayoutProperty.apply(this,h.args));break;case"setFilter":n.push(()=>this.setFilter.apply(this,h.args));break;case"addSource":n.push(()=>this.addSource.apply(this,h.args));break;case"removeSource":n.push(()=>this.removeSource.apply(this,h.args));break;case"setLayerZoomRange":n.push(()=>this.setLayerZoomRange.apply(this,h.args));break;case"setLight":n.push(()=>this.setLight.apply(this,h.args));break;case"setGeoJSONSourceData":n.push(()=>this.setGeoJSONSourceData.apply(this,h.args));break;case"setGlyphs":n.push(()=>this.setGlyphs.apply(this,h.args));break;case"setSprite":n.push(()=>this.setSprite.apply(this,h.args));break;case"setTerrain":n.push(()=>this.map.setTerrain.apply(this,h.args));break;case"setSky":n.push(()=>this.setSky.apply(this,h.args));break;case"setProjection":this.setProjection.apply(this,h.args);break;case"setGlobalState":n.push(()=>this.setGlobalState.apply(this,h.args));break;case"setTransition":n.push(()=>{});break;default:l.push(h.command)}return{operations:n,unimplemented:l}}addImage(t,n){if(this.getImage(t))return this.fire(new a.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new a.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,l={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(a.C.source,`sources.${t}`,n,null,l))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const h=this.tileManagers[t]=new Zi(t,n,this.dispatcher);h.style=this,h.setEventedParent(this,()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:t})),h.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new a.k(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const n=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],n.fire(new a.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.tileManagers[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(n),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,n,l={}){this._checkLoaded();const h=t.id;if(this.getLayer(h))return void this.fire(new a.k(new Error(`Layer "${h}" already exists on this map.`)));let _;if(t.type==="custom"){if(ys(this,a.bY(t)))return;_=a.bU(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(h,t.source),t=a.bW(t),t=a.e(t,{source:h})),this._validate(a.C.layer,`layers.${h}`,t,{arrayIndex:-1},l))return;_=a.bU(t,this._globalState),this._validateLayer(_),_.setEventedParent(this,{layer:{id:h}})}const w=n?this._order.indexOf(n):this._order.length;if(n&&w===-1)this.fire(new a.k(new Error(`Cannot add layer "${h}" before non-existing layer "${n}".`)));else{if(this._order.splice(w,0,h),this._layerOrderChanged=!0,this._layers[h]=_,this._removedLayers[h]&&_.source&&_.type!=="custom"){const P=this._removedLayers[h];delete this._removedLayers[h],P.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.tileManagers[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new a.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const l=this._order.indexOf(t);this._order.splice(l,1);const h=n?this._order.indexOf(n):this._order.length;n&&h===-1?this.fire(new a.k(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(h,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new a.k(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,l){this._checkLoaded();const h=this.getLayer(t);h?h.minzoom===n&&h.maxzoom===l||(n!=null&&(h.minzoom=n),l!=null&&(h.maxzoom=l),this._updateLayer(h)):this.fire(new a.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,l={}){this._checkLoaded();const h=this.getLayer(t);if(h){if(!a.bS(h.filter,n))return n==null?(h.setFilter(void 0),void this._updateLayer(h)):void(this._validate(a.C.filter,`layers.${h.id}.filter`,n,null,l)||(h.setFilter(a.bW(n)),this._updateLayer(h)))}else this.fire(new a.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return a.bW(this.getLayer(t).filter)}setLayoutProperty(t,n,l,h={}){this._checkLoaded();const _=this.getLayer(t);_?a.bS(_.getLayoutProperty(n),l)||(_.setLayoutProperty(n,l,h),this._updateLayer(_)):this.fire(new a.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const l=this.getLayer(t);if(l)return l.getLayoutProperty(n);this.fire(new a.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,l,h={}){this._checkLoaded();const _=this.getLayer(t);_?a.bS(_.getPaintProperty(n),l)||this._updatePaintProperty(_,n,l,h):this.fire(new a.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,n,l,h={}){t.setPaintProperty(n,l,h)&&this._updateLayer(t),a.bV(t)&&n==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(l),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const l=t.source,h=t.sourceLayer,_=this.tileManagers[l];if(_===void 0)return void this.fire(new a.k(new Error(`The source '${l}' does not exist in the map's style.`)));const w=_.getSource().type;w==="geojson"&&h?this.fire(new a.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||h?(t.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),_.setFeatureState(h,t.id,n)):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const l=t.source,h=this.tileManagers[l];if(h===void 0)return void this.fire(new a.k(new Error(`The source '${l}' does not exist in the map's style.`)));const _=h.getSource().type,w=_==="vector"?t.sourceLayer:void 0;_!=="vector"||w?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new a.k(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(w,t.id,n):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,l=t.sourceLayer,h=this.tileManagers[n];if(h!==void 0)return h.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),h.getFeatureState(l,t.id)):void this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.k(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=a.bZ(this.tileManagers,_=>_.serialize()),n=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,h=this.stylesheet;return a.b_({version:h.version,name:h.name,metadata:h.metadata,light:h.light,sky:h.sky,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,projection:h.projection,sources:t,layers:n,terrain:l},_=>_!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=w=>this._layers[w].type==="fill-extrusion",l={},h=[];for(let w=this._order.length-1;w>=0;w--){const P=this._order[w];if(n(P)){l[P]=w;for(const M of t){const R=M[P];if(R)for(const B of R)h.push(B)}}}h.sort((w,P)=>P.intersectionZ-w.intersectionZ);const _=[];for(let w=this._order.length-1;w>=0;w--){const P=this._order[w];if(n(P))for(let M=h.length-1;M>=0;M--){const R=h[M].feature;if(l[R.layer.id]<w)break;_.push(R),h.pop()}else for(const M of t){const R=M[P];if(R)for(const B of R)_.push(B.feature)}}return _}queryRenderedFeatures(t,n,l){n&&n.filter&&this._validate(a.C.filter,"queryRenderedFeatures.filter",n.filter,null,n);const h={};if(n&&n.layers){if(!(Array.isArray(n.layers)||n.layers instanceof Set))return this.fire(new a.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const R of n.layers){const B=this._layers[R];if(!B)return this.fire(new a.k(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];h[B.source]=!0}}const _=[];n.availableImages=this._availableImages;const w=this._serializedAllLayers(),P=n.layers instanceof Set?n.layers:Array.isArray(n.layers)?new Set(n.layers):null,M=Object.assign(Object.assign({},n),{layers:P,globalState:this._globalState});for(const R in this.tileManagers)n.layers&&!h[R]||_.push(fr(this.tileManagers[R],this._layers,w,t,M,l,this.map.terrain?(B,$,G)=>this.map.terrain.getElevation(B,$,G):void 0));return this.placement&&_.push(function(R,B,$,G,X,oe,ve){const Se={},be=oe.queryRenderedSymbols(G),Ae=[];for(const We of Object.keys(be).map(Number))Ae.push(ve[We]);Ae.sort(Ft);for(const We of Ae){const Le=We.featureIndex.lookupSymbolFeatures(be[We.bucketInstanceId],B,We.bucketIndex,We.sourceLayerIndex,{filterSpec:X.filter,globalState:X.globalState},X.layers,X.availableImages,R);for(const Je in Le){const et=Se[Je]=Se[Je]||[],Ve=Le[Je];Ve.sort((lt,Tt)=>{const bt=We.featureSortOrder;if(bt){const Pt=bt.indexOf(lt.featureIndex);return bt.indexOf(Tt.featureIndex)-Pt}return Tt.featureIndex-lt.featureIndex});for(const lt of Ve)et.push(lt)}}return function(We,Le,Je){for(const et in We)for(const Ve of We[et])Ue(Ve,Je[Le[et].source]);return We}(Se,R,$)}(this._layers,w,this.tileManagers,t,M,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(t,n){n?.filter&&this._validate(a.C.filter,"querySourceFeatures.filter",n.filter,null,n);const l=this.tileManagers[t];return l?function(h,_){const w=h.getRenderableIds().map(R=>h.getTileByID(R)),P=[],M={};for(let R=0;R<w.length;R++){const B=w[R],$=B.tileID.canonical.key;M[$]||(M[$]=!0,B.querySourceFeatures(P,_))}return P}(l,n?Object.assign(Object.assign({},n),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const l=this.light.getLight();let h=!1;for(const w in t)if(!a.bS(t[w],l[w])){h=!0;break}if(!h)return;const _={now:ce(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(_)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,n={}){this._checkLoaded();const l=this.getSky();let h=!1;if(!t&&!l)return;if(t&&!l)h=!0;else if(!t&&l)h=!0;else for(const w in t)if(!a.bS(t[w],l[w])){h=!0;break}if(!h)return;const _={now:ce(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,n),this.sky.updateTransitions(_)}_setProjectionInternal(t){const n=function(l,h){const _={constrainOverride:h};if(Array.isArray(l)){const w=new Dr({type:l});return{projection:w,transform:new Ms(_),cameraHelper:new Ta(w)}}switch(l){case"mercator":return{projection:new jn,transform:new oa(_),cameraHelper:new Zs};case"globe":{const w=new Dr({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:w,transform:new Ms(_),cameraHelper:new Ta(w)}}case"vertical-perspective":return{projection:new tr,transform:new la(_),cameraHelper:new di};default:return a.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new jn,transform:new oa(_),cameraHelper:new Zs}}}(t,this.map.transformConstrain);this.projection=n.projection,this.map.migrateProjection(n.transform,n.cameraHelper);for(const l in this.tileManagers)this.tileManagers[l].reload()}_validate(t,n,l,h,_={}){return(!_||_.validate!==!1)&&ys(this,t.call(a.C,a.e({key:n,style:this.serialize(),value:l,styleSpec:a.u},h)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),at().off(Ie,this._rtlPluginLoaded);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.tileManagers){const l=this.tileManagers[n];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const n in this.tileManagers)this.tileManagers[n].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,n,l,h,_=!1){let w=!1,P=!1;const M={};for(const R of this._order){const B=this._layers[R];if(B.type!=="symbol")continue;if(!M[B.source]){const G=this.tileManagers[B.source];M[B.source]=G.getRenderableIds(!0).map(X=>G.getTileByID(X)).sort((X,oe)=>oe.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(oe.tileID)?-1:1))}const $=this.crossTileSymbolIndex.addLayer(B,M[B.source],t.center.lng);w=w||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ce(),t.zoom))&&(this.pauseablePlacement=new qs(t,this.map.terrain,this._order,_,n,l,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ce()),P=!0),w&&this.pauseablePlacement.placement.setStale()),P||w)for(const R of this._order){const B=this._layers[R];B.type==="symbol"&&this.placement.updateLayerOpacities(B,M[B.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ce())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,n){return a._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const h=this.tileManagers[n.source];return h&&h.setDependencies(n.tileID.key,n.type,n.icons),l})}getGlyphs(t,n){return a._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(n.stacks),h=this.tileManagers[n.source];return h&&h.setDependencies(n.tileID.key,n.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,n={}){this._checkLoaded(),t&&this._validate(a.C.glyphs,"glyphs",t,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,n){return a._(this,void 0,void 0,function*(){const l={};for(const[h,_]of Object.entries(n.dashes))l[h]=this.lineAtlas.getDash(_.dasharray,_.round);return l})}addSprite(t,n,l={},h){this._checkLoaded();const _=[{id:t,url:n}],w=[...Te(this.stylesheet.sprite),..._];this._validate(a.C.sprite,"sprite",w,null,l)||(this.stylesheet.sprite=w,this._loadSprite(_,!0,h))}removeSprite(t){this._checkLoaded();const n=Te(this.stylesheet.sprite);if(n.find(l=>l.id===t)){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;n.splice(n.findIndex(l=>l.id===t),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}else this.fire(new a.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Te(this.stylesheet.sprite)}setSprite(t,n={},l){this._checkLoaded(),t&&this._validate(a.C.sprite,"sprite",t,null,n)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const n=this.tileManagers[t];n.setEventedParent(null),n.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const n=this._layers[t];n.setEventedParent(null),n.onRemove&&n.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var cs=a.aV([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Bo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,l,h,_,w,P,M,R){this.context=t;let B=this.boundPaintVertexBuffers.length!==h.length;for(let $=0;!B&&$<h.length;$++)this.boundPaintVertexBuffers[$]!==h[$]&&(B=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==l||B||this.boundIndexBuffer!==_||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==P||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==R?this.freshBind(n,l,h,_,w,P,M,R):(t.bindVertexArray.set(this.vao),P&&P.bind(),_&&_.dynamicDraw&&_.bind(),M&&M.bind(),R&&R.bind())}freshBind(t,n,l,h,_,w,P,M){const R=t.numAttributes,B=this.context,$=B.gl;this.vao&&this.destroy(),this.vao=B.createVertexArray(),B.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=P,this.boundDynamicVertexBuffer3=M,n.enableAttributes($,t);for(const G of l)G.enableAttributes($,t);w&&w.enableAttributes($,t),P&&P.enableAttributes($,t),M&&M.enableAttributes($,t),n.bind(),n.setVertexAttribPointers($,t,_);for(const G of l)G.bind(),G.setVertexAttribPointers($,t,_);w&&(w.bind(),w.setVertexAttribPointers($,t,_)),h&&h.bind(),P&&(P.bind(),P.setVertexAttribPointers($,t,_)),M&&(M.bind(),M.setVertexAttribPointers($,t,_)),B.currentNumAttributes=R}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const gl=(g,t,n,l,h)=>({u_texture:0,u_ele_delta:g,u_fog_matrix:t,u_fog_color:n?n.properties.get("fog-color"):a.bq.white,u_fog_ground_blend:n?n.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:h?0:n?n.calculateFogBlendOpacity(l):0,u_horizon_color:n?n.properties.get("horizon-color"):a.bq.white,u_horizon_fog_blend:n?n.properties.get("horizon-fog-blend"):1,u_is_globe_mode:h?1:0}),ja={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function fn(g){const t=[];for(let n=0;n<g.length;n++){if(g[n]===null)continue;const l=g[n].split(" ");t.push(l.pop())}return t}class Cs{constructor(t,n,l,h,_,w,P,M,R=[]){const B=t.gl;this.program=B.createProgram();const $=fn(n.staticAttributes),G=l?l.getBinderAttributes():[],X=$.concat(G),oe=Ui.prelude.staticUniforms?fn(Ui.prelude.staticUniforms):[],ve=P.staticUniforms?fn(P.staticUniforms):[],Se=n.staticUniforms?fn(n.staticUniforms):[],be=l?l.getBinderUniforms():[],Ae=oe.concat(ve).concat(Se).concat(be),We=[];for(const bt of Ae)We.indexOf(bt)<0&&We.push(bt);const Le=l?l.defines():[];ie(B)&&Le.unshift("#version 300 es"),_&&Le.push("#define OVERDRAW_INSPECTOR;"),w&&Le.push("#define TERRAIN3D;"),M&&Le.push(M),R&&Le.push(...R);let Je=Le.concat(Ui.prelude.fragmentSource,P.fragmentSource,n.fragmentSource).join(`
`),et=Le.concat(Ui.prelude.vertexSource,P.vertexSource,n.vertexSource).join(`
`);ie(B)||(Je=function(bt){return bt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(Je),et=function(bt){return bt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(et));const Ve=B.createShader(B.FRAGMENT_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(Ve,Je),B.compileShader(Ve),!B.getShaderParameter(Ve,B.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${B.getShaderInfoLog(Ve)}`);B.attachShader(this.program,Ve);const lt=B.createShader(B.VERTEX_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(lt,et),B.compileShader(lt),!B.getShaderParameter(lt,B.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${B.getShaderInfoLog(lt)}`);B.attachShader(this.program,lt),this.attributes={};const Tt={};this.numAttributes=X.length;for(let bt=0;bt<this.numAttributes;bt++)X[bt]&&(B.bindAttribLocation(this.program,bt,X[bt]),this.attributes[X[bt]]=bt);if(B.linkProgram(this.program),!B.getProgramParameter(this.program,B.LINK_STATUS))throw new Error(`Program failed to link: ${B.getProgramInfoLog(this.program)}`);B.deleteShader(lt),B.deleteShader(Ve);for(let bt=0;bt<We.length;bt++){const Pt=We[bt];if(Pt&&!Tt[Pt]){const Ct=B.getUniformLocation(this.program,Pt);Ct&&(Tt[Pt]=Ct)}}this.fixedUniforms=h(t,Tt),this.terrainUniforms=((bt,Pt)=>({u_depth:new a.b$(bt,Pt.u_depth),u_terrain:new a.b$(bt,Pt.u_terrain),u_terrain_dim:new a.br(bt,Pt.u_terrain_dim),u_terrain_matrix:new a.c1(bt,Pt.u_terrain_matrix),u_terrain_unpack:new a.c2(bt,Pt.u_terrain_unpack),u_terrain_exaggeration:new a.br(bt,Pt.u_terrain_exaggeration)}))(t,Tt),this.projectionUniforms=((bt,Pt)=>({u_projection_matrix:new a.c1(bt,Pt.u_projection_matrix),u_projection_tile_mercator_coords:new a.c2(bt,Pt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new a.c2(bt,Pt.u_projection_clipping_plane),u_projection_transition:new a.br(bt,Pt.u_projection_transition),u_projection_fallback_matrix:new a.c1(bt,Pt.u_projection_fallback_matrix)}))(t,Tt),this.binderUniforms=l?l.getUniforms(t,Tt):[]}draw(t,n,l,h,_,w,P,M,R,B,$,G,X,oe,ve,Se,be,Ae,We){const Le=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(h),t.setColorMode(_),t.setCullFace(w),M){t.activeTexture.set(Le.TEXTURE2),Le.bindTexture(Le.TEXTURE_2D,M.depthTexture),t.activeTexture.set(Le.TEXTURE3),Le.bindTexture(Le.TEXTURE_2D,M.texture);for(const et in this.terrainUniforms)this.terrainUniforms[et].set(M[et])}if(R)for(const et in R)this.projectionUniforms[ja[et]].set(R[et]);if(P)for(const et in this.fixedUniforms)this.fixedUniforms[et].set(P[et]);Se&&Se.setUniforms(t,this.binderUniforms,oe,{zoom:ve});let Je=0;switch(n){case Le.LINES:Je=2;break;case Le.TRIANGLES:Je=3;break;case Le.LINE_STRIP:Je=1}for(const et of X.get()){const Ve=et.vaos||(et.vaos={});(Ve[B]||(Ve[B]=new Bo)).bind(t,this,$,Se?Se.getPaintVertexBuffers():[],G,et.vertexOffset,be,Ae,We),Le.drawElements(n,et.primitiveLength*Je,Le.UNSIGNED_SHORT,et.primitiveOffset*Je*2)}}}function _l(g,t,n){const l=1/a.aO(n,1,t.transform.tileZoom),h=Math.pow(2,n.tileID.overscaledZ),_=n.tileSize*Math.pow(2,t.transform.tileZoom)/h,w=_*(n.tileID.canonical.x+n.tileID.wrap*h),P=_*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[l,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[w>>16,P>>16],u_pixel_coord_lower:[65535&w,65535&P]}}const jo=(g,t,n,l)=>{const h=g.style.light,_=h.properties.get("position"),w=[_.x,_.y,_.z],P=a.c5();h.properties.get("anchor")==="viewport"&&a.c6(P,g.transform.bearingInRadians),a.c7(w,w,P);const M=g.transform.transformLightDirection(w),R=h.properties.get("color");return{u_lightpos:w,u_lightpos_globe:M,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+t,u_opacity:n,u_fill_translate:l}},Aa=(g,t,n,l,h,_,w)=>a.e(jo(g,t,n,l),_l(_,g,w),{u_height_factor:-Math.pow(2,h.overscaledZ)/w.tileSize/8}),ho=(g,t,n,l)=>a.e(_l(t,g,n),{u_fill_translate:l}),us=(g,t)=>({u_world:g,u_fill_translate:t}),hs=(g,t,n,l,h)=>a.e(ho(g,t,n,h),{u_world:l}),fo=(g,t,n,l,h)=>{const _=g.transform;let w,P,M=0;if(n.paint.get("circle-pitch-alignment")==="map"){const R=a.aO(t,1,_.zoom);w=!0,P=[R,R],M=R/(a.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*h}else w=!1,P=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(n.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+w,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:P,u_globe_extrude_scale:M,u_translate:l}},Jn=g=>({u_pixel_extrude_scale:[1/g.width,1/g.height]}),Ua=g=>({u_viewport_size:[g.width,g.height]}),Uo=(g,t=1)=>({u_color:g,u_overlay:0,u_overlay_scale:t}),ks=(g,t,n,l)=>{const h=a.aO(g,1,t)/(a.a5*Math.pow(2,g.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:a.aO(g,1,t),u_intensity:n,u_globe_extrude_scale:h}},an=(g,t,n,l)=>{const h=a.N();a.c8(h,0,g.width,g.height,0,0,1);const _=g.context.gl;return{u_matrix:h,u_world:[_.drawingBufferWidth,_.drawingBufferHeight],u_image:n,u_color_ramp:l,u_opacity:t.paint.get("heatmap-opacity")}},yl=(g,t,n)=>{const l=n.paint.get("hillshade-accent-color");let h;switch(n.paint.get("hillshade-method")){case"basic":h=4;break;case"combined":h=1;break;case"igor":h=2;break;case"multidirectional":h=3;break;default:h=0}const _=n.getIlluminationProperties();for(let w=0;w<_.directionRadians.length;w++)n.paint.get("hillshade-illumination-anchor")==="viewport"&&(_.directionRadians[w]+=g.transform.bearingInRadians);return{u_image:0,u_latrange:Ea(0,t.tileID),u_exaggeration:n.paint.get("hillshade-exaggeration"),u_altitudes:_.altitudeRadians,u_azimuths:_.directionRadians,u_accent:l,u_method:h,u_highlights:_.highlightColor,u_shadows:_.shadowColor}},Ia=(g,t)=>{const n=t.stride,l=a.N();return a.c8(l,0,a.a5,-a.a5,0,0,1),a.O(l,l,[0,-a.a5,0]),{u_matrix:l,u_image:1,u_dimension:[n,n],u_zoom:g.overscaledZ,u_unpack:t.getUnpackVector()}};function Ea(g,t){const n=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new a.ab(0,l/n).toLngLat().lat,new a.ab(0,(l+1)/n).toLngLat().lat]}const Vo=(g,t,n=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:n,u_opacity:g.paint.get("color-relief-opacity")}),Va=(g,t,n,l)=>{const h=g.transform;return{u_translation:go(g,t,n),u_ratio:l/a.aO(t,1,h.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},qo=(g,t,n,l,h)=>a.e(Va(g,t,n,l),{u_image:0,u_image_height:h}),po=(g,t,n,l,h)=>{const _=g.transform,w=An(t,_);return{u_translation:go(g,t,n),u_texsize:t.imageAtlasTexture.size,u_ratio:l/a.aO(t,1,_.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[w,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},mo=(g,t,n,l,h)=>{const _=An(t,g.transform);return a.e(Va(g,t,n,l),{u_tileratio:_,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image:0,u_mix:h.t,u_lineatlas_width:g.lineAtlas.width,u_lineatlas_height:g.lineAtlas.height})},La=(g,t,n,l,h,_)=>{const w=An(t,g.transform);return a.e(Va(g,t,n,l),{u_image:0,u_image_height:_,u_tileratio:w,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image_dash:1,u_mix:h.t,u_lineatlas_width:g.lineAtlas.width,u_lineatlas_height:g.lineAtlas.height})};function An(g,t){return 1/a.aO(g,1,t.tileZoom)}function go(g,t,n){return a.aP(g.transform,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const ds=(g,t,n,l,h)=>{return{u_tl_parent:g,u_scale_parent:t,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(w=l.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(_=l.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:Xs(l.paint.get("raster-hue-rotate")),u_coords_top:[h[0].x,h[0].y,h[1].x,h[1].y],u_coords_bottom:[h[3].x,h[3].y,h[2].x,h[2].y]};var _,w};function Xs(g){g*=Math.PI/180;const t=Math.sin(g),n=Math.cos(g);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const Ci=(g,t,n,l,h,_,w,P,M,R,B,$,G)=>{const X=w.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:X.cameraToCenterDistance,u_pitch:X.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:X.width/X.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_label_plane_matrix:P,u_coord_matrix:M,u_is_text:+B,u_pitch_with_map:+l,u_is_along_line:h,u_is_variable_anchor:_,u_texsize:$,u_texture:0,u_translation:R,u_pitched_scale:G}},Ii=(g,t,n,l,h,_,w,P,M,R,B,$,G,X)=>{const oe=w.transform;return a.e(Ci(g,t,n,l,h,_,w,P,M,R,B,$,X),{u_gamma_scale:l?Math.cos(oe.pitch*Math.PI/180)*oe.cameraToCenterDistance:1,u_device_pixel_ratio:w.pixelRatio,u_is_halo:1})},Ri=(g,t,n,l,h,_,w,P,M,R,B,$,G)=>a.e(Ii(g,t,n,l,h,_,w,P,M,R,!0,B,0,G),{u_texsize_icon:$,u_texture_icon:1}),Qi=(g,t)=>({u_opacity:g,u_color:t}),qa=(g,t,n,l,h)=>a.e(function(_,w,P,M){const R=P.imageManager.getPattern(_.from.toString()),B=P.imageManager.getPattern(_.to.toString()),{width:$,height:G}=P.imageManager.getPixelSize(),X=Math.pow(2,M.tileID.overscaledZ),oe=M.tileSize*Math.pow(2,P.transform.tileZoom)/X,ve=oe*(M.tileID.canonical.x+M.tileID.wrap*X),Se=oe*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[$,G],u_mix:w.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/a.aO(M,1,P.transform.tileZoom),u_pixel_coord_upper:[ve>>16,Se>>16],u_pixel_coord_lower:[65535&ve,65535&Se]}}(n,h,t,l),{u_opacity:g}),Go=(g,t)=>{},Ma={fillExtrusion:(g,t)=>({u_lightpos:new a.c3(g,t.u_lightpos),u_lightpos_globe:new a.c3(g,t.u_lightpos_globe),u_lightintensity:new a.br(g,t.u_lightintensity),u_lightcolor:new a.c3(g,t.u_lightcolor),u_vertical_gradient:new a.br(g,t.u_vertical_gradient),u_opacity:new a.br(g,t.u_opacity),u_fill_translate:new a.c4(g,t.u_fill_translate)}),fillExtrusionPattern:(g,t)=>({u_lightpos:new a.c3(g,t.u_lightpos),u_lightpos_globe:new a.c3(g,t.u_lightpos_globe),u_lightintensity:new a.br(g,t.u_lightintensity),u_lightcolor:new a.c3(g,t.u_lightcolor),u_vertical_gradient:new a.br(g,t.u_vertical_gradient),u_height_factor:new a.br(g,t.u_height_factor),u_opacity:new a.br(g,t.u_opacity),u_fill_translate:new a.c4(g,t.u_fill_translate),u_image:new a.b$(g,t.u_image),u_texsize:new a.c4(g,t.u_texsize),u_pixel_coord_upper:new a.c4(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.c4(g,t.u_pixel_coord_lower),u_scale:new a.c3(g,t.u_scale),u_fade:new a.br(g,t.u_fade)}),fill:(g,t)=>({u_fill_translate:new a.c4(g,t.u_fill_translate)}),fillPattern:(g,t)=>({u_image:new a.b$(g,t.u_image),u_texsize:new a.c4(g,t.u_texsize),u_pixel_coord_upper:new a.c4(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.c4(g,t.u_pixel_coord_lower),u_scale:new a.c3(g,t.u_scale),u_fade:new a.br(g,t.u_fade),u_fill_translate:new a.c4(g,t.u_fill_translate)}),fillOutline:(g,t)=>({u_world:new a.c4(g,t.u_world),u_fill_translate:new a.c4(g,t.u_fill_translate)}),fillOutlinePattern:(g,t)=>({u_world:new a.c4(g,t.u_world),u_image:new a.b$(g,t.u_image),u_texsize:new a.c4(g,t.u_texsize),u_pixel_coord_upper:new a.c4(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.c4(g,t.u_pixel_coord_lower),u_scale:new a.c3(g,t.u_scale),u_fade:new a.br(g,t.u_fade),u_fill_translate:new a.c4(g,t.u_fill_translate)}),circle:(g,t)=>({u_camera_to_center_distance:new a.br(g,t.u_camera_to_center_distance),u_scale_with_map:new a.b$(g,t.u_scale_with_map),u_pitch_with_map:new a.b$(g,t.u_pitch_with_map),u_extrude_scale:new a.c4(g,t.u_extrude_scale),u_device_pixel_ratio:new a.br(g,t.u_device_pixel_ratio),u_globe_extrude_scale:new a.br(g,t.u_globe_extrude_scale),u_translate:new a.c4(g,t.u_translate)}),collisionBox:(g,t)=>({u_pixel_extrude_scale:new a.c4(g,t.u_pixel_extrude_scale)}),collisionCircle:(g,t)=>({u_viewport_size:new a.c4(g,t.u_viewport_size)}),debug:(g,t)=>({u_color:new a.c0(g,t.u_color),u_overlay:new a.b$(g,t.u_overlay),u_overlay_scale:new a.br(g,t.u_overlay_scale)}),depth:Go,clippingMask:Go,heatmap:(g,t)=>({u_extrude_scale:new a.br(g,t.u_extrude_scale),u_intensity:new a.br(g,t.u_intensity),u_globe_extrude_scale:new a.br(g,t.u_globe_extrude_scale)}),heatmapTexture:(g,t)=>({u_matrix:new a.c1(g,t.u_matrix),u_world:new a.c4(g,t.u_world),u_image:new a.b$(g,t.u_image),u_color_ramp:new a.b$(g,t.u_color_ramp),u_opacity:new a.br(g,t.u_opacity)}),hillshade:(g,t)=>({u_image:new a.b$(g,t.u_image),u_latrange:new a.c4(g,t.u_latrange),u_exaggeration:new a.br(g,t.u_exaggeration),u_altitudes:new a.ca(g,t.u_altitudes),u_azimuths:new a.ca(g,t.u_azimuths),u_accent:new a.c0(g,t.u_accent),u_method:new a.b$(g,t.u_method),u_shadows:new a.c9(g,t.u_shadows),u_highlights:new a.c9(g,t.u_highlights)}),hillshadePrepare:(g,t)=>({u_matrix:new a.c1(g,t.u_matrix),u_image:new a.b$(g,t.u_image),u_dimension:new a.c4(g,t.u_dimension),u_zoom:new a.br(g,t.u_zoom),u_unpack:new a.c2(g,t.u_unpack)}),colorRelief:(g,t)=>({u_image:new a.b$(g,t.u_image),u_unpack:new a.c2(g,t.u_unpack),u_dimension:new a.c4(g,t.u_dimension),u_elevation_stops:new a.b$(g,t.u_elevation_stops),u_color_stops:new a.b$(g,t.u_color_stops),u_color_ramp_size:new a.b$(g,t.u_color_ramp_size),u_opacity:new a.br(g,t.u_opacity)}),line:(g,t)=>({u_translation:new a.c4(g,t.u_translation),u_ratio:new a.br(g,t.u_ratio),u_device_pixel_ratio:new a.br(g,t.u_device_pixel_ratio),u_units_to_pixels:new a.c4(g,t.u_units_to_pixels)}),lineGradient:(g,t)=>({u_translation:new a.c4(g,t.u_translation),u_ratio:new a.br(g,t.u_ratio),u_device_pixel_ratio:new a.br(g,t.u_device_pixel_ratio),u_units_to_pixels:new a.c4(g,t.u_units_to_pixels),u_image:new a.b$(g,t.u_image),u_image_height:new a.br(g,t.u_image_height)}),linePattern:(g,t)=>({u_translation:new a.c4(g,t.u_translation),u_texsize:new a.c4(g,t.u_texsize),u_ratio:new a.br(g,t.u_ratio),u_device_pixel_ratio:new a.br(g,t.u_device_pixel_ratio),u_image:new a.b$(g,t.u_image),u_units_to_pixels:new a.c4(g,t.u_units_to_pixels),u_scale:new a.c3(g,t.u_scale),u_fade:new a.br(g,t.u_fade)}),lineSDF:(g,t)=>({u_translation:new a.c4(g,t.u_translation),u_ratio:new a.br(g,t.u_ratio),u_device_pixel_ratio:new a.br(g,t.u_device_pixel_ratio),u_units_to_pixels:new a.c4(g,t.u_units_to_pixels),u_image:new a.b$(g,t.u_image),u_mix:new a.br(g,t.u_mix),u_tileratio:new a.br(g,t.u_tileratio),u_crossfade_from:new a.br(g,t.u_crossfade_from),u_crossfade_to:new a.br(g,t.u_crossfade_to),u_lineatlas_width:new a.br(g,t.u_lineatlas_width),u_lineatlas_height:new a.br(g,t.u_lineatlas_height)}),lineGradientSDF:(g,t)=>({u_translation:new a.c4(g,t.u_translation),u_ratio:new a.br(g,t.u_ratio),u_device_pixel_ratio:new a.br(g,t.u_device_pixel_ratio),u_units_to_pixels:new a.c4(g,t.u_units_to_pixels),u_image:new a.b$(g,t.u_image),u_image_height:new a.br(g,t.u_image_height),u_tileratio:new a.br(g,t.u_tileratio),u_crossfade_from:new a.br(g,t.u_crossfade_from),u_crossfade_to:new a.br(g,t.u_crossfade_to),u_image_dash:new a.b$(g,t.u_image_dash),u_mix:new a.br(g,t.u_mix),u_lineatlas_width:new a.br(g,t.u_lineatlas_width),u_lineatlas_height:new a.br(g,t.u_lineatlas_height)}),raster:(g,t)=>({u_tl_parent:new a.c4(g,t.u_tl_parent),u_scale_parent:new a.br(g,t.u_scale_parent),u_buffer_scale:new a.br(g,t.u_buffer_scale),u_fade_t:new a.br(g,t.u_fade_t),u_opacity:new a.br(g,t.u_opacity),u_image0:new a.b$(g,t.u_image0),u_image1:new a.b$(g,t.u_image1),u_brightness_low:new a.br(g,t.u_brightness_low),u_brightness_high:new a.br(g,t.u_brightness_high),u_saturation_factor:new a.br(g,t.u_saturation_factor),u_contrast_factor:new a.br(g,t.u_contrast_factor),u_spin_weights:new a.c3(g,t.u_spin_weights),u_coords_top:new a.c2(g,t.u_coords_top),u_coords_bottom:new a.c2(g,t.u_coords_bottom)}),symbolIcon:(g,t)=>({u_is_size_zoom_constant:new a.b$(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.b$(g,t.u_is_size_feature_constant),u_size_t:new a.br(g,t.u_size_t),u_size:new a.br(g,t.u_size),u_camera_to_center_distance:new a.br(g,t.u_camera_to_center_distance),u_pitch:new a.br(g,t.u_pitch),u_rotate_symbol:new a.b$(g,t.u_rotate_symbol),u_aspect_ratio:new a.br(g,t.u_aspect_ratio),u_fade_change:new a.br(g,t.u_fade_change),u_label_plane_matrix:new a.c1(g,t.u_label_plane_matrix),u_coord_matrix:new a.c1(g,t.u_coord_matrix),u_is_text:new a.b$(g,t.u_is_text),u_pitch_with_map:new a.b$(g,t.u_pitch_with_map),u_is_along_line:new a.b$(g,t.u_is_along_line),u_is_variable_anchor:new a.b$(g,t.u_is_variable_anchor),u_texsize:new a.c4(g,t.u_texsize),u_texture:new a.b$(g,t.u_texture),u_translation:new a.c4(g,t.u_translation),u_pitched_scale:new a.br(g,t.u_pitched_scale)}),symbolSDF:(g,t)=>({u_is_size_zoom_constant:new a.b$(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.b$(g,t.u_is_size_feature_constant),u_size_t:new a.br(g,t.u_size_t),u_size:new a.br(g,t.u_size),u_camera_to_center_distance:new a.br(g,t.u_camera_to_center_distance),u_pitch:new a.br(g,t.u_pitch),u_rotate_symbol:new a.b$(g,t.u_rotate_symbol),u_aspect_ratio:new a.br(g,t.u_aspect_ratio),u_fade_change:new a.br(g,t.u_fade_change),u_label_plane_matrix:new a.c1(g,t.u_label_plane_matrix),u_coord_matrix:new a.c1(g,t.u_coord_matrix),u_is_text:new a.b$(g,t.u_is_text),u_pitch_with_map:new a.b$(g,t.u_pitch_with_map),u_is_along_line:new a.b$(g,t.u_is_along_line),u_is_variable_anchor:new a.b$(g,t.u_is_variable_anchor),u_texsize:new a.c4(g,t.u_texsize),u_texture:new a.b$(g,t.u_texture),u_gamma_scale:new a.br(g,t.u_gamma_scale),u_device_pixel_ratio:new a.br(g,t.u_device_pixel_ratio),u_is_halo:new a.b$(g,t.u_is_halo),u_translation:new a.c4(g,t.u_translation),u_pitched_scale:new a.br(g,t.u_pitched_scale)}),symbolTextAndIcon:(g,t)=>({u_is_size_zoom_constant:new a.b$(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.b$(g,t.u_is_size_feature_constant),u_size_t:new a.br(g,t.u_size_t),u_size:new a.br(g,t.u_size),u_camera_to_center_distance:new a.br(g,t.u_camera_to_center_distance),u_pitch:new a.br(g,t.u_pitch),u_rotate_symbol:new a.b$(g,t.u_rotate_symbol),u_aspect_ratio:new a.br(g,t.u_aspect_ratio),u_fade_change:new a.br(g,t.u_fade_change),u_label_plane_matrix:new a.c1(g,t.u_label_plane_matrix),u_coord_matrix:new a.c1(g,t.u_coord_matrix),u_is_text:new a.b$(g,t.u_is_text),u_pitch_with_map:new a.b$(g,t.u_pitch_with_map),u_is_along_line:new a.b$(g,t.u_is_along_line),u_is_variable_anchor:new a.b$(g,t.u_is_variable_anchor),u_texsize:new a.c4(g,t.u_texsize),u_texsize_icon:new a.c4(g,t.u_texsize_icon),u_texture:new a.b$(g,t.u_texture),u_texture_icon:new a.b$(g,t.u_texture_icon),u_gamma_scale:new a.br(g,t.u_gamma_scale),u_device_pixel_ratio:new a.br(g,t.u_device_pixel_ratio),u_is_halo:new a.b$(g,t.u_is_halo),u_translation:new a.c4(g,t.u_translation),u_pitched_scale:new a.br(g,t.u_pitched_scale)}),background:(g,t)=>({u_opacity:new a.br(g,t.u_opacity),u_color:new a.c0(g,t.u_color)}),backgroundPattern:(g,t)=>({u_opacity:new a.br(g,t.u_opacity),u_image:new a.b$(g,t.u_image),u_pattern_tl_a:new a.c4(g,t.u_pattern_tl_a),u_pattern_br_a:new a.c4(g,t.u_pattern_br_a),u_pattern_tl_b:new a.c4(g,t.u_pattern_tl_b),u_pattern_br_b:new a.c4(g,t.u_pattern_br_b),u_texsize:new a.c4(g,t.u_texsize),u_mix:new a.br(g,t.u_mix),u_pattern_size_a:new a.c4(g,t.u_pattern_size_a),u_pattern_size_b:new a.c4(g,t.u_pattern_size_b),u_scale_a:new a.br(g,t.u_scale_a),u_scale_b:new a.br(g,t.u_scale_b),u_pixel_coord_upper:new a.c4(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.c4(g,t.u_pixel_coord_lower),u_tile_units_to_pixels:new a.br(g,t.u_tile_units_to_pixels)}),terrain:(g,t)=>({u_texture:new a.b$(g,t.u_texture),u_ele_delta:new a.br(g,t.u_ele_delta),u_fog_matrix:new a.c1(g,t.u_fog_matrix),u_fog_color:new a.c0(g,t.u_fog_color),u_fog_ground_blend:new a.br(g,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.br(g,t.u_fog_ground_blend_opacity),u_horizon_color:new a.c0(g,t.u_horizon_color),u_horizon_fog_blend:new a.br(g,t.u_horizon_fog_blend),u_is_globe_mode:new a.br(g,t.u_is_globe_mode)}),terrainDepth:(g,t)=>({u_ele_delta:new a.br(g,t.u_ele_delta)}),terrainCoords:(g,t)=>({u_texture:new a.b$(g,t.u_texture),u_terrain_coords_id:new a.br(g,t.u_terrain_coords_id),u_ele_delta:new a.br(g,t.u_ele_delta)}),projectionErrorMeasurement:(g,t)=>({u_input:new a.br(g,t.u_input),u_output_expected:new a.br(g,t.u_output_expected)}),atmosphere:(g,t)=>({u_sun_pos:new a.c3(g,t.u_sun_pos),u_atmosphere_blend:new a.br(g,t.u_atmosphere_blend),u_globe_position:new a.c3(g,t.u_globe_position),u_globe_radius:new a.br(g,t.u_globe_radius),u_inv_proj_matrix:new a.c1(g,t.u_inv_proj_matrix)}),sky:(g,t)=>({u_sky_color:new a.c0(g,t.u_sky_color),u_horizon_color:new a.c0(g,t.u_horizon_color),u_horizon:new a.c4(g,t.u_horizon),u_horizon_normal:new a.c4(g,t.u_horizon_normal),u_sky_horizon_blend:new a.br(g,t.u_sky_horizon_blend),u_sky_blend:new a.br(g,t.u_sky_blend)})};class Gl{constructor(t,n,l){this.context=t;const h=t.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Hc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Au{constructor(t,n,l,h){this.length=n.length,this.attributes=l,this.itemSize=n.bytesPerElement,this.dynamicDraw=h,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),t.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let l=0;l<this.attributes.length;l++){const h=n.attributes[this.attributes[l].name];h!==void 0&&t.enableVertexAttribArray(h)}}setVertexAttribPointers(t,n,l){for(let h=0;h<this.attributes.length;h++){const _=this.attributes[h],w=n.attributes[_.name];w!==void 0&&t.vertexAttribPointer(w,_.components,t[Hc[_.type]],!1,this.itemSize,_.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class gi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class $l extends gi{getDefault(){return a.bq.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Zl extends gi{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Wl extends gi{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class bc extends gi{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class _o extends gi{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class vl extends gi{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class $o extends gi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Ds extends gi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Xc extends gi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class bl extends gi{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class xc extends gi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class yo extends gi{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Hl extends gi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class Xl extends gi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class xl extends gi{getDefault(){return a.bq.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Yl extends gi{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Yc extends gi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class Zo extends gi{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class vo extends gi{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Jl extends gi{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class fs extends gi{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Zr extends gi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Wo extends gi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class wc extends gi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Jc extends gi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class bo extends gi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Sc extends gi{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Kc extends gi{getDefault(){return null}set(t){var n;if(t===this.current&&!this.dirty)return;const l=this.gl;ie(l)?l.bindVertexArray(t):(n=l.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Qc extends gi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class eu extends gi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Kl extends gi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Ga extends gi{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class wl extends Ga{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Tc extends Ga{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class tu extends Ga{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const Pc="Framebuffer is not complete";class Ac{constructor(t,n,l,h,_){this.context=t,this.width=n,this.height=l;const w=t.gl,P=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new wl(t,P),h)this.depthAttachment=_?new tu(t,P):new Tc(t,P);else if(_)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error(Pc)}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class Ic{constructor(t){var n,l;if(this.gl=t,this.clearColor=new $l(this),this.clearDepth=new Zl(this),this.clearStencil=new Wl(this),this.colorMask=new bc(this),this.depthMask=new _o(this),this.stencilMask=new vl(this),this.stencilFunc=new $o(this),this.stencilOp=new Ds(this),this.stencilTest=new Xc(this),this.depthRange=new bl(this),this.depthTest=new xc(this),this.depthFunc=new yo(this),this.blend=new Hl(this),this.blendFunc=new Xl(this),this.blendColor=new xl(this),this.blendEquation=new Yl(this),this.cullFace=new Yc(this),this.cullFaceSide=new Zo(this),this.frontFace=new vo(this),this.program=new Jl(this),this.activeTexture=new fs(this),this.viewport=new Zr(this),this.bindFramebuffer=new Wo(this),this.bindRenderbuffer=new wc(this),this.bindTexture=new Jc(this),this.bindVertexBuffer=new bo(this),this.bindElementBuffer=new Sc(this),this.bindVertexArray=new Kc(this),this.pixelStoreUnpack=new Qc(this),this.pixelStoreUnpackPremultiplyAlpha=new eu(this),this.pixelStoreUnpackFlipY=new Kl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),ie(t)){this.HALF_FLOAT=t.HALF_FLOAT;const h=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=t.RGBA16F)!==null&&n!==void 0?n:h?.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:h?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const h=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=h?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new Gl(this,t,n)}createVertexBuffer(t,n,l){return new Au(this,t,n,l)}createRenderbuffer(t,n,l){const h=this.gl,_=h.createRenderbuffer();return this.bindRenderbuffer.set(_),h.renderbufferStorage(h.RENDERBUFFER,t,n,l),this.bindRenderbuffer.set(null),_}createFramebuffer(t,n,l,h){return new Ac(this,t,n,l,h)}clear({color:t,depth:n,stencil:l}){const h=this.gl;let _=0;t&&(_|=h.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(_|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),l!==void 0&&(_|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),h.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){a.bS(t.blendFunction,vi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return ie(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var n;return ie(this.gl)?this.gl.deleteVertexArray(t):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Ho;function Xo(g,t,n,l,h){const _=g.context,w=g.transform,P=_.gl,M=g.useProgram("collisionBox"),R=[];let B=0,$=0;for(let be=0;be<l.length;be++){const Ae=l[be],We=t.getTile(Ae).getBucket(n);if(!We)continue;const Le=h?We.textCollisionBox:We.iconCollisionBox,Je=We.collisionCircleArray;Je.length>0&&(R.push({circleArray:Je,circleOffset:$,coord:Ae}),B+=Je.length/4,$=B),Le&&M.draw(_,P.LINES,Hr.disabled,Kr.disabled,g.colorModeForRenderPass(),ni.disabled,Jn(g.transform),g.style.map.terrain&&g.style.map.terrain.getTerrainData(Ae),w.getProjectionData({overscaledTileID:Ae,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),n.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,null,g.transform.zoom,null,null,Le.collisionVertexBuffer)}if(!h||!R.length)return;const G=g.useProgram("collisionCircle"),X=new a.cb;X.resize(4*B),X._trim();let oe=0;for(const be of R)for(let Ae=0;Ae<be.circleArray.length/4;Ae++){const We=4*Ae,Le=be.circleArray[We+0],Je=be.circleArray[We+1],et=be.circleArray[We+2],Ve=be.circleArray[We+3];X.emplace(oe++,Le,Je,et,Ve,0),X.emplace(oe++,Le,Je,et,Ve,1),X.emplace(oe++,Le,Je,et,Ve,2),X.emplace(oe++,Le,Je,et,Ve,3)}(!Ho||Ho.length<2*B)&&(Ho=function(be){const Ae=2*be,We=new a.cd;We.resize(Ae),We._trim();for(let Le=0;Le<Ae;Le++){const Je=6*Le;We.uint16[Je+0]=4*Le+0,We.uint16[Je+1]=4*Le+1,We.uint16[Je+2]=4*Le+2,We.uint16[Je+3]=4*Le+2,We.uint16[Je+4]=4*Le+3,We.uint16[Je+5]=4*Le+0}return We}(B));const ve=_.createIndexBuffer(Ho,!0),Se=_.createVertexBuffer(X,a.cc.members,!0);for(const be of R){const Ae=Ua(g.transform);G.draw(_,P.TRIANGLES,Hr.disabled,Kr.disabled,g.colorModeForRenderPass(),ni.disabled,Ae,g.style.map.terrain&&g.style.map.terrain.getTerrainData(be.coord),null,n.id,Se,ve,a.aY.simpleSegment(0,2*be.circleOffset,be.circleArray.length,be.circleArray.length/2),null,g.transform.zoom,null,null,null)}Se.destroy(),ve.destroy()}const ru=a.as(new Float32Array(16));function iu(g,t,n,l,h,_){const{horizontalAlign:w,verticalAlign:P}=a.aT(g);return new a.P((-(w-.5)*t/h+l[0])*_,(-(P-.5)*n/h+l[1])*_)}function Yo(g,t,n,l,h,_){const w=t.tileAnchorPoint.add(new a.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let P=l.mult(_);n||(P=P.rotate(-h));const M=w.add(P);return Gr(M.x,M.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(n){const P=mi(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(g),M=Math.atan(P.y/P.x)+(P.x<0?Math.PI:0);return g.add(l.rotate(M))}return g.add(l)}function Ql(g,t,n,l,h,_,w,P,M,R,B,$){const G=g.text.placedSymbolArray,X=g.text.dynamicLayoutVertexArray,oe=g.icon.dynamicLayoutVertexArray,ve={};X.clear();for(let Se=0;Se<G.length;Se++){const be=G.get(Se),Ae=be.hidden||!be.crossTileID||g.allowVerticalPlacement&&!be.placedOrientation?null:l[be.crossTileID];if(Ae){const We=new a.P(be.anchorX,be.anchorY),Le={getElevation:$,width:h.width,height:h.height,pitchedLabelPlaneMatrix:_,pitchWithMap:n,transform:h,tileAnchorPoint:We,translation:R,unwrappedTileID:B},Je=n?ba(We.x,We.y,Le):mi(We.x,We.y,Le),et=ya(h.cameraToCenterDistance,Je.signedDistanceFromCamera);let Ve=a.aB(g.textSizeData,P,be)*et/a.aN;n&&(Ve*=g.tilePixelRatio/w);const{width:lt,height:Tt,anchor:bt,textOffset:Pt,textBoxScale:Ct}=Ae,Jt=iu(bt,lt,Tt,Pt,Ct,Ve),ar=h.getPitchedTextCorrection(We.x+R[0],We.y+R[1],B),Yt=Yo(Je.point,Le,t,Jt,-h.bearingInRadians,ar),xr=g.allowVerticalPlacement&&be.placedOrientation===a.aA.vertical?Math.PI/2:0;for(let Jr=0;Jr<be.numGlyphs;Jr++)a.aH(X,Yt,xr);M&&be.associatedIconIndex>=0&&(ve[be.associatedIconIndex]={shiftedAnchor:Yt,angle:xr})}else Oa(be.numGlyphs,X)}if(M){oe.clear();const Se=g.icon.placedSymbolArray;for(let be=0;be<Se.length;be++){const Ae=Se.get(be);if(Ae.hidden)Oa(Ae.numGlyphs,oe);else{const We=ve[be];if(We)for(let Le=0;Le<Ae.numGlyphs;Le++)a.aH(oe,We.shiftedAnchor,We.angle);else Oa(Ae.numGlyphs,oe)}}g.icon.dynamicLayoutVertexBuffer.updateData(oe)}g.text.dynamicLayoutVertexBuffer.updateData(X)}function Iu(g,t,n){return n.iconsInText&&t?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function ec(g,t,n,l,h,_,w,P,M,R,B,$,G){const X=g.context,oe=X.gl,ve=g.transform,Se=P==="map",be=M==="map",Ae=P!=="viewport"&&n.layout.get("symbol-placement")!=="point",We=Se&&!be&&!Ae,Le=!n.layout.get("symbol-sort-key").isConstant();let Je=!1;const et=g.getDepthModeForSublayer(0,Hr.ReadOnly),Ve=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),lt=[],Tt=ve.getCircleRadiusCorrection();for(const bt of l){const Pt=t.getTile(bt),Ct=Pt.getBucket(n);if(!Ct)continue;const Jt=h?Ct.text:Ct.icon;if(!Jt||!Jt.segments.get().length||!Jt.hasVisibleVertices)continue;const ar=Jt.programConfigurations.get(n.id),Yt=h||Ct.sdfIcons,xr=h?Ct.textSizeData:Ct.iconSizeData,Jr=be||ve.pitch!==0,Ti=g.useProgram(Iu(Yt,h,Ct),ar),qi=a.az(xr,ve.zoom),Li=g.style.map.terrain&&g.style.map.terrain.getTerrainData(bt);let en,Vi,$n,Hi,Rn=[0,0],xn=null;if(h)Vi=Pt.glyphAtlasTexture,$n=oe.LINEAR,en=Pt.glyphAtlasTexture.size,Ct.iconsInText&&(Rn=Pt.imageAtlasTexture.size,xn=Pt.imageAtlasTexture,Hi=Jr||g.options.rotating||g.options.zooming||xr.kind==="composite"||xr.kind==="camera"?oe.LINEAR:oe.NEAREST);else{const zn=n.layout.get("icon-size").constantOr(0)!==1||Ct.iconsNeedLinear;Vi=Pt.imageAtlasTexture,$n=Yt||g.options.rotating||g.options.zooming||zn||Jr?oe.LINEAR:oe.NEAREST,en=Pt.imageAtlasTexture.size}const wn=a.aO(Pt,1,g.transform.zoom),ps=Oi(Se,g.transform,wn),Ns=a.N();a.aC(Ns,ps);const Io=Bs(be,Se,g.transform,wn),Cl=a.aP(ve,Pt,_,w),lc=ve.getProjectionData({overscaledTileID:bt,applyGlobeMatrix:!G,applyTerrainMatrix:!0}),Du=Ve&&Ct.hasTextData(),Dc=n.layout.get("icon-text-fit")!=="none"&&Du&&Ct.hasIconData();if(Ae){const zn=g.style.map.terrain?(pa,cn)=>g.style.map.terrain.getElevation(bt,pa,cn):null,Zn=n.layout.get("text-rotation-alignment")==="map";Ra(Ct,g,h,ps,Ns,be,R,Zn,bt.toUnwrapped(),ve.width,ve.height,Cl,zn)}const Eo=h&&Ve||Dc,es=Ae||Eo?ru:be?ps:g.transform.clipSpaceToPixelsMatrix,ws=Yt&&n.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ms;ms=Yt?Ct.iconsInText?Ri(xr.kind,qi,We,be,Ae,Eo,g,es,Io,Cl,en,Rn,Tt):Ii(xr.kind,qi,We,be,Ae,Eo,g,es,Io,Cl,h,en,0,Tt):Ci(xr.kind,qi,We,be,Ae,Eo,g,es,Io,Cl,h,en,Tt);const Ca={program:Ti,buffers:Jt,uniformValues:ms,projectionData:lc,atlasTexture:Vi,atlasTextureIcon:xn,atlasInterpolation:$n,atlasInterpolationIcon:Hi,isSDF:Yt,hasHalo:ws};if(Le&&Ct.canOverlap){Je=!0;const zn=Jt.segments.get();for(const Zn of zn)lt.push({segments:new a.aY([Zn]),sortKey:Zn.sortKey,state:Ca,terrainData:Li})}else lt.push({segments:Jt.segments,sortKey:0,state:Ca,terrainData:Li})}Je&&lt.sort((bt,Pt)=>bt.sortKey-Pt.sortKey);for(const bt of lt){const Pt=bt.state;if(X.activeTexture.set(oe.TEXTURE0),Pt.atlasTexture.bind(Pt.atlasInterpolation,oe.CLAMP_TO_EDGE),Pt.atlasTextureIcon&&(X.activeTexture.set(oe.TEXTURE1),Pt.atlasTextureIcon&&Pt.atlasTextureIcon.bind(Pt.atlasInterpolationIcon,oe.CLAMP_TO_EDGE)),Pt.isSDF){const Ct=Pt.uniformValues;Pt.hasHalo&&(Ct.u_is_halo=1,tc(Pt.buffers,bt.segments,n,g,Pt.program,et,B,$,Ct,Pt.projectionData,bt.terrainData)),Ct.u_is_halo=0}tc(Pt.buffers,bt.segments,n,g,Pt.program,et,B,$,Pt.uniformValues,Pt.projectionData,bt.terrainData)}}function tc(g,t,n,l,h,_,w,P,M,R,B){const $=l.context;h.draw($,$.gl.TRIANGLES,_,w,P,ni.backCCW,M,B,R,n.id,g.layoutVertexBuffer,g.indexBuffer,t,n.paint,l.transform.zoom,g.programConfigurations.get(n.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function Eu(g,t,n,l,h){const _=g.context,w=_.gl,P=Kr.disabled,M=new vi([w.ONE,w.ONE],a.bq.transparent,[!0,!0,!0,!0]),R=t.getBucket(n);if(!R)return;const B=l.key;let $=n.heatmapFbos.get(B);$||($=rc(_,t.tileSize,t.tileSize),n.heatmapFbos.set(B,$)),_.bindFramebuffer.set($.framebuffer),_.viewport.set([0,0,t.tileSize,t.tileSize]),_.clear({color:a.bq.transparent});const G=R.programConfigurations.get(n.id),X=g.useProgram("heatmap",G,!h),oe=g.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ve=g.style.map.terrain.getTerrainData(l);X.draw(_,w.TRIANGLES,Hr.disabled,P,M,ni.disabled,ks(t,g.transform.zoom,n.paint.get("heatmap-intensity"),1),ve,oe,n.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,n.paint,g.transform.zoom,G)}function Lu(g,t,n,l,h){const _=g.context,w=_.gl,P=g.transform;_.setColorMode(g.colorModeForRenderPass());const M=Ec(_,t),R=n.key,B=t.heatmapFbos.get(R);if(!B)return;_.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,B.colorAttachment.get()),_.activeTexture.set(w.TEXTURE1),M.bind(w.LINEAR,w.CLAMP_TO_EDGE);const $=P.getProjectionData({overscaledTileID:n,applyTerrainMatrix:h,applyGlobeMatrix:!l});g.useProgram("heatmapTexture").draw(_,w.TRIANGLES,Hr.disabled,Kr.disabled,g.colorModeForRenderPass(),ni.disabled,an(g,t,0,1),null,$,t.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments,t.paint,P.zoom),B.destroy(),t.heatmapFbos.delete(R)}function rc(g,t,n){var l,h;const _=g.gl,w=_.createTexture();_.bindTexture(_.TEXTURE_2D,w),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR);const P=(l=g.HALF_FLOAT)!==null&&l!==void 0?l:_.UNSIGNED_BYTE,M=(h=g.RGBA16F)!==null&&h!==void 0?h:_.RGBA;_.texImage2D(_.TEXTURE_2D,0,M,t,n,0,_.RGBA,P,null);const R=g.createFramebuffer(t,n,!1,!1);return R.colorAttachment.set(w),R}function Ec(g,t){return t.colorRampTexture||(t.colorRampTexture=new a.T(g,t.colorRamp,g.gl.RGBA)),t.colorRampTexture}function $a(g,t,n,l,h,_,w,P){let M=256;if(h.stepInterpolant){const R=t.getSource().maxzoom,B=w.canonical.z===R?Math.ceil(1<<g.transform.maxZoom-w.canonical.z):1;M=a.ao(a.cf(_.maxLineLength/a.a5*1024*B),256,n.maxTextureSize)}return P.gradient=a.cg({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:M,image:P.gradient||void 0,clips:_.lineClipsArray}),P.texture?P.texture.update(P.gradient):P.texture=new a.T(n,P.gradient,l.RGBA),P.version=h.gradientVersion,P.texture}function Ys(g,t,n,l,h){g.activeTexture.set(t.TEXTURE0),n.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),l.updatePaintBuffers(h)}function Si(g,t,n,l,h,_){(h||g.lineAtlas.dirty)&&(t.activeTexture.set(n.TEXTURE0),g.lineAtlas.bind(t)),l.updatePaintBuffers(_)}function Jo(g,t,n,l,h,_,w){const P=_.gradients[h.id];let M=P.texture;h.gradientVersion!==P.version&&(M=$a(g,t,n,l,h,_,w,P)),n.activeTexture.set(l.TEXTURE0),M.bind(h.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE)}function Fs(g,t,n,l,h,_,w,P,M){const R=_.gradients[h.id];let B=R.texture;h.gradientVersion!==R.version&&(B=$a(g,t,n,l,h,_,w,R)),n.activeTexture.set(l.TEXTURE0),B.bind(h.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE),n.activeTexture.set(l.TEXTURE1),g.lineAtlas.bind(n),P.updatePaintBuffers(M)}function ua(g,t,n,l,h){if(!n||!l||!l.imageAtlas)return;const _=l.imageAtlas.patternPositions;let w=_[n.to.toString()],P=_[n.from.toString()];if(!w&&P&&(w=P),!P&&w&&(P=w),!w||!P){const M=h.getPaintProperty(t);w=_[M],P=_[M]}w&&P&&g.setConstantPatternPositions(w,P)}function Kn(g,t,n,l,h,_,w,P){const M=g.context.gl,R="fill-pattern",B=n.paint.get(R),$=B&&B.constantOr(1),G=n.getCrossfadeParameters();let X,oe,ve,Se,be;const Ae=g.transform,We=n.paint.get("fill-translate"),Le=n.paint.get("fill-translate-anchor");w?(oe=$&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",X=M.LINES):(oe=$?"fillPattern":"fill",X=M.TRIANGLES);const Je=B.constantOr(null);for(const et of l){const Ve=t.getTile(et);if($&&!Ve.patternsLoaded())continue;const lt=Ve.getBucket(n);if(!lt)continue;const Tt=lt.programConfigurations.get(n.id),bt=g.useProgram(oe,Tt),Pt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(et);$&&(g.context.activeTexture.set(M.TEXTURE0),Ve.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Tt.updatePaintBuffers(G)),ua(Tt,R,Je,Ve,n);const Ct=Ae.getProjectionData({overscaledTileID:et,applyGlobeMatrix:!P,applyTerrainMatrix:!0}),Jt=a.aP(Ae,Ve,We,Le);if(w){Se=lt.indexBuffer2,be=lt.segments2;const Yt=[M.drawingBufferWidth,M.drawingBufferHeight];ve=oe==="fillOutlinePattern"&&$?hs(g,G,Ve,Yt,Jt):us(Yt,Jt)}else Se=lt.indexBuffer,be=lt.segments,ve=$?ho(g,G,Ve,Jt):{u_fill_translate:Jt};const ar=g.stencilModeForClipping(et);bt.draw(g.context,X,h,ar,_,ni.backCCW,ve,Pt,Ct,n.id,lt.layoutVertexBuffer,Se,be,n.paint,g.transform.zoom,Tt)}}function Lc(g,t,n,l,h,_,w,P){const M=g.context,R=M.gl,B="fill-extrusion-pattern",$=n.paint.get(B),G=$.constantOr(1),X=n.getCrossfadeParameters(),oe=n.paint.get("fill-extrusion-opacity"),ve=$.constantOr(null),Se=g.transform;for(const be of l){const Ae=t.getTile(be),We=Ae.getBucket(n);if(!We)continue;const Le=g.style.map.terrain&&g.style.map.terrain.getTerrainData(be),Je=We.programConfigurations.get(n.id),et=g.useProgram(G?"fillExtrusionPattern":"fillExtrusion",Je);G&&(g.context.activeTexture.set(R.TEXTURE0),Ae.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Je.updatePaintBuffers(X));const Ve=Se.getProjectionData({overscaledTileID:be,applyGlobeMatrix:!P,applyTerrainMatrix:!0});ua(Je,B,ve,Ae,n);const lt=a.aP(Se,Ae,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Tt=n.paint.get("fill-extrusion-vertical-gradient"),bt=G?Aa(g,Tt,oe,lt,be,X,Ae):jo(g,Tt,oe,lt);et.draw(M,M.gl.TRIANGLES,h,_,w,ni.backCCW,bt,Le,Ve,n.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,n.paint,g.transform.zoom,Je,g.style.map.terrain&&We.centroidVertexBuffer)}}function xo(g,t,n,l,h,_,w,P,M){var R;const B=g.style.projection,$=g.context,G=g.transform,X=$.gl,oe=[`#define NUM_ILLUMINATION_SOURCES ${n.paint.get("hillshade-highlight-color").values.length}`],ve=g.useProgram("hillshade",null,!1,oe),Se=!g.options.moving;for(const be of l){const Ae=t.getTile(be),We=Ae.fbo;if(!We)continue;const Le=B.getMeshFromTileID($,be.canonical,P,!0,"raster"),Je=(R=g.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(be);$.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_2D,We.colorAttachment.get());const et=G.getProjectionData({overscaledTileID:be,aligned:Se,applyGlobeMatrix:!M,applyTerrainMatrix:!0});ve.draw($,X.TRIANGLES,_,h[be.overscaledZ],w,ni.backCCW,yl(g,Ae,n),Je,et,n.id,Le.vertexBuffer,Le.indexBuffer,Le.segments)}}function Sl(g,t,n,l,h,_,w,P,M){var R;const B=g.style.projection,$=g.context,G=g.transform,X=$.gl,oe=g.useProgram("colorRelief"),ve=!g.options.moving;let Se=!0,be=0;for(const Ae of l){const We=t.getTile(Ae),Le=We.dem;if(Se){const bt=X.getParameter(X.MAX_TEXTURE_SIZE),{elevationTexture:Pt,colorTexture:Ct}=n.getColorRampTextures($,bt,Le.getUnpackVector());$.activeTexture.set(X.TEXTURE1),Pt.bind(X.NEAREST,X.CLAMP_TO_EDGE),$.activeTexture.set(X.TEXTURE4),Ct.bind(X.LINEAR,X.CLAMP_TO_EDGE),Se=!1,be=Pt.size[0]}if(!Le||!Le.data)continue;const Je=Le.stride,et=Le.getPixels();if($.activeTexture.set(X.TEXTURE0),$.pixelStoreUnpackPremultiplyAlpha.set(!1),We.demTexture=We.demTexture||g.getTileTexture(Je),We.demTexture){const bt=We.demTexture;bt.update(et,{premultiply:!1}),bt.bind(X.LINEAR,X.CLAMP_TO_EDGE)}else We.demTexture=new a.T($,et,X.RGBA,{premultiply:!1}),We.demTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const Ve=B.getMeshFromTileID($,Ae.canonical,P,!0,"raster"),lt=(R=g.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(Ae),Tt=G.getProjectionData({overscaledTileID:Ae,aligned:ve,applyGlobeMatrix:!M,applyTerrainMatrix:!0});oe.draw($,X.TRIANGLES,_,h[Ae.overscaledZ],w,ni.backCCW,Vo(n,We.dem,be),lt,Tt,n.id,Ve.vertexBuffer,Ve.indexBuffer,Ve.segments)}}const wo=[new a.P(0,0),new a.P(a.a5,0),new a.P(a.a5,a.a5),new a.P(0,a.a5)];function Ko(g,t,n,l,h,_,w,P,M=!1,R=!1){const B=l[l.length-1].overscaledZ,$=g.context,G=$.gl,X=g.useProgram("raster"),oe=g.transform,ve=g.style.projection,Se=g.colorModeForRenderPass(),be=!g.options.moving,Ae=n.paint.get("raster-opacity"),We=n.paint.get("raster-resampling"),Le=n.paint.get("raster-fade-duration"),Je=!!g.style.map.terrain;for(const et of l){const Ve=g.getDepthModeForSublayer(et.overscaledZ-B,Ae===1?Hr.ReadWrite:Hr.ReadOnly,G.LESS),lt=t.getTile(et),Tt=We==="nearest"?G.NEAREST:G.LINEAR;$.activeTexture.set(G.TEXTURE0),lt.texture.bind(Tt,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),$.activeTexture.set(G.TEXTURE1);const{parentTile:bt,parentScaleBy:Pt,parentTopLeft:Ct,fadeValues:Jt}=nu(lt,t,Le,Je);lt.fadeOpacity=Jt.tileOpacity,bt?(bt.fadeOpacity=Jt.parentTileOpacity,bt.texture.bind(Tt,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST)):lt.texture.bind(Tt,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),lt.texture.useMipmap&&$.extTextureFilterAnisotropic&&g.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax);const ar=g.style.map.terrain&&g.style.map.terrain.getTerrainData(et),Yt=oe.getProjectionData({overscaledTileID:et,aligned:be,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),xr=ds(Ct,Pt,Jt.fadeMix,n,P),Jr=ve.getMeshFromTileID($,et.canonical,_,w,"raster");X.draw($,G.TRIANGLES,Ve,h?h[et.overscaledZ]:Kr.disabled,Se,M?ni.frontCCW:ni.backCCW,xr,ar,Yt,n.id,Jr.vertexBuffer,Jr.indexBuffer,Jr.segments)}}function nu(g,t,n,l){const h={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(n===0||l)return h;if(g.fadingParentID){const _=t.getLoadedTile(g.fadingParentID);if(!_)return h;const w=Math.pow(2,_.tileID.overscaledZ-g.tileID.overscaledZ),P=[g.tileID.canonical.x*w%1,g.tileID.canonical.y*w%1],M=function(R,B,$){const G=ce(),X=(G-B.timeAdded)/$,oe=R.fadingDirection===ot.Incoming,ve=a.ao((G-R.timeAdded)/$,0,1),Se=a.ao(1-X,0,1),be=oe?ve:Se;return{tileOpacity:be,parentTileOpacity:oe?Se:ve,fadeMix:{opacity:1,mix:1-be}}}(g,_,n);return{parentTile:_,parentScaleBy:w,parentTopLeft:P,fadeValues:M}}if(g.selfFading){const _=function(w,P){const M=(ce()-w.timeAdded)/P,R=a.ao(M,0,1);return{tileOpacity:R,fadeMix:{opacity:R,mix:0}}}(g,n);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:_}}return h}const Mu=new a.bq(1,0,0,1),ic=new a.bq(0,1,0,1),nc=new a.bq(0,0,1,1),Tl=new a.bq(1,0,1,1),Za=new a.bq(0,1,1,1);function su(g,t,n,l){sc(g,0,t+n/2,g.transform.width,n,l)}function Mc(g,t,n,l){sc(g,t-n/2,0,n,g.transform.height,l)}function sc(g,t,n,l,h,_){const w=g.context,P=w.gl;P.enable(P.SCISSOR_TEST),P.scissor(t*g.pixelRatio,n*g.pixelRatio,l*g.pixelRatio,h*g.pixelRatio),w.clear({color:_}),P.disable(P.SCISSOR_TEST)}function Cu(g,t,n){const l=g.context,h=l.gl,_=g.useProgram("debug"),w=Hr.disabled,P=Kr.disabled,M=g.colorModeForRenderPass(),R="$debug",B=g.style.map.terrain&&g.style.map.terrain.getTerrainData(n);l.activeTexture.set(h.TEXTURE0);const $=t.getTileByID(n.key).latestRawTileData,G=Math.floor(($&&$.byteLength||0)/1024),X=t.getTile(n).tileSize,oe=512/Math.min(X,512)*(n.overscaledZ/g.transform.zoom)*.5;let ve=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(ve+=` => ${n.overscaledZ}`),function(be,Ae){be.initDebugOverlayCanvas();const We=be.debugOverlayCanvas,Le=be.context.gl,Je=be.debugOverlayCanvas.getContext("2d");Je.clearRect(0,0,We.width,We.height),Je.shadowColor="white",Je.shadowBlur=2,Je.lineWidth=1.5,Je.strokeStyle="white",Je.textBaseline="top",Je.font="bold 36px Open Sans, sans-serif",Je.fillText(Ae,5,5),Je.strokeText(Ae,5,5),be.debugOverlayTexture.update(We),be.debugOverlayTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)}(g,`${ve} ${G}kB`);const Se=g.transform.getProjectionData({overscaledTileID:n,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(l,h.TRIANGLES,w,P,vi.alphaBlended,ni.disabled,Uo(a.bq.transparent,oe),null,Se,R,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),_.draw(l,h.LINE_STRIP,w,P,M,ni.disabled,Uo(a.bq.red),B,Se,R,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function au(g,t,n,l){const{isRenderingGlobe:h}=l,_=g.context,w=_.gl,P=g.transform,M=g.colorModeForRenderPass(),R=g.getDepthModeFor3D(),B=g.useProgram("terrain");_.bindFramebuffer.set(null),_.viewport.set([0,0,g.width,g.height]);for(const $ of n){const G=t.getTerrainMesh($.tileID),X=g.renderToTexture.getTexture($),oe=t.getTerrainData($.tileID);_.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,X.texture);const ve=t.getMeshFrameDelta(P.zoom),Se=P.calculateFogMatrix($.tileID.toUnwrapped()),be=gl(ve,Se,g.style.sky,P.pitch,h),Ae=P.getProjectionData({overscaledTileID:$.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});B.draw(_,w.TRIANGLES,R,Kr.disabled,M,ni.backCCW,be,oe,Ae,"terrain",G.vertexBuffer,G.indexBuffer,G.segments)}}function ou(g,t){if(!t.mesh){const n=new a.aX;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(1,1),n.emplaceBack(-1,1);const l=new a.aZ;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),t.mesh=new wi(g.createVertexBuffer(n,Yn.members),g.createIndexBuffer(l),a.aY.simpleSegment(0,0,n.length,l.length))}return t.mesh}class ku{constructor(t,n){this.context=new Ic(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.as(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Zi.maxOverzooming+Zi.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new zr}resize(t,n,l){if(this.width=Math.floor(t*l),this.height=Math.floor(n*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const t=this.context,n=new a.aX;n.emplaceBack(0,0),n.emplaceBack(a.a5,0),n.emplaceBack(0,a.a5),n.emplaceBack(a.a5,a.a5),this.tileExtentBuffer=t.createVertexBuffer(n,Yn.members),this.tileExtentSegments=a.aY.simpleSegment(0,0,4,2);const l=new a.aX;l.emplaceBack(0,0),l.emplaceBack(a.a5,0),l.emplaceBack(0,a.a5),l.emplaceBack(a.a5,a.a5),this.debugBuffer=t.createVertexBuffer(l,Yn.members),this.debugSegments=a.aY.simpleSegment(0,0,4,5);const h=new a.ci;h.emplaceBack(0,0,0,0),h.emplaceBack(a.a5,0,a.a5,0),h.emplaceBack(0,a.a5,0,a.a5),h.emplaceBack(a.a5,a.a5,a.a5,a.a5),this.rasterBoundsBuffer=t.createVertexBuffer(h,cs.members),this.rasterBoundsSegments=a.aY.simpleSegment(0,0,4,2);const _=new a.aX;_.emplaceBack(0,0),_.emplaceBack(a.a5,0),_.emplaceBack(0,a.a5),_.emplaceBack(a.a5,a.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(_,Yn.members),this.rasterBoundsSegmentsPosOnly=a.aY.simpleSegment(0,0,4,5);const w=new a.aX;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(w,Yn.members),this.viewportSegments=a.aY.simpleSegment(0,0,4,2);const P=new a.cj;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(P);const M=new a.aZ;M.emplaceBack(1,0,2),M.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(M);const R=this.context.gl;this.stencilClearMode=new Kr({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.tileExtentMesh=new wi(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=a.N();a.c8(l,0,this.width,this.height,0,0,1),a.Q(l,l,[n.drawingBufferWidth,n.drawingBufferHeight,0]);const h={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(t,n.TRIANGLES,Hr.disabled,this.stencilClearMode,vi.disabled,ni.disabled,null,null,h,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n,l){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source,this.nextStencilID+n.length>256&&this.clearStencil();const h=this.context;h.setColorMode(vi.disabled),h.setDepthMode(Hr.disabled);const _={};for(const w of n)_[w.key]=this.nextStencilID++;this._renderTileMasks(_,n,l,!0),this._renderTileMasks(_,n,l,!1),this._tileClippingMaskIDs=_}_renderTileMasks(t,n,l,h){const _=this.context,w=_.gl,P=this.style.projection,M=this.transform,R=this.useProgram("clippingMask");for(const B of n){const $=t[B.key],G=this.style.map.terrain&&this.style.map.terrain.getTerrainData(B),X=P.getMeshFromTileID(this.context,B.canonical,h,!0,"stencil"),oe=M.getProjectionData({overscaledTileID:B,applyGlobeMatrix:!l,applyTerrainMatrix:!0});R.draw(_,w.TRIANGLES,Hr.disabled,new Kr({func:w.ALWAYS,mask:0},$,255,w.KEEP,w.KEEP,w.REPLACE),vi.disabled,l?ni.disabled:ni.backCCW,null,G,oe,"$clipping",X.vertexBuffer,X.indexBuffer,X.segments)}}_renderTilesDepthBuffer(){const t=this.context,n=t.gl,l=this.style.projection,h=this.transform,_=this.useProgram("depth"),w=this.getDepthModeFor3D(),P=rr(h,{tileSize:h.tileSize});for(const M of P){const R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(M),B=l.getMeshFromTileID(this.context,M.canonical,!0,!0,"raster"),$=h.getProjectionData({overscaledTileID:M,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(t,n.TRIANGLES,w,Kr.disabled,vi.disabled,ni.backCCW,null,R,$,"$clipping",B.vertexBuffer,B.indexBuffer,B.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Kr({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new Kr({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const n=this.context.gl,l=t.sort((w,P)=>P.overscaledZ-w.overscaledZ),h=l[l.length-1].overscaledZ,_=l[0].overscaledZ-h+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const w={};for(let P=0;P<_;P++)w[P+h]=new Kr({func:n.GEQUAL,mask:255},P+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=_,[w,l]}return[{[h]:Kr.disabled},l]}stencilConfigForOverlapTwoPass(t){const n=this.context.gl,l=t.sort((w,P)=>P.overscaledZ-w.overscaledZ),h=l[l.length-1].overscaledZ,_=l[0].overscaledZ-h+1;if(this.clearStencil(),_>1){const w={},P={};for(let M=0;M<_;M++)w[M+h]=new Kr({func:n.GREATER,mask:255},_+1+M,255,n.KEEP,n.KEEP,n.REPLACE),P[M+h]=new Kr({func:n.GREATER,mask:255},1+M,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID=2*_+1,[w,P,l]}return this.nextStencilID=3,[{[h]:new Kr({func:n.GREATER,mask:255},2,255,n.KEEP,n.KEEP,n.REPLACE)},{[h]:new Kr({func:n.GREATER,mask:255},1,255,n.KEEP,n.KEEP,n.REPLACE)},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new vi([t.CONSTANT_COLOR,t.ONE],new a.bq(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?vi.unblended:vi.alphaBlended}getDepthModeForSublayer(t,n,l){if(!this.opaquePassEnabledForLayer())return Hr.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Hr(l||this.context.gl.LEQUAL,n,[h,h])}getDepthModeFor3D(){return new Hr(this.context.gl.LEQUAL,Hr.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){var l,h;this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(ce()),this.imageManager.beginFrame();const _=this.style._order,w=this.style.tileManagers,P={},M={},R={},B={isRenderingToTexture:!1,isRenderingGlobe:((l=t.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const G in w){const X=w[G];X.used&&X.prepare(this.context),P[G]=X.getVisibleCoordinates(!1),M[G]=P[G].slice().reverse(),R[G]=X.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let G=0;G<_.length;G++)if(this.style._layers[_[G]].is3D()){this.opaquePassCutoff=G;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const G of _){const X=this.style._layers[G];if(!X.hasOffscreenPass()||X.isHidden(this.transform.zoom))continue;const oe=M[X.source];(X.type==="custom"||oe.length)&&this.renderLayer(this,w[X.source],X,oe,B)}if((h=this.style.projection)===null||h===void 0||h.updateGPUdependent({context:this.context,useProgram:G=>this.useProgram(G)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?a.bq.black:a.bq.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(G,X){const oe=G.context,ve=oe.gl,Se=((et,Ve,lt)=>{const Tt=Math.cos(Ve.rollInRadians),bt=Math.sin(Ve.rollInRadians),Pt=Ee(Ve),Ct=Ve.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:et.properties.get("sky-color"),u_horizon_color:et.properties.get("horizon-color"),u_horizon:[(Ve.width/2-Pt*bt)*lt,(Ve.height/2+Pt*Tt)*lt],u_horizon_normal:[-bt,Tt],u_sky_horizon_blend:et.properties.get("sky-horizon-blend")*Ve.height/2*lt,u_sky_blend:Ct}})(X,G.style.map.transform,G.pixelRatio),be=new Hr(ve.LEQUAL,Hr.ReadWrite,[0,1]),Ae=Kr.disabled,We=G.colorModeForRenderPass(),Le=G.useProgram("sky"),Je=ou(oe,X);Le.draw(oe,ve.TRIANGLES,be,Ae,We,ni.disabled,Se,null,void 0,"sky",Je.vertexBuffer,Je.indexBuffer,Je.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const G=this.style._layers[_[this.currentLayer]],X=w[G.source],oe=P[G.source];this._renderTileClippingMasks(G,oe,!1),this.renderLayer(this,X,G,oe,B)}this.renderPass="translucent";let $=!1;for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const G=this.style._layers[_[this.currentLayer]],X=w[G.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(G,B))continue;this.opaquePassEnabledForLayer()||$||($=!0,B.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const oe=(G.type==="symbol"?R:M)[G.source];this._renderTileClippingMasks(G,P[G.source],!!this.renderToTexture),this.renderLayer(this,X,G,oe,B)}if(B.isRenderingGlobe&&function(G,X,oe){const ve=G.context,Se=ve.gl,be=G.useProgram("atmosphere"),Ae=new Hr(Se.LEQUAL,Hr.ReadOnly,[0,1]),We=G.transform,Le=function(Ct,Jt){const ar=Ct.properties.get("position"),Yt=[-ar.x,-ar.y,-ar.z],xr=a.as(new Float64Array(16));return Ct.properties.get("anchor")==="map"&&(a.bh(xr,xr,Jt.rollInRadians),a.bi(xr,xr,-Jt.pitchInRadians),a.bh(xr,xr,Jt.bearingInRadians),a.bi(xr,xr,Jt.center.lat*Math.PI/180),a.bK(xr,xr,-Jt.center.lng*Math.PI/180)),a.ch(Yt,Yt,xr),Yt}(oe,G.transform),Je=We.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),et=X.properties.get("atmosphere-blend")*Je.projectionTransition;if(et===0)return;const Ve=Ai(We.worldSize,We.center.lat),lt=We.inverseProjectionMatrix,Tt=new Float64Array(4);Tt[3]=1,a.aI(Tt,Tt,We.modelViewProjectionMatrix),Tt[0]/=Tt[3],Tt[1]/=Tt[3],Tt[2]/=Tt[3],Tt[3]=1,a.aI(Tt,Tt,lt),Tt[0]/=Tt[3],Tt[1]/=Tt[3],Tt[2]/=Tt[3],Tt[3]=1;const bt=((Ct,Jt,ar,Yt,xr)=>({u_sun_pos:Ct,u_atmosphere_blend:Jt,u_globe_position:ar,u_globe_radius:Yt,u_inv_proj_matrix:xr}))(Le,et,[Tt[0],Tt[1],Tt[2]],Ve,lt),Pt=ou(ve,X);be.draw(ve,Se.TRIANGLES,Ae,Kr.disabled,vi.alphaBlended,ni.disabled,bt,null,null,"atmosphere",Pt.vertexBuffer,Pt.indexBuffer,Pt.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const G=function(X,oe){let ve=null;const Se=Object.values(X._layers).flatMap(Le=>Le.source&&!Le.isHidden(oe)?[X.tileManagers[Le.source]]:[]),be=Se.filter(Le=>Le.getSource().type==="vector"),Ae=Se.filter(Le=>Le.getSource().type!=="vector"),We=Le=>{(!ve||ve.getSource().maxzoom<Le.getSource().maxzoom)&&(ve=Le)};return be.forEach(Le=>We(Le)),ve||Ae.forEach(Le=>We(Le)),ve}(this.style,this.transform.zoom);G&&function(X,oe,ve){for(let Se=0;Se<ve.length;Se++)Cu(X,oe,ve[Se])}(this,G,G.getVisibleCoordinates())}this.options.showPadding&&function(G){const X=G.transform.padding;su(G,G.transform.height-(X.top||0),3,Mu),su(G,X.bottom||0,3,ic),Mc(G,X.left||0,3,nc),Mc(G,G.transform.width-(X.right||0),3,Tl);const oe=G.transform.centerPoint;(function(ve,Se,be,Ae){sc(ve,Se-1,be-10,2,20,Ae),sc(ve,Se-10,be-1,20,2,Ae)})(G,oe.x,G.transform.height-oe.y,Za)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let h=this.terrainFacilitator.dirty;h||(h=t?!a.ck(n,l):!a.cl(n,l)),h||(h=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),h&&(a.cm(n,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(_,w){const P=_.context,M=P.gl,R=_.transform,B=vi.unblended,$=new Hr(M.LEQUAL,Hr.ReadWrite,[0,1]),G=w.tileManager.getRenderableTiles(),X=_.useProgram("terrainDepth");P.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),P.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),P.clear({color:a.bq.transparent,depth:1});for(const oe of G){const ve=w.getTerrainMesh(oe.tileID),Se=w.getTerrainData(oe.tileID),be=R.getProjectionData({overscaledTileID:oe.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Ae={u_ele_delta:w.getMeshFrameDelta(R.zoom)};X.draw(P,M.TRIANGLES,$,Kr.disabled,B,ni.backCCW,Ae,Se,be,"terrain",ve.vertexBuffer,ve.indexBuffer,ve.segments)}P.bindFramebuffer.set(null),P.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain),function(_,w){const P=_.context,M=P.gl,R=_.transform,B=vi.unblended,$=new Hr(M.LEQUAL,Hr.ReadWrite,[0,1]),G=w.getCoordsTexture(),X=w.tileManager.getRenderableTiles(),oe=_.useProgram("terrainCoords");P.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),P.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),P.clear({color:a.bq.transparent,depth:1}),w.coordsIndex=[];for(const ve of X){const Se=w.getTerrainMesh(ve.tileID),be=w.getTerrainData(ve.tileID);P.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,G.texture);const Ae={u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(R.zoom)},We=R.getProjectionData({overscaledTileID:ve.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});oe.draw(P,M.TRIANGLES,$,Kr.disabled,B,ni.backCCW,Ae,be,We,"terrain",Se.vertexBuffer,Se.indexBuffer,Se.segments),w.coordsIndex.push(ve.tileID.key)}P.bindFramebuffer.set(null),P.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain))}renderLayer(t,n,l,h,_){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(h||[]).length)&&(this.id=l.id,a.cn(l)?function(w,P,M,R,B,$){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:G}=$,X=Kr.disabled,oe=w.colorModeForRenderPass();(M._unevaluatedLayout.hasValue("text-variable-anchor")||M._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ve,Se,be,Ae,We,Le,Je,et,Ve){const lt=Se.transform,Tt=Se.style.map.terrain,bt=We==="map",Pt=Le==="map";for(const Ct of ve){const Jt=Ae.getTile(Ct),ar=Jt.getBucket(be);if(!ar||!ar.text||!ar.text.segments.get().length)continue;const Yt=a.az(ar.textSizeData,lt.zoom),xr=a.aO(Jt,1,Se.transform.zoom),Jr=Oi(bt,Se.transform,xr),Ti=be.layout.get("icon-text-fit")!=="none"&&ar.hasIconData();if(Yt){const qi=Math.pow(2,lt.zoom-Jt.tileID.overscaledZ),Li=Tt?(en,Vi)=>Tt.getElevation(Ct,en,Vi):null;Ql(ar,bt,Pt,Ve,lt,Jr,qi,Yt,Ti,a.aP(lt,Jt,Je,et),Ct.toUnwrapped(),Li)}}}(R,w,M,P,M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),B),M.paint.get("icon-opacity").constantOr(1)!==0&&ec(w,P,M,R,!1,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),M.layout.get("icon-rotation-alignment"),M.layout.get("icon-pitch-alignment"),M.layout.get("icon-keep-upright"),X,oe,G),M.paint.get("text-opacity").constantOr(1)!==0&&ec(w,P,M,R,!0,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.layout.get("text-keep-upright"),X,oe,G),P.map.showCollisionBoxes&&(Xo(w,P,M,R,!0),Xo(w,P,M,R,!1))}(t,n,l,h,this.style.placement.variableOffsets,_):a.co(l)?function(w,P,M,R,B){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:$}=B,G=M.paint.get("circle-opacity"),X=M.paint.get("circle-stroke-width"),oe=M.paint.get("circle-stroke-opacity"),ve=!M.layout.get("circle-sort-key").isConstant();if(G.constantOr(1)===0&&(X.constantOr(1)===0||oe.constantOr(1)===0))return;const Se=w.context,be=Se.gl,Ae=w.transform,We=w.getDepthModeForSublayer(0,Hr.ReadOnly),Le=Kr.disabled,Je=w.colorModeForRenderPass(),et=[],Ve=Ae.getCircleRadiusCorrection();for(let lt=0;lt<R.length;lt++){const Tt=R[lt],bt=P.getTile(Tt),Pt=bt.getBucket(M);if(!Pt)continue;const Ct=M.paint.get("circle-translate"),Jt=M.paint.get("circle-translate-anchor"),ar=a.aP(Ae,bt,Ct,Jt),Yt=Pt.programConfigurations.get(M.id),xr=w.useProgram("circle",Yt),Jr=Pt.layoutVertexBuffer,Ti=Pt.indexBuffer,qi=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Tt),Li={programConfiguration:Yt,program:xr,layoutVertexBuffer:Jr,indexBuffer:Ti,uniformValues:fo(w,bt,M,ar,Ve),terrainData:qi,projectionData:Ae.getProjectionData({overscaledTileID:Tt,applyGlobeMatrix:!$,applyTerrainMatrix:!0})};if(ve){const en=Pt.segments.get();for(const Vi of en)et.push({segments:new a.aY([Vi]),sortKey:Vi.sortKey,state:Li})}else et.push({segments:Pt.segments,sortKey:0,state:Li})}ve&&et.sort((lt,Tt)=>lt.sortKey-Tt.sortKey);for(const lt of et){const{programConfiguration:Tt,program:bt,layoutVertexBuffer:Pt,indexBuffer:Ct,uniformValues:Jt,terrainData:ar,projectionData:Yt}=lt.state;bt.draw(Se,be.TRIANGLES,We,Le,Je,ni.backCCW,Jt,ar,Yt,M.id,Pt,Ct,lt.segments,M.paint,w.transform.zoom,Tt)}}(t,n,l,h,_):a.cp(l)?function(w,P,M,R,B){if(M.paint.get("heatmap-opacity")===0)return;const $=w.context,{isRenderingToTexture:G,isRenderingGlobe:X}=B;if(w.style.map.terrain){for(const oe of R){const ve=P.getTile(oe);P.hasRenderableParent(oe)||(w.renderPass==="offscreen"?Eu(w,ve,M,oe,X):w.renderPass==="translucent"&&Lu(w,M,oe,G,X))}$.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?function(oe,ve,Se,be){const Ae=oe.context,We=Ae.gl,Le=oe.transform,Je=Kr.disabled,et=new vi([We.ONE,We.ONE],a.bq.transparent,[!0,!0,!0,!0]);(function(Ve,lt,Tt){const bt=Ve.gl;Ve.activeTexture.set(bt.TEXTURE1),Ve.viewport.set([0,0,lt.width/4,lt.height/4]);let Pt=Tt.heatmapFbos.get(a.ce);Pt?(bt.bindTexture(bt.TEXTURE_2D,Pt.colorAttachment.get()),Ve.bindFramebuffer.set(Pt.framebuffer)):(Pt=rc(Ve,lt.width/4,lt.height/4),Tt.heatmapFbos.set(a.ce,Pt))})(Ae,oe,Se),Ae.clear({color:a.bq.transparent});for(let Ve=0;Ve<be.length;Ve++){const lt=be[Ve];if(ve.hasRenderableParent(lt))continue;const Tt=ve.getTile(lt),bt=Tt.getBucket(Se);if(!bt)continue;const Pt=bt.programConfigurations.get(Se.id),Ct=oe.useProgram("heatmap",Pt),Jt=Le.getProjectionData({overscaledTileID:lt,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),ar=Le.getCircleRadiusCorrection();Ct.draw(Ae,We.TRIANGLES,Hr.disabled,Je,et,ni.backCCW,ks(Tt,Le.zoom,Se.paint.get("heatmap-intensity"),ar),null,Jt,Se.id,bt.layoutVertexBuffer,bt.indexBuffer,bt.segments,Se.paint,Le.zoom,Pt)}Ae.viewport.set([0,0,oe.width,oe.height])}(w,P,M,R):w.renderPass==="translucent"&&function(oe,ve){const Se=oe.context,be=Se.gl;Se.setColorMode(oe.colorModeForRenderPass());const Ae=ve.heatmapFbos.get(a.ce);Ae&&(Se.activeTexture.set(be.TEXTURE0),be.bindTexture(be.TEXTURE_2D,Ae.colorAttachment.get()),Se.activeTexture.set(be.TEXTURE1),Ec(Se,ve).bind(be.LINEAR,be.CLAMP_TO_EDGE),oe.useProgram("heatmapTexture").draw(Se,be.TRIANGLES,Hr.disabled,Kr.disabled,oe.colorModeForRenderPass(),ni.disabled,an(oe,ve,0,1),null,null,ve.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments,ve.paint,oe.transform.zoom))}(w,M)}(t,n,l,h,_):a.cq(l)?function(w,P,M,R,B){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:$}=B,G=M.paint.get("line-opacity"),X=M.paint.get("line-width");if(G.constantOr(1)===0||X.constantOr(1)===0)return;const oe=w.getDepthModeForSublayer(0,Hr.ReadOnly),ve=w.colorModeForRenderPass(),Se=M.paint.get("line-dasharray"),be=Se.constantOr(1),Ae=M.paint.get("line-pattern"),We=Ae.constantOr(1),Le=M.paint.get("line-gradient"),Je=M.getCrossfadeParameters();let et;et=We?"linePattern":be&&Le?"lineGradientSDF":be?"lineSDF":Le?"lineGradient":"line";const Ve=w.context,lt=Ve.gl,Tt=w.transform;let bt=!0;for(const Pt of R){const Ct=P.getTile(Pt);if(We&&!Ct.patternsLoaded())continue;const Jt=Ct.getBucket(M);if(!Jt)continue;const ar=Jt.programConfigurations.get(M.id),Yt=w.context.program.get(),xr=w.useProgram(et,ar),Jr=bt||xr.program!==Yt,Ti=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Pt),qi=Ae.constantOr(null),Li=Se&&Se.constantOr(null);if(qi&&Ct.imageAtlas){const Rn=Ct.imageAtlas,xn=Rn.patternPositions[qi.to.toString()],wn=Rn.patternPositions[qi.from.toString()];xn&&wn&&ar.setConstantPatternPositions(xn,wn)}else if(Li){const Rn=M.layout.get("line-cap")==="round",xn=w.lineAtlas.getDash(Li.to,Rn),wn=w.lineAtlas.getDash(Li.from,Rn);ar.setConstantDashPositions(xn,wn)}const en=Tt.getProjectionData({overscaledTileID:Pt,applyGlobeMatrix:!$,applyTerrainMatrix:!0}),Vi=Tt.getPixelScale();let $n;We?($n=po(w,Ct,M,Vi,Je),Ys(Ve,lt,Ct,ar,Je)):be&&Le?($n=La(w,Ct,M,Vi,Je,Jt.lineClipsArray.length),Fs(w,P,Ve,lt,M,Jt,Pt,ar,Je)):be?($n=mo(w,Ct,M,Vi,Je),Si(w,Ve,lt,ar,Jr,Je)):Le?($n=qo(w,Ct,M,Vi,Jt.lineClipsArray.length),Jo(w,P,Ve,lt,M,Jt,Pt)):$n=Va(w,Ct,M,Vi);const Hi=w.stencilModeForClipping(Pt);xr.draw(Ve,lt.TRIANGLES,oe,Hi,ve,ni.disabled,$n,Ti,en,M.id,Jt.layoutVertexBuffer,Jt.indexBuffer,Jt.segments,M.paint,w.transform.zoom,ar,Jt.layoutVertexBuffer2),bt=!1}}(t,n,l,h,_):a.cr(l)?function(w,P,M,R,B){const $=M.paint.get("fill-color"),G=M.paint.get("fill-opacity");if(G.constantOr(1)===0)return;const{isRenderingToTexture:X}=B,oe=w.colorModeForRenderPass(),ve=M.paint.get("fill-pattern"),Se=w.opaquePassEnabledForLayer()&&!ve.constantOr(1)&&$.constantOr(a.bq.transparent).a===1&&G.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===Se){const be=w.getDepthModeForSublayer(1,w.renderPass==="opaque"?Hr.ReadWrite:Hr.ReadOnly);Kn(w,P,M,R,be,oe,!1,X)}if(w.renderPass==="translucent"&&M.paint.get("fill-antialias")){const be=w.getDepthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,Hr.ReadOnly);Kn(w,P,M,R,be,oe,!0,X)}}(t,n,l,h,_):a.cs(l)?function(w,P,M,R,B){const $=M.paint.get("fill-extrusion-opacity");if($===0)return;const{isRenderingToTexture:G}=B;if(w.renderPass==="translucent"){const X=new Hr(w.context.gl.LEQUAL,Hr.ReadWrite,w.depthRangeFor3D);if($!==1||M.paint.get("fill-extrusion-pattern").constantOr(1))Lc(w,P,M,R,X,Kr.disabled,vi.disabled,G),Lc(w,P,M,R,X,w.stencilModeFor3D(),w.colorModeForRenderPass(),G);else{const oe=w.colorModeForRenderPass();Lc(w,P,M,R,X,Kr.disabled,oe,G)}}}(t,n,l,h,_):a.ct(l)?function(w,P,M,R,B){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const{isRenderingToTexture:$}=B,G=w.context,X=w.style.projection.useSubdivision,oe=w.getDepthModeForSublayer(0,Hr.ReadOnly),ve=w.colorModeForRenderPass();if(w.renderPass==="offscreen")(function(Se,be,Ae,We,Le,Je,et){const Ve=Se.context,lt=Ve.gl;for(const Tt of Ae){const bt=be.getTile(Tt),Pt=bt.dem;if(!Pt||!Pt.data||!bt.needsHillshadePrepare)continue;const Ct=Pt.dim,Jt=Pt.stride,ar=Pt.getPixels();if(Ve.activeTexture.set(lt.TEXTURE1),Ve.pixelStoreUnpackPremultiplyAlpha.set(!1),bt.demTexture=bt.demTexture||Se.getTileTexture(Jt),bt.demTexture){const xr=bt.demTexture;xr.update(ar,{premultiply:!1}),xr.bind(lt.NEAREST,lt.CLAMP_TO_EDGE)}else bt.demTexture=new a.T(Ve,ar,lt.RGBA,{premultiply:!1}),bt.demTexture.bind(lt.NEAREST,lt.CLAMP_TO_EDGE);Ve.activeTexture.set(lt.TEXTURE0);let Yt=bt.fbo;if(!Yt){const xr=new a.T(Ve,{width:Ct,height:Ct,data:null},lt.RGBA);xr.bind(lt.LINEAR,lt.CLAMP_TO_EDGE),Yt=bt.fbo=Ve.createFramebuffer(Ct,Ct,!0,!1),Yt.colorAttachment.set(xr.texture)}Ve.bindFramebuffer.set(Yt.framebuffer),Ve.viewport.set([0,0,Ct,Ct]),Se.useProgram("hillshadePrepare").draw(Ve,lt.TRIANGLES,Le,Je,et,ni.disabled,Ia(bt.tileID,Pt),null,null,We.id,Se.rasterBoundsBuffer,Se.quadTriangleIndexBuffer,Se.rasterBoundsSegments),bt.needsHillshadePrepare=!1}})(w,P,R,M,oe,Kr.disabled,ve),G.viewport.set([0,0,w.width,w.height]);else if(w.renderPass==="translucent")if(X){const[Se,be,Ae]=w.stencilConfigForOverlapTwoPass(R);xo(w,P,M,Ae,Se,oe,ve,!1,$),xo(w,P,M,Ae,be,oe,ve,!0,$)}else{const[Se,be]=w.getStencilConfigForOverlapAndUpdateStencilID(R);xo(w,P,M,be,Se,oe,ve,!1,$)}}(t,n,l,h,_):a.cu(l)?function(w,P,M,R,B){if(w.renderPass!=="translucent"||!R.length)return;const{isRenderingToTexture:$}=B,G=w.style.projection.useSubdivision,X=w.getDepthModeForSublayer(0,Hr.ReadOnly),oe=w.colorModeForRenderPass();if(G){const[ve,Se,be]=w.stencilConfigForOverlapTwoPass(R);Sl(w,P,M,be,ve,X,oe,!1,$),Sl(w,P,M,be,Se,X,oe,!0,$)}else{const[ve,Se]=w.getStencilConfigForOverlapAndUpdateStencilID(R);Sl(w,P,M,Se,ve,X,oe,!1,$)}}(t,n,l,h,_):a.bV(l)?function(w,P,M,R,B){if(w.renderPass!=="translucent"||M.paint.get("raster-opacity")===0||!R.length)return;const{isRenderingToTexture:$}=B,G=P.getSource(),X=w.style.projection.useSubdivision;if(G instanceof Rr)Ko(w,P,M,R,null,!1,!1,G.tileCoords,G.flippedWindingOrder,$);else if(X){const[oe,ve,Se]=w.stencilConfigForOverlapTwoPass(R);Ko(w,P,M,Se,oe,!1,!0,wo,!1,$),Ko(w,P,M,Se,ve,!0,!0,wo,!1,$)}else{const[oe,ve]=w.getStencilConfigForOverlapAndUpdateStencilID(R);Ko(w,P,M,ve,oe,!1,!0,wo,!1,$)}}(t,n,l,h,_):a.cv(l)?function(w,P,M,R,B){const $=M.paint.get("background-color"),G=M.paint.get("background-opacity");if(G===0)return;const{isRenderingToTexture:X}=B,oe=w.context,ve=oe.gl,Se=w.style.projection,be=w.transform,Ae=be.tileSize,We=M.paint.get("background-pattern");if(w.isPatternMissing(We))return;const Le=!We&&$.a===1&&G===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==Le)return;const Je=Kr.disabled,et=w.getDepthModeForSublayer(0,Le==="opaque"?Hr.ReadWrite:Hr.ReadOnly),Ve=w.colorModeForRenderPass(),lt=w.useProgram(We?"backgroundPattern":"background"),Tt=R||rr(be,{tileSize:Ae,terrain:w.style.map.terrain});We&&(oe.activeTexture.set(ve.TEXTURE0),w.imageManager.bind(w.context));const bt=M.getCrossfadeParameters();for(const Pt of Tt){const Ct=be.getProjectionData({overscaledTileID:Pt,applyGlobeMatrix:!X,applyTerrainMatrix:!0}),Jt=We?qa(G,w,We,{tileID:Pt,tileSize:Ae},bt):Qi(G,$),ar=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Pt),Yt=Se.getMeshFromTileID(oe,Pt.canonical,!1,!0,"raster");lt.draw(oe,ve.TRIANGLES,et,Je,Ve,ni.backCCW,Jt,ar,Ct,M.id,Yt.vertexBuffer,Yt.indexBuffer,Yt.segments)}}(t,0,l,h,_):a.cw(l)&&function(w,P,M,R){const{isRenderingGlobe:B}=R,$=w.context,G=M.implementation,X=w.style.projection,oe=w.transform,ve=oe.getProjectionDataForCustomLayer(B),Se={farZ:oe.farZ,nearZ:oe.nearZ,fov:oe.fov*Math.PI/180,modelViewProjectionMatrix:oe.modelViewProjectionMatrix,projectionMatrix:oe.projectionMatrix,shaderData:{variantName:X.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${X.shaderPreludeCode.vertexSource}`,define:X.shaderDefine},defaultProjectionData:ve},be=G.renderingMode?G.renderingMode:"2d";if(w.renderPass==="offscreen"){const Ae=G.prerender;Ae&&(w.setCustomLayerDefaults(),$.setColorMode(w.colorModeForRenderPass()),Ae.call(G,$.gl,Se),$.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),$.setColorMode(w.colorModeForRenderPass()),$.setStencilMode(Kr.disabled);const Ae=be==="3d"?w.getDepthModeFor3D():w.getDepthModeForSublayer(0,Hr.ReadOnly);$.setDepthMode(Ae),G.render($.gl,Se),$.setDirty(),w.setBaseState(),$.bindFramebuffer.set(null)}}(t,0,l,_))}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!n||!l}useProgram(t,n,l=!1,h=[]){this.cache=this.cache||{};const _=!!this.style.map.terrain,w=this.style.projection,P=l?Ui.projectionMercator:w.shaderPreludeCode,M=l?Ki:w.shaderDefine,R=t+(n?n.cacheKey:"")+`/${l?as:w.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(_?"/terrain":"")+(h?`/${h.join("/")}`:"");return this.cache[R]||(this.cache[R]=new Cs(this.context,Ui[t],n,Ma[t],this._showOverdrawInspector,_,P,M,h)),this.cache[R]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,n;if(this._tileTextures){for(const l in this._tileTextures){const h=this._tileTextures[l];if(h)for(const _ of h)_.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((n=this.tileExtentMesh.indexBuffer)===null||n===void 0||n.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const l in this.cache){const h=this.cache[l];h&&h.program&&this.context.gl.deleteProgram(h.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:n}=this.context.gl;return this.width!==t||this.height!==n}}function lu(g,t){let n,l=!1,h=null,_=null;const w=()=>{h=null,l&&(g.apply(_,n),h=setTimeout(w,t),l=!1)};return(...P)=>(l=!0,_=this,n=P,h||w(),h)}class Pl{constructor(t){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(l=h)}),(l&&l[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(!this._isValidHash(n))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:l,pitch:+(n[4]||0)}),!0},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{const n=this._getCurrentHash();if(n.length===0)return;const l=n.join("/");let h=l;h.split("&").length>0&&(h=h.split("&")[0]),this._hashName&&(h=`${this._hashName}=${l}`);let _=window.location.hash.replace(h,"");_.startsWith("#&")?_=_.slice(0,1)+_.slice(2):_==="#"&&(_="");let w=window.location.href.replace(/(#.+)?$/,_);w=w.replace("&&","&"),window.history.replaceState(window.history.state,null,w)},this._updateHash=lu(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const n=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,h),w=Math.round(n.lng*_)/_,P=Math.round(n.lat*_)/_,M=this._map.getBearing(),R=this._map.getPitch();let B="";if(B+=t?`/${w}/${P}/${l}`:`${l}/${P}/${w}`,(M||R)&&(B+="/"+Math.round(10*M)/10),R&&(B+=`/${Math.round(R)}`),this._hashName){const $=this._hashName;let G=!1;const X=window.location.hash.slice(1).split("&").map(oe=>{const ve=oe.split("=")[0];return ve===$?(G=!0,`${ve}=${B}`):oe}).filter(oe=>oe);return G||X.push(`${$}=${B}`),`#${X.join("&")}`}return`#${B}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new a.V(+t[2],+t[1])}catch{return!1}const n=+t[0],l=+(t[3]||0),h=+(t[4]||0);return n>=this._map.getMinZoom()&&n<=this._map.getMaxZoom()&&l>=-180&&l<=180&&h>=this._map.getMinPitch()&&h<=this._map.getMaxPitch()}}const Wa={linearity:.3,easing:a.cx(0,0,.3,1)},Js=a.e({deceleration:2500,maxSpeed:1400},Wa),ha=a.e({deceleration:20,maxSpeed:1400},Wa),cu=a.e({deceleration:1e3,maxSpeed:360},Wa),T=a.e({deceleration:1e3,maxSpeed:90},Wa),E=a.e({deceleration:1e3,maxSpeed:360},Wa);class U{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ce(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=ce();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,roll:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)n.zoom+=_.zoomDelta||0,n.bearing+=_.bearingDelta||0,n.pitch+=_.pitchDelta||0,n.roll+=_.rollDelta||0,_.panDelta&&n.pan._add(_.panDelta),_.around&&(n.around=_.around),_.pinchAround&&(n.pinchAround=_.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(n.pan.mag()){const _=ne(n.pan.mag(),l,a.e({},Js,t||{})),w=n.pan.mult(_.amount/n.pan.mag()),P=this._map.cameraHelper.handlePanInertia(w,this._map.transform);h.center=P.easingCenter,h.offset=P.easingOffset,Z(h,_)}if(n.zoom){const _=ne(n.zoom,l,ha);h.zoom=this._map.transform.zoom+_.amount,Z(h,_)}if(n.bearing){const _=ne(n.bearing,l,cu);h.bearing=this._map.transform.bearing+a.ao(_.amount,-179,179),Z(h,_)}if(n.pitch){const _=ne(n.pitch,l,T);h.pitch=this._map.transform.pitch+_.amount,Z(h,_)}if(n.roll){const _=ne(n.roll,l,E);h.roll=this._map.transform.roll+a.ao(_.amount,-179,179),Z(h,_)}if(h.zoom||h.bearing){const _=n.pinchAround===void 0?n.around:n.pinchAround;h.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),a.e(h,{noMoveStart:!0})}}function Z(g,t){(!g.duration||g.duration<t.duration)&&(g.duration=t.duration,g.easing=t.easing)}function ne(g,t,n){const{maxSpeed:l,linearity:h,deceleration:_}=n,w=a.ao(g*h/(t/1e3),-l,l),P=Math.abs(w)/(_*h);return{easing:n.easing,duration:1e3*P,amount:w*(P/2)}}class le extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,l,h={}){l=l instanceof MouseEvent?l:new MouseEvent(t,l);const _=Q.mousePos(n.getCanvas(),l),w=n.unproject(_);super(t,a.e({point:_,lngLat:w,originalEvent:l},h)),this._defaultPrevented=!1,this.target=n}}class pe extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,l){const h=t==="touchend"?l.changedTouches:l.touches,_=Q.touchPos(n.getCanvasContainer(),h),w=_.map(M=>n.unproject(M)),P=_.reduce((M,R,B,$)=>M.add(R.div($.length)),new a.P(0,0));super(t,{points:_,point:P,lngLats:w,lngLat:n.unproject(P),originalEvent:l}),this._defaultPrevented=!1}}class _e extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class we{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new _e(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new le(t.type,this._map,t))}mouseup(t){this._map.fire(new le(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new le(t.type,this._map,t))}dblclick(t){return this._firePreventable(new le(t.type,this._map,t))}mouseover(t){this._map.fire(new le(t.type,this._map,t))}mouseout(t){this._map.fire(new le(t.type,this._map,t))}touchstart(t){return this._firePreventable(new pe(t.type,this._map,t))}touchmove(t){this._map.fire(new pe(t.type,this._map,t))}touchend(t){this._map.fire(new pe(t.type,this._map,t))}touchcancel(t){this._map.fire(new pe(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class De{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new le(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new le("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new le(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ke{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(a.P.convert(t),this._map.terrain)}}class It{constructor(t,n){this._map=t,this._tr=new ke(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(Q.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const l=n;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=l,this._box||(this._box=Q.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(h.x,l.x),w=Math.max(h.x,l.x),P=Math.min(h.y,l.y),M=Math.max(h.y,l.y);Q.setTransform(this._box,`translate(${_}px,${P}px)`),this._box.style.width=w-_+"px",this._box.style.height=M-P+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const l=this._startPos,h=n;if(this.reset(),Q.suppressClick(),l.x!==h.x||l.y!==h.y)return this._map.fire(new a.l("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(l,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Q.remove(this._box),this._box=null),Q.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new a.l(t,{originalEvent:n}))}}function Re(g,t){if(g.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${t.length}`);const n={};for(let l=0;l<g.length;l++)n[g[l].identifier]=t[l];return n}class dt{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=function(h){const _=new a.P(0,0);for(const w of h)_._add(w);return _.div(h.length)}(n),this.touches=Re(l,n)))}touchmove(t,n,l){if(this.aborted||!this.centroid)return;const h=Re(l,n);for(const _ in this.touches){const w=h[_];(!w||w.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,n,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class _t{constructor(t){this.singleTap=new dt(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,l){this.singleTap.touchstart(t,n,l)}touchmove(t,n,l){this.singleTap.touchmove(t,n,l)}touchend(t,n,l){const h=this.singleTap.touchend(t,n,l);if(h){const _=t.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(h)<30;if(_&&w||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class qt{constructor(t){this._tr=new ke(t),this._zoomIn=new _t({numTouches:1,numTaps:2}),this._zoomOut=new _t({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,l){this._zoomIn.touchstart(t,n,l),this._zoomOut.touchstart(t,n,l)}touchmove(t,n,l){this._zoomIn.touchmove(t,n,l),this._zoomOut.touchmove(t,n,l)}touchend(t,n,l){const h=this._zoomIn.touchend(t,n,l),_=this._zoomOut.touchend(t,n,l),w=this._tr;return h?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(h)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class St{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const n=this._moveFunction(...t);if(n.bearingDelta||n.pitchDelta||n.rollDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(t,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(n)?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,n){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const h=Array.isArray(n)?n[0]:n;return!this._moved&&h.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(l,h))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&Q.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const $t=0,Wt=2,or={[$t]:1,[Wt]:2};class Qt{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const n=Q.mouseButton(t);this._eventButton=n}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(n,l){const h=or[l];return n.buttons===void 0||(n.buttons&h)!==h}(t,this._eventButton)}isValidEndEvent(t){return Q.mouseButton(t)===this._eventButton}}class Nr{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Sr{constructor(t=new Qt({checkCorrectEvent:()=>!0}),n=new Nr){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=n}_executeRelevantHandler(t,n,l){return t instanceof MouseEvent?n(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?l(t):void 0}startMove(t){this._executeRelevantHandler(t,n=>this.mouseMoveStateManager.startMove(n),n=>this.oneFingerTouchMoveStateManager.startMove(n))}endMove(t){this._executeRelevantHandler(t,n=>this.mouseMoveStateManager.endMove(n),n=>this.oneFingerTouchMoveStateManager.endMove(n))}isValidStartEvent(t){return this._executeRelevantHandler(t,n=>this.mouseMoveStateManager.isValidStartEvent(n),n=>this.oneFingerTouchMoveStateManager.isValidStartEvent(n))}isValidMoveEvent(t){return this._executeRelevantHandler(t,n=>this.mouseMoveStateManager.isValidMoveEvent(n),n=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(n))}isValidEndEvent(t){return this._executeRelevantHandler(t,n=>this.mouseMoveStateManager.isValidEndEvent(n),n=>this.oneFingerTouchMoveStateManager.isValidEndEvent(n))}}const Qr=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=t=>{t.preventDefault()}};class Cr{constructor(t,n){this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,n,l){return this._calculateTransform(t,n,l)}touchmove(t,n,l){if(this._active){if(!this._shouldBePrevented(l.length))return t.preventDefault(),this._calculateTransform(t,n,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,n,l){this._calculateTransform(t,n,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,l){l.length>0&&(this._active=!0);const h=Re(l,n),_=new a.P(0,0),w=new a.P(0,0);let P=0;for(const R in h){const B=h[R],$=this._touches[R];$&&(_._add(B),w._add(B.sub($)),P++,h[R]=B)}if(this._touches=h,this._shouldBePrevented(P)||!w.mag())return;const M=w.div(P);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(P),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ui{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,n,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,l){if(!this._firstTwoTouches)return;t.preventDefault();const[h,_]=this._firstTwoTouches,w=on(l,n,h),P=on(l,n,_);if(!w||!P)return;const M=this._aroundCenter?null:w.add(P).div(2);return this._move([w,P],M,t)}touchend(t,n,l){if(!this._firstTwoTouches)return;const[h,_]=this._firstTwoTouches,w=on(l,n,h),P=on(l,n,_);w&&P||(this._active&&Q.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function on(g,t,n){for(let l=0;l<g.length;l++)if(g[l].identifier===n)return t[l]}function ei(g,t){return Math.log(g/t)/Math.LN2}class Er extends ui{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(ei(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ei(this._distance,l),pinchAround:n}}}function _r(g,t){return 180*g.angleWith(t)/Math.PI}class Ei extends ui{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n,l){const h=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:_r(this._vector,h),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,l=_r(t,this._startVector);return Math.abs(l)<n}}function br(g){return Math.abs(g.y)>Math.abs(g.x)}class pi extends ui{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,l){super.touchstart(t,n,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,br(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const h=t[0].sub(this._lastPoints[0]),_=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,_,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(h.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,l){if(this._valid!==void 0)return this._valid;const h=t.mag()>=2,_=n.mag()>=2;if(!h&&!_)return;if(!h||!_)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const w=t.y>0==n.y>0;return br(t)&&br(n)&&w}}const ki={panStep:100,bearingStep:15,pitchStep:10};class pn{constructor(t){this._tr=new ke(t);const n=ki;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,l=0,h=0,_=0,w=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?h=1:(t.preventDefault(),w=-1);break;case 40:t.shiftKey?h=-1:(t.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(l=0,h=0),{cameraAnimation:P=>{const M=this._tr;P.easeTo({duration:300,easeId:"keyboardHandler",easing:Un,zoom:n?Math.round(M.zoom)+n*(t.shiftKey?2:1):M.zoom,bearing:M.bearing+l*this._bearingStep,pitch:M.pitch+h*this._pitchStep,offset:[-_*this._panStep,-w*this._panStep],center:M.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Un(g){return g*(2-g)}const Wi=4.000244140625,Vn=1/450;class qn{constructor(t,n){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new ke(t),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Vn}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=ce(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,n!==0&&n%Wi==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(h*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=Q.mousePos(this._map.getCanvas(),t),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(a.V.convert(l.center)):n,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const P=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=P),typeof this._targetZoom=="number"&&(this._targetZoom+=P)}if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>Wi?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&M!==0&&(M=1/M);const R=typeof this._targetZoom!="number"?t.scale:a.ar(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),a.au(R*M)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,l=this._startZoom,h=this._easing;let _,w=!1;if(this._type==="wheel"&&l&&h){const P=ce()-this._lastWheelEventTime,M=Math.min((P+5)/200,1),R=h(M);_=a.G.number(l,n,R),M<1?this._frameId||(this._frameId=!0):w=!0}else _=n,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=_,{noInertia:!0,needsRenderFrame:!w,zoomDelta:_-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=a.cz;if(this._prevEase){const l=this._prevEase,h=(ce()-l.start)/l.duration,_=l.easing(h+.01)-l.easing(h),w=.27/Math.sqrt(_*_+1e-4)*.01,P=Math.sqrt(.0729-w*w);n=a.cx(w,P,.25,1)}return this._prevEase={start:ce(),duration:t,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class vn{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ii{constructor(t){this._tr=new ke(t),this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xi{constructor(){this._tap=new _t({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,n,l){if(!this._swipePoint)if(this._tapTime){const h=n[0],_=t.timeStamp-this._tapTime<500,w=this._tapPoint.dist(h)<30;_&&w?l.length>0&&(this._swipePoint=h,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,n,l)}touchmove(t,n,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const h=n[0],_=h.y-this._swipePoint.y;return this._swipePoint=h,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,n,l)}touchend(t,n,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const h=this._tap.touchend(t,n,l);h&&(this._tapTime=t.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cr{constructor(t,n,l){this._el=t,this._mousePan=n,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class hr{constructor(t,n,l,h){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=n,this._mousePitch=l,this._mouseRoll=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class ln{constructor(t,n,l,h){this._el=t,this._touchZoom=n,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Rs{constructor(t,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=Q.create("div","maplibregl-cooperative-gesture-screen",t);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=n,this._container.appendChild(h);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=l,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Q.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,n){this._enabled&&(this._map.fire(new a.l("cooperativegestureprevented",{gestureType:t,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const zi=g=>g.zoom||g.drag||g.roll||g.pitch||g.rotate;class Di extends a.l{}function li(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta||g.rollDelta}class bn{constructor(t,n){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,_)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=h.type==="renderFrame"?void 0:h,P={needsRenderFrame:!1},M={},R={};for(const{handlerName:G,handler:X,allowed:oe}of this._handlers){if(!X.isEnabled())continue;let ve;if(this._blockedByActive(R,oe,G))X.reset();else if(X[_||h.type]){if(a.cA(h,_||h.type)){const Se=Q.mousePos(this._map.getCanvas(),h);ve=X[_||h.type](h,Se)}else if(a.cB(h,_||h.type)){const Se=this._getMapTouches(h.touches),be=Q.touchPos(this._map.getCanvas(),Se);ve=X[_||h.type](h,be,Se)}else a.cC(_||h.type)||(ve=X[_||h.type](h));this.mergeHandlerResult(P,M,ve,G,w),ve&&ve.needsRenderFrame&&this._triggerRenderFrame()}(ve||X.isActive())&&(R[G]=X)}const B={};for(const G in this._previousActiveHandlers)R[G]||(B[G]=w);this._previousActiveHandlers=R,(Object.keys(B).length||li(P))&&(this._changes.push([P,M,B]),this._triggerRenderFrame()),(Object.keys(R).length||li(P))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:$}=P;$&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],$(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new U(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,_,w]of this._listeners)Q.addEventListener(h,_,h===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[t,n,l]of this._listeners)Q.removeEventListener(t,n,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const n=this._map,l=n.getCanvasContainer();this._add("mapEvent",new we(n,t));const h=n.boxZoom=new It(n,t);this._add("boxZoom",h),t.interactive&&t.boxZoom&&h.enable();const _=n.cooperativeGestures=new Rs(n,t.cooperativeGestures);this._add("cooperativeGestures",_),t.cooperativeGestures&&_.enable();const w=new qt(n),P=new ii(n);n.doubleClickZoom=new vn(P,w),this._add("tapZoom",w),this._add("clickZoom",P),t.interactive&&t.doubleClickZoom&&n.doubleClickZoom.enable();const M=new xi;this._add("tapDragZoom",M);const R=n.touchPitch=new pi(n);this._add("touchPitch",R),t.interactive&&t.touchPitch&&n.touchPitch.enable(t.touchPitch);const B=()=>n.project(n.getCenter()),$=function({enable:Le,clickTolerance:Je,aroundCenter:et=!0,minPixelCenterThreshold:Ve=100,rotateDegreesPerPixelMoved:lt=.8},Tt){const bt=new Qt({checkCorrectEvent:Pt=>Q.mouseButton(Pt)===0&&Pt.ctrlKey||Q.mouseButton(Pt)===2&&!Pt.ctrlKey});return new St({clickTolerance:Je,move:(Pt,Ct)=>{const Jt=Tt();if(et&&Math.abs(Jt.y-Pt.y)>Ve)return{bearingDelta:a.cy(new a.P(Pt.x,Ct.y),Ct,Jt)};let ar=(Ct.x-Pt.x)*lt;return et&&Ct.y<Jt.y&&(ar=-ar),{bearingDelta:ar}},moveStateManager:bt,enable:Le,assignEvents:Qr})}(t,B),G=function({enable:Le,clickTolerance:Je,pitchDegreesPerPixelMoved:et=-.5}){const Ve=new Qt({checkCorrectEvent:lt=>Q.mouseButton(lt)===0&&lt.ctrlKey||Q.mouseButton(lt)===2});return new St({clickTolerance:Je,move:(lt,Tt)=>({pitchDelta:(Tt.y-lt.y)*et}),moveStateManager:Ve,enable:Le,assignEvents:Qr})}(t),X=function({enable:Le,clickTolerance:Je,rollDegreesPerPixelMoved:et=.3},Ve){const lt=new Qt({checkCorrectEvent:Tt=>Q.mouseButton(Tt)===2&&Tt.ctrlKey});return new St({clickTolerance:Je,move:(Tt,bt)=>{const Pt=Ve();let Ct=(bt.x-Tt.x)*et;return bt.y<Pt.y&&(Ct=-Ct),{rollDelta:Ct}},moveStateManager:lt,enable:Le,assignEvents:Qr})}(t,B);n.dragRotate=new hr(t,$,G,X),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",G,["mouseRotate","mouseRoll"]),this._add("mouseRoll",X,["mousePitch"]),t.interactive&&t.dragRotate&&n.dragRotate.enable();const oe=function({enable:Le,clickTolerance:Je}){const et=new Qt({checkCorrectEvent:Ve=>Q.mouseButton(Ve)===0&&!Ve.ctrlKey});return new St({clickTolerance:Je,move:(Ve,lt)=>({around:lt,panDelta:lt.sub(Ve)}),activateOnStart:!0,moveStateManager:et,enable:Le,assignEvents:Qr})}(t),ve=new Cr(t,n);n.dragPan=new cr(l,oe,ve),this._add("mousePan",oe),this._add("touchPan",ve,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&n.dragPan.enable(t.dragPan);const Se=new Ei,be=new Er;n.touchZoomRotate=new ln(l,be,Se,M),this._add("touchRotate",Se,["touchPan","touchZoom"]),this._add("touchZoom",be,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&n.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new De(n));const Ae=n.scrollZoom=new qn(n,()=>this._triggerRenderFrame());this._add("scrollZoom",Ae,["mousePan"]),t.interactive&&t.scrollZoom&&n.scrollZoom.enable(t.scrollZoom);const We=n.keyboard=new pn(n);this._add("keyboard",We),t.interactive&&t.keyboard&&n.keyboard.enable()}_add(t,n,l){this._handlers.push({handlerName:t,handler:n,allowed:l}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!zi(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,n,l){for(const h in t)if(h!==l&&(!n||n.indexOf(h)<0))return!0;return!1}_getMapTouches(t){const n=[];for(const l of t)this._el.contains(l.target)&&n.push(l);return n}mergeHandlerResult(t,n,l,h,_){if(!l)return;a.e(t,l);const w={handlerName:h,originalEvent:l.originalEvent||_};l.zoomDelta!==void 0&&(n.zoom=w),l.panDelta!==void 0&&(n.drag=w),l.rollDelta!==void 0&&(n.roll=w),l.pitchDelta!==void 0&&(n.pitch=w),l.bearingDelta!==void 0&&(n.rotate=w)}_applyChanges(){const t={},n={},l={};for(const[h,_,w]of this._changes)h.panDelta&&(t.panDelta=(t.panDelta||new a.P(0,0))._add(h.panDelta)),h.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+h.pitchDelta),h.rollDelta&&(t.rollDelta=(t.rollDelta||0)+h.rollDelta),h.around!==void 0&&(t.around=h.around),h.pinchAround!==void 0&&(t.pinchAround=h.pinchAround),h.noInertia&&(t.noInertia=h.noInertia),a.e(n,_),a.e(l,w);this._updateMapTransform(t,n,l),this._changes=[]}_updateMapTransform(t,n,l){const h=this._map,_=h._getTransformForUpdate(),w=h.terrain;if(!(li(t)||w&&this._terrainMovement))return this._fireEvents(n,l,!0);h._stop(!0);let{panDelta:P,zoomDelta:M,bearingDelta:R,pitchDelta:B,rollDelta:$,around:G,pinchAround:X}=t;X!==void 0&&(G=X),G=G||h.transform.centerPoint,w&&!_.isPointOnMapSurface(G)&&(G=_.centerPoint);const oe={panDelta:P,zoomDelta:M,rollDelta:$,pitchDelta:B,bearingDelta:R,around:G};this._map.cameraHelper.useGlobeControls&&!_.isPointOnMapSurface(G)&&(G=_.centerPoint);const ve=G.distSqr(_.centerPoint)<.01?_.center:_.screenPointToLocation(P?G.sub(P):G);this._handleMapControls({terrain:w,tr:_,deltasForHelper:oe,preZoomAroundLoc:ve,combinedEventsInProgress:n,panDelta:P}),h._applyUpdatedTransform(_),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,l,!0)}_handleMapControls({terrain:t,tr:n,deltasForHelper:l,preZoomAroundLoc:h,combinedEventsInProgress:_,panDelta:w}){const P=this._map.cameraHelper;if(P.handleMapControlsRollPitchBearingZoom(l,n),t)return P.useGlobeControls?(this._terrainMovement||!_.drag&&!_.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void P.handleMapControlsPan(l,n,h)):this._terrainMovement||!_.drag&&!_.zoom?void(_.drag&&this._terrainMovement&&w?n.setCenter(n.screenPointToLocation(n.centerPoint.sub(w))):P.handleMapControlsPan(l,n,h)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void P.handleMapControlsPan(l,n,h));P.handleMapControlsPan(l,n,h)}_fireEvents(t,n,l){const h=zi(this._eventsInProgress),_=zi(t),w={};for(const $ in t){const{originalEvent:G}=t[$];this._eventsInProgress[$]||(w[`${$}start`]=G),this._eventsInProgress[$]=t[$]}!h&&_&&this._fireEvent("movestart",_.originalEvent);for(const $ in w)this._fireEvent($,w[$]);_&&this._fireEvent("move",_.originalEvent);for(const $ in t){const{originalEvent:G}=t[$];this._fireEvent($,G)}const P={};let M;for(const $ in this._eventsInProgress){const{handlerName:G,originalEvent:X}=this._eventsInProgress[$];this._handlersById[G].isActive()||(delete this._eventsInProgress[$],M=n[G]||X,P[`${$}end`]=M)}for(const $ in P)this._fireEvent($,P[$]);const R=zi(this._eventsInProgress),B=(h||_)&&!R;if(B&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const $=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&$.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform($)}if(l&&B){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),G=X=>X!==0&&-this._bearingSnap<X&&X<this._bearingSnap;!$||!$.essential&&j.prefersReducedMotion?(this._map.fire(new a.l("moveend",{originalEvent:M})),G(this._map.getBearing())&&this._map.resetNorth()):(G($.bearing||this._map.getBearing())&&($.bearing=0),$.freezeElevation=!0,this._map.easeTo($,{originalEvent:M})),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new a.l(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Di("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class zs extends a.E{constructor(t,n,l){super(),this._renderFrameCallback=()=>{const h=Math.min((ce()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=l.bearingSnap,this.cameraHelper=n,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(t,n){t.apply(this.transform),this.transform=t,this.cameraHelper=n}getCenter(){return new a.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,n){return this.jumpTo({elevation:t},n),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,n,l){return t=a.P.convert(t).mult(-1),this.panTo(this.transform.center,a.e({offset:t},n),l)}panTo(t,n,l){return this.easeTo(a.e({center:t},n),l)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,l){return this.easeTo(a.e({zoom:t},n),l)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,n){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new a.l("movestart",n)).fire(new a.l("move",n)).fire(new a.l("moveend",n))),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,l){return this.easeTo(a.e({bearing:t},n),l)}resetNorth(t,n){return this.rotateTo(0,a.e({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(a.e({bearing:0,pitch:0,roll:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}getRoll(){return this.transform.roll}setRoll(t,n){return this.jumpTo({roll:t},n),this}cameraForBounds(t,n){t=wr.convert(t).adjustAntiMeridian();const l=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,n)}_cameraForBoxAndBearing(t,n,l,h){const _={top:0,bottom:0,right:0,left:0};if(typeof(h=a.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const R=h.padding;h.padding={top:R,bottom:R,right:R,left:R}}const w=a.e(_,h.padding);h.padding=w;const P=this.transform,M=new wr(t,n);return this.cameraHelper.cameraForBoxAndBearing(h,w,M,l,P)}fitBounds(t,n,l){return this._fitInternal(this.cameraForBounds(t,n),n,l)}fitScreenCoordinates(t,n,l,h,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(a.P.convert(t)),this.transform.screenPointToLocation(a.P.convert(n)),l,h),h,_)}_fitInternal(t,n,l){return t?(delete(n=a.e(t,n)).padding,n.linear?this.easeTo(n,l):this.flyTo(n,l)):this}jumpTo(t,n){this.stop();const l=this._getTransformForUpdate();let h=!1,_=!1,w=!1;const P=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,t);const M=l.zoom!==P;return"elevation"in t&&l.elevation!==+t.elevation&&l.setElevation(+t.elevation),"bearing"in t&&l.bearing!==+t.bearing&&(h=!0,l.setBearing(+t.bearing)),"pitch"in t&&l.pitch!==+t.pitch&&(_=!0,l.setPitch(+t.pitch)),"roll"in t&&l.roll!==+t.roll&&(w=!0,l.setRoll(+t.roll)),t.padding==null||l.isPaddingEqual(t.padding)||l.setPadding(t.padding),this._applyUpdatedTransform(l),this.fire(new a.l("movestart",n)).fire(new a.l("move",n)),M&&this.fire(new a.l("zoomstart",n)).fire(new a.l("zoom",n)).fire(new a.l("zoomend",n)),h&&this.fire(new a.l("rotatestart",n)).fire(new a.l("rotate",n)).fire(new a.l("rotateend",n)),_&&this.fire(new a.l("pitchstart",n)).fire(new a.l("pitch",n)).fire(new a.l("pitchend",n)),w&&this.fire(new a.l("rollstart",n)).fire(new a.l("roll",n)).fire(new a.l("rollend",n)),this.fire(new a.l("moveend",n))}calculateCameraOptionsFromTo(t,n,l,h=0){const _=a.ab.fromLngLat(t,n),w=a.ab.fromLngLat(l,h),P=w.x-_.x,M=w.y-_.y,R=w.z-_.z,B=Math.hypot(P,M,R);if(B===0)throw new Error("Can't calculate camera options with same From and To");const $=Math.hypot(P,M),G=a.au(this.transform.cameraToCenterDistance/B/this.transform.tileSize),X=180*Math.atan2(P,-M)/Math.PI;let oe=180*Math.acos($/B)/Math.PI;return oe=R<0?90-oe:90+oe,{center:w.toLngLat(),elevation:h,zoom:G,pitch:oe,bearing:X}}calculateCameraOptionsFromCameraLngLatAltRotation(t,n,l,h,_){const w=this.transform.calculateCenterFromCameraLngLatAlt(t,n,l,h);return{center:w.center,elevation:w.elevation,zoom:w.zoom,bearing:l,pitch:h,roll:_}}easeTo(t,n){this._stop(!1,t.easeId),((t=a.e({offset:[0,0],duration:500,easing:a.cz},t)).animate===!1||!t.essential&&j.prefersReducedMotion)&&(t.duration=0);const l=this._getTransformForUpdate(),h=this.getBearing(),_=l.pitch,w=l.roll,P="bearing"in t?this._normalizeBearing(t.bearing,h):h,M="pitch"in t?+t.pitch:_,R="roll"in t?this._normalizeBearing(t.roll,w):w,B="padding"in t?t.padding:l.padding,$=a.P.convert(t.offset);let G,X;t.around&&(G=a.V.convert(t.around),X=l.locationToScreenPoint(G));const oe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ve=this.cameraHelper.handleEaseTo(l,{bearing:P,pitch:M,roll:R,padding:B,around:G,aroundPoint:X,offsetAsPoint:$,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||h!==P,this._pitching=this._pitching||M!==_,this._rolling=this._rolling||R!==w,this._padding=!l.isPaddingEqual(B),this._zooming=this._zooming||ve.isZooming,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,oe),this.terrain&&this._prepareElevation(ve.elevationCenter),this._ease(Se=>{ve.easeFunc(Se),this.terrain&&!t.freezeElevation&&this._updateElevation(Se),this._applyUpdatedTransform(l),this._fireMoveEvents(n)},Se=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(n,Se)},t),this}_prepareEase(t,n,l={}){this._moving=!0,n||l.moving||this.fire(new a.l("movestart",t)),this._zooming&&!l.zooming&&this.fire(new a.l("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new a.l("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new a.l("pitchstart",t)),this._rolling&&!l.rolling&&this.fire(new a.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&n!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(n-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=n}this.transform.setElevation(a.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const n=t.getCameraLngLat(),l=t.getCameraAltitude(),h=this.terrain?this.terrain.getElevationForLngLatZoom(n,t.zoom):0;if(l<h){const _=this.calculateCameraOptionsFromTo(n,h,t.center,t.elevation);return{pitch:_.pitch,zoom:_.zoom}}return{}}_applyUpdatedTransform(t){const n=[];if(n.push(h=>this._elevateCameraIfInsideTerrain(h)),this.transformCameraUpdate&&n.push(h=>this.transformCameraUpdate(h)),!n.length)return;const l=t.clone();for(const h of n){const _=l.clone(),{center:w,zoom:P,roll:M,pitch:R,bearing:B,elevation:$}=h(_);w&&_.setCenter(w),$!==void 0&&_.setElevation($),P!==void 0&&_.setZoom(P),M!==void 0&&_.setRoll(M),R!==void 0&&_.setPitch(R),B!==void 0&&_.setBearing(B),l.apply(_)}this.transform.apply(l)}_fireMoveEvents(t){this.fire(new a.l("move",t)),this._zooming&&this.fire(new a.l("zoom",t)),this._rotating&&this.fire(new a.l("rotate",t)),this._pitching&&this.fire(new a.l("pitch",t)),this._rolling&&this.fire(new a.l("roll",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const l=this._zooming,h=this._rotating,_=this._pitching,w=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new a.l("zoomend",t)),h&&this.fire(new a.l("rotateend",t)),_&&this.fire(new a.l("pitchend",t)),w&&this.fire(new a.l("rollend",t)),this.fire(new a.l("moveend",t))}flyTo(t,n){if(!t.essential&&j.prefersReducedMotion){const Ct=a.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Ct,n)}this.stop(),t=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.cz},t);const l=this._getTransformForUpdate(),h=l.bearing,_=l.pitch,w=l.roll,P=l.padding,M="bearing"in t?this._normalizeBearing(t.bearing,h):h,R="pitch"in t?+t.pitch:_,B="roll"in t?this._normalizeBearing(t.roll,w):w,$="padding"in t?t.padding:l.padding,G=a.P.convert(t.offset);let X=l.centerPoint.add(G);const oe=l.screenPointToLocation(X),ve=this.cameraHelper.handleFlyTo(l,{bearing:M,pitch:R,roll:B,padding:$,locationAtOffset:oe,offsetAsPoint:G,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let Se=t.curve;const be=Math.max(l.width,l.height),Ae=be/ve.scaleOfZoom,We=ve.pixelPathLength;typeof ve.scaleOfMinZoom=="number"&&(Se=Math.sqrt(be/ve.scaleOfMinZoom/We*2));const Le=Se*Se;function Je(Ct){const Jt=(Ae*Ae-be*be+(Ct?-1:1)*Le*Le*We*We)/(2*(Ct?Ae:be)*Le*We);return Math.log(Math.sqrt(Jt*Jt+1)-Jt)}function et(Ct){return(Math.exp(Ct)-Math.exp(-Ct))/2}function Ve(Ct){return(Math.exp(Ct)+Math.exp(-Ct))/2}const lt=Je(!1);let Tt=function(Ct){return Ve(lt)/Ve(lt+Se*Ct)},bt=function(Ct){return be*((Ve(lt)*(et(Jt=lt+Se*Ct)/Ve(Jt))-et(lt))/Le)/We;var Jt},Pt=(Je(!0)-lt)/Se;if(Math.abs(We)<2e-6||!isFinite(Pt)){if(Math.abs(be-Ae)<1e-6)return this.easeTo(t,n);const Ct=Ae<be?-1:1;Pt=Math.abs(Math.log(Ae/be))/Se,bt=()=>0,Tt=Jt=>Math.exp(Ct*Se*Jt)}return t.duration="duration"in t?+t.duration:1e3*Pt/("screenSpeed"in t?+t.screenSpeed/Se:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=h!==M,this._pitching=R!==_,this._rolling=B!==w,this._padding=!l.isPaddingEqual($),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(ve.targetCenter),this._ease(Ct=>{const Jt=Ct*Pt,ar=1/Tt(Jt),Yt=bt(Jt);this._rotating&&l.setBearing(a.G.number(h,M,Ct)),this._pitching&&l.setPitch(a.G.number(_,R,Ct)),this._rolling&&l.setRoll(a.G.number(w,B,Ct)),this._padding&&(l.interpolatePadding(P,$,Ct),X=l.centerPoint.add(G)),ve.easeFunc(Ct,ar,Yt,X),this.terrain&&!t.freezeElevation&&this._updateElevation(Ct),this._applyUpdatedTransform(l),this._fireMoveEvents(n)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,n)}return t||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(t,n,l){l.animate===!1||l.duration===0?(t(1),n()):(this._easeStart=ce(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,n){t=a.W(t,-180,180);const l=Math.abs(t-n);return Math.abs(t-360-n)<l&&(t-=360),Math.abs(t+360-n)<l&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(a.V.convert(t)):null}}const Qn={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class vs{constructor(t=Qn){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=Q.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Q.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Q.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const l=this._map._getUIString(`AttributionControl.${n}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(h=>typeof h!="string"?"":h)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const n=this._map.style.tileManagers;for(const h in n){const _=n[h];if(_.used||_.usedForTerrain){const w=_.getSource();w.attribution&&t.indexOf(w.attribution)<0&&t.push(w.attribution)}}t=t.filter(h=>String(h).trim()),t.sort((h,_)=>h.length-_.length),t=t.filter((h,_)=>{for(let w=_+1;w<t.length;w++)if(t[w].indexOf(h)>=0)return!1;return!0});const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=Q.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Fn{constructor(t={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=Q.create("div","maplibregl-ctrl");const n=Q.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Q.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class fi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,l=n?this._queue.concat(n):this._queue;for(const h of l)if(h.id===t)return void(h.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const l of n)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var _i=a.aV([{name:"a_pos3d",type:"Int16",components:3}]);class Ni extends a.E{constructor(t){super(),this._lastTilesetChange=ce(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,n){this.tileManager.update(t,n),this._renderableTilesKeys=[];const l={};for(const h of rr(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n,calculateTileZoom:this.tileManager._source.calculateTileZoom}))l[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.terrainRttPosMatrix32f=new Float64Array(16),a.c8(h.terrainRttPosMatrix32f,0,a.a5,a.a5,0,0,1),this._tiles[h.key]=new Rt(h,this.tileSize),this._lastTilesetChange=ce());for(const h in this._tiles)l[h]||delete this._tiles[h]}freeRtt(t){for(const n in this._tiles){const l=this._tiles[n];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,n){return n?this._getTerrainCoordsForTileRanges(t,n):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const n={};for(const l of this._renderableTilesKeys){const h=this._tiles[l].tileID,_=t.clone(),w=a.bl();if(h.canonical.equals(t.canonical))a.c8(w,0,a.a5,a.a5,0,0,1);else if(h.canonical.isChildOf(t.canonical)){const P=h.canonical.z-t.canonical.z,M=h.canonical.x-(h.canonical.x>>P<<P),R=h.canonical.y-(h.canonical.y>>P<<P),B=a.a5>>P;a.c8(w,0,B,B,0,0,1),a.O(w,w,[-M*B,-R*B,0])}else{if(!t.canonical.isChildOf(h.canonical))continue;{const P=t.canonical.z-h.canonical.z,M=t.canonical.x-(t.canonical.x>>P<<P),R=t.canonical.y-(t.canonical.y>>P<<P),B=a.a5>>P;a.c8(w,0,a.a5,a.a5,0,0,1),a.O(w,w,[M*B,R*B,0]),a.Q(w,w,[1/2**P,1/2**P,0])}}_.terrainRttPosMatrix32f=new Float32Array(w),n[l]=_}return n}_getTerrainCoordsForTileRanges(t,n){const l={};for(const h of this._renderableTilesKeys){const _=this._tiles[h].tileID;if(!this._isWithinTileRanges(_,n))continue;const w=t.clone(),P=a.bl();if(_.canonical.z===t.canonical.z){const M=t.canonical.x-_.canonical.x,R=t.canonical.y-_.canonical.y;a.c8(P,0,a.a5,a.a5,0,0,1),a.O(P,P,[M*a.a5,R*a.a5,0])}else if(_.canonical.z>t.canonical.z){const M=_.canonical.z-t.canonical.z,R=_.canonical.x-(_.canonical.x>>M<<M),B=_.canonical.y-(_.canonical.y>>M<<M),$=t.canonical.x-(_.canonical.x>>M),G=t.canonical.y-(_.canonical.y>>M),X=a.a5>>M;a.c8(P,0,X,X,0,0,1),a.O(P,P,[-R*X+$*a.a5,-B*X+G*a.a5,0])}else{const M=t.canonical.z-_.canonical.z,R=t.canonical.x-(t.canonical.x>>M<<M),B=t.canonical.y-(t.canonical.y>>M<<M),$=(t.canonical.x>>M)-_.canonical.x,G=(t.canonical.y>>M)-_.canonical.y,X=a.a5<<M;a.c8(P,0,X,X,0,0,1),a.O(P,P,[R*a.a5+$*X,B*a.a5+G*X,0])}w.terrainRttPosMatrix32f=new Float32Array(P),l[h]=w}return l}getSourceTile(t,n){const l=this.tileManager._source;let h=t.overscaledZ-this.deltaZoom;if(h>l.maxzoom&&(h=l.maxzoom),h<l.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(h).key);let _=this.findTileInCaches(this._sourceTileCache[t.key]);if(!_?.dem&&n)for(;h>=l.minzoom&&!_?.dem;)_=this.findTileInCaches(t.scaledTo(h--).key);return _}findTileInCaches(t){let n=this.tileManager.getTileByID(t);return n||(n=this.tileManager._outOfViewCache.getByKey(t),n)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,n){return n[t.canonical.z]&&t.canonical.x>=n[t.canonical.z].minTileX&&t.canonical.x<=n[t.canonical.z].maxTileX&&t.canonical.y>=n[t.canonical.z].minTileY&&t.canonical.y<=n[t.canonical.z].maxTileY}}class Gn{constructor(t,n,l){this._meshCache={},this.painter=t,this.tileManager=new Ni(n),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,n,l,h=a.a5){var _;if(!(n>=0&&n<h&&l>=0&&l<h))return 0;const w=this.getTerrainData(t),P=(_=w.tile)===null||_===void 0?void 0:_.dem;if(!P)return 0;const M=a.cD([],[n/h*a.a5,l/h*a.a5],w.u_terrain_matrix),R=[M[0]*P.dim,M[1]*P.dim],B=Math.floor(R[0]),$=Math.floor(R[1]),G=R[0]-B,X=R[1]-$;return P.get(B,$)*(1-G)*(1-X)+P.get(B+1,$)*G*(1-X)+P.get(B,$+1)*(1-G)*X+P.get(B+1,$+1)*G*X}getElevationForLngLatZoom(t,n){if(!a.cE(n,t.wrap()))return 0;const{tileID:l,mercatorX:h,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(t,n);return this.getElevation(l,h%a.a5,_%a.a5,a.a5)}getElevationForLngLat(t){return this.getElevationForLngLatZoom(t,this.tileManager.maxzoom)}getElevation(t,n,l,h=a.a5){return this.getDEMElevation(t,n,l,h)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const h=this.painter.context,_=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new a.T(h,_,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new a.T(h,new a.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.as([])}const n=this.tileManager.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const h=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new a.T(h,n.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),n.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const l=n&&n+n.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const h=this.tileManager.getSource().maxzoom;let _=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=h?_=t.canonical.z-h:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=t.canonical.x-(t.canonical.x>>_<<_),P=t.canonical.y-(t.canonical.y>>_<<_),M=a.cF(new Float64Array(16),[1/(a.a5<<_),1/(a.a5<<_),0]);a.O(M,M,[w*a.a5,P*a.a5,0]),this._demMatrixCache[t.key]={matrix:M,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(t){const n=this.painter,l=n.width/devicePixelRatio,h=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new a.T(n.context,{width:l,height:h,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new a.T(n.context,{width:l,height:h,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(l,h,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,l,h))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,w=0;_<this._coordsTextureSize;_++)for(let P=0;P<this._coordsTextureSize;P++,w+=4)n[w+0]=255&P,n[w+1]=255&_,n[w+2]=P>>8<<4|_>>8,n[w+3]=0;const l=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),h=new a.T(t,l,t.gl.RGBA,{premultiply:!1});return h.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),l=this.painter.context,h=l.gl,_=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),w=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),P=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(_,P-w-1,1,1,h.RGBA,h.UNSIGNED_BYTE,n),l.bindFramebuffer.set(null);const M=n[0]+(n[2]>>4<<8),R=n[1]+((15&n[2])<<8),B=this.coordsIndex[255-n[3]],$=B&&this.tileManager.getTileByID(B);if(!$)return null;const G=this._coordsTextureSize,X=(1<<$.tileID.canonical.z)*G;return new a.ab(($.tileID.canonical.x*G+M)/X+$.tileID.wrap,($.tileID.canonical.y*G+R)/X,this.getElevation($.tileID,M,R,G))}depthAtPoint(t){const n=new Uint8Array(4),l=this.painter.context,h=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,n),l.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(t){var n;const l=((n=this.painter.style.projection)===null||n===void 0?void 0:n.transitionState)>0,h=l&&t.canonical.y===0,_=l&&t.canonical.y===(1<<t.canonical.z)-1,w=`m_${h?"n":""}_${_?"s":""}`;if(this._meshCache[w])return this._meshCache[w];const P=this.painter.context,M=new a.cG,R=new a.aZ,B=this.meshSize,$=a.a5/B,G=B*B;for(let Ve=0;Ve<=B;Ve++)for(let lt=0;lt<=B;lt++)M.emplaceBack(lt*$,Ve*$,0);for(let Ve=0;Ve<G;Ve+=B+1)for(let lt=0;lt<B;lt++)R.emplaceBack(lt+Ve,B+lt+Ve+1,B+lt+Ve+2),R.emplaceBack(lt+Ve,B+lt+Ve+2,lt+Ve+1);const X=M.length,oe=X+(B+1),ve=(B+1)*B,Se=h?a.bs:0,be=h?0:1,Ae=_?a.bt:a.a5,We=_?0:1;for(let Ve=0;Ve<=B;Ve++)M.emplaceBack(Ve*$,Se,be);for(let Ve=0;Ve<=B;Ve++)M.emplaceBack(Ve*$,Ae,We);for(let Ve=0;Ve<B;Ve++)R.emplaceBack(ve+Ve,oe+Ve,oe+Ve+1),R.emplaceBack(ve+Ve,oe+Ve+1,ve+Ve+1),R.emplaceBack(0+Ve,X+Ve+1,X+Ve),R.emplaceBack(0+Ve,0+Ve+1,X+Ve+1);const Le=M.length,Je=Le+2*(B+1);for(const Ve of[0,1])for(let lt=0;lt<=B;lt++)for(const Tt of[0,1])M.emplaceBack(Ve*a.a5,lt*$,Tt);for(let Ve=0;Ve<2*B;Ve+=2)R.emplaceBack(Le+Ve,Le+Ve+1,Le+Ve+3),R.emplaceBack(Le+Ve,Le+Ve+3,Le+Ve+2),R.emplaceBack(Je+Ve,Je+Ve+3,Je+Ve+1),R.emplaceBack(Je+Ve,Je+Ve+2,Je+Ve+3);const et=new wi(P.createVertexBuffer(M,_i.members),P.createIndexBuffer(R),a.aY.simpleSegment(0,0,M.length,R.length));return this._meshCache[w]=et,et}getMeshFrameDelta(t){return 2*Math.PI*a.bF/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,n){var l;if(!a.cE(n,t.wrap()))return 0;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(t,n);return(l=this.getMinMaxElevation(h).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return n&&n.dem&&(l.minElevation=n.dem.min*this.exaggeration,l.maxElevation=n.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,n){const l=a.ab.fromLngLat(t.wrap()),h=(1<<n)*a.a5,_=l.x*h,w=l.y*h,P=Math.floor(_/a.a5),M=Math.floor(w/a.a5);return{tileID:new a.a2(n,0,n,P,M),mercatorX:_,mercatorY:w}}}class bs{constructor(t,n,l){this._context=t,this._size=n,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new a.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(l.texture),{id:t,fbo:n,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>t.id!==n),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const xs={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class da{constructor(t,n){this.painter=t,this.terrain=n,this.pool=new bs(t.context,30,n.tileManager.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter(l=>!t._layers[l].isHidden(n)),this._coordsAscending={};for(const l in t.tileManagers){this._coordsAscending[l]={};const h=t.tileManagers[l].getVisibleCoordinates(),_=t.tileManagers[l].getSource(),w=_ instanceof Rr?_.terrainTileRanges:null;for(const P of h){const M=this.terrain.tileManager.getTerrainCoords(P,w);for(const R in M)this._coordsAscending[l][R]||(this._coordsAscending[l][R]=[]),this._coordsAscending[l][R].push(M[R])}}this._coordsAscendingStr={};for(const l of t._order){const h=t._layers[l],_=h.source;if(xs[h.type]&&!this._coordsAscendingStr[_]){this._coordsAscendingStr[_]={};for(const w in this._coordsAscending[_])this._coordsAscendingStr[_][w]=this._coordsAscending[_][w].map(P=>P.key).sort().join()}}for(const l of this._renderableTiles)for(const h in this._coordsAscendingStr){const _=this._coordsAscendingStr[h][l.tileID.key];_&&_!==l.rttCoords[h]&&(l.rtt=[])}}renderLayer(t,n){if(t.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},n),{isRenderingToTexture:!0}),h=t.type,_=this.painter,w=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(xs[h]&&(this._prevType&&xs[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(t.id),!w))return!0;if(xs[this._prevType]||xs[h]&&w){this._prevType=h;const P=this._stacks.length-1,M=this._stacks[P]||[];for(const R of this._renderableTiles){if(this.pool.isFull()&&(au(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(R),R.rtt[P]){const $=this.pool.getObjectForId(R.rtt[P].id);if($.stamp===R.rtt[P].stamp){this.pool.useObject($);continue}}const B=this.pool.getOrCreateFreeObject();this.pool.useObject(B),this.pool.stampObject(B),R.rtt[P]={id:B.id,stamp:B.stamp},_.context.bindFramebuffer.set(B.fbo.framebuffer),_.context.clear({color:a.bq.transparent,stencil:0}),_.currentStencilSource=void 0;for(let $=0;$<M.length;$++){const G=_.style._layers[M[$]],X=G.source?this._coordsAscending[G.source][R.tileID.key]:[R.tileID];_.context.viewport.set([0,0,B.fbo.width,B.fbo.height]),_._renderTileClippingMasks(G,X,!0),_.renderLayer(_,_.style.tileManagers[G.source],G,X,l),G.source&&(R.rttCoords[G.source]=this._coordsAscendingStr[G.source][R.tileID.key])}}return au(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),xs[h]}return!1}}const In={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},So=C,Al={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Qn,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},Il={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Qo{constructor(t,n,l=!1){this.mousedown=_=>{this.startMove(_,Q.mousePos(this.element,_)),Q.addEventListener(window,"mousemove",this.mousemove),Q.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.move(_,Q.mousePos(this.element,_))},this.mouseup=_=>{this._rotatePitchHandler.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Q.touchPos(this.element,_.targetTouches)[0],this.startMove(_,this._startPos),Q.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Q.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=Q.touchPos(this.element,_.targetTouches)[0],this.move(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=n;const h=new Sr;this._rotatePitchHandler=new St({clickTolerance:3,move:(_,w)=>{const P=n.getBoundingClientRect(),M=new a.P((P.bottom-P.top)/2,(P.right-P.left)/2);return{bearingDelta:a.cy(new a.P(_.x,w.y),w,M),pitchDelta:l?-.5*(w.y-_.y):void 0}},moveStateManager:h,enable:!0,assignEvents:()=>{}}),this.map=t,Q.addEventListener(n,"mousedown",this.mousedown),Q.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),Q.addEventListener(n,"touchcancel",this.reset)}startMove(t,n){this._rotatePitchHandler.dragStart(t,n),Q.disableDrag()}move(t,n){const l=this.map,{bearingDelta:h,pitchDelta:_}=this._rotatePitchHandler.dragMove(t,n)||{};h&&l.setBearing(l.getBearing()+h),_&&l.setPitch(l.getPitch()+_)}off(){const t=this.element;Q.removeEventListener(t,"mousedown",this.mousedown),Q.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),Q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Q.removeEventListener(window,"touchend",this.touchend),Q.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){Q.enableDrag(),Q.removeEventListener(window,"mousemove",this.mousemove),Q.removeEventListener(window,"mouseup",this.mouseup),Q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Q.removeEventListener(window,"touchend",this.touchend)}}let Ha;function Cc(g,t,n,l=!1){if(l||!n.getCoveringTilesDetailsProvider().allowWorldCopies())return g?.wrap();const h=new a.V(g.lng,g.lat);if(g=new a.V(g.lng,g.lat),t){const _=new a.V(g.lng-360,g.lat),w=new a.V(g.lng+360,g.lat),P=n.locationToScreenPoint(g).distSqr(t);n.locationToScreenPoint(_).distSqr(t)<P?g=_:n.locationToScreenPoint(w).distSqr(t)<P&&(g=w)}for(;Math.abs(g.lng-n.center.lng)>180;){const _=n.locationToScreenPoint(g);if(_.x>=0&&_.y>=0&&_.x<=n.width&&_.y<=n.height)break;g.lng>n.center.lng?g.lng-=360:g.lng+=360}return g.lng!==h.lng&&n.isPointOnMapSurface(n.locationToScreenPoint(g))?g:h}const el={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function fa(g,t,n){const l=g.classList;for(const h in el)l.remove(`maplibregl-${n}-anchor-${h}`);l.add(`maplibregl-${n}-anchor-${t}`)}class ac extends a.E{constructor(t){if(super(),this._onKeyPress=n=>{const l=n.code,h=n.charCode||n.keyCode;l!=="Space"&&l!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=n=>{const l=n.originalEvent.target,h=this._element;this._popup&&(l===h||h.contains(l))&&this.togglePopup()},this._update=n=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();(n?.type==="terrain"||n?.type==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=Cc(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),Q.setTransform(this._element,`${el[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${h}`),j.frameAsync(new AbortController).then(()=>{this._updateOpacity(n&&n.type==="moveend")}).catch(()=>{})},this._onMove=n=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.l("dragstart"))),this.fire(new a.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.l("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=a.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Q.create("div");const n=Q.createNS("http://www.w3.org/2000/svg","svg"),l=41,h=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${l}px`),n.setAttributeNS(null,"width",`${h}px`),n.setAttributeNS(null,"viewBox",`0 0 ${h} ${l}`);const _=Q.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const w=Q.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const P=Q.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"transform","translate(3.0, 29.0)"),P.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const be of M){const Ae=Q.createNS("http://www.w3.org/2000/svg","ellipse");Ae.setAttributeNS(null,"opacity","0.04"),Ae.setAttributeNS(null,"cx","10.5"),Ae.setAttributeNS(null,"cy","5.80029008"),Ae.setAttributeNS(null,"rx",be.rx),Ae.setAttributeNS(null,"ry",be.ry),P.appendChild(Ae)}const R=Q.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill",this._color);const B=Q.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),R.appendChild(B);const $=Q.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"opacity","0.25"),$.setAttributeNS(null,"fill","#000000");const G=Q.createNS("http://www.w3.org/2000/svg","path");G.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),$.appendChild(G);const X=Q.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(6.0, 7.0)"),X.setAttributeNS(null,"fill","#FFFFFF");const oe=Q.createNS("http://www.w3.org/2000/svg","g");oe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ve=Q.createNS("http://www.w3.org/2000/svg","circle");ve.setAttributeNS(null,"fill","#000000"),ve.setAttributeNS(null,"opacity","0.25"),ve.setAttributeNS(null,"cx","5.5"),ve.setAttributeNS(null,"cy","5.5"),ve.setAttributeNS(null,"r","5.4999962");const Se=Q.createNS("http://www.w3.org/2000/svg","circle");Se.setAttributeNS(null,"fill","#FFFFFF"),Se.setAttributeNS(null,"cx","5.5"),Se.setAttributeNS(null,"cy","5.5"),Se.setAttributeNS(null,"r","5.4999962"),oe.appendChild(ve),oe.appendChild(Se),w.appendChild(P),w.appendChild(R),w.appendChild($),w.appendChild(X),w.appendChild(oe),n.appendChild(w),n.setAttributeNS(null,"height",l*this._scale+"px"),n.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(n),this._offset=a.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),fa(this._element,this._anchor,"marker"),t&&t.className)for(const n of t.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Q.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=a.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const h=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var n,l;const h=(n=this._map)===null||n===void 0?void 0:n.terrain,_=this._map.transform.isLocationOccluded(this._lngLat);if(!h||_){const X=_?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==X&&(this._element.style.opacity=X))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const w=this._map,P=w.terrain.depthAtPoint(this._pos),M=w.terrain.getElevationForLngLat(this._lngLat);if(w.transform.lngLatToCameraDepth(this._lngLat,M)-P<.006)return void(this._element.style.opacity=this._opacity);const R=-this._offset.y/w.transform.pixelsPerMeter,B=Math.sin(w.getPitch()*Math.PI/180)*R,$=w.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),G=w.transform.lngLatToCameraDepth(this._lngLat,M+B)-$>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&G&&this._popup.remove(),this._element.style.opacity=G?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=a.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,n){return(this._opacity===void 0||t===void 0&&n===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const uu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let tl=0,To=!1;const El={maxWidth:100,unit:"metric"};function Ll(g,t,n){const l=n&&n.maxWidth||100,h=g._container.clientHeight/2,_=g._container.clientWidth/2,w=g.unproject([_-l/2,h]),P=g.unproject([_+l/2,h]),M=Math.round(g.project(P).x-g.project(w).x),R=Math.min(l,M,g._container.clientWidth),B=w.distanceTo(P);if(n&&n.unit==="imperial"){const $=3.2808*B;$>5280?Po(t,R,$/5280,g._getUIString("ScaleControl.Miles")):Po(t,R,$,g._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Po(t,R,B/1852,g._getUIString("ScaleControl.NauticalMiles")):B>=1e3?Po(t,R,B/1e3,g._getUIString("ScaleControl.Kilometers")):Po(t,R,B,g._getUIString("ScaleControl.Meters"))}function Po(g,t,n,l){const h=function(_){const w=Math.pow(10,`${Math.floor(_)}`.length-1);let P=_/w;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(M){const R=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*R)/R}(P),w*P}(n);g.style.width=t*(h/n)+"px",g.innerHTML=`${h}&nbsp;${l}`}const Ml={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},oc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ao(g){if(g){if(typeof g=="number"){const t=Math.round(Math.abs(g)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,g),"top-left":new a.P(t,t),"top-right":new a.P(-t,t),bottom:new a.P(0,-g),"bottom-left":new a.P(t,-t),"bottom-right":new a.P(-t,-t),left:new a.P(g,0),right:new a.P(-g,0)}}if(g instanceof a.P||Array.isArray(g)){const t=a.P.convert(g);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:a.P.convert(g.center||[0,0]),top:a.P.convert(g.top||[0,0]),"top-left":a.P.convert(g["top-left"]||[0,0]),"top-right":a.P.convert(g["top-right"]||[0,0]),bottom:a.P.convert(g.bottom||[0,0]),"bottom-left":a.P.convert(g["bottom-left"]||[0,0]),"bottom-right":a.P.convert(g["bottom-right"]||[0,0]),left:a.P.convert(g.left||[0,0]),right:a.P.convert(g.right||[0,0])}}return Ao(new a.P(0,0))}const kc=C;b.AJAXError=a.cJ,b.Event=a.l,b.Evented=a.E,b.LngLat=a.V,b.MercatorCoordinate=a.ab,b.Point=a.P,b.addProtocol=a.cK,b.config=a.c,b.removeProtocol=a.cL,b.AttributionControl=vs,b.BoxZoomHandler=It,b.CanvasSource=re,b.CooperativeGesturesHandler=Rs,b.DoubleClickZoomHandler=vn,b.DragPanHandler=cr,b.DragRotateHandler=hr,b.EdgeInsets=aa,b.FullscreenControl=class extends a.E{constructor(g={}){super(),this._onFullscreenChange=()=>{var t;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=n?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Q.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=Q.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Q.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},b.GeoJSONSource=ai,b.GeolocateControl=class extends a.E{constructor(g){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new a.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const n=new a.V(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,h=this._map.getBearing(),_=a.e({bearing:h},this.options.fitBoundsOptions),w=wr.fromLngLat(n,l);this._map.fitBounds(w,_,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const n=new a.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&To)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Q.create("button","maplibregl-ctrl-geolocate",this._container),Q.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Q.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ac({element:this._dotElement}),this._circleElement=Q.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ac({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{const l=n?.[0]instanceof ResizeObserverEntry;n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.l("trackuserlocationend")),this.fire(new a.l("userlocationlostfocus")))})}},this.options=a.e({},uu,g)}onAdd(g){return this._map=g,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return a._(this,arguments,void 0,function*(t=!1){if(Ha!==void 0&&!t)return Ha;if(window.navigator.permissions===void 0)return Ha=!!window.navigator.geolocation,Ha;try{Ha=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ha=!!window.navigator.geolocation}return Ha})}().then(t=>this._finishSetupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Q.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,tl=0,To=!1}_isOutOfMapMaxBounds(g){const t=this._map.getMaxBounds(),n=g.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const g=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&g))return;const t=this._map.project(g),n=this._map.unproject([t.x+100,t.y]),l=g.distanceTo(n)/100,h=2*this._accuracy/l;this._circleElement.style.width=`${h.toFixed(2)}px`,this._circleElement.style.height=`${h.toFixed(2)}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":tl--,To=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.l("trackuserlocationstart")),this.fire(new a.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),tl++,tl>1?(g={maximumAge:6e5,timeout:0},To=!0):(g=this.options.positionOptions,To=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},b.GlobeControl=class{constructor(){this._toggleProjection=()=>{var g;const t=(g=this._map.getProjection())===null||g===void 0?void 0:g.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var g;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((g=this._map.getProjection())===null||g===void 0?void 0:g.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(g){return this._map=g,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Q.create("button","maplibregl-ctrl-globe",this._container),Q.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Q.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},b.Hash=Pl,b.ImageSource=Rr,b.KeyboardHandler=pn,b.LngLatBounds=wr,b.LogoControl=Fn,b.Map=class extends zs{constructor(g){var t,n;a.cH.mark(a.cI.create);const l=Object.assign(Object.assign(Object.assign({},Al),g),{canvasContextAttributes:Object.assign(Object.assign({},Al.canvasContextAttributes),g.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const h=new oa,_=new Zs;if(l.minZoom!==void 0&&h.setMinZoom(l.minZoom),l.maxZoom!==void 0&&h.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&h.setMinPitch(l.minPitch),l.maxPitch!==void 0&&h.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&h.setRenderWorldCopies(l.renderWorldCopies),l.transformConstrain!==null&&h.setConstrainOverride(l.transformConstrain),super(h,_,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new fi,this._controls=[],this._mapId=a.ah(),this._lostContextStyle={style:null,images:null},this._contextLost=P=>{P.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const M of Object.values(this.style._layers))if(M.type==="custom"&&console.warn(`Custom layer with id '${M.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),M._listeners)for(const[R]of Object.entries(M._listeners))console.warn(`Custom layer with id '${M.id}' had event listeners for event '${R}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new a.l("webglcontextlost",{originalEvent:P}))},this._contextRestored=P=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new a.l("webglcontextrestored",{originalEvent:P}))},this._onMapScroll=P=>{if(P.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},In),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this._zoomLevelsToOverscale=l.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=l.transformCameraUpdate,this.transformConstrain=l.transformConstrain,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,l.reduceMotion!==void 0&&(j.prefersReducedMotion=l.reduceMotion),this._imageQueueHandle=it.addThrottleControl(()=>this.isMoving()),this._requestManager=new He(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let P=!1;const M=lu(R=>{this._trackResize&&!this._removed&&(this.resize(R),this.redraw())},50);this._resizeObserver=new ResizeObserver(R=>{P?M(R):P=!0}),this._resizeObserver.observe(this._container)}this.handlers=new bn(this,l),this._hash=l.hash&&new Pl(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,a.e({},l.fitBoundsOptions,{duration:0}))));const w=typeof l.style=="string"||((n=(t=l.style)===null||t===void 0?void 0:t.projection)===null||n===void 0?void 0:n.type)!=="globe";this.resize(null,w),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new vs(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new Fn,l.logoPosition),this.on("style.load",()=>{if(w||this._resizeTransform(),this.transform.unmodified){const P=a.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(P)}}),this.on("data",P=>{this._update(P.dataType==="style"),this.fire(new a.l(`${P.dataType}data`,P))}),this.on("dataloading",P=>{this.fire(new a.l(`${P.dataType}dataloading`,P))}),this.on("dataabort",P=>{this.fire(new a.l("sourcedataabort",P))})}_getMapId(){return this._mapId}setGlobalStateProperty(g,t){return this.style.setGlobalStateProperty(g,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(g,t){if(t===void 0&&(t=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new a.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=g.onAdd(this);this._controls.push(g);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(n,l.firstChild):l.appendChild(n),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new a.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(g);return t>-1&&this._controls.splice(t,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}coveringTiles(g){return rr(this.transform,g)}calculateCameraOptionsFromTo(g,t,n,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLat(n)),super.calculateCameraOptionsFromTo(g,t,n,l)}resize(g,t=!0){const[n,l]=this._containerDimensions(),h=this._getClampedPixelRatio(n,l);if(this._resizeCanvas(n,l,h),this.painter.resize(n,l,h),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const P=this._getClampedPixelRatio(n,l);this._resizeCanvas(n,l,P),this.painter.resize(n,l,P)}this._resizeTransform(t);const _=!this._moving;return _&&(this.stop(),this.fire(new a.l("movestart",g)).fire(new a.l("move",g))),this.fire(new a.l("resize",g)),_&&this.fire(new a.l("moveend",g)),this}_resizeTransform(g=!0){var t;const[n,l]=this._containerDimensions();this.transform.resize(n,l,g),(t=this._requestedCameraState)===null||t===void 0||t.resize(n,l,g)}_getClampedPixelRatio(g,t){const{0:n,1:l}=this._maxCanvasSize,h=this.getPixelRatio(),_=g*h,w=t*h;return Math.min(_>n?n/_:1,w>l?l/w:1)*h}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(wr.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.setMinZoom(g),this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.setMaxZoom(g),this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.setMinPitch(g),this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(g>=this.transform.minPitch)return this.transform.setMaxPitch(g),this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.setRenderWorldCopies(g),this._update()}setTransformConstrain(g){return this.transform.setConstrainOverride(g),this._update()}project(g){return this.transform.locationToScreenPoint(a.V.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.screenPointToLocation(a.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,t,n){if(g==="mouseenter"||g==="mouseover"){let l=!1;return{layers:t,listener:n,delegates:{mousemove:_=>{const w=t.filter(M=>this.getLayer(M)),P=w.length!==0?this.queryRenderedFeatures(_.point,{layers:w}):[];P.length?l||(l=!0,n.call(this,new le(g,this,_.originalEvent,{features:P}))):l=!1},mouseout:()=>{l=!1}}}}if(g==="mouseleave"||g==="mouseout"){let l=!1;return{layers:t,listener:n,delegates:{mousemove:w=>{const P=t.filter(M=>this.getLayer(M));(P.length!==0?this.queryRenderedFeatures(w.point,{layers:P}):[]).length?l=!0:l&&(l=!1,n.call(this,new le(g,this,w.originalEvent)))},mouseout:w=>{l&&(l=!1,n.call(this,new le(g,this,w.originalEvent)))}}}}{const l=h=>{const _=t.filter(P=>this.getLayer(P)),w=_.length!==0?this.queryRenderedFeatures(h.point,{layers:_}):[];w.length&&(h.features=w,n.call(this,h),delete h.features)};return{layers:t,listener:n,delegates:{[g]:l}}}}_saveDelegatedListener(g,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(t)}_removeDelegatedListener(g,t,n){if(!this._delegatedListeners||!this._delegatedListeners[g])return;const l=this._delegatedListeners[g];for(let h=0;h<l.length;h++){const _=l[h];if(_.listener===n&&_.layers.length===t.length&&_.layers.every(w=>t.includes(w))){for(const w in _.delegates)this.off(w,_.delegates[w]);return void l.splice(h,1)}}}on(g,t,n){if(n===void 0)return super.on(g,t);const l=typeof t=="string"?[t]:t,h=this._createDelegatedListener(g,l,n);this._saveDelegatedListener(g,h);for(const _ in h.delegates)this.on(_,h.delegates[_]);return{unsubscribe:()=>{this._removeDelegatedListener(g,l,n)}}}once(g,t,n){if(n===void 0)return super.once(g,t);const l=typeof t=="string"?[t]:t,h=this._createDelegatedListener(g,l,n);for(const _ in h.delegates){const w=h.delegates[_];h.delegates[_]=(...P)=>{this._removeDelegatedListener(g,l,n),w(...P)}}this._saveDelegatedListener(g,h);for(const _ in h.delegates)this.once(_,h.delegates[_]);return this}off(g,t,n){return n===void 0?super.off(g,t):(this._removeDelegatedListener(g,typeof t=="string"?[t]:t,n),this)}queryRenderedFeatures(g,t){if(!this.style)return[];let n;const l=g instanceof a.P||Array.isArray(g),h=l?g:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:g)||{},h instanceof a.P||typeof h[0]=="number")n=[a.P.convert(h)];else{const _=a.P.convert(h[0]),w=a.P.convert(h[1]);n=[_,new a.P(w.x,_.y),w,new a.P(_.x,w.y),_]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(g,t){return this.style.querySourceFeatures(g,t)}setStyle(g,t){return(t=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(g,t))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const t=this._locale[g];if(t==null)throw new Error(`Missing UI string '${g}'`);return t}_updateStyle(g,t){var n,l;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(g,t));const h=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new ca(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,t,h):this.style.loadJSON(g,t,h),this):((l=(n=this.style)===null||n===void 0?void 0:n.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ca(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,t){if(typeof g=="string"){const n=this._requestManager.transformRequest(g,"Style");a.j(n,new AbortController).then(l=>{this._updateDiff(l.data,t)}).catch(l=>{l&&this.fire(new a.k(l))})}else typeof g=="object"&&this._updateDiff(g,t)}_updateDiff(g,t){try{this.style.setState(g,t)&&this._update(!0)}catch(n){a.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(g,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(g,t){return this._lazyInitEmptyStyle(),this.style.addSource(g,t),this._update(!0)}isSourceLoaded(g){const t=this.style&&this.style.tileManagers[g];if(t!==void 0)return t.loaded();this.fire(new a.k(new Error(`There is no tile manager with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const t=this.style.tileManagers[g.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain===null&&t.reload();for(const n in this.style._layers){const l=this.style._layers[n];l.type==="hillshade"&&l.source===g.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),l.type==="color-relief"&&l.source===g.source&&a.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Gn(this.painter,t,g),this.painter.renderToTexture=new da(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=n=>{var l;n.dataType==="style"?this.terrain.tileManager.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==g.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=n.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new a.l("terrain",{terrain:g})),this}getTerrain(){var g,t;return(t=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const g=this.style&&this.style.tileManagers;for(const t of Object.values(g))if(!t.areTilesLoaded())return!1;return!0}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}setSourceTileLodParams(g,t,n){if(n){const l=this.getSource(n);if(!l)throw new Error(`There is no source with ID "${n}", cannot set LOD parameters`);l.calculateTileZoom=Lt(Math.max(1,g),Math.max(1,t))}else for(const l in this.style.tileManagers)this.style.tileManagers[l].getSource().calculateTileZoom=Lt(Math.max(1,g),Math.max(1,t));return this._update(!0),this}refreshTiles(g,t){const n=this.style.tileManagers[g];if(!n)throw new Error(`There is no tile manager with ID "${g}", cannot refresh tile`);t===void 0?n.reload(!0):n.refreshTiles(t.map(l=>new a.ae(l.z,l.x,l.y)))}addImage(g,t,n={}){const{pixelRatio:l=1,sdf:h=!1,stretchX:_,stretchY:w,content:P,textFitWidth:M,textFitHeight:R}=n;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||a.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:B,height:$,data:G}=t,X=t;return this.style.addImage(g,{data:new a.R({width:B,height:$},new Uint8Array(G)),pixelRatio:l,stretchX:_,stretchY:w,content:P,textFitWidth:M,textFitHeight:R,sdf:h,version:0,userImage:X}),X.onAdd&&X.onAdd(this,g),this}}{const{width:B,height:$,data:G}=j.getImageData(t);this.style.addImage(g,{data:new a.R({width:B,height:$},G),pixelRatio:l,stretchX:_,stretchY:w,content:P,textFitWidth:M,textFitHeight:R,sdf:h,version:0})}}updateImage(g,t){const n=this.style.getImage(g);if(!n)return this.fire(new a.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||a.b(t)?j.getImageData(t):t,{width:h,height:_,data:w}=l;if(h===void 0||_===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==n.data.width||_!==n.data.height)return this.fire(new a.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const P=!(t instanceof HTMLImageElement||a.b(t));return n.data.replace(w,P),this.style.updateImage(g,n),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new a.k(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g){return it.getImage(this._requestManager.transformRequest(g,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(g,t){return this._lazyInitEmptyStyle(),this.style.addLayer(g,t),this._update(!0)}moveLayer(g,t){return this.style.moveLayer(g,t),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,t,n){return this.style.setLayerZoomRange(g,t,n),this._update(!0)}setFilter(g,t,n={}){return this.style.setFilter(g,t,n),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,t,n,l={}){return this.style.setPaintProperty(g,t,n,l),this._update(!0)}getPaintProperty(g,t){return this.style.getPaintProperty(g,t)}setLayoutProperty(g,t,n,l={}){return this.style.setLayoutProperty(g,t,n,l),this._update(!0)}getLayoutProperty(g,t){return this.style.getLayoutProperty(g,t)}setGlyphs(g,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,t,n,l=>{l||this._update(!0)}),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,t,n=>{n||this._update(!0)}),this}setLight(g,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(g,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(g,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(g,t){return this.style.setFeatureState(g,t),this._update()}removeFeatureState(g,t){return this.style.removeFeatureState(g,t),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,t=0;return this._container&&(g=this._container.clientWidth||400,t=this._container.clientHeight||300),[g,t]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const t=this._canvasContainer=Q.create("div","maplibregl-canvas-container",g);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=Q.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),l=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],l);const h=this._controlContainer=Q.create("div","maplibregl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{_[w]=Q.create("div",`maplibregl-ctrl-${w} `,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,t,n){this._canvas.width=Math.floor(n*g),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const g=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{t={requestedAttributes:g},l&&(t.statusMessage=l.statusMessage,t.type=l.type)},{once:!0});let n=null;if(n=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,g):this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g),!n){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new ku(n,this.transform),ge.testSupport(n)}migrateProjection(g,t){super.migrateProjection(g,t),this.painter.transform=g,this.fire(new a.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){var t,n,l,h,_;const w=this._idleTriggered?this._fadeDuration:0,P=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let M=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const $=this.transform.zoom,G=ce();this.style.zoomHistory.update($,G);const X=new a.H($,{now:G,fadeDuration:w,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),oe=X.crossFadingFactor();oe===1&&oe===this._crossFadingFactor||(M=!0,this._crossFadingFactor=oe),this.style.update(X)}const R=((n=this.style.projection)===null||n===void 0?void 0:n.transitionState)>0!==P;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((h=this.style.projection)===null||h===void 0?void 0:h.transitionState,(_=this.style.projection)===null||_===void 0?void 0:_.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||R)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,R),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,showPadding:this.showPadding}),this.fire(new a.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.cH.mark(a.cI.load),this.fire(new a.l("load"))),this.style&&(this.style.hasTransitions()||M)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const B=this._sourcesDirty||this._styleDirty||this._placementDirty;return B||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.l("idle")),!this._loaded||this._fullyLoaded||B||(this._fullyLoaded=!0,a.cH.mark(a.cI.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),it.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Q.remove(this._canvasContainer),Q.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),a.cH.clearMetrics(),this._removed=!0,this.fire(new a.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,j.frame(this._frameRequest,g=>{a.cH.frame(g),this._frameRequest=null;try{this._render(g)}catch(t){if(!a.Z(t)&&!function(n){return n.message===Pc}(t))throw t}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return So}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(g){return this._lazyInitEmptyStyle(),this.style.setProjection(g),this._update(!0)}},b.MapMouseEvent=le,b.MapTouchEvent=pe,b.MapWheelEvent=_e,b.Marker=ac,b.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const t=this._map.getZoom(),n=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,n)=>{const l=this._map._getUIString(`NavigationControl.${n}`);t.title=l,t.setAttribute("aria-label",l)},this.options=a.e({},Il,g),this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),Q.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),Q.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=Q.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Qo(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,t){const n=Q.create("button",g,this._container);return n.type="button",n.addEventListener("click",t),n}},b.Popup=class extends a.E{constructor(g){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&Q.remove(this._content),this._container&&(Q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Q.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Q.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Cc(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const n=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const h=Ao(this.options.offset);if(!l){const w=this._container.offsetWidth,P=this._container.offsetHeight;let M;M=n.y+h.bottom.y<P?["top"]:n.y>this._map.transform.height-P?["bottom"]:[],n.x<w/2?M.push("left"):n.x>this._map.transform.width-w/2&&M.push("right"),l=M.length===0?"bottom":M.join("-")}let _=n.add(h[l]);this.options.subpixelPositioning||(_=_.round()),Q.setTransform(this._container,`${el[l]} translate(${_.x}px,${_.y}px)`),fa(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(Ml),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=a.V.convert(g),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const t=document.createDocumentFragment(),n=document.createElement("body");let l;for(n.innerHTML=g;l=n.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Q.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){return this._container&&this._container.classList.add(g),this}removeClassName(g){return this._container&&this._container.classList.remove(g),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}setSubpixelPositioning(g){this.options.subpixelPositioning=g}_createCloseButton(){this.options.closeButton&&(this._closeButton=Q.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(oc);g&&g.focus()}},b.RasterDEMTileSource=mr,b.RasterTileSource=Ar,b.ScaleControl=class{constructor(g){this._onMove=()=>{Ll(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Ll(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},El),g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},b.ScrollZoomHandler=qn,b.Style=ca,b.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=g}onAdd(g){return this._map=g,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Q.create("button","maplibregl-ctrl-terrain",this._container),Q.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Q.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},b.TwoFingersTouchPitchHandler=pi,b.TwoFingersTouchRotateHandler=Ei,b.TwoFingersTouchZoomHandler=Er,b.TwoFingersTouchZoomRotateHandler=ln,b.VectorTileSource=ir,b.VideoSource=nt,b.addSourceType=(g,t)=>a._(void 0,void 0,void 0,function*(){if(se(g))throw new Error(`A source type called "${g}" already exists.`);((n,l)=>{K[n]=l})(g,t)}),b.clearPrewarmedResources=function(){const g=ut;g&&(g.isPreloaded()&&g.numActive()===1?(g.release($e),ut=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},b.createTileMesh=mt,b.getMaxParallelImageRequests=function(){return a.c.MAX_PARALLEL_IMAGE_REQUESTS},b.getRTLTextPluginStatus=function(){return at().getRTLTextPluginStatus()},b.getVersion=function(){return kc},b.getWorkerCount=function(){return tt.workerCount},b.getWorkerUrl=function(){return a.c.WORKER_URL},b.importScriptInWorkers=function(g){return er().broadcast("IS",g)},b.isTimeFrozen=function(){return Pe.isFrozen()},b.now=ce,b.prewarm=function(){wt().acquire($e)},b.restoreNow=function(){Pe.restoreNow()},b.setMaxParallelImageRequests=function(g){a.c.MAX_PARALLEL_IMAGE_REQUESTS=g},b.setNow=function(g){Pe.setNow(g)},b.setRTLTextPlugin=function(g,t){return at().setRTLTextPlugin(g,t)},b.setWorkerCount=function(g){tt.workerCount=g},b.setWorkerUrl=function(g){a.c.WORKER_URL=g}});var x=u;return x})}(Od)),Od.exports}var Zy=Cb();const th=Gy(Zy);function tp(p,o,u,m){function v(x){return x instanceof u?x:new u(function(b){b(x)})}return new(u||(u=Promise))(function(x,b){function a(O){try{F(m.next(O))}catch(Y){b(Y)}}function C(O){try{F(m.throw(O))}catch(Y){b(Y)}}function F(O){O.done?x(O.value):v(O.value).then(a,C)}F((m=m.apply(p,o||[])).next())})}var Ad=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Kd(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var rp,p_;function Wy(){if(p_)return rp;p_=1,rp=o;var p=Object.prototype.hasOwnProperty;function o(){for(var u={},m=0;m<arguments.length;m++){var v=arguments[m];for(var x in v)p.call(v,x)&&(u[x]=v[x])}return u}return rp}var ip={exports:{}},m_;function kb(){return m_||(m_=1,function(p,o){(function(){var u={};p.exports=u,u.simpleFilter=function(m,v){return v.filter(function(x){return u.test(m,x)})},u.test=function(m,v){return u.match(m,v)!==null},u.match=function(m,v,x){x=x||{};var b=0,a=[],C=v.length,F=0,O=0,Y=x.pre||"",ee=x.post||"",j=x.caseSensitive&&v||v.toLowerCase(),Pe;m=x.caseSensitive&&m||m.toLowerCase();for(var ce=0;ce<C;ce++)Pe=v[ce],j[ce]===m[b]?(Pe=Y+Pe+ee,b+=1,O+=1+O):O=0,F+=O,a[a.length]=Pe;return b===m.length?(F=j===m?1/0:F,{rendered:a.join(""),score:F}):null},u.filter=function(m,v,x){return!v||v.length===0?[]:typeof m!="string"?v:(x=x||{},v.reduce(function(b,a,C,F){var O=a;x.extract&&(O=x.extract(a));var Y=u.match(m,O,x);return Y!=null&&(b[b.length]={string:Y.rendered,score:Y.score,index:C,original:a}),b},[]).sort(function(b,a){var C=a.score-b.score;return C||b.index-a.index}))}})()}(ip)),ip.exports}var np,g_;function Db(){if(g_)return np;g_=1;var p=function(o){return this.component=o,this.items=[],this.active=o.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,o.el.parentNode.insertBefore(this.wrapper,o.el.nextSibling),this};return p.prototype.show=function(){this.element.style.display="block"},p.prototype.hide=function(){this.element.style.display="none"},p.prototype.add=function(o){this.items.push(o)},p.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0},p.prototype.isEmpty=function(){return!this.items.length},p.prototype.isVisible=function(){return this.element.style.display==="block"},p.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var o=0;o<this.items.length;o++)this.drawItem(this.items[o],this.active===o);this.show()},p.prototype.drawItem=function(o,u){var m=document.createElement("li"),v=document.createElement("a");u&&(m.className+=" active"),v.innerHTML=o.string,m.appendChild(v),this.element.appendChild(m),m.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),m.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,o)}).bind(this))},p.prototype.handleMouseUp=function(o){this.selectingListItem=!1,this.component.value(o.original),this.clear(),this.draw()},p.prototype.move=function(o){this.active=o,this.draw()},p.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)},p.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)},p.prototype.drawError=function(o){var u=document.createElement("li");u.innerHTML=o,this.element.appendChild(u),this.show()},np=p,np}var sp,__;function Fb(){if(__)return sp;__=1;var p=Wy(),o=kb(),u=Db(),m=function(v,x,b){return b=b||{},this.options=p({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},b),this.el=v,this.data=x||[],this.list=new u(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(a){this.handleKeyUp(a.keyCode,a)}).bind(this),!1),this.el.addEventListener("keydown",(function(a){this.handleKeyDown(a)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(a){this.handlePaste(a)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};return m.prototype.handleKeyUp=function(v,x){if(!(v===40||v===38||v===27||v===9)){if(v===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),x.stopPropagation());return}this.handleInputChange(this.el.value)}},m.prototype.handleKeyDown=function(v){switch(v.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&v.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},m.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},m.prototype.handlePaste=function(v){if(v.clipboardData)this.handleInputChange(v.clipboardData.getData("Text"));else{var x=this;setTimeout(function(){x.handleInputChange(v.target.value)},100)}},m.prototype.handleInputChange=function(v){if(this.query=this.normalize(v),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(x){for(var b=0;b<x.length&&(this.list.add(x[b]),b!==this.options.limit-1);b++);this.list.draw()}).bind(this))},m.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},m.prototype.update=function(v){this.data=v,this.handleKeyUp()},m.prototype.clear=function(){this.data=[],this.list.clear()},m.prototype.normalize=function(v){return v=v.toLowerCase(),v},m.prototype.match=function(v,x){return v.indexOf(x)>-1},m.prototype.value=function(v){if(this.selected=v,this.el.value=this.getItemValue(v||{place_name:this.query}),document.createEvent){var x=document.createEvent("HTMLEvents");x.initEvent("change",!0,!1),this.el.dispatchEvent(x)}else this.el.fireEvent("onchange")},m.prototype.getCandidates=function(v){var x={pre:"<strong>",post:"</strong>",extract:(function(a){return this.getItemValue(a)}).bind(this)},b;this.options.filter?(b=o.filter(this.query,this.data,x),b=b.map((function(a){return{original:a.original,string:this.render(a.original,a.string)}}).bind(this))):b=this.data.map((function(a){var C=this.render(a);return{original:a,string:C}}).bind(this)),v(b)},m.prototype.getItemValue=function(v){return v},m.prototype.render=function(v,x){if(x)return x;for(var b=v.original?this.getItemValue(v.original):this.getItemValue(v),a=this.normalize(b),C=a.lastIndexOf(this.query);C>-1;){var F=C+this.query.length;b=b.slice(0,C)+"<strong>"+b.slice(C,F)+"</strong>"+b.slice(F),C=a.slice(0,C).lastIndexOf(this.query)}return b},m.prototype.renderError=function(v){this.list.drawError(v)},sp=m,sp}var ap,y_;function Rb(){if(y_)return ap;y_=1;var p=Fb();return ap=p,typeof window<"u"&&(window.Suggestions=p),ap}var zb=Rb(),Nb=Kd(zb),Bd={exports:{}},Ob=Bd.exports,v_;function Bb(){return v_||(v_=1,function(p){(function(o,u,m){p.exports?p.exports=m():o[u]=m()})(Ob,"subtag",function(){var o="",u=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function m(C){return C.match(u)||[]}function v(C){return m(C).filter(function(F,O){return F&&O})}function x(C){return C=m(C),{language:C[1]||o,extlang:C[2]||o,script:C[3]||o,region:C[4]||o}}function b(C,F,O){Object.defineProperty(C,F,{value:O,enumerable:!0})}function a(C,F,O){function Y(ee){return m(ee)[C]||o}b(Y,"pattern",F),b(x,O,Y)}return a(1,/^[a-zA-Z]{2,3}$/,"language"),a(2,/^[a-zA-Z]{3}$/,"extlang"),a(3,/^[a-zA-Z]{4}$/,"script"),a(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),b(x,"split",v),x})}(Bd)),Bd.exports}var jb=Bb(),Ub=Kd(jb),op,b_;function Vb(){if(b_)return op;b_=1;var p="Expected a function",o=NaN,u="[object Symbol]",m=/^\s+|\s+$/g,v=/^[-+]0x[0-9a-f]+$/i,x=/^0b[01]+$/i,b=/^0o[0-7]+$/i,a=parseInt,C=typeof Ad=="object"&&Ad&&Ad.Object===Object&&Ad,F=typeof self=="object"&&self&&self.Object===Object&&self,O=C||F||Function("return this")(),Y=Object.prototype,ee=Y.toString,j=Math.max,Pe=Math.min,ce=function(){return O.Date.now()};function Q(Ge,Ze,it){var He,Te,st,me,xe,Xe,Ye=0,At=!1,Dt=!1,kt=!0;if(typeof Ge!="function")throw new TypeError(p);Ze=Me(Ze)||0,ge(it)&&(At=!!it.leading,Dt="maxWait"in it,st=Dt?j(Me(it.maxWait)||0,Ze):st,kt="trailing"in it?!!it.trailing:kt);function yt(ut){var pt=He,wt=Te;return He=Te=void 0,Ye=ut,me=Ge.apply(wt,pt),me}function vt(ut){return Ye=ut,xe=setTimeout(he,Ze),At?yt(ut):me}function sr(ut){var pt=ut-Xe,wt=ut-Ye,Bt=Ze-pt;return Dt?Pe(Bt,st-wt):Bt}function Zt(ut){var pt=ut-Xe,wt=ut-Ye;return Xe===void 0||pt>=Ze||pt<0||Dt&&wt>=st}function he(){var ut=ce();if(Zt(ut))return Fe(ut);xe=setTimeout(he,sr(ut))}function Fe(ut){return xe=void 0,kt&&He?yt(ut):(He=Te=void 0,me)}function $e(){xe!==void 0&&clearTimeout(xe),Ye=0,He=Xe=Te=xe=void 0}function tt(){return xe===void 0?me:Fe(ce())}function ct(){var ut=ce(),pt=Zt(ut);if(He=arguments,Te=this,Xe=ut,pt){if(xe===void 0)return vt(Xe);if(Dt)return xe=setTimeout(he,Ze),yt(Xe)}return xe===void 0&&(xe=setTimeout(he,Ze)),me}return ct.cancel=$e,ct.flush=tt,ct}function ge(Ge){var Ze=typeof Ge;return!!Ge&&(Ze=="object"||Ze=="function")}function Qe(Ge){return!!Ge&&typeof Ge=="object"}function Oe(Ge){return typeof Ge=="symbol"||Qe(Ge)&&ee.call(Ge)==u}function Me(Ge){if(typeof Ge=="number")return Ge;if(Oe(Ge))return o;if(ge(Ge)){var Ze=typeof Ge.valueOf=="function"?Ge.valueOf():Ge;Ge=ge(Ze)?Ze+"":Ze}if(typeof Ge!="string")return Ge===0?Ge:+Ge;Ge=Ge.replace(m,"");var it=x.test(Ge);return it||b.test(Ge)?a(Ge.slice(2),it?2:8):v.test(Ge)?o:+Ge}return op=Q,op}var qb=Vb(),Gb=Kd(qb),$b=Wy(),ol=Kd($b),Id={exports:{}},x_;function Zb(){if(x_)return Id.exports;x_=1;var p=typeof Reflect=="object"?Reflect:null,o=p&&typeof p.apply=="function"?p.apply:function(Ge,Ze,it){return Function.prototype.apply.call(Ge,Ze,it)},u;p&&typeof p.ownKeys=="function"?u=p.ownKeys:Object.getOwnPropertySymbols?u=function(Ge){return Object.getOwnPropertyNames(Ge).concat(Object.getOwnPropertySymbols(Ge))}:u=function(Ge){return Object.getOwnPropertyNames(Ge)};function m(Me){console&&console.warn&&console.warn(Me)}var v=Number.isNaN||function(Ge){return Ge!==Ge};function x(){x.init.call(this)}Id.exports=x,Id.exports.once=ge,x.EventEmitter=x,x.prototype._events=void 0,x.prototype._eventsCount=0,x.prototype._maxListeners=void 0;var b=10;function a(Me){if(typeof Me!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Me)}Object.defineProperty(x,"defaultMaxListeners",{enumerable:!0,get:function(){return b},set:function(Me){if(typeof Me!="number"||Me<0||v(Me))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Me+".");b=Me}}),x.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},x.prototype.setMaxListeners=function(Ge){if(typeof Ge!="number"||Ge<0||v(Ge))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Ge+".");return this._maxListeners=Ge,this};function C(Me){return Me._maxListeners===void 0?x.defaultMaxListeners:Me._maxListeners}x.prototype.getMaxListeners=function(){return C(this)},x.prototype.emit=function(Ge){for(var Ze=[],it=1;it<arguments.length;it++)Ze.push(arguments[it]);var He=Ge==="error",Te=this._events;if(Te!==void 0)He=He&&Te.error===void 0;else if(!He)return!1;if(He){var st;if(Ze.length>0&&(st=Ze[0]),st instanceof Error)throw st;var me=new Error("Unhandled error."+(st?" ("+st.message+")":""));throw me.context=st,me}var xe=Te[Ge];if(xe===void 0)return!1;if(typeof xe=="function")o(xe,this,Ze);else for(var Xe=xe.length,Ye=Pe(xe,Xe),it=0;it<Xe;++it)o(Ye[it],this,Ze);return!0};function F(Me,Ge,Ze,it){var He,Te,st;if(a(Ze),Te=Me._events,Te===void 0?(Te=Me._events=Object.create(null),Me._eventsCount=0):(Te.newListener!==void 0&&(Me.emit("newListener",Ge,Ze.listener?Ze.listener:Ze),Te=Me._events),st=Te[Ge]),st===void 0)st=Te[Ge]=Ze,++Me._eventsCount;else if(typeof st=="function"?st=Te[Ge]=it?[Ze,st]:[st,Ze]:it?st.unshift(Ze):st.push(Ze),He=C(Me),He>0&&st.length>He&&!st.warned){st.warned=!0;var me=new Error("Possible EventEmitter memory leak detected. "+st.length+" "+String(Ge)+" listeners added. Use emitter.setMaxListeners() to increase limit");me.name="MaxListenersExceededWarning",me.emitter=Me,me.type=Ge,me.count=st.length,m(me)}return Me}x.prototype.addListener=function(Ge,Ze){return F(this,Ge,Ze,!1)},x.prototype.on=x.prototype.addListener,x.prototype.prependListener=function(Ge,Ze){return F(this,Ge,Ze,!0)};function O(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Y(Me,Ge,Ze){var it={fired:!1,wrapFn:void 0,target:Me,type:Ge,listener:Ze},He=O.bind(it);return He.listener=Ze,it.wrapFn=He,He}x.prototype.once=function(Ge,Ze){return a(Ze),this.on(Ge,Y(this,Ge,Ze)),this},x.prototype.prependOnceListener=function(Ge,Ze){return a(Ze),this.prependListener(Ge,Y(this,Ge,Ze)),this},x.prototype.removeListener=function(Ge,Ze){var it,He,Te,st,me;if(a(Ze),He=this._events,He===void 0)return this;if(it=He[Ge],it===void 0)return this;if(it===Ze||it.listener===Ze)--this._eventsCount===0?this._events=Object.create(null):(delete He[Ge],He.removeListener&&this.emit("removeListener",Ge,it.listener||Ze));else if(typeof it!="function"){for(Te=-1,st=it.length-1;st>=0;st--)if(it[st]===Ze||it[st].listener===Ze){me=it[st].listener,Te=st;break}if(Te<0)return this;Te===0?it.shift():ce(it,Te),it.length===1&&(He[Ge]=it[0]),He.removeListener!==void 0&&this.emit("removeListener",Ge,me||Ze)}return this},x.prototype.off=x.prototype.removeListener,x.prototype.removeAllListeners=function(Ge){var Ze,it,He;if(it=this._events,it===void 0)return this;if(it.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):it[Ge]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete it[Ge]),this;if(arguments.length===0){var Te=Object.keys(it),st;for(He=0;He<Te.length;++He)st=Te[He],st!=="removeListener"&&this.removeAllListeners(st);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(Ze=it[Ge],typeof Ze=="function")this.removeListener(Ge,Ze);else if(Ze!==void 0)for(He=Ze.length-1;He>=0;He--)this.removeListener(Ge,Ze[He]);return this};function ee(Me,Ge,Ze){var it=Me._events;if(it===void 0)return[];var He=it[Ge];return He===void 0?[]:typeof He=="function"?Ze?[He.listener||He]:[He]:Ze?Q(He):Pe(He,He.length)}x.prototype.listeners=function(Ge){return ee(this,Ge,!0)},x.prototype.rawListeners=function(Ge){return ee(this,Ge,!1)},x.listenerCount=function(Me,Ge){return typeof Me.listenerCount=="function"?Me.listenerCount(Ge):j.call(Me,Ge)},x.prototype.listenerCount=j;function j(Me){var Ge=this._events;if(Ge!==void 0){var Ze=Ge[Me];if(typeof Ze=="function")return 1;if(Ze!==void 0)return Ze.length}return 0}x.prototype.eventNames=function(){return this._eventsCount>0?u(this._events):[]};function Pe(Me,Ge){for(var Ze=new Array(Ge),it=0;it<Ge;++it)Ze[it]=Me[it];return Ze}function ce(Me,Ge){for(;Ge+1<Me.length;Ge++)Me[Ge]=Me[Ge+1];Me.pop()}function Q(Me){for(var Ge=new Array(Me.length),Ze=0;Ze<Ge.length;++Ze)Ge[Ze]=Me[Ze].listener||Me[Ze];return Ge}function ge(Me,Ge){return new Promise(function(Ze,it){function He(st){Me.removeListener(Ge,Te),it(st)}function Te(){typeof Me.removeListener=="function"&&Me.removeListener("error",He),Ze([].slice.call(arguments))}Oe(Me,Ge,Te,{once:!0}),Ge!=="error"&&Qe(Me,He,{once:!0})})}function Qe(Me,Ge,Ze){typeof Me.on=="function"&&Oe(Me,"error",Ge,Ze)}function Oe(Me,Ge,Ze,it){if(typeof Me.on=="function")it.once?Me.once(Ge,Ze):Me.on(Ge,Ze);else if(typeof Me.addEventListener=="function")Me.addEventListener(Ge,function He(Te){it.once&&Me.removeEventListener(Ge,He),Ze(Te)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Me)}return Id.exports}var Wb=Zb();const w_={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},Hb={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:"",es:"Buscar"},Xb={en:"No results found",de:"Keine Ergebnisse gefunden",es:"No hay resultados",fr:"Aucun rsultat trouv"},Yb={en:"There was an error reaching the server",de:"Verbindung fehlgeschlagen",es:"Error al conectarse al servidor",fr:"Une erreur est survenue lors de la connexion au serveur"};var Nh={placeholder:Hb,errorNoResults:Xb,errorConnectionFailed:Yb};const Jb=/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/;class Kb{constructor(o,u){this.options={zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:void 0,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,proximityMinZoom:9,getItemValue:m=>m.text!==void 0?m.text:m.place_name,render:function(m){if(!m.geometry){const x=m.text,b=x.toLowerCase().indexOf(this.query.toLowerCase()),a=this.query.length,C=x.substring(0,b),F=x.substring(b,b+a),O=x.substring(b+a);return'<div class="maplibregl-ctrl-geocoder--suggestion"><svg class="maplibregl-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="maplibregl-ctrl-geocoder--suggestion-info"><div class="maplibregl-ctrl-geocoder--suggestion-title">'+C+'<span class="maplibregl-ctrl-geocoder--suggestion-match">'+F+"</span>"+O+"</div></div></div>"}const v=m.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--result"><svg class="maplibregl-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="maplibregl-ctrl-geocoder--result-title">'+v[0]+'</div><div class="maplibregl-ctrl-geocoder--result-address">'+v.splice(1,v.length).join(",")+"</div></div></div>"},popupRender:m=>{const v=m.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--suggestion popup-suggestion"><div class="maplibregl-ctrl-geocoder--suggestion-title popup-suggestion-title">'+v[0]+'</div><div class="maplibregl-ctrl-geocoder--suggestion-address popup-suggestion-address">'+v.splice(1,v.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},this._eventEmitter=new Wb.EventEmitter,this.options=ol({},this.options,u),this.fresh=!0,this.lastSelected=null,this.geocoderApi=o}addTo(o){function u(m,v){if(!document.body.contains(v))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const x=m.onAdd();v.appendChild(x)}if(o instanceof HTMLElement)u(this,o);else if(typeof o=="string"){const m=document.querySelectorAll(o);if(m.length===0)throw new Error("Element "+o+"not found.");if(m.length>1)throw new Error("Geocoder can only be added to a single html element");u(this,m[0])}else if("addControl"in o)o.addControl(this);else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")}onAdd(o){if(o&&typeof o!="string"&&(this._map=o),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);const u=this.container=document.createElement("div");u.className="maplibregl-ctrl-geocoder maplibregl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";const m=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="search",this._inputEl.className="maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",Gb(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);const v=document.createElement("div");v.classList.add("maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("type","button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="maplibregl-ctrl-geocoder--button";const x=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(x),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),v.appendChild(this._clearEl),v.appendChild(this._loadingEl),u.appendChild(m),u.appendChild(this._inputEl),u.appendChild(v),this._typeahead=new Nb(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.container.addEventListener("click",()=>{this._typeahead.update(this._typeahead.data)}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),u}createIcon(o,u){const m=document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.setAttribute("class","maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+o),m.setAttribute("viewBox","0 0 18 18"),m.setAttribute("xml:space","preserve"),m.setAttribute("width","18"),m.setAttribute("height","18"),"innerHTML"in m)m.innerHTML=u;else{const v=document.createElement("div");v.innerHTML="<svg>"+u.valueOf().toString()+"</svg>";const x=v.firstChild,b=x.firstChild;m.appendChild(b)}return m}onRemove(){return this.container.remove(),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this}_onPaste(o){const u=(o.clipboardData||window.clipboardData).getData("text");u.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(u)}_onKeyDown(o){if(o.keyCode===27&&this.options.clearAndBlurOnEsc)return this._clear(o),this._inputEl.blur();const x=this._inputEl.value;if(!x)return this.fresh=!0,o.keyCode!==9&&this.clear(o),this._clearEl.style.display="none";if(!(o.metaKey||[9,27,37,39,38,40].indexOf(o.keyCode)!==-1)){if(o.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(x);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(x,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}x.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(x)}}_showButton(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")}_hideButton(){this._typeahead.selected&&(this._clearEl.style.display="none")}_onBlur(o){this.options.clearOnBlur&&this._clearOnBlur(o),this.options.collapsed&&this._collapse()}_onChange(){const o=this._typeahead.selected;if(o&&!o.geometry)o.placeId?this._geocode(o.placeId,!0,!0):this._geocode(o.text,!0);else if(o&&JSON.stringify(o)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){let u;if(this._removeResultMarkers(),o.properties&&w_[o.properties.short_code])u=ol({},this.options.flyTo),this._map&&this._map.fitBounds(w_[o.properties.short_code].bbox,u);else if(o.bbox){const m=o.bbox;u=ol({},this.options.flyTo),this._map&&this._map.fitBounds([[m[0],m[1]],[m[2],m[3]]],u)}else{const m={zoom:this.options.zoom};u=ol({},m,this.options.flyTo),o.center?u.center=o.center:o.geometry&&o.geometry.type&&o.geometry.type==="Point"&&o.geometry.coordinates&&(u.center=o.geometry.coordinates),this._map&&this._map.flyTo(u)}}this.options.marker&&this._maplibregl&&this._handleMarker(o),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(o),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:o})}}_getConfigForRequest(){return["bbox","limit","proximity","countries","types","language","reverseMode"].reduce((m,v)=>(this.options[v]&&(["countries","types","language"].indexOf(v)>-1?m[v]=this.options[v].split(/[\s,]+/):m[v]=this.options[v],v==="proximity"&&this.options[v]&&typeof this.options[v].longitude=="number"&&typeof this.options[v].latitude=="number"&&(m[v]=[this.options[v].longitude,this.options[v].latitude])),m),{})}_geocode(o){return tp(this,arguments,void 0,function*(u,m=!1,v=!1){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:u});const x=this._getConfigForRequest(),b=this._createGeocodeRequest(x,u,m,v),a=this.options.localGeocoder?this.options.localGeocoder(u)||[]:[];try{const C=yield b;yield this._handleGeocodeResponse(C,x,u,m,a)}catch(C){this._handleGeocodeErrorResponse(C,a)}return b})}_createGeocodeRequest(o,u,m,v){return this.options.localGeocoderOnly?Promise.resolve({}):this.options.reverseGeocode&&Jb.test(u)?this._createReverseGeocodeRequest(u,o):(o.query=u,this.geocoderApi.getSuggestions?m?this.geocoderApi.searchByPlaceId&&v?this.geocoderApi.searchByPlaceId(o):this.geocoderApi.forwardGeocode(o):this.geocoderApi.getSuggestions(o):this.geocoderApi.forwardGeocode(o))}_createReverseGeocodeRequest(o,u){const m=o.split(/[\s(,)?]+/).map(v=>parseFloat(v)).reverse();return u.query=m,u.limit=1,"proximity"in u&&delete u.proximity,this.geocoderApi.reverseGeocode(u)}_handleGeocodeResponse(o,u,m,v,x){return tp(this,void 0,void 0,function*(){this._loadingEl.style.display="none";let b={};o?b=o:b={type:"FeatureCollection",features:[]},b.config=u,this.fresh&&(this.fresh=!1),b.features=b.features?x.concat(b.features):x;const a=this.options.externalGeocoder?this.options.externalGeocoder(m,b.features,u)||Promise.resolve([]):Promise.resolve([]);try{const F=yield a;b.features=b.features?F.concat(b.features):F}catch{}this.options.filter&&b.features.length&&(b.features=b.features.filter(this.options.filter));let C=[];"suggestions"in b?C=b.suggestions:"place"in b?C=[b.place]:C=b.features,C.length?(this._clearEl.style.display="block",this._typeahead.update(C),(!this.options.showResultsWhileTyping||v)&&this.options.showResultMarkers&&(b.features.length>0||"place"in b)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",b)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",b))})}_handleGeocodeErrorResponse(o,u){this._loadingEl.style.display="none",u.length&&this.options.localGeocoder?(this._clearEl.style.display="block",this._typeahead.update(u)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:u}),this._eventEmitter.emit("error",{error:o})}_clear(o){o&&o.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0}clear(o){this._clear(o),this._inputEl.focus()}_clearOnBlur(o){o.relatedTarget&&this._clear(o)}_onQueryResult(o){if(!("features"in o)||!o.features.length)return;const u=o.features[0];this._typeahead.selected=u,this._inputEl.value=u.place_name,this._onChange()}_updateProximity(){if(this._map)if(this._map.getZoom()>this.options.proximityMinZoom){const o=this._map.getCenter().wrap();this.setProximity({longitude:o.lng,latitude:o.lat})}else this.setProximity(null)}_collapse(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("maplibregl-ctrl-geocoder--collapsed")}_unCollapse(){this.container.classList.remove("maplibregl-ctrl-geocoder--collapsed")}query(o){return tp(this,void 0,void 0,function*(){const u=yield this._geocode(o);this._onQueryResult(u)})}_renderError(){const o=`<div class='maplibre-gl-geocoder--error'>${this._localize("errorConnectionFailed")}</div>`;this._renderMessage(o)}_renderNoResults(){const o=`<div class='maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>
        ${this._localize("errorNoResults")}</div>`;this._renderMessage(o)}_renderMessage(o){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(o)}_localize(o){const u=Ub.language(this.options.language.split(",")[0]);return this.options.language&&Nh?.[o][u]?Nh[o][u]:Nh[o].en}_fitBoundsForMarkers(){if(this._typeahead.data.length<1)return;const o=this._typeahead.data.filter(u=>typeof u!="string").slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){const m=ol({},{padding:100},this.options.flyTo),v=new this._maplibregl.LngLatBounds;for(const x of o)v.extend(x.geometry.coordinates);this._map.fitBounds(v,m)}return o.length>0&&this._maplibregl&&this._handleResultMarkers(o),this}setInput(o){return this._inputEl.value=o,this._typeahead.selected=null,this._typeahead.clear(),o.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(o),this}setProximity(o){return this.options.proximity=o,this}getProximity(){return this.options.proximity}setRenderFunction(o){return o&&typeof o=="function"&&(this._typeahead.render=o),this}getRenderFunction(){return this._typeahead.render}setLanguage(o){return this.options.language=o||this.options.language||navigator.language,this}getLanguage(){return this.options.language}getZoom(){return this.options.zoom}setZoom(o){return this.options.zoom=o,this}getFlyTo(){return this.options.flyTo}setFlyTo(o){return this.options.flyTo=o,this}getPlaceholder(){return this.options.placeholder}setPlaceholder(o){return this.placeholder=o||this.options.placeholder||this._localize("placeholder"),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this}getBbox(){return this.options.bbox}setBbox(o){return this.options.bbox=o,this}getCountries(){return this.options.countries}setCountries(o){return this.options.countries=o,this}getTypes(){return this.options.types}setTypes(o){return this.options.types=o,this}getMinLength(){return this.options.minLength}setMinLength(o){return this.options.minLength=o,this._typeahead&&(this._typeahead.options.minLength=o),this}getLimit(){return this.options.limit}setLimit(o){return this.options.limit=o,this._typeahead&&(this._typeahead.options.limit=o),this}getFilter(){return this.options.filter}setFilter(o){return this.options.filter=o,this}setGeocoderApi(o){return this.geocoderApi=o,this}getGeocoderApi(){return this.geocoderApi}_handleMarker(o){if(!this._map)return;this._removeMarker();const m=ol({},{color:"#4668F2"},this.options.marker);this.mapMarker=new this._maplibregl.Marker(m);let v;if(this.options.popup){const b=ol({},{},this.options.popup);v=new this._maplibregl.Popup(b).setHTML(this.options.popupRender(o))}return o.center?(this.mapMarker.setLngLat(o.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(v)):o.geometry&&o.geometry.type&&o.geometry.type==="Point"&&o.geometry.coordinates&&(this.mapMarker.setLngLat(o.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(v)),this}_removeMarker(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)}_handleResultMarkers(o){if(!this._map)return;this._removeResultMarkers();let m=ol({},{color:"#4668F2"},this.options.showResultMarkers);for(const v of o){let x;if(this.options.showResultMarkers){this.options.showResultMarkers&&this.options.showResultMarkers.element&&(x=this.options.showResultMarkers.element.cloneNode(!0),m=ol(m,{element:x}));const b=new this._maplibregl.Marker(ol({},m,{element:x}));let a;if(this.options.popup){const F=ol({},{},this.options.popup);a=new this._maplibregl.Popup(F).setHTML(this.options.popupRender(v))}v.center?(b.setLngLat(v.center).addTo(this._map),this.options.popup&&b.setPopup(a)):v.geometry&&v.geometry.type&&v.geometry.type==="Point"&&v.geometry.coordinates&&(b.setLngLat(v.geometry.coordinates).addTo(this._map),this.options.popup&&b.setPopup(a)),this.resultMarkers.push(b)}}return this}_removeResultMarkers(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(o){o.remove()}),this.resultMarkers=[])}on(o,u){return this._eventEmitter.on(o,u),this}once(o){return new Promise(u=>{this._eventEmitter.once(o,u)})}off(o,u){return this._eventEmitter.removeListener(o,u),this}}const Qb="modulepreload",e2=function(p){return"/"+p},S_={},lp=function(o,u,m){let v=Promise.resolve();if(u&&u.length>0){let C=function(F){return Promise.all(F.map(O=>Promise.resolve(O).then(Y=>({status:"fulfilled",value:Y}),Y=>({status:"rejected",reason:Y}))))};document.getElementsByTagName("link");const b=document.querySelector("meta[property=csp-nonce]"),a=b?.nonce||b?.getAttribute("nonce");v=C(u.map(F=>{if(F=e2(F),F in S_)return;S_[F]=!0;const O=F.endsWith(".css"),Y=O?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${F}"]${Y}`))return;const ee=document.createElement("link");if(ee.rel=O?"stylesheet":Qb,O||(ee.as="script"),ee.crossOrigin="",ee.href=F,a&&ee.setAttribute("nonce",a),document.head.appendChild(ee),O)return new Promise((j,Pe)=>{ee.addEventListener("load",j),ee.addEventListener("error",()=>Pe(new Error(`Unable to preload CSS for ${F}`)))})}))}function x(b){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=b,window.dispatchEvent(a),!a.defaultPrevented)throw b}return v.then(b=>{for(const a of b||[])a.status==="rejected"&&x(a.reason);return o().catch(x)})};class t2{map;width;height;svgCanvas;xLine;yLine;color="#535353";constructor(o){this.map=o,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){this.width=this.map?.getCanvas().clientWidth,this.height=this.map?.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const o=this.width/2,u=this.height/2;this.yLine.setAttribute("x1",`${o}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${o}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${u}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${u}px`)}else console.error("element value is null")}createCanvas(o){if(this.width!==void 0&&this.height!==void 0){const u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.style.position="relative",u.setAttribute("width",`${this.width}px`),u.setAttribute("height",`${this.height}px`);const m=this.width/2,v=this.height/2;this.yLine=u.appendChild(this.createLine(m,0,m,this.height,this.color,"2px")),this.xLine=u.appendChild(this.createLine(0,v,this.width,v,this.color,"2px")),o?.appendChild(u),this.svgCanvas=u}}createLine(o,u,m,v,x,b){const a=document.createElementNS("http://www.w3.org/2000/svg","line");return a.setAttribute("x1",o),a.setAttribute("y1",u),a.setAttribute("x2",m),a.setAttribute("y2",v),a.setAttribute("stroke-dasharray","5,5"),a.setAttribute("stroke",x),a.setAttribute("stroke-width",b),a}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}}const T_={72:72,96:96,200:200,300:300,400:400},yc={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},Ed={Landscape:"landscape",Portrait:"portrait"},sh={LETTER:[279,216],A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},dh={mm:"mm"};class r2{map;width;height;unit;svgCanvas;svgPath;constructor(o){if(this.map=o,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const u=this.map?.getCanvas().clientWidth,m=this.map?.getCanvas().clientHeight,v=document.createElementNS("http://www.w3.org/2000/svg","svg");v.style.position="absolute",v.style.top="0px",v.style.left="0px",v.setAttribute("width",`${u}px`),v.setAttribute("height",`${m}px`);const x=document.createElementNS("http://www.w3.org/2000/svg","path");x.setAttribute("style","fill:#888888;stroke-width:0"),x.setAttribute("fill-opacity","0.5"),v.append(x),this.map?.getCanvasContainer().appendChild(v),this.svgCanvas=v,this.svgPath=x}mapResize(){this.generateCutOut()}updateArea(o,u){this.width=o,this.height=u,this.unit=dh.mm,this.generateCutOut()}generateCutOut(){if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const o=this.toPixels(this.width),u=this.toPixels(this.height),m=this.map?.getCanvas().clientWidth,v=this.map?.getCanvas().clientHeight,x=m/2-o/2,b=x+o,a=v/2-u/2,C=a+u;this.svgCanvas.setAttribute("width",`${m}px`),this.svgCanvas.setAttribute("height",`${v}px`),this.svgPath.setAttribute("d",`M 0 0 L ${m} 0 L ${m} ${v} L 0 ${v} M ${x} ${a} L ${x} ${C} L ${b} ${C} L ${b} ${a}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(o,u=96){return this.unit===dh.mm&&(u/=25.4),u*o}}const Hy={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate",LanguageName:"English",LanguageCode:"en"},i2={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Gnrer",LanguageName:"Franais",LanguageCode:"fr"},n2={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi",LanguageName:"Suomalainen",LanguageCode:"fi"},s2={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflsung",Generate:"Erstellen",LanguageName:"Deutsch",LanguageCode:"de"},a2={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera",LanguageName:"Svenska",LanguageCode:"sv"},o2={PageSize:"Tamao de pgina",PageOrientation:"Orientacin de pgina",Format:"Formato",DPI:"DPI",Generate:"Generar",LanguageName:"Espaola",LanguageCode:"es"},l2={PageSize:"Mida",PageOrientation:"Orientaci",Format:"Format",DPI:"DPI",Generate:"Genera",LanguageName:"Catalan",LanguageCode:"ca"},c2={PageSize:"Kch thc trang",PageOrientation:"Loi trang",Format:"nh dng",DPI:"Mt  im nh (DPI)",Generate:"To",LanguageName:"Ting Vit",LanguageCode:"vi"},u2={PageSize:" ",PageOrientation:" ",Format:"",DPI:"DPI",Generate:"",LanguageName:"",LanguageCode:"uk"},h2={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:"",LanguageName:"",LanguageCode:"zhHans"},d2={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:"",LanguageName:"",LanguageCode:"zhHant"},f2={PageSize:"",PageOrientation:"",Format:"",DPI:"DPI",Generate:"",LanguageName:"",LanguageCode:"ja"},p2={PageSize:"Tamanho da pgina",PageOrientation:"Orientao da pgina",Format:"Formato",DPI:"DPI",Generate:"Gerar",LanguageName:"Portugus",LanguageCode:"pt"},m2={PageSize:" ",PageOrientation:" ",Format:"",DPI:" (DPI)",Generate:"",LanguageName:"",LanguageCode:"ru"},g2=[Hy,i2,n2,s2,a2,o2,l2,c2,u2,h2,d2,f2,p2,m2],_2=p=>g2.find(o=>o.LanguageCode===p)??Hy;function $i(p){"@babel/helpers - typeof";return $i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},$i(p)}var ul=Uint8Array,Co=Uint16Array,Zp=Int32Array,Wp=new ul([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Hp=new ul([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),P_=new ul([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Xy=function(p,o){for(var u=new Co(31),m=0;m<31;++m)u[m]=o+=1<<p[m-1];for(var v=new Zp(u[30]),m=1;m<30;++m)for(var x=u[m];x<u[m+1];++x)v[x]=x-u[m]<<5|m;return{b:u,r:v}},Yy=Xy(Wp,2),y2=Yy.b,Dp=Yy.r;y2[28]=258,Dp[258]=28;var v2=Xy(Hp,0),A_=v2.r,Jy=new Co(32768);for(var _n=0;_n<32768;++_n){var Uc=(_n&43690)>>1|(_n&21845)<<1;Uc=(Uc&52428)>>2|(Uc&13107)<<2,Uc=(Uc&61680)>>4|(Uc&3855)<<4,Jy[_n]=((Uc&65280)>>8|(Uc&255)<<8)>>1}var Vh=function(p,o,u){for(var m=p.length,v=0,x=new Co(o);v<m;++v)p[v]&&++x[p[v]-1];var b=new Co(o);for(v=1;v<o;++v)b[v]=b[v-1]+x[v-1]<<1;var a;for(a=new Co(m),v=0;v<m;++v)p[v]&&(a[v]=Jy[b[p[v]-1]++]>>15-p[v]);return a},wu=new ul(288);for(var _n=0;_n<144;++_n)wu[_n]=8;for(var _n=144;_n<256;++_n)wu[_n]=9;for(var _n=256;_n<280;++_n)wu[_n]=7;for(var _n=280;_n<288;++_n)wu[_n]=8;var Zd=new ul(32);for(var _n=0;_n<32;++_n)Zd[_n]=5;var b2=Vh(wu,9),x2=Vh(Zd,5),Ky=function(p){return(p+7)/8|0},w2=function(p,o,u){return(u==null||u>p.length)&&(u=p.length),new ul(p.subarray(o,u))},mc=function(p,o,u){u<<=o&7;var m=o/8|0;p[m]|=u,p[m+1]|=u>>8},Oh=function(p,o,u){u<<=o&7;var m=o/8|0;p[m]|=u,p[m+1]|=u>>8,p[m+2]|=u>>16},cp=function(p,o){for(var u=[],m=0;m<p.length;++m)p[m]&&u.push({s:m,f:p[m]});var v=u.length,x=u.slice();if(!v)return{t:e0,l:0};if(v==1){var b=new ul(u[0].s+1);return b[u[0].s]=1,{t:b,l:1}}u.sort(function(Ge,Ze){return Ge.f-Ze.f}),u.push({s:-1,f:25001});var a=u[0],C=u[1],F=0,O=1,Y=2;for(u[0]={s:-1,f:a.f+C.f,l:a,r:C};O!=v-1;)a=u[u[F].f<u[Y].f?F++:Y++],C=u[F!=O&&u[F].f<u[Y].f?F++:Y++],u[O++]={s:-1,f:a.f+C.f,l:a,r:C};for(var ee=x[0].s,m=1;m<v;++m)x[m].s>ee&&(ee=x[m].s);var j=new Co(ee+1),Pe=Fp(u[O-1],j,0);if(Pe>o){var m=0,ce=0,Q=Pe-o,ge=1<<Q;for(x.sort(function(Ze,it){return j[it.s]-j[Ze.s]||Ze.f-it.f});m<v;++m){var Qe=x[m].s;if(j[Qe]>o)ce+=ge-(1<<Pe-j[Qe]),j[Qe]=o;else break}for(ce>>=Q;ce>0;){var Oe=x[m].s;j[Oe]<o?ce-=1<<o-j[Oe]++-1:++m}for(;m>=0&&ce;--m){var Me=x[m].s;j[Me]==o&&(--j[Me],++ce)}Pe=o}return{t:new ul(j),l:Pe}},Fp=function(p,o,u){return p.s==-1?Math.max(Fp(p.l,o,u+1),Fp(p.r,o,u+1)):o[p.s]=u},I_=function(p){for(var o=p.length;o&&!p[--o];);for(var u=new Co(++o),m=0,v=p[0],x=1,b=function(C){u[m++]=C},a=1;a<=o;++a)if(p[a]==v&&a!=o)++x;else{if(!v&&x>2){for(;x>138;x-=138)b(32754);x>2&&(b(x>10?x-11<<5|28690:x-3<<5|12305),x=0)}else if(x>3){for(b(v),--x;x>6;x-=6)b(8304);x>2&&(b(x-3<<5|8208),x=0)}for(;x--;)b(v);x=1,v=p[a]}return{c:u.subarray(0,m),n:o}},Bh=function(p,o){for(var u=0,m=0;m<o.length;++m)u+=p[m]*o[m];return u},Qy=function(p,o,u){var m=u.length,v=Ky(o+2);p[v]=m&255,p[v+1]=m>>8,p[v+2]=p[v]^255,p[v+3]=p[v+1]^255;for(var x=0;x<m;++x)p[v+x+4]=u[x];return(v+4+m)*8},E_=function(p,o,u,m,v,x,b,a,C,F,O){mc(o,O++,u),++v[256];for(var Y=cp(v,15),ee=Y.t,j=Y.l,Pe=cp(x,15),ce=Pe.t,Q=Pe.l,ge=I_(ee),Qe=ge.c,Oe=ge.n,Me=I_(ce),Ge=Me.c,Ze=Me.n,it=new Co(19),He=0;He<Qe.length;++He)++it[Qe[He]&31];for(var He=0;He<Ge.length;++He)++it[Ge[He]&31];for(var Te=cp(it,7),st=Te.t,me=Te.l,xe=19;xe>4&&!st[P_[xe-1]];--xe);var Xe=F+5<<3,Ye=Bh(v,wu)+Bh(x,Zd)+b,At=Bh(v,ee)+Bh(x,ce)+b+14+3*xe+Bh(it,st)+2*it[16]+3*it[17]+7*it[18];if(C>=0&&Xe<=Ye&&Xe<=At)return Qy(o,O,p.subarray(C,C+F));var Dt,kt,yt,vt;if(mc(o,O,1+(At<Ye)),O+=2,At<Ye){Dt=Vh(ee,j),kt=ee,yt=Vh(ce,Q),vt=ce;var sr=Vh(st,me);mc(o,O,Oe-257),mc(o,O+5,Ze-1),mc(o,O+10,xe-4),O+=14;for(var He=0;He<xe;++He)mc(o,O+3*He,st[P_[He]]);O+=3*xe;for(var Zt=[Qe,Ge],he=0;he<2;++he)for(var Fe=Zt[he],He=0;He<Fe.length;++He){var $e=Fe[He]&31;mc(o,O,sr[$e]),O+=st[$e],$e>15&&(mc(o,O,Fe[He]>>5&127),O+=Fe[He]>>12)}}else Dt=b2,kt=wu,yt=x2,vt=Zd;for(var He=0;He<a;++He){var tt=m[He];if(tt>255){var $e=tt>>18&31;Oh(o,O,Dt[$e+257]),O+=kt[$e+257],$e>7&&(mc(o,O,tt>>23&31),O+=Wp[$e]);var ct=tt&31;Oh(o,O,yt[ct]),O+=vt[ct],ct>3&&(Oh(o,O,tt>>5&8191),O+=Hp[ct])}else Oh(o,O,Dt[tt]),O+=kt[tt]}return Oh(o,O,Dt[256]),O+kt[256]},S2=new Zp([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),e0=new ul(0),T2=function(p,o,u,m,v,x){var b=x.z||p.length,a=new ul(m+b+5*(1+Math.ceil(b/7e3))+v),C=a.subarray(m,a.length-v),F=x.l,O=(x.r||0)&7;if(o){O&&(C[0]=x.r>>3);for(var Y=S2[o-1],ee=Y>>13,j=Y&8191,Pe=(1<<u)-1,ce=x.p||new Co(32768),Q=x.h||new Co(Pe+1),ge=Math.ceil(u/3),Qe=2*ge,Oe=function(Ft){return(p[Ft]^p[Ft+1]<<ge^p[Ft+2]<<Qe)&Pe},Me=new Zp(25e3),Ge=new Co(288),Ze=new Co(32),it=0,He=0,Te=x.i||0,st=0,me=x.w||0,xe=0;Te+2<b;++Te){var Xe=Oe(Te),Ye=Te&32767,At=Q[Xe];if(ce[Ye]=At,Q[Xe]=Ye,me<=Te){var Dt=b-Te;if((it>7e3||st>24576)&&(Dt>423||!F)){O=E_(p,C,0,Me,Ge,Ze,He,st,xe,Te-xe,O),st=it=He=0,xe=Te;for(var kt=0;kt<286;++kt)Ge[kt]=0;for(var kt=0;kt<30;++kt)Ze[kt]=0}var yt=2,vt=0,sr=j,Zt=Ye-At&32767;if(Dt>2&&Xe==Oe(Te-Zt))for(var he=Math.min(ee,Dt)-1,Fe=Math.min(32767,Te),$e=Math.min(258,Dt);Zt<=Fe&&--sr&&Ye!=At;){if(p[Te+yt]==p[Te+yt-Zt]){for(var tt=0;tt<$e&&p[Te+tt]==p[Te+tt-Zt];++tt);if(tt>yt){if(yt=tt,vt=Zt,tt>he)break;for(var ct=Math.min(Zt,tt-2),ut=0,kt=0;kt<ct;++kt){var pt=Te-Zt+kt&32767,wt=ce[pt],Bt=pt-wt&32767;Bt>ut&&(ut=Bt,At=pt)}}}Ye=At,At=ce[Ye],Zt+=Ye-At&32767}if(vt){Me[st++]=268435456|Dp[yt]<<18|A_[vt];var er=Dp[yt]&31,ur=A_[vt]&31;He+=Wp[er]+Hp[ur],++Ge[257+er],++Ze[ur],me=Te+yt,++it}else Me[st++]=p[Te],++Ge[p[Te]]}}for(Te=Math.max(Te,me);Te<b;++Te)Me[st++]=p[Te],++Ge[p[Te]];O=E_(p,C,F,Me,Ge,Ze,He,st,xe,Te-xe,O),F||(x.r=O&7|C[O/8|0]<<3,O-=7,x.h=Q,x.p=ce,x.i=Te,x.w=me)}else{for(var Te=x.w||0;Te<b+F;Te+=65535){var fr=Te+65535;fr>=b&&(C[O/8|0]=F,fr=b),O=Qy(C,O+1,p.subarray(Te,fr))}x.i=b}return w2(a,0,m+Ky(O)+v)},t0=function(){var p=1,o=0;return{p:function(u){for(var m=p,v=o,x=u.length|0,b=0;b!=x;){for(var a=Math.min(b+2655,x);b<a;++b)v+=m+=u[b];m=(m&65535)+15*(m>>16),v=(v&65535)+15*(v>>16)}p=m,o=v},d:function(){return p%=65521,o%=65521,(p&255)<<24|(p&65280)<<8|(o&255)<<8|o>>8}}},P2=function(p,o,u,m,v){if(!v&&(v={l:1},o.dictionary)){var x=o.dictionary.subarray(-32768),b=new ul(x.length+p.length);b.set(x),b.set(p,x.length),p=b,v.w=x.length}return T2(p,o.level==null?6:o.level,o.mem==null?v.l?Math.ceil(Math.max(8,Math.min(13,Math.log(p.length)))*1.5):20:12+o.mem,u,m,v)},r0=function(p,o,u){for(;u;++o)p[o]=u,u>>>=8},A2=function(p,o){var u=o.level,m=u==0?0:u<6?1:u==9?3:2;if(p[0]=120,p[1]=m<<6|(o.dictionary&&32),p[1]|=31-(p[0]<<8|p[1])%31,o.dictionary){var v=t0();v.p(o.dictionary),r0(p,2,v.d())}};function Rp(p,o){o||(o={});var u=t0();u.p(p);var m=P2(p,o,o.dictionary?6:2,4);return A2(m,o),r0(m,m.length-4,u.d()),m}var I2=typeof TextDecoder<"u"&&new TextDecoder,E2=0;try{I2.decode(e0,{stream:!0}),E2=1}catch{}function L2(p){if(Array.isArray(p))return p}function M2(p,o){var u=p==null?null:typeof Symbol<"u"&&p[Symbol.iterator]||p["@@iterator"];if(u!=null){var m,v,x,b,a=[],C=!0,F=!1;try{if(x=(u=u.call(p)).next,o!==0)for(;!(C=(m=x.call(u)).done)&&(a.push(m.value),a.length!==o);C=!0);}catch(O){F=!0,v=O}finally{try{if(!C&&u.return!=null&&(b=u.return(),Object(b)!==b))return}finally{if(F)throw v}}return a}}function L_(p,o){(o==null||o>p.length)&&(o=p.length);for(var u=0,m=Array(o);u<o;u++)m[u]=p[u];return m}function C2(p,o){if(p){if(typeof p=="string")return L_(p,o);var u={}.toString.call(p).slice(8,-1);return u==="Object"&&p.constructor&&(u=p.constructor.name),u==="Map"||u==="Set"?Array.from(p):u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u)?L_(p,o):void 0}}function k2(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function M_(p,o){return L2(p)||M2(p,o)||C2(p,o)||k2()}function C_(p,o="utf8"){return new TextDecoder(o).decode(p)}const D2=new TextEncoder;function F2(p){return D2.encode(p)}const R2=1024*8,z2=(()=>{const p=new Uint8Array(4),o=new Uint32Array(p.buffer);return!((o[0]=1)&p[0])})(),up={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class Xp{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(o=R2,u={}){let m=!1;typeof o=="number"?o=new ArrayBuffer(o):(m=!0,this.lastWrittenByte=o.byteLength);const v=u.offset?u.offset>>>0:0,x=o.byteLength-v;let b=v;(ArrayBuffer.isView(o)||o instanceof Xp)&&(o.byteLength!==o.buffer.byteLength&&(b=o.byteOffset+v),o=o.buffer),m?this.lastWrittenByte=x:this.lastWrittenByte=0,this.buffer=o,this.length=x,this.byteLength=x,this.byteOffset=b,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,b,x),this._mark=0,this._marks=[]}available(o=1){return this.offset+o<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(o=1){return this.offset+=o,this}back(o=1){return this.offset-=o,this}seek(o){return this.offset=o,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const o=this._marks.pop();if(o===void 0)throw new Error("Mark stack empty");return this.seek(o),this}rewind(){return this.offset=0,this}ensureAvailable(o=1){if(!this.available(o)){const u=(this.offset+o)*2,m=new Uint8Array(u);m.set(new Uint8Array(this.buffer)),this.buffer=m.buffer,this.length=u,this.byteLength=u,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(o=1){return this.readArray(o,"uint8")}readArray(o,u){const m=up[u].BYTES_PER_ELEMENT*o,v=this.byteOffset+this.offset,x=this.buffer.slice(v,v+m);if(this.littleEndian===z2&&u!=="uint8"&&u!=="int8"){const a=new Uint8Array(this.buffer.slice(v,v+m));a.reverse();const C=new up[u](a.buffer);return this.offset+=m,C.reverse(),C}const b=new up[u](x);return this.offset+=m,b}readInt16(){const o=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,o}readUint16(){const o=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,o}readInt32(){const o=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,o}readUint32(){const o=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,o}readFloat32(){const o=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,o}readFloat64(){const o=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,o}readBigInt64(){const o=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,o}readBigUint64(){const o=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,o}readChar(){return String.fromCharCode(this.readInt8())}readChars(o=1){let u="";for(let m=0;m<o;m++)u+=this.readChar();return u}readUtf8(o=1){return C_(this.readBytes(o))}decodeText(o=1,u="utf8"){return C_(this.readBytes(o),u)}writeBoolean(o){return this.writeUint8(o?255:0),this}writeInt8(o){return this.ensureAvailable(1),this._data.setInt8(this.offset++,o),this._updateLastWrittenByte(),this}writeUint8(o){return this.ensureAvailable(1),this._data.setUint8(this.offset++,o),this._updateLastWrittenByte(),this}writeByte(o){return this.writeUint8(o)}writeBytes(o){this.ensureAvailable(o.length);for(let u=0;u<o.length;u++)this._data.setUint8(this.offset++,o[u]);return this._updateLastWrittenByte(),this}writeInt16(o){return this.ensureAvailable(2),this._data.setInt16(this.offset,o,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(o){return this.ensureAvailable(2),this._data.setUint16(this.offset,o,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(o){return this.ensureAvailable(4),this._data.setInt32(this.offset,o,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(o){return this.ensureAvailable(4),this._data.setUint32(this.offset,o,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(o){return this.ensureAvailable(4),this._data.setFloat32(this.offset,o,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(o){return this.ensureAvailable(8),this._data.setFloat64(this.offset,o,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(o){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,o,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(o){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,o,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(o){return this.writeUint8(o.charCodeAt(0))}writeChars(o){for(let u=0;u<o.length;u++)this.writeUint8(o.charCodeAt(u));return this}writeUtf8(o){return this.writeBytes(F2(o))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function fh(p){let o=p.length;for(;--o>=0;)p[o]=0}const N2=3,O2=258,i0=29,B2=256,j2=B2+1+i0,n0=30,U2=512,V2=new Array((j2+2)*2);fh(V2);const q2=new Array(n0*2);fh(q2);const G2=new Array(U2);fh(G2);const $2=new Array(O2-N2+1);fh($2);const Z2=new Array(i0);fh(Z2);const W2=new Array(n0);fh(W2);const H2=(p,o,u,m)=>{let v=p&65535|0,x=p>>>16&65535|0,b=0;for(;u!==0;){b=u>2e3?2e3:u,u-=b;do v=v+o[m++]|0,x=x+v|0;while(--b);v%=65521,x%=65521}return v|x<<16|0};var zp=H2;const X2=()=>{let p,o=[];for(var u=0;u<256;u++){p=u;for(var m=0;m<8;m++)p=p&1?3988292384^p>>>1:p>>>1;o[u]=p}return o},Y2=new Uint32Array(X2()),J2=(p,o,u,m)=>{const v=Y2,x=m+u;p^=-1;for(let b=m;b<x;b++)p=p>>>8^v[(p^o[b])&255];return p^-1};var Fl=J2,Np={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},s0={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const K2=(p,o)=>Object.prototype.hasOwnProperty.call(p,o);var Q2=function(p){const o=Array.prototype.slice.call(arguments,1);for(;o.length;){const u=o.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(const m in u)K2(u,m)&&(p[m]=u[m])}}return p},ex=p=>{let o=0;for(let m=0,v=p.length;m<v;m++)o+=p[m].length;const u=new Uint8Array(o);for(let m=0,v=0,x=p.length;m<x;m++){let b=p[m];u.set(b,v),v+=b.length}return u},a0={assign:Q2,flattenChunks:ex};let o0=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o0=!1}const Wh=new Uint8Array(256);for(let p=0;p<256;p++)Wh[p]=p>=252?6:p>=248?5:p>=240?4:p>=224?3:p>=192?2:1;Wh[254]=Wh[254]=1;var tx=p=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(p);let o,u,m,v,x,b=p.length,a=0;for(v=0;v<b;v++)u=p.charCodeAt(v),(u&64512)===55296&&v+1<b&&(m=p.charCodeAt(v+1),(m&64512)===56320&&(u=65536+(u-55296<<10)+(m-56320),v++)),a+=u<128?1:u<2048?2:u<65536?3:4;for(o=new Uint8Array(a),x=0,v=0;x<a;v++)u=p.charCodeAt(v),(u&64512)===55296&&v+1<b&&(m=p.charCodeAt(v+1),(m&64512)===56320&&(u=65536+(u-55296<<10)+(m-56320),v++)),u<128?o[x++]=u:u<2048?(o[x++]=192|u>>>6,o[x++]=128|u&63):u<65536?(o[x++]=224|u>>>12,o[x++]=128|u>>>6&63,o[x++]=128|u&63):(o[x++]=240|u>>>18,o[x++]=128|u>>>12&63,o[x++]=128|u>>>6&63,o[x++]=128|u&63);return o};const rx=(p,o)=>{if(o<65534&&p.subarray&&o0)return String.fromCharCode.apply(null,p.length===o?p:p.subarray(0,o));let u="";for(let m=0;m<o;m++)u+=String.fromCharCode(p[m]);return u};var ix=(p,o)=>{const u=o||p.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(p.subarray(0,o));let m,v;const x=new Array(u*2);for(v=0,m=0;m<u;){let b=p[m++];if(b<128){x[v++]=b;continue}let a=Wh[b];if(a>4){x[v++]=65533,m+=a-1;continue}for(b&=a===2?31:a===3?15:7;a>1&&m<u;)b=b<<6|p[m++]&63,a--;if(a>1){x[v++]=65533;continue}b<65536?x[v++]=b:(b-=65536,x[v++]=55296|b>>10&1023,x[v++]=56320|b&1023)}return rx(x,v)},nx=(p,o)=>{o=o||p.length,o>p.length&&(o=p.length);let u=o-1;for(;u>=0&&(p[u]&192)===128;)u--;return u<0||u===0?o:u+Wh[p[u]]>o?u:o},Op={string2buf:tx,buf2string:ix,utf8border:nx};function sx(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var ax=sx;const Ld=16209,ox=16191;var lx=function(p,o){let u,m,v,x,b,a,C,F,O,Y,ee,j,Pe,ce,Q,ge,Qe,Oe,Me,Ge,Ze,it,He,Te;const st=p.state;u=p.next_in,He=p.input,m=u+(p.avail_in-5),v=p.next_out,Te=p.output,x=v-(o-p.avail_out),b=v+(p.avail_out-257),a=st.dmax,C=st.wsize,F=st.whave,O=st.wnext,Y=st.window,ee=st.hold,j=st.bits,Pe=st.lencode,ce=st.distcode,Q=(1<<st.lenbits)-1,ge=(1<<st.distbits)-1;e:do{j<15&&(ee+=He[u++]<<j,j+=8,ee+=He[u++]<<j,j+=8),Qe=Pe[ee&Q];t:for(;;){if(Oe=Qe>>>24,ee>>>=Oe,j-=Oe,Oe=Qe>>>16&255,Oe===0)Te[v++]=Qe&65535;else if(Oe&16){Me=Qe&65535,Oe&=15,Oe&&(j<Oe&&(ee+=He[u++]<<j,j+=8),Me+=ee&(1<<Oe)-1,ee>>>=Oe,j-=Oe),j<15&&(ee+=He[u++]<<j,j+=8,ee+=He[u++]<<j,j+=8),Qe=ce[ee&ge];r:for(;;){if(Oe=Qe>>>24,ee>>>=Oe,j-=Oe,Oe=Qe>>>16&255,Oe&16){if(Ge=Qe&65535,Oe&=15,j<Oe&&(ee+=He[u++]<<j,j+=8,j<Oe&&(ee+=He[u++]<<j,j+=8)),Ge+=ee&(1<<Oe)-1,Ge>a){p.msg="invalid distance too far back",st.mode=Ld;break e}if(ee>>>=Oe,j-=Oe,Oe=v-x,Ge>Oe){if(Oe=Ge-Oe,Oe>F&&st.sane){p.msg="invalid distance too far back",st.mode=Ld;break e}if(Ze=0,it=Y,O===0){if(Ze+=C-Oe,Oe<Me){Me-=Oe;do Te[v++]=Y[Ze++];while(--Oe);Ze=v-Ge,it=Te}}else if(O<Oe){if(Ze+=C+O-Oe,Oe-=O,Oe<Me){Me-=Oe;do Te[v++]=Y[Ze++];while(--Oe);if(Ze=0,O<Me){Oe=O,Me-=Oe;do Te[v++]=Y[Ze++];while(--Oe);Ze=v-Ge,it=Te}}}else if(Ze+=O-Oe,Oe<Me){Me-=Oe;do Te[v++]=Y[Ze++];while(--Oe);Ze=v-Ge,it=Te}for(;Me>2;)Te[v++]=it[Ze++],Te[v++]=it[Ze++],Te[v++]=it[Ze++],Me-=3;Me&&(Te[v++]=it[Ze++],Me>1&&(Te[v++]=it[Ze++]))}else{Ze=v-Ge;do Te[v++]=Te[Ze++],Te[v++]=Te[Ze++],Te[v++]=Te[Ze++],Me-=3;while(Me>2);Me&&(Te[v++]=Te[Ze++],Me>1&&(Te[v++]=Te[Ze++]))}}else if((Oe&64)===0){Qe=ce[(Qe&65535)+(ee&(1<<Oe)-1)];continue r}else{p.msg="invalid distance code",st.mode=Ld;break e}break}}else if((Oe&64)===0){Qe=Pe[(Qe&65535)+(ee&(1<<Oe)-1)];continue t}else if(Oe&32){st.mode=ox;break e}else{p.msg="invalid literal/length code",st.mode=Ld;break e}break}}while(u<m&&v<b);Me=j>>3,u-=Me,j-=Me<<3,ee&=(1<<j)-1,p.next_in=u,p.next_out=v,p.avail_in=u<m?5+(m-u):5-(u-m),p.avail_out=v<b?257+(b-v):257-(v-b),st.hold=ee,st.bits=j};const Ku=15,k_=852,D_=592,F_=0,hp=1,R_=2,cx=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ux=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),hx=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dx=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),fx=(p,o,u,m,v,x,b,a)=>{const C=a.bits;let F=0,O=0,Y=0,ee=0,j=0,Pe=0,ce=0,Q=0,ge=0,Qe=0,Oe,Me,Ge,Ze,it,He=null,Te;const st=new Uint16Array(Ku+1),me=new Uint16Array(Ku+1);let xe=null,Xe,Ye,At;for(F=0;F<=Ku;F++)st[F]=0;for(O=0;O<m;O++)st[o[u+O]]++;for(j=C,ee=Ku;ee>=1&&st[ee]===0;ee--);if(j>ee&&(j=ee),ee===0)return v[x++]=1<<24|64<<16|0,v[x++]=1<<24|64<<16|0,a.bits=1,0;for(Y=1;Y<ee&&st[Y]===0;Y++);for(j<Y&&(j=Y),Q=1,F=1;F<=Ku;F++)if(Q<<=1,Q-=st[F],Q<0)return-1;if(Q>0&&(p===F_||ee!==1))return-1;for(me[1]=0,F=1;F<Ku;F++)me[F+1]=me[F]+st[F];for(O=0;O<m;O++)o[u+O]!==0&&(b[me[o[u+O]]++]=O);if(p===F_?(He=xe=b,Te=20):p===hp?(He=cx,xe=ux,Te=257):(He=hx,xe=dx,Te=0),Qe=0,O=0,F=Y,it=x,Pe=j,ce=0,Ge=-1,ge=1<<j,Ze=ge-1,p===hp&&ge>k_||p===R_&&ge>D_)return 1;for(;;){Xe=F-ce,b[O]+1<Te?(Ye=0,At=b[O]):b[O]>=Te?(Ye=xe[b[O]-Te],At=He[b[O]-Te]):(Ye=96,At=0),Oe=1<<F-ce,Me=1<<Pe,Y=Me;do Me-=Oe,v[it+(Qe>>ce)+Me]=Xe<<24|Ye<<16|At|0;while(Me!==0);for(Oe=1<<F-1;Qe&Oe;)Oe>>=1;if(Oe!==0?(Qe&=Oe-1,Qe+=Oe):Qe=0,O++,--st[F]===0){if(F===ee)break;F=o[u+b[O]]}if(F>j&&(Qe&Ze)!==Ge){for(ce===0&&(ce=j),it+=Y,Pe=F-ce,Q=1<<Pe;Pe+ce<ee&&(Q-=st[Pe+ce],!(Q<=0));)Pe++,Q<<=1;if(ge+=1<<Pe,p===hp&&ge>k_||p===R_&&ge>D_)return 1;Ge=Qe&Ze,v[Ge]=j<<24|Pe<<16|it-x|0}}return Qe!==0&&(v[it+Qe]=F-ce<<24|64<<16|0),a.bits=j,0};var qh=fx;const px=0,l0=1,c0=2,{Z_FINISH:z_,Z_BLOCK:mx,Z_TREES:Md,Z_OK:Su,Z_STREAM_END:gx,Z_NEED_DICT:_x,Z_STREAM_ERROR:hl,Z_DATA_ERROR:u0,Z_MEM_ERROR:h0,Z_BUF_ERROR:yx,Z_DEFLATED:N_}=s0,Qd=16180,O_=16181,B_=16182,j_=16183,U_=16184,V_=16185,q_=16186,G_=16187,$_=16188,Z_=16189,Wd=16190,gc=16191,dp=16192,W_=16193,fp=16194,H_=16195,X_=16196,Y_=16197,J_=16198,Cd=16199,kd=16200,K_=16201,Q_=16202,ey=16203,ty=16204,ry=16205,pp=16206,iy=16207,ny=16208,Tn=16209,d0=16210,f0=16211,vx=852,bx=592,xx=15,wx=xx,sy=p=>(p>>>24&255)+(p>>>8&65280)+((p&65280)<<8)+((p&255)<<24);function Sx(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Tu=p=>{if(!p)return 1;const o=p.state;return!o||o.strm!==p||o.mode<Qd||o.mode>f0?1:0},p0=p=>{if(Tu(p))return hl;const o=p.state;return p.total_in=p.total_out=o.total=0,p.msg="",o.wrap&&(p.adler=o.wrap&1),o.mode=Qd,o.last=0,o.havedict=0,o.flags=-1,o.dmax=32768,o.head=null,o.hold=0,o.bits=0,o.lencode=o.lendyn=new Int32Array(vx),o.distcode=o.distdyn=new Int32Array(bx),o.sane=1,o.back=-1,Su},m0=p=>{if(Tu(p))return hl;const o=p.state;return o.wsize=0,o.whave=0,o.wnext=0,p0(p)},g0=(p,o)=>{let u;if(Tu(p))return hl;const m=p.state;return o<0?(u=0,o=-o):(u=(o>>4)+5,o<48&&(o&=15)),o&&(o<8||o>15)?hl:(m.window!==null&&m.wbits!==o&&(m.window=null),m.wrap=u,m.wbits=o,m0(p))},_0=(p,o)=>{if(!p)return hl;const u=new Sx;p.state=u,u.strm=p,u.window=null,u.mode=Qd;const m=g0(p,o);return m!==Su&&(p.state=null),m},Tx=p=>_0(p,wx);let ay=!0,mp,gp;const Px=p=>{if(ay){mp=new Int32Array(512),gp=new Int32Array(32);let o=0;for(;o<144;)p.lens[o++]=8;for(;o<256;)p.lens[o++]=9;for(;o<280;)p.lens[o++]=7;for(;o<288;)p.lens[o++]=8;for(qh(l0,p.lens,0,288,mp,0,p.work,{bits:9}),o=0;o<32;)p.lens[o++]=5;qh(c0,p.lens,0,32,gp,0,p.work,{bits:5}),ay=!1}p.lencode=mp,p.lenbits=9,p.distcode=gp,p.distbits=5},y0=(p,o,u,m)=>{let v;const x=p.state;return x.window===null&&(x.wsize=1<<x.wbits,x.wnext=0,x.whave=0,x.window=new Uint8Array(x.wsize)),m>=x.wsize?(x.window.set(o.subarray(u-x.wsize,u),0),x.wnext=0,x.whave=x.wsize):(v=x.wsize-x.wnext,v>m&&(v=m),x.window.set(o.subarray(u-m,u-m+v),x.wnext),m-=v,m?(x.window.set(o.subarray(u-m,u),0),x.wnext=m,x.whave=x.wsize):(x.wnext+=v,x.wnext===x.wsize&&(x.wnext=0),x.whave<x.wsize&&(x.whave+=v))),0},Ax=(p,o)=>{let u,m,v,x,b,a,C,F,O,Y,ee,j,Pe,ce,Q=0,ge,Qe,Oe,Me,Ge,Ze,it,He;const Te=new Uint8Array(4);let st,me;const xe=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Tu(p)||!p.output||!p.input&&p.avail_in!==0)return hl;u=p.state,u.mode===gc&&(u.mode=dp),b=p.next_out,v=p.output,C=p.avail_out,x=p.next_in,m=p.input,a=p.avail_in,F=u.hold,O=u.bits,Y=a,ee=C,He=Su;e:for(;;)switch(u.mode){case Qd:if(u.wrap===0){u.mode=dp;break}for(;O<16;){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}if(u.wrap&2&&F===35615){u.wbits===0&&(u.wbits=15),u.check=0,Te[0]=F&255,Te[1]=F>>>8&255,u.check=Fl(u.check,Te,2,0),F=0,O=0,u.mode=O_;break}if(u.head&&(u.head.done=!1),!(u.wrap&1)||(((F&255)<<8)+(F>>8))%31){p.msg="incorrect header check",u.mode=Tn;break}if((F&15)!==N_){p.msg="unknown compression method",u.mode=Tn;break}if(F>>>=4,O-=4,it=(F&15)+8,u.wbits===0&&(u.wbits=it),it>15||it>u.wbits){p.msg="invalid window size",u.mode=Tn;break}u.dmax=1<<u.wbits,u.flags=0,p.adler=u.check=1,u.mode=F&512?Z_:gc,F=0,O=0;break;case O_:for(;O<16;){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}if(u.flags=F,(u.flags&255)!==N_){p.msg="unknown compression method",u.mode=Tn;break}if(u.flags&57344){p.msg="unknown header flags set",u.mode=Tn;break}u.head&&(u.head.text=F>>8&1),u.flags&512&&u.wrap&4&&(Te[0]=F&255,Te[1]=F>>>8&255,u.check=Fl(u.check,Te,2,0)),F=0,O=0,u.mode=B_;case B_:for(;O<32;){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}u.head&&(u.head.time=F),u.flags&512&&u.wrap&4&&(Te[0]=F&255,Te[1]=F>>>8&255,Te[2]=F>>>16&255,Te[3]=F>>>24&255,u.check=Fl(u.check,Te,4,0)),F=0,O=0,u.mode=j_;case j_:for(;O<16;){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}u.head&&(u.head.xflags=F&255,u.head.os=F>>8),u.flags&512&&u.wrap&4&&(Te[0]=F&255,Te[1]=F>>>8&255,u.check=Fl(u.check,Te,2,0)),F=0,O=0,u.mode=U_;case U_:if(u.flags&1024){for(;O<16;){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}u.length=F,u.head&&(u.head.extra_len=F),u.flags&512&&u.wrap&4&&(Te[0]=F&255,Te[1]=F>>>8&255,u.check=Fl(u.check,Te,2,0)),F=0,O=0}else u.head&&(u.head.extra=null);u.mode=V_;case V_:if(u.flags&1024&&(j=u.length,j>a&&(j=a),j&&(u.head&&(it=u.head.extra_len-u.length,u.head.extra||(u.head.extra=new Uint8Array(u.head.extra_len)),u.head.extra.set(m.subarray(x,x+j),it)),u.flags&512&&u.wrap&4&&(u.check=Fl(u.check,m,j,x)),a-=j,x+=j,u.length-=j),u.length))break e;u.length=0,u.mode=q_;case q_:if(u.flags&2048){if(a===0)break e;j=0;do it=m[x+j++],u.head&&it&&u.length<65536&&(u.head.name+=String.fromCharCode(it));while(it&&j<a);if(u.flags&512&&u.wrap&4&&(u.check=Fl(u.check,m,j,x)),a-=j,x+=j,it)break e}else u.head&&(u.head.name=null);u.length=0,u.mode=G_;case G_:if(u.flags&4096){if(a===0)break e;j=0;do it=m[x+j++],u.head&&it&&u.length<65536&&(u.head.comment+=String.fromCharCode(it));while(it&&j<a);if(u.flags&512&&u.wrap&4&&(u.check=Fl(u.check,m,j,x)),a-=j,x+=j,it)break e}else u.head&&(u.head.comment=null);u.mode=$_;case $_:if(u.flags&512){for(;O<16;){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}if(u.wrap&4&&F!==(u.check&65535)){p.msg="header crc mismatch",u.mode=Tn;break}F=0,O=0}u.head&&(u.head.hcrc=u.flags>>9&1,u.head.done=!0),p.adler=u.check=0,u.mode=gc;break;case Z_:for(;O<32;){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}p.adler=u.check=sy(F),F=0,O=0,u.mode=Wd;case Wd:if(u.havedict===0)return p.next_out=b,p.avail_out=C,p.next_in=x,p.avail_in=a,u.hold=F,u.bits=O,_x;p.adler=u.check=1,u.mode=gc;case gc:if(o===mx||o===Md)break e;case dp:if(u.last){F>>>=O&7,O-=O&7,u.mode=pp;break}for(;O<3;){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}switch(u.last=F&1,F>>>=1,O-=1,F&3){case 0:u.mode=W_;break;case 1:if(Px(u),u.mode=Cd,o===Md){F>>>=2,O-=2;break e}break;case 2:u.mode=X_;break;case 3:p.msg="invalid block type",u.mode=Tn}F>>>=2,O-=2;break;case W_:for(F>>>=O&7,O-=O&7;O<32;){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}if((F&65535)!==(F>>>16^65535)){p.msg="invalid stored block lengths",u.mode=Tn;break}if(u.length=F&65535,F=0,O=0,u.mode=fp,o===Md)break e;case fp:u.mode=H_;case H_:if(j=u.length,j){if(j>a&&(j=a),j>C&&(j=C),j===0)break e;v.set(m.subarray(x,x+j),b),a-=j,x+=j,C-=j,b+=j,u.length-=j;break}u.mode=gc;break;case X_:for(;O<14;){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}if(u.nlen=(F&31)+257,F>>>=5,O-=5,u.ndist=(F&31)+1,F>>>=5,O-=5,u.ncode=(F&15)+4,F>>>=4,O-=4,u.nlen>286||u.ndist>30){p.msg="too many length or distance symbols",u.mode=Tn;break}u.have=0,u.mode=Y_;case Y_:for(;u.have<u.ncode;){for(;O<3;){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}u.lens[xe[u.have++]]=F&7,F>>>=3,O-=3}for(;u.have<19;)u.lens[xe[u.have++]]=0;if(u.lencode=u.lendyn,u.lenbits=7,st={bits:u.lenbits},He=qh(px,u.lens,0,19,u.lencode,0,u.work,st),u.lenbits=st.bits,He){p.msg="invalid code lengths set",u.mode=Tn;break}u.have=0,u.mode=J_;case J_:for(;u.have<u.nlen+u.ndist;){for(;Q=u.lencode[F&(1<<u.lenbits)-1],ge=Q>>>24,Qe=Q>>>16&255,Oe=Q&65535,!(ge<=O);){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}if(Oe<16)F>>>=ge,O-=ge,u.lens[u.have++]=Oe;else{if(Oe===16){for(me=ge+2;O<me;){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}if(F>>>=ge,O-=ge,u.have===0){p.msg="invalid bit length repeat",u.mode=Tn;break}it=u.lens[u.have-1],j=3+(F&3),F>>>=2,O-=2}else if(Oe===17){for(me=ge+3;O<me;){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}F>>>=ge,O-=ge,it=0,j=3+(F&7),F>>>=3,O-=3}else{for(me=ge+7;O<me;){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}F>>>=ge,O-=ge,it=0,j=11+(F&127),F>>>=7,O-=7}if(u.have+j>u.nlen+u.ndist){p.msg="invalid bit length repeat",u.mode=Tn;break}for(;j--;)u.lens[u.have++]=it}}if(u.mode===Tn)break;if(u.lens[256]===0){p.msg="invalid code -- missing end-of-block",u.mode=Tn;break}if(u.lenbits=9,st={bits:u.lenbits},He=qh(l0,u.lens,0,u.nlen,u.lencode,0,u.work,st),u.lenbits=st.bits,He){p.msg="invalid literal/lengths set",u.mode=Tn;break}if(u.distbits=6,u.distcode=u.distdyn,st={bits:u.distbits},He=qh(c0,u.lens,u.nlen,u.ndist,u.distcode,0,u.work,st),u.distbits=st.bits,He){p.msg="invalid distances set",u.mode=Tn;break}if(u.mode=Cd,o===Md)break e;case Cd:u.mode=kd;case kd:if(a>=6&&C>=258){p.next_out=b,p.avail_out=C,p.next_in=x,p.avail_in=a,u.hold=F,u.bits=O,lx(p,ee),b=p.next_out,v=p.output,C=p.avail_out,x=p.next_in,m=p.input,a=p.avail_in,F=u.hold,O=u.bits,u.mode===gc&&(u.back=-1);break}for(u.back=0;Q=u.lencode[F&(1<<u.lenbits)-1],ge=Q>>>24,Qe=Q>>>16&255,Oe=Q&65535,!(ge<=O);){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}if(Qe&&(Qe&240)===0){for(Me=ge,Ge=Qe,Ze=Oe;Q=u.lencode[Ze+((F&(1<<Me+Ge)-1)>>Me)],ge=Q>>>24,Qe=Q>>>16&255,Oe=Q&65535,!(Me+ge<=O);){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}F>>>=Me,O-=Me,u.back+=Me}if(F>>>=ge,O-=ge,u.back+=ge,u.length=Oe,Qe===0){u.mode=ry;break}if(Qe&32){u.back=-1,u.mode=gc;break}if(Qe&64){p.msg="invalid literal/length code",u.mode=Tn;break}u.extra=Qe&15,u.mode=K_;case K_:if(u.extra){for(me=u.extra;O<me;){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}u.length+=F&(1<<u.extra)-1,F>>>=u.extra,O-=u.extra,u.back+=u.extra}u.was=u.length,u.mode=Q_;case Q_:for(;Q=u.distcode[F&(1<<u.distbits)-1],ge=Q>>>24,Qe=Q>>>16&255,Oe=Q&65535,!(ge<=O);){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}if((Qe&240)===0){for(Me=ge,Ge=Qe,Ze=Oe;Q=u.distcode[Ze+((F&(1<<Me+Ge)-1)>>Me)],ge=Q>>>24,Qe=Q>>>16&255,Oe=Q&65535,!(Me+ge<=O);){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}F>>>=Me,O-=Me,u.back+=Me}if(F>>>=ge,O-=ge,u.back+=ge,Qe&64){p.msg="invalid distance code",u.mode=Tn;break}u.offset=Oe,u.extra=Qe&15,u.mode=ey;case ey:if(u.extra){for(me=u.extra;O<me;){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}u.offset+=F&(1<<u.extra)-1,F>>>=u.extra,O-=u.extra,u.back+=u.extra}if(u.offset>u.dmax){p.msg="invalid distance too far back",u.mode=Tn;break}u.mode=ty;case ty:if(C===0)break e;if(j=ee-C,u.offset>j){if(j=u.offset-j,j>u.whave&&u.sane){p.msg="invalid distance too far back",u.mode=Tn;break}j>u.wnext?(j-=u.wnext,Pe=u.wsize-j):Pe=u.wnext-j,j>u.length&&(j=u.length),ce=u.window}else ce=v,Pe=b-u.offset,j=u.length;j>C&&(j=C),C-=j,u.length-=j;do v[b++]=ce[Pe++];while(--j);u.length===0&&(u.mode=kd);break;case ry:if(C===0)break e;v[b++]=u.length,C--,u.mode=kd;break;case pp:if(u.wrap){for(;O<32;){if(a===0)break e;a--,F|=m[x++]<<O,O+=8}if(ee-=C,p.total_out+=ee,u.total+=ee,u.wrap&4&&ee&&(p.adler=u.check=u.flags?Fl(u.check,v,ee,b-ee):zp(u.check,v,ee,b-ee)),ee=C,u.wrap&4&&(u.flags?F:sy(F))!==u.check){p.msg="incorrect data check",u.mode=Tn;break}F=0,O=0}u.mode=iy;case iy:if(u.wrap&&u.flags){for(;O<32;){if(a===0)break e;a--,F+=m[x++]<<O,O+=8}if(u.wrap&4&&F!==(u.total&4294967295)){p.msg="incorrect length check",u.mode=Tn;break}F=0,O=0}u.mode=ny;case ny:He=gx;break e;case Tn:He=u0;break e;case d0:return h0;case f0:default:return hl}return p.next_out=b,p.avail_out=C,p.next_in=x,p.avail_in=a,u.hold=F,u.bits=O,(u.wsize||ee!==p.avail_out&&u.mode<Tn&&(u.mode<pp||o!==z_))&&y0(p,p.output,p.next_out,ee-p.avail_out),Y-=p.avail_in,ee-=p.avail_out,p.total_in+=Y,p.total_out+=ee,u.total+=ee,u.wrap&4&&ee&&(p.adler=u.check=u.flags?Fl(u.check,v,ee,p.next_out-ee):zp(u.check,v,ee,p.next_out-ee)),p.data_type=u.bits+(u.last?64:0)+(u.mode===gc?128:0)+(u.mode===Cd||u.mode===fp?256:0),(Y===0&&ee===0||o===z_)&&He===Su&&(He=yx),He},Ix=p=>{if(Tu(p))return hl;let o=p.state;return o.window&&(o.window=null),p.state=null,Su},Ex=(p,o)=>{if(Tu(p))return hl;const u=p.state;return(u.wrap&2)===0?hl:(u.head=o,o.done=!1,Su)},Lx=(p,o)=>{const u=o.length;let m,v,x;return Tu(p)||(m=p.state,m.wrap!==0&&m.mode!==Wd)?hl:m.mode===Wd&&(v=1,v=zp(v,o,u,0),v!==m.check)?u0:(x=y0(p,o,u,u),x?(m.mode=d0,h0):(m.havedict=1,Su))};var Mx=m0,Cx=g0,kx=p0,Dx=Tx,Fx=_0,Rx=Ax,zx=Ix,Nx=Ex,Ox=Lx,Bx="pako inflate (from Nodeca project)",_c={inflateReset:Mx,inflateReset2:Cx,inflateResetKeep:kx,inflateInit:Dx,inflateInit2:Fx,inflate:Rx,inflateEnd:zx,inflateGetHeader:Nx,inflateSetDictionary:Ox,inflateInfo:Bx};function jx(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Ux=jx;const v0=Object.prototype.toString,{Z_NO_FLUSH:Vx,Z_FINISH:qx,Z_OK:Hh,Z_STREAM_END:_p,Z_NEED_DICT:yp,Z_STREAM_ERROR:Gx,Z_DATA_ERROR:oy,Z_MEM_ERROR:$x}=s0;function Xh(p){this.options=a0.assign({chunkSize:1024*64,windowBits:15,to:""},p||{});const o=this.options;o.raw&&o.windowBits>=0&&o.windowBits<16&&(o.windowBits=-o.windowBits,o.windowBits===0&&(o.windowBits=-15)),o.windowBits>=0&&o.windowBits<16&&!(p&&p.windowBits)&&(o.windowBits+=32),o.windowBits>15&&o.windowBits<48&&(o.windowBits&15)===0&&(o.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ax,this.strm.avail_out=0;let u=_c.inflateInit2(this.strm,o.windowBits);if(u!==Hh)throw new Error(Np[u]);if(this.header=new Ux,_c.inflateGetHeader(this.strm,this.header),o.dictionary&&(typeof o.dictionary=="string"?o.dictionary=Op.string2buf(o.dictionary):v0.call(o.dictionary)==="[object ArrayBuffer]"&&(o.dictionary=new Uint8Array(o.dictionary)),o.raw&&(u=_c.inflateSetDictionary(this.strm,o.dictionary),u!==Hh)))throw new Error(Np[u])}Xh.prototype.push=function(p,o){const u=this.strm,m=this.options.chunkSize,v=this.options.dictionary;let x,b,a;if(this.ended)return!1;for(o===~~o?b=o:b=o===!0?qx:Vx,v0.call(p)==="[object ArrayBuffer]"?u.input=new Uint8Array(p):u.input=p,u.next_in=0,u.avail_in=u.input.length;;){for(u.avail_out===0&&(u.output=new Uint8Array(m),u.next_out=0,u.avail_out=m),x=_c.inflate(u,b),x===yp&&v&&(x=_c.inflateSetDictionary(u,v),x===Hh?x=_c.inflate(u,b):x===oy&&(x=yp));u.avail_in>0&&x===_p&&u.state.wrap>0&&p[u.next_in]!==0;)_c.inflateReset(u),x=_c.inflate(u,b);switch(x){case Gx:case oy:case yp:case $x:return this.onEnd(x),this.ended=!0,!1}if(a=u.avail_out,u.next_out&&(u.avail_out===0||x===_p))if(this.options.to==="string"){let C=Op.utf8border(u.output,u.next_out),F=u.next_out-C,O=Op.buf2string(u.output,C);u.next_out=F,u.avail_out=m-F,F&&u.output.set(u.output.subarray(C,C+F),0),this.onData(O)}else this.onData(u.output.length===u.next_out?u.output:u.output.subarray(0,u.next_out));if(!(x===Hh&&a===0)){if(x===_p)return x=_c.inflateEnd(this.strm),this.onEnd(x),this.ended=!0,!0;if(u.avail_in===0)break}}return!0};Xh.prototype.onData=function(p){this.chunks.push(p)};Xh.prototype.onEnd=function(p){p===Hh&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a0.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg};function Zx(p,o){const u=new Xh(o);if(u.push(p),u.err)throw u.msg||Np[u.err];return u.result}var Wx=Xh,Hx=Zx,Xx={Inflate:Wx,inflate:Hx};const{Inflate:Yx,inflate:Jx}=Xx;var ly=Yx,Kx=Jx;const b0=[];for(let p=0;p<256;p++){let o=p;for(let u=0;u<8;u++)o&1?o=3988292384^o>>>1:o=o>>>1;b0[p]=o}const cy=4294967295;function Qx(p,o,u){let m=p;for(let v=0;v<u;v++)m=b0[(m^o[v])&255]^m>>>8;return m}function ew(p,o){return(Qx(cy,p,o)^cy)>>>0}function uy(p,o,u){const m=p.readUint32(),v=ew(new Uint8Array(p.buffer,p.byteOffset+p.offset-o-4,o),o);if(v!==m)throw new Error(`CRC mismatch for chunk ${u}. Expected ${m}, found ${v}`)}function x0(p,o,u){for(let m=0;m<u;m++)o[m]=p[m]}function w0(p,o,u,m){let v=0;for(;v<m;v++)o[v]=p[v];for(;v<u;v++)o[v]=p[v]+o[v-m]&255}function S0(p,o,u,m){let v=0;if(u.length===0)for(;v<m;v++)o[v]=p[v];else for(;v<m;v++)o[v]=p[v]+u[v]&255}function T0(p,o,u,m,v){let x=0;if(u.length===0){for(;x<v;x++)o[x]=p[x];for(;x<m;x++)o[x]=p[x]+(o[x-v]>>1)&255}else{for(;x<v;x++)o[x]=p[x]+(u[x]>>1)&255;for(;x<m;x++)o[x]=p[x]+(o[x-v]+u[x]>>1)&255}}function P0(p,o,u,m,v){let x=0;if(u.length===0){for(;x<v;x++)o[x]=p[x];for(;x<m;x++)o[x]=p[x]+o[x-v]&255}else{for(;x<v;x++)o[x]=p[x]+u[x]&255;for(;x<m;x++)o[x]=p[x]+tw(o[x-v],u[x],u[x-v])&255}}function tw(p,o,u){const m=p+o-u,v=Math.abs(m-p),x=Math.abs(m-o),b=Math.abs(m-u);return v<=x&&v<=b?p:x<=b?o:u}function rw(p,o,u,m,v,x){switch(p){case 0:x0(o,u,v);break;case 1:w0(o,u,v,x);break;case 2:S0(o,u,m,v);break;case 3:T0(o,u,m,v,x);break;case 4:P0(o,u,m,v,x);break;default:throw new Error(`Unsupported filter: ${p}`)}}const iw=new Uint16Array([255]),nw=new Uint8Array(iw.buffer),sw=nw[0]===255;function aw(p){const{data:o,width:u,height:m,channels:v,depth:x}=p,b=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],a=Math.ceil(x/8)*v,C=new Uint8Array(m*u*a);let F=0;for(let O=0;O<7;O++){const Y=b[O],ee=Math.ceil((u-Y.x)/Y.xStep),j=Math.ceil((m-Y.y)/Y.yStep);if(ee<=0||j<=0)continue;const Pe=ee*a,ce=new Uint8Array(Pe);for(let Q=0;Q<j;Q++){const ge=o[F++],Qe=o.subarray(F,F+Pe);F+=Pe;const Oe=new Uint8Array(Pe);rw(ge,Qe,Oe,ce,Pe,a),ce.set(Oe);for(let Me=0;Me<ee;Me++){const Ge=Y.x+Me*Y.xStep,Ze=Y.y+Q*Y.yStep;if(!(Ge>=u||Ze>=m))for(let it=0;it<a;it++)C[(Ze*u+Ge)*a+it]=Oe[Me*a+it]}}}if(x===16){const O=new Uint16Array(C.buffer);if(sw)for(let Y=0;Y<O.length;Y++)O[Y]=ow(O[Y]);return O}else return C}function ow(p){return(p&255)<<8|p>>8&255}const lw=new Uint16Array([255]),cw=new Uint8Array(lw.buffer),uw=cw[0]===255,hw=new Uint8Array(0);function hy(p){const{data:o,width:u,height:m,channels:v,depth:x}=p,b=Math.ceil(x/8)*v,a=Math.ceil(x/8*v*u),C=new Uint8Array(m*a);let F=hw,O=0,Y,ee;for(let j=0;j<m;j++){switch(Y=o.subarray(O+1,O+1+a),ee=C.subarray(j*a,(j+1)*a),o[O]){case 0:x0(Y,ee,a);break;case 1:w0(Y,ee,a,b);break;case 2:S0(Y,ee,F,a);break;case 3:T0(Y,ee,F,a,b);break;case 4:P0(Y,ee,F,a,b);break;default:throw new Error(`Unsupported filter: ${o[O]}`)}F=ee,O+=a+1}if(x===16){const j=new Uint16Array(C.buffer);if(uw)for(let Pe=0;Pe<j.length;Pe++)j[Pe]=dw(j[Pe]);return j}else return C}function dw(p){return(p&255)<<8|p>>8&255}const jd=Uint8Array.of(137,80,78,71,13,10,26,10);function dy(p){if(!fw(p.readBytes(jd.length)))throw new Error("wrong PNG signature")}function fw(p){if(p.length<jd.length)return!1;for(let o=0;o<jd.length;o++)if(p[o]!==jd[o])return!1;return!0}const pw="tEXt",mw=0,A0=new TextDecoder("latin1");function gw(p){if(yw(p),p.length===0||p.length>79)throw new Error("keyword length must be between 1 and 79")}const _w=/^[\u0000-\u00FF]*$/;function yw(p){if(!_w.test(p))throw new Error("invalid latin1 text")}function vw(p,o,u){const m=I0(o);p[m]=bw(o,u-m.length-1)}function I0(p){for(p.mark();p.readByte()!==mw;);const o=p.offset;p.reset();const u=A0.decode(p.readBytes(o-p.offset-1));return p.skip(1),gw(u),u}function bw(p,o){return A0.decode(p.readBytes(o))}const Ka={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},vp={UNKNOWN:-1,DEFLATE:0},fy={UNKNOWN:-1,ADAPTIVE:0},bp={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},Dd={NONE:0,BACKGROUND:1,PREVIOUS:2},xp={SOURCE:0,OVER:1};class xw extends Xp{_checkCrc;_inflator;_png;_apng;_end;_hasPalette;_palette;_hasTransparency;_transparency;_compressionMethod;_filterMethod;_interlaceMethod;_colorType;_isAnimated;_numberOfFrames;_numberOfPlays;_frames;_writingDataChunks;constructor(o,u={}){super(o);const{checkCrc:m=!1}=u;this._checkCrc=m,this._inflator=new ly,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=vp.UNKNOWN,this._filterMethod=fy.UNKNOWN,this._interlaceMethod=bp.UNKNOWN,this._colorType=Ka.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(dy(this);!this._end;){const o=this.readUint32(),u=this.readChars(4);this.decodeChunk(o,u)}return this.decodeImage(),this._png}decodeApng(){for(dy(this);!this._end;){const o=this.readUint32(),u=this.readChars(4);this.decodeApngChunk(o,u)}return this.decodeApngImage(),this._apng}decodeChunk(o,u){const m=this.offset;switch(u){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(o);break;case"IDAT":this.decodeIDAT(o);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(o);break;case"iCCP":this.decodeiCCP(o);break;case pw:vw(this._png.text,this,o);break;case"pHYs":this.decodepHYs();break;default:this.skip(o);break}if(this.offset-m!==o)throw new Error(`Length mismatch while decoding chunk ${u}`);this._checkCrc?uy(this,o+4,u):this.skip(4)}decodeApngChunk(o,u){const m=this.offset;switch(u!=="fdAT"&&u!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),u){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(o);break;default:this.decodeChunk(o,u),this.offset=m+o;break}if(this.offset-m!==o)throw new Error(`Length mismatch while decoding chunk ${u}`);this._checkCrc?uy(this,o+4,u):this.skip(4)}decodeIHDR(){const o=this._png;o.width=this.readUint32(),o.height=this.readUint32(),o.depth=ww(this.readUint8());const u=this.readUint8();this._colorType=u;let m;switch(u){case Ka.GREYSCALE:m=1;break;case Ka.TRUECOLOUR:m=3;break;case Ka.INDEXED_COLOUR:m=1;break;case Ka.GREYSCALE_ALPHA:m=2;break;case Ka.TRUECOLOUR_ALPHA:m=4;break;case Ka.UNKNOWN:default:throw new Error(`Unknown color type: ${u}`)}if(this._png.channels=m,this._compressionMethod=this.readUint8(),this._compressionMethod!==vp.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const o={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(o)}decodePLTE(o){if(o%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${o}`);const u=o/3;this._hasPalette=!0;const m=[];this._palette=m;for(let v=0;v<u;v++)m.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(o){this._writingDataChunks=!0;const u=o,m=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,m,u)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(o)}decodeFDAT(o){this._writingDataChunks=!0;let u=o,m=this.offset+this.byteOffset;if(m+=4,u-=4,this._inflator.push(new Uint8Array(this.buffer,m,u)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(o)}decodetRNS(o){switch(this._colorType){case Ka.GREYSCALE:case Ka.TRUECOLOUR:{if(o%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${o}`);if(o/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${o/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(o/2);for(let u=0;u<o/2;u++)this._transparency[u]=this.readUint16();break}case Ka.INDEXED_COLOUR:{if(o>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${o} vs ${this._palette.length})`);let u=0;for(;u<o;u++){const m=this.readByte();this._palette[u].push(m)}for(;u<this._palette.length;u++)this._palette[u].push(255);break}case Ka.UNKNOWN:case Ka.GREYSCALE_ALPHA:case Ka.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(o){const u=I0(this),m=this.readUint8();if(m!==vp.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${m}`);const v=this.readBytes(o-u.length-2);this._png.iccEmbeddedProfile={name:u,profile:Kx(v)}}decodepHYs(){const o=this.readUint32(),u=this.readUint32(),m=this.readByte();this._png.resolution={x:o,y:u,unit:m}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let o=0;o<this._numberOfFrames;o++){const u={sequenceNumber:this._frames[o].sequenceNumber,delayNumber:this._frames[o].delayNumber,delayDenominator:this._frames[o].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},m=this._frames.at(o);if(m){if(m.data=hy({data:m.data,width:m.width,height:m.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),o===0||m.xOffset===0&&m.yOffset===0&&m.width===this._png.width&&m.height===this._png.height)u.data=m.data;else{const v=this._apng.frames.at(o-1);this.disposeFrame(m,v,u),this.addFrameDataToCanvas(u,m)}this._apng.frames.push(u)}}return this._apng}disposeFrame(o,u,m){switch(o.disposeOp){case Dd.NONE:break;case Dd.BACKGROUND:for(let v=0;v<this._png.height;v++)for(let x=0;x<this._png.width;x++){const b=(v*o.width+x)*this._png.channels;for(let a=0;a<this._png.channels;a++)m.data[b+a]=0}break;case Dd.PREVIOUS:m.data.set(u.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(o,u){const m=1<<this._png.depth,v=(x,b)=>{const a=((x+u.yOffset)*this._png.width+u.xOffset+b)*this._png.channels,C=(x*u.width+b)*this._png.channels;return{index:a,frameIndex:C}};switch(u.blendOp){case xp.SOURCE:for(let x=0;x<u.height;x++)for(let b=0;b<u.width;b++){const{index:a,frameIndex:C}=v(x,b);for(let F=0;F<this._png.channels;F++)o.data[a+F]=u.data[C+F]}break;case xp.OVER:for(let x=0;x<u.height;x++)for(let b=0;b<u.width;b++){const{index:a,frameIndex:C}=v(x,b);for(let F=0;F<this._png.channels;F++){const O=u.data[C+this._png.channels-1]/m,Y=F%(this._png.channels-1)===0?1:u.data[C+F],ee=Math.floor(O*Y+(1-O)*o.data[a+F]);o.data[a+F]+=ee}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const o=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(this._filterMethod!==fy.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===bp.NO_INTERLACE)this._png.data=hy({data:o,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===bp.ADAM7)this._png.data=aw({data:o,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const o=this._inflator.result,u=this._frames.at(-1);u?u.data=o:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:Dd.NONE,blendOp:xp.SOURCE,data:o}),this._inflator=new ly,this._writingDataChunks=!1}}function ww(p){if(p!==1&&p!==2&&p!==4&&p!==8&&p!==16)throw new Error(`invalid bit depth: ${p}`);return p}var py;(function(p){p[p.UNKNOWN=0]="UNKNOWN",p[p.METRE=1]="METRE"})(py||(py={}));function Sw(p,o){return new xw(p,o).decode()}var ti=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function wp(){ti.console&&typeof ti.console.log=="function"&&ti.console.log.apply(ti.console,arguments)}var nn={log:wp,warn:function(p){ti.console&&(typeof ti.console.warn=="function"?ti.console.warn.apply(ti.console,arguments):wp.call(null,arguments))},error:function(p){ti.console&&(typeof ti.console.error=="function"?ti.console.error.apply(ti.console,arguments):wp(p))}};function Sp(p,o,u){var m=new XMLHttpRequest;m.open("GET",p),m.responseType="blob",m.onload=function(){vu(m.response,o,u)},m.onerror=function(){nn.error("could not download file")},m.send()}function my(p){var o=new XMLHttpRequest;o.open("HEAD",p,!1);try{o.send()}catch{}return o.status>=200&&o.status<=299}function Fd(p){try{p.dispatchEvent(new MouseEvent("click"))}catch{var o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),p.dispatchEvent(o)}}var vu=ti.saveAs||((typeof window>"u"?"undefined":$i(window))!=="object"||window!==ti?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(p,o,u){var m=ti.URL||ti.webkitURL,v=document.createElement("a");o=o||p.name||"download",v.download=o,v.rel="noopener",typeof p=="string"?(v.href=p,v.origin!==location.origin?my(v.href)?Sp(p,o,u):Fd(v,v.target="_blank"):Fd(v)):(v.href=m.createObjectURL(p),setTimeout(function(){m.revokeObjectURL(v.href)},4e4),setTimeout(function(){Fd(v)},0))}:"msSaveOrOpenBlob"in navigator?function(p,o,u){if(o=o||p.name||"download",typeof p=="string")if(my(p))Sp(p,o,u);else{var m=document.createElement("a");m.href=p,m.target="_blank",setTimeout(function(){Fd(m)})}else navigator.msSaveOrOpenBlob(function(v,x){return x===void 0?x={autoBom:!1}:$i(x)!=="object"&&(nn.warn("Deprecated: Expected third argument to be a object"),x={autoBom:!x}),x.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(v.type)?new Blob(["\uFEFF",v],{type:v.type}):v}(p,u),o)}:function(p,o,u,m){if((m=m||open("","_blank"))&&(m.document.title=m.document.body.innerText="downloading..."),typeof p=="string")return Sp(p,o,u);var v=p.type==="application/octet-stream",x=/constructor/i.test(ti.HTMLElement)||ti.safari,b=/CriOS\/[\d]+/.test(navigator.userAgent);if((b||v&&x)&&(typeof FileReader>"u"?"undefined":$i(FileReader))==="object"){var a=new FileReader;a.onloadend=function(){var O=a.result;O=b?O:O.replace(/^data:[^;]*;/,"data:attachment/file;"),m?m.location.href=O:location=O,m=null},a.readAsDataURL(p)}else{var C=ti.URL||ti.webkitURL,F=C.createObjectURL(p);m?m.location=F:location.href=F,m=null,setTimeout(function(){C.revokeObjectURL(F)},4e4)}});function E0(p){var o;p=p||"",this.ok=!1,p.charAt(0)=="#"&&(p=p.substr(1,6)),p={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[p=(p=p.replace(/ /g,"")).toLowerCase()]||p;for(var u=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(a){return[parseInt(a[1]),parseInt(a[2]),parseInt(a[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}}],m=0;m<u.length;m++){var v=u[m].re,x=u[m].process,b=v.exec(p);b&&(o=x(b),this.r=o[0],this.g=o[1],this.b=o[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var a=this.r.toString(16),C=this.g.toString(16),F=this.b.toString(16);return a.length==1&&(a="0"+a),C.length==1&&(C="0"+C),F.length==1&&(F="0"+F),"#"+a+C+F}}var Ud=ti.atob.bind(ti),gy=ti.btoa.bind(ti);function Tp(p,o){var u=p[0],m=p[1],v=p[2],x=p[3];u=ea(u,m,v,x,o[0],7,-680876936),x=ea(x,u,m,v,o[1],12,-389564586),v=ea(v,x,u,m,o[2],17,606105819),m=ea(m,v,x,u,o[3],22,-1044525330),u=ea(u,m,v,x,o[4],7,-176418897),x=ea(x,u,m,v,o[5],12,1200080426),v=ea(v,x,u,m,o[6],17,-1473231341),m=ea(m,v,x,u,o[7],22,-45705983),u=ea(u,m,v,x,o[8],7,1770035416),x=ea(x,u,m,v,o[9],12,-1958414417),v=ea(v,x,u,m,o[10],17,-42063),m=ea(m,v,x,u,o[11],22,-1990404162),u=ea(u,m,v,x,o[12],7,1804603682),x=ea(x,u,m,v,o[13],12,-40341101),v=ea(v,x,u,m,o[14],17,-1502002290),u=ta(u,m=ea(m,v,x,u,o[15],22,1236535329),v,x,o[1],5,-165796510),x=ta(x,u,m,v,o[6],9,-1069501632),v=ta(v,x,u,m,o[11],14,643717713),m=ta(m,v,x,u,o[0],20,-373897302),u=ta(u,m,v,x,o[5],5,-701558691),x=ta(x,u,m,v,o[10],9,38016083),v=ta(v,x,u,m,o[15],14,-660478335),m=ta(m,v,x,u,o[4],20,-405537848),u=ta(u,m,v,x,o[9],5,568446438),x=ta(x,u,m,v,o[14],9,-1019803690),v=ta(v,x,u,m,o[3],14,-187363961),m=ta(m,v,x,u,o[8],20,1163531501),u=ta(u,m,v,x,o[13],5,-1444681467),x=ta(x,u,m,v,o[2],9,-51403784),v=ta(v,x,u,m,o[7],14,1735328473),u=ra(u,m=ta(m,v,x,u,o[12],20,-1926607734),v,x,o[5],4,-378558),x=ra(x,u,m,v,o[8],11,-2022574463),v=ra(v,x,u,m,o[11],16,1839030562),m=ra(m,v,x,u,o[14],23,-35309556),u=ra(u,m,v,x,o[1],4,-1530992060),x=ra(x,u,m,v,o[4],11,1272893353),v=ra(v,x,u,m,o[7],16,-155497632),m=ra(m,v,x,u,o[10],23,-1094730640),u=ra(u,m,v,x,o[13],4,681279174),x=ra(x,u,m,v,o[0],11,-358537222),v=ra(v,x,u,m,o[3],16,-722521979),m=ra(m,v,x,u,o[6],23,76029189),u=ra(u,m,v,x,o[9],4,-640364487),x=ra(x,u,m,v,o[12],11,-421815835),v=ra(v,x,u,m,o[15],16,530742520),u=ia(u,m=ra(m,v,x,u,o[2],23,-995338651),v,x,o[0],6,-198630844),x=ia(x,u,m,v,o[7],10,1126891415),v=ia(v,x,u,m,o[14],15,-1416354905),m=ia(m,v,x,u,o[5],21,-57434055),u=ia(u,m,v,x,o[12],6,1700485571),x=ia(x,u,m,v,o[3],10,-1894986606),v=ia(v,x,u,m,o[10],15,-1051523),m=ia(m,v,x,u,o[1],21,-2054922799),u=ia(u,m,v,x,o[8],6,1873313359),x=ia(x,u,m,v,o[15],10,-30611744),v=ia(v,x,u,m,o[6],15,-1560198380),m=ia(m,v,x,u,o[13],21,1309151649),u=ia(u,m,v,x,o[4],6,-145523070),x=ia(x,u,m,v,o[11],10,-1120210379),v=ia(v,x,u,m,o[2],15,718787259),m=ia(m,v,x,u,o[9],21,-343485551),p[0]=$c(u,p[0]),p[1]=$c(m,p[1]),p[2]=$c(v,p[2]),p[3]=$c(x,p[3])}function ef(p,o,u,m,v,x){return o=$c($c(o,p),$c(m,x)),$c(o<<v|o>>>32-v,u)}function ea(p,o,u,m,v,x,b){return ef(o&u|~o&m,p,o,v,x,b)}function ta(p,o,u,m,v,x,b){return ef(o&m|u&~m,p,o,v,x,b)}function ra(p,o,u,m,v,x,b){return ef(o^u^m,p,o,v,x,b)}function ia(p,o,u,m,v,x,b){return ef(u^(o|~m),p,o,v,x,b)}function L0(p){var o,u=p.length,m=[1732584193,-271733879,-1732584194,271733878];for(o=64;o<=p.length;o+=64)Tp(m,Tw(p.substring(o-64,o)));p=p.substring(o-64);var v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(o=0;o<p.length;o++)v[o>>2]|=p.charCodeAt(o)<<(o%4<<3);if(v[o>>2]|=128<<(o%4<<3),o>55)for(Tp(m,v),o=0;o<16;o++)v[o]=0;return v[14]=8*u,Tp(m,v),m}function Tw(p){var o,u=[];for(o=0;o<64;o+=4)u[o>>2]=p.charCodeAt(o)+(p.charCodeAt(o+1)<<8)+(p.charCodeAt(o+2)<<16)+(p.charCodeAt(o+3)<<24);return u}var _y="0123456789abcdef".split("");function Pw(p){for(var o="",u=0;u<4;u++)o+=_y[p>>8*u+4&15]+_y[p>>8*u&15];return o}function Aw(p){return String.fromCharCode(255&p,(65280&p)>>8,(16711680&p)>>16,(4278190080&p)>>24)}function Bp(p){return L0(p).map(Aw).join("")}var Iw=function(p){for(var o=0;o<p.length;o++)p[o]=Pw(p[o]);return p.join("")}(L0("hello"))!="5d41402abc4b2a76b9719d911017c592";function $c(p,o){if(Iw){var u=(65535&p)+(65535&o);return(p>>16)+(o>>16)+(u>>16)<<16|65535&u}return p+o&4294967295}function jp(p,o){var u,m,v,x;if(p!==u){for(var b=(v=p,x=1+(256/p.length|0),new Array(x+1).join(v)),a=[],C=0;C<256;C++)a[C]=C;var F=0;for(C=0;C<256;C++){var O=a[C];F=(F+O+b.charCodeAt(C))%256,a[C]=a[F],a[F]=O}u=p,m=a}else a=m;var Y=o.length,ee=0,j=0,Pe="";for(C=0;C<Y;C++)j=(j+(O=a[ee=(ee+1)%256]))%256,a[ee]=a[j],a[j]=O,b=a[(a[ee]+a[j])%256],Pe+=String.fromCharCode(o.charCodeAt(C)^b);return Pe}var yy={print:4,modify:8,copy:16,"annot-forms":32};function rh(p,o,u,m){this.v=1,this.r=2;var v=192;p.forEach(function(a){if(yy.perm!==void 0)throw new Error("Invalid permission: "+a);v+=yy[a]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var x=(o+this.padding).substr(0,32),b=(u+this.padding).substr(0,32);this.O=this.processOwnerPassword(x,b),this.P=-(1+(255^v)),this.encryptionKey=Bp(x+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(m)).substr(0,5),this.U=jp(this.encryptionKey,this.padding)}function ih(p){if(/[^\u0000-\u00ff]/.test(p))throw new Error("Invalid PDF Name Object: "+p+", Only accept ASCII characters.");for(var o="",u=p.length,m=0;m<u;m++){var v=p.charCodeAt(m);o+=v<33||v===35||v===37||v===40||v===41||v===47||v===60||v===62||v===91||v===93||v===123||v===125||v>126?"#"+("0"+v.toString(16)).slice(-2):p[m]}return o}function vy(p){if($i(p)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var o={};this.subscribe=function(u,m,v){if(v=v||!1,typeof u!="string"||typeof m!="function"||typeof v!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");o.hasOwnProperty(u)||(o[u]={});var x=Math.random().toString(35);return o[u][x]=[m,!!v],x},this.unsubscribe=function(u){for(var m in o)if(o[m][u])return delete o[m][u],Object.keys(o[m]).length===0&&delete o[m],!0;return!1},this.publish=function(u){if(o.hasOwnProperty(u)){var m=Array.prototype.slice.call(arguments,1),v=[];for(var x in o[u]){var b=o[u][x];try{b[0].apply(p,m)}catch(a){ti.console&&nn.error("jsPDF PubSub Error",a.message,a)}b[1]&&v.push(x)}v.length&&v.forEach(this.unsubscribe)}},this.getTopics=function(){return o}}function Hd(p){if(!(this instanceof Hd))return new Hd(p);var o="opacity,stroke-opacity".split(",");for(var u in p)p.hasOwnProperty(u)&&o.indexOf(u)>=0&&(this[u]=p[u]);this.id="",this.objectNumber=-1}function M0(p,o){this.gState=p,this.matrix=o,this.id="",this.objectNumber=-1}function bu(p,o,u,m,v){if(!(this instanceof bu))return new bu(p,o,u,m,v);this.type=p==="axial"?2:3,this.coords=o,this.colors=u,M0.call(this,m,v)}function ah(p,o,u,m,v){if(!(this instanceof ah))return new ah(p,o,u,m,v);this.boundingBox=p,this.xStep=o,this.yStep=u,this.stream="",this.cloneIndex=0,M0.call(this,m,v)}function qr(p){var o,u=typeof arguments[0]=="string"?arguments[0]:"p",m=arguments[1],v=arguments[2],x=arguments[3],b=[],a=1,C=16,F="S",O=null;$i(p=p||{})==="object"&&(u=p.orientation,m=p.unit||m,v=p.format||v,x=p.compress||p.compressPdf||x,(O=p.encryption||null)!==null&&(O.userPassword=O.userPassword||"",O.ownerPassword=O.ownerPassword||"",O.userPermissions=O.userPermissions||[]),a=typeof p.userUnit=="number"?Math.abs(p.userUnit):1,p.precision!==void 0&&(o=p.precision),p.floatPrecision!==void 0&&(C=p.floatPrecision),F=p.defaultPathOperation||"S"),b=p.filters||(x===!0?["FlateEncode"]:b),m=m||"mm",u=(""+(u||"P")).toLowerCase();var Y=p.putOnlyUsedFonts||!1,ee={},j={internal:{},__private__:{}};j.__private__.PubSub=vy;var Pe="1.3",ce=j.__private__.getPdfVersion=function(){return Pe};j.__private__.setPdfVersion=function(z){Pe=z};var Q={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};j.__private__.getPageFormats=function(){return Q};var ge=j.__private__.getPageFormat=function(z){return Q[z]};v=v||"a4";var Qe="compat",Oe="advanced",Me=Qe;function Ge(){this.saveGraphicsState(),Ue(new Mt(Ie,0,0,-Ie,0,Dn()*Ie).toString()+" cm"),this.setFontSize(this.getFontSize()/Ie),F="n",Me=Oe}function Ze(){this.restoreGraphicsState(),F="S",Me=Qe}var it=j.__private__.combineFontStyleAndFontWeight=function(z,ie){if(z=="bold"&&ie=="normal"||z=="bold"&&ie==400||z=="normal"&&ie=="italic"||z=="bold"&&ie=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return ie&&(z=ie==400||ie==="normal"?z==="italic"?"italic":"normal":ie!=700&&ie!=="bold"||z!=="normal"?(ie==700?"bold":ie)+""+z:"bold"),z};j.advancedAPI=function(z){var ie=Me===Qe;return ie&&Ge.call(this),typeof z!="function"||(z(this),ie&&Ze.call(this)),this},j.compatAPI=function(z){var ie=Me===Oe;return ie&&Ze.call(this),typeof z!="function"||(z(this),ie&&Ge.call(this)),this},j.isAdvancedAPI=function(){return Me===Oe};var He,Te=function(z){if(Me!==Oe)throw new Error(z+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},st=j.roundToPrecision=j.__private__.roundToPrecision=function(z,ie){var ze=o||ie;if(isNaN(z)||isNaN(ze))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return z.toFixed(ze).replace(/0+$/,"")};He=j.hpf=j.__private__.hpf=typeof C=="number"?function(z){if(isNaN(z))throw new Error("Invalid argument passed to jsPDF.hpf");return st(z,C)}:C==="smart"?function(z){if(isNaN(z))throw new Error("Invalid argument passed to jsPDF.hpf");return st(z,z>-1&&z<1?16:5)}:function(z){if(isNaN(z))throw new Error("Invalid argument passed to jsPDF.hpf");return st(z,16)};var me=j.f2=j.__private__.f2=function(z){if(isNaN(z))throw new Error("Invalid argument passed to jsPDF.f2");return st(z,2)},xe=j.__private__.f3=function(z){if(isNaN(z))throw new Error("Invalid argument passed to jsPDF.f3");return st(z,3)},Xe=j.scale=j.__private__.scale=function(z){if(isNaN(z))throw new Error("Invalid argument passed to jsPDF.scale");return Me===Qe?z*Ie:Me===Oe?z:void 0},Ye=function(z){return Xe(function(ie){return Me===Qe?Dn()-ie:Me===Oe?ie:void 0}(z))};j.__private__.setPrecision=j.setPrecision=function(z){typeof parseInt(z,10)=="number"&&(o=parseInt(z,10))};var At,Dt="00000000000000000000000000000000",kt=j.__private__.getFileId=function(){return Dt},yt=j.__private__.setFileId=function(z){return Dt=z!==void 0&&/^[a-fA-F0-9]{32}$/.test(z)?z.toUpperCase():Dt.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),O!==null&&(sn=new rh(O.userPermissions,O.userPassword,O.ownerPassword,Dt)),Dt};j.setFileId=function(z){return yt(z),this},j.getFileId=function(){return kt()};var vt=j.__private__.convertDateToPDFDate=function(z){var ie=z.getTimezoneOffset(),ze=ie<0?"+":"-",rt=Math.floor(Math.abs(ie/60)),mt=Math.abs(ie%60),Gt=[ze,$e(rt),"'",$e(mt),"'"].join("");return["D:",z.getFullYear(),$e(z.getMonth()+1),$e(z.getDate()),$e(z.getHours()),$e(z.getMinutes()),$e(z.getSeconds()),Gt].join("")},sr=j.__private__.convertPDFDateToDate=function(z){var ie=parseInt(z.substr(2,4),10),ze=parseInt(z.substr(6,2),10)-1,rt=parseInt(z.substr(8,2),10),mt=parseInt(z.substr(10,2),10),Gt=parseInt(z.substr(12,2),10),tr=parseInt(z.substr(14,2),10);return new Date(ie,ze,rt,mt,Gt,tr,0)},Zt=j.__private__.setCreationDate=function(z){var ie;if(z===void 0&&(z=new Date),z instanceof Date)ie=vt(z);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(z))throw new Error("Invalid argument passed to jsPDF.setCreationDate");ie=z}return At=ie},he=j.__private__.getCreationDate=function(z){var ie=At;return z==="jsDate"&&(ie=sr(At)),ie};j.setCreationDate=function(z){return Zt(z),this},j.getCreationDate=function(z){return he(z)};var Fe,$e=j.__private__.padd2=function(z){return("0"+parseInt(z)).slice(-2)},tt=j.__private__.padd2Hex=function(z){return("00"+(z=z.toString())).substr(z.length)},ct=0,ut=[],pt=[],wt=0,Bt=[],er=[],ur=!1,fr=pt;j.__private__.setCustomOutputDestination=function(z){ur=!0,fr=z};var Ft=function(z){ur||(fr=z)};j.__private__.resetCustomOutputDestination=function(){ur=!1,fr=pt};var Ue=j.__private__.out=function(z){return z=z.toString(),wt+=z.length+1,fr.push(z),fr},Yr=j.__private__.write=function(z){return Ue(arguments.length===1?z.toString():Array.prototype.join.call(arguments," "))},wr=j.__private__.getArrayBuffer=function(z){for(var ie=z.length,ze=new ArrayBuffer(ie),rt=new Uint8Array(ze);ie--;)rt[ie]=z.charCodeAt(ie);return ze},Tr=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];j.__private__.getStandardFonts=function(){return Tr};var ir=p.fontSize||16;j.__private__.setFontSize=j.setFontSize=function(z){return ir=Me===Oe?z/Ie:z,this};var Ar,mr=j.__private__.getFontSize=j.getFontSize=function(){return Me===Qe?ir:ir*Ie},Vr=p.R2L||!1;j.__private__.setR2L=j.setR2L=function(z){return Vr=z,this},j.__private__.getR2L=j.getR2L=function(){return Vr};var Lr,ai=j.__private__.setZoomMode=function(z){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(z))Ar=z;else if(isNaN(z)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(z)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+z+'" is not recognized.');Ar=z}else Ar=parseInt(z,10)};j.__private__.getZoomMode=function(){return Ar};var Rr,nt=j.__private__.setPageMode=function(z){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(z)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+z+'" is not recognized.');Lr=z};j.__private__.getPageMode=function(){return Lr};var re=j.__private__.setLayoutMode=function(z){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(z)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+z+'" is not recognized.');Rr=z};j.__private__.getLayoutMode=function(){return Rr},j.__private__.setDisplayMode=j.setDisplayMode=function(z,ie,ze){return ai(z),re(ie),nt(ze),this};var K={title:"",subject:"",author:"",keywords:"",creator:""};j.__private__.getDocumentProperty=function(z){if(Object.keys(K).indexOf(z)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return K[z]},j.__private__.getDocumentProperties=function(){return K},j.__private__.setDocumentProperties=j.setProperties=j.setDocumentProperties=function(z){for(var ie in K)K.hasOwnProperty(ie)&&z[ie]&&(K[ie]=z[ie]);return this},j.__private__.setDocumentProperty=function(z,ie){if(Object.keys(K).indexOf(z)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return K[z]=ie};var se,Ie,Ce,ht,at,Be={},ot={},Rt=[],te={},I={},D={},fe={},Ee=null,qe=0,ae=[],ft=new vy(j),Nt=p.hotfixes||[],gt={},Lt={},Ht=[],Mt=function z(ie,ze,rt,mt,Gt,tr){if(!(this instanceof z))return new z(ie,ze,rt,mt,Gt,tr);isNaN(ie)&&(ie=1),isNaN(ze)&&(ze=0),isNaN(rt)&&(rt=0),isNaN(mt)&&(mt=1),isNaN(Gt)&&(Gt=0),isNaN(tr)&&(tr=0),this._matrix=[ie,ze,rt,mt,Gt,tr]};Object.defineProperty(Mt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(z){this._matrix[0]=z}}),Object.defineProperty(Mt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(z){this._matrix[1]=z}}),Object.defineProperty(Mt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(z){this._matrix[2]=z}}),Object.defineProperty(Mt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(z){this._matrix[3]=z}}),Object.defineProperty(Mt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(z){this._matrix[4]=z}}),Object.defineProperty(Mt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(z){this._matrix[5]=z}}),Object.defineProperty(Mt.prototype,"a",{get:function(){return this._matrix[0]},set:function(z){this._matrix[0]=z}}),Object.defineProperty(Mt.prototype,"b",{get:function(){return this._matrix[1]},set:function(z){this._matrix[1]=z}}),Object.defineProperty(Mt.prototype,"c",{get:function(){return this._matrix[2]},set:function(z){this._matrix[2]=z}}),Object.defineProperty(Mt.prototype,"d",{get:function(){return this._matrix[3]},set:function(z){this._matrix[3]=z}}),Object.defineProperty(Mt.prototype,"e",{get:function(){return this._matrix[4]},set:function(z){this._matrix[4]=z}}),Object.defineProperty(Mt.prototype,"f",{get:function(){return this._matrix[5]},set:function(z){this._matrix[5]=z}}),Object.defineProperty(Mt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Mt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Mt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Mt.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Mt.prototype.join=function(z){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(He).join(z)},Mt.prototype.multiply=function(z){var ie=z.sx*this.sx+z.shy*this.shx,ze=z.sx*this.shy+z.shy*this.sy,rt=z.shx*this.sx+z.sy*this.shx,mt=z.shx*this.shy+z.sy*this.sy,Gt=z.tx*this.sx+z.ty*this.shx+this.tx,tr=z.tx*this.shy+z.ty*this.sy+this.ty;return new Mt(ie,ze,rt,mt,Gt,tr)},Mt.prototype.decompose=function(){var z=this.sx,ie=this.shy,ze=this.shx,rt=this.sy,mt=this.tx,Gt=this.ty,tr=Math.sqrt(z*z+ie*ie),Ir=(z/=tr)*ze+(ie/=tr)*rt;ze-=z*Ir,rt-=ie*Ir;var Dr=Math.sqrt(ze*ze+rt*rt);return Ir/=Dr,z*(rt/=Dr)<ie*(ze/=Dr)&&(z=-z,ie=-ie,Ir=-Ir,tr=-tr),{scale:new Mt(tr,0,0,Dr,0,0),translate:new Mt(1,0,0,1,mt,Gt),rotate:new Mt(z,ie,-ie,z,0,0),skew:new Mt(1,0,Ir,1,0,0)}},Mt.prototype.toString=function(z){return this.join(" ")},Mt.prototype.inversed=function(){var z=this.sx,ie=this.shy,ze=this.shx,rt=this.sy,mt=this.tx,Gt=this.ty,tr=1/(z*rt-ie*ze),Ir=rt*tr,Dr=-ie*tr,Mr=-ze*tr,$r=z*tr;return new Mt(Ir,Dr,Mr,$r,-Ir*mt-Mr*Gt,-Dr*mt-$r*Gt)},Mt.prototype.applyToPoint=function(z){var ie=z.x*this.sx+z.y*this.shx+this.tx,ze=z.x*this.shy+z.y*this.sy+this.ty;return new lo(ie,ze)},Mt.prototype.applyToRectangle=function(z){var ie=this.applyToPoint(z),ze=this.applyToPoint(new lo(z.x+z.w,z.y+z.h));return new No(ie.x,ie.y,ze.x-ie.x,ze.y-ie.y)},Mt.prototype.clone=function(){var z=this.sx,ie=this.shy,ze=this.shx,rt=this.sy,mt=this.tx,Gt=this.ty;return new Mt(z,ie,ze,rt,mt,Gt)},j.Matrix=Mt;var rr=j.matrixMult=function(z,ie){return ie.multiply(z)},Ut=new Mt(1,0,0,1,0,0);j.unitMatrix=j.identityMatrix=Ut;var gr=function(z,ie){if(!I[z]){var ze=(ie instanceof bu?"Sh":"P")+(Object.keys(te).length+1).toString(10);ie.id=ze,I[z]=ze,te[ze]=ie,ft.publish("addPattern",ie)}};j.ShadingPattern=bu,j.TilingPattern=ah,j.addShadingPattern=function(z,ie){return Te("addShadingPattern()"),gr(z,ie),this},j.beginTilingPattern=function(z){Te("beginTilingPattern()"),vi(z.boundingBox[0],z.boundingBox[1],z.boundingBox[2]-z.boundingBox[0],z.boundingBox[3]-z.boundingBox[1],z.matrix)},j.endTilingPattern=function(z,ie){Te("endTilingPattern()"),ie.stream=er[Fe].join(`
`),gr(z,ie),ft.publish("endTilingPattern",ie),Ht.pop().restore()};var Xr,ri=j.__private__.newObject=function(){var z=Ot();return kr(z,!0),z},Ot=j.__private__.newObjectDeferred=function(){return ct++,ut[ct]=function(){return wt},ct},kr=function(z,ie){return ie=typeof ie=="boolean"&&ie,ut[z]=wt,ie&&Ue(z+" 0 obj"),z},Fi=j.__private__.newAdditionalObject=function(){var z={objId:Ot(),content:""};return Bt.push(z),z},Ln=Ot(),Zi=Ot(),nr=j.__private__.decodeColorString=function(z){var ie=z.split(" ");if(ie.length!==2||ie[1]!=="g"&&ie[1]!=="G")ie.length!==5||ie[4]!=="k"&&ie[4]!=="K"||(ie=[(1-ie[0])*(1-ie[3]),(1-ie[1])*(1-ie[3]),(1-ie[2])*(1-ie[3]),"r"]);else{var ze=parseFloat(ie[0]);ie=[ze,ze,ze,"r"]}for(var rt="#",mt=0;mt<3;mt++)rt+=("0"+Math.floor(255*parseFloat(ie[mt])).toString(16)).slice(-2);return rt},Br=j.__private__.encodeColorString=function(z){var ie;typeof z=="string"&&(z={ch1:z});var ze=z.ch1,rt=z.ch2,mt=z.ch3,Gt=z.ch4,tr=z.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof ze=="string"&&ze.charAt(0)!=="#"){var Ir=new E0(ze);if(Ir.ok)ze=Ir.toHex();else if(!/^\d*\.?\d*$/.test(ze))throw new Error('Invalid color "'+ze+'" passed to jsPDF.encodeColorString.')}if(typeof ze=="string"&&/^#[0-9A-Fa-f]{3}$/.test(ze)&&(ze="#"+ze[1]+ze[1]+ze[2]+ze[2]+ze[3]+ze[3]),typeof ze=="string"&&/^#[0-9A-Fa-f]{6}$/.test(ze)){var Dr=parseInt(ze.substr(1),16);ze=Dr>>16&255,rt=Dr>>8&255,mt=255&Dr}if(rt===void 0||Gt===void 0&&ze===rt&&rt===mt)ie=typeof ze=="string"?ze+" "+tr[0]:z.precision===2?me(ze/255)+" "+tr[0]:xe(ze/255)+" "+tr[0];else if(Gt===void 0||$i(Gt)==="object"){if(Gt&&!isNaN(Gt.a)&&Gt.a===0)return["1.","1.","1.",tr[1]].join(" ");ie=typeof ze=="string"?[ze,rt,mt,tr[1]].join(" "):z.precision===2?[me(ze/255),me(rt/255),me(mt/255),tr[1]].join(" "):[xe(ze/255),xe(rt/255),xe(mt/255),tr[1]].join(" ")}else ie=typeof ze=="string"?[ze,rt,mt,Gt,tr[2]].join(" "):z.precision===2?[me(ze),me(rt),me(mt),me(Gt),tr[2]].join(" "):[xe(ze),xe(rt),xe(mt),xe(Gt),tr[2]].join(" ");return ie},Or=j.__private__.getFilters=function(){return b},Oi=j.__private__.putStream=function(z){var ie=(z=z||{}).data||"",ze=z.filters||Or(),rt=z.alreadyAppliedFilters||[],mt=z.addLength1||!1,Gt=ie.length,tr=z.objectId,Ir=function(si){return si};if(O!==null&&tr===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");O!==null&&(Ir=sn.encryptor(tr,0));var Dr={};ze===!0&&(ze=["FlateEncode"]);var Mr=z.additionalKeyValues||[],$r=(Dr=qr.API.processDataByFilters!==void 0?qr.API.processDataByFilters(ie,ze):{data:ie,reverseChain:[]}).reverseChain+(Array.isArray(rt)?rt.join(" "):rt.toString());if(Dr.data.length!==0&&(Mr.push({key:"Length",value:Dr.data.length}),mt===!0&&Mr.push({key:"Length1",value:Gt})),$r.length!=0)if($r.split("/").length-1==1)Mr.push({key:"Filter",value:$r});else{Mr.push({key:"Filter",value:"["+$r+"]"});for(var Ur=0;Ur<Mr.length;Ur+=1)if(Mr[Ur].key==="DecodeParms"){for(var Ai=[],hn=0;hn<Dr.reverseChain.split("/").length-1;hn+=1)Ai.push("null");Ai.push(Mr[Ur].value),Mr[Ur].value="["+Ai.join(" ")+"]"}}Ue("<<");for(var bi=0;bi<Mr.length;bi++)Ue("/"+Mr[bi].key+" "+Mr[bi].value);Ue(">>"),Dr.data.length!==0&&(Ue("stream"),Ue(Ir(Dr.data)),Ue("endstream"))},Bs=j.__private__.putPage=function(z){var ie=z.number,ze=z.data,rt=z.objId,mt=z.contentsObjId;kr(rt,!0),Ue("<</Type /Page"),Ue("/Parent "+z.rootDictionaryObjId+" 0 R"),Ue("/Resources "+z.resourceDictionaryObjId+" 0 R"),Ue("/MediaBox ["+parseFloat(He(z.mediaBox.bottomLeftX))+" "+parseFloat(He(z.mediaBox.bottomLeftY))+" "+He(z.mediaBox.topRightX)+" "+He(z.mediaBox.topRightY)+"]"),z.cropBox!==null&&Ue("/CropBox ["+He(z.cropBox.bottomLeftX)+" "+He(z.cropBox.bottomLeftY)+" "+He(z.cropBox.topRightX)+" "+He(z.cropBox.topRightY)+"]"),z.bleedBox!==null&&Ue("/BleedBox ["+He(z.bleedBox.bottomLeftX)+" "+He(z.bleedBox.bottomLeftY)+" "+He(z.bleedBox.topRightX)+" "+He(z.bleedBox.topRightY)+"]"),z.trimBox!==null&&Ue("/TrimBox ["+He(z.trimBox.bottomLeftX)+" "+He(z.trimBox.bottomLeftY)+" "+He(z.trimBox.topRightX)+" "+He(z.trimBox.topRightY)+"]"),z.artBox!==null&&Ue("/ArtBox ["+He(z.artBox.bottomLeftX)+" "+He(z.artBox.bottomLeftY)+" "+He(z.artBox.topRightX)+" "+He(z.artBox.topRightY)+"]"),typeof z.userUnit=="number"&&z.userUnit!==1&&Ue("/UserUnit "+z.userUnit),ft.publish("putPage",{objId:rt,pageContext:ae[ie],pageNumber:ie,page:ze}),Ue("/Contents "+mt+" 0 R"),Ue(">>"),Ue("endobj");var Gt=ze.join(`
`);return Me===Oe&&(Gt+=`
Q`),kr(mt,!0),Oi({data:Gt,filters:Or(),objectId:mt}),Ue("endobj"),rt},Mn=j.__private__.putPages=function(){var z,ie,ze=[];for(z=1;z<=qe;z++)ae[z].objId=Ot(),ae[z].contentsObjId=Ot();for(z=1;z<=qe;z++)ze.push(Bs({number:z,data:er[z],objId:ae[z].objId,contentsObjId:ae[z].contentsObjId,mediaBox:ae[z].mediaBox,cropBox:ae[z].cropBox,bleedBox:ae[z].bleedBox,trimBox:ae[z].trimBox,artBox:ae[z].artBox,userUnit:ae[z].userUnit,rootDictionaryObjId:Ln,resourceDictionaryObjId:Zi}));kr(Ln,!0),Ue("<</Type /Pages");var rt="/Kids [";for(ie=0;ie<qe;ie++)rt+=ze[ie]+" 0 R ";Ue(rt+"]"),Ue("/Count "+qe),Ue(">>"),Ue("endobj"),ft.publish("postPutPages")},Gr=function(z){ft.publish("putFont",{font:z,out:Ue,newObject:ri,putStream:Oi}),z.isAlreadyPutted!==!0&&(z.objectNumber=ri(),Ue("<<"),Ue("/Type /Font"),Ue("/BaseFont /"+ih(z.postScriptName)),Ue("/Subtype /Type1"),typeof z.encoding=="string"&&Ue("/Encoding /"+z.encoding),Ue("/FirstChar 32"),Ue("/LastChar 255"),Ue(">>"),Ue("endobj"))},ya=function(z){z.objectNumber=ri();var ie=[];ie.push({key:"Type",value:"/XObject"}),ie.push({key:"Subtype",value:"/Form"}),ie.push({key:"BBox",value:"["+[He(z.x),He(z.y),He(z.x+z.width),He(z.y+z.height)].join(" ")+"]"}),ie.push({key:"Matrix",value:"["+z.matrix.toString()+"]"});var ze=z.pages[1].join(`
`);Oi({data:ze,additionalKeyValues:ie,objectId:z.objectNumber}),Ue("endobj")},va=function(z,ie){ie||(ie=21);var ze=ri(),rt=function(tr,Ir){var Dr,Mr=[],$r=1/(Ir-1);for(Dr=0;Dr<1;Dr+=$r)Mr.push(Dr);if(Mr.push(1),tr[0].offset!=0){var Ur={offset:0,color:tr[0].color};tr.unshift(Ur)}if(tr[tr.length-1].offset!=1){var Ai={offset:1,color:tr[tr.length-1].color};tr.push(Ai)}for(var hn="",bi=0,si=0;si<Mr.length;si++){for(Dr=Mr[si];Dr>tr[bi+1].offset;)bi++;var dn=tr[bi].offset,Pn=(Dr-dn)/(tr[bi+1].offset-dn),Sa=tr[bi].color,co=tr[bi+1].color;hn+=tt(Math.round((1-Pn)*Sa[0]+Pn*co[0]).toString(16))+tt(Math.round((1-Pn)*Sa[1]+Pn*co[1]).toString(16))+tt(Math.round((1-Pn)*Sa[2]+Pn*co[2]).toString(16))}return hn.trim()}(z.colors,ie),mt=[];mt.push({key:"FunctionType",value:"0"}),mt.push({key:"Domain",value:"[0.0 1.0]"}),mt.push({key:"Size",value:"["+ie+"]"}),mt.push({key:"BitsPerSample",value:"8"}),mt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),mt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Oi({data:rt,additionalKeyValues:mt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:ze}),Ue("endobj"),z.objectNumber=ri(),Ue("<< /ShadingType "+z.type),Ue("/ColorSpace /DeviceRGB");var Gt="/Coords ["+He(parseFloat(z.coords[0]))+" "+He(parseFloat(z.coords[1]))+" ";z.type===2?Gt+=He(parseFloat(z.coords[2]))+" "+He(parseFloat(z.coords[3])):Gt+=He(parseFloat(z.coords[2]))+" "+He(parseFloat(z.coords[3]))+" "+He(parseFloat(z.coords[4]))+" "+He(parseFloat(z.coords[5])),Ue(Gt+="]"),z.matrix&&Ue("/Matrix ["+z.matrix.toString()+"]"),Ue("/Function "+ze+" 0 R"),Ue("/Extend [true true]"),Ue(">>"),Ue("endobj")},Ra=function(z,ie){var ze=Ot(),rt=ri();ie.push({resourcesOid:ze,objectOid:rt}),z.objectNumber=rt;var mt=[];mt.push({key:"Type",value:"/Pattern"}),mt.push({key:"PatternType",value:"1"}),mt.push({key:"PaintType",value:"1"}),mt.push({key:"TilingType",value:"1"}),mt.push({key:"BBox",value:"["+z.boundingBox.map(He).join(" ")+"]"}),mt.push({key:"XStep",value:He(z.xStep)}),mt.push({key:"YStep",value:He(z.yStep)}),mt.push({key:"Resources",value:ze+" 0 R"}),z.matrix&&mt.push({key:"Matrix",value:"["+z.matrix.toString()+"]"}),Oi({data:z.stream,additionalKeyValues:mt,objectId:z.objectNumber}),Ue("endobj")},to=function(z){for(var ie in z.objectNumber=ri(),Ue("<<"),z)switch(ie){case"opacity":Ue("/ca "+me(z[ie]));break;case"stroke-opacity":Ue("/CA "+me(z[ie]))}Ue(">>"),Ue("endobj")},za=function(z){kr(z.resourcesOid,!0),Ue("<<"),Ue("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),function(){for(var ie in Ue("/Font <<"),Be)Be.hasOwnProperty(ie)&&(Y===!1||Y===!0&&ee.hasOwnProperty(ie))&&Ue("/"+ie+" "+Be[ie].objectNumber+" 0 R");Ue(">>")}(),function(){if(Object.keys(te).length>0){for(var ie in Ue("/Shading <<"),te)te.hasOwnProperty(ie)&&te[ie]instanceof bu&&te[ie].objectNumber>=0&&Ue("/"+ie+" "+te[ie].objectNumber+" 0 R");ft.publish("putShadingPatternDict"),Ue(">>")}}(),function(ie){if(Object.keys(te).length>0){for(var ze in Ue("/Pattern <<"),te)te.hasOwnProperty(ze)&&te[ze]instanceof j.TilingPattern&&te[ze].objectNumber>=0&&te[ze].objectNumber<ie&&Ue("/"+ze+" "+te[ze].objectNumber+" 0 R");ft.publish("putTilingPatternDict"),Ue(">>")}}(z.objectOid),function(){if(Object.keys(D).length>0){var ie;for(ie in Ue("/ExtGState <<"),D)D.hasOwnProperty(ie)&&D[ie].objectNumber>=0&&Ue("/"+ie+" "+D[ie].objectNumber+" 0 R");ft.publish("putGStateDict"),Ue(">>")}}(),function(){for(var ie in Ue("/XObject <<"),gt)gt.hasOwnProperty(ie)&&gt[ie].objectNumber>=0&&Ue("/"+ie+" "+gt[ie].objectNumber+" 0 R");ft.publish("putXobjectDict"),Ue(">>")}(),Ue(">>"),Ue("endobj")},Na=function(z){ot[z.fontName]=ot[z.fontName]||{},ot[z.fontName][z.fontStyle]=z.id},ro=function(z,ie,ze,rt,mt){var Gt={id:"F"+(Object.keys(Be).length+1).toString(10),postScriptName:z,fontName:ie,fontStyle:ze,encoding:rt,isStandardFont:mt||!1,metadata:{}};return ft.publish("addFont",{font:Gt,instance:this}),Be[Gt.id]=Gt,Na(Gt),Gt.id},Bi=j.__private__.pdfEscape=j.pdfEscape=function(z,ie){return function(ze,rt){var mt,Gt,tr,Ir,Dr,Mr,$r,Ur,Ai;if(tr=(rt=rt||{}).sourceEncoding||"Unicode",Dr=rt.outputEncoding,(rt.autoencode||Dr)&&Be[se].metadata&&Be[se].metadata[tr]&&Be[se].metadata[tr].encoding&&(Ir=Be[se].metadata[tr].encoding,!Dr&&Be[se].encoding&&(Dr=Be[se].encoding),!Dr&&Ir.codePages&&(Dr=Ir.codePages[0]),typeof Dr=="string"&&(Dr=Ir[Dr]),Dr)){for($r=!1,Mr=[],mt=0,Gt=ze.length;mt<Gt;mt++)(Ur=Dr[ze.charCodeAt(mt)])?Mr.push(String.fromCharCode(Ur)):Mr.push(ze[mt]),Mr[mt].charCodeAt(0)>>8&&($r=!0);ze=Mr.join("")}for(mt=ze.length;$r===void 0&&mt!==0;)ze.charCodeAt(mt-1)>>8&&($r=!0),mt--;if(!$r)return ze;for(Mr=rt.noBOM?[]:[254,255],mt=0,Gt=ze.length;mt<Gt;mt++){if((Ai=(Ur=ze.charCodeAt(mt))>>8)>>8)throw new Error("Character at position "+mt+" of string '"+ze+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");Mr.push(Ai),Mr.push(Ur-(Ai<<8))}return String.fromCharCode.apply(void 0,Mr)}(z,ie).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},mi=j.__private__.beginPage=function(z){er[++qe]=[],ae[qe]={objId:0,contentsObjId:0,userUnit:Number(a),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(z[0]),topRightY:Number(z[1])}},io(qe),Ft(er[Fe])},ko=function(z,ie){var ze,rt,mt;switch(u=ie||u,typeof z=="string"&&(ze=ge(z.toLowerCase()),Array.isArray(ze)&&(rt=ze[0],mt=ze[1])),Array.isArray(z)&&(rt=z[0]*Ie,mt=z[1]*Ie),isNaN(rt)&&(rt=v[0],mt=v[1]),(rt>14400||mt>14400)&&(nn.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),rt=Math.min(14400,rt),mt=Math.min(14400,mt)),v=[rt,mt],u.substr(0,1)){case"l":mt>rt&&(v=[mt,rt]);break;case"p":rt>mt&&(v=[mt,rt])}mi(v),Cn(zo),Ue(aa),kn!==0&&Ue(kn+" J"),oa!==0&&Ue(oa+" j"),ft.publish("addPage",{pageNumber:qe})},ba=function(z){z>0&&z<=qe&&(er.splice(z,1),ae.splice(z,1),qe--,Fe>qe&&(Fe=qe),this.setPage(Fe))},io=function(z){z>0&&z<=qe&&(Fe=z)},xa=j.__private__.getNumberOfPages=j.getNumberOfPages=function(){return er.length-1},_s=function(z,ie,ze){var rt,mt=void 0;return ze=ze||{},z=z!==void 0?z:Be[se].fontName,ie=ie!==void 0?ie:Be[se].fontStyle,rt=z.toLowerCase(),ot[rt]!==void 0&&ot[rt][ie]!==void 0?mt=ot[rt][ie]:ot[z]!==void 0&&ot[z][ie]!==void 0?mt=ot[z][ie]:ze.disableWarning===!1&&nn.warn("Unable to look up font label for font '"+z+"', '"+ie+"'. Refer to getFontList() for available fonts."),mt||ze.noFallback||(mt=ot.times[ie])==null&&(mt=ot.times.normal),mt},Do=j.__private__.putInfo=function(){var z=ri(),ie=function(rt){return rt};for(var ze in O!==null&&(ie=sn.encryptor(z,0)),Ue("<<"),Ue("/Producer ("+Bi(ie("jsPDF "+qr.version))+")"),K)K.hasOwnProperty(ze)&&K[ze]&&Ue("/"+ze.substr(0,1).toUpperCase()+ze.substr(1)+" ("+Bi(ie(K[ze]))+")");Ue("/CreationDate ("+Bi(ie(At))+")"),Ue(">>"),Ue("endobj")},Oa=j.__private__.putCatalog=function(z){var ie=(z=z||{}).rootDictionaryObjId||Ln;switch(ri(),Ue("<<"),Ue("/Type /Catalog"),Ue("/Pages "+ie+" 0 R"),Ar||(Ar="fullwidth"),Ar){case"fullwidth":Ue("/OpenAction [3 0 R /FitH null]");break;case"fullheight":Ue("/OpenAction [3 0 R /FitV null]");break;case"fullpage":Ue("/OpenAction [3 0 R /Fit]");break;case"original":Ue("/OpenAction [3 0 R /XYZ null null 1]");break;default:var ze=""+Ar;ze.substr(ze.length-1)==="%"&&(Ar=parseInt(Ar)/100),typeof Ar=="number"&&Ue("/OpenAction [3 0 R /XYZ null null "+me(Ar)+"]")}switch(Rr||(Rr="continuous"),Rr){case"continuous":Ue("/PageLayout /OneColumn");break;case"single":Ue("/PageLayout /SinglePage");break;case"two":case"twoleft":Ue("/PageLayout /TwoColumnLeft");break;case"tworight":Ue("/PageLayout /TwoColumnRight")}Lr&&Ue("/PageMode /"+Lr),ft.publish("putCatalog"),Ue(">>"),Ue("endobj")},Ji=j.__private__.putTrailer=function(){Ue("trailer"),Ue("<<"),Ue("/Size "+(ct+1)),Ue("/Root "+ct+" 0 R"),Ue("/Info "+(ct-1)+" 0 R"),O!==null&&Ue("/Encrypt "+sn.oid+" 0 R"),Ue("/ID [ <"+Dt+"> <"+Dt+"> ]"),Ue(">>")},ji=j.__private__.putHeader=function(){Ue("%PDF-"+Pe),Ue("%")},Ol=j.__private__.putXRef=function(){var z="0000000000";Ue("xref"),Ue("0 "+(ct+1)),Ue("0000000000 65535 f ");for(var ie=1;ie<=ct;ie++)typeof ut[ie]=="function"?Ue((z+ut[ie]()).slice(-10)+" 00000 n "):ut[ie]!==void 0?Ue((z+ut[ie]).slice(-10)+" 00000 n "):Ue("0000000000 00000 n ")},wa=j.__private__.buildDocument=function(){var z;ct=0,wt=0,pt=[],ut=[],Bt=[],Ln=Ot(),Zi=Ot(),Ft(pt),ft.publish("buildDocument"),ji(),Mn(),function(){ft.publish("putAdditionalObjects");for(var ze=0;ze<Bt.length;ze++){var rt=Bt[ze];kr(rt.objId,!0),Ue(rt.content),Ue("endobj")}ft.publish("postPutAdditionalObjects")}(),z=[],function(){for(var ze in Be)Be.hasOwnProperty(ze)&&(Y===!1||Y===!0&&ee.hasOwnProperty(ze))&&Gr(Be[ze])}(),function(){var ze;for(ze in D)D.hasOwnProperty(ze)&&to(D[ze])}(),function(){for(var ze in gt)gt.hasOwnProperty(ze)&&ya(gt[ze])}(),function(ze){var rt;for(rt in te)te.hasOwnProperty(rt)&&(te[rt]instanceof bu?va(te[rt]):te[rt]instanceof ah&&Ra(te[rt],ze))}(z),ft.publish("putResources"),z.forEach(za),za({resourcesOid:Zi,objectOid:Number.MAX_SAFE_INTEGER}),ft.publish("postPutResources"),O!==null&&(sn.oid=ri(),Ue("<<"),Ue("/Filter /Standard"),Ue("/V "+sn.v),Ue("/R "+sn.r),Ue("/U <"+sn.toHexString(sn.U)+">"),Ue("/O <"+sn.toHexString(sn.O)+">"),Ue("/P "+sn.P),Ue(">>"),Ue("endobj")),Do(),Oa();var ie=wt;return Ol(),Ji(),Ue("startxref"),Ue(""+ie),Ue("%%EOF"),Ft(er[Fe]),pt.join(`
`)},na=j.__private__.getBlob=function(z){return new Blob([wr(z)],{type:"application/pdf"})},js=j.output=j.__private__.output=(Xr=function(z,ie){switch(typeof(ie=ie||{})=="string"?ie={filename:ie}:ie.filename=ie.filename||"generated.pdf",z){case void 0:return wa();case"save":j.save(ie.filename);break;case"arraybuffer":return wr(wa());case"blob":return na(wa());case"bloburi":case"bloburl":if(ti.URL!==void 0&&typeof ti.URL.createObjectURL=="function")return ti.URL&&ti.URL.createObjectURL(na(wa()))||void 0;nn.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var ze="",rt=wa();try{ze=gy(rt)}catch{ze=gy(unescape(encodeURIComponent(rt)))}return"data:application/pdf;filename="+ie.filename+";base64,"+ze;case"pdfobjectnewwindow":if(Object.prototype.toString.call(ti)==="[object Window]"){var mt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Gt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';ie.pdfObjectUrl&&(mt=ie.pdfObjectUrl,Gt="");var tr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+mt+'"'+Gt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(ie)+");<\/script></body></html>",Ir=ti.open();return Ir!==null&&Ir.document.write(tr),Ir}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(ti)==="[object Window]"){var Dr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(ie.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+ie.filename+'" width="500px" height="400px" /></body></html>',Mr=ti.open();if(Mr!==null){Mr.document.write(Dr);var $r=this;Mr.document.documentElement.querySelector("#pdfViewer").onload=function(){Mr.document.title=ie.filename,Mr.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open($r.output("bloburl"))}}return Mr}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(ti)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Ur='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",ie)+'"></iframe></body></html>',Ai=ti.open();if(Ai!==null&&(Ai.document.write(Ur),Ai.document.title=ie.filename),Ai||typeof safari>"u")return Ai;break;case"datauri":case"dataurl":return ti.document.location.href=this.output("datauristring",ie);default:return null}},Xr.foo=function(){try{return Xr.apply(this,arguments)}catch(ze){var z=ze.stack||"";~z.indexOf(" at ")&&(z=z.split(" at ")[1]);var ie="Error in function "+z.split(`
`)[0].split("<")[0]+": "+ze.message;if(!ti.console)throw new Error(ie);ti.console.error(ie,ze),ti.alert&&alert(ie)}},Xr.foo.bar=Xr,Xr.foo),no=function(z){return Array.isArray(Nt)===!0&&Nt.indexOf(z)>-1};switch(m){case"pt":Ie=1;break;case"mm":Ie=72/25.4;break;case"cm":Ie=72/2.54;break;case"in":Ie=72;break;case"px":Ie=no("px_scaling")==1?.75:96/72;break;case"pc":case"em":Ie=12;break;case"ex":Ie=6;break;default:if(typeof m!="number")throw new Error("Invalid unit: "+m);Ie=m}var sn=null;Zt(),yt();var so=j.__private__.getPageInfo=j.getPageInfo=function(z){if(isNaN(z)||z%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:ae[z].objId,pageNumber:z,pageContext:ae[z]}},Bl=j.__private__.getPageInfoByObjId=function(z){if(isNaN(z)||z%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var ie in ae)if(ae[ie].objId===z)break;return so(ie)},jl=j.__private__.getCurrentPageInfo=j.getCurrentPageInfo=function(){return{objId:ae[Fe].objId,pageNumber:Fe,pageContext:ae[Fe]}};j.addPage=function(){return ko.apply(this,arguments),this},j.setPage=function(){return io.apply(this,arguments),Ft.call(this,er[Fe]),this},j.insertPage=function(z){return this.addPage(),this.movePage(Fe,z),this},j.movePage=function(z,ie){var ze,rt;if(z>ie){ze=er[z],rt=ae[z];for(var mt=z;mt>ie;mt--)er[mt]=er[mt-1],ae[mt]=ae[mt-1];er[ie]=ze,ae[ie]=rt,this.setPage(ie)}else if(z<ie){ze=er[z],rt=ae[z];for(var Gt=z;Gt<ie;Gt++)er[Gt]=er[Gt+1],ae[Gt]=ae[Gt+1];er[ie]=ze,ae[ie]=rt,this.setPage(ie)}return this},j.deletePage=function(){return ba.apply(this,arguments),this},j.__private__.text=j.text=function(z,ie,ze,rt,mt){var Gt,tr,Ir,Dr,Mr,$r,Ur,Ai,hn,bi=(rt=rt||{}).scope||this;if(typeof z=="number"&&typeof ie=="number"&&(typeof ze=="string"||Array.isArray(ze))){var si=ze;ze=ie,ie=z,z=si}if(arguments[3]instanceof Mt==0?(Ir=arguments[4],Dr=arguments[5],$i(Ur=arguments[3])==="object"&&Ur!==null||(typeof Ir=="string"&&(Dr=Ir,Ir=null),typeof Ur=="string"&&(Dr=Ur,Ur=null),typeof Ur=="number"&&(Ir=Ur,Ur=null),rt={flags:Ur,angle:Ir,align:Dr})):(Te("The transform parameter of text() with a Matrix value"),hn=mt),isNaN(ie)||isNaN(ze)||z==null)throw new Error("Invalid arguments passed to jsPDF.text");if(z.length===0)return bi;var dn,Pn="",Sa=typeof rt.lineHeightFactor=="number"?rt.lineHeightFactor:Ro,co=bi.internal.scaleFactor;function uo(Ci){return Ci=Ci.split("	").join(Array(rt.TabLen||9).join(" ")),Bi(Ci,Ur)}function Oo(Ci){for(var Ii,Ri=Ci.concat(),Qi=[],qa=Ri.length;qa--;)typeof(Ii=Ri.shift())=="string"?Qi.push(Ii):Array.isArray(Ci)&&(Ii.length===1||Ii[1]===void 0&&Ii[2]===void 0)?Qi.push(Ii[0]):Qi.push([Ii[0],Ii[1],Ii[2]]);return Qi}function Hs(Ci,Ii){var Ri;if(typeof Ci=="string")Ri=Ii(Ci)[0];else if(Array.isArray(Ci)){for(var Qi,qa,Go=Ci.concat(),Ma=[],Gl=Go.length;Gl--;)typeof(Qi=Go.shift())=="string"?Ma.push(Ii(Qi)[0]):Array.isArray(Qi)&&typeof Qi[0]=="string"&&(qa=Ii(Qi[0],Qi[1],Qi[2]),Ma.push([qa[0],qa[1],qa[2]]));Ri=Ma}return Ri}var Ls=!1,Ba=!0;if(typeof z=="string")Ls=!0;else if(Array.isArray(z)){var la=z.concat();tr=[];for(var Ms,di=la.length;di--;)(typeof(Ms=la.shift())!="string"||Array.isArray(Ms)&&typeof Ms[0]!="string")&&(Ba=!1);Ls=Ba}if(Ls===!1)throw new Error('Type of text must be string or Array. "'+z+'" is not recognized.');typeof z=="string"&&(z=z.match(/[\r?\n]/)?z.split(/\r\n|\r|\n/g):[z]);var Ta=ir/bi.internal.scaleFactor,ys=Ta*(Sa-1);switch(rt.baseline){case"bottom":ze-=ys;break;case"top":ze+=Ta-ys;break;case"hanging":ze+=Ta-2*ys;break;case"middle":ze+=Ta/2-ys}if(($r=rt.maxWidth||0)>0&&(typeof z=="string"?z=bi.splitTextToSize(z,$r):Object.prototype.toString.call(z)==="[object Array]"&&(z=z.reduce(function(Ci,Ii){return Ci.concat(bi.splitTextToSize(Ii,$r))},[]))),Gt={text:z,x:ie,y:ze,options:rt,mutex:{pdfEscape:Bi,activeFontKey:se,fonts:Be,activeFontSize:ir}},ft.publish("preProcessText",Gt),z=Gt.text,Ir=(rt=Gt.options).angle,hn instanceof Mt==0&&Ir&&typeof Ir=="number"){Ir*=Math.PI/180,rt.rotationDirection===0&&(Ir=-Ir),Me===Oe&&(Ir=-Ir);var Pa=Math.cos(Ir),ca=Math.sin(Ir);hn=new Mt(Pa,ca,-ca,Pa,0,0)}else Ir&&Ir instanceof Mt&&(hn=Ir);Me!==Oe||hn||(hn=Ut),(Mr=rt.charSpace||os)!==void 0&&(Pn+=He(Xe(Mr))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(Ai=rt.horizontalScale)!==void 0&&(Pn+=He(100*Ai)+` Tz
`),rt.lang;var cs=-1,Bo=rt.renderingMode!==void 0?rt.renderingMode:rt.stroke,gl=bi.internal.getCurrentPageInfo().pageContext;switch(Bo){case 0:case!1:case"fill":cs=0;break;case 1:case!0:case"stroke":cs=1;break;case 2:case"fillThenStroke":cs=2;break;case 3:case"invisible":cs=3;break;case 4:case"fillAndAddForClipping":cs=4;break;case 5:case"strokeAndAddPathForClipping":cs=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":cs=6;break;case 7:case"addToPathForClipping":cs=7}var ja=gl.usedRenderingMode!==void 0?gl.usedRenderingMode:-1;cs!==-1?Pn+=cs+` Tr
`:ja!==-1&&(Pn+=`0 Tr
`),cs!==-1&&(gl.usedRenderingMode=cs),Dr=rt.align||"left";var fn,Cs=ir*Sa,_l=bi.internal.pageSize.getWidth(),jo=Be[se];Mr=rt.charSpace||os,$r=rt.maxWidth||0,Ur=Object.assign({autoencode:!0,noBOM:!0},rt.flags);var Aa=[],ho=function(Ci){return bi.getStringUnitWidth(Ci,{font:jo,charSpace:Mr,fontSize:ir,doKerning:!1})*ir/co};if(Object.prototype.toString.call(z)==="[object Array]"){var us;tr=Oo(z),Dr!=="left"&&(fn=tr.map(ho));var hs,fo=0;if(Dr==="right"){ie-=fn[0],z=[],di=tr.length;for(var Jn=0;Jn<di;Jn++)Jn===0?(hs=Yn(ie),us=Ki(ze)):(hs=Xe(fo-fn[Jn]),us=-Cs),z.push([tr[Jn],hs,us]),fo=fn[Jn]}else if(Dr==="center"){ie-=fn[0]/2,z=[],di=tr.length;for(var Ua=0;Ua<di;Ua++)Ua===0?(hs=Yn(ie),us=Ki(ze)):(hs=Xe((fo-fn[Ua])/2),us=-Cs),z.push([tr[Ua],hs,us]),fo=fn[Ua]}else if(Dr==="left"){z=[],di=tr.length;for(var Uo=0;Uo<di;Uo++)z.push(tr[Uo])}else if(Dr==="justify"&&jo.encoding==="Identity-H"){z=[],di=tr.length,$r=$r!==0?$r:_l;for(var ks=0,an=0;an<di;an++)if(us=an===0?Ki(ze):-Cs,hs=an===0?Yn(ie):ks,an<di-1){var yl=Xe(($r-fn[an])/(tr[an].split(" ").length-1)),Ia=tr[an].split(" ");z.push([Ia[0]+" ",hs,us]),ks=0;for(var Ea=1;Ea<Ia.length;Ea++){var Vo=(ho(Ia[Ea-1]+" "+Ia[Ea])-ho(Ia[Ea]))*co+yl;Ea==Ia.length-1?z.push([Ia[Ea],Vo,0]):z.push([Ia[Ea]+" ",Vo,0]),ks-=Vo}}else z.push([tr[an],hs,us]);z.push(["",ks,0])}else{if(Dr!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(z=[],di=tr.length,$r=$r!==0?$r:_l,an=0;an<di;an++)us=an===0?Ki(ze):-Cs,hs=an===0?Yn(ie):0,an<di-1?Aa.push(He(Xe(($r-fn[an])/(tr[an].split(" ").length-1)))):Aa.push(0),z.push([tr[an],hs,us])}}(typeof rt.R2L=="boolean"?rt.R2L:Vr)===!0&&(z=Hs(z,function(Ci,Ii,Ri){return[Ci.split("").reverse().join(""),Ii,Ri]})),Gt={text:z,x:ie,y:ze,options:rt,mutex:{pdfEscape:Bi,activeFontKey:se,fonts:Be,activeFontSize:ir}},ft.publish("postProcessText",Gt),z=Gt.text,dn=Gt.mutex.isHex||!1;var Va=Be[se].encoding;Va!=="WinAnsiEncoding"&&Va!=="StandardEncoding"||(z=Hs(z,function(Ci,Ii,Ri){return[uo(Ci),Ii,Ri]})),tr=Oo(z),z=[];for(var qo,po,mo,La=Array.isArray(tr[0])?1:0,An="",go=function(Ci,Ii,Ri){var Qi="";return Ri instanceof Mt?(Ri=typeof rt.angle=="number"?rr(Ri,new Mt(1,0,0,1,Ci,Ii)):rr(new Mt(1,0,0,1,Ci,Ii),Ri),Me===Oe&&(Ri=rr(new Mt(1,0,0,-1,0,0),Ri)),Qi=Ri.join(" ")+` Tm
`):Qi=He(Ci)+" "+He(Ii)+` Td
`,Qi},ds=0;ds<tr.length;ds++){switch(An="",La){case 1:mo=(dn?"<":"(")+tr[ds][0]+(dn?">":")"),qo=parseFloat(tr[ds][1]),po=parseFloat(tr[ds][2]);break;case 0:mo=(dn?"<":"(")+tr[ds]+(dn?">":")"),qo=Yn(ie),po=Ki(ze)}Aa!==void 0&&Aa[ds]!==void 0&&(An=Aa[ds]+` Tw
`),ds===0?z.push(An+go(qo,po,hn)+mo):La===0?z.push(An+mo):La===1&&z.push(An+go(qo,po,hn)+mo)}z=La===0?z.join(` Tj
T* `):z.join(` Tj
`),z+=` Tj
`;var Xs=`BT
/`;return Xs+=se+" "+ir+` Tf
`,Xs+=He(ir*Sa)+` TL
`,Xs+=Mi+`
`,Xs+=Pn,Xs+=z,Ue(Xs+="ET"),ee[se]=!0,bi};var Ul=j.__private__.clip=j.clip=function(z){return Ue(z==="evenodd"?"W*":"W"),this};j.clipEvenOdd=function(){return Ul("evenodd")},j.__private__.discardPath=j.discardPath=function(){return Ue("n"),this};var Us=j.__private__.isValidStyle=function(z){var ie=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(z)!==-1&&(ie=!0),ie};j.__private__.setDefaultPathOperation=j.setDefaultPathOperation=function(z){return Us(z)&&(F=z),this};var vc=j.__private__.getStyle=j.getStyle=function(z){var ie=F;switch(z){case"D":case"S":ie="S";break;case"F":ie="f";break;case"FD":case"DF":ie="B";break;case"f":case"f*":case"B":case"B*":ie=z}return ie},ao=j.close=function(){return Ue("h"),this};j.stroke=function(){return Ue("S"),this},j.fill=function(z){return sa("f",z),this},j.fillEvenOdd=function(z){return sa("f*",z),this},j.fillStroke=function(z){return sa("B",z),this},j.fillStrokeEvenOdd=function(z){return sa("B*",z),this};var sa=function(z,ie){$i(ie)==="object"?Vl(ie,z):Ue(z)},pl=function(z){z===null||Me===Oe&&z===void 0||(z=vc(z),Ue(z))};function oo(z,ie,ze,rt,mt){var Gt=new ah(ie||this.boundingBox,ze||this.xStep,rt||this.yStep,this.gState,mt||this.matrix);Gt.stream=this.stream;var tr=z+"$$"+this.cloneIndex+++"$$";return gr(tr,Gt),Gt}var Vl=function(z,ie){var ze=I[z.key],rt=te[ze];if(rt instanceof bu)Ue("q"),Ue(Fo(ie)),rt.gState&&j.setGState(rt.gState),Ue(z.matrix.toString()+" cm"),Ue("/"+ze+" sh"),Ue("Q");else if(rt instanceof ah){var mt=new Mt(1,0,0,-1,0,Dn());z.matrix&&(mt=mt.multiply(z.matrix||Ut),ze=oo.call(rt,z.key,z.boundingBox,z.xStep,z.yStep,mt).id),Ue("q"),Ue("/Pattern cs"),Ue("/"+ze+" scn"),rt.gState&&j.setGState(rt.gState),Ue(ie),Ue("Q")}},Fo=function(z){switch(z){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},Vs=j.moveTo=function(z,ie){return Ue(He(Xe(z))+" "+He(Ye(ie))+" m"),this},qs=j.lineTo=function(z,ie){return Ue(He(Xe(z))+" "+He(Ye(ie))+" l"),this},Wr=j.curveTo=function(z,ie,ze,rt,mt,Gt){return Ue([He(Xe(z)),He(Ye(ie)),He(Xe(ze)),He(Ye(rt)),He(Xe(mt)),He(Ye(Gt)),"c"].join(" ")),this};j.__private__.line=j.line=function(z,ie,ze,rt,mt){if(isNaN(z)||isNaN(ie)||isNaN(ze)||isNaN(rt)||!Us(mt))throw new Error("Invalid arguments passed to jsPDF.line");return Me===Qe?this.lines([[ze-z,rt-ie]],z,ie,[1,1],mt||"S"):this.lines([[ze-z,rt-ie]],z,ie,[1,1]).stroke()},j.__private__.lines=j.lines=function(z,ie,ze,rt,mt,Gt){var tr,Ir,Dr,Mr,$r,Ur,Ai,hn,bi,si,dn,Pn;if(typeof z=="number"&&(Pn=ze,ze=ie,ie=z,z=Pn),rt=rt||[1,1],Gt=Gt||!1,isNaN(ie)||isNaN(ze)||!Array.isArray(z)||!Array.isArray(rt)||!Us(mt)||typeof Gt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Vs(ie,ze),tr=rt[0],Ir=rt[1],Mr=z.length,si=ie,dn=ze,Dr=0;Dr<Mr;Dr++)($r=z[Dr]).length===2?(si=$r[0]*tr+si,dn=$r[1]*Ir+dn,qs(si,dn)):(Ur=$r[0]*tr+si,Ai=$r[1]*Ir+dn,hn=$r[2]*tr+si,bi=$r[3]*Ir+dn,si=$r[4]*tr+si,dn=$r[5]*Ir+dn,Wr(Ur,Ai,hn,bi,si,dn));return Gt&&ao(),pl(mt),this},j.path=function(z){for(var ie=0;ie<z.length;ie++){var ze=z[ie],rt=ze.c;switch(ze.op){case"m":Vs(rt[0],rt[1]);break;case"l":qs(rt[0],rt[1]);break;case"c":Wr.apply(this,rt);break;case"h":ao()}}return this},j.__private__.rect=j.rect=function(z,ie,ze,rt,mt){if(isNaN(z)||isNaN(ie)||isNaN(ze)||isNaN(rt)||!Us(mt))throw new Error("Invalid arguments passed to jsPDF.rect");return Me===Qe&&(rt=-rt),Ue([He(Xe(z)),He(Ye(ie)),He(Xe(ze)),He(Xe(rt)),"re"].join(" ")),pl(mt),this},j.__private__.triangle=j.triangle=function(z,ie,ze,rt,mt,Gt,tr){if(isNaN(z)||isNaN(ie)||isNaN(ze)||isNaN(rt)||isNaN(mt)||isNaN(Gt)||!Us(tr))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[ze-z,rt-ie],[mt-ze,Gt-rt],[z-mt,ie-Gt]],z,ie,[1,1],tr,!0),this},j.__private__.roundedRect=j.roundedRect=function(z,ie,ze,rt,mt,Gt,tr){if(isNaN(z)||isNaN(ie)||isNaN(ze)||isNaN(rt)||isNaN(mt)||isNaN(Gt)||!Us(tr))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Ir=4/3*(Math.SQRT2-1);return mt=Math.min(mt,.5*ze),Gt=Math.min(Gt,.5*rt),this.lines([[ze-2*mt,0],[mt*Ir,0,mt,Gt-Gt*Ir,mt,Gt],[0,rt-2*Gt],[0,Gt*Ir,-mt*Ir,Gt,-mt,Gt],[2*mt-ze,0],[-mt*Ir,0,-mt,-Gt*Ir,-mt,-Gt],[0,2*Gt-rt],[0,-Gt*Ir,mt*Ir,-Gt,mt,-Gt]],z+mt,ie,[1,1],tr,!0),this},j.__private__.ellipse=j.ellipse=function(z,ie,ze,rt,mt){if(isNaN(z)||isNaN(ie)||isNaN(ze)||isNaN(rt)||!Us(mt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Gt=4/3*(Math.SQRT2-1)*ze,tr=4/3*(Math.SQRT2-1)*rt;return Vs(z+ze,ie),Wr(z+ze,ie-tr,z+Gt,ie-rt,z,ie-rt),Wr(z-Gt,ie-rt,z-ze,ie-tr,z-ze,ie),Wr(z-ze,ie+tr,z-Gt,ie+rt,z,ie+rt),Wr(z+Gt,ie+rt,z+ze,ie+tr,z+ze,ie),pl(mt),this},j.__private__.circle=j.circle=function(z,ie,ze,rt){if(isNaN(z)||isNaN(ie)||isNaN(ze)||!Us(rt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(z,ie,ze,ze,rt)},j.setFont=function(z,ie,ze){return ze&&(ie=it(ie,ze)),se=_s(z,ie,{disableWarning:!1}),this};var ql=j.__private__.getFont=j.getFont=function(){return Be[_s.apply(j,arguments)]};j.__private__.getFontList=j.getFontList=function(){var z,ie,ze={};for(z in ot)if(ot.hasOwnProperty(z))for(ie in ze[z]=[],ot[z])ot[z].hasOwnProperty(ie)&&ze[z].push(ie);return ze},j.addFont=function(z,ie,ze,rt,mt){var Gt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Gt.indexOf(arguments[3])!==-1?mt=arguments[3]:arguments[3]&&Gt.indexOf(arguments[3])==-1&&(ze=it(ze,rt)),ro.call(this,z,ie,ze,mt=mt||"Identity-H")};var Ro,zo=p.lineWidth||.200025,zr=j.__private__.getLineWidth=j.getLineWidth=function(){return zo},Cn=j.__private__.setLineWidth=j.setLineWidth=function(z){return zo=z,Ue(He(Xe(z))+" w"),this};j.__private__.setLineDash=qr.API.setLineDash=qr.API.setLineDashPattern=function(z,ie){if(z=z||[],ie=ie||0,isNaN(ie)||!Array.isArray(z))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return z=z.map(function(ze){return He(Xe(ze))}).join(" "),ie=He(Xe(ie)),Ue("["+z+"] "+ie+" d"),this};var Ui=j.__private__.getLineHeight=j.getLineHeight=function(){return ir*Ro};j.__private__.getLineHeight=j.getLineHeight=function(){return ir*Ro};var jr=j.__private__.setLineHeightFactor=j.setLineHeightFactor=function(z){return typeof(z=z||1.15)=="number"&&(Ro=z),this},wi=j.__private__.getLineHeightFactor=j.getLineHeightFactor=function(){return Ro};jr(p.lineHeight);var Yn=j.__private__.getHorizontalCoordinate=function(z){return Xe(z)},Ki=j.__private__.getVerticalCoordinate=function(z){return Me===Oe?z:ae[Fe].mediaBox.topRightY-ae[Fe].mediaBox.bottomLeftY-Xe(z)},as=j.__private__.getHorizontalCoordinateString=j.getHorizontalCoordinateString=function(z){return He(Yn(z))},jn=j.__private__.getVerticalCoordinateString=j.getVerticalCoordinateString=function(z){return He(Ki(z))},aa=p.strokeColor||"0 G";j.__private__.getStrokeColor=j.getDrawColor=function(){return nr(aa)},j.__private__.setStrokeColor=j.setDrawColor=function(z,ie,ze,rt){return aa=Br({ch1:z,ch2:ie,ch3:ze,ch4:rt,pdfColorType:"draw",precision:2}),Ue(aa),this};var Gs=p.fillColor||"0 g";j.__private__.getFillColor=j.getFillColor=function(){return nr(Gs)},j.__private__.setFillColor=j.setFillColor=function(z,ie,ze,rt){return Gs=Br({ch1:z,ch2:ie,ch3:ze,ch4:rt,pdfColorType:"fill",precision:2}),Ue(Gs),this};var Mi=p.textColor||"0 g",$s=j.__private__.getTextColor=j.getTextColor=function(){return nr(Mi)};j.__private__.setTextColor=j.setTextColor=function(z,ie,ze,rt){return Mi=Br({ch1:z,ch2:ie,ch3:ze,ch4:rt,pdfColorType:"text",precision:3}),this};var os=p.charSpace,ml=j.__private__.getCharSpace=j.getCharSpace=function(){return parseFloat(os||0)};j.__private__.setCharSpace=j.setCharSpace=function(z){if(isNaN(z))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return os=z,this};var kn=0;j.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},j.__private__.setLineCap=j.setLineCap=function(z){var ie=j.CapJoinStyles[z];if(ie===void 0)throw new Error("Line cap style of '"+z+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return kn=ie,Ue(ie+" J"),this};var oa=0;j.__private__.setLineJoin=j.setLineJoin=function(z){var ie=j.CapJoinStyles[z];if(ie===void 0)throw new Error("Line join style of '"+z+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return oa=ie,Ue(ie+" j"),this},j.__private__.setLineMiterLimit=j.__private__.setMiterLimit=j.setLineMiterLimit=j.setMiterLimit=function(z){if(z=z||0,isNaN(z))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return Ue(He(Xe(z))+" M"),this},j.GState=Hd,j.setGState=function(z){(z=typeof z=="string"?D[fe[z]]:ls(null,z)).equals(Ee)||(Ue("/"+z.id+" gs"),Ee=z)};var ls=function(z,ie){if(!z||!fe[z]){var ze=!1;for(var rt in D)if(D.hasOwnProperty(rt)&&D[rt].equals(ie)){ze=!0;break}if(ze)ie=D[rt];else{var mt="GS"+(Object.keys(D).length+1).toString(10);D[mt]=ie,ie.id=mt}return z&&(fe[z]=ie.id),ft.publish("addGState",ie),ie}};j.addGState=function(z,ie){return ls(z,ie),this},j.saveGraphicsState=function(){return Ue("q"),Rt.push({key:se,size:ir,color:Mi}),this},j.restoreGraphicsState=function(){Ue("Q");var z=Rt.pop();return se=z.key,ir=z.size,Mi=z.color,Ee=null,this},j.setCurrentTransformationMatrix=function(z){return Ue(z.toString()+" cm"),this},j.comment=function(z){return Ue("#"+z),this};var lo=function(z,ie){var ze=z||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return ze},set:function(Gt){isNaN(Gt)||(ze=parseFloat(Gt))}});var rt=ie||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return rt},set:function(Gt){isNaN(Gt)||(rt=parseFloat(Gt))}});var mt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return mt},set:function(Gt){mt=Gt.toString()}}),this},No=function(z,ie,ze,rt){lo.call(this,z,ie),this.type="rect";var mt=ze||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return mt},set:function(tr){isNaN(tr)||(mt=parseFloat(tr))}});var Gt=rt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Gt},set:function(tr){isNaN(tr)||(Gt=parseFloat(tr))}}),this},Zs=function(){this.page=qe,this.currentPage=Fe,this.pages=er.slice(0),this.pagesContext=ae.slice(0),this.x=Ce,this.y=ht,this.matrix=at,this.width=ni(Fe),this.height=Dn(Fe),this.outputDestination=fr,this.id="",this.objectNumber=-1};Zs.prototype.restore=function(){qe=this.page,Fe=this.currentPage,ae=this.pagesContext,er=this.pages,Ce=this.x,ht=this.y,at=this.matrix,Hr(Fe,this.width),Kr(Fe,this.height),fr=this.outputDestination};var vi=function(z,ie,ze,rt,mt){Ht.push(new Zs),qe=Fe=0,er=[],Ce=z,ht=ie,at=mt,mi([ze,rt])};for(var Ws in j.beginFormObject=function(z,ie,ze,rt,mt){return vi(z,ie,ze,rt,mt),this},j.endFormObject=function(z){return function(ie){if(Lt[ie])Ht.pop().restore();else{var ze=new Zs,rt="Xo"+(Object.keys(gt).length+1).toString(10);ze.id=rt,Lt[ie]=rt,gt[rt]=ze,ft.publish("addFormObject",ze),Ht.pop().restore()}}(z),this},j.doFormObject=function(z,ie){var ze=gt[Lt[z]];return Ue("q"),Ue(ie.toString()+" cm"),Ue("/"+ze.id+" Do"),Ue("Q"),this},j.getFormObject=function(z){var ie=gt[Lt[z]];return{x:ie.x,y:ie.y,width:ie.width,height:ie.height,matrix:ie.matrix}},j.save=function(z,ie){return z=z||"generated.pdf",(ie=ie||{}).returnPromise=ie.returnPromise||!1,ie.returnPromise===!1?(vu(na(wa()),z),typeof vu.unload=="function"&&ti.setTimeout&&setTimeout(vu.unload,911),this):new Promise(function(ze,rt){try{var mt=vu(na(wa()),z);typeof vu.unload=="function"&&ti.setTimeout&&setTimeout(vu.unload,911),ze(mt)}catch(Gt){rt(Gt.message)}})},qr.API)qr.API.hasOwnProperty(Ws)&&(Ws==="events"&&qr.API.events.length?function(z,ie){var ze,rt,mt;for(mt=ie.length-1;mt!==-1;mt--)ze=ie[mt][0],rt=ie[mt][1],z.subscribe.apply(z,[ze].concat(typeof rt=="function"?[rt]:rt))}(ft,qr.API.events):j[Ws]=qr.API[Ws]);var ni=j.getPageWidth=function(z){return(ae[z=z||Fe].mediaBox.topRightX-ae[z].mediaBox.bottomLeftX)/Ie},Hr=j.setPageWidth=function(z,ie){ae[z].mediaBox.topRightX=ie*Ie+ae[z].mediaBox.bottomLeftX},Dn=j.getPageHeight=function(z){return(ae[z=z||Fe].mediaBox.topRightY-ae[z].mediaBox.bottomLeftY)/Ie},Kr=j.setPageHeight=function(z,ie){ae[z].mediaBox.topRightY=ie*Ie+ae[z].mediaBox.bottomLeftY};return j.internal={pdfEscape:Bi,getStyle:vc,getFont:ql,getFontSize:mr,getCharSpace:ml,getTextColor:$s,getLineHeight:Ui,getLineHeightFactor:wi,getLineWidth:zr,write:Yr,getHorizontalCoordinate:Yn,getVerticalCoordinate:Ki,getCoordinateString:as,getVerticalCoordinateString:jn,collections:{},newObject:ri,newAdditionalObject:Fi,newObjectDeferred:Ot,newObjectDeferredBegin:kr,getFilters:Or,putStream:Oi,events:ft,scaleFactor:Ie,pageSize:{getWidth:function(){return ni(Fe)},setWidth:function(z){Hr(Fe,z)},getHeight:function(){return Dn(Fe)},setHeight:function(z){Kr(Fe,z)}},encryptionOptions:O,encryption:sn,getEncryptor:function(z){return O!==null?sn.encryptor(z,0):function(ie){return ie}},output:js,getNumberOfPages:xa,pages:er,out:Ue,f2:me,f3:xe,getPageInfo:so,getPageInfoByObjId:Bl,getCurrentPageInfo:jl,getPDFVersion:ce,Point:lo,Rectangle:No,Matrix:Mt,hasHotfix:no},Object.defineProperty(j.internal.pageSize,"width",{get:function(){return ni(Fe)},set:function(z){Hr(Fe,z)},enumerable:!0,configurable:!0}),Object.defineProperty(j.internal.pageSize,"height",{get:function(){return Dn(Fe)},set:function(z){Kr(Fe,z)},enumerable:!0,configurable:!0}),(function(z){for(var ie=0,ze=Tr.length;ie<ze;ie++){var rt=ro.call(this,z[ie][0],z[ie][1],z[ie][2],Tr[ie][3],!0);Y===!1&&(ee[rt]=!0);var mt=z[ie][0].split("-");Na({id:rt,fontName:mt[0],fontStyle:mt[1]||""})}ft.publish("addFonts",{fonts:Be,dictionary:ot})}).call(j,Tr),se="F1",ko(v,u),ft.publish("initialized"),j}rh.prototype.lsbFirstWord=function(p){return String.fromCharCode(255&p,p>>8&255,p>>16&255,p>>24&255)},rh.prototype.toHexString=function(p){return p.split("").map(function(o){return("0"+(255&o.charCodeAt(0)).toString(16)).slice(-2)}).join("")},rh.prototype.hexToBytes=function(p){for(var o=[],u=0;u<p.length;u+=2)o.push(String.fromCharCode(parseInt(p.substr(u,2),16)));return o.join("")},rh.prototype.processOwnerPassword=function(p,o){return jp(Bp(o).substr(0,5),p)},rh.prototype.encryptor=function(p,o){var u=Bp(this.encryptionKey+String.fromCharCode(255&p,p>>8&255,p>>16&255,255&o,o>>8&255)).substr(0,10);return function(m){return jp(u,m)}},Hd.prototype.equals=function(p){var o,u="id,objectNumber,equals";if(!p||$i(p)!==$i(this))return!1;var m=0;for(o in this)if(!(u.indexOf(o)>=0)){if(this.hasOwnProperty(o)&&!p.hasOwnProperty(o)||this[o]!==p[o])return!1;m++}for(o in p)p.hasOwnProperty(o)&&u.indexOf(o)<0&&m--;return m===0},qr.API={events:[]},qr.version="3.0.2";var Bn=qr.API,Yp=1,Pu=function(p){return p.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Qu=function(p){return p.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},oi=function(p){return p.toFixed(2)},Vc=function(p){return p.toFixed(5)};Bn.__acroform__={};var Fa=function(p,o){p.prototype=Object.create(o.prototype),p.prototype.constructor=p},by=function(p){return p*Yp},Rl=function(p){var o=new k0,u=Fr.internal.getHeight(p)||0,m=Fr.internal.getWidth(p)||0;return o.BBox=[0,0,Number(oi(m)),Number(oi(u))],o},Ew=Bn.__acroform__.setBit=function(p,o){if(p=p||0,o=o||0,isNaN(p)||isNaN(o))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return p|1<<o},Lw=Bn.__acroform__.clearBit=function(p,o){if(p=p||0,o=o||0,isNaN(p)||isNaN(o))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return p&~(1<<o)},Mw=Bn.__acroform__.getBit=function(p,o){if(isNaN(p)||isNaN(o))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return p&1<<o?1:0},Wn=Bn.__acroform__.getBitForPdf=function(p,o){if(isNaN(p)||isNaN(o))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Mw(p,o-1)},Hn=Bn.__acroform__.setBitForPdf=function(p,o){if(isNaN(p)||isNaN(o))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Ew(p,o-1)},Xn=Bn.__acroform__.clearBitForPdf=function(p,o){if(isNaN(p)||isNaN(o))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Lw(p,o-1)},Cw=Bn.__acroform__.calculateCoordinates=function(p,o){var u=o.internal.getHorizontalCoordinate,m=o.internal.getVerticalCoordinate,v=p[0],x=p[1],b=p[2],a=p[3],C={};return C.lowerLeft_X=u(v)||0,C.lowerLeft_Y=m(x+a)||0,C.upperRight_X=u(v+b)||0,C.upperRight_Y=m(x)||0,[Number(oi(C.lowerLeft_X)),Number(oi(C.lowerLeft_Y)),Number(oi(C.upperRight_X)),Number(oi(C.upperRight_Y))]},kw=function(p){if(p.appearanceStreamContent)return p.appearanceStreamContent;if(p.V||p.DV){var o=[],u=p._V||p.DV,m=Up(p,u),v=p.scope.internal.getFont(p.fontName,p.fontStyle).id;o.push("/Tx BMC"),o.push("q"),o.push("BT"),o.push(p.scope.__private__.encodeColorString(p.color)),o.push("/"+v+" "+oi(m.fontSize)+" Tf"),o.push("1 0 0 1 0 0 Tm"),o.push(m.text),o.push("ET"),o.push("Q"),o.push("EMC");var x=Rl(p);return x.scope=p.scope,x.stream=o.join(`
`),x}},Up=function(p,o){var u=p.fontSize===0?p.maxFontSize:p.fontSize,m={text:"",fontSize:""},v=(o=(o=o.substr(0,1)=="("?o.substr(1):o).substr(o.length-1)==")"?o.substr(0,o.length-1):o).split(" ");v=p.multiline?v.map(function(me){return me.split(`
`)}):v.map(function(me){return[me]});var x=u,b=Fr.internal.getHeight(p)||0;b=b<0?-b:b;var a=Fr.internal.getWidth(p)||0;a=a<0?-a:a;var C=function(me,xe,Xe){if(me+1<v.length){var Ye=xe+" "+v[me+1][0];return Rd(Ye,p,Xe).width<=a-4}return!1};x++;e:for(;x>0;){o="",x--;var F,O,Y=Rd("3",p,x).height,ee=p.multiline?b-x:(b-Y)/2,j=ee+=2,Pe=0,ce=0,Q=0;if(x<=0){o=`(...) Tj
`,o+="% Width of Text: "+Rd(o,p,x=12).width+", FieldWidth:"+a+`
`;break}for(var ge="",Qe=0,Oe=0;Oe<v.length;Oe++)if(v.hasOwnProperty(Oe)){var Me=!1;if(v[Oe].length!==1&&Q!==v[Oe].length-1){if((Y+2)*(Qe+2)+2>b)continue e;ge+=v[Oe][Q],Me=!0,ce=Oe,Oe--}else{ge=(ge+=v[Oe][Q]+" ").substr(ge.length-1)==" "?ge.substr(0,ge.length-1):ge;var Ge=parseInt(Oe),Ze=C(Ge,ge,x),it=Oe>=v.length-1;if(Ze&&!it){ge+=" ",Q=0;continue}if(Ze||it){if(it)ce=Ge;else if(p.multiline&&(Y+2)*(Qe+2)+2>b)continue e}else{if(!p.multiline||(Y+2)*(Qe+2)+2>b)continue e;ce=Ge}}for(var He="",Te=Pe;Te<=ce;Te++){var st=v[Te];if(p.multiline){if(Te===ce){He+=st[Q]+" ",Q=(Q+1)%st.length;continue}if(Te===Pe){He+=st[st.length-1]+" ";continue}}He+=st[0]+" "}switch(He=He.substr(He.length-1)==" "?He.substr(0,He.length-1):He,O=Rd(He,p,x).width,p.textAlign){case"right":F=a-O-2;break;case"center":F=(a-O)/2;break;default:F=2}o+=oi(F)+" "+oi(j)+` Td
`,o+="("+Pu(He)+`) Tj
`,o+=-oi(F)+` 0 Td
`,j=-(x+2),O=0,Pe=Me?ce:ce+1,Qe++,ge=""}break}return m.text=o,m.fontSize=x,m},Rd=function(p,o,u){var m=o.scope.internal.getFont(o.fontName,o.fontStyle),v=o.scope.getStringUnitWidth(p,{font:m,fontSize:parseFloat(u),charSpace:0})*parseFloat(u);return{height:o.scope.getStringUnitWidth("3",{font:m,fontSize:parseFloat(u),charSpace:0})*parseFloat(u)*1.5,width:v}},Dw={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},Fw=function(p,o){var u={type:"reference",object:p};o.internal.getPageInfo(p.page).pageContext.annotations.find(function(m){return m.type===u.type&&m.object===u.object})===void 0&&o.internal.getPageInfo(p.page).pageContext.annotations.push(u)},Rw=function(p,o){if(o.scope=p,p.internal!==void 0&&(p.internal.acroformPlugin===void 0||p.internal.acroformPlugin.isInitialized===!1)){if(dl.FieldNum=0,p.internal.acroformPlugin=JSON.parse(JSON.stringify(Dw)),p.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Yp=p.internal.scaleFactor,p.internal.acroformPlugin.acroFormDictionaryRoot=new D0,p.internal.acroformPlugin.acroFormDictionaryRoot.scope=p,p.internal.acroformPlugin.acroFormDictionaryRoot._eventID=p.internal.events.subscribe("postPutResources",function(){(function(u){u.internal.events.unsubscribe(u.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete u.internal.acroformPlugin.acroFormDictionaryRoot._eventID,u.internal.acroformPlugin.printedOut=!0})(p)}),p.internal.events.subscribe("buildDocument",function(){(function(u){u.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var m=u.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var v in m)if(m.hasOwnProperty(v)){var x=m[v];x.objId=void 0,x.hasAnnotation&&Fw(x,u)}})(p)}),p.internal.events.subscribe("putCatalog",function(){(function(u){if(u.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");u.internal.write("/AcroForm "+u.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(p)}),p.internal.events.subscribe("postPutPages",function(u){(function(m,v){var x=!m;for(var b in m||(v.internal.newObjectDeferredBegin(v.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),v.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),m=m||v.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(m.hasOwnProperty(b)){var a=m[b],C=[],F=a.Rect;if(a.Rect&&(a.Rect=Cw(a.Rect,v)),v.internal.newObjectDeferredBegin(a.objId,!0),a.DA=Fr.createDefaultAppearanceStream(a),$i(a)==="object"&&typeof a.getKeyValueListForStream=="function"&&(C=a.getKeyValueListForStream()),a.Rect=F,a.hasAppearanceStream&&!a.appearanceStreamContent){var O=kw(a);C.push({key:"AP",value:"<</N "+O+">>"}),v.internal.acroformPlugin.xForms.push(O)}if(a.appearanceStreamContent){var Y="";for(var ee in a.appearanceStreamContent)if(a.appearanceStreamContent.hasOwnProperty(ee)){var j=a.appearanceStreamContent[ee];if(Y+="/"+ee+" ",Y+="<<",Object.keys(j).length>=1||Array.isArray(j)){for(var b in j)if(j.hasOwnProperty(b)){var Pe=j[b];typeof Pe=="function"&&(Pe=Pe.call(v,a)),Y+="/"+b+" "+Pe+" ",v.internal.acroformPlugin.xForms.indexOf(Pe)>=0||v.internal.acroformPlugin.xForms.push(Pe)}}else typeof(Pe=j)=="function"&&(Pe=Pe.call(v,a)),Y+="/"+b+" "+Pe,v.internal.acroformPlugin.xForms.indexOf(Pe)>=0||v.internal.acroformPlugin.xForms.push(Pe);Y+=">>"}C.push({key:"AP",value:`<<
`+Y+">>"})}v.internal.putStream({additionalKeyValues:C,objectId:a.objId}),v.internal.out("endobj")}x&&function(ce,Q){for(var ge in ce)if(ce.hasOwnProperty(ge)){var Qe=ge,Oe=ce[ge];Q.internal.newObjectDeferredBegin(Oe.objId,!0),$i(Oe)==="object"&&typeof Oe.putStream=="function"&&Oe.putStream(),delete ce[Qe]}}(v.internal.acroformPlugin.xForms,v)})(u,p)}),p.internal.acroformPlugin.isInitialized=!0}},C0=Bn.__acroform__.arrayToPdfArray=function(p,o,u){var m=function(b){return b};if(Array.isArray(p)){for(var v="[",x=0;x<p.length;x++)switch(x!==0&&(v+=" "),$i(p[x])){case"boolean":case"number":case"object":v+=p[x].toString();break;case"string":p[x].substr(0,1)!=="/"?(o!==void 0&&u&&(m=u.internal.getEncryptor(o)),v+="("+Pu(m(p[x].toString()))+")"):v+=p[x].toString()}return v+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},Pp=function(p,o,u){var m=function(v){return v};return o!==void 0&&u&&(m=u.internal.getEncryptor(o)),(p=p||"").toString(),"("+Pu(m(p))+")"},zl=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(p){this._objId=p}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};zl.prototype.toString=function(){return this.objId+" 0 R"},zl.prototype.putStream=function(){var p=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:p,objectId:this.objId}),this.scope.internal.out("endobj")},zl.prototype.getKeyValueListForStream=function(){var p=[],o=Object.getOwnPropertyNames(this).filter(function(x){return x!="content"&&x!="appearanceStreamContent"&&x!="scope"&&x!="objId"&&x.substring(0,1)!="_"});for(var u in o)if(Object.getOwnPropertyDescriptor(this,o[u]).configurable===!1){var m=o[u],v=this[m];v&&(Array.isArray(v)?p.push({key:m,value:C0(v,this.objId,this.scope)}):v instanceof zl?(v.scope=this.scope,p.push({key:m,value:v.objId+" 0 R"})):typeof v!="function"&&p.push({key:m,value:v}))}return p};var k0=function(){zl.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var p,o=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return o},set:function(u){o=u}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(u){p=u.trim()},get:function(){return p||null}})};Fa(k0,zl);var D0=function(){zl.call(this);var p,o=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return o.length>0?o:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return o}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(p){var u=function(m){return m};return this.scope&&(u=this.scope.internal.getEncryptor(this.objId)),"("+Pu(u(p))+")"}},set:function(u){p=u}})};Fa(D0,zl);var dl=function p(){zl.call(this);var o=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return o},set:function(ge){if(isNaN(ge))throw new Error('Invalid value "'+ge+'" for attribute F supplied.');o=ge}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Wn(o,3)},set:function(ge){ge?this.F=Hn(o,3):this.F=Xn(o,3)}});var u=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return u},set:function(ge){if(isNaN(ge))throw new Error('Invalid value "'+ge+'" for attribute Ff supplied.');u=ge}});var m=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(m.length!==0)return m},set:function(ge){m=ge!==void 0?ge:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!m||isNaN(m[0])?0:m[0]},set:function(ge){m[0]=ge}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!m||isNaN(m[1])?0:m[1]},set:function(ge){m[1]=ge}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!m||isNaN(m[2])?0:m[2]},set:function(ge){m[2]=ge}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!m||isNaN(m[3])?0:m[3]},set:function(ge){m[3]=ge}});var v="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return v},set:function(ge){switch(ge){case"/Btn":case"/Tx":case"/Ch":case"/Sig":v=ge;break;default:throw new Error('Invalid value "'+ge+'" for attribute FT supplied.')}}});var x=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!x||x.length<1){if(this instanceof Xd)return;x="FieldObject"+p.FieldNum++}var ge=function(Qe){return Qe};return this.scope&&(ge=this.scope.internal.getEncryptor(this.objId)),"("+Pu(ge(x))+")"},set:function(ge){x=ge.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return x},set:function(ge){x=ge}});var b="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return b},set:function(ge){b=ge}});var a="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return a},set:function(ge){a=ge}});var C=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return C},set:function(ge){C=ge}});var F=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return F===void 0?50/Yp:F},set:function(ge){F=ge}});var O="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return O},set:function(ge){O=ge}});var Y="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!Y||this instanceof Xd||this instanceof xu))return Pp(Y,this.objId,this.scope)},set:function(ge){ge=ge.toString(),Y=ge}});var ee=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(ee)return this instanceof Is==0?Pp(ee,this.objId,this.scope):ee},set:function(ge){ge=ge.toString(),ee=this instanceof Is==0?ge.substr(0,1)==="("?Qu(ge.substr(1,ge.length-2)):Qu(ge):ge}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Is==1?Qu(ee.substr(1,ee.length-1)):ee},set:function(ge){ge=ge.toString(),ee=this instanceof Is==1?"/"+ge:ge}});var j=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(j)return j},set:function(ge){this.V=ge}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(j)return this instanceof Is==0?Pp(j,this.objId,this.scope):j},set:function(ge){ge=ge.toString(),j=this instanceof Is==0?ge.substr(0,1)==="("?Qu(ge.substr(1,ge.length-2)):Qu(ge):ge}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Is==1?Qu(j.substr(1,j.length-1)):j},set:function(ge){ge=ge.toString(),j=this instanceof Is==1?"/"+ge:ge}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var Pe,ce=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return ce},set:function(ge){ge=!!ge,ce=ge}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(Pe)return Pe},set:function(ge){Pe=ge}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Wn(this.Ff,1)},set:function(ge){ge?this.Ff=Hn(this.Ff,1):this.Ff=Xn(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Wn(this.Ff,2)},set:function(ge){ge?this.Ff=Hn(this.Ff,2):this.Ff=Xn(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Wn(this.Ff,3)},set:function(ge){ge?this.Ff=Hn(this.Ff,3):this.Ff=Xn(this.Ff,3)}});var Q=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(Q!==null)return Q},set:function(ge){if([0,1,2].indexOf(ge)===-1)throw new Error('Invalid value "'+ge+'" for attribute Q supplied.');Q=ge}}),Object.defineProperty(this,"textAlign",{get:function(){var ge;switch(Q){case 0:default:ge="left";break;case 1:ge="center";break;case 2:ge="right"}return ge},configurable:!0,enumerable:!0,set:function(ge){switch(ge){case"right":case 2:Q=2;break;case"center":case 1:Q=1;break;default:Q=0}}})};Fa(dl,zl);var lh=function(){dl.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var p=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return p},set:function(u){p=u}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return p},set:function(u){p=u}});var o=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return C0(o,this.objId,this.scope)},set:function(u){var m,v;v=[],typeof(m=u)=="string"&&(v=function(x,b,a){a||(a=1);for(var C,F=[];C=b.exec(x);)F.push(C[a]);return F}(m,/\((.*?)\)/g)),o=v}}),this.getOptions=function(){return o},this.setOptions=function(u){o=u,this.sort&&o.sort()},this.addOption=function(u){u=(u=u||"").toString(),o.push(u),this.sort&&o.sort()},this.removeOption=function(u,m){for(m=m||!1,u=(u=u||"").toString();o.indexOf(u)!==-1&&(o.splice(o.indexOf(u),1),m!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Wn(this.Ff,18)},set:function(u){u?this.Ff=Hn(this.Ff,18):this.Ff=Xn(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Wn(this.Ff,19)},set:function(u){this.combo===!0&&(u?this.Ff=Hn(this.Ff,19):this.Ff=Xn(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Wn(this.Ff,20)},set:function(u){u?(this.Ff=Hn(this.Ff,20),o.sort()):this.Ff=Xn(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Wn(this.Ff,22)},set:function(u){u?this.Ff=Hn(this.Ff,22):this.Ff=Xn(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Wn(this.Ff,23)},set:function(u){u?this.Ff=Hn(this.Ff,23):this.Ff=Xn(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Wn(this.Ff,27)},set:function(u){u?this.Ff=Hn(this.Ff,27):this.Ff=Xn(this.Ff,27)}}),this.hasAppearanceStream=!1};Fa(lh,dl);var ch=function(){lh.call(this),this.fontName="helvetica",this.combo=!1};Fa(ch,lh);var uh=function(){ch.call(this),this.combo=!0};Fa(uh,ch);var Vd=function(){uh.call(this),this.edit=!0};Fa(Vd,uh);var Is=function(){dl.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Wn(this.Ff,15)},set:function(u){u?this.Ff=Hn(this.Ff,15):this.Ff=Xn(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Wn(this.Ff,16)},set:function(u){u?this.Ff=Hn(this.Ff,16):this.Ff=Xn(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Wn(this.Ff,17)},set:function(u){u?this.Ff=Hn(this.Ff,17):this.Ff=Xn(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Wn(this.Ff,26)},set:function(u){u?this.Ff=Hn(this.Ff,26):this.Ff=Xn(this.Ff,26)}});var p,o={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var u=function(x){return x};if(this.scope&&(u=this.scope.internal.getEncryptor(this.objId)),Object.keys(o).length!==0){var m,v=[];for(m in v.push("<<"),o)v.push("/"+m+" ("+Pu(u(o[m]))+")");return v.push(">>"),v.join(`
`)}},set:function(u){$i(u)==="object"&&(o=u)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return o.CA||""},set:function(u){typeof u=="string"&&(o.CA=u)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return p},set:function(u){p=u}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return p.substr(1,p.length-1)},set:function(u){p="/"+u}})};Fa(Is,dl);var qd=function(){Is.call(this),this.pushButton=!0};Fa(qd,Is);var hh=function(){Is.call(this),this.radio=!0,this.pushButton=!1;var p=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return p},set:function(o){p=o!==void 0?o:[]}})};Fa(hh,Is);var Xd=function(){var p,o;dl.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return p},set:function(v){p=v}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return o},set:function(v){o=v}});var u,m={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var v=function(a){return a};this.scope&&(v=this.scope.internal.getEncryptor(this.objId));var x,b=[];for(x in b.push("<<"),m)b.push("/"+x+" ("+Pu(v(m[x]))+")");return b.push(">>"),b.join(`
`)},set:function(v){$i(v)==="object"&&(m=v)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return m.CA||""},set:function(v){typeof v=="string"&&(m.CA=v)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return u},set:function(v){u=v}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return u.substr(1,u.length-1)},set:function(v){u="/"+v}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Fr.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Fa(Xd,dl),hh.prototype.setAppearance=function(p){if(!("createAppearanceStream"in p)||!("getCA"in p))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var o in this.Kids)if(this.Kids.hasOwnProperty(o)){var u=this.Kids[o];u.appearanceStreamContent=p.createAppearanceStream(u.optionName),u.caption=p.getCA()}},hh.prototype.createOption=function(p){var o=new Xd;return o.Parent=this,o.optionName=p,this.Kids.push(o),zw.call(this.scope,o),o};var Gd=function(){Is.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Fr.CheckBox.createAppearanceStream()};Fa(Gd,Is);var xu=function(){dl.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Wn(this.Ff,13)},set:function(o){o?this.Ff=Hn(this.Ff,13):this.Ff=Xn(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Wn(this.Ff,21)},set:function(o){o?this.Ff=Hn(this.Ff,21):this.Ff=Xn(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Wn(this.Ff,23)},set:function(o){o?this.Ff=Hn(this.Ff,23):this.Ff=Xn(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Wn(this.Ff,24)},set:function(o){o?this.Ff=Hn(this.Ff,24):this.Ff=Xn(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Wn(this.Ff,25)},set:function(o){o?this.Ff=Hn(this.Ff,25):this.Ff=Xn(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Wn(this.Ff,26)},set:function(o){o?this.Ff=Hn(this.Ff,26):this.Ff=Xn(this.Ff,26)}});var p=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return p},set:function(o){p=o}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return p},set:function(o){Number.isInteger(o)&&(p=o)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Fa(xu,dl);var $d=function(){xu.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Wn(this.Ff,14)},set:function(p){p?this.Ff=Hn(this.Ff,14):this.Ff=Xn(this.Ff,14)}}),this.password=!0};Fa($d,xu);var Fr={CheckBox:{createAppearanceStream:function(){return{N:{On:Fr.CheckBox.YesNormal},D:{On:Fr.CheckBox.YesPushDown,Off:Fr.CheckBox.OffPushDown}}},YesPushDown:function(p){var o=Rl(p);o.scope=p.scope;var u=[],m=p.scope.internal.getFont(p.fontName,p.fontStyle).id,v=p.scope.__private__.encodeColorString(p.color),x=Up(p,p.caption);return u.push("0.749023 g"),u.push("0 0 "+oi(Fr.internal.getWidth(p))+" "+oi(Fr.internal.getHeight(p))+" re"),u.push("f"),u.push("BMC"),u.push("q"),u.push("0 0 1 rg"),u.push("/"+m+" "+oi(x.fontSize)+" Tf "+v),u.push("BT"),u.push(x.text),u.push("ET"),u.push("Q"),u.push("EMC"),o.stream=u.join(`
`),o},YesNormal:function(p){var o=Rl(p);o.scope=p.scope;var u=p.scope.internal.getFont(p.fontName,p.fontStyle).id,m=p.scope.__private__.encodeColorString(p.color),v=[],x=Fr.internal.getHeight(p),b=Fr.internal.getWidth(p),a=Up(p,p.caption);return v.push("1 g"),v.push("0 0 "+oi(b)+" "+oi(x)+" re"),v.push("f"),v.push("q"),v.push("0 0 1 rg"),v.push("0 0 "+oi(b-1)+" "+oi(x-1)+" re"),v.push("W"),v.push("n"),v.push("0 g"),v.push("BT"),v.push("/"+u+" "+oi(a.fontSize)+" Tf "+m),v.push(a.text),v.push("ET"),v.push("Q"),o.stream=v.join(`
`),o},OffPushDown:function(p){var o=Rl(p);o.scope=p.scope;var u=[];return u.push("0.749023 g"),u.push("0 0 "+oi(Fr.internal.getWidth(p))+" "+oi(Fr.internal.getHeight(p))+" re"),u.push("f"),o.stream=u.join(`
`),o}},RadioButton:{Circle:{createAppearanceStream:function(p){var o={D:{Off:Fr.RadioButton.Circle.OffPushDown},N:{}};return o.N[p]=Fr.RadioButton.Circle.YesNormal,o.D[p]=Fr.RadioButton.Circle.YesPushDown,o},getCA:function(){return"l"},YesNormal:function(p){var o=Rl(p);o.scope=p.scope;var u=[],m=Fr.internal.getWidth(p)<=Fr.internal.getHeight(p)?Fr.internal.getWidth(p)/4:Fr.internal.getHeight(p)/4;m=Number((.9*m).toFixed(5));var v=Fr.internal.Bezier_C,x=Number((m*v).toFixed(5));return u.push("q"),u.push("1 0 0 1 "+Vc(Fr.internal.getWidth(p)/2)+" "+Vc(Fr.internal.getHeight(p)/2)+" cm"),u.push(m+" 0 m"),u.push(m+" "+x+" "+x+" "+m+" 0 "+m+" c"),u.push("-"+x+" "+m+" -"+m+" "+x+" -"+m+" 0 c"),u.push("-"+m+" -"+x+" -"+x+" -"+m+" 0 -"+m+" c"),u.push(x+" -"+m+" "+m+" -"+x+" "+m+" 0 c"),u.push("f"),u.push("Q"),o.stream=u.join(`
`),o},YesPushDown:function(p){var o=Rl(p);o.scope=p.scope;var u=[],m=Fr.internal.getWidth(p)<=Fr.internal.getHeight(p)?Fr.internal.getWidth(p)/4:Fr.internal.getHeight(p)/4;m=Number((.9*m).toFixed(5));var v=Number((2*m).toFixed(5)),x=Number((v*Fr.internal.Bezier_C).toFixed(5)),b=Number((m*Fr.internal.Bezier_C).toFixed(5));return u.push("0.749023 g"),u.push("q"),u.push("1 0 0 1 "+Vc(Fr.internal.getWidth(p)/2)+" "+Vc(Fr.internal.getHeight(p)/2)+" cm"),u.push(v+" 0 m"),u.push(v+" "+x+" "+x+" "+v+" 0 "+v+" c"),u.push("-"+x+" "+v+" -"+v+" "+x+" -"+v+" 0 c"),u.push("-"+v+" -"+x+" -"+x+" -"+v+" 0 -"+v+" c"),u.push(x+" -"+v+" "+v+" -"+x+" "+v+" 0 c"),u.push("f"),u.push("Q"),u.push("0 g"),u.push("q"),u.push("1 0 0 1 "+Vc(Fr.internal.getWidth(p)/2)+" "+Vc(Fr.internal.getHeight(p)/2)+" cm"),u.push(m+" 0 m"),u.push(m+" "+b+" "+b+" "+m+" 0 "+m+" c"),u.push("-"+b+" "+m+" -"+m+" "+b+" -"+m+" 0 c"),u.push("-"+m+" -"+b+" -"+b+" -"+m+" 0 -"+m+" c"),u.push(b+" -"+m+" "+m+" -"+b+" "+m+" 0 c"),u.push("f"),u.push("Q"),o.stream=u.join(`
`),o},OffPushDown:function(p){var o=Rl(p);o.scope=p.scope;var u=[],m=Fr.internal.getWidth(p)<=Fr.internal.getHeight(p)?Fr.internal.getWidth(p)/4:Fr.internal.getHeight(p)/4;m=Number((.9*m).toFixed(5));var v=Number((2*m).toFixed(5)),x=Number((v*Fr.internal.Bezier_C).toFixed(5));return u.push("0.749023 g"),u.push("q"),u.push("1 0 0 1 "+Vc(Fr.internal.getWidth(p)/2)+" "+Vc(Fr.internal.getHeight(p)/2)+" cm"),u.push(v+" 0 m"),u.push(v+" "+x+" "+x+" "+v+" 0 "+v+" c"),u.push("-"+x+" "+v+" -"+v+" "+x+" -"+v+" 0 c"),u.push("-"+v+" -"+x+" -"+x+" -"+v+" 0 -"+v+" c"),u.push(x+" -"+v+" "+v+" -"+x+" "+v+" 0 c"),u.push("f"),u.push("Q"),o.stream=u.join(`
`),o}},Cross:{createAppearanceStream:function(p){var o={D:{Off:Fr.RadioButton.Cross.OffPushDown},N:{}};return o.N[p]=Fr.RadioButton.Cross.YesNormal,o.D[p]=Fr.RadioButton.Cross.YesPushDown,o},getCA:function(){return"8"},YesNormal:function(p){var o=Rl(p);o.scope=p.scope;var u=[],m=Fr.internal.calculateCross(p);return u.push("q"),u.push("1 1 "+oi(Fr.internal.getWidth(p)-2)+" "+oi(Fr.internal.getHeight(p)-2)+" re"),u.push("W"),u.push("n"),u.push(oi(m.x1.x)+" "+oi(m.x1.y)+" m"),u.push(oi(m.x2.x)+" "+oi(m.x2.y)+" l"),u.push(oi(m.x4.x)+" "+oi(m.x4.y)+" m"),u.push(oi(m.x3.x)+" "+oi(m.x3.y)+" l"),u.push("s"),u.push("Q"),o.stream=u.join(`
`),o},YesPushDown:function(p){var o=Rl(p);o.scope=p.scope;var u=Fr.internal.calculateCross(p),m=[];return m.push("0.749023 g"),m.push("0 0 "+oi(Fr.internal.getWidth(p))+" "+oi(Fr.internal.getHeight(p))+" re"),m.push("f"),m.push("q"),m.push("1 1 "+oi(Fr.internal.getWidth(p)-2)+" "+oi(Fr.internal.getHeight(p)-2)+" re"),m.push("W"),m.push("n"),m.push(oi(u.x1.x)+" "+oi(u.x1.y)+" m"),m.push(oi(u.x2.x)+" "+oi(u.x2.y)+" l"),m.push(oi(u.x4.x)+" "+oi(u.x4.y)+" m"),m.push(oi(u.x3.x)+" "+oi(u.x3.y)+" l"),m.push("s"),m.push("Q"),o.stream=m.join(`
`),o},OffPushDown:function(p){var o=Rl(p);o.scope=p.scope;var u=[];return u.push("0.749023 g"),u.push("0 0 "+oi(Fr.internal.getWidth(p))+" "+oi(Fr.internal.getHeight(p))+" re"),u.push("f"),o.stream=u.join(`
`),o}}},createDefaultAppearanceStream:function(p){var o=p.scope.internal.getFont(p.fontName,p.fontStyle).id,u=p.scope.__private__.encodeColorString(p.color);return"/"+o+" "+p.fontSize+" Tf "+u}};Fr.internal={Bezier_C:.551915024494,calculateCross:function(p){var o=Fr.internal.getWidth(p),u=Fr.internal.getHeight(p),m=Math.min(o,u);return{x1:{x:(o-m)/2,y:(u-m)/2+m},x2:{x:(o-m)/2+m,y:(u-m)/2},x3:{x:(o-m)/2,y:(u-m)/2},x4:{x:(o-m)/2+m,y:(u-m)/2+m}}}},Fr.internal.getWidth=function(p){var o=0;return $i(p)==="object"&&(o=by(p.Rect[2])),o},Fr.internal.getHeight=function(p){var o=0;return $i(p)==="object"&&(o=by(p.Rect[3])),o};var zw=Bn.addField=function(p){if(Rw(this,p),!(p instanceof dl))throw new Error("Invalid argument passed to jsPDF.addField.");var o;return(o=p).scope.internal.acroformPlugin.printedOut&&(o.scope.internal.acroformPlugin.printedOut=!1,o.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),o.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(o),p.page=p.scope.internal.getCurrentPageInfo().pageNumber,this};Bn.AcroFormChoiceField=lh,Bn.AcroFormListBox=ch,Bn.AcroFormComboBox=uh,Bn.AcroFormEditBox=Vd,Bn.AcroFormButton=Is,Bn.AcroFormPushButton=qd,Bn.AcroFormRadioButton=hh,Bn.AcroFormCheckBox=Gd,Bn.AcroFormTextField=xu,Bn.AcroFormPasswordField=$d,Bn.AcroFormAppearance=Fr,Bn.AcroForm={ChoiceField:lh,ListBox:ch,ComboBox:uh,EditBox:Vd,Button:Is,PushButton:qd,RadioButton:hh,CheckBox:Gd,TextField:xu,PasswordField:$d,Appearance:Fr},qr.AcroForm={ChoiceField:lh,ListBox:ch,ComboBox:uh,EditBox:Vd,Button:Is,PushButton:qd,RadioButton:hh,CheckBox:Gd,TextField:xu,PasswordField:$d,Appearance:Fr};qr.AcroForm;function F0(p){return p.reduce(function(o,u,m){return o[u]=m,o},{})}(function(p){var o="addImage_";p.__addimage__={};var u="UNKNOWN",m={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},v=p.__addimage__.getImageFileTypeByImageData=function(me,xe){var Xe,Ye,At,Dt,kt,yt=u;if((xe=xe||u)==="RGBA"||me.data!==void 0&&me.data instanceof Uint8ClampedArray&&"height"in me&&"width"in me)return"RGBA";if(Ze(me))for(kt in m)for(At=m[kt],Xe=0;Xe<At.length;Xe+=1){for(Dt=!0,Ye=0;Ye<At[Xe].length;Ye+=1)if(At[Xe][Ye]!==void 0&&At[Xe][Ye]!==me[Ye]){Dt=!1;break}if(Dt===!0){yt=kt;break}}else for(kt in m)for(At=m[kt],Xe=0;Xe<At.length;Xe+=1){for(Dt=!0,Ye=0;Ye<At[Xe].length;Ye+=1)if(At[Xe][Ye]!==void 0&&At[Xe][Ye]!==me.charCodeAt(Ye)){Dt=!1;break}if(Dt===!0){yt=kt;break}}return yt===u&&xe!==u&&(yt=xe),yt},x=function me(xe){for(var Xe=this.internal.write,Ye=this.internal.putStream,At=(0,this.internal.getFilters)();At.indexOf("FlateEncode")!==-1;)At.splice(At.indexOf("FlateEncode"),1);xe.objectId=this.internal.newObject();var Dt=[];if(Dt.push({key:"Type",value:"/XObject"}),Dt.push({key:"Subtype",value:"/Image"}),Dt.push({key:"Width",value:xe.width}),Dt.push({key:"Height",value:xe.height}),xe.colorSpace===ge.INDEXED?Dt.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(xe.palette.length/3-1)+" "+("sMask"in xe&&xe.sMask!==void 0?xe.objectId+2:xe.objectId+1)+" 0 R]"}):(Dt.push({key:"ColorSpace",value:"/"+xe.colorSpace}),xe.colorSpace===ge.DEVICE_CMYK&&Dt.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),Dt.push({key:"BitsPerComponent",value:xe.bitsPerComponent}),"decodeParameters"in xe&&xe.decodeParameters!==void 0&&Dt.push({key:"DecodeParms",value:"<<"+xe.decodeParameters+">>"}),"transparency"in xe&&Array.isArray(xe.transparency)){for(var kt="",yt=0,vt=xe.transparency.length;yt<vt;yt++)kt+=xe.transparency[yt]+" "+xe.transparency[yt]+" ";Dt.push({key:"Mask",value:"["+kt+"]"})}xe.sMask!==void 0&&Dt.push({key:"SMask",value:xe.objectId+1+" 0 R"});var sr=xe.filter!==void 0?["/"+xe.filter]:void 0;if(Ye({data:xe.data,additionalKeyValues:Dt,alreadyAppliedFilters:sr,objectId:xe.objectId}),Xe("endobj"),"sMask"in xe&&xe.sMask!==void 0){var Zt=(xe.predictor!=null?"/Predictor "+xe.predictor:"")+" /Colors 1 /BitsPerComponent 8 /Columns "+xe.width,he={width:xe.width,height:xe.height,colorSpace:"DeviceGray",bitsPerComponent:xe.bitsPerComponent,decodeParameters:Zt,data:xe.sMask};"filter"in xe&&(he.filter=xe.filter),me.call(this,he)}if(xe.colorSpace===ge.INDEXED){var Fe=this.internal.newObject();Ye({data:He(new Uint8Array(xe.palette)),objectId:Fe}),Xe("endobj")}},b=function(){var me=this.internal.collections[o+"images"];for(var xe in me)x.call(this,me[xe])},a=function(){var me,xe=this.internal.collections[o+"images"],Xe=this.internal.write;for(var Ye in xe)Xe("/I"+(me=xe[Ye]).index,me.objectId,"0","R")},C=function(){this.internal.collections[o+"images"]||(this.internal.collections[o+"images"]={},this.internal.events.subscribe("putResources",b),this.internal.events.subscribe("putXobjectDict",a))},F=function(){var me=this.internal.collections[o+"images"];return C.call(this),me},O=function(){return Object.keys(this.internal.collections[o+"images"]).length},Y=function(me){return typeof p["process"+me.toUpperCase()]=="function"},ee=function(me){return $i(me)==="object"&&me.nodeType===1},j=function(me,xe){if(me.nodeName==="IMG"&&me.hasAttribute("src")){var Xe=""+me.getAttribute("src");if(Xe.indexOf("data:image/")===0)return Ud(unescape(Xe).split("base64,").pop());var Ye=p.loadFile(Xe,!0);if(Ye!==void 0)return Ye}if(me.nodeName==="CANVAS"){if(me.width===0||me.height===0)throw new Error("Given canvas must have data. Canvas width: "+me.width+", height: "+me.height);var At;switch(xe){case"PNG":At="image/png";break;case"WEBP":At="image/webp";break;default:At="image/jpeg"}return Ud(me.toDataURL(At,1).split("base64,").pop())}},Pe=function(me){var xe=this.internal.collections[o+"images"];if(xe){for(var Xe in xe)if(me===xe[Xe].alias)return xe[Xe]}},ce=function(me,xe,Xe){return me||xe||(me=-96,xe=-96),me<0&&(me=-1*Xe.width*72/me/this.internal.scaleFactor),xe<0&&(xe=-1*Xe.height*72/xe/this.internal.scaleFactor),me===0&&(me=xe*Xe.width/Xe.height),xe===0&&(xe=me*Xe.height/Xe.width),[me,xe]},Q=function(me,xe,Xe,Ye,At,Dt){var kt=ce.call(this,Xe,Ye,At),yt=this.internal.getCoordinateString,vt=this.internal.getVerticalCoordinateString,sr=F.call(this);if(Xe=kt[0],Ye=kt[1],sr[At.index]=At,Dt){Dt*=Math.PI/180;var Zt=Math.cos(Dt),he=Math.sin(Dt),Fe=function(tt){return tt.toFixed(4)},$e=[Fe(Zt),Fe(he),Fe(-1*he),Fe(Zt),0,0,"cm"]}this.internal.write("q"),Dt?(this.internal.write([1,"0","0",1,yt(me),vt(xe+Ye),"cm"].join(" ")),this.internal.write($e.join(" ")),this.internal.write([yt(Xe),"0","0",yt(Ye),"0","0","cm"].join(" "))):this.internal.write([yt(Xe),"0","0",yt(Ye),yt(me),vt(xe+Ye),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+At.index+" Do"),this.internal.write("Q")},ge=p.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};p.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var Qe=p.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},Oe=p.__addimage__.sHashCode=function(me){var xe,Xe,Ye=0;if(typeof me=="string")for(Xe=me.length,xe=0;xe<Xe;xe++)Ye=(Ye<<5)-Ye+me.charCodeAt(xe),Ye|=0;else if(Ze(me))for(Xe=me.byteLength/2,xe=0;xe<Xe;xe++)Ye=(Ye<<5)-Ye+me[xe],Ye|=0;return Ye},Me=p.__addimage__.validateStringAsBase64=function(me){(me=me||"").toString().trim();var xe=!0;return me.length===0&&(xe=!1),me.length%4!=0&&(xe=!1),/^[A-Za-z0-9+/]+$/.test(me.substr(0,me.length-2))===!1&&(xe=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(me.substr(-2))===!1&&(xe=!1),xe},Ge=p.__addimage__.extractImageFromDataUrl=function(me){if(me==null||!(me=me.trim()).startsWith("data:"))return null;var xe=me.indexOf(",");return xe<0?null:me.substring(0,xe).trim().endsWith("base64")?me.substring(xe+1):null};p.__addimage__.isArrayBuffer=function(me){return me instanceof ArrayBuffer};var Ze=p.__addimage__.isArrayBufferView=function(me){return me instanceof Int8Array||me instanceof Uint8Array||me instanceof Uint8ClampedArray||me instanceof Int16Array||me instanceof Uint16Array||me instanceof Int32Array||me instanceof Uint32Array||me instanceof Float32Array||me instanceof Float64Array},it=p.__addimage__.binaryStringToUint8Array=function(me){for(var xe=me.length,Xe=new Uint8Array(xe),Ye=0;Ye<xe;Ye++)Xe[Ye]=me.charCodeAt(Ye);return Xe},He=p.__addimage__.arrayBufferToBinaryString=function(me){for(var xe="",Xe=Ze(me)?me:new Uint8Array(me),Ye=0;Ye<Xe.length;Ye+=8192)xe+=String.fromCharCode.apply(null,Xe.subarray(Ye,Ye+8192));return xe};p.addImage=function(){var me,xe,Xe,Ye,At,Dt,kt,yt,vt;if(typeof arguments[1]=="number"?(xe=u,Xe=arguments[1],Ye=arguments[2],At=arguments[3],Dt=arguments[4],kt=arguments[5],yt=arguments[6],vt=arguments[7]):(xe=arguments[1],Xe=arguments[2],Ye=arguments[3],At=arguments[4],Dt=arguments[5],kt=arguments[6],yt=arguments[7],vt=arguments[8]),$i(me=arguments[0])==="object"&&!ee(me)&&"imageData"in me){var sr=me;me=sr.imageData,xe=sr.format||xe||u,Xe=sr.x||Xe||0,Ye=sr.y||Ye||0,At=sr.w||sr.width||At,Dt=sr.h||sr.height||Dt,kt=sr.alias||kt,yt=sr.compression||yt,vt=sr.rotation||sr.angle||vt}var Zt=this.internal.getFilters();if(yt===void 0&&Zt.indexOf("FlateEncode")!==-1&&(yt="SLOW"),isNaN(Xe)||isNaN(Ye))throw new Error("Invalid coordinates passed to jsPDF.addImage");C.call(this);var he=Te.call(this,me,xe,kt,yt);return Q.call(this,Xe,Ye,At,Dt,he,vt),this};var Te=function(me,xe,Xe,Ye){var At,Dt,kt;if(typeof me=="string"&&v(me)===u){me=unescape(me);var yt=st(me,!1);(yt!==""||(yt=p.loadFile(me,!0))!==void 0)&&(me=yt)}if(ee(me)&&(me=j(me,xe)),xe=v(me,xe),!Y(xe))throw new Error("addImage does not support files of type '"+xe+"', please ensure that a plugin for '"+xe+"' support is added.");if(((kt=Xe)==null||kt.length===0)&&(Xe=function(vt){return typeof vt=="string"||Ze(vt)?Oe(vt):Ze(vt.data)?Oe(vt.data):null}(me)),(At=Pe.call(this,Xe))||(me instanceof Uint8Array||xe==="RGBA"||(Dt=me,me=it(me)),At=this["process"+xe.toUpperCase()](me,O.call(this),Xe,function(vt){return vt&&typeof vt=="string"&&(vt=vt.toUpperCase()),vt in p.image_compression?vt:Qe.NONE}(Ye),Dt)),!At)throw new Error("An unknown error occurred whilst processing the image.");return At},st=p.__addimage__.convertBase64ToBinaryString=function(me,xe){xe=typeof xe!="boolean"||xe;var Xe,Ye="";if(typeof me=="string"){var At;Xe=(At=Ge(me))!==null&&At!==void 0?At:me;try{Ye=Ud(Xe)}catch(Dt){if(xe)throw Me(Xe)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+Dt.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return Ye};p.getImageProperties=function(me){var xe,Xe,Ye="";if(ee(me)&&(me=j(me)),typeof me=="string"&&v(me)===u&&((Ye=st(me,!1))===""&&(Ye=p.loadFile(me)||""),me=Ye),Xe=v(me),!Y(Xe))throw new Error("addImage does not support files of type '"+Xe+"', please ensure that a plugin for '"+Xe+"' support is added.");if(me instanceof Uint8Array||(me=it(me)),!(xe=this["process"+Xe.toUpperCase()](me)))throw new Error("An unknown error occurred whilst processing the image");return xe.fileType=Xe,xe}})(qr.API),function(p){var o=function(u){if(u!==void 0&&u!="")return!0};qr.API.events.push(["addPage",function(u){this.internal.getPageInfo(u.pageNumber).pageContext.annotations=[]}]),p.events.push(["putPage",function(u){for(var m,v,x,b=this.internal.getCoordinateString,a=this.internal.getVerticalCoordinateString,C=this.internal.getPageInfoByObjId(u.objId),F=u.pageContext.annotations,O=!1,Y=0;Y<F.length&&!O;Y++)switch((m=F[Y]).type){case"link":(o(m.options.url)||o(m.options.pageNumber))&&(O=!0);break;case"reference":case"text":case"freetext":O=!0}if(O!=0){this.internal.write("/Annots [");for(var ee=0;ee<F.length;ee++){m=F[ee];var j=this.internal.pdfEscape,Pe=this.internal.getEncryptor(u.objId);switch(m.type){case"reference":this.internal.write(" "+m.object.objId+" 0 R ");break;case"text":var ce=this.internal.newAdditionalObject(),Q=this.internal.newAdditionalObject(),ge=this.internal.getEncryptor(ce.objId),Qe=m.title||"Note";x="<</Type /Annot /Subtype /Text "+(v="/Rect ["+b(m.bounds.x)+" "+a(m.bounds.y+m.bounds.h)+" "+b(m.bounds.x+m.bounds.w)+" "+a(m.bounds.y)+"] ")+"/Contents ("+j(ge(m.contents))+")",x+=" /Popup "+Q.objId+" 0 R",x+=" /P "+C.objId+" 0 R",x+=" /T ("+j(ge(Qe))+") >>",ce.content=x;var Oe=ce.objId+" 0 R";x="<</Type /Annot /Subtype /Popup "+(v="/Rect ["+b(m.bounds.x+30)+" "+a(m.bounds.y+m.bounds.h)+" "+b(m.bounds.x+m.bounds.w+30)+" "+a(m.bounds.y)+"] ")+" /Parent "+Oe,m.open&&(x+=" /Open true"),x+=" >>",Q.content=x,this.internal.write(ce.objId,"0 R",Q.objId,"0 R");break;case"freetext":v="/Rect ["+b(m.bounds.x)+" "+a(m.bounds.y)+" "+b(m.bounds.x+m.bounds.w)+" "+a(m.bounds.y+m.bounds.h)+"] ";var Me=m.color||"#000000";x="<</Type /Annot /Subtype /FreeText "+v+"/Contents ("+j(Pe(m.contents))+")",x+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+Me+")",x+=" /Border [0 0 0]",x+=" >>",this.internal.write(x);break;case"link":if(m.options.name){var Ge=this.annotations._nameMap[m.options.name];m.options.pageNumber=Ge.page,m.options.top=Ge.y}else m.options.top||(m.options.top=0);if(v="/Rect ["+m.finalBounds.x+" "+m.finalBounds.y+" "+m.finalBounds.w+" "+m.finalBounds.h+"] ",x="",m.options.url)x="<</Type /Annot /Subtype /Link "+v+"/Border [0 0 0] /A <</S /URI /URI ("+j(Pe(m.options.url))+") >>";else if(m.options.pageNumber)switch(x="<</Type /Annot /Subtype /Link "+v+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(m.options.pageNumber).objId+" 0 R",m.options.magFactor=m.options.magFactor||"XYZ",m.options.magFactor){case"Fit":x+=" /Fit]";break;case"FitH":x+=" /FitH "+m.options.top+"]";break;case"FitV":m.options.left=m.options.left||0,x+=" /FitV "+m.options.left+"]";break;default:var Ze=a(m.options.top);m.options.left=m.options.left||0,m.options.zoom===void 0&&(m.options.zoom=0),x+=" /XYZ "+m.options.left+" "+Ze+" "+m.options.zoom+"]"}x!=""&&(x+=" >>",this.internal.write(x))}}this.internal.write("]")}}]),p.createAnnotation=function(u){var m=this.internal.getCurrentPageInfo();switch(u.type){case"link":this.link(u.bounds.x,u.bounds.y,u.bounds.w,u.bounds.h,u);break;case"text":case"freetext":m.pageContext.annotations.push(u)}},p.link=function(u,m,v,x,b){var a=this.internal.getCurrentPageInfo(),C=this.internal.getCoordinateString,F=this.internal.getVerticalCoordinateString;a.pageContext.annotations.push({finalBounds:{x:C(u),y:F(m),w:C(u+v),h:F(m+x)},options:b,type:"link"})},p.textWithLink=function(u,m,v,x){var b,a,C=this.getTextWidth(u),F=this.internal.getLineHeight()/this.internal.scaleFactor;if(x.maxWidth!==void 0){a=x.maxWidth;var O=this.splitTextToSize(u,a).length;b=Math.ceil(F*O)}else a=C,b=F;return this.text(u,m,v,x),v+=.2*F,x.align==="center"&&(m-=C/2),x.align==="right"&&(m-=C),this.link(m,v-F,a,b,x),C},p.getTextWidth=function(u){var m=this.internal.getFontSize();return this.getStringUnitWidth(u)*m/this.internal.scaleFactor}}(qr.API),function(p){var o={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},u={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},m={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},v=[1570,1571,1573,1575];p.__arabicParser__={};var x=p.__arabicParser__.isInArabicSubstitutionA=function(ce){return o[ce.charCodeAt(0)]!==void 0},b=p.__arabicParser__.isArabicLetter=function(ce){return typeof ce=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(ce)},a=p.__arabicParser__.isArabicEndLetter=function(ce){return b(ce)&&x(ce)&&o[ce.charCodeAt(0)].length<=2},C=p.__arabicParser__.isArabicAlfLetter=function(ce){return b(ce)&&v.indexOf(ce.charCodeAt(0))>=0};p.__arabicParser__.arabicLetterHasIsolatedForm=function(ce){return b(ce)&&x(ce)&&o[ce.charCodeAt(0)].length>=1};var F=p.__arabicParser__.arabicLetterHasFinalForm=function(ce){return b(ce)&&x(ce)&&o[ce.charCodeAt(0)].length>=2};p.__arabicParser__.arabicLetterHasInitialForm=function(ce){return b(ce)&&x(ce)&&o[ce.charCodeAt(0)].length>=3};var O=p.__arabicParser__.arabicLetterHasMedialForm=function(ce){return b(ce)&&x(ce)&&o[ce.charCodeAt(0)].length==4},Y=p.__arabicParser__.resolveLigatures=function(ce){var Q=0,ge=u,Qe="",Oe=0;for(Q=0;Q<ce.length;Q+=1)ge[ce.charCodeAt(Q)]!==void 0?(Oe++,typeof(ge=ge[ce.charCodeAt(Q)])=="number"&&(Qe+=String.fromCharCode(ge),ge=u,Oe=0),Q===ce.length-1&&(ge=u,Qe+=ce.charAt(Q-(Oe-1)),Q-=Oe-1,Oe=0)):(ge=u,Qe+=ce.charAt(Q-Oe),Q-=Oe,Oe=0);return Qe};p.__arabicParser__.isArabicDiacritic=function(ce){return ce!==void 0&&m[ce.charCodeAt(0)]!==void 0};var ee=p.__arabicParser__.getCorrectForm=function(ce,Q,ge){return b(ce)?x(ce)===!1?-1:!F(ce)||!b(Q)&&!b(ge)||!b(ge)&&a(Q)||a(ce)&&!b(Q)||a(ce)&&C(Q)||a(ce)&&a(Q)?0:O(ce)&&b(Q)&&!a(Q)&&b(ge)&&F(ge)?3:a(ce)||!b(ge)?1:2:-1},j=function(ce){var Q=0,ge=0,Qe=0,Oe="",Me="",Ge="",Ze=(ce=ce||"").split("\\s+"),it=[];for(Q=0;Q<Ze.length;Q+=1){for(it.push(""),ge=0;ge<Ze[Q].length;ge+=1)Oe=Ze[Q][ge],Me=Ze[Q][ge-1],Ge=Ze[Q][ge+1],b(Oe)?(Qe=ee(Oe,Me,Ge),it[Q]+=Qe!==-1?String.fromCharCode(o[Oe.charCodeAt(0)][Qe]):Oe):it[Q]+=Oe;it[Q]=Y(it[Q])}return it.join(" ")},Pe=p.__arabicParser__.processArabic=p.processArabic=function(){var ce,Q=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,ge=[];if(Array.isArray(Q)){var Qe=0;for(ge=[],Qe=0;Qe<Q.length;Qe+=1)Array.isArray(Q[Qe])?ge.push([j(Q[Qe][0]),Q[Qe][1],Q[Qe][2]]):ge.push([j(Q[Qe])]);ce=ge}else ce=j(Q);return typeof arguments[0]=="string"?ce:(arguments[0].text=ce,arguments[0])};p.events.push(["preProcessText",Pe])}(qr.API),qr.API.autoPrint=function(p){var o;return(p=p||{}).variant=p.variant||"non-conform",p.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){o=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+o+" 0 R")})),this},function(p){var o=function(){var u=void 0;Object.defineProperty(this,"pdf",{get:function(){return u},set:function(a){u=a}});var m=150;Object.defineProperty(this,"width",{get:function(){return m},set:function(a){m=isNaN(a)||Number.isInteger(a)===!1||a<0?150:a,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=m+1)}});var v=300;Object.defineProperty(this,"height",{get:function(){return v},set:function(a){v=isNaN(a)||Number.isInteger(a)===!1||a<0?300:a,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=v+1)}});var x=[];Object.defineProperty(this,"childNodes",{get:function(){return x},set:function(a){x=a}});var b={};Object.defineProperty(this,"style",{get:function(){return b},set:function(a){b=a}}),Object.defineProperty(this,"parentNode",{})};o.prototype.getContext=function(u,m){var v;if((u=u||"2d")!=="2d")return null;for(v in m)this.pdf.context2d.hasOwnProperty(v)&&(this.pdf.context2d[v]=m[v]);return this.pdf.context2d._canvas=this,this.pdf.context2d},o.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},p.events.push(["initialized",function(){this.canvas=new o,this.canvas.pdf=this}])}(qr.API),function(p){var o={left:0,top:0,bottom:0,right:0},u=!1,m=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},o),this.internal.__cell__.margins.width=this.getPageWidth(),v.call(this))},v=function(){this.internal.__cell__.lastCell=new x,this.internal.__cell__.pages=1},x=function(){var C=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return C},set:function(ce){C=ce}});var F=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return F},set:function(ce){F=ce}});var O=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return O},set:function(ce){O=ce}});var Y=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return Y},set:function(ce){Y=ce}});var ee=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return ee},set:function(ce){ee=ce}});var j=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return j},set:function(ce){j=ce}});var Pe=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return Pe},set:function(ce){Pe=ce}}),this};x.prototype.clone=function(){return new x(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},x.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},p.setHeaderFunction=function(C){return m.call(this),this.internal.__cell__.headerFunction=typeof C=="function"?C:void 0,this},p.getTextDimensions=function(C,F){m.call(this);var O=(F=F||{}).fontSize||this.getFontSize(),Y=F.font||this.getFont(),ee=F.scaleFactor||this.internal.scaleFactor,j=0,Pe=0,ce=0,Q=this;if(!Array.isArray(C)&&typeof C!="string"){if(typeof C!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");C=String(C)}var ge=F.maxWidth;ge>0?typeof C=="string"?C=this.splitTextToSize(C,ge):Object.prototype.toString.call(C)==="[object Array]"&&(C=C.reduce(function(Oe,Me){return Oe.concat(Q.splitTextToSize(Me,ge))},[])):C=Array.isArray(C)?C:[C];for(var Qe=0;Qe<C.length;Qe++)j<(ce=this.getStringUnitWidth(C[Qe],{font:Y})*O)&&(j=ce);return j!==0&&(Pe=C.length),{w:j/=ee,h:Math.max((Pe*O*this.getLineHeightFactor()-O*(this.getLineHeightFactor()-1))/ee,0)}},p.cellAddPage=function(){m.call(this),this.addPage();var C=this.internal.__cell__.margins||o;return this.internal.__cell__.lastCell=new x(C.left,C.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var b=p.cell=function(){var C;C=arguments[0]instanceof x?arguments[0]:new x(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),m.call(this);var F=this.internal.__cell__.lastCell,O=this.internal.__cell__.padding,Y=this.internal.__cell__.margins||o,ee=this.internal.__cell__.tableHeaderRow,j=this.internal.__cell__.printHeaders;return F.lineNumber!==void 0&&(F.lineNumber===C.lineNumber?(C.x=(F.x||0)+(F.width||0),C.y=F.y||0):F.y+F.height+C.height+Y.bottom>this.getPageHeight()?(this.cellAddPage(),C.y=Y.top,j&&ee&&(this.printHeaderRow(C.lineNumber,!0),C.y+=ee[0].height)):C.y=F.y+F.height||C.y),C.text[0]!==void 0&&(this.rect(C.x,C.y,C.width,C.height,u===!0?"FD":void 0),C.align==="right"?this.text(C.text,C.x+C.width-O,C.y+O,{align:"right",baseline:"top"}):C.align==="center"?this.text(C.text,C.x+C.width/2,C.y+O,{align:"center",baseline:"top",maxWidth:C.width-O-O}):this.text(C.text,C.x+O,C.y+O,{align:"left",baseline:"top",maxWidth:C.width-O-O})),this.internal.__cell__.lastCell=C,this};p.table=function(C,F,O,Y,ee){if(m.call(this),!O)throw new Error("No data for PDF table.");var j,Pe,ce,Q,ge=[],Qe=[],Oe=[],Me={},Ge={},Ze=[],it=[],He=(ee=ee||{}).autoSize||!1,Te=ee.printHeaders!==!1,st=ee.css&&ee.css["font-size"]!==void 0?16*ee.css["font-size"]:ee.fontSize||12,me=ee.margins||Object.assign({width:this.getPageWidth()},o),xe=typeof ee.padding=="number"?ee.padding:3,Xe=ee.headerBackgroundColor||"#c8c8c8",Ye=ee.headerTextColor||"#000";if(v.call(this),this.internal.__cell__.printHeaders=Te,this.internal.__cell__.margins=me,this.internal.__cell__.table_font_size=st,this.internal.__cell__.padding=xe,this.internal.__cell__.headerBackgroundColor=Xe,this.internal.__cell__.headerTextColor=Ye,this.setFontSize(st),Y==null)Qe=ge=Object.keys(O[0]),Oe=ge.map(function(){return"left"});else if(Array.isArray(Y)&&$i(Y[0])==="object")for(ge=Y.map(function(sr){return sr.name}),Qe=Y.map(function(sr){return sr.prompt||sr.name||""}),Oe=Y.map(function(sr){return sr.align||"left"}),j=0;j<Y.length;j+=1)Ge[Y[j].name]=.7499990551181103*Y[j].width;else Array.isArray(Y)&&typeof Y[0]=="string"&&(Qe=ge=Y,Oe=ge.map(function(){return"left"}));if(He||Array.isArray(Y)&&typeof Y[0]=="string")for(j=0;j<ge.length;j+=1){for(Me[Q=ge[j]]=O.map(function(sr){return sr[Q]}),this.setFont(void 0,"bold"),Ze.push(this.getTextDimensions(Qe[j],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),Pe=Me[Q],this.setFont(void 0,"normal"),ce=0;ce<Pe.length;ce+=1)Ze.push(this.getTextDimensions(Pe[ce],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);Ge[Q]=Math.max.apply(null,Ze)+xe+xe,Ze=[]}if(Te){var At={};for(j=0;j<ge.length;j+=1)At[ge[j]]={},At[ge[j]].text=Qe[j],At[ge[j]].align=Oe[j];var Dt=a.call(this,At,Ge);it=ge.map(function(sr){return new x(C,F,Ge[sr],Dt,At[sr].text,void 0,At[sr].align)}),this.setTableHeaderRow(it),this.printHeaderRow(1,!1)}var kt=Y.reduce(function(sr,Zt){return sr[Zt.name]=Zt.align,sr},{});for(j=0;j<O.length;j+=1){"rowStart"in ee&&ee.rowStart instanceof Function&&ee.rowStart({row:j,data:O[j]},this);var yt=a.call(this,O[j],Ge);for(ce=0;ce<ge.length;ce+=1){var vt=O[j][ge[ce]];"cellStart"in ee&&ee.cellStart instanceof Function&&ee.cellStart({row:j,col:ce,data:vt},this),b.call(this,new x(C,F,Ge[ge[ce]],yt,vt,j+2,kt[ge[ce]]))}}return this.internal.__cell__.table_x=C,this.internal.__cell__.table_y=F,this};var a=function(C,F){var O=this.internal.__cell__.padding,Y=this.internal.__cell__.table_font_size,ee=this.internal.scaleFactor;return Object.keys(C).map(function(j){var Pe=C[j];return this.splitTextToSize(Pe.hasOwnProperty("text")?Pe.text:Pe,F[j]-O-O)},this).map(function(j){return this.getLineHeightFactor()*j.length*Y/ee+O+O},this).reduce(function(j,Pe){return Math.max(j,Pe)},0)};p.setTableHeaderRow=function(C){m.call(this),this.internal.__cell__.tableHeaderRow=C},p.printHeaderRow=function(C,F){if(m.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var O;if(u=!0,typeof this.internal.__cell__.headerFunction=="function"){var Y=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new x(Y[0],Y[1],Y[2],Y[3],void 0,-1)}this.setFont(void 0,"bold");for(var ee=[],j=0;j<this.internal.__cell__.tableHeaderRow.length;j+=1){O=this.internal.__cell__.tableHeaderRow[j].clone(),F&&(O.y=this.internal.__cell__.margins.top||0,ee.push(O)),O.lineNumber=C;var Pe=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),b.call(this,O),this.setTextColor(Pe)}ee.length>0&&this.setTableHeaderRow(ee),this.setFont(void 0,"normal"),u=!1}}(qr.API);var R0={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},z0=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],Vp=F0(z0),N0=[100,200,300,400,500,600,700,800,900],Nw=F0(N0);function Ap(p){var o=p.family.replace(/"|'/g,"").toLowerCase(),u=function(x){return R0[x=x||"normal"]?x:"normal"}(p.style),m=function(x){return x?typeof x=="number"?x>=100&&x<=900&&x%100==0?x:400:/^\d00$/.test(x)?parseInt(x):x==="bold"?700:400:400}(p.weight),v=function(x){return typeof Vp[x=x||"normal"]=="number"?x:"normal"}(p.stretch);return{family:o,style:u,weight:m,stretch:v,src:p.src||[],ref:p.ref||{name:o,style:[v,u,m].join(" ")}}}function xy(p,o,u,m){var v;for(v=u;v>=0&&v<o.length;v+=m)if(p[o[v]])return p[o[v]];for(v=u;v>=0&&v<o.length;v-=m)if(p[o[v]])return p[o[v]]}var Ow={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},wy={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function Sy(p){return[p.stretch,p.style,p.weight,p.family].join(" ")}function Ty(p){return p.trimLeft()}function Bw(p,o){for(var u=0;u<p.length;){if(p.charAt(u)===o)return[p.substring(0,u),p.substring(u+1)];u+=1}return null}function jw(p){var o=p.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return o===null?null:[o[0],p.substring(o[0].length)]}var zd,Py,Ay,eh,Nd,Iy,Ey,Ly,My=["times"];function Cy(p,o,u,m){var v=4,x=Dy;switch(m){case qr.API.image_compression.FAST:v=1,x=ky;break;case qr.API.image_compression.MEDIUM:v=6,x=Fy;break;case qr.API.image_compression.SLOW:v=9,x=Ry}p=function(a,C,F,O){for(var Y,ee=a.length/C,j=new Uint8Array(a.length+ee),Pe=[Uw,ky,Dy,Fy,Ry],ce=0;ce<ee;ce+=1){var Q=ce*C,ge=a.subarray(Q,Q+C);if(O)j.set(O(ge,F,Y),Q+ce);else{for(var Qe=Pe.length,Oe=[],Me=0;Me<Qe;Me+=1)Oe[Me]=Pe[Me](ge,F,Y);var Ge=qw(Oe.concat());j.set(Oe[Ge],Q+ce)}Y=ge}return j}(p,o,u,x);var b=Rp(p,{level:v});return qr.API.__addimage__.arrayBufferToBinaryString(b)}function Uw(p){var o=Array.apply([],p);return o.unshift(0),o}function ky(p,o){var u=p.length,m=[];m[0]=1;for(var v=0;v<u;v+=1){var x=p[v-o]||0;m[v+1]=p[v]-x+256&255}return m}function Dy(p,o,u){var m=p.length,v=[];v[0]=2;for(var x=0;x<m;x+=1){var b=u&&u[x]||0;v[x+1]=p[x]-b+256&255}return v}function Fy(p,o,u){var m=p.length,v=[];v[0]=3;for(var x=0;x<m;x+=1){var b=p[x-o]||0,a=u&&u[x]||0;v[x+1]=p[x]+256-(b+a>>>1)&255}return v}function Ry(p,o,u){var m=p.length,v=[];v[0]=4;for(var x=0;x<m;x+=1){var b=Vw(p[x-o]||0,u&&u[x]||0,u&&u[x-o]||0);v[x+1]=p[x]-b+256&255}return v}function Vw(p,o,u){if(p===o&&o===u)return p;var m=Math.abs(o-u),v=Math.abs(p-u),x=Math.abs(p+o-u-u);return m<=v&&m<=x?p:v<=x?o:u}function qw(p){var o=p.map(function(u){return u.reduce(function(m,v){return m+Math.abs(v)},0)});return o.indexOf(Math.min.apply(null,o))}function Ip(p,o,u){var m=o*u,v=Math.floor(m/8),x=16-(m-8*v+u),b=(1<<u)-1;return O0(p,v)>>x&b}function zy(p,o,u,m){var v=u*m,x=Math.floor(v/8),b=16-(v-8*x+m),a=(1<<m)-1,C=(o&a)<<b;(function(F,O,Y){if(O+1<F.byteLength)F.setUint16(O,Y,!1);else{var ee=Y>>8&255;F.setUint8(O,ee)}})(p,x,O0(p,x)&~(a<<b)&65535|C)}function O0(p,o){return o+1<p.byteLength?p.getUint16(o,!1):p.getUint8(o)<<8}function Gw(p){var o=0;if(p[o++]!==71||p[o++]!==73||p[o++]!==70||p[o++]!==56||(p[o++]+1&253)!=56||p[o++]!==97)throw new Error("Invalid GIF 87a/89a header.");var u=p[o++]|p[o++]<<8,m=p[o++]|p[o++]<<8,v=p[o++],x=v>>7,b=1<<1+(7&v);p[o++],p[o++];var a=null,C=null;x&&(a=o,C=b,o+=3*b);var F=!0,O=[],Y=0,ee=null,j=0,Pe=null;for(this.width=u,this.height=m;F&&o<p.length;)switch(p[o++]){case 33:switch(p[o++]){case 255:if(p[o]!==11||p[o+1]==78&&p[o+2]==69&&p[o+3]==84&&p[o+4]==83&&p[o+5]==67&&p[o+6]==65&&p[o+7]==80&&p[o+8]==69&&p[o+9]==50&&p[o+10]==46&&p[o+11]==48&&p[o+12]==3&&p[o+13]==1&&p[o+16]==0)o+=14,Pe=p[o++]|p[o++]<<8,o++;else for(o+=12;;){if(!((me=p[o++])>=0))throw Error("Invalid block size");if(me===0)break;o+=me}break;case 249:if(p[o++]!==4||p[o+4]!==0)throw new Error("Invalid graphics extension block.");var ce=p[o++];Y=p[o++]|p[o++]<<8,ee=p[o++],1&ce||(ee=null),j=ce>>2&7,o++;break;case 254:for(;;){if(!((me=p[o++])>=0))throw Error("Invalid block size");if(me===0)break;o+=me}break;default:throw new Error("Unknown graphic control label: 0x"+p[o-1].toString(16))}break;case 44:var Q=p[o++]|p[o++]<<8,ge=p[o++]|p[o++]<<8,Qe=p[o++]|p[o++]<<8,Oe=p[o++]|p[o++]<<8,Me=p[o++],Ge=Me>>6&1,Ze=1<<1+(7&Me),it=a,He=C,Te=!1;Me>>7&&(Te=!0,it=o,He=Ze,o+=3*Ze);var st=o;for(o++;;){var me;if(!((me=p[o++])>=0))throw Error("Invalid block size");if(me===0)break;o+=me}O.push({x:Q,y:ge,width:Qe,height:Oe,has_local_palette:Te,palette_offset:it,palette_size:He,data_offset:st,data_length:o-st,transparent_index:ee,interlaced:!!Ge,delay:Y,disposal:j});break;case 59:F=!1;break;default:throw new Error("Unknown gif block: 0x"+p[o-1].toString(16))}this.numFrames=function(){return O.length},this.loopCount=function(){return Pe},this.frameInfo=function(xe){if(xe<0||xe>=O.length)throw new Error("Frame index out of range.");return O[xe]},this.decodeAndBlitFrameBGRA=function(xe,Xe){var Ye=this.frameInfo(xe),At=Ye.width*Ye.height,Dt=new Uint8Array(At);Ny(p,Ye.data_offset,Dt,At);var kt=Ye.palette_offset,yt=Ye.transparent_index;yt===null&&(yt=256);var vt=Ye.width,sr=u-vt,Zt=vt,he=4*(Ye.y*u+Ye.x),Fe=4*((Ye.y+Ye.height)*u+Ye.x),$e=he,tt=4*sr;Ye.interlaced===!0&&(tt+=4*u*7);for(var ct=8,ut=0,pt=Dt.length;ut<pt;++ut){var wt=Dt[ut];if(Zt===0&&(Zt=vt,($e+=tt)>=Fe&&(tt=4*sr+4*u*(ct-1),$e=he+(vt+sr)*(ct<<1),ct>>=1)),wt===yt)$e+=4;else{var Bt=p[kt+3*wt],er=p[kt+3*wt+1],ur=p[kt+3*wt+2];Xe[$e++]=ur,Xe[$e++]=er,Xe[$e++]=Bt,Xe[$e++]=255}--Zt}},this.decodeAndBlitFrameRGBA=function(xe,Xe){var Ye=this.frameInfo(xe),At=Ye.width*Ye.height,Dt=new Uint8Array(At);Ny(p,Ye.data_offset,Dt,At);var kt=Ye.palette_offset,yt=Ye.transparent_index;yt===null&&(yt=256);var vt=Ye.width,sr=u-vt,Zt=vt,he=4*(Ye.y*u+Ye.x),Fe=4*((Ye.y+Ye.height)*u+Ye.x),$e=he,tt=4*sr;Ye.interlaced===!0&&(tt+=4*u*7);for(var ct=8,ut=0,pt=Dt.length;ut<pt;++ut){var wt=Dt[ut];if(Zt===0&&(Zt=vt,($e+=tt)>=Fe&&(tt=4*sr+4*u*(ct-1),$e=he+(vt+sr)*(ct<<1),ct>>=1)),wt===yt)$e+=4;else{var Bt=p[kt+3*wt],er=p[kt+3*wt+1],ur=p[kt+3*wt+2];Xe[$e++]=Bt,Xe[$e++]=er,Xe[$e++]=ur,Xe[$e++]=255}--Zt}}}function Ny(p,o,u,m){for(var v=p[o++],x=1<<v,b=x+1,a=b+1,C=v+1,F=(1<<C)-1,O=0,Y=0,ee=0,j=p[o++],Pe=new Int32Array(4096),ce=null;;){for(;O<16&&j!==0;)Y|=p[o++]<<O,O+=8,j===1?j=p[o++]:--j;if(O<C)break;var Q=Y&F;if(Y>>=C,O-=C,Q!==x){if(Q===b)break;for(var ge=Q<a?Q:ce,Qe=0,Oe=ge;Oe>x;)Oe=Pe[Oe]>>8,++Qe;var Me=Oe;if(ee+Qe+(ge!==Q?1:0)>m)return void nn.log("Warning, gif stream longer than expected.");u[ee++]=Me;var Ge=ee+=Qe;for(ge!==Q&&(u[ee++]=Me),Oe=ge;Qe--;)Oe=Pe[Oe],u[--Ge]=255&Oe,Oe>>=8;ce!==null&&a<4096&&(Pe[a++]=ce<<8|Me,a>=F+1&&C<12&&(++C,F=F<<1|1)),ce=Q}else a=b+1,F=(1<<(C=v+1))-1,ce=null}return ee!==m&&nn.log("Warning, gif stream shorter than expected."),u}function Ep(p){var o,u,m,v,x,b=Math.floor,a=new Array(64),C=new Array(64),F=new Array(64),O=new Array(64),Y=new Array(65535),ee=new Array(65535),j=new Array(64),Pe=new Array(64),ce=[],Q=0,ge=7,Qe=new Array(64),Oe=new Array(64),Me=new Array(64),Ge=new Array(256),Ze=new Array(2048),it=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],He=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],Te=[0,1,2,3,4,5,6,7,8,9,10,11],st=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],me=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],xe=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Xe=[0,1,2,3,4,5,6,7,8,9,10,11],Ye=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],At=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Dt(he,Fe){for(var $e=0,tt=0,ct=new Array,ut=1;ut<=16;ut++){for(var pt=1;pt<=he[ut];pt++)ct[Fe[tt]]=[],ct[Fe[tt]][0]=$e,ct[Fe[tt]][1]=ut,tt++,$e++;$e*=2}return ct}function kt(he){for(var Fe=he[0],$e=he[1]-1;$e>=0;)Fe&1<<$e&&(Q|=1<<ge),$e--,--ge<0&&(Q==255?(yt(255),yt(0)):yt(Q),ge=7,Q=0)}function yt(he){ce.push(he)}function vt(he){yt(he>>8&255),yt(255&he)}function sr(he,Fe,$e,tt,ct){for(var ut,pt=ct[0],wt=ct[240],Bt=function(ir,Ar){var mr,Vr,Lr,ai,Rr,nt,re,K,se,Ie,Ce=0;for(se=0;se<8;++se){mr=ir[Ce],Vr=ir[Ce+1],Lr=ir[Ce+2],ai=ir[Ce+3],Rr=ir[Ce+4],nt=ir[Ce+5],re=ir[Ce+6];var ht=mr+(K=ir[Ce+7]),at=mr-K,Be=Vr+re,ot=Vr-re,Rt=Lr+nt,te=Lr-nt,I=ai+Rr,D=ai-Rr,fe=ht+I,Ee=ht-I,qe=Be+Rt,ae=Be-Rt;ir[Ce]=fe+qe,ir[Ce+4]=fe-qe;var ft=.707106781*(ae+Ee);ir[Ce+2]=Ee+ft,ir[Ce+6]=Ee-ft;var Nt=.382683433*((fe=D+te)-(ae=ot+at)),gt=.5411961*fe+Nt,Lt=1.306562965*ae+Nt,Ht=.707106781*(qe=te+ot),Mt=at+Ht,rr=at-Ht;ir[Ce+5]=rr+gt,ir[Ce+3]=rr-gt,ir[Ce+1]=Mt+Lt,ir[Ce+7]=Mt-Lt,Ce+=8}for(Ce=0,se=0;se<8;++se){mr=ir[Ce],Vr=ir[Ce+8],Lr=ir[Ce+16],ai=ir[Ce+24],Rr=ir[Ce+32],nt=ir[Ce+40],re=ir[Ce+48];var Ut=mr+(K=ir[Ce+56]),gr=mr-K,Xr=Vr+re,ri=Vr-re,Ot=Lr+nt,kr=Lr-nt,Fi=ai+Rr,Ln=ai-Rr,Zi=Ut+Fi,nr=Ut-Fi,Br=Xr+Ot,Or=Xr-Ot;ir[Ce]=Zi+Br,ir[Ce+32]=Zi-Br;var Oi=.707106781*(Or+nr);ir[Ce+16]=nr+Oi,ir[Ce+48]=nr-Oi;var Bs=.382683433*((Zi=Ln+kr)-(Or=ri+gr)),Mn=.5411961*Zi+Bs,Gr=1.306562965*Or+Bs,ya=.707106781*(Br=kr+ri),va=gr+ya,Ra=gr-ya;ir[Ce+40]=Ra+Mn,ir[Ce+24]=Ra-Mn,ir[Ce+8]=va+Gr,ir[Ce+56]=va-Gr,Ce++}for(se=0;se<64;++se)Ie=ir[se]*Ar[se],j[se]=Ie>0?Ie+.5|0:Ie-.5|0;return j}(he,Fe),er=0;er<64;++er)Pe[it[er]]=Bt[er];var ur=Pe[0]-$e;$e=Pe[0],ur==0?kt(tt[0]):(kt(tt[ee[ut=32767+ur]]),kt(Y[ut]));for(var fr=63;fr>0&&Pe[fr]==0;)fr--;if(fr==0)return kt(pt),$e;for(var Ft,Ue=1;Ue<=fr;){for(var Yr=Ue;Pe[Ue]==0&&Ue<=fr;)++Ue;var wr=Ue-Yr;if(wr>=16){Ft=wr>>4;for(var Tr=1;Tr<=Ft;++Tr)kt(wt);wr&=15}ut=32767+Pe[Ue],kt(ct[(wr<<4)+ee[ut]]),kt(Y[ut]),Ue++}return fr!=63&&kt(pt),$e}function Zt(he){he=Math.min(Math.max(he,1),100),x!=he&&(function(Fe){for(var $e=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],tt=0;tt<64;tt++){var ct=b(($e[tt]*Fe+50)/100);ct=Math.min(Math.max(ct,1),255),a[it[tt]]=ct}for(var ut=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],pt=0;pt<64;pt++){var wt=b((ut[pt]*Fe+50)/100);wt=Math.min(Math.max(wt,1),255),C[it[pt]]=wt}for(var Bt=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],er=0,ur=0;ur<8;ur++)for(var fr=0;fr<8;fr++)F[er]=1/(a[it[er]]*Bt[ur]*Bt[fr]*8),O[er]=1/(C[it[er]]*Bt[ur]*Bt[fr]*8),er++}(he<50?Math.floor(5e3/he):Math.floor(200-2*he)),x=he)}this.encode=function(he,Fe){Fe&&Zt(Fe),ce=new Array,Q=0,ge=7,vt(65496),vt(65504),vt(16),yt(74),yt(70),yt(73),yt(70),yt(0),yt(1),yt(1),yt(0),vt(1),vt(1),yt(0),yt(0),function(){vt(65499),vt(132),yt(0);for(var Vr=0;Vr<64;Vr++)yt(a[Vr]);yt(1);for(var Lr=0;Lr<64;Lr++)yt(C[Lr])}(),function(Vr,Lr){vt(65472),vt(17),yt(8),vt(Lr),vt(Vr),yt(3),yt(1),yt(17),yt(0),yt(2),yt(17),yt(1),yt(3),yt(17),yt(1)}(he.width,he.height),function(){vt(65476),vt(418),yt(0);for(var Vr=0;Vr<16;Vr++)yt(He[Vr+1]);for(var Lr=0;Lr<=11;Lr++)yt(Te[Lr]);yt(16);for(var ai=0;ai<16;ai++)yt(st[ai+1]);for(var Rr=0;Rr<=161;Rr++)yt(me[Rr]);yt(1);for(var nt=0;nt<16;nt++)yt(xe[nt+1]);for(var re=0;re<=11;re++)yt(Xe[re]);yt(17);for(var K=0;K<16;K++)yt(Ye[K+1]);for(var se=0;se<=161;se++)yt(At[se])}(),vt(65498),vt(12),yt(3),yt(1),yt(0),yt(2),yt(17),yt(3),yt(17),yt(0),yt(63),yt(0);var $e=0,tt=0,ct=0;Q=0,ge=7,this.encode.displayName="_encode_";for(var ut,pt,wt,Bt,er,ur,fr,Ft,Ue,Yr=he.data,wr=he.width,Tr=he.height,ir=4*wr,Ar=0;Ar<Tr;){for(ut=0;ut<ir;){for(er=ir*Ar+ut,fr=-1,Ft=0,Ue=0;Ue<64;Ue++)ur=er+(Ft=Ue>>3)*ir+(fr=4*(7&Ue)),Ar+Ft>=Tr&&(ur-=ir*(Ar+1+Ft-Tr)),ut+fr>=ir&&(ur-=ut+fr-ir+4),pt=Yr[ur++],wt=Yr[ur++],Bt=Yr[ur++],Qe[Ue]=(Ze[pt]+Ze[wt+256|0]+Ze[Bt+512|0]>>16)-128,Oe[Ue]=(Ze[pt+768|0]+Ze[wt+1024|0]+Ze[Bt+1280|0]>>16)-128,Me[Ue]=(Ze[pt+1280|0]+Ze[wt+1536|0]+Ze[Bt+1792|0]>>16)-128;$e=sr(Qe,F,$e,o,m),tt=sr(Oe,O,tt,u,v),ct=sr(Me,O,ct,u,v),ut+=32}Ar+=8}if(ge>=0){var mr=[];mr[1]=ge+1,mr[0]=(1<<ge+1)-1,kt(mr)}return vt(65497),new Uint8Array(ce)},p=p||50,function(){for(var he=String.fromCharCode,Fe=0;Fe<256;Fe++)Ge[Fe]=he(Fe)}(),o=Dt(He,Te),u=Dt(xe,Xe),m=Dt(st,me),v=Dt(Ye,At),function(){for(var he=1,Fe=2,$e=1;$e<=15;$e++){for(var tt=he;tt<Fe;tt++)ee[32767+tt]=$e,Y[32767+tt]=[],Y[32767+tt][1]=$e,Y[32767+tt][0]=tt;for(var ct=-(Fe-1);ct<=-he;ct++)ee[32767+ct]=$e,Y[32767+ct]=[],Y[32767+ct][1]=$e,Y[32767+ct][0]=Fe-1+ct;he<<=1,Fe<<=1}}(),function(){for(var he=0;he<256;he++)Ze[he]=19595*he,Ze[he+256|0]=38470*he,Ze[he+512|0]=7471*he+32768,Ze[he+768|0]=-11059*he,Ze[he+1024|0]=-21709*he,Ze[he+1280|0]=32768*he+8421375,Ze[he+1536|0]=-27439*he,Ze[he+1792|0]=-5329*he}(),Zt(p)}function ll(p,o){if(this.pos=0,this.buffer=p,this.datav=new DataView(p.buffer),this.is_with_alpha=!!o,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function Oy(p){function o(Te){if(!Te)throw Error("assert :P")}function u(Te,st,me){for(var xe=0;4>xe;xe++)if(Te[st+xe]!=me.charCodeAt(xe))return!0;return!1}function m(Te,st,me,xe,Xe){for(var Ye=0;Ye<Xe;Ye++)Te[st+Ye]=me[xe+Ye]}function v(Te,st,me,xe){for(var Xe=0;Xe<xe;Xe++)Te[st+Xe]=me}function x(Te){return new Int32Array(Te)}function b(Te,st){for(var me=[],xe=0;xe<Te;xe++)me.push(new st);return me}function a(Te,st){var me=[];return function xe(Xe,Ye,At){for(var Dt=At[Ye],kt=0;kt<Dt&&(Xe.push(At.length>Ye+1?[]:new st),!(At.length<Ye+1));kt++)xe(Xe[kt],Ye+1,At)}(me,0,Te),me}var C=function(){var Te=this;function st(T,E){for(var U=1<<E-1>>>0;T&U;)U>>>=1;return U?(T&U-1)+U:T}function me(T,E,U,Z,ne){o(!(Z%U));do T[E+(Z-=U)]=ne;while(0<Z)}function xe(T,E,U,Z,ne){if(o(2328>=ne),512>=ne)var le=x(512);else if((le=x(ne))==null)return 0;return function(pe,_e,we,De,ke,It){var Re,dt,_t=_e,qt=1<<we,St=x(16),$t=x(16);for(o(ke!=0),o(De!=null),o(pe!=null),o(0<we),dt=0;dt<ke;++dt){if(15<De[dt])return 0;++St[De[dt]]}if(St[0]==ke)return 0;for($t[1]=0,Re=1;15>Re;++Re){if(St[Re]>1<<Re)return 0;$t[Re+1]=$t[Re]+St[Re]}for(dt=0;dt<ke;++dt)Re=De[dt],0<De[dt]&&(It[$t[Re]++]=dt);if($t[15]==1)return(De=new Xe).g=0,De.value=It[0],me(pe,_t,1,qt,De),qt;var Wt,or=-1,Qt=qt-1,Nr=0,Sr=1,Qr=1,Cr=1<<we;for(dt=0,Re=1,ke=2;Re<=we;++Re,ke<<=1){if(Sr+=Qr<<=1,0>(Qr-=St[Re]))return 0;for(;0<St[Re];--St[Re])(De=new Xe).g=Re,De.value=It[dt++],me(pe,_t+Nr,ke,Cr,De),Nr=st(Nr,Re)}for(Re=we+1,ke=2;15>=Re;++Re,ke<<=1){if(Sr+=Qr<<=1,0>(Qr-=St[Re]))return 0;for(;0<St[Re];--St[Re]){if(De=new Xe,(Nr&Qt)!=or){for(_t+=Cr,Wt=1<<(or=Re)-we;15>or&&!(0>=(Wt-=St[or]));)++or,Wt<<=1;qt+=Cr=1<<(Wt=or-we),pe[_e+(or=Nr&Qt)].g=Wt+we,pe[_e+or].value=_t-_e-or}De.g=Re-we,De.value=It[dt++],me(pe,_t+(Nr>>we),ke,Cr,De),Nr=st(Nr,Re)}}return Sr!=2*$t[15]-1?0:qt}(T,E,U,Z,ne,le)}function Xe(){this.value=this.g=0}function Ye(){this.value=this.g=0}function At(){this.G=b(5,Xe),this.H=x(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=b(Jn,Ye)}function Dt(T,E,U,Z){o(T!=null),o(E!=null),o(2147483648>Z),T.Ca=254,T.I=0,T.b=-8,T.Ka=0,T.oa=E,T.pa=U,T.Jd=E,T.Yc=U+Z,T.Zc=4<=Z?U+Z-4+1:U,pt(T)}function kt(T,E){for(var U=0;0<E--;)U|=Bt(T,128)<<E;return U}function yt(T,E){var U=kt(T,E);return wt(T)?-U:U}function vt(T,E,U,Z){var ne,le=0;for(o(T!=null),o(E!=null),o(4294967288>Z),T.Sb=Z,T.Ra=0,T.u=0,T.h=0,4<Z&&(Z=4),ne=0;ne<Z;++ne)le+=E[U+ne]<<8*ne;T.Ra=le,T.bb=Z,T.oa=E,T.pa=U}function sr(T){for(;8<=T.u&&T.bb<T.Sb;)T.Ra>>>=8,T.Ra+=T.oa[T.pa+T.bb]<<ks-8>>>0,++T.bb,T.u-=8;tt(T)&&(T.h=1,T.u=0)}function Zt(T,E){if(o(0<=E),!T.h&&E<=Uo){var U=$e(T)&Ua[E];return T.u+=E,sr(T),U}return T.h=1,T.u=0}function he(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function Fe(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function $e(T){return T.Ra>>>(T.u&ks-1)>>>0}function tt(T){return o(T.bb<=T.Sb),T.h||T.bb==T.Sb&&T.u>ks}function ct(T,E){T.u=E,T.h=tt(T)}function ut(T){T.u>=an&&(o(T.u>=an),sr(T))}function pt(T){o(T!=null&&T.oa!=null),T.pa<T.Zc?(T.I=(T.oa[T.pa++]|T.I<<8)>>>0,T.b+=8):(o(T!=null&&T.oa!=null),T.pa<T.Yc?(T.b+=8,T.I=T.oa[T.pa++]|T.I<<8):T.Ka?T.b=0:(T.I<<=8,T.b+=8,T.Ka=1))}function wt(T){return kt(T,1)}function Bt(T,E){var U=T.Ca;0>T.b&&pt(T);var Z=T.b,ne=U*E>>>8,le=(T.I>>>Z>ne)+0;for(le?(U-=ne,T.I-=ne+1<<Z>>>0):U=ne+1,Z=U,ne=0;256<=Z;)ne+=8,Z>>=8;return Z=7^ne+yl[Z],T.b-=Z,T.Ca=(U<<Z)-1,le}function er(T,E,U){T[E+0]=U>>24&255,T[E+1]=U>>16&255,T[E+2]=U>>8&255,T[E+3]=255&U}function ur(T,E){return T[E+0]|T[E+1]<<8}function fr(T,E){return ur(T,E)|T[E+2]<<16}function Ft(T,E){return ur(T,E)|ur(T,E+2)<<16}function Ue(T,E){var U=1<<E;return o(T!=null),o(0<E),T.X=x(U),T.X==null?0:(T.Mb=32-E,T.Xa=E,1)}function Yr(T,E){o(T!=null),o(E!=null),o(T.Xa==E.Xa),m(E.X,0,T.X,0,1<<E.Xa)}function wr(){this.X=[],this.Xa=this.Mb=0}function Tr(T,E,U,Z){o(U!=null),o(Z!=null);var ne=U[0],le=Z[0];return ne==0&&(ne=(T*le+E/2)/E),le==0&&(le=(E*ne+T/2)/T),0>=ne||0>=le?0:(U[0]=ne,Z[0]=le,1)}function ir(T,E){return T+(1<<E)-1>>>E}function Ar(T,E){return((4278255360&T)+(4278255360&E)>>>0&4278255360)+((16711935&T)+(16711935&E)>>>0&16711935)>>>0}function mr(T,E){Te[E]=function(U,Z,ne,le,pe,_e,we){var De;for(De=0;De<pe;++De){var ke=Te[T](_e[we+De-1],ne,le+De);_e[we+De]=Ar(U[Z+De],ke)}}}function Vr(){this.ud=this.hd=this.jd=0}function Lr(T,E){return((4278124286&(T^E))>>>1)+(T&E)>>>0}function ai(T){return 0<=T&&256>T?T:0>T?0:255<T?255:void 0}function Rr(T,E){return ai(T+(T-E+.5>>1))}function nt(T,E,U){return Math.abs(E-U)-Math.abs(T-U)}function re(T,E,U,Z,ne,le,pe){for(Z=le[pe-1],U=0;U<ne;++U)le[pe+U]=Z=Ar(T[E+U],Z)}function K(T,E,U,Z,ne){var le;for(le=0;le<U;++le){var pe=T[E+le],_e=pe>>8&255,we=16711935&(we=(we=16711935&pe)+((_e<<16)+_e));Z[ne+le]=(4278255360&pe)+we>>>0}}function se(T,E){E.jd=255&T,E.hd=T>>8&255,E.ud=T>>16&255}function Ie(T,E,U,Z,ne,le){var pe;for(pe=0;pe<Z;++pe){var _e=E[U+pe],we=_e>>>8,De=_e,ke=255&(ke=(ke=_e>>>16)+((T.jd<<24>>24)*(we<<24>>24)>>>5));De=255&(De=(De+=(T.hd<<24>>24)*(we<<24>>24)>>>5)+((T.ud<<24>>24)*(ke<<24>>24)>>>5)),ne[le+pe]=(4278255360&_e)+(ke<<16)+De}}function Ce(T,E,U,Z,ne){Te[E]=function(le,pe,_e,we,De,ke,It,Re,dt){for(we=It;we<Re;++we)for(It=0;It<dt;++It)De[ke++]=ne(_e[Z(le[pe++])])},Te[T]=function(le,pe,_e,we,De,ke,It){var Re=8>>le.b,dt=le.Ea,_t=le.K[0],qt=le.w;if(8>Re)for(le=(1<<le.b)-1,qt=(1<<Re)-1;pe<_e;++pe){var St,$t=0;for(St=0;St<dt;++St)St&le||($t=Z(we[De++])),ke[It++]=ne(_t[$t&qt]),$t>>=Re}else Te["VP8LMapColor"+U](we,De,_t,qt,ke,It,pe,_e,dt)}}function ht(T,E,U,Z,ne){for(U=E+U;E<U;){var le=T[E++];Z[ne++]=le>>16&255,Z[ne++]=le>>8&255,Z[ne++]=255&le}}function at(T,E,U,Z,ne){for(U=E+U;E<U;){var le=T[E++];Z[ne++]=le>>16&255,Z[ne++]=le>>8&255,Z[ne++]=255&le,Z[ne++]=le>>24&255}}function Be(T,E,U,Z,ne){for(U=E+U;E<U;){var le=(pe=T[E++])>>16&240|pe>>12&15,pe=240&pe|pe>>28&15;Z[ne++]=le,Z[ne++]=pe}}function ot(T,E,U,Z,ne){for(U=E+U;E<U;){var le=(pe=T[E++])>>16&248|pe>>13&7,pe=pe>>5&224|pe>>3&31;Z[ne++]=le,Z[ne++]=pe}}function Rt(T,E,U,Z,ne){for(U=E+U;E<U;){var le=T[E++];Z[ne++]=255&le,Z[ne++]=le>>8&255,Z[ne++]=le>>16&255}}function te(T,E,U,Z,ne,le){if(le==0)for(U=E+U;E<U;)er(Z,((le=T[E++])[0]>>24|le[1]>>8&65280|le[2]<<8&16711680|le[3]<<24)>>>0),ne+=32;else m(Z,ne,T,E,U)}function I(T,E){Te[E][0]=Te[T+"0"],Te[E][1]=Te[T+"1"],Te[E][2]=Te[T+"2"],Te[E][3]=Te[T+"3"],Te[E][4]=Te[T+"4"],Te[E][5]=Te[T+"5"],Te[E][6]=Te[T+"6"],Te[E][7]=Te[T+"7"],Te[E][8]=Te[T+"8"],Te[E][9]=Te[T+"9"],Te[E][10]=Te[T+"10"],Te[E][11]=Te[T+"11"],Te[E][12]=Te[T+"12"],Te[E][13]=Te[T+"13"],Te[E][14]=Te[T+"0"],Te[E][15]=Te[T+"0"]}function D(T){return T==eu||T==Kl||T==Ga||T==wl}function fe(){this.eb=[],this.size=this.A=this.fb=0}function Ee(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function qe(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new fe,this.f.kb=new Ee,this.sd=null}function ae(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function ft(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Nt(T){return alert("todo:WebPSamplerProcessPlane"),T.T}function gt(T,E){var U=T.T,Z=E.ba.f.RGBA,ne=Z.eb,le=Z.fb+T.ka*Z.A,pe=Kn[E.ba.S],_e=T.y,we=T.O,De=T.f,ke=T.N,It=T.ea,Re=T.W,dt=E.cc,_t=E.dc,qt=E.Mc,St=E.Nc,$t=T.ka,Wt=T.ka+T.T,or=T.U,Qt=or+1>>1;for($t==0?pe(_e,we,null,null,De,ke,It,Re,De,ke,It,Re,ne,le,null,null,or):(pe(E.ec,E.fc,_e,we,dt,_t,qt,St,De,ke,It,Re,ne,le-Z.A,ne,le,or),++U);$t+2<Wt;$t+=2)dt=De,_t=ke,qt=It,St=Re,ke+=T.Rc,Re+=T.Rc,le+=2*Z.A,pe(_e,(we+=2*T.fa)-T.fa,_e,we,dt,_t,qt,St,De,ke,It,Re,ne,le-Z.A,ne,le,or);return we+=T.fa,T.j+Wt<T.o?(m(E.ec,E.fc,_e,we,or),m(E.cc,E.dc,De,ke,Qt),m(E.Mc,E.Nc,It,Re,Qt),U--):1&Wt||pe(_e,we,null,null,De,ke,It,Re,De,ke,It,Re,ne,le+Z.A,null,null,or),U}function Lt(T,E,U){var Z=T.F,ne=[T.J];if(Z!=null){var le=T.U,pe=E.ba.S,_e=pe==Sc||pe==Ga;E=E.ba.f.RGBA;var we=[0],De=T.ka;we[0]=T.T,T.Kb&&(De==0?--we[0]:(--De,ne[0]-=T.width),T.j+T.ka+T.T==T.o&&(we[0]=T.o-T.j-De));var ke=E.eb;De=E.fb+De*E.A,T=yo(Z,ne[0],T.width,le,we,ke,De+(_e?0:3),E.A),o(U==we),T&&D(pe)&&bl(ke,De,_e,le,we,E.A)}return 0}function Ht(T){var E=T.ma,U=E.ba.S,Z=11>U,ne=U==wc||U==bo||U==Sc||U==Kc||U==12||D(U);if(E.memory=null,E.Ib=null,E.Jb=null,E.Nd=null,!us(E.Oa,T,ne?11:12))return 0;if(ne&&D(U)&&Ba(),T.da)alert("todo:use_scaling");else{if(Z){if(E.Ib=Nt,T.Kb){if(U=T.U+1>>1,E.memory=x(T.U+2*U),E.memory==null)return 0;E.ec=E.memory,E.fc=0,E.cc=E.ec,E.dc=E.fc+T.U,E.Mc=E.cc,E.Nc=E.dc+U,E.Ib=gt,Ba()}}else alert("todo:EmitYUV");ne&&(E.Jb=Lt,Z&&Hs())}if(Z&&!Mc){for(T=0;256>T;++T)sc[T]=89858*(T-128)+nc>>ic,ou[T]=-22014*(T-128)+nc,au[T]=-45773*(T-128),Cu[T]=113618*(T-128)+nc>>ic;for(T=Tl;T<Za;++T)E=76283*(T-16)+nc>>ic,ku[T-Tl]=fn(E,255),lu[T-Tl]=fn(E+8>>4,15);Mc=1}return 1}function Mt(T){var E=T.ma,U=T.U,Z=T.T;return o(!(1&T.ka)),0>=U||0>=Z?0:(U=E.Ib(T,E),E.Jb!=null&&E.Jb(T,E,U),E.Dc+=U,1)}function rr(T){T.ma.memory=null}function Ut(T,E,U,Z){return Zt(T,8)!=47?0:(E[0]=Zt(T,14)+1,U[0]=Zt(T,14)+1,Z[0]=Zt(T,1),Zt(T,3)!=0?0:!T.h)}function gr(T,E){if(4>T)return T+1;var U=T-2>>1;return(2+(1&T)<<U)+Zt(E,U)+1}function Xr(T,E){return 120<E?E-120:1<=(U=((U=Ho[E-1])>>4)*T+(8-(15&U)))?U:1;var U}function ri(T,E,U){var Z=$e(U),ne=T[E+=255&Z].g-8;return 0<ne&&(ct(U,U.u+8),Z=$e(U),E+=T[E].value,E+=Z&(1<<ne)-1),ct(U,U.u+T[E].g),T[E].value}function Ot(T,E,U){return U.g+=T.g,U.value+=T.value<<E>>>0,o(8>=U.g),T.g}function kr(T,E,U){var Z=T.xc;return o((E=Z==0?0:T.vc[T.md*(U>>Z)+(E>>Z)])<T.Wb),T.Ya[E]}function Fi(T,E,U,Z){var ne=T.ab,le=T.c*E,pe=T.C;E=pe+E;var _e=U,we=Z;for(Z=T.Ta,U=T.Ua;0<ne--;){var De=T.gc[ne],ke=pe,It=E,Re=_e,dt=we,_t=(we=Z,_e=U,De.Ea);switch(o(ke<It),o(It<=De.nc),De.hc){case 2:Vo(Re,dt,(It-ke)*_t,we,_e);break;case 0:var qt=ke,St=It,$t=we,Wt=_e,or=(Cr=De).Ea;qt==0&&(Ia(Re,dt,null,null,1,$t,Wt),re(Re,dt+1,0,0,or-1,$t,Wt+1),dt+=or,Wt+=or,++qt);for(var Qt=1<<Cr.b,Nr=Qt-1,Sr=ir(or,Cr.b),Qr=Cr.K,Cr=Cr.w+(qt>>Cr.b)*Sr;qt<St;){var ui=Qr,on=Cr,ei=1;for(Ea(Re,dt,$t,Wt-or,1,$t,Wt);ei<or;){var Er=(ei&~Nr)+Qt;Er>or&&(Er=or),(0,La[ui[on++]>>8&15])(Re,dt+ +ei,$t,Wt+ei-or,Er-ei,$t,Wt+ei),ei=Er}dt+=or,Wt+=or,++qt&Nr||(Cr+=Sr)}It!=De.nc&&m(we,_e-_t,we,_e+(It-ke-1)*_t,_t);break;case 1:for(_t=Re,St=dt,or=(Re=De.Ea)-(Wt=Re&~($t=(dt=1<<De.b)-1)),qt=ir(Re,De.b),Qt=De.K,De=De.w+(ke>>De.b)*qt;ke<It;){for(Nr=Qt,Sr=De,Qr=new Vr,Cr=St+Wt,ui=St+Re;St<Cr;)se(Nr[Sr++],Qr),An(Qr,_t,St,dt,we,_e),St+=dt,_e+=dt;St<ui&&(se(Nr[Sr++],Qr),An(Qr,_t,St,or,we,_e),St+=or,_e+=or),++ke&$t||(De+=qt)}break;case 3:if(Re==we&&dt==_e&&0<De.b){for(St=we,Re=_t=_e+(It-ke)*_t-(Wt=(It-ke)*ir(De.Ea,De.b)),dt=we,$t=_e,qt=[],Wt=(or=Wt)-1;0<=Wt;--Wt)qt[Wt]=dt[$t+Wt];for(Wt=or-1;0<=Wt;--Wt)St[Re+Wt]=qt[Wt];Va(De,ke,It,we,_t,we,_e)}else Va(De,ke,It,Re,dt,we,_e)}_e=Z,we=U}we!=U&&m(Z,U,_e,we,le)}function Ln(T,E){var U=T.V,Z=T.Ba+T.c*T.C,ne=E-T.C;if(o(E<=T.l.o),o(16>=ne),0<ne){var le=T.l,pe=T.Ta,_e=T.Ua,we=le.width;if(Fi(T,ne,U,Z),ne=_e=[_e],o((U=T.C)<(Z=E)),o(le.v<le.va),Z>le.o&&(Z=le.o),U<le.j){var De=le.j-U;U=le.j,ne[0]+=De*we}if(U>=Z?U=0:(ne[0]+=4*le.v,le.ka=U-le.j,le.U=le.va-le.v,le.T=Z-U,U=1),U){if(_e=_e[0],11>(U=T.ca).S){var ke=U.f.RGBA,It=(Z=U.S,ne=le.U,le=le.T,De=ke.eb,ke.A),Re=le;for(ke=ke.fb+T.Ma*ke.A;0<Re--;){var dt=pe,_t=_e,qt=ne,St=De,$t=ke;switch(Z){case Wo:go(dt,_t,qt,St,$t);break;case wc:ds(dt,_t,qt,St,$t);break;case eu:ds(dt,_t,qt,St,$t),bl(St,$t,0,qt,1,0);break;case Jc:Ii(dt,_t,qt,St,$t);break;case bo:te(dt,_t,qt,St,$t,1);break;case Kl:te(dt,_t,qt,St,$t,1),bl(St,$t,0,qt,1,0);break;case Sc:te(dt,_t,qt,St,$t,0);break;case Ga:te(dt,_t,qt,St,$t,0),bl(St,$t,1,qt,1,0);break;case Kc:Xs(dt,_t,qt,St,$t);break;case wl:Xs(dt,_t,qt,St,$t),xc(St,$t,qt,1,0);break;case Qc:Ci(dt,_t,qt,St,$t);break;default:o(0)}_e+=we,ke+=It}T.Ma+=le}else alert("todo:EmitRescaledRowsYUVA");o(T.Ma<=U.height)}}T.C=E,o(T.C<=T.i)}function Zi(T){var E;if(0<T.ua)return 0;for(E=0;E<T.Wb;++E){var U=T.Ya[E].G,Z=T.Ya[E].H;if(0<U[1][Z[1]+0].g||0<U[2][Z[2]+0].g||0<U[3][Z[3]+0].g)return 0}return 1}function nr(T,E,U,Z,ne,le){if(T.Z!=0){var pe=T.qd,_e=T.rd;for(o(ua[T.Z]!=null);E<U;++E)ua[T.Z](pe,_e,Z,ne,Z,ne,le),pe=Z,_e=ne,ne+=le;T.qd=pe,T.rd=_e}}function Br(T,E){var U=T.l.ma,Z=U.Z==0||U.Z==1?T.l.j:T.C;if(Z=T.C<Z?Z:T.C,o(E<=T.l.o),E>Z){var ne=T.l.width,le=U.ca,pe=U.tb+ne*Z,_e=T.V,we=T.Ba+T.c*Z,De=T.gc;o(T.ab==1),o(De[0].hc==3),po(De[0],Z,E,_e,we,le,pe),nr(U,Z,E,le,pe,ne)}T.C=T.Ma=E}function Or(T,E,U,Z,ne,le,pe){var _e=T.$/Z,we=T.$%Z,De=T.m,ke=T.s,It=U+T.$,Re=It;ne=U+Z*ne;var dt=U+Z*le,_t=280+ke.ua,qt=T.Pb?_e:16777216,St=0<ke.ua?ke.Wa:null,$t=ke.wc,Wt=It<dt?kr(ke,we,_e):null;o(T.C<le),o(dt<=ne);var or=!1;e:for(;;){for(;or||It<dt;){var Qt=0;if(_e>=qt){var Nr=It-U;o((qt=T).Pb),qt.wd=qt.m,qt.xd=Nr,0<qt.s.ua&&Yr(qt.s.Wa,qt.s.vb),qt=_e+ru}if(we&$t||(Wt=kr(ke,we,_e)),o(Wt!=null),Wt.Qb&&(E[It]=Wt.qb,or=!0),!or)if(ut(De),Wt.jc){Qt=De,Nr=E;var Sr=It,Qr=Wt.pd[$e(Qt)&Jn-1];o(Wt.jc),256>Qr.g?(ct(Qt,Qt.u+Qr.g),Nr[Sr]=Qr.value,Qt=0):(ct(Qt,Qt.u+Qr.g-256),o(256<=Qr.value),Qt=Qr.value),Qt==0&&(or=!0)}else Qt=ri(Wt.G[0],Wt.H[0],De);if(De.h)break;if(or||256>Qt){if(!or)if(Wt.nd)E[It]=(Wt.qb|Qt<<8)>>>0;else{if(ut(De),or=ri(Wt.G[1],Wt.H[1],De),ut(De),Nr=ri(Wt.G[2],Wt.H[2],De),Sr=ri(Wt.G[3],Wt.H[3],De),De.h)break;E[It]=(Sr<<24|or<<16|Qt<<8|Nr)>>>0}if(or=!1,++It,++we>=Z&&(we=0,++_e,pe!=null&&_e<=le&&!(_e%16)&&pe(T,_e),St!=null))for(;Re<It;)Qt=E[Re++],St.X[(506832829*Qt&4294967295)>>>St.Mb]=Qt}else if(280>Qt){if(Qt=gr(Qt-256,De),Nr=ri(Wt.G[4],Wt.H[4],De),ut(De),Nr=Xr(Z,Nr=gr(Nr,De)),De.h)break;if(It-U<Nr||ne-It<Qt)break e;for(Sr=0;Sr<Qt;++Sr)E[It+Sr]=E[It+Sr-Nr];for(It+=Qt,we+=Qt;we>=Z;)we-=Z,++_e,pe!=null&&_e<=le&&!(_e%16)&&pe(T,_e);if(o(It<=ne),we&$t&&(Wt=kr(ke,we,_e)),St!=null)for(;Re<It;)Qt=E[Re++],St.X[(506832829*Qt&4294967295)>>>St.Mb]=Qt}else{if(!(Qt<_t))break e;for(or=Qt-280,o(St!=null);Re<It;)Qt=E[Re++],St.X[(506832829*Qt&4294967295)>>>St.Mb]=Qt;Qt=It,o(!(or>>>(Nr=St).Xa)),E[Qt]=Nr.X[or],or=!0}or||o(De.h==tt(De))}if(T.Pb&&De.h&&It<ne)o(T.m.h),T.a=5,T.m=T.wd,T.$=T.xd,0<T.s.ua&&Yr(T.s.vb,T.s.Wa);else{if(De.h)break e;pe?.(T,_e>le?le:_e),T.a=0,T.$=It-U}return 1}return T.a=3,0}function Oi(T){o(T!=null),T.vc=null,T.yc=null,T.Ya=null;var E=T.Wa;E!=null&&(E.X=null),T.vb=null,o(T!=null)}function Bs(){var T=new Ai;return T==null?null:(T.a=0,T.xb=Fs,I("Predictor","VP8LPredictors"),I("Predictor","VP8LPredictors_C"),I("PredictorAdd","VP8LPredictorsAdd"),I("PredictorAdd","VP8LPredictorsAdd_C"),Vo=K,An=Ie,go=ht,ds=at,Xs=Be,Ci=ot,Ii=Rt,Te.VP8LMapColor32b=qo,Te.VP8LMapColor8b=mo,T)}function Mn(T,E,U,Z,ne){var le=1,pe=[T],_e=[E],we=Z.m,De=Z.s,ke=null,It=0;e:for(;;){if(U)for(;le&&Zt(we,1);){var Re=pe,dt=_e,_t=Z,qt=1,St=_t.m,$t=_t.gc[_t.ab],Wt=Zt(St,2);if(_t.Oc&1<<Wt)le=0;else{switch(_t.Oc|=1<<Wt,$t.hc=Wt,$t.Ea=Re[0],$t.nc=dt[0],$t.K=[null],++_t.ab,o(4>=_t.ab),Wt){case 0:case 1:$t.b=Zt(St,3)+2,qt=Mn(ir($t.Ea,$t.b),ir($t.nc,$t.b),0,_t,$t.K),$t.K=$t.K[0];break;case 3:var or,Qt=Zt(St,8)+1,Nr=16<Qt?0:4<Qt?1:2<Qt?2:3;if(Re[0]=ir($t.Ea,Nr),$t.b=Nr,or=qt=Mn(Qt,1,0,_t,$t.K)){var Sr,Qr=Qt,Cr=$t,ui=1<<(8>>Cr.b),on=x(ui);if(on==null)or=0;else{var ei=Cr.K[0],Er=Cr.w;for(on[0]=Cr.K[0][0],Sr=1;Sr<1*Qr;++Sr)on[Sr]=Ar(ei[Er+Sr],on[Sr-1]);for(;Sr<4*ui;++Sr)on[Sr]=0;Cr.K[0]=null,Cr.K[0]=on,or=1}}qt=or;break;case 2:break;default:o(0)}le=qt}}if(pe=pe[0],_e=_e[0],le&&Zt(we,1)&&!(le=1<=(It=Zt(we,4))&&11>=It)){Z.a=3;break e}var _r;if(_r=le)t:{var Ei,br,pi,ki=Z,pn=pe,Un=_e,Wi=It,Vn=U,qn=ki.m,vn=ki.s,ii=[null],xi=1,cr=0,hr=Xo[Wi];r:for(;;){if(Vn&&Zt(qn,1)){var ln=Zt(qn,3)+2,Rs=ir(pn,ln),zi=ir(Un,ln),Di=Rs*zi;if(!Mn(Rs,zi,0,ki,ii))break r;for(ii=ii[0],vn.xc=ln,Ei=0;Ei<Di;++Ei){var li=ii[Ei]>>8&65535;ii[Ei]=li,li>=xi&&(xi=li+1)}}if(qn.h)break r;for(br=0;5>br;++br){var bn=Pc[br];!br&&0<Wi&&(bn+=1<<Wi),cr<bn&&(cr=bn)}var zs=b(xi*hr,Xe),Qn=xi,vs=b(Qn,At);if(vs==null)var Fn=null;else o(65536>=Qn),Fn=vs;var fi=x(cr);if(Fn==null||fi==null||zs==null){ki.a=1;break r}var _i=zs;for(Ei=pi=0;Ei<xi;++Ei){var Ni=Fn[Ei],Gn=Ni.G,bs=Ni.H,xs=0,da=1,In=0;for(br=0;5>br;++br){bn=Pc[br],Gn[br]=_i,bs[br]=pi,!br&&0<Wi&&(bn+=1<<Wi);n:{var So,Al=bn,Il=ki,Qo=fi,Ha=_i,Cc=pi,el=0,fa=Il.m,ac=Zt(fa,1);if(v(Qo,0,0,Al),ac){var uu=Zt(fa,1)+1,tl=Zt(fa,1),To=Zt(fa,tl==0?1:8);Qo[To]=1,uu==2&&(Qo[To=Zt(fa,8)]=1);var El=1}else{var Ll=x(19),Po=Zt(fa,4)+4;if(19<Po){Il.a=3;var Ml=0;break n}for(So=0;So<Po;++So)Ll[Ic[So]]=Zt(fa,3);var oc=void 0,Ao=void 0,kc=Il,g=Ll,t=Al,n=Qo,l=0,h=kc.m,_=8,w=b(128,Xe);i:for(;xe(w,0,7,g,19);){if(Zt(h,1)){var P=2+2*Zt(h,3);if((oc=2+Zt(h,P))>t)break i}else oc=t;for(Ao=0;Ao<t&&oc--;){ut(h);var M=w[0+(127&$e(h))];ct(h,h.u+M.g);var R=M.value;if(16>R)n[Ao++]=R,R!=0&&(_=R);else{var B=R==16,$=R-16,G=tu[$],X=Zt(h,Tc[$])+G;if(Ao+X>t)break i;for(var oe=B?_:0;0<X--;)n[Ao++]=oe}}l=1;break i}l||(kc.a=3),El=l}(El=El&&!fa.h)&&(el=xe(Ha,Cc,8,Qo,Al)),El&&el!=0?Ml=el:(Il.a=3,Ml=0)}if(Ml==0)break r;if(da&&Ac[br]==1&&(da=_i[pi].g==0),xs+=_i[pi].g,pi+=Ml,3>=br){var ve,Se=fi[0];for(ve=1;ve<bn;++ve)fi[ve]>Se&&(Se=fi[ve]);In+=Se}}if(Ni.nd=da,Ni.Qb=0,da&&(Ni.qb=(Gn[3][bs[3]+0].value<<24|Gn[1][bs[1]+0].value<<16|Gn[2][bs[2]+0].value)>>>0,xs==0&&256>Gn[0][bs[0]+0].value&&(Ni.Qb=1,Ni.qb+=Gn[0][bs[0]+0].value<<8)),Ni.jc=!Ni.Qb&&6>In,Ni.jc){var be,Ae=Ni;for(be=0;be<Jn;++be){var We=be,Le=Ae.pd[We],Je=Ae.G[0][Ae.H[0]+We];256<=Je.value?(Le.g=Je.g+256,Le.value=Je.value):(Le.g=0,Le.value=0,We>>=Ot(Je,8,Le),We>>=Ot(Ae.G[1][Ae.H[1]+We],16,Le),We>>=Ot(Ae.G[2][Ae.H[2]+We],0,Le),Ot(Ae.G[3][Ae.H[3]+We],24,Le))}}}vn.vc=ii,vn.Wb=xi,vn.Ya=Fn,vn.yc=zs,_r=1;break t}_r=0}if(!(le=_r)){Z.a=3;break e}if(0<It){if(De.ua=1<<It,!Ue(De.Wa,It)){Z.a=1,le=0;break e}}else De.ua=0;var et=Z,Ve=pe,lt=_e,Tt=et.s,bt=Tt.xc;if(et.c=Ve,et.i=lt,Tt.md=ir(Ve,bt),Tt.wc=bt==0?-1:(1<<bt)-1,U){Z.xb=Jo;break e}if((ke=x(pe*_e))==null){Z.a=1,le=0;break e}le=(le=Or(Z,ke,0,pe,_e,_e,null))&&!we.h;break e}return le?(ne!=null?ne[0]=ke:(o(ke==null),o(U)),Z.$=0,U||Oi(De)):Oi(De),le}function Gr(T,E){var U=T.c*T.i,Z=U+E+16*E;return o(T.c<=E),T.V=x(Z),T.V==null?(T.Ta=null,T.Ua=0,T.a=1,0):(T.Ta=T.V,T.Ua=T.Ba+U+E,1)}function ya(T,E){var U=T.C,Z=E-U,ne=T.V,le=T.Ba+T.c*U;for(o(E<=T.l.o);0<Z;){var pe=16<Z?16:Z,_e=T.l.ma,we=T.l.width,De=we*pe,ke=_e.ca,It=_e.tb+we*U,Re=T.Ta,dt=T.Ua;Fi(T,pe,ne,le),Hl(Re,dt,ke,It,De),nr(_e,U,U+pe,ke,It,we),Z-=pe,ne+=pe*T.c,U+=pe}o(U==E),T.C=T.Ma=E}function va(){this.ub=this.yd=this.td=this.Rb=0}function Ra(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function to(){this.Fb=this.Bb=this.Cb=0,this.Zb=x(4),this.Lb=x(4)}function za(){this.Yb=function(){var T=[];return function E(U,Z,ne){for(var le=ne[Z],pe=0;pe<le&&(U.push(ne.length>Z+1?[]:0),!(ne.length<Z+1));pe++)E(U[pe],Z+1,ne)}(T,0,[3,11]),T}()}function Na(){this.jb=x(3),this.Wc=a([4,8],za),this.Xc=a([4,17],za)}function ro(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new x(4),this.od=new x(4)}function Bi(){this.ld=this.La=this.dd=this.tc=0}function mi(){this.Na=this.la=0}function ko(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function ba(){this.ad=x(384),this.Za=0,this.Ob=x(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function io(){this.uc=this.M=this.Nb=0,this.wa=Array(new Bi),this.Y=0,this.ya=Array(new ba),this.aa=0,this.l=new Do}function xa(){this.y=x(16),this.f=x(8),this.ea=x(8)}function _s(){this.cb=this.a=0,this.sc="",this.m=new he,this.Od=new va,this.Kc=new Ra,this.ed=new ro,this.Qa=new to,this.Ic=this.$c=this.Aa=0,this.D=new io,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=b(8,he),this.ia=0,this.pb=b(4,ko),this.Pa=new Na,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new xa),this.Hd=0,this.rb=Array(new mi),this.sb=0,this.wa=Array(new Bi),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new ba),this.L=this.aa=0,this.gd=a([4,2],Bi),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Do(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Oa(){var T=new _s;return T!=null&&(T.a=0,T.sc="OK",T.cb=0,T.Xb=0,Ql||(Ql=wa)),T}function Ji(T,E,U){return T.a==0&&(T.a=E,T.sc=U,T.cb=0),0}function ji(T,E,U){return 3<=U&&T[E+0]==157&&T[E+1]==1&&T[E+2]==42}function Ol(T,E){if(T==null)return 0;if(T.a=0,T.sc="OK",E==null)return Ji(T,2,"null VP8Io passed to VP8GetHeaders()");var U=E.data,Z=E.w,ne=E.ha;if(4>ne)return Ji(T,7,"Truncated header.");var le=U[Z+0]|U[Z+1]<<8|U[Z+2]<<16,pe=T.Od;if(pe.Rb=!(1&le),pe.td=le>>1&7,pe.yd=le>>4&1,pe.ub=le>>5,3<pe.td)return Ji(T,3,"Incorrect keyframe parameters.");if(!pe.yd)return Ji(T,4,"Frame not displayable.");Z+=3,ne-=3;var _e=T.Kc;if(pe.Rb){if(7>ne)return Ji(T,7,"cannot parse picture header");if(!ji(U,Z,ne))return Ji(T,3,"Bad code word");_e.c=16383&(U[Z+4]<<8|U[Z+3]),_e.Td=U[Z+4]>>6,_e.i=16383&(U[Z+6]<<8|U[Z+5]),_e.Ud=U[Z+6]>>6,Z+=7,ne-=7,T.za=_e.c+15>>4,T.Ub=_e.i+15>>4,E.width=_e.c,E.height=_e.i,E.Da=0,E.j=0,E.v=0,E.va=E.width,E.o=E.height,E.da=0,E.ib=E.width,E.hb=E.height,E.U=E.width,E.T=E.height,v((le=T.Pa).jb,0,255,le.jb.length),o((le=T.Qa)!=null),le.Cb=0,le.Bb=0,le.Fb=1,v(le.Zb,0,0,le.Zb.length),v(le.Lb,0,0,le.Lb)}if(pe.ub>ne)return Ji(T,7,"bad partition length");Dt(le=T.m,U,Z,pe.ub),Z+=pe.ub,ne-=pe.ub,pe.Rb&&(_e.Ld=wt(le),_e.Kd=wt(le)),_e=T.Qa;var we,De=T.Pa;if(o(le!=null),o(_e!=null),_e.Cb=wt(le),_e.Cb){if(_e.Bb=wt(le),wt(le)){for(_e.Fb=wt(le),we=0;4>we;++we)_e.Zb[we]=wt(le)?yt(le,7):0;for(we=0;4>we;++we)_e.Lb[we]=wt(le)?yt(le,6):0}if(_e.Bb)for(we=0;3>we;++we)De.jb[we]=wt(le)?kt(le,8):255}else _e.Bb=0;if(le.Ka)return Ji(T,3,"cannot parse segment header");if((_e=T.ed).zd=wt(le),_e.Tb=kt(le,6),_e.wb=kt(le,3),_e.Pc=wt(le),_e.Pc&&wt(le)){for(De=0;4>De;++De)wt(le)&&(_e.vd[De]=yt(le,6));for(De=0;4>De;++De)wt(le)&&(_e.od[De]=yt(le,6))}if(T.L=_e.Tb==0?0:_e.zd?1:2,le.Ka)return Ji(T,3,"cannot parse filter header");var ke=ne;if(ne=we=Z,Z=we+ke,_e=ke,T.Xb=(1<<kt(T.m,2))-1,ke<3*(De=T.Xb))U=7;else{for(we+=3*De,_e-=3*De,ke=0;ke<De;++ke){var It=U[ne+0]|U[ne+1]<<8|U[ne+2]<<16;It>_e&&(It=_e),Dt(T.Jc[+ke],U,we,It),we+=It,_e-=It,ne+=3}Dt(T.Jc[+De],U,we,_e),U=we<Z?0:5}if(U!=0)return Ji(T,U,"cannot parse partitions");for(U=kt(we=T.m,7),ne=wt(we)?yt(we,4):0,Z=wt(we)?yt(we,4):0,_e=wt(we)?yt(we,4):0,De=wt(we)?yt(we,4):0,we=wt(we)?yt(we,4):0,ke=T.Qa,It=0;4>It;++It){if(ke.Cb){var Re=ke.Zb[It];ke.Fb||(Re+=U)}else{if(0<It){T.pb[It]=T.pb[0];continue}Re=U}var dt=T.pb[It];dt.Sc[0]=iu[fn(Re+ne,127)],dt.Sc[1]=Yo[fn(Re+0,127)],dt.Eb[0]=2*iu[fn(Re+Z,127)],dt.Eb[1]=101581*Yo[fn(Re+_e,127)]>>16,8>dt.Eb[1]&&(dt.Eb[1]=8),dt.Qc[0]=iu[fn(Re+De,117)],dt.Qc[1]=Yo[fn(Re+we,127)],dt.lc=Re+we}if(!pe.Rb)return Ji(T,4,"Not a key frame.");for(wt(le),pe=T.Pa,U=0;4>U;++U){for(ne=0;8>ne;++ne)for(Z=0;3>Z;++Z)for(_e=0;11>_e;++_e)De=Bt(le,rc[U][ne][Z][_e])?kt(le,8):Eu[U][ne][Z][_e],pe.Wc[U][ne].Yb[Z][_e]=De;for(ne=0;17>ne;++ne)pe.Xc[U][ne]=pe.Wc[U][Ec[ne]]}return T.kc=wt(le),T.kc&&(T.Bd=kt(le,8)),T.cb=1}function wa(T,E,U,Z,ne,le,pe){var _e=E[ne].Yb[U];for(U=0;16>ne;++ne){if(!Bt(T,_e[U+0]))return ne;for(;!Bt(T,_e[U+1]);)if(_e=E[++ne].Yb[0],U=0,ne==16)return 16;var we=E[ne+1].Yb;if(Bt(T,_e[U+2])){var De=T,ke=0;if(Bt(De,(Re=_e)[(It=U)+3]))if(Bt(De,Re[It+6])){for(_e=0,It=2*(ke=Bt(De,Re[It+8]))+(Re=Bt(De,Re[It+9+ke])),ke=0,Re=Iu[It];Re[_e];++_e)ke+=ke+Bt(De,Re[_e]);ke+=3+(8<<It)}else Bt(De,Re[It+7])?(ke=7+2*Bt(De,165),ke+=Bt(De,145)):ke=5+Bt(De,159);else ke=Bt(De,Re[It+4])?3+Bt(De,Re[It+5]):2;_e=we[2]}else ke=1,_e=we[1];we=pe+ec[ne],0>(De=T).b&&pt(De);var It,Re=De.b,dt=(It=De.Ca>>1)-(De.I>>Re)>>31;--De.b,De.Ca+=dt,De.Ca|=1,De.I-=(It+1&dt)<<Re,le[we]=((ke^dt)-dt)*Z[(0<ne)+0]}return 16}function na(T){var E=T.rb[T.sb-1];E.la=0,E.Na=0,v(T.zc,0,0,T.zc.length),T.ja=0}function js(T,E,U,Z,ne){ne=T[E+U+32*Z]+(ne>>3),T[E+U+32*Z]=-256&ne?0>ne?0:255:ne}function no(T,E,U,Z,ne,le){js(T,E,0,U,Z+ne),js(T,E,1,U,Z+le),js(T,E,2,U,Z-le),js(T,E,3,U,Z-ne)}function sn(T){return(20091*T>>16)+T}function so(T,E,U,Z){var ne,le=0,pe=x(16);for(ne=0;4>ne;++ne){var _e=T[E+0]+T[E+8],we=T[E+0]-T[E+8],De=(35468*T[E+4]>>16)-sn(T[E+12]),ke=sn(T[E+4])+(35468*T[E+12]>>16);pe[le+0]=_e+ke,pe[le+1]=we+De,pe[le+2]=we-De,pe[le+3]=_e-ke,le+=4,E++}for(ne=le=0;4>ne;++ne)_e=(T=pe[le+0]+4)+pe[le+8],we=T-pe[le+8],De=(35468*pe[le+4]>>16)-sn(pe[le+12]),js(U,Z,0,0,_e+(ke=sn(pe[le+4])+(35468*pe[le+12]>>16))),js(U,Z,1,0,we+De),js(U,Z,2,0,we-De),js(U,Z,3,0,_e-ke),le++,Z+=32}function Bl(T,E,U,Z){var ne=T[E+0]+4,le=35468*T[E+4]>>16,pe=sn(T[E+4]),_e=35468*T[E+1]>>16;no(U,Z,0,ne+pe,T=sn(T[E+1]),_e),no(U,Z,1,ne+le,T,_e),no(U,Z,2,ne-le,T,_e),no(U,Z,3,ne-pe,T,_e)}function jl(T,E,U,Z,ne){so(T,E,U,Z),ne&&so(T,E+16,U,Z+4)}function Ul(T,E,U,Z){Qi(T,E+0,U,Z,1),Qi(T,E+32,U,Z+128,1)}function Us(T,E,U,Z){var ne;for(T=T[E+0]+4,ne=0;4>ne;++ne)for(E=0;4>E;++E)js(U,Z,E,ne,T)}function vc(T,E,U,Z){T[E+0]&&Ma(T,E+0,U,Z),T[E+16]&&Ma(T,E+16,U,Z+4),T[E+32]&&Ma(T,E+32,U,Z+128),T[E+48]&&Ma(T,E+48,U,Z+128+4)}function ao(T,E,U,Z){var ne,le=x(16);for(ne=0;4>ne;++ne){var pe=T[E+0+ne]+T[E+12+ne],_e=T[E+4+ne]+T[E+8+ne],we=T[E+4+ne]-T[E+8+ne],De=T[E+0+ne]-T[E+12+ne];le[0+ne]=pe+_e,le[8+ne]=pe-_e,le[4+ne]=De+we,le[12+ne]=De-we}for(ne=0;4>ne;++ne)pe=(T=le[0+4*ne]+3)+le[3+4*ne],_e=le[1+4*ne]+le[2+4*ne],we=le[1+4*ne]-le[2+4*ne],De=T-le[3+4*ne],U[Z+0]=pe+_e>>3,U[Z+16]=De+we>>3,U[Z+32]=pe-_e>>3,U[Z+48]=De-we>>3,Z+=64}function sa(T,E,U){var Z,ne=E-32,le=fs,pe=255-T[ne-1];for(Z=0;Z<U;++Z){var _e,we=le,De=pe+T[E-1];for(_e=0;_e<U;++_e)T[E+_e]=we[De+T[ne+_e]];E+=32}}function pl(T,E){sa(T,E,4)}function oo(T,E){sa(T,E,8)}function Vl(T,E){sa(T,E,16)}function Fo(T,E){var U;for(U=0;16>U;++U)m(T,E+32*U,T,E-32,16)}function Vs(T,E){var U;for(U=16;0<U;--U)v(T,E,T[E-1],16),E+=32}function qs(T,E,U){var Z;for(Z=0;16>Z;++Z)v(E,U+32*Z,T,16)}function Wr(T,E){var U,Z=16;for(U=0;16>U;++U)Z+=T[E-1+32*U]+T[E+U-32];qs(Z>>5,T,E)}function ql(T,E){var U,Z=8;for(U=0;16>U;++U)Z+=T[E-1+32*U];qs(Z>>4,T,E)}function Ro(T,E){var U,Z=8;for(U=0;16>U;++U)Z+=T[E+U-32];qs(Z>>4,T,E)}function zo(T,E){qs(128,T,E)}function zr(T,E,U){return T+2*E+U+2>>2}function Cn(T,E){var U,Z=E-32;for(Z=new Uint8Array([zr(T[Z-1],T[Z+0],T[Z+1]),zr(T[Z+0],T[Z+1],T[Z+2]),zr(T[Z+1],T[Z+2],T[Z+3]),zr(T[Z+2],T[Z+3],T[Z+4])]),U=0;4>U;++U)m(T,E+32*U,Z,0,Z.length)}function Ui(T,E){var U=T[E-1],Z=T[E-1+32],ne=T[E-1+64],le=T[E-1+96];er(T,E+0,16843009*zr(T[E-1-32],U,Z)),er(T,E+32,16843009*zr(U,Z,ne)),er(T,E+64,16843009*zr(Z,ne,le)),er(T,E+96,16843009*zr(ne,le,le))}function jr(T,E){var U,Z=4;for(U=0;4>U;++U)Z+=T[E+U-32]+T[E-1+32*U];for(Z>>=3,U=0;4>U;++U)v(T,E+32*U,Z,4)}function wi(T,E){var U=T[E-1+0],Z=T[E-1+32],ne=T[E-1+64],le=T[E-1-32],pe=T[E+0-32],_e=T[E+1-32],we=T[E+2-32],De=T[E+3-32];T[E+0+96]=zr(Z,ne,T[E-1+96]),T[E+1+96]=T[E+0+64]=zr(U,Z,ne),T[E+2+96]=T[E+1+64]=T[E+0+32]=zr(le,U,Z),T[E+3+96]=T[E+2+64]=T[E+1+32]=T[E+0+0]=zr(pe,le,U),T[E+3+64]=T[E+2+32]=T[E+1+0]=zr(_e,pe,le),T[E+3+32]=T[E+2+0]=zr(we,_e,pe),T[E+3+0]=zr(De,we,_e)}function Yn(T,E){var U=T[E+1-32],Z=T[E+2-32],ne=T[E+3-32],le=T[E+4-32],pe=T[E+5-32],_e=T[E+6-32],we=T[E+7-32];T[E+0+0]=zr(T[E+0-32],U,Z),T[E+1+0]=T[E+0+32]=zr(U,Z,ne),T[E+2+0]=T[E+1+32]=T[E+0+64]=zr(Z,ne,le),T[E+3+0]=T[E+2+32]=T[E+1+64]=T[E+0+96]=zr(ne,le,pe),T[E+3+32]=T[E+2+64]=T[E+1+96]=zr(le,pe,_e),T[E+3+64]=T[E+2+96]=zr(pe,_e,we),T[E+3+96]=zr(_e,we,we)}function Ki(T,E){var U=T[E-1+0],Z=T[E-1+32],ne=T[E-1+64],le=T[E-1-32],pe=T[E+0-32],_e=T[E+1-32],we=T[E+2-32],De=T[E+3-32];T[E+0+0]=T[E+1+64]=le+pe+1>>1,T[E+1+0]=T[E+2+64]=pe+_e+1>>1,T[E+2+0]=T[E+3+64]=_e+we+1>>1,T[E+3+0]=we+De+1>>1,T[E+0+96]=zr(ne,Z,U),T[E+0+64]=zr(Z,U,le),T[E+0+32]=T[E+1+96]=zr(U,le,pe),T[E+1+32]=T[E+2+96]=zr(le,pe,_e),T[E+2+32]=T[E+3+96]=zr(pe,_e,we),T[E+3+32]=zr(_e,we,De)}function as(T,E){var U=T[E+0-32],Z=T[E+1-32],ne=T[E+2-32],le=T[E+3-32],pe=T[E+4-32],_e=T[E+5-32],we=T[E+6-32],De=T[E+7-32];T[E+0+0]=U+Z+1>>1,T[E+1+0]=T[E+0+64]=Z+ne+1>>1,T[E+2+0]=T[E+1+64]=ne+le+1>>1,T[E+3+0]=T[E+2+64]=le+pe+1>>1,T[E+0+32]=zr(U,Z,ne),T[E+1+32]=T[E+0+96]=zr(Z,ne,le),T[E+2+32]=T[E+1+96]=zr(ne,le,pe),T[E+3+32]=T[E+2+96]=zr(le,pe,_e),T[E+3+64]=zr(pe,_e,we),T[E+3+96]=zr(_e,we,De)}function jn(T,E){var U=T[E-1+0],Z=T[E-1+32],ne=T[E-1+64],le=T[E-1+96];T[E+0+0]=U+Z+1>>1,T[E+2+0]=T[E+0+32]=Z+ne+1>>1,T[E+2+32]=T[E+0+64]=ne+le+1>>1,T[E+1+0]=zr(U,Z,ne),T[E+3+0]=T[E+1+32]=zr(Z,ne,le),T[E+3+32]=T[E+1+64]=zr(ne,le,le),T[E+3+64]=T[E+2+64]=T[E+0+96]=T[E+1+96]=T[E+2+96]=T[E+3+96]=le}function aa(T,E){var U=T[E-1+0],Z=T[E-1+32],ne=T[E-1+64],le=T[E-1+96],pe=T[E-1-32],_e=T[E+0-32],we=T[E+1-32],De=T[E+2-32];T[E+0+0]=T[E+2+32]=U+pe+1>>1,T[E+0+32]=T[E+2+64]=Z+U+1>>1,T[E+0+64]=T[E+2+96]=ne+Z+1>>1,T[E+0+96]=le+ne+1>>1,T[E+3+0]=zr(_e,we,De),T[E+2+0]=zr(pe,_e,we),T[E+1+0]=T[E+3+32]=zr(U,pe,_e),T[E+1+32]=T[E+3+64]=zr(Z,U,pe),T[E+1+64]=T[E+3+96]=zr(ne,Z,U),T[E+1+96]=zr(le,ne,Z)}function Gs(T,E){var U;for(U=0;8>U;++U)m(T,E+32*U,T,E-32,8)}function Mi(T,E){var U;for(U=0;8>U;++U)v(T,E,T[E-1],8),E+=32}function $s(T,E,U){var Z;for(Z=0;8>Z;++Z)v(E,U+32*Z,T,8)}function os(T,E){var U,Z=8;for(U=0;8>U;++U)Z+=T[E+U-32]+T[E-1+32*U];$s(Z>>4,T,E)}function ml(T,E){var U,Z=4;for(U=0;8>U;++U)Z+=T[E+U-32];$s(Z>>3,T,E)}function kn(T,E){var U,Z=4;for(U=0;8>U;++U)Z+=T[E-1+32*U];$s(Z>>3,T,E)}function oa(T,E){$s(128,T,E)}function ls(T,E,U){var Z=T[E-U],ne=T[E+0],le=3*(ne-Z)+vo[1020+T[E-2*U]-T[E+U]],pe=Jl[112+(le+4>>3)];T[E-U]=fs[255+Z+Jl[112+(le+3>>3)]],T[E+0]=fs[255+ne-pe]}function lo(T,E,U,Z){var ne=T[E+0],le=T[E+U];return Zr[255+T[E-2*U]-T[E-U]]>Z||Zr[255+le-ne]>Z}function No(T,E,U,Z){return 4*Zr[255+T[E-U]-T[E+0]]+Zr[255+T[E-2*U]-T[E+U]]<=Z}function Zs(T,E,U,Z,ne){var le=T[E-3*U],pe=T[E-2*U],_e=T[E-U],we=T[E+0],De=T[E+U],ke=T[E+2*U],It=T[E+3*U];return 4*Zr[255+_e-we]+Zr[255+pe-De]>Z?0:Zr[255+T[E-4*U]-le]<=ne&&Zr[255+le-pe]<=ne&&Zr[255+pe-_e]<=ne&&Zr[255+It-ke]<=ne&&Zr[255+ke-De]<=ne&&Zr[255+De-we]<=ne}function vi(T,E,U,Z){var ne=2*Z+1;for(Z=0;16>Z;++Z)No(T,E+Z,U,ne)&&ls(T,E+Z,U)}function Ws(T,E,U,Z){var ne=2*Z+1;for(Z=0;16>Z;++Z)No(T,E+Z*U,1,ne)&&ls(T,E+Z*U,1)}function ni(T,E,U,Z){var ne;for(ne=3;0<ne;--ne)vi(T,E+=4*U,U,Z)}function Hr(T,E,U,Z){var ne;for(ne=3;0<ne;--ne)Ws(T,E+=4,U,Z)}function Dn(T,E,U,Z,ne,le,pe,_e){for(le=2*le+1;0<ne--;){if(Zs(T,E,U,le,pe))if(lo(T,E,U,_e))ls(T,E,U);else{var we=T,De=E,ke=U,It=we[De-2*ke],Re=we[De-ke],dt=we[De+0],_t=we[De+ke],qt=we[De+2*ke],St=27*(Wt=vo[1020+3*(dt-Re)+vo[1020+It-_t]])+63>>7,$t=18*Wt+63>>7,Wt=9*Wt+63>>7;we[De-3*ke]=fs[255+we[De-3*ke]+Wt],we[De-2*ke]=fs[255+It+$t],we[De-ke]=fs[255+Re+St],we[De+0]=fs[255+dt-St],we[De+ke]=fs[255+_t-$t],we[De+2*ke]=fs[255+qt-Wt]}E+=Z}}function Kr(T,E,U,Z,ne,le,pe,_e){for(le=2*le+1;0<ne--;){if(Zs(T,E,U,le,pe))if(lo(T,E,U,_e))ls(T,E,U);else{var we=T,De=E,ke=U,It=we[De-ke],Re=we[De+0],dt=we[De+ke],_t=Jl[112+(4+(qt=3*(Re-It))>>3)],qt=Jl[112+(qt+3>>3)],St=_t+1>>1;we[De-2*ke]=fs[255+we[De-2*ke]+St],we[De-ke]=fs[255+It+qt],we[De+0]=fs[255+Re-_t],we[De+ke]=fs[255+dt-St]}E+=Z}}function z(T,E,U,Z,ne,le){Dn(T,E,U,1,16,Z,ne,le)}function ie(T,E,U,Z,ne,le){Dn(T,E,1,U,16,Z,ne,le)}function ze(T,E,U,Z,ne,le){var pe;for(pe=3;0<pe;--pe)Kr(T,E+=4*U,U,1,16,Z,ne,le)}function rt(T,E,U,Z,ne,le){var pe;for(pe=3;0<pe;--pe)Kr(T,E+=4,1,U,16,Z,ne,le)}function mt(T,E,U,Z,ne,le,pe,_e){Dn(T,E,ne,1,8,le,pe,_e),Dn(U,Z,ne,1,8,le,pe,_e)}function Gt(T,E,U,Z,ne,le,pe,_e){Dn(T,E,1,ne,8,le,pe,_e),Dn(U,Z,1,ne,8,le,pe,_e)}function tr(T,E,U,Z,ne,le,pe,_e){Kr(T,E+4*ne,ne,1,8,le,pe,_e),Kr(U,Z+4*ne,ne,1,8,le,pe,_e)}function Ir(T,E,U,Z,ne,le,pe,_e){Kr(T,E+4,1,ne,8,le,pe,_e),Kr(U,Z+4,1,ne,8,le,pe,_e)}function Dr(){this.ba=new qe,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new ft,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Mr(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function $r(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Ur(){this.ua=0,this.Wa=new wr,this.vb=new wr,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new At,this.yc=new Xe}function Ai(){this.xb=this.a=0,this.l=new Do,this.ca=new qe,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new Fe,this.Pb=0,this.wd=new Fe,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Ur,this.ab=0,this.gc=b(4,$r),this.Oc=0}function hn(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Do,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function bi(T,E,U,Z,ne,le,pe){for(T=T==null?0:T[E+0],E=0;E<pe;++E)ne[le+E]=T+U[Z+E]&255,T=ne[le+E]}function si(T,E,U,Z,ne,le,pe){var _e;if(T==null)bi(null,null,U,Z,ne,le,pe);else for(_e=0;_e<pe;++_e)ne[le+_e]=T[E+_e]+U[Z+_e]&255}function dn(T,E,U,Z,ne,le,pe){if(T==null)bi(null,null,U,Z,ne,le,pe);else{var _e,we=T[E+0],De=we,ke=we;for(_e=0;_e<pe;++_e)De=ke+(we=T[E+_e])-De,ke=U[Z+_e]+(-256&De?0>De?0:255:De)&255,De=we,ne[le+_e]=ke}}function Pn(T,E,U,Z){var ne=E.width,le=E.o;if(o(T!=null&&E!=null),0>U||0>=Z||U+Z>le)return null;if(!T.Cc){if(T.ga==null){var pe;if(T.ga=new hn,(pe=T.ga==null)||(pe=E.width*E.o,o(T.Gb.length==0),T.Gb=x(pe),T.Uc=0,T.Gb==null?pe=0:(T.mb=T.Gb,T.nb=T.Uc,T.rc=null,pe=1),pe=!pe),!pe){pe=T.ga;var _e=T.Fa,we=T.P,De=T.qc,ke=T.mb,It=T.nb,Re=we+1,dt=De-1,_t=pe.l;if(o(_e!=null&&ke!=null&&E!=null),ua[0]=null,ua[1]=bi,ua[2]=si,ua[3]=dn,pe.ca=ke,pe.tb=It,pe.c=E.width,pe.i=E.height,o(0<pe.c&&0<pe.i),1>=De)E=0;else if(pe.$a=3&_e[we+0],pe.Z=_e[we+0]>>2&3,pe.Lc=_e[we+0]>>4&3,we=_e[we+0]>>6&3,0>pe.$a||1<pe.$a||4<=pe.Z||1<pe.Lc||we)E=0;else if(_t.put=Mt,_t.ac=Ht,_t.bc=rr,_t.ma=pe,_t.width=E.width,_t.height=E.height,_t.Da=E.Da,_t.v=E.v,_t.va=E.va,_t.j=E.j,_t.o=E.o,pe.$a)e:{o(pe.$a==1),E=Bs();t:for(;;){if(E==null){E=0;break e}if(o(pe!=null),pe.mc=E,E.c=pe.c,E.i=pe.i,E.l=pe.l,E.l.ma=pe,E.l.width=pe.c,E.l.height=pe.i,E.a=0,vt(E.m,_e,Re,dt),!Mn(pe.c,pe.i,1,E,null)||(E.ab==1&&E.gc[0].hc==3&&Zi(E.s)?(pe.ic=1,_e=E.c*E.i,E.Ta=null,E.Ua=0,E.V=x(_e),E.Ba=0,E.V==null?(E.a=1,E=0):E=1):(pe.ic=0,E=Gr(E,pe.c)),!E))break t;E=1;break e}pe.mc=null,E=0}else E=dt>=pe.c*pe.i;pe=!E}if(pe)return null;T.ga.Lc!=1?T.Ga=0:Z=le-U}o(T.ga!=null),o(U+Z<=le);e:{if(E=(_e=T.ga).c,le=_e.l.o,_e.$a==0){if(Re=T.rc,dt=T.Vc,_t=T.Fa,we=T.P+1+U*E,De=T.mb,ke=T.nb+U*E,o(we<=T.P+T.qc),_e.Z!=0)for(o(ua[_e.Z]!=null),pe=0;pe<Z;++pe)ua[_e.Z](Re,dt,_t,we,De,ke,E),Re=De,dt=ke,ke+=E,we+=E;else for(pe=0;pe<Z;++pe)m(De,ke,_t,we,E),Re=De,dt=ke,ke+=E,we+=E;T.rc=Re,T.Vc=dt}else{if(o(_e.mc!=null),E=U+Z,o((pe=_e.mc)!=null),o(E<=pe.i),pe.C>=E)E=1;else if(_e.ic||Hs(),_e.ic){_e=pe.V,Re=pe.Ba,dt=pe.c;var qt=pe.i,St=(_t=1,we=pe.$/dt,De=pe.$%dt,ke=pe.m,It=pe.s,pe.$),$t=dt*qt,Wt=dt*E,or=It.wc,Qt=St<Wt?kr(It,De,we):null;o(St<=$t),o(E<=qt),o(Zi(It));t:for(;;){for(;!ke.h&&St<Wt;){if(De&or||(Qt=kr(It,De,we)),o(Qt!=null),ut(ke),256>(qt=ri(Qt.G[0],Qt.H[0],ke)))_e[Re+St]=qt,++St,++De>=dt&&(De=0,++we<=E&&!(we%16)&&Br(pe,we));else{if(!(280>qt)){_t=0;break t}qt=gr(qt-256,ke);var Nr,Sr=ri(Qt.G[4],Qt.H[4],ke);if(ut(ke),!(St>=(Sr=Xr(dt,Sr=gr(Sr,ke)))&&$t-St>=qt)){_t=0;break t}for(Nr=0;Nr<qt;++Nr)_e[Re+St+Nr]=_e[Re+St+Nr-Sr];for(St+=qt,De+=qt;De>=dt;)De-=dt,++we<=E&&!(we%16)&&Br(pe,we);St<Wt&&De&or&&(Qt=kr(It,De,we))}o(ke.h==tt(ke))}Br(pe,we>E?E:we);break t}!_t||ke.h&&St<$t?(_t=0,pe.a=ke.h?5:3):pe.$=St,E=_t}else E=Or(pe,pe.V,pe.Ba,pe.c,pe.i,E,ya);if(!E){Z=0;break e}}U+Z>=le&&(T.Cc=1),Z=1}if(!Z)return null;if(T.Cc&&((Z=T.ga)!=null&&(Z.mc=null),T.ga=null,0<T.Ga))return alert("todo:WebPDequantizeLevels"),null}return T.nb+U*ne}function Sa(T,E,U,Z,ne,le){for(;0<ne--;){var pe,_e=T,we=E+(U?1:0),De=T,ke=E+(U?0:3);for(pe=0;pe<Z;++pe){var It=De[ke+4*pe];It!=255&&(It*=32897,_e[we+4*pe+0]=_e[we+4*pe+0]*It>>23,_e[we+4*pe+1]=_e[we+4*pe+1]*It>>23,_e[we+4*pe+2]=_e[we+4*pe+2]*It>>23)}E+=le}}function co(T,E,U,Z,ne){for(;0<Z--;){var le;for(le=0;le<U;++le){var pe=T[E+2*le+0],_e=15&(De=T[E+2*le+1]),we=4369*_e,De=(240&De|De>>4)*we>>16;T[E+2*le+0]=(240&pe|pe>>4)*we>>16&240|(15&pe|pe<<4)*we>>16>>4&15,T[E+2*le+1]=240&De|_e}E+=ne}}function uo(T,E,U,Z,ne,le,pe,_e){var we,De,ke=255;for(De=0;De<ne;++De){for(we=0;we<Z;++we){var It=T[E+we];le[pe+4*we]=It,ke&=It}E+=U,pe+=_e}return ke!=255}function Oo(T,E,U,Z,ne){var le;for(le=0;le<ne;++le)U[Z+le]=T[E+le]>>8}function Hs(){bl=Sa,xc=co,yo=uo,Hl=Oo}function Ls(T,E,U){Te[T]=function(Z,ne,le,pe,_e,we,De,ke,It,Re,dt,_t,qt,St,$t,Wt,or){var Qt,Nr=or-1>>1,Sr=_e[we+0]|De[ke+0]<<16,Qr=It[Re+0]|dt[_t+0]<<16;o(Z!=null);var Cr=3*Sr+Qr+131074>>2;for(E(Z[ne+0],255&Cr,Cr>>16,qt,St),le!=null&&(Cr=3*Qr+Sr+131074>>2,E(le[pe+0],255&Cr,Cr>>16,$t,Wt)),Qt=1;Qt<=Nr;++Qt){var ui=_e[we+Qt]|De[ke+Qt]<<16,on=It[Re+Qt]|dt[_t+Qt]<<16,ei=Sr+ui+Qr+on+524296,Er=ei+2*(ui+Qr)>>3;Cr=Er+Sr>>1,Sr=(ei=ei+2*(Sr+on)>>3)+ui>>1,E(Z[ne+2*Qt-1],255&Cr,Cr>>16,qt,St+(2*Qt-1)*U),E(Z[ne+2*Qt-0],255&Sr,Sr>>16,qt,St+(2*Qt-0)*U),le!=null&&(Cr=ei+Qr>>1,Sr=Er+on>>1,E(le[pe+2*Qt-1],255&Cr,Cr>>16,$t,Wt+(2*Qt-1)*U),E(le[pe+2*Qt+0],255&Sr,Sr>>16,$t,Wt+(2*Qt+0)*U)),Sr=ui,Qr=on}1&or||(Cr=3*Sr+Qr+131074>>2,E(Z[ne+or-1],255&Cr,Cr>>16,qt,St+(or-1)*U),le!=null&&(Cr=3*Qr+Sr+131074>>2,E(le[pe+or-1],255&Cr,Cr>>16,$t,Wt+(or-1)*U)))}}function Ba(){Kn[Wo]=Lc,Kn[wc]=Sl,Kn[Jc]=xo,Kn[bo]=wo,Kn[Sc]=Ko,Kn[Kc]=nu,Kn[Qc]=Mu,Kn[eu]=Sl,Kn[Kl]=wo,Kn[Ga]=Ko,Kn[wl]=nu}function la(T){return T&-16384?0>T?0:255:T>>su}function Ms(T,E){return la((19077*T>>8)+(26149*E>>8)-14234)}function di(T,E,U){return la((19077*T>>8)-(6419*E>>8)-(13320*U>>8)+8708)}function Ta(T,E){return la((19077*T>>8)+(33050*E>>8)-17685)}function ys(T,E,U,Z,ne){Z[ne+0]=Ms(T,U),Z[ne+1]=di(T,E,U),Z[ne+2]=Ta(T,E)}function Pa(T,E,U,Z,ne){Z[ne+0]=Ta(T,E),Z[ne+1]=di(T,E,U),Z[ne+2]=Ms(T,U)}function ca(T,E,U,Z,ne){var le=di(T,E,U);E=le<<3&224|Ta(T,E)>>3,Z[ne+0]=248&Ms(T,U)|le>>5,Z[ne+1]=E}function cs(T,E,U,Z,ne){var le=240&Ta(T,E)|15;Z[ne+0]=240&Ms(T,U)|di(T,E,U)>>4,Z[ne+1]=le}function Bo(T,E,U,Z,ne){Z[ne+0]=255,ys(T,E,U,Z,ne+1)}function gl(T,E,U,Z,ne){Pa(T,E,U,Z,ne),Z[ne+3]=255}function ja(T,E,U,Z,ne){ys(T,E,U,Z,ne),Z[ne+3]=255}function fn(T,E){return 0>T?0:T>E?E:T}function Cs(T,E,U){Te[T]=function(Z,ne,le,pe,_e,we,De,ke,It){for(var Re=ke+(-2&It)*U;ke!=Re;)E(Z[ne+0],le[pe+0],_e[we+0],De,ke),E(Z[ne+1],le[pe+0],_e[we+0],De,ke+U),ne+=2,++pe,++we,ke+=2*U;1&It&&E(Z[ne+0],le[pe+0],_e[we+0],De,ke)}}function _l(T,E,U){return U==0?T==0?E==0?6:5:E==0?4:0:U}function jo(T,E,U,Z,ne){switch(T>>>30){case 3:Qi(E,U,Z,ne,0);break;case 2:qa(E,U,Z,ne);break;case 1:Ma(E,U,Z,ne)}}function Aa(T,E){var U,Z,ne=E.M,le=E.Nb,pe=T.oc,_e=T.pc+40,we=T.oc,De=T.pc+584,ke=T.oc,It=T.pc+600;for(U=0;16>U;++U)pe[_e+32*U-1]=129;for(U=0;8>U;++U)we[De+32*U-1]=129,ke[It+32*U-1]=129;for(0<ne?pe[_e-1-32]=we[De-1-32]=ke[It-1-32]=129:(v(pe,_e-32-1,127,21),v(we,De-32-1,127,9),v(ke,It-32-1,127,9)),Z=0;Z<T.za;++Z){var Re=E.ya[E.aa+Z];if(0<Z){for(U=-1;16>U;++U)m(pe,_e+32*U-4,pe,_e+32*U+12,4);for(U=-1;8>U;++U)m(we,De+32*U-4,we,De+32*U+4,4),m(ke,It+32*U-4,ke,It+32*U+4,4)}var dt=T.Gd,_t=T.Hd+Z,qt=Re.ad,St=Re.Hc;if(0<ne&&(m(pe,_e-32,dt[_t].y,0,16),m(we,De-32,dt[_t].f,0,8),m(ke,It-32,dt[_t].ea,0,8)),Re.Za){var $t=pe,Wt=_e-32+16;for(0<ne&&(Z>=T.za-1?v($t,Wt,dt[_t].y[15],4):m($t,Wt,dt[_t+1].y,0,4)),U=0;4>U;U++)$t[Wt+128+U]=$t[Wt+256+U]=$t[Wt+384+U]=$t[Wt+0+U];for(U=0;16>U;++U,St<<=2)$t=pe,Wt=_e+Pl[U],Ys[Re.Ob[U]]($t,Wt),jo(St,qt,16*+U,$t,Wt)}else if($t=_l(Z,ne,Re.Ob[0]),$a[$t](pe,_e),St!=0)for(U=0;16>U;++U,St<<=2)jo(St,qt,16*+U,pe,_e+Pl[U]);for(U=Re.Gc,$t=_l(Z,ne,Re.Dd),Si[$t](we,De),Si[$t](ke,It),St=qt,$t=we,Wt=De,255&(Re=0|U)&&(170&Re?Go(St,256,$t,Wt):Gl(St,256,$t,Wt)),Re=ke,St=It,255&(U>>=8)&&(170&U?Go(qt,320,Re,St):Gl(qt,320,Re,St)),ne<T.Ub-1&&(m(dt[_t].y,0,pe,_e+480,16),m(dt[_t].f,0,we,De+224,8),m(dt[_t].ea,0,ke,It+224,8)),U=8*le*T.B,dt=T.sa,_t=T.ta+16*Z+16*le*T.R,qt=T.qa,Re=T.ra+8*Z+U,St=T.Ha,$t=T.Ia+8*Z+U,U=0;16>U;++U)m(dt,_t+U*T.R,pe,_e+32*U,16);for(U=0;8>U;++U)m(qt,Re+U*T.B,we,De+32*U,8),m(St,$t+U*T.B,ke,It+32*U,8)}}function ho(T,E,U,Z,ne,le,pe,_e,we){var De=[0],ke=[0],It=0,Re=we!=null?we.kd:0,dt=we??new Mr;if(T==null||12>U)return 7;dt.data=T,dt.w=E,dt.ha=U,E=[E],U=[U],dt.gb=[dt.gb];e:{var _t=E,qt=U,St=dt.gb;if(o(T!=null),o(qt!=null),o(St!=null),St[0]=0,12<=qt[0]&&!u(T,_t[0],"RIFF")){if(u(T,_t[0]+8,"WEBP")){St=3;break e}var $t=Ft(T,_t[0]+4);if(12>$t||4294967286<$t){St=3;break e}if(Re&&$t>qt[0]-8){St=7;break e}St[0]=$t,_t[0]+=12,qt[0]-=12}St=0}if(St!=0)return St;for($t=0<dt.gb[0],U=U[0];;){e:{var Wt=T;qt=E,St=U;var or=De,Qt=ke,Nr=_t=[0];if((Cr=It=[It])[0]=0,8>St[0])St=7;else{if(!u(Wt,qt[0],"VP8X")){if(Ft(Wt,qt[0]+4)!=10){St=3;break e}if(18>St[0]){St=7;break e}var Sr=Ft(Wt,qt[0]+8),Qr=1+fr(Wt,qt[0]+12);if(2147483648<=Qr*(Wt=1+fr(Wt,qt[0]+15))){St=3;break e}Nr!=null&&(Nr[0]=Sr),or!=null&&(or[0]=Qr),Qt!=null&&(Qt[0]=Wt),qt[0]+=18,St[0]-=18,Cr[0]=1}St=0}}if(It=It[0],_t=_t[0],St!=0)return St;if(qt=!!(2&_t),!$t&&It)return 3;if(le!=null&&(le[0]=!!(16&_t)),pe!=null&&(pe[0]=qt),_e!=null&&(_e[0]=0),pe=De[0],_t=ke[0],It&&qt&&we==null){St=0;break}if(4>U){St=7;break}if($t&&It||!$t&&!It&&!u(T,E[0],"ALPH")){U=[U],dt.na=[dt.na],dt.P=[dt.P],dt.Sa=[dt.Sa];e:{Sr=T,St=E,$t=U;var Cr=dt.gb;or=dt.na,Qt=dt.P,Nr=dt.Sa,Qr=22,o(Sr!=null),o($t!=null),Wt=St[0];var ui=$t[0];for(o(or!=null),o(Nr!=null),or[0]=null,Qt[0]=null,Nr[0]=0;;){if(St[0]=Wt,$t[0]=ui,8>ui){St=7;break e}var on=Ft(Sr,Wt+4);if(4294967286<on){St=3;break e}var ei=8+on+1&-2;if(Qr+=ei,0<Cr&&Qr>Cr){St=3;break e}if(!u(Sr,Wt,"VP8 ")||!u(Sr,Wt,"VP8L")){St=0;break e}if(ui[0]<ei){St=7;break e}u(Sr,Wt,"ALPH")||(or[0]=Sr,Qt[0]=Wt+8,Nr[0]=on),Wt+=ei,ui-=ei}}if(U=U[0],dt.na=dt.na[0],dt.P=dt.P[0],dt.Sa=dt.Sa[0],St!=0)break}U=[U],dt.Ja=[dt.Ja],dt.xa=[dt.xa];e:if(Cr=T,St=E,$t=U,or=dt.gb[0],Qt=dt.Ja,Nr=dt.xa,Sr=St[0],Wt=!u(Cr,Sr,"VP8 "),Qr=!u(Cr,Sr,"VP8L"),o(Cr!=null),o($t!=null),o(Qt!=null),o(Nr!=null),8>$t[0])St=7;else{if(Wt||Qr){if(Cr=Ft(Cr,Sr+4),12<=or&&Cr>or-12){St=3;break e}if(Re&&Cr>$t[0]-8){St=7;break e}Qt[0]=Cr,St[0]+=8,$t[0]-=8,Nr[0]=Qr}else Nr[0]=5<=$t[0]&&Cr[Sr+0]==47&&!(Cr[Sr+4]>>5),Qt[0]=$t[0];St=0}if(U=U[0],dt.Ja=dt.Ja[0],dt.xa=dt.xa[0],E=E[0],St!=0)break;if(4294967286<dt.Ja)return 3;if(_e==null||qt||(_e[0]=dt.xa?2:1),pe=[pe],_t=[_t],dt.xa){if(5>U){St=7;break}_e=pe,Re=_t,qt=le,T==null||5>U?T=0:5<=U&&T[E+0]==47&&!(T[E+4]>>5)?($t=[0],Cr=[0],or=[0],vt(Qt=new Fe,T,E,U),Ut(Qt,$t,Cr,or)?(_e!=null&&(_e[0]=$t[0]),Re!=null&&(Re[0]=Cr[0]),qt!=null&&(qt[0]=or[0]),T=1):T=0):T=0}else{if(10>U){St=7;break}_e=_t,T==null||10>U||!ji(T,E+3,U-3)?T=0:(Re=T[E+0]|T[E+1]<<8|T[E+2]<<16,qt=16383&(T[E+7]<<8|T[E+6]),T=16383&(T[E+9]<<8|T[E+8]),1&Re||3<(Re>>1&7)||!(Re>>4&1)||Re>>5>=dt.Ja||!qt||!T?T=0:(pe&&(pe[0]=qt),_e&&(_e[0]=T),T=1))}if(!T||(pe=pe[0],_t=_t[0],It&&(De[0]!=pe||ke[0]!=_t)))return 3;we!=null&&(we[0]=dt,we.offset=E-we.w,o(4294967286>E-we.w),o(we.offset==we.ha-U));break}return St==0||St==7&&It&&we==null?(le!=null&&(le[0]|=dt.na!=null&&0<dt.na.length),Z!=null&&(Z[0]=pe),ne!=null&&(ne[0]=_t),0):St}function us(T,E,U){var Z=E.width,ne=E.height,le=0,pe=0,_e=Z,we=ne;if(E.Da=T!=null&&0<T.Da,E.Da&&(_e=T.cd,we=T.bd,le=T.v,pe=T.j,11>U||(le&=-2,pe&=-2),0>le||0>pe||0>=_e||0>=we||le+_e>Z||pe+we>ne))return 0;if(E.v=le,E.j=pe,E.va=le+_e,E.o=pe+we,E.U=_e,E.T=we,E.da=T!=null&&0<T.da,E.da){if(!Tr(_e,we,U=[T.ib],le=[T.hb]))return 0;E.ib=U[0],E.hb=le[0]}return E.ob=T!=null&&T.ob,E.Kb=T==null||!T.Sd,E.da&&(E.ob=E.ib<3*Z/4&&E.hb<3*ne/4,E.Kb=0),1}function hs(T){if(T==null)return 2;if(11>T.S){var E=T.f.RGBA;E.fb+=(T.height-1)*E.A,E.A=-E.A}else E=T.f.kb,T=T.height,E.O+=(T-1)*E.fa,E.fa=-E.fa,E.N+=(T-1>>1)*E.Ab,E.Ab=-E.Ab,E.W+=(T-1>>1)*E.Db,E.Db=-E.Db,E.F!=null&&(E.J+=(T-1)*E.lb,E.lb=-E.lb);return 0}function fo(T,E,U,Z){if(Z==null||0>=T||0>=E)return 2;if(U!=null){if(U.Da){var ne=U.cd,le=U.bd,pe=-2&U.v,_e=-2&U.j;if(0>pe||0>_e||0>=ne||0>=le||pe+ne>T||_e+le>E)return 2;T=ne,E=le}if(U.da){if(!Tr(T,E,ne=[U.ib],le=[U.hb]))return 2;T=ne[0],E=le[0]}}Z.width=T,Z.height=E;e:{var we=Z.width,De=Z.height;if(T=Z.S,0>=we||0>=De||!(T>=Wo&&13>T))T=2;else{if(0>=Z.Rd&&Z.sd==null){pe=le=ne=E=0;var ke=(_e=we*cu[T])*De;if(11>T||(le=(De+1)/2*(E=(we+1)/2),T==12&&(pe=(ne=we)*De)),(De=x(ke+2*le+pe))==null){T=1;break e}Z.sd=De,11>T?((we=Z.f.RGBA).eb=De,we.fb=0,we.A=_e,we.size=ke):((we=Z.f.kb).y=De,we.O=0,we.fa=_e,we.Fd=ke,we.f=De,we.N=0+ke,we.Ab=E,we.Cd=le,we.ea=De,we.W=0+ke+le,we.Db=E,we.Ed=le,T==12&&(we.F=De,we.J=0+ke+2*le),we.Tc=pe,we.lb=ne)}if(E=1,ne=Z.S,le=Z.width,pe=Z.height,ne>=Wo&&13>ne)if(11>ne)T=Z.f.RGBA,E&=(_e=Math.abs(T.A))*(pe-1)+le<=T.size,E&=_e>=le*cu[ne],E&=T.eb!=null;else{T=Z.f.kb,_e=(le+1)/2,ke=(pe+1)/2,we=Math.abs(T.fa),De=Math.abs(T.Ab);var It=Math.abs(T.Db),Re=Math.abs(T.lb),dt=Re*(pe-1)+le;E&=we*(pe-1)+le<=T.Fd,E&=De*(ke-1)+_e<=T.Cd,E=(E&=It*(ke-1)+_e<=T.Ed)&we>=le&De>=_e&It>=_e,E&=T.y!=null,E&=T.f!=null,E&=T.ea!=null,ne==12&&(E&=Re>=le,E&=dt<=T.Tc,E&=T.F!=null)}else E=0;T=E?0:2}}return T!=0||U!=null&&U.fd&&(T=hs(Z)),T}var Jn=64,Ua=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Uo=24,ks=32,an=8,yl=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];mr("Predictor0","PredictorAdd0"),Te.Predictor0=function(){return 4278190080},Te.Predictor1=function(T){return T},Te.Predictor2=function(T,E,U){return E[U+0]},Te.Predictor3=function(T,E,U){return E[U+1]},Te.Predictor4=function(T,E,U){return E[U-1]},Te.Predictor5=function(T,E,U){return Lr(Lr(T,E[U+1]),E[U+0])},Te.Predictor6=function(T,E,U){return Lr(T,E[U-1])},Te.Predictor7=function(T,E,U){return Lr(T,E[U+0])},Te.Predictor8=function(T,E,U){return Lr(E[U-1],E[U+0])},Te.Predictor9=function(T,E,U){return Lr(E[U+0],E[U+1])},Te.Predictor10=function(T,E,U){return Lr(Lr(T,E[U-1]),Lr(E[U+0],E[U+1]))},Te.Predictor11=function(T,E,U){var Z=E[U+0];return 0>=nt(Z>>24&255,T>>24&255,(E=E[U-1])>>24&255)+nt(Z>>16&255,T>>16&255,E>>16&255)+nt(Z>>8&255,T>>8&255,E>>8&255)+nt(255&Z,255&T,255&E)?Z:T},Te.Predictor12=function(T,E,U){var Z=E[U+0];return(ai((T>>24&255)+(Z>>24&255)-((E=E[U-1])>>24&255))<<24|ai((T>>16&255)+(Z>>16&255)-(E>>16&255))<<16|ai((T>>8&255)+(Z>>8&255)-(E>>8&255))<<8|ai((255&T)+(255&Z)-(255&E)))>>>0},Te.Predictor13=function(T,E,U){var Z=E[U-1];return(Rr((T=Lr(T,E[U+0]))>>24&255,Z>>24&255)<<24|Rr(T>>16&255,Z>>16&255)<<16|Rr(T>>8&255,Z>>8&255)<<8|Rr(255&T,255&Z))>>>0};var Ia=Te.PredictorAdd0;Te.PredictorAdd1=re,mr("Predictor2","PredictorAdd2"),mr("Predictor3","PredictorAdd3"),mr("Predictor4","PredictorAdd4"),mr("Predictor5","PredictorAdd5"),mr("Predictor6","PredictorAdd6"),mr("Predictor7","PredictorAdd7"),mr("Predictor8","PredictorAdd8"),mr("Predictor9","PredictorAdd9"),mr("Predictor10","PredictorAdd10"),mr("Predictor11","PredictorAdd11"),mr("Predictor12","PredictorAdd12"),mr("Predictor13","PredictorAdd13");var Ea=Te.PredictorAdd2;Ce("ColorIndexInverseTransform","MapARGB","32b",function(T){return T>>8&255},function(T){return T}),Ce("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(T){return T},function(T){return T>>8&255});var Vo,Va=Te.ColorIndexInverseTransform,qo=Te.MapARGB,po=Te.VP8LColorIndexInverseTransformAlpha,mo=Te.MapAlpha,La=Te.VP8LPredictorsAdd=[];La.length=16,(Te.VP8LPredictors=[]).length=16,(Te.VP8LPredictorsAdd_C=[]).length=16,(Te.VP8LPredictors_C=[]).length=16;var An,go,ds,Xs,Ci,Ii,Ri,Qi,qa,Go,Ma,Gl,Hc,Au,gi,$l,Zl,Wl,bc,_o,vl,$o,Ds,Xc,bl,xc,yo,Hl,Xl=x(511),xl=x(2041),Yl=x(225),Yc=x(767),Zo=0,vo=xl,Jl=Yl,fs=Yc,Zr=Xl,Wo=0,wc=1,Jc=2,bo=3,Sc=4,Kc=5,Qc=6,eu=7,Kl=8,Ga=9,wl=10,Tc=[2,3,7],tu=[3,3,11],Pc=[280,256,256,256,40],Ac=[0,1,1,1,0],Ic=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Ho=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Xo=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],ru=8,iu=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Yo=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Ql=null,Iu=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],ec=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],tc=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],Eu=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Lu=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],rc=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Ec=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],$a=[],Ys=[],Si=[],Jo=1,Fs=2,ua=[],Kn=[];Ls("UpsampleRgbLinePair",ys,3),Ls("UpsampleBgrLinePair",Pa,3),Ls("UpsampleRgbaLinePair",ja,4),Ls("UpsampleBgraLinePair",gl,4),Ls("UpsampleArgbLinePair",Bo,4),Ls("UpsampleRgba4444LinePair",cs,2),Ls("UpsampleRgb565LinePair",ca,2);var Lc=Te.UpsampleRgbLinePair,xo=Te.UpsampleBgrLinePair,Sl=Te.UpsampleRgbaLinePair,wo=Te.UpsampleBgraLinePair,Ko=Te.UpsampleArgbLinePair,nu=Te.UpsampleRgba4444LinePair,Mu=Te.UpsampleRgb565LinePair,ic=16,nc=1<<ic-1,Tl=-227,Za=482,su=6,Mc=0,sc=x(256),Cu=x(256),au=x(256),ou=x(256),ku=x(Za-Tl),lu=x(Za-Tl);Cs("YuvToRgbRow",ys,3),Cs("YuvToBgrRow",Pa,3),Cs("YuvToRgbaRow",ja,4),Cs("YuvToBgraRow",gl,4),Cs("YuvToArgbRow",Bo,4),Cs("YuvToRgba4444Row",cs,2),Cs("YuvToRgb565Row",ca,2);var Pl=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Wa=[0,2,8],Js=[8,7,6,4,4,2,2,2,1,1,1,1],ha=1;this.WebPDecodeRGBA=function(T,E,U,Z,ne){var le=wc,pe=new Dr,_e=new qe;pe.ba=_e,_e.S=le,_e.width=[_e.width],_e.height=[_e.height];var we=_e.width,De=_e.height,ke=new ae;if(ke==null||T==null)var It=2;else o(ke!=null),It=ho(T,E,U,ke.width,ke.height,ke.Pd,ke.Qd,ke.format,null);if(It!=0?we=0:(we!=null&&(we[0]=ke.width[0]),De!=null&&(De[0]=ke.height[0]),we=1),we){_e.width=_e.width[0],_e.height=_e.height[0],Z!=null&&(Z[0]=_e.width),ne!=null&&(ne[0]=_e.height);e:{if(Z=new Do,(ne=new Mr).data=T,ne.w=E,ne.ha=U,ne.kd=1,E=[0],o(ne!=null),((T=ho(ne.data,ne.w,ne.ha,null,null,null,E,null,ne))==0||T==7)&&E[0]&&(T=4),(E=T)==0){if(o(pe!=null),Z.data=ne.data,Z.w=ne.w+ne.offset,Z.ha=ne.ha-ne.offset,Z.put=Mt,Z.ac=Ht,Z.bc=rr,Z.ma=pe,ne.xa){if((T=Bs())==null){pe=1;break e}if(function(Re,dt){var _t=[0],qt=[0],St=[0];t:for(;;){if(Re==null)return 0;if(dt==null)return Re.a=2,0;if(Re.l=dt,Re.a=0,vt(Re.m,dt.data,dt.w,dt.ha),!Ut(Re.m,_t,qt,St)){Re.a=3;break t}if(Re.xb=Fs,dt.width=_t[0],dt.height=qt[0],!Mn(_t[0],qt[0],1,Re,null))break t;return 1}return o(Re.a!=0),0}(T,Z)){if(Z=(E=fo(Z.width,Z.height,pe.Oa,pe.ba))==0){t:{Z=T;r:for(;;){if(Z==null){Z=0;break t}if(o(Z.s.yc!=null),o(Z.s.Ya!=null),o(0<Z.s.Wb),o((U=Z.l)!=null),o((ne=U.ma)!=null),Z.xb!=0){if(Z.ca=ne.ba,Z.tb=ne.tb,o(Z.ca!=null),!us(ne.Oa,U,bo)){Z.a=2;break r}if(!Gr(Z,U.width)||U.da)break r;if((U.da||D(Z.ca.S))&&Hs(),11>Z.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),Z.ca.f.kb.F!=null&&Hs()),Z.Pb&&0<Z.s.ua&&Z.s.vb.X==null&&!Ue(Z.s.vb,Z.s.Wa.Xa)){Z.a=1;break r}Z.xb=0}if(!Or(Z,Z.V,Z.Ba,Z.c,Z.i,U.o,Ln))break r;ne.Dc=Z.Ma,Z=1;break t}o(Z.a!=0),Z=0}Z=!Z}Z&&(E=T.a)}else E=T.a}else{if((T=new Oa)==null){pe=1;break e}if(T.Fa=ne.na,T.P=ne.P,T.qc=ne.Sa,Ol(T,Z)){if((E=fo(Z.width,Z.height,pe.Oa,pe.ba))==0){if(T.Aa=0,U=pe.Oa,o((ne=T)!=null),U!=null){if(0<(we=0>(we=U.Md)?0:100<we?255:255*we/100)){for(De=ke=0;4>De;++De)12>(It=ne.pb[De]).lc&&(It.ia=we*Js[0>It.lc?0:It.lc]>>3),ke|=It.ia;ke&&(alert("todo:VP8InitRandom"),ne.ia=1)}ne.Ga=U.Id,100<ne.Ga?ne.Ga=100:0>ne.Ga&&(ne.Ga=0)}(function(Re,dt){if(Re==null)return 0;if(dt==null)return Ji(Re,2,"NULL VP8Io parameter in VP8Decode().");if(!Re.cb&&!Ol(Re,dt))return 0;if(o(Re.cb),dt.ac==null||dt.ac(dt)){dt.ob&&(Re.L=0);var _t=Wa[Re.L];if(Re.L==2?(Re.yb=0,Re.zb=0):(Re.yb=dt.v-_t>>4,Re.zb=dt.j-_t>>4,0>Re.yb&&(Re.yb=0),0>Re.zb&&(Re.zb=0)),Re.Va=dt.o+15+_t>>4,Re.Hb=dt.va+15+_t>>4,Re.Hb>Re.za&&(Re.Hb=Re.za),Re.Va>Re.Ub&&(Re.Va=Re.Ub),0<Re.L){var qt=Re.ed;for(_t=0;4>_t;++_t){var St;if(Re.Qa.Cb){var $t=Re.Qa.Lb[_t];Re.Qa.Fb||($t+=qt.Tb)}else $t=qt.Tb;for(St=0;1>=St;++St){var Wt=Re.gd[_t][St],or=$t;if(qt.Pc&&(or+=qt.vd[0],St&&(or+=qt.od[0])),0<(or=0>or?0:63<or?63:or)){var Qt=or;0<qt.wb&&(Qt=4<qt.wb?Qt>>2:Qt>>1)>9-qt.wb&&(Qt=9-qt.wb),1>Qt&&(Qt=1),Wt.dd=Qt,Wt.tc=2*or+Qt,Wt.ld=40<=or?2:15<=or?1:0}else Wt.tc=0;Wt.La=St}}}_t=0}else Ji(Re,6,"Frame setup failed"),_t=Re.a;if(_t=_t==0){if(_t){Re.$c=0,0<Re.Aa||(Re.Ic=ha);t:{_t=Re.Ic,qt=4*(Qt=Re.za);var Nr=32*Qt,Sr=Qt+1,Qr=0<Re.L?Qt*(0<Re.Aa?2:1):0,Cr=(Re.Aa==2?2:1)*Qt;if((Wt=qt+832+(St=3*(16*_t+Wa[Re.L])/2*Nr)+($t=Re.Fa!=null&&0<Re.Fa.length?Re.Kc.c*Re.Kc.i:0))!=Wt)_t=0;else{if(Wt>Re.Vb){if(Re.Vb=0,Re.Ec=x(Wt),Re.Fc=0,Re.Ec==null){_t=Ji(Re,1,"no memory during frame initialization.");break t}Re.Vb=Wt}Wt=Re.Ec,or=Re.Fc,Re.Ac=Wt,Re.Bc=or,or+=qt,Re.Gd=b(Nr,xa),Re.Hd=0,Re.rb=b(Sr+1,mi),Re.sb=1,Re.wa=Qr?b(Qr,Bi):null,Re.Y=0,Re.D.Nb=0,Re.D.wa=Re.wa,Re.D.Y=Re.Y,0<Re.Aa&&(Re.D.Y+=Qt),o(!0),Re.oc=Wt,Re.pc=or,or+=832,Re.ya=b(Cr,ba),Re.aa=0,Re.D.ya=Re.ya,Re.D.aa=Re.aa,Re.Aa==2&&(Re.D.aa+=Qt),Re.R=16*Qt,Re.B=8*Qt,Qt=(Nr=Wa[Re.L])*Re.R,Nr=Nr/2*Re.B,Re.sa=Wt,Re.ta=or+Qt,Re.qa=Re.sa,Re.ra=Re.ta+16*_t*Re.R+Nr,Re.Ha=Re.qa,Re.Ia=Re.ra+8*_t*Re.B+Nr,Re.$c=0,or+=St,Re.mb=$t?Wt:null,Re.nb=$t?or:null,o(or+$t<=Re.Fc+Re.Vb),na(Re),v(Re.Ac,Re.Bc,0,qt),_t=1}}if(_t){if(dt.ka=0,dt.y=Re.sa,dt.O=Re.ta,dt.f=Re.qa,dt.N=Re.ra,dt.ea=Re.Ha,dt.Vd=Re.Ia,dt.fa=Re.R,dt.Rc=Re.B,dt.F=null,dt.J=0,!Zo){for(_t=-255;255>=_t;++_t)Xl[255+_t]=0>_t?-_t:_t;for(_t=-1020;1020>=_t;++_t)xl[1020+_t]=-128>_t?-128:127<_t?127:_t;for(_t=-112;112>=_t;++_t)Yl[112+_t]=-16>_t?-16:15<_t?15:_t;for(_t=-255;510>=_t;++_t)Yc[255+_t]=0>_t?0:255<_t?255:_t;Zo=1}Ri=ao,Qi=jl,Go=Ul,Ma=Us,Gl=vc,qa=Bl,Hc=z,Au=ie,gi=mt,$l=Gt,Zl=ze,Wl=rt,bc=tr,_o=Ir,vl=vi,$o=Ws,Ds=ni,Xc=Hr,Ys[0]=jr,Ys[1]=pl,Ys[2]=Cn,Ys[3]=Ui,Ys[4]=wi,Ys[5]=Ki,Ys[6]=Yn,Ys[7]=as,Ys[8]=aa,Ys[9]=jn,$a[0]=Wr,$a[1]=Vl,$a[2]=Fo,$a[3]=Vs,$a[4]=ql,$a[5]=Ro,$a[6]=zo,Si[0]=os,Si[1]=oo,Si[2]=Gs,Si[3]=Mi,Si[4]=kn,Si[5]=ml,Si[6]=oa,_t=1}else _t=0}_t&&(_t=function(ui,on){for(ui.M=0;ui.M<ui.Va;++ui.M){var ei,Er=ui.Jc[ui.M&ui.Xb],_r=ui.m,Ei=ui;for(ei=0;ei<Ei.za;++ei){var br=_r,pi=Ei,ki=pi.Ac,pn=pi.Bc+4*ei,Un=pi.zc,Wi=pi.ya[pi.aa+ei];if(pi.Qa.Bb?Wi.$b=Bt(br,pi.Pa.jb[0])?2+Bt(br,pi.Pa.jb[2]):Bt(br,pi.Pa.jb[1]):Wi.$b=0,pi.kc&&(Wi.Ad=Bt(br,pi.Bd)),Wi.Za=!Bt(br,145)+0,Wi.Za){var Vn=Wi.Ob,qn=0;for(pi=0;4>pi;++pi){var vn,ii=Un[0+pi];for(vn=0;4>vn;++vn){ii=Lu[ki[pn+vn]][ii];for(var xi=tc[Bt(br,ii[0])];0<xi;)xi=tc[2*xi+Bt(br,ii[xi])];ii=-xi,ki[pn+vn]=ii}m(Vn,qn,ki,pn,4),qn+=4,Un[0+pi]=ii}}else ii=Bt(br,156)?Bt(br,128)?1:3:Bt(br,163)?2:0,Wi.Ob[0]=ii,v(ki,pn,ii,4),v(Un,0,ii,4);Wi.Dd=Bt(br,142)?Bt(br,114)?Bt(br,183)?1:3:2:0}if(Ei.m.Ka)return Ji(ui,7,"Premature end-of-partition0 encountered.");for(;ui.ja<ui.za;++ui.ja){if(Ei=Er,br=(_r=ui).rb[_r.sb-1],ki=_r.rb[_r.sb+_r.ja],ei=_r.ya[_r.aa+_r.ja],pn=_r.kc?ei.Ad:0)br.la=ki.la=0,ei.Za||(br.Na=ki.Na=0),ei.Hc=0,ei.Gc=0,ei.ia=0;else{var cr,hr;if(br=ki,ki=Ei,pn=_r.Pa.Xc,Un=_r.ya[_r.aa+_r.ja],Wi=_r.pb[Un.$b],pi=Un.ad,Vn=0,qn=_r.rb[_r.sb-1],ii=vn=0,v(pi,Vn,0,384),Un.Za)var ln=0,Rs=pn[3];else{xi=x(16);var zi=br.Na+qn.Na;if(zi=Ql(ki,pn[1],zi,Wi.Eb,0,xi,0),br.Na=qn.Na=(0<zi)+0,1<zi)Ri(xi,0,pi,Vn);else{var Di=xi[0]+3>>3;for(xi=0;256>xi;xi+=16)pi[Vn+xi]=Di}ln=1,Rs=pn[0]}var li=15&br.la,bn=15&qn.la;for(xi=0;4>xi;++xi){var zs=1&bn;for(Di=hr=0;4>Di;++Di)li=li>>1|(zs=(zi=Ql(ki,Rs,zi=zs+(1&li),Wi.Sc,ln,pi,Vn))>ln)<<7,hr=hr<<2|(3<zi?3:1<zi?2:pi[Vn+0]!=0),Vn+=16;li>>=4,bn=bn>>1|zs<<7,vn=(vn<<8|hr)>>>0}for(Rs=li,ln=bn>>4,cr=0;4>cr;cr+=2){for(hr=0,li=br.la>>4+cr,bn=qn.la>>4+cr,xi=0;2>xi;++xi){for(zs=1&bn,Di=0;2>Di;++Di)zi=zs+(1&li),li=li>>1|(zs=0<(zi=Ql(ki,pn[2],zi,Wi.Qc,0,pi,Vn)))<<3,hr=hr<<2|(3<zi?3:1<zi?2:pi[Vn+0]!=0),Vn+=16;li>>=2,bn=bn>>1|zs<<5}ii|=hr<<4*cr,Rs|=li<<4<<cr,ln|=(240&bn)<<cr}br.la=Rs,qn.la=ln,Un.Hc=vn,Un.Gc=ii,Un.ia=43690&ii?0:Wi.ia,pn=!(vn|ii)}if(0<_r.L&&(_r.wa[_r.Y+_r.ja]=_r.gd[ei.$b][ei.Za],_r.wa[_r.Y+_r.ja].La|=!pn),Ei.Ka)return Ji(ui,7,"Premature end-of-file encountered.")}if(na(ui),_r=on,Ei=1,ei=(Er=ui).D,br=0<Er.L&&Er.M>=Er.zb&&Er.M<=Er.Va,Er.Aa==0)t:{if(ei.M=Er.M,ei.uc=br,Aa(Er,ei),Ei=1,ei=(hr=Er.D).Nb,br=(ii=Wa[Er.L])*Er.R,ki=ii/2*Er.B,xi=16*ei*Er.R,Di=8*ei*Er.B,pn=Er.sa,Un=Er.ta-br+xi,Wi=Er.qa,pi=Er.ra-ki+Di,Vn=Er.Ha,qn=Er.Ia-ki+Di,bn=(li=hr.M)==0,vn=li>=Er.Va-1,Er.Aa==2&&Aa(Er,hr),hr.uc)for(zs=(zi=Er).D.M,o(zi.D.uc),hr=zi.yb;hr<zi.Hb;++hr){ln=hr,Rs=zs;var Qn=(vs=(In=zi).D).Nb;cr=In.R;var vs=vs.wa[vs.Y+ln],Fn=In.sa,fi=In.ta+16*Qn*cr+16*ln,_i=vs.dd,Ni=vs.tc;if(Ni!=0)if(o(3<=Ni),In.L==1)0<ln&&$o(Fn,fi,cr,Ni+4),vs.La&&Xc(Fn,fi,cr,Ni),0<Rs&&vl(Fn,fi,cr,Ni+4),vs.La&&Ds(Fn,fi,cr,Ni);else{var Gn=In.B,bs=In.qa,xs=In.ra+8*Qn*Gn+8*ln,da=In.Ha,In=In.Ia+8*Qn*Gn+8*ln;Qn=vs.ld,0<ln&&(Au(Fn,fi,cr,Ni+4,_i,Qn),$l(bs,xs,da,In,Gn,Ni+4,_i,Qn)),vs.La&&(Wl(Fn,fi,cr,Ni,_i,Qn),_o(bs,xs,da,In,Gn,Ni,_i,Qn)),0<Rs&&(Hc(Fn,fi,cr,Ni+4,_i,Qn),gi(bs,xs,da,In,Gn,Ni+4,_i,Qn)),vs.La&&(Zl(Fn,fi,cr,Ni,_i,Qn),bc(bs,xs,da,In,Gn,Ni,_i,Qn))}}if(Er.ia&&alert("todo:DitherRow"),_r.put!=null){if(hr=16*li,li=16*(li+1),bn?(_r.y=Er.sa,_r.O=Er.ta+xi,_r.f=Er.qa,_r.N=Er.ra+Di,_r.ea=Er.Ha,_r.W=Er.Ia+Di):(hr-=ii,_r.y=pn,_r.O=Un,_r.f=Wi,_r.N=pi,_r.ea=Vn,_r.W=qn),vn||(li-=ii),li>_r.o&&(li=_r.o),_r.F=null,_r.J=null,Er.Fa!=null&&0<Er.Fa.length&&hr<li&&(_r.J=Pn(Er,_r,hr,li-hr),_r.F=Er.mb,_r.F==null&&_r.F.length==0)){Ei=Ji(Er,3,"Could not decode alpha data.");break t}hr<_r.j&&(ii=_r.j-hr,hr=_r.j,o(!(1&ii)),_r.O+=Er.R*ii,_r.N+=Er.B*(ii>>1),_r.W+=Er.B*(ii>>1),_r.F!=null&&(_r.J+=_r.width*ii)),hr<li&&(_r.O+=_r.v,_r.N+=_r.v>>1,_r.W+=_r.v>>1,_r.F!=null&&(_r.J+=_r.v),_r.ka=hr-_r.j,_r.U=_r.va-_r.v,_r.T=li-hr,Ei=_r.put(_r))}ei+1!=Er.Ic||vn||(m(Er.sa,Er.ta-br,pn,Un+16*Er.R,br),m(Er.qa,Er.ra-ki,Wi,pi+8*Er.B,ki),m(Er.Ha,Er.Ia-ki,Vn,qn+8*Er.B,ki))}if(!Ei)return Ji(ui,6,"Output aborted.")}return 1}(Re,dt)),dt.bc!=null&&dt.bc(dt),_t&=1}return _t?(Re.cb=0,_t):0})(T,Z)||(E=T.a)}}else E=T.a}E==0&&pe.Oa!=null&&pe.Oa.fd&&(E=hs(pe.ba))}pe=E}le=pe!=0?null:11>le?_e.f.RGBA.eb:_e.f.kb.y}else le=null;return le};var cu=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function F(Te,st){for(var me="",xe=0;xe<4;xe++)me+=String.fromCharCode(Te[st++]);return me}function O(Te,st){return Te[st+0]|Te[st+1]<<8}function Y(Te,st){return(Te[st+0]|Te[st+1]<<8|Te[st+2]<<16)>>>0}function ee(Te,st){return(Te[st+0]|Te[st+1]<<8|Te[st+2]<<16|Te[st+3]<<24)>>>0}new C;var j=[0],Pe=[0],ce=[],Q=new C,ge=p,Qe=function(Te,st){var me={},xe=0,Xe=!1,Ye=0,At=0;if(me.frames=[],!function(he,Fe){for(var $e=0;$e<4;$e++)if(he[Fe+$e]!="RIFF".charCodeAt($e))return!0;return!1}(Te,st)){for(ee(Te,st+=4),st+=8;st<Te.length;){var Dt=F(Te,st),kt=ee(Te,st+=4);st+=4;var yt=kt+(1&kt);switch(Dt){case"VP8 ":case"VP8L":me.frames[xe]===void 0&&(me.frames[xe]={}),(Zt=me.frames[xe]).src_off=Xe?At:st-8,Zt.src_size=Ye+kt+8,xe++,Xe&&(Xe=!1,Ye=0,At=0);break;case"VP8X":(Zt=me.header={}).feature_flags=Te[st];var vt=st+4;Zt.canvas_width=1+Y(Te,vt),vt+=3,Zt.canvas_height=1+Y(Te,vt),vt+=3;break;case"ALPH":Xe=!0,Ye=yt+8,At=st-8;break;case"ANIM":(Zt=me.header).bgcolor=ee(Te,st),vt=st+4,Zt.loop_count=O(Te,vt),vt+=2;break;case"ANMF":var sr,Zt;(Zt=me.frames[xe]={}).offset_x=2*Y(Te,st),st+=3,Zt.offset_y=2*Y(Te,st),st+=3,Zt.width=1+Y(Te,st),st+=3,Zt.height=1+Y(Te,st),st+=3,Zt.duration=Y(Te,st),st+=3,sr=Te[st++],Zt.dispose=1&sr,Zt.blend=sr>>1&1}Dt!="ANMF"&&(st+=yt)}return me}}(ge,0);Qe.response=ge,Qe.rgbaoutput=!0,Qe.dataurl=!1;var Oe=Qe.header?Qe.header:null,Me=Qe.frames?Qe.frames:null;if(Oe){Oe.loop_counter=Oe.loop_count,j=[Oe.canvas_height],Pe=[Oe.canvas_width];for(var Ge=0;Ge<Me.length&&Me[Ge].blend!=0;Ge++);}var Ze=Me[0],it=Q.WebPDecodeRGBA(ge,Ze.src_off,Ze.src_size,Pe,j);Ze.rgba=it,Ze.imgwidth=Pe[0],Ze.imgheight=j[0];for(var He=0;He<Pe[0]*j[0]*4;He++)ce[He]=it[He];return this.width=Pe,this.height=j,this.data=ce,this}(function(p){var o,u,m,v,x,b,a,C,F,O=function(he){return he=he||{},this.isStrokeTransparent=he.isStrokeTransparent||!1,this.strokeOpacity=he.strokeOpacity||1,this.strokeStyle=he.strokeStyle||"#000000",this.fillStyle=he.fillStyle||"#000000",this.isFillTransparent=he.isFillTransparent||!1,this.fillOpacity=he.fillOpacity||1,this.font=he.font||"10px sans-serif",this.textBaseline=he.textBaseline||"alphabetic",this.textAlign=he.textAlign||"left",this.lineWidth=he.lineWidth||1,this.lineJoin=he.lineJoin||"miter",this.lineCap=he.lineCap||"butt",this.path=he.path||[],this.transform=he.transform!==void 0?he.transform.clone():new C,this.globalCompositeOperation=he.globalCompositeOperation||"normal",this.globalAlpha=he.globalAlpha||1,this.clip_path=he.clip_path||[],this.currentPoint=he.currentPoint||new b,this.miterLimit=he.miterLimit||10,this.lastPoint=he.lastPoint||new b,this.lineDashOffset=he.lineDashOffset||0,this.lineDash=he.lineDash||[],this.margin=he.margin||[0,0,0,0],this.prevPageLastElemOffset=he.prevPageLastElemOffset||0,this.ignoreClearRect=typeof he.ignoreClearRect!="boolean"||he.ignoreClearRect,this};p.events.push(["initialized",function(){this.context2d=new Y(this),o=this.internal.f2,u=this.internal.getCoordinateString,m=this.internal.getVerticalCoordinateString,v=this.internal.getHorizontalCoordinate,x=this.internal.getVerticalCoordinate,b=this.internal.Point,a=this.internal.Rectangle,C=this.internal.Matrix,F=new O}]);var Y=function(he){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Fe=he;Object.defineProperty(this,"pdf",{get:function(){return Fe}});var $e=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return $e},set:function(Ft){$e=!!Ft}});var tt=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return tt},set:function(Ft){tt=!!Ft}});var ct=0;Object.defineProperty(this,"posX",{get:function(){return ct},set:function(Ft){isNaN(Ft)||(ct=Ft)}});var ut=0;Object.defineProperty(this,"posY",{get:function(){return ut},set:function(Ft){isNaN(Ft)||(ut=Ft)}}),Object.defineProperty(this,"margin",{get:function(){return F.margin},set:function(Ft){var Ue;typeof Ft=="number"?Ue=[Ft,Ft,Ft,Ft]:((Ue=new Array(4))[0]=Ft[0],Ue[1]=Ft.length>=2?Ft[1]:Ue[0],Ue[2]=Ft.length>=3?Ft[2]:Ue[0],Ue[3]=Ft.length>=4?Ft[3]:Ue[1]),F.margin=Ue}});var pt=!1;Object.defineProperty(this,"autoPaging",{get:function(){return pt},set:function(Ft){pt=Ft}});var wt=0;Object.defineProperty(this,"lastBreak",{get:function(){return wt},set:function(Ft){wt=Ft}});var Bt=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Bt},set:function(Ft){Bt=Ft}}),Object.defineProperty(this,"ctx",{get:function(){return F},set:function(Ft){Ft instanceof O&&(F=Ft)}}),Object.defineProperty(this,"path",{get:function(){return F.path},set:function(Ft){F.path=Ft}});var er=[];Object.defineProperty(this,"ctxStack",{get:function(){return er},set:function(Ft){er=Ft}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(Ft){var Ue;Ue=ee(Ft),this.ctx.fillStyle=Ue.style,this.ctx.isFillTransparent=Ue.a===0,this.ctx.fillOpacity=Ue.a,this.pdf.setFillColor(Ue.r,Ue.g,Ue.b,{a:Ue.a}),this.pdf.setTextColor(Ue.r,Ue.g,Ue.b,{a:Ue.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(Ft){var Ue=ee(Ft);this.ctx.strokeStyle=Ue.style,this.ctx.isStrokeTransparent=Ue.a===0,this.ctx.strokeOpacity=Ue.a,Ue.a===0?this.pdf.setDrawColor(255,255,255):(Ue.a,this.pdf.setDrawColor(Ue.r,Ue.g,Ue.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(Ft){["butt","round","square"].indexOf(Ft)!==-1&&(this.ctx.lineCap=Ft,this.pdf.setLineCap(Ft))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(Ft){isNaN(Ft)||(this.ctx.lineWidth=Ft,this.pdf.setLineWidth(Ft))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(Ft){["bevel","round","miter"].indexOf(Ft)!==-1&&(this.ctx.lineJoin=Ft,this.pdf.setLineJoin(Ft))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(Ft){isNaN(Ft)||(this.ctx.miterLimit=Ft,this.pdf.setMiterLimit(Ft))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(Ft){this.ctx.textBaseline=Ft}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(Ft){["right","end","center","left","start"].indexOf(Ft)!==-1&&(this.ctx.textAlign=Ft)}});var ur=null,fr=null;Object.defineProperty(this,"fontFaces",{get:function(){return fr},set:function(Ft){ur=null,fr=Ft}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(Ft){var Ue;if(this.ctx.font=Ft,(Ue=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(Ft))!==null){var Yr=Ue[1];Ue[2];var wr=Ue[3],Tr=Ue[4];Ue[5];var ir=Ue[6],Ar=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Tr)[2];Tr=Math.floor(Ar==="px"?parseFloat(Tr)*this.pdf.internal.scaleFactor:Ar==="em"?parseFloat(Tr)*this.pdf.getFontSize():parseFloat(Tr)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Tr);var mr=function(Ie){var Ce,ht,at=[],Be=Ie.trim();if(Be==="")return My;if(Be in wy)return[wy[Be]];for(;Be!=="";){switch(ht=null,Ce=(Be=Ty(Be)).charAt(0)){case'"':case"'":ht=Bw(Be.substring(1),Ce);break;default:ht=jw(Be)}if(ht===null||(at.push(ht[0]),(Be=Ty(ht[1]))!==""&&Be.charAt(0)!==","))return My;Be=Be.replace(/^,/,"")}return at}(ir);if(this.fontFaces){var Vr=function(Ie,Ce){if(ur===null){var ht=function(at){var Be=[];return Object.keys(at).forEach(function(ot){at[ot].forEach(function(Rt){var te=null;switch(Rt){case"bold":te={family:ot,weight:"bold"};break;case"italic":te={family:ot,style:"italic"};break;case"bolditalic":te={family:ot,weight:"bold",style:"italic"};break;case"":case"normal":te={family:ot}}te!==null&&(te.ref={name:ot,style:Rt},Be.push(te))})}),Be}(Ie.getFontList());ur=function(at){for(var Be={},ot=0;ot<at.length;++ot){var Rt=Ap(at[ot]),te=Rt.family,I=Rt.stretch,D=Rt.style,fe=Rt.weight;Be[te]=Be[te]||{},Be[te][I]=Be[te][I]||{},Be[te][I][D]=Be[te][I][D]||{},Be[te][I][D][fe]=Rt}return Be}(ht.concat(Ce))}return ur}(this.pdf,this.fontFaces),Lr=mr.map(function(Ie){return{family:Ie,stretch:"normal",weight:wr,style:Yr}}),ai=function(Ie,Ce,ht){for(var at=(ht=ht||{}).defaultFontFamily||"times",Be=Object.assign({},Ow,ht.genericFontFamilies||{}),ot=null,Rt=null,te=0;te<Ce.length;++te)if(Be[(ot=Ap(Ce[te])).family]&&(ot.family=Be[ot.family]),Ie.hasOwnProperty(ot.family)){Rt=Ie[ot.family];break}if(!(Rt=Rt||Ie[at]))throw new Error("Could not find a font-family for the rule '"+Sy(ot)+"' and default family '"+at+"'.");if(Rt=function(I,D){if(D[I])return D[I];var fe=Vp[I],Ee=fe<=Vp.normal?-1:1,qe=xy(D,z0,fe,Ee);if(!qe)throw new Error("Could not find a matching font-stretch value for "+I);return qe}(ot.stretch,Rt),Rt=function(I,D){if(D[I])return D[I];for(var fe=R0[I],Ee=0;Ee<fe.length;++Ee)if(D[fe[Ee]])return D[fe[Ee]];throw new Error("Could not find a matching font-style for "+I)}(ot.style,Rt),!(Rt=function(I,D){if(D[I])return D[I];if(I===400&&D[500])return D[500];if(I===500&&D[400])return D[400];var fe=Nw[I],Ee=xy(D,N0,fe,I<400?-1:1);if(!Ee)throw new Error("Could not find a matching font-weight for value "+I);return Ee}(ot.weight,Rt)))throw new Error("Failed to resolve a font for the rule '"+Sy(ot)+"'.");return Rt}(Vr,Lr);this.pdf.setFont(ai.ref.name,ai.ref.style)}else{var Rr="";(wr==="bold"||parseInt(wr,10)>=700||Yr==="bold")&&(Rr="bold"),Yr==="italic"&&(Rr+="italic"),Rr.length===0&&(Rr="normal");for(var nt="",re={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},K=0;K<mr.length;K++){if(this.pdf.internal.getFont(mr[K],Rr,{noFallback:!0,disableWarning:!0})!==void 0){nt=mr[K];break}if(Rr==="bolditalic"&&this.pdf.internal.getFont(mr[K],"bold",{noFallback:!0,disableWarning:!0})!==void 0)nt=mr[K],Rr="bold";else if(this.pdf.internal.getFont(mr[K],"normal",{noFallback:!0,disableWarning:!0})!==void 0){nt=mr[K],Rr="normal";break}}if(nt===""){for(var se=0;se<mr.length;se++)if(re[mr[se]]){nt=re[mr[se]];break}}nt=nt===""?"Times":nt,this.pdf.setFont(nt,Rr)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(Ft){this.ctx.globalCompositeOperation=Ft}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(Ft){this.ctx.globalAlpha=Ft}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(Ft){this.ctx.lineDashOffset=Ft,Zt.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(Ft){this.ctx.lineDash=Ft,Zt.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(Ft){this.ctx.ignoreClearRect=!!Ft}})};Y.prototype.setLineDash=function(he){this.lineDash=he},Y.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},Y.prototype.fill=function(){Me.call(this,"fill",!1)},Y.prototype.stroke=function(){Me.call(this,"stroke",!1)},Y.prototype.beginPath=function(){this.path=[{type:"begin"}]},Y.prototype.moveTo=function(he,Fe){if(isNaN(he)||isNaN(Fe))throw nn.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var $e=this.ctx.transform.applyToPoint(new b(he,Fe));this.path.push({type:"mt",x:$e.x,y:$e.y}),this.ctx.lastPoint=new b(he,Fe)},Y.prototype.closePath=function(){var he=new b(0,0),Fe=0;for(Fe=this.path.length-1;Fe!==-1;Fe--)if(this.path[Fe].type==="begin"&&$i(this.path[Fe+1])==="object"&&typeof this.path[Fe+1].x=="number"){he=new b(this.path[Fe+1].x,this.path[Fe+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new b(he.x,he.y)},Y.prototype.lineTo=function(he,Fe){if(isNaN(he)||isNaN(Fe))throw nn.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var $e=this.ctx.transform.applyToPoint(new b(he,Fe));this.path.push({type:"lt",x:$e.x,y:$e.y}),this.ctx.lastPoint=new b($e.x,$e.y)},Y.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),Me.call(this,null,!0)},Y.prototype.quadraticCurveTo=function(he,Fe,$e,tt){if(isNaN($e)||isNaN(tt)||isNaN(he)||isNaN(Fe))throw nn.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var ct=this.ctx.transform.applyToPoint(new b($e,tt)),ut=this.ctx.transform.applyToPoint(new b(he,Fe));this.path.push({type:"qct",x1:ut.x,y1:ut.y,x:ct.x,y:ct.y}),this.ctx.lastPoint=new b(ct.x,ct.y)},Y.prototype.bezierCurveTo=function(he,Fe,$e,tt,ct,ut){if(isNaN(ct)||isNaN(ut)||isNaN(he)||isNaN(Fe)||isNaN($e)||isNaN(tt))throw nn.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var pt=this.ctx.transform.applyToPoint(new b(ct,ut)),wt=this.ctx.transform.applyToPoint(new b(he,Fe)),Bt=this.ctx.transform.applyToPoint(new b($e,tt));this.path.push({type:"bct",x1:wt.x,y1:wt.y,x2:Bt.x,y2:Bt.y,x:pt.x,y:pt.y}),this.ctx.lastPoint=new b(pt.x,pt.y)},Y.prototype.arc=function(he,Fe,$e,tt,ct,ut){if(isNaN(he)||isNaN(Fe)||isNaN($e)||isNaN(tt)||isNaN(ct))throw nn.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(ut=!!ut,!this.ctx.transform.isIdentity){var pt=this.ctx.transform.applyToPoint(new b(he,Fe));he=pt.x,Fe=pt.y;var wt=this.ctx.transform.applyToPoint(new b(0,$e)),Bt=this.ctx.transform.applyToPoint(new b(0,0));$e=Math.sqrt(Math.pow(wt.x-Bt.x,2)+Math.pow(wt.y-Bt.y,2))}Math.abs(ct-tt)>=2*Math.PI&&(tt=0,ct=2*Math.PI),this.path.push({type:"arc",x:he,y:Fe,radius:$e,startAngle:tt,endAngle:ct,counterclockwise:ut})},Y.prototype.arcTo=function(he,Fe,$e,tt,ct){throw new Error("arcTo not implemented.")},Y.prototype.rect=function(he,Fe,$e,tt){if(isNaN(he)||isNaN(Fe)||isNaN($e)||isNaN(tt))throw nn.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(he,Fe),this.lineTo(he+$e,Fe),this.lineTo(he+$e,Fe+tt),this.lineTo(he,Fe+tt),this.lineTo(he,Fe),this.lineTo(he+$e,Fe),this.lineTo(he,Fe)},Y.prototype.fillRect=function(he,Fe,$e,tt){if(isNaN(he)||isNaN(Fe)||isNaN($e)||isNaN(tt))throw nn.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!j.call(this)){var ct={};this.lineCap!=="butt"&&(ct.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(ct.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(he,Fe,$e,tt),this.fill(),ct.hasOwnProperty("lineCap")&&(this.lineCap=ct.lineCap),ct.hasOwnProperty("lineJoin")&&(this.lineJoin=ct.lineJoin)}},Y.prototype.strokeRect=function(he,Fe,$e,tt){if(isNaN(he)||isNaN(Fe)||isNaN($e)||isNaN(tt))throw nn.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");Pe.call(this)||(this.beginPath(),this.rect(he,Fe,$e,tt),this.stroke())},Y.prototype.clearRect=function(he,Fe,$e,tt){if(isNaN(he)||isNaN(Fe)||isNaN($e)||isNaN(tt))throw nn.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(he,Fe,$e,tt))},Y.prototype.save=function(he){he=typeof he!="boolean"||he;for(var Fe=this.pdf.internal.getCurrentPageInfo().pageNumber,$e=0;$e<this.pdf.internal.getNumberOfPages();$e++)this.pdf.setPage($e+1),this.pdf.internal.out("q");if(this.pdf.setPage(Fe),he){this.ctx.fontSize=this.pdf.internal.getFontSize();var tt=new O(this.ctx);this.ctxStack.push(this.ctx),this.ctx=tt}},Y.prototype.restore=function(he){he=typeof he!="boolean"||he;for(var Fe=this.pdf.internal.getCurrentPageInfo().pageNumber,$e=0;$e<this.pdf.internal.getNumberOfPages();$e++)this.pdf.setPage($e+1),this.pdf.internal.out("Q");this.pdf.setPage(Fe),he&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},Y.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var ee=function(he){var Fe,$e,tt,ct;if(he.isCanvasGradient===!0&&(he=he.getColor()),!he)return{r:0,g:0,b:0,a:0,style:he};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(he))Fe=0,$e=0,tt=0,ct=0;else{var ut=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(he);if(ut!==null)Fe=parseInt(ut[1]),$e=parseInt(ut[2]),tt=parseInt(ut[3]),ct=1;else if((ut=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(he))!==null)Fe=parseInt(ut[1]),$e=parseInt(ut[2]),tt=parseInt(ut[3]),ct=parseFloat(ut[4]);else{if(ct=1,typeof he=="string"&&he.charAt(0)!=="#"){var pt=new E0(he);he=pt.ok?pt.toHex():"#000000"}he.length===4?(Fe=he.substring(1,2),Fe+=Fe,$e=he.substring(2,3),$e+=$e,tt=he.substring(3,4),tt+=tt):(Fe=he.substring(1,3),$e=he.substring(3,5),tt=he.substring(5,7)),Fe=parseInt(Fe,16),$e=parseInt($e,16),tt=parseInt(tt,16)}}return{r:Fe,g:$e,b:tt,a:ct,style:he}},j=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},Pe=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};Y.prototype.fillText=function(he,Fe,$e,tt){if(isNaN(Fe)||isNaN($e)||typeof he!="string")throw nn.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(tt=isNaN(tt)?void 0:tt,!j.call(this)){var ct=yt(this.ctx.transform.rotation),ut=this.ctx.transform.scaleX;xe.call(this,{text:he,x:Fe,y:$e,scale:ut,angle:ct,align:this.textAlign,maxWidth:tt})}},Y.prototype.strokeText=function(he,Fe,$e,tt){if(isNaN(Fe)||isNaN($e)||typeof he!="string")throw nn.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!Pe.call(this)){tt=isNaN(tt)?void 0:tt;var ct=yt(this.ctx.transform.rotation),ut=this.ctx.transform.scaleX;xe.call(this,{text:he,x:Fe,y:$e,scale:ut,renderingMode:"stroke",angle:ct,align:this.textAlign,maxWidth:tt})}},Y.prototype.measureText=function(he){if(typeof he!="string")throw nn.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Fe=this.pdf,$e=this.pdf.internal.scaleFactor,tt=Fe.internal.getFontSize(),ct=Fe.getStringUnitWidth(he)*tt/Fe.internal.scaleFactor;return new function(ut){var pt=(ut=ut||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return pt}}),this}({width:ct*=Math.round(96*$e/72*1e4)/1e4})},Y.prototype.scale=function(he,Fe){if(isNaN(he)||isNaN(Fe))throw nn.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var $e=new C(he,0,0,Fe,0,0);this.ctx.transform=this.ctx.transform.multiply($e)},Y.prototype.rotate=function(he){if(isNaN(he))throw nn.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Fe=new C(Math.cos(he),Math.sin(he),-Math.sin(he),Math.cos(he),0,0);this.ctx.transform=this.ctx.transform.multiply(Fe)},Y.prototype.translate=function(he,Fe){if(isNaN(he)||isNaN(Fe))throw nn.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var $e=new C(1,0,0,1,he,Fe);this.ctx.transform=this.ctx.transform.multiply($e)},Y.prototype.transform=function(he,Fe,$e,tt,ct,ut){if(isNaN(he)||isNaN(Fe)||isNaN($e)||isNaN(tt)||isNaN(ct)||isNaN(ut))throw nn.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var pt=new C(he,Fe,$e,tt,ct,ut);this.ctx.transform=this.ctx.transform.multiply(pt)},Y.prototype.setTransform=function(he,Fe,$e,tt,ct,ut){he=isNaN(he)?1:he,Fe=isNaN(Fe)?0:Fe,$e=isNaN($e)?0:$e,tt=isNaN(tt)?1:tt,ct=isNaN(ct)?0:ct,ut=isNaN(ut)?0:ut,this.ctx.transform=new C(he,Fe,$e,tt,ct,ut)};var ce=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};Y.prototype.drawImage=function(he,Fe,$e,tt,ct,ut,pt,wt,Bt){var er=this.pdf.getImageProperties(he),ur=1,fr=1,Ft=1,Ue=1;tt!==void 0&&wt!==void 0&&(Ft=wt/tt,Ue=Bt/ct,ur=er.width/tt*wt/tt,fr=er.height/ct*Bt/ct),ut===void 0&&(ut=Fe,pt=$e,Fe=0,$e=0),tt!==void 0&&wt===void 0&&(wt=tt,Bt=ct),tt===void 0&&wt===void 0&&(wt=er.width,Bt=er.height);for(var Yr,wr=this.ctx.transform.decompose(),Tr=yt(wr.rotate.shx),ir=new C,Ar=(ir=(ir=(ir=ir.multiply(wr.translate)).multiply(wr.skew)).multiply(wr.scale)).applyToRectangle(new a(ut-Fe*Ft,pt-$e*Ue,tt*ur,ct*fr)),mr=Q.call(this,Ar),Vr=[],Lr=0;Lr<mr.length;Lr+=1)Vr.indexOf(mr[Lr])===-1&&Vr.push(mr[Lr]);if(Oe(Vr),this.autoPaging)for(var ai=Vr[0],Rr=Vr[Vr.length-1],nt=ai;nt<Rr+1;nt++){this.pdf.setPage(nt);var re=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],K=nt===1?this.posY+this.margin[0]:this.margin[0],se=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ie=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Ce=nt===1?0:se+(nt-2)*Ie;if(this.ctx.clip_path.length!==0){var ht=this.path;Yr=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=Qe(Yr,this.posX+this.margin[3],-Ce+K+this.ctx.prevPageLastElemOffset),Ge.call(this,"fill",!0),this.path=ht}var at=JSON.parse(JSON.stringify(Ar));at=Qe([at],this.posX+this.margin[3],-Ce+K+this.ctx.prevPageLastElemOffset)[0];var Be=(nt>ai||nt<Rr)&&ce.call(this);Be&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],re,Ie,null).clip().discardPath()),this.pdf.addImage(he,"JPEG",at.x,at.y,at.w,at.h,null,null,Tr),Be&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(he,"JPEG",Ar.x,Ar.y,Ar.w,Ar.h,null,null,Tr)};var Q=function(he,Fe,$e){var tt=[];Fe=Fe||this.pdf.internal.pageSize.width,$e=$e||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var ct=this.posY+this.ctx.prevPageLastElemOffset;switch(he.type){default:case"mt":case"lt":tt.push(Math.floor((he.y+ct)/$e)+1);break;case"arc":tt.push(Math.floor((he.y+ct-he.radius)/$e)+1),tt.push(Math.floor((he.y+ct+he.radius)/$e)+1);break;case"qct":var ut=vt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,he.x1,he.y1,he.x,he.y);tt.push(Math.floor((ut.y+ct)/$e)+1),tt.push(Math.floor((ut.y+ut.h+ct)/$e)+1);break;case"bct":var pt=sr(this.ctx.lastPoint.x,this.ctx.lastPoint.y,he.x1,he.y1,he.x2,he.y2,he.x,he.y);tt.push(Math.floor((pt.y+ct)/$e)+1),tt.push(Math.floor((pt.y+pt.h+ct)/$e)+1);break;case"rect":tt.push(Math.floor((he.y+ct)/$e)+1),tt.push(Math.floor((he.y+he.h+ct)/$e)+1)}for(var wt=0;wt<tt.length;wt+=1)for(;this.pdf.internal.getNumberOfPages()<tt[wt];)ge.call(this);return tt},ge=function(){var he=this.fillStyle,Fe=this.strokeStyle,$e=this.font,tt=this.lineCap,ct=this.lineWidth,ut=this.lineJoin;this.pdf.addPage(),this.fillStyle=he,this.strokeStyle=Fe,this.font=$e,this.lineCap=tt,this.lineWidth=ct,this.lineJoin=ut},Qe=function(he,Fe,$e){for(var tt=0;tt<he.length;tt++)switch(he[tt].type){case"bct":he[tt].x2+=Fe,he[tt].y2+=$e;case"qct":he[tt].x1+=Fe,he[tt].y1+=$e;default:he[tt].x+=Fe,he[tt].y+=$e}return he},Oe=function(he){return he.sort(function(Fe,$e){return Fe-$e})},Me=function(he,Fe){for(var $e,tt,ct=this.fillStyle,ut=this.strokeStyle,pt=this.lineCap,wt=this.lineWidth,Bt=Math.abs(wt*this.ctx.transform.scaleX),er=this.lineJoin,ur=JSON.parse(JSON.stringify(this.path)),fr=JSON.parse(JSON.stringify(this.path)),Ft=[],Ue=0;Ue<fr.length;Ue++)if(fr[Ue].x!==void 0)for(var Yr=Q.call(this,fr[Ue]),wr=0;wr<Yr.length;wr+=1)Ft.indexOf(Yr[wr])===-1&&Ft.push(Yr[wr]);for(var Tr=0;Tr<Ft.length;Tr++)for(;this.pdf.internal.getNumberOfPages()<Ft[Tr];)ge.call(this);if(Oe(Ft),this.autoPaging)for(var ir=Ft[0],Ar=Ft[Ft.length-1],mr=ir;mr<Ar+1;mr++){this.pdf.setPage(mr),this.fillStyle=ct,this.strokeStyle=ut,this.lineCap=pt,this.lineWidth=Bt,this.lineJoin=er;var Vr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Lr=mr===1?this.posY+this.margin[0]:this.margin[0],ai=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Rr=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],nt=mr===1?0:ai+(mr-2)*Rr;if(this.ctx.clip_path.length!==0){var re=this.path;$e=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=Qe($e,this.posX+this.margin[3],-nt+Lr+this.ctx.prevPageLastElemOffset),Ge.call(this,he,!0),this.path=re}if(tt=JSON.parse(JSON.stringify(ur)),this.path=Qe(tt,this.posX+this.margin[3],-nt+Lr+this.ctx.prevPageLastElemOffset),Fe===!1||mr===0){var K=(mr>ir||mr<Ar)&&ce.call(this);K&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Vr,Rr,null).clip().discardPath()),Ge.call(this,he,Fe),K&&this.pdf.restoreGraphicsState()}this.lineWidth=wt}else this.lineWidth=Bt,Ge.call(this,he,Fe),this.lineWidth=wt;this.path=ur},Ge=function(he,Fe){if((he!=="stroke"||Fe||!Pe.call(this))&&(he==="stroke"||Fe||!j.call(this))){for(var $e,tt,ct=[],ut=this.path,pt=0;pt<ut.length;pt++){var wt=ut[pt];switch(wt.type){case"begin":ct.push({begin:!0});break;case"close":ct.push({close:!0});break;case"mt":ct.push({start:wt,deltas:[],abs:[]});break;case"lt":var Bt=ct.length;if(ut[pt-1]&&!isNaN(ut[pt-1].x)&&($e=[wt.x-ut[pt-1].x,wt.y-ut[pt-1].y],Bt>0)){for(;Bt>=0;Bt--)if(ct[Bt-1].close!==!0&&ct[Bt-1].begin!==!0){ct[Bt-1].deltas.push($e),ct[Bt-1].abs.push(wt);break}}break;case"bct":$e=[wt.x1-ut[pt-1].x,wt.y1-ut[pt-1].y,wt.x2-ut[pt-1].x,wt.y2-ut[pt-1].y,wt.x-ut[pt-1].x,wt.y-ut[pt-1].y],ct[ct.length-1].deltas.push($e);break;case"qct":var er=ut[pt-1].x+2/3*(wt.x1-ut[pt-1].x),ur=ut[pt-1].y+2/3*(wt.y1-ut[pt-1].y),fr=wt.x+2/3*(wt.x1-wt.x),Ft=wt.y+2/3*(wt.y1-wt.y),Ue=wt.x,Yr=wt.y;$e=[er-ut[pt-1].x,ur-ut[pt-1].y,fr-ut[pt-1].x,Ft-ut[pt-1].y,Ue-ut[pt-1].x,Yr-ut[pt-1].y],ct[ct.length-1].deltas.push($e);break;case"arc":ct.push({deltas:[],abs:[],arc:!0}),Array.isArray(ct[ct.length-1].abs)&&ct[ct.length-1].abs.push(wt)}}tt=Fe?null:he==="stroke"?"stroke":"fill";for(var wr=!1,Tr=0;Tr<ct.length;Tr++)if(ct[Tr].arc)for(var ir=ct[Tr].abs,Ar=0;Ar<ir.length;Ar++){var mr=ir[Ar];mr.type==="arc"?He.call(this,mr.x,mr.y,mr.radius,mr.startAngle,mr.endAngle,mr.counterclockwise,void 0,Fe,!wr):Xe.call(this,mr.x,mr.y),wr=!0}else if(ct[Tr].close===!0)this.pdf.internal.out("h"),wr=!1;else if(ct[Tr].begin!==!0){var Vr=ct[Tr].start.x,Lr=ct[Tr].start.y;Ye.call(this,ct[Tr].deltas,Vr,Lr),wr=!0}tt&&Te.call(this,tt),Fe&&st.call(this)}},Ze=function(he){var Fe=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,$e=Fe*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return he-$e;case"top":return he+Fe-$e;case"hanging":return he+Fe-2*$e;case"middle":return he+Fe/2-$e;default:return he}},it=function(he){return he+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};Y.prototype.createLinearGradient=function(){var he=function(){};return he.colorStops=[],he.addColorStop=function(Fe,$e){this.colorStops.push([Fe,$e])},he.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},he.isCanvasGradient=!0,he},Y.prototype.createPattern=function(){return this.createLinearGradient()},Y.prototype.createRadialGradient=function(){return this.createLinearGradient()};var He=function(he,Fe,$e,tt,ct,ut,pt,wt,Bt){for(var er=Dt.call(this,$e,tt,ct,ut),ur=0;ur<er.length;ur++){var fr=er[ur];ur===0&&(Bt?me.call(this,fr.x1+he,fr.y1+Fe):Xe.call(this,fr.x1+he,fr.y1+Fe)),At.call(this,he,Fe,fr.x2,fr.y2,fr.x3,fr.y3,fr.x4,fr.y4)}wt?st.call(this):Te.call(this,pt)},Te=function(he){switch(he){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},st=function(){this.pdf.clip(),this.pdf.discardPath()},me=function(he,Fe){this.pdf.internal.out(u(he)+" "+m(Fe)+" m")},xe=function(he){var Fe;switch(he.align){case"right":case"end":Fe="right";break;case"center":Fe="center";break;default:Fe="left"}var $e=this.pdf.getTextDimensions(he.text),tt=Ze.call(this,he.y),ct=it.call(this,tt)-$e.h,ut=this.ctx.transform.applyToPoint(new b(he.x,tt)),pt=this.ctx.transform.decompose(),wt=new C;wt=(wt=(wt=wt.multiply(pt.translate)).multiply(pt.skew)).multiply(pt.scale);for(var Bt,er,ur,fr=this.ctx.transform.applyToRectangle(new a(he.x,tt,$e.w,$e.h)),Ft=wt.applyToRectangle(new a(he.x,ct,$e.w,$e.h)),Ue=Q.call(this,Ft),Yr=[],wr=0;wr<Ue.length;wr+=1)Yr.indexOf(Ue[wr])===-1&&Yr.push(Ue[wr]);if(Oe(Yr),this.autoPaging)for(var Tr=Yr[0],ir=Yr[Yr.length-1],Ar=Tr;Ar<ir+1;Ar++){this.pdf.setPage(Ar);var mr=Ar===1?this.posY+this.margin[0]:this.margin[0],Vr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Lr=this.pdf.internal.pageSize.height-this.margin[2],ai=Lr-this.margin[0],Rr=this.pdf.internal.pageSize.width-this.margin[1],nt=Rr-this.margin[3],re=Ar===1?0:Vr+(Ar-2)*ai;if(this.ctx.clip_path.length!==0){var K=this.path;Bt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=Qe(Bt,this.posX+this.margin[3],-1*re+mr),Ge.call(this,"fill",!0),this.path=K}var se=Qe([JSON.parse(JSON.stringify(Ft))],this.posX+this.margin[3],-re+mr+this.ctx.prevPageLastElemOffset)[0];he.scale>=.01&&(er=this.pdf.internal.getFontSize(),this.pdf.setFontSize(er*he.scale),ur=this.lineWidth,this.lineWidth=ur*he.scale);var Ie=this.autoPaging!=="text";if(Ie||se.y+se.h<=Lr){if(Ie||se.y>=mr&&se.x<=Rr){var Ce=Ie?he.text:this.pdf.splitTextToSize(he.text,he.maxWidth||Rr-se.x)[0],ht=Qe([JSON.parse(JSON.stringify(fr))],this.posX+this.margin[3],-re+mr+this.ctx.prevPageLastElemOffset)[0],at=Ie&&(Ar>Tr||Ar<ir)&&ce.call(this);at&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],nt,ai,null).clip().discardPath()),this.pdf.text(Ce,ht.x,ht.y,{angle:he.angle,align:Fe,renderingMode:he.renderingMode}),at&&this.pdf.restoreGraphicsState()}}else se.y<Lr&&(this.ctx.prevPageLastElemOffset+=Lr-se.y);he.scale>=.01&&(this.pdf.setFontSize(er),this.lineWidth=ur)}else he.scale>=.01&&(er=this.pdf.internal.getFontSize(),this.pdf.setFontSize(er*he.scale),ur=this.lineWidth,this.lineWidth=ur*he.scale),this.pdf.text(he.text,ut.x+this.posX,ut.y+this.posY,{angle:he.angle,align:Fe,renderingMode:he.renderingMode,maxWidth:he.maxWidth}),he.scale>=.01&&(this.pdf.setFontSize(er),this.lineWidth=ur)},Xe=function(he,Fe,$e,tt){$e=$e||0,tt=tt||0,this.pdf.internal.out(u(he+$e)+" "+m(Fe+tt)+" l")},Ye=function(he,Fe,$e){return this.pdf.lines(he,Fe,$e,null,null)},At=function(he,Fe,$e,tt,ct,ut,pt,wt){this.pdf.internal.out([o(v($e+he)),o(x(tt+Fe)),o(v(ct+he)),o(x(ut+Fe)),o(v(pt+he)),o(x(wt+Fe)),"c"].join(" "))},Dt=function(he,Fe,$e,tt){for(var ct=2*Math.PI,ut=Math.PI/2;Fe>$e;)Fe-=ct;var pt=Math.abs($e-Fe);pt<ct&&tt&&(pt=ct-pt);for(var wt=[],Bt=tt?-1:1,er=Fe;pt>1e-5;){var ur=er+Bt*Math.min(pt,ut);wt.push(kt.call(this,he,er,ur)),pt-=Math.abs(ur-er),er=ur}return wt},kt=function(he,Fe,$e){var tt=($e-Fe)/2,ct=he*Math.cos(tt),ut=he*Math.sin(tt),pt=ct,wt=-ut,Bt=pt*pt+wt*wt,er=Bt+pt*ct+wt*ut,ur=4/3*(Math.sqrt(2*Bt*er)-er)/(pt*ut-wt*ct),fr=pt-ur*wt,Ft=wt+ur*pt,Ue=fr,Yr=-Ft,wr=tt+Fe,Tr=Math.cos(wr),ir=Math.sin(wr);return{x1:he*Math.cos(Fe),y1:he*Math.sin(Fe),x2:fr*Tr-Ft*ir,y2:fr*ir+Ft*Tr,x3:Ue*Tr-Yr*ir,y3:Ue*ir+Yr*Tr,x4:he*Math.cos($e),y4:he*Math.sin($e)}},yt=function(he){return 180*he/Math.PI},vt=function(he,Fe,$e,tt,ct,ut){var pt=he+.5*($e-he),wt=Fe+.5*(tt-Fe),Bt=ct+.5*($e-ct),er=ut+.5*(tt-ut),ur=Math.min(he,ct,pt,Bt),fr=Math.max(he,ct,pt,Bt),Ft=Math.min(Fe,ut,wt,er),Ue=Math.max(Fe,ut,wt,er);return new a(ur,Ft,fr-ur,Ue-Ft)},sr=function(he,Fe,$e,tt,ct,ut,pt,wt){var Bt,er,ur,fr,Ft,Ue,Yr,wr,Tr,ir,Ar,mr,Vr,Lr,ai=$e-he,Rr=tt-Fe,nt=ct-$e,re=ut-tt,K=pt-ct,se=wt-ut;for(er=0;er<41;er++)Tr=(Yr=(ur=he+(Bt=er/40)*ai)+Bt*((Ft=$e+Bt*nt)-ur))+Bt*(Ft+Bt*(ct+Bt*K-Ft)-Yr),ir=(wr=(fr=Fe+Bt*Rr)+Bt*((Ue=tt+Bt*re)-fr))+Bt*(Ue+Bt*(ut+Bt*se-Ue)-wr),er==0?(Ar=Tr,mr=ir,Vr=Tr,Lr=ir):(Ar=Math.min(Ar,Tr),mr=Math.min(mr,ir),Vr=Math.max(Vr,Tr),Lr=Math.max(Lr,ir));return new a(Math.round(Ar),Math.round(mr),Math.round(Vr-Ar),Math.round(Lr-mr))},Zt=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var he,Fe,$e=(he=this.ctx.lineDash,Fe=this.ctx.lineDashOffset,JSON.stringify({lineDash:he,lineDashOffset:Fe}));this.prevLineDash!==$e&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=$e)}}})(qr.API),function(p){var o=function(b){var a,C,F,O,Y,ee,j,Pe,ce,Q;for(C=[],F=0,O=(b+=a="\0\0\0\0".slice(b.length%4||4)).length;O>F;F+=4)(Y=(b.charCodeAt(F)<<24)+(b.charCodeAt(F+1)<<16)+(b.charCodeAt(F+2)<<8)+b.charCodeAt(F+3))!==0?(ee=(Y=((Y=((Y=((Y=(Y-(Q=Y%85))/85)-(ce=Y%85))/85)-(Pe=Y%85))/85)-(j=Y%85))/85)%85,C.push(ee+33,j+33,Pe+33,ce+33,Q+33)):C.push(122);return function(ge,Qe){for(var Oe=Qe;Oe>0;Oe--)ge.pop()}(C,a.length),String.fromCharCode.apply(String,C)+"~>"},u=function(b){var a,C,F,O,Y,ee=String,j="length",Pe=255,ce="charCodeAt",Q="slice",ge="replace";for(b[Q](-2),b=b[Q](0,-2)[ge](/\s/g,"")[ge]("z","!!!!!"),F=[],O=0,Y=(b+=a="uuuuu"[Q](b[j]%5||5))[j];Y>O;O+=5)C=52200625*(b[ce](O)-33)+614125*(b[ce](O+1)-33)+7225*(b[ce](O+2)-33)+85*(b[ce](O+3)-33)+(b[ce](O+4)-33),F.push(Pe&C>>24,Pe&C>>16,Pe&C>>8,Pe&C);return function(Qe,Oe){for(var Me=Oe;Me>0;Me--)Qe.pop()}(F,a[j]),ee.fromCharCode.apply(ee,F)},m=function(b){return b.split("").map(function(a){return("0"+a.charCodeAt().toString(16)).slice(-2)}).join("")+">"},v=function(b){var a=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((b=b.replace(/\s/g,"")).indexOf(">")!==-1&&(b=b.substr(0,b.indexOf(">"))),b.length%2&&(b+="0"),a.test(b)===!1)return"";for(var C="",F=0;F<b.length;F+=2)C+=String.fromCharCode("0x"+(b[F]+b[F+1]));return C},x=function(b){for(var a=new Uint8Array(b.length),C=b.length;C--;)a[C]=b.charCodeAt(C);return(a=Rp(a)).reduce(function(F,O){return F+String.fromCharCode(O)},"")};p.processDataByFilters=function(b,a){var C=0,F=b||"",O=[];for(typeof(a=a||[])=="string"&&(a=[a]),C=0;C<a.length;C+=1)switch(a[C]){case"ASCII85Decode":case"/ASCII85Decode":F=u(F),O.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":F=o(F),O.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":F=v(F),O.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":F=m(F),O.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":F=x(F),O.push("/FlateDecode");break;default:throw new Error('The filter: "'+a[C]+'" is not implemented')}return{data:F,reverseChain:O.reverse().join(" ")}}}(qr.API),function(p){p.loadFile=function(o,u,m){return function(v,x,b){x=x!==!1,b=typeof b=="function"?b:function(){};var a=void 0;try{a=function(C,F,O){var Y=new XMLHttpRequest,ee=0,j=function(Pe){var ce=Pe.length,Q=[],ge=String.fromCharCode;for(ee=0;ee<ce;ee+=1)Q.push(ge(255&Pe.charCodeAt(ee)));return Q.join("")};if(Y.open("GET",C,!F),Y.overrideMimeType("text/plain; charset=x-user-defined"),F===!1&&(Y.onload=function(){Y.status===200?O(j(this.responseText)):O(void 0)}),Y.send(null),F&&Y.status===200)return j(Y.responseText)}(v,x,b)}catch{}return a}(o,u,m)},p.loadImageFile=p.loadFile}(qr.API),function(p){function o(){return(ti.html2canvas?Promise.resolve(ti.html2canvas):lp(()=>import("./html2canvas.esm-Dmi1NfiH-Bwg2zecY.js"),[])).catch(function(a){return Promise.reject(new Error("Could not load html2canvas: "+a))}).then(function(a){return a.default?a.default:a})}function u(){return(ti.DOMPurify?Promise.resolve(ti.DOMPurify):lp(()=>import("./purify.es-DHbHSKL1-BQ5ruev7.js"),[])).catch(function(a){return Promise.reject(new Error("Could not load dompurify: "+a))}).then(function(a){return a.default?a.default:a})}var m=function(a){var C=$i(a);return C==="undefined"?"undefined":C==="string"||a instanceof String?"string":C==="number"||a instanceof Number?"number":C==="function"||a instanceof Function?"function":a&&a.constructor===Array?"array":a&&a.nodeType===1?"element":C==="object"?"object":"unknown"},v=function(a,C){var F=document.createElement(a);for(var O in C.className&&(F.className=C.className),C.innerHTML&&C.dompurify&&(F.innerHTML=C.dompurify.sanitize(C.innerHTML)),C.style)F.style[O]=C.style[O];return F},x=function a(C,F){for(var O=C.nodeType===3?document.createTextNode(C.nodeValue):C.cloneNode(!1),Y=C.firstChild;Y;Y=Y.nextSibling)F!==!0&&Y.nodeType===1&&Y.nodeName==="SCRIPT"||O.appendChild(a(Y,F));return C.nodeType===1&&(C.nodeName==="CANVAS"?(O.width=C.width,O.height=C.height,O.getContext("2d").drawImage(C,0,0)):C.nodeName!=="TEXTAREA"&&C.nodeName!=="SELECT"||(O.value=C.value),O.addEventListener("load",function(){O.scrollTop=C.scrollTop,O.scrollLeft=C.scrollLeft},!0)),O},b=function a(C){var F=Object.assign(a.convert(Promise.resolve()),JSON.parse(JSON.stringify(a.template))),O=a.convert(Promise.resolve(),F);return(O=O.setProgress(1,a,1,[a])).set(C)};(b.prototype=Object.create(Promise.prototype)).constructor=b,b.convert=function(a,C){return a.__proto__=C||b.prototype,a},b.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},b.prototype.from=function(a,C){return this.then(function(){switch(C=C||function(F){switch(m(F)){case"string":return"string";case"element":return F.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(a),C){case"string":return this.then(u).then(function(F){return this.set({src:v("div",{innerHTML:a,dompurify:F})})});case"element":return this.set({src:a});case"canvas":return this.set({canvas:a});case"img":return this.set({img:a});default:return this.error("Unknown source type.")}})},b.prototype.to=function(a){switch(a){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},b.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var a={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},C=x(this.prop.src,this.opt.html2canvas.javascriptEnabled);C.tagName==="BODY"&&(a.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=v("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=v("div",{className:"html2pdf__container",style:a}),this.prop.container.appendChild(C),this.prop.container.firstChild.appendChild(v("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},b.prototype.toCanvas=function(){var a=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(a).then(o).then(function(C){var F=Object.assign({},this.opt.html2canvas);return delete F.onrendered,C(this.prop.container,F)}).then(function(C){(this.opt.html2canvas.onrendered||function(){})(C),this.prop.canvas=C,document.body.removeChild(this.prop.overlay)})},b.prototype.toContext2d=function(){var a=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(a).then(o).then(function(C){var F=this.opt.jsPDF,O=this.opt.fontFaces,Y=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,ee=Object.assign({async:!0,allowTaint:!0,scale:Y,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete ee.onrendered,F.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,F.context2d.posX=this.opt.x,F.context2d.posY=this.opt.y,F.context2d.margin=this.opt.margin,F.context2d.fontFaces=O,O)for(var j=0;j<O.length;++j){var Pe=O[j],ce=Pe.src.find(function(Q){return Q.format==="truetype"});ce&&F.addFont(ce.url,Pe.ref.name,Pe.ref.style)}return ee.windowHeight=ee.windowHeight||0,ee.windowHeight=ee.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):ee.windowHeight,F.context2d.save(!0),C(this.prop.container,ee)}).then(function(C){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(C),this.prop.canvas=C,document.body.removeChild(this.prop.overlay)})},b.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var a=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=a})},b.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},b.prototype.output=function(a,C,F){return(F=F||"pdf").toLowerCase()==="img"||F.toLowerCase()==="image"?this.outputImg(a,C):this.outputPdf(a,C)},b.prototype.outputPdf=function(a,C){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(a,C)})},b.prototype.outputImg=function(a){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(a){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+a+'" is not supported.'}})},b.prototype.save=function(a){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(a?{filename:a}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},b.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},b.prototype.set=function(a){if(m(a)!=="object")return this;var C=Object.keys(a||{}).map(function(F){if(F in b.template.prop)return function(){this.prop[F]=a[F]};switch(F){case"margin":return this.setMargin.bind(this,a.margin);case"jsPDF":return function(){return this.opt.jsPDF=a.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,a.pageSize);default:return function(){this.opt[F]=a[F]}}},this);return this.then(function(){return this.thenList(C)})},b.prototype.get=function(a,C){return this.then(function(){var F=a in b.template.prop?this.prop[a]:this.opt[a];return C?C(F):F})},b.prototype.setMargin=function(a){return this.then(function(){switch(m(a)){case"number":a=[a,a,a,a];case"array":if(a.length===2&&(a=[a[0],a[1],a[0],a[1]]),a.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=a}).then(this.setPageSize)},b.prototype.setPageSize=function(a){function C(F,O){return Math.floor(F*O/72*96)}return this.then(function(){(a=a||qr.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(a.inner={width:a.width-this.opt.margin[1]-this.opt.margin[3],height:a.height-this.opt.margin[0]-this.opt.margin[2]},a.inner.px={width:C(a.inner.width,a.k),height:C(a.inner.height,a.k)},a.inner.ratio=a.inner.height/a.inner.width),this.prop.pageSize=a})},b.prototype.setProgress=function(a,C,F,O){return a!=null&&(this.progress.val=a),C!=null&&(this.progress.state=C),F!=null&&(this.progress.n=F),O!=null&&(this.progress.stack=O),this.progress.ratio=this.progress.val/this.progress.state,this},b.prototype.updateProgress=function(a,C,F,O){return this.setProgress(a?this.progress.val+a:null,C||null,F?this.progress.n+F:null,O?this.progress.stack.concat(O):null)},b.prototype.then=function(a,C){var F=this;return this.thenCore(a,C,function(O,Y){return F.updateProgress(null,null,1,[O]),Promise.prototype.then.call(this,function(ee){return F.updateProgress(null,O),ee}).then(O,Y).then(function(ee){return F.updateProgress(1),ee})})},b.prototype.thenCore=function(a,C,F){F=F||Promise.prototype.then;var O=this;a&&(a=a.bind(O)),C&&(C=C.bind(O));var Y=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?O:b.convert(Object.assign({},O),Promise.prototype),ee=F.call(Y,a,C);return b.convert(ee,O.__proto__)},b.prototype.thenExternal=function(a,C){return Promise.prototype.then.call(this,a,C)},b.prototype.thenList=function(a){var C=this;return a.forEach(function(F){C=C.thenCore(F)}),C},b.prototype.catch=function(a){a&&(a=a.bind(this));var C=Promise.prototype.catch.call(this,a);return b.convert(C,this)},b.prototype.catchExternal=function(a){return Promise.prototype.catch.call(this,a)},b.prototype.error=function(a){return this.then(function(){throw new Error(a)})},b.prototype.using=b.prototype.set,b.prototype.saveAs=b.prototype.save,b.prototype.export=b.prototype.output,b.prototype.run=b.prototype.then,qr.getPageSize=function(a,C,F){if($i(a)==="object"){var O=a;a=O.orientation,C=O.unit||C,F=O.format||F}C=C||"mm",F=F||"a4",a=(""+(a||"P")).toLowerCase();var Y,ee=(""+F).toLowerCase(),j={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(C){case"pt":Y=1;break;case"mm":Y=72/25.4;break;case"cm":Y=72/2.54;break;case"in":Y=72;break;case"px":Y=.75;break;case"pc":case"em":Y=12;break;case"ex":Y=6;break;default:throw"Invalid unit: "+C}var Pe,ce=0,Q=0;if(j.hasOwnProperty(ee))ce=j[ee][1]/Y,Q=j[ee][0]/Y;else try{ce=F[1],Q=F[0]}catch{throw new Error("Invalid format: "+F)}if(a==="p"||a==="portrait")a="p",Q>ce&&(Pe=Q,Q=ce,ce=Pe);else{if(a!=="l"&&a!=="landscape")throw"Invalid orientation: "+a;a="l",ce>Q&&(Pe=Q,Q=ce,ce=Pe)}return{width:Q,height:ce,unit:C,k:Y,orientation:a}},p.html=function(a,C){(C=C||{}).callback=C.callback||function(){},C.html2canvas=C.html2canvas||{},C.html2canvas.canvas=C.html2canvas.canvas||this.canvas,C.jsPDF=C.jsPDF||this,C.fontFaces=C.fontFaces?C.fontFaces.map(Ap):null;var F=new b(C);return C.worker?F:F.from(a).doCallback()}}(qr.API),qr.API.addJS=function(p){return Ay=p,this.internal.events.subscribe("postPutResources",function(){zd=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(zd+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),Py=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+Ay+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){zd!==void 0&&Py!==void 0&&this.internal.out("/Names <</JavaScript "+zd+" 0 R>>")}),this},function(p){var o;p.events.push(["postPutResources",function(){var u=this,m=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var v=u.outline.render().split(/\r\n/),x=0;x<v.length;x++){var b=v[x],a=m.exec(b);if(a!=null){var C=a[1];u.internal.newObjectDeferredBegin(C,!1)}u.internal.write(b)}if(this.outline.createNamedDestinations){var F=this.internal.pages.length,O=[];for(x=0;x<F;x++){var Y=u.internal.newObject();O.push(Y);var ee=u.internal.getPageInfo(x+1);u.internal.write("<< /D["+ee.objId+" 0 R /XYZ null null null]>> endobj")}var j=u.internal.newObject();for(u.internal.write("<< /Names [ "),x=0;x<O.length;x++)u.internal.write("(page_"+(x+1)+")"+O[x]+" 0 R");u.internal.write(" ] >>","endobj"),o=u.internal.newObject(),u.internal.write("<< /Dests "+j+" 0 R"),u.internal.write(">>","endobj")}}]),p.events.push(["putCatalog",function(){var u=this;u.outline.root.children.length>0&&(u.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&u.internal.write("/Names "+o+" 0 R"))}]),p.events.push(["initialized",function(){var u=this;u.outline={createNamedDestinations:!1,root:{children:[]}},u.outline.add=function(m,v,x){var b={title:v,options:x,children:[]};return m==null&&(m=this.root),m.children.push(b),b},u.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=u,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},u.outline.genIds_r=function(m){m.id=u.internal.newObjectDeferred();for(var v=0;v<m.children.length;v++)this.genIds_r(m.children[v])},u.outline.renderRoot=function(m){this.objStart(m),this.line("/Type /Outlines"),m.children.length>0&&(this.line("/First "+this.makeRef(m.children[0])),this.line("/Last "+this.makeRef(m.children[m.children.length-1]))),this.line("/Count "+this.count_r({count:0},m)),this.objEnd()},u.outline.renderItems=function(m){for(var v=this.ctx.pdf.internal.getVerticalCoordinateString,x=0;x<m.children.length;x++){var b=m.children[x];this.objStart(b),this.line("/Title "+this.makeString(b.title)),this.line("/Parent "+this.makeRef(m)),x>0&&this.line("/Prev "+this.makeRef(m.children[x-1])),x<m.children.length-1&&this.line("/Next "+this.makeRef(m.children[x+1])),b.children.length>0&&(this.line("/First "+this.makeRef(b.children[0])),this.line("/Last "+this.makeRef(b.children[b.children.length-1])));var a=this.count=this.count_r({count:0},b);if(a>0&&this.line("/Count "+a),b.options&&b.options.pageNumber){var C=u.internal.getPageInfo(b.options.pageNumber);this.line("/Dest ["+C.objId+" 0 R /XYZ 0 "+v(0)+" 0]")}this.objEnd()}for(var F=0;F<m.children.length;F++)this.renderItems(m.children[F])},u.outline.line=function(m){this.ctx.val+=m+`\r
`},u.outline.makeRef=function(m){return m.id+" 0 R"},u.outline.makeString=function(m){return"("+u.internal.pdfEscape(m)+")"},u.outline.objStart=function(m){this.ctx.val+=`\r
`+m.id+` 0 obj\r
<<\r
`},u.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},u.outline.count_r=function(m,v){for(var x=0;x<v.children.length;x++)m.count++,this.count_r(m,v.children[x]);return m.count}}])}(qr.API),function(p){var o=[192,193,194,195,196,197,198,199];p.processJPEG=function(u,m,v,x,b,a){var C,F=this.decode.DCT_DECODE,O=null;if(typeof u=="string"||this.__addimage__.isArrayBuffer(u)||this.__addimage__.isArrayBufferView(u)){switch(u=b||u,u=this.__addimage__.isArrayBuffer(u)?new Uint8Array(u):u,C=function(Y){for(var ee,j=256*Y.charCodeAt(4)+Y.charCodeAt(5),Pe=Y.length,ce={width:0,height:0,numcomponents:1},Q=4;Q<Pe;Q+=2){if(Q+=j,o.indexOf(Y.charCodeAt(Q+1))!==-1){ee=256*Y.charCodeAt(Q+5)+Y.charCodeAt(Q+6),ce={width:256*Y.charCodeAt(Q+7)+Y.charCodeAt(Q+8),height:ee,numcomponents:Y.charCodeAt(Q+9)};break}j=256*Y.charCodeAt(Q+2)+Y.charCodeAt(Q+3)}return ce}(u=this.__addimage__.isArrayBufferView(u)?this.__addimage__.arrayBufferToBinaryString(u):u),C.numcomponents){case 1:a=this.color_spaces.DEVICE_GRAY;break;case 4:a=this.color_spaces.DEVICE_CMYK;break;case 3:a=this.color_spaces.DEVICE_RGB}O={data:u,width:C.width,height:C.height,colorSpace:a,bitsPerComponent:8,filter:F,index:m,alias:v}}return O}}(qr.API),qr.API.processPNG=function(p,o,u,m){if(this.__addimage__.isArrayBuffer(p)&&(p=new Uint8Array(p)),this.__addimage__.isArrayBufferView(p)){var v,x=Sw(p,{checkCrc:!0}),b=x.width,a=x.height,C=x.channels,F=x.palette,O=x.depth;v=F&&C===1?function(it){for(var He=it.width,Te=it.height,st=it.data,me=it.palette,xe=it.depth,Xe=!1,Ye=[],At=[],Dt=void 0,kt=!1,yt=0,vt=0;vt<me.length;vt++){var sr=M_(me[vt],4),Zt=sr[0],he=sr[1],Fe=sr[2],$e=sr[3];Ye.push(Zt,he,Fe),$e!=null&&($e===0?(yt++,At.length<1&&At.push(vt)):$e<255&&(kt=!0))}if(kt||yt>1){Xe=!0,At=void 0;var tt=He*Te;Dt=new Uint8Array(tt);for(var ct=new DataView(st.buffer),ut=0;ut<tt;ut++){var pt=Ip(ct,ut,xe),wt=M_(me[pt],4)[3];Dt[ut]=wt}}return{colorSpace:"Indexed",colorsPerPixel:1,colorBytes:st,alphaBytes:Dt,needSMask:Xe,palette:Ye,mask:At}}(x):C===2||C===4?function(it){for(var He=it.data,Te=it.width,st=it.height,me=it.channels,xe=it.depth,Xe=me===2?"DeviceGray":"DeviceRGB",Ye=me-1,At=Te*st,Dt=Ye,kt=At*Dt,yt=1*At,vt=Math.ceil(kt*xe/8),sr=Math.ceil(yt*xe/8),Zt=new Uint8Array(vt),he=new Uint8Array(sr),Fe=new DataView(He.buffer),$e=new DataView(Zt.buffer),tt=new DataView(he.buffer),ct=!1,ut=0;ut<At;ut++){for(var pt=ut*me,wt=0;wt<Dt;wt++)zy($e,Ip(Fe,pt+wt,xe),ut*Dt+wt,xe);var Bt=Ip(Fe,pt+Dt,xe);Bt<(1<<xe)-1&&(ct=!0),zy(tt,Bt,1*ut,xe)}return{colorSpace:Xe,colorsPerPixel:Ye,colorBytes:Zt,alphaBytes:he,needSMask:ct}}(x):function(it){var He=it.data,Te=it.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:Te,colorsPerPixel:Te==="DeviceGray"?1:3,colorBytes:He instanceof Uint8Array?He:new Uint8Array(He.buffer),needSMask:!1}}(x);var Y,ee,j,Pe=v,ce=Pe.colorSpace,Q=Pe.colorsPerPixel,ge=Pe.colorBytes,Qe=Pe.alphaBytes,Oe=Pe.needSMask,Me=Pe.palette,Ge=Pe.mask,Ze=null;return m!==qr.API.image_compression.NONE&&typeof Rp=="function"?(Ze=function(it){var He;switch(it){case qr.API.image_compression.FAST:He=11;break;case qr.API.image_compression.MEDIUM:He=13;break;case qr.API.image_compression.SLOW:He=14;break;default:He=12}return He}(m),Y=this.decode.FLATE_DECODE,ee="/Predictor ".concat(Ze," "),p=Cy(ge,b*Q,Q,m),Oe&&(j=Cy(Qe,b,1,m))):(Y=void 0,ee="",p=ge,Oe&&(j=Qe)),ee+="/Colors ".concat(Q," /BitsPerComponent ").concat(O," /Columns ").concat(b),(this.__addimage__.isArrayBuffer(p)||this.__addimage__.isArrayBufferView(p))&&(p=this.__addimage__.arrayBufferToBinaryString(p)),(j&&this.__addimage__.isArrayBuffer(j)||this.__addimage__.isArrayBufferView(j))&&(j=this.__addimage__.arrayBufferToBinaryString(j)),{alias:u,data:p,index:o,filter:Y,decodeParameters:ee,transparency:Ge,palette:Me,sMask:j,predictor:Ze,width:b,height:a,bitsPerComponent:O,colorSpace:ce}}},function(p){p.processGIF89A=function(o,u,m,v){var x=new Gw(o),b=x.width,a=x.height,C=[];x.decodeAndBlitFrameRGBA(0,C);var F={data:C,width:b,height:a},O=new Ep(100).encode(F,100);return p.processJPEG.call(this,O,u,m,v)},p.processGIF87A=p.processGIF89A}(qr.API),ll.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var p=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(p);for(var o=0;o<p;o++){var u=this.datav.getUint8(this.pos++,!0),m=this.datav.getUint8(this.pos++,!0),v=this.datav.getUint8(this.pos++,!0),x=this.datav.getUint8(this.pos++,!0);this.palette[o]={red:v,green:m,blue:u,quad:x}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},ll.prototype.parseBGR=function(){this.pos=this.offset;try{var p="bit"+this.bitPP,o=this.width*this.height*4;this.data=new Uint8Array(o),this[p]()}catch(u){nn.log("bit decode error:"+u)}},ll.prototype.bit1=function(){var p,o=Math.ceil(this.width/8),u=o%4;for(p=this.height-1;p>=0;p--){for(var m=this.bottom_up?p:this.height-1-p,v=0;v<o;v++)for(var x=this.datav.getUint8(this.pos++,!0),b=m*this.width*4+8*v*4,a=0;a<8&&8*v+a<this.width;a++){var C=this.palette[x>>7-a&1];this.data[b+4*a]=C.blue,this.data[b+4*a+1]=C.green,this.data[b+4*a+2]=C.red,this.data[b+4*a+3]=255}u!==0&&(this.pos+=4-u)}},ll.prototype.bit4=function(){for(var p=Math.ceil(this.width/2),o=p%4,u=this.height-1;u>=0;u--){for(var m=this.bottom_up?u:this.height-1-u,v=0;v<p;v++){var x=this.datav.getUint8(this.pos++,!0),b=m*this.width*4+2*v*4,a=x>>4,C=15&x,F=this.palette[a];if(this.data[b]=F.blue,this.data[b+1]=F.green,this.data[b+2]=F.red,this.data[b+3]=255,2*v+1>=this.width)break;F=this.palette[C],this.data[b+4]=F.blue,this.data[b+4+1]=F.green,this.data[b+4+2]=F.red,this.data[b+4+3]=255}o!==0&&(this.pos+=4-o)}},ll.prototype.bit8=function(){for(var p=this.width%4,o=this.height-1;o>=0;o--){for(var u=this.bottom_up?o:this.height-1-o,m=0;m<this.width;m++){var v=this.datav.getUint8(this.pos++,!0),x=u*this.width*4+4*m;if(v<this.palette.length){var b=this.palette[v];this.data[x]=b.red,this.data[x+1]=b.green,this.data[x+2]=b.blue,this.data[x+3]=255}else this.data[x]=255,this.data[x+1]=255,this.data[x+2]=255,this.data[x+3]=255}p!==0&&(this.pos+=4-p)}},ll.prototype.bit15=function(){for(var p=this.width%3,o=parseInt("11111",2),u=this.height-1;u>=0;u--){for(var m=this.bottom_up?u:this.height-1-u,v=0;v<this.width;v++){var x=this.datav.getUint16(this.pos,!0);this.pos+=2;var b=(x&o)/o*255|0,a=(x>>5&o)/o*255|0,C=(x>>10&o)/o*255|0,F=x>>15?255:0,O=m*this.width*4+4*v;this.data[O]=C,this.data[O+1]=a,this.data[O+2]=b,this.data[O+3]=F}this.pos+=p}},ll.prototype.bit16=function(){for(var p=this.width%3,o=parseInt("11111",2),u=parseInt("111111",2),m=this.height-1;m>=0;m--){for(var v=this.bottom_up?m:this.height-1-m,x=0;x<this.width;x++){var b=this.datav.getUint16(this.pos,!0);this.pos+=2;var a=(b&o)/o*255|0,C=(b>>5&u)/u*255|0,F=(b>>11)/o*255|0,O=v*this.width*4+4*x;this.data[O]=F,this.data[O+1]=C,this.data[O+2]=a,this.data[O+3]=255}this.pos+=p}},ll.prototype.bit24=function(){for(var p=this.height-1;p>=0;p--){for(var o=this.bottom_up?p:this.height-1-p,u=0;u<this.width;u++){var m=this.datav.getUint8(this.pos++,!0),v=this.datav.getUint8(this.pos++,!0),x=this.datav.getUint8(this.pos++,!0),b=o*this.width*4+4*u;this.data[b]=x,this.data[b+1]=v,this.data[b+2]=m,this.data[b+3]=255}this.pos+=this.width%4}},ll.prototype.bit32=function(){for(var p=this.height-1;p>=0;p--)for(var o=this.bottom_up?p:this.height-1-p,u=0;u<this.width;u++){var m=this.datav.getUint8(this.pos++,!0),v=this.datav.getUint8(this.pos++,!0),x=this.datav.getUint8(this.pos++,!0),b=this.datav.getUint8(this.pos++,!0),a=o*this.width*4+4*u;this.data[a]=x,this.data[a+1]=v,this.data[a+2]=m,this.data[a+3]=b}},ll.prototype.getData=function(){return this.data},function(p){p.processBMP=function(o,u,m,v){var x=new ll(o,!1),b=x.width,a=x.height,C={data:x.getData(),width:b,height:a},F=new Ep(100).encode(C,100);return p.processJPEG.call(this,F,u,m,v)}}(qr.API),Oy.prototype.getData=function(){return this.data},function(p){p.processWEBP=function(o,u,m,v){var x=new Oy(o),b=x.width,a=x.height,C={data:x.getData(),width:b,height:a},F=new Ep(100).encode(C,100);return p.processJPEG.call(this,F,u,m,v)}}(qr.API),qr.API.processRGBA=function(p,o,u){for(var m=p.data,v=m.length,x=new Uint8Array(v/4*3),b=new Uint8Array(v/4),a=0,C=0,F=0;F<v;F+=4){var O=m[F],Y=m[F+1],ee=m[F+2],j=m[F+3];x[a++]=O,x[a++]=Y,x[a++]=ee,b[C++]=j}var Pe=this.__addimage__.arrayBufferToBinaryString(x);return{alpha:this.__addimage__.arrayBufferToBinaryString(b),data:Pe,index:o,alias:u,colorSpace:"DeviceRGB",bitsPerComponent:8,width:p.width,height:p.height}},qr.API.setLanguage=function(p){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[p]!==void 0&&(this.internal.languageSettings.languageCode=p,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},eh=qr.API,Nd=eh.getCharWidthsArray=function(p,o){var u,m,v=(o=o||{}).font||this.internal.getFont(),x=o.fontSize||this.internal.getFontSize(),b=o.charSpace||this.internal.getCharSpace(),a=o.widths?o.widths:v.metadata.Unicode.widths,C=a.fof?a.fof:1,F=o.kerning?o.kerning:v.metadata.Unicode.kerning,O=F.fof?F.fof:1,Y=o.doKerning!==!1,ee=0,j=p.length,Pe=0,ce=a[0]||C,Q=[];for(u=0;u<j;u++)m=p.charCodeAt(u),typeof v.metadata.widthOfString=="function"?Q.push((v.metadata.widthOfGlyph(v.metadata.characterToGlyph(m))+b*(1e3/x)||0)/1e3):(ee=Y&&$i(F[m])==="object"&&!isNaN(parseInt(F[m][Pe],10))?F[m][Pe]/O:0,Q.push((a[m]||ce)/C+ee)),Pe=m;return Q},Iy=eh.getStringUnitWidth=function(p,o){var u=(o=o||{}).fontSize||this.internal.getFontSize(),m=o.font||this.internal.getFont(),v=o.charSpace||this.internal.getCharSpace();return eh.processArabic&&(p=eh.processArabic(p)),typeof m.metadata.widthOfString=="function"?m.metadata.widthOfString(p,u,v)/u:Nd.apply(this,arguments).reduce(function(x,b){return x+b},0)},Ey=function(p,o,u,m){for(var v=[],x=0,b=p.length,a=0;x!==b&&a+o[x]<u;)a+=o[x],x++;v.push(p.slice(0,x));var C=x;for(a=0;x!==b;)a+o[x]>m&&(v.push(p.slice(C,x)),a=0,C=x),a+=o[x],x++;return C!==x&&v.push(p.slice(C,x)),v},Ly=function(p,o,u){u||(u={});var m,v,x,b,a,C,F,O=[],Y=[O],ee=u.textIndent||0,j=0,Pe=0,ce=p.split(" "),Q=Nd.apply(this,[" ",u])[0];if(C=u.lineIndent===-1?ce[0].length+2:u.lineIndent||0){var ge=Array(C).join(" "),Qe=[];ce.map(function(Me){(Me=Me.split(/\s*\n/)).length>1?Qe=Qe.concat(Me.map(function(Ge,Ze){return(Ze&&Ge.length?`
`:"")+Ge})):Qe.push(Me[0])}),ce=Qe,C=Iy.apply(this,[ge,u])}for(x=0,b=ce.length;x<b;x++){var Oe=0;if(m=ce[x],C&&m[0]==`
`&&(m=m.substr(1),Oe=1),ee+j+(Pe=(v=Nd.apply(this,[m,u])).reduce(function(Me,Ge){return Me+Ge},0))>o||Oe){if(Pe>o){for(a=Ey.apply(this,[m,v,o-(ee+j),o]),O.push(a.shift()),O=[a.pop()];a.length;)Y.push([a.shift()]);Pe=v.slice(m.length-(O[0]?O[0].length:0)).reduce(function(Me,Ge){return Me+Ge},0)}else O=[m];Y.push(O),ee=Pe+C,j=Q}else O.push(m),ee+=j+Pe,j=Q}return F=C?function(Me,Ge){return(Ge?ge:"")+Me.join(" ")}:function(Me){return Me.join(" ")},Y.map(F)},eh.splitTextToSize=function(p,o,u){var m,v=(u=u||{}).fontSize||this.internal.getFontSize(),x=(function(O){if(O.widths&&O.kerning)return{widths:O.widths,kerning:O.kerning};var Y=this.internal.getFont(O.fontName,O.fontStyle),ee="Unicode";return Y.metadata[ee]?{widths:Y.metadata[ee].widths||{0:1},kerning:Y.metadata[ee].kerning||{}}:{font:Y.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,u);m=Array.isArray(p)?p:String(p).split(/\r?\n/);var b=1*this.internal.scaleFactor*o/v;x.textIndent=u.textIndent?1*u.textIndent*this.internal.scaleFactor/v:0,x.lineIndent=u.lineIndent;var a,C,F=[];for(a=0,C=m.length;a<C;a++)F=F.concat(Ly.apply(this,[m[a],b,x]));return F},function(p){p.__fontmetrics__=p.__fontmetrics__||{};for(var o="0123456789abcdef",u="klmnopqrstuvwxyz",m={},v={},x=0;x<16;x++)m[u[x]]=o[x],v[o[x]]=u[x];var b=function(ee){return"0x"+parseInt(ee,10).toString(16)},a=p.__fontmetrics__.compress=function(ee){var j,Pe,ce,Q,ge=["{"];for(var Qe in ee){if(j=ee[Qe],isNaN(parseInt(Qe,10))?Pe="'"+Qe+"'":(Qe=parseInt(Qe,10),Pe=(Pe=b(Qe).slice(2)).slice(0,-1)+v[Pe.slice(-1)]),typeof j=="number")j<0?(ce=b(j).slice(3),Q="-"):(ce=b(j).slice(2),Q=""),ce=Q+ce.slice(0,-1)+v[ce.slice(-1)];else{if($i(j)!=="object")throw new Error("Don't know what to do with value type "+$i(j)+".");ce=a(j)}ge.push(Pe+ce)}return ge.push("}"),ge.join("")},C=p.__fontmetrics__.uncompress=function(ee){if(typeof ee!="string")throw new Error("Invalid argument passed to uncompress.");for(var j,Pe,ce,Q,ge={},Qe=1,Oe=ge,Me=[],Ge="",Ze="",it=ee.length-1,He=1;He<it;He+=1)(Q=ee[He])=="'"?j?(ce=j.join(""),j=void 0):j=[]:j?j.push(Q):Q=="{"?(Me.push([Oe,ce]),Oe={},ce=void 0):Q=="}"?((Pe=Me.pop())[0][Pe[1]]=Oe,ce=void 0,Oe=Pe[0]):Q=="-"?Qe=-1:ce===void 0?m.hasOwnProperty(Q)?(Ge+=m[Q],ce=parseInt(Ge,16)*Qe,Qe=1,Ge=""):Ge+=Q:m.hasOwnProperty(Q)?(Ze+=m[Q],Oe[ce]=parseInt(Ze,16)*Qe,Qe=1,ce=void 0,Ze=""):Ze+=Q;return ge},F={codePages:["WinAnsiEncoding"],WinAnsiEncoding:C("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},O={Unicode:{Courier:F,"Courier-Bold":F,"Courier-BoldOblique":F,"Courier-Oblique":F,Helvetica:F,"Helvetica-Bold":F,"Helvetica-BoldOblique":F,"Helvetica-Oblique":F,"Times-Roman":F,"Times-Bold":F,"Times-BoldItalic":F,"Times-Italic":F}},Y={Unicode:{"Courier-Oblique":C("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":C("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":C("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:C("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":C("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":C("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:C("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:C("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":C("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:C("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":C("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":C("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":C("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":C("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};p.events.push(["addFont",function(ee){var j=ee.font,Pe=Y.Unicode[j.postScriptName];Pe&&(j.metadata.Unicode={},j.metadata.Unicode.widths=Pe.widths,j.metadata.Unicode.kerning=Pe.kerning);var ce=O.Unicode[j.postScriptName];ce&&(j.metadata.Unicode.encoding=ce,j.encoding=ce.codePages[0])}])}(qr.API),function(p){var o=function(u){for(var m=u.length,v=new Uint8Array(m),x=0;x<m;x++)v[x]=u.charCodeAt(x);return v};p.API.events.push(["addFont",function(u){var m=void 0,v=u.font,x=u.instance;if(!v.isStandardFont){if(x===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+v.postScriptName+"').");if(typeof(m=x.existsFileInVFS(v.postScriptName)===!1?x.loadFile(v.postScriptName):x.getFileFromVFS(v.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+v.postScriptName+"').");(function(b,a){a=/^\x00\x01\x00\x00/.test(a)?o(a):o(Ud(a)),b.metadata=p.API.TTFFont.open(a),b.metadata.Unicode=b.metadata.Unicode||{encoding:{},kerning:{},widths:[]},b.metadata.glyIdsUsed=[0]})(v,m)}}])}(qr),qr.API.addSvgAsImage=function(p,o,u,m,v,x,b,a){if(isNaN(o)||isNaN(u))throw nn.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(m)||isNaN(v))throw nn.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var C=document.createElement("canvas");C.width=m,C.height=v;var F=C.getContext("2d");F.fillStyle="#fff",F.fillRect(0,0,C.width,C.height);var O={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},Y=this;return(ti.canvg?Promise.resolve(ti.canvg):lp(()=>import("./index.es-CDV9zB2B-D_aLO0Vn.js"),[])).catch(function(ee){return Promise.reject(new Error("Could not load canvg: "+ee))}).then(function(ee){return ee.default?ee.default:ee}).then(function(ee){return ee.fromString(F,p,O)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(ee){return ee.render(O)}).then(function(){Y.addImage(C.toDataURL("image/jpeg",1),o,u,m,v,b,a)})},qr.API.putTotalPages=function(p){var o,u=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(o=new RegExp(p,"g"),u=this.internal.getNumberOfPages()):(o=new RegExp(this.pdfEscape16(p,this.internal.getFont()),"g"),u=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var m=1;m<=this.internal.getNumberOfPages();m++)for(var v=0;v<this.internal.pages[m].length;v++)this.internal.pages[m][v]=this.internal.pages[m][v].replace(o,u);return this},qr.API.viewerPreferences=function(p,o){var u;p=p||{},o=o||!1;var m,v,x,b={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},a=Object.keys(b),C=[],F=0,O=0,Y=0;function ee(Pe,ce){var Q,ge=!1;for(Q=0;Q<Pe.length;Q+=1)Pe[Q]===ce&&(ge=!0);return ge}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(b)),this.internal.viewerpreferences.isSubscribed=!1),u=this.internal.viewerpreferences.configuration,p==="reset"||o===!0){var j=a.length;for(Y=0;Y<j;Y+=1)u[a[Y]].value=u[a[Y]].defaultValue,u[a[Y]].explicitSet=!1}if($i(p)==="object"){for(v in p)if(x=p[v],ee(a,v)&&x!==void 0){if(u[v].type==="boolean"&&typeof x=="boolean")u[v].value=x;else if(u[v].type==="name"&&ee(u[v].valueSet,x))u[v].value=x;else if(u[v].type==="integer"&&Number.isInteger(x))u[v].value=x;else if(u[v].type==="array"){for(F=0;F<x.length;F+=1)if(m=!0,x[F].length===1&&typeof x[F][0]=="number")C.push(String(x[F]-1));else if(x[F].length>1){for(O=0;O<x[F].length;O+=1)typeof x[F][O]!="number"&&(m=!1);m===!0&&C.push([x[F][0]-1,x[F][1]-1].join(" "))}u[v].value="["+C.join(" ")+"]"}else u[v].value=u[v].defaultValue;u[v].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var Pe,ce=[];for(Pe in u)u[Pe].explicitSet===!0&&(u[Pe].type==="name"?ce.push("/"+Pe+" /"+u[Pe].value):ce.push("/"+Pe+" "+u[Pe].value));ce.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+ce.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=u,this},function(p){var o=function(){var m='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',v=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),x=unescape(encodeURIComponent(m)),b=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),a=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),C=unescape(encodeURIComponent("</x:xmpmeta>")),F=x.length+b.length+a.length+v.length+C.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+F+" >>"),this.internal.write("stream"),this.internal.write(v+x+b+a+C),this.internal.write("endstream"),this.internal.write("endobj")},u=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};p.addMetadata=function(m,v){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:m,namespaceuri:v||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",u),this.internal.events.subscribe("postPutResources",o)),this}}(qr.API),function(p){var o=p.API,u=o.pdfEscape16=function(x,b){for(var a,C=b.metadata.Unicode.widths,F=["","0","00","000","0000"],O=[""],Y=0,ee=x.length;Y<ee;++Y){if(a=b.metadata.characterToGlyph(x.charCodeAt(Y)),b.metadata.glyIdsUsed.push(a),b.metadata.toUnicode[a]=x.charCodeAt(Y),C.indexOf(a)==-1&&(C.push(a),C.push([parseInt(b.metadata.widthOfGlyph(a),10)])),a=="0")return O.join("");a=a.toString(16),O.push(F[4-a.length],a)}return O.join("")},m=function(x){var b,a,C,F,O,Y,ee;for(O=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,C=[],Y=0,ee=(a=Object.keys(x).sort(function(j,Pe){return j-Pe})).length;Y<ee;Y++)b=a[Y],C.length>=100&&(O+=`
`+C.length+` beginbfchar
`+C.join(`
`)+`
endbfchar`,C=[]),x[b]!==void 0&&x[b]!==null&&typeof x[b].toString=="function"&&(F=("0000"+x[b].toString(16)).slice(-4),b=("0000"+(+b).toString(16)).slice(-4),C.push("<"+b+"><"+F+">"));return C.length&&(O+=`
`+C.length+` beginbfchar
`+C.join(`
`)+`
endbfchar
`),O+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};o.events.push(["putFont",function(x){(function(b){var a=b.font,C=b.out,F=b.newObject,O=b.putStream;if(a.metadata instanceof p.API.TTFFont&&a.encoding==="Identity-H"){for(var Y=a.metadata.Unicode.widths,ee=a.metadata.subset.encode(a.metadata.glyIdsUsed,1),j="",Pe=0;Pe<ee.length;Pe++)j+=String.fromCharCode(ee[Pe]);var ce=F();O({data:j,addLength1:!0,objectId:ce}),C("endobj");var Q=F();O({data:m(a.metadata.toUnicode),addLength1:!0,objectId:Q}),C("endobj");var ge=F();C("<<"),C("/Type /FontDescriptor"),C("/FontName /"+ih(a.fontName)),C("/FontFile2 "+ce+" 0 R"),C("/FontBBox "+p.API.PDFObject.convert(a.metadata.bbox)),C("/Flags "+a.metadata.flags),C("/StemV "+a.metadata.stemV),C("/ItalicAngle "+a.metadata.italicAngle),C("/Ascent "+a.metadata.ascender),C("/Descent "+a.metadata.decender),C("/CapHeight "+a.metadata.capHeight),C(">>"),C("endobj");var Qe=F();C("<<"),C("/Type /Font"),C("/BaseFont /"+ih(a.fontName)),C("/FontDescriptor "+ge+" 0 R"),C("/W "+p.API.PDFObject.convert(Y)),C("/CIDToGIDMap /Identity"),C("/DW 1000"),C("/Subtype /CIDFontType2"),C("/CIDSystemInfo"),C("<<"),C("/Supplement 0"),C("/Registry (Adobe)"),C("/Ordering ("+a.encoding+")"),C(">>"),C(">>"),C("endobj"),a.objectNumber=F(),C("<<"),C("/Type /Font"),C("/Subtype /Type0"),C("/ToUnicode "+Q+" 0 R"),C("/BaseFont /"+ih(a.fontName)),C("/Encoding /"+a.encoding),C("/DescendantFonts ["+Qe+" 0 R]"),C(">>"),C("endobj"),a.isAlreadyPutted=!0}})(x)}]),o.events.push(["putFont",function(x){(function(b){var a=b.font,C=b.out,F=b.newObject,O=b.putStream;if(a.metadata instanceof p.API.TTFFont&&a.encoding==="WinAnsiEncoding"){for(var Y=a.metadata.rawData,ee="",j=0;j<Y.length;j++)ee+=String.fromCharCode(Y[j]);var Pe=F();O({data:ee,addLength1:!0,objectId:Pe}),C("endobj");var ce=F();O({data:m(a.metadata.toUnicode),addLength1:!0,objectId:ce}),C("endobj");var Q=F();C("<<"),C("/Descent "+a.metadata.decender),C("/CapHeight "+a.metadata.capHeight),C("/StemV "+a.metadata.stemV),C("/Type /FontDescriptor"),C("/FontFile2 "+Pe+" 0 R"),C("/Flags 96"),C("/FontBBox "+p.API.PDFObject.convert(a.metadata.bbox)),C("/FontName /"+ih(a.fontName)),C("/ItalicAngle "+a.metadata.italicAngle),C("/Ascent "+a.metadata.ascender),C(">>"),C("endobj"),a.objectNumber=F();for(var ge=0;ge<a.metadata.hmtx.widths.length;ge++)a.metadata.hmtx.widths[ge]=parseInt(a.metadata.hmtx.widths[ge]*(1e3/a.metadata.head.unitsPerEm));C("<</Subtype/TrueType/Type/Font/ToUnicode "+ce+" 0 R/BaseFont/"+ih(a.fontName)+"/FontDescriptor "+Q+" 0 R/Encoding/"+a.encoding+" /FirstChar 29 /LastChar 255 /Widths "+p.API.PDFObject.convert(a.metadata.hmtx.widths)+">>"),C("endobj"),a.isAlreadyPutted=!0}})(x)}]);var v=function(x){var b,a=x.text||"",C=x.x,F=x.y,O=x.options||{},Y=x.mutex||{},ee=Y.pdfEscape,j=Y.activeFontKey,Pe=Y.fonts,ce=j,Q="",ge=0,Qe="",Oe=Pe[ce].encoding;if(Pe[ce].encoding!=="Identity-H")return{text:a,x:C,y:F,options:O,mutex:Y};for(Qe=a,ce=j,Array.isArray(a)&&(Qe=a[0]),ge=0;ge<Qe.length;ge+=1)Pe[ce].metadata.hasOwnProperty("cmap")&&(b=Pe[ce].metadata.cmap.unicode.codeMap[Qe[ge].charCodeAt(0)]),b||Qe[ge].charCodeAt(0)<256&&Pe[ce].metadata.hasOwnProperty("Unicode")?Q+=Qe[ge]:Q+="";var Me="";return parseInt(ce.slice(1))<14||Oe==="WinAnsiEncoding"?Me=ee(Q,ce).split("").map(function(Ge){return Ge.charCodeAt(0).toString(16)}).join(""):Oe==="Identity-H"&&(Me=u(Q,Pe[ce])),Y.isHex=!0,{text:Me,x:C,y:F,options:O,mutex:Y}};o.events.push(["postProcessText",function(x){var b=x.text||"",a=[],C={text:b,x:x.x,y:x.y,options:x.options,mutex:x.mutex};if(Array.isArray(b)){var F=0;for(F=0;F<b.length;F+=1)Array.isArray(b[F])&&b[F].length===3?a.push([v(Object.assign({},C,{text:b[F][0]})).text,b[F][1],b[F][2]]):a.push(v(Object.assign({},C,{text:b[F]})).text);x.text=a}else x.text=v(Object.assign({},C,{text:b})).text}])}(qr),function(p){var o=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};p.existsFileInVFS=function(u){return o.call(this),this.internal.vFS[u]!==void 0},p.addFileToVFS=function(u,m){return o.call(this),this.internal.vFS[u]=m,this},p.getFileFromVFS=function(u){return o.call(this),this.internal.vFS[u]!==void 0?this.internal.vFS[u]:null}}(qr.API),function(p){p.__bidiEngine__=p.prototype.__bidiEngine__=function(m){var v,x,b,a,C,F,O,Y=o,ee=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],j=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],Pe={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},ce={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},Q=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],ge=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),Qe=!1,Oe=0;this.__bidiEngine__={};var Me=function(me){var xe=me.charCodeAt(),Xe=xe>>8,Ye=ce[Xe];return Ye!==void 0?Y[256*Ye+(255&xe)]:Xe===252||Xe===253?"AL":ge.test(Xe)?"L":Xe===8?"R":"N"},Ge=function(me){for(var xe,Xe=0;Xe<me.length;Xe++){if((xe=Me(me.charAt(Xe)))==="L")return!1;if(xe==="R")return!0}return!1},Ze=function(me,xe,Xe,Ye){var At,Dt,kt,yt,vt=xe[Ye];switch(vt){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":Qe=!1;break;case"N":case"AN":break;case"EN":Qe&&(vt="AN");break;case"AL":Qe=!0,vt="R";break;case"WS":case"BN":vt="N";break;case"CS":Ye<1||Ye+1>=xe.length||(At=Xe[Ye-1])!=="EN"&&At!=="AN"||(Dt=xe[Ye+1])!=="EN"&&Dt!=="AN"?vt="N":Qe&&(Dt="AN"),vt=Dt===At?Dt:"N";break;case"ES":vt=(At=Ye>0?Xe[Ye-1]:"B")==="EN"&&Ye+1<xe.length&&xe[Ye+1]==="EN"?"EN":"N";break;case"ET":if(Ye>0&&Xe[Ye-1]==="EN"){vt="EN";break}if(Qe){vt="N";break}for(kt=Ye+1,yt=xe.length;kt<yt&&xe[kt]==="ET";)kt++;vt=kt<yt&&xe[kt]==="EN"?"EN":"N";break;case"NSM":if(b&&!a){for(yt=xe.length,kt=Ye+1;kt<yt&&xe[kt]==="NSM";)kt++;if(kt<yt){var sr=me[Ye],Zt=sr>=1425&&sr<=2303||sr===64286;if(At=xe[kt],Zt&&(At==="R"||At==="AL")){vt="R";break}}}vt=Ye<1||(At=xe[Ye-1])==="B"?"N":Xe[Ye-1];break;case"B":Qe=!1,v=!0,vt=Oe;break;case"S":x=!0,vt="N"}return vt},it=function(me,xe,Xe){var Ye=me.split("");return Xe&&He(Ye,Xe,{hiLevel:Oe}),Ye.reverse(),xe&&xe.reverse(),Ye.join("")},He=function(me,xe,Xe){var Ye,At,Dt,kt,yt,vt=-1,sr=me.length,Zt=0,he=[],Fe=Oe?j:ee,$e=[];for(Qe=!1,v=!1,x=!1,At=0;At<sr;At++)$e[At]=Me(me[At]);for(Dt=0;Dt<sr;Dt++){if(yt=Zt,he[Dt]=Ze(me,$e,he,Dt),Ye=240&(Zt=Fe[yt][Pe[he[Dt]]]),Zt&=15,xe[Dt]=kt=Fe[Zt][5],Ye>0)if(Ye===16){for(At=vt;At<Dt;At++)xe[At]=1;vt=-1}else vt=-1;if(Fe[Zt][6])vt===-1&&(vt=Dt);else if(vt>-1){for(At=vt;At<Dt;At++)xe[At]=kt;vt=-1}$e[Dt]==="B"&&(xe[Dt]=0),Xe.hiLevel|=kt}x&&function(tt,ct,ut){for(var pt=0;pt<ut;pt++)if(tt[pt]==="S"){ct[pt]=Oe;for(var wt=pt-1;wt>=0&&tt[wt]==="WS";wt--)ct[wt]=Oe}}($e,xe,sr)},Te=function(me,xe,Xe,Ye,At){if(!(At.hiLevel<me)){if(me===1&&Oe===1&&!v)return xe.reverse(),void(Xe&&Xe.reverse());for(var Dt,kt,yt,vt,sr=xe.length,Zt=0;Zt<sr;){if(Ye[Zt]>=me){for(yt=Zt+1;yt<sr&&Ye[yt]>=me;)yt++;for(vt=Zt,kt=yt-1;vt<kt;vt++,kt--)Dt=xe[vt],xe[vt]=xe[kt],xe[kt]=Dt,Xe&&(Dt=Xe[vt],Xe[vt]=Xe[kt],Xe[kt]=Dt);Zt=yt}Zt++}}},st=function(me,xe,Xe){var Ye=me.split(""),At={hiLevel:Oe};return Xe||(Xe=[]),He(Ye,Xe,At),function(Dt,kt,yt){if(yt.hiLevel!==0&&O)for(var vt,sr=0;sr<Dt.length;sr++)kt[sr]===1&&(vt=Q.indexOf(Dt[sr]))>=0&&(Dt[sr]=Q[vt+1])}(Ye,Xe,At),Te(2,Ye,xe,Xe,At),Te(1,Ye,xe,Xe,At),Ye.join("")};return this.__bidiEngine__.doBidiReorder=function(me,xe,Xe){if(function(At,Dt){if(Dt)for(var kt=0;kt<At.length;kt++)Dt[kt]=kt;a===void 0&&(a=Ge(At)),F===void 0&&(F=Ge(At))}(me,xe),b||!C||F)if(b&&C&&a^F)Oe=a?1:0,me=it(me,xe,Xe);else if(!b&&C&&F)Oe=a?1:0,me=st(me,xe,Xe),me=it(me,xe);else if(!b||a||C||F){if(b&&!C&&a^F)me=it(me,xe),a?(Oe=0,me=st(me,xe,Xe)):(Oe=1,me=st(me,xe,Xe),me=it(me,xe));else if(b&&a&&!C&&F)Oe=1,me=st(me,xe,Xe),me=it(me,xe);else if(!b&&!C&&a^F){var Ye=O;a?(Oe=1,me=st(me,xe,Xe),Oe=0,O=!1,me=st(me,xe,Xe),O=Ye):(Oe=0,me=st(me,xe,Xe),me=it(me,xe),Oe=1,O=!1,me=st(me,xe,Xe),O=Ye,me=it(me,xe))}}else Oe=0,me=st(me,xe,Xe);else Oe=a?1:0,me=st(me,xe,Xe);return me},this.__bidiEngine__.setOptions=function(me){me&&(b=me.isInputVisual,C=me.isOutputVisual,a=me.isInputRtl,F=me.isOutputRtl,O=me.isSymmetricSwapping)},this.__bidiEngine__.setOptions(m),this.__bidiEngine__};var o=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],u=new p.__bidiEngine__({isInputVisual:!0});p.API.events.push(["postProcessText",function(m){var v=m.text;m.x,m.y;var x=m.options||{};m.mutex,x.lang;var b=[];if(x.isInputVisual=typeof x.isInputVisual!="boolean"||x.isInputVisual,u.setOptions(x),Object.prototype.toString.call(v)==="[object Array]"){var a=0;for(b=[],a=0;a<v.length;a+=1)Object.prototype.toString.call(v[a])==="[object Array]"?b.push([u.doBidiReorder(v[a][0]),v[a][1],v[a][2]]):b.push([u.doBidiReorder(v[a])]);m.text=b}else m.text=u.doBidiReorder(v);u.setOptions({isInputVisual:!0})}])}(qr),qr.API.TTFFont=function(){function p(o){var u;if(this.rawData=o,u=this.contents=new Wc(o),this.contents.pos=4,u.readString(4)==="ttcf")throw new Error("TTCF not supported.");u.pos=0,this.parse(),this.subset=new s5(this),this.registerTTF()}return p.open=function(o){return new p(o)},p.prototype.parse=function(){return this.directory=new $w(this.contents),this.head=new Ww(this),this.name=new Kw(this),this.cmap=new B0(this),this.toUnicode={},this.hhea=new Hw(this),this.maxp=new Qw(this),this.hmtx=new e5(this),this.post=new Yw(this),this.os2=new Xw(this),this.loca=new n5(this),this.glyf=new t5(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},p.prototype.registerTTF=function(){var o,u,m,v,x;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var b,a,C,F;for(F=[],b=0,a=(C=this.bbox).length;b<a;b++)o=C[b],F.push(Math.round(o*this.scaleFactor));return F}).call(this),this.stemV=0,this.post.exists?(m=255&(v=this.post.italic_angle),32768&(u=v>>16)&&(u=-(1+(65535^u))),this.italicAngle=+(u+"."+m)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(x=this.familyClass)===1||x===2||x===3||x===4||x===5||x===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},p.prototype.characterToGlyph=function(o){var u;return((u=this.cmap.unicode)!=null?u.codeMap[o]:void 0)||0},p.prototype.widthOfGlyph=function(o){var u;return u=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(o).advance*u},p.prototype.widthOfString=function(o,u,m){var v,x,b,a;for(b=0,x=0,a=(o=""+o).length;0<=a?x<a:x>a;x=0<=a?++x:--x)v=o.charCodeAt(x),b+=this.widthOfGlyph(this.characterToGlyph(v))+m*(1e3/u)||0;return b*(u/1e3)},p.prototype.lineHeight=function(o,u){var m;return u==null&&(u=!1),m=u?this.lineGap:0,(this.ascender+m-this.decender)/1e3*o},p}();var fl,Wc=function(){function p(o){this.data=o??[],this.pos=0,this.length=this.data.length}return p.prototype.readByte=function(){return this.data[this.pos++]},p.prototype.writeByte=function(o){return this.data[this.pos++]=o},p.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},p.prototype.writeUInt32=function(o){return this.writeByte(o>>>24&255),this.writeByte(o>>16&255),this.writeByte(o>>8&255),this.writeByte(255&o)},p.prototype.readInt32=function(){var o;return(o=this.readUInt32())>=2147483648?o-4294967296:o},p.prototype.writeInt32=function(o){return o<0&&(o+=4294967296),this.writeUInt32(o)},p.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},p.prototype.writeUInt16=function(o){return this.writeByte(o>>8&255),this.writeByte(255&o)},p.prototype.readInt16=function(){var o;return(o=this.readUInt16())>=32768?o-65536:o},p.prototype.writeInt16=function(o){return o<0&&(o+=65536),this.writeUInt16(o)},p.prototype.readString=function(o){var u,m;for(m=[],u=0;0<=o?u<o:u>o;u=0<=o?++u:--u)m[u]=String.fromCharCode(this.readByte());return m.join("")},p.prototype.writeString=function(o){var u,m,v;for(v=[],u=0,m=o.length;0<=m?u<m:u>m;u=0<=m?++u:--u)v.push(this.writeByte(o.charCodeAt(u)));return v},p.prototype.readShort=function(){return this.readInt16()},p.prototype.writeShort=function(o){return this.writeInt16(o)},p.prototype.readLongLong=function(){var o,u,m,v,x,b,a,C;return o=this.readByte(),u=this.readByte(),m=this.readByte(),v=this.readByte(),x=this.readByte(),b=this.readByte(),a=this.readByte(),C=this.readByte(),128&o?-1*(72057594037927940*(255^o)+281474976710656*(255^u)+1099511627776*(255^m)+4294967296*(255^v)+16777216*(255^x)+65536*(255^b)+256*(255^a)+(255^C)+1):72057594037927940*o+281474976710656*u+1099511627776*m+4294967296*v+16777216*x+65536*b+256*a+C},p.prototype.writeLongLong=function(o){var u,m;return u=Math.floor(o/4294967296),m=4294967295&o,this.writeByte(u>>24&255),this.writeByte(u>>16&255),this.writeByte(u>>8&255),this.writeByte(255&u),this.writeByte(m>>24&255),this.writeByte(m>>16&255),this.writeByte(m>>8&255),this.writeByte(255&m)},p.prototype.readInt=function(){return this.readInt32()},p.prototype.writeInt=function(o){return this.writeInt32(o)},p.prototype.read=function(o){var u,m;for(u=[],m=0;0<=o?m<o:m>o;m=0<=o?++m:--m)u.push(this.readByte());return u},p.prototype.write=function(o){var u,m,v,x;for(x=[],m=0,v=o.length;m<v;m++)u=o[m],x.push(this.writeByte(u));return x},p}(),$w=function(){var p;function o(u){var m,v,x;for(this.scalarType=u.readInt(),this.tableCount=u.readShort(),this.searchRange=u.readShort(),this.entrySelector=u.readShort(),this.rangeShift=u.readShort(),this.tables={},v=0,x=this.tableCount;0<=x?v<x:v>x;v=0<=x?++v:--v)m={tag:u.readString(4),checksum:u.readInt(),offset:u.readInt(),length:u.readInt()},this.tables[m.tag]=m}return o.prototype.encode=function(u){var m,v,x,b,a,C,F,O,Y,ee,j,Pe,ce;for(ce in j=Object.keys(u).length,C=Math.log(2),Y=16*Math.floor(Math.log(j)/C),b=Math.floor(Y/C),O=16*j-Y,(v=new Wc).writeInt(this.scalarType),v.writeShort(j),v.writeShort(Y),v.writeShort(b),v.writeShort(O),x=16*j,F=v.pos+x,a=null,Pe=[],u)for(ee=u[ce],v.writeString(ce),v.writeInt(p(ee)),v.writeInt(F),v.writeInt(ee.length),Pe=Pe.concat(ee),ce==="head"&&(a=F),F+=ee.length;F%4;)Pe.push(0),F++;return v.write(Pe),m=2981146554-p(v.data),v.pos=a+8,v.writeUInt32(m),v.data},p=function(u){var m,v,x,b;for(u=j0.call(u);u.length%4;)u.push(0);for(x=new Wc(u),v=0,m=0,b=u.length;m<b;m=m+=4)v+=x.readUInt32();return 4294967295&v},o}(),Zw={}.hasOwnProperty,Nl=function(p,o){for(var u in o)Zw.call(o,u)&&(p[u]=o[u]);function m(){this.constructor=p}return m.prototype=o.prototype,p.prototype=new m,p.__super__=o.prototype,p};fl=function(){function p(o){var u;this.file=o,u=this.file.directory.tables[this.tag],this.exists=!!u,u&&(this.offset=u.offset,this.length=u.length,this.parse(this.file.contents))}return p.prototype.parse=function(){},p.prototype.encode=function(){},p.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},p}();var Ww=function(){function p(){return p.__super__.constructor.apply(this,arguments)}return Nl(p,fl),p.prototype.tag="head",p.prototype.parse=function(o){return o.pos=this.offset,this.version=o.readInt(),this.revision=o.readInt(),this.checkSumAdjustment=o.readInt(),this.magicNumber=o.readInt(),this.flags=o.readShort(),this.unitsPerEm=o.readShort(),this.created=o.readLongLong(),this.modified=o.readLongLong(),this.xMin=o.readShort(),this.yMin=o.readShort(),this.xMax=o.readShort(),this.yMax=o.readShort(),this.macStyle=o.readShort(),this.lowestRecPPEM=o.readShort(),this.fontDirectionHint=o.readShort(),this.indexToLocFormat=o.readShort(),this.glyphDataFormat=o.readShort()},p.prototype.encode=function(o){var u;return(u=new Wc).writeInt(this.version),u.writeInt(this.revision),u.writeInt(this.checkSumAdjustment),u.writeInt(this.magicNumber),u.writeShort(this.flags),u.writeShort(this.unitsPerEm),u.writeLongLong(this.created),u.writeLongLong(this.modified),u.writeShort(this.xMin),u.writeShort(this.yMin),u.writeShort(this.xMax),u.writeShort(this.yMax),u.writeShort(this.macStyle),u.writeShort(this.lowestRecPPEM),u.writeShort(this.fontDirectionHint),u.writeShort(o),u.writeShort(this.glyphDataFormat),u.data},p}(),By=function(){function p(o,u){var m,v,x,b,a,C,F,O,Y,ee,j,Pe,ce,Q,ge,Qe,Oe;switch(this.platformID=o.readUInt16(),this.encodingID=o.readShort(),this.offset=u+o.readInt(),Y=o.pos,o.pos=this.offset,this.format=o.readUInt16(),this.length=o.readUInt16(),this.language=o.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(C=0;C<256;++C)this.codeMap[C]=o.readByte();break;case 4:for(j=o.readUInt16(),ee=j/2,o.pos+=6,x=function(){var Me,Ge;for(Ge=[],C=Me=0;0<=ee?Me<ee:Me>ee;C=0<=ee?++Me:--Me)Ge.push(o.readUInt16());return Ge}(),o.pos+=2,ce=function(){var Me,Ge;for(Ge=[],C=Me=0;0<=ee?Me<ee:Me>ee;C=0<=ee?++Me:--Me)Ge.push(o.readUInt16());return Ge}(),F=function(){var Me,Ge;for(Ge=[],C=Me=0;0<=ee?Me<ee:Me>ee;C=0<=ee?++Me:--Me)Ge.push(o.readUInt16());return Ge}(),O=function(){var Me,Ge;for(Ge=[],C=Me=0;0<=ee?Me<ee:Me>ee;C=0<=ee?++Me:--Me)Ge.push(o.readUInt16());return Ge}(),v=(this.length-o.pos+this.offset)/2,a=function(){var Me,Ge;for(Ge=[],C=Me=0;0<=v?Me<v:Me>v;C=0<=v?++Me:--Me)Ge.push(o.readUInt16());return Ge}(),C=ge=0,Oe=x.length;ge<Oe;C=++ge)for(Q=x[C],m=Qe=Pe=ce[C];Pe<=Q?Qe<=Q:Qe>=Q;m=Pe<=Q?++Qe:--Qe)O[C]===0?b=m+F[C]:(b=a[O[C]/2+(m-Pe)-(ee-C)]||0)!==0&&(b+=F[C]),this.codeMap[m]=65535&b}o.pos=Y}return p.encode=function(o,u){var m,v,x,b,a,C,F,O,Y,ee,j,Pe,ce,Q,ge,Qe,Oe,Me,Ge,Ze,it,He,Te,st,me,xe,Xe,Ye,At,Dt,kt,yt,vt,sr,Zt,he,Fe,$e,tt,ct,ut,pt,wt,Bt,er,ur;switch(Ye=new Wc,b=Object.keys(o).sort(function(fr,Ft){return fr-Ft}),u){case"macroman":for(ce=0,Q=function(){var fr=[];for(Pe=0;Pe<256;++Pe)fr.push(0);return fr}(),Qe={0:0},x={},At=0,vt=b.length;At<vt;At++)Qe[wt=o[v=b[At]]]==null&&(Qe[wt]=++ce),x[v]={old:o[v],new:Qe[o[v]]},Q[v]=Qe[o[v]];return Ye.writeUInt16(1),Ye.writeUInt16(0),Ye.writeUInt32(12),Ye.writeUInt16(0),Ye.writeUInt16(262),Ye.writeUInt16(0),Ye.write(Q),{charMap:x,subtable:Ye.data,maxGlyphID:ce+1};case"unicode":for(xe=[],Y=[],Oe=0,Qe={},m={},ge=F=null,Dt=0,sr=b.length;Dt<sr;Dt++)Qe[Ge=o[v=b[Dt]]]==null&&(Qe[Ge]=++Oe),m[v]={old:Ge,new:Qe[Ge]},a=Qe[Ge]-v,ge!=null&&a===F||(ge&&Y.push(ge),xe.push(v),F=a),ge=v;for(ge&&Y.push(ge),Y.push(65535),xe.push(65535),st=2*(Te=xe.length),He=2*Math.pow(Math.log(Te)/Math.LN2,2),ee=Math.log(He/2)/Math.LN2,it=2*Te-He,C=[],Ze=[],j=[],Pe=kt=0,Zt=xe.length;kt<Zt;Pe=++kt){if(me=xe[Pe],O=Y[Pe],me===65535){C.push(0),Ze.push(0);break}if(me-(Xe=m[me].new)>=32768)for(C.push(0),Ze.push(2*(j.length+Te-Pe)),v=yt=me;me<=O?yt<=O:yt>=O;v=me<=O?++yt:--yt)j.push(m[v].new);else C.push(Xe-me),Ze.push(0)}for(Ye.writeUInt16(3),Ye.writeUInt16(1),Ye.writeUInt32(12),Ye.writeUInt16(4),Ye.writeUInt16(16+8*Te+2*j.length),Ye.writeUInt16(0),Ye.writeUInt16(st),Ye.writeUInt16(He),Ye.writeUInt16(ee),Ye.writeUInt16(it),ut=0,he=Y.length;ut<he;ut++)v=Y[ut],Ye.writeUInt16(v);for(Ye.writeUInt16(0),pt=0,Fe=xe.length;pt<Fe;pt++)v=xe[pt],Ye.writeUInt16(v);for(Bt=0,$e=C.length;Bt<$e;Bt++)a=C[Bt],Ye.writeUInt16(a);for(er=0,tt=Ze.length;er<tt;er++)Me=Ze[er],Ye.writeUInt16(Me);for(ur=0,ct=j.length;ur<ct;ur++)ce=j[ur],Ye.writeUInt16(ce);return{charMap:m,subtable:Ye.data,maxGlyphID:Oe+1}}},p}(),B0=function(){function p(){return p.__super__.constructor.apply(this,arguments)}return Nl(p,fl),p.prototype.tag="cmap",p.prototype.parse=function(o){var u,m,v;for(o.pos=this.offset,this.version=o.readUInt16(),v=o.readUInt16(),this.tables=[],this.unicode=null,m=0;0<=v?m<v:m>v;m=0<=v?++m:--m)u=new By(o,this.offset),this.tables.push(u),u.isUnicode&&this.unicode==null&&(this.unicode=u);return!0},p.encode=function(o,u){var m,v;return u==null&&(u="macroman"),m=By.encode(o,u),(v=new Wc).writeUInt16(0),v.writeUInt16(1),m.table=v.data.concat(m.subtable),m},p}(),Hw=function(){function p(){return p.__super__.constructor.apply(this,arguments)}return Nl(p,fl),p.prototype.tag="hhea",p.prototype.parse=function(o){return o.pos=this.offset,this.version=o.readInt(),this.ascender=o.readShort(),this.decender=o.readShort(),this.lineGap=o.readShort(),this.advanceWidthMax=o.readShort(),this.minLeftSideBearing=o.readShort(),this.minRightSideBearing=o.readShort(),this.xMaxExtent=o.readShort(),this.caretSlopeRise=o.readShort(),this.caretSlopeRun=o.readShort(),this.caretOffset=o.readShort(),o.pos+=8,this.metricDataFormat=o.readShort(),this.numberOfMetrics=o.readUInt16()},p}(),Xw=function(){function p(){return p.__super__.constructor.apply(this,arguments)}return Nl(p,fl),p.prototype.tag="OS/2",p.prototype.parse=function(o){if(o.pos=this.offset,this.version=o.readUInt16(),this.averageCharWidth=o.readShort(),this.weightClass=o.readUInt16(),this.widthClass=o.readUInt16(),this.type=o.readShort(),this.ySubscriptXSize=o.readShort(),this.ySubscriptYSize=o.readShort(),this.ySubscriptXOffset=o.readShort(),this.ySubscriptYOffset=o.readShort(),this.ySuperscriptXSize=o.readShort(),this.ySuperscriptYSize=o.readShort(),this.ySuperscriptXOffset=o.readShort(),this.ySuperscriptYOffset=o.readShort(),this.yStrikeoutSize=o.readShort(),this.yStrikeoutPosition=o.readShort(),this.familyClass=o.readShort(),this.panose=function(){var u,m;for(m=[],u=0;u<10;++u)m.push(o.readByte());return m}(),this.charRange=function(){var u,m;for(m=[],u=0;u<4;++u)m.push(o.readInt());return m}(),this.vendorID=o.readString(4),this.selection=o.readShort(),this.firstCharIndex=o.readShort(),this.lastCharIndex=o.readShort(),this.version>0&&(this.ascent=o.readShort(),this.descent=o.readShort(),this.lineGap=o.readShort(),this.winAscent=o.readShort(),this.winDescent=o.readShort(),this.codePageRange=function(){var u,m;for(m=[],u=0;u<2;u=++u)m.push(o.readInt());return m}(),this.version>1))return this.xHeight=o.readShort(),this.capHeight=o.readShort(),this.defaultChar=o.readShort(),this.breakChar=o.readShort(),this.maxContext=o.readShort()},p}(),Yw=function(){function p(){return p.__super__.constructor.apply(this,arguments)}return Nl(p,fl),p.prototype.tag="post",p.prototype.parse=function(o){var u,m,v;switch(o.pos=this.offset,this.format=o.readInt(),this.italicAngle=o.readInt(),this.underlinePosition=o.readShort(),this.underlineThickness=o.readShort(),this.isFixedPitch=o.readInt(),this.minMemType42=o.readInt(),this.maxMemType42=o.readInt(),this.minMemType1=o.readInt(),this.maxMemType1=o.readInt(),this.format){case 65536:case 196608:break;case 131072:var x;for(m=o.readUInt16(),this.glyphNameIndex=[],x=0;0<=m?x<m:x>m;x=0<=m?++x:--x)this.glyphNameIndex.push(o.readUInt16());for(this.names=[],v=[];o.pos<this.offset+this.length;)u=o.readByte(),v.push(this.names.push(o.readString(u)));return v;case 151552:return m=o.readUInt16(),this.offsets=o.read(m);case 262144:return this.map=(function(){var b,a,C;for(C=[],x=b=0,a=this.file.maxp.numGlyphs;0<=a?b<a:b>a;x=0<=a?++b:--b)C.push(o.readUInt32());return C}).call(this)}},p}(),Jw=function(p,o){this.raw=p,this.length=p.length,this.platformID=o.platformID,this.encodingID=o.encodingID,this.languageID=o.languageID},Kw=function(){function p(){return p.__super__.constructor.apply(this,arguments)}return Nl(p,fl),p.prototype.tag="name",p.prototype.parse=function(o){var u,m,v,x,b,a,C,F,O,Y,ee;for(o.pos=this.offset,o.readShort(),u=o.readShort(),a=o.readShort(),m=[],x=0;0<=u?x<u:x>u;x=0<=u?++x:--x)m.push({platformID:o.readShort(),encodingID:o.readShort(),languageID:o.readShort(),nameID:o.readShort(),length:o.readShort(),offset:this.offset+a+o.readShort()});for(C={},x=O=0,Y=m.length;O<Y;x=++O)v=m[x],o.pos=v.offset,F=o.readString(v.length),b=new Jw(F,v),C[ee=v.nameID]==null&&(C[ee]=[]),C[v.nameID].push(b);this.strings=C,this.copyright=C[0],this.fontFamily=C[1],this.fontSubfamily=C[2],this.uniqueSubfamily=C[3],this.fontName=C[4],this.version=C[5];try{this.postscriptName=C[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=C[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=C[7],this.manufacturer=C[8],this.designer=C[9],this.description=C[10],this.vendorUrl=C[11],this.designerUrl=C[12],this.license=C[13],this.licenseUrl=C[14],this.preferredFamily=C[15],this.preferredSubfamily=C[17],this.compatibleFull=C[18],this.sampleText=C[19]},p}(),Qw=function(){function p(){return p.__super__.constructor.apply(this,arguments)}return Nl(p,fl),p.prototype.tag="maxp",p.prototype.parse=function(o){return o.pos=this.offset,this.version=o.readInt(),this.numGlyphs=o.readUInt16(),this.maxPoints=o.readUInt16(),this.maxContours=o.readUInt16(),this.maxCompositePoints=o.readUInt16(),this.maxComponentContours=o.readUInt16(),this.maxZones=o.readUInt16(),this.maxTwilightPoints=o.readUInt16(),this.maxStorage=o.readUInt16(),this.maxFunctionDefs=o.readUInt16(),this.maxInstructionDefs=o.readUInt16(),this.maxStackElements=o.readUInt16(),this.maxSizeOfInstructions=o.readUInt16(),this.maxComponentElements=o.readUInt16(),this.maxComponentDepth=o.readUInt16()},p}(),e5=function(){function p(){return p.__super__.constructor.apply(this,arguments)}return Nl(p,fl),p.prototype.tag="hmtx",p.prototype.parse=function(o){var u,m,v,x,b,a,C;for(o.pos=this.offset,this.metrics=[],u=0,a=this.file.hhea.numberOfMetrics;0<=a?u<a:u>a;u=0<=a?++u:--u)this.metrics.push({advance:o.readUInt16(),lsb:o.readInt16()});for(v=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var F,O;for(O=[],u=F=0;0<=v?F<v:F>v;u=0<=v?++F:--F)O.push(o.readInt16());return O}(),this.widths=(function(){var F,O,Y,ee;for(ee=[],F=0,O=(Y=this.metrics).length;F<O;F++)x=Y[F],ee.push(x.advance);return ee}).call(this),m=this.widths[this.widths.length-1],C=[],u=b=0;0<=v?b<v:b>v;u=0<=v?++b:--b)C.push(this.widths.push(m));return C},p.prototype.forGlyph=function(o){return o in this.metrics?this.metrics[o]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[o-this.metrics.length]}},p}(),j0=[].slice,t5=function(){function p(){return p.__super__.constructor.apply(this,arguments)}return Nl(p,fl),p.prototype.tag="glyf",p.prototype.parse=function(){return this.cache={}},p.prototype.glyphFor=function(o){var u,m,v,x,b,a,C,F,O,Y;return o in this.cache?this.cache[o]:(x=this.file.loca,u=this.file.contents,m=x.indexOf(o),(v=x.lengthOf(o))===0?this.cache[o]=null:(u.pos=this.offset+m,b=(a=new Wc(u.read(v))).readShort(),F=a.readShort(),Y=a.readShort(),C=a.readShort(),O=a.readShort(),this.cache[o]=b===-1?new i5(a,F,Y,C,O):new r5(a,b,F,Y,C,O),this.cache[o]))},p.prototype.encode=function(o,u,m){var v,x,b,a,C;for(b=[],x=[],a=0,C=u.length;a<C;a++)v=o[u[a]],x.push(b.length),v&&(b=b.concat(v.encode(m)));return x.push(b.length),{table:b,offsets:x}},p}(),r5=function(){function p(o,u,m,v,x,b){this.raw=o,this.numberOfContours=u,this.xMin=m,this.yMin=v,this.xMax=x,this.yMax=b,this.compound=!1}return p.prototype.encode=function(){return this.raw.data},p}(),i5=function(){function p(o,u,m,v,x){var b,a;for(this.raw=o,this.xMin=u,this.yMin=m,this.xMax=v,this.yMax=x,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],b=this.raw;a=b.readShort(),this.glyphOffsets.push(b.pos),this.glyphIDs.push(b.readUInt16()),32&a;)b.pos+=1&a?4:2,128&a?b.pos+=8:64&a?b.pos+=4:8&a&&(b.pos+=2)}return p.prototype.encode=function(){var o,u,m;for(u=new Wc(j0.call(this.raw.data)),o=0,m=this.glyphIDs.length;o<m;++o)u.pos=this.glyphOffsets[o];return u.data},p}(),n5=function(){function p(){return p.__super__.constructor.apply(this,arguments)}return Nl(p,fl),p.prototype.tag="loca",p.prototype.parse=function(o){var u,m;return o.pos=this.offset,u=this.file.head.indexToLocFormat,this.offsets=u===0?(function(){var v,x;for(x=[],m=0,v=this.length;m<v;m+=2)x.push(2*o.readUInt16());return x}).call(this):(function(){var v,x;for(x=[],m=0,v=this.length;m<v;m+=4)x.push(o.readUInt32());return x}).call(this)},p.prototype.indexOf=function(o){return this.offsets[o]},p.prototype.lengthOf=function(o){return this.offsets[o+1]-this.offsets[o]},p.prototype.encode=function(o,u){for(var m=new Uint32Array(this.offsets.length),v=0,x=0,b=0;b<m.length;++b)if(m[b]=v,x<u.length&&u[x]==b){++x,m[b]=v;var a=this.offsets[b],C=this.offsets[b+1]-a;C>0&&(v+=C)}for(var F=new Array(4*m.length),O=0;O<m.length;++O)F[4*O+3]=255&m[O],F[4*O+2]=(65280&m[O])>>8,F[4*O+1]=(16711680&m[O])>>16,F[4*O]=(4278190080&m[O])>>24;return F},p}(),s5=function(){function p(o){this.font=o,this.subset={},this.unicodes={},this.next=33}return p.prototype.generateCmap=function(){var o,u,m,v,x;for(u in v=this.font.cmap.tables[0].codeMap,o={},x=this.subset)m=x[u],o[u]=v[m];return o},p.prototype.glyphsFor=function(o){var u,m,v,x,b,a,C;for(v={},b=0,a=o.length;b<a;b++)v[x=o[b]]=this.font.glyf.glyphFor(x);for(x in u=[],v)(m=v[x])!=null&&m.compound&&u.push.apply(u,m.glyphIDs);if(u.length>0)for(x in C=this.glyphsFor(u))m=C[x],v[x]=m;return v},p.prototype.encode=function(o,u){var m,v,x,b,a,C,F,O,Y,ee,j,Pe,ce,Q,ge;for(v in m=B0.encode(this.generateCmap(),"unicode"),b=this.glyphsFor(o),j={0:0},ge=m.charMap)j[(C=ge[v]).old]=C.new;for(Pe in ee=m.maxGlyphID,b)Pe in j||(j[Pe]=ee++);return O=function(Qe){var Oe,Me;for(Oe in Me={},Qe)Me[Qe[Oe]]=Oe;return Me}(j),Y=Object.keys(O).sort(function(Qe,Oe){return Qe-Oe}),ce=function(){var Qe,Oe,Me;for(Me=[],Qe=0,Oe=Y.length;Qe<Oe;Qe++)a=Y[Qe],Me.push(O[a]);return Me}(),x=this.font.glyf.encode(b,ce,j),F=this.font.loca.encode(x.offsets,ce),Q={cmap:this.font.cmap.raw(),glyf:x.table,loca:F,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(u)},this.font.os2.exists&&(Q["OS/2"]=this.font.os2.raw()),this.font.directory.encode(Q)},p}();qr.API.PDFObject=function(){var p;function o(){}return p=function(u,m){return(Array(m+1).join("0")+u).slice(-m)},o.convert=function(u){var m,v,x,b;if(Array.isArray(u))return"["+function(){var a,C,F;for(F=[],a=0,C=u.length;a<C;a++)m=u[a],F.push(o.convert(m));return F}().join(" ")+"]";if(typeof u=="string")return"/"+u;if(u?.isString)return"("+u+")";if(u instanceof Date)return"(D:"+p(u.getUTCFullYear(),4)+p(u.getUTCMonth(),2)+p(u.getUTCDate(),2)+p(u.getUTCHours(),2)+p(u.getUTCMinutes(),2)+p(u.getUTCSeconds(),2)+"Z)";if({}.toString.call(u)==="[object Object]"){for(v in x=["<<"],u)b=u[v],x.push("/"+v+" "+o.convert(b));return x.push(">>"),x.join(`
`)}return""+u},o}();const Jp={"circle-radius":8,"circle-color":"red","circle-stroke-width":1,"circle-stroke-color":"black"},Yd={style:{textSize:16,textHaloColor:"#FFFFFF",textHaloWidth:.8,textColor:"#000000",fallbackTextFont:["Open Sans Regular"]},visibility:"visible",position:"bottom-right"},Jd={image:'<svg width="800px" height="800px" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--gis" preserveAspectRatio="xMidYMid meet"><path d="M47.655 1.634l-35 95c-.828 2.24 1.659 4.255 3.68 2.98l33.667-21.228l33.666 21.228c2.02 1.271 4.503-.74 3.678-2.98l-35-95C51.907.514 51.163.006 50 .008c-1.163.001-1.99.65-2.345 1.626zm-.155 14.88v57.54L19.89 91.461z" fill="none" stroke="white" stroke-width="1.5"/><path d="M47.655 1.634l-35 95c-.828 2.24 1.659 4.255 3.68 2.98l33.667-21.228l33.666 21.228c2.02 1.271 4.503-.74 3.678-2.98l-35-95C51.907.514 51.163.006 50 .008c-1.163.001-1.99.65-2.345 1.626zm-.155 14.88v57.54L19.89 91.461z" fill="#000000" fill-rule="evenodd"></path></svg>',imageName:"gl-export-north-icon",imageSizeFraction:.05,visibility:"visible",position:"top-right"};class a5{map;width;height;dpi;format;unit;fileName;markerClassName;markerCirclePaint;attributionClassName;attributionOptions;northIconOptions;constructor(o,u=sh.A4,m=300,v=yc.PNG,x=dh.mm,b="map",a="maplibregl-marker",C=Jp,F="maplibregl-ctrl-attrib-inner",O=Yd,Y=Jd){this.map=o,this.width=u[0],this.height=u[1],this.dpi=m,this.format=v,this.unit=x,this.fileName=b,this.markerClassName=a,this.markerCirclePaint=C,this.attributionClassName=F,this.attributionOptions=O,this.northIconOptions=Y}renderMapPost(o){return o}getMarkers(){return this.map.getCanvasContainer().getElementsByClassName(this.markerClassName)}renderMarkers(o){const u=this.getMarkers();for(let m=0;m<u.length;m++){const v=u.item(m);if(!v)continue;const x=v.getAttribute("style");if(!x)continue;const b=/translate\(([^,]+)px,\s*([^,]+)px\)/,a=x.match(b);if(!a)continue;const C=parseInt(a[1]),F=parseInt(a[2]),O=this.map.unproject([C,F]),Y=`point${m}`;o.addSource(Y,{type:"geojson",data:{type:"Point",coordinates:[O.lng,O.lat]}}),o.addLayer({id:Y,source:Y,type:"circle",paint:this.markerCirclePaint})}return o}generate(){const o=this;this.addLoader(),this.showLoader();const u=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return o.dpi/96}});const m=document.createElement("div");m.className="hidden-map",document.body.appendChild(m);const v=document.createElement("div");v.style.width=this.toPixels(this.width),v.style.height=this.toPixels(this.height),m.appendChild(v);const x=this.map.getStyle();if(x&&x.sources){const a=x.sources;Object.keys(a).forEach(C=>{const F=a[C];Object.keys(F).forEach(O=>{F[O]||delete F[O]})})}let b=this.getRenderedMap(v,x);b.on("load",()=>{this.addNorthIconToMap(b).then(()=>{b.once("idle",()=>{this.addAttributions(b)?b.once("idle",()=>{b=this.renderMapPost(b),this.getMarkers().length===0?this.exportImage(b,m,u):(b=this.renderMarkers(b),b.once("idle",()=>{this.exportImage(b,m,u)}))}):(b=this.renderMapPost(b),this.getMarkers().length===0?this.exportImage(b,m,u):(b=this.renderMarkers(b),b.once("idle",()=>{this.exportImage(b,m,u)})))})})})}stripHtml(o){const u=document.createElement("div");return u.innerHTML=o,u.textContent||u.innerText||""}getIconWidth(o,u){const m=o.getContainer(),v=parseInt(m.style.width.replace("px",""));return parseInt(`${v*u}`)}getElementPosition(o,u,m=0){const v=o.getContainer();let x=0,b=0;switch(u){case"top-left":x=0+m,b=0+m;break;case"top-right":x=parseInt(v.style.width.replace("px",""))-m,b=0+m;break;case"bottom-left":x=0+m,b=parseInt(v.style.height.replace("px",""))-m;break;case"bottom-right":x=parseInt(v.style.width.replace("px",""))-m,b=parseInt(v.style.height.replace("px",""))-m;break}return[x,b]}addNorthIconImage(o){const u=this.getIconWidth(o,this.northIconOptions.imageSizeFraction??.08);return new Promise(m=>{const v=new Image(u,u);v.onload=()=>{this.northIconOptions.imageName&&o.addImage(this.northIconOptions.imageName,v),m()};function x(b){return"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(b)}this.northIconOptions.image&&(v.src=x(this.northIconOptions.image))})}addNorthIconToMap(o){let u=this.northIconOptions.visibility??"visible";return o.getZoom()<2&&this.width>this.height&&(u="none"),new Promise(m=>{this.addNorthIconImage(o).then(()=>{const v=this.getIconWidth(o,this.northIconOptions.imageSizeFraction??.08)*.8,x=this.getElementPosition(o,this.northIconOptions.position??"top-right",v),b=o.unproject(x),a=this.northIconOptions.imageName??"gl-export-north-icon";o.addSource(a,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[b.lng,b.lat]},properties:{}}}),o.addLayer({id:a,source:a,type:"symbol",layout:{"icon-image":a,"icon-size":1,"icon-rotate":o.getBearing()*-1,"icon-allow-overlap":!0,"icon-ignore-placement":!0,visibility:u},paint:{}}),m()})})}addAttributions(o){if(!this.map.getStyle().glyphs)return!1;const u=o.getContainer(),m=this.attributionOptions.position??"bottom-right",v=this.getElementPosition(o,m,5),x=v[0],b=o.unproject(v),a=u.getElementsByClassName(this.attributionClassName),C=[];if(a?.length>0){const ce=a.item(0);if(ce)for(let Q=0;Q<ce.children.length;Q++){const ge=ce.children.item(Q);ge&&C.push(this.stripHtml(ge.outerHTML))}}else{const ce=this.map.getStyle().sources;Object.keys(ce).forEach(Q=>{const ge=ce[Q];if("attribution"in ge){const Qe=ge.attribution;C.push(this.stripHtml(Qe))}})}if(C.length===0)return!1;const F=C.join(" | "),O="attribution";o.addSource(O,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[b.lng,b.lat]},properties:{attribution:F}}});const Y=this.map.getStyle().layers.filter(ce=>ce.type==="symbol"&&ce.layout&&"text-font"in ce.layout),ee=Y.length>0&&Y[0].layout?Y[0].layout["text-font"]:this.attributionOptions.style?.fallbackTextFont;let j=this.attributionOptions.visibility??"visible";o.getZoom()<2&&this.width>this.height&&(j="none");const Pe=this.attributionOptions.style;return o.addLayer({id:O,source:O,type:"symbol",layout:{"text-field":["get","attribution"],"text-font":ee,"text-max-width":parseInt(`${x/Pe.textSize}`),"text-anchor":m,"text-justify":["top-right","bottom-right"].includes(m)?"right":"left","text-size":Pe.textSize,"text-allow-overlap":!0,visibility:j},paint:{"text-halo-color":Pe.textHaloColor,"text-halo-width":Pe.textHaloWidth,"text-color":Pe.textColor}}),!0}exportImage(o,u,m){const v=o.getCanvas(),x=`${this.fileName}.${this.format}`;switch(this.format){case yc.PNG:this.toPNG(v,x);break;case yc.JPEG:this.toJPEG(v,x);break;case yc.PDF:this.toPDF(o,x);break;case yc.SVG:this.toSVG(v,x);break;default:console.error(`Invalid file format: ${this.format}`);break}o.remove(),u.parentNode?.removeChild(u),Object.defineProperty(window,"devicePixelRatio",{get(){return m}}),u.remove(),this.hideLoader()}toPNG(o,u){const m=document.createElement("a");m.href=o.toDataURL(),m.download=u,m.click(),m.remove()}toJPEG(o,u){const m=o.toDataURL("image/jpeg",.85),v=document.createElement("a");v.href=m,v.download=u,v.click(),v.remove()}toPDF(o,u){const m=o.getCanvas(),v=new qr({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});v.addImage(m.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:x,lat:b}=o.getCenter();v.setProperties({title:o.getStyle().name,subject:`center: [${x}, ${b}], zoom: ${o.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),v.save(u)}toSVG(o,u){const m=o.toDataURL("image/png"),v=Number(this.toPixels(this.width,this.dpi).replace("px","")),x=Number(this.toPixels(this.height,this.dpi).replace("px","")),b=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${v}" 
      height="${x}" 
      viewBox="0 0 ${v} ${x}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${m}" width="${v}" height="${x}"></image>
    </svg>`,a=document.createElement("a");a.href=`data:application/xml,${encodeURIComponent(b)}`,a.download=u,a.click(),a.remove()}toPixels(o,u=96){return this.unit===dh.mm&&(u/=25.4),`${u*o}px`}addLoader(){const o=this.map.getCanvas().parentElement?.parentElement;if(!o||o.getElementsByClassName("map-export-loader").length>0)return;const u=document.createElement("span");u.classList.add("map-export-loader"),u.classList.add("loader-default"),o.appendChild(u)}showLoader(){const o=this.map.getCanvas().parentElement?.parentElement;if(!o)return;const u=o.getElementsByClassName("map-export-loader");u&&u.length>0&&u.item(0)?.classList.add("is-active")}hideLoader(){const o=this.map.getCanvas().parentElement?.parentElement;if(!o)return;const u=o.getElementsByClassName("map-export-loader");u&&u.length>0&&u.item(0)?.classList.remove("is-active")}}class o5 extends a5{constructor(o,u=sh.A4,m=300,v=yc.PNG,x=dh.mm,b="map",a=Jp,C=Yd,F=Jd){super(o,u,m,v,x,b,"maplibregl-marker",a,"maplibregl-ctrl-attrib-inner",C,F)}getRenderedMap(o,u){const m=new Zy.Map({container:o,style:u,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,canvasContextAttributes:{preserveDrawingBuffer:!0},fadeDuration:0,transformRequest:this.map._requestManager._transformRequestFn});this.map.getTerrain()&&(m.setMaxPitch(85),m.setPitch(this.map.getPitch()));const v=(this.map.style.imageManager||{}).images||[];return Object.keys(v).forEach(x=>{v[x].data&&m.addImage(x,v[x].data)}),m}renderMapPost(o){const u=this.map.getTerrain();return u&&o.setTerrain({source:u.source,exaggeration:u.exaggeration}),o}}class l5{controlContainer;exportContainer;crosshair;printableArea;map;exportButton;options={PageSize:sh.A4,PageOrientation:Ed.Landscape,Format:yc.PDF,DPI:T_[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys(sh),Filename:"map",markerCirclePaint:Jp,attributionOptions:Yd,northIconOptions:Jd};MAPLIB_CSS_PREFIX="maplibregl";constructor(o){o&&(o.attributionOptions=Object.assign(Yd,o.attributionOptions),o.northIconOptions=Object.assign(Jd,o.northIconOptions),this.options=Object.assign(this.options,o)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){const o=this.options.Local??"en";return _2(o)}onAdd(o){this.map=o,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl`),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-group`),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-list`),this.exportButton=document.createElement("button"),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-icon`),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-control`),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const u=document.createElement("TABLE");u.className="print-table";const m={};this.options.AllowedSizes?.forEach(F=>{sh[F]&&(m[F]=sh[F])});const v=this.createSelection(m,this.getTranslation().PageSize,"page-size",this.options.PageSize,(F,O)=>JSON.stringify(F[O]));u.appendChild(v);const x=this.createSelection(Ed,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(F,O)=>F[O]);u.appendChild(x);const b=this.createSelection(yc,this.getTranslation().Format,"format-type",this.options.Format,(F,O)=>F[O]);u.appendChild(b);const a=this.createSelection(T_,this.getTranslation().DPI,"dpi-type",this.options.DPI,(F,O)=>F[O]);u.appendChild(a),this.exportContainer.appendChild(u);const C=document.createElement("button");return C.type="button",C.textContent=this.getTranslation().Generate,C.classList.add("generate-button"),C.addEventListener("click",()=>{const F=document.getElementById("mapbox-gl-export-page-size"),O=document.getElementById("mapbox-gl-export-page-orientation"),Y=document.getElementById("mapbox-gl-export-format-type"),ee=document.getElementById("mapbox-gl-export-dpi-type"),j=O.value;let Pe=JSON.parse(F.value);j===Ed.Portrait&&(Pe=Pe.reverse()),this.generateMap(o,Pe,Number(ee.value),Y.value,dh.mm,this.options.Filename)}),this.exportContainer.appendChild(C),this.controlContainer}generateMap(o,u,m,v,x,b){new o5(o,u,m,v,x,b,this.options.markerCirclePaint,this.options.attributionOptions,this.options.northIconOptions).generate()}createSelection(o,u,m,v,x){const b=document.createElement("label");b.textContent=u;const a=document.createElement("select");a.setAttribute("id",`mapbox-gl-export-${m}`),a.style.width="100%",Object.keys(o).forEach(Y=>{const ee=document.createElement("option");ee.setAttribute("value",x(o,Y)),ee.appendChild(document.createTextNode(Y)),ee.setAttribute("name",m),v===o[Y]&&(ee.selected=!0),a.appendChild(ee)}),a.addEventListener("change",()=>{this.updatePrintableArea()});const C=document.createElement("TR"),F=document.createElement("TD"),O=document.createElement("TD");return F.appendChild(b),O.appendChild(a),C.appendChild(F),C.appendChild(O),C}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0),this.map=void 0)}onDocumentClick(o){this.controlContainer&&!this.controlContainer.contains(o.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(o){this.options.Crosshair===!0&&(o===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new t2(this.map),this.crosshair.create()))}togglePrintableArea(o){this.options.PrintableArea===!0&&(o===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new r2(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const o=document.getElementById("mapbox-gl-export-page-size"),u=document.getElementById("mapbox-gl-export-page-orientation").value;let m=JSON.parse(o.value);u===Ed.Portrait&&(m=m.reverse()),this.printableArea.updateArea(m[0],m[1])}}var c5=["fill-antialias","fill-opacity","fill-color","fill-outline-color","fill-translate","fill-translate-anchor","fill-pattern","fill-extrusion-opacity","fill-extrusion-color","fill-extrusion-translate","fill-extrusion-translate-anchor","fill-extrusion-pattern","fill-extrusion-height","fill-extrusion-base","fill-extrusion-vertical-gradient","line-opacity","line-color","line-translate","line-translate-anchor","line-width","line-gap-width","line-offset","line-blur","line-dasharray","line-pattern","line-gradient","circle-radius","circle-color","circle-blur","circle-opacity","circle-translate","circle-translate-anchor","circle-pitch-scale","circle-pitch-alignment","circle-stroke-width","circle-stroke-color","circle-stroke-opacity","heatmap-radius","heatmap-weight","heatmap-intensity","heatmap-color","heatmap-opacity","icon-opacity","icon-color","icon-halo-color","icon-halo-width","icon-halo-blur","icon-translate","icon-translate-anchor","text-opacity","text-color","text-halo-color","text-halo-width","text-halo-blur","text-translate","text-translate-anchor","raster-opacity","raster-hue-rotate","raster-brightness-min","raster-brightness-max","raster-saturation","raster-contrast","raster-resampling","raster-fade-duration","hillshade-illumination-direction","hillshade-illumination-anchor","hillshade-exaggeration","hillshade-shadow-color","hillshade-highlight-color","hillshade-accent-color","background-color","background-pattern","background-opacity"],u5=["visibility","fill-sort-key","circle-sort-key","line-cap","line-join","line-miter-limit","line-round-limit","line-sort-key","symbol-placement","symbol-spacing","symbol-avoid-edges","symbol-sort-key","symbol-z-order","icon-allow-overlap","icon-ignore-placement","icon-optional","icon-rotation-alignment","icon-size","icon-text-fit","icon-text-fit-padding","icon-image","icon-rotate","icon-padding","icon-keep-upright","icon-offset","icon-anchor","icon-pitch-alignment","text-pitch-alignment","text-rotation-alignment","text-field","text-font","text-size","text-max-width","text-line-height","text-letter-spacing","text-justify","text-radial-offset","text-variable-anchor","text-anchor","text-max-angle","text-writing-mode","text-rotate","text-padding","text-keep-upright","text-transform","text-offset","text-allow-overlap","text-ignore-placement","text-optional"],Zc={paints:c5,layouts:u5};const Lp=p=>p.replace(/[A-Z]/g,o=>`-${o.toLowerCase()}`),qp=p=>p.replace(/(^|-)([a-z])/g,(o,u,m)=>`${m.toUpperCase()}`);function h5(p){return Zc.paints.indexOf(p)>=0}function d5(p){return Zc.layouts.indexOf(p)>=0}function f5(p){return Zc.paints.indexOf(p)>=0?"paint":Zc.layouts.indexOf(p)>=0?"layout":"other"}function p5(p){return String(p).match(/\.(geo)?json/)||p.type==="Feature"||p.type==="FeatureCollection"?{type:"geojson",data:p}:String(p).match(/^mapbox:\/\//)?{type:"vector",url:p}:p}const Gh=(p,o)=>Array.isArray(p)?p:p instanceof RegExp?o.getStyle().layers.map(u=>u.id).filter(u=>u.match(p)):p instanceof Function?o.getStyle().layers.filter(u=>p(u)).map(u=>u.id):[p],Da=p=>function(o,...u){return Gh(o,this.map).forEach(v=>p.call(this,v,...u))},jh=p=>function(o,...u){const v=Gh(o,this.map).map(x=>p.call(this,x,...u));return()=>v.forEach(x=>x())},U0=["line","fill","circle","symbol","video","raster","fill-extrusion","heatmap","hillshade"];class Gc{_loaded=!1;_mapgl=null;map;update;static init(o,u){return o.U=new Gc,o.U._mapgl=u,o.U.map=o,o.U}static async newMap(o,u={},m={}){function v(F,O=[]){F.layers=[...F.layers,...O.map(Y=>this.layerStyle(Y))]}function x(F,O={}){F.sources={...F.sources,...O}}function b(F,O){F=O(F)}function a(F,O={}){Object.keys(O).forEach(Y=>{const ee=O[Y].layers;delete O[Y].layers,F.sources[Y]=O[Y],F.layers=[...F.layers,...ee.map(j=>this.layerStyle({source:Y,...j}))]})}if(u.style||(u.style={version:8,layers:[],sources:{}}),m.addLayers||m.addSources||m.transformStyle||m.mixStyles){let F=u.style,O;if(typeof F=="string"){const ee=F.replace(/^mapbox:\/\/styles\//,"https://api.mapbox.com/styles/v1/");O=await(await fetch(ee)).json()}else O=F;const Y=new Gc;v.call(Y,O,m.addLayers),x(O,m.addSources),b(O,m.transformStyle??(ee=>ee)),a.call(Y,O,m.mixStyles),u.style=O}const C=new o.Map(u);return Gc.init(C,o),C}static interpolateZoom(o,...u){return this.interpolate(["zoom"],o,...u)}static zoom=Gc.interpolateZoom;static step(o,u,m,...v){return["step",typeof o=="string"?["get",o]:o,...Array.isArray(u)&&!m?u:[u],...Array.isArray(m)?m:typeof m=="object"?Object.entries(m).map(([x,b])=>[isNaN(+x)?x:+x,b]).flat():[m,...v]]}static stepZoom(o,u,...m){return this.step(["zoom"],o,u,...m)}static interpolate(o,u,...m){return["interpolate",["linear"],typeof o=="string"?["get",o]:o,...Array.isArray(u)?u:typeof u=="object"?Object.entries(u).map(([v,x])=>[+v,x]).flat():[u,...m]]}static match(o,u,m){return u.default&&(m=u.default,delete u.default),["match",typeof o=="string"?["get",o]:o,...Object.entries(u).map(([v,x])=>[isNaN(+v)?v:+v,x]).flat(),m]}hoverPointer(o){const u=Gh(o,this.map),m=b=>this.map.getCanvas().style.cursor="pointer",v=b=>{this.map.queryRenderedFeatures(b.point,{layers:u}).length===0&&(this.map.getCanvas().style.cursor=x)},x=this.map.getCanvas().style.cursor;for(const b of u)this.map.on("mouseleave",b,v),this.map.on("mouseenter",b,m);return()=>{for(const b of u)this.map.off("mouseenter",b,m),this.map.off("mouseleave",b,v);this.map.getCanvas().style.cursor=x}}hoverFeatureState=jh(function(o,u,m,v,x){if(Array.isArray(u)){let O=u.map(([Y,ee])=>this.hoverFeatureState(o,Y,ee));return()=>O.forEach(Y=>Y())}if(u===void 0){const O=this.getLayerStyle(o);u=O.source,m=O["source-layer"]}let b;const a=O=>{b&&this.map.setFeatureState({source:u,sourceLayer:m,id:b},{hover:O})},C=O=>{const Y=O.features?.[0];Y&&Y.id===b||(a(!1),Y&&(b&&x&&x({...O,oldFeatureId:b}),b=Y.id,a(!0),v&&v(O)))},F=O=>{a(!1),O&&O.oldFeatureId&&(O.oldFeatureId=b),b=void 0,x&&x(O)};return this.map.on("mousemove",o,C),this.map.on("mouseleave",o,F),()=>{this.map.off("mousemove",o,C),this.map.off("mouseleave",o,F),F()}});hoverPopup(o,u,m={}){if(!this._mapgl)throw"Mapbox GL JS or MapLibre GL JS object required when initialising";const v=new this._mapgl.Popup({closeButton:!1,...m});return jh(function(x,b){const a=F=>{F?.features?.[0]&&(v.setLngLat(F.lngLat),v.setHTML(b(F.features[0],v)),v.addTo(this.map))},C=F=>{v.remove()};return this.map.on("mouseenter",x,a),this.map.on("mouseout",x,C),()=>{this.map.off("mouseenter",x,a),this.map.off("mouseout",x,C),C()}}).call(this,o,u)}clickPopup(o,u,m={}){if(!this._mapgl)throw"Mapbox GL JS or Maplibre GL JS object required when initialising";const v=new this._mapgl.Popup({...m});return jh(function(x,b){const a=C=>{C.features?.[0]&&(v.setLngLat(C.features[0].geometry.coordinates.slice()),v.setHTML(b(C.features[0],v)),v.addTo(this.map))};return this.map.on("click",x,a),()=>this.map.off("click",x,a)}).call(this,o,u)}clickLayer=jh(function(o,u){const m=v=>{v.features=this.map.queryRenderedFeatures(v.point,{layers:[o]}),u(v)};return this.map.on("click",o,m),()=>this.map.off("click",o,m)});clickOneLayer(o,u,m){const v=Gh(o,this.map),x=b=>{let a=!1;for(const C of v){const F=this.map.queryRenderedFeatures(b.point,{layers:[C]});if(F[0])try{u({event:b,layer:C,feature:F[0],features:F})}finally{a=!0;break}}!a&&m&&m(b)};return this.map.on("click",x),()=>this.map.off("click",x)}hoverLayer=jh(function(o,u){const m=v=>{v.features=this.map.queryRenderedFeatures(v.point,{layers:[o]}),u(v)};return this.map.on("click",o,m),()=>this.map.off("click",o,m)});_mapAddLayerBefore(o,u){u?(this.map.getLayer(u)||(u=void 0),this.map.addLayer(o,u)):this.map.addLayer(o)}addLayer(o,u,m,v,x){return this._mapAddLayerBefore(this.layerStyle(o,u,m,v),x),this._makeSource(u)}add(o,u,m,v,x){if(this._mapAddLayerBefore({...this.properties(v),id:o,type:m,source:p5(u)},x),typeof u=="string")return this._makeSource(u)}setLayer(o,u,m,v,x){const b=this.layerStyle(o,u,m,v),a=this.map.getStyle();if(!a)throw"Map has no style";const C=a.layers.findIndex(O=>O.id===b.id);if(a.layers.findIndex(O=>O.id===x)<0&&(x=void 0),C>=0){this.map.removeLayer(b.id);let O=x;!x&&a.layers[C+1]&&(O=a.layers[C+1].id),this.map.addLayer(b,O)}else this.map.addLayer(b,x||void 0);return this._makeSource(u)}removeLayer=Da(function(o){const u=m=>{m.error.message.match(/does not exist/)||console.error(m.error)};this.map.once("error",u),this.map.removeLayer(o),this.map.off("error",u)});addLineLayer(o,u,m,v){}addFillLayer(o,u,m,v){}addCircleLayer(o,u,m,v){}addSymbolLayer(o,u,m,v){}addVideoLayer(o,u,m,v){}addRasterLayer(o,u,m,v){}addFillExtrusionLayer(o,u,m,v){}addHeatmapLayer(o,u,m,v){}addHillshadeLayer(o,u,m,v){}addGeoJSONSource(o,u,m){return u&&typeof u=="object"&&!(u.type==="FeatureCollection"||u.type==="GeometryCollection"||u.geometry||u.coordinates)&&(m=u,u=void 0),u||(u={type:"FeatureCollection",features:[]}),this.addSource(o,{type:"geojson",data:u??void 0,...m})}addGeoJSON(o,u,m){return this.addGeoJSONSource(o,u,m)}addSource(o,u){const m=this.map.getStyle();if(!m)throw"Map has no style";return m.sources[o]=u,this.map.setStyle(m),this._makeSource(o)}layersBySource(o){const u=this.map.getStyle();if(!u)throw"Map has no style";return u.layers.filter(m=>m.source===o).map(m=>m.id)}addVectorSource(o,u,m={}){return typeof u=="string"?u.match(/\{z\}/)?this.addSource(o,{...m,type:"vector",tiles:[u]}):this.addSource(o,{...m,type:"vector",url:u}):this.addSource(o,{...u,type:"vector"})}addVector(o,u,m={}){return this.addVectorSource(o,u,m)}addRasterSource(o,u){return this.addSource(o,{...u,type:"raster"})}addRasterDemSource(o,u){return this.addSource(o,{...u,type:"raster-dem"})}addImageSource(o,u){return this.addSource(o,{...u,type:"image"})}addVideoSource(o,u){return this.addSource(o,{...u,type:"video"})}setProperty=Da(function(o,u,m){if(typeof u=="object")Object.keys(u).forEach(v=>this.setProperty(o,v,u[v]));else{const v=Lp(u??""),x=Gh(o,this.map);for(const b of x)h5(v)?this.map.setPaintProperty(b,v,m):d5(v)&&this.map.setLayoutProperty(b,v,m)}});properties(o){if(!o)return;const u={},m={paint:{},layout:{},other:{}};return Object.keys(o).forEach(v=>{const x=Lp(v);m[f5(x)][x]=o[v]}),Object.keys(m.paint).length&&(u.paint=m.paint),Object.keys(m.layout).length&&(u.layout=m.layout),Object.assign(u,m.other),u}layerStyle(...o){const[u,m,v]=o,x=o.find(a=>typeof a=="object"&&!Array.isArray(a)),b=typeof x=="object"?this.properties(x)||{}:{};return typeof u=="string"&&(b.id=u),typeof m=="string"&&(b.source=m),typeof v=="string"&&(b.type=v),b}getLayerStyle(o){return this.map.getStyle()?.layers?.find(u=>u.id===o)}setLayerStyle=Da(function(o,u){const m=(b={},a={})=>Object.keys(b).forEach(C=>{C in a||this.setProperty(o,C,void 0)});typeof o=="object"&&!Array.isArray(o)&&o.id&&!u&&(u=o,o=u.id);const v=this.getLayerStyle(o),x=this.properties(u);m(v?.paint,x?.paint),m(v?.layout,x?.layout),this.setProperty(o,{...x?.paint,...x?.layout},void 0)});setData(o,u={type:"FeatureCollection",features:[]}){this.map.getSource(o).setData(u)}show=Da(function(o){this.setVisibility(o,"visible")});hide=Da(function(o){this.setVisibility(o,"none")});toggle=Da(function(o,u){this.setVisibility(o,u?"visible":"none")});showSource=Da(function(o){this.setVisibility(this.layersBySource(o),"visible")});hideSource=Da(function(o){this.setVisibility(this.layersBySource(o),"none")});toggleSource=Da(function(o,u){this.setVisibility(this.layersBySource(o),u?"visible":"none")});setFilter=Da(function(o,u){this.map.setFilter(o,u)});removeSource=Da(function(o){const u=this.layersBySource(o);this.removeLayer(u),this.map.getSource(o)&&this.map.removeSource(o)});setLayerSource=Da(function(o,u,m){const v=this.map.getStyle().layers,x=v.findIndex(C=>C.id===o),b=v[x],a=v[x+1]&&v[x+1].id;b.source=u,m?b["source-layer"]=m:m!==void 0&&delete b["source-layer"],this.map.removeLayer(o),this._mapAddLayerBefore(b,a)});onLoad(o){if(o)this.map.loaded()||this._loaded?o():this.map.once("load",()=>{this._loaded=!0,o()});else return new Promise(u=>this.onLoad(u))}setRootProperty(o,u){const m=this.map.getStyle();m[Lp(o)]=u,this.map.setStyle(m)}setTransition(o){this.setRootProperty("transition",o)}loadImage(o,u,m){return typeof u=="string"?new Promise((v,x)=>{this.map.loadImage(u,(b,a)=>{b||!a?(console.error(`Error loading image ${u}`,b),x(`Error loading image ${u}`)):(this.map.addImage(o,a,m),v(o))})}):this.map.addImage(o,u,m)}lockOrientation(){const o=this.map.getBearing(),u=this.map.getPitch();this.map.touchZoomRotate.disableRotation(),this.map.dragRotate.disable(),this.map.on("move",()=>{this.map.getBearing()!==o&&this.map.setBearing(o),this.map.getPitch()!==u&&this.map.setPitch(u)})}fontsInUse(){function o(x){Array.isArray(x)&&(x[0]==="literal"?u.push(...x[1]):x.forEach(o))}let u=[];const m=this.map.getStyle();if(!m)throw"Map has no style";const v=m.layers.map(x=>x.type==="symbol"&&x.layout&&x.layout["text-font"]).filter(Boolean);for(const x of v)if(x.stops)try{u.push(...x.stops.flat().filter(Array.isArray).flat())}catch{console.log("Couldn't process font expression:",x)}else x.every(b=>typeof b=="string")?u.push(...x):o(x);return[...new Set(u)]}_makeSource(o){const u=new Gc;return u.map=this.map,u._mapgl=this._mapgl,U0.forEach(function(m){V0(m,u,o)}),u}}const V0=(p,o,u)=>{let m;u?m=function(x,b,a){return this.setLayer(x,u,p,b,a)}:m=function(x,b,a,C){return this.setLayer(x,b,p,a,C)};const v=qp(p);o[`add${v}`]=m,o[`add${v}Layer`]=m};function m5(p){const o=(m,v)=>{const x="set"+qp(m);p[x]=Da(function(b,a){return this.map[v](b,m,a)})},u=(m,v)=>{const x="get"+qp(m);p[x]=Da(function(b){return this.map[v](b,m)})};Zc.paints.forEach(m=>o(m,"setPaintProperty")),Zc.layouts.forEach(m=>o(m,"setLayoutProperty")),Zc.paints.forEach(m=>u(m,"getPaintProperty")),Zc.layouts.forEach(m=>u(m,"getLayoutProperty")),U0.forEach(m=>V0(m,p))}const g5=Gc.prototype;m5(g5);var eo=Uint8Array,oh=Uint16Array,_5=Int32Array,q0=new eo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),G0=new eo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),y5=new eo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$0=function(p,o){for(var u=new oh(31),m=0;m<31;++m)u[m]=o+=1<<p[m-1];for(var v=new _5(u[30]),m=1;m<30;++m)for(var x=u[m];x<u[m+1];++x)v[x]=x-u[m]<<5|m;return{b:u,r:v}},Z0=$0(q0,2),W0=Z0.b,v5=Z0.r;W0[28]=258,v5[258]=28;var b5=$0(G0,0),x5=b5.b,Gp=new oh(32768);for(var yn=0;yn<32768;++yn){var qc=(yn&43690)>>1|(yn&21845)<<1;qc=(qc&52428)>>2|(qc&13107)<<2,qc=(qc&61680)>>4|(qc&3855)<<4,Gp[yn]=((qc&65280)>>8|(qc&255)<<8)>>1}var $h=function(p,o,u){for(var m=p.length,v=0,x=new oh(o);v<m;++v)p[v]&&++x[p[v]-1];var b=new oh(o);for(v=1;v<o;++v)b[v]=b[v-1]+x[v-1]<<1;var a;if(u){a=new oh(1<<o);var C=15-o;for(v=0;v<m;++v)if(p[v])for(var F=v<<4|p[v],O=o-p[v],Y=b[p[v]-1]++<<O,ee=Y|(1<<O)-1;Y<=ee;++Y)a[Gp[Y]>>C]=F}else for(a=new oh(m),v=0;v<m;++v)p[v]&&(a[v]=Gp[b[p[v]-1]++]>>15-p[v]);return a},Yh=new eo(288);for(var yn=0;yn<144;++yn)Yh[yn]=8;for(var yn=144;yn<256;++yn)Yh[yn]=9;for(var yn=256;yn<280;++yn)Yh[yn]=7;for(var yn=280;yn<288;++yn)Yh[yn]=8;var H0=new eo(32);for(var yn=0;yn<32;++yn)H0[yn]=5;var w5=$h(Yh,9,1),S5=$h(H0,5,1),Mp=function(p){for(var o=p[0],u=1;u<p.length;++u)p[u]>o&&(o=p[u]);return o},cl=function(p,o,u){var m=o/8|0;return(p[m]|p[m+1]<<8)>>(o&7)&u},Cp=function(p,o){var u=o/8|0;return(p[u]|p[u+1]<<8|p[u+2]<<16)>>(o&7)},T5=function(p){return(p+7)/8|0},P5=function(p,o,u){return(u==null||u>p.length)&&(u=p.length),new eo(p.subarray(o,u))},A5=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Qa=function(p,o,u){var m=new Error(o||A5[p]);if(m.code=p,Error.captureStackTrace&&Error.captureStackTrace(m,Qa),!u)throw m;return m},Kp=function(p,o,u,m){var v=p.length,x=0;if(!v||o.f&&!o.l)return u||new eo(0);var b=!u,a=b||o.i!=2,C=o.i;b&&(u=new eo(v*3));var F=function(er){var ur=u.length;if(er>ur){var fr=new eo(Math.max(ur*2,er));fr.set(u),u=fr}},O=o.f||0,Y=o.p||0,ee=o.b||0,j=o.l,Pe=o.d,ce=o.m,Q=o.n,ge=v*8;do{if(!j){O=cl(p,Y,1);var Qe=cl(p,Y+1,3);if(Y+=3,Qe)if(Qe==1)j=w5,Pe=S5,ce=9,Q=5;else if(Qe==2){var Ze=cl(p,Y,31)+257,it=cl(p,Y+10,15)+4,He=Ze+cl(p,Y+5,31)+1;Y+=14;for(var Te=new eo(He),st=new eo(19),me=0;me<it;++me)st[y5[me]]=cl(p,Y+me*3,7);Y+=it*3;for(var xe=Mp(st),Xe=(1<<xe)-1,Ye=$h(st,xe,1),me=0;me<He;){var At=Ye[cl(p,Y,Xe)];Y+=At&15;var Oe=At>>4;if(Oe<16)Te[me++]=Oe;else{var Dt=0,kt=0;for(Oe==16?(kt=3+cl(p,Y,3),Y+=2,Dt=Te[me-1]):Oe==17?(kt=3+cl(p,Y,7),Y+=3):Oe==18&&(kt=11+cl(p,Y,127),Y+=7);kt--;)Te[me++]=Dt}}var yt=Te.subarray(0,Ze),vt=Te.subarray(Ze);ce=Mp(yt),Q=Mp(vt),j=$h(yt,ce,1),Pe=$h(vt,Q,1)}else Qa(1);else{var Oe=T5(Y)+4,Me=p[Oe-4]|p[Oe-3]<<8,Ge=Oe+Me;if(Ge>v){C&&Qa(0);break}a&&F(ee+Me),u.set(p.subarray(Oe,Ge),ee),o.b=ee+=Me,o.p=Y=Ge*8,o.f=O;continue}if(Y>ge){C&&Qa(0);break}}a&&F(ee+131072);for(var sr=(1<<ce)-1,Zt=(1<<Q)-1,he=Y;;he=Y){var Dt=j[Cp(p,Y)&sr],Fe=Dt>>4;if(Y+=Dt&15,Y>ge){C&&Qa(0);break}if(Dt||Qa(2),Fe<256)u[ee++]=Fe;else if(Fe==256){he=Y,j=null;break}else{var $e=Fe-254;if(Fe>264){var me=Fe-257,tt=q0[me];$e=cl(p,Y,(1<<tt)-1)+W0[me],Y+=tt}var ct=Pe[Cp(p,Y)&Zt],ut=ct>>4;ct||Qa(3),Y+=ct&15;var vt=x5[ut];if(ut>3){var tt=G0[ut];vt+=Cp(p,Y)&(1<<tt)-1,Y+=tt}if(Y>ge){C&&Qa(0);break}a&&F(ee+131072);var pt=ee+$e;if(ee<vt){var wt=x-vt,Bt=Math.min(vt,pt);for(wt+ee<0&&Qa(3);ee<Bt;++ee)u[ee]=m[wt+ee]}for(;ee<pt;++ee)u[ee]=u[ee-vt]}}o.l=j,o.p=he,o.b=ee,o.f=O,j&&(O=1,o.m=ce,o.d=Pe,o.n=Q)}while(!O);return ee!=u.length&&b?P5(u,0,ee):u.subarray(0,ee)},I5=new eo(0),E5=function(p){(p[0]!=31||p[1]!=139||p[2]!=8)&&Qa(6,"invalid gzip data");var o=p[3],u=10;o&4&&(u+=(p[10]|p[11]<<8)+2);for(var m=(o>>3&1)+(o>>4&1);m>0;m-=!p[u++]);return u+(o&2)},L5=function(p){var o=p.length;return(p[o-4]|p[o-3]<<8|p[o-2]<<16|p[o-1]<<24)>>>0},M5=function(p,o){return((p[0]&15)!=8||p[0]>>4>7||(p[0]<<8|p[1])%31)&&Qa(6,"invalid zlib data"),(p[1]>>5&1)==1&&Qa(6,"invalid zlib data: "+(p[1]&32?"need":"unexpected")+" dictionary"),(p[1]>>3&4)+2};function C5(p,o){return Kp(p,{i:2},o,o)}function k5(p,o){var u=E5(p);return u+8>p.length&&Qa(6,"invalid gzip data"),Kp(p.subarray(u,-8),{i:2},new eo(L5(p)),o)}function D5(p,o){return Kp(p.subarray(M5(p),-4),{i:2},o,o)}function F5(p,o){return p[0]==31&&p[1]==139&&p[2]==8?k5(p,o):(p[0]&15)!=8||p[0]>>4>7||(p[0]<<8|p[1])%31?C5(p,o):D5(p,o)}var R5=typeof TextDecoder<"u"&&new TextDecoder,z5=0;try{R5.decode(I5,{stream:!0}),z5=1}catch{}var N5=Object.defineProperty,Zh=Math.pow,Yi=(p,o)=>N5(p,"name",{value:o,configurable:!0}),Es=(p,o,u)=>new Promise((m,v)=>{var x=C=>{try{a(u.next(C))}catch(F){v(F)}},b=C=>{try{a(u.throw(C))}catch(F){v(F)}},a=C=>C.done?m(C.value):Promise.resolve(C.value).then(x,b);a((u=u.apply(p,o)).next())});Yi((p,o)=>{let u=!1,m="",v=L.GridLayer.extend({createTile:Yi((x,b)=>{let a=document.createElement("img"),C=new AbortController,F=C.signal;return a.cancel=()=>{C.abort()},u||(p.getHeader().then(O=>{O.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):O.tileType===2?m="image/png":O.tileType===3?m="image/jpeg":O.tileType===4?m="image/webp":O.tileType===5&&(m="image/avif")}),u=!0),p.getZxy(x.z,x.x,x.y,F).then(O=>{if(O){let Y=new Blob([O.data],{type:m}),ee=window.URL.createObjectURL(Y);a.src=ee,a.cancel=void 0,b(void 0,a)}}).catch(O=>{if(O.name!=="AbortError")throw O}),a},"createTile"),_removeTile:Yi(function(x){let b=this._tiles[x];b&&(b.el.cancel&&b.el.cancel(),b.el.width=0,b.el.height=0,b.el.deleted=!0,L.DomUtil.remove(b.el),delete this._tiles[x],this.fire("tileunload",{tile:b.el,coords:this._keyToTileCoords(x)}))},"_removeTile")});return new v(o)},"leafletRasterLayer");var O5=Yi(p=>(o,u)=>{if(u instanceof AbortController)return p(o,u);let m=new AbortController;return p(o,m).then(v=>u(void 0,v.data,v.cacheControl||"",v.expires||""),v=>u(v)).catch(v=>u(v)),{cancel:Yi(()=>m.abort(),"cancel")}},"v3compat"),X0=class{constructor(o){this.tilev4=Yi((u,m)=>Es(this,null,function*(){if(u.type==="json"){let j=u.url.substr(10),Pe=this.tiles.get(j);if(Pe||(Pe=new jy(j),this.tiles.set(j,Pe)),this.metadata)return{data:yield Pe.getTileJson(u.url)};let ce=yield Pe.getHeader();return(ce.minLon>=ce.maxLon||ce.minLat>=ce.maxLat)&&console.error(`Bounds of PMTiles archive ${ce.minLon},${ce.minLat},${ce.maxLon},${ce.maxLat} are not valid.`),{data:{tiles:[`${u.url}/{z}/{x}/{y}`],minzoom:ce.minZoom,maxzoom:ce.maxZoom,bounds:[ce.minLon,ce.minLat,ce.maxLon,ce.maxLat]}}}let v=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),x=u.url.match(v);if(!x)throw new Error("Invalid PMTiles protocol URL");let b=x[1],a=this.tiles.get(b);a||(a=new jy(b),this.tiles.set(b,a));let C=x[2],F=x[3],O=x[4],Y=yield a.getHeader(),ee=yield a?.getZxy(+C,+F,+O,m.signal);if(ee)return{data:new Uint8Array(ee.data),cacheControl:ee.cacheControl,expires:ee.expires};if(Y.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=O5(this.tilev4),this.tiles=new Map,this.metadata=o?.metadata||!1,this.errorOnMissingTile=o?.errorOnMissingTile||!1}add(o){this.tiles.set(o.source.getKey(),o)}get(o){return this.tiles.get(o)}};Yi(X0,"Protocol");var B5=X0;function Y0(p,o){return(o>>>0)*4294967296+(p>>>0)}Yi(Y0,"toNum");function J0(p,o){let u=o.buf,m=u[o.pos++],v=(m&112)>>4;if(m<128||(m=u[o.pos++],v|=(m&127)<<3,m<128)||(m=u[o.pos++],v|=(m&127)<<10,m<128)||(m=u[o.pos++],v|=(m&127)<<17,m<128)||(m=u[o.pos++],v|=(m&127)<<24,m<128)||(m=u[o.pos++],v|=(m&1)<<31,m<128))return Y0(p,v);throw new Error("Expected varint not more than 10 bytes")}Yi(J0,"readVarintRemainder");function nh(p){let o=p.buf,u=o[p.pos++],m=u&127;return u<128||(u=o[p.pos++],m|=(u&127)<<7,u<128)||(u=o[p.pos++],m|=(u&127)<<14,u<128)||(u=o[p.pos++],m|=(u&127)<<21,u<128)?m:(u=o[p.pos],m|=(u&15)<<28,J0(m,p))}Yi(nh,"readVarint");function Qp(p,o,u,m){if(m===0){u===1&&(o[0]=p-1-o[0],o[1]=p-1-o[1]);let v=o[0];o[0]=o[1],o[1]=v}}Yi(Qp,"rotate");function K0(p,o){let u=Zh(2,p),m=o,v=o,x=o,b=[0,0],a=1;for(;a<u;)m=1&x/2,v=1&(x^m),Qp(a,b,m,v),b[0]+=a*m,b[1]+=a*v,x=x/4,a*=2;return[p,b[0],b[1]]}Yi(K0,"idOnLevel");var j5=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Q0(p,o,u){if(p>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(o>Zh(2,p)-1||u>Zh(2,p)-1)throw new Error("tile x/y outside zoom level bounds");let m=j5[p],v=Zh(2,p),x=0,b=0,a=0,C=[o,u],F=v/2;for(;F>0;)x=(C[0]&F)>0?1:0,b=(C[1]&F)>0?1:0,a+=F*F*(3*x^b),Qp(F,C,x,b),F=F/2;return m+a}Yi(Q0,"zxyToTileId");function U5(p){let o=0;for(let u=0;u<27;u++){let m=(1<<u)*(1<<u);if(o+m>p)return K0(u,p-o);o+=m}throw new Error("Tile zoom level exceeds max safe number limit (26)")}Yi(U5,"tileIdToZxy");var V5=(p=>(p[p.Unknown=0]="Unknown",p[p.None=1]="None",p[p.Gzip=2]="Gzip",p[p.Brotli=3]="Brotli",p[p.Zstd=4]="Zstd",p))(V5||{});function tf(p,o){return Es(this,null,function*(){if(o===1||o===0)return p;if(o===2){if(typeof globalThis.DecompressionStream>"u")return F5(new Uint8Array(p));let u=new Response(p).body;if(!u)throw new Error("Failed to read response stream");let m=u.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(m).arrayBuffer()}throw new Error("Compression method not supported")})}Yi(tf,"defaultDecompress");var q5=(p=>(p[p.Unknown=0]="Unknown",p[p.Mvt=1]="Mvt",p[p.Png=2]="Png",p[p.Jpeg=3]="Jpeg",p[p.Webp=4]="Webp",p[p.Avif=5]="Avif",p))(q5||{});function e1(p){return p===1?".mvt":p===2?".png":p===3?".jpg":p===4?".webp":p===5?".avif":""}Yi(e1,"tileTypeExt");var G5=127;function t1(p,o){let u=0,m=p.length-1;for(;u<=m;){let v=m+u>>1,x=o-p[v].tileId;if(x>0)u=v+1;else if(x<0)m=v-1;else return p[v]}return m>=0&&(p[m].runLength===0||o-p[m].tileId<p[m].runLength)?p[m]:null}Yi(t1,"findTile");var $5=class{constructor(o){this.file=o}getKey(){return this.file.name}getBytes(o,u){return Es(this,null,function*(){return{data:yield this.file.slice(o,o+u).arrayBuffer()}})}};Yi($5,"FileSource");var r1=class{constructor(o,u=new Headers){this.url=o,this.customHeaders=u,this.mustReload=!1;let m="";"navigator"in globalThis&&(m=globalThis.navigator.userAgent||"");let v=m.indexOf("Windows")>-1,x=/Chrome|Chromium|Edg|OPR|Brave/.test(m);this.chromeWindowsNoCache=!1,v&&x&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(o){this.customHeaders=o}getBytes(o,u,m,v){return Es(this,null,function*(){let x,b;m?b=m:(x=new AbortController,b=x.signal);let a=new Headers(this.customHeaders);a.set("range",`bytes=${o}-${o+u-1}`);let C;this.mustReload?C="reload":this.chromeWindowsNoCache&&(C="no-store");let F=yield fetch(this.url,{signal:b,cache:C,headers:a});if(o===0&&F.status===416){let ee=F.headers.get("Content-Range");if(!ee||!ee.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let j=+ee.substr(8);F=yield fetch(this.url,{signal:b,cache:"reload",headers:{range:`bytes=0-${j-1}`}})}let O=F.headers.get("Etag");if(O!=null&&O.startsWith("W/")&&(O=null),F.status===416||v&&O&&O!==v)throw this.mustReload=!0,new $p(`Server returned non-matching ETag ${v} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(F.status>=300)throw new Error(`Bad response code: ${F.status}`);let Y=F.headers.get("Content-Length");if(F.status===200&&(!Y||+Y>u))throw x&&x.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield F.arrayBuffer(),etag:O||void 0,cacheControl:F.headers.get("Cache-Control")||void 0,expires:F.headers.get("Expires")||void 0}})}};Yi(r1,"FetchSource");var Z5=r1;function Mo(p,o){let u=p.getUint32(o+4,!0),m=p.getUint32(o+0,!0);return u*Zh(2,32)+m}Yi(Mo,"getUint64");function i1(p,o){let u=new DataView(p),m=u.getUint8(7);if(m>3)throw new Error(`Archive is spec version ${m} but this library supports up to spec version 3`);return{specVersion:m,rootDirectoryOffset:Mo(u,8),rootDirectoryLength:Mo(u,16),jsonMetadataOffset:Mo(u,24),jsonMetadataLength:Mo(u,32),leafDirectoryOffset:Mo(u,40),leafDirectoryLength:Mo(u,48),tileDataOffset:Mo(u,56),tileDataLength:Mo(u,64),numAddressedTiles:Mo(u,72),numTileEntries:Mo(u,80),numTileContents:Mo(u,88),clustered:u.getUint8(96)===1,internalCompression:u.getUint8(97),tileCompression:u.getUint8(98),tileType:u.getUint8(99),minZoom:u.getUint8(100),maxZoom:u.getUint8(101),minLon:u.getInt32(102,!0)/1e7,minLat:u.getInt32(106,!0)/1e7,maxLon:u.getInt32(110,!0)/1e7,maxLat:u.getInt32(114,!0)/1e7,centerZoom:u.getUint8(118),centerLon:u.getInt32(119,!0)/1e7,centerLat:u.getInt32(123,!0)/1e7,etag:o}}Yi(i1,"bytesToHeader");function em(p){let o={buf:new Uint8Array(p),pos:0},u=nh(o),m=[],v=0;for(let x=0;x<u;x++){let b=nh(o);m.push({tileId:v+b,offset:0,length:0,runLength:1}),v+=b}for(let x=0;x<u;x++)m[x].runLength=nh(o);for(let x=0;x<u;x++)m[x].length=nh(o);for(let x=0;x<u;x++){let b=nh(o);b===0&&x>0?m[x].offset=m[x-1].offset+m[x-1].length:m[x].offset=b-1}return m}Yi(em,"deserializeIndex");var n1=class extends Error{};Yi(n1,"EtagMismatch");var $p=n1;function tm(p,o){return Es(this,null,function*(){let u=yield p.getBytes(0,16384);if(new DataView(u.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let m=u.data.slice(0,G5),v=i1(m,u.etag),x=u.data.slice(v.rootDirectoryOffset,v.rootDirectoryOffset+v.rootDirectoryLength),b=`${p.getKey()}|${v.etag||""}|${v.rootDirectoryOffset}|${v.rootDirectoryLength}`,a=em(yield o(x,v.internalCompression));return[v,[b,a.length,a]]})}Yi(tm,"getHeaderAndRoot");function rm(p,o,u,m,v){return Es(this,null,function*(){let x=yield p.getBytes(u,m,void 0,v.etag),b=yield o(x.data,v.internalCompression),a=em(b);if(a.length===0)throw new Error("Empty directory is invalid");return a})}Yi(rm,"getDirectory");var W5=class{constructor(o=100,u=!0,m=tf){this.cache=new Map,this.maxCacheEntries=o,this.counter=1,this.decompress=m}getHeader(o){return Es(this,null,function*(){let u=o.getKey(),m=this.cache.get(u);if(m)return m.lastUsed=this.counter++,m.data;let v=yield tm(o,this.decompress);return v[1]&&this.cache.set(v[1][0],{lastUsed:this.counter++,data:v[1][2]}),this.cache.set(u,{lastUsed:this.counter++,data:v[0]}),this.prune(),v[0]})}getDirectory(o,u,m,v){return Es(this,null,function*(){let x=`${o.getKey()}|${v.etag||""}|${u}|${m}`,b=this.cache.get(x);if(b)return b.lastUsed=this.counter++,b.data;let a=yield rm(o,this.decompress,u,m,v);return this.cache.set(x,{lastUsed:this.counter++,data:a}),this.prune(),a})}prune(){if(this.cache.size>this.maxCacheEntries){let o=1/0,u;this.cache.forEach((m,v)=>{m.lastUsed<o&&(o=m.lastUsed,u=v)}),u&&this.cache.delete(u)}}invalidate(o){return Es(this,null,function*(){this.cache.delete(o.getKey())})}};Yi(W5,"ResolvedValueCache");var s1=class{constructor(o=100,u=!0,m=tf){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=o,this.counter=1,this.decompress=m}getHeader(o){return Es(this,null,function*(){let u=o.getKey(),m=this.cache.get(u);if(m)return m.lastUsed=this.counter++,yield m.data;let v=new Promise((x,b)=>{tm(o,this.decompress).then(a=>{a[1]&&this.cache.set(a[1][0],{lastUsed:this.counter++,data:Promise.resolve(a[1][2])}),x(a[0]),this.prune()}).catch(a=>{b(a)})});return this.cache.set(u,{lastUsed:this.counter++,data:v}),v})}getDirectory(o,u,m,v){return Es(this,null,function*(){let x=`${o.getKey()}|${v.etag||""}|${u}|${m}`,b=this.cache.get(x);if(b)return b.lastUsed=this.counter++,yield b.data;let a=new Promise((C,F)=>{rm(o,this.decompress,u,m,v).then(O=>{C(O),this.prune()}).catch(O=>{F(O)})});return this.cache.set(x,{lastUsed:this.counter++,data:a}),a})}prune(){if(this.cache.size>=this.maxCacheEntries){let o=1/0,u;this.cache.forEach((m,v)=>{m.lastUsed<o&&(o=m.lastUsed,u=v)}),u&&this.cache.delete(u)}}invalidate(o){return Es(this,null,function*(){let u=o.getKey();if(this.invalidations.get(u))return yield this.invalidations.get(u);this.cache.delete(o.getKey());let m=new Promise((v,x)=>{this.getHeader(o).then(b=>{v(),this.invalidations.delete(u)}).catch(b=>{x(b)})});this.invalidations.set(u,m)})}};Yi(s1,"SharedPromiseCache");var H5=s1,a1=class{constructor(o,u,m){typeof o=="string"?this.source=new Z5(o):this.source=o,m?this.decompress=m:this.decompress=tf,u?this.cache=u:this.cache=new H5}getHeader(){return Es(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(o,u,m,v){return Es(this,null,function*(){let x=Q0(o,u,m),b=yield this.cache.getHeader(this.source);if(o<b.minZoom||o>b.maxZoom)return;let a=b.rootDirectoryOffset,C=b.rootDirectoryLength;for(let F=0;F<=3;F++){let O=yield this.cache.getDirectory(this.source,a,C,b),Y=t1(O,x);if(Y){if(Y.runLength>0){let ee=yield this.source.getBytes(b.tileDataOffset+Y.offset,Y.length,v,b.etag);return{data:yield this.decompress(ee.data,b.tileCompression),cacheControl:ee.cacheControl,expires:ee.expires}}a=b.leafDirectoryOffset+Y.offset,C=Y.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(o,u,m,v){return Es(this,null,function*(){try{return yield this.getZxyAttempt(o,u,m,v)}catch(x){if(x instanceof $p)return this.cache.invalidate(this.source),yield this.getZxyAttempt(o,u,m,v);throw x}})}getMetadataAttempt(){return Es(this,null,function*(){let o=yield this.cache.getHeader(this.source),u=yield this.source.getBytes(o.jsonMetadataOffset,o.jsonMetadataLength,void 0,o.etag),m=yield this.decompress(u.data,o.internalCompression),v=new TextDecoder("utf-8");return JSON.parse(v.decode(m))})}getMetadata(){return Es(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(o){if(o instanceof $p)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw o}})}getTileJson(o){return Es(this,null,function*(){let u=yield this.getHeader(),m=yield this.getMetadata(),v=e1(u.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${o}/{z}/{x}/{y}${v}`],vector_layers:m.vector_layers,attribution:m.attribution,description:m.description,name:m.name,version:m.version,bounds:[u.minLon,u.minLat,u.maxLon,u.maxLat],center:[u.centerLon,u.centerLat,u.centerZoom],minzoom:u.minZoom,maxzoom:u.maxZoom}})}};Yi(a1,"PMTiles");var jy=a1,Uh={exports:{}},X5=Uh.exports,Uy;function Y5(){return Uy||(Uy=1,function(p,o){(function(u,m){m(o)})(X5,function(u){const m=new Uint8Array([102,103,98,3,102,103,98,0]),v=new Int32Array(2),x=new Float32Array(v.buffer),b=new Float64Array(v.buffer),a=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var C,F;(function(te){te[te.UTF8_BYTES=1]="UTF8_BYTES",te[te.UTF16_STRING=2]="UTF16_STRING"})(C||(C={}));class O{constructor(I){this.bytes_=I,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(I){return new O(new Uint8Array(I))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(I){this.position_=I}capacity(){return this.bytes_.length}readInt8(I){return this.readUint8(I)<<24>>24}readUint8(I){return this.bytes_[I]}readInt16(I){return this.readUint16(I)<<16>>16}readUint16(I){return this.bytes_[I]|this.bytes_[I+1]<<8}readInt32(I){return this.bytes_[I]|this.bytes_[I+1]<<8|this.bytes_[I+2]<<16|this.bytes_[I+3]<<24}readUint32(I){return this.readInt32(I)>>>0}readInt64(I){return BigInt.asIntN(64,BigInt(this.readUint32(I))+(BigInt(this.readUint32(I+4))<<BigInt(32)))}readUint64(I){return BigInt.asUintN(64,BigInt(this.readUint32(I))+(BigInt(this.readUint32(I+4))<<BigInt(32)))}readFloat32(I){return v[0]=this.readInt32(I),x[0]}readFloat64(I){return v[a?0:1]=this.readInt32(I),v[a?1:0]=this.readInt32(I+4),b[0]}writeInt8(I,D){this.bytes_[I]=D}writeUint8(I,D){this.bytes_[I]=D}writeInt16(I,D){this.bytes_[I]=D,this.bytes_[I+1]=D>>8}writeUint16(I,D){this.bytes_[I]=D,this.bytes_[I+1]=D>>8}writeInt32(I,D){this.bytes_[I]=D,this.bytes_[I+1]=D>>8,this.bytes_[I+2]=D>>16,this.bytes_[I+3]=D>>24}writeUint32(I,D){this.bytes_[I]=D,this.bytes_[I+1]=D>>8,this.bytes_[I+2]=D>>16,this.bytes_[I+3]=D>>24}writeInt64(I,D){this.writeInt32(I,Number(BigInt.asIntN(32,D))),this.writeInt32(I+4,Number(BigInt.asIntN(32,D>>BigInt(32))))}writeUint64(I,D){this.writeUint32(I,Number(BigInt.asUintN(32,D))),this.writeUint32(I+4,Number(BigInt.asUintN(32,D>>BigInt(32))))}writeFloat32(I,D){x[0]=D,this.writeInt32(I,v[0])}writeFloat64(I,D){b[0]=D,this.writeInt32(I,v[a?0:1]),this.writeInt32(I+4,v[a?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+4+4)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let I="";for(let D=0;D<4;D++)I+=String.fromCharCode(this.readInt8(this.position_+4+D));return I}__offset(I,D){const fe=I-this.readInt32(I);return D<this.readInt16(fe)?this.readInt16(fe+D):0}__union(I,D){return I.bb_pos=D+this.readInt32(D),I.bb=this,I}__string(I,D){I+=this.readInt32(I);const fe=this.readInt32(I);I+=4;const Ee=this.bytes_.subarray(I,I+fe);return D===C.UTF8_BYTES?Ee:this.text_decoder_.decode(Ee)}__union_with_string(I,D){return typeof I=="string"?this.__string(D):this.__union(I,D)}__indirect(I){return I+this.readInt32(I)}__vector(I){return I+this.readInt32(I)+4}__vector_len(I){return this.readInt32(I+this.readInt32(I))}__has_identifier(I){if(I.length!=4)throw new Error("FlatBuffers: file identifier must be length 4");for(let D=0;D<4;D++)if(I.charCodeAt(D)!=this.readInt8(this.position()+4+D))return!1;return!0}createScalarList(I,D){const fe=[];for(let Ee=0;Ee<D;++Ee){const qe=I(Ee);qe!==null&&fe.push(qe)}return fe}createObjList(I,D){const fe=[];for(let Ee=0;Ee<D;++Ee){const qe=I(Ee);qe!==null&&fe.push(qe.unpack())}return fe}}class Y{constructor(I){let D;this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder,D=I||1024,this.bb=O.allocate(D),this.space=D}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(I){this.force_defaults=I}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(I,D){I>this.minalign&&(this.minalign=I);const fe=1+~(this.bb.capacity()-this.space+D)&I-1;for(;this.space<fe+I+D;){const Ee=this.bb.capacity();this.bb=Y.growByteBuffer(this.bb),this.space+=this.bb.capacity()-Ee}this.pad(fe)}pad(I){for(let D=0;D<I;D++)this.bb.writeInt8(--this.space,0)}writeInt8(I){this.bb.writeInt8(this.space-=1,I)}writeInt16(I){this.bb.writeInt16(this.space-=2,I)}writeInt32(I){this.bb.writeInt32(this.space-=4,I)}writeInt64(I){this.bb.writeInt64(this.space-=8,I)}writeFloat32(I){this.bb.writeFloat32(this.space-=4,I)}writeFloat64(I){this.bb.writeFloat64(this.space-=8,I)}addInt8(I){this.prep(1,0),this.writeInt8(I)}addInt16(I){this.prep(2,0),this.writeInt16(I)}addInt32(I){this.prep(4,0),this.writeInt32(I)}addInt64(I){this.prep(8,0),this.writeInt64(I)}addFloat32(I){this.prep(4,0),this.writeFloat32(I)}addFloat64(I){this.prep(8,0),this.writeFloat64(I)}addFieldInt8(I,D,fe){(this.force_defaults||D!=fe)&&(this.addInt8(D),this.slot(I))}addFieldInt16(I,D,fe){(this.force_defaults||D!=fe)&&(this.addInt16(D),this.slot(I))}addFieldInt32(I,D,fe){(this.force_defaults||D!=fe)&&(this.addInt32(D),this.slot(I))}addFieldInt64(I,D,fe){(this.force_defaults||D!==fe)&&(this.addInt64(D),this.slot(I))}addFieldFloat32(I,D,fe){(this.force_defaults||D!=fe)&&(this.addFloat32(D),this.slot(I))}addFieldFloat64(I,D,fe){(this.force_defaults||D!=fe)&&(this.addFloat64(D),this.slot(I))}addFieldOffset(I,D,fe){(this.force_defaults||D!=fe)&&(this.addOffset(D),this.slot(I))}addFieldStruct(I,D,fe){D!=fe&&(this.nested(D),this.slot(I))}nested(I){if(I!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(I){this.vtable!==null&&(this.vtable[I]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(I){const D=I.capacity();if(3221225472&D)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const fe=D<<1,Ee=O.allocate(fe);return Ee.setPosition(fe-D),Ee.bytes().set(I.bytes(),fe-D),Ee}addOffset(I){this.prep(4,0),this.writeInt32(this.offset()-I+4)}startObject(I){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=I;for(let D=0;D<I;D++)this.vtable[D]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const I=this.offset();let D=this.vtable_in_use-1;for(;D>=0&&this.vtable[D]==0;D--);const fe=D+1;for(;D>=0;D--)this.addInt16(this.vtable[D]!=0?I-this.vtable[D]:0);this.addInt16(I-this.object_start);const Ee=2*(fe+2);this.addInt16(Ee);let qe=0;const ae=this.space;e:for(D=0;D<this.vtables.length;D++){const ft=this.bb.capacity()-this.vtables[D];if(Ee==this.bb.readInt16(ft)){for(let Nt=2;Nt<Ee;Nt+=2)if(this.bb.readInt16(ae+Nt)!=this.bb.readInt16(ft+Nt))continue e;qe=this.vtables[D];break}}return qe?(this.space=this.bb.capacity()-I,this.bb.writeInt32(this.space,qe-I)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-I,this.offset()-I)),this.isNested=!1,I}finish(I,D,fe){const Ee=fe?4:0;if(D){const qe=D;if(this.prep(this.minalign,8+Ee),qe.length!=4)throw new TypeError("FlatBuffers: file identifier must be length 4");for(let ae=3;ae>=0;ae--)this.writeInt8(qe.charCodeAt(ae))}this.prep(this.minalign,4+Ee),this.addOffset(I),Ee&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(I,D){this.finish(I,D,!0)}requiredField(I,D){const fe=this.bb.capacity()-I,Ee=fe-this.bb.readInt32(fe);if(!(D<this.bb.readInt16(Ee)&&this.bb.readInt16(Ee+D)!=0))throw new TypeError("FlatBuffers: field "+D+" must be set")}startVector(I,D,fe){this.notNested(),this.vector_num_elems=D,this.prep(4,I*D),this.prep(fe,I*D)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(I){if(!I)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(I))return this.string_maps.get(I);const D=this.createString(I);return this.string_maps.set(I,D),D}createString(I){if(I==null)return 0;let D;return D=I instanceof Uint8Array?I:this.text_encoder.encode(I),this.addInt8(0),this.startVector(1,D.length,1),this.bb.setPosition(this.space-=D.length),this.bb.bytes().set(D,this.space),this.endVector()}createByteVector(I){return I==null?0:(this.startVector(1,I.length,1),this.bb.setPosition(this.space-=I.length),this.bb.bytes().set(I,this.space),this.endVector())}createObjectOffset(I){return I===null?0:typeof I=="string"?this.createString(I):I.pack(this)}createObjectOffsetList(I){const D=[];for(let fe=0;fe<I.length;++fe){const Ee=I[fe];if(Ee===null)throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.");D.push(this.createObjectOffset(Ee))}return D}createStructOffsetList(I,D){return D(this,I.length),this.createObjectOffsetList(I.slice().reverse()),this.endVector()}}var ee,j=((F={})[F.Byte=0]="Byte",F[F.UByte=1]="UByte",F[F.Bool=2]="Bool",F[F.Short=3]="Short",F[F.UShort=4]="UShort",F[F.Int=5]="Int",F[F.UInt=6]="UInt",F[F.Long=7]="Long",F[F.ULong=8]="ULong",F[F.Float=9]="Float",F[F.Double=10]="Double",F[F.String=11]="String",F[F.Json=12]="Json",F[F.DateTime=13]="DateTime",F[F.Binary=14]="Binary",F);class Pe{bb=null;bb_pos=0;__init(I,D){return this.bb_pos=I,this.bb=D,this}static getRootAsColumn(I,D){return(D||new Pe).__init(I.readInt32(I.position())+I.position(),I)}static getSizePrefixedRootAsColumn(I,D){return I.setPosition(I.position()+4),(D||new Pe).__init(I.readInt32(I.position())+I.position(),I)}name(I){let D=this.bb.__offset(this.bb_pos,4);return D?this.bb.__string(this.bb_pos+D,I):null}type(){let I=this.bb.__offset(this.bb_pos,6);return I?this.bb.readUint8(this.bb_pos+I):j.Byte}title(I){let D=this.bb.__offset(this.bb_pos,8);return D?this.bb.__string(this.bb_pos+D,I):null}description(I){let D=this.bb.__offset(this.bb_pos,10);return D?this.bb.__string(this.bb_pos+D,I):null}width(){let I=this.bb.__offset(this.bb_pos,12);return I?this.bb.readInt32(this.bb_pos+I):-1}precision(){let I=this.bb.__offset(this.bb_pos,14);return I?this.bb.readInt32(this.bb_pos+I):-1}scale(){let I=this.bb.__offset(this.bb_pos,16);return I?this.bb.readInt32(this.bb_pos+I):-1}nullable(){let I=this.bb.__offset(this.bb_pos,18);return!I||!!this.bb.readInt8(this.bb_pos+I)}unique(){let I=this.bb.__offset(this.bb_pos,20);return!!I&&!!this.bb.readInt8(this.bb_pos+I)}primaryKey(){let I=this.bb.__offset(this.bb_pos,22);return!!I&&!!this.bb.readInt8(this.bb_pos+I)}metadata(I){let D=this.bb.__offset(this.bb_pos,24);return D?this.bb.__string(this.bb_pos+D,I):null}static startColumn(I){I.startObject(11)}static addName(I,D){I.addFieldOffset(0,D,0)}static addType(I,D){I.addFieldInt8(1,D,j.Byte)}static addTitle(I,D){I.addFieldOffset(2,D,0)}static addDescription(I,D){I.addFieldOffset(3,D,0)}static addWidth(I,D){I.addFieldInt32(4,D,-1)}static addPrecision(I,D){I.addFieldInt32(5,D,-1)}static addScale(I,D){I.addFieldInt32(6,D,-1)}static addNullable(I,D){I.addFieldInt8(7,+D,1)}static addUnique(I,D){I.addFieldInt8(8,+D,0)}static addPrimaryKey(I,D){I.addFieldInt8(9,+D,0)}static addMetadata(I,D){I.addFieldOffset(10,D,0)}static endColumn(I){let D=I.endObject();return I.requiredField(D,4),D}static createColumn(I,D,fe,Ee,qe,ae,ft,Nt,gt,Lt,Ht,Mt){return Pe.startColumn(I),Pe.addName(I,D),Pe.addType(I,fe),Pe.addTitle(I,Ee),Pe.addDescription(I,qe),Pe.addWidth(I,ae),Pe.addPrecision(I,ft),Pe.addScale(I,Nt),Pe.addNullable(I,gt),Pe.addUnique(I,Lt),Pe.addPrimaryKey(I,Ht),Pe.addMetadata(I,Mt),Pe.endColumn(I)}}var ce=((ee={})[ee.Unknown=0]="Unknown",ee[ee.Point=1]="Point",ee[ee.LineString=2]="LineString",ee[ee.Polygon=3]="Polygon",ee[ee.MultiPoint=4]="MultiPoint",ee[ee.MultiLineString=5]="MultiLineString",ee[ee.MultiPolygon=6]="MultiPolygon",ee[ee.GeometryCollection=7]="GeometryCollection",ee[ee.CircularString=8]="CircularString",ee[ee.CompoundCurve=9]="CompoundCurve",ee[ee.CurvePolygon=10]="CurvePolygon",ee[ee.MultiCurve=11]="MultiCurve",ee[ee.MultiSurface=12]="MultiSurface",ee[ee.Curve=13]="Curve",ee[ee.Surface=14]="Surface",ee[ee.PolyhedralSurface=15]="PolyhedralSurface",ee[ee.TIN=16]="TIN",ee[ee.Triangle=17]="Triangle",ee);class Q{bb=null;bb_pos=0;__init(I,D){return this.bb_pos=I,this.bb=D,this}static getRootAsGeometry(I,D){return(D||new Q).__init(I.readInt32(I.position())+I.position(),I)}static getSizePrefixedRootAsGeometry(I,D){return I.setPosition(I.position()+4),(D||new Q).__init(I.readInt32(I.position())+I.position(),I)}ends(I){let D=this.bb.__offset(this.bb_pos,4);return D?this.bb.readUint32(this.bb.__vector(this.bb_pos+D)+4*I):0}endsLength(){let I=this.bb.__offset(this.bb_pos,4);return I?this.bb.__vector_len(this.bb_pos+I):0}endsArray(){let I=this.bb.__offset(this.bb_pos,4);return I?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+I),this.bb.__vector_len(this.bb_pos+I)):null}xy(I){let D=this.bb.__offset(this.bb_pos,6);return D?this.bb.readFloat64(this.bb.__vector(this.bb_pos+D)+8*I):0}xyLength(){let I=this.bb.__offset(this.bb_pos,6);return I?this.bb.__vector_len(this.bb_pos+I):0}xyArray(){let I=this.bb.__offset(this.bb_pos,6);return I?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+I),this.bb.__vector_len(this.bb_pos+I)):null}z(I){let D=this.bb.__offset(this.bb_pos,8);return D?this.bb.readFloat64(this.bb.__vector(this.bb_pos+D)+8*I):0}zLength(){let I=this.bb.__offset(this.bb_pos,8);return I?this.bb.__vector_len(this.bb_pos+I):0}zArray(){let I=this.bb.__offset(this.bb_pos,8);return I?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+I),this.bb.__vector_len(this.bb_pos+I)):null}m(I){let D=this.bb.__offset(this.bb_pos,10);return D?this.bb.readFloat64(this.bb.__vector(this.bb_pos+D)+8*I):0}mLength(){let I=this.bb.__offset(this.bb_pos,10);return I?this.bb.__vector_len(this.bb_pos+I):0}mArray(){let I=this.bb.__offset(this.bb_pos,10);return I?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+I),this.bb.__vector_len(this.bb_pos+I)):null}t(I){let D=this.bb.__offset(this.bb_pos,12);return D?this.bb.readFloat64(this.bb.__vector(this.bb_pos+D)+8*I):0}tLength(){let I=this.bb.__offset(this.bb_pos,12);return I?this.bb.__vector_len(this.bb_pos+I):0}tArray(){let I=this.bb.__offset(this.bb_pos,12);return I?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+I),this.bb.__vector_len(this.bb_pos+I)):null}tm(I){let D=this.bb.__offset(this.bb_pos,14);return D?this.bb.readUint64(this.bb.__vector(this.bb_pos+D)+8*I):BigInt(0)}tmLength(){let I=this.bb.__offset(this.bb_pos,14);return I?this.bb.__vector_len(this.bb_pos+I):0}type(){let I=this.bb.__offset(this.bb_pos,16);return I?this.bb.readUint8(this.bb_pos+I):ce.Unknown}parts(I,D){let fe=this.bb.__offset(this.bb_pos,18);return fe?(D||new Q).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+fe)+4*I),this.bb):null}partsLength(){let I=this.bb.__offset(this.bb_pos,18);return I?this.bb.__vector_len(this.bb_pos+I):0}static startGeometry(I){I.startObject(8)}static addEnds(I,D){I.addFieldOffset(0,D,0)}static createEndsVector(I,D){I.startVector(4,D.length,4);for(let fe=D.length-1;fe>=0;fe--)I.addInt32(D[fe]);return I.endVector()}static startEndsVector(I,D){I.startVector(4,D,4)}static addXy(I,D){I.addFieldOffset(1,D,0)}static createXyVector(I,D){I.startVector(8,D.length,8);for(let fe=D.length-1;fe>=0;fe--)I.addFloat64(D[fe]);return I.endVector()}static startXyVector(I,D){I.startVector(8,D,8)}static addZ(I,D){I.addFieldOffset(2,D,0)}static createZVector(I,D){I.startVector(8,D.length,8);for(let fe=D.length-1;fe>=0;fe--)I.addFloat64(D[fe]);return I.endVector()}static startZVector(I,D){I.startVector(8,D,8)}static addM(I,D){I.addFieldOffset(3,D,0)}static createMVector(I,D){I.startVector(8,D.length,8);for(let fe=D.length-1;fe>=0;fe--)I.addFloat64(D[fe]);return I.endVector()}static startMVector(I,D){I.startVector(8,D,8)}static addT(I,D){I.addFieldOffset(4,D,0)}static createTVector(I,D){I.startVector(8,D.length,8);for(let fe=D.length-1;fe>=0;fe--)I.addFloat64(D[fe]);return I.endVector()}static startTVector(I,D){I.startVector(8,D,8)}static addTm(I,D){I.addFieldOffset(5,D,0)}static createTmVector(I,D){I.startVector(8,D.length,8);for(let fe=D.length-1;fe>=0;fe--)I.addInt64(D[fe]);return I.endVector()}static startTmVector(I,D){I.startVector(8,D,8)}static addType(I,D){I.addFieldInt8(6,D,ce.Unknown)}static addParts(I,D){I.addFieldOffset(7,D,0)}static createPartsVector(I,D){I.startVector(4,D.length,4);for(let fe=D.length-1;fe>=0;fe--)I.addOffset(D[fe]);return I.endVector()}static startPartsVector(I,D){I.startVector(4,D,4)}static endGeometry(I){return I.endObject()}static createGeometry(I,D,fe,Ee,qe,ae,ft,Nt,gt){return Q.startGeometry(I),Q.addEnds(I,D),Q.addXy(I,fe),Q.addZ(I,Ee),Q.addM(I,qe),Q.addT(I,ae),Q.addTm(I,ft),Q.addType(I,Nt),Q.addParts(I,gt),Q.endGeometry(I)}}class ge{bb=null;bb_pos=0;__init(I,D){return this.bb_pos=I,this.bb=D,this}static getRootAsFeature(I,D){return(D||new ge).__init(I.readInt32(I.position())+I.position(),I)}static getSizePrefixedRootAsFeature(I,D){return I.setPosition(I.position()+4),(D||new ge).__init(I.readInt32(I.position())+I.position(),I)}geometry(I){let D=this.bb.__offset(this.bb_pos,4);return D?(I||new Q).__init(this.bb.__indirect(this.bb_pos+D),this.bb):null}properties(I){let D=this.bb.__offset(this.bb_pos,6);return D?this.bb.readUint8(this.bb.__vector(this.bb_pos+D)+I):0}propertiesLength(){let I=this.bb.__offset(this.bb_pos,6);return I?this.bb.__vector_len(this.bb_pos+I):0}propertiesArray(){let I=this.bb.__offset(this.bb_pos,6);return I?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+I),this.bb.__vector_len(this.bb_pos+I)):null}columns(I,D){let fe=this.bb.__offset(this.bb_pos,8);return fe?(D||new Pe).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+fe)+4*I),this.bb):null}columnsLength(){let I=this.bb.__offset(this.bb_pos,8);return I?this.bb.__vector_len(this.bb_pos+I):0}static startFeature(I){I.startObject(3)}static addGeometry(I,D){I.addFieldOffset(0,D,0)}static addProperties(I,D){I.addFieldOffset(1,D,0)}static createPropertiesVector(I,D){I.startVector(1,D.length,1);for(let fe=D.length-1;fe>=0;fe--)I.addInt8(D[fe]);return I.endVector()}static startPropertiesVector(I,D){I.startVector(1,D,1)}static addColumns(I,D){I.addFieldOffset(2,D,0)}static createColumnsVector(I,D){I.startVector(4,D.length,4);for(let fe=D.length-1;fe>=0;fe--)I.addOffset(D[fe]);return I.endVector()}static startColumnsVector(I,D){I.startVector(4,D,4)}static endFeature(I){return I.endObject()}static finishFeatureBuffer(I,D){I.finish(D)}static finishSizePrefixedFeatureBuffer(I,D){I.finish(D,void 0,!0)}static createFeature(I,D,fe,Ee){return ge.startFeature(I),ge.addGeometry(I,D),ge.addProperties(I,fe),ge.addColumns(I,Ee),ge.endFeature(I)}}function Qe(te,I){let D,fe,Ee,{xy:qe,z:ae,m:ft,ends:Nt,parts:gt,type:Lt}=I;if(gt){let Mt=gt.map(Ut=>Qe(te,Ut)),rr=Q.createPartsVector(te,Mt);return Q.startGeometry(te),Q.addParts(te,rr),Q.addType(te,Lt),Q.endGeometry(te)}let Ht=Q.createXyVector(te,qe);return ae&&(D=Q.createZVector(te,ae)),ft&&(fe=Q.createMVector(te,ft)),Nt&&(Ee=Q.createEndsVector(te,Nt)),Q.startGeometry(te),Ee&&Q.addEnds(te,Ee),Q.addXy(te,Ht),D&&Q.addZ(te,D),fe&&Q.addM(te,fe),Q.addType(te,Lt),Q.endGeometry(te)}function Oe(te,I,D){if(te.length!==0)if(Array.isArray(te[0]))for(let fe of te)Oe(fe,I,D);else te.length===2?I.push(...te):(I.push(te[0],te[1]),D.push(te[2]))}function Me(te,I){let D=[];for(let fe=0;fe<te.length;fe+=2){let Ee=[te[fe],te[fe+1]];I&&Ee.push(I[fe>>1]),D.push(Ee)}return D}function Ge(te){return te?ce[te]:ce.Unknown}let Ze=new TextEncoder,it=new TextDecoder;function He(te,I,D){let fe=D.columns,Ee=new Y,qe=0,ae=1024,ft=new Uint8Array(1024),Nt=new DataView(ft.buffer),gt=rr=>{if(qe+rr<ae)return;let Ut=new Uint8Array(ae=Math.max(ae+rr,2*ae));Ut.set(ft),Nt=new DataView((ft=Ut).buffer)};if(fe)for(let rr=0;rr<fe.length;rr++){let Ut=fe[rr],gr=I[Ut.name];if(gr!==null)switch(gt(2),Nt.setUint16(qe,rr,!0),qe+=2,Ut.type){case j.Bool:gt(1),Nt.setUint8(qe,gr),qe+=1;break;case j.Short:gt(2),Nt.setInt16(qe,gr,!0),qe+=2;break;case j.UShort:gt(2),Nt.setUint16(qe,gr,!0),qe+=2;break;case j.Int:gt(4),Nt.setInt32(qe,gr,!0),qe+=4;break;case j.UInt:gt(4),Nt.setUint32(qe,gr,!0),qe+=4;break;case j.Long:gt(8),Nt.setBigInt64(qe,BigInt(gr),!0),qe+=8;break;case j.Float:gt(4),Nt.setFloat32(qe,gr,!0),qe+=4;break;case j.Double:gt(8),Nt.setFloat64(qe,gr,!0),qe+=8;break;case j.DateTime:case j.String:{let Xr=Ze.encode(gr);gt(4),Nt.setUint32(qe,Xr.length,!0),qe+=4,gt(Xr.length),ft.set(Xr,qe),qe+=Xr.length;break}case j.Json:{let Xr=Ze.encode(JSON.stringify(gr));gt(4),Nt.setUint32(qe,Xr.length,!0),qe+=4,gt(Xr.length),ft.set(Xr,qe),qe+=Xr.length;break}case j.Binary:gt(4),Nt.setUint32(qe,gr.length,!0),qe+=4,gt(gr.length),ft.set(gr,qe),qe+=gr.length;break;default:throw Error(`Unknown type ${Ut.type}`)}}let Lt=0;qe>0&&(Lt=ge.createPropertiesVector(Ee,ft.slice(0,qe)));let Ht=Qe(Ee,te);ge.startFeature(Ee),ge.addGeometry(Ee,Ht),Lt&&ge.addProperties(Ee,Lt);let Mt=ge.endFeature(Ee);return Ee.finishSizePrefixed(Mt),Ee.asUint8Array()}function Te(te,I){let D={};if(!I||I.length===0)return D;let fe=te.propertiesArray();if(!fe)return D;let Ee=new DataView(fe.buffer,fe.byteOffset),qe=te.propertiesLength(),ae=0;for(;ae<qe;){let ft=Ee.getUint16(ae,!0);ae+=2;let Nt=I[ft],gt=Nt.name;switch(Nt.type){case j.Bool:D[gt]=!!Ee.getUint8(ae),ae+=1;break;case j.Byte:D[gt]=Ee.getInt8(ae),ae+=1;break;case j.UByte:D[gt]=Ee.getUint8(ae),ae+=1;break;case j.Short:D[gt]=Ee.getInt16(ae,!0),ae+=2;break;case j.UShort:D[gt]=Ee.getUint16(ae,!0),ae+=2;break;case j.Int:D[gt]=Ee.getInt32(ae,!0),ae+=4;break;case j.UInt:D[gt]=Ee.getUint32(ae,!0),ae+=4;break;case j.Long:D[gt]=Number(Ee.getBigInt64(ae,!0)),ae+=8;break;case j.ULong:D[gt]=Number(Ee.getBigUint64(ae,!0)),ae+=8;break;case j.Float:D[gt]=Ee.getFloat32(ae,!0),ae+=4;break;case j.Double:D[gt]=Ee.getFloat64(ae,!0),ae+=8;break;case j.DateTime:case j.String:{let Lt=Ee.getUint32(ae,!0);ae+=4,D[gt]=it.decode(fe.subarray(ae,ae+Lt)),ae+=Lt;break}case j.Json:{let Lt=Ee.getUint32(ae,!0);ae+=4;let Ht=it.decode(fe.subarray(ae,ae+Lt));D[gt]=JSON.parse(Ht),ae+=Lt;break}case j.Binary:{let Lt=Ee.getUint32(ae,!0);ae+=4,D[gt]=fe.subarray(ae,ae+Lt),ae+=Lt;break}default:throw Error(`Unknown type ${Nt.type}`)}}return D}var st=new Uint8Array(0);function me(te,I){if(!te.length)return I;if(!I.length)return te;var D=new Uint8Array(te.length+I.length);return D.set(te),D.set(I,te.length),D}function xe(te){this._source=te,this._array=st,this._index=0}xe.prototype.read=function(){var te=this,I=te._array.subarray(te._index);return te._source.read().then(function(D){return te._array=st,te._index=0,D.done?I.length>0?{done:!1,value:I}:{done:!0,value:void 0}:{done:!1,value:me(I,D.value)}})},xe.prototype.slice=function(te){if((te|=0)<0)throw new Error("invalid length");var I=this,D=this._array.length-this._index;if(this._index+te<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=te));var fe=new Uint8Array(te);return fe.set(this._array.subarray(this._index)),function Ee(){return I._source.read().then(function(qe){return qe.done?(I._array=st,I._index=0,D>0?fe.subarray(0,D):null):D+qe.value.length>=te?(I._array=qe.value,I._index=te-D,fe.set(qe.value.subarray(0,te-D),D),fe):(fe.set(qe.value,D),D+=qe.value.length,Ee())})}()},xe.prototype.cancel=function(){return this._source.cancel()};class Xe{bb=null;bb_pos=0;__init(I,D){return this.bb_pos=I,this.bb=D,this}static getRootAsCrs(I,D){return(D||new Xe).__init(I.readInt32(I.position())+I.position(),I)}static getSizePrefixedRootAsCrs(I,D){return I.setPosition(I.position()+4),(D||new Xe).__init(I.readInt32(I.position())+I.position(),I)}org(I){let D=this.bb.__offset(this.bb_pos,4);return D?this.bb.__string(this.bb_pos+D,I):null}code(){let I=this.bb.__offset(this.bb_pos,6);return I?this.bb.readInt32(this.bb_pos+I):0}name(I){let D=this.bb.__offset(this.bb_pos,8);return D?this.bb.__string(this.bb_pos+D,I):null}description(I){let D=this.bb.__offset(this.bb_pos,10);return D?this.bb.__string(this.bb_pos+D,I):null}wkt(I){let D=this.bb.__offset(this.bb_pos,12);return D?this.bb.__string(this.bb_pos+D,I):null}codeString(I){let D=this.bb.__offset(this.bb_pos,14);return D?this.bb.__string(this.bb_pos+D,I):null}static startCrs(I){I.startObject(6)}static addOrg(I,D){I.addFieldOffset(0,D,0)}static addCode(I,D){I.addFieldInt32(1,D,0)}static addName(I,D){I.addFieldOffset(2,D,0)}static addDescription(I,D){I.addFieldOffset(3,D,0)}static addWkt(I,D){I.addFieldOffset(4,D,0)}static addCodeString(I,D){I.addFieldOffset(5,D,0)}static endCrs(I){return I.endObject()}static createCrs(I,D,fe,Ee,qe,ae,ft){return Xe.startCrs(I),Xe.addOrg(I,D),Xe.addCode(I,fe),Xe.addName(I,Ee),Xe.addDescription(I,qe),Xe.addWkt(I,ae),Xe.addCodeString(I,ft),Xe.endCrs(I)}}class Ye{bb=null;bb_pos=0;__init(I,D){return this.bb_pos=I,this.bb=D,this}static getRootAsHeader(I,D){return(D||new Ye).__init(I.readInt32(I.position())+I.position(),I)}static getSizePrefixedRootAsHeader(I,D){return I.setPosition(I.position()+4),(D||new Ye).__init(I.readInt32(I.position())+I.position(),I)}name(I){let D=this.bb.__offset(this.bb_pos,4);return D?this.bb.__string(this.bb_pos+D,I):null}envelope(I){let D=this.bb.__offset(this.bb_pos,6);return D?this.bb.readFloat64(this.bb.__vector(this.bb_pos+D)+8*I):0}envelopeLength(){let I=this.bb.__offset(this.bb_pos,6);return I?this.bb.__vector_len(this.bb_pos+I):0}envelopeArray(){let I=this.bb.__offset(this.bb_pos,6);return I?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+I),this.bb.__vector_len(this.bb_pos+I)):null}geometryType(){let I=this.bb.__offset(this.bb_pos,8);return I?this.bb.readUint8(this.bb_pos+I):ce.Unknown}hasZ(){let I=this.bb.__offset(this.bb_pos,10);return!!I&&!!this.bb.readInt8(this.bb_pos+I)}hasM(){let I=this.bb.__offset(this.bb_pos,12);return!!I&&!!this.bb.readInt8(this.bb_pos+I)}hasT(){let I=this.bb.__offset(this.bb_pos,14);return!!I&&!!this.bb.readInt8(this.bb_pos+I)}hasTm(){let I=this.bb.__offset(this.bb_pos,16);return!!I&&!!this.bb.readInt8(this.bb_pos+I)}columns(I,D){let fe=this.bb.__offset(this.bb_pos,18);return fe?(D||new Pe).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+fe)+4*I),this.bb):null}columnsLength(){let I=this.bb.__offset(this.bb_pos,18);return I?this.bb.__vector_len(this.bb_pos+I):0}featuresCount(){let I=this.bb.__offset(this.bb_pos,20);return I?this.bb.readUint64(this.bb_pos+I):BigInt("0")}indexNodeSize(){let I=this.bb.__offset(this.bb_pos,22);return I?this.bb.readUint16(this.bb_pos+I):16}crs(I){let D=this.bb.__offset(this.bb_pos,24);return D?(I||new Xe).__init(this.bb.__indirect(this.bb_pos+D),this.bb):null}title(I){let D=this.bb.__offset(this.bb_pos,26);return D?this.bb.__string(this.bb_pos+D,I):null}description(I){let D=this.bb.__offset(this.bb_pos,28);return D?this.bb.__string(this.bb_pos+D,I):null}metadata(I){let D=this.bb.__offset(this.bb_pos,30);return D?this.bb.__string(this.bb_pos+D,I):null}static startHeader(I){I.startObject(14)}static addName(I,D){I.addFieldOffset(0,D,0)}static addEnvelope(I,D){I.addFieldOffset(1,D,0)}static createEnvelopeVector(I,D){I.startVector(8,D.length,8);for(let fe=D.length-1;fe>=0;fe--)I.addFloat64(D[fe]);return I.endVector()}static startEnvelopeVector(I,D){I.startVector(8,D,8)}static addGeometryType(I,D){I.addFieldInt8(2,D,ce.Unknown)}static addHasZ(I,D){I.addFieldInt8(3,+D,0)}static addHasM(I,D){I.addFieldInt8(4,+D,0)}static addHasT(I,D){I.addFieldInt8(5,+D,0)}static addHasTm(I,D){I.addFieldInt8(6,+D,0)}static addColumns(I,D){I.addFieldOffset(7,D,0)}static createColumnsVector(I,D){I.startVector(4,D.length,4);for(let fe=D.length-1;fe>=0;fe--)I.addOffset(D[fe]);return I.endVector()}static startColumnsVector(I,D){I.startVector(4,D,4)}static addFeaturesCount(I,D){I.addFieldInt64(8,D,BigInt("0"))}static addIndexNodeSize(I,D){I.addFieldInt16(9,D,16)}static addCrs(I,D){I.addFieldOffset(10,D,0)}static addTitle(I,D){I.addFieldOffset(11,D,0)}static addDescription(I,D){I.addFieldOffset(12,D,0)}static addMetadata(I,D){I.addFieldOffset(13,D,0)}static endHeader(I){return I.endObject()}static finishHeaderBuffer(I,D){I.finish(D)}static finishSizePrefixedHeaderBuffer(I,D){I.finish(D,void 0,!0)}}function At(te){let I=Ye.getRootAsHeader(te),D=I.featuresCount(),fe=I.indexNodeSize(),Ee=[];for(let ft=0;ft<I.columnsLength();ft++){let Nt=I.columns(ft);if(!Nt)throw Error("Column unexpectedly missing");if(!Nt.name())throw Error("Column name unexpectedly missing");Ee.push({name:Nt.name(),type:Nt.type(),title:Nt.title(),description:Nt.description(),width:Nt.width(),precision:Nt.precision(),scale:Nt.scale(),nullable:Nt.nullable(),unique:Nt.unique(),primary_key:Nt.primaryKey()})}let qe=I.crs(),ae=qe?{org:qe.org(),code:qe.code(),name:qe.name(),description:qe.description(),wkt:qe.wkt(),code_string:qe.codeString()}:null;return{geometryType:I.geometryType(),columns:Ee,envelope:null,featuresCount:Number(D),indexNodeSize:fe,crs:ae,title:I.title(),description:I.description(),metadata:I.metadata()}}class Dt{static global=new Dt;_extraRequestThreshold=262144;extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(I){if(I<0)throw Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=I}}function kt(te,I){I=Math.min(Math.max(+I,2),65535);let D=te,fe=D;do fe+=D=Math.ceil(D/I);while(D!==1);return 40*fe}async function*yt(te,I,D,fe){class Ee{_level;nodes;constructor(rr,Ut){this._level=Ut,this.nodes=rr}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(rr){this.nodes[1]=rr}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}let{minX:qe,minY:ae,maxX:ft,maxY:Nt}=D,gt=function(Mt,rr){if(rr<2)throw Error("Node size must be at least 2");if(Mt===0)throw Error("Number of items must be greater than 0");let Ut=Mt,gr=Ut,Xr=[Ut];do gr+=Ut=Math.ceil(Ut/rr),Xr.push(Ut);while(Ut!==1);let ri=[];for(let kr of(Ut=gr,Xr))ri.push(Ut-kr),Ut-=kr;let Ot=[];for(let kr=0;kr<Xr.length;kr++)Ot.push([ri[kr],ri[kr]+Xr[kr]]);return Ot}(te,I),Lt=gt[0][0],Ht=[new Ee([0,1],gt.length-1)];for(;Ht.length!==0;){let Mt=Ht.shift(),rr=Mt.startNodeIdx(),Ut=rr>=Lt,gr=(()=>{let[,Ot]=gt[Mt.level()],kr=Math.min(Mt.endNodeIdx()+I,Ot);return Ut&&kr<Ot?kr+1:kr})(),Xr=gr-rr,ri=new DataView(await fe(40*rr,40*Xr));for(let Ot=rr;Ot<gr;Ot++){let kr=Ot-rr,Fi=40*kr;if(ft<ri.getFloat64(Fi+0,!0)||Nt<ri.getFloat64(Fi+8,!0)||qe>ri.getFloat64(Fi+16,!0)||ae>ri.getFloat64(Fi+24,!0))continue;let Ln=ri.getBigUint64(Fi+32,!0);if(Ut){let Or=(()=>{if(Ot<te-1){let Bs=40*(kr+1);return ri.getBigUint64(Bs+32,!0)-Ln}return null})(),Oi=Ot-Lt;yield[Number(Ln),Oi,Number(Or)];continue}let Zi=Dt.global.extraRequestThreshold()/40,nr=Ht[Ht.length-1];if(nr!==void 0&&nr.level()===Mt.level()-1&&Ln<nr.endNodeIdx()+Zi){nr.extendEndNodeIdx(Number(Ln));continue}let Br=(()=>{let Or=Mt.level()-1;return new Ee([Number(Ln),Number(Ln)+1],Or)})();nr!==void 0&&(nr.level(),Br.level()),Ht.push(Br)}}}class vt{bytes;header;headerLength;indexLength;constructor(I,D,fe,Ee){this.bytes=I,this.header=D,this.headerLength=fe,this.indexLength=Ee}static open(I){if(!I.subarray(0,3).every((ae,ft)=>m[ft]===ae))throw Error("Not a FlatGeobuf file");let D=new DataView(I.buffer).getUint32(8,!0);if(D>10485760||D<8)throw Error("Invalid header size");let fe=I.subarray(12,12+D),Ee=At(new O(fe)),qe=kt(Ee.featuresCount,Ee.indexNodeSize);return new vt(I,Ee,D,qe)}async*selectBbox(I){let D=this.lengthBeforeTree(),fe=async(Ee,qe)=>{let ae=D+Ee;return this.bytes.slice(ae,ae+qe).buffer};for await(let Ee of yt(this.header.featuresCount,this.header.indexNodeSize,I,fe)){let[qe,ae]=Ee,ft=this.readFeature(qe);yield{id:ae,feature:ft}}}lengthBeforeTree(){return m.length+4+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}readFeature(I){let D=I+this.lengthBeforeFeatures(),fe=new DataView(this.bytes.buffer).getUint32(D,!0),Ee=this.bytes.subarray(D+4,D+4+fe),qe=new Uint8Array(fe+4);qe.set(Ee,4);let ae=new O(qe);return ae.setPosition(4),ge.getRootAsFeature(ae)}}var sr=function(te,I){return sr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,fe){D.__proto__=fe}||function(D,fe){for(var Ee in fe)fe.hasOwnProperty(Ee)&&(D[Ee]=fe[Ee])},sr(te,I)};function Zt(te,I,D,fe){return new(D||(D=Promise))(function(Ee,qe){function ae(gt){try{Nt(fe.next(gt))}catch(Lt){qe(Lt)}}function ft(gt){try{Nt(fe.throw(gt))}catch(Lt){qe(Lt)}}function Nt(gt){var Lt;gt.done?Ee(gt.value):(Lt=gt.value,Lt instanceof D?Lt:new D(function(Ht){Ht(Lt)})).then(ae,ft)}Nt((fe=fe.apply(te,[])).next())})}function he(te,I){var D,fe,Ee,qe,ae={label:0,sent:function(){if(1&Ee[0])throw Ee[1];return Ee[1]},trys:[],ops:[]};return qe={next:ft(0),throw:ft(1),return:ft(2)},typeof Symbol=="function"&&(qe[Symbol.iterator]=function(){return this}),qe;function ft(Nt){return function(gt){return function(Lt){if(D)throw new TypeError("Generator is already executing.");for(;ae;)try{if(D=1,fe&&(Ee=2&Lt[0]?fe.return:Lt[0]?fe.throw||((Ee=fe.return)&&Ee.call(fe),0):fe.next)&&!(Ee=Ee.call(fe,Lt[1])).done)return Ee;switch(fe=0,Ee&&(Lt=[2&Lt[0],Ee.value]),Lt[0]){case 0:case 1:Ee=Lt;break;case 4:return ae.label++,{value:Lt[1],done:!1};case 5:ae.label++,fe=Lt[1],Lt=[0];continue;case 7:Lt=ae.ops.pop(),ae.trys.pop();continue;default:if(Ee=ae.trys,!((Ee=Ee.length>0&&Ee[Ee.length-1])||Lt[0]!==6&&Lt[0]!==2)){ae=0;continue}if(Lt[0]===3&&(!Ee||Lt[1]>Ee[0]&&Lt[1]<Ee[3])){ae.label=Lt[1];break}if(Lt[0]===6&&ae.label<Ee[1]){ae.label=Ee[1],Ee=Lt;break}if(Ee&&ae.label<Ee[2]){ae.label=Ee[2],ae.ops.push(Lt);break}Ee[2]&&ae.ops.pop(),ae.trys.pop();continue}Lt=I.call(te,ae)}catch(Ht){Lt=[6,Ht],fe=0}finally{D=Ee=0}if(5&Lt[0])throw Lt[1];return{value:Lt[0]?Lt[1]:void 0,done:!0}}([Nt,gt])}}}function Fe(te){var I=typeof Symbol=="function"&&Symbol.iterator,D=I&&te[I],fe=0;if(D)return D.call(te);if(te&&typeof te.length=="number")return{next:function(){return te&&fe>=te.length&&(te=void 0),{value:te&&te[fe++],done:!te}}};throw new TypeError(I?"Object is not iterable.":"Symbol.iterator is not defined.")}function $e(te){return this instanceof $e?(this.v=te,this):new $e(te)}function tt(te,I,D){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var fe,Ee=D.apply(te,I||[]),qe=[];return fe={},ae("next"),ae("throw"),ae("return"),fe[Symbol.asyncIterator]=function(){return this},fe;function ae(Ht){Ee[Ht]&&(fe[Ht]=function(Mt){return new Promise(function(rr,Ut){qe.push([Ht,Mt,rr,Ut])>1||ft(Ht,Mt)})})}function ft(Ht,Mt){try{(function(rr){rr.value instanceof $e?Promise.resolve(rr.value.v).then(Nt,gt):Lt(qe[0][2],rr)})(Ee[Ht](Mt))}catch(rr){Lt(qe[0][3],rr)}}function Nt(Ht){ft("next",Ht)}function gt(Ht){ft("throw",Ht)}function Lt(Ht,Mt){Ht(Mt),qe.shift(),qe.length&&ft(qe[0][0],qe[0][1])}}var ct=function(te){function I(D){var fe=te.call(this,D)||this;return Object.defineProperty(fe,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(fe,fe.constructor.prototype):fe.__proto__=fe.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(fe,fe.constructor),fe}return function(D,fe){function Ee(){this.constructor=D}sr(D,fe),D.prototype=fe===null?Object.create(fe):(Ee.prototype=fe.prototype,new Ee)}(I,te),I}(Error);function ut(te){te!=null&&typeof te.then=="function"&&te.then(wt,wt)}(function(){function te(I){if(I<0)throw new RangeError("Capacity may not be less than 0");this._c=I,this._q=[]}Object.defineProperty(te.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(te.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),te.prototype.add=function(I){if(this.full)throw new Error("Buffer full");this._q.push(I)},te.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}})(),function(){function te(I){if(I<1)throw new RangeError("Capacity may not be less than 1");this._c=I,this._q=[]}Object.defineProperty(te.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(te.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),te.prototype.add=function(I){for(;this._q.length>=this._c;)this._q.shift();this._q.push(I)},te.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}}(),function(){function te(I){if(I<1)throw new RangeError("Capacity may not be less than 1");this._c=I,this._q=[]}Object.defineProperty(te.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(te.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),te.prototype.add=function(I){this._q.length<this._c&&this._q.push(I)},te.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}}();var pt=1024,wt=function(){};function Bt(te){var I=te.err,D=Promise.resolve(te.execution).then(function(fe){if(I!=null)throw I;return fe});return te.err=void 0,te.execution=D.then(function(){},function(){}),te.pending===void 0?D:te.pending.then(function(){return D})}function er(te,I){var D=te.state>=3;return Promise.resolve(I).then(function(fe){return!D&&te.state>=4?Bt(te).then(function(Ee){return{value:Ee,done:!0}}):{value:fe,done:D}})}function ur(te,I){var D,fe;if(!(te.state>=2))if(te.state=2,te.onnext(),te.onstop(),te.err==null&&(te.err=I),te.pushes.length!==0||te.buffer!==void 0&&!te.buffer.empty)try{for(var Ee=Fe(te.pushes),qe=Ee.next();!qe.done;qe=Ee.next())qe.value.resolve()}catch(ae){D={error:ae}}finally{try{qe&&!qe.done&&(fe=Ee.return)&&fe.call(Ee)}finally{if(D)throw D.error}}else fr(te)}function fr(te){var I,D;if(!(te.state>=3)){te.state<2&&ur(te),te.state=3,te.buffer=void 0;try{for(var fe=Fe(te.nexts),Ee=fe.next();!Ee.done;Ee=fe.next()){var qe=Ee.value,ae=te.pending===void 0?Bt(te):te.pending.then(function(){return Bt(te)});qe.resolve(er(te,ae))}}catch(ft){I={error:ft}}finally{try{Ee&&!Ee.done&&(D=fe.return)&&D.call(fe)}finally{if(I)throw I.error}}te.pushes=[],te.nexts=[]}}function Ft(te){te.state>=4||(te.state<3&&fr(te),te.state=4)}function Ue(te,I){if(ut(I),te.pushes.length>=pt)throw new ct("No more than 1024 pending calls to push are allowed on a single repeater.");if(te.state>=2)return Promise.resolve(void 0);var D,fe=te.pending===void 0?Promise.resolve(I):te.pending.then(function(){return I});fe=fe.catch(function(ft){te.state<2&&(te.err=ft),Ft(te)}),te.nexts.length?(te.nexts.shift().resolve(er(te,fe)),D=te.nexts.length?Promise.resolve(te.nexts[0].value):te.buffer===void 0||te.buffer.full?new Promise(function(ft){return te.onnext=ft}):Promise.resolve(void 0)):te.buffer===void 0||te.buffer.full?D=new Promise(function(ft){return te.pushes.push({resolve:ft,value:fe})}):(te.buffer.add(fe),D=Promise.resolve(void 0));var Ee=!0,qe={},ae=D.catch(function(ft){if(Ee)throw ft});return qe.then=function(ft,Nt){return Ee=!1,Promise.prototype.then.call(D,ft,Nt)},qe.catch=function(ft){return Ee=!1,Promise.prototype.catch.call(D,ft)},qe.finally=D.finally.bind(D),te.pending=fe.then(function(){return ae}).catch(function(ft){te.err=ft,Ft(te)}),qe}function Yr(te){if(!(te.state>=1)){te.state=1;var I=Ue.bind(null,te),D=function(fe){var Ee=ur.bind(null,fe),qe=new Promise(function(ae){return fe.onstop=ae});return Ee.then=qe.then.bind(qe),Ee.catch=qe.catch.bind(qe),Ee.finally=qe.finally.bind(qe),Ee}(te);te.execution=new Promise(function(fe){return fe(te.executor(I,D))}),te.execution.catch(function(){return ur(te)})}}var wr=new WeakMap,Tr=function(){function te(I,D){wr.set(this,{executor:I,buffer:D,err:void 0,state:0,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:wt,onstop:wt})}return te.prototype.next=function(I){ut(I);var D=wr.get(this);if(D===void 0)throw new Error("WeakMap error");if(D.nexts.length>=pt)throw new ct("No more than 1024 pending calls to next are allowed on a single repeater.");if(D.state<=0&&Yr(D),D.onnext(I),D.buffer!==void 0&&!D.buffer.empty){var fe=er(D,D.buffer.remove());if(D.pushes.length){var Ee=D.pushes.shift();D.buffer.add(Ee.value),D.onnext=Ee.resolve}return fe}if(D.pushes.length){var qe=D.pushes.shift();return D.onnext=qe.resolve,er(D,qe.value)}return D.state>=2?(fr(D),er(D,Bt(D))):new Promise(function(ae){return D.nexts.push({resolve:ae,value:I})})},te.prototype.return=function(I){ut(I);var D=wr.get(this);if(D===void 0)throw new Error("WeakMap error");return fr(D),D.execution=Promise.resolve(D.execution).then(function(){return I}),er(D,Bt(D))},te.prototype.throw=function(I){var D=wr.get(this);if(D===void 0)throw new Error("WeakMap error");return D.state<=0||D.state>=2||D.buffer!==void 0&&!D.buffer.empty?(fr(D),D.err==null&&(D.err=I),er(D,Bt(D))):this.next(Promise.reject(I))},te.prototype[Symbol.asyncIterator]=function(){return this},te.race=Ar,te.merge=mr,te.zip=Vr,te.latest=Lr,te}();function ir(te,I){var D,fe,Ee=[],qe=function(Nt){Nt!=null&&typeof Nt[Symbol.asyncIterator]=="function"?Ee.push(Nt[Symbol.asyncIterator]()):Nt!=null&&typeof Nt[Symbol.iterator]=="function"?Ee.push(Nt[Symbol.iterator]()):Ee.push(function(){return tt(this,arguments,function(){return he(this,function(gt){switch(gt.label){case 0:return I.yieldValues?[4,$e(Nt)]:[3,3];case 1:return[4,gt.sent()];case 2:gt.sent(),gt.label=3;case 3:return I.returnValues?[4,$e(Nt)]:[3,5];case 4:return[2,gt.sent()];case 5:return[2]}})})}())};try{for(var ae=Fe(te),ft=ae.next();!ft.done;ft=ae.next())qe(ft.value)}catch(Nt){D={error:Nt}}finally{try{ft&&!ft.done&&(fe=ae.return)&&fe.call(ae)}finally{if(D)throw D.error}}return Ee}function Ar(te){var I=this,D=ir(te,{returnValues:!0});return new Tr(function(fe,Ee){return Zt(I,0,void 0,function(){var qe,ae,ft,Nt,gt,Lt;return he(this,function(Ht){switch(Ht.label){case 0:if(!D.length)return Ee(),[2];ae=!1,Ee.then(function(){qe(),ae=!0}),Ht.label=1;case 1:Ht.trys.push([1,,5,7]),Nt=void 0,gt=0,Lt=function(){var Mt,rr,Ut,gr,Xr,ri;return he(this,function(Ot){switch(Ot.label){case 0:Mt=gt;try{for(Xr=void 0,rr=Fe(D),Ut=rr.next();!Ut.done;Ut=rr.next())gr=Ut.value,Promise.resolve(gr.next()).then(function(kr){kr.done?(Ee(),ft===void 0&&(ft=kr)):gt===Mt&&(gt++,qe(kr))},function(kr){return Ee(kr)})}catch(kr){Xr={error:kr}}finally{try{Ut&&!Ut.done&&(ri=rr.return)&&ri.call(rr)}finally{if(Xr)throw Xr.error}}return[4,new Promise(function(kr){return qe=kr})];case 1:return(Nt=Ot.sent())===void 0?[3,3]:[4,fe(Nt.value)];case 2:Ot.sent(),Ot.label=3;case 3:return[2]}})},Ht.label=2;case 2:return ae?[3,4]:[5,Lt()];case 3:return Ht.sent(),[3,2];case 4:return[2,ft&&ft.value];case 5:return Ee(),[4,Promise.race(D.map(function(Mt){return Mt.return&&Mt.return()}))];case 6:return Ht.sent(),[7];case 7:return[2]}})})})}function mr(te){var I=this,D=ir(te,{yieldValues:!0});return new Tr(function(fe,Ee){return Zt(I,0,void 0,function(){var qe,ae,ft,Nt=this;return he(this,function(gt){switch(gt.label){case 0:if(!D.length)return Ee(),[2];qe=[],ae=!1,Ee.then(function(){var Lt,Ht;ae=!0;try{for(var Mt=Fe(qe),rr=Mt.next();!rr.done;rr=Mt.next())(0,rr.value)()}catch(Ut){Lt={error:Ut}}finally{try{rr&&!rr.done&&(Ht=Mt.return)&&Ht.call(Mt)}finally{if(Lt)throw Lt.error}}}),gt.label=1;case 1:return gt.trys.push([1,,3,4]),[4,Promise.all(D.map(function(Lt,Ht){return Zt(Nt,0,void 0,function(){var Mt;return he(this,function(rr){switch(rr.label){case 0:rr.trys.push([0,,6,9]),rr.label=1;case 1:return ae?[3,5]:(Promise.resolve(Lt.next()).then(function(Ut){return qe[Ht](Ut)},function(Ut){return Ee(Ut)}),[4,new Promise(function(Ut){qe[Ht]=Ut})]);case 2:return(Mt=rr.sent())===void 0?[3,4]:Mt.done?(ft=Mt,[2]):[4,fe(Mt.value)];case 3:rr.sent(),rr.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return Lt.return?[4,Lt.return()]:[3,8];case 7:rr.sent(),rr.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return gt.sent(),[2,ft&&ft.value];case 3:return Ee(),[7];case 4:return[2]}})})})}function Vr(te){var I=this,D=ir(te,{returnValues:!0});return new Tr(function(fe,Ee){return Zt(I,0,void 0,function(){var qe,ae,ft,Nt;return he(this,function(gt){switch(gt.label){case 0:if(!D.length)return Ee(),[2,[]];ae=!1,Ee.then(function(){qe(),ae=!0}),gt.label=1;case 1:gt.trys.push([1,,6,8]),gt.label=2;case 2:return ae?[3,5]:(Promise.all(D.map(function(Lt){return Lt.next()})).then(function(Lt){return qe(Lt)},function(Lt){return Ee(Lt)}),[4,new Promise(function(Lt){return qe=Lt})]);case 3:return(ft=gt.sent())===void 0?[2]:(Nt=ft.map(function(Lt){return Lt.value}),ft.some(function(Lt){return Lt.done})?[2,Nt]:[4,fe(Nt)]);case 4:return gt.sent(),[3,2];case 5:return[3,8];case 6:return Ee(),[4,Promise.all(D.map(function(Lt){return Lt.return&&Lt.return()}))];case 7:return gt.sent(),[7];case 8:return[2]}})})})}function Lr(te){var I=this,D=ir(te,{yieldValues:!0,returnValues:!0});return new Tr(function(fe,Ee){return Zt(I,0,void 0,function(){var qe,ae,ft,Nt,gt,Lt=this;return he(this,function(Ht){switch(Ht.label){case 0:if(!D.length)return Ee(),[2,[]];ae=[],ft=!1,Ee.then(function(){var Mt,rr;qe();try{for(var Ut=Fe(ae),gr=Ut.next();!gr.done;gr=Ut.next())(0,gr.value)()}catch(Xr){Mt={error:Xr}}finally{try{gr&&!gr.done&&(rr=Ut.return)&&rr.call(Ut)}finally{if(Mt)throw Mt.error}}ft=!0}),Ht.label=1;case 1:return Ht.trys.push([1,,5,7]),Promise.all(D.map(function(Mt){return Mt.next()})).then(function(Mt){return qe(Mt)},function(Mt){return Ee(Mt)}),[4,new Promise(function(Mt){return qe=Mt})];case 2:return(Nt=Ht.sent())===void 0?[2]:(gt=Nt.map(function(Mt){return Mt.value}),Nt.every(function(Mt){return Mt.done})?[2,gt]:[4,fe(gt.slice())]);case 3:return Ht.sent(),[4,Promise.all(D.map(function(Mt,rr){return Zt(Lt,0,void 0,function(){var Ut;return he(this,function(gr){switch(gr.label){case 0:if(Nt[rr].done)return[2,Nt[rr].value];gr.label=1;case 1:return ft?[3,4]:(Promise.resolve(Mt.next()).then(function(Xr){return ae[rr](Xr)},function(Xr){return Ee(Xr)}),[4,new Promise(function(Xr){return ae[rr]=Xr})]);case 2:return(Ut=gr.sent())===void 0?[2,Nt[rr].value]:Ut.done?[2,Ut.value]:(gt[rr]=Ut.value,[4,fe(gt.slice())]);case 3:return gr.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,Ht.sent()];case 5:return Ee(),[4,Promise.all(D.map(function(Mt){return Mt.return&&Mt.return()}))];case 6:return Ht.sent(),[7];case 7:return[2]}})})})}class ai{headerClient;header;headerLength;indexLength;nocache;headers;constructor(I,D,fe,Ee,qe,ae={}){this.headerClient=I,this.header=D,this.headerLength=fe,this.indexLength=Ee,this.nocache=qe,this.headers=ae}static async open(I,D,fe={}){let Ee,qe=new Rr(I,D,fe),ae=2024+(()=>{let Lt,Ht=0;for(Lt=0;Lt<3;Lt++)Ht+=16**Lt*40;return Ht})();if(!new Uint8Array(await qe.getRange(0,8,ae,"header")).subarray(0,3).every((Lt,Ht)=>m[Ht]===Lt))throw Error("Not a FlatGeobuf file");if((Ee=new DataView(await qe.getRange(8,4,ae,"header")).getUint32(0,!0))>10485760||Ee<8)throw Error("Invalid header size");let ft=await qe.getRange(12,Ee,ae,"header"),Nt=At(new O(new Uint8Array(ft)));if(Nt.indexNodeSize===0)throw Error("No index found, cannot read features filtered by bbox");let gt=kt(Nt.featuresCount,Nt.indexNodeSize);return new ai(qe,Nt,Ee,gt,D,fe)}async*selectBbox(I){let D=this.lengthBeforeTree(),fe=this.headerClient,Ee=async(Nt,gt)=>fe.getRange(D+Nt,gt,0,"index"),qe=[],ae=[];for await(let Nt of yt(this.header.featuresCount,this.header.indexNodeSize,I,Ee)){let[gt,Lt]=Nt,[,,Ht]=Nt;if(Ht||(Ht=4),ae.length===0){ae.push([gt,Ht,Lt]);continue}let Mt=ae[ae.length-1];gt-(Mt[0]+Mt[1])>Dt.global.extraRequestThreshold()&&(qe.push(ae),ae=[]),ae.push([gt,Ht,Lt])}this.headerClient.logUsage("header+index"),ae.length>0&&qe.push(ae);let ft=qe.flatMap(Nt=>this.readFeatureBatch(Nt,this.nocache));yield*Tr.merge(ft)}lengthBeforeTree(){return m.length+4+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(I){return new Rr(this.headerClient.httpClient,I,this.headers)}async*readFeatureBatch(I,D){let[fe]=I[0],[Ee,qe]=I[I.length-1],ae=this.buildFeatureClient(D),ft=Ee+qe-fe;for(let[Nt,,gt]of I){let Lt=await this.readFeature(ae,Nt,ft);yield{id:gt,feature:Lt},ft=0}ae.logUsage("feature")}async readFeature(I,D,fe){let Ee,qe=D+this.lengthBeforeFeatures();Ee=new DataView(await I.getRange(qe,4,fe,"feature length")).getUint32(0,!0);let ae=new Uint8Array(await I.getRange(qe+4,Ee,fe,"feature data")),ft=new Uint8Array(Ee+4);ft.set(ae,4);let Nt=new O(ft);return Nt.setPosition(4),ge.getRootAsFeature(Nt)}}class Rr{httpClient;bytesEverUsed=0;bytesEverFetched=0;buffer=new ArrayBuffer(0);head=0;constructor(I,D,fe={}){if(typeof I=="string")this.httpClient=new nt(I,D,fe);else{if(!(I instanceof nt))throw Error("Unknown source");this.httpClient=I}}async getRange(I,D,fe,Ee){this.bytesEverUsed+=D;let qe=I-this.head,ae=qe+D;if(qe>=0&&ae<=this.buffer.byteLength)return this.buffer.slice(qe,ae);let ft=Math.max(D,fe);return this.bytesEverFetched+=ft,this.buffer=await this.httpClient.getRange(I,ft,Ee),this.head=I,this.buffer.slice(0,D)}logUsage(I){I.split(" ")[0],(100*this.bytesEverUsed/this.bytesEverFetched).toFixed(2)}}class nt{url;nocache;headers;requestsEverMade=0;bytesEverRequested=0;constructor(I,D,fe={}){this.url=I,this.nocache=D,this.headers=fe}async getRange(I,D,fe){this.requestsEverMade+=1,this.bytesEverRequested+=D;let Ee=`bytes=${I}-${I+D-1}`,qe=new Headers(this.headers);return qe.set("Range",Ee),this.nocache&&qe.set("Cache-Control","no-cache, no-store"),await(await fetch(this.url,{headers:qe})).arrayBuffer()}}function re(te){let I;for(let D of te){if(I===ce.Unknown)break;let fe=D.getGeometry?Ge(D.getGeometry().getType()):Ge(D.geometry.type);I===void 0?I=fe:I!==fe&&(I=ce.Unknown)}if(I===void 0)throw Error("Could not infer geometry type for collection of features.");return I}async function*K(te,I,D){let fe,Ee=typeof(ft=te).slice=="function"?ft:new xe(typeof ft.read=="function"?ft:ft.getReader()),qe=async Ut=>await Ee.slice(Ut),ae=new Uint8Array(await qe(8));var ft;if(!ae.subarray(0,3).every((Ut,gr)=>m[gr]===Ut))throw Error("Not a FlatGeobuf file");ae=new Uint8Array(await qe(4));let Nt=new O(ae),gt=Nt.readUint32(0);ae=new Uint8Array(await qe(gt));let Lt=At(Nt=new O(ae));D&&D(Lt);let{indexNodeSize:Ht,featuresCount:Mt}=Lt;if(Ht>0){let Ut=kt(Mt,Ht);await qe(Ut)}let rr=0;for(;fe=await se(qe,Lt,I,rr++);)yield fe}async function se(te,I,D,fe){let Ee=new Uint8Array(await te(4,"feature length"));if(Ee.byteLength===0)return;let qe=new O(Ee),ae=qe.readUint32(0);Ee=new Uint8Array(await te(ae,"feature data"));let ft=new Uint8Array(ae+4);return ft.set(Ee,4),(qe=new O(ft)).setPosition(4),D(fe,ge.getRootAsFeature(qe),I)}function Ie(te){let I,D,fe=te.coordinates,Ee=[],qe=[],ae=Ge(te.type),ft=0;switch(te.type){case"Point":case"MultiPoint":case"LineString":Oe(fe,Ee,qe);break;case"MultiLineString":case"Polygon":Oe(fe,Ee,qe),fe.length>1&&(I=fe.map(Nt=>ft+=Nt.length));break;case"MultiPolygon":D=fe.map(Nt=>({type:"Polygon",coordinates:Nt})).map(Ie)}return{xy:Ee,z:qe.length>0?qe:void 0,ends:I,type:ae,parts:D}}function Ce(te){let I=Ge(te.type),D=[];for(let fe=0;fe<te.geometries.length;fe++){let Ee=te.geometries[fe];Ee.type==="GeometryCollection"?D.push(Ce(Ee)):D.push(Ie(Ee))}return{type:I,parts:D}}function ht(te,I){let D=I;if(D===ce.Unknown&&(D=te.type()),D===ce.GeometryCollection){let Ee=[];for(let qe=0;qe<te.partsLength();qe++){let ae=te.parts(qe),ft=ae.type();Ee.push(ht(ae,ft))}return{type:ce[D],geometries:Ee}}if(D===ce.MultiPolygon){let Ee=[];for(let qe=0;qe<te.partsLength();qe++)Ee.push(ht(te.parts(qe),ce.Polygon));return{type:ce[D],coordinates:Ee.map(qe=>qe.coordinates)}}let fe=function(Ee,qe){let ae=Ee.xyArray(),ft=Ee.zArray();switch(qe){case ce.Point:{let Nt=Array.from(ae);return ft&&Nt.push(ft[0]),Nt}case ce.MultiPoint:case ce.LineString:return Me(ae,ft);case ce.MultiLineString:case ce.Polygon:return function(Nt,gt,Lt){let Ht;if(!Lt||Lt.length===0)return[Me(Nt,gt)];let Mt=0,rr=Array.from(Lt).map(Ut=>Nt.slice(Mt,Mt=Ut<<1));return gt&&(Mt=0,Ht=Array.from(Lt).map(Ut=>gt.slice(Mt,Mt=Ut))),rr.map((Ut,gr)=>Me(Ut,Ht?Ht[gr]:void 0))}(ae,ft,Ee.endsArray())}}(te,D);return{type:ce[D],coordinates:fe}}function at(te,I,D){let fe=D.columns;return{type:"Feature",id:te,geometry:ht(I.geometry(),D.geometryType),properties:Te(I,fe)}}function Be(te,I=0){var D;let fe,Ee,qe=(fe=(D=te).features[0].properties,Ee=null,fe&&(Ee=Object.keys(fe).map(Ht=>function(Mt,rr){return{name:rr,type:function(Ut){if(typeof Ut=="boolean")return j.Bool;if(typeof Ut=="number")return j.Double;if(typeof Ut=="string"||Ut===null)return j.String;if(Ut instanceof Uint8Array)return j.Binary;if(typeof Ut=="object")return j.Json;throw Error(`Unknown type (value '${Ut}')`)}(Mt[rr]),title:null,description:null,width:-1,precision:-1,scale:-1,nullable:!0,unique:!1,primary_key:!1}}(fe,Ht))),{geometryType:re(D.features),columns:Ee,featuresCount:D.features.length}),ae=function(Ht,Mt=0){let rr,Ut=new Y,gr=0;Ht.columns&&(gr=Ye.createColumnsVector(Ut,Ht.columns.map(Ot=>{let kr;return kr=Ut.createString(Ot.name),Pe.startColumn(Ut),Pe.addName(Ut,kr),Pe.addType(Ut,Ot.type),Pe.endColumn(Ut)})));let Xr=Ut.createString("L1");Mt&&(Xe.startCrs(Ut),Xe.addCode(Ut,Mt),rr=Xe.endCrs(Ut)),Ye.startHeader(Ut),rr&&Ye.addCrs(Ut,rr),Ye.addFeaturesCount(Ut,BigInt(Ht.featuresCount)),Ye.addGeometryType(Ut,Ht.geometryType),Ye.addIndexNodeSize(Ut,0),gr&&Ye.addColumns(Ut,gr),Ye.addName(Ut,Xr);let ri=Ye.endHeader(Ut);return Ut.finishSizePrefixed(ri),Ut.asUint8Array()}(qe,I),ft=te.features.map(Ht=>He(Ht.geometry.type==="GeometryCollection"?Ce(Ht.geometry):Ie(Ht.geometry),Ht.properties,qe)),Nt=ft.map(Ht=>Ht.length).reduce((Ht,Mt)=>Ht+Mt),gt=new Uint8Array(m.length+ae.length+Nt);gt.set(ae,m.length);let Lt=m.length+ae.length;for(let Ht of ft)gt.set(Ht,Lt),Lt+=Ht.length;return gt.set(m),gt}async function*ot(te,I,D){yield*async function*(fe,Ee,qe,ae){if(!fe.subarray(0,3).every((Ut,gr)=>m[gr]===Ut))throw Error("Not a FlatGeobuf file");if(qe){let Ut=vt.open(fe);for await(let gr of Ut.selectBbox(qe))yield Ee(gr.id,gr.feature,Ut.header);return}let ft=new O(fe),Nt=ft.readUint32(m.length);ft.setPosition(m.length+4);let gt=At(ft);ae&&ae(gt);let Lt=m.length+4+Nt,{indexNodeSize:Ht,featuresCount:Mt}=gt;Ht>0&&(Lt+=kt(Mt,Ht));let rr=0;for(;Lt<ft.capacity();){let Ut=ft.readUint32(Lt);ft.setPosition(Lt+4);let gr=ge.getRootAsFeature(ft);yield Ee(rr++,gr,gt),Lt+=4+Ut}}(te,at,I,D)}function Rt(te,I,D,fe=!1,Ee={}){return async function*(qe,ae,ft,Nt,gt=!1,Lt={}){let Ht=await ai.open(qe,gt,Lt);for await(let Mt of(Nt&&Nt(Ht.header),Ht.selectBbox(ae)))yield ft(Mt.id,Mt.feature,Ht.header)}(te,I,at,D,fe,Ee)}u.deserialize=function(te,I,D,fe=!1,Ee={}){return te instanceof Uint8Array?ot(te,I,D):te instanceof ReadableStream?function(qe,ae){return K(qe,at,ae)}(te,D):Rt(te,I,D,fe,Ee)},u.serialize=function(te,I=0){return Be(te,I)}})}(Uh,Uh.exports)),Uh.exports}var J5=Y5(),kp,Vy;function K5(){if(Vy)return kp;Vy=1;var p="Expected a function",o=NaN,u="[object Symbol]",m=/^\s+|\s+$/g,v=/^[-+]0x[0-9a-f]+$/i,x=/^0b[01]+$/i,b=/^0o[0-7]+$/i,a=parseInt,C=typeof Pd=="object"&&Pd&&Pd.Object===Object&&Pd,F=typeof self=="object"&&self&&self.Object===Object&&self,O=C||F||Function("return this")(),Y=Object.prototype,ee=Y.toString,j=Math.max,Pe=Math.min,ce=function(){return O.Date.now()};function Q(Ze,it,He){var Te,st,me,xe,Xe,Ye,At=0,Dt=!1,kt=!1,yt=!0;if(typeof Ze!="function")throw new TypeError(p);it=Ge(it)||0,Qe(He)&&(Dt=!!He.leading,kt="maxWait"in He,me=kt?j(Ge(He.maxWait)||0,it):me,yt="trailing"in He?!!He.trailing:yt);function vt(pt){var wt=Te,Bt=st;return Te=st=void 0,At=pt,xe=Ze.apply(Bt,wt),xe}function sr(pt){return At=pt,Xe=setTimeout(Fe,it),Dt?vt(pt):xe}function Zt(pt){var wt=pt-Ye,Bt=pt-At,er=it-wt;return kt?Pe(er,me-Bt):er}function he(pt){var wt=pt-Ye,Bt=pt-At;return Ye===void 0||wt>=it||wt<0||kt&&Bt>=me}function Fe(){var pt=ce();if(he(pt))return $e(pt);Xe=setTimeout(Fe,Zt(pt))}function $e(pt){return Xe=void 0,yt&&Te?vt(pt):(Te=st=void 0,xe)}function tt(){Xe!==void 0&&clearTimeout(Xe),At=0,Te=Ye=st=Xe=void 0}function ct(){return Xe===void 0?xe:$e(ce())}function ut(){var pt=ce(),wt=he(pt);if(Te=arguments,st=this,Ye=pt,wt){if(Xe===void 0)return sr(Ye);if(kt)return Xe=setTimeout(Fe,it),vt(Ye)}return Xe===void 0&&(Xe=setTimeout(Fe,it)),xe}return ut.cancel=tt,ut.flush=ct,ut}function ge(Ze,it,He){var Te=!0,st=!0;if(typeof Ze!="function")throw new TypeError(p);return Qe(He)&&(Te="leading"in He?!!He.leading:Te,st="trailing"in He?!!He.trailing:st),Q(Ze,it,{leading:Te,maxWait:it,trailing:st})}function Qe(Ze){var it=typeof Ze;return!!Ze&&(it=="object"||it=="function")}function Oe(Ze){return!!Ze&&typeof Ze=="object"}function Me(Ze){return typeof Ze=="symbol"||Oe(Ze)&&ee.call(Ze)==u}function Ge(Ze){if(typeof Ze=="number")return Ze;if(Me(Ze))return o;if(Qe(Ze)){var it=typeof Ze.valueOf=="function"?Ze.valueOf():Ze;Ze=Qe(it)?it+"":it}if(typeof Ze!="string")return Ze===0?Ze:+Ze;Ze=Ze.replace(m,"");var He=x.test(Ze);return He||b.test(Ze)?a(Ze.slice(2),He?2:8):v.test(Ze)?o:+Ze}return kp=ge,kp}var Q5=K5();const e3=Gy(Q5);let t3=new B5;th.addProtocol("pmtiles",t3.tile);const qy=18;document.addEventListener("DOMContentLoaded",async()=>{const p=new th.Map({container:"map",hash:!0,style:"./style.json",center:[135.57,34.777],zoom:13,maxZoom:19,minZoom:4,localIdeographFontFamily:["BIZ UDPGothic","sans-serif"]});Gc.init(p);function o(){const{_sw:C,_ne:F}=p.getBounds();return{minX:C.lng,minY:C.lat,maxX:F.lng,maxY:F.lat}}async function u(){if(p.getZoom()<qy)return;let C=0;const F={type:"FeatureCollection",features:[]};let O=J5.deserialize("./data/r1chikeizu.fgb",o());for await(let Y of O)F.features.push({...Y,id:C}),C+=1;p.getSource("blocks").setData(F)}p.on("load",()=>{p.on("click",C=>{const O=["senbiki-fill","youto-fill","koudoti-fill","bouka-fill"].map(j=>p.queryRenderedFeatures(C.point,{layers:[j]})[0]);if(O[0]===void 0)return;const Y=[O[0].properties.];Y[0]==""&&(Y[1]=`<br>${O[1].properties.}
      <li>${O[1].properties.}</li>
      <li>${O[1].properties.}</li>`,Y[2]=O[2]?.properties?.Type??""),Y[3]="<br>",Y[4]=O[3]?.properties?.??"22";const ee=Y.join("");new th.Popup().setLngLat(C.lngLat).setHTML(ee).addTo(p)}),p.addSource("blocks",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),p.addLayer({id:"blocks-line",type:"line",source:"blocks",minzoom:qy,paint:{"line-color":["match",["get","layer"],"","#232323","","#232323","","#a8a1ad","#7b7b7d"],"line-width":["match",["get","layer"],"",2.6,"",1.6,"",1.6,.6]}}),u=e3(u,500),u(),p.on("moveend",function(C){u()})});const m={forwardGeocode:async C=>{const F=[],O=`https://geocode.csis.u-tokyo.ac.jp/cgi-bin/simple_geocode.cgi?addr=${C.query}&charset=UTF8&constraint=`,ee=await(await fetch(O)).text(),Pe=await new DOMParser().parseFromString(ee,"text/xml"),ce=[Pe.getElementsByTagName("longitude")[0].firstChild.nodeValue,Pe.getElementsByTagName("latitude")[0].firstChild.nodeValue],Q={type:"Feature",geometry:{type:"Point",coordinates:ce},place_name:Pe.getElementsByTagName("address")[0].textContent,place_type:["place"],center:ce};return F.push(Q),{features:F}}};p.addControl(new Kb(m,{maplibregl:th})),p.addControl(new th.NavigationControl),p.addControl(new l5({Format:yc.PNG,Crosshair:!0,PrintableArea:!0,Local:"ja"})),p.addControl(new th.ScaleControl({maxWidth:200}));let v=document.getElementById("style"),x=document.getElementById("kyk"),b=document.getElementById("tyk"),a=document.getElementById("bdr");document.getElementById("style").addEventListener("click",()=>{const C=v.checked;p.U.toggle("r-raster",C),p.U.toggle(["tran-fill","bldg-fill"],!C),p.U.toggleSource("v",!C)}),document.getElementById("kyk").addEventListener("click",()=>{p.U.toggle("kyojuu-fill",x.checked),p.U.toggle("youto-fill",!(x.checked||b.checked))}),document.getElementById("tyk").addEventListener("click",()=>{p.U.toggle("toshikinou-fill",b.checked),p.U.toggle("youto-fill",!(x.checked||b.checked))}),document.getElementById("bdr").addEventListener("click",()=>{p.U.toggle(/-symbol$/,a.checked)})});export{$i as w};
